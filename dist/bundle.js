(() => {
  var __defProp = Object.defineProperty;
  var __defProps = Object.defineProperties;
  var __getOwnPropDescs = Object.getOwnPropertyDescriptors;
  var __getOwnPropSymbols = Object.getOwnPropertySymbols;
  var __hasOwnProp = Object.prototype.hasOwnProperty;
  var __propIsEnum = Object.prototype.propertyIsEnumerable;
  var __defNormalProp = (obj, key, value) => key in obj ? __defProp(obj, key, { enumerable: true, configurable: true, writable: true, value }) : obj[key] = value;
  var __spreadValues = (a, b) => {
    for (var prop in b || (b = {}))
      if (__hasOwnProp.call(b, prop))
        __defNormalProp(a, prop, b[prop]);
    if (__getOwnPropSymbols)
      for (var prop of __getOwnPropSymbols(b)) {
        if (__propIsEnum.call(b, prop))
          __defNormalProp(a, prop, b[prop]);
      }
    return a;
  };
  var __spreadProps = (a, b) => __defProps(a, __getOwnPropDescs(b));

  // node_modules/.pnpm/@firebase+util@1.6.0/node_modules/@firebase/util/dist/index.esm2017.js
  var stringToByteArray$1 = function(str) {
    const out = [];
    let p2 = 0;
    for (let i = 0; i < str.length; i++) {
      let c = str.charCodeAt(i);
      if (c < 128) {
        out[p2++] = c;
      } else if (c < 2048) {
        out[p2++] = c >> 6 | 192;
        out[p2++] = c & 63 | 128;
      } else if ((c & 64512) === 55296 && i + 1 < str.length && (str.charCodeAt(i + 1) & 64512) === 56320) {
        c = 65536 + ((c & 1023) << 10) + (str.charCodeAt(++i) & 1023);
        out[p2++] = c >> 18 | 240;
        out[p2++] = c >> 12 & 63 | 128;
        out[p2++] = c >> 6 & 63 | 128;
        out[p2++] = c & 63 | 128;
      } else {
        out[p2++] = c >> 12 | 224;
        out[p2++] = c >> 6 & 63 | 128;
        out[p2++] = c & 63 | 128;
      }
    }
    return out;
  };
  var byteArrayToString = function(bytes) {
    const out = [];
    let pos = 0, c = 0;
    while (pos < bytes.length) {
      const c1 = bytes[pos++];
      if (c1 < 128) {
        out[c++] = String.fromCharCode(c1);
      } else if (c1 > 191 && c1 < 224) {
        const c2 = bytes[pos++];
        out[c++] = String.fromCharCode((c1 & 31) << 6 | c2 & 63);
      } else if (c1 > 239 && c1 < 365) {
        const c2 = bytes[pos++];
        const c3 = bytes[pos++];
        const c4 = bytes[pos++];
        const u = ((c1 & 7) << 18 | (c2 & 63) << 12 | (c3 & 63) << 6 | c4 & 63) - 65536;
        out[c++] = String.fromCharCode(55296 + (u >> 10));
        out[c++] = String.fromCharCode(56320 + (u & 1023));
      } else {
        const c2 = bytes[pos++];
        const c3 = bytes[pos++];
        out[c++] = String.fromCharCode((c1 & 15) << 12 | (c2 & 63) << 6 | c3 & 63);
      }
    }
    return out.join("");
  };
  var base64 = {
    byteToCharMap_: null,
    charToByteMap_: null,
    byteToCharMapWebSafe_: null,
    charToByteMapWebSafe_: null,
    ENCODED_VALS_BASE: "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",
    get ENCODED_VALS() {
      return this.ENCODED_VALS_BASE + "+/=";
    },
    get ENCODED_VALS_WEBSAFE() {
      return this.ENCODED_VALS_BASE + "-_.";
    },
    HAS_NATIVE_SUPPORT: typeof atob === "function",
    encodeByteArray(input, webSafe) {
      if (!Array.isArray(input)) {
        throw Error("encodeByteArray takes an array as a parameter");
      }
      this.init_();
      const byteToCharMap = webSafe ? this.byteToCharMapWebSafe_ : this.byteToCharMap_;
      const output = [];
      for (let i = 0; i < input.length; i += 3) {
        const byte1 = input[i];
        const haveByte2 = i + 1 < input.length;
        const byte2 = haveByte2 ? input[i + 1] : 0;
        const haveByte3 = i + 2 < input.length;
        const byte3 = haveByte3 ? input[i + 2] : 0;
        const outByte1 = byte1 >> 2;
        const outByte2 = (byte1 & 3) << 4 | byte2 >> 4;
        let outByte3 = (byte2 & 15) << 2 | byte3 >> 6;
        let outByte4 = byte3 & 63;
        if (!haveByte3) {
          outByte4 = 64;
          if (!haveByte2) {
            outByte3 = 64;
          }
        }
        output.push(byteToCharMap[outByte1], byteToCharMap[outByte2], byteToCharMap[outByte3], byteToCharMap[outByte4]);
      }
      return output.join("");
    },
    encodeString(input, webSafe) {
      if (this.HAS_NATIVE_SUPPORT && !webSafe) {
        return btoa(input);
      }
      return this.encodeByteArray(stringToByteArray$1(input), webSafe);
    },
    decodeString(input, webSafe) {
      if (this.HAS_NATIVE_SUPPORT && !webSafe) {
        return atob(input);
      }
      return byteArrayToString(this.decodeStringToByteArray(input, webSafe));
    },
    decodeStringToByteArray(input, webSafe) {
      this.init_();
      const charToByteMap = webSafe ? this.charToByteMapWebSafe_ : this.charToByteMap_;
      const output = [];
      for (let i = 0; i < input.length; ) {
        const byte1 = charToByteMap[input.charAt(i++)];
        const haveByte2 = i < input.length;
        const byte2 = haveByte2 ? charToByteMap[input.charAt(i)] : 0;
        ++i;
        const haveByte3 = i < input.length;
        const byte3 = haveByte3 ? charToByteMap[input.charAt(i)] : 64;
        ++i;
        const haveByte4 = i < input.length;
        const byte4 = haveByte4 ? charToByteMap[input.charAt(i)] : 64;
        ++i;
        if (byte1 == null || byte2 == null || byte3 == null || byte4 == null) {
          throw Error();
        }
        const outByte1 = byte1 << 2 | byte2 >> 4;
        output.push(outByte1);
        if (byte3 !== 64) {
          const outByte2 = byte2 << 4 & 240 | byte3 >> 2;
          output.push(outByte2);
          if (byte4 !== 64) {
            const outByte3 = byte3 << 6 & 192 | byte4;
            output.push(outByte3);
          }
        }
      }
      return output;
    },
    init_() {
      if (!this.byteToCharMap_) {
        this.byteToCharMap_ = {};
        this.charToByteMap_ = {};
        this.byteToCharMapWebSafe_ = {};
        this.charToByteMapWebSafe_ = {};
        for (let i = 0; i < this.ENCODED_VALS.length; i++) {
          this.byteToCharMap_[i] = this.ENCODED_VALS.charAt(i);
          this.charToByteMap_[this.byteToCharMap_[i]] = i;
          this.byteToCharMapWebSafe_[i] = this.ENCODED_VALS_WEBSAFE.charAt(i);
          this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[i]] = i;
          if (i >= this.ENCODED_VALS_BASE.length) {
            this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(i)] = i;
            this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(i)] = i;
          }
        }
      }
    }
  };
  var base64Encode = function(str) {
    const utf8Bytes = stringToByteArray$1(str);
    return base64.encodeByteArray(utf8Bytes, true);
  };
  var base64urlEncodeWithoutPadding = function(str) {
    return base64Encode(str).replace(/\./g, "");
  };
  var Deferred = class {
    constructor() {
      this.reject = () => {
      };
      this.resolve = () => {
      };
      this.promise = new Promise((resolve, reject) => {
        this.resolve = resolve;
        this.reject = reject;
      });
    }
    wrapCallback(callback) {
      return (error, value) => {
        if (error) {
          this.reject(error);
        } else {
          this.resolve(value);
        }
        if (typeof callback === "function") {
          this.promise.catch(() => {
          });
          if (callback.length === 1) {
            callback(error);
          } else {
            callback(error, value);
          }
        }
      };
    }
  };
  function getUA() {
    if (typeof navigator !== "undefined" && typeof navigator["userAgent"] === "string") {
      return navigator["userAgent"];
    } else {
      return "";
    }
  }
  function isMobileCordova() {
    return typeof window !== "undefined" && !!(window["cordova"] || window["phonegap"] || window["PhoneGap"]) && /ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(getUA());
  }
  function isBrowserExtension() {
    const runtime = typeof chrome === "object" ? chrome.runtime : typeof browser === "object" ? browser.runtime : void 0;
    return typeof runtime === "object" && runtime.id !== void 0;
  }
  function isReactNative() {
    return typeof navigator === "object" && navigator["product"] === "ReactNative";
  }
  function isElectron() {
    return getUA().indexOf("Electron/") >= 0;
  }
  function isIE() {
    const ua2 = getUA();
    return ua2.indexOf("MSIE ") >= 0 || ua2.indexOf("Trident/") >= 0;
  }
  function isUWP() {
    return getUA().indexOf("MSAppHost/") >= 0;
  }
  function isIndexedDBAvailable() {
    return typeof indexedDB === "object";
  }
  function validateIndexedDBOpenable() {
    return new Promise((resolve, reject) => {
      try {
        let preExist = true;
        const DB_CHECK_NAME = "validate-browser-context-for-indexeddb-analytics-module";
        const request = self.indexedDB.open(DB_CHECK_NAME);
        request.onsuccess = () => {
          request.result.close();
          if (!preExist) {
            self.indexedDB.deleteDatabase(DB_CHECK_NAME);
          }
          resolve(true);
        };
        request.onupgradeneeded = () => {
          preExist = false;
        };
        request.onerror = () => {
          var _a2;
          reject(((_a2 = request.error) === null || _a2 === void 0 ? void 0 : _a2.message) || "");
        };
      } catch (error) {
        reject(error);
      }
    });
  }
  var ERROR_NAME = "FirebaseError";
  var FirebaseError = class extends Error {
    constructor(code, message, customData) {
      super(message);
      this.code = code;
      this.customData = customData;
      this.name = ERROR_NAME;
      Object.setPrototypeOf(this, FirebaseError.prototype);
      if (Error.captureStackTrace) {
        Error.captureStackTrace(this, ErrorFactory.prototype.create);
      }
    }
  };
  var ErrorFactory = class {
    constructor(service, serviceName, errors) {
      this.service = service;
      this.serviceName = serviceName;
      this.errors = errors;
    }
    create(code, ...data) {
      const customData = data[0] || {};
      const fullCode = `${this.service}/${code}`;
      const template = this.errors[code];
      const message = template ? replaceTemplate(template, customData) : "Error";
      const fullMessage = `${this.serviceName}: ${message} (${fullCode}).`;
      const error = new FirebaseError(fullCode, fullMessage, customData);
      return error;
    }
  };
  function replaceTemplate(template, data) {
    return template.replace(PATTERN, (_, key) => {
      const value = data[key];
      return value != null ? String(value) : `<${key}?>`;
    });
  }
  var PATTERN = /\{\$([^}]+)}/g;
  function deepEqual(a, b) {
    if (a === b) {
      return true;
    }
    const aKeys = Object.keys(a);
    const bKeys = Object.keys(b);
    for (const k3 of aKeys) {
      if (!bKeys.includes(k3)) {
        return false;
      }
      const aProp = a[k3];
      const bProp = b[k3];
      if (isObject(aProp) && isObject(bProp)) {
        if (!deepEqual(aProp, bProp)) {
          return false;
        }
      } else if (aProp !== bProp) {
        return false;
      }
    }
    for (const k3 of bKeys) {
      if (!aKeys.includes(k3)) {
        return false;
      }
    }
    return true;
  }
  function isObject(thing) {
    return thing !== null && typeof thing === "object";
  }
  var MAX_VALUE_MILLIS = 4 * 60 * 60 * 1e3;
  function getModularInstance(service) {
    if (service && service._delegate) {
      return service._delegate;
    } else {
      return service;
    }
  }

  // node_modules/.pnpm/@firebase+component@0.5.14/node_modules/@firebase/component/dist/esm/index.esm2017.js
  var Component = class {
    constructor(name3, instanceFactory, type) {
      this.name = name3;
      this.instanceFactory = instanceFactory;
      this.type = type;
      this.multipleInstances = false;
      this.serviceProps = {};
      this.instantiationMode = "LAZY";
      this.onInstanceCreated = null;
    }
    setInstantiationMode(mode) {
      this.instantiationMode = mode;
      return this;
    }
    setMultipleInstances(multipleInstances) {
      this.multipleInstances = multipleInstances;
      return this;
    }
    setServiceProps(props) {
      this.serviceProps = props;
      return this;
    }
    setInstanceCreatedCallback(callback) {
      this.onInstanceCreated = callback;
      return this;
    }
  };
  var DEFAULT_ENTRY_NAME = "[DEFAULT]";
  var Provider = class {
    constructor(name3, container) {
      this.name = name3;
      this.container = container;
      this.component = null;
      this.instances = /* @__PURE__ */ new Map();
      this.instancesDeferred = /* @__PURE__ */ new Map();
      this.instancesOptions = /* @__PURE__ */ new Map();
      this.onInitCallbacks = /* @__PURE__ */ new Map();
    }
    get(identifier) {
      const normalizedIdentifier = this.normalizeInstanceIdentifier(identifier);
      if (!this.instancesDeferred.has(normalizedIdentifier)) {
        const deferred = new Deferred();
        this.instancesDeferred.set(normalizedIdentifier, deferred);
        if (this.isInitialized(normalizedIdentifier) || this.shouldAutoInitialize()) {
          try {
            const instance = this.getOrInitializeService({
              instanceIdentifier: normalizedIdentifier
            });
            if (instance) {
              deferred.resolve(instance);
            }
          } catch (e) {
          }
        }
      }
      return this.instancesDeferred.get(normalizedIdentifier).promise;
    }
    getImmediate(options) {
      var _a2;
      const normalizedIdentifier = this.normalizeInstanceIdentifier(options === null || options === void 0 ? void 0 : options.identifier);
      const optional = (_a2 = options === null || options === void 0 ? void 0 : options.optional) !== null && _a2 !== void 0 ? _a2 : false;
      if (this.isInitialized(normalizedIdentifier) || this.shouldAutoInitialize()) {
        try {
          return this.getOrInitializeService({
            instanceIdentifier: normalizedIdentifier
          });
        } catch (e) {
          if (optional) {
            return null;
          } else {
            throw e;
          }
        }
      } else {
        if (optional) {
          return null;
        } else {
          throw Error(`Service ${this.name} is not available`);
        }
      }
    }
    getComponent() {
      return this.component;
    }
    setComponent(component) {
      if (component.name !== this.name) {
        throw Error(`Mismatching Component ${component.name} for Provider ${this.name}.`);
      }
      if (this.component) {
        throw Error(`Component for ${this.name} has already been provided`);
      }
      this.component = component;
      if (!this.shouldAutoInitialize()) {
        return;
      }
      if (isComponentEager(component)) {
        try {
          this.getOrInitializeService({ instanceIdentifier: DEFAULT_ENTRY_NAME });
        } catch (e) {
        }
      }
      for (const [instanceIdentifier, instanceDeferred] of this.instancesDeferred.entries()) {
        const normalizedIdentifier = this.normalizeInstanceIdentifier(instanceIdentifier);
        try {
          const instance = this.getOrInitializeService({
            instanceIdentifier: normalizedIdentifier
          });
          instanceDeferred.resolve(instance);
        } catch (e) {
        }
      }
    }
    clearInstance(identifier = DEFAULT_ENTRY_NAME) {
      this.instancesDeferred.delete(identifier);
      this.instancesOptions.delete(identifier);
      this.instances.delete(identifier);
    }
    async delete() {
      const services = Array.from(this.instances.values());
      await Promise.all([
        ...services.filter((service) => "INTERNAL" in service).map((service) => service.INTERNAL.delete()),
        ...services.filter((service) => "_delete" in service).map((service) => service._delete())
      ]);
    }
    isComponentSet() {
      return this.component != null;
    }
    isInitialized(identifier = DEFAULT_ENTRY_NAME) {
      return this.instances.has(identifier);
    }
    getOptions(identifier = DEFAULT_ENTRY_NAME) {
      return this.instancesOptions.get(identifier) || {};
    }
    initialize(opts = {}) {
      const { options = {} } = opts;
      const normalizedIdentifier = this.normalizeInstanceIdentifier(opts.instanceIdentifier);
      if (this.isInitialized(normalizedIdentifier)) {
        throw Error(`${this.name}(${normalizedIdentifier}) has already been initialized`);
      }
      if (!this.isComponentSet()) {
        throw Error(`Component ${this.name} has not been registered yet`);
      }
      const instance = this.getOrInitializeService({
        instanceIdentifier: normalizedIdentifier,
        options
      });
      for (const [instanceIdentifier, instanceDeferred] of this.instancesDeferred.entries()) {
        const normalizedDeferredIdentifier = this.normalizeInstanceIdentifier(instanceIdentifier);
        if (normalizedIdentifier === normalizedDeferredIdentifier) {
          instanceDeferred.resolve(instance);
        }
      }
      return instance;
    }
    onInit(callback, identifier) {
      var _a2;
      const normalizedIdentifier = this.normalizeInstanceIdentifier(identifier);
      const existingCallbacks = (_a2 = this.onInitCallbacks.get(normalizedIdentifier)) !== null && _a2 !== void 0 ? _a2 : /* @__PURE__ */ new Set();
      existingCallbacks.add(callback);
      this.onInitCallbacks.set(normalizedIdentifier, existingCallbacks);
      const existingInstance = this.instances.get(normalizedIdentifier);
      if (existingInstance) {
        callback(existingInstance, normalizedIdentifier);
      }
      return () => {
        existingCallbacks.delete(callback);
      };
    }
    invokeOnInitCallbacks(instance, identifier) {
      const callbacks = this.onInitCallbacks.get(identifier);
      if (!callbacks) {
        return;
      }
      for (const callback of callbacks) {
        try {
          callback(instance, identifier);
        } catch (_a2) {
        }
      }
    }
    getOrInitializeService({ instanceIdentifier, options = {} }) {
      let instance = this.instances.get(instanceIdentifier);
      if (!instance && this.component) {
        instance = this.component.instanceFactory(this.container, {
          instanceIdentifier: normalizeIdentifierForFactory(instanceIdentifier),
          options
        });
        this.instances.set(instanceIdentifier, instance);
        this.instancesOptions.set(instanceIdentifier, options);
        this.invokeOnInitCallbacks(instance, instanceIdentifier);
        if (this.component.onInstanceCreated) {
          try {
            this.component.onInstanceCreated(this.container, instanceIdentifier, instance);
          } catch (_a2) {
          }
        }
      }
      return instance || null;
    }
    normalizeInstanceIdentifier(identifier = DEFAULT_ENTRY_NAME) {
      if (this.component) {
        return this.component.multipleInstances ? identifier : DEFAULT_ENTRY_NAME;
      } else {
        return identifier;
      }
    }
    shouldAutoInitialize() {
      return !!this.component && this.component.instantiationMode !== "EXPLICIT";
    }
  };
  function normalizeIdentifierForFactory(identifier) {
    return identifier === DEFAULT_ENTRY_NAME ? void 0 : identifier;
  }
  function isComponentEager(component) {
    return component.instantiationMode === "EAGER";
  }
  var ComponentContainer = class {
    constructor(name3) {
      this.name = name3;
      this.providers = /* @__PURE__ */ new Map();
    }
    addComponent(component) {
      const provider = this.getProvider(component.name);
      if (provider.isComponentSet()) {
        throw new Error(`Component ${component.name} has already been registered with ${this.name}`);
      }
      provider.setComponent(component);
    }
    addOrOverwriteComponent(component) {
      const provider = this.getProvider(component.name);
      if (provider.isComponentSet()) {
        this.providers.delete(component.name);
      }
      this.addComponent(component);
    }
    getProvider(name3) {
      if (this.providers.has(name3)) {
        return this.providers.get(name3);
      }
      const provider = new Provider(name3, this);
      this.providers.set(name3, provider);
      return provider;
    }
    getProviders() {
      return Array.from(this.providers.values());
    }
  };

  // node_modules/.pnpm/@firebase+logger@0.3.2/node_modules/@firebase/logger/dist/esm/index.esm2017.js
  var instances = [];
  var LogLevel;
  (function(LogLevel2) {
    LogLevel2[LogLevel2["DEBUG"] = 0] = "DEBUG";
    LogLevel2[LogLevel2["VERBOSE"] = 1] = "VERBOSE";
    LogLevel2[LogLevel2["INFO"] = 2] = "INFO";
    LogLevel2[LogLevel2["WARN"] = 3] = "WARN";
    LogLevel2[LogLevel2["ERROR"] = 4] = "ERROR";
    LogLevel2[LogLevel2["SILENT"] = 5] = "SILENT";
  })(LogLevel || (LogLevel = {}));
  var levelStringToEnum = {
    "debug": LogLevel.DEBUG,
    "verbose": LogLevel.VERBOSE,
    "info": LogLevel.INFO,
    "warn": LogLevel.WARN,
    "error": LogLevel.ERROR,
    "silent": LogLevel.SILENT
  };
  var defaultLogLevel = LogLevel.INFO;
  var ConsoleMethod = {
    [LogLevel.DEBUG]: "log",
    [LogLevel.VERBOSE]: "log",
    [LogLevel.INFO]: "info",
    [LogLevel.WARN]: "warn",
    [LogLevel.ERROR]: "error"
  };
  var defaultLogHandler = (instance, logType, ...args) => {
    if (logType < instance.logLevel) {
      return;
    }
    const now = new Date().toISOString();
    const method = ConsoleMethod[logType];
    if (method) {
      console[method](`[${now}]  ${instance.name}:`, ...args);
    } else {
      throw new Error(`Attempted to log a message with an invalid logType (value: ${logType})`);
    }
  };
  var Logger = class {
    constructor(name3) {
      this.name = name3;
      this._logLevel = defaultLogLevel;
      this._logHandler = defaultLogHandler;
      this._userLogHandler = null;
      instances.push(this);
    }
    get logLevel() {
      return this._logLevel;
    }
    set logLevel(val) {
      if (!(val in LogLevel)) {
        throw new TypeError(`Invalid value "${val}" assigned to \`logLevel\``);
      }
      this._logLevel = val;
    }
    setLogLevel(val) {
      this._logLevel = typeof val === "string" ? levelStringToEnum[val] : val;
    }
    get logHandler() {
      return this._logHandler;
    }
    set logHandler(val) {
      if (typeof val !== "function") {
        throw new TypeError("Value assigned to `logHandler` must be a function");
      }
      this._logHandler = val;
    }
    get userLogHandler() {
      return this._userLogHandler;
    }
    set userLogHandler(val) {
      this._userLogHandler = val;
    }
    debug(...args) {
      this._userLogHandler && this._userLogHandler(this, LogLevel.DEBUG, ...args);
      this._logHandler(this, LogLevel.DEBUG, ...args);
    }
    log(...args) {
      this._userLogHandler && this._userLogHandler(this, LogLevel.VERBOSE, ...args);
      this._logHandler(this, LogLevel.VERBOSE, ...args);
    }
    info(...args) {
      this._userLogHandler && this._userLogHandler(this, LogLevel.INFO, ...args);
      this._logHandler(this, LogLevel.INFO, ...args);
    }
    warn(...args) {
      this._userLogHandler && this._userLogHandler(this, LogLevel.WARN, ...args);
      this._logHandler(this, LogLevel.WARN, ...args);
    }
    error(...args) {
      this._userLogHandler && this._userLogHandler(this, LogLevel.ERROR, ...args);
      this._logHandler(this, LogLevel.ERROR, ...args);
    }
  };

  // node_modules/.pnpm/idb@7.0.1/node_modules/idb/build/wrap-idb-value.js
  var instanceOfAny = (object, constructors) => constructors.some((c) => object instanceof c);
  var idbProxyableTypes;
  var cursorAdvanceMethods;
  function getIdbProxyableTypes() {
    return idbProxyableTypes || (idbProxyableTypes = [
      IDBDatabase,
      IDBObjectStore,
      IDBIndex,
      IDBCursor,
      IDBTransaction
    ]);
  }
  function getCursorAdvanceMethods() {
    return cursorAdvanceMethods || (cursorAdvanceMethods = [
      IDBCursor.prototype.advance,
      IDBCursor.prototype.continue,
      IDBCursor.prototype.continuePrimaryKey
    ]);
  }
  var cursorRequestMap = /* @__PURE__ */ new WeakMap();
  var transactionDoneMap = /* @__PURE__ */ new WeakMap();
  var transactionStoreNamesMap = /* @__PURE__ */ new WeakMap();
  var transformCache = /* @__PURE__ */ new WeakMap();
  var reverseTransformCache = /* @__PURE__ */ new WeakMap();
  function promisifyRequest(request) {
    const promise = new Promise((resolve, reject) => {
      const unlisten = () => {
        request.removeEventListener("success", success);
        request.removeEventListener("error", error);
      };
      const success = () => {
        resolve(wrap(request.result));
        unlisten();
      };
      const error = () => {
        reject(request.error);
        unlisten();
      };
      request.addEventListener("success", success);
      request.addEventListener("error", error);
    });
    promise.then((value) => {
      if (value instanceof IDBCursor) {
        cursorRequestMap.set(value, request);
      }
    }).catch(() => {
    });
    reverseTransformCache.set(promise, request);
    return promise;
  }
  function cacheDonePromiseForTransaction(tx) {
    if (transactionDoneMap.has(tx))
      return;
    const done = new Promise((resolve, reject) => {
      const unlisten = () => {
        tx.removeEventListener("complete", complete);
        tx.removeEventListener("error", error);
        tx.removeEventListener("abort", error);
      };
      const complete = () => {
        resolve();
        unlisten();
      };
      const error = () => {
        reject(tx.error || new DOMException("AbortError", "AbortError"));
        unlisten();
      };
      tx.addEventListener("complete", complete);
      tx.addEventListener("error", error);
      tx.addEventListener("abort", error);
    });
    transactionDoneMap.set(tx, done);
  }
  var idbProxyTraps = {
    get(target, prop, receiver) {
      if (target instanceof IDBTransaction) {
        if (prop === "done")
          return transactionDoneMap.get(target);
        if (prop === "objectStoreNames") {
          return target.objectStoreNames || transactionStoreNamesMap.get(target);
        }
        if (prop === "store") {
          return receiver.objectStoreNames[1] ? void 0 : receiver.objectStore(receiver.objectStoreNames[0]);
        }
      }
      return wrap(target[prop]);
    },
    set(target, prop, value) {
      target[prop] = value;
      return true;
    },
    has(target, prop) {
      if (target instanceof IDBTransaction && (prop === "done" || prop === "store")) {
        return true;
      }
      return prop in target;
    }
  };
  function replaceTraps(callback) {
    idbProxyTraps = callback(idbProxyTraps);
  }
  function wrapFunction(func) {
    if (func === IDBDatabase.prototype.transaction && !("objectStoreNames" in IDBTransaction.prototype)) {
      return function(storeNames, ...args) {
        const tx = func.call(unwrap(this), storeNames, ...args);
        transactionStoreNamesMap.set(tx, storeNames.sort ? storeNames.sort() : [storeNames]);
        return wrap(tx);
      };
    }
    if (getCursorAdvanceMethods().includes(func)) {
      return function(...args) {
        func.apply(unwrap(this), args);
        return wrap(cursorRequestMap.get(this));
      };
    }
    return function(...args) {
      return wrap(func.apply(unwrap(this), args));
    };
  }
  function transformCachableValue(value) {
    if (typeof value === "function")
      return wrapFunction(value);
    if (value instanceof IDBTransaction)
      cacheDonePromiseForTransaction(value);
    if (instanceOfAny(value, getIdbProxyableTypes()))
      return new Proxy(value, idbProxyTraps);
    return value;
  }
  function wrap(value) {
    if (value instanceof IDBRequest)
      return promisifyRequest(value);
    if (transformCache.has(value))
      return transformCache.get(value);
    const newValue = transformCachableValue(value);
    if (newValue !== value) {
      transformCache.set(value, newValue);
      reverseTransformCache.set(newValue, value);
    }
    return newValue;
  }
  var unwrap = (value) => reverseTransformCache.get(value);

  // node_modules/.pnpm/idb@7.0.1/node_modules/idb/build/index.js
  function openDB(name3, version3, { blocked, upgrade, blocking, terminated } = {}) {
    const request = indexedDB.open(name3, version3);
    const openPromise = wrap(request);
    if (upgrade) {
      request.addEventListener("upgradeneeded", (event) => {
        upgrade(wrap(request.result), event.oldVersion, event.newVersion, wrap(request.transaction));
      });
    }
    if (blocked)
      request.addEventListener("blocked", () => blocked());
    openPromise.then((db3) => {
      if (terminated)
        db3.addEventListener("close", () => terminated());
      if (blocking)
        db3.addEventListener("versionchange", () => blocking());
    }).catch(() => {
    });
    return openPromise;
  }
  var readMethods = ["get", "getKey", "getAll", "getAllKeys", "count"];
  var writeMethods = ["put", "add", "delete", "clear"];
  var cachedMethods = /* @__PURE__ */ new Map();
  function getMethod(target, prop) {
    if (!(target instanceof IDBDatabase && !(prop in target) && typeof prop === "string")) {
      return;
    }
    if (cachedMethods.get(prop))
      return cachedMethods.get(prop);
    const targetFuncName = prop.replace(/FromIndex$/, "");
    const useIndex = prop !== targetFuncName;
    const isWrite = writeMethods.includes(targetFuncName);
    if (!(targetFuncName in (useIndex ? IDBIndex : IDBObjectStore).prototype) || !(isWrite || readMethods.includes(targetFuncName))) {
      return;
    }
    const method = async function(storeName, ...args) {
      const tx = this.transaction(storeName, isWrite ? "readwrite" : "readonly");
      let target2 = tx.store;
      if (useIndex)
        target2 = target2.index(args.shift());
      return (await Promise.all([
        target2[targetFuncName](...args),
        isWrite && tx.done
      ]))[0];
    };
    cachedMethods.set(prop, method);
    return method;
  }
  replaceTraps((oldTraps) => __spreadProps(__spreadValues({}, oldTraps), {
    get: (target, prop, receiver) => getMethod(target, prop) || oldTraps.get(target, prop, receiver),
    has: (target, prop) => !!getMethod(target, prop) || oldTraps.has(target, prop)
  }));

  // node_modules/.pnpm/@firebase+app@0.7.25/node_modules/@firebase/app/dist/esm/index.esm2017.js
  var PlatformLoggerServiceImpl = class {
    constructor(container) {
      this.container = container;
    }
    getPlatformInfoString() {
      const providers = this.container.getProviders();
      return providers.map((provider) => {
        if (isVersionServiceProvider(provider)) {
          const service = provider.getImmediate();
          return `${service.library}/${service.version}`;
        } else {
          return null;
        }
      }).filter((logString) => logString).join(" ");
    }
  };
  function isVersionServiceProvider(provider) {
    const component = provider.getComponent();
    return (component === null || component === void 0 ? void 0 : component.type) === "VERSION";
  }
  var name$o = "@firebase/app";
  var version$1 = "0.7.25";
  var logger = new Logger("@firebase/app");
  var name$n = "@firebase/app-compat";
  var name$m = "@firebase/analytics-compat";
  var name$l = "@firebase/analytics";
  var name$k = "@firebase/app-check-compat";
  var name$j = "@firebase/app-check";
  var name$i = "@firebase/auth";
  var name$h = "@firebase/auth-compat";
  var name$g = "@firebase/database";
  var name$f = "@firebase/database-compat";
  var name$e = "@firebase/functions";
  var name$d = "@firebase/functions-compat";
  var name$c = "@firebase/installations";
  var name$b = "@firebase/installations-compat";
  var name$a = "@firebase/messaging";
  var name$9 = "@firebase/messaging-compat";
  var name$8 = "@firebase/performance";
  var name$7 = "@firebase/performance-compat";
  var name$6 = "@firebase/remote-config";
  var name$5 = "@firebase/remote-config-compat";
  var name$4 = "@firebase/storage";
  var name$3 = "@firebase/storage-compat";
  var name$2 = "@firebase/firestore";
  var name$1 = "@firebase/firestore-compat";
  var name = "firebase";
  var version = "9.8.2";
  var DEFAULT_ENTRY_NAME2 = "[DEFAULT]";
  var PLATFORM_LOG_STRING = {
    [name$o]: "fire-core",
    [name$n]: "fire-core-compat",
    [name$l]: "fire-analytics",
    [name$m]: "fire-analytics-compat",
    [name$j]: "fire-app-check",
    [name$k]: "fire-app-check-compat",
    [name$i]: "fire-auth",
    [name$h]: "fire-auth-compat",
    [name$g]: "fire-rtdb",
    [name$f]: "fire-rtdb-compat",
    [name$e]: "fire-fn",
    [name$d]: "fire-fn-compat",
    [name$c]: "fire-iid",
    [name$b]: "fire-iid-compat",
    [name$a]: "fire-fcm",
    [name$9]: "fire-fcm-compat",
    [name$8]: "fire-perf",
    [name$7]: "fire-perf-compat",
    [name$6]: "fire-rc",
    [name$5]: "fire-rc-compat",
    [name$4]: "fire-gcs",
    [name$3]: "fire-gcs-compat",
    [name$2]: "fire-fst",
    [name$1]: "fire-fst-compat",
    "fire-js": "fire-js",
    [name]: "fire-js-all"
  };
  var _apps = /* @__PURE__ */ new Map();
  var _components = /* @__PURE__ */ new Map();
  function _addComponent(app2, component) {
    try {
      app2.container.addComponent(component);
    } catch (e) {
      logger.debug(`Component ${component.name} failed to register with FirebaseApp ${app2.name}`, e);
    }
  }
  function _registerComponent(component) {
    const componentName = component.name;
    if (_components.has(componentName)) {
      logger.debug(`There were multiple attempts to register component ${componentName}.`);
      return false;
    }
    _components.set(componentName, component);
    for (const app2 of _apps.values()) {
      _addComponent(app2, component);
    }
    return true;
  }
  function _getProvider(app2, name3) {
    const heartbeatController = app2.container.getProvider("heartbeat").getImmediate({ optional: true });
    if (heartbeatController) {
      void heartbeatController.triggerHeartbeat();
    }
    return app2.container.getProvider(name3);
  }
  var ERRORS = {
    ["no-app"]: "No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",
    ["bad-app-name"]: "Illegal App name: '{$appName}",
    ["duplicate-app"]: "Firebase App named '{$appName}' already exists with different options or config",
    ["app-deleted"]: "Firebase App named '{$appName}' already deleted",
    ["invalid-app-argument"]: "firebase.{$appName}() takes either no argument or a Firebase App instance.",
    ["invalid-log-argument"]: "First argument to `onLog` must be null or a function.",
    ["storage-open"]: "Error thrown when opening storage. Original error: {$originalErrorMessage}.",
    ["storage-get"]: "Error thrown when reading from storage. Original error: {$originalErrorMessage}.",
    ["storage-set"]: "Error thrown when writing to storage. Original error: {$originalErrorMessage}.",
    ["storage-delete"]: "Error thrown when deleting from storage. Original error: {$originalErrorMessage}."
  };
  var ERROR_FACTORY = new ErrorFactory("app", "Firebase", ERRORS);
  var FirebaseAppImpl = class {
    constructor(options, config, container) {
      this._isDeleted = false;
      this._options = Object.assign({}, options);
      this._config = Object.assign({}, config);
      this._name = config.name;
      this._automaticDataCollectionEnabled = config.automaticDataCollectionEnabled;
      this._container = container;
      this.container.addComponent(new Component("app", () => this, "PUBLIC"));
    }
    get automaticDataCollectionEnabled() {
      this.checkDestroyed();
      return this._automaticDataCollectionEnabled;
    }
    set automaticDataCollectionEnabled(val) {
      this.checkDestroyed();
      this._automaticDataCollectionEnabled = val;
    }
    get name() {
      this.checkDestroyed();
      return this._name;
    }
    get options() {
      this.checkDestroyed();
      return this._options;
    }
    get config() {
      this.checkDestroyed();
      return this._config;
    }
    get container() {
      return this._container;
    }
    get isDeleted() {
      return this._isDeleted;
    }
    set isDeleted(val) {
      this._isDeleted = val;
    }
    checkDestroyed() {
      if (this.isDeleted) {
        throw ERROR_FACTORY.create("app-deleted", { appName: this._name });
      }
    }
  };
  var SDK_VERSION = version;
  function initializeApp(options, rawConfig = {}) {
    if (typeof rawConfig !== "object") {
      const name4 = rawConfig;
      rawConfig = { name: name4 };
    }
    const config = Object.assign({ name: DEFAULT_ENTRY_NAME2, automaticDataCollectionEnabled: false }, rawConfig);
    const name3 = config.name;
    if (typeof name3 !== "string" || !name3) {
      throw ERROR_FACTORY.create("bad-app-name", {
        appName: String(name3)
      });
    }
    const existingApp = _apps.get(name3);
    if (existingApp) {
      if (deepEqual(options, existingApp.options) && deepEqual(config, existingApp.config)) {
        return existingApp;
      } else {
        throw ERROR_FACTORY.create("duplicate-app", { appName: name3 });
      }
    }
    const container = new ComponentContainer(name3);
    for (const component of _components.values()) {
      container.addComponent(component);
    }
    const newApp = new FirebaseAppImpl(options, config, container);
    _apps.set(name3, newApp);
    return newApp;
  }
  function getApp(name3 = DEFAULT_ENTRY_NAME2) {
    const app2 = _apps.get(name3);
    if (!app2) {
      throw ERROR_FACTORY.create("no-app", { appName: name3 });
    }
    return app2;
  }
  function registerVersion(libraryKeyOrName, version3, variant) {
    var _a2;
    let library = (_a2 = PLATFORM_LOG_STRING[libraryKeyOrName]) !== null && _a2 !== void 0 ? _a2 : libraryKeyOrName;
    if (variant) {
      library += `-${variant}`;
    }
    const libraryMismatch = library.match(/\s|\//);
    const versionMismatch = version3.match(/\s|\//);
    if (libraryMismatch || versionMismatch) {
      const warning = [
        `Unable to register library "${library}" with version "${version3}":`
      ];
      if (libraryMismatch) {
        warning.push(`library name "${library}" contains illegal characters (whitespace or "/")`);
      }
      if (libraryMismatch && versionMismatch) {
        warning.push("and");
      }
      if (versionMismatch) {
        warning.push(`version name "${version3}" contains illegal characters (whitespace or "/")`);
      }
      logger.warn(warning.join(" "));
      return;
    }
    _registerComponent(new Component(`${library}-version`, () => ({ library, version: version3 }), "VERSION"));
  }
  var DB_NAME = "firebase-heartbeat-database";
  var DB_VERSION = 1;
  var STORE_NAME = "firebase-heartbeat-store";
  var dbPromise = null;
  function getDbPromise() {
    if (!dbPromise) {
      dbPromise = openDB(DB_NAME, DB_VERSION, {
        upgrade: (db3, oldVersion) => {
          switch (oldVersion) {
            case 0:
              db3.createObjectStore(STORE_NAME);
          }
        }
      }).catch((e) => {
        throw ERROR_FACTORY.create("storage-open", {
          originalErrorMessage: e.message
        });
      });
    }
    return dbPromise;
  }
  async function readHeartbeatsFromIndexedDB(app2) {
    try {
      const db3 = await getDbPromise();
      return db3.transaction(STORE_NAME).objectStore(STORE_NAME).get(computeKey(app2));
    } catch (e) {
      throw ERROR_FACTORY.create("storage-get", {
        originalErrorMessage: e.message
      });
    }
  }
  async function writeHeartbeatsToIndexedDB(app2, heartbeatObject) {
    try {
      const db3 = await getDbPromise();
      const tx = db3.transaction(STORE_NAME, "readwrite");
      const objectStore = tx.objectStore(STORE_NAME);
      await objectStore.put(heartbeatObject, computeKey(app2));
      return tx.done;
    } catch (e) {
      throw ERROR_FACTORY.create("storage-set", {
        originalErrorMessage: e.message
      });
    }
  }
  function computeKey(app2) {
    return `${app2.name}!${app2.options.appId}`;
  }
  var MAX_HEADER_BYTES = 1024;
  var STORED_HEARTBEAT_RETENTION_MAX_MILLIS = 30 * 24 * 60 * 60 * 1e3;
  var HeartbeatServiceImpl = class {
    constructor(container) {
      this.container = container;
      this._heartbeatsCache = null;
      const app2 = this.container.getProvider("app").getImmediate();
      this._storage = new HeartbeatStorageImpl(app2);
      this._heartbeatsCachePromise = this._storage.read().then((result) => {
        this._heartbeatsCache = result;
        return result;
      });
    }
    async triggerHeartbeat() {
      const platformLogger = this.container.getProvider("platform-logger").getImmediate();
      const agent = platformLogger.getPlatformInfoString();
      const date = getUTCDateString();
      if (this._heartbeatsCache === null) {
        this._heartbeatsCache = await this._heartbeatsCachePromise;
      }
      if (this._heartbeatsCache.lastSentHeartbeatDate === date || this._heartbeatsCache.heartbeats.some((singleDateHeartbeat) => singleDateHeartbeat.date === date)) {
        return;
      } else {
        this._heartbeatsCache.heartbeats.push({ date, agent });
      }
      this._heartbeatsCache.heartbeats = this._heartbeatsCache.heartbeats.filter((singleDateHeartbeat) => {
        const hbTimestamp = new Date(singleDateHeartbeat.date).valueOf();
        const now = Date.now();
        return now - hbTimestamp <= STORED_HEARTBEAT_RETENTION_MAX_MILLIS;
      });
      return this._storage.overwrite(this._heartbeatsCache);
    }
    async getHeartbeatsHeader() {
      if (this._heartbeatsCache === null) {
        await this._heartbeatsCachePromise;
      }
      if (this._heartbeatsCache === null || this._heartbeatsCache.heartbeats.length === 0) {
        return "";
      }
      const date = getUTCDateString();
      const { heartbeatsToSend, unsentEntries } = extractHeartbeatsForHeader(this._heartbeatsCache.heartbeats);
      const headerString = base64urlEncodeWithoutPadding(JSON.stringify({ version: 2, heartbeats: heartbeatsToSend }));
      this._heartbeatsCache.lastSentHeartbeatDate = date;
      if (unsentEntries.length > 0) {
        this._heartbeatsCache.heartbeats = unsentEntries;
        await this._storage.overwrite(this._heartbeatsCache);
      } else {
        this._heartbeatsCache.heartbeats = [];
        void this._storage.overwrite(this._heartbeatsCache);
      }
      return headerString;
    }
  };
  function getUTCDateString() {
    const today = new Date();
    return today.toISOString().substring(0, 10);
  }
  function extractHeartbeatsForHeader(heartbeatsCache, maxSize = MAX_HEADER_BYTES) {
    const heartbeatsToSend = [];
    let unsentEntries = heartbeatsCache.slice();
    for (const singleDateHeartbeat of heartbeatsCache) {
      const heartbeatEntry = heartbeatsToSend.find((hb2) => hb2.agent === singleDateHeartbeat.agent);
      if (!heartbeatEntry) {
        heartbeatsToSend.push({
          agent: singleDateHeartbeat.agent,
          dates: [singleDateHeartbeat.date]
        });
        if (countBytes(heartbeatsToSend) > maxSize) {
          heartbeatsToSend.pop();
          break;
        }
      } else {
        heartbeatEntry.dates.push(singleDateHeartbeat.date);
        if (countBytes(heartbeatsToSend) > maxSize) {
          heartbeatEntry.dates.pop();
          break;
        }
      }
      unsentEntries = unsentEntries.slice(1);
    }
    return {
      heartbeatsToSend,
      unsentEntries
    };
  }
  var HeartbeatStorageImpl = class {
    constructor(app2) {
      this.app = app2;
      this._canUseIndexedDBPromise = this.runIndexedDBEnvironmentCheck();
    }
    async runIndexedDBEnvironmentCheck() {
      if (!isIndexedDBAvailable()) {
        return false;
      } else {
        return validateIndexedDBOpenable().then(() => true).catch(() => false);
      }
    }
    async read() {
      const canUseIndexedDB = await this._canUseIndexedDBPromise;
      if (!canUseIndexedDB) {
        return { heartbeats: [] };
      } else {
        const idbHeartbeatObject = await readHeartbeatsFromIndexedDB(this.app);
        return idbHeartbeatObject || { heartbeats: [] };
      }
    }
    async overwrite(heartbeatsObject) {
      var _a2;
      const canUseIndexedDB = await this._canUseIndexedDBPromise;
      if (!canUseIndexedDB) {
        return;
      } else {
        const existingHeartbeatsObject = await this.read();
        return writeHeartbeatsToIndexedDB(this.app, {
          lastSentHeartbeatDate: (_a2 = heartbeatsObject.lastSentHeartbeatDate) !== null && _a2 !== void 0 ? _a2 : existingHeartbeatsObject.lastSentHeartbeatDate,
          heartbeats: heartbeatsObject.heartbeats
        });
      }
    }
    async add(heartbeatsObject) {
      var _a2;
      const canUseIndexedDB = await this._canUseIndexedDBPromise;
      if (!canUseIndexedDB) {
        return;
      } else {
        const existingHeartbeatsObject = await this.read();
        return writeHeartbeatsToIndexedDB(this.app, {
          lastSentHeartbeatDate: (_a2 = heartbeatsObject.lastSentHeartbeatDate) !== null && _a2 !== void 0 ? _a2 : existingHeartbeatsObject.lastSentHeartbeatDate,
          heartbeats: [
            ...existingHeartbeatsObject.heartbeats,
            ...heartbeatsObject.heartbeats
          ]
        });
      }
    }
  };
  function countBytes(heartbeatsCache) {
    return base64urlEncodeWithoutPadding(JSON.stringify({ version: 2, heartbeats: heartbeatsCache })).length;
  }
  function registerCoreComponents(variant) {
    _registerComponent(new Component("platform-logger", (container) => new PlatformLoggerServiceImpl(container), "PRIVATE"));
    _registerComponent(new Component("heartbeat", (container) => new HeartbeatServiceImpl(container), "PRIVATE"));
    registerVersion(name$o, version$1, variant);
    registerVersion(name$o, version$1, "esm2017");
    registerVersion("fire-js", "");
  }
  registerCoreComponents("");

  // node_modules/.pnpm/firebase@9.8.2/node_modules/firebase/app/dist/index.esm.js
  var name2 = "firebase";
  var version2 = "9.8.2";
  registerVersion(name2, version2, "app");

  // node_modules/.pnpm/@firebase+webchannel-wrapper@0.6.1/node_modules/@firebase/webchannel-wrapper/dist/index.esm2017.js
  var commonjsGlobal = typeof globalThis !== "undefined" ? globalThis : typeof window !== "undefined" ? window : typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : {};
  var esm = {};
  var k;
  var goog = goog || {};
  var l = commonjsGlobal || self;
  function aa() {
  }
  function ba(a) {
    var b = typeof a;
    b = b != "object" ? b : a ? Array.isArray(a) ? "array" : b : "null";
    return b == "array" || b == "object" && typeof a.length == "number";
  }
  function p(a) {
    var b = typeof a;
    return b == "object" && a != null || b == "function";
  }
  function da(a) {
    return Object.prototype.hasOwnProperty.call(a, ea) && a[ea] || (a[ea] = ++fa);
  }
  var ea = "closure_uid_" + (1e9 * Math.random() >>> 0);
  var fa = 0;
  function ha(a, b, c) {
    return a.call.apply(a.bind, arguments);
  }
  function ia(a, b, c) {
    if (!a)
      throw Error();
    if (2 < arguments.length) {
      var d = Array.prototype.slice.call(arguments, 2);
      return function() {
        var e = Array.prototype.slice.call(arguments);
        Array.prototype.unshift.apply(e, d);
        return a.apply(b, e);
      };
    }
    return function() {
      return a.apply(b, arguments);
    };
  }
  function q(a, b, c) {
    Function.prototype.bind && Function.prototype.bind.toString().indexOf("native code") != -1 ? q = ha : q = ia;
    return q.apply(null, arguments);
  }
  function ja(a, b) {
    var c = Array.prototype.slice.call(arguments, 1);
    return function() {
      var d = c.slice();
      d.push.apply(d, arguments);
      return a.apply(this, d);
    };
  }
  function t(a, b) {
    function c() {
    }
    c.prototype = b.prototype;
    a.Z = b.prototype;
    a.prototype = new c();
    a.prototype.constructor = a;
    a.Vb = function(d, e, f) {
      for (var h = Array(arguments.length - 2), n = 2; n < arguments.length; n++)
        h[n - 2] = arguments[n];
      return b.prototype[e].apply(d, h);
    };
  }
  function v() {
    this.s = this.s;
    this.o = this.o;
  }
  var ka = 0;
  var la = {};
  v.prototype.s = false;
  v.prototype.na = function() {
    if (!this.s && (this.s = true, this.M(), ka != 0)) {
      var a = da(this);
      delete la[a];
    }
  };
  v.prototype.M = function() {
    if (this.o)
      for (; this.o.length; )
        this.o.shift()();
  };
  var ma = Array.prototype.indexOf ? function(a, b) {
    return Array.prototype.indexOf.call(a, b, void 0);
  } : function(a, b) {
    if (typeof a === "string")
      return typeof b !== "string" || b.length != 1 ? -1 : a.indexOf(b, 0);
    for (let c = 0; c < a.length; c++)
      if (c in a && a[c] === b)
        return c;
    return -1;
  };
  var na = Array.prototype.forEach ? function(a, b, c) {
    Array.prototype.forEach.call(a, b, c);
  } : function(a, b, c) {
    const d = a.length, e = typeof a === "string" ? a.split("") : a;
    for (let f = 0; f < d; f++)
      f in e && b.call(c, e[f], f, a);
  };
  function oa(a) {
    a: {
      var b = pa;
      const c = a.length, d = typeof a === "string" ? a.split("") : a;
      for (let e = 0; e < c; e++)
        if (e in d && b.call(void 0, d[e], e, a)) {
          b = e;
          break a;
        }
      b = -1;
    }
    return 0 > b ? null : typeof a === "string" ? a.charAt(b) : a[b];
  }
  function qa(a) {
    return Array.prototype.concat.apply([], arguments);
  }
  function ra(a) {
    const b = a.length;
    if (0 < b) {
      const c = Array(b);
      for (let d = 0; d < b; d++)
        c[d] = a[d];
      return c;
    }
    return [];
  }
  function sa(a) {
    return /^[\s\xa0]*$/.test(a);
  }
  var ta = String.prototype.trim ? function(a) {
    return a.trim();
  } : function(a) {
    return /^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(a)[1];
  };
  function w(a, b) {
    return a.indexOf(b) != -1;
  }
  function ua(a, b) {
    return a < b ? -1 : a > b ? 1 : 0;
  }
  var x;
  a: {
    va = l.navigator;
    if (va) {
      wa2 = va.userAgent;
      if (wa2) {
        x = wa2;
        break a;
      }
    }
    x = "";
  }
  var va;
  var wa2;
  function xa(a, b, c) {
    for (const d in a)
      b.call(c, a[d], d, a);
  }
  function ya(a) {
    const b = {};
    for (const c in a)
      b[c] = a[c];
    return b;
  }
  var za = "constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");
  function Aa(a, b) {
    let c, d;
    for (let e = 1; e < arguments.length; e++) {
      d = arguments[e];
      for (c in d)
        a[c] = d[c];
      for (let f = 0; f < za.length; f++)
        c = za[f], Object.prototype.hasOwnProperty.call(d, c) && (a[c] = d[c]);
    }
  }
  function Ca(a) {
    Ca[" "](a);
    return a;
  }
  Ca[" "] = aa;
  function Fa(a) {
    var b = Ga;
    return Object.prototype.hasOwnProperty.call(b, 9) ? b[9] : b[9] = a(9);
  }
  var Ha = w(x, "Opera");
  var y = w(x, "Trident") || w(x, "MSIE");
  var Ia = w(x, "Edge");
  var Ja = Ia || y;
  var Ka = w(x, "Gecko") && !(w(x.toLowerCase(), "webkit") && !w(x, "Edge")) && !(w(x, "Trident") || w(x, "MSIE")) && !w(x, "Edge");
  var La = w(x.toLowerCase(), "webkit") && !w(x, "Edge");
  function Ma() {
    var a = l.document;
    return a ? a.documentMode : void 0;
  }
  var Na;
  a: {
    Oa = "", Pa2 = function() {
      var a = x;
      if (Ka)
        return /rv:([^\);]+)(\)|;)/.exec(a);
      if (Ia)
        return /Edge\/([\d\.]+)/.exec(a);
      if (y)
        return /\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(a);
      if (La)
        return /WebKit\/(\S+)/.exec(a);
      if (Ha)
        return /(?:Version)[ \/]?(\S+)/.exec(a);
    }();
    Pa2 && (Oa = Pa2 ? Pa2[1] : "");
    if (y) {
      Qa = Ma();
      if (Qa != null && Qa > parseFloat(Oa)) {
        Na = String(Qa);
        break a;
      }
    }
    Na = Oa;
  }
  var Oa;
  var Pa2;
  var Qa;
  var Ga = {};
  function Ra() {
    return Fa(function() {
      let a = 0;
      const b = ta(String(Na)).split("."), c = ta("9").split("."), d = Math.max(b.length, c.length);
      for (let h = 0; a == 0 && h < d; h++) {
        var e = b[h] || "", f = c[h] || "";
        do {
          e = /(\d*)(\D*)(.*)/.exec(e) || ["", "", "", ""];
          f = /(\d*)(\D*)(.*)/.exec(f) || ["", "", "", ""];
          if (e[0].length == 0 && f[0].length == 0)
            break;
          a = ua(e[1].length == 0 ? 0 : parseInt(e[1], 10), f[1].length == 0 ? 0 : parseInt(f[1], 10)) || ua(e[2].length == 0, f[2].length == 0) || ua(e[2], f[2]);
          e = e[3];
          f = f[3];
        } while (a == 0);
      }
      return 0 <= a;
    });
  }
  var Sa;
  if (l.document && y) {
    Ta = Ma();
    Sa = Ta ? Ta : parseInt(Na, 10) || void 0;
  } else
    Sa = void 0;
  var Ta;
  var Ua = Sa;
  var Va = function() {
    if (!l.addEventListener || !Object.defineProperty)
      return false;
    var a = false, b = Object.defineProperty({}, "passive", { get: function() {
      a = true;
    } });
    try {
      l.addEventListener("test", aa, b), l.removeEventListener("test", aa, b);
    } catch (c) {
    }
    return a;
  }();
  function z(a, b) {
    this.type = a;
    this.g = this.target = b;
    this.defaultPrevented = false;
  }
  z.prototype.h = function() {
    this.defaultPrevented = true;
  };
  function A(a, b) {
    z.call(this, a ? a.type : "");
    this.relatedTarget = this.g = this.target = null;
    this.button = this.screenY = this.screenX = this.clientY = this.clientX = 0;
    this.key = "";
    this.metaKey = this.shiftKey = this.altKey = this.ctrlKey = false;
    this.state = null;
    this.pointerId = 0;
    this.pointerType = "";
    this.i = null;
    if (a) {
      var c = this.type = a.type, d = a.changedTouches && a.changedTouches.length ? a.changedTouches[0] : null;
      this.target = a.target || a.srcElement;
      this.g = b;
      if (b = a.relatedTarget) {
        if (Ka) {
          a: {
            try {
              Ca(b.nodeName);
              var e = true;
              break a;
            } catch (f) {
            }
            e = false;
          }
          e || (b = null);
        }
      } else
        c == "mouseover" ? b = a.fromElement : c == "mouseout" && (b = a.toElement);
      this.relatedTarget = b;
      d ? (this.clientX = d.clientX !== void 0 ? d.clientX : d.pageX, this.clientY = d.clientY !== void 0 ? d.clientY : d.pageY, this.screenX = d.screenX || 0, this.screenY = d.screenY || 0) : (this.clientX = a.clientX !== void 0 ? a.clientX : a.pageX, this.clientY = a.clientY !== void 0 ? a.clientY : a.pageY, this.screenX = a.screenX || 0, this.screenY = a.screenY || 0);
      this.button = a.button;
      this.key = a.key || "";
      this.ctrlKey = a.ctrlKey;
      this.altKey = a.altKey;
      this.shiftKey = a.shiftKey;
      this.metaKey = a.metaKey;
      this.pointerId = a.pointerId || 0;
      this.pointerType = typeof a.pointerType === "string" ? a.pointerType : Wa[a.pointerType] || "";
      this.state = a.state;
      this.i = a;
      a.defaultPrevented && A.Z.h.call(this);
    }
  }
  t(A, z);
  var Wa = { 2: "touch", 3: "pen", 4: "mouse" };
  A.prototype.h = function() {
    A.Z.h.call(this);
    var a = this.i;
    a.preventDefault ? a.preventDefault() : a.returnValue = false;
  };
  var B = "closure_listenable_" + (1e6 * Math.random() | 0);
  var Xa = 0;
  function Ya(a, b, c, d, e) {
    this.listener = a;
    this.proxy = null;
    this.src = b;
    this.type = c;
    this.capture = !!d;
    this.ia = e;
    this.key = ++Xa;
    this.ca = this.fa = false;
  }
  function Za(a) {
    a.ca = true;
    a.listener = null;
    a.proxy = null;
    a.src = null;
    a.ia = null;
  }
  function $a(a) {
    this.src = a;
    this.g = {};
    this.h = 0;
  }
  $a.prototype.add = function(a, b, c, d, e) {
    var f = a.toString();
    a = this.g[f];
    a || (a = this.g[f] = [], this.h++);
    var h = ab(a, b, d, e);
    -1 < h ? (b = a[h], c || (b.fa = false)) : (b = new Ya(b, this.src, f, !!d, e), b.fa = c, a.push(b));
    return b;
  };
  function bb(a, b) {
    var c = b.type;
    if (c in a.g) {
      var d = a.g[c], e = ma(d, b), f;
      (f = 0 <= e) && Array.prototype.splice.call(d, e, 1);
      f && (Za(b), a.g[c].length == 0 && (delete a.g[c], a.h--));
    }
  }
  function ab(a, b, c, d) {
    for (var e = 0; e < a.length; ++e) {
      var f = a[e];
      if (!f.ca && f.listener == b && f.capture == !!c && f.ia == d)
        return e;
    }
    return -1;
  }
  var cb = "closure_lm_" + (1e6 * Math.random() | 0);
  var db = {};
  function fb(a, b, c, d, e) {
    if (d && d.once)
      return gb(a, b, c, d, e);
    if (Array.isArray(b)) {
      for (var f = 0; f < b.length; f++)
        fb(a, b[f], c, d, e);
      return null;
    }
    c = hb(c);
    return a && a[B] ? a.N(b, c, p(d) ? !!d.capture : !!d, e) : ib(a, b, c, false, d, e);
  }
  function ib(a, b, c, d, e, f) {
    if (!b)
      throw Error("Invalid event type");
    var h = p(e) ? !!e.capture : !!e, n = jb(a);
    n || (a[cb] = n = new $a(a));
    c = n.add(b, c, d, h, f);
    if (c.proxy)
      return c;
    d = kb();
    c.proxy = d;
    d.src = a;
    d.listener = c;
    if (a.addEventListener)
      Va || (e = h), e === void 0 && (e = false), a.addEventListener(b.toString(), d, e);
    else if (a.attachEvent)
      a.attachEvent(lb(b.toString()), d);
    else if (a.addListener && a.removeListener)
      a.addListener(d);
    else
      throw Error("addEventListener and attachEvent are unavailable.");
    return c;
  }
  function kb() {
    function a(c) {
      return b.call(a.src, a.listener, c);
    }
    var b = mb;
    return a;
  }
  function gb(a, b, c, d, e) {
    if (Array.isArray(b)) {
      for (var f = 0; f < b.length; f++)
        gb(a, b[f], c, d, e);
      return null;
    }
    c = hb(c);
    return a && a[B] ? a.O(b, c, p(d) ? !!d.capture : !!d, e) : ib(a, b, c, true, d, e);
  }
  function nb(a, b, c, d, e) {
    if (Array.isArray(b))
      for (var f = 0; f < b.length; f++)
        nb(a, b[f], c, d, e);
    else
      (d = p(d) ? !!d.capture : !!d, c = hb(c), a && a[B]) ? (a = a.i, b = String(b).toString(), b in a.g && (f = a.g[b], c = ab(f, c, d, e), -1 < c && (Za(f[c]), Array.prototype.splice.call(f, c, 1), f.length == 0 && (delete a.g[b], a.h--)))) : a && (a = jb(a)) && (b = a.g[b.toString()], a = -1, b && (a = ab(b, c, d, e)), (c = -1 < a ? b[a] : null) && ob(c));
  }
  function ob(a) {
    if (typeof a !== "number" && a && !a.ca) {
      var b = a.src;
      if (b && b[B])
        bb(b.i, a);
      else {
        var c = a.type, d = a.proxy;
        b.removeEventListener ? b.removeEventListener(c, d, a.capture) : b.detachEvent ? b.detachEvent(lb(c), d) : b.addListener && b.removeListener && b.removeListener(d);
        (c = jb(b)) ? (bb(c, a), c.h == 0 && (c.src = null, b[cb] = null)) : Za(a);
      }
    }
  }
  function lb(a) {
    return a in db ? db[a] : db[a] = "on" + a;
  }
  function mb(a, b) {
    if (a.ca)
      a = true;
    else {
      b = new A(b, this);
      var c = a.listener, d = a.ia || a.src;
      a.fa && ob(a);
      a = c.call(d, b);
    }
    return a;
  }
  function jb(a) {
    a = a[cb];
    return a instanceof $a ? a : null;
  }
  var pb = "__closure_events_fn_" + (1e9 * Math.random() >>> 0);
  function hb(a) {
    if (typeof a === "function")
      return a;
    a[pb] || (a[pb] = function(b) {
      return a.handleEvent(b);
    });
    return a[pb];
  }
  function C() {
    v.call(this);
    this.i = new $a(this);
    this.P = this;
    this.I = null;
  }
  t(C, v);
  C.prototype[B] = true;
  C.prototype.removeEventListener = function(a, b, c, d) {
    nb(this, a, b, c, d);
  };
  function D(a, b) {
    var c, d = a.I;
    if (d)
      for (c = []; d; d = d.I)
        c.push(d);
    a = a.P;
    d = b.type || b;
    if (typeof b === "string")
      b = new z(b, a);
    else if (b instanceof z)
      b.target = b.target || a;
    else {
      var e = b;
      b = new z(d, a);
      Aa(b, e);
    }
    e = true;
    if (c)
      for (var f = c.length - 1; 0 <= f; f--) {
        var h = b.g = c[f];
        e = qb(h, d, true, b) && e;
      }
    h = b.g = a;
    e = qb(h, d, true, b) && e;
    e = qb(h, d, false, b) && e;
    if (c)
      for (f = 0; f < c.length; f++)
        h = b.g = c[f], e = qb(h, d, false, b) && e;
  }
  C.prototype.M = function() {
    C.Z.M.call(this);
    if (this.i) {
      var a = this.i, c;
      for (c in a.g) {
        for (var d = a.g[c], e = 0; e < d.length; e++)
          Za(d[e]);
        delete a.g[c];
        a.h--;
      }
    }
    this.I = null;
  };
  C.prototype.N = function(a, b, c, d) {
    return this.i.add(String(a), b, false, c, d);
  };
  C.prototype.O = function(a, b, c, d) {
    return this.i.add(String(a), b, true, c, d);
  };
  function qb(a, b, c, d) {
    b = a.i.g[String(b)];
    if (!b)
      return true;
    b = b.concat();
    for (var e = true, f = 0; f < b.length; ++f) {
      var h = b[f];
      if (h && !h.ca && h.capture == c) {
        var n = h.listener, u = h.ia || h.src;
        h.fa && bb(a.i, h);
        e = n.call(u, d) !== false && e;
      }
    }
    return e && !d.defaultPrevented;
  }
  var rb = l.JSON.stringify;
  function sb() {
    var a = tb;
    let b = null;
    a.g && (b = a.g, a.g = a.g.next, a.g || (a.h = null), b.next = null);
    return b;
  }
  var ub = class {
    constructor() {
      this.h = this.g = null;
    }
    add(a, b) {
      const c = vb.get();
      c.set(a, b);
      this.h ? this.h.next = c : this.g = c;
      this.h = c;
    }
  };
  var vb = new class {
    constructor(a, b) {
      this.i = a;
      this.j = b;
      this.h = 0;
      this.g = null;
    }
    get() {
      let a;
      0 < this.h ? (this.h--, a = this.g, this.g = a.next, a.next = null) : a = this.i();
      return a;
    }
  }(() => new wb(), (a) => a.reset());
  var wb = class {
    constructor() {
      this.next = this.g = this.h = null;
    }
    set(a, b) {
      this.h = a;
      this.g = b;
      this.next = null;
    }
    reset() {
      this.next = this.g = this.h = null;
    }
  };
  function yb(a) {
    l.setTimeout(() => {
      throw a;
    }, 0);
  }
  function zb(a, b) {
    Ab || Bb();
    Cb || (Ab(), Cb = true);
    tb.add(a, b);
  }
  var Ab;
  function Bb() {
    var a = l.Promise.resolve(void 0);
    Ab = function() {
      a.then(Db);
    };
  }
  var Cb = false;
  var tb = new ub();
  function Db() {
    for (var a; a = sb(); ) {
      try {
        a.h.call(a.g);
      } catch (c) {
        yb(c);
      }
      var b = vb;
      b.j(a);
      100 > b.h && (b.h++, a.next = b.g, b.g = a);
    }
    Cb = false;
  }
  function Eb(a, b) {
    C.call(this);
    this.h = a || 1;
    this.g = b || l;
    this.j = q(this.kb, this);
    this.l = Date.now();
  }
  t(Eb, C);
  k = Eb.prototype;
  k.da = false;
  k.S = null;
  k.kb = function() {
    if (this.da) {
      var a = Date.now() - this.l;
      0 < a && a < 0.8 * this.h ? this.S = this.g.setTimeout(this.j, this.h - a) : (this.S && (this.g.clearTimeout(this.S), this.S = null), D(this, "tick"), this.da && (Fb(this), this.start()));
    }
  };
  k.start = function() {
    this.da = true;
    this.S || (this.S = this.g.setTimeout(this.j, this.h), this.l = Date.now());
  };
  function Fb(a) {
    a.da = false;
    a.S && (a.g.clearTimeout(a.S), a.S = null);
  }
  k.M = function() {
    Eb.Z.M.call(this);
    Fb(this);
    delete this.g;
  };
  function Gb(a, b, c) {
    if (typeof a === "function")
      c && (a = q(a, c));
    else if (a && typeof a.handleEvent == "function")
      a = q(a.handleEvent, a);
    else
      throw Error("Invalid listener argument");
    return 2147483647 < Number(b) ? -1 : l.setTimeout(a, b || 0);
  }
  function Hb(a) {
    a.g = Gb(() => {
      a.g = null;
      a.i && (a.i = false, Hb(a));
    }, a.j);
    const b = a.h;
    a.h = null;
    a.m.apply(null, b);
  }
  var Ib = class extends v {
    constructor(a, b) {
      super();
      this.m = a;
      this.j = b;
      this.h = null;
      this.i = false;
      this.g = null;
    }
    l(a) {
      this.h = arguments;
      this.g ? this.i = true : Hb(this);
    }
    M() {
      super.M();
      this.g && (l.clearTimeout(this.g), this.g = null, this.i = false, this.h = null);
    }
  };
  function E(a) {
    v.call(this);
    this.h = a;
    this.g = {};
  }
  t(E, v);
  var Jb = [];
  function Kb(a, b, c, d) {
    Array.isArray(c) || (c && (Jb[0] = c.toString()), c = Jb);
    for (var e = 0; e < c.length; e++) {
      var f = fb(b, c[e], d || a.handleEvent, false, a.h || a);
      if (!f)
        break;
      a.g[f.key] = f;
    }
  }
  function Lb(a) {
    xa(a.g, function(b, c) {
      this.g.hasOwnProperty(c) && ob(b);
    }, a);
    a.g = {};
  }
  E.prototype.M = function() {
    E.Z.M.call(this);
    Lb(this);
  };
  E.prototype.handleEvent = function() {
    throw Error("EventHandler.handleEvent not implemented");
  };
  function Mb() {
    this.g = true;
  }
  Mb.prototype.Aa = function() {
    this.g = false;
  };
  function Nb(a, b, c, d, e, f) {
    a.info(function() {
      if (a.g)
        if (f) {
          var h = "";
          for (var n = f.split("&"), u = 0; u < n.length; u++) {
            var m = n[u].split("=");
            if (1 < m.length) {
              var r = m[0];
              m = m[1];
              var G2 = r.split("_");
              h = 2 <= G2.length && G2[1] == "type" ? h + (r + "=" + m + "&") : h + (r + "=redacted&");
            }
          }
        } else
          h = null;
      else
        h = f;
      return "XMLHTTP REQ (" + d + ") [attempt " + e + "]: " + b + "\n" + c + "\n" + h;
    });
  }
  function Ob(a, b, c, d, e, f, h) {
    a.info(function() {
      return "XMLHTTP RESP (" + d + ") [ attempt " + e + "]: " + b + "\n" + c + "\n" + f + " " + h;
    });
  }
  function F(a, b, c, d) {
    a.info(function() {
      return "XMLHTTP TEXT (" + b + "): " + Pb(a, c) + (d ? " " + d : "");
    });
  }
  function Qb(a, b) {
    a.info(function() {
      return "TIMEOUT: " + b;
    });
  }
  Mb.prototype.info = function() {
  };
  function Pb(a, b) {
    if (!a.g)
      return b;
    if (!b)
      return null;
    try {
      var c = JSON.parse(b);
      if (c) {
        for (a = 0; a < c.length; a++)
          if (Array.isArray(c[a])) {
            var d = c[a];
            if (!(2 > d.length)) {
              var e = d[1];
              if (Array.isArray(e) && !(1 > e.length)) {
                var f = e[0];
                if (f != "noop" && f != "stop" && f != "close")
                  for (var h = 1; h < e.length; h++)
                    e[h] = "";
              }
            }
          }
      }
      return rb(c);
    } catch (n) {
      return b;
    }
  }
  var H = {};
  var Rb = null;
  function Sb() {
    return Rb = Rb || new C();
  }
  H.Ma = "serverreachability";
  function Tb(a) {
    z.call(this, H.Ma, a);
  }
  t(Tb, z);
  function I(a) {
    const b = Sb();
    D(b, new Tb(b, a));
  }
  H.STAT_EVENT = "statevent";
  function Ub(a, b) {
    z.call(this, H.STAT_EVENT, a);
    this.stat = b;
  }
  t(Ub, z);
  function J(a) {
    const b = Sb();
    D(b, new Ub(b, a));
  }
  H.Na = "timingevent";
  function Vb(a, b) {
    z.call(this, H.Na, a);
    this.size = b;
  }
  t(Vb, z);
  function K(a, b) {
    if (typeof a !== "function")
      throw Error("Fn must not be null and must be a function");
    return l.setTimeout(function() {
      a();
    }, b);
  }
  var Wb = { NO_ERROR: 0, lb: 1, yb: 2, xb: 3, sb: 4, wb: 5, zb: 6, Ja: 7, TIMEOUT: 8, Cb: 9 };
  var Xb = { qb: "complete", Mb: "success", Ka: "error", Ja: "abort", Eb: "ready", Fb: "readystatechange", TIMEOUT: "timeout", Ab: "incrementaldata", Db: "progress", tb: "downloadprogress", Ub: "uploadprogress" };
  function Yb() {
  }
  Yb.prototype.h = null;
  function Zb(a) {
    return a.h || (a.h = a.i());
  }
  function $b() {
  }
  var L = { OPEN: "a", pb: "b", Ka: "c", Bb: "d" };
  function ac() {
    z.call(this, "d");
  }
  t(ac, z);
  function bc() {
    z.call(this, "c");
  }
  t(bc, z);
  var cc;
  function dc() {
  }
  t(dc, Yb);
  dc.prototype.g = function() {
    return new XMLHttpRequest();
  };
  dc.prototype.i = function() {
    return {};
  };
  cc = new dc();
  function M(a, b, c, d) {
    this.l = a;
    this.j = b;
    this.m = c;
    this.X = d || 1;
    this.V = new E(this);
    this.P = ec;
    a = Ja ? 125 : void 0;
    this.W = new Eb(a);
    this.H = null;
    this.i = false;
    this.s = this.A = this.v = this.K = this.F = this.Y = this.B = null;
    this.D = [];
    this.g = null;
    this.C = 0;
    this.o = this.u = null;
    this.N = -1;
    this.I = false;
    this.O = 0;
    this.L = null;
    this.aa = this.J = this.$ = this.U = false;
    this.h = new fc();
  }
  function fc() {
    this.i = null;
    this.g = "";
    this.h = false;
  }
  var ec = 45e3;
  var gc = {};
  var hc = {};
  k = M.prototype;
  k.setTimeout = function(a) {
    this.P = a;
  };
  function ic(a, b, c) {
    a.K = 1;
    a.v = jc(N(b));
    a.s = c;
    a.U = true;
    kc(a, null);
  }
  function kc(a, b) {
    a.F = Date.now();
    lc(a);
    a.A = N(a.v);
    var c = a.A, d = a.X;
    Array.isArray(d) || (d = [String(d)]);
    mc(c.h, "t", d);
    a.C = 0;
    c = a.l.H;
    a.h = new fc();
    a.g = nc(a.l, c ? b : null, !a.s);
    0 < a.O && (a.L = new Ib(q(a.Ia, a, a.g), a.O));
    Kb(a.V, a.g, "readystatechange", a.gb);
    b = a.H ? ya(a.H) : {};
    a.s ? (a.u || (a.u = "POST"), b["Content-Type"] = "application/x-www-form-urlencoded", a.g.ea(a.A, a.u, a.s, b)) : (a.u = "GET", a.g.ea(a.A, a.u, null, b));
    I(1);
    Nb(a.j, a.u, a.A, a.m, a.X, a.s);
  }
  k.gb = function(a) {
    a = a.target;
    const b = this.L;
    b && O(a) == 3 ? b.l() : this.Ia(a);
  };
  k.Ia = function(a) {
    try {
      if (a == this.g)
        a: {
          const r = O(this.g);
          var b = this.g.Da();
          const G2 = this.g.ba();
          if (!(3 > r) && (r != 3 || Ja || this.g && (this.h.h || this.g.ga() || oc(this.g)))) {
            this.I || r != 4 || b == 7 || (b == 8 || 0 >= G2 ? I(3) : I(2));
            pc(this);
            var c = this.g.ba();
            this.N = c;
            b:
              if (qc(this)) {
                var d = oc(this.g);
                a = "";
                var e = d.length, f = O(this.g) == 4;
                if (!this.h.i) {
                  if (typeof TextDecoder === "undefined") {
                    P(this);
                    rc(this);
                    var h = "";
                    break b;
                  }
                  this.h.i = new l.TextDecoder();
                }
                for (b = 0; b < e; b++)
                  this.h.h = true, a += this.h.i.decode(d[b], { stream: f && b == e - 1 });
                d.splice(0, e);
                this.h.g += a;
                this.C = 0;
                h = this.h.g;
              } else
                h = this.g.ga();
            this.i = c == 200;
            Ob(this.j, this.u, this.A, this.m, this.X, r, c);
            if (this.i) {
              if (this.$ && !this.J) {
                b: {
                  if (this.g) {
                    var n, u = this.g;
                    if ((n = u.g ? u.g.getResponseHeader("X-HTTP-Initial-Response") : null) && !sa(n)) {
                      var m = n;
                      break b;
                    }
                  }
                  m = null;
                }
                if (c = m)
                  F(this.j, this.m, c, "Initial handshake response via X-HTTP-Initial-Response"), this.J = true, sc(this, c);
                else {
                  this.i = false;
                  this.o = 3;
                  J(12);
                  P(this);
                  rc(this);
                  break a;
                }
              }
              this.U ? (tc(this, r, h), Ja && this.i && r == 3 && (Kb(this.V, this.W, "tick", this.fb), this.W.start())) : (F(this.j, this.m, h, null), sc(this, h));
              r == 4 && P(this);
              this.i && !this.I && (r == 4 ? uc(this.l, this) : (this.i = false, lc(this)));
            } else
              c == 400 && 0 < h.indexOf("Unknown SID") ? (this.o = 3, J(12)) : (this.o = 0, J(13)), P(this), rc(this);
          }
        }
    } catch (r) {
    } finally {
    }
  };
  function qc(a) {
    return a.g ? a.u == "GET" && a.K != 2 && a.l.Ba : false;
  }
  function tc(a, b, c) {
    let d = true, e;
    for (; !a.I && a.C < c.length; )
      if (e = vc(a, c), e == hc) {
        b == 4 && (a.o = 4, J(14), d = false);
        F(a.j, a.m, null, "[Incomplete Response]");
        break;
      } else if (e == gc) {
        a.o = 4;
        J(15);
        F(a.j, a.m, c, "[Invalid Chunk]");
        d = false;
        break;
      } else
        F(a.j, a.m, e, null), sc(a, e);
    qc(a) && e != hc && e != gc && (a.h.g = "", a.C = 0);
    b != 4 || c.length != 0 || a.h.h || (a.o = 1, J(16), d = false);
    a.i = a.i && d;
    d ? 0 < c.length && !a.aa && (a.aa = true, b = a.l, b.g == a && b.$ && !b.L && (b.h.info("Great, no buffering proxy detected. Bytes received: " + c.length), wc(b), b.L = true, J(11))) : (F(a.j, a.m, c, "[Invalid Chunked Response]"), P(a), rc(a));
  }
  k.fb = function() {
    if (this.g) {
      var a = O(this.g), b = this.g.ga();
      this.C < b.length && (pc(this), tc(this, a, b), this.i && a != 4 && lc(this));
    }
  };
  function vc(a, b) {
    var c = a.C, d = b.indexOf("\n", c);
    if (d == -1)
      return hc;
    c = Number(b.substring(c, d));
    if (isNaN(c))
      return gc;
    d += 1;
    if (d + c > b.length)
      return hc;
    b = b.substr(d, c);
    a.C = d + c;
    return b;
  }
  k.cancel = function() {
    this.I = true;
    P(this);
  };
  function lc(a) {
    a.Y = Date.now() + a.P;
    xc(a, a.P);
  }
  function xc(a, b) {
    if (a.B != null)
      throw Error("WatchDog timer not null");
    a.B = K(q(a.eb, a), b);
  }
  function pc(a) {
    a.B && (l.clearTimeout(a.B), a.B = null);
  }
  k.eb = function() {
    this.B = null;
    const a = Date.now();
    0 <= a - this.Y ? (Qb(this.j, this.A), this.K != 2 && (I(3), J(17)), P(this), this.o = 2, rc(this)) : xc(this, this.Y - a);
  };
  function rc(a) {
    a.l.G == 0 || a.I || uc(a.l, a);
  }
  function P(a) {
    pc(a);
    var b = a.L;
    b && typeof b.na == "function" && b.na();
    a.L = null;
    Fb(a.W);
    Lb(a.V);
    a.g && (b = a.g, a.g = null, b.abort(), b.na());
  }
  function sc(a, b) {
    try {
      var c = a.l;
      if (c.G != 0 && (c.g == a || yc(c.i, a))) {
        if (c.I = a.N, !a.J && yc(c.i, a) && c.G == 3) {
          try {
            var d = c.Ca.g.parse(b);
          } catch (m) {
            d = null;
          }
          if (Array.isArray(d) && d.length == 3) {
            var e = d;
            if (e[0] == 0)
              a: {
                if (!c.u) {
                  if (c.g)
                    if (c.g.F + 3e3 < a.F)
                      zc(c), Ac(c);
                    else
                      break a;
                  Bc(c);
                  J(18);
                }
              }
            else
              c.ta = e[1], 0 < c.ta - c.U && 37500 > e[2] && c.N && c.A == 0 && !c.v && (c.v = K(q(c.ab, c), 6e3));
            if (1 >= Cc(c.i) && c.ka) {
              try {
                c.ka();
              } catch (m) {
              }
              c.ka = void 0;
            }
          } else
            Q(c, 11);
        } else if ((a.J || c.g == a) && zc(c), !sa(b))
          for (e = c.Ca.g.parse(b), b = 0; b < e.length; b++) {
            let m = e[b];
            c.U = m[0];
            m = m[1];
            if (c.G == 2)
              if (m[0] == "c") {
                c.J = m[1];
                c.la = m[2];
                const r = m[3];
                r != null && (c.ma = r, c.h.info("VER=" + c.ma));
                const G2 = m[4];
                G2 != null && (c.za = G2, c.h.info("SVER=" + c.za));
                const Da = m[5];
                Da != null && typeof Da === "number" && 0 < Da && (d = 1.5 * Da, c.K = d, c.h.info("backChannelRequestTimeoutMs_=" + d));
                d = c;
                const ca2 = a.g;
                if (ca2) {
                  const Ea = ca2.g ? ca2.g.getResponseHeader("X-Client-Wire-Protocol") : null;
                  if (Ea) {
                    var f = d.i;
                    !f.g && (w(Ea, "spdy") || w(Ea, "quic") || w(Ea, "h2")) && (f.j = f.l, f.g = /* @__PURE__ */ new Set(), f.h && (Dc(f, f.h), f.h = null));
                  }
                  if (d.D) {
                    const xb = ca2.g ? ca2.g.getResponseHeader("X-HTTP-Session-Id") : null;
                    xb && (d.sa = xb, R(d.F, d.D, xb));
                  }
                }
                c.G = 3;
                c.j && c.j.xa();
                c.$ && (c.O = Date.now() - a.F, c.h.info("Handshake RTT: " + c.O + "ms"));
                d = c;
                var h = a;
                d.oa = Ec(d, d.H ? d.la : null, d.W);
                if (h.J) {
                  Fc(d.i, h);
                  var n = h, u = d.K;
                  u && n.setTimeout(u);
                  n.B && (pc(n), lc(n));
                  d.g = h;
                } else
                  Gc(d);
                0 < c.l.length && Hc(c);
              } else
                m[0] != "stop" && m[0] != "close" || Q(c, 7);
            else
              c.G == 3 && (m[0] == "stop" || m[0] == "close" ? m[0] == "stop" ? Q(c, 7) : Ic(c) : m[0] != "noop" && c.j && c.j.wa(m), c.A = 0);
          }
      }
      I(4);
    } catch (m) {
    }
  }
  function Jc(a) {
    if (a.R && typeof a.R == "function")
      return a.R();
    if (typeof a === "string")
      return a.split("");
    if (ba(a)) {
      for (var b = [], c = a.length, d = 0; d < c; d++)
        b.push(a[d]);
      return b;
    }
    b = [];
    c = 0;
    for (d in a)
      b[c++] = a[d];
    return b;
  }
  function Kc(a, b) {
    if (a.forEach && typeof a.forEach == "function")
      a.forEach(b, void 0);
    else if (ba(a) || typeof a === "string")
      na(a, b, void 0);
    else {
      if (a.T && typeof a.T == "function")
        var c = a.T();
      else if (a.R && typeof a.R == "function")
        c = void 0;
      else if (ba(a) || typeof a === "string") {
        c = [];
        for (var d = a.length, e = 0; e < d; e++)
          c.push(e);
      } else
        for (e in c = [], d = 0, a)
          c[d++] = e;
      d = Jc(a);
      e = d.length;
      for (var f = 0; f < e; f++)
        b.call(void 0, d[f], c && c[f], a);
    }
  }
  function S(a, b) {
    this.h = {};
    this.g = [];
    this.i = 0;
    var c = arguments.length;
    if (1 < c) {
      if (c % 2)
        throw Error("Uneven number of arguments");
      for (var d = 0; d < c; d += 2)
        this.set(arguments[d], arguments[d + 1]);
    } else if (a)
      if (a instanceof S)
        for (c = a.T(), d = 0; d < c.length; d++)
          this.set(c[d], a.get(c[d]));
      else
        for (d in a)
          this.set(d, a[d]);
  }
  k = S.prototype;
  k.R = function() {
    Lc(this);
    for (var a = [], b = 0; b < this.g.length; b++)
      a.push(this.h[this.g[b]]);
    return a;
  };
  k.T = function() {
    Lc(this);
    return this.g.concat();
  };
  function Lc(a) {
    if (a.i != a.g.length) {
      for (var b = 0, c = 0; b < a.g.length; ) {
        var d = a.g[b];
        T(a.h, d) && (a.g[c++] = d);
        b++;
      }
      a.g.length = c;
    }
    if (a.i != a.g.length) {
      var e = {};
      for (c = b = 0; b < a.g.length; )
        d = a.g[b], T(e, d) || (a.g[c++] = d, e[d] = 1), b++;
      a.g.length = c;
    }
  }
  k.get = function(a, b) {
    return T(this.h, a) ? this.h[a] : b;
  };
  k.set = function(a, b) {
    T(this.h, a) || (this.i++, this.g.push(a));
    this.h[a] = b;
  };
  k.forEach = function(a, b) {
    for (var c = this.T(), d = 0; d < c.length; d++) {
      var e = c[d], f = this.get(e);
      a.call(b, f, e, this);
    }
  };
  function T(a, b) {
    return Object.prototype.hasOwnProperty.call(a, b);
  }
  var Mc = /^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;
  function Nc(a, b) {
    if (a) {
      a = a.split("&");
      for (var c = 0; c < a.length; c++) {
        var d = a[c].indexOf("="), e = null;
        if (0 <= d) {
          var f = a[c].substring(0, d);
          e = a[c].substring(d + 1);
        } else
          f = a[c];
        b(f, e ? decodeURIComponent(e.replace(/\+/g, " ")) : "");
      }
    }
  }
  function U(a, b) {
    this.i = this.s = this.j = "";
    this.m = null;
    this.o = this.l = "";
    this.g = false;
    if (a instanceof U) {
      this.g = b !== void 0 ? b : a.g;
      Oc(this, a.j);
      this.s = a.s;
      Pc(this, a.i);
      Qc(this, a.m);
      this.l = a.l;
      b = a.h;
      var c = new Rc();
      c.i = b.i;
      b.g && (c.g = new S(b.g), c.h = b.h);
      Sc(this, c);
      this.o = a.o;
    } else
      a && (c = String(a).match(Mc)) ? (this.g = !!b, Oc(this, c[1] || "", true), this.s = Tc(c[2] || ""), Pc(this, c[3] || "", true), Qc(this, c[4]), this.l = Tc(c[5] || "", true), Sc(this, c[6] || "", true), this.o = Tc(c[7] || "")) : (this.g = !!b, this.h = new Rc(null, this.g));
  }
  U.prototype.toString = function() {
    var a = [], b = this.j;
    b && a.push(Uc(b, Vc, true), ":");
    var c = this.i;
    if (c || b == "file")
      a.push("//"), (b = this.s) && a.push(Uc(b, Vc, true), "@"), a.push(encodeURIComponent(String(c)).replace(/%25([0-9a-fA-F]{2})/g, "%$1")), c = this.m, c != null && a.push(":", String(c));
    if (c = this.l)
      this.i && c.charAt(0) != "/" && a.push("/"), a.push(Uc(c, c.charAt(0) == "/" ? Wc : Xc, true));
    (c = this.h.toString()) && a.push("?", c);
    (c = this.o) && a.push("#", Uc(c, Yc));
    return a.join("");
  };
  function N(a) {
    return new U(a);
  }
  function Oc(a, b, c) {
    a.j = c ? Tc(b, true) : b;
    a.j && (a.j = a.j.replace(/:$/, ""));
  }
  function Pc(a, b, c) {
    a.i = c ? Tc(b, true) : b;
  }
  function Qc(a, b) {
    if (b) {
      b = Number(b);
      if (isNaN(b) || 0 > b)
        throw Error("Bad port number " + b);
      a.m = b;
    } else
      a.m = null;
  }
  function Sc(a, b, c) {
    b instanceof Rc ? (a.h = b, Zc(a.h, a.g)) : (c || (b = Uc(b, $c)), a.h = new Rc(b, a.g));
  }
  function R(a, b, c) {
    a.h.set(b, c);
  }
  function jc(a) {
    R(a, "zx", Math.floor(2147483648 * Math.random()).toString(36) + Math.abs(Math.floor(2147483648 * Math.random()) ^ Date.now()).toString(36));
    return a;
  }
  function ad(a) {
    return a instanceof U ? N(a) : new U(a, void 0);
  }
  function bd(a, b, c, d) {
    var e = new U(null, void 0);
    a && Oc(e, a);
    b && Pc(e, b);
    c && Qc(e, c);
    d && (e.l = d);
    return e;
  }
  function Tc(a, b) {
    return a ? b ? decodeURI(a.replace(/%25/g, "%2525")) : decodeURIComponent(a) : "";
  }
  function Uc(a, b, c) {
    return typeof a === "string" ? (a = encodeURI(a).replace(b, cd), c && (a = a.replace(/%25([0-9a-fA-F]{2})/g, "%$1")), a) : null;
  }
  function cd(a) {
    a = a.charCodeAt(0);
    return "%" + (a >> 4 & 15).toString(16) + (a & 15).toString(16);
  }
  var Vc = /[#\/\?@]/g;
  var Xc = /[#\?:]/g;
  var Wc = /[#\?]/g;
  var $c = /[#\?@]/g;
  var Yc = /#/g;
  function Rc(a, b) {
    this.h = this.g = null;
    this.i = a || null;
    this.j = !!b;
  }
  function V(a) {
    a.g || (a.g = new S(), a.h = 0, a.i && Nc(a.i, function(b, c) {
      a.add(decodeURIComponent(b.replace(/\+/g, " ")), c);
    }));
  }
  k = Rc.prototype;
  k.add = function(a, b) {
    V(this);
    this.i = null;
    a = W(this, a);
    var c = this.g.get(a);
    c || this.g.set(a, c = []);
    c.push(b);
    this.h += 1;
    return this;
  };
  function dd(a, b) {
    V(a);
    b = W(a, b);
    T(a.g.h, b) && (a.i = null, a.h -= a.g.get(b).length, a = a.g, T(a.h, b) && (delete a.h[b], a.i--, a.g.length > 2 * a.i && Lc(a)));
  }
  function ed(a, b) {
    V(a);
    b = W(a, b);
    return T(a.g.h, b);
  }
  k.forEach = function(a, b) {
    V(this);
    this.g.forEach(function(c, d) {
      na(c, function(e) {
        a.call(b, e, d, this);
      }, this);
    }, this);
  };
  k.T = function() {
    V(this);
    for (var a = this.g.R(), b = this.g.T(), c = [], d = 0; d < b.length; d++)
      for (var e = a[d], f = 0; f < e.length; f++)
        c.push(b[d]);
    return c;
  };
  k.R = function(a) {
    V(this);
    var b = [];
    if (typeof a === "string")
      ed(this, a) && (b = qa(b, this.g.get(W(this, a))));
    else {
      a = this.g.R();
      for (var c = 0; c < a.length; c++)
        b = qa(b, a[c]);
    }
    return b;
  };
  k.set = function(a, b) {
    V(this);
    this.i = null;
    a = W(this, a);
    ed(this, a) && (this.h -= this.g.get(a).length);
    this.g.set(a, [b]);
    this.h += 1;
    return this;
  };
  k.get = function(a, b) {
    if (!a)
      return b;
    a = this.R(a);
    return 0 < a.length ? String(a[0]) : b;
  };
  function mc(a, b, c) {
    dd(a, b);
    0 < c.length && (a.i = null, a.g.set(W(a, b), ra(c)), a.h += c.length);
  }
  k.toString = function() {
    if (this.i)
      return this.i;
    if (!this.g)
      return "";
    for (var a = [], b = this.g.T(), c = 0; c < b.length; c++) {
      var d = b[c], e = encodeURIComponent(String(d));
      d = this.R(d);
      for (var f = 0; f < d.length; f++) {
        var h = e;
        d[f] !== "" && (h += "=" + encodeURIComponent(String(d[f])));
        a.push(h);
      }
    }
    return this.i = a.join("&");
  };
  function W(a, b) {
    b = String(b);
    a.j && (b = b.toLowerCase());
    return b;
  }
  function Zc(a, b) {
    b && !a.j && (V(a), a.i = null, a.g.forEach(function(c, d) {
      var e = d.toLowerCase();
      d != e && (dd(this, d), mc(this, e, c));
    }, a));
    a.j = b;
  }
  var fd = class {
    constructor(a, b) {
      this.h = a;
      this.g = b;
    }
  };
  function gd(a) {
    this.l = a || hd;
    l.PerformanceNavigationTiming ? (a = l.performance.getEntriesByType("navigation"), a = 0 < a.length && (a[0].nextHopProtocol == "hq" || a[0].nextHopProtocol == "h2")) : a = !!(l.g && l.g.Ea && l.g.Ea() && l.g.Ea().Zb);
    this.j = a ? this.l : 1;
    this.g = null;
    1 < this.j && (this.g = /* @__PURE__ */ new Set());
    this.h = null;
    this.i = [];
  }
  var hd = 10;
  function id(a) {
    return a.h ? true : a.g ? a.g.size >= a.j : false;
  }
  function Cc(a) {
    return a.h ? 1 : a.g ? a.g.size : 0;
  }
  function yc(a, b) {
    return a.h ? a.h == b : a.g ? a.g.has(b) : false;
  }
  function Dc(a, b) {
    a.g ? a.g.add(b) : a.h = b;
  }
  function Fc(a, b) {
    a.h && a.h == b ? a.h = null : a.g && a.g.has(b) && a.g.delete(b);
  }
  gd.prototype.cancel = function() {
    this.i = jd(this);
    if (this.h)
      this.h.cancel(), this.h = null;
    else if (this.g && this.g.size !== 0) {
      for (const a of this.g.values())
        a.cancel();
      this.g.clear();
    }
  };
  function jd(a) {
    if (a.h != null)
      return a.i.concat(a.h.D);
    if (a.g != null && a.g.size !== 0) {
      let b = a.i;
      for (const c of a.g.values())
        b = b.concat(c.D);
      return b;
    }
    return ra(a.i);
  }
  function kd() {
  }
  kd.prototype.stringify = function(a) {
    return l.JSON.stringify(a, void 0);
  };
  kd.prototype.parse = function(a) {
    return l.JSON.parse(a, void 0);
  };
  function ld() {
    this.g = new kd();
  }
  function md(a, b, c) {
    const d = c || "";
    try {
      Kc(a, function(e, f) {
        let h = e;
        p(e) && (h = rb(e));
        b.push(d + f + "=" + encodeURIComponent(h));
      });
    } catch (e) {
      throw b.push(d + "type=" + encodeURIComponent("_badmap")), e;
    }
  }
  function nd(a, b) {
    const c = new Mb();
    if (l.Image) {
      const d = new Image();
      d.onload = ja(od, c, d, "TestLoadImage: loaded", true, b);
      d.onerror = ja(od, c, d, "TestLoadImage: error", false, b);
      d.onabort = ja(od, c, d, "TestLoadImage: abort", false, b);
      d.ontimeout = ja(od, c, d, "TestLoadImage: timeout", false, b);
      l.setTimeout(function() {
        if (d.ontimeout)
          d.ontimeout();
      }, 1e4);
      d.src = a;
    } else
      b(false);
  }
  function od(a, b, c, d, e) {
    try {
      b.onload = null, b.onerror = null, b.onabort = null, b.ontimeout = null, e(d);
    } catch (f) {
    }
  }
  function pd(a) {
    this.l = a.$b || null;
    this.j = a.ib || false;
  }
  t(pd, Yb);
  pd.prototype.g = function() {
    return new qd(this.l, this.j);
  };
  pd.prototype.i = function(a) {
    return function() {
      return a;
    };
  }({});
  function qd(a, b) {
    C.call(this);
    this.D = a;
    this.u = b;
    this.m = void 0;
    this.readyState = rd;
    this.status = 0;
    this.responseType = this.responseText = this.response = this.statusText = "";
    this.onreadystatechange = null;
    this.v = new Headers();
    this.h = null;
    this.C = "GET";
    this.B = "";
    this.g = false;
    this.A = this.j = this.l = null;
  }
  t(qd, C);
  var rd = 0;
  k = qd.prototype;
  k.open = function(a, b) {
    if (this.readyState != rd)
      throw this.abort(), Error("Error reopening a connection");
    this.C = a;
    this.B = b;
    this.readyState = 1;
    sd(this);
  };
  k.send = function(a) {
    if (this.readyState != 1)
      throw this.abort(), Error("need to call open() first. ");
    this.g = true;
    const b = { headers: this.v, method: this.C, credentials: this.m, cache: void 0 };
    a && (b.body = a);
    (this.D || l).fetch(new Request(this.B, b)).then(this.Va.bind(this), this.ha.bind(this));
  };
  k.abort = function() {
    this.response = this.responseText = "";
    this.v = new Headers();
    this.status = 0;
    this.j && this.j.cancel("Request was aborted.");
    1 <= this.readyState && this.g && this.readyState != 4 && (this.g = false, td(this));
    this.readyState = rd;
  };
  k.Va = function(a) {
    if (this.g && (this.l = a, this.h || (this.status = this.l.status, this.statusText = this.l.statusText, this.h = a.headers, this.readyState = 2, sd(this)), this.g && (this.readyState = 3, sd(this), this.g)))
      if (this.responseType === "arraybuffer")
        a.arrayBuffer().then(this.Ta.bind(this), this.ha.bind(this));
      else if (typeof l.ReadableStream !== "undefined" && "body" in a) {
        this.j = a.body.getReader();
        if (this.u) {
          if (this.responseType)
            throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');
          this.response = [];
        } else
          this.response = this.responseText = "", this.A = new TextDecoder();
        ud(this);
      } else
        a.text().then(this.Ua.bind(this), this.ha.bind(this));
  };
  function ud(a) {
    a.j.read().then(a.Sa.bind(a)).catch(a.ha.bind(a));
  }
  k.Sa = function(a) {
    if (this.g) {
      if (this.u && a.value)
        this.response.push(a.value);
      else if (!this.u) {
        var b = a.value ? a.value : new Uint8Array(0);
        if (b = this.A.decode(b, { stream: !a.done }))
          this.response = this.responseText += b;
      }
      a.done ? td(this) : sd(this);
      this.readyState == 3 && ud(this);
    }
  };
  k.Ua = function(a) {
    this.g && (this.response = this.responseText = a, td(this));
  };
  k.Ta = function(a) {
    this.g && (this.response = a, td(this));
  };
  k.ha = function() {
    this.g && td(this);
  };
  function td(a) {
    a.readyState = 4;
    a.l = null;
    a.j = null;
    a.A = null;
    sd(a);
  }
  k.setRequestHeader = function(a, b) {
    this.v.append(a, b);
  };
  k.getResponseHeader = function(a) {
    return this.h ? this.h.get(a.toLowerCase()) || "" : "";
  };
  k.getAllResponseHeaders = function() {
    if (!this.h)
      return "";
    const a = [], b = this.h.entries();
    for (var c = b.next(); !c.done; )
      c = c.value, a.push(c[0] + ": " + c[1]), c = b.next();
    return a.join("\r\n");
  };
  function sd(a) {
    a.onreadystatechange && a.onreadystatechange.call(a);
  }
  Object.defineProperty(qd.prototype, "withCredentials", { get: function() {
    return this.m === "include";
  }, set: function(a) {
    this.m = a ? "include" : "same-origin";
  } });
  var vd = l.JSON.parse;
  function X(a) {
    C.call(this);
    this.headers = new S();
    this.u = a || null;
    this.h = false;
    this.C = this.g = null;
    this.H = "";
    this.m = 0;
    this.j = "";
    this.l = this.F = this.v = this.D = false;
    this.B = 0;
    this.A = null;
    this.J = wd;
    this.K = this.L = false;
  }
  t(X, C);
  var wd = "";
  var xd = /^https?$/i;
  var yd = ["POST", "PUT"];
  k = X.prototype;
  k.ea = function(a, b, c, d) {
    if (this.g)
      throw Error("[goog.net.XhrIo] Object is active with another request=" + this.H + "; newUri=" + a);
    b = b ? b.toUpperCase() : "GET";
    this.H = a;
    this.j = "";
    this.m = 0;
    this.D = false;
    this.h = true;
    this.g = this.u ? this.u.g() : cc.g();
    this.C = this.u ? Zb(this.u) : Zb(cc);
    this.g.onreadystatechange = q(this.Fa, this);
    try {
      this.F = true, this.g.open(b, String(a), true), this.F = false;
    } catch (f) {
      zd(this, f);
      return;
    }
    a = c || "";
    const e = new S(this.headers);
    d && Kc(d, function(f, h) {
      e.set(h, f);
    });
    d = oa(e.T());
    c = l.FormData && a instanceof l.FormData;
    !(0 <= ma(yd, b)) || d || c || e.set("Content-Type", "application/x-www-form-urlencoded;charset=utf-8");
    e.forEach(function(f, h) {
      this.g.setRequestHeader(h, f);
    }, this);
    this.J && (this.g.responseType = this.J);
    "withCredentials" in this.g && this.g.withCredentials !== this.L && (this.g.withCredentials = this.L);
    try {
      Ad(this), 0 < this.B && ((this.K = Bd(this.g)) ? (this.g.timeout = this.B, this.g.ontimeout = q(this.pa, this)) : this.A = Gb(this.pa, this.B, this)), this.v = true, this.g.send(a), this.v = false;
    } catch (f) {
      zd(this, f);
    }
  };
  function Bd(a) {
    return y && Ra() && typeof a.timeout === "number" && a.ontimeout !== void 0;
  }
  function pa(a) {
    return a.toLowerCase() == "content-type";
  }
  k.pa = function() {
    typeof goog != "undefined" && this.g && (this.j = "Timed out after " + this.B + "ms, aborting", this.m = 8, D(this, "timeout"), this.abort(8));
  };
  function zd(a, b) {
    a.h = false;
    a.g && (a.l = true, a.g.abort(), a.l = false);
    a.j = b;
    a.m = 5;
    Cd(a);
    Dd(a);
  }
  function Cd(a) {
    a.D || (a.D = true, D(a, "complete"), D(a, "error"));
  }
  k.abort = function(a) {
    this.g && this.h && (this.h = false, this.l = true, this.g.abort(), this.l = false, this.m = a || 7, D(this, "complete"), D(this, "abort"), Dd(this));
  };
  k.M = function() {
    this.g && (this.h && (this.h = false, this.l = true, this.g.abort(), this.l = false), Dd(this, true));
    X.Z.M.call(this);
  };
  k.Fa = function() {
    this.s || (this.F || this.v || this.l ? Ed(this) : this.cb());
  };
  k.cb = function() {
    Ed(this);
  };
  function Ed(a) {
    if (a.h && typeof goog != "undefined" && (!a.C[1] || O(a) != 4 || a.ba() != 2)) {
      if (a.v && O(a) == 4)
        Gb(a.Fa, 0, a);
      else if (D(a, "readystatechange"), O(a) == 4) {
        a.h = false;
        try {
          const n = a.ba();
          a:
            switch (n) {
              case 200:
              case 201:
              case 202:
              case 204:
              case 206:
              case 304:
              case 1223:
                var b = true;
                break a;
              default:
                b = false;
            }
          var c;
          if (!(c = b)) {
            var d;
            if (d = n === 0) {
              var e = String(a.H).match(Mc)[1] || null;
              if (!e && l.self && l.self.location) {
                var f = l.self.location.protocol;
                e = f.substr(0, f.length - 1);
              }
              d = !xd.test(e ? e.toLowerCase() : "");
            }
            c = d;
          }
          if (c)
            D(a, "complete"), D(a, "success");
          else {
            a.m = 6;
            try {
              var h = 2 < O(a) ? a.g.statusText : "";
            } catch (u) {
              h = "";
            }
            a.j = h + " [" + a.ba() + "]";
            Cd(a);
          }
        } finally {
          Dd(a);
        }
      }
    }
  }
  function Dd(a, b) {
    if (a.g) {
      Ad(a);
      const c = a.g, d = a.C[0] ? aa : null;
      a.g = null;
      a.C = null;
      b || D(a, "ready");
      try {
        c.onreadystatechange = d;
      } catch (e) {
      }
    }
  }
  function Ad(a) {
    a.g && a.K && (a.g.ontimeout = null);
    a.A && (l.clearTimeout(a.A), a.A = null);
  }
  function O(a) {
    return a.g ? a.g.readyState : 0;
  }
  k.ba = function() {
    try {
      return 2 < O(this) ? this.g.status : -1;
    } catch (a) {
      return -1;
    }
  };
  k.ga = function() {
    try {
      return this.g ? this.g.responseText : "";
    } catch (a) {
      return "";
    }
  };
  k.Qa = function(a) {
    if (this.g) {
      var b = this.g.responseText;
      a && b.indexOf(a) == 0 && (b = b.substring(a.length));
      return vd(b);
    }
  };
  function oc(a) {
    try {
      if (!a.g)
        return null;
      if ("response" in a.g)
        return a.g.response;
      switch (a.J) {
        case wd:
        case "text":
          return a.g.responseText;
        case "arraybuffer":
          if ("mozResponseArrayBuffer" in a.g)
            return a.g.mozResponseArrayBuffer;
      }
      return null;
    } catch (b) {
      return null;
    }
  }
  k.Da = function() {
    return this.m;
  };
  k.La = function() {
    return typeof this.j === "string" ? this.j : String(this.j);
  };
  function Fd(a) {
    let b = "";
    xa(a, function(c, d) {
      b += d;
      b += ":";
      b += c;
      b += "\r\n";
    });
    return b;
  }
  function Gd(a, b, c) {
    a: {
      for (d in c) {
        var d = false;
        break a;
      }
      d = true;
    }
    d || (c = Fd(c), typeof a === "string" ? c != null && encodeURIComponent(String(c)) : R(a, b, c));
  }
  function Hd(a, b, c) {
    return c && c.internalChannelParams ? c.internalChannelParams[a] || b : b;
  }
  function Id(a) {
    this.za = 0;
    this.l = [];
    this.h = new Mb();
    this.la = this.oa = this.F = this.W = this.g = this.sa = this.D = this.aa = this.o = this.P = this.s = null;
    this.Za = this.V = 0;
    this.Xa = Hd("failFast", false, a);
    this.N = this.v = this.u = this.m = this.j = null;
    this.X = true;
    this.I = this.ta = this.U = -1;
    this.Y = this.A = this.C = 0;
    this.Pa = Hd("baseRetryDelayMs", 5e3, a);
    this.$a = Hd("retryDelaySeedMs", 1e4, a);
    this.Ya = Hd("forwardChannelMaxRetries", 2, a);
    this.ra = Hd("forwardChannelRequestTimeoutMs", 2e4, a);
    this.qa = a && a.xmlHttpFactory || void 0;
    this.Ba = a && a.Yb || false;
    this.K = void 0;
    this.H = a && a.supportsCrossDomainXhr || false;
    this.J = "";
    this.i = new gd(a && a.concurrentRequestLimit);
    this.Ca = new ld();
    this.ja = a && a.fastHandshake || false;
    this.Ra = a && a.Wb || false;
    a && a.Aa && this.h.Aa();
    a && a.forceLongPolling && (this.X = false);
    this.$ = !this.ja && this.X && a && a.detectBufferingProxy || false;
    this.ka = void 0;
    this.O = 0;
    this.L = false;
    this.B = null;
    this.Wa = !a || a.Xb !== false;
  }
  k = Id.prototype;
  k.ma = 8;
  k.G = 1;
  function Ic(a) {
    Jd(a);
    if (a.G == 3) {
      var b = a.V++, c = N(a.F);
      R(c, "SID", a.J);
      R(c, "RID", b);
      R(c, "TYPE", "terminate");
      Kd(a, c);
      b = new M(a, a.h, b, void 0);
      b.K = 2;
      b.v = jc(N(c));
      c = false;
      l.navigator && l.navigator.sendBeacon && (c = l.navigator.sendBeacon(b.v.toString(), ""));
      !c && l.Image && (new Image().src = b.v, c = true);
      c || (b.g = nc(b.l, null), b.g.ea(b.v));
      b.F = Date.now();
      lc(b);
    }
    Ld(a);
  }
  k.hb = function(a) {
    try {
      this.h.info("Origin Trials invoked: " + a);
    } catch (b) {
    }
  };
  function Ac(a) {
    a.g && (wc(a), a.g.cancel(), a.g = null);
  }
  function Jd(a) {
    Ac(a);
    a.u && (l.clearTimeout(a.u), a.u = null);
    zc(a);
    a.i.cancel();
    a.m && (typeof a.m === "number" && l.clearTimeout(a.m), a.m = null);
  }
  function Md(a, b) {
    a.l.push(new fd(a.Za++, b));
    a.G == 3 && Hc(a);
  }
  function Hc(a) {
    id(a.i) || a.m || (a.m = true, zb(a.Ha, a), a.C = 0);
  }
  function Nd(a, b) {
    if (Cc(a.i) >= a.i.j - (a.m ? 1 : 0))
      return false;
    if (a.m)
      return a.l = b.D.concat(a.l), true;
    if (a.G == 1 || a.G == 2 || a.C >= (a.Xa ? 0 : a.Ya))
      return false;
    a.m = K(q(a.Ha, a, b), Od(a, a.C));
    a.C++;
    return true;
  }
  k.Ha = function(a) {
    if (this.m)
      if (this.m = null, this.G == 1) {
        if (!a) {
          this.V = Math.floor(1e5 * Math.random());
          a = this.V++;
          const e = new M(this, this.h, a, void 0);
          let f = this.s;
          this.P && (f ? (f = ya(f), Aa(f, this.P)) : f = this.P);
          this.o === null && (e.H = f);
          if (this.ja)
            a: {
              var b = 0;
              for (var c = 0; c < this.l.length; c++) {
                b: {
                  var d = this.l[c];
                  if ("__data__" in d.g && (d = d.g.__data__, typeof d === "string")) {
                    d = d.length;
                    break b;
                  }
                  d = void 0;
                }
                if (d === void 0)
                  break;
                b += d;
                if (4096 < b) {
                  b = c;
                  break a;
                }
                if (b === 4096 || c === this.l.length - 1) {
                  b = c + 1;
                  break a;
                }
              }
              b = 1e3;
            }
          else
            b = 1e3;
          b = Pd(this, e, b);
          c = N(this.F);
          R(c, "RID", a);
          R(c, "CVER", 22);
          this.D && R(c, "X-HTTP-Session-Id", this.D);
          Kd(this, c);
          this.o && f && Gd(c, this.o, f);
          Dc(this.i, e);
          this.Ra && R(c, "TYPE", "init");
          this.ja ? (R(c, "$req", b), R(c, "SID", "null"), e.$ = true, ic(e, c, null)) : ic(e, c, b);
          this.G = 2;
        }
      } else
        this.G == 3 && (a ? Qd(this, a) : this.l.length == 0 || id(this.i) || Qd(this));
  };
  function Qd(a, b) {
    var c;
    b ? c = b.m : c = a.V++;
    const d = N(a.F);
    R(d, "SID", a.J);
    R(d, "RID", c);
    R(d, "AID", a.U);
    Kd(a, d);
    a.o && a.s && Gd(d, a.o, a.s);
    c = new M(a, a.h, c, a.C + 1);
    a.o === null && (c.H = a.s);
    b && (a.l = b.D.concat(a.l));
    b = Pd(a, c, 1e3);
    c.setTimeout(Math.round(0.5 * a.ra) + Math.round(0.5 * a.ra * Math.random()));
    Dc(a.i, c);
    ic(c, d, b);
  }
  function Kd(a, b) {
    a.j && Kc({}, function(c, d) {
      R(b, d, c);
    });
  }
  function Pd(a, b, c) {
    c = Math.min(a.l.length, c);
    var d = a.j ? q(a.j.Oa, a.j, a) : null;
    a: {
      var e = a.l;
      let f = -1;
      for (; ; ) {
        const h = ["count=" + c];
        f == -1 ? 0 < c ? (f = e[0].h, h.push("ofs=" + f)) : f = 0 : h.push("ofs=" + f);
        let n = true;
        for (let u = 0; u < c; u++) {
          let m = e[u].h;
          const r = e[u].g;
          m -= f;
          if (0 > m)
            f = Math.max(0, e[u].h - 100), n = false;
          else
            try {
              md(r, h, "req" + m + "_");
            } catch (G2) {
              d && d(r);
            }
        }
        if (n) {
          d = h.join("&");
          break a;
        }
      }
    }
    a = a.l.splice(0, c);
    b.D = a;
    return d;
  }
  function Gc(a) {
    a.g || a.u || (a.Y = 1, zb(a.Ga, a), a.A = 0);
  }
  function Bc(a) {
    if (a.g || a.u || 3 <= a.A)
      return false;
    a.Y++;
    a.u = K(q(a.Ga, a), Od(a, a.A));
    a.A++;
    return true;
  }
  k.Ga = function() {
    this.u = null;
    Rd(this);
    if (this.$ && !(this.L || this.g == null || 0 >= this.O)) {
      var a = 2 * this.O;
      this.h.info("BP detection timer enabled: " + a);
      this.B = K(q(this.bb, this), a);
    }
  };
  k.bb = function() {
    this.B && (this.B = null, this.h.info("BP detection timeout reached."), this.h.info("Buffering proxy detected and switch to long-polling!"), this.N = false, this.L = true, J(10), Ac(this), Rd(this));
  };
  function wc(a) {
    a.B != null && (l.clearTimeout(a.B), a.B = null);
  }
  function Rd(a) {
    a.g = new M(a, a.h, "rpc", a.Y);
    a.o === null && (a.g.H = a.s);
    a.g.O = 0;
    var b = N(a.oa);
    R(b, "RID", "rpc");
    R(b, "SID", a.J);
    R(b, "CI", a.N ? "0" : "1");
    R(b, "AID", a.U);
    Kd(a, b);
    R(b, "TYPE", "xmlhttp");
    a.o && a.s && Gd(b, a.o, a.s);
    a.K && a.g.setTimeout(a.K);
    var c = a.g;
    a = a.la;
    c.K = 1;
    c.v = jc(N(b));
    c.s = null;
    c.U = true;
    kc(c, a);
  }
  k.ab = function() {
    this.v != null && (this.v = null, Ac(this), Bc(this), J(19));
  };
  function zc(a) {
    a.v != null && (l.clearTimeout(a.v), a.v = null);
  }
  function uc(a, b) {
    var c = null;
    if (a.g == b) {
      zc(a);
      wc(a);
      a.g = null;
      var d = 2;
    } else if (yc(a.i, b))
      c = b.D, Fc(a.i, b), d = 1;
    else
      return;
    a.I = b.N;
    if (a.G != 0) {
      if (b.i)
        if (d == 1) {
          c = b.s ? b.s.length : 0;
          b = Date.now() - b.F;
          var e = a.C;
          d = Sb();
          D(d, new Vb(d, c, b, e));
          Hc(a);
        } else
          Gc(a);
      else if (e = b.o, e == 3 || e == 0 && 0 < a.I || !(d == 1 && Nd(a, b) || d == 2 && Bc(a)))
        switch (c && 0 < c.length && (b = a.i, b.i = b.i.concat(c)), e) {
          case 1:
            Q(a, 5);
            break;
          case 4:
            Q(a, 10);
            break;
          case 3:
            Q(a, 6);
            break;
          default:
            Q(a, 2);
        }
    }
  }
  function Od(a, b) {
    let c = a.Pa + Math.floor(Math.random() * a.$a);
    a.j || (c *= 2);
    return c * b;
  }
  function Q(a, b) {
    a.h.info("Error code " + b);
    if (b == 2) {
      var c = null;
      a.j && (c = null);
      var d = q(a.jb, a);
      c || (c = new U("//www.google.com/images/cleardot.gif"), l.location && l.location.protocol == "http" || Oc(c, "https"), jc(c));
      nd(c.toString(), d);
    } else
      J(2);
    a.G = 0;
    a.j && a.j.va(b);
    Ld(a);
    Jd(a);
  }
  k.jb = function(a) {
    a ? (this.h.info("Successfully pinged google.com"), J(2)) : (this.h.info("Failed to ping google.com"), J(1));
  };
  function Ld(a) {
    a.G = 0;
    a.I = -1;
    if (a.j) {
      if (jd(a.i).length != 0 || a.l.length != 0)
        a.i.i.length = 0, ra(a.l), a.l.length = 0;
      a.j.ua();
    }
  }
  function Ec(a, b, c) {
    let d = ad(c);
    if (d.i != "")
      b && Pc(d, b + "." + d.i), Qc(d, d.m);
    else {
      const e = l.location;
      d = bd(e.protocol, b ? b + "." + e.hostname : e.hostname, +e.port, c);
    }
    a.aa && xa(a.aa, function(e, f) {
      R(d, f, e);
    });
    b = a.D;
    c = a.sa;
    b && c && R(d, b, c);
    R(d, "VER", a.ma);
    Kd(a, d);
    return d;
  }
  function nc(a, b, c) {
    if (b && !a.H)
      throw Error("Can't create secondary domain capable XhrIo object.");
    b = c && a.Ba && !a.qa ? new X(new pd({ ib: true })) : new X(a.qa);
    b.L = a.H;
    return b;
  }
  function Sd() {
  }
  k = Sd.prototype;
  k.xa = function() {
  };
  k.wa = function() {
  };
  k.va = function() {
  };
  k.ua = function() {
  };
  k.Oa = function() {
  };
  function Td() {
    if (y && !(10 <= Number(Ua)))
      throw Error("Environmental error: no available transport.");
  }
  Td.prototype.g = function(a, b) {
    return new Y(a, b);
  };
  function Y(a, b) {
    C.call(this);
    this.g = new Id(b);
    this.l = a;
    this.h = b && b.messageUrlParams || null;
    a = b && b.messageHeaders || null;
    b && b.clientProtocolHeaderRequired && (a ? a["X-Client-Protocol"] = "webchannel" : a = { "X-Client-Protocol": "webchannel" });
    this.g.s = a;
    a = b && b.initMessageHeaders || null;
    b && b.messageContentType && (a ? a["X-WebChannel-Content-Type"] = b.messageContentType : a = { "X-WebChannel-Content-Type": b.messageContentType });
    b && b.ya && (a ? a["X-WebChannel-Client-Profile"] = b.ya : a = { "X-WebChannel-Client-Profile": b.ya });
    this.g.P = a;
    (a = b && b.httpHeadersOverwriteParam) && !sa(a) && (this.g.o = a);
    this.A = b && b.supportsCrossDomainXhr || false;
    this.v = b && b.sendRawJson || false;
    (b = b && b.httpSessionIdParam) && !sa(b) && (this.g.D = b, a = this.h, a !== null && b in a && (a = this.h, b in a && delete a[b]));
    this.j = new Z(this);
  }
  t(Y, C);
  Y.prototype.m = function() {
    this.g.j = this.j;
    this.A && (this.g.H = true);
    var a = this.g, b = this.l, c = this.h || void 0;
    a.Wa && (a.h.info("Origin Trials enabled."), zb(q(a.hb, a, b)));
    J(0);
    a.W = b;
    a.aa = c || {};
    a.N = a.X;
    a.F = Ec(a, null, a.W);
    Hc(a);
  };
  Y.prototype.close = function() {
    Ic(this.g);
  };
  Y.prototype.u = function(a) {
    if (typeof a === "string") {
      var b = {};
      b.__data__ = a;
      Md(this.g, b);
    } else
      this.v ? (b = {}, b.__data__ = rb(a), Md(this.g, b)) : Md(this.g, a);
  };
  Y.prototype.M = function() {
    this.g.j = null;
    delete this.j;
    Ic(this.g);
    delete this.g;
    Y.Z.M.call(this);
  };
  function Ud(a) {
    ac.call(this);
    var b = a.__sm__;
    if (b) {
      a: {
        for (const c in b) {
          a = c;
          break a;
        }
        a = void 0;
      }
      if (this.i = a)
        a = this.i, b = b !== null && a in b ? b[a] : void 0;
      this.data = b;
    } else
      this.data = a;
  }
  t(Ud, ac);
  function Vd() {
    bc.call(this);
    this.status = 1;
  }
  t(Vd, bc);
  function Z(a) {
    this.g = a;
  }
  t(Z, Sd);
  Z.prototype.xa = function() {
    D(this.g, "a");
  };
  Z.prototype.wa = function(a) {
    D(this.g, new Ud(a));
  };
  Z.prototype.va = function(a) {
    D(this.g, new Vd(a));
  };
  Z.prototype.ua = function() {
    D(this.g, "b");
  };
  Td.prototype.createWebChannel = Td.prototype.g;
  Y.prototype.send = Y.prototype.u;
  Y.prototype.open = Y.prototype.m;
  Y.prototype.close = Y.prototype.close;
  Wb.NO_ERROR = 0;
  Wb.TIMEOUT = 8;
  Wb.HTTP_ERROR = 6;
  Xb.COMPLETE = "complete";
  $b.EventType = L;
  L.OPEN = "a";
  L.CLOSE = "b";
  L.ERROR = "c";
  L.MESSAGE = "d";
  C.prototype.listen = C.prototype.N;
  X.prototype.listenOnce = X.prototype.O;
  X.prototype.getLastError = X.prototype.La;
  X.prototype.getLastErrorCode = X.prototype.Da;
  X.prototype.getStatus = X.prototype.ba;
  X.prototype.getResponseJson = X.prototype.Qa;
  X.prototype.getResponseText = X.prototype.ga;
  X.prototype.send = X.prototype.ea;
  var createWebChannelTransport = esm.createWebChannelTransport = function() {
    return new Td();
  };
  var getStatEventTarget = esm.getStatEventTarget = function() {
    return Sb();
  };
  var ErrorCode = esm.ErrorCode = Wb;
  var EventType = esm.EventType = Xb;
  var Event = esm.Event = H;
  var Stat = esm.Stat = { rb: 0, ub: 1, vb: 2, Ob: 3, Tb: 4, Qb: 5, Rb: 6, Pb: 7, Nb: 8, Sb: 9, PROXY: 10, NOPROXY: 11, Lb: 12, Hb: 13, Ib: 14, Gb: 15, Jb: 16, Kb: 17, nb: 18, mb: 19, ob: 20 };
  var FetchXmlHttpFactory = esm.FetchXmlHttpFactory = pd;
  var WebChannel = esm.WebChannel = $b;
  var XhrIo = esm.XhrIo = X;

  // node_modules/.pnpm/@firebase+firestore@3.4.9_@firebase+app@0.7.25/node_modules/@firebase/firestore/dist/index.esm2017.js
  var D2 = "@firebase/firestore";
  var C2 = class {
    constructor(t2) {
      this.uid = t2;
    }
    isAuthenticated() {
      return this.uid != null;
    }
    toKey() {
      return this.isAuthenticated() ? "uid:" + this.uid : "anonymous-user";
    }
    isEqual(t2) {
      return t2.uid === this.uid;
    }
  };
  C2.UNAUTHENTICATED = new C2(null), C2.GOOGLE_CREDENTIALS = new C2("google-credentials-uid"), C2.FIRST_PARTY = new C2("first-party-uid"), C2.MOCK_USER = new C2("mock-user");
  var x2 = "9.8.0";
  var N2 = new Logger("@firebase/firestore");
  function k2() {
    return N2.logLevel;
  }
  function O2(t2, ...e) {
    if (N2.logLevel <= LogLevel.DEBUG) {
      const n = e.map(B2);
      N2.debug(`Firestore (${x2}): ${t2}`, ...n);
    }
  }
  function F2(t2, ...e) {
    if (N2.logLevel <= LogLevel.ERROR) {
      const n = e.map(B2);
      N2.error(`Firestore (${x2}): ${t2}`, ...n);
    }
  }
  function $(t2, ...e) {
    if (N2.logLevel <= LogLevel.WARN) {
      const n = e.map(B2);
      N2.warn(`Firestore (${x2}): ${t2}`, ...n);
    }
  }
  function B2(t2) {
    if (typeof t2 == "string")
      return t2;
    try {
      return e = t2, JSON.stringify(e);
    } catch (e2) {
      return t2;
    }
    var e;
  }
  function L2(t2 = "Unexpected state") {
    const e = `FIRESTORE (${x2}) INTERNAL ASSERTION FAILED: ` + t2;
    throw F2(e), new Error(e);
  }
  function U2(t2, e) {
    t2 || L2();
  }
  function K2(t2, e) {
    return t2;
  }
  var G = {
    OK: "ok",
    CANCELLED: "cancelled",
    UNKNOWN: "unknown",
    INVALID_ARGUMENT: "invalid-argument",
    DEADLINE_EXCEEDED: "deadline-exceeded",
    NOT_FOUND: "not-found",
    ALREADY_EXISTS: "already-exists",
    PERMISSION_DENIED: "permission-denied",
    UNAUTHENTICATED: "unauthenticated",
    RESOURCE_EXHAUSTED: "resource-exhausted",
    FAILED_PRECONDITION: "failed-precondition",
    ABORTED: "aborted",
    OUT_OF_RANGE: "out-of-range",
    UNIMPLEMENTED: "unimplemented",
    INTERNAL: "internal",
    UNAVAILABLE: "unavailable",
    DATA_LOSS: "data-loss"
  };
  var Q2 = class extends FirebaseError {
    constructor(t2, e) {
      super(t2, e), this.code = t2, this.message = e, this.toString = () => `${this.name}: [code=${this.code}]: ${this.message}`;
    }
  };
  var j = class {
    constructor() {
      this.promise = new Promise((t2, e) => {
        this.resolve = t2, this.reject = e;
      });
    }
  };
  var W2 = class {
    constructor(t2, e) {
      this.user = e, this.type = "OAuth", this.headers = /* @__PURE__ */ new Map(), this.headers.set("Authorization", `Bearer ${t2}`);
    }
  };
  var z2 = class {
    getToken() {
      return Promise.resolve(null);
    }
    invalidateToken() {
    }
    start(t2, e) {
      t2.enqueueRetryable(() => e(C2.UNAUTHENTICATED));
    }
    shutdown() {
    }
  };
  var J2 = class {
    constructor(t2) {
      this.t = t2, this.currentUser = C2.UNAUTHENTICATED, this.i = 0, this.forceRefresh = false, this.auth = null;
    }
    start(t2, e) {
      let n = this.i;
      const s = (t3) => this.i !== n ? (n = this.i, e(t3)) : Promise.resolve();
      let i = new j();
      this.o = () => {
        this.i++, this.currentUser = this.u(), i.resolve(), i = new j(), t2.enqueueRetryable(() => s(this.currentUser));
      };
      const r = () => {
        const e2 = i;
        t2.enqueueRetryable(async () => {
          await e2.promise, await s(this.currentUser);
        });
      }, o = (t3) => {
        O2("FirebaseAuthCredentialsProvider", "Auth detected"), this.auth = t3, this.auth.addAuthTokenListener(this.o), r();
      };
      this.t.onInit((t3) => o(t3)), setTimeout(() => {
        if (!this.auth) {
          const t3 = this.t.getImmediate({
            optional: true
          });
          t3 ? o(t3) : (O2("FirebaseAuthCredentialsProvider", "Auth not yet detected"), i.resolve(), i = new j());
        }
      }, 0), r();
    }
    getToken() {
      const t2 = this.i, e = this.forceRefresh;
      return this.forceRefresh = false, this.auth ? this.auth.getToken(e).then((e2) => this.i !== t2 ? (O2("FirebaseAuthCredentialsProvider", "getToken aborted due to token change."), this.getToken()) : e2 ? (U2(typeof e2.accessToken == "string"), new W2(e2.accessToken, this.currentUser)) : null) : Promise.resolve(null);
    }
    invalidateToken() {
      this.forceRefresh = true;
    }
    shutdown() {
      this.auth && this.auth.removeAuthTokenListener(this.o);
    }
    u() {
      const t2 = this.auth && this.auth.getUid();
      return U2(t2 === null || typeof t2 == "string"), new C2(t2);
    }
  };
  var Y2 = class {
    constructor(t2, e, n) {
      this.type = "FirstParty", this.user = C2.FIRST_PARTY, this.headers = /* @__PURE__ */ new Map(), this.headers.set("X-Goog-AuthUser", e);
      const s = t2.auth.getAuthHeaderValueForFirstParty([]);
      s && this.headers.set("Authorization", s), n && this.headers.set("X-Goog-Iam-Authorization-Token", n);
    }
  };
  var X2 = class {
    constructor(t2, e, n) {
      this.h = t2, this.l = e, this.m = n;
    }
    getToken() {
      return Promise.resolve(new Y2(this.h, this.l, this.m));
    }
    start(t2, e) {
      t2.enqueueRetryable(() => e(C2.FIRST_PARTY));
    }
    shutdown() {
    }
    invalidateToken() {
    }
  };
  var Z2 = class {
    constructor(t2) {
      this.value = t2, this.type = "AppCheck", this.headers = /* @__PURE__ */ new Map(), t2 && t2.length > 0 && this.headers.set("x-firebase-appcheck", this.value);
    }
  };
  var tt = class {
    constructor(t2) {
      this.g = t2, this.forceRefresh = false, this.appCheck = null, this.p = null;
    }
    start(t2, e) {
      const n = (t3) => {
        t3.error != null && O2("FirebaseAppCheckTokenProvider", `Error getting App Check token; using placeholder token instead. Error: ${t3.error.message}`);
        const n2 = t3.token !== this.p;
        return this.p = t3.token, O2("FirebaseAppCheckTokenProvider", `Received ${n2 ? "new" : "existing"} token.`), n2 ? e(t3.token) : Promise.resolve();
      };
      this.o = (e2) => {
        t2.enqueueRetryable(() => n(e2));
      };
      const s = (t3) => {
        O2("FirebaseAppCheckTokenProvider", "AppCheck detected"), this.appCheck = t3, this.appCheck.addTokenListener(this.o);
      };
      this.g.onInit((t3) => s(t3)), setTimeout(() => {
        if (!this.appCheck) {
          const t3 = this.g.getImmediate({
            optional: true
          });
          t3 ? s(t3) : O2("FirebaseAppCheckTokenProvider", "AppCheck not yet detected");
        }
      }, 0);
    }
    getToken() {
      const t2 = this.forceRefresh;
      return this.forceRefresh = false, this.appCheck ? this.appCheck.getToken(t2).then((t3) => t3 ? (U2(typeof t3.token == "string"), this.p = t3.token, new Z2(t3.token)) : null) : Promise.resolve(null);
    }
    invalidateToken() {
      this.forceRefresh = true;
    }
    shutdown() {
      this.appCheck && this.appCheck.removeTokenListener(this.o);
    }
  };
  var nt = class {
    constructor(t2, e) {
      this.previousValue = t2, e && (e.sequenceNumberHandler = (t3) => this.I(t3), this.T = (t3) => e.writeSequenceNumber(t3));
    }
    I(t2) {
      return this.previousValue = Math.max(t2, this.previousValue), this.previousValue;
    }
    next() {
      const t2 = ++this.previousValue;
      return this.T && this.T(t2), t2;
    }
  };
  function st(t2) {
    const e = typeof self != "undefined" && (self.crypto || self.msCrypto), n = new Uint8Array(t2);
    if (e && typeof e.getRandomValues == "function")
      e.getRandomValues(n);
    else
      for (let e2 = 0; e2 < t2; e2++)
        n[e2] = Math.floor(256 * Math.random());
    return n;
  }
  nt.A = -1;
  var it = class {
    static R() {
      const t2 = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789", e = Math.floor(256 / t2.length) * t2.length;
      let n = "";
      for (; n.length < 20; ) {
        const s = st(40);
        for (let i = 0; i < s.length; ++i)
          n.length < 20 && s[i] < e && (n += t2.charAt(s[i] % t2.length));
      }
      return n;
    }
  };
  function rt(t2, e) {
    return t2 < e ? -1 : t2 > e ? 1 : 0;
  }
  function ot(t2, e, n) {
    return t2.length === e.length && t2.every((t3, s) => n(t3, e[s]));
  }
  var at = class {
    constructor(t2, e) {
      if (this.seconds = t2, this.nanoseconds = e, e < 0)
        throw new Q2(G.INVALID_ARGUMENT, "Timestamp nanoseconds out of range: " + e);
      if (e >= 1e9)
        throw new Q2(G.INVALID_ARGUMENT, "Timestamp nanoseconds out of range: " + e);
      if (t2 < -62135596800)
        throw new Q2(G.INVALID_ARGUMENT, "Timestamp seconds out of range: " + t2);
      if (t2 >= 253402300800)
        throw new Q2(G.INVALID_ARGUMENT, "Timestamp seconds out of range: " + t2);
    }
    static now() {
      return at.fromMillis(Date.now());
    }
    static fromDate(t2) {
      return at.fromMillis(t2.getTime());
    }
    static fromMillis(t2) {
      const e = Math.floor(t2 / 1e3), n = Math.floor(1e6 * (t2 - 1e3 * e));
      return new at(e, n);
    }
    toDate() {
      return new Date(this.toMillis());
    }
    toMillis() {
      return 1e3 * this.seconds + this.nanoseconds / 1e6;
    }
    _compareTo(t2) {
      return this.seconds === t2.seconds ? rt(this.nanoseconds, t2.nanoseconds) : rt(this.seconds, t2.seconds);
    }
    isEqual(t2) {
      return t2.seconds === this.seconds && t2.nanoseconds === this.nanoseconds;
    }
    toString() {
      return "Timestamp(seconds=" + this.seconds + ", nanoseconds=" + this.nanoseconds + ")";
    }
    toJSON() {
      return {
        seconds: this.seconds,
        nanoseconds: this.nanoseconds
      };
    }
    valueOf() {
      const t2 = this.seconds - -62135596800;
      return String(t2).padStart(12, "0") + "." + String(this.nanoseconds).padStart(9, "0");
    }
  };
  var ct = class {
    constructor(t2) {
      this.timestamp = t2;
    }
    static fromTimestamp(t2) {
      return new ct(t2);
    }
    static min() {
      return new ct(new at(0, 0));
    }
    static max() {
      return new ct(new at(253402300799, 999999999));
    }
    compareTo(t2) {
      return this.timestamp._compareTo(t2.timestamp);
    }
    isEqual(t2) {
      return this.timestamp.isEqual(t2.timestamp);
    }
    toMicroseconds() {
      return 1e6 * this.timestamp.seconds + this.timestamp.nanoseconds / 1e3;
    }
    toString() {
      return "SnapshotVersion(" + this.timestamp.toString() + ")";
    }
    toTimestamp() {
      return this.timestamp;
    }
  };
  function ht(t2) {
    let e = 0;
    for (const n in t2)
      Object.prototype.hasOwnProperty.call(t2, n) && e++;
    return e;
  }
  function lt(t2, e) {
    for (const n in t2)
      Object.prototype.hasOwnProperty.call(t2, n) && e(n, t2[n]);
  }
  function ft(t2) {
    for (const e in t2)
      if (Object.prototype.hasOwnProperty.call(t2, e))
        return false;
    return true;
  }
  var dt = class {
    constructor(t2, e, n) {
      e === void 0 ? e = 0 : e > t2.length && L2(), n === void 0 ? n = t2.length - e : n > t2.length - e && L2(), this.segments = t2, this.offset = e, this.len = n;
    }
    get length() {
      return this.len;
    }
    isEqual(t2) {
      return dt.comparator(this, t2) === 0;
    }
    child(t2) {
      const e = this.segments.slice(this.offset, this.limit());
      return t2 instanceof dt ? t2.forEach((t3) => {
        e.push(t3);
      }) : e.push(t2), this.construct(e);
    }
    limit() {
      return this.offset + this.length;
    }
    popFirst(t2) {
      return t2 = t2 === void 0 ? 1 : t2, this.construct(this.segments, this.offset + t2, this.length - t2);
    }
    popLast() {
      return this.construct(this.segments, this.offset, this.length - 1);
    }
    firstSegment() {
      return this.segments[this.offset];
    }
    lastSegment() {
      return this.get(this.length - 1);
    }
    get(t2) {
      return this.segments[this.offset + t2];
    }
    isEmpty() {
      return this.length === 0;
    }
    isPrefixOf(t2) {
      if (t2.length < this.length)
        return false;
      for (let e = 0; e < this.length; e++)
        if (this.get(e) !== t2.get(e))
          return false;
      return true;
    }
    isImmediateParentOf(t2) {
      if (this.length + 1 !== t2.length)
        return false;
      for (let e = 0; e < this.length; e++)
        if (this.get(e) !== t2.get(e))
          return false;
      return true;
    }
    forEach(t2) {
      for (let e = this.offset, n = this.limit(); e < n; e++)
        t2(this.segments[e]);
    }
    toArray() {
      return this.segments.slice(this.offset, this.limit());
    }
    static comparator(t2, e) {
      const n = Math.min(t2.length, e.length);
      for (let s = 0; s < n; s++) {
        const n2 = t2.get(s), i = e.get(s);
        if (n2 < i)
          return -1;
        if (n2 > i)
          return 1;
      }
      return t2.length < e.length ? -1 : t2.length > e.length ? 1 : 0;
    }
  };
  var _t = class extends dt {
    construct(t2, e, n) {
      return new _t(t2, e, n);
    }
    canonicalString() {
      return this.toArray().join("/");
    }
    toString() {
      return this.canonicalString();
    }
    static fromString(...t2) {
      const e = [];
      for (const n of t2) {
        if (n.indexOf("//") >= 0)
          throw new Q2(G.INVALID_ARGUMENT, `Invalid segment (${n}). Paths must not contain // in them.`);
        e.push(...n.split("/").filter((t3) => t3.length > 0));
      }
      return new _t(e);
    }
    static emptyPath() {
      return new _t([]);
    }
  };
  var wt = /^[_a-zA-Z][_a-zA-Z0-9]*$/;
  var mt = class extends dt {
    construct(t2, e, n) {
      return new mt(t2, e, n);
    }
    static isValidIdentifier(t2) {
      return wt.test(t2);
    }
    canonicalString() {
      return this.toArray().map((t2) => (t2 = t2.replace(/\\/g, "\\\\").replace(/`/g, "\\`"), mt.isValidIdentifier(t2) || (t2 = "`" + t2 + "`"), t2)).join(".");
    }
    toString() {
      return this.canonicalString();
    }
    isKeyField() {
      return this.length === 1 && this.get(0) === "__name__";
    }
    static keyField() {
      return new mt(["__name__"]);
    }
    static fromServerFormat(t2) {
      const e = [];
      let n = "", s = 0;
      const i = () => {
        if (n.length === 0)
          throw new Q2(G.INVALID_ARGUMENT, `Invalid field path (${t2}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);
        e.push(n), n = "";
      };
      let r = false;
      for (; s < t2.length; ) {
        const e2 = t2[s];
        if (e2 === "\\") {
          if (s + 1 === t2.length)
            throw new Q2(G.INVALID_ARGUMENT, "Path has trailing escape character: " + t2);
          const e3 = t2[s + 1];
          if (e3 !== "\\" && e3 !== "." && e3 !== "`")
            throw new Q2(G.INVALID_ARGUMENT, "Path has invalid escape sequence: " + t2);
          n += e3, s += 2;
        } else
          e2 === "`" ? (r = !r, s++) : e2 !== "." || r ? (n += e2, s++) : (i(), s++);
      }
      if (i(), r)
        throw new Q2(G.INVALID_ARGUMENT, "Unterminated ` in path: " + t2);
      return new mt(e);
    }
    static emptyPath() {
      return new mt([]);
    }
  };
  var pt = class {
    constructor(t2) {
      this.binaryString = t2;
    }
    static fromBase64String(t2) {
      const e = atob(t2);
      return new pt(e);
    }
    static fromUint8Array(t2) {
      const e = function(t3) {
        let e2 = "";
        for (let n = 0; n < t3.length; ++n)
          e2 += String.fromCharCode(t3[n]);
        return e2;
      }(t2);
      return new pt(e);
    }
    [Symbol.iterator]() {
      let t2 = 0;
      return {
        next: () => t2 < this.binaryString.length ? {
          value: this.binaryString.charCodeAt(t2++),
          done: false
        } : {
          value: void 0,
          done: true
        }
      };
    }
    toBase64() {
      return t2 = this.binaryString, btoa(t2);
      var t2;
    }
    toUint8Array() {
      return function(t2) {
        const e = new Uint8Array(t2.length);
        for (let n = 0; n < t2.length; n++)
          e[n] = t2.charCodeAt(n);
        return e;
      }(this.binaryString);
    }
    approximateByteSize() {
      return 2 * this.binaryString.length;
    }
    compareTo(t2) {
      return rt(this.binaryString, t2.binaryString);
    }
    isEqual(t2) {
      return this.binaryString === t2.binaryString;
    }
  };
  pt.EMPTY_BYTE_STRING = new pt("");
  var It = new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);
  function Tt(t2) {
    if (U2(!!t2), typeof t2 == "string") {
      let e = 0;
      const n = It.exec(t2);
      if (U2(!!n), n[1]) {
        let t3 = n[1];
        t3 = (t3 + "000000000").substr(0, 9), e = Number(t3);
      }
      const s = new Date(t2);
      return {
        seconds: Math.floor(s.getTime() / 1e3),
        nanos: e
      };
    }
    return {
      seconds: Et(t2.seconds),
      nanos: Et(t2.nanos)
    };
  }
  function Et(t2) {
    return typeof t2 == "number" ? t2 : typeof t2 == "string" ? Number(t2) : 0;
  }
  function At(t2) {
    return typeof t2 == "string" ? pt.fromBase64String(t2) : pt.fromUint8Array(t2);
  }
  function Rt(t2) {
    var e, n;
    return ((n = (((e = t2 == null ? void 0 : t2.mapValue) === null || e === void 0 ? void 0 : e.fields) || {}).__type__) === null || n === void 0 ? void 0 : n.stringValue) === "server_timestamp";
  }
  function bt(t2) {
    const e = t2.mapValue.fields.__previous_value__;
    return Rt(e) ? bt(e) : e;
  }
  function Pt(t2) {
    const e = Tt(t2.mapValue.fields.__local_write_time__.timestampValue);
    return new at(e.seconds, e.nanos);
  }
  var Vt = class {
    constructor(t2, e, n, s, i, r, o, u) {
      this.databaseId = t2, this.appId = e, this.persistenceKey = n, this.host = s, this.ssl = i, this.forceLongPolling = r, this.autoDetectLongPolling = o, this.useFetchStreams = u;
    }
  };
  var vt = class {
    constructor(t2, e) {
      this.projectId = t2, this.database = e || "(default)";
    }
    static empty() {
      return new vt("", "");
    }
    get isDefaultDatabase() {
      return this.database === "(default)";
    }
    isEqual(t2) {
      return t2 instanceof vt && t2.projectId === this.projectId && t2.database === this.database;
    }
  };
  function St(t2) {
    return t2 == null;
  }
  function Dt(t2) {
    return t2 === 0 && 1 / t2 == -1 / 0;
  }
  var xt = class {
    constructor(t2) {
      this.path = t2;
    }
    static fromPath(t2) {
      return new xt(_t.fromString(t2));
    }
    static fromName(t2) {
      return new xt(_t.fromString(t2).popFirst(5));
    }
    static empty() {
      return new xt(_t.emptyPath());
    }
    get collectionGroup() {
      return this.path.popLast().lastSegment();
    }
    hasCollectionId(t2) {
      return this.path.length >= 2 && this.path.get(this.path.length - 2) === t2;
    }
    getCollectionGroup() {
      return this.path.get(this.path.length - 2);
    }
    getCollectionPath() {
      return this.path.popLast();
    }
    isEqual(t2) {
      return t2 !== null && _t.comparator(this.path, t2.path) === 0;
    }
    toString() {
      return this.path.toString();
    }
    static comparator(t2, e) {
      return _t.comparator(t2.path, e.path);
    }
    static isDocumentKey(t2) {
      return t2.length % 2 == 0;
    }
    static fromSegments(t2) {
      return new xt(new _t(t2.slice()));
    }
  };
  var Nt = {
    mapValue: {
      fields: {
        __type__: {
          stringValue: "__max__"
        }
      }
    }
  };
  function Mt(t2) {
    return "nullValue" in t2 ? 0 : "booleanValue" in t2 ? 1 : "integerValue" in t2 || "doubleValue" in t2 ? 2 : "timestampValue" in t2 ? 3 : "stringValue" in t2 ? 5 : "bytesValue" in t2 ? 6 : "referenceValue" in t2 ? 7 : "geoPointValue" in t2 ? 8 : "arrayValue" in t2 ? 9 : "mapValue" in t2 ? Rt(t2) ? 4 : Ht(t2) ? 9007199254740991 : 10 : L2();
  }
  function Ot(t2, e) {
    if (t2 === e)
      return true;
    const n = Mt(t2);
    if (n !== Mt(e))
      return false;
    switch (n) {
      case 0:
      case 9007199254740991:
        return true;
      case 1:
        return t2.booleanValue === e.booleanValue;
      case 4:
        return Pt(t2).isEqual(Pt(e));
      case 3:
        return function(t3, e2) {
          if (typeof t3.timestampValue == "string" && typeof e2.timestampValue == "string" && t3.timestampValue.length === e2.timestampValue.length)
            return t3.timestampValue === e2.timestampValue;
          const n2 = Tt(t3.timestampValue), s = Tt(e2.timestampValue);
          return n2.seconds === s.seconds && n2.nanos === s.nanos;
        }(t2, e);
      case 5:
        return t2.stringValue === e.stringValue;
      case 6:
        return function(t3, e2) {
          return At(t3.bytesValue).isEqual(At(e2.bytesValue));
        }(t2, e);
      case 7:
        return t2.referenceValue === e.referenceValue;
      case 8:
        return function(t3, e2) {
          return Et(t3.geoPointValue.latitude) === Et(e2.geoPointValue.latitude) && Et(t3.geoPointValue.longitude) === Et(e2.geoPointValue.longitude);
        }(t2, e);
      case 2:
        return function(t3, e2) {
          if ("integerValue" in t3 && "integerValue" in e2)
            return Et(t3.integerValue) === Et(e2.integerValue);
          if ("doubleValue" in t3 && "doubleValue" in e2) {
            const n2 = Et(t3.doubleValue), s = Et(e2.doubleValue);
            return n2 === s ? Dt(n2) === Dt(s) : isNaN(n2) && isNaN(s);
          }
          return false;
        }(t2, e);
      case 9:
        return ot(t2.arrayValue.values || [], e.arrayValue.values || [], Ot);
      case 10:
        return function(t3, e2) {
          const n2 = t3.mapValue.fields || {}, s = e2.mapValue.fields || {};
          if (ht(n2) !== ht(s))
            return false;
          for (const t4 in n2)
            if (n2.hasOwnProperty(t4) && (s[t4] === void 0 || !Ot(n2[t4], s[t4])))
              return false;
          return true;
        }(t2, e);
      default:
        return L2();
    }
  }
  function Ft(t2, e) {
    return (t2.values || []).find((t3) => Ot(t3, e)) !== void 0;
  }
  function $t(t2, e) {
    if (t2 === e)
      return 0;
    const n = Mt(t2), s = Mt(e);
    if (n !== s)
      return rt(n, s);
    switch (n) {
      case 0:
      case 9007199254740991:
        return 0;
      case 1:
        return rt(t2.booleanValue, e.booleanValue);
      case 2:
        return function(t3, e2) {
          const n2 = Et(t3.integerValue || t3.doubleValue), s2 = Et(e2.integerValue || e2.doubleValue);
          return n2 < s2 ? -1 : n2 > s2 ? 1 : n2 === s2 ? 0 : isNaN(n2) ? isNaN(s2) ? 0 : -1 : 1;
        }(t2, e);
      case 3:
        return Bt(t2.timestampValue, e.timestampValue);
      case 4:
        return Bt(Pt(t2), Pt(e));
      case 5:
        return rt(t2.stringValue, e.stringValue);
      case 6:
        return function(t3, e2) {
          const n2 = At(t3), s2 = At(e2);
          return n2.compareTo(s2);
        }(t2.bytesValue, e.bytesValue);
      case 7:
        return function(t3, e2) {
          const n2 = t3.split("/"), s2 = e2.split("/");
          for (let t4 = 0; t4 < n2.length && t4 < s2.length; t4++) {
            const e3 = rt(n2[t4], s2[t4]);
            if (e3 !== 0)
              return e3;
          }
          return rt(n2.length, s2.length);
        }(t2.referenceValue, e.referenceValue);
      case 8:
        return function(t3, e2) {
          const n2 = rt(Et(t3.latitude), Et(e2.latitude));
          if (n2 !== 0)
            return n2;
          return rt(Et(t3.longitude), Et(e2.longitude));
        }(t2.geoPointValue, e.geoPointValue);
      case 9:
        return function(t3, e2) {
          const n2 = t3.values || [], s2 = e2.values || [];
          for (let t4 = 0; t4 < n2.length && t4 < s2.length; ++t4) {
            const e3 = $t(n2[t4], s2[t4]);
            if (e3)
              return e3;
          }
          return rt(n2.length, s2.length);
        }(t2.arrayValue, e.arrayValue);
      case 10:
        return function(t3, e2) {
          if (t3 === Nt.mapValue && e2 === Nt.mapValue)
            return 0;
          if (t3 === Nt.mapValue)
            return 1;
          if (e2 === Nt.mapValue)
            return -1;
          const n2 = t3.fields || {}, s2 = Object.keys(n2), i = e2.fields || {}, r = Object.keys(i);
          s2.sort(), r.sort();
          for (let t4 = 0; t4 < s2.length && t4 < r.length; ++t4) {
            const e3 = rt(s2[t4], r[t4]);
            if (e3 !== 0)
              return e3;
            const o = $t(n2[s2[t4]], i[r[t4]]);
            if (o !== 0)
              return o;
          }
          return rt(s2.length, r.length);
        }(t2.mapValue, e.mapValue);
      default:
        throw L2();
    }
  }
  function Bt(t2, e) {
    if (typeof t2 == "string" && typeof e == "string" && t2.length === e.length)
      return rt(t2, e);
    const n = Tt(t2), s = Tt(e), i = rt(n.seconds, s.seconds);
    return i !== 0 ? i : rt(n.nanos, s.nanos);
  }
  function Lt(t2) {
    return Ut(t2);
  }
  function Ut(t2) {
    return "nullValue" in t2 ? "null" : "booleanValue" in t2 ? "" + t2.booleanValue : "integerValue" in t2 ? "" + t2.integerValue : "doubleValue" in t2 ? "" + t2.doubleValue : "timestampValue" in t2 ? function(t3) {
      const e2 = Tt(t3);
      return `time(${e2.seconds},${e2.nanos})`;
    }(t2.timestampValue) : "stringValue" in t2 ? t2.stringValue : "bytesValue" in t2 ? At(t2.bytesValue).toBase64() : "referenceValue" in t2 ? (n = t2.referenceValue, xt.fromName(n).toString()) : "geoPointValue" in t2 ? `geo(${(e = t2.geoPointValue).latitude},${e.longitude})` : "arrayValue" in t2 ? function(t3) {
      let e2 = "[", n2 = true;
      for (const s of t3.values || [])
        n2 ? n2 = false : e2 += ",", e2 += Ut(s);
      return e2 + "]";
    }(t2.arrayValue) : "mapValue" in t2 ? function(t3) {
      const e2 = Object.keys(t3.fields || {}).sort();
      let n2 = "{", s = true;
      for (const i of e2)
        s ? s = false : n2 += ",", n2 += `${i}:${Ut(t3.fields[i])}`;
      return n2 + "}";
    }(t2.mapValue) : L2();
    var e, n;
  }
  function Kt(t2) {
    return !!t2 && "integerValue" in t2;
  }
  function Gt(t2) {
    return !!t2 && "arrayValue" in t2;
  }
  function Qt(t2) {
    return !!t2 && "nullValue" in t2;
  }
  function jt(t2) {
    return !!t2 && "doubleValue" in t2 && isNaN(Number(t2.doubleValue));
  }
  function Wt(t2) {
    return !!t2 && "mapValue" in t2;
  }
  function zt(t2) {
    if (t2.geoPointValue)
      return {
        geoPointValue: Object.assign({}, t2.geoPointValue)
      };
    if (t2.timestampValue && typeof t2.timestampValue == "object")
      return {
        timestampValue: Object.assign({}, t2.timestampValue)
      };
    if (t2.mapValue) {
      const e = {
        mapValue: {
          fields: {}
        }
      };
      return lt(t2.mapValue.fields, (t3, n) => e.mapValue.fields[t3] = zt(n)), e;
    }
    if (t2.arrayValue) {
      const e = {
        arrayValue: {
          values: []
        }
      };
      for (let n = 0; n < (t2.arrayValue.values || []).length; ++n)
        e.arrayValue.values[n] = zt(t2.arrayValue.values[n]);
      return e;
    }
    return Object.assign({}, t2);
  }
  function Ht(t2) {
    return (((t2.mapValue || {}).fields || {}).__type__ || {}).stringValue === "__max__";
  }
  var te = class {
    constructor(t2) {
      this.value = t2;
    }
    static empty() {
      return new te({
        mapValue: {}
      });
    }
    field(t2) {
      if (t2.isEmpty())
        return this.value;
      {
        let e = this.value;
        for (let n = 0; n < t2.length - 1; ++n)
          if (e = (e.mapValue.fields || {})[t2.get(n)], !Wt(e))
            return null;
        return e = (e.mapValue.fields || {})[t2.lastSegment()], e || null;
      }
    }
    set(t2, e) {
      this.getFieldsMap(t2.popLast())[t2.lastSegment()] = zt(e);
    }
    setAll(t2) {
      let e = mt.emptyPath(), n = {}, s = [];
      t2.forEach((t3, i2) => {
        if (!e.isImmediateParentOf(i2)) {
          const t4 = this.getFieldsMap(e);
          this.applyChanges(t4, n, s), n = {}, s = [], e = i2.popLast();
        }
        t3 ? n[i2.lastSegment()] = zt(t3) : s.push(i2.lastSegment());
      });
      const i = this.getFieldsMap(e);
      this.applyChanges(i, n, s);
    }
    delete(t2) {
      const e = this.field(t2.popLast());
      Wt(e) && e.mapValue.fields && delete e.mapValue.fields[t2.lastSegment()];
    }
    isEqual(t2) {
      return Ot(this.value, t2.value);
    }
    getFieldsMap(t2) {
      let e = this.value;
      e.mapValue.fields || (e.mapValue = {
        fields: {}
      });
      for (let n = 0; n < t2.length; ++n) {
        let s = e.mapValue.fields[t2.get(n)];
        Wt(s) && s.mapValue.fields || (s = {
          mapValue: {
            fields: {}
          }
        }, e.mapValue.fields[t2.get(n)] = s), e = s;
      }
      return e.mapValue.fields;
    }
    applyChanges(t2, e, n) {
      lt(e, (e2, n2) => t2[e2] = n2);
      for (const e2 of n)
        delete t2[e2];
    }
    clone() {
      return new te(zt(this.value));
    }
  };
  var ne = class {
    constructor(t2, e, n, s, i, r) {
      this.key = t2, this.documentType = e, this.version = n, this.readTime = s, this.data = i, this.documentState = r;
    }
    static newInvalidDocument(t2) {
      return new ne(t2, 0, ct.min(), ct.min(), te.empty(), 0);
    }
    static newFoundDocument(t2, e, n) {
      return new ne(t2, 1, e, ct.min(), n, 0);
    }
    static newNoDocument(t2, e) {
      return new ne(t2, 2, e, ct.min(), te.empty(), 0);
    }
    static newUnknownDocument(t2, e) {
      return new ne(t2, 3, e, ct.min(), te.empty(), 2);
    }
    convertToFoundDocument(t2, e) {
      return this.version = t2, this.documentType = 1, this.data = e, this.documentState = 0, this;
    }
    convertToNoDocument(t2) {
      return this.version = t2, this.documentType = 2, this.data = te.empty(), this.documentState = 0, this;
    }
    convertToUnknownDocument(t2) {
      return this.version = t2, this.documentType = 3, this.data = te.empty(), this.documentState = 2, this;
    }
    setHasCommittedMutations() {
      return this.documentState = 2, this;
    }
    setHasLocalMutations() {
      return this.documentState = 1, this;
    }
    setReadTime(t2) {
      return this.readTime = t2, this;
    }
    get hasLocalMutations() {
      return this.documentState === 1;
    }
    get hasCommittedMutations() {
      return this.documentState === 2;
    }
    get hasPendingWrites() {
      return this.hasLocalMutations || this.hasCommittedMutations;
    }
    isValidDocument() {
      return this.documentType !== 0;
    }
    isFoundDocument() {
      return this.documentType === 1;
    }
    isNoDocument() {
      return this.documentType === 2;
    }
    isUnknownDocument() {
      return this.documentType === 3;
    }
    isEqual(t2) {
      return t2 instanceof ne && this.key.isEqual(t2.key) && this.version.isEqual(t2.version) && this.documentType === t2.documentType && this.documentState === t2.documentState && this.data.isEqual(t2.data);
    }
    mutableCopy() {
      return new ne(this.key, this.documentType, this.version, this.readTime, this.data.clone(), this.documentState);
    }
    toString() {
      return `Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`;
    }
  };
  var se = class {
    constructor(t2, e, n, s) {
      this.indexId = t2, this.collectionGroup = e, this.fields = n, this.indexState = s;
    }
  };
  se.UNKNOWN_ID = -1;
  function ae(t2, e) {
    const n = t2.toTimestamp().seconds, s = t2.toTimestamp().nanoseconds + 1, i = ct.fromTimestamp(s === 1e9 ? new at(n + 1, 0) : new at(n, s));
    return new he(i, xt.empty(), e);
  }
  function ce(t2) {
    return new he(t2.readTime, t2.key, -1);
  }
  var he = class {
    constructor(t2, e, n) {
      this.readTime = t2, this.documentKey = e, this.largestBatchId = n;
    }
    static min() {
      return new he(ct.min(), xt.empty(), -1);
    }
    static max() {
      return new he(ct.max(), xt.empty(), -1);
    }
  };
  function le(t2, e) {
    let n = t2.readTime.compareTo(e.readTime);
    return n !== 0 ? n : (n = xt.comparator(t2.documentKey, e.documentKey), n !== 0 ? n : rt(t2.largestBatchId, e.largestBatchId));
  }
  var fe = class {
    constructor(t2, e) {
      this.comparator = t2, this.root = e || _e.EMPTY;
    }
    insert(t2, e) {
      return new fe(this.comparator, this.root.insert(t2, e, this.comparator).copy(null, null, _e.BLACK, null, null));
    }
    remove(t2) {
      return new fe(this.comparator, this.root.remove(t2, this.comparator).copy(null, null, _e.BLACK, null, null));
    }
    get(t2) {
      let e = this.root;
      for (; !e.isEmpty(); ) {
        const n = this.comparator(t2, e.key);
        if (n === 0)
          return e.value;
        n < 0 ? e = e.left : n > 0 && (e = e.right);
      }
      return null;
    }
    indexOf(t2) {
      let e = 0, n = this.root;
      for (; !n.isEmpty(); ) {
        const s = this.comparator(t2, n.key);
        if (s === 0)
          return e + n.left.size;
        s < 0 ? n = n.left : (e += n.left.size + 1, n = n.right);
      }
      return -1;
    }
    isEmpty() {
      return this.root.isEmpty();
    }
    get size() {
      return this.root.size;
    }
    minKey() {
      return this.root.minKey();
    }
    maxKey() {
      return this.root.maxKey();
    }
    inorderTraversal(t2) {
      return this.root.inorderTraversal(t2);
    }
    forEach(t2) {
      this.inorderTraversal((e, n) => (t2(e, n), false));
    }
    toString() {
      const t2 = [];
      return this.inorderTraversal((e, n) => (t2.push(`${e}:${n}`), false)), `{${t2.join(", ")}}`;
    }
    reverseTraversal(t2) {
      return this.root.reverseTraversal(t2);
    }
    getIterator() {
      return new de(this.root, null, this.comparator, false);
    }
    getIteratorFrom(t2) {
      return new de(this.root, t2, this.comparator, false);
    }
    getReverseIterator() {
      return new de(this.root, null, this.comparator, true);
    }
    getReverseIteratorFrom(t2) {
      return new de(this.root, t2, this.comparator, true);
    }
  };
  var de = class {
    constructor(t2, e, n, s) {
      this.isReverse = s, this.nodeStack = [];
      let i = 1;
      for (; !t2.isEmpty(); )
        if (i = e ? n(t2.key, e) : 1, e && s && (i *= -1), i < 0)
          t2 = this.isReverse ? t2.left : t2.right;
        else {
          if (i === 0) {
            this.nodeStack.push(t2);
            break;
          }
          this.nodeStack.push(t2), t2 = this.isReverse ? t2.right : t2.left;
        }
    }
    getNext() {
      let t2 = this.nodeStack.pop();
      const e = {
        key: t2.key,
        value: t2.value
      };
      if (this.isReverse)
        for (t2 = t2.left; !t2.isEmpty(); )
          this.nodeStack.push(t2), t2 = t2.right;
      else
        for (t2 = t2.right; !t2.isEmpty(); )
          this.nodeStack.push(t2), t2 = t2.left;
      return e;
    }
    hasNext() {
      return this.nodeStack.length > 0;
    }
    peek() {
      if (this.nodeStack.length === 0)
        return null;
      const t2 = this.nodeStack[this.nodeStack.length - 1];
      return {
        key: t2.key,
        value: t2.value
      };
    }
  };
  var _e = class {
    constructor(t2, e, n, s, i) {
      this.key = t2, this.value = e, this.color = n != null ? n : _e.RED, this.left = s != null ? s : _e.EMPTY, this.right = i != null ? i : _e.EMPTY, this.size = this.left.size + 1 + this.right.size;
    }
    copy(t2, e, n, s, i) {
      return new _e(t2 != null ? t2 : this.key, e != null ? e : this.value, n != null ? n : this.color, s != null ? s : this.left, i != null ? i : this.right);
    }
    isEmpty() {
      return false;
    }
    inorderTraversal(t2) {
      return this.left.inorderTraversal(t2) || t2(this.key, this.value) || this.right.inorderTraversal(t2);
    }
    reverseTraversal(t2) {
      return this.right.reverseTraversal(t2) || t2(this.key, this.value) || this.left.reverseTraversal(t2);
    }
    min() {
      return this.left.isEmpty() ? this : this.left.min();
    }
    minKey() {
      return this.min().key;
    }
    maxKey() {
      return this.right.isEmpty() ? this.key : this.right.maxKey();
    }
    insert(t2, e, n) {
      let s = this;
      const i = n(t2, s.key);
      return s = i < 0 ? s.copy(null, null, null, s.left.insert(t2, e, n), null) : i === 0 ? s.copy(null, e, null, null, null) : s.copy(null, null, null, null, s.right.insert(t2, e, n)), s.fixUp();
    }
    removeMin() {
      if (this.left.isEmpty())
        return _e.EMPTY;
      let t2 = this;
      return t2.left.isRed() || t2.left.left.isRed() || (t2 = t2.moveRedLeft()), t2 = t2.copy(null, null, null, t2.left.removeMin(), null), t2.fixUp();
    }
    remove(t2, e) {
      let n, s = this;
      if (e(t2, s.key) < 0)
        s.left.isEmpty() || s.left.isRed() || s.left.left.isRed() || (s = s.moveRedLeft()), s = s.copy(null, null, null, s.left.remove(t2, e), null);
      else {
        if (s.left.isRed() && (s = s.rotateRight()), s.right.isEmpty() || s.right.isRed() || s.right.left.isRed() || (s = s.moveRedRight()), e(t2, s.key) === 0) {
          if (s.right.isEmpty())
            return _e.EMPTY;
          n = s.right.min(), s = s.copy(n.key, n.value, null, null, s.right.removeMin());
        }
        s = s.copy(null, null, null, null, s.right.remove(t2, e));
      }
      return s.fixUp();
    }
    isRed() {
      return this.color;
    }
    fixUp() {
      let t2 = this;
      return t2.right.isRed() && !t2.left.isRed() && (t2 = t2.rotateLeft()), t2.left.isRed() && t2.left.left.isRed() && (t2 = t2.rotateRight()), t2.left.isRed() && t2.right.isRed() && (t2 = t2.colorFlip()), t2;
    }
    moveRedLeft() {
      let t2 = this.colorFlip();
      return t2.right.left.isRed() && (t2 = t2.copy(null, null, null, null, t2.right.rotateRight()), t2 = t2.rotateLeft(), t2 = t2.colorFlip()), t2;
    }
    moveRedRight() {
      let t2 = this.colorFlip();
      return t2.left.left.isRed() && (t2 = t2.rotateRight(), t2 = t2.colorFlip()), t2;
    }
    rotateLeft() {
      const t2 = this.copy(null, null, _e.RED, null, this.right.left);
      return this.right.copy(null, null, this.color, t2, null);
    }
    rotateRight() {
      const t2 = this.copy(null, null, _e.RED, this.left.right, null);
      return this.left.copy(null, null, this.color, null, t2);
    }
    colorFlip() {
      const t2 = this.left.copy(null, null, !this.left.color, null, null), e = this.right.copy(null, null, !this.right.color, null, null);
      return this.copy(null, null, !this.color, t2, e);
    }
    checkMaxDepth() {
      const t2 = this.check();
      return Math.pow(2, t2) <= this.size + 1;
    }
    check() {
      if (this.isRed() && this.left.isRed())
        throw L2();
      if (this.right.isRed())
        throw L2();
      const t2 = this.left.check();
      if (t2 !== this.right.check())
        throw L2();
      return t2 + (this.isRed() ? 0 : 1);
    }
  };
  _e.EMPTY = null, _e.RED = true, _e.BLACK = false;
  _e.EMPTY = new class {
    constructor() {
      this.size = 0;
    }
    get key() {
      throw L2();
    }
    get value() {
      throw L2();
    }
    get color() {
      throw L2();
    }
    get left() {
      throw L2();
    }
    get right() {
      throw L2();
    }
    copy(t2, e, n, s, i) {
      return this;
    }
    insert(t2, e, n) {
      return new _e(t2, e);
    }
    remove(t2, e) {
      return this;
    }
    isEmpty() {
      return true;
    }
    inorderTraversal(t2) {
      return false;
    }
    reverseTraversal(t2) {
      return false;
    }
    minKey() {
      return null;
    }
    maxKey() {
      return null;
    }
    isRed() {
      return false;
    }
    checkMaxDepth() {
      return true;
    }
    check() {
      return 0;
    }
  }();
  var we = class {
    constructor(t2) {
      this.comparator = t2, this.data = new fe(this.comparator);
    }
    has(t2) {
      return this.data.get(t2) !== null;
    }
    first() {
      return this.data.minKey();
    }
    last() {
      return this.data.maxKey();
    }
    get size() {
      return this.data.size;
    }
    indexOf(t2) {
      return this.data.indexOf(t2);
    }
    forEach(t2) {
      this.data.inorderTraversal((e, n) => (t2(e), false));
    }
    forEachInRange(t2, e) {
      const n = this.data.getIteratorFrom(t2[0]);
      for (; n.hasNext(); ) {
        const s = n.getNext();
        if (this.comparator(s.key, t2[1]) >= 0)
          return;
        e(s.key);
      }
    }
    forEachWhile(t2, e) {
      let n;
      for (n = e !== void 0 ? this.data.getIteratorFrom(e) : this.data.getIterator(); n.hasNext(); ) {
        if (!t2(n.getNext().key))
          return;
      }
    }
    firstAfterOrEqual(t2) {
      const e = this.data.getIteratorFrom(t2);
      return e.hasNext() ? e.getNext().key : null;
    }
    getIterator() {
      return new me(this.data.getIterator());
    }
    getIteratorFrom(t2) {
      return new me(this.data.getIteratorFrom(t2));
    }
    add(t2) {
      return this.copy(this.data.remove(t2).insert(t2, true));
    }
    delete(t2) {
      return this.has(t2) ? this.copy(this.data.remove(t2)) : this;
    }
    isEmpty() {
      return this.data.isEmpty();
    }
    unionWith(t2) {
      let e = this;
      return e.size < t2.size && (e = t2, t2 = this), t2.forEach((t3) => {
        e = e.add(t3);
      }), e;
    }
    isEqual(t2) {
      if (!(t2 instanceof we))
        return false;
      if (this.size !== t2.size)
        return false;
      const e = this.data.getIterator(), n = t2.data.getIterator();
      for (; e.hasNext(); ) {
        const t3 = e.getNext().key, s = n.getNext().key;
        if (this.comparator(t3, s) !== 0)
          return false;
      }
      return true;
    }
    toArray() {
      const t2 = [];
      return this.forEach((e) => {
        t2.push(e);
      }), t2;
    }
    toString() {
      const t2 = [];
      return this.forEach((e) => t2.push(e)), "SortedSet(" + t2.toString() + ")";
    }
    copy(t2) {
      const e = new we(this.comparator);
      return e.data = t2, e;
    }
  };
  var me = class {
    constructor(t2) {
      this.iter = t2;
    }
    getNext() {
      return this.iter.getNext().key;
    }
    hasNext() {
      return this.iter.hasNext();
    }
  };
  var ye = class {
    constructor(t2, e = null, n = [], s = [], i = null, r = null, o = null) {
      this.path = t2, this.collectionGroup = e, this.orderBy = n, this.filters = s, this.limit = i, this.startAt = r, this.endAt = o, this.P = null;
    }
  };
  function pe(t2, e = null, n = [], s = [], i = null, r = null, o = null) {
    return new ye(t2, e, n, s, i, r, o);
  }
  function Ie(t2) {
    const e = K2(t2);
    if (e.P === null) {
      let t3 = e.path.canonicalString();
      e.collectionGroup !== null && (t3 += "|cg:" + e.collectionGroup), t3 += "|f:", t3 += e.filters.map((t4) => {
        return (e2 = t4).field.canonicalString() + e2.op.toString() + Lt(e2.value);
        var e2;
      }).join(","), t3 += "|ob:", t3 += e.orderBy.map((t4) => function(t5) {
        return t5.field.canonicalString() + t5.dir;
      }(t4)).join(","), St(e.limit) || (t3 += "|l:", t3 += e.limit), e.startAt && (t3 += "|lb:", t3 += e.startAt.inclusive ? "b:" : "a:", t3 += e.startAt.position.map((t4) => Lt(t4)).join(",")), e.endAt && (t3 += "|ub:", t3 += e.endAt.inclusive ? "a:" : "b:", t3 += e.endAt.position.map((t4) => Lt(t4)).join(",")), e.P = t3;
    }
    return e.P;
  }
  function Te(t2) {
    let e = t2.path.canonicalString();
    return t2.collectionGroup !== null && (e += " collectionGroup=" + t2.collectionGroup), t2.filters.length > 0 && (e += `, filters: [${t2.filters.map((t3) => {
      return `${(e2 = t3).field.canonicalString()} ${e2.op} ${Lt(e2.value)}`;
      var e2;
    }).join(", ")}]`), St(t2.limit) || (e += ", limit: " + t2.limit), t2.orderBy.length > 0 && (e += `, orderBy: [${t2.orderBy.map((t3) => function(t4) {
      return `${t4.field.canonicalString()} (${t4.dir})`;
    }(t3)).join(", ")}]`), t2.startAt && (e += ", startAt: ", e += t2.startAt.inclusive ? "b:" : "a:", e += t2.startAt.position.map((t3) => Lt(t3)).join(",")), t2.endAt && (e += ", endAt: ", e += t2.endAt.inclusive ? "a:" : "b:", e += t2.endAt.position.map((t3) => Lt(t3)).join(",")), `Target(${e})`;
  }
  function Ee(t2, e) {
    if (t2.limit !== e.limit)
      return false;
    if (t2.orderBy.length !== e.orderBy.length)
      return false;
    for (let n2 = 0; n2 < t2.orderBy.length; n2++)
      if (!$e(t2.orderBy[n2], e.orderBy[n2]))
        return false;
    if (t2.filters.length !== e.filters.length)
      return false;
    for (let i = 0; i < t2.filters.length; i++)
      if (n = t2.filters[i], s = e.filters[i], n.op !== s.op || !n.field.isEqual(s.field) || !Ot(n.value, s.value))
        return false;
    var n, s;
    return t2.collectionGroup === e.collectionGroup && (!!t2.path.isEqual(e.path) && (!!Le(t2.startAt, e.startAt) && Le(t2.endAt, e.endAt)));
  }
  function Ae(t2) {
    return xt.isDocumentKey(t2.path) && t2.collectionGroup === null && t2.filters.length === 0;
  }
  var Ve = class extends class {
  } {
    constructor(t2, e, n) {
      super(), this.field = t2, this.op = e, this.value = n;
    }
    static create(t2, e, n) {
      return t2.isKeyField() ? e === "in" || e === "not-in" ? this.V(t2, e, n) : new ve(t2, e, n) : e === "array-contains" ? new xe(t2, n) : e === "in" ? new Ne(t2, n) : e === "not-in" ? new ke(t2, n) : e === "array-contains-any" ? new Me(t2, n) : new Ve(t2, e, n);
    }
    static V(t2, e, n) {
      return e === "in" ? new Se(t2, n) : new De(t2, n);
    }
    matches(t2) {
      const e = t2.data.field(this.field);
      return this.op === "!=" ? e !== null && this.v($t(e, this.value)) : e !== null && Mt(this.value) === Mt(e) && this.v($t(e, this.value));
    }
    v(t2) {
      switch (this.op) {
        case "<":
          return t2 < 0;
        case "<=":
          return t2 <= 0;
        case "==":
          return t2 === 0;
        case "!=":
          return t2 !== 0;
        case ">":
          return t2 > 0;
        case ">=":
          return t2 >= 0;
        default:
          return L2();
      }
    }
    S() {
      return ["<", "<=", ">", ">=", "!=", "not-in"].indexOf(this.op) >= 0;
    }
  };
  var ve = class extends Ve {
    constructor(t2, e, n) {
      super(t2, e, n), this.key = xt.fromName(n.referenceValue);
    }
    matches(t2) {
      const e = xt.comparator(t2.key, this.key);
      return this.v(e);
    }
  };
  var Se = class extends Ve {
    constructor(t2, e) {
      super(t2, "in", e), this.keys = Ce("in", e);
    }
    matches(t2) {
      return this.keys.some((e) => e.isEqual(t2.key));
    }
  };
  var De = class extends Ve {
    constructor(t2, e) {
      super(t2, "not-in", e), this.keys = Ce("not-in", e);
    }
    matches(t2) {
      return !this.keys.some((e) => e.isEqual(t2.key));
    }
  };
  function Ce(t2, e) {
    var n;
    return (((n = e.arrayValue) === null || n === void 0 ? void 0 : n.values) || []).map((t3) => xt.fromName(t3.referenceValue));
  }
  var xe = class extends Ve {
    constructor(t2, e) {
      super(t2, "array-contains", e);
    }
    matches(t2) {
      const e = t2.data.field(this.field);
      return Gt(e) && Ft(e.arrayValue, this.value);
    }
  };
  var Ne = class extends Ve {
    constructor(t2, e) {
      super(t2, "in", e);
    }
    matches(t2) {
      const e = t2.data.field(this.field);
      return e !== null && Ft(this.value.arrayValue, e);
    }
  };
  var ke = class extends Ve {
    constructor(t2, e) {
      super(t2, "not-in", e);
    }
    matches(t2) {
      if (Ft(this.value.arrayValue, {
        nullValue: "NULL_VALUE"
      }))
        return false;
      const e = t2.data.field(this.field);
      return e !== null && !Ft(this.value.arrayValue, e);
    }
  };
  var Me = class extends Ve {
    constructor(t2, e) {
      super(t2, "array-contains-any", e);
    }
    matches(t2) {
      const e = t2.data.field(this.field);
      return !(!Gt(e) || !e.arrayValue.values) && e.arrayValue.values.some((t3) => Ft(this.value.arrayValue, t3));
    }
  };
  var Oe = class {
    constructor(t2, e) {
      this.position = t2, this.inclusive = e;
    }
  };
  var Fe = class {
    constructor(t2, e = "asc") {
      this.field = t2, this.dir = e;
    }
  };
  function $e(t2, e) {
    return t2.dir === e.dir && t2.field.isEqual(e.field);
  }
  function Be(t2, e, n) {
    let s = 0;
    for (let i = 0; i < t2.position.length; i++) {
      const r = e[i], o = t2.position[i];
      if (r.field.isKeyField())
        s = xt.comparator(xt.fromName(o.referenceValue), n.key);
      else {
        s = $t(o, n.data.field(r.field));
      }
      if (r.dir === "desc" && (s *= -1), s !== 0)
        break;
    }
    return s;
  }
  function Le(t2, e) {
    if (t2 === null)
      return e === null;
    if (e === null)
      return false;
    if (t2.inclusive !== e.inclusive || t2.position.length !== e.position.length)
      return false;
    for (let n = 0; n < t2.position.length; n++) {
      if (!Ot(t2.position[n], e.position[n]))
        return false;
    }
    return true;
  }
  var Ue = class {
    constructor(t2, e = null, n = [], s = [], i = null, r = "F", o = null, u = null) {
      this.path = t2, this.collectionGroup = e, this.explicitOrderBy = n, this.filters = s, this.limit = i, this.limitType = r, this.startAt = o, this.endAt = u, this.D = null, this.C = null, this.startAt, this.endAt;
    }
  };
  function qe(t2, e, n, s, i, r, o, u) {
    return new Ue(t2, e, n, s, i, r, o, u);
  }
  function Ke(t2) {
    return new Ue(t2);
  }
  function Ge(t2) {
    return t2.filters.length === 0 && t2.limit === null && t2.startAt == null && t2.endAt == null && (t2.explicitOrderBy.length === 0 || t2.explicitOrderBy.length === 1 && t2.explicitOrderBy[0].field.isKeyField());
  }
  function Qe(t2) {
    return t2.explicitOrderBy.length > 0 ? t2.explicitOrderBy[0].field : null;
  }
  function je(t2) {
    for (const e of t2.filters)
      if (e.S())
        return e.field;
    return null;
  }
  function We(t2) {
    return t2.collectionGroup !== null;
  }
  function ze(t2) {
    const e = K2(t2);
    if (e.D === null) {
      e.D = [];
      const t3 = je(e), n = Qe(e);
      if (t3 !== null && n === null)
        t3.isKeyField() || e.D.push(new Fe(t3)), e.D.push(new Fe(mt.keyField(), "asc"));
      else {
        let t4 = false;
        for (const n2 of e.explicitOrderBy)
          e.D.push(n2), n2.field.isKeyField() && (t4 = true);
        if (!t4) {
          const t5 = e.explicitOrderBy.length > 0 ? e.explicitOrderBy[e.explicitOrderBy.length - 1].dir : "asc";
          e.D.push(new Fe(mt.keyField(), t5));
        }
      }
    }
    return e.D;
  }
  function He(t2) {
    const e = K2(t2);
    if (!e.C)
      if (e.limitType === "F")
        e.C = pe(e.path, e.collectionGroup, ze(e), e.filters, e.limit, e.startAt, e.endAt);
      else {
        const t3 = [];
        for (const n2 of ze(e)) {
          const e2 = n2.dir === "desc" ? "asc" : "desc";
          t3.push(new Fe(n2.field, e2));
        }
        const n = e.endAt ? new Oe(e.endAt.position, e.endAt.inclusive) : null, s = e.startAt ? new Oe(e.startAt.position, e.startAt.inclusive) : null;
        e.C = pe(e.path, e.collectionGroup, t3, e.filters, e.limit, n, s);
      }
    return e.C;
  }
  function Je(t2, e, n) {
    return new Ue(t2.path, t2.collectionGroup, t2.explicitOrderBy.slice(), t2.filters.slice(), e, n, t2.startAt, t2.endAt);
  }
  function Ye(t2, e) {
    return Ee(He(t2), He(e)) && t2.limitType === e.limitType;
  }
  function Xe(t2) {
    return `${Ie(He(t2))}|lt:${t2.limitType}`;
  }
  function Ze(t2) {
    return `Query(target=${Te(He(t2))}; limitType=${t2.limitType})`;
  }
  function tn(t2, e) {
    return e.isFoundDocument() && function(t3, e2) {
      const n = e2.key.path;
      return t3.collectionGroup !== null ? e2.key.hasCollectionId(t3.collectionGroup) && t3.path.isPrefixOf(n) : xt.isDocumentKey(t3.path) ? t3.path.isEqual(n) : t3.path.isImmediateParentOf(n);
    }(t2, e) && function(t3, e2) {
      for (const n of t3.explicitOrderBy)
        if (!n.field.isKeyField() && e2.data.field(n.field) === null)
          return false;
      return true;
    }(t2, e) && function(t3, e2) {
      for (const n of t3.filters)
        if (!n.matches(e2))
          return false;
      return true;
    }(t2, e) && function(t3, e2) {
      if (t3.startAt && !function(t4, e3, n) {
        const s = Be(t4, e3, n);
        return t4.inclusive ? s <= 0 : s < 0;
      }(t3.startAt, ze(t3), e2))
        return false;
      if (t3.endAt && !function(t4, e3, n) {
        const s = Be(t4, e3, n);
        return t4.inclusive ? s >= 0 : s > 0;
      }(t3.endAt, ze(t3), e2))
        return false;
      return true;
    }(t2, e);
  }
  function en(t2) {
    return t2.collectionGroup || (t2.path.length % 2 == 1 ? t2.path.lastSegment() : t2.path.get(t2.path.length - 2));
  }
  function nn(t2) {
    return (e, n) => {
      let s = false;
      for (const i of ze(t2)) {
        const t3 = sn(i, e, n);
        if (t3 !== 0)
          return t3;
        s = s || i.field.isKeyField();
      }
      return 0;
    };
  }
  function sn(t2, e, n) {
    const s = t2.field.isKeyField() ? xt.comparator(e.key, n.key) : function(t3, e2, n2) {
      const s2 = e2.data.field(t3), i = n2.data.field(t3);
      return s2 !== null && i !== null ? $t(s2, i) : L2();
    }(t2.field, e, n);
    switch (t2.dir) {
      case "asc":
        return s;
      case "desc":
        return -1 * s;
      default:
        return L2();
    }
  }
  function rn(t2, e) {
    if (t2.N) {
      if (isNaN(e))
        return {
          doubleValue: "NaN"
        };
      if (e === 1 / 0)
        return {
          doubleValue: "Infinity"
        };
      if (e === -1 / 0)
        return {
          doubleValue: "-Infinity"
        };
    }
    return {
      doubleValue: Dt(e) ? "-0" : e
    };
  }
  function on(t2) {
    return {
      integerValue: "" + t2
    };
  }
  var an = class {
    constructor() {
      this._ = void 0;
    }
  };
  function cn(t2, e, n) {
    return t2 instanceof fn ? function(t3, e2) {
      const n2 = {
        fields: {
          __type__: {
            stringValue: "server_timestamp"
          },
          __local_write_time__: {
            timestampValue: {
              seconds: t3.seconds,
              nanos: t3.nanoseconds
            }
          }
        }
      };
      return e2 && (n2.fields.__previous_value__ = e2), {
        mapValue: n2
      };
    }(n, e) : t2 instanceof dn ? _n(t2, e) : t2 instanceof wn ? mn(t2, e) : function(t3, e2) {
      const n2 = ln(t3, e2), s = yn(n2) + yn(t3.k);
      return Kt(n2) && Kt(t3.k) ? on(s) : rn(t3.M, s);
    }(t2, e);
  }
  function hn(t2, e, n) {
    return t2 instanceof dn ? _n(t2, e) : t2 instanceof wn ? mn(t2, e) : n;
  }
  function ln(t2, e) {
    return t2 instanceof gn ? Kt(n = e) || function(t3) {
      return !!t3 && "doubleValue" in t3;
    }(n) ? e : {
      integerValue: 0
    } : null;
    var n;
  }
  var fn = class extends an {
  };
  var dn = class extends an {
    constructor(t2) {
      super(), this.elements = t2;
    }
  };
  function _n(t2, e) {
    const n = pn(e);
    for (const e2 of t2.elements)
      n.some((t3) => Ot(t3, e2)) || n.push(e2);
    return {
      arrayValue: {
        values: n
      }
    };
  }
  var wn = class extends an {
    constructor(t2) {
      super(), this.elements = t2;
    }
  };
  function mn(t2, e) {
    let n = pn(e);
    for (const e2 of t2.elements)
      n = n.filter((t3) => !Ot(t3, e2));
    return {
      arrayValue: {
        values: n
      }
    };
  }
  var gn = class extends an {
    constructor(t2, e) {
      super(), this.M = t2, this.k = e;
    }
  };
  function yn(t2) {
    return Et(t2.integerValue || t2.doubleValue);
  }
  function pn(t2) {
    return Gt(t2) && t2.arrayValue.values ? t2.arrayValue.values.slice() : [];
  }
  function Tn(t2, e) {
    return t2.field.isEqual(e.field) && function(t3, e2) {
      return t3 instanceof dn && e2 instanceof dn || t3 instanceof wn && e2 instanceof wn ? ot(t3.elements, e2.elements, Ot) : t3 instanceof gn && e2 instanceof gn ? Ot(t3.k, e2.k) : t3 instanceof fn && e2 instanceof fn;
    }(t2.transform, e.transform);
  }
  function Rn(t2, e) {
    return t2.updateTime !== void 0 ? e.isFoundDocument() && e.version.isEqual(t2.updateTime) : t2.exists === void 0 || t2.exists === e.isFoundDocument();
  }
  var bn = class {
  };
  function Pn(t2, e, n) {
    t2 instanceof Cn ? function(t3, e2, n2) {
      const s = t3.value.clone(), i = kn(t3.fieldTransforms, e2, n2.transformResults);
      s.setAll(i), e2.convertToFoundDocument(n2.version, s).setHasCommittedMutations();
    }(t2, e, n) : t2 instanceof xn ? function(t3, e2, n2) {
      if (!Rn(t3.precondition, e2))
        return void e2.convertToUnknownDocument(n2.version);
      const s = kn(t3.fieldTransforms, e2, n2.transformResults), i = e2.data;
      i.setAll(Nn(t3)), i.setAll(s), e2.convertToFoundDocument(n2.version, i).setHasCommittedMutations();
    }(t2, e, n) : function(t3, e2, n2) {
      e2.convertToNoDocument(n2.version).setHasCommittedMutations();
    }(0, e, n);
  }
  function Vn(t2, e, n) {
    t2 instanceof Cn ? function(t3, e2, n2) {
      if (!Rn(t3.precondition, e2))
        return;
      const s = t3.value.clone(), i = Mn(t3.fieldTransforms, n2, e2);
      s.setAll(i), e2.convertToFoundDocument(Dn(e2), s).setHasLocalMutations();
    }(t2, e, n) : t2 instanceof xn ? function(t3, e2, n2) {
      if (!Rn(t3.precondition, e2))
        return;
      const s = Mn(t3.fieldTransforms, n2, e2), i = e2.data;
      i.setAll(Nn(t3)), i.setAll(s), e2.convertToFoundDocument(Dn(e2), i).setHasLocalMutations();
    }(t2, e, n) : function(t3, e2) {
      Rn(t3.precondition, e2) && e2.convertToNoDocument(ct.min());
    }(t2, e);
  }
  function Sn(t2, e) {
    return t2.type === e.type && (!!t2.key.isEqual(e.key) && (!!t2.precondition.isEqual(e.precondition) && (!!function(t3, e2) {
      return t3 === void 0 && e2 === void 0 || !(!t3 || !e2) && ot(t3, e2, (t4, e3) => Tn(t4, e3));
    }(t2.fieldTransforms, e.fieldTransforms) && (t2.type === 0 ? t2.value.isEqual(e.value) : t2.type !== 1 || t2.data.isEqual(e.data) && t2.fieldMask.isEqual(e.fieldMask)))));
  }
  function Dn(t2) {
    return t2.isFoundDocument() ? t2.version : ct.min();
  }
  var Cn = class extends bn {
    constructor(t2, e, n, s = []) {
      super(), this.key = t2, this.value = e, this.precondition = n, this.fieldTransforms = s, this.type = 0;
    }
  };
  var xn = class extends bn {
    constructor(t2, e, n, s, i = []) {
      super(), this.key = t2, this.data = e, this.fieldMask = n, this.precondition = s, this.fieldTransforms = i, this.type = 1;
    }
  };
  function Nn(t2) {
    const e = /* @__PURE__ */ new Map();
    return t2.fieldMask.fields.forEach((n) => {
      if (!n.isEmpty()) {
        const s = t2.data.field(n);
        e.set(n, s);
      }
    }), e;
  }
  function kn(t2, e, n) {
    const s = /* @__PURE__ */ new Map();
    U2(t2.length === n.length);
    for (let i = 0; i < n.length; i++) {
      const r = t2[i], o = r.transform, u = e.data.field(r.field);
      s.set(r.field, hn(o, u, n[i]));
    }
    return s;
  }
  function Mn(t2, e, n) {
    const s = /* @__PURE__ */ new Map();
    for (const i of t2) {
      const t3 = i.transform, r = n.data.field(i.field);
      s.set(i.field, cn(t3, r, e));
    }
    return s;
  }
  var $n = class {
    constructor(t2) {
      this.count = t2;
    }
  };
  var Bn;
  var Ln;
  function qn(t2) {
    if (t2 === void 0)
      return F2("GRPC error has no .code"), G.UNKNOWN;
    switch (t2) {
      case Bn.OK:
        return G.OK;
      case Bn.CANCELLED:
        return G.CANCELLED;
      case Bn.UNKNOWN:
        return G.UNKNOWN;
      case Bn.DEADLINE_EXCEEDED:
        return G.DEADLINE_EXCEEDED;
      case Bn.RESOURCE_EXHAUSTED:
        return G.RESOURCE_EXHAUSTED;
      case Bn.INTERNAL:
        return G.INTERNAL;
      case Bn.UNAVAILABLE:
        return G.UNAVAILABLE;
      case Bn.UNAUTHENTICATED:
        return G.UNAUTHENTICATED;
      case Bn.INVALID_ARGUMENT:
        return G.INVALID_ARGUMENT;
      case Bn.NOT_FOUND:
        return G.NOT_FOUND;
      case Bn.ALREADY_EXISTS:
        return G.ALREADY_EXISTS;
      case Bn.PERMISSION_DENIED:
        return G.PERMISSION_DENIED;
      case Bn.FAILED_PRECONDITION:
        return G.FAILED_PRECONDITION;
      case Bn.ABORTED:
        return G.ABORTED;
      case Bn.OUT_OF_RANGE:
        return G.OUT_OF_RANGE;
      case Bn.UNIMPLEMENTED:
        return G.UNIMPLEMENTED;
      case Bn.DATA_LOSS:
        return G.DATA_LOSS;
      default:
        return L2();
    }
  }
  (Ln = Bn || (Bn = {}))[Ln.OK = 0] = "OK", Ln[Ln.CANCELLED = 1] = "CANCELLED", Ln[Ln.UNKNOWN = 2] = "UNKNOWN", Ln[Ln.INVALID_ARGUMENT = 3] = "INVALID_ARGUMENT", Ln[Ln.DEADLINE_EXCEEDED = 4] = "DEADLINE_EXCEEDED", Ln[Ln.NOT_FOUND = 5] = "NOT_FOUND", Ln[Ln.ALREADY_EXISTS = 6] = "ALREADY_EXISTS", Ln[Ln.PERMISSION_DENIED = 7] = "PERMISSION_DENIED", Ln[Ln.UNAUTHENTICATED = 16] = "UNAUTHENTICATED", Ln[Ln.RESOURCE_EXHAUSTED = 8] = "RESOURCE_EXHAUSTED", Ln[Ln.FAILED_PRECONDITION = 9] = "FAILED_PRECONDITION", Ln[Ln.ABORTED = 10] = "ABORTED", Ln[Ln.OUT_OF_RANGE = 11] = "OUT_OF_RANGE", Ln[Ln.UNIMPLEMENTED = 12] = "UNIMPLEMENTED", Ln[Ln.INTERNAL = 13] = "INTERNAL", Ln[Ln.UNAVAILABLE = 14] = "UNAVAILABLE", Ln[Ln.DATA_LOSS = 15] = "DATA_LOSS";
  var Kn = class {
    constructor(t2, e) {
      this.mapKeyFn = t2, this.equalsFn = e, this.inner = {}, this.innerSize = 0;
    }
    get(t2) {
      const e = this.mapKeyFn(t2), n = this.inner[e];
      if (n !== void 0) {
        for (const [e2, s] of n)
          if (this.equalsFn(e2, t2))
            return s;
      }
    }
    has(t2) {
      return this.get(t2) !== void 0;
    }
    set(t2, e) {
      const n = this.mapKeyFn(t2), s = this.inner[n];
      if (s === void 0)
        return this.inner[n] = [[t2, e]], void this.innerSize++;
      for (let n2 = 0; n2 < s.length; n2++)
        if (this.equalsFn(s[n2][0], t2))
          return void (s[n2] = [t2, e]);
      s.push([t2, e]), this.innerSize++;
    }
    delete(t2) {
      const e = this.mapKeyFn(t2), n = this.inner[e];
      if (n === void 0)
        return false;
      for (let s = 0; s < n.length; s++)
        if (this.equalsFn(n[s][0], t2))
          return n.length === 1 ? delete this.inner[e] : n.splice(s, 1), this.innerSize--, true;
      return false;
    }
    forEach(t2) {
      lt(this.inner, (e, n) => {
        for (const [e2, s] of n)
          t2(e2, s);
      });
    }
    isEmpty() {
      return ft(this.inner);
    }
    size() {
      return this.innerSize;
    }
  };
  var Gn = new fe(xt.comparator);
  function Qn() {
    return Gn;
  }
  var jn = new fe(xt.comparator);
  function Wn(...t2) {
    let e = jn;
    for (const n of t2)
      e = e.insert(n.key, n);
    return e;
  }
  function zn() {
    return new Kn((t2) => t2.toString(), (t2, e) => t2.isEqual(e));
  }
  var Hn = new fe(xt.comparator);
  var Jn = new we(xt.comparator);
  function Yn(...t2) {
    let e = Jn;
    for (const n of t2)
      e = e.add(n);
    return e;
  }
  var Xn = new we(rt);
  function Zn() {
    return Xn;
  }
  var ts = class {
    constructor(t2, e, n, s, i) {
      this.snapshotVersion = t2, this.targetChanges = e, this.targetMismatches = n, this.documentUpdates = s, this.resolvedLimboDocuments = i;
    }
    static createSynthesizedRemoteEventForCurrentChange(t2, e) {
      const n = /* @__PURE__ */ new Map();
      return n.set(t2, es.createSynthesizedTargetChangeForCurrentChange(t2, e)), new ts(ct.min(), n, Zn(), Qn(), Yn());
    }
  };
  var es = class {
    constructor(t2, e, n, s, i) {
      this.resumeToken = t2, this.current = e, this.addedDocuments = n, this.modifiedDocuments = s, this.removedDocuments = i;
    }
    static createSynthesizedTargetChangeForCurrentChange(t2, e) {
      return new es(pt.EMPTY_BYTE_STRING, e, Yn(), Yn(), Yn());
    }
  };
  var ns = class {
    constructor(t2, e, n, s) {
      this.O = t2, this.removedTargetIds = e, this.key = n, this.F = s;
    }
  };
  var ss = class {
    constructor(t2, e) {
      this.targetId = t2, this.$ = e;
    }
  };
  var is = class {
    constructor(t2, e, n = pt.EMPTY_BYTE_STRING, s = null) {
      this.state = t2, this.targetIds = e, this.resumeToken = n, this.cause = s;
    }
  };
  var rs = class {
    constructor() {
      this.B = 0, this.L = as(), this.U = pt.EMPTY_BYTE_STRING, this.q = false, this.K = true;
    }
    get current() {
      return this.q;
    }
    get resumeToken() {
      return this.U;
    }
    get G() {
      return this.B !== 0;
    }
    get j() {
      return this.K;
    }
    W(t2) {
      t2.approximateByteSize() > 0 && (this.K = true, this.U = t2);
    }
    H() {
      let t2 = Yn(), e = Yn(), n = Yn();
      return this.L.forEach((s, i) => {
        switch (i) {
          case 0:
            t2 = t2.add(s);
            break;
          case 2:
            e = e.add(s);
            break;
          case 1:
            n = n.add(s);
            break;
          default:
            L2();
        }
      }), new es(this.U, this.q, t2, e, n);
    }
    J() {
      this.K = false, this.L = as();
    }
    Y(t2, e) {
      this.K = true, this.L = this.L.insert(t2, e);
    }
    X(t2) {
      this.K = true, this.L = this.L.remove(t2);
    }
    Z() {
      this.B += 1;
    }
    tt() {
      this.B -= 1;
    }
    et() {
      this.K = true, this.q = true;
    }
  };
  var os = class {
    constructor(t2) {
      this.nt = t2, this.st = /* @__PURE__ */ new Map(), this.it = Qn(), this.rt = us(), this.ot = new we(rt);
    }
    ut(t2) {
      for (const e of t2.O)
        t2.F && t2.F.isFoundDocument() ? this.at(e, t2.F) : this.ct(e, t2.key, t2.F);
      for (const e of t2.removedTargetIds)
        this.ct(e, t2.key, t2.F);
    }
    ht(t2) {
      this.forEachTarget(t2, (e) => {
        const n = this.lt(e);
        switch (t2.state) {
          case 0:
            this.ft(e) && n.W(t2.resumeToken);
            break;
          case 1:
            n.tt(), n.G || n.J(), n.W(t2.resumeToken);
            break;
          case 2:
            n.tt(), n.G || this.removeTarget(e);
            break;
          case 3:
            this.ft(e) && (n.et(), n.W(t2.resumeToken));
            break;
          case 4:
            this.ft(e) && (this.dt(e), n.W(t2.resumeToken));
            break;
          default:
            L2();
        }
      });
    }
    forEachTarget(t2, e) {
      t2.targetIds.length > 0 ? t2.targetIds.forEach(e) : this.st.forEach((t3, n) => {
        this.ft(n) && e(n);
      });
    }
    _t(t2) {
      const e = t2.targetId, n = t2.$.count, s = this.wt(e);
      if (s) {
        const t3 = s.target;
        if (Ae(t3))
          if (n === 0) {
            const n2 = new xt(t3.path);
            this.ct(e, n2, ne.newNoDocument(n2, ct.min()));
          } else
            U2(n === 1);
        else {
          this.gt(e) !== n && (this.dt(e), this.ot = this.ot.add(e));
        }
      }
    }
    yt(t2) {
      const e = /* @__PURE__ */ new Map();
      this.st.forEach((n2, s2) => {
        const i = this.wt(s2);
        if (i) {
          if (n2.current && Ae(i.target)) {
            const e2 = new xt(i.target.path);
            this.it.get(e2) !== null || this.It(s2, e2) || this.ct(s2, e2, ne.newNoDocument(e2, t2));
          }
          n2.j && (e.set(s2, n2.H()), n2.J());
        }
      });
      let n = Yn();
      this.rt.forEach((t3, e2) => {
        let s2 = true;
        e2.forEachWhile((t4) => {
          const e3 = this.wt(t4);
          return !e3 || e3.purpose === 2 || (s2 = false, false);
        }), s2 && (n = n.add(t3));
      }), this.it.forEach((e2, n2) => n2.setReadTime(t2));
      const s = new ts(t2, e, this.ot, this.it, n);
      return this.it = Qn(), this.rt = us(), this.ot = new we(rt), s;
    }
    at(t2, e) {
      if (!this.ft(t2))
        return;
      const n = this.It(t2, e.key) ? 2 : 0;
      this.lt(t2).Y(e.key, n), this.it = this.it.insert(e.key, e), this.rt = this.rt.insert(e.key, this.Tt(e.key).add(t2));
    }
    ct(t2, e, n) {
      if (!this.ft(t2))
        return;
      const s = this.lt(t2);
      this.It(t2, e) ? s.Y(e, 1) : s.X(e), this.rt = this.rt.insert(e, this.Tt(e).delete(t2)), n && (this.it = this.it.insert(e, n));
    }
    removeTarget(t2) {
      this.st.delete(t2);
    }
    gt(t2) {
      const e = this.lt(t2).H();
      return this.nt.getRemoteKeysForTarget(t2).size + e.addedDocuments.size - e.removedDocuments.size;
    }
    Z(t2) {
      this.lt(t2).Z();
    }
    lt(t2) {
      let e = this.st.get(t2);
      return e || (e = new rs(), this.st.set(t2, e)), e;
    }
    Tt(t2) {
      let e = this.rt.get(t2);
      return e || (e = new we(rt), this.rt = this.rt.insert(t2, e)), e;
    }
    ft(t2) {
      const e = this.wt(t2) !== null;
      return e || O2("WatchChangeAggregator", "Detected inactive target", t2), e;
    }
    wt(t2) {
      const e = this.st.get(t2);
      return e && e.G ? null : this.nt.Et(t2);
    }
    dt(t2) {
      this.st.set(t2, new rs());
      this.nt.getRemoteKeysForTarget(t2).forEach((e) => {
        this.ct(t2, e, null);
      });
    }
    It(t2, e) {
      return this.nt.getRemoteKeysForTarget(t2).has(e);
    }
  };
  function us() {
    return new fe(xt.comparator);
  }
  function as() {
    return new fe(xt.comparator);
  }
  var cs = (() => {
    const t2 = {
      asc: "ASCENDING",
      desc: "DESCENDING"
    };
    return t2;
  })();
  var hs = (() => {
    const t2 = {
      "<": "LESS_THAN",
      "<=": "LESS_THAN_OR_EQUAL",
      ">": "GREATER_THAN",
      ">=": "GREATER_THAN_OR_EQUAL",
      "==": "EQUAL",
      "!=": "NOT_EQUAL",
      "array-contains": "ARRAY_CONTAINS",
      in: "IN",
      "not-in": "NOT_IN",
      "array-contains-any": "ARRAY_CONTAINS_ANY"
    };
    return t2;
  })();
  var ls = class {
    constructor(t2, e) {
      this.databaseId = t2, this.N = e;
    }
  };
  function fs(t2, e) {
    if (t2.N) {
      return `${new Date(1e3 * e.seconds).toISOString().replace(/\.\d*/, "").replace("Z", "")}.${("000000000" + e.nanoseconds).slice(-9)}Z`;
    }
    return {
      seconds: "" + e.seconds,
      nanos: e.nanoseconds
    };
  }
  function ds(t2, e) {
    return t2.N ? e.toBase64() : e.toUint8Array();
  }
  function ws(t2) {
    return U2(!!t2), ct.fromTimestamp(function(t3) {
      const e = Tt(t3);
      return new at(e.seconds, e.nanos);
    }(t2));
  }
  function ms(t2, e) {
    return function(t3) {
      return new _t(["projects", t3.projectId, "databases", t3.database]);
    }(t2).child("documents").child(e).canonicalString();
  }
  function gs(t2) {
    const e = _t.fromString(t2);
    return U2(Ks(e)), e;
  }
  function ps(t2, e) {
    const n = gs(e);
    if (n.get(1) !== t2.databaseId.projectId)
      throw new Q2(G.INVALID_ARGUMENT, "Tried to deserialize key from different project: " + n.get(1) + " vs " + t2.databaseId.projectId);
    if (n.get(3) !== t2.databaseId.database)
      throw new Q2(G.INVALID_ARGUMENT, "Tried to deserialize key from different database: " + n.get(3) + " vs " + t2.databaseId.database);
    return new xt(As(n));
  }
  function Is(t2, e) {
    return ms(t2.databaseId, e);
  }
  function Ts(t2) {
    const e = gs(t2);
    return e.length === 4 ? _t.emptyPath() : As(e);
  }
  function Es(t2) {
    return new _t(["projects", t2.databaseId.projectId, "databases", t2.databaseId.database]).canonicalString();
  }
  function As(t2) {
    return U2(t2.length > 4 && t2.get(4) === "documents"), t2.popFirst(5);
  }
  function Vs(t2, e) {
    let n;
    if ("targetChange" in e) {
      e.targetChange;
      const s = function(t3) {
        return t3 === "NO_CHANGE" ? 0 : t3 === "ADD" ? 1 : t3 === "REMOVE" ? 2 : t3 === "CURRENT" ? 3 : t3 === "RESET" ? 4 : L2();
      }(e.targetChange.targetChangeType || "NO_CHANGE"), i = e.targetChange.targetIds || [], r = function(t3, e2) {
        return t3.N ? (U2(e2 === void 0 || typeof e2 == "string"), pt.fromBase64String(e2 || "")) : (U2(e2 === void 0 || e2 instanceof Uint8Array), pt.fromUint8Array(e2 || new Uint8Array()));
      }(t2, e.targetChange.resumeToken), o = e.targetChange.cause, u = o && function(t3) {
        const e2 = t3.code === void 0 ? G.UNKNOWN : qn(t3.code);
        return new Q2(e2, t3.message || "");
      }(o);
      n = new is(s, i, r, u || null);
    } else if ("documentChange" in e) {
      e.documentChange;
      const s = e.documentChange;
      s.document, s.document.name, s.document.updateTime;
      const i = ps(t2, s.document.name), r = ws(s.document.updateTime), o = new te({
        mapValue: {
          fields: s.document.fields
        }
      }), u = ne.newFoundDocument(i, r, o), a = s.targetIds || [], c = s.removedTargetIds || [];
      n = new ns(a, c, u.key, u);
    } else if ("documentDelete" in e) {
      e.documentDelete;
      const s = e.documentDelete;
      s.document;
      const i = ps(t2, s.document), r = s.readTime ? ws(s.readTime) : ct.min(), o = ne.newNoDocument(i, r), u = s.removedTargetIds || [];
      n = new ns([], u, o.key, o);
    } else if ("documentRemove" in e) {
      e.documentRemove;
      const s = e.documentRemove;
      s.document;
      const i = ps(t2, s.document), r = s.removedTargetIds || [];
      n = new ns([], r, i, null);
    } else {
      if (!("filter" in e))
        return L2();
      {
        e.filter;
        const t3 = e.filter;
        t3.targetId;
        const s = t3.count || 0, i = new $n(s), r = t3.targetId;
        n = new ss(r, i);
      }
    }
    return n;
  }
  function Cs(t2, e) {
    return {
      documents: [Is(t2, e.path)]
    };
  }
  function xs(t2, e) {
    const n = {
      structuredQuery: {}
    }, s = e.path;
    e.collectionGroup !== null ? (n.parent = Is(t2, s), n.structuredQuery.from = [{
      collectionId: e.collectionGroup,
      allDescendants: true
    }]) : (n.parent = Is(t2, s.popLast()), n.structuredQuery.from = [{
      collectionId: s.lastSegment()
    }]);
    const i = function(t3) {
      if (t3.length === 0)
        return;
      const e2 = t3.map((t4) => function(t5) {
        if (t5.op === "==") {
          if (jt(t5.value))
            return {
              unaryFilter: {
                field: $s(t5.field),
                op: "IS_NAN"
              }
            };
          if (Qt(t5.value))
            return {
              unaryFilter: {
                field: $s(t5.field),
                op: "IS_NULL"
              }
            };
        } else if (t5.op === "!=") {
          if (jt(t5.value))
            return {
              unaryFilter: {
                field: $s(t5.field),
                op: "IS_NOT_NAN"
              }
            };
          if (Qt(t5.value))
            return {
              unaryFilter: {
                field: $s(t5.field),
                op: "IS_NOT_NULL"
              }
            };
        }
        return {
          fieldFilter: {
            field: $s(t5.field),
            op: Fs(t5.op),
            value: t5.value
          }
        };
      }(t4));
      if (e2.length === 1)
        return e2[0];
      return {
        compositeFilter: {
          op: "AND",
          filters: e2
        }
      };
    }(e.filters);
    i && (n.structuredQuery.where = i);
    const r = function(t3) {
      if (t3.length === 0)
        return;
      return t3.map((t4) => function(t5) {
        return {
          field: $s(t5.field),
          direction: Os(t5.dir)
        };
      }(t4));
    }(e.orderBy);
    r && (n.structuredQuery.orderBy = r);
    const o = function(t3, e2) {
      return t3.N || St(e2) ? e2 : {
        value: e2
      };
    }(t2, e.limit);
    var u;
    return o !== null && (n.structuredQuery.limit = o), e.startAt && (n.structuredQuery.startAt = {
      before: (u = e.startAt).inclusive,
      values: u.position
    }), e.endAt && (n.structuredQuery.endAt = function(t3) {
      return {
        before: !t3.inclusive,
        values: t3.position
      };
    }(e.endAt)), n;
  }
  function Ns(t2) {
    let e = Ts(t2.parent);
    const n = t2.structuredQuery, s = n.from ? n.from.length : 0;
    let i = null;
    if (s > 0) {
      U2(s === 1);
      const t3 = n.from[0];
      t3.allDescendants ? i = t3.collectionId : e = e.child(t3.collectionId);
    }
    let r = [];
    n.where && (r = Ms(n.where));
    let o = [];
    n.orderBy && (o = n.orderBy.map((t3) => function(t4) {
      return new Fe(Bs(t4.field), function(t5) {
        switch (t5) {
          case "ASCENDING":
            return "asc";
          case "DESCENDING":
            return "desc";
          default:
            return;
        }
      }(t4.direction));
    }(t3)));
    let u = null;
    n.limit && (u = function(t3) {
      let e2;
      return e2 = typeof t3 == "object" ? t3.value : t3, St(e2) ? null : e2;
    }(n.limit));
    let a = null;
    n.startAt && (a = function(t3) {
      const e2 = !!t3.before, n2 = t3.values || [];
      return new Oe(n2, e2);
    }(n.startAt));
    let c = null;
    return n.endAt && (c = function(t3) {
      const e2 = !t3.before, n2 = t3.values || [];
      return new Oe(n2, e2);
    }(n.endAt)), qe(e, i, o, r, u, "F", a, c);
  }
  function ks(t2, e) {
    const n = function(t3, e2) {
      switch (e2) {
        case 0:
          return null;
        case 1:
          return "existence-filter-mismatch";
        case 2:
          return "limbo-document";
        default:
          return L2();
      }
    }(0, e.purpose);
    return n == null ? null : {
      "goog-listen-tags": n
    };
  }
  function Ms(t2) {
    return t2 ? t2.unaryFilter !== void 0 ? [Us(t2)] : t2.fieldFilter !== void 0 ? [Ls(t2)] : t2.compositeFilter !== void 0 ? t2.compositeFilter.filters.map((t3) => Ms(t3)).reduce((t3, e) => t3.concat(e)) : L2() : [];
  }
  function Os(t2) {
    return cs[t2];
  }
  function Fs(t2) {
    return hs[t2];
  }
  function $s(t2) {
    return {
      fieldPath: t2.canonicalString()
    };
  }
  function Bs(t2) {
    return mt.fromServerFormat(t2.fieldPath);
  }
  function Ls(t2) {
    return Ve.create(Bs(t2.fieldFilter.field), function(t3) {
      switch (t3) {
        case "EQUAL":
          return "==";
        case "NOT_EQUAL":
          return "!=";
        case "GREATER_THAN":
          return ">";
        case "GREATER_THAN_OR_EQUAL":
          return ">=";
        case "LESS_THAN":
          return "<";
        case "LESS_THAN_OR_EQUAL":
          return "<=";
        case "ARRAY_CONTAINS":
          return "array-contains";
        case "IN":
          return "in";
        case "NOT_IN":
          return "not-in";
        case "ARRAY_CONTAINS_ANY":
          return "array-contains-any";
        default:
          return L2();
      }
    }(t2.fieldFilter.op), t2.fieldFilter.value);
  }
  function Us(t2) {
    switch (t2.unaryFilter.op) {
      case "IS_NAN":
        const e = Bs(t2.unaryFilter.field);
        return Ve.create(e, "==", {
          doubleValue: NaN
        });
      case "IS_NULL":
        const n = Bs(t2.unaryFilter.field);
        return Ve.create(n, "==", {
          nullValue: "NULL_VALUE"
        });
      case "IS_NOT_NAN":
        const s = Bs(t2.unaryFilter.field);
        return Ve.create(s, "!=", {
          doubleValue: NaN
        });
      case "IS_NOT_NULL":
        const i = Bs(t2.unaryFilter.field);
        return Ve.create(i, "!=", {
          nullValue: "NULL_VALUE"
        });
      default:
        return L2();
    }
  }
  function Ks(t2) {
    return t2.length >= 4 && t2.get(0) === "projects" && t2.get(2) === "databases";
  }
  var fi = [...[...[...[...["mutationQueues", "mutations", "documentMutations", "remoteDocuments", "targets", "owner", "targetGlobal", "targetDocuments"], "clientMetadata"], "remoteDocumentGlobal"], "collectionParents"], "bundles", "namedQueries"];
  var di = [...fi, "documentOverlays"];
  var _i = ["mutationQueues", "mutations", "documentMutations", "remoteDocumentsV14", "targets", "owner", "targetGlobal", "targetDocuments", "clientMetadata", "remoteDocumentGlobal", "collectionParents", "bundles", "namedQueries", "documentOverlays"];
  var wi = [..._i, "indexConfiguration", "indexState", "indexEntries"];
  var mi = "The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";
  var gi = class {
    constructor() {
      this.onCommittedListeners = [];
    }
    addOnCommittedListener(t2) {
      this.onCommittedListeners.push(t2);
    }
    raiseOnCommittedEvent() {
      this.onCommittedListeners.forEach((t2) => t2());
    }
  };
  var yi = class {
    constructor(t2) {
      this.nextCallback = null, this.catchCallback = null, this.result = void 0, this.error = void 0, this.isDone = false, this.callbackAttached = false, t2((t3) => {
        this.isDone = true, this.result = t3, this.nextCallback && this.nextCallback(t3);
      }, (t3) => {
        this.isDone = true, this.error = t3, this.catchCallback && this.catchCallback(t3);
      });
    }
    catch(t2) {
      return this.next(void 0, t2);
    }
    next(t2, e) {
      return this.callbackAttached && L2(), this.callbackAttached = true, this.isDone ? this.error ? this.wrapFailure(e, this.error) : this.wrapSuccess(t2, this.result) : new yi((n, s) => {
        this.nextCallback = (e2) => {
          this.wrapSuccess(t2, e2).next(n, s);
        }, this.catchCallback = (t3) => {
          this.wrapFailure(e, t3).next(n, s);
        };
      });
    }
    toPromise() {
      return new Promise((t2, e) => {
        this.next(t2, e);
      });
    }
    wrapUserFunction(t2) {
      try {
        const e = t2();
        return e instanceof yi ? e : yi.resolve(e);
      } catch (t3) {
        return yi.reject(t3);
      }
    }
    wrapSuccess(t2, e) {
      return t2 ? this.wrapUserFunction(() => t2(e)) : yi.resolve(e);
    }
    wrapFailure(t2, e) {
      return t2 ? this.wrapUserFunction(() => t2(e)) : yi.reject(e);
    }
    static resolve(t2) {
      return new yi((e, n) => {
        e(t2);
      });
    }
    static reject(t2) {
      return new yi((e, n) => {
        n(t2);
      });
    }
    static waitFor(t2) {
      return new yi((e, n) => {
        let s = 0, i = 0, r = false;
        t2.forEach((t3) => {
          ++s, t3.next(() => {
            ++i, r && i === s && e();
          }, (t4) => n(t4));
        }), r = true, i === s && e();
      });
    }
    static or(t2) {
      let e = yi.resolve(false);
      for (const n of t2)
        e = e.next((t3) => t3 ? yi.resolve(t3) : n());
      return e;
    }
    static forEach(t2, e) {
      const n = [];
      return t2.forEach((t3, s) => {
        n.push(e.call(this, t3, s));
      }), this.waitFor(n);
    }
  };
  function Ai(t2) {
    return t2.name === "IndexedDbTransactionError";
  }
  var Di = class {
    constructor(t2, e, n, s) {
      this.batchId = t2, this.localWriteTime = e, this.baseMutations = n, this.mutations = s;
    }
    applyToRemoteDocument(t2, e) {
      const n = e.mutationResults;
      for (let e2 = 0; e2 < this.mutations.length; e2++) {
        const s = this.mutations[e2];
        if (s.key.isEqual(t2.key)) {
          Pn(s, t2, n[e2]);
        }
      }
    }
    applyToLocalView(t2) {
      for (const e of this.baseMutations)
        e.key.isEqual(t2.key) && Vn(e, t2, this.localWriteTime);
      for (const e of this.mutations)
        e.key.isEqual(t2.key) && Vn(e, t2, this.localWriteTime);
    }
    applyToLocalDocumentSet(t2) {
      this.mutations.forEach((e) => {
        const n = t2.get(e.key), s = n;
        this.applyToLocalView(s), n.isValidDocument() || s.convertToNoDocument(ct.min());
      });
    }
    keys() {
      return this.mutations.reduce((t2, e) => t2.add(e.key), Yn());
    }
    isEqual(t2) {
      return this.batchId === t2.batchId && ot(this.mutations, t2.mutations, (t3, e) => Sn(t3, e)) && ot(this.baseMutations, t2.baseMutations, (t3, e) => Sn(t3, e));
    }
  };
  var xi = class {
    constructor(t2, e) {
      this.largestBatchId = t2, this.mutation = e;
    }
    getKey() {
      return this.mutation.key;
    }
    isEqual(t2) {
      return t2 !== null && this.mutation === t2.mutation;
    }
    toString() {
      return `Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`;
    }
  };
  var Ni = class {
    constructor(t2, e, n, s, i = ct.min(), r = ct.min(), o = pt.EMPTY_BYTE_STRING) {
      this.target = t2, this.targetId = e, this.purpose = n, this.sequenceNumber = s, this.snapshotVersion = i, this.lastLimboFreeSnapshotVersion = r, this.resumeToken = o;
    }
    withSequenceNumber(t2) {
      return new Ni(this.target, this.targetId, this.purpose, t2, this.snapshotVersion, this.lastLimboFreeSnapshotVersion, this.resumeToken);
    }
    withResumeToken(t2, e) {
      return new Ni(this.target, this.targetId, this.purpose, this.sequenceNumber, e, this.lastLimboFreeSnapshotVersion, t2);
    }
    withLastLimboFreeSnapshotVersion(t2) {
      return new Ni(this.target, this.targetId, this.purpose, this.sequenceNumber, this.snapshotVersion, t2, this.resumeToken);
    }
  };
  var ki = class {
    constructor(t2) {
      this.Jt = t2;
    }
  };
  function Ki(t2) {
    const e = Ns({
      parent: t2.parent,
      structuredQuery: t2.structuredQuery
    });
    return t2.limitType === "LAST" ? Je(e, e.limit, "L") : e;
  }
  var Yi = class {
    constructor() {
    }
    Zt(t2, e) {
      this.te(t2, e), e.ee();
    }
    te(t2, e) {
      if ("nullValue" in t2)
        this.ne(e, 5);
      else if ("booleanValue" in t2)
        this.ne(e, 10), e.se(t2.booleanValue ? 1 : 0);
      else if ("integerValue" in t2)
        this.ne(e, 15), e.se(Et(t2.integerValue));
      else if ("doubleValue" in t2) {
        const n = Et(t2.doubleValue);
        isNaN(n) ? this.ne(e, 13) : (this.ne(e, 15), Dt(n) ? e.se(0) : e.se(n));
      } else if ("timestampValue" in t2) {
        const n = t2.timestampValue;
        this.ne(e, 20), typeof n == "string" ? e.ie(n) : (e.ie(`${n.seconds || ""}`), e.se(n.nanos || 0));
      } else if ("stringValue" in t2)
        this.re(t2.stringValue, e), this.oe(e);
      else if ("bytesValue" in t2)
        this.ne(e, 30), e.ue(At(t2.bytesValue)), this.oe(e);
      else if ("referenceValue" in t2)
        this.ae(t2.referenceValue, e);
      else if ("geoPointValue" in t2) {
        const n = t2.geoPointValue;
        this.ne(e, 45), e.se(n.latitude || 0), e.se(n.longitude || 0);
      } else
        "mapValue" in t2 ? Ht(t2) ? this.ne(e, Number.MAX_SAFE_INTEGER) : (this.ce(t2.mapValue, e), this.oe(e)) : "arrayValue" in t2 ? (this.he(t2.arrayValue, e), this.oe(e)) : L2();
    }
    re(t2, e) {
      this.ne(e, 25), this.le(t2, e);
    }
    le(t2, e) {
      e.ie(t2);
    }
    ce(t2, e) {
      const n = t2.fields || {};
      this.ne(e, 55);
      for (const t3 of Object.keys(n))
        this.re(t3, e), this.te(n[t3], e);
    }
    he(t2, e) {
      const n = t2.values || [];
      this.ne(e, 50);
      for (const t3 of n)
        this.te(t3, e);
    }
    ae(t2, e) {
      this.ne(e, 37);
      xt.fromName(t2).path.forEach((t3) => {
        this.ne(e, 60), this.le(t3, e);
      });
    }
    ne(t2, e) {
      t2.se(e);
    }
    oe(t2) {
      t2.se(2);
    }
  };
  Yi.fe = new Yi();
  var ar = class {
    constructor() {
      this.qe = new cr();
    }
    addToCollectionParentIndex(t2, e) {
      return this.qe.add(e), yi.resolve();
    }
    getCollectionParents(t2, e) {
      return yi.resolve(this.qe.getEntries(e));
    }
    addFieldIndex(t2, e) {
      return yi.resolve();
    }
    deleteFieldIndex(t2, e) {
      return yi.resolve();
    }
    getDocumentsMatchingTarget(t2, e) {
      return yi.resolve(null);
    }
    getIndexType(t2, e) {
      return yi.resolve(0);
    }
    getFieldIndexes(t2, e) {
      return yi.resolve([]);
    }
    getNextCollectionGroupToUpdate(t2) {
      return yi.resolve(null);
    }
    getMinOffset(t2, e) {
      return yi.resolve(he.min());
    }
    updateCollectionGroup(t2, e, n) {
      return yi.resolve();
    }
    updateIndexEntries(t2, e) {
      return yi.resolve();
    }
  };
  var cr = class {
    constructor() {
      this.index = {};
    }
    add(t2) {
      const e = t2.lastSegment(), n = t2.popLast(), s = this.index[e] || new we(_t.comparator), i = !s.has(n);
      return this.index[e] = s.add(n), i;
    }
    has(t2) {
      const e = t2.lastSegment(), n = t2.popLast(), s = this.index[e];
      return s && s.has(n);
    }
    getEntries(t2) {
      return (this.index[t2] || new we(_t.comparator)).toArray();
    }
  };
  var hr = new Uint8Array(0);
  var gr = class {
    constructor(t2, e, n) {
      this.cacheSizeCollectionThreshold = t2, this.percentileToCollect = e, this.maximumSequenceNumbersToCollect = n;
    }
    static withCacheSize(t2) {
      return new gr(t2, gr.DEFAULT_COLLECTION_PERCENTILE, gr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT);
    }
  };
  gr.DEFAULT_COLLECTION_PERCENTILE = 10, gr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT = 1e3, gr.DEFAULT = new gr(41943040, gr.DEFAULT_COLLECTION_PERCENTILE, gr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT), gr.DISABLED = new gr(-1, 0, 0);
  var br = class {
    constructor(t2) {
      this.mn = t2;
    }
    next() {
      return this.mn += 2, this.mn;
    }
    static gn() {
      return new br(0);
    }
    static yn() {
      return new br(-1);
    }
  };
  async function Dr(t2) {
    if (t2.code !== G.FAILED_PRECONDITION || t2.message !== mi)
      throw t2;
    O2("LocalStore", "Unexpectedly lost primary lease");
  }
  var Fr = class {
    constructor() {
      this.changes = new Kn((t2) => t2.toString(), (t2, e) => t2.isEqual(e)), this.changesApplied = false;
    }
    addEntry(t2) {
      this.assertNotApplied(), this.changes.set(t2.key, t2);
    }
    removeEntry(t2, e) {
      this.assertNotApplied(), this.changes.set(t2, ne.newInvalidDocument(t2).setReadTime(e));
    }
    getEntry(t2, e) {
      this.assertNotApplied();
      const n = this.changes.get(e);
      return n !== void 0 ? yi.resolve(n) : this.getFromCache(t2, e);
    }
    getEntries(t2, e) {
      return this.getAllFromCache(t2, e);
    }
    apply(t2) {
      return this.assertNotApplied(), this.changesApplied = true, this.applyChanges(t2);
    }
    assertNotApplied() {
    }
  };
  var Xr = class {
    constructor(t2, e, n) {
      this.ds = t2, this.Bs = e, this.indexManager = n;
    }
    Ls(t2, e) {
      return this.Bs.getAllMutationBatchesAffectingDocumentKey(t2, e).next((n) => this.Us(t2, e, n));
    }
    Us(t2, e, n) {
      return this.ds.getEntry(t2, e).next((t3) => {
        for (const e2 of n)
          e2.applyToLocalView(t3);
        return t3;
      });
    }
    qs(t2, e) {
      t2.forEach((t3, n) => {
        for (const t4 of e)
          t4.applyToLocalView(n);
      });
    }
    Ks(t2, e) {
      return this.ds.getEntries(t2, e).next((e2) => this.Gs(t2, e2).next(() => e2));
    }
    Gs(t2, e) {
      return this.Bs.getAllMutationBatchesAffectingDocumentKeys(t2, e).next((t3) => this.qs(e, t3));
    }
    Qs(t2, e, n) {
      return function(t3) {
        return xt.isDocumentKey(t3.path) && t3.collectionGroup === null && t3.filters.length === 0;
      }(e) ? this.js(t2, e.path) : We(e) ? this.Ws(t2, e, n) : this.zs(t2, e, n);
    }
    js(t2, e) {
      return this.Ls(t2, new xt(e)).next((t3) => {
        let e2 = Wn();
        return t3.isFoundDocument() && (e2 = e2.insert(t3.key, t3)), e2;
      });
    }
    Ws(t2, e, n) {
      const s = e.collectionGroup;
      let i = Wn();
      return this.indexManager.getCollectionParents(t2, s).next((r) => yi.forEach(r, (r2) => {
        const o = function(t3, e2) {
          return new Ue(e2, null, t3.explicitOrderBy.slice(), t3.filters.slice(), t3.limit, t3.limitType, t3.startAt, t3.endAt);
        }(e, r2.child(s));
        return this.zs(t2, o, n).next((t3) => {
          t3.forEach((t4, e2) => {
            i = i.insert(t4, e2);
          });
        });
      }).next(() => i));
    }
    zs(t2, e, n) {
      let s;
      return this.ds.getAllFromCollection(t2, e.path, n).next((n2) => (s = n2, this.Bs.getAllMutationBatchesAffectingQuery(t2, e))).next((t3) => {
        for (const e2 of t3)
          for (const t4 of e2.mutations) {
            const n2 = t4.key;
            let i = s.get(n2);
            i == null && (i = ne.newInvalidDocument(n2), s = s.insert(n2, i)), Vn(t4, i, e2.localWriteTime), i.isFoundDocument() || (s = s.remove(n2));
          }
      }).next(() => (s.forEach((t3, n2) => {
        tn(e, n2) || (s = s.remove(t3));
      }), s));
    }
  };
  var Zr = class {
    constructor(t2, e, n, s) {
      this.targetId = t2, this.fromCache = e, this.Hs = n, this.Js = s;
    }
    static Ys(t2, e) {
      let n = Yn(), s = Yn();
      for (const t3 of e.docChanges)
        switch (t3.type) {
          case 0:
            n = n.add(t3.doc.key);
            break;
          case 1:
            s = s.add(t3.doc.key);
        }
      return new Zr(t2, e.fromCache, n, s);
    }
  };
  var to = class {
    constructor() {
      this.Xs = false;
    }
    initialize(t2, e) {
      this.Zs = t2, this.indexManager = e, this.Xs = true;
    }
    Qs(t2, e, n, s) {
      return this.ti(t2, e).next((i) => i || this.ei(t2, e, s, n)).next((n2) => n2 || this.ni(t2, e));
    }
    ti(t2, e) {
      return yi.resolve(null);
    }
    ei(t2, e, n, s) {
      return Ge(e) || s.isEqual(ct.min()) ? this.ni(t2, e) : this.Zs.Ks(t2, n).next((i) => {
        const r = this.si(e, i);
        return this.ii(e, r, n, s) ? this.ni(t2, e) : (k2() <= LogLevel.DEBUG && O2("QueryEngine", "Re-using previous result from %s to execute query: %s", s.toString(), Ze(e)), this.ri(t2, r, e, ae(s, -1)));
      });
    }
    si(t2, e) {
      let n = new we(nn(t2));
      return e.forEach((e2, s) => {
        tn(t2, s) && (n = n.add(s));
      }), n;
    }
    ii(t2, e, n, s) {
      if (t2.limit === null)
        return false;
      if (n.size !== e.size)
        return true;
      const i = t2.limitType === "F" ? e.last() : e.first();
      return !!i && (i.hasPendingWrites || i.version.compareTo(s) > 0);
    }
    ni(t2, e) {
      return k2() <= LogLevel.DEBUG && O2("QueryEngine", "Using full collection scan to execute query:", Ze(e)), this.Zs.Qs(t2, e, he.min());
    }
    ri(t2, e, n, s) {
      return this.Zs.Qs(t2, n, s).next((t3) => (e.forEach((e2) => {
        t3 = t3.insert(e2.key, e2);
      }), t3));
    }
  };
  var eo = class {
    constructor(t2, e, n, s) {
      this.persistence = t2, this.oi = e, this.M = s, this.ui = new fe(rt), this.ai = new Kn((t3) => Ie(t3), Ee), this.ci = /* @__PURE__ */ new Map(), this.hi = t2.getRemoteDocumentCache(), this.fs = t2.getTargetCache(), this._s = t2.getBundleCache(), this.li(n);
    }
    li(t2) {
      this.indexManager = this.persistence.getIndexManager(t2), this.Bs = this.persistence.getMutationQueue(t2, this.indexManager), this.fi = new Xr(this.hi, this.Bs, this.indexManager), this.hi.setIndexManager(this.indexManager), this.oi.initialize(this.fi, this.indexManager);
    }
    collectGarbage(t2) {
      return this.persistence.runTransaction("Collect garbage", "readwrite-primary", (e) => t2.collect(e, this.ui));
    }
  };
  function no(t2, e, n, s) {
    return new eo(t2, e, n, s);
  }
  async function so(t2, e) {
    const n = K2(t2);
    return await n.persistence.runTransaction("Handle user change", "readonly", (t3) => {
      let s;
      return n.Bs.getAllMutationBatches(t3).next((i) => (s = i, n.li(e), n.Bs.getAllMutationBatches(t3))).next((e2) => {
        const i = [], r = [];
        let o = Yn();
        for (const t4 of s) {
          i.push(t4.batchId);
          for (const e3 of t4.mutations)
            o = o.add(e3.key);
        }
        for (const t4 of e2) {
          r.push(t4.batchId);
          for (const e3 of t4.mutations)
            o = o.add(e3.key);
        }
        return n.fi.Ks(t3, o).next((t4) => ({
          di: t4,
          removedBatchIds: i,
          addedBatchIds: r
        }));
      });
    });
  }
  function ro(t2) {
    const e = K2(t2);
    return e.persistence.runTransaction("Get last remote snapshot version", "readonly", (t3) => e.fs.getLastRemoteSnapshotVersion(t3));
  }
  function oo(t2, e) {
    const n = K2(t2), s = e.snapshotVersion;
    let i = n.ui;
    return n.persistence.runTransaction("Apply remote event", "readwrite-primary", (t3) => {
      const r = n.hi.newChangeBuffer({
        trackRemovals: true
      });
      i = n.ui;
      const o = [];
      e.targetChanges.forEach((r2, u2) => {
        const a = i.get(u2);
        if (!a)
          return;
        o.push(n.fs.removeMatchingKeys(t3, r2.removedDocuments, u2).next(() => n.fs.addMatchingKeys(t3, r2.addedDocuments, u2)));
        let c = a.withSequenceNumber(t3.currentSequenceNumber);
        e.targetMismatches.has(u2) ? c = c.withResumeToken(pt.EMPTY_BYTE_STRING, ct.min()).withLastLimboFreeSnapshotVersion(ct.min()) : r2.resumeToken.approximateByteSize() > 0 && (c = c.withResumeToken(r2.resumeToken, s)), i = i.insert(u2, c), function(t4, e2, n2) {
          if (t4.resumeToken.approximateByteSize() === 0)
            return true;
          if (e2.snapshotVersion.toMicroseconds() - t4.snapshotVersion.toMicroseconds() >= 3e8)
            return true;
          return n2.addedDocuments.size + n2.modifiedDocuments.size + n2.removedDocuments.size > 0;
        }(a, c, r2) && o.push(n.fs.updateTargetData(t3, c));
      });
      let u = Qn();
      if (e.documentUpdates.forEach((s2) => {
        e.resolvedLimboDocuments.has(s2) && o.push(n.persistence.referenceDelegate.updateLimboDocument(t3, s2));
      }), o.push(uo(t3, r, e.documentUpdates).next((t4) => {
        u = t4;
      })), !s.isEqual(ct.min())) {
        const e2 = n.fs.getLastRemoteSnapshotVersion(t3).next((e3) => n.fs.setTargetsMetadata(t3, t3.currentSequenceNumber, s));
        o.push(e2);
      }
      return yi.waitFor(o).next(() => r.apply(t3)).next(() => n.fi.Gs(t3, u)).next(() => u);
    }).then((t3) => (n.ui = i, t3));
  }
  function uo(t2, e, n) {
    let s = Yn();
    return n.forEach((t3) => s = s.add(t3)), e.getEntries(t2, s).next((t3) => {
      let s2 = Qn();
      return n.forEach((n2, i) => {
        const r = t3.get(n2);
        i.isNoDocument() && i.version.isEqual(ct.min()) ? (e.removeEntry(n2, i.readTime), s2 = s2.insert(n2, i)) : !r.isValidDocument() || i.version.compareTo(r.version) > 0 || i.version.compareTo(r.version) === 0 && r.hasPendingWrites ? (e.addEntry(i), s2 = s2.insert(n2, i)) : O2("LocalStore", "Ignoring outdated watch update for ", n2, ". Current version:", r.version, " Watch version:", i.version);
      }), s2;
    });
  }
  function co(t2, e) {
    const n = K2(t2);
    return n.persistence.runTransaction("Allocate target", "readwrite", (t3) => {
      let s;
      return n.fs.getTargetData(t3, e).next((i) => i ? (s = i, yi.resolve(s)) : n.fs.allocateTargetId(t3).next((i2) => (s = new Ni(e, i2, 0, t3.currentSequenceNumber), n.fs.addTargetData(t3, s).next(() => s))));
    }).then((t3) => {
      const s = n.ui.get(t3.targetId);
      return (s === null || t3.snapshotVersion.compareTo(s.snapshotVersion) > 0) && (n.ui = n.ui.insert(t3.targetId, t3), n.ai.set(e, t3.targetId)), t3;
    });
  }
  async function ho(t2, e, n) {
    const s = K2(t2), i = s.ui.get(e), r = n ? "readwrite" : "readwrite-primary";
    try {
      n || await s.persistence.runTransaction("Release target", r, (t3) => s.persistence.referenceDelegate.removeTarget(t3, i));
    } catch (t3) {
      if (!Ai(t3))
        throw t3;
      O2("LocalStore", `Failed to update sequence numbers for target ${e}: ${t3}`);
    }
    s.ui = s.ui.remove(e), s.ai.delete(i.target);
  }
  function lo(t2, e, n) {
    const s = K2(t2);
    let i = ct.min(), r = Yn();
    return s.persistence.runTransaction("Execute query", "readonly", (t3) => function(t4, e2, n2) {
      const s2 = K2(t4), i2 = s2.ai.get(n2);
      return i2 !== void 0 ? yi.resolve(s2.ui.get(i2)) : s2.fs.getTargetData(e2, n2);
    }(s, t3, He(e)).next((e2) => {
      if (e2)
        return i = e2.lastLimboFreeSnapshotVersion, s.fs.getMatchingKeysForTargetId(t3, e2.targetId).next((t4) => {
          r = t4;
        });
    }).next(() => s.oi.Qs(t3, e, n ? i : ct.min(), n ? r : Yn())).next((t4) => (wo(s, en(e), t4), {
      documents: t4,
      _i: r
    })));
  }
  function wo(t2, e, n) {
    let s = ct.min();
    n.forEach((t3, e2) => {
      e2.readTime.compareTo(s) > 0 && (s = e2.readTime);
    }), t2.ci.set(e, s);
  }
  var yo = class {
    constructor(t2) {
      this.M = t2, this.yi = /* @__PURE__ */ new Map(), this.pi = /* @__PURE__ */ new Map();
    }
    getBundleMetadata(t2, e) {
      return yi.resolve(this.yi.get(e));
    }
    saveBundleMetadata(t2, e) {
      var n;
      return this.yi.set(e.id, {
        id: (n = e).id,
        version: n.version,
        createTime: ws(n.createTime)
      }), yi.resolve();
    }
    getNamedQuery(t2, e) {
      return yi.resolve(this.pi.get(e));
    }
    saveNamedQuery(t2, e) {
      return this.pi.set(e.name, function(t3) {
        return {
          name: t3.name,
          query: Ki(t3.bundledQuery),
          readTime: ws(t3.readTime)
        };
      }(e)), yi.resolve();
    }
  };
  var po = class {
    constructor() {
      this.overlays = new fe(xt.comparator), this.Ii = /* @__PURE__ */ new Map();
    }
    getOverlay(t2, e) {
      return yi.resolve(this.overlays.get(e));
    }
    saveOverlays(t2, e, n) {
      return n.forEach((n2, s) => {
        this.Xt(t2, e, s);
      }), yi.resolve();
    }
    removeOverlaysForBatchId(t2, e, n) {
      const s = this.Ii.get(n);
      return s !== void 0 && (s.forEach((t3) => this.overlays = this.overlays.remove(t3)), this.Ii.delete(n)), yi.resolve();
    }
    getOverlaysForCollection(t2, e, n) {
      const s = zn(), i = e.length + 1, r = new xt(e.child("")), o = this.overlays.getIteratorFrom(r);
      for (; o.hasNext(); ) {
        const t3 = o.getNext().value, r2 = t3.getKey();
        if (!e.isPrefixOf(r2.path))
          break;
        r2.path.length === i && (t3.largestBatchId > n && s.set(t3.getKey(), t3));
      }
      return yi.resolve(s);
    }
    getOverlaysForCollectionGroup(t2, e, n, s) {
      let i = new fe((t3, e2) => t3 - e2);
      const r = this.overlays.getIterator();
      for (; r.hasNext(); ) {
        const t3 = r.getNext().value;
        if (t3.getKey().getCollectionGroup() === e && t3.largestBatchId > n) {
          let e2 = i.get(t3.largestBatchId);
          e2 === null && (e2 = zn(), i = i.insert(t3.largestBatchId, e2)), e2.set(t3.getKey(), t3);
        }
      }
      const o = zn(), u = i.getIterator();
      for (; u.hasNext(); ) {
        if (u.getNext().value.forEach((t3, e2) => o.set(t3, e2)), o.size() >= s)
          break;
      }
      return yi.resolve(o);
    }
    Xt(t2, e, n) {
      if (n === null)
        return;
      const s = this.overlays.get(n.key);
      if (s !== null) {
        const t3 = this.Ii.get(s.largestBatchId).delete(n.key);
        this.Ii.set(s.largestBatchId, t3);
      }
      this.overlays = this.overlays.insert(n.key, new xi(e, n));
      let i = this.Ii.get(e);
      i === void 0 && (i = Yn(), this.Ii.set(e, i)), this.Ii.set(e, i.add(n.key));
    }
  };
  var Io = class {
    constructor() {
      this.Ti = new we(To.Ei), this.Ai = new we(To.Ri);
    }
    isEmpty() {
      return this.Ti.isEmpty();
    }
    addReference(t2, e) {
      const n = new To(t2, e);
      this.Ti = this.Ti.add(n), this.Ai = this.Ai.add(n);
    }
    bi(t2, e) {
      t2.forEach((t3) => this.addReference(t3, e));
    }
    removeReference(t2, e) {
      this.Pi(new To(t2, e));
    }
    Vi(t2, e) {
      t2.forEach((t3) => this.removeReference(t3, e));
    }
    vi(t2) {
      const e = new xt(new _t([])), n = new To(e, t2), s = new To(e, t2 + 1), i = [];
      return this.Ai.forEachInRange([n, s], (t3) => {
        this.Pi(t3), i.push(t3.key);
      }), i;
    }
    Si() {
      this.Ti.forEach((t2) => this.Pi(t2));
    }
    Pi(t2) {
      this.Ti = this.Ti.delete(t2), this.Ai = this.Ai.delete(t2);
    }
    Di(t2) {
      const e = new xt(new _t([])), n = new To(e, t2), s = new To(e, t2 + 1);
      let i = Yn();
      return this.Ai.forEachInRange([n, s], (t3) => {
        i = i.add(t3.key);
      }), i;
    }
    containsKey(t2) {
      const e = new To(t2, 0), n = this.Ti.firstAfterOrEqual(e);
      return n !== null && t2.isEqual(n.key);
    }
  };
  var To = class {
    constructor(t2, e) {
      this.key = t2, this.Ci = e;
    }
    static Ei(t2, e) {
      return xt.comparator(t2.key, e.key) || rt(t2.Ci, e.Ci);
    }
    static Ri(t2, e) {
      return rt(t2.Ci, e.Ci) || xt.comparator(t2.key, e.key);
    }
  };
  var Eo = class {
    constructor(t2, e) {
      this.indexManager = t2, this.referenceDelegate = e, this.Bs = [], this.xi = 1, this.Ni = new we(To.Ei);
    }
    checkEmpty(t2) {
      return yi.resolve(this.Bs.length === 0);
    }
    addMutationBatch(t2, e, n, s) {
      const i = this.xi;
      this.xi++, this.Bs.length > 0 && this.Bs[this.Bs.length - 1];
      const r = new Di(i, e, n, s);
      this.Bs.push(r);
      for (const e2 of s)
        this.Ni = this.Ni.add(new To(e2.key, i)), this.indexManager.addToCollectionParentIndex(t2, e2.key.path.popLast());
      return yi.resolve(r);
    }
    lookupMutationBatch(t2, e) {
      return yi.resolve(this.ki(e));
    }
    getNextMutationBatchAfterBatchId(t2, e) {
      const n = e + 1, s = this.Mi(n), i = s < 0 ? 0 : s;
      return yi.resolve(this.Bs.length > i ? this.Bs[i] : null);
    }
    getHighestUnacknowledgedBatchId() {
      return yi.resolve(this.Bs.length === 0 ? -1 : this.xi - 1);
    }
    getAllMutationBatches(t2) {
      return yi.resolve(this.Bs.slice());
    }
    getAllMutationBatchesAffectingDocumentKey(t2, e) {
      const n = new To(e, 0), s = new To(e, Number.POSITIVE_INFINITY), i = [];
      return this.Ni.forEachInRange([n, s], (t3) => {
        const e2 = this.ki(t3.Ci);
        i.push(e2);
      }), yi.resolve(i);
    }
    getAllMutationBatchesAffectingDocumentKeys(t2, e) {
      let n = new we(rt);
      return e.forEach((t3) => {
        const e2 = new To(t3, 0), s = new To(t3, Number.POSITIVE_INFINITY);
        this.Ni.forEachInRange([e2, s], (t4) => {
          n = n.add(t4.Ci);
        });
      }), yi.resolve(this.Oi(n));
    }
    getAllMutationBatchesAffectingQuery(t2, e) {
      const n = e.path, s = n.length + 1;
      let i = n;
      xt.isDocumentKey(i) || (i = i.child(""));
      const r = new To(new xt(i), 0);
      let o = new we(rt);
      return this.Ni.forEachWhile((t3) => {
        const e2 = t3.key.path;
        return !!n.isPrefixOf(e2) && (e2.length === s && (o = o.add(t3.Ci)), true);
      }, r), yi.resolve(this.Oi(o));
    }
    Oi(t2) {
      const e = [];
      return t2.forEach((t3) => {
        const n = this.ki(t3);
        n !== null && e.push(n);
      }), e;
    }
    removeMutationBatch(t2, e) {
      U2(this.Fi(e.batchId, "removed") === 0), this.Bs.shift();
      let n = this.Ni;
      return yi.forEach(e.mutations, (s) => {
        const i = new To(s.key, e.batchId);
        return n = n.delete(i), this.referenceDelegate.markPotentiallyOrphaned(t2, s.key);
      }).next(() => {
        this.Ni = n;
      });
    }
    _n(t2) {
    }
    containsKey(t2, e) {
      const n = new To(e, 0), s = this.Ni.firstAfterOrEqual(n);
      return yi.resolve(e.isEqual(s && s.key));
    }
    performConsistencyCheck(t2) {
      return this.Bs.length, yi.resolve();
    }
    Fi(t2, e) {
      return this.Mi(t2);
    }
    Mi(t2) {
      if (this.Bs.length === 0)
        return 0;
      return t2 - this.Bs[0].batchId;
    }
    ki(t2) {
      const e = this.Mi(t2);
      if (e < 0 || e >= this.Bs.length)
        return null;
      return this.Bs[e];
    }
  };
  var Ao = class {
    constructor(t2) {
      this.$i = t2, this.docs = new fe(xt.comparator), this.size = 0;
    }
    setIndexManager(t2) {
      this.indexManager = t2;
    }
    addEntry(t2, e) {
      const n = e.key, s = this.docs.get(n), i = s ? s.size : 0, r = this.$i(e);
      return this.docs = this.docs.insert(n, {
        document: e.mutableCopy(),
        size: r
      }), this.size += r - i, this.indexManager.addToCollectionParentIndex(t2, n.path.popLast());
    }
    removeEntry(t2) {
      const e = this.docs.get(t2);
      e && (this.docs = this.docs.remove(t2), this.size -= e.size);
    }
    getEntry(t2, e) {
      const n = this.docs.get(e);
      return yi.resolve(n ? n.document.mutableCopy() : ne.newInvalidDocument(e));
    }
    getEntries(t2, e) {
      let n = Qn();
      return e.forEach((t3) => {
        const e2 = this.docs.get(t3);
        n = n.insert(t3, e2 ? e2.document.mutableCopy() : ne.newInvalidDocument(t3));
      }), yi.resolve(n);
    }
    getAllFromCollection(t2, e, n) {
      let s = Qn();
      const i = new xt(e.child("")), r = this.docs.getIteratorFrom(i);
      for (; r.hasNext(); ) {
        const { key: t3, value: { document: i2 } } = r.getNext();
        if (!e.isPrefixOf(t3.path))
          break;
        t3.path.length > e.length + 1 || (le(ce(i2), n) <= 0 || (s = s.insert(i2.key, i2.mutableCopy())));
      }
      return yi.resolve(s);
    }
    getAllFromCollectionGroup(t2, e, n, s) {
      L2();
    }
    Bi(t2, e) {
      return yi.forEach(this.docs, (t3) => e(t3));
    }
    newChangeBuffer(t2) {
      return new Ro(this);
    }
    getSize(t2) {
      return yi.resolve(this.size);
    }
  };
  var Ro = class extends Fr {
    constructor(t2) {
      super(), this.Kn = t2;
    }
    applyChanges(t2) {
      const e = [];
      return this.changes.forEach((n, s) => {
        s.isValidDocument() ? e.push(this.Kn.addEntry(t2, s)) : this.Kn.removeEntry(n);
      }), yi.waitFor(e);
    }
    getFromCache(t2, e) {
      return this.Kn.getEntry(t2, e);
    }
    getAllFromCache(t2, e) {
      return this.Kn.getEntries(t2, e);
    }
  };
  var bo = class {
    constructor(t2) {
      this.persistence = t2, this.Li = new Kn((t3) => Ie(t3), Ee), this.lastRemoteSnapshotVersion = ct.min(), this.highestTargetId = 0, this.Ui = 0, this.qi = new Io(), this.targetCount = 0, this.Ki = br.gn();
    }
    forEachTarget(t2, e) {
      return this.Li.forEach((t3, n) => e(n)), yi.resolve();
    }
    getLastRemoteSnapshotVersion(t2) {
      return yi.resolve(this.lastRemoteSnapshotVersion);
    }
    getHighestSequenceNumber(t2) {
      return yi.resolve(this.Ui);
    }
    allocateTargetId(t2) {
      return this.highestTargetId = this.Ki.next(), yi.resolve(this.highestTargetId);
    }
    setTargetsMetadata(t2, e, n) {
      return n && (this.lastRemoteSnapshotVersion = n), e > this.Ui && (this.Ui = e), yi.resolve();
    }
    Tn(t2) {
      this.Li.set(t2.target, t2);
      const e = t2.targetId;
      e > this.highestTargetId && (this.Ki = new br(e), this.highestTargetId = e), t2.sequenceNumber > this.Ui && (this.Ui = t2.sequenceNumber);
    }
    addTargetData(t2, e) {
      return this.Tn(e), this.targetCount += 1, yi.resolve();
    }
    updateTargetData(t2, e) {
      return this.Tn(e), yi.resolve();
    }
    removeTargetData(t2, e) {
      return this.Li.delete(e.target), this.qi.vi(e.targetId), this.targetCount -= 1, yi.resolve();
    }
    removeTargets(t2, e, n) {
      let s = 0;
      const i = [];
      return this.Li.forEach((r, o) => {
        o.sequenceNumber <= e && n.get(o.targetId) === null && (this.Li.delete(r), i.push(this.removeMatchingKeysForTargetId(t2, o.targetId)), s++);
      }), yi.waitFor(i).next(() => s);
    }
    getTargetCount(t2) {
      return yi.resolve(this.targetCount);
    }
    getTargetData(t2, e) {
      const n = this.Li.get(e) || null;
      return yi.resolve(n);
    }
    addMatchingKeys(t2, e, n) {
      return this.qi.bi(e, n), yi.resolve();
    }
    removeMatchingKeys(t2, e, n) {
      this.qi.Vi(e, n);
      const s = this.persistence.referenceDelegate, i = [];
      return s && e.forEach((e2) => {
        i.push(s.markPotentiallyOrphaned(t2, e2));
      }), yi.waitFor(i);
    }
    removeMatchingKeysForTargetId(t2, e) {
      return this.qi.vi(e), yi.resolve();
    }
    getMatchingKeysForTargetId(t2, e) {
      const n = this.qi.Di(e);
      return yi.resolve(n);
    }
    containsKey(t2, e) {
      return yi.resolve(this.qi.containsKey(e));
    }
  };
  var Po = class {
    constructor(t2, e) {
      this.Gi = {}, this.overlays = {}, this.es = new nt(0), this.ns = false, this.ns = true, this.referenceDelegate = t2(this), this.fs = new bo(this);
      this.indexManager = new ar(), this.ds = function(t3) {
        return new Ao(t3);
      }((t3) => this.referenceDelegate.Qi(t3)), this.M = new ki(e), this._s = new yo(this.M);
    }
    start() {
      return Promise.resolve();
    }
    shutdown() {
      return this.ns = false, Promise.resolve();
    }
    get started() {
      return this.ns;
    }
    setDatabaseDeletedListener() {
    }
    setNetworkEnabled() {
    }
    getIndexManager(t2) {
      return this.indexManager;
    }
    getDocumentOverlayCache(t2) {
      let e = this.overlays[t2.toKey()];
      return e || (e = new po(), this.overlays[t2.toKey()] = e), e;
    }
    getMutationQueue(t2, e) {
      let n = this.Gi[t2.toKey()];
      return n || (n = new Eo(e, this.referenceDelegate), this.Gi[t2.toKey()] = n), n;
    }
    getTargetCache() {
      return this.fs;
    }
    getRemoteDocumentCache() {
      return this.ds;
    }
    getBundleCache() {
      return this._s;
    }
    runTransaction(t2, e, n) {
      O2("MemoryPersistence", "Starting transaction:", t2);
      const s = new Vo(this.es.next());
      return this.referenceDelegate.ji(), n(s).next((t3) => this.referenceDelegate.Wi(s).next(() => t3)).toPromise().then((t3) => (s.raiseOnCommittedEvent(), t3));
    }
    zi(t2, e) {
      return yi.or(Object.values(this.Gi).map((n) => () => n.containsKey(t2, e)));
    }
  };
  var Vo = class extends gi {
    constructor(t2) {
      super(), this.currentSequenceNumber = t2;
    }
  };
  var vo = class {
    constructor(t2) {
      this.persistence = t2, this.Hi = new Io(), this.Ji = null;
    }
    static Yi(t2) {
      return new vo(t2);
    }
    get Xi() {
      if (this.Ji)
        return this.Ji;
      throw L2();
    }
    addReference(t2, e, n) {
      return this.Hi.addReference(n, e), this.Xi.delete(n.toString()), yi.resolve();
    }
    removeReference(t2, e, n) {
      return this.Hi.removeReference(n, e), this.Xi.add(n.toString()), yi.resolve();
    }
    markPotentiallyOrphaned(t2, e) {
      return this.Xi.add(e.toString()), yi.resolve();
    }
    removeTarget(t2, e) {
      this.Hi.vi(e.targetId).forEach((t3) => this.Xi.add(t3.toString()));
      const n = this.persistence.getTargetCache();
      return n.getMatchingKeysForTargetId(t2, e.targetId).next((t3) => {
        t3.forEach((t4) => this.Xi.add(t4.toString()));
      }).next(() => n.removeTargetData(t2, e));
    }
    ji() {
      this.Ji = /* @__PURE__ */ new Set();
    }
    Wi(t2) {
      const e = this.persistence.getRemoteDocumentCache().newChangeBuffer();
      return yi.forEach(this.Xi, (n) => {
        const s = xt.fromPath(n);
        return this.Zi(t2, s).next((t3) => {
          t3 || e.removeEntry(s, ct.min());
        });
      }).next(() => (this.Ji = null, e.apply(t2)));
    }
    updateLimboDocument(t2, e) {
      return this.Zi(t2, e).next((t3) => {
        t3 ? this.Xi.delete(e.toString()) : this.Xi.add(e.toString());
      });
    }
    Qi(t2) {
      return 0;
    }
    Zi(t2, e) {
      return yi.or([() => yi.resolve(this.Hi.containsKey(e)), () => this.persistence.getTargetCache().containsKey(t2, e), () => this.persistence.zi(t2, e)]);
    }
  };
  var Oo = class {
    constructor() {
      this.activeTargetIds = Zn();
    }
    nr(t2) {
      this.activeTargetIds = this.activeTargetIds.add(t2);
    }
    sr(t2) {
      this.activeTargetIds = this.activeTargetIds.delete(t2);
    }
    er() {
      const t2 = {
        activeTargetIds: this.activeTargetIds.toArray(),
        updateTimeMs: Date.now()
      };
      return JSON.stringify(t2);
    }
  };
  var $o = class {
    constructor() {
      this.Ur = new Oo(), this.qr = {}, this.onlineStateHandler = null, this.sequenceNumberHandler = null;
    }
    addPendingMutation(t2) {
    }
    updateMutationState(t2, e, n) {
    }
    addLocalQueryTarget(t2) {
      return this.Ur.nr(t2), this.qr[t2] || "not-current";
    }
    updateQueryState(t2, e, n) {
      this.qr[t2] = e;
    }
    removeLocalQueryTarget(t2) {
      this.Ur.sr(t2);
    }
    isLocalQueryTarget(t2) {
      return this.Ur.activeTargetIds.has(t2);
    }
    clearQueryState(t2) {
      delete this.qr[t2];
    }
    getAllActiveQueryTargets() {
      return this.Ur.activeTargetIds;
    }
    isActiveQueryTarget(t2) {
      return this.Ur.activeTargetIds.has(t2);
    }
    start() {
      return this.Ur = new Oo(), Promise.resolve();
    }
    handleUserChange(t2, e, n) {
    }
    setOnlineState(t2) {
    }
    shutdown() {
    }
    writeSequenceNumber(t2) {
    }
    notifyBundleLoaded(t2) {
    }
  };
  var Bo = class {
    Kr(t2) {
    }
    shutdown() {
    }
  };
  var Lo = class {
    constructor() {
      this.Gr = () => this.Qr(), this.jr = () => this.Wr(), this.zr = [], this.Hr();
    }
    Kr(t2) {
      this.zr.push(t2);
    }
    shutdown() {
      window.removeEventListener("online", this.Gr), window.removeEventListener("offline", this.jr);
    }
    Hr() {
      window.addEventListener("online", this.Gr), window.addEventListener("offline", this.jr);
    }
    Qr() {
      O2("ConnectivityMonitor", "Network connectivity changed: AVAILABLE");
      for (const t2 of this.zr)
        t2(0);
    }
    Wr() {
      O2("ConnectivityMonitor", "Network connectivity changed: UNAVAILABLE");
      for (const t2 of this.zr)
        t2(1);
    }
    static vt() {
      return typeof window != "undefined" && window.addEventListener !== void 0 && window.removeEventListener !== void 0;
    }
  };
  var Uo = {
    BatchGetDocuments: "batchGet",
    Commit: "commit",
    RunQuery: "runQuery"
  };
  var qo = class {
    constructor(t2) {
      this.Jr = t2.Jr, this.Yr = t2.Yr;
    }
    Xr(t2) {
      this.Zr = t2;
    }
    eo(t2) {
      this.no = t2;
    }
    onMessage(t2) {
      this.so = t2;
    }
    close() {
      this.Yr();
    }
    send(t2) {
      this.Jr(t2);
    }
    io() {
      this.Zr();
    }
    ro(t2) {
      this.no(t2);
    }
    oo(t2) {
      this.so(t2);
    }
  };
  var Ko = class extends class {
    constructor(t2) {
      this.databaseInfo = t2, this.databaseId = t2.databaseId;
      const e = t2.ssl ? "https" : "http";
      this.uo = e + "://" + t2.host, this.ao = "projects/" + this.databaseId.projectId + "/databases/" + this.databaseId.database + "/documents";
    }
    co(t2, e, n, s, i) {
      const r = this.ho(t2, e);
      O2("RestConnection", "Sending: ", r, n);
      const o = {};
      return this.lo(o, s, i), this.fo(t2, r, o, n).then((t3) => (O2("RestConnection", "Received: ", t3), t3), (e2) => {
        throw $("RestConnection", `${t2} failed with error: `, e2, "url: ", r, "request:", n), e2;
      });
    }
    _o(t2, e, n, s, i) {
      return this.co(t2, e, n, s, i);
    }
    lo(t2, e, n) {
      t2["X-Goog-Api-Client"] = "gl-js/ fire/" + x2, t2["Content-Type"] = "text/plain", this.databaseInfo.appId && (t2["X-Firebase-GMPID"] = this.databaseInfo.appId), e && e.headers.forEach((e2, n2) => t2[n2] = e2), n && n.headers.forEach((e2, n2) => t2[n2] = e2);
    }
    ho(t2, e) {
      const n = Uo[t2];
      return `${this.uo}/v1/${e}:${n}`;
    }
  } {
    constructor(t2) {
      super(t2), this.forceLongPolling = t2.forceLongPolling, this.autoDetectLongPolling = t2.autoDetectLongPolling, this.useFetchStreams = t2.useFetchStreams;
    }
    fo(t2, e, n, s) {
      return new Promise((i, r) => {
        const o = new XhrIo();
        o.listenOnce(EventType.COMPLETE, () => {
          try {
            switch (o.getLastErrorCode()) {
              case ErrorCode.NO_ERROR:
                const e2 = o.getResponseJson();
                O2("Connection", "XHR received:", JSON.stringify(e2)), i(e2);
                break;
              case ErrorCode.TIMEOUT:
                O2("Connection", 'RPC "' + t2 + '" timed out'), r(new Q2(G.DEADLINE_EXCEEDED, "Request time out"));
                break;
              case ErrorCode.HTTP_ERROR:
                const n2 = o.getStatus();
                if (O2("Connection", 'RPC "' + t2 + '" failed with status:', n2, "response text:", o.getResponseText()), n2 > 0) {
                  const t3 = o.getResponseJson().error;
                  if (t3 && t3.status && t3.message) {
                    const e3 = function(t4) {
                      const e4 = t4.toLowerCase().replace(/_/g, "-");
                      return Object.values(G).indexOf(e4) >= 0 ? e4 : G.UNKNOWN;
                    }(t3.status);
                    r(new Q2(e3, t3.message));
                  } else
                    r(new Q2(G.UNKNOWN, "Server responded with status " + o.getStatus()));
                } else
                  r(new Q2(G.UNAVAILABLE, "Connection failed."));
                break;
              default:
                L2();
            }
          } finally {
            O2("Connection", 'RPC "' + t2 + '" completed.');
          }
        });
        const u = JSON.stringify(s);
        o.send(e, "POST", u, n, 15);
      });
    }
    wo(t2, e, n) {
      const s = [this.uo, "/", "google.firestore.v1.Firestore", "/", t2, "/channel"], i = createWebChannelTransport(), r = getStatEventTarget(), o = {
        httpSessionIdParam: "gsessionid",
        initMessageHeaders: {},
        messageUrlParams: {
          database: `projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`
        },
        sendRawJson: true,
        supportsCrossDomainXhr: true,
        internalChannelParams: {
          forwardChannelRequestTimeoutMs: 6e5
        },
        forceLongPolling: this.forceLongPolling,
        detectBufferingProxy: this.autoDetectLongPolling
      };
      this.useFetchStreams && (o.xmlHttpFactory = new FetchXmlHttpFactory({})), this.lo(o.initMessageHeaders, e, n), isMobileCordova() || isReactNative() || isElectron() || isIE() || isUWP() || isBrowserExtension() || (o.httpHeadersOverwriteParam = "$httpHeaders");
      const u = s.join("");
      O2("Connection", "Creating WebChannel: " + u, o);
      const a = i.createWebChannel(u, o);
      let c = false, h = false;
      const l2 = new qo({
        Jr: (t3) => {
          h ? O2("Connection", "Not sending because WebChannel is closed:", t3) : (c || (O2("Connection", "Opening WebChannel transport."), a.open(), c = true), O2("Connection", "WebChannel sending:", t3), a.send(t3));
        },
        Yr: () => a.close()
      }), y2 = (t3, e2, n2) => {
        t3.listen(e2, (t4) => {
          try {
            n2(t4);
          } catch (t5) {
            setTimeout(() => {
              throw t5;
            }, 0);
          }
        });
      };
      return y2(a, WebChannel.EventType.OPEN, () => {
        h || O2("Connection", "WebChannel transport opened.");
      }), y2(a, WebChannel.EventType.CLOSE, () => {
        h || (h = true, O2("Connection", "WebChannel transport closed"), l2.ro());
      }), y2(a, WebChannel.EventType.ERROR, (t3) => {
        h || (h = true, $("Connection", "WebChannel transport errored:", t3), l2.ro(new Q2(G.UNAVAILABLE, "The operation could not be completed")));
      }), y2(a, WebChannel.EventType.MESSAGE, (t3) => {
        var e2;
        if (!h) {
          const n2 = t3.data[0];
          U2(!!n2);
          const s2 = n2, i2 = s2.error || ((e2 = s2[0]) === null || e2 === void 0 ? void 0 : e2.error);
          if (i2) {
            O2("Connection", "WebChannel received error:", i2);
            const t4 = i2.status;
            let e3 = function(t5) {
              const e4 = Bn[t5];
              if (e4 !== void 0)
                return qn(e4);
            }(t4), n3 = i2.message;
            e3 === void 0 && (e3 = G.INTERNAL, n3 = "Unknown error status: " + t4 + " with message " + i2.message), h = true, l2.ro(new Q2(e3, n3)), a.close();
          } else
            O2("Connection", "WebChannel received:", n2), l2.oo(n2);
        }
      }), y2(r, Event.STAT_EVENT, (t3) => {
        t3.stat === Stat.PROXY ? O2("Connection", "Detected buffering proxy") : t3.stat === Stat.NOPROXY && O2("Connection", "Detected no buffering proxy");
      }), setTimeout(() => {
        l2.io();
      }, 0), l2;
    }
  };
  function Qo() {
    return typeof document != "undefined" ? document : null;
  }
  function jo(t2) {
    return new ls(t2, true);
  }
  var Wo = class {
    constructor(t2, e, n = 1e3, s = 1.5, i = 6e4) {
      this.Yn = t2, this.timerId = e, this.mo = n, this.yo = s, this.po = i, this.Io = 0, this.To = null, this.Eo = Date.now(), this.reset();
    }
    reset() {
      this.Io = 0;
    }
    Ao() {
      this.Io = this.po;
    }
    Ro(t2) {
      this.cancel();
      const e = Math.floor(this.Io + this.bo()), n = Math.max(0, Date.now() - this.Eo), s = Math.max(0, e - n);
      s > 0 && O2("ExponentialBackoff", `Backing off for ${s} ms (base delay: ${this.Io} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`), this.To = this.Yn.enqueueAfterDelay(this.timerId, s, () => (this.Eo = Date.now(), t2())), this.Io *= this.yo, this.Io < this.mo && (this.Io = this.mo), this.Io > this.po && (this.Io = this.po);
    }
    Po() {
      this.To !== null && (this.To.skipDelay(), this.To = null);
    }
    cancel() {
      this.To !== null && (this.To.cancel(), this.To = null);
    }
    bo() {
      return (Math.random() - 0.5) * this.Io;
    }
  };
  var zo = class {
    constructor(t2, e, n, s, i, r, o, u) {
      this.Yn = t2, this.Vo = n, this.vo = s, this.So = i, this.authCredentialsProvider = r, this.appCheckCredentialsProvider = o, this.listener = u, this.state = 0, this.Do = 0, this.Co = null, this.xo = null, this.stream = null, this.No = new Wo(t2, e);
    }
    ko() {
      return this.state === 1 || this.state === 5 || this.Mo();
    }
    Mo() {
      return this.state === 2 || this.state === 3;
    }
    start() {
      this.state !== 4 ? this.auth() : this.Oo();
    }
    async stop() {
      this.ko() && await this.close(0);
    }
    Fo() {
      this.state = 0, this.No.reset();
    }
    $o() {
      this.Mo() && this.Co === null && (this.Co = this.Yn.enqueueAfterDelay(this.Vo, 6e4, () => this.Bo()));
    }
    Lo(t2) {
      this.Uo(), this.stream.send(t2);
    }
    async Bo() {
      if (this.Mo())
        return this.close(0);
    }
    Uo() {
      this.Co && (this.Co.cancel(), this.Co = null);
    }
    qo() {
      this.xo && (this.xo.cancel(), this.xo = null);
    }
    async close(t2, e) {
      this.Uo(), this.qo(), this.No.cancel(), this.Do++, t2 !== 4 ? this.No.reset() : e && e.code === G.RESOURCE_EXHAUSTED ? (F2(e.toString()), F2("Using maximum backoff delay to prevent overloading the backend."), this.No.Ao()) : e && e.code === G.UNAUTHENTICATED && this.state !== 3 && (this.authCredentialsProvider.invalidateToken(), this.appCheckCredentialsProvider.invalidateToken()), this.stream !== null && (this.Ko(), this.stream.close(), this.stream = null), this.state = t2, await this.listener.eo(e);
    }
    Ko() {
    }
    auth() {
      this.state = 1;
      const t2 = this.Go(this.Do), e = this.Do;
      Promise.all([this.authCredentialsProvider.getToken(), this.appCheckCredentialsProvider.getToken()]).then(([t3, n]) => {
        this.Do === e && this.Qo(t3, n);
      }, (e2) => {
        t2(() => {
          const t3 = new Q2(G.UNKNOWN, "Fetching auth token failed: " + e2.message);
          return this.jo(t3);
        });
      });
    }
    Qo(t2, e) {
      const n = this.Go(this.Do);
      this.stream = this.Wo(t2, e), this.stream.Xr(() => {
        n(() => (this.state = 2, this.xo = this.Yn.enqueueAfterDelay(this.vo, 1e4, () => (this.Mo() && (this.state = 3), Promise.resolve())), this.listener.Xr()));
      }), this.stream.eo((t3) => {
        n(() => this.jo(t3));
      }), this.stream.onMessage((t3) => {
        n(() => this.onMessage(t3));
      });
    }
    Oo() {
      this.state = 5, this.No.Ro(async () => {
        this.state = 0, this.start();
      });
    }
    jo(t2) {
      return O2("PersistentStream", `close with error: ${t2}`), this.stream = null, this.close(4, t2);
    }
    Go(t2) {
      return (e) => {
        this.Yn.enqueueAndForget(() => this.Do === t2 ? e() : (O2("PersistentStream", "stream callback skipped by getCloseGuardedDispatcher."), Promise.resolve()));
      };
    }
  };
  var Ho = class extends zo {
    constructor(t2, e, n, s, i, r) {
      super(t2, "listen_stream_connection_backoff", "listen_stream_idle", "health_check_timeout", e, n, s, r), this.M = i;
    }
    Wo(t2, e) {
      return this.So.wo("Listen", t2, e);
    }
    onMessage(t2) {
      this.No.reset();
      const e = Vs(this.M, t2), n = function(t3) {
        if (!("targetChange" in t3))
          return ct.min();
        const e2 = t3.targetChange;
        return e2.targetIds && e2.targetIds.length ? ct.min() : e2.readTime ? ws(e2.readTime) : ct.min();
      }(t2);
      return this.listener.zo(e, n);
    }
    Ho(t2) {
      const e = {};
      e.database = Es(this.M), e.addTarget = function(t3, e2) {
        let n2;
        const s = e2.target;
        return n2 = Ae(s) ? {
          documents: Cs(t3, s)
        } : {
          query: xs(t3, s)
        }, n2.targetId = e2.targetId, e2.resumeToken.approximateByteSize() > 0 ? n2.resumeToken = ds(t3, e2.resumeToken) : e2.snapshotVersion.compareTo(ct.min()) > 0 && (n2.readTime = fs(t3, e2.snapshotVersion.toTimestamp())), n2;
      }(this.M, t2);
      const n = ks(this.M, t2);
      n && (e.labels = n), this.Lo(e);
    }
    Jo(t2) {
      const e = {};
      e.database = Es(this.M), e.removeTarget = t2, this.Lo(e);
    }
  };
  var Yo = class extends class {
  } {
    constructor(t2, e, n, s) {
      super(), this.authCredentials = t2, this.appCheckCredentials = e, this.So = n, this.M = s, this.su = false;
    }
    iu() {
      if (this.su)
        throw new Q2(G.FAILED_PRECONDITION, "The client has already been terminated.");
    }
    co(t2, e, n) {
      return this.iu(), Promise.all([this.authCredentials.getToken(), this.appCheckCredentials.getToken()]).then(([s, i]) => this.So.co(t2, e, n, s, i)).catch((t3) => {
        throw t3.name === "FirebaseError" ? (t3.code === G.UNAUTHENTICATED && (this.authCredentials.invalidateToken(), this.appCheckCredentials.invalidateToken()), t3) : new Q2(G.UNKNOWN, t3.toString());
      });
    }
    _o(t2, e, n) {
      return this.iu(), Promise.all([this.authCredentials.getToken(), this.appCheckCredentials.getToken()]).then(([s, i]) => this.So._o(t2, e, n, s, i)).catch((t3) => {
        throw t3.name === "FirebaseError" ? (t3.code === G.UNAUTHENTICATED && (this.authCredentials.invalidateToken(), this.appCheckCredentials.invalidateToken()), t3) : new Q2(G.UNKNOWN, t3.toString());
      });
    }
    terminate() {
      this.su = true;
    }
  };
  var Xo = class {
    constructor(t2, e) {
      this.asyncQueue = t2, this.onlineStateHandler = e, this.state = "Unknown", this.ru = 0, this.ou = null, this.uu = true;
    }
    au() {
      this.ru === 0 && (this.cu("Unknown"), this.ou = this.asyncQueue.enqueueAfterDelay("online_state_timeout", 1e4, () => (this.ou = null, this.hu("Backend didn't respond within 10 seconds."), this.cu("Offline"), Promise.resolve())));
    }
    lu(t2) {
      this.state === "Online" ? this.cu("Unknown") : (this.ru++, this.ru >= 1 && (this.fu(), this.hu(`Connection failed 1 times. Most recent error: ${t2.toString()}`), this.cu("Offline")));
    }
    set(t2) {
      this.fu(), this.ru = 0, t2 === "Online" && (this.uu = false), this.cu(t2);
    }
    cu(t2) {
      t2 !== this.state && (this.state = t2, this.onlineStateHandler(t2));
    }
    hu(t2) {
      const e = `Could not reach Cloud Firestore backend. ${t2}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;
      this.uu ? (F2(e), this.uu = false) : O2("OnlineStateTracker", e);
    }
    fu() {
      this.ou !== null && (this.ou.cancel(), this.ou = null);
    }
  };
  var Zo = class {
    constructor(t2, e, n, s, i) {
      this.localStore = t2, this.datastore = e, this.asyncQueue = n, this.remoteSyncer = {}, this.du = [], this._u = /* @__PURE__ */ new Map(), this.wu = /* @__PURE__ */ new Set(), this.mu = [], this.gu = i, this.gu.Kr((t3) => {
        n.enqueueAndForget(async () => {
          au(this) && (O2("RemoteStore", "Restarting streams for network reachability change."), await async function(t4) {
            const e2 = K2(t4);
            e2.wu.add(4), await eu(e2), e2.yu.set("Unknown"), e2.wu.delete(4), await tu(e2);
          }(this));
        });
      }), this.yu = new Xo(n, s);
    }
  };
  async function tu(t2) {
    if (au(t2))
      for (const e of t2.mu)
        await e(true);
  }
  async function eu(t2) {
    for (const e of t2.mu)
      await e(false);
  }
  function nu(t2, e) {
    const n = K2(t2);
    n._u.has(e.targetId) || (n._u.set(e.targetId, e), uu(n) ? ou(n) : Pu(n).Mo() && iu(n, e));
  }
  function su(t2, e) {
    const n = K2(t2), s = Pu(n);
    n._u.delete(e), s.Mo() && ru(n, e), n._u.size === 0 && (s.Mo() ? s.$o() : au(n) && n.yu.set("Unknown"));
  }
  function iu(t2, e) {
    t2.pu.Z(e.targetId), Pu(t2).Ho(e);
  }
  function ru(t2, e) {
    t2.pu.Z(e), Pu(t2).Jo(e);
  }
  function ou(t2) {
    t2.pu = new os({
      getRemoteKeysForTarget: (e) => t2.remoteSyncer.getRemoteKeysForTarget(e),
      Et: (e) => t2._u.get(e) || null
    }), Pu(t2).start(), t2.yu.au();
  }
  function uu(t2) {
    return au(t2) && !Pu(t2).ko() && t2._u.size > 0;
  }
  function au(t2) {
    return K2(t2).wu.size === 0;
  }
  function cu(t2) {
    t2.pu = void 0;
  }
  async function hu(t2) {
    t2._u.forEach((e, n) => {
      iu(t2, e);
    });
  }
  async function lu(t2, e) {
    cu(t2), uu(t2) ? (t2.yu.lu(e), ou(t2)) : t2.yu.set("Unknown");
  }
  async function fu(t2, e, n) {
    if (t2.yu.set("Online"), e instanceof is && e.state === 2 && e.cause)
      try {
        await async function(t3, e2) {
          const n2 = e2.cause;
          for (const s of e2.targetIds)
            t3._u.has(s) && (await t3.remoteSyncer.rejectListen(s, n2), t3._u.delete(s), t3.pu.removeTarget(s));
        }(t2, e);
      } catch (n2) {
        O2("RemoteStore", "Failed to remove targets %s: %s ", e.targetIds.join(","), n2), await du(t2, n2);
      }
    else if (e instanceof ns ? t2.pu.ut(e) : e instanceof ss ? t2.pu._t(e) : t2.pu.ht(e), !n.isEqual(ct.min()))
      try {
        const e2 = await ro(t2.localStore);
        n.compareTo(e2) >= 0 && await function(t3, e3) {
          const n2 = t3.pu.yt(e3);
          return n2.targetChanges.forEach((n3, s) => {
            if (n3.resumeToken.approximateByteSize() > 0) {
              const i = t3._u.get(s);
              i && t3._u.set(s, i.withResumeToken(n3.resumeToken, e3));
            }
          }), n2.targetMismatches.forEach((e4) => {
            const n3 = t3._u.get(e4);
            if (!n3)
              return;
            t3._u.set(e4, n3.withResumeToken(pt.EMPTY_BYTE_STRING, n3.snapshotVersion)), ru(t3, e4);
            const s = new Ni(n3.target, e4, 1, n3.sequenceNumber);
            iu(t3, s);
          }), t3.remoteSyncer.applyRemoteEvent(n2);
        }(t2, n);
      } catch (e2) {
        O2("RemoteStore", "Failed to raise snapshot:", e2), await du(t2, e2);
      }
  }
  async function du(t2, e, n) {
    if (!Ai(e))
      throw e;
    t2.wu.add(1), await eu(t2), t2.yu.set("Offline"), n || (n = () => ro(t2.localStore)), t2.asyncQueue.enqueueRetryable(async () => {
      O2("RemoteStore", "Retrying IndexedDB access"), await n(), t2.wu.delete(1), await tu(t2);
    });
  }
  async function Ru(t2, e) {
    const n = K2(t2);
    n.asyncQueue.verifyOperationInProgress(), O2("RemoteStore", "RemoteStore received new credentials");
    const s = au(n);
    n.wu.add(3), await eu(n), s && n.yu.set("Unknown"), await n.remoteSyncer.handleCredentialChange(e), n.wu.delete(3), await tu(n);
  }
  async function bu(t2, e) {
    const n = K2(t2);
    e ? (n.wu.delete(2), await tu(n)) : e || (n.wu.add(2), await eu(n), n.yu.set("Unknown"));
  }
  function Pu(t2) {
    return t2.Iu || (t2.Iu = function(t3, e, n) {
      const s = K2(t3);
      return s.iu(), new Ho(e, s.So, s.authCredentials, s.appCheckCredentials, s.M, n);
    }(t2.datastore, t2.asyncQueue, {
      Xr: hu.bind(null, t2),
      eo: lu.bind(null, t2),
      zo: fu.bind(null, t2)
    }), t2.mu.push(async (e) => {
      e ? (t2.Iu.Fo(), uu(t2) ? ou(t2) : t2.yu.set("Unknown")) : (await t2.Iu.stop(), cu(t2));
    })), t2.Iu;
  }
  var vu = class {
    constructor(t2, e, n, s, i) {
      this.asyncQueue = t2, this.timerId = e, this.targetTimeMs = n, this.op = s, this.removalCallback = i, this.deferred = new j(), this.then = this.deferred.promise.then.bind(this.deferred.promise), this.deferred.promise.catch((t3) => {
      });
    }
    static createAndSchedule(t2, e, n, s, i) {
      const r = Date.now() + n, o = new vu(t2, e, r, s, i);
      return o.start(n), o;
    }
    start(t2) {
      this.timerHandle = setTimeout(() => this.handleDelayElapsed(), t2);
    }
    skipDelay() {
      return this.handleDelayElapsed();
    }
    cancel(t2) {
      this.timerHandle !== null && (this.clearTimeout(), this.deferred.reject(new Q2(G.CANCELLED, "Operation cancelled" + (t2 ? ": " + t2 : ""))));
    }
    handleDelayElapsed() {
      this.asyncQueue.enqueueAndForget(() => this.timerHandle !== null ? (this.clearTimeout(), this.op().then((t2) => this.deferred.resolve(t2))) : Promise.resolve());
    }
    clearTimeout() {
      this.timerHandle !== null && (this.removalCallback(this), clearTimeout(this.timerHandle), this.timerHandle = null);
    }
  };
  function Su(t2, e) {
    if (F2("AsyncQueue", `${e}: ${t2}`), Ai(t2))
      return new Q2(G.UNAVAILABLE, `${e}: ${t2}`);
    throw t2;
  }
  var Du = class {
    constructor(t2) {
      this.comparator = t2 ? (e, n) => t2(e, n) || xt.comparator(e.key, n.key) : (t3, e) => xt.comparator(t3.key, e.key), this.keyedMap = Wn(), this.sortedSet = new fe(this.comparator);
    }
    static emptySet(t2) {
      return new Du(t2.comparator);
    }
    has(t2) {
      return this.keyedMap.get(t2) != null;
    }
    get(t2) {
      return this.keyedMap.get(t2);
    }
    first() {
      return this.sortedSet.minKey();
    }
    last() {
      return this.sortedSet.maxKey();
    }
    isEmpty() {
      return this.sortedSet.isEmpty();
    }
    indexOf(t2) {
      const e = this.keyedMap.get(t2);
      return e ? this.sortedSet.indexOf(e) : -1;
    }
    get size() {
      return this.sortedSet.size;
    }
    forEach(t2) {
      this.sortedSet.inorderTraversal((e, n) => (t2(e), false));
    }
    add(t2) {
      const e = this.delete(t2.key);
      return e.copy(e.keyedMap.insert(t2.key, t2), e.sortedSet.insert(t2, null));
    }
    delete(t2) {
      const e = this.get(t2);
      return e ? this.copy(this.keyedMap.remove(t2), this.sortedSet.remove(e)) : this;
    }
    isEqual(t2) {
      if (!(t2 instanceof Du))
        return false;
      if (this.size !== t2.size)
        return false;
      const e = this.sortedSet.getIterator(), n = t2.sortedSet.getIterator();
      for (; e.hasNext(); ) {
        const t3 = e.getNext().key, s = n.getNext().key;
        if (!t3.isEqual(s))
          return false;
      }
      return true;
    }
    toString() {
      const t2 = [];
      return this.forEach((e) => {
        t2.push(e.toString());
      }), t2.length === 0 ? "DocumentSet ()" : "DocumentSet (\n  " + t2.join("  \n") + "\n)";
    }
    copy(t2, e) {
      const n = new Du();
      return n.comparator = this.comparator, n.keyedMap = t2, n.sortedSet = e, n;
    }
  };
  var Cu = class {
    constructor() {
      this.Eu = new fe(xt.comparator);
    }
    track(t2) {
      const e = t2.doc.key, n = this.Eu.get(e);
      n ? t2.type !== 0 && n.type === 3 ? this.Eu = this.Eu.insert(e, t2) : t2.type === 3 && n.type !== 1 ? this.Eu = this.Eu.insert(e, {
        type: n.type,
        doc: t2.doc
      }) : t2.type === 2 && n.type === 2 ? this.Eu = this.Eu.insert(e, {
        type: 2,
        doc: t2.doc
      }) : t2.type === 2 && n.type === 0 ? this.Eu = this.Eu.insert(e, {
        type: 0,
        doc: t2.doc
      }) : t2.type === 1 && n.type === 0 ? this.Eu = this.Eu.remove(e) : t2.type === 1 && n.type === 2 ? this.Eu = this.Eu.insert(e, {
        type: 1,
        doc: n.doc
      }) : t2.type === 0 && n.type === 1 ? this.Eu = this.Eu.insert(e, {
        type: 2,
        doc: t2.doc
      }) : L2() : this.Eu = this.Eu.insert(e, t2);
    }
    Au() {
      const t2 = [];
      return this.Eu.inorderTraversal((e, n) => {
        t2.push(n);
      }), t2;
    }
  };
  var xu = class {
    constructor(t2, e, n, s, i, r, o, u) {
      this.query = t2, this.docs = e, this.oldDocs = n, this.docChanges = s, this.mutatedKeys = i, this.fromCache = r, this.syncStateChanged = o, this.excludesMetadataChanges = u;
    }
    static fromInitialDocuments(t2, e, n, s) {
      const i = [];
      return e.forEach((t3) => {
        i.push({
          type: 0,
          doc: t3
        });
      }), new xu(t2, e, Du.emptySet(e), i, n, s, true, false);
    }
    get hasPendingWrites() {
      return !this.mutatedKeys.isEmpty();
    }
    isEqual(t2) {
      if (!(this.fromCache === t2.fromCache && this.syncStateChanged === t2.syncStateChanged && this.mutatedKeys.isEqual(t2.mutatedKeys) && Ye(this.query, t2.query) && this.docs.isEqual(t2.docs) && this.oldDocs.isEqual(t2.oldDocs)))
        return false;
      const e = this.docChanges, n = t2.docChanges;
      if (e.length !== n.length)
        return false;
      for (let t3 = 0; t3 < e.length; t3++)
        if (e[t3].type !== n[t3].type || !e[t3].doc.isEqual(n[t3].doc))
          return false;
      return true;
    }
  };
  var Nu = class {
    constructor() {
      this.Ru = void 0, this.listeners = [];
    }
  };
  var ku = class {
    constructor() {
      this.queries = new Kn((t2) => Xe(t2), Ye), this.onlineState = "Unknown", this.bu = /* @__PURE__ */ new Set();
    }
  };
  async function Mu(t2, e) {
    const n = K2(t2), s = e.query;
    let i = false, r = n.queries.get(s);
    if (r || (i = true, r = new Nu()), i)
      try {
        r.Ru = await n.onListen(s);
      } catch (t3) {
        const n2 = Su(t3, `Initialization of query '${Ze(e.query)}' failed`);
        return void e.onError(n2);
      }
    if (n.queries.set(s, r), r.listeners.push(e), e.Pu(n.onlineState), r.Ru) {
      e.Vu(r.Ru) && Bu(n);
    }
  }
  async function Ou(t2, e) {
    const n = K2(t2), s = e.query;
    let i = false;
    const r = n.queries.get(s);
    if (r) {
      const t3 = r.listeners.indexOf(e);
      t3 >= 0 && (r.listeners.splice(t3, 1), i = r.listeners.length === 0);
    }
    if (i)
      return n.queries.delete(s), n.onUnlisten(s);
  }
  function Fu(t2, e) {
    const n = K2(t2);
    let s = false;
    for (const t3 of e) {
      const e2 = t3.query, i = n.queries.get(e2);
      if (i) {
        for (const e3 of i.listeners)
          e3.Vu(t3) && (s = true);
        i.Ru = t3;
      }
    }
    s && Bu(n);
  }
  function $u(t2, e, n) {
    const s = K2(t2), i = s.queries.get(e);
    if (i)
      for (const t3 of i.listeners)
        t3.onError(n);
    s.queries.delete(e);
  }
  function Bu(t2) {
    t2.bu.forEach((t3) => {
      t3.next();
    });
  }
  var Lu = class {
    constructor(t2, e, n) {
      this.query = t2, this.vu = e, this.Su = false, this.Du = null, this.onlineState = "Unknown", this.options = n || {};
    }
    Vu(t2) {
      if (!this.options.includeMetadataChanges) {
        const e2 = [];
        for (const n of t2.docChanges)
          n.type !== 3 && e2.push(n);
        t2 = new xu(t2.query, t2.docs, t2.oldDocs, e2, t2.mutatedKeys, t2.fromCache, t2.syncStateChanged, true);
      }
      let e = false;
      return this.Su ? this.Cu(t2) && (this.vu.next(t2), e = true) : this.xu(t2, this.onlineState) && (this.Nu(t2), e = true), this.Du = t2, e;
    }
    onError(t2) {
      this.vu.error(t2);
    }
    Pu(t2) {
      this.onlineState = t2;
      let e = false;
      return this.Du && !this.Su && this.xu(this.Du, t2) && (this.Nu(this.Du), e = true), e;
    }
    xu(t2, e) {
      if (!t2.fromCache)
        return true;
      const n = e !== "Offline";
      return (!this.options.ku || !n) && (!t2.docs.isEmpty() || e === "Offline");
    }
    Cu(t2) {
      if (t2.docChanges.length > 0)
        return true;
      const e = this.Du && this.Du.hasPendingWrites !== t2.hasPendingWrites;
      return !(!t2.syncStateChanged && !e) && this.options.includeMetadataChanges === true;
    }
    Nu(t2) {
      t2 = xu.fromInitialDocuments(t2.query, t2.docs, t2.mutatedKeys, t2.fromCache), this.Su = true, this.vu.next(t2);
    }
  };
  var Qu = class {
    constructor(t2) {
      this.key = t2;
    }
  };
  var ju = class {
    constructor(t2) {
      this.key = t2;
    }
  };
  var Wu = class {
    constructor(t2, e) {
      this.query = t2, this.Uu = e, this.qu = null, this.current = false, this.Ku = Yn(), this.mutatedKeys = Yn(), this.Gu = nn(t2), this.Qu = new Du(this.Gu);
    }
    get ju() {
      return this.Uu;
    }
    Wu(t2, e) {
      const n = e ? e.zu : new Cu(), s = e ? e.Qu : this.Qu;
      let i = e ? e.mutatedKeys : this.mutatedKeys, r = s, o = false;
      const u = this.query.limitType === "F" && s.size === this.query.limit ? s.last() : null, a = this.query.limitType === "L" && s.size === this.query.limit ? s.first() : null;
      if (t2.inorderTraversal((t3, e2) => {
        const c = s.get(t3), h = tn(this.query, e2) ? e2 : null, l2 = !!c && this.mutatedKeys.has(c.key), f = !!h && (h.hasLocalMutations || this.mutatedKeys.has(h.key) && h.hasCommittedMutations);
        let d = false;
        if (c && h) {
          c.data.isEqual(h.data) ? l2 !== f && (n.track({
            type: 3,
            doc: h
          }), d = true) : this.Hu(c, h) || (n.track({
            type: 2,
            doc: h
          }), d = true, (u && this.Gu(h, u) > 0 || a && this.Gu(h, a) < 0) && (o = true));
        } else
          !c && h ? (n.track({
            type: 0,
            doc: h
          }), d = true) : c && !h && (n.track({
            type: 1,
            doc: c
          }), d = true, (u || a) && (o = true));
        d && (h ? (r = r.add(h), i = f ? i.add(t3) : i.delete(t3)) : (r = r.delete(t3), i = i.delete(t3)));
      }), this.query.limit !== null)
        for (; r.size > this.query.limit; ) {
          const t3 = this.query.limitType === "F" ? r.last() : r.first();
          r = r.delete(t3.key), i = i.delete(t3.key), n.track({
            type: 1,
            doc: t3
          });
        }
      return {
        Qu: r,
        zu: n,
        ii: o,
        mutatedKeys: i
      };
    }
    Hu(t2, e) {
      return t2.hasLocalMutations && e.hasCommittedMutations && !e.hasLocalMutations;
    }
    applyChanges(t2, e, n) {
      const s = this.Qu;
      this.Qu = t2.Qu, this.mutatedKeys = t2.mutatedKeys;
      const i = t2.zu.Au();
      i.sort((t3, e2) => function(t4, e3) {
        const n2 = (t5) => {
          switch (t5) {
            case 0:
              return 1;
            case 2:
            case 3:
              return 2;
            case 1:
              return 0;
            default:
              return L2();
          }
        };
        return n2(t4) - n2(e3);
      }(t3.type, e2.type) || this.Gu(t3.doc, e2.doc)), this.Ju(n);
      const r = e ? this.Yu() : [], o = this.Ku.size === 0 && this.current ? 1 : 0, u = o !== this.qu;
      if (this.qu = o, i.length !== 0 || u) {
        return {
          snapshot: new xu(this.query, t2.Qu, s, i, t2.mutatedKeys, o === 0, u, false),
          Xu: r
        };
      }
      return {
        Xu: r
      };
    }
    Pu(t2) {
      return this.current && t2 === "Offline" ? (this.current = false, this.applyChanges({
        Qu: this.Qu,
        zu: new Cu(),
        mutatedKeys: this.mutatedKeys,
        ii: false
      }, false)) : {
        Xu: []
      };
    }
    Zu(t2) {
      return !this.Uu.has(t2) && (!!this.Qu.has(t2) && !this.Qu.get(t2).hasLocalMutations);
    }
    Ju(t2) {
      t2 && (t2.addedDocuments.forEach((t3) => this.Uu = this.Uu.add(t3)), t2.modifiedDocuments.forEach((t3) => {
      }), t2.removedDocuments.forEach((t3) => this.Uu = this.Uu.delete(t3)), this.current = t2.current);
    }
    Yu() {
      if (!this.current)
        return [];
      const t2 = this.Ku;
      this.Ku = Yn(), this.Qu.forEach((t3) => {
        this.Zu(t3.key) && (this.Ku = this.Ku.add(t3.key));
      });
      const e = [];
      return t2.forEach((t3) => {
        this.Ku.has(t3) || e.push(new ju(t3));
      }), this.Ku.forEach((n) => {
        t2.has(n) || e.push(new Qu(n));
      }), e;
    }
    ta(t2) {
      this.Uu = t2._i, this.Ku = Yn();
      const e = this.Wu(t2.documents);
      return this.applyChanges(e, true);
    }
    ea() {
      return xu.fromInitialDocuments(this.query, this.Qu, this.mutatedKeys, this.qu === 0);
    }
  };
  var zu = class {
    constructor(t2, e, n) {
      this.query = t2, this.targetId = e, this.view = n;
    }
  };
  var Hu = class {
    constructor(t2) {
      this.key = t2, this.na = false;
    }
  };
  var Ju = class {
    constructor(t2, e, n, s, i, r) {
      this.localStore = t2, this.remoteStore = e, this.eventManager = n, this.sharedClientState = s, this.currentUser = i, this.maxConcurrentLimboResolutions = r, this.sa = {}, this.ia = new Kn((t3) => Xe(t3), Ye), this.ra = /* @__PURE__ */ new Map(), this.oa = /* @__PURE__ */ new Set(), this.ua = new fe(xt.comparator), this.aa = /* @__PURE__ */ new Map(), this.ca = new Io(), this.ha = {}, this.la = /* @__PURE__ */ new Map(), this.fa = br.yn(), this.onlineState = "Unknown", this.da = void 0;
    }
    get isPrimaryClient() {
      return this.da === true;
    }
  };
  async function Yu(t2, e) {
    const n = Pa(t2);
    let s, i;
    const r = n.ia.get(e);
    if (r)
      s = r.targetId, n.sharedClientState.addLocalQueryTarget(s), i = r.view.ea();
    else {
      const t3 = await co(n.localStore, He(e));
      n.isPrimaryClient && nu(n.remoteStore, t3);
      const r2 = n.sharedClientState.addLocalQueryTarget(t3.targetId);
      s = t3.targetId, i = await Xu(n, e, s, r2 === "current");
    }
    return i;
  }
  async function Xu(t2, e, n, s) {
    t2._a = (e2, n2, s2) => async function(t3, e3, n3, s3) {
      let i2 = e3.view.Wu(n3);
      i2.ii && (i2 = await lo(t3.localStore, e3.query, false).then(({ documents: t4 }) => e3.view.Wu(t4, i2)));
      const r2 = s3 && s3.targetChanges.get(e3.targetId), o2 = e3.view.applyChanges(i2, t3.isPrimaryClient, r2);
      return la2(t3, e3.targetId, o2.Xu), o2.snapshot;
    }(t2, e2, n2, s2);
    const i = await lo(t2.localStore, e, true), r = new Wu(e, i._i), o = r.Wu(i.documents), u = es.createSynthesizedTargetChangeForCurrentChange(n, s && t2.onlineState !== "Offline"), a = r.applyChanges(o, t2.isPrimaryClient, u);
    la2(t2, n, a.Xu);
    const c = new zu(e, n, r);
    return t2.ia.set(e, c), t2.ra.has(n) ? t2.ra.get(n).push(e) : t2.ra.set(n, [e]), a.snapshot;
  }
  async function Zu(t2, e) {
    const n = K2(t2), s = n.ia.get(e), i = n.ra.get(s.targetId);
    if (i.length > 1)
      return n.ra.set(s.targetId, i.filter((t3) => !Ye(t3, e))), void n.ia.delete(e);
    if (n.isPrimaryClient) {
      n.sharedClientState.removeLocalQueryTarget(s.targetId);
      n.sharedClientState.isActiveQueryTarget(s.targetId) || await ho(n.localStore, s.targetId, false).then(() => {
        n.sharedClientState.clearQueryState(s.targetId), su(n.remoteStore, s.targetId), ca(n, s.targetId);
      }).catch(Dr);
    } else
      ca(n, s.targetId), await ho(n.localStore, s.targetId, true);
  }
  async function ea2(t2, e) {
    const n = K2(t2);
    try {
      const t3 = await oo(n.localStore, e);
      e.targetChanges.forEach((t4, e2) => {
        const s = n.aa.get(e2);
        s && (U2(t4.addedDocuments.size + t4.modifiedDocuments.size + t4.removedDocuments.size <= 1), t4.addedDocuments.size > 0 ? s.na = true : t4.modifiedDocuments.size > 0 ? U2(s.na) : t4.removedDocuments.size > 0 && (U2(s.na), s.na = false));
      }), await _a(n, t3, e);
    } catch (t3) {
      await Dr(t3);
    }
  }
  function na2(t2, e, n) {
    const s = K2(t2);
    if (s.isPrimaryClient && n === 0 || !s.isPrimaryClient && n === 1) {
      const t3 = [];
      s.ia.forEach((n2, s2) => {
        const i = s2.view.Pu(e);
        i.snapshot && t3.push(i.snapshot);
      }), function(t4, e2) {
        const n2 = K2(t4);
        n2.onlineState = e2;
        let s2 = false;
        n2.queries.forEach((t5, n3) => {
          for (const t6 of n3.listeners)
            t6.Pu(e2) && (s2 = true);
        }), s2 && Bu(n2);
      }(s.eventManager, e), t3.length && s.sa.zo(t3), s.onlineState = e, s.isPrimaryClient && s.sharedClientState.setOnlineState(e);
    }
  }
  async function sa2(t2, e, n) {
    const s = K2(t2);
    s.sharedClientState.updateQueryState(e, "rejected", n);
    const i = s.aa.get(e), r = i && i.key;
    if (r) {
      let t3 = new fe(xt.comparator);
      t3 = t3.insert(r, ne.newNoDocument(r, ct.min()));
      const n2 = Yn().add(r), i2 = new ts(ct.min(), /* @__PURE__ */ new Map(), new we(rt), t3, n2);
      await ea2(s, i2), s.ua = s.ua.remove(r), s.aa.delete(e), da2(s);
    } else
      await ho(s.localStore, e, false).then(() => ca(s, e, n)).catch(Dr);
  }
  function ca(t2, e, n = null) {
    t2.sharedClientState.removeLocalQueryTarget(e);
    for (const s of t2.ra.get(e))
      t2.ia.delete(s), n && t2.sa.wa(s, n);
    if (t2.ra.delete(e), t2.isPrimaryClient) {
      t2.ca.vi(e).forEach((e2) => {
        t2.ca.containsKey(e2) || ha2(t2, e2);
      });
    }
  }
  function ha2(t2, e) {
    t2.oa.delete(e.path.canonicalString());
    const n = t2.ua.get(e);
    n !== null && (su(t2.remoteStore, n), t2.ua = t2.ua.remove(e), t2.aa.delete(n), da2(t2));
  }
  function la2(t2, e, n) {
    for (const s of n)
      if (s instanceof Qu)
        t2.ca.addReference(s.key, e), fa2(t2, s);
      else if (s instanceof ju) {
        O2("SyncEngine", "Document no longer in limbo: " + s.key), t2.ca.removeReference(s.key, e);
        t2.ca.containsKey(s.key) || ha2(t2, s.key);
      } else
        L2();
  }
  function fa2(t2, e) {
    const n = e.key, s = n.path.canonicalString();
    t2.ua.get(n) || t2.oa.has(s) || (O2("SyncEngine", "New document in limbo: " + n), t2.oa.add(s), da2(t2));
  }
  function da2(t2) {
    for (; t2.oa.size > 0 && t2.ua.size < t2.maxConcurrentLimboResolutions; ) {
      const e = t2.oa.values().next().value;
      t2.oa.delete(e);
      const n = new xt(_t.fromString(e)), s = t2.fa.next();
      t2.aa.set(s, new Hu(n)), t2.ua = t2.ua.insert(n, s), nu(t2.remoteStore, new Ni(He(Ke(n.path)), s, 2, nt.A));
    }
  }
  async function _a(t2, e, n) {
    const s = K2(t2), i = [], r = [], o = [];
    s.ia.isEmpty() || (s.ia.forEach((t3, u) => {
      o.push(s._a(u, e, n).then((t4) => {
        if (t4) {
          s.isPrimaryClient && s.sharedClientState.updateQueryState(u.targetId, t4.fromCache ? "not-current" : "current"), i.push(t4);
          const e2 = Zr.Ys(u.targetId, t4);
          r.push(e2);
        }
      }));
    }), await Promise.all(o), s.sa.zo(i), await async function(t3, e2) {
      const n2 = K2(t3);
      try {
        await n2.persistence.runTransaction("notifyLocalViewChanges", "readwrite", (t4) => yi.forEach(e2, (e3) => yi.forEach(e3.Hs, (s2) => n2.persistence.referenceDelegate.addReference(t4, e3.targetId, s2)).next(() => yi.forEach(e3.Js, (s2) => n2.persistence.referenceDelegate.removeReference(t4, e3.targetId, s2)))));
      } catch (t4) {
        if (!Ai(t4))
          throw t4;
        O2("LocalStore", "Failed to update sequence numbers: " + t4);
      }
      for (const t4 of e2) {
        const e3 = t4.targetId;
        if (!t4.fromCache) {
          const t5 = n2.ui.get(e3), s2 = t5.snapshotVersion, i2 = t5.withLastLimboFreeSnapshotVersion(s2);
          n2.ui = n2.ui.insert(e3, i2);
        }
      }
    }(s.localStore, r));
  }
  async function wa(t2, e) {
    const n = K2(t2);
    if (!n.currentUser.isEqual(e)) {
      O2("SyncEngine", "User change. New user:", e.toKey());
      const t3 = await so(n.localStore, e);
      n.currentUser = e, function(t4, e2) {
        t4.la.forEach((t5) => {
          t5.forEach((t6) => {
            t6.reject(new Q2(G.CANCELLED, e2));
          });
        }), t4.la.clear();
      }(n, "'waitForPendingWrites' promise is rejected due to a user change."), n.sharedClientState.handleUserChange(e, t3.removedBatchIds, t3.addedBatchIds), await _a(n, t3.di);
    }
  }
  function ma2(t2, e) {
    const n = K2(t2), s = n.aa.get(e);
    if (s && s.na)
      return Yn().add(s.key);
    {
      let t3 = Yn();
      const s2 = n.ra.get(e);
      if (!s2)
        return t3;
      for (const e2 of s2) {
        const s3 = n.ia.get(e2);
        t3 = t3.unionWith(s3.view.ju);
      }
      return t3;
    }
  }
  function Pa(t2) {
    const e = K2(t2);
    return e.remoteStore.remoteSyncer.applyRemoteEvent = ea2.bind(null, e), e.remoteStore.remoteSyncer.getRemoteKeysForTarget = ma2.bind(null, e), e.remoteStore.remoteSyncer.rejectListen = sa2.bind(null, e), e.sa.zo = Fu.bind(null, e.eventManager), e.sa.wa = $u.bind(null, e.eventManager), e;
  }
  var Sa2 = class {
    constructor() {
      this.synchronizeTabs = false;
    }
    async initialize(t2) {
      this.M = jo(t2.databaseInfo.databaseId), this.sharedClientState = this.ga(t2), this.persistence = this.ya(t2), await this.persistence.start(), this.gcScheduler = this.pa(t2), this.localStore = this.Ia(t2);
    }
    pa(t2) {
      return null;
    }
    Ia(t2) {
      return no(this.persistence, new to(), t2.initialUser, this.M);
    }
    ya(t2) {
      return new Po(vo.Yi, this.M);
    }
    ga(t2) {
      return new $o();
    }
    async terminate() {
      this.gcScheduler && this.gcScheduler.stop(), await this.sharedClientState.shutdown(), await this.persistence.shutdown();
    }
  };
  var xa2 = class {
    async initialize(t2, e) {
      this.localStore || (this.localStore = t2.localStore, this.sharedClientState = t2.sharedClientState, this.datastore = this.createDatastore(e), this.remoteStore = this.createRemoteStore(e), this.eventManager = this.createEventManager(e), this.syncEngine = this.createSyncEngine(e, !t2.synchronizeTabs), this.sharedClientState.onlineStateHandler = (t3) => na2(this.syncEngine, t3, 1), this.remoteStore.remoteSyncer.handleCredentialChange = wa.bind(null, this.syncEngine), await bu(this.remoteStore, this.syncEngine.isPrimaryClient));
    }
    createEventManager(t2) {
      return new ku();
    }
    createDatastore(t2) {
      const e = jo(t2.databaseInfo.databaseId), n = (s = t2.databaseInfo, new Ko(s));
      var s;
      return function(t3, e2, n2, s2) {
        return new Yo(t3, e2, n2, s2);
      }(t2.authCredentials, t2.appCheckCredentials, n, e);
    }
    createRemoteStore(t2) {
      return e = this.localStore, n = this.datastore, s = t2.asyncQueue, i = (t3) => na2(this.syncEngine, t3, 0), r = Lo.vt() ? new Lo() : new Bo(), new Zo(e, n, s, i, r);
      var e, n, s, i, r;
    }
    createSyncEngine(t2, e) {
      return function(t3, e2, n, s, i, r, o) {
        const u = new Ju(t3, e2, n, s, i, r);
        return o && (u.da = true), u;
      }(this.localStore, this.remoteStore, this.eventManager, this.sharedClientState, t2.initialUser, t2.maxConcurrentLimboResolutions, e);
    }
    terminate() {
      return async function(t2) {
        const e = K2(t2);
        O2("RemoteStore", "RemoteStore shutting down."), e.wu.add(5), await eu(e), e.gu.shutdown(), e.yu.set("Unknown");
      }(this.remoteStore);
    }
  };
  var ka2 = class {
    constructor(t2) {
      this.observer = t2, this.muted = false;
    }
    next(t2) {
      this.observer.next && this.Ea(this.observer.next, t2);
    }
    error(t2) {
      this.observer.error ? this.Ea(this.observer.error, t2) : console.error("Uncaught Error in snapshot listener:", t2);
    }
    Aa() {
      this.muted = true;
    }
    Ea(t2, e) {
      this.muted || setTimeout(() => {
        this.muted || t2(e);
      }, 0);
    }
  };
  var $a2 = class {
    constructor(t2, e, n, s) {
      this.authCredentials = t2, this.appCheckCredentials = e, this.asyncQueue = n, this.databaseInfo = s, this.user = C2.UNAUTHENTICATED, this.clientId = it.R(), this.authCredentialListener = () => Promise.resolve(), this.appCheckCredentialListener = () => Promise.resolve(), this.authCredentials.start(n, async (t3) => {
        O2("FirestoreClient", "Received user=", t3.uid), await this.authCredentialListener(t3), this.user = t3;
      }), this.appCheckCredentials.start(n, (t3) => (O2("FirestoreClient", "Received new app check token=", t3), this.appCheckCredentialListener(t3, this.user)));
    }
    async getConfiguration() {
      return {
        asyncQueue: this.asyncQueue,
        databaseInfo: this.databaseInfo,
        clientId: this.clientId,
        authCredentials: this.authCredentials,
        appCheckCredentials: this.appCheckCredentials,
        initialUser: this.user,
        maxConcurrentLimboResolutions: 100
      };
    }
    setCredentialChangeListener(t2) {
      this.authCredentialListener = t2;
    }
    setAppCheckTokenChangeListener(t2) {
      this.appCheckCredentialListener = t2;
    }
    verifyNotTerminated() {
      if (this.asyncQueue.isShuttingDown)
        throw new Q2(G.FAILED_PRECONDITION, "The client has already been terminated.");
    }
    terminate() {
      this.asyncQueue.enterRestrictedMode();
      const t2 = new j();
      return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async () => {
        try {
          this.onlineComponents && await this.onlineComponents.terminate(), this.offlineComponents && await this.offlineComponents.terminate(), this.authCredentials.shutdown(), this.appCheckCredentials.shutdown(), t2.resolve();
        } catch (e) {
          const n = Su(e, "Failed to shutdown persistence");
          t2.reject(n);
        }
      }), t2.promise;
    }
  };
  async function Ba(t2, e) {
    t2.asyncQueue.verifyOperationInProgress(), O2("FirestoreClient", "Initializing OfflineComponentProvider");
    const n = await t2.getConfiguration();
    await e.initialize(n);
    let s = n.initialUser;
    t2.setCredentialChangeListener(async (t3) => {
      s.isEqual(t3) || (await so(e.localStore, t3), s = t3);
    }), e.persistence.setDatabaseDeletedListener(() => t2.terminate()), t2.offlineComponents = e;
  }
  async function La2(t2, e) {
    t2.asyncQueue.verifyOperationInProgress();
    const n = await Ua2(t2);
    O2("FirestoreClient", "Initializing OnlineComponentProvider");
    const s = await t2.getConfiguration();
    await e.initialize(n, s), t2.setCredentialChangeListener((t3) => Ru(e.remoteStore, t3)), t2.setAppCheckTokenChangeListener((t3, n2) => Ru(e.remoteStore, n2)), t2.onlineComponents = e;
  }
  async function Ua2(t2) {
    return t2.offlineComponents || (O2("FirestoreClient", "Using default OfflineComponentProvider"), await Ba(t2, new Sa2())), t2.offlineComponents;
  }
  async function qa2(t2) {
    return t2.onlineComponents || (O2("FirestoreClient", "Using default OnlineComponentProvider"), await La2(t2, new xa2())), t2.onlineComponents;
  }
  async function Wa2(t2) {
    const e = await qa2(t2), n = e.eventManager;
    return n.onListen = Yu.bind(null, e.syncEngine), n.onUnlisten = Zu.bind(null, e.syncEngine), n;
  }
  function Za2(t2, e, n = {}) {
    const s = new j();
    return t2.asyncQueue.enqueueAndForget(async () => function(t3, e2, n2, s2, i) {
      const r = new ka2({
        next: (n3) => {
          e2.enqueueAndForget(() => Ou(t3, o)), n3.fromCache && s2.source === "server" ? i.reject(new Q2(G.UNAVAILABLE, 'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')) : i.resolve(n3);
        },
        error: (t4) => i.reject(t4)
      }), o = new Lu(n2, r, {
        includeMetadataChanges: true,
        ku: true
      });
      return Mu(t3, o);
    }(await Wa2(t2), t2.asyncQueue, e, n, s)), s.promise;
  }
  var ic2 = /* @__PURE__ */ new Map();
  function rc2(t2, e, n) {
    if (!n)
      throw new Q2(G.INVALID_ARGUMENT, `Function ${t2}() cannot be called with an empty ${e}.`);
  }
  function oc2(t2, e, n, s) {
    if (e === true && s === true)
      throw new Q2(G.INVALID_ARGUMENT, `${t2} and ${n} cannot be used together.`);
  }
  function ac2(t2) {
    if (xt.isDocumentKey(t2))
      throw new Q2(G.INVALID_ARGUMENT, `Invalid collection reference. Collection references must have an odd number of segments, but ${t2} has ${t2.length}.`);
  }
  function cc2(t2) {
    if (t2 === void 0)
      return "undefined";
    if (t2 === null)
      return "null";
    if (typeof t2 == "string")
      return t2.length > 20 && (t2 = `${t2.substring(0, 20)}...`), JSON.stringify(t2);
    if (typeof t2 == "number" || typeof t2 == "boolean")
      return "" + t2;
    if (typeof t2 == "object") {
      if (t2 instanceof Array)
        return "an array";
      {
        const e = function(t3) {
          if (t3.constructor)
            return t3.constructor.name;
          return null;
        }(t2);
        return e ? `a custom ${e} object` : "an object";
      }
    }
    return typeof t2 == "function" ? "a function" : L2();
  }
  function hc2(t2, e) {
    if ("_delegate" in t2 && (t2 = t2._delegate), !(t2 instanceof e)) {
      if (e.name === t2.constructor.name)
        throw new Q2(G.INVALID_ARGUMENT, "Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");
      {
        const n = cc2(t2);
        throw new Q2(G.INVALID_ARGUMENT, `Expected type '${e.name}', but it was: ${n}`);
      }
    }
    return t2;
  }
  var fc2 = class {
    constructor(t2) {
      var e;
      if (t2.host === void 0) {
        if (t2.ssl !== void 0)
          throw new Q2(G.INVALID_ARGUMENT, "Can't provide ssl option if host option is not set");
        this.host = "firestore.googleapis.com", this.ssl = true;
      } else
        this.host = t2.host, this.ssl = (e = t2.ssl) === null || e === void 0 || e;
      if (this.credentials = t2.credentials, this.ignoreUndefinedProperties = !!t2.ignoreUndefinedProperties, t2.cacheSizeBytes === void 0)
        this.cacheSizeBytes = 41943040;
      else {
        if (t2.cacheSizeBytes !== -1 && t2.cacheSizeBytes < 1048576)
          throw new Q2(G.INVALID_ARGUMENT, "cacheSizeBytes must be at least 1048576");
        this.cacheSizeBytes = t2.cacheSizeBytes;
      }
      this.experimentalForceLongPolling = !!t2.experimentalForceLongPolling, this.experimentalAutoDetectLongPolling = !!t2.experimentalAutoDetectLongPolling, this.useFetchStreams = !!t2.useFetchStreams, oc2("experimentalForceLongPolling", t2.experimentalForceLongPolling, "experimentalAutoDetectLongPolling", t2.experimentalAutoDetectLongPolling);
    }
    isEqual(t2) {
      return this.host === t2.host && this.ssl === t2.ssl && this.credentials === t2.credentials && this.cacheSizeBytes === t2.cacheSizeBytes && this.experimentalForceLongPolling === t2.experimentalForceLongPolling && this.experimentalAutoDetectLongPolling === t2.experimentalAutoDetectLongPolling && this.ignoreUndefinedProperties === t2.ignoreUndefinedProperties && this.useFetchStreams === t2.useFetchStreams;
    }
  };
  var dc2 = class {
    constructor(t2, e, n) {
      this._authCredentials = e, this._appCheckCredentials = n, this.type = "firestore-lite", this._persistenceKey = "(lite)", this._settings = new fc2({}), this._settingsFrozen = false, t2 instanceof vt ? this._databaseId = t2 : (this._app = t2, this._databaseId = function(t3) {
        if (!Object.prototype.hasOwnProperty.apply(t3.options, ["projectId"]))
          throw new Q2(G.INVALID_ARGUMENT, '"projectId" not provided in firebase.initializeApp.');
        return new vt(t3.options.projectId);
      }(t2));
    }
    get app() {
      if (!this._app)
        throw new Q2(G.FAILED_PRECONDITION, "Firestore was not initialized using the Firebase SDK. 'app' is not available");
      return this._app;
    }
    get _initialized() {
      return this._settingsFrozen;
    }
    get _terminated() {
      return this._terminateTask !== void 0;
    }
    _setSettings(t2) {
      if (this._settingsFrozen)
        throw new Q2(G.FAILED_PRECONDITION, "Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");
      this._settings = new fc2(t2), t2.credentials !== void 0 && (this._authCredentials = function(t3) {
        if (!t3)
          return new z2();
        switch (t3.type) {
          case "gapi":
            const e = t3.client;
            return U2(!(typeof e != "object" || e === null || !e.auth || !e.auth.getAuthHeaderValueForFirstParty)), new X2(e, t3.sessionIndex || "0", t3.iamToken || null);
          case "provider":
            return t3.client;
          default:
            throw new Q2(G.INVALID_ARGUMENT, "makeAuthCredentialsProvider failed due to invalid credential type");
        }
      }(t2.credentials));
    }
    _getSettings() {
      return this._settings;
    }
    _freezeSettings() {
      return this._settingsFrozen = true, this._settings;
    }
    _delete() {
      return this._terminateTask || (this._terminateTask = this._terminate()), this._terminateTask;
    }
    toJSON() {
      return {
        app: this._app,
        databaseId: this._databaseId,
        settings: this._settings
      };
    }
    _terminate() {
      return function(t2) {
        const e = ic2.get(t2);
        e && (O2("ComponentProvider", "Removing Datastore"), ic2.delete(t2), e.terminate());
      }(this), Promise.resolve();
    }
  };
  var wc2 = class {
    constructor(t2, e, n) {
      this.converter = e, this._key = n, this.type = "document", this.firestore = t2;
    }
    get _path() {
      return this._key.path;
    }
    get id() {
      return this._key.path.lastSegment();
    }
    get path() {
      return this._key.path.canonicalString();
    }
    get parent() {
      return new gc2(this.firestore, this.converter, this._key.path.popLast());
    }
    withConverter(t2) {
      return new wc2(this.firestore, t2, this._key);
    }
  };
  var mc2 = class {
    constructor(t2, e, n) {
      this.converter = e, this._query = n, this.type = "query", this.firestore = t2;
    }
    withConverter(t2) {
      return new mc2(this.firestore, t2, this._query);
    }
  };
  var gc2 = class extends mc2 {
    constructor(t2, e, n) {
      super(t2, e, Ke(n)), this._path = n, this.type = "collection";
    }
    get id() {
      return this._query.path.lastSegment();
    }
    get path() {
      return this._query.path.canonicalString();
    }
    get parent() {
      const t2 = this._path.popLast();
      return t2.isEmpty() ? null : new wc2(this.firestore, null, new xt(t2));
    }
    withConverter(t2) {
      return new gc2(this.firestore, t2, this._path);
    }
  };
  function yc2(t2, e, ...n) {
    if (t2 = getModularInstance(t2), rc2("collection", "path", e), t2 instanceof dc2) {
      const s = _t.fromString(e, ...n);
      return ac2(s), new gc2(t2, null, s);
    }
    {
      if (!(t2 instanceof wc2 || t2 instanceof gc2))
        throw new Q2(G.INVALID_ARGUMENT, "Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");
      const s = t2._path.child(_t.fromString(e, ...n));
      return ac2(s), new gc2(t2.firestore, null, s);
    }
  }
  var Ac2 = class {
    constructor() {
      this.Fa = Promise.resolve(), this.$a = [], this.Ba = false, this.La = [], this.Ua = null, this.qa = false, this.Ka = false, this.Ga = [], this.No = new Wo(this, "async_queue_retry"), this.Qa = () => {
        const t3 = Qo();
        t3 && O2("AsyncQueue", "Visibility state changed to " + t3.visibilityState), this.No.Po();
      };
      const t2 = Qo();
      t2 && typeof t2.addEventListener == "function" && t2.addEventListener("visibilitychange", this.Qa);
    }
    get isShuttingDown() {
      return this.Ba;
    }
    enqueueAndForget(t2) {
      this.enqueue(t2);
    }
    enqueueAndForgetEvenWhileRestricted(t2) {
      this.ja(), this.Wa(t2);
    }
    enterRestrictedMode(t2) {
      if (!this.Ba) {
        this.Ba = true, this.Ka = t2 || false;
        const e = Qo();
        e && typeof e.removeEventListener == "function" && e.removeEventListener("visibilitychange", this.Qa);
      }
    }
    enqueue(t2) {
      if (this.ja(), this.Ba)
        return new Promise(() => {
        });
      const e = new j();
      return this.Wa(() => this.Ba && this.Ka ? Promise.resolve() : (t2().then(e.resolve, e.reject), e.promise)).then(() => e.promise);
    }
    enqueueRetryable(t2) {
      this.enqueueAndForget(() => (this.$a.push(t2), this.za()));
    }
    async za() {
      if (this.$a.length !== 0) {
        try {
          await this.$a[0](), this.$a.shift(), this.No.reset();
        } catch (t2) {
          if (!Ai(t2))
            throw t2;
          O2("AsyncQueue", "Operation failed with retryable error: " + t2);
        }
        this.$a.length > 0 && this.No.Ro(() => this.za());
      }
    }
    Wa(t2) {
      const e = this.Fa.then(() => (this.qa = true, t2().catch((t3) => {
        this.Ua = t3, this.qa = false;
        const e2 = function(t4) {
          let e3 = t4.message || "";
          t4.stack && (e3 = t4.stack.includes(t4.message) ? t4.stack : t4.message + "\n" + t4.stack);
          return e3;
        }(t3);
        throw F2("INTERNAL UNHANDLED ERROR: ", e2), t3;
      }).then((t3) => (this.qa = false, t3))));
      return this.Fa = e, e;
    }
    enqueueAfterDelay(t2, e, n) {
      this.ja(), this.Ga.indexOf(t2) > -1 && (e = 0);
      const s = vu.createAndSchedule(this, t2, e, n, (t3) => this.Ha(t3));
      return this.La.push(s), s;
    }
    ja() {
      this.Ua && L2();
    }
    verifyOperationInProgress() {
    }
    async Ja() {
      let t2;
      do {
        t2 = this.Fa, await t2;
      } while (t2 !== this.Fa);
    }
    Ya(t2) {
      for (const e of this.La)
        if (e.timerId === t2)
          return true;
      return false;
    }
    Xa(t2) {
      return this.Ja().then(() => {
        this.La.sort((t3, e) => t3.targetTimeMs - e.targetTimeMs);
        for (const e of this.La)
          if (e.skipDelay(), t2 !== "all" && e.timerId === t2)
            break;
        return this.Ja();
      });
    }
    Za(t2) {
      this.Ga.push(t2);
    }
    Ha(t2) {
      const e = this.La.indexOf(t2);
      this.La.splice(e, 1);
    }
  };
  var Vc2 = class extends dc2 {
    constructor(t2, e, n) {
      super(t2, e, n), this.type = "firestore", this._queue = new Ac2(), this._persistenceKey = "name" in t2 ? t2.name : "[DEFAULT]";
    }
    _terminate() {
      return this._firestoreClient || Cc2(this), this._firestoreClient.terminate();
    }
  };
  function Sc2(e = getApp()) {
    return _getProvider(e, "firestore").getImmediate();
  }
  function Dc2(t2) {
    return t2._firestoreClient || Cc2(t2), t2._firestoreClient.verifyNotTerminated(), t2._firestoreClient;
  }
  function Cc2(t2) {
    var e;
    const n = t2._freezeSettings(), s = function(t3, e2, n2, s2) {
      return new Vt(t3, e2, n2, s2.host, s2.ssl, s2.experimentalForceLongPolling, s2.experimentalAutoDetectLongPolling, s2.useFetchStreams);
    }(t2._databaseId, ((e = t2._app) === null || e === void 0 ? void 0 : e.options.appId) || "", t2._persistenceKey, n);
    t2._firestoreClient = new $a2(t2._authCredentials, t2._appCheckCredentials, t2._queue, s);
  }
  var Kc2 = class {
    constructor(...t2) {
      for (let e = 0; e < t2.length; ++e)
        if (t2[e].length === 0)
          throw new Q2(G.INVALID_ARGUMENT, "Invalid field name at argument $(i + 1). Field names must not be empty.");
      this._internalPath = new mt(t2);
    }
    isEqual(t2) {
      return this._internalPath.isEqual(t2._internalPath);
    }
  };
  var Qc2 = class {
    constructor(t2) {
      this._byteString = t2;
    }
    static fromBase64String(t2) {
      try {
        return new Qc2(pt.fromBase64String(t2));
      } catch (t3) {
        throw new Q2(G.INVALID_ARGUMENT, "Failed to construct data from Base64 string: " + t3);
      }
    }
    static fromUint8Array(t2) {
      return new Qc2(pt.fromUint8Array(t2));
    }
    toBase64() {
      return this._byteString.toBase64();
    }
    toUint8Array() {
      return this._byteString.toUint8Array();
    }
    toString() {
      return "Bytes(base64: " + this.toBase64() + ")";
    }
    isEqual(t2) {
      return this._byteString.isEqual(t2._byteString);
    }
  };
  var Wc2 = class {
    constructor(t2, e) {
      if (!isFinite(t2) || t2 < -90 || t2 > 90)
        throw new Q2(G.INVALID_ARGUMENT, "Latitude must be a number between -90 and 90, but was: " + t2);
      if (!isFinite(e) || e < -180 || e > 180)
        throw new Q2(G.INVALID_ARGUMENT, "Longitude must be a number between -180 and 180, but was: " + e);
      this._lat = t2, this._long = e;
    }
    get latitude() {
      return this._lat;
    }
    get longitude() {
      return this._long;
    }
    isEqual(t2) {
      return this._lat === t2._lat && this._long === t2._long;
    }
    toJSON() {
      return {
        latitude: this._lat,
        longitude: this._long
      };
    }
    _compareTo(t2) {
      return rt(this._lat, t2._lat) || rt(this._long, t2._long);
    }
  };
  var mh = new RegExp("[~\\*/\\[\\]]");
  function gh(t2, e, n) {
    if (e.search(mh) >= 0)
      throw yh(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`, t2, false, void 0, n);
    try {
      return new Kc2(...e.split("."))._internalPath;
    } catch (s) {
      throw yh(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`, t2, false, void 0, n);
    }
  }
  function yh(t2, e, n, s, i) {
    const r = s && !s.isEmpty(), o = i !== void 0;
    let u = `Function ${e}() called with invalid data`;
    n && (u += " (via `toFirestore()`)"), u += ". ";
    let a = "";
    return (r || o) && (a += " (found", r && (a += ` in field ${s}`), o && (a += ` in document ${i}`), a += ")"), new Q2(G.INVALID_ARGUMENT, u + t2 + a);
  }
  var Ih = class {
    constructor(t2, e, n, s, i) {
      this._firestore = t2, this._userDataWriter = e, this._key = n, this._document = s, this._converter = i;
    }
    get id() {
      return this._key.path.lastSegment();
    }
    get ref() {
      return new wc2(this._firestore, this._converter, this._key);
    }
    exists() {
      return this._document !== null;
    }
    data() {
      if (this._document) {
        if (this._converter) {
          const t2 = new Th(this._firestore, this._userDataWriter, this._key, this._document, null);
          return this._converter.fromFirestore(t2);
        }
        return this._userDataWriter.convertValue(this._document.data.value);
      }
    }
    get(t2) {
      if (this._document) {
        const e = this._document.data.field(Eh("DocumentSnapshot.get", t2));
        if (e !== null)
          return this._userDataWriter.convertValue(e);
      }
    }
  };
  var Th = class extends Ih {
    data() {
      return super.data();
    }
  };
  function Eh(t2, e) {
    return typeof e == "string" ? gh(t2, e) : e instanceof Kc2 ? e._internalPath : e._delegate._internalPath;
  }
  var Ah = class {
    constructor(t2, e) {
      this.hasPendingWrites = t2, this.fromCache = e;
    }
    isEqual(t2) {
      return this.hasPendingWrites === t2.hasPendingWrites && this.fromCache === t2.fromCache;
    }
  };
  var Rh = class extends Ih {
    constructor(t2, e, n, s, i, r) {
      super(t2, e, n, s, r), this._firestore = t2, this._firestoreImpl = t2, this.metadata = i;
    }
    exists() {
      return super.exists();
    }
    data(t2 = {}) {
      if (this._document) {
        if (this._converter) {
          const e = new bh(this._firestore, this._userDataWriter, this._key, this._document, this.metadata, null);
          return this._converter.fromFirestore(e, t2);
        }
        return this._userDataWriter.convertValue(this._document.data.value, t2.serverTimestamps);
      }
    }
    get(t2, e = {}) {
      if (this._document) {
        const n = this._document.data.field(Eh("DocumentSnapshot.get", t2));
        if (n !== null)
          return this._userDataWriter.convertValue(n, e.serverTimestamps);
      }
    }
  };
  var bh = class extends Rh {
    data(t2 = {}) {
      return super.data(t2);
    }
  };
  var Ph = class {
    constructor(t2, e, n, s) {
      this._firestore = t2, this._userDataWriter = e, this._snapshot = s, this.metadata = new Ah(s.hasPendingWrites, s.fromCache), this.query = n;
    }
    get docs() {
      const t2 = [];
      return this.forEach((e) => t2.push(e)), t2;
    }
    get size() {
      return this._snapshot.docs.size;
    }
    get empty() {
      return this.size === 0;
    }
    forEach(t2, e) {
      this._snapshot.docs.forEach((n) => {
        t2.call(e, new bh(this._firestore, this._userDataWriter, n.key, n, new Ah(this._snapshot.mutatedKeys.has(n.key), this._snapshot.fromCache), this.query.converter));
      });
    }
    docChanges(t2 = {}) {
      const e = !!t2.includeMetadataChanges;
      if (e && this._snapshot.excludesMetadataChanges)
        throw new Q2(G.INVALID_ARGUMENT, "To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");
      return this._cachedChanges && this._cachedChangesIncludeMetadataChanges === e || (this._cachedChanges = function(t3, e2) {
        if (t3._snapshot.oldDocs.isEmpty()) {
          let e3 = 0;
          return t3._snapshot.docChanges.map((n) => ({
            type: "added",
            doc: new bh(t3._firestore, t3._userDataWriter, n.doc.key, n.doc, new Ah(t3._snapshot.mutatedKeys.has(n.doc.key), t3._snapshot.fromCache), t3.query.converter),
            oldIndex: -1,
            newIndex: e3++
          }));
        }
        {
          let n = t3._snapshot.oldDocs;
          return t3._snapshot.docChanges.filter((t4) => e2 || t4.type !== 3).map((e3) => {
            const s = new bh(t3._firestore, t3._userDataWriter, e3.doc.key, e3.doc, new Ah(t3._snapshot.mutatedKeys.has(e3.doc.key), t3._snapshot.fromCache), t3.query.converter);
            let i = -1, r = -1;
            return e3.type !== 0 && (i = n.indexOf(e3.doc.key), n = n.delete(e3.doc.key)), e3.type !== 1 && (n = n.add(e3.doc), r = n.indexOf(e3.doc.key)), {
              type: Vh(e3.type),
              doc: s,
              oldIndex: i,
              newIndex: r
            };
          });
        }
      }(this, e), this._cachedChangesIncludeMetadataChanges = e), this._cachedChanges;
    }
  };
  function Vh(t2) {
    switch (t2) {
      case 0:
        return "added";
      case 2:
      case 3:
        return "modified";
      case 1:
        return "removed";
      default:
        return L2();
    }
  }
  function Sh(t2) {
    if (t2.limitType === "L" && t2.explicitOrderBy.length === 0)
      throw new Q2(G.UNIMPLEMENTED, "limitToLast() queries require specifying at least one orderBy() clause");
  }
  var Jh = class {
    convertValue(t2, e = "none") {
      switch (Mt(t2)) {
        case 0:
          return null;
        case 1:
          return t2.booleanValue;
        case 2:
          return Et(t2.integerValue || t2.doubleValue);
        case 3:
          return this.convertTimestamp(t2.timestampValue);
        case 4:
          return this.convertServerTimestamp(t2, e);
        case 5:
          return t2.stringValue;
        case 6:
          return this.convertBytes(At(t2.bytesValue));
        case 7:
          return this.convertReference(t2.referenceValue);
        case 8:
          return this.convertGeoPoint(t2.geoPointValue);
        case 9:
          return this.convertArray(t2.arrayValue, e);
        case 10:
          return this.convertObject(t2.mapValue, e);
        default:
          throw L2();
      }
    }
    convertObject(t2, e) {
      const n = {};
      return lt(t2.fields, (t3, s) => {
        n[t3] = this.convertValue(s, e);
      }), n;
    }
    convertGeoPoint(t2) {
      return new Wc2(Et(t2.latitude), Et(t2.longitude));
    }
    convertArray(t2, e) {
      return (t2.values || []).map((t3) => this.convertValue(t3, e));
    }
    convertServerTimestamp(t2, e) {
      switch (e) {
        case "previous":
          const n = bt(t2);
          return n == null ? null : this.convertValue(n, e);
        case "estimate":
          return this.convertTimestamp(Pt(t2));
        default:
          return null;
      }
    }
    convertTimestamp(t2) {
      const e = Tt(t2);
      return new at(e.seconds, e.nanos);
    }
    convertDocumentKey(t2, e) {
      const n = _t.fromString(t2);
      U2(Ks(n));
      const s = new vt(n.get(1), n.get(3)), i = new xt(n.popFirst(5));
      return s.isEqual(e) || F2(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`), i;
    }
  };
  var nl = class extends Jh {
    constructor(t2) {
      super(), this.firestore = t2;
    }
    convertBytes(t2) {
      return new Qc2(t2);
    }
    convertReference(t2) {
      const e = this.convertDocumentKey(t2, this.firestore._databaseId);
      return new wc2(this.firestore, null, e);
    }
  };
  function rl(t2) {
    t2 = hc2(t2, mc2);
    const e = hc2(t2.firestore, Vc2), n = Dc2(e), s = new nl(e);
    return Sh(t2._query), Za2(n, t2._query).then((n2) => new Ph(e, s, t2, n2));
  }
  !function(t2, e = true) {
    !function(t3) {
      x2 = t3;
    }(SDK_VERSION), _registerComponent(new Component("firestore", (t3, { options: n }) => {
      const s = t3.getProvider("app").getImmediate(), i = new Vc2(s, new J2(t3.getProvider("auth-internal")), new tt(t3.getProvider("app-check-internal")));
      return n = Object.assign({
        useFetchStreams: e
      }, n), i._setSettings(n), i;
    }, "PUBLIC")), registerVersion(D2, "3.4.9", t2), registerVersion(D2, "3.4.9", "esm2017");
  }();

  // src/index.js
  var firebaseConfig = {
    apiKey: "AIzaSyCbMamMISViMpNtw4JXQGqn-J5VxUMyMKs",
    authDomain: "firstpage-f9dde.firebaseapp.com",
    projectId: "firstpage-f9dde",
    storageBucket: "firstpage-f9dde.appspot.com",
    messagingSenderId: "120347697336",
    appId: "1:120347697336:web:e96e3d451ea24e34b6d44d"
  };
  var app = initializeApp(firebaseConfig);
  var db2 = Sc2();
  var colUsers = yc2(db2, "users");
  rl(colUsers).then((snapshot) => {
    let users = [];
    snapshot.docs.forEach((doc) => {
      users.push(__spreadProps(__spreadValues({}, doc.data()), { id: doc.id }));
    });
    console.log(users);
  }).catch((err) => {
    console.log(err.message);
  });
})();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vbm9kZV9tb2R1bGVzLy5wbnBtL0BmaXJlYmFzZSt1dGlsQDEuNi4wL25vZGVfbW9kdWxlcy9AZmlyZWJhc2UvdXRpbC9zcmMvY29uc3RhbnRzLnRzIiwgIi4uL25vZGVfbW9kdWxlcy8ucG5wbS9AZmlyZWJhc2UrdXRpbEAxLjYuMC9ub2RlX21vZHVsZXMvQGZpcmViYXNlL3V0aWwvc3JjL2Fzc2VydC50cyIsICIuLi9ub2RlX21vZHVsZXMvLnBucG0vQGZpcmViYXNlK3V0aWxAMS42LjAvbm9kZV9tb2R1bGVzL0BmaXJlYmFzZS91dGlsL3NyYy9jcnlwdC50cyIsICIuLi9ub2RlX21vZHVsZXMvLnBucG0vQGZpcmViYXNlK3V0aWxAMS42LjAvbm9kZV9tb2R1bGVzL0BmaXJlYmFzZS91dGlsL3NyYy9kZWVwQ29weS50cyIsICIuLi9ub2RlX21vZHVsZXMvLnBucG0vQGZpcmViYXNlK3V0aWxAMS42LjAvbm9kZV9tb2R1bGVzL0BmaXJlYmFzZS91dGlsL3NyYy9kZWZlcnJlZC50cyIsICIuLi9ub2RlX21vZHVsZXMvLnBucG0vQGZpcmViYXNlK3V0aWxAMS42LjAvbm9kZV9tb2R1bGVzL0BmaXJlYmFzZS91dGlsL3NyYy9lbXVsYXRvci50cyIsICIuLi9ub2RlX21vZHVsZXMvLnBucG0vQGZpcmViYXNlK3V0aWxAMS42LjAvbm9kZV9tb2R1bGVzL0BmaXJlYmFzZS91dGlsL3NyYy9lbnZpcm9ubWVudC50cyIsICIuLi9ub2RlX21vZHVsZXMvLnBucG0vQGZpcmViYXNlK3V0aWxAMS42LjAvbm9kZV9tb2R1bGVzL0BmaXJlYmFzZS91dGlsL3NyYy9lcnJvcnMudHMiLCAiLi4vbm9kZV9tb2R1bGVzLy5wbnBtL0BmaXJlYmFzZSt1dGlsQDEuNi4wL25vZGVfbW9kdWxlcy9AZmlyZWJhc2UvdXRpbC9zcmMvanNvbi50cyIsICIuLi9ub2RlX21vZHVsZXMvLnBucG0vQGZpcmViYXNlK3V0aWxAMS42LjAvbm9kZV9tb2R1bGVzL0BmaXJlYmFzZS91dGlsL3NyYy9qd3QudHMiLCAiLi4vbm9kZV9tb2R1bGVzLy5wbnBtL0BmaXJlYmFzZSt1dGlsQDEuNi4wL25vZGVfbW9kdWxlcy9AZmlyZWJhc2UvdXRpbC9zcmMvb2JqLnRzIiwgIi4uL25vZGVfbW9kdWxlcy8ucG5wbS9AZmlyZWJhc2UrdXRpbEAxLjYuMC9ub2RlX21vZHVsZXMvQGZpcmViYXNlL3V0aWwvc3JjL3F1ZXJ5LnRzIiwgIi4uL25vZGVfbW9kdWxlcy8ucG5wbS9AZmlyZWJhc2UrdXRpbEAxLjYuMC9ub2RlX21vZHVsZXMvQGZpcmViYXNlL3V0aWwvc3JjL3NoYTEudHMiLCAiLi4vbm9kZV9tb2R1bGVzLy5wbnBtL0BmaXJlYmFzZSt1dGlsQDEuNi4wL25vZGVfbW9kdWxlcy9AZmlyZWJhc2UvdXRpbC9zcmMvc3Vic2NyaWJlLnRzIiwgIi4uL25vZGVfbW9kdWxlcy8ucG5wbS9AZmlyZWJhc2UrdXRpbEAxLjYuMC9ub2RlX21vZHVsZXMvQGZpcmViYXNlL3V0aWwvc3JjL3ZhbGlkYXRpb24udHMiLCAiLi4vbm9kZV9tb2R1bGVzLy5wbnBtL0BmaXJlYmFzZSt1dGlsQDEuNi4wL25vZGVfbW9kdWxlcy9AZmlyZWJhc2UvdXRpbC9zcmMvdXRmOC50cyIsICIuLi9ub2RlX21vZHVsZXMvLnBucG0vQGZpcmViYXNlK3V0aWxAMS42LjAvbm9kZV9tb2R1bGVzL0BmaXJlYmFzZS91dGlsL3NyYy9leHBvbmVudGlhbF9iYWNrb2ZmLnRzIiwgIi4uL25vZGVfbW9kdWxlcy8ucG5wbS9AZmlyZWJhc2UrdXRpbEAxLjYuMC9ub2RlX21vZHVsZXMvQGZpcmViYXNlL3V0aWwvc3JjL2Zvcm1hdHRlcnMudHMiLCAiLi4vbm9kZV9tb2R1bGVzLy5wbnBtL0BmaXJlYmFzZSt1dGlsQDEuNi4wL25vZGVfbW9kdWxlcy9AZmlyZWJhc2UvdXRpbC9zcmMvY29tcGF0LnRzIiwgIi4uL25vZGVfbW9kdWxlcy8ucG5wbS9AZmlyZWJhc2UrY29tcG9uZW50QDAuNS4xNC9ub2RlX21vZHVsZXMvQGZpcmViYXNlL2NvbXBvbmVudC9zcmMvY29tcG9uZW50LnRzIiwgIi4uL25vZGVfbW9kdWxlcy8ucG5wbS9AZmlyZWJhc2UrY29tcG9uZW50QDAuNS4xNC9ub2RlX21vZHVsZXMvQGZpcmViYXNlL2NvbXBvbmVudC9zcmMvY29uc3RhbnRzLnRzIiwgIi4uL25vZGVfbW9kdWxlcy8ucG5wbS9AZmlyZWJhc2UrY29tcG9uZW50QDAuNS4xNC9ub2RlX21vZHVsZXMvQGZpcmViYXNlL2NvbXBvbmVudC9zcmMvcHJvdmlkZXIudHMiLCAiLi4vbm9kZV9tb2R1bGVzLy5wbnBtL0BmaXJlYmFzZStjb21wb25lbnRAMC41LjE0L25vZGVfbW9kdWxlcy9AZmlyZWJhc2UvY29tcG9uZW50L3NyYy9jb21wb25lbnRfY29udGFpbmVyLnRzIiwgIi4uL25vZGVfbW9kdWxlcy8ucG5wbS9AZmlyZWJhc2UrbG9nZ2VyQDAuMy4yL25vZGVfbW9kdWxlcy9AZmlyZWJhc2UvbG9nZ2VyL3NyYy9sb2dnZXIudHMiLCAiLi4vbm9kZV9tb2R1bGVzLy5wbnBtL2lkYkA3LjAuMS9ub2RlX21vZHVsZXMvaWRiL2J1aWxkL3dyYXAtaWRiLXZhbHVlLmpzIiwgIi4uL25vZGVfbW9kdWxlcy8ucG5wbS9pZGJANy4wLjEvbm9kZV9tb2R1bGVzL2lkYi9idWlsZC9pbmRleC5qcyIsICIuLi9ub2RlX21vZHVsZXMvLnBucG0vQGZpcmViYXNlK2FwcEAwLjcuMjUvbm9kZV9tb2R1bGVzL0BmaXJlYmFzZS9hcHAvc3JjL3BsYXRmb3JtTG9nZ2VyU2VydmljZS50cyIsICIuLi9ub2RlX21vZHVsZXMvLnBucG0vQGZpcmViYXNlK2FwcEAwLjcuMjUvbm9kZV9tb2R1bGVzL0BmaXJlYmFzZS9hcHAvc3JjL2xvZ2dlci50cyIsICIuLi9ub2RlX21vZHVsZXMvLnBucG0vQGZpcmViYXNlK2FwcEAwLjcuMjUvbm9kZV9tb2R1bGVzL0BmaXJlYmFzZS9hcHAvc3JjL2NvbnN0YW50cy50cyIsICIuLi9ub2RlX21vZHVsZXMvLnBucG0vQGZpcmViYXNlK2FwcEAwLjcuMjUvbm9kZV9tb2R1bGVzL0BmaXJlYmFzZS9hcHAvc3JjL2ludGVybmFsLnRzIiwgIi4uL25vZGVfbW9kdWxlcy8ucG5wbS9AZmlyZWJhc2UrYXBwQDAuNy4yNS9ub2RlX21vZHVsZXMvQGZpcmViYXNlL2FwcC9zcmMvZXJyb3JzLnRzIiwgIi4uL25vZGVfbW9kdWxlcy8ucG5wbS9AZmlyZWJhc2UrYXBwQDAuNy4yNS9ub2RlX21vZHVsZXMvQGZpcmViYXNlL2FwcC9zcmMvZmlyZWJhc2VBcHAudHMiLCAiLi4vbm9kZV9tb2R1bGVzLy5wbnBtL0BmaXJlYmFzZSthcHBAMC43LjI1L25vZGVfbW9kdWxlcy9AZmlyZWJhc2UvYXBwL3NyYy9hcGkudHMiLCAiLi4vbm9kZV9tb2R1bGVzLy5wbnBtL0BmaXJlYmFzZSthcHBAMC43LjI1L25vZGVfbW9kdWxlcy9AZmlyZWJhc2UvYXBwL3NyYy9pbmRleGVkZGIudHMiLCAiLi4vbm9kZV9tb2R1bGVzLy5wbnBtL0BmaXJlYmFzZSthcHBAMC43LjI1L25vZGVfbW9kdWxlcy9AZmlyZWJhc2UvYXBwL3NyYy9oZWFydGJlYXRTZXJ2aWNlLnRzIiwgIi4uL25vZGVfbW9kdWxlcy8ucG5wbS9AZmlyZWJhc2UrYXBwQDAuNy4yNS9ub2RlX21vZHVsZXMvQGZpcmViYXNlL2FwcC9zcmMvcmVnaXN0ZXJDb3JlQ29tcG9uZW50cy50cyIsICIuLi9ub2RlX21vZHVsZXMvLnBucG0vQGZpcmViYXNlK2FwcEAwLjcuMjUvbm9kZV9tb2R1bGVzL0BmaXJlYmFzZS9hcHAvc3JjL2luZGV4LnRzIiwgIi4uL25vZGVfbW9kdWxlcy8ucG5wbS9maXJlYmFzZUA5LjguMi9ub2RlX21vZHVsZXMvZmlyZWJhc2UvYXBwL2luZGV4LnRzIiwgIi4uL25vZGVfbW9kdWxlcy8ucG5wbS9AZmlyZWJhc2Urd2ViY2hhbm5lbC13cmFwcGVyQDAuNi4xL25vZGVfbW9kdWxlcy9AZmlyZWJhc2Uvd2ViY2hhbm5lbC13cmFwcGVyL25vZGVfbW9kdWxlcy9nb29nbGUtY2xvc3VyZS1saWJyYXJ5L2Nsb3N1cmUvZ29vZy9iYXNlLmpzIiwgIi4uL25vZGVfbW9kdWxlcy8ucG5wbS9AZmlyZWJhc2Urd2ViY2hhbm5lbC13cmFwcGVyQDAuNi4xL25vZGVfbW9kdWxlcy9AZmlyZWJhc2Uvd2ViY2hhbm5lbC13cmFwcGVyL25vZGVfbW9kdWxlcy9nb29nbGUtY2xvc3VyZS1saWJyYXJ5L2Nsb3N1cmUvZ29vZy9kaXNwb3NhYmxlL2Rpc3Bvc2FibGUuanMiLCAiLi4vbm9kZV9tb2R1bGVzLy5wbnBtL0BmaXJlYmFzZSt3ZWJjaGFubmVsLXdyYXBwZXJAMC42LjEvbm9kZV9tb2R1bGVzL0BmaXJlYmFzZS93ZWJjaGFubmVsLXdyYXBwZXIvbm9kZV9tb2R1bGVzL2dvb2dsZS1jbG9zdXJlLWxpYnJhcnkvY2xvc3VyZS9nb29nL2FycmF5L2FycmF5LmpzIiwgIi4uL25vZGVfbW9kdWxlcy8ucG5wbS9AZmlyZWJhc2Urd2ViY2hhbm5lbC13cmFwcGVyQDAuNi4xL25vZGVfbW9kdWxlcy9AZmlyZWJhc2Uvd2ViY2hhbm5lbC13cmFwcGVyL25vZGVfbW9kdWxlcy9nb29nbGUtY2xvc3VyZS1saWJyYXJ5L2Nsb3N1cmUvZ29vZy9uZXQveGhyaW8uanMiLCAiLi4vbm9kZV9tb2R1bGVzLy5wbnBtL0BmaXJlYmFzZSt3ZWJjaGFubmVsLXdyYXBwZXJAMC42LjEvbm9kZV9tb2R1bGVzL0BmaXJlYmFzZS93ZWJjaGFubmVsLXdyYXBwZXIvbm9kZV9tb2R1bGVzL2dvb2dsZS1jbG9zdXJlLWxpYnJhcnkvY2xvc3VyZS9nb29nL3N0cmluZy9pbnRlcm5hbC5qcyIsICIuLi9ub2RlX21vZHVsZXMvLnBucG0vQGZpcmViYXNlK3dlYmNoYW5uZWwtd3JhcHBlckAwLjYuMS9ub2RlX21vZHVsZXMvQGZpcmViYXNlL3dlYmNoYW5uZWwtd3JhcHBlci9ub2RlX21vZHVsZXMvZ29vZ2xlLWNsb3N1cmUtbGlicmFyeS9jbG9zdXJlL2dvb2cvbGFicy91c2VyYWdlbnQvdXRpbC5qcyIsICIuLi9ub2RlX21vZHVsZXMvLnBucG0vQGZpcmViYXNlK3dlYmNoYW5uZWwtd3JhcHBlckAwLjYuMS9ub2RlX21vZHVsZXMvQGZpcmViYXNlL3dlYmNoYW5uZWwtd3JhcHBlci9ub2RlX21vZHVsZXMvZ29vZ2xlLWNsb3N1cmUtbGlicmFyeS9jbG9zdXJlL2dvb2cvb2JqZWN0L29iamVjdC5qcyIsICIuLi9ub2RlX21vZHVsZXMvLnBucG0vQGZpcmViYXNlK3dlYmNoYW5uZWwtd3JhcHBlckAwLjYuMS9ub2RlX21vZHVsZXMvQGZpcmViYXNlL3dlYmNoYW5uZWwtd3JhcHBlci9ub2RlX21vZHVsZXMvZ29vZ2xlLWNsb3N1cmUtbGlicmFyeS9jbG9zdXJlL2dvb2cvcmVmbGVjdC9yZWZsZWN0LmpzIiwgIi4uL25vZGVfbW9kdWxlcy8ucG5wbS9AZmlyZWJhc2Urd2ViY2hhbm5lbC13cmFwcGVyQDAuNi4xL25vZGVfbW9kdWxlcy9AZmlyZWJhc2Uvd2ViY2hhbm5lbC13cmFwcGVyL25vZGVfbW9kdWxlcy9nb29nbGUtY2xvc3VyZS1saWJyYXJ5L2Nsb3N1cmUvZ29vZy91c2VyYWdlbnQvdXNlcmFnZW50LmpzIiwgIi4uL25vZGVfbW9kdWxlcy8ucG5wbS9AZmlyZWJhc2Urd2ViY2hhbm5lbC13cmFwcGVyQDAuNi4xL25vZGVfbW9kdWxlcy9AZmlyZWJhc2Uvd2ViY2hhbm5lbC13cmFwcGVyL25vZGVfbW9kdWxlcy9nb29nbGUtY2xvc3VyZS1saWJyYXJ5L2Nsb3N1cmUvZ29vZy9sYWJzL3VzZXJhZ2VudC9icm93c2VyLmpzIiwgIi4uL25vZGVfbW9kdWxlcy8ucG5wbS9AZmlyZWJhc2Urd2ViY2hhbm5lbC13cmFwcGVyQDAuNi4xL25vZGVfbW9kdWxlcy9AZmlyZWJhc2Uvd2ViY2hhbm5lbC13cmFwcGVyL25vZGVfbW9kdWxlcy9nb29nbGUtY2xvc3VyZS1saWJyYXJ5L2Nsb3N1cmUvZ29vZy9sYWJzL3VzZXJhZ2VudC9lbmdpbmUuanMiLCAiLi4vbm9kZV9tb2R1bGVzLy5wbnBtL0BmaXJlYmFzZSt3ZWJjaGFubmVsLXdyYXBwZXJAMC42LjEvbm9kZV9tb2R1bGVzL0BmaXJlYmFzZS93ZWJjaGFubmVsLXdyYXBwZXIvbm9kZV9tb2R1bGVzL2dvb2dsZS1jbG9zdXJlLWxpYnJhcnkvY2xvc3VyZS9nb29nL2V2ZW50cy9icm93c2VyZmVhdHVyZS5qcyIsICIuLi9ub2RlX21vZHVsZXMvLnBucG0vQGZpcmViYXNlK3dlYmNoYW5uZWwtd3JhcHBlckAwLjYuMS9ub2RlX21vZHVsZXMvQGZpcmViYXNlL3dlYmNoYW5uZWwtd3JhcHBlci9ub2RlX21vZHVsZXMvZ29vZ2xlLWNsb3N1cmUtbGlicmFyeS9jbG9zdXJlL2dvb2cvZXZlbnRzL2V2ZW50LmpzIiwgIi4uL25vZGVfbW9kdWxlcy8ucG5wbS9AZmlyZWJhc2Urd2ViY2hhbm5lbC13cmFwcGVyQDAuNi4xL25vZGVfbW9kdWxlcy9AZmlyZWJhc2Uvd2ViY2hhbm5lbC13cmFwcGVyL25vZGVfbW9kdWxlcy9nb29nbGUtY2xvc3VyZS1saWJyYXJ5L2Nsb3N1cmUvZ29vZy9ldmVudHMvYnJvd3NlcmV2ZW50LmpzIiwgIi4uL25vZGVfbW9kdWxlcy8ucG5wbS9AZmlyZWJhc2Urd2ViY2hhbm5lbC13cmFwcGVyQDAuNi4xL25vZGVfbW9kdWxlcy9AZmlyZWJhc2Uvd2ViY2hhbm5lbC13cmFwcGVyL25vZGVfbW9kdWxlcy9nb29nbGUtY2xvc3VyZS1saWJyYXJ5L2Nsb3N1cmUvZ29vZy9ldmVudHMvZXZlbnR0eXBlLmpzIiwgIi4uL25vZGVfbW9kdWxlcy8ucG5wbS9AZmlyZWJhc2Urd2ViY2hhbm5lbC13cmFwcGVyQDAuNi4xL25vZGVfbW9kdWxlcy9AZmlyZWJhc2Uvd2ViY2hhbm5lbC13cmFwcGVyL25vZGVfbW9kdWxlcy9nb29nbGUtY2xvc3VyZS1saWJyYXJ5L2Nsb3N1cmUvZ29vZy9ldmVudHMvbGlzdGVuYWJsZS5qcyIsICIuLi9ub2RlX21vZHVsZXMvLnBucG0vQGZpcmViYXNlK3dlYmNoYW5uZWwtd3JhcHBlckAwLjYuMS9ub2RlX21vZHVsZXMvQGZpcmViYXNlL3dlYmNoYW5uZWwtd3JhcHBlci9ub2RlX21vZHVsZXMvZ29vZ2xlLWNsb3N1cmUtbGlicmFyeS9jbG9zdXJlL2dvb2cvZXZlbnRzL2xpc3RlbmFibGVrZXkuanMiLCAiLi4vbm9kZV9tb2R1bGVzLy5wbnBtL0BmaXJlYmFzZSt3ZWJjaGFubmVsLXdyYXBwZXJAMC42LjEvbm9kZV9tb2R1bGVzL0BmaXJlYmFzZS93ZWJjaGFubmVsLXdyYXBwZXIvbm9kZV9tb2R1bGVzL2dvb2dsZS1jbG9zdXJlLWxpYnJhcnkvY2xvc3VyZS9nb29nL2V2ZW50cy9saXN0ZW5lci5qcyIsICIuLi9ub2RlX21vZHVsZXMvLnBucG0vQGZpcmViYXNlK3dlYmNoYW5uZWwtd3JhcHBlckAwLjYuMS9ub2RlX21vZHVsZXMvQGZpcmViYXNlL3dlYmNoYW5uZWwtd3JhcHBlci9ub2RlX21vZHVsZXMvZ29vZ2xlLWNsb3N1cmUtbGlicmFyeS9jbG9zdXJlL2dvb2cvZXZlbnRzL2xpc3RlbmVybWFwLmpzIiwgIi4uL25vZGVfbW9kdWxlcy8ucG5wbS9AZmlyZWJhc2Urd2ViY2hhbm5lbC13cmFwcGVyQDAuNi4xL25vZGVfbW9kdWxlcy9AZmlyZWJhc2Uvd2ViY2hhbm5lbC13cmFwcGVyL25vZGVfbW9kdWxlcy9nb29nbGUtY2xvc3VyZS1saWJyYXJ5L2Nsb3N1cmUvZ29vZy9ldmVudHMvZXZlbnRzLmpzIiwgIi4uL25vZGVfbW9kdWxlcy8ucG5wbS9AZmlyZWJhc2Urd2ViY2hhbm5lbC13cmFwcGVyQDAuNi4xL25vZGVfbW9kdWxlcy9AZmlyZWJhc2Uvd2ViY2hhbm5lbC13cmFwcGVyL25vZGVfbW9kdWxlcy9nb29nbGUtY2xvc3VyZS1saWJyYXJ5L2Nsb3N1cmUvZ29vZy9ldmVudHMvZXZlbnR0YXJnZXQuanMiLCAiLi4vbm9kZV9tb2R1bGVzLy5wbnBtL0BmaXJlYmFzZSt3ZWJjaGFubmVsLXdyYXBwZXJAMC42LjEvbm9kZV9tb2R1bGVzL0BmaXJlYmFzZS93ZWJjaGFubmVsLXdyYXBwZXIvbm9kZV9tb2R1bGVzL2dvb2dsZS1jbG9zdXJlLWxpYnJhcnkvY2xvc3VyZS9nb29nL2pzb24vanNvbi5qcyIsICIuLi9ub2RlX21vZHVsZXMvLnBucG0vQGZpcmViYXNlK3dlYmNoYW5uZWwtd3JhcHBlckAwLjYuMS9ub2RlX21vZHVsZXMvQGZpcmViYXNlL3dlYmNoYW5uZWwtd3JhcHBlci9ub2RlX21vZHVsZXMvZ29vZ2xlLWNsb3N1cmUtbGlicmFyeS9jbG9zdXJlL2dvb2cvYXN5bmMvd29ya3F1ZXVlLmpzIiwgIi4uL25vZGVfbW9kdWxlcy8ucG5wbS9AZmlyZWJhc2Urd2ViY2hhbm5lbC13cmFwcGVyQDAuNi4xL25vZGVfbW9kdWxlcy9AZmlyZWJhc2Uvd2ViY2hhbm5lbC13cmFwcGVyL25vZGVfbW9kdWxlcy9nb29nbGUtY2xvc3VyZS1saWJyYXJ5L2Nsb3N1cmUvZ29vZy9hc3luYy9ydW4uanMiLCAiLi4vbm9kZV9tb2R1bGVzLy5wbnBtL0BmaXJlYmFzZSt3ZWJjaGFubmVsLXdyYXBwZXJAMC42LjEvbm9kZV9tb2R1bGVzL0BmaXJlYmFzZS93ZWJjaGFubmVsLXdyYXBwZXIvbm9kZV9tb2R1bGVzL2dvb2dsZS1jbG9zdXJlLWxpYnJhcnkvY2xvc3VyZS9nb29nL2FzeW5jL2ZyZWVsaXN0LmpzIiwgIi4uL25vZGVfbW9kdWxlcy8ucG5wbS9AZmlyZWJhc2Urd2ViY2hhbm5lbC13cmFwcGVyQDAuNi4xL25vZGVfbW9kdWxlcy9AZmlyZWJhc2Uvd2ViY2hhbm5lbC13cmFwcGVyL25vZGVfbW9kdWxlcy9nb29nbGUtY2xvc3VyZS1saWJyYXJ5L2Nsb3N1cmUvZ29vZy9hc3luYy90aHJvd2V4Y2VwdGlvbi5qcyIsICIuLi9ub2RlX21vZHVsZXMvLnBucG0vQGZpcmViYXNlK3dlYmNoYW5uZWwtd3JhcHBlckAwLjYuMS9ub2RlX21vZHVsZXMvQGZpcmViYXNlL3dlYmNoYW5uZWwtd3JhcHBlci9ub2RlX21vZHVsZXMvZ29vZ2xlLWNsb3N1cmUtbGlicmFyeS9jbG9zdXJlL2dvb2cvdGltZXIvdGltZXIuanMiLCAiLi4vbm9kZV9tb2R1bGVzLy5wbnBtL0BmaXJlYmFzZSt3ZWJjaGFubmVsLXdyYXBwZXJAMC42LjEvbm9kZV9tb2R1bGVzL0BmaXJlYmFzZS93ZWJjaGFubmVsLXdyYXBwZXIvbm9kZV9tb2R1bGVzL2dvb2dsZS1jbG9zdXJlLWxpYnJhcnkvY2xvc3VyZS9nb29nL2FzeW5jL3Rocm90dGxlLmpzIiwgIi4uL25vZGVfbW9kdWxlcy8ucG5wbS9AZmlyZWJhc2Urd2ViY2hhbm5lbC13cmFwcGVyQDAuNi4xL25vZGVfbW9kdWxlcy9AZmlyZWJhc2Uvd2ViY2hhbm5lbC13cmFwcGVyL25vZGVfbW9kdWxlcy9nb29nbGUtY2xvc3VyZS1saWJyYXJ5L2Nsb3N1cmUvZ29vZy9ldmVudHMvZXZlbnRoYW5kbGVyLmpzIiwgIi4uL25vZGVfbW9kdWxlcy8ucG5wbS9AZmlyZWJhc2Urd2ViY2hhbm5lbC13cmFwcGVyQDAuNi4xL25vZGVfbW9kdWxlcy9AZmlyZWJhc2Uvd2ViY2hhbm5lbC13cmFwcGVyL25vZGVfbW9kdWxlcy9nb29nbGUtY2xvc3VyZS1saWJyYXJ5L2Nsb3N1cmUvZ29vZy9sYWJzL25ldC93ZWJjaGFubmVsL3dlYmNoYW5uZWxkZWJ1Zy5qcyIsICIuLi9ub2RlX21vZHVsZXMvLnBucG0vQGZpcmViYXNlK3dlYmNoYW5uZWwtd3JhcHBlckAwLjYuMS9ub2RlX21vZHVsZXMvQGZpcmViYXNlL3dlYmNoYW5uZWwtd3JhcHBlci9ub2RlX21vZHVsZXMvZ29vZ2xlLWNsb3N1cmUtbGlicmFyeS9jbG9zdXJlL2dvb2cvbGFicy9uZXQvd2ViY2hhbm5lbC9yZXF1ZXN0c3RhdHMuanMiLCAiLi4vbm9kZV9tb2R1bGVzLy5wbnBtL0BmaXJlYmFzZSt3ZWJjaGFubmVsLXdyYXBwZXJAMC42LjEvbm9kZV9tb2R1bGVzL0BmaXJlYmFzZS93ZWJjaGFubmVsLXdyYXBwZXIvbm9kZV9tb2R1bGVzL2dvb2dsZS1jbG9zdXJlLWxpYnJhcnkvY2xvc3VyZS9nb29nL25ldC9lcnJvcmNvZGUuanMiLCAiLi4vbm9kZV9tb2R1bGVzLy5wbnBtL0BmaXJlYmFzZSt3ZWJjaGFubmVsLXdyYXBwZXJAMC42LjEvbm9kZV9tb2R1bGVzL0BmaXJlYmFzZS93ZWJjaGFubmVsLXdyYXBwZXIvbm9kZV9tb2R1bGVzL2dvb2dsZS1jbG9zdXJlLWxpYnJhcnkvY2xvc3VyZS9nb29nL25ldC9ldmVudHR5cGUuanMiLCAiLi4vbm9kZV9tb2R1bGVzLy5wbnBtL0BmaXJlYmFzZSt3ZWJjaGFubmVsLXdyYXBwZXJAMC42LjEvbm9kZV9tb2R1bGVzL0BmaXJlYmFzZS93ZWJjaGFubmVsLXdyYXBwZXIvbm9kZV9tb2R1bGVzL2dvb2dsZS1jbG9zdXJlLWxpYnJhcnkvY2xvc3VyZS9nb29nL25ldC94bWxodHRwZmFjdG9yeS5qcyIsICIuLi9ub2RlX21vZHVsZXMvLnBucG0vQGZpcmViYXNlK3dlYmNoYW5uZWwtd3JhcHBlckAwLjYuMS9ub2RlX21vZHVsZXMvQGZpcmViYXNlL3dlYmNoYW5uZWwtd3JhcHBlci9ub2RlX21vZHVsZXMvZ29vZ2xlLWNsb3N1cmUtbGlicmFyeS9jbG9zdXJlL2dvb2cvbGFicy9uZXQvd2ViY2hhbm5lbC5qcyIsICIuLi9ub2RlX21vZHVsZXMvLnBucG0vQGZpcmViYXNlK3dlYmNoYW5uZWwtd3JhcHBlckAwLjYuMS9ub2RlX21vZHVsZXMvQGZpcmViYXNlL3dlYmNoYW5uZWwtd3JhcHBlci9ub2RlX21vZHVsZXMvZ29vZ2xlLWNsb3N1cmUtbGlicmFyeS9jbG9zdXJlL2dvb2cvbmV0L3htbGh0dHAuanMiLCAiLi4vbm9kZV9tb2R1bGVzLy5wbnBtL0BmaXJlYmFzZSt3ZWJjaGFubmVsLXdyYXBwZXJAMC42LjEvbm9kZV9tb2R1bGVzL0BmaXJlYmFzZS93ZWJjaGFubmVsLXdyYXBwZXIvbm9kZV9tb2R1bGVzL2dvb2dsZS1jbG9zdXJlLWxpYnJhcnkvY2xvc3VyZS9nb29nL2xhYnMvbmV0L3dlYmNoYW5uZWwvY2hhbm5lbHJlcXVlc3QuanMiLCAiLi4vbm9kZV9tb2R1bGVzLy5wbnBtL0BmaXJlYmFzZSt3ZWJjaGFubmVsLXdyYXBwZXJAMC42LjEvbm9kZV9tb2R1bGVzL0BmaXJlYmFzZS93ZWJjaGFubmVsLXdyYXBwZXIvbm9kZV9tb2R1bGVzL2dvb2dsZS1jbG9zdXJlLWxpYnJhcnkvY2xvc3VyZS9nb29nL2xhYnMvbmV0L3dlYmNoYW5uZWwvZW52aXJvbm1lbnQuanMiLCAiLi4vbm9kZV9tb2R1bGVzLy5wbnBtL0BmaXJlYmFzZSt3ZWJjaGFubmVsLXdyYXBwZXJAMC42LjEvbm9kZV9tb2R1bGVzL0BmaXJlYmFzZS93ZWJjaGFubmVsLXdyYXBwZXIvbm9kZV9tb2R1bGVzL2dvb2dsZS1jbG9zdXJlLWxpYnJhcnkvY2xvc3VyZS9nb29nL2xhYnMvbmV0L3dlYmNoYW5uZWwvd2ViY2hhbm5lbGJhc2UuanMiLCAiLi4vbm9kZV9tb2R1bGVzLy5wbnBtL0BmaXJlYmFzZSt3ZWJjaGFubmVsLXdyYXBwZXJAMC42LjEvbm9kZV9tb2R1bGVzL0BmaXJlYmFzZS93ZWJjaGFubmVsLXdyYXBwZXIvbm9kZV9tb2R1bGVzL2dvb2dsZS1jbG9zdXJlLWxpYnJhcnkvY2xvc3VyZS9nb29nL3VyaS91cmkuanMiLCAiLi4vbm9kZV9tb2R1bGVzLy5wbnBtL0BmaXJlYmFzZSt3ZWJjaGFubmVsLXdyYXBwZXJAMC42LjEvbm9kZV9tb2R1bGVzL0BmaXJlYmFzZS93ZWJjaGFubmVsLXdyYXBwZXIvbm9kZV9tb2R1bGVzL2dvb2dsZS1jbG9zdXJlLWxpYnJhcnkvY2xvc3VyZS9nb29nL3N0cmluZy9zdHJpbmcuanMiLCAiLi4vbm9kZV9tb2R1bGVzLy5wbnBtL0BmaXJlYmFzZSt3ZWJjaGFubmVsLXdyYXBwZXJAMC42LjEvbm9kZV9tb2R1bGVzL0BmaXJlYmFzZS93ZWJjaGFubmVsLXdyYXBwZXIvbm9kZV9tb2R1bGVzL2dvb2dsZS1jbG9zdXJlLWxpYnJhcnkvY2xvc3VyZS9nb29nL2Rpc3Bvc2FibGUvZGlzcG9zZS5qcyIsICIuLi9ub2RlX21vZHVsZXMvLnBucG0vQGZpcmViYXNlK3dlYmNoYW5uZWwtd3JhcHBlckAwLjYuMS9ub2RlX21vZHVsZXMvQGZpcmViYXNlL3dlYmNoYW5uZWwtd3JhcHBlci9ub2RlX21vZHVsZXMvZ29vZ2xlLWNsb3N1cmUtbGlicmFyeS9jbG9zdXJlL2dvb2cvbGFicy9uZXQvd2ViY2hhbm5lbC93aXJldjguanMiLCAiLi4vbm9kZV9tb2R1bGVzLy5wbnBtL0BmaXJlYmFzZSt3ZWJjaGFubmVsLXdyYXBwZXJAMC42LjEvbm9kZV9tb2R1bGVzL0BmaXJlYmFzZS93ZWJjaGFubmVsLXdyYXBwZXIvbm9kZV9tb2R1bGVzL2dvb2dsZS1jbG9zdXJlLWxpYnJhcnkvY2xvc3VyZS9nb29nL2xhYnMvbmV0L3dlYmNoYW5uZWwvZm9yd2FyZGNoYW5uZWxyZXF1ZXN0cG9vbC5qcyIsICIuLi9ub2RlX21vZHVsZXMvLnBucG0vQGZpcmViYXNlK3dlYmNoYW5uZWwtd3JhcHBlckAwLjYuMS9ub2RlX21vZHVsZXMvQGZpcmViYXNlL3dlYmNoYW5uZWwtd3JhcHBlci9ub2RlX21vZHVsZXMvZ29vZ2xlLWNsb3N1cmUtbGlicmFyeS9jbG9zdXJlL2dvb2cvc3RydWN0cy9zdHJ1Y3RzLmpzIiwgIi4uL25vZGVfbW9kdWxlcy8ucG5wbS9AZmlyZWJhc2Urd2ViY2hhbm5lbC13cmFwcGVyQDAuNi4xL25vZGVfbW9kdWxlcy9AZmlyZWJhc2Uvd2ViY2hhbm5lbC13cmFwcGVyL25vZGVfbW9kdWxlcy9nb29nbGUtY2xvc3VyZS1saWJyYXJ5L2Nsb3N1cmUvZ29vZy9zdHJ1Y3RzL21hcC5qcyIsICIuLi9ub2RlX21vZHVsZXMvLnBucG0vQGZpcmViYXNlK3dlYmNoYW5uZWwtd3JhcHBlckAwLjYuMS9ub2RlX21vZHVsZXMvQGZpcmViYXNlL3dlYmNoYW5uZWwtd3JhcHBlci9ub2RlX21vZHVsZXMvZ29vZ2xlLWNsb3N1cmUtbGlicmFyeS9jbG9zdXJlL2dvb2cvdXJpL3V0aWxzLmpzIiwgIi4uL25vZGVfbW9kdWxlcy8ucG5wbS9AZmlyZWJhc2Urd2ViY2hhbm5lbC13cmFwcGVyQDAuNi4xL25vZGVfbW9kdWxlcy9AZmlyZWJhc2Uvd2ViY2hhbm5lbC13cmFwcGVyL25vZGVfbW9kdWxlcy9nb29nbGUtY2xvc3VyZS1saWJyYXJ5L2Nsb3N1cmUvZ29vZy9sYWJzL25ldC93ZWJjaGFubmVsL3dpcmUuanMiLCAiLi4vbm9kZV9tb2R1bGVzLy5wbnBtL0BmaXJlYmFzZSt3ZWJjaGFubmVsLXdyYXBwZXJAMC42LjEvbm9kZV9tb2R1bGVzL0BmaXJlYmFzZS93ZWJjaGFubmVsLXdyYXBwZXIvbm9kZV9tb2R1bGVzL2dvb2dsZS1jbG9zdXJlLWxpYnJhcnkvY2xvc3VyZS9nb29nL2pzb24vbmF0aXZlanNvbnByb2Nlc3Nvci5qcyIsICIuLi9ub2RlX21vZHVsZXMvLnBucG0vQGZpcmViYXNlK3dlYmNoYW5uZWwtd3JhcHBlckAwLjYuMS9ub2RlX21vZHVsZXMvQGZpcmViYXNlL3dlYmNoYW5uZWwtd3JhcHBlci9ub2RlX21vZHVsZXMvZ29vZ2xlLWNsb3N1cmUtbGlicmFyeS9jbG9zdXJlL2dvb2cvbGFicy9uZXQvd2ViY2hhbm5lbC9uZXR1dGlscy5qcyIsICIuLi9ub2RlX21vZHVsZXMvLnBucG0vQGZpcmViYXNlK3dlYmNoYW5uZWwtd3JhcHBlckAwLjYuMS9ub2RlX21vZHVsZXMvQGZpcmViYXNlL3dlYmNoYW5uZWwtd3JhcHBlci9ub2RlX21vZHVsZXMvZ29vZ2xlLWNsb3N1cmUtbGlicmFyeS9jbG9zdXJlL2dvb2cvbmV0L2ZldGNoeG1saHR0cGZhY3RvcnkuanMiLCAiLi4vbm9kZV9tb2R1bGVzLy5wbnBtL0BmaXJlYmFzZSt3ZWJjaGFubmVsLXdyYXBwZXJAMC42LjEvbm9kZV9tb2R1bGVzL0BmaXJlYmFzZS93ZWJjaGFubmVsLXdyYXBwZXIvbm9kZV9tb2R1bGVzL2dvb2dsZS1jbG9zdXJlLWxpYnJhcnkvY2xvc3VyZS9nb29nL2Z1bmN0aW9ucy9mdW5jdGlvbnMuanMiLCAiLi4vbm9kZV9tb2R1bGVzLy5wbnBtL0BmaXJlYmFzZSt3ZWJjaGFubmVsLXdyYXBwZXJAMC42LjEvbm9kZV9tb2R1bGVzL0BmaXJlYmFzZS93ZWJjaGFubmVsLXdyYXBwZXIvbm9kZV9tb2R1bGVzL2dvb2dsZS1jbG9zdXJlLWxpYnJhcnkvY2xvc3VyZS9nb29nL2pzb24vaHlicmlkLmpzIiwgIi4uL25vZGVfbW9kdWxlcy8ucG5wbS9AZmlyZWJhc2Urd2ViY2hhbm5lbC13cmFwcGVyQDAuNi4xL25vZGVfbW9kdWxlcy9AZmlyZWJhc2Uvd2ViY2hhbm5lbC13cmFwcGVyL25vZGVfbW9kdWxlcy9nb29nbGUtY2xvc3VyZS1saWJyYXJ5L2Nsb3N1cmUvZ29vZy9uZXQvaHR0cHN0YXR1cy5qcyIsICIuLi9ub2RlX21vZHVsZXMvLnBucG0vQGZpcmViYXNlK3dlYmNoYW5uZWwtd3JhcHBlckAwLjYuMS9ub2RlX21vZHVsZXMvQGZpcmViYXNlL3dlYmNoYW5uZWwtd3JhcHBlci9ub2RlX21vZHVsZXMvZ29vZ2xlLWNsb3N1cmUtbGlicmFyeS9jbG9zdXJlL2dvb2cvbmV0L3JwYy9odHRwY29ycy5qcyIsICIuLi9ub2RlX21vZHVsZXMvLnBucG0vQGZpcmViYXNlK3dlYmNoYW5uZWwtd3JhcHBlckAwLjYuMS9ub2RlX21vZHVsZXMvQGZpcmViYXNlL3dlYmNoYW5uZWwtd3JhcHBlci9ub2RlX21vZHVsZXMvZ29vZ2xlLWNsb3N1cmUtbGlicmFyeS9jbG9zdXJlL2dvb2cvbGFicy9uZXQvd2ViY2hhbm5lbHRyYW5zcG9ydC5qcyIsICIuLi9ub2RlX21vZHVsZXMvLnBucG0vQGZpcmViYXNlK3dlYmNoYW5uZWwtd3JhcHBlckAwLjYuMS9ub2RlX21vZHVsZXMvQGZpcmViYXNlL3dlYmNoYW5uZWwtd3JhcHBlci9ub2RlX21vZHVsZXMvZ29vZ2xlLWNsb3N1cmUtbGlicmFyeS9jbG9zdXJlL2dvb2cvbGFicy9uZXQvd2ViY2hhbm5lbC93ZWJjaGFubmVsYmFzZXRyYW5zcG9ydC5qcyIsICIuLi9ub2RlX21vZHVsZXMvLnBucG0vQGZpcmViYXNlK3dlYmNoYW5uZWwtd3JhcHBlckAwLjYuMS9ub2RlX21vZHVsZXMvQGZpcmViYXNlL3dlYmNoYW5uZWwtd3JhcHBlci9kaXN0L3RlbXAvc3JjL2luZGV4LmpzIiwgIi4uL25vZGVfbW9kdWxlcy8ucG5wbS9AZmlyZWJhc2Urd2ViY2hhbm5lbC13cmFwcGVyQDAuNi4xL25vZGVfbW9kdWxlcy9AZmlyZWJhc2Uvd2ViY2hhbm5lbC13cmFwcGVyL25vZGVfbW9kdWxlcy9nb29nbGUtY2xvc3VyZS1saWJyYXJ5L2Nsb3N1cmUvZ29vZy9sYWJzL25ldC93ZWJjaGFubmVsdHJhbnNwb3J0ZmFjdG9yeS5qcyIsICIuLi9ub2RlX21vZHVsZXMvLnBucG0vQGZpcmViYXNlK2ZpcmVzdG9yZUAzLjQuOV9AZmlyZWJhc2UrYXBwQDAuNy4yNS9ub2RlX21vZHVsZXMvQGZpcmViYXNlL2ZpcmVzdG9yZS9kaXN0L2luZGV4LmVzbTIwMTcuanMiLCAiLi4vc3JjL2luZGV4LmpzIl0sCiAgInNvdXJjZXNDb250ZW50IjogWyIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG4vKipcbiAqIEBmaWxlb3ZlcnZpZXcgRmlyZWJhc2UgY29uc3RhbnRzLiAgU29tZSBvZiB0aGVzZSAoQGRlZmluZXMpIGNhbiBiZSBvdmVycmlkZGVuIGF0IGNvbXBpbGUtdGltZS5cbiAqL1xuXG5leHBvcnQgY29uc3QgQ09OU1RBTlRTID0ge1xuICAvKipcbiAgICogQGRlZmluZSB7Ym9vbGVhbn0gV2hldGhlciB0aGlzIGlzIHRoZSBjbGllbnQgTm9kZS5qcyBTREsuXG4gICAqL1xuICBOT0RFX0NMSUVOVDogZmFsc2UsXG4gIC8qKlxuICAgKiBAZGVmaW5lIHtib29sZWFufSBXaGV0aGVyIHRoaXMgaXMgdGhlIEFkbWluIE5vZGUuanMgU0RLLlxuICAgKi9cbiAgTk9ERV9BRE1JTjogZmFsc2UsXG5cbiAgLyoqXG4gICAqIEZpcmViYXNlIFNESyBWZXJzaW9uXG4gICAqL1xuICBTREtfVkVSU0lPTjogJyR7SlNDT1JFX1ZFUlNJT059J1xufTtcbiIsICIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQgeyBDT05TVEFOVFMgfSBmcm9tICcuL2NvbnN0YW50cyc7XG5cbi8qKlxuICogVGhyb3dzIGFuIGVycm9yIGlmIHRoZSBwcm92aWRlZCBhc3NlcnRpb24gaXMgZmFsc3lcbiAqL1xuZXhwb3J0IGNvbnN0IGFzc2VydCA9IGZ1bmN0aW9uIChhc3NlcnRpb246IHVua25vd24sIG1lc3NhZ2U6IHN0cmluZyk6IHZvaWQge1xuICBpZiAoIWFzc2VydGlvbikge1xuICAgIHRocm93IGFzc2VydGlvbkVycm9yKG1lc3NhZ2UpO1xuICB9XG59O1xuXG4vKipcbiAqIFJldHVybnMgYW4gRXJyb3Igb2JqZWN0IHN1aXRhYmxlIGZvciB0aHJvd2luZy5cbiAqL1xuZXhwb3J0IGNvbnN0IGFzc2VydGlvbkVycm9yID0gZnVuY3Rpb24gKG1lc3NhZ2U6IHN0cmluZyk6IEVycm9yIHtcbiAgcmV0dXJuIG5ldyBFcnJvcihcbiAgICAnRmlyZWJhc2UgRGF0YWJhc2UgKCcgK1xuICAgICAgQ09OU1RBTlRTLlNES19WRVJTSU9OICtcbiAgICAgICcpIElOVEVSTkFMIEFTU0VSVCBGQUlMRUQ6ICcgK1xuICAgICAgbWVzc2FnZVxuICApO1xufTtcbiIsICIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5jb25zdCBzdHJpbmdUb0J5dGVBcnJheSA9IGZ1bmN0aW9uIChzdHI6IHN0cmluZyk6IG51bWJlcltdIHtcbiAgLy8gVE9ETyh1c2VyKTogVXNlIG5hdGl2ZSBpbXBsZW1lbnRhdGlvbnMgaWYvd2hlbiBhdmFpbGFibGVcbiAgY29uc3Qgb3V0OiBudW1iZXJbXSA9IFtdO1xuICBsZXQgcCA9IDA7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgc3RyLmxlbmd0aDsgaSsrKSB7XG4gICAgbGV0IGMgPSBzdHIuY2hhckNvZGVBdChpKTtcbiAgICBpZiAoYyA8IDEyOCkge1xuICAgICAgb3V0W3ArK10gPSBjO1xuICAgIH0gZWxzZSBpZiAoYyA8IDIwNDgpIHtcbiAgICAgIG91dFtwKytdID0gKGMgPj4gNikgfCAxOTI7XG4gICAgICBvdXRbcCsrXSA9IChjICYgNjMpIHwgMTI4O1xuICAgIH0gZWxzZSBpZiAoXG4gICAgICAoYyAmIDB4ZmMwMCkgPT09IDB4ZDgwMCAmJlxuICAgICAgaSArIDEgPCBzdHIubGVuZ3RoICYmXG4gICAgICAoc3RyLmNoYXJDb2RlQXQoaSArIDEpICYgMHhmYzAwKSA9PT0gMHhkYzAwXG4gICAgKSB7XG4gICAgICAvLyBTdXJyb2dhdGUgUGFpclxuICAgICAgYyA9IDB4MTAwMDAgKyAoKGMgJiAweDAzZmYpIDw8IDEwKSArIChzdHIuY2hhckNvZGVBdCgrK2kpICYgMHgwM2ZmKTtcbiAgICAgIG91dFtwKytdID0gKGMgPj4gMTgpIHwgMjQwO1xuICAgICAgb3V0W3ArK10gPSAoKGMgPj4gMTIpICYgNjMpIHwgMTI4O1xuICAgICAgb3V0W3ArK10gPSAoKGMgPj4gNikgJiA2MykgfCAxMjg7XG4gICAgICBvdXRbcCsrXSA9IChjICYgNjMpIHwgMTI4O1xuICAgIH0gZWxzZSB7XG4gICAgICBvdXRbcCsrXSA9IChjID4+IDEyKSB8IDIyNDtcbiAgICAgIG91dFtwKytdID0gKChjID4+IDYpICYgNjMpIHwgMTI4O1xuICAgICAgb3V0W3ArK10gPSAoYyAmIDYzKSB8IDEyODtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIG91dDtcbn07XG5cbi8qKlxuICogVHVybnMgYW4gYXJyYXkgb2YgbnVtYmVycyBpbnRvIHRoZSBzdHJpbmcgZ2l2ZW4gYnkgdGhlIGNvbmNhdGVuYXRpb24gb2YgdGhlXG4gKiBjaGFyYWN0ZXJzIHRvIHdoaWNoIHRoZSBudW1iZXJzIGNvcnJlc3BvbmQuXG4gKiBAcGFyYW0gYnl0ZXMgQXJyYXkgb2YgbnVtYmVycyByZXByZXNlbnRpbmcgY2hhcmFjdGVycy5cbiAqIEByZXR1cm4gU3RyaW5naWZpY2F0aW9uIG9mIHRoZSBhcnJheS5cbiAqL1xuY29uc3QgYnl0ZUFycmF5VG9TdHJpbmcgPSBmdW5jdGlvbiAoYnl0ZXM6IG51bWJlcltdKTogc3RyaW5nIHtcbiAgLy8gVE9ETyh1c2VyKTogVXNlIG5hdGl2ZSBpbXBsZW1lbnRhdGlvbnMgaWYvd2hlbiBhdmFpbGFibGVcbiAgY29uc3Qgb3V0OiBzdHJpbmdbXSA9IFtdO1xuICBsZXQgcG9zID0gMCxcbiAgICBjID0gMDtcbiAgd2hpbGUgKHBvcyA8IGJ5dGVzLmxlbmd0aCkge1xuICAgIGNvbnN0IGMxID0gYnl0ZXNbcG9zKytdO1xuICAgIGlmIChjMSA8IDEyOCkge1xuICAgICAgb3V0W2MrK10gPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGMxKTtcbiAgICB9IGVsc2UgaWYgKGMxID4gMTkxICYmIGMxIDwgMjI0KSB7XG4gICAgICBjb25zdCBjMiA9IGJ5dGVzW3BvcysrXTtcbiAgICAgIG91dFtjKytdID0gU3RyaW5nLmZyb21DaGFyQ29kZSgoKGMxICYgMzEpIDw8IDYpIHwgKGMyICYgNjMpKTtcbiAgICB9IGVsc2UgaWYgKGMxID4gMjM5ICYmIGMxIDwgMzY1KSB7XG4gICAgICAvLyBTdXJyb2dhdGUgUGFpclxuICAgICAgY29uc3QgYzIgPSBieXRlc1twb3MrK107XG4gICAgICBjb25zdCBjMyA9IGJ5dGVzW3BvcysrXTtcbiAgICAgIGNvbnN0IGM0ID0gYnl0ZXNbcG9zKytdO1xuICAgICAgY29uc3QgdSA9XG4gICAgICAgICgoKGMxICYgNykgPDwgMTgpIHwgKChjMiAmIDYzKSA8PCAxMikgfCAoKGMzICYgNjMpIDw8IDYpIHwgKGM0ICYgNjMpKSAtXG4gICAgICAgIDB4MTAwMDA7XG4gICAgICBvdXRbYysrXSA9IFN0cmluZy5mcm9tQ2hhckNvZGUoMHhkODAwICsgKHUgPj4gMTApKTtcbiAgICAgIG91dFtjKytdID0gU3RyaW5nLmZyb21DaGFyQ29kZSgweGRjMDAgKyAodSAmIDEwMjMpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgYzIgPSBieXRlc1twb3MrK107XG4gICAgICBjb25zdCBjMyA9IGJ5dGVzW3BvcysrXTtcbiAgICAgIG91dFtjKytdID0gU3RyaW5nLmZyb21DaGFyQ29kZShcbiAgICAgICAgKChjMSAmIDE1KSA8PCAxMikgfCAoKGMyICYgNjMpIDw8IDYpIHwgKGMzICYgNjMpXG4gICAgICApO1xuICAgIH1cbiAgfVxuICByZXR1cm4gb3V0LmpvaW4oJycpO1xufTtcblxuaW50ZXJmYWNlIEJhc2U2NCB7XG4gIGJ5dGVUb0NoYXJNYXBfOiB7IFtrZXk6IG51bWJlcl06IHN0cmluZyB9IHwgbnVsbDtcbiAgY2hhclRvQnl0ZU1hcF86IHsgW2tleTogc3RyaW5nXTogbnVtYmVyIH0gfCBudWxsO1xuICBieXRlVG9DaGFyTWFwV2ViU2FmZV86IHsgW2tleTogbnVtYmVyXTogc3RyaW5nIH0gfCBudWxsO1xuICBjaGFyVG9CeXRlTWFwV2ViU2FmZV86IHsgW2tleTogc3RyaW5nXTogbnVtYmVyIH0gfCBudWxsO1xuICBFTkNPREVEX1ZBTFNfQkFTRTogc3RyaW5nO1xuICByZWFkb25seSBFTkNPREVEX1ZBTFM6IHN0cmluZztcbiAgcmVhZG9ubHkgRU5DT0RFRF9WQUxTX1dFQlNBRkU6IHN0cmluZztcbiAgSEFTX05BVElWRV9TVVBQT1JUOiBib29sZWFuO1xuICBlbmNvZGVCeXRlQXJyYXkoaW5wdXQ6IG51bWJlcltdIHwgVWludDhBcnJheSwgd2ViU2FmZT86IGJvb2xlYW4pOiBzdHJpbmc7XG4gIGVuY29kZVN0cmluZyhpbnB1dDogc3RyaW5nLCB3ZWJTYWZlPzogYm9vbGVhbik6IHN0cmluZztcbiAgZGVjb2RlU3RyaW5nKGlucHV0OiBzdHJpbmcsIHdlYlNhZmU6IGJvb2xlYW4pOiBzdHJpbmc7XG4gIGRlY29kZVN0cmluZ1RvQnl0ZUFycmF5KGlucHV0OiBzdHJpbmcsIHdlYlNhZmU6IGJvb2xlYW4pOiBudW1iZXJbXTtcbiAgaW5pdF8oKTogdm9pZDtcbn1cblxuLy8gV2UgZGVmaW5lIGl0IGFzIGFuIG9iamVjdCBsaXRlcmFsIGluc3RlYWQgb2YgYSBjbGFzcyBiZWNhdXNlIGEgY2xhc3MgY29tcGlsZWQgZG93biB0byBlczUgY2FuJ3Rcbi8vIGJlIHRyZWVzaGFrZWQuIGh0dHBzOi8vZ2l0aHViLmNvbS9yb2xsdXAvcm9sbHVwL2lzc3Vlcy8xNjkxXG4vLyBTdGF0aWMgbG9va3VwIG1hcHMsIGxhemlseSBwb3B1bGF0ZWQgYnkgaW5pdF8oKVxuZXhwb3J0IGNvbnN0IGJhc2U2NDogQmFzZTY0ID0ge1xuICAvKipcbiAgICogTWFwcyBieXRlcyB0byBjaGFyYWN0ZXJzLlxuICAgKi9cbiAgYnl0ZVRvQ2hhck1hcF86IG51bGwsXG5cbiAgLyoqXG4gICAqIE1hcHMgY2hhcmFjdGVycyB0byBieXRlcy5cbiAgICovXG4gIGNoYXJUb0J5dGVNYXBfOiBudWxsLFxuXG4gIC8qKlxuICAgKiBNYXBzIGJ5dGVzIHRvIHdlYnNhZmUgY2hhcmFjdGVycy5cbiAgICogQHByaXZhdGVcbiAgICovXG4gIGJ5dGVUb0NoYXJNYXBXZWJTYWZlXzogbnVsbCxcblxuICAvKipcbiAgICogTWFwcyB3ZWJzYWZlIGNoYXJhY3RlcnMgdG8gYnl0ZXMuXG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBjaGFyVG9CeXRlTWFwV2ViU2FmZV86IG51bGwsXG5cbiAgLyoqXG4gICAqIE91ciBkZWZhdWx0IGFscGhhYmV0LCBzaGFyZWQgYmV0d2VlblxuICAgKiBFTkNPREVEX1ZBTFMgYW5kIEVOQ09ERURfVkFMU19XRUJTQUZFXG4gICAqL1xuICBFTkNPREVEX1ZBTFNfQkFTRTpcbiAgICAnQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVonICsgJ2FiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6JyArICcwMTIzNDU2Nzg5JyxcblxuICAvKipcbiAgICogT3VyIGRlZmF1bHQgYWxwaGFiZXQuIFZhbHVlIDY0ICg9KSBpcyBzcGVjaWFsOyBpdCBtZWFucyBcIm5vdGhpbmcuXCJcbiAgICovXG4gIGdldCBFTkNPREVEX1ZBTFMoKSB7XG4gICAgcmV0dXJuIHRoaXMuRU5DT0RFRF9WQUxTX0JBU0UgKyAnKy89JztcbiAgfSxcblxuICAvKipcbiAgICogT3VyIHdlYnNhZmUgYWxwaGFiZXQuXG4gICAqL1xuICBnZXQgRU5DT0RFRF9WQUxTX1dFQlNBRkUoKSB7XG4gICAgcmV0dXJuIHRoaXMuRU5DT0RFRF9WQUxTX0JBU0UgKyAnLV8uJztcbiAgfSxcblxuICAvKipcbiAgICogV2hldGhlciB0aGlzIGJyb3dzZXIgc3VwcG9ydHMgdGhlIGF0b2IgYW5kIGJ0b2EgZnVuY3Rpb25zLiBUaGlzIGV4dGVuc2lvblxuICAgKiBzdGFydGVkIGF0IE1vemlsbGEgYnV0IGlzIG5vdyBpbXBsZW1lbnRlZCBieSBtYW55IGJyb3dzZXJzLiBXZSB1c2UgdGhlXG4gICAqIEFTU1VNRV8qIHZhcmlhYmxlcyB0byBhdm9pZCBwdWxsaW5nIGluIHRoZSBmdWxsIHVzZXJhZ2VudCBkZXRlY3Rpb24gbGlicmFyeVxuICAgKiBidXQgc3RpbGwgYWxsb3dpbmcgdGhlIHN0YW5kYXJkIHBlci1icm93c2VyIGNvbXBpbGF0aW9ucy5cbiAgICpcbiAgICovXG4gIEhBU19OQVRJVkVfU1VQUE9SVDogdHlwZW9mIGF0b2IgPT09ICdmdW5jdGlvbicsXG5cbiAgLyoqXG4gICAqIEJhc2U2NC1lbmNvZGUgYW4gYXJyYXkgb2YgYnl0ZXMuXG4gICAqXG4gICAqIEBwYXJhbSBpbnB1dCBBbiBhcnJheSBvZiBieXRlcyAobnVtYmVycyB3aXRoXG4gICAqICAgICB2YWx1ZSBpbiBbMCwgMjU1XSkgdG8gZW5jb2RlLlxuICAgKiBAcGFyYW0gd2ViU2FmZSBCb29sZWFuIGluZGljYXRpbmcgd2Ugc2hvdWxkIHVzZSB0aGVcbiAgICogICAgIGFsdGVybmF0aXZlIGFscGhhYmV0LlxuICAgKiBAcmV0dXJuIFRoZSBiYXNlNjQgZW5jb2RlZCBzdHJpbmcuXG4gICAqL1xuICBlbmNvZGVCeXRlQXJyYXkoaW5wdXQ6IG51bWJlcltdIHwgVWludDhBcnJheSwgd2ViU2FmZT86IGJvb2xlYW4pOiBzdHJpbmcge1xuICAgIGlmICghQXJyYXkuaXNBcnJheShpbnB1dCkpIHtcbiAgICAgIHRocm93IEVycm9yKCdlbmNvZGVCeXRlQXJyYXkgdGFrZXMgYW4gYXJyYXkgYXMgYSBwYXJhbWV0ZXInKTtcbiAgICB9XG5cbiAgICB0aGlzLmluaXRfKCk7XG5cbiAgICBjb25zdCBieXRlVG9DaGFyTWFwID0gd2ViU2FmZVxuICAgICAgPyB0aGlzLmJ5dGVUb0NoYXJNYXBXZWJTYWZlXyFcbiAgICAgIDogdGhpcy5ieXRlVG9DaGFyTWFwXyE7XG5cbiAgICBjb25zdCBvdXRwdXQgPSBbXTtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaW5wdXQubGVuZ3RoOyBpICs9IDMpIHtcbiAgICAgIGNvbnN0IGJ5dGUxID0gaW5wdXRbaV07XG4gICAgICBjb25zdCBoYXZlQnl0ZTIgPSBpICsgMSA8IGlucHV0Lmxlbmd0aDtcbiAgICAgIGNvbnN0IGJ5dGUyID0gaGF2ZUJ5dGUyID8gaW5wdXRbaSArIDFdIDogMDtcbiAgICAgIGNvbnN0IGhhdmVCeXRlMyA9IGkgKyAyIDwgaW5wdXQubGVuZ3RoO1xuICAgICAgY29uc3QgYnl0ZTMgPSBoYXZlQnl0ZTMgPyBpbnB1dFtpICsgMl0gOiAwO1xuXG4gICAgICBjb25zdCBvdXRCeXRlMSA9IGJ5dGUxID4+IDI7XG4gICAgICBjb25zdCBvdXRCeXRlMiA9ICgoYnl0ZTEgJiAweDAzKSA8PCA0KSB8IChieXRlMiA+PiA0KTtcbiAgICAgIGxldCBvdXRCeXRlMyA9ICgoYnl0ZTIgJiAweDBmKSA8PCAyKSB8IChieXRlMyA+PiA2KTtcbiAgICAgIGxldCBvdXRCeXRlNCA9IGJ5dGUzICYgMHgzZjtcblxuICAgICAgaWYgKCFoYXZlQnl0ZTMpIHtcbiAgICAgICAgb3V0Qnl0ZTQgPSA2NDtcblxuICAgICAgICBpZiAoIWhhdmVCeXRlMikge1xuICAgICAgICAgIG91dEJ5dGUzID0gNjQ7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgb3V0cHV0LnB1c2goXG4gICAgICAgIGJ5dGVUb0NoYXJNYXBbb3V0Qnl0ZTFdLFxuICAgICAgICBieXRlVG9DaGFyTWFwW291dEJ5dGUyXSxcbiAgICAgICAgYnl0ZVRvQ2hhck1hcFtvdXRCeXRlM10sXG4gICAgICAgIGJ5dGVUb0NoYXJNYXBbb3V0Qnl0ZTRdXG4gICAgICApO1xuICAgIH1cblxuICAgIHJldHVybiBvdXRwdXQuam9pbignJyk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEJhc2U2NC1lbmNvZGUgYSBzdHJpbmcuXG4gICAqXG4gICAqIEBwYXJhbSBpbnB1dCBBIHN0cmluZyB0byBlbmNvZGUuXG4gICAqIEBwYXJhbSB3ZWJTYWZlIElmIHRydWUsIHdlIHNob3VsZCB1c2UgdGhlXG4gICAqICAgICBhbHRlcm5hdGl2ZSBhbHBoYWJldC5cbiAgICogQHJldHVybiBUaGUgYmFzZTY0IGVuY29kZWQgc3RyaW5nLlxuICAgKi9cbiAgZW5jb2RlU3RyaW5nKGlucHV0OiBzdHJpbmcsIHdlYlNhZmU/OiBib29sZWFuKTogc3RyaW5nIHtcbiAgICAvLyBTaG9ydGN1dCBmb3IgTW96aWxsYSBicm93c2VycyB0aGF0IGltcGxlbWVudFxuICAgIC8vIGEgbmF0aXZlIGJhc2U2NCBlbmNvZGVyIGluIHRoZSBmb3JtIG9mIFwiYnRvYS9hdG9iXCJcbiAgICBpZiAodGhpcy5IQVNfTkFUSVZFX1NVUFBPUlQgJiYgIXdlYlNhZmUpIHtcbiAgICAgIHJldHVybiBidG9hKGlucHV0KTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuZW5jb2RlQnl0ZUFycmF5KHN0cmluZ1RvQnl0ZUFycmF5KGlucHV0KSwgd2ViU2FmZSk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEJhc2U2NC1kZWNvZGUgYSBzdHJpbmcuXG4gICAqXG4gICAqIEBwYXJhbSBpbnB1dCB0byBkZWNvZGUuXG4gICAqIEBwYXJhbSB3ZWJTYWZlIFRydWUgaWYgd2Ugc2hvdWxkIHVzZSB0aGVcbiAgICogICAgIGFsdGVybmF0aXZlIGFscGhhYmV0LlxuICAgKiBAcmV0dXJuIHN0cmluZyByZXByZXNlbnRpbmcgdGhlIGRlY29kZWQgdmFsdWUuXG4gICAqL1xuICBkZWNvZGVTdHJpbmcoaW5wdXQ6IHN0cmluZywgd2ViU2FmZTogYm9vbGVhbik6IHN0cmluZyB7XG4gICAgLy8gU2hvcnRjdXQgZm9yIE1vemlsbGEgYnJvd3NlcnMgdGhhdCBpbXBsZW1lbnRcbiAgICAvLyBhIG5hdGl2ZSBiYXNlNjQgZW5jb2RlciBpbiB0aGUgZm9ybSBvZiBcImJ0b2EvYXRvYlwiXG4gICAgaWYgKHRoaXMuSEFTX05BVElWRV9TVVBQT1JUICYmICF3ZWJTYWZlKSB7XG4gICAgICByZXR1cm4gYXRvYihpbnB1dCk7XG4gICAgfVxuICAgIHJldHVybiBieXRlQXJyYXlUb1N0cmluZyh0aGlzLmRlY29kZVN0cmluZ1RvQnl0ZUFycmF5KGlucHV0LCB3ZWJTYWZlKSk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEJhc2U2NC1kZWNvZGUgYSBzdHJpbmcuXG4gICAqXG4gICAqIEluIGJhc2UtNjQgZGVjb2RpbmcsIGdyb3VwcyBvZiBmb3VyIGNoYXJhY3RlcnMgYXJlIGNvbnZlcnRlZCBpbnRvIHRocmVlXG4gICAqIGJ5dGVzLiAgSWYgdGhlIGVuY29kZXIgZGlkIG5vdCBhcHBseSBwYWRkaW5nLCB0aGUgaW5wdXQgbGVuZ3RoIG1heSBub3RcbiAgICogYmUgYSBtdWx0aXBsZSBvZiA0LlxuICAgKlxuICAgKiBJbiB0aGlzIGNhc2UsIHRoZSBsYXN0IGdyb3VwIHdpbGwgaGF2ZSBmZXdlciB0aGFuIDQgY2hhcmFjdGVycywgYW5kXG4gICAqIHBhZGRpbmcgd2lsbCBiZSBpbmZlcnJlZC4gIElmIHRoZSBncm91cCBoYXMgb25lIG9yIHR3byBjaGFyYWN0ZXJzLCBpdCBkZWNvZGVzXG4gICAqIHRvIG9uZSBieXRlLiAgSWYgdGhlIGdyb3VwIGhhcyB0aHJlZSBjaGFyYWN0ZXJzLCBpdCBkZWNvZGVzIHRvIHR3byBieXRlcy5cbiAgICpcbiAgICogQHBhcmFtIGlucHV0IElucHV0IHRvIGRlY29kZS5cbiAgICogQHBhcmFtIHdlYlNhZmUgVHJ1ZSBpZiB3ZSBzaG91bGQgdXNlIHRoZSB3ZWItc2FmZSBhbHBoYWJldC5cbiAgICogQHJldHVybiBieXRlcyByZXByZXNlbnRpbmcgdGhlIGRlY29kZWQgdmFsdWUuXG4gICAqL1xuICBkZWNvZGVTdHJpbmdUb0J5dGVBcnJheShpbnB1dDogc3RyaW5nLCB3ZWJTYWZlOiBib29sZWFuKTogbnVtYmVyW10ge1xuICAgIHRoaXMuaW5pdF8oKTtcblxuICAgIGNvbnN0IGNoYXJUb0J5dGVNYXAgPSB3ZWJTYWZlXG4gICAgICA/IHRoaXMuY2hhclRvQnl0ZU1hcFdlYlNhZmVfIVxuICAgICAgOiB0aGlzLmNoYXJUb0J5dGVNYXBfITtcblxuICAgIGNvbnN0IG91dHB1dDogbnVtYmVyW10gPSBbXTtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaW5wdXQubGVuZ3RoOyApIHtcbiAgICAgIGNvbnN0IGJ5dGUxID0gY2hhclRvQnl0ZU1hcFtpbnB1dC5jaGFyQXQoaSsrKV07XG5cbiAgICAgIGNvbnN0IGhhdmVCeXRlMiA9IGkgPCBpbnB1dC5sZW5ndGg7XG4gICAgICBjb25zdCBieXRlMiA9IGhhdmVCeXRlMiA/IGNoYXJUb0J5dGVNYXBbaW5wdXQuY2hhckF0KGkpXSA6IDA7XG4gICAgICArK2k7XG5cbiAgICAgIGNvbnN0IGhhdmVCeXRlMyA9IGkgPCBpbnB1dC5sZW5ndGg7XG4gICAgICBjb25zdCBieXRlMyA9IGhhdmVCeXRlMyA/IGNoYXJUb0J5dGVNYXBbaW5wdXQuY2hhckF0KGkpXSA6IDY0O1xuICAgICAgKytpO1xuXG4gICAgICBjb25zdCBoYXZlQnl0ZTQgPSBpIDwgaW5wdXQubGVuZ3RoO1xuICAgICAgY29uc3QgYnl0ZTQgPSBoYXZlQnl0ZTQgPyBjaGFyVG9CeXRlTWFwW2lucHV0LmNoYXJBdChpKV0gOiA2NDtcbiAgICAgICsraTtcblxuICAgICAgaWYgKGJ5dGUxID09IG51bGwgfHwgYnl0ZTIgPT0gbnVsbCB8fCBieXRlMyA9PSBudWxsIHx8IGJ5dGU0ID09IG51bGwpIHtcbiAgICAgICAgdGhyb3cgRXJyb3IoKTtcbiAgICAgIH1cblxuICAgICAgY29uc3Qgb3V0Qnl0ZTEgPSAoYnl0ZTEgPDwgMikgfCAoYnl0ZTIgPj4gNCk7XG4gICAgICBvdXRwdXQucHVzaChvdXRCeXRlMSk7XG5cbiAgICAgIGlmIChieXRlMyAhPT0gNjQpIHtcbiAgICAgICAgY29uc3Qgb3V0Qnl0ZTIgPSAoKGJ5dGUyIDw8IDQpICYgMHhmMCkgfCAoYnl0ZTMgPj4gMik7XG4gICAgICAgIG91dHB1dC5wdXNoKG91dEJ5dGUyKTtcblxuICAgICAgICBpZiAoYnl0ZTQgIT09IDY0KSB7XG4gICAgICAgICAgY29uc3Qgb3V0Qnl0ZTMgPSAoKGJ5dGUzIDw8IDYpICYgMHhjMCkgfCBieXRlNDtcbiAgICAgICAgICBvdXRwdXQucHVzaChvdXRCeXRlMyk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gb3V0cHV0O1xuICB9LFxuXG4gIC8qKlxuICAgKiBMYXp5IHN0YXRpYyBpbml0aWFsaXphdGlvbiBmdW5jdGlvbi4gQ2FsbGVkIGJlZm9yZVxuICAgKiBhY2Nlc3NpbmcgYW55IG9mIHRoZSBzdGF0aWMgbWFwIHZhcmlhYmxlcy5cbiAgICogQHByaXZhdGVcbiAgICovXG4gIGluaXRfKCkge1xuICAgIGlmICghdGhpcy5ieXRlVG9DaGFyTWFwXykge1xuICAgICAgdGhpcy5ieXRlVG9DaGFyTWFwXyA9IHt9O1xuICAgICAgdGhpcy5jaGFyVG9CeXRlTWFwXyA9IHt9O1xuICAgICAgdGhpcy5ieXRlVG9DaGFyTWFwV2ViU2FmZV8gPSB7fTtcbiAgICAgIHRoaXMuY2hhclRvQnl0ZU1hcFdlYlNhZmVfID0ge307XG5cbiAgICAgIC8vIFdlIHdhbnQgcXVpY2sgbWFwcGluZ3MgYmFjayBhbmQgZm9ydGgsIHNvIHdlIHByZWNvbXB1dGUgdHdvIG1hcHMuXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuRU5DT0RFRF9WQUxTLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHRoaXMuYnl0ZVRvQ2hhck1hcF9baV0gPSB0aGlzLkVOQ09ERURfVkFMUy5jaGFyQXQoaSk7XG4gICAgICAgIHRoaXMuY2hhclRvQnl0ZU1hcF9bdGhpcy5ieXRlVG9DaGFyTWFwX1tpXV0gPSBpO1xuICAgICAgICB0aGlzLmJ5dGVUb0NoYXJNYXBXZWJTYWZlX1tpXSA9IHRoaXMuRU5DT0RFRF9WQUxTX1dFQlNBRkUuY2hhckF0KGkpO1xuICAgICAgICB0aGlzLmNoYXJUb0J5dGVNYXBXZWJTYWZlX1t0aGlzLmJ5dGVUb0NoYXJNYXBXZWJTYWZlX1tpXV0gPSBpO1xuXG4gICAgICAgIC8vIEJlIGZvcmdpdmluZyB3aGVuIGRlY29kaW5nIGFuZCBjb3JyZWN0bHkgZGVjb2RlIGJvdGggZW5jb2RpbmdzLlxuICAgICAgICBpZiAoaSA+PSB0aGlzLkVOQ09ERURfVkFMU19CQVNFLmxlbmd0aCkge1xuICAgICAgICAgIHRoaXMuY2hhclRvQnl0ZU1hcF9bdGhpcy5FTkNPREVEX1ZBTFNfV0VCU0FGRS5jaGFyQXQoaSldID0gaTtcbiAgICAgICAgICB0aGlzLmNoYXJUb0J5dGVNYXBXZWJTYWZlX1t0aGlzLkVOQ09ERURfVkFMUy5jaGFyQXQoaSldID0gaTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxufTtcblxuLyoqXG4gKiBVUkwtc2FmZSBiYXNlNjQgZW5jb2RpbmdcbiAqL1xuZXhwb3J0IGNvbnN0IGJhc2U2NEVuY29kZSA9IGZ1bmN0aW9uIChzdHI6IHN0cmluZyk6IHN0cmluZyB7XG4gIGNvbnN0IHV0ZjhCeXRlcyA9IHN0cmluZ1RvQnl0ZUFycmF5KHN0cik7XG4gIHJldHVybiBiYXNlNjQuZW5jb2RlQnl0ZUFycmF5KHV0ZjhCeXRlcywgdHJ1ZSk7XG59O1xuXG4vKipcbiAqIFVSTC1zYWZlIGJhc2U2NCBlbmNvZGluZyAod2l0aG91dCBcIi5cIiBwYWRkaW5nIGluIHRoZSBlbmQpLlxuICogZS5nLiBVc2VkIGluIEpTT04gV2ViIFRva2VuIChKV1QpIHBhcnRzLlxuICovXG5leHBvcnQgY29uc3QgYmFzZTY0dXJsRW5jb2RlV2l0aG91dFBhZGRpbmcgPSBmdW5jdGlvbiAoc3RyOiBzdHJpbmcpOiBzdHJpbmcge1xuICAvLyBVc2UgYmFzZTY0dXJsIGVuY29kaW5nIGFuZCByZW1vdmUgcGFkZGluZyBpbiB0aGUgZW5kIChkb3QgY2hhcmFjdGVycykuXG4gIHJldHVybiBiYXNlNjRFbmNvZGUoc3RyKS5yZXBsYWNlKC9cXC4vZywgJycpO1xufTtcblxuLyoqXG4gKiBVUkwtc2FmZSBiYXNlNjQgZGVjb2RpbmdcbiAqXG4gKiBOT1RFOiBETyBOT1QgdXNlIHRoZSBnbG9iYWwgYXRvYigpIGZ1bmN0aW9uIC0gaXQgZG9lcyBOT1Qgc3VwcG9ydCB0aGVcbiAqIGJhc2U2NFVybCB2YXJpYW50IGVuY29kaW5nLlxuICpcbiAqIEBwYXJhbSBzdHIgVG8gYmUgZGVjb2RlZFxuICogQHJldHVybiBEZWNvZGVkIHJlc3VsdCwgaWYgcG9zc2libGVcbiAqL1xuZXhwb3J0IGNvbnN0IGJhc2U2NERlY29kZSA9IGZ1bmN0aW9uIChzdHI6IHN0cmluZyk6IHN0cmluZyB8IG51bGwge1xuICB0cnkge1xuICAgIHJldHVybiBiYXNlNjQuZGVjb2RlU3RyaW5nKHN0ciwgdHJ1ZSk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBjb25zb2xlLmVycm9yKCdiYXNlNjREZWNvZGUgZmFpbGVkOiAnLCBlKTtcbiAgfVxuICByZXR1cm4gbnVsbDtcbn07XG4iLCAiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuLyoqXG4gKiBEbyBhIGRlZXAtY29weSBvZiBiYXNpYyBKYXZhU2NyaXB0IE9iamVjdHMgb3IgQXJyYXlzLlxuICovXG5leHBvcnQgZnVuY3Rpb24gZGVlcENvcHk8VD4odmFsdWU6IFQpOiBUIHtcbiAgcmV0dXJuIGRlZXBFeHRlbmQodW5kZWZpbmVkLCB2YWx1ZSkgYXMgVDtcbn1cblxuLyoqXG4gKiBDb3B5IHByb3BlcnRpZXMgZnJvbSBzb3VyY2UgdG8gdGFyZ2V0IChyZWN1cnNpdmVseSBhbGxvd3MgZXh0ZW5zaW9uXG4gKiBvZiBPYmplY3RzIGFuZCBBcnJheXMpLiAgU2NhbGFyIHZhbHVlcyBpbiB0aGUgdGFyZ2V0IGFyZSBvdmVyLXdyaXR0ZW4uXG4gKiBJZiB0YXJnZXQgaXMgdW5kZWZpbmVkLCBhbiBvYmplY3Qgb2YgdGhlIGFwcHJvcHJpYXRlIHR5cGUgd2lsbCBiZSBjcmVhdGVkXG4gKiAoYW5kIHJldHVybmVkKS5cbiAqXG4gKiBXZSByZWN1cnNpdmVseSBjb3B5IGFsbCBjaGlsZCBwcm9wZXJ0aWVzIG9mIHBsYWluIE9iamVjdHMgaW4gdGhlIHNvdXJjZS0gc29cbiAqIHRoYXQgbmFtZXNwYWNlLSBsaWtlIGRpY3Rpb25hcmllcyBhcmUgbWVyZ2VkLlxuICpcbiAqIE5vdGUgdGhhdCB0aGUgdGFyZ2V0IGNhbiBiZSBhIGZ1bmN0aW9uLCBpbiB3aGljaCBjYXNlIHRoZSBwcm9wZXJ0aWVzIGluXG4gKiB0aGUgc291cmNlIE9iamVjdCBhcmUgY29waWVkIG9udG8gaXQgYXMgc3RhdGljIHByb3BlcnRpZXMgb2YgdGhlIEZ1bmN0aW9uLlxuICpcbiAqIE5vdGU6IHdlIGRvbid0IG1lcmdlIF9fcHJvdG9fXyB0byBwcmV2ZW50IHByb3RvdHlwZSBwb2xsdXRpb25cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGRlZXBFeHRlbmQodGFyZ2V0OiB1bmtub3duLCBzb3VyY2U6IHVua25vd24pOiB1bmtub3duIHtcbiAgaWYgKCEoc291cmNlIGluc3RhbmNlb2YgT2JqZWN0KSkge1xuICAgIHJldHVybiBzb3VyY2U7XG4gIH1cblxuICBzd2l0Y2ggKHNvdXJjZS5jb25zdHJ1Y3Rvcikge1xuICAgIGNhc2UgRGF0ZTpcbiAgICAgIC8vIFRyZWF0IERhdGVzIGxpa2Ugc2NhbGFyczsgaWYgdGhlIHRhcmdldCBkYXRlIG9iamVjdCBoYWQgYW55IGNoaWxkXG4gICAgICAvLyBwcm9wZXJ0aWVzIC0gdGhleSB3aWxsIGJlIGxvc3QhXG4gICAgICBjb25zdCBkYXRlVmFsdWUgPSBzb3VyY2UgYXMgRGF0ZTtcbiAgICAgIHJldHVybiBuZXcgRGF0ZShkYXRlVmFsdWUuZ2V0VGltZSgpKTtcblxuICAgIGNhc2UgT2JqZWN0OlxuICAgICAgaWYgKHRhcmdldCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHRhcmdldCA9IHt9O1xuICAgICAgfVxuICAgICAgYnJlYWs7XG4gICAgY2FzZSBBcnJheTpcbiAgICAgIC8vIEFsd2F5cyBjb3B5IHRoZSBhcnJheSBzb3VyY2UgYW5kIG92ZXJ3cml0ZSB0aGUgdGFyZ2V0LlxuICAgICAgdGFyZ2V0ID0gW107XG4gICAgICBicmVhaztcblxuICAgIGRlZmF1bHQ6XG4gICAgICAvLyBOb3QgYSBwbGFpbiBPYmplY3QgLSB0cmVhdCBpdCBhcyBhIHNjYWxhci5cbiAgICAgIHJldHVybiBzb3VyY2U7XG4gIH1cblxuICBmb3IgKGNvbnN0IHByb3AgaW4gc291cmNlKSB7XG4gICAgLy8gdXNlIGlzVmFsaWRLZXkgdG8gZ3VhcmQgYWdhaW5zdCBwcm90b3R5cGUgcG9sbHV0aW9uLiBTZWUgaHR0cHM6Ly9zbnlrLmlvL3Z1bG4vU05ZSy1KUy1MT0RBU0gtNDUwMjAyXG4gICAgaWYgKCFzb3VyY2UuaGFzT3duUHJvcGVydHkocHJvcCkgfHwgIWlzVmFsaWRLZXkocHJvcCkpIHtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cbiAgICAodGFyZ2V0IGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KVtwcm9wXSA9IGRlZXBFeHRlbmQoXG4gICAgICAodGFyZ2V0IGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KVtwcm9wXSxcbiAgICAgIChzb3VyY2UgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pW3Byb3BdXG4gICAgKTtcbiAgfVxuXG4gIHJldHVybiB0YXJnZXQ7XG59XG5cbmZ1bmN0aW9uIGlzVmFsaWRLZXkoa2V5OiBzdHJpbmcpOiBib29sZWFuIHtcbiAgcmV0dXJuIGtleSAhPT0gJ19fcHJvdG9fXyc7XG59XG4iLCAiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuZXhwb3J0IGNsYXNzIERlZmVycmVkPFI+IHtcbiAgcHJvbWlzZTogUHJvbWlzZTxSPjtcbiAgcmVqZWN0OiAodmFsdWU/OiB1bmtub3duKSA9PiB2b2lkID0gKCkgPT4ge307XG4gIHJlc29sdmU6ICh2YWx1ZT86IHVua25vd24pID0+IHZvaWQgPSAoKSA9PiB7fTtcbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5wcm9taXNlID0gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgdGhpcy5yZXNvbHZlID0gcmVzb2x2ZSBhcyAodmFsdWU/OiB1bmtub3duKSA9PiB2b2lkO1xuICAgICAgdGhpcy5yZWplY3QgPSByZWplY3QgYXMgKHZhbHVlPzogdW5rbm93bikgPT4gdm9pZDtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBPdXIgQVBJIGludGVybmFscyBhcmUgbm90IHByb21pc2VpZmllZCBhbmQgY2Fubm90IGJlY2F1c2Ugb3VyIGNhbGxiYWNrIEFQSXMgaGF2ZSBzdWJ0bGUgZXhwZWN0YXRpb25zIGFyb3VuZFxuICAgKiBpbnZva2luZyBwcm9taXNlcyBpbmxpbmUsIHdoaWNoIFByb21pc2VzIGFyZSBmb3JiaWRkZW4gdG8gZG8uIFRoaXMgbWV0aG9kIGFjY2VwdHMgYW4gb3B0aW9uYWwgbm9kZS1zdHlsZSBjYWxsYmFja1xuICAgKiBhbmQgcmV0dXJucyBhIG5vZGUtc3R5bGUgY2FsbGJhY2sgd2hpY2ggd2lsbCByZXNvbHZlIG9yIHJlamVjdCB0aGUgRGVmZXJyZWQncyBwcm9taXNlLlxuICAgKi9cbiAgd3JhcENhbGxiYWNrKFxuICAgIGNhbGxiYWNrPzogKGVycm9yPzogdW5rbm93biwgdmFsdWU/OiB1bmtub3duKSA9PiB2b2lkXG4gICk6IChlcnJvcjogdW5rbm93biwgdmFsdWU/OiB1bmtub3duKSA9PiB2b2lkIHtcbiAgICByZXR1cm4gKGVycm9yLCB2YWx1ZT8pID0+IHtcbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICB0aGlzLnJlamVjdChlcnJvcik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnJlc29sdmUodmFsdWUpO1xuICAgICAgfVxuICAgICAgaWYgKHR5cGVvZiBjYWxsYmFjayA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAvLyBBdHRhY2hpbmcgbm9vcCBoYW5kbGVyIGp1c3QgaW4gY2FzZSBkZXZlbG9wZXIgd2Fzbid0IGV4cGVjdGluZ1xuICAgICAgICAvLyBwcm9taXNlc1xuICAgICAgICB0aGlzLnByb21pc2UuY2F0Y2goKCkgPT4ge30pO1xuXG4gICAgICAgIC8vIFNvbWUgb2Ygb3VyIGNhbGxiYWNrcyBkb24ndCBleHBlY3QgYSB2YWx1ZSBhbmQgb3VyIG93biB0ZXN0c1xuICAgICAgICAvLyBhc3NlcnQgdGhhdCB0aGUgcGFyYW1ldGVyIGxlbmd0aCBpcyAxXG4gICAgICAgIGlmIChjYWxsYmFjay5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgICBjYWxsYmFjayhlcnJvcik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY2FsbGJhY2soZXJyb3IsIHZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH07XG4gIH1cbn1cbiIsICIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMSBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQgeyBiYXNlNjR1cmxFbmNvZGVXaXRob3V0UGFkZGluZyB9IGZyb20gJy4vY3J5cHQnO1xuXG4vLyBGaXJlYmFzZSBBdXRoIHRva2VucyBjb250YWluIHNuYWtlX2Nhc2UgY2xhaW1zIGZvbGxvd2luZyB0aGUgSldUIHN0YW5kYXJkIC8gY29udmVudGlvbi5cbi8qIGVzbGludC1kaXNhYmxlIGNhbWVsY2FzZSAqL1xuXG5leHBvcnQgdHlwZSBGaXJlYmFzZVNpZ25JblByb3ZpZGVyID1cbiAgfCAnY3VzdG9tJ1xuICB8ICdlbWFpbCdcbiAgfCAncGFzc3dvcmQnXG4gIHwgJ3Bob25lJ1xuICB8ICdhbm9ueW1vdXMnXG4gIHwgJ2dvb2dsZS5jb20nXG4gIHwgJ2ZhY2Vib29rLmNvbSdcbiAgfCAnZ2l0aHViLmNvbSdcbiAgfCAndHdpdHRlci5jb20nXG4gIHwgJ21pY3Jvc29mdC5jb20nXG4gIHwgJ2FwcGxlLmNvbSc7XG5cbmludGVyZmFjZSBGaXJlYmFzZUlkVG9rZW4ge1xuICAvLyBBbHdheXMgc2V0IHRvIGh0dHBzOi8vc2VjdXJldG9rZW4uZ29vZ2xlLmNvbS9QUk9KRUNUX0lEXG4gIGlzczogc3RyaW5nO1xuXG4gIC8vIEFsd2F5cyBzZXQgdG8gUFJPSkVDVF9JRFxuICBhdWQ6IHN0cmluZztcblxuICAvLyBUaGUgdXNlcidzIHVuaXF1ZSBJRFxuICBzdWI6IHN0cmluZztcblxuICAvLyBUaGUgdG9rZW4gaXNzdWUgdGltZSwgaW4gc2Vjb25kcyBzaW5jZSBlcG9jaFxuICBpYXQ6IG51bWJlcjtcblxuICAvLyBUaGUgdG9rZW4gZXhwaXJ5IHRpbWUsIG5vcm1hbGx5ICdpYXQnICsgMzYwMFxuICBleHA6IG51bWJlcjtcblxuICAvLyBUaGUgdXNlcidzIHVuaXF1ZSBJRC4gTXVzdCBiZSBlcXVhbCB0byAnc3ViJ1xuICB1c2VyX2lkOiBzdHJpbmc7XG5cbiAgLy8gVGhlIHRpbWUgdGhlIHVzZXIgYXV0aGVudGljYXRlZCwgbm9ybWFsbHkgJ2lhdCdcbiAgYXV0aF90aW1lOiBudW1iZXI7XG5cbiAgLy8gVGhlIHNpZ24gaW4gcHJvdmlkZXIsIG9ubHkgc2V0IHdoZW4gdGhlIHByb3ZpZGVyIGlzICdhbm9ueW1vdXMnXG4gIHByb3ZpZGVyX2lkPzogJ2Fub255bW91cyc7XG5cbiAgLy8gVGhlIHVzZXIncyBwcmltYXJ5IGVtYWlsXG4gIGVtYWlsPzogc3RyaW5nO1xuXG4gIC8vIFRoZSB1c2VyJ3MgZW1haWwgdmVyaWZpY2F0aW9uIHN0YXR1c1xuICBlbWFpbF92ZXJpZmllZD86IGJvb2xlYW47XG5cbiAgLy8gVGhlIHVzZXIncyBwcmltYXJ5IHBob25lIG51bWJlclxuICBwaG9uZV9udW1iZXI/OiBzdHJpbmc7XG5cbiAgLy8gVGhlIHVzZXIncyBkaXNwbGF5IG5hbWVcbiAgbmFtZT86IHN0cmluZztcblxuICAvLyBUaGUgdXNlcidzIHByb2ZpbGUgcGhvdG8gVVJMXG4gIHBpY3R1cmU/OiBzdHJpbmc7XG5cbiAgLy8gSW5mb3JtYXRpb24gb24gYWxsIGlkZW50aXRpZXMgbGlua2VkIHRvIHRoaXMgdXNlclxuICBmaXJlYmFzZToge1xuICAgIC8vIFRoZSBwcmltYXJ5IHNpZ24taW4gcHJvdmlkZXJcbiAgICBzaWduX2luX3Byb3ZpZGVyOiBGaXJlYmFzZVNpZ25JblByb3ZpZGVyO1xuXG4gICAgLy8gQSBtYXAgb2YgcHJvdmlkZXJzIHRvIHRoZSB1c2VyJ3MgbGlzdCBvZiB1bmlxdWUgaWRlbnRpZmllcnMgZnJvbVxuICAgIC8vIGVhY2ggcHJvdmlkZXJcbiAgICBpZGVudGl0aWVzPzogeyBbcHJvdmlkZXIgaW4gRmlyZWJhc2VTaWduSW5Qcm92aWRlcl0/OiBzdHJpbmdbXSB9O1xuICB9O1xuXG4gIC8vIEN1c3RvbSBjbGFpbXMgc2V0IGJ5IHRoZSBkZXZlbG9wZXJcbiAgW2NsYWltOiBzdHJpbmddOiB1bmtub3duO1xuXG4gIHVpZD86IG5ldmVyOyAvLyBUcnkgdG8gY2F0Y2ggYSBjb21tb24gbWlzdGFrZSBvZiBcInVpZFwiIChzaG91bGQgYmUgXCJzdWJcIiBpbnN0ZWFkKS5cbn1cblxuZXhwb3J0IHR5cGUgRW11bGF0b3JNb2NrVG9rZW5PcHRpb25zID0gKHsgdXNlcl9pZDogc3RyaW5nIH0gfCB7IHN1Yjogc3RyaW5nIH0pICZcbiAgUGFydGlhbDxGaXJlYmFzZUlkVG9rZW4+O1xuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlTW9ja1VzZXJUb2tlbihcbiAgdG9rZW46IEVtdWxhdG9yTW9ja1Rva2VuT3B0aW9ucyxcbiAgcHJvamVjdElkPzogc3RyaW5nXG4pOiBzdHJpbmcge1xuICBpZiAodG9rZW4udWlkKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgJ1RoZSBcInVpZFwiIGZpZWxkIGlzIG5vIGxvbmdlciBzdXBwb3J0ZWQgYnkgbW9ja1VzZXJUb2tlbi4gUGxlYXNlIHVzZSBcInN1YlwiIGluc3RlYWQgZm9yIEZpcmViYXNlIEF1dGggVXNlciBJRC4nXG4gICAgKTtcbiAgfVxuICAvLyBVbnNlY3VyZWQgSldUcyB1c2UgXCJub25lXCIgYXMgdGhlIGFsZ29yaXRobS5cbiAgY29uc3QgaGVhZGVyID0ge1xuICAgIGFsZzogJ25vbmUnLFxuICAgIHR5cGU6ICdKV1QnXG4gIH07XG5cbiAgY29uc3QgcHJvamVjdCA9IHByb2plY3RJZCB8fCAnZGVtby1wcm9qZWN0JztcbiAgY29uc3QgaWF0ID0gdG9rZW4uaWF0IHx8IDA7XG4gIGNvbnN0IHN1YiA9IHRva2VuLnN1YiB8fCB0b2tlbi51c2VyX2lkO1xuICBpZiAoIXN1Yikge1xuICAgIHRocm93IG5ldyBFcnJvcihcIm1vY2tVc2VyVG9rZW4gbXVzdCBjb250YWluICdzdWInIG9yICd1c2VyX2lkJyBmaWVsZCFcIik7XG4gIH1cblxuICBjb25zdCBwYXlsb2FkOiBGaXJlYmFzZUlkVG9rZW4gPSB7XG4gICAgLy8gU2V0IGFsbCByZXF1aXJlZCBmaWVsZHMgdG8gZGVjZW50IGRlZmF1bHRzXG4gICAgaXNzOiBgaHR0cHM6Ly9zZWN1cmV0b2tlbi5nb29nbGUuY29tLyR7cHJvamVjdH1gLFxuICAgIGF1ZDogcHJvamVjdCxcbiAgICBpYXQsXG4gICAgZXhwOiBpYXQgKyAzNjAwLFxuICAgIGF1dGhfdGltZTogaWF0LFxuICAgIHN1YixcbiAgICB1c2VyX2lkOiBzdWIsXG4gICAgZmlyZWJhc2U6IHtcbiAgICAgIHNpZ25faW5fcHJvdmlkZXI6ICdjdXN0b20nLFxuICAgICAgaWRlbnRpdGllczoge31cbiAgICB9LFxuXG4gICAgLy8gT3ZlcnJpZGUgd2l0aCB1c2VyIG9wdGlvbnNcbiAgICAuLi50b2tlblxuICB9O1xuXG4gIC8vIFVuc2VjdXJlZCBKV1RzIHVzZSB0aGUgZW1wdHkgc3RyaW5nIGFzIGEgc2lnbmF0dXJlLlxuICBjb25zdCBzaWduYXR1cmUgPSAnJztcbiAgcmV0dXJuIFtcbiAgICBiYXNlNjR1cmxFbmNvZGVXaXRob3V0UGFkZGluZyhKU09OLnN0cmluZ2lmeShoZWFkZXIpKSxcbiAgICBiYXNlNjR1cmxFbmNvZGVXaXRob3V0UGFkZGluZyhKU09OLnN0cmluZ2lmeShwYXlsb2FkKSksXG4gICAgc2lnbmF0dXJlXG4gIF0uam9pbignLicpO1xufVxuIiwgIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7IENPTlNUQU5UUyB9IGZyb20gJy4vY29uc3RhbnRzJztcblxuLyoqXG4gKiBSZXR1cm5zIG5hdmlnYXRvci51c2VyQWdlbnQgc3RyaW5nIG9yICcnIGlmIGl0J3Mgbm90IGRlZmluZWQuXG4gKiBAcmV0dXJuIHVzZXIgYWdlbnQgc3RyaW5nXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRVQSgpOiBzdHJpbmcge1xuICBpZiAoXG4gICAgdHlwZW9mIG5hdmlnYXRvciAhPT0gJ3VuZGVmaW5lZCcgJiZcbiAgICB0eXBlb2YgbmF2aWdhdG9yWyd1c2VyQWdlbnQnXSA9PT0gJ3N0cmluZydcbiAgKSB7XG4gICAgcmV0dXJuIG5hdmlnYXRvclsndXNlckFnZW50J107XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuICcnO1xuICB9XG59XG5cbi8qKlxuICogRGV0ZWN0IENvcmRvdmEgLyBQaG9uZUdhcCAvIElvbmljIGZyYW1ld29ya3Mgb24gYSBtb2JpbGUgZGV2aWNlLlxuICpcbiAqIERlbGliZXJhdGVseSBkb2VzIG5vdCByZWx5IG9uIGNoZWNraW5nIGBmaWxlOi8vYCBVUkxzIChhcyB0aGlzIGZhaWxzIFBob25lR2FwXG4gKiBpbiB0aGUgUmlwcGxlIGVtdWxhdG9yKSBub3IgQ29yZG92YSBgb25EZXZpY2VSZWFkeWAsIHdoaWNoIHdvdWxkIG5vcm1hbGx5XG4gKiB3YWl0IGZvciBhIGNhbGxiYWNrLlxuICovXG5leHBvcnQgZnVuY3Rpb24gaXNNb2JpbGVDb3Jkb3ZhKCk6IGJvb2xlYW4ge1xuICByZXR1cm4gKFxuICAgIHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnICYmXG4gICAgLy8gQHRzLWlnbm9yZSBTZXR0aW5nIHVwIGFuIGJyb2FkbHkgYXBwbGljYWJsZSBpbmRleCBzaWduYXR1cmUgZm9yIFdpbmRvd1xuICAgIC8vIGp1c3QgdG8gZGVhbCB3aXRoIHRoaXMgY2FzZSB3b3VsZCBwcm9iYWJseSBiZSBhIGJhZCBpZGVhLlxuICAgICEhKHdpbmRvd1snY29yZG92YSddIHx8IHdpbmRvd1sncGhvbmVnYXAnXSB8fCB3aW5kb3dbJ1Bob25lR2FwJ10pICYmXG4gICAgL2lvc3xpcGhvbmV8aXBvZHxpcGFkfGFuZHJvaWR8YmxhY2tiZXJyeXxpZW1vYmlsZS9pLnRlc3QoZ2V0VUEoKSlcbiAgKTtcbn1cblxuLyoqXG4gKiBEZXRlY3QgTm9kZS5qcy5cbiAqXG4gKiBAcmV0dXJuIHRydWUgaWYgTm9kZS5qcyBlbnZpcm9ubWVudCBpcyBkZXRlY3RlZC5cbiAqL1xuLy8gTm9kZSBkZXRlY3Rpb24gbG9naWMgZnJvbTogaHR0cHM6Ly9naXRodWIuY29tL2lsaWFrYW4vZGV0ZWN0LW5vZGUvXG5leHBvcnQgZnVuY3Rpb24gaXNOb2RlKCk6IGJvb2xlYW4ge1xuICB0cnkge1xuICAgIHJldHVybiAoXG4gICAgICBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoZ2xvYmFsLnByb2Nlc3MpID09PSAnW29iamVjdCBwcm9jZXNzXSdcbiAgICApO1xuICB9IGNhdGNoIChlKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG59XG5cbi8qKlxuICogRGV0ZWN0IEJyb3dzZXIgRW52aXJvbm1lbnRcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGlzQnJvd3NlcigpOiBib29sZWFuIHtcbiAgcmV0dXJuIHR5cGVvZiBzZWxmID09PSAnb2JqZWN0JyAmJiBzZWxmLnNlbGYgPT09IHNlbGY7XG59XG5cbi8qKlxuICogRGV0ZWN0IGJyb3dzZXIgZXh0ZW5zaW9ucyAoQ2hyb21lIGFuZCBGaXJlZm94IGF0IGxlYXN0KS5cbiAqL1xuaW50ZXJmYWNlIEJyb3dzZXJSdW50aW1lIHtcbiAgaWQ/OiB1bmtub3duO1xufVxuZGVjbGFyZSBjb25zdCBjaHJvbWU6IHsgcnVudGltZT86IEJyb3dzZXJSdW50aW1lIH07XG5kZWNsYXJlIGNvbnN0IGJyb3dzZXI6IHsgcnVudGltZT86IEJyb3dzZXJSdW50aW1lIH07XG5leHBvcnQgZnVuY3Rpb24gaXNCcm93c2VyRXh0ZW5zaW9uKCk6IGJvb2xlYW4ge1xuICBjb25zdCBydW50aW1lID1cbiAgICB0eXBlb2YgY2hyb21lID09PSAnb2JqZWN0J1xuICAgICAgPyBjaHJvbWUucnVudGltZVxuICAgICAgOiB0eXBlb2YgYnJvd3NlciA9PT0gJ29iamVjdCdcbiAgICAgID8gYnJvd3Nlci5ydW50aW1lXG4gICAgICA6IHVuZGVmaW5lZDtcbiAgcmV0dXJuIHR5cGVvZiBydW50aW1lID09PSAnb2JqZWN0JyAmJiBydW50aW1lLmlkICE9PSB1bmRlZmluZWQ7XG59XG5cbi8qKlxuICogRGV0ZWN0IFJlYWN0IE5hdGl2ZS5cbiAqXG4gKiBAcmV0dXJuIHRydWUgaWYgUmVhY3ROYXRpdmUgZW52aXJvbm1lbnQgaXMgZGV0ZWN0ZWQuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpc1JlYWN0TmF0aXZlKCk6IGJvb2xlYW4ge1xuICByZXR1cm4gKFxuICAgIHR5cGVvZiBuYXZpZ2F0b3IgPT09ICdvYmplY3QnICYmIG5hdmlnYXRvclsncHJvZHVjdCddID09PSAnUmVhY3ROYXRpdmUnXG4gICk7XG59XG5cbi8qKiBEZXRlY3RzIEVsZWN0cm9uIGFwcHMuICovXG5leHBvcnQgZnVuY3Rpb24gaXNFbGVjdHJvbigpOiBib29sZWFuIHtcbiAgcmV0dXJuIGdldFVBKCkuaW5kZXhPZignRWxlY3Ryb24vJykgPj0gMDtcbn1cblxuLyoqIERldGVjdHMgSW50ZXJuZXQgRXhwbG9yZXIuICovXG5leHBvcnQgZnVuY3Rpb24gaXNJRSgpOiBib29sZWFuIHtcbiAgY29uc3QgdWEgPSBnZXRVQSgpO1xuICByZXR1cm4gdWEuaW5kZXhPZignTVNJRSAnKSA+PSAwIHx8IHVhLmluZGV4T2YoJ1RyaWRlbnQvJykgPj0gMDtcbn1cblxuLyoqIERldGVjdHMgVW5pdmVyc2FsIFdpbmRvd3MgUGxhdGZvcm0gYXBwcy4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpc1VXUCgpOiBib29sZWFuIHtcbiAgcmV0dXJuIGdldFVBKCkuaW5kZXhPZignTVNBcHBIb3N0LycpID49IDA7XG59XG5cbi8qKlxuICogRGV0ZWN0IHdoZXRoZXIgdGhlIGN1cnJlbnQgU0RLIGJ1aWxkIGlzIHRoZSBOb2RlIHZlcnNpb24uXG4gKlxuICogQHJldHVybiB0cnVlIGlmIGl0J3MgdGhlIE5vZGUgU0RLIGJ1aWxkLlxuICovXG5leHBvcnQgZnVuY3Rpb24gaXNOb2RlU2RrKCk6IGJvb2xlYW4ge1xuICByZXR1cm4gQ09OU1RBTlRTLk5PREVfQ0xJRU5UID09PSB0cnVlIHx8IENPTlNUQU5UUy5OT0RFX0FETUlOID09PSB0cnVlO1xufVxuXG4vKiogUmV0dXJucyB0cnVlIGlmIHdlIGFyZSBydW5uaW5nIGluIFNhZmFyaS4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpc1NhZmFyaSgpOiBib29sZWFuIHtcbiAgcmV0dXJuIChcbiAgICAhaXNOb2RlKCkgJiZcbiAgICBuYXZpZ2F0b3IudXNlckFnZW50LmluY2x1ZGVzKCdTYWZhcmknKSAmJlxuICAgICFuYXZpZ2F0b3IudXNlckFnZW50LmluY2x1ZGVzKCdDaHJvbWUnKVxuICApO1xufVxuXG4vKipcbiAqIFRoaXMgbWV0aG9kIGNoZWNrcyBpZiBpbmRleGVkREIgaXMgc3VwcG9ydGVkIGJ5IGN1cnJlbnQgYnJvd3Nlci9zZXJ2aWNlIHdvcmtlciBjb250ZXh0XG4gKiBAcmV0dXJuIHRydWUgaWYgaW5kZXhlZERCIGlzIHN1cHBvcnRlZCBieSBjdXJyZW50IGJyb3dzZXIvc2VydmljZSB3b3JrZXIgY29udGV4dFxuICovXG5leHBvcnQgZnVuY3Rpb24gaXNJbmRleGVkREJBdmFpbGFibGUoKTogYm9vbGVhbiB7XG4gIHJldHVybiB0eXBlb2YgaW5kZXhlZERCID09PSAnb2JqZWN0Jztcbn1cblxuLyoqXG4gKiBUaGlzIG1ldGhvZCB2YWxpZGF0ZXMgYnJvd3Nlci9zdyBjb250ZXh0IGZvciBpbmRleGVkREIgYnkgb3BlbmluZyBhIGR1bW15IGluZGV4ZWREQiBkYXRhYmFzZSBhbmQgcmVqZWN0XG4gKiBpZiBlcnJvcnMgb2NjdXIgZHVyaW5nIHRoZSBkYXRhYmFzZSBvcGVuIG9wZXJhdGlvbi5cbiAqXG4gKiBAdGhyb3dzIGV4Y2VwdGlvbiBpZiBjdXJyZW50IGJyb3dzZXIvc3cgY29udGV4dCBjYW4ndCBydW4gaWRiLm9wZW4gKGV4OiBTYWZhcmkgaWZyYW1lLCBGaXJlZm94XG4gKiBwcml2YXRlIGJyb3dzaW5nKVxuICovXG5leHBvcnQgZnVuY3Rpb24gdmFsaWRhdGVJbmRleGVkREJPcGVuYWJsZSgpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICB0cnkge1xuICAgICAgbGV0IHByZUV4aXN0OiBib29sZWFuID0gdHJ1ZTtcbiAgICAgIGNvbnN0IERCX0NIRUNLX05BTUUgPVxuICAgICAgICAndmFsaWRhdGUtYnJvd3Nlci1jb250ZXh0LWZvci1pbmRleGVkZGItYW5hbHl0aWNzLW1vZHVsZSc7XG4gICAgICBjb25zdCByZXF1ZXN0ID0gc2VsZi5pbmRleGVkREIub3BlbihEQl9DSEVDS19OQU1FKTtcbiAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gKCkgPT4ge1xuICAgICAgICByZXF1ZXN0LnJlc3VsdC5jbG9zZSgpO1xuICAgICAgICAvLyBkZWxldGUgZGF0YWJhc2Ugb25seSB3aGVuIGl0IGRvZXNuJ3QgcHJlLWV4aXN0XG4gICAgICAgIGlmICghcHJlRXhpc3QpIHtcbiAgICAgICAgICBzZWxmLmluZGV4ZWREQi5kZWxldGVEYXRhYmFzZShEQl9DSEVDS19OQU1FKTtcbiAgICAgICAgfVxuICAgICAgICByZXNvbHZlKHRydWUpO1xuICAgICAgfTtcbiAgICAgIHJlcXVlc3Qub251cGdyYWRlbmVlZGVkID0gKCkgPT4ge1xuICAgICAgICBwcmVFeGlzdCA9IGZhbHNlO1xuICAgICAgfTtcblxuICAgICAgcmVxdWVzdC5vbmVycm9yID0gKCkgPT4ge1xuICAgICAgICByZWplY3QocmVxdWVzdC5lcnJvcj8ubWVzc2FnZSB8fCAnJyk7XG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICByZWplY3QoZXJyb3IpO1xuICAgIH1cbiAgfSk7XG59XG5cbi8qKlxuICpcbiAqIFRoaXMgbWV0aG9kIGNoZWNrcyB3aGV0aGVyIGNvb2tpZSBpcyBlbmFibGVkIHdpdGhpbiBjdXJyZW50IGJyb3dzZXJcbiAqIEByZXR1cm4gdHJ1ZSBpZiBjb29raWUgaXMgZW5hYmxlZCB3aXRoaW4gY3VycmVudCBicm93c2VyXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBhcmVDb29raWVzRW5hYmxlZCgpOiBib29sZWFuIHtcbiAgaWYgKHR5cGVvZiBuYXZpZ2F0b3IgPT09ICd1bmRlZmluZWQnIHx8ICFuYXZpZ2F0b3IuY29va2llRW5hYmxlZCkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICByZXR1cm4gdHJ1ZTtcbn1cblxuLyoqXG4gKiBQb2x5ZmlsbCBmb3IgYGdsb2JhbFRoaXNgIG9iamVjdC5cbiAqIEByZXR1cm5zIHRoZSBgZ2xvYmFsVGhpc2Agb2JqZWN0IGZvciB0aGUgZ2l2ZW4gZW52aXJvbm1lbnQuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRHbG9iYWwoKTogdHlwZW9mIGdsb2JhbFRoaXMge1xuICBpZiAodHlwZW9mIHNlbGYgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgcmV0dXJuIHNlbGY7XG4gIH1cbiAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgcmV0dXJuIHdpbmRvdztcbiAgfVxuICBpZiAodHlwZW9mIGdsb2JhbCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICByZXR1cm4gZ2xvYmFsO1xuICB9XG4gIHRocm93IG5ldyBFcnJvcignVW5hYmxlIHRvIGxvY2F0ZSBnbG9iYWwgb2JqZWN0LicpO1xufVxuIiwgIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEBmaWxlb3ZlcnZpZXcgU3RhbmRhcmRpemVkIEZpcmViYXNlIEVycm9yLlxuICpcbiAqIFVzYWdlOlxuICpcbiAqICAgLy8gVHlwZXNjcmlwdCBzdHJpbmcgbGl0ZXJhbHMgZm9yIHR5cGUtc2FmZSBjb2Rlc1xuICogICB0eXBlIEVyciA9XG4gKiAgICAgJ3Vua25vd24nIHxcbiAqICAgICAnb2JqZWN0LW5vdC1mb3VuZCdcbiAqICAgICA7XG4gKlxuICogICAvLyBDbG9zdXJlIGVudW0gZm9yIHR5cGUtc2FmZSBlcnJvciBjb2Rlc1xuICogICAvLyBhdC1lbnVtIHtzdHJpbmd9XG4gKiAgIHZhciBFcnIgPSB7XG4gKiAgICAgVU5LTk9XTjogJ3Vua25vd24nLFxuICogICAgIE9CSkVDVF9OT1RfRk9VTkQ6ICdvYmplY3Qtbm90LWZvdW5kJyxcbiAqICAgfVxuICpcbiAqICAgbGV0IGVycm9yczogTWFwPEVyciwgc3RyaW5nPiA9IHtcbiAqICAgICAnZ2VuZXJpYy1lcnJvcic6IFwiVW5rbm93biBlcnJvclwiLFxuICogICAgICdmaWxlLW5vdC1mb3VuZCc6IFwiQ291bGQgbm90IGZpbmQgZmlsZTogeyRmaWxlfVwiLFxuICogICB9O1xuICpcbiAqICAgLy8gVHlwZS1zYWZlIGZ1bmN0aW9uIC0gbXVzdCBwYXNzIGEgdmFsaWQgZXJyb3IgY29kZSBhcyBwYXJhbS5cbiAqICAgbGV0IGVycm9yID0gbmV3IEVycm9yRmFjdG9yeTxFcnI+KCdzZXJ2aWNlJywgJ1NlcnZpY2UnLCBlcnJvcnMpO1xuICpcbiAqICAgLi4uXG4gKiAgIHRocm93IGVycm9yLmNyZWF0ZShFcnIuR0VORVJJQyk7XG4gKiAgIC4uLlxuICogICB0aHJvdyBlcnJvci5jcmVhdGUoRXJyLkZJTEVfTk9UX0ZPVU5ELCB7J2ZpbGUnOiBmaWxlTmFtZX0pO1xuICogICAuLi5cbiAqICAgLy8gU2VydmljZTogQ291bGQgbm90IGZpbGUgZmlsZTogZm9vLnR4dCAoc2VydmljZS9maWxlLW5vdC1mb3VuZCkuXG4gKlxuICogICBjYXRjaCAoZSkge1xuICogICAgIGFzc2VydChlLm1lc3NhZ2UgPT09IFwiQ291bGQgbm90IGZpbmQgZmlsZTogZm9vLnR4dC5cIik7XG4gKiAgICAgaWYgKGUuY29kZSA9PT0gJ3NlcnZpY2UvZmlsZS1ub3QtZm91bmQnKSB7XG4gKiAgICAgICBjb25zb2xlLmxvZyhcIkNvdWxkIG5vdCByZWFkIGZpbGU6IFwiICsgZVsnZmlsZSddKTtcbiAqICAgICB9XG4gKiAgIH1cbiAqL1xuXG5leHBvcnQgdHlwZSBFcnJvck1hcDxFcnJvckNvZGUgZXh0ZW5kcyBzdHJpbmc+ID0ge1xuICByZWFkb25seSBbSyBpbiBFcnJvckNvZGVdOiBzdHJpbmc7XG59O1xuXG5jb25zdCBFUlJPUl9OQU1FID0gJ0ZpcmViYXNlRXJyb3InO1xuXG5leHBvcnQgaW50ZXJmYWNlIFN0cmluZ0xpa2Uge1xuICB0b1N0cmluZygpOiBzdHJpbmc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgRXJyb3JEYXRhIHtcbiAgW2tleTogc3RyaW5nXTogdW5rbm93bjtcbn1cblxuLy8gQmFzZWQgb24gY29kZSBmcm9tOlxuLy8gaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvR2xvYmFsX09iamVjdHMvRXJyb3IjQ3VzdG9tX0Vycm9yX1R5cGVzXG5leHBvcnQgY2xhc3MgRmlyZWJhc2VFcnJvciBleHRlbmRzIEVycm9yIHtcbiAgLyoqIFRoZSBjdXN0b20gbmFtZSBmb3IgYWxsIEZpcmViYXNlRXJyb3JzLiAqL1xuICByZWFkb25seSBuYW1lOiBzdHJpbmcgPSBFUlJPUl9OQU1FO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIC8qKiBUaGUgZXJyb3IgY29kZSBmb3IgdGhpcyBlcnJvci4gKi9cbiAgICByZWFkb25seSBjb2RlOiBzdHJpbmcsXG4gICAgbWVzc2FnZTogc3RyaW5nLFxuICAgIC8qKiBDdXN0b20gZGF0YSBmb3IgdGhpcyBlcnJvci4gKi9cbiAgICBwdWJsaWMgY3VzdG9tRGF0YT86IFJlY29yZDxzdHJpbmcsIHVua25vd24+XG4gICkge1xuICAgIHN1cGVyKG1lc3NhZ2UpO1xuXG4gICAgLy8gRml4IEZvciBFUzVcbiAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vTWljcm9zb2Z0L1R5cGVTY3JpcHQtd2lraS9ibG9iL21hc3Rlci9CcmVha2luZy1DaGFuZ2VzLm1kI2V4dGVuZGluZy1idWlsdC1pbnMtbGlrZS1lcnJvci1hcnJheS1hbmQtbWFwLW1heS1uby1sb25nZXItd29ya1xuICAgIE9iamVjdC5zZXRQcm90b3R5cGVPZih0aGlzLCBGaXJlYmFzZUVycm9yLnByb3RvdHlwZSk7XG5cbiAgICAvLyBNYWludGFpbnMgcHJvcGVyIHN0YWNrIHRyYWNlIGZvciB3aGVyZSBvdXIgZXJyb3Igd2FzIHRocm93bi5cbiAgICAvLyBPbmx5IGF2YWlsYWJsZSBvbiBWOC5cbiAgICBpZiAoRXJyb3IuY2FwdHVyZVN0YWNrVHJhY2UpIHtcbiAgICAgIEVycm9yLmNhcHR1cmVTdGFja1RyYWNlKHRoaXMsIEVycm9yRmFjdG9yeS5wcm90b3R5cGUuY3JlYXRlKTtcbiAgICB9XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIEVycm9yRmFjdG9yeTxcbiAgRXJyb3JDb2RlIGV4dGVuZHMgc3RyaW5nLFxuICBFcnJvclBhcmFtcyBleHRlbmRzIHsgcmVhZG9ubHkgW0sgaW4gRXJyb3JDb2RlXT86IEVycm9yRGF0YSB9ID0ge31cbj4ge1xuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIHJlYWRvbmx5IHNlcnZpY2U6IHN0cmluZyxcbiAgICBwcml2YXRlIHJlYWRvbmx5IHNlcnZpY2VOYW1lOiBzdHJpbmcsXG4gICAgcHJpdmF0ZSByZWFkb25seSBlcnJvcnM6IEVycm9yTWFwPEVycm9yQ29kZT5cbiAgKSB7fVxuXG4gIGNyZWF0ZTxLIGV4dGVuZHMgRXJyb3JDb2RlPihcbiAgICBjb2RlOiBLLFxuICAgIC4uLmRhdGE6IEsgZXh0ZW5kcyBrZXlvZiBFcnJvclBhcmFtcyA/IFtFcnJvclBhcmFtc1tLXV0gOiBbXVxuICApOiBGaXJlYmFzZUVycm9yIHtcbiAgICBjb25zdCBjdXN0b21EYXRhID0gKGRhdGFbMF0gYXMgRXJyb3JEYXRhKSB8fCB7fTtcbiAgICBjb25zdCBmdWxsQ29kZSA9IGAke3RoaXMuc2VydmljZX0vJHtjb2RlfWA7XG4gICAgY29uc3QgdGVtcGxhdGUgPSB0aGlzLmVycm9yc1tjb2RlXTtcblxuICAgIGNvbnN0IG1lc3NhZ2UgPSB0ZW1wbGF0ZSA/IHJlcGxhY2VUZW1wbGF0ZSh0ZW1wbGF0ZSwgY3VzdG9tRGF0YSkgOiAnRXJyb3InO1xuICAgIC8vIFNlcnZpY2UgTmFtZTogRXJyb3IgbWVzc2FnZSAoc2VydmljZS9jb2RlKS5cbiAgICBjb25zdCBmdWxsTWVzc2FnZSA9IGAke3RoaXMuc2VydmljZU5hbWV9OiAke21lc3NhZ2V9ICgke2Z1bGxDb2RlfSkuYDtcblxuICAgIGNvbnN0IGVycm9yID0gbmV3IEZpcmViYXNlRXJyb3IoZnVsbENvZGUsIGZ1bGxNZXNzYWdlLCBjdXN0b21EYXRhKTtcblxuICAgIHJldHVybiBlcnJvcjtcbiAgfVxufVxuXG5mdW5jdGlvbiByZXBsYWNlVGVtcGxhdGUodGVtcGxhdGU6IHN0cmluZywgZGF0YTogRXJyb3JEYXRhKTogc3RyaW5nIHtcbiAgcmV0dXJuIHRlbXBsYXRlLnJlcGxhY2UoUEFUVEVSTiwgKF8sIGtleSkgPT4ge1xuICAgIGNvbnN0IHZhbHVlID0gZGF0YVtrZXldO1xuICAgIHJldHVybiB2YWx1ZSAhPSBudWxsID8gU3RyaW5nKHZhbHVlKSA6IGA8JHtrZXl9Pz5gO1xuICB9KTtcbn1cblxuY29uc3QgUEFUVEVSTiA9IC9cXHtcXCQoW159XSspfS9nO1xuIiwgIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbi8qKlxuICogRXZhbHVhdGVzIGEgSlNPTiBzdHJpbmcgaW50byBhIGphdmFzY3JpcHQgb2JqZWN0LlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBzdHIgQSBzdHJpbmcgY29udGFpbmluZyBKU09OLlxuICogQHJldHVybiB7Kn0gVGhlIGphdmFzY3JpcHQgb2JqZWN0IHJlcHJlc2VudGluZyB0aGUgc3BlY2lmaWVkIEpTT04uXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBqc29uRXZhbChzdHI6IHN0cmluZyk6IHVua25vd24ge1xuICByZXR1cm4gSlNPTi5wYXJzZShzdHIpO1xufVxuXG4vKipcbiAqIFJldHVybnMgSlNPTiByZXByZXNlbnRpbmcgYSBqYXZhc2NyaXB0IG9iamVjdC5cbiAqIEBwYXJhbSB7Kn0gZGF0YSBKYXZhc2NyaXB0IG9iamVjdCB0byBiZSBzdHJpbmdpZmllZC5cbiAqIEByZXR1cm4ge3N0cmluZ30gVGhlIEpTT04gY29udGVudHMgb2YgdGhlIG9iamVjdC5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHN0cmluZ2lmeShkYXRhOiB1bmtub3duKTogc3RyaW5nIHtcbiAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KGRhdGEpO1xufVxuIiwgIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7IGJhc2U2NERlY29kZSB9IGZyb20gJy4vY3J5cHQnO1xuaW1wb3J0IHsganNvbkV2YWwgfSBmcm9tICcuL2pzb24nO1xuXG5pbnRlcmZhY2UgQ2xhaW1zIHtcbiAgW2tleTogc3RyaW5nXToge307XG59XG5cbmludGVyZmFjZSBEZWNvZGVkVG9rZW4ge1xuICBoZWFkZXI6IG9iamVjdDtcbiAgY2xhaW1zOiBDbGFpbXM7XG4gIGRhdGE6IG9iamVjdDtcbiAgc2lnbmF0dXJlOiBzdHJpbmc7XG59XG5cbi8qKlxuICogRGVjb2RlcyBhIEZpcmViYXNlIGF1dGguIHRva2VuIGludG8gY29uc3RpdHVlbnQgcGFydHMuXG4gKlxuICogTm90ZXM6XG4gKiAtIE1heSByZXR1cm4gd2l0aCBpbnZhbGlkIC8gaW5jb21wbGV0ZSBjbGFpbXMgaWYgdGhlcmUncyBubyBuYXRpdmUgYmFzZTY0IGRlY29kaW5nIHN1cHBvcnQuXG4gKiAtIERvZXNuJ3QgY2hlY2sgaWYgdGhlIHRva2VuIGlzIGFjdHVhbGx5IHZhbGlkLlxuICovXG5leHBvcnQgY29uc3QgZGVjb2RlID0gZnVuY3Rpb24gKHRva2VuOiBzdHJpbmcpOiBEZWNvZGVkVG9rZW4ge1xuICBsZXQgaGVhZGVyID0ge30sXG4gICAgY2xhaW1zOiBDbGFpbXMgPSB7fSxcbiAgICBkYXRhID0ge30sXG4gICAgc2lnbmF0dXJlID0gJyc7XG5cbiAgdHJ5IHtcbiAgICBjb25zdCBwYXJ0cyA9IHRva2VuLnNwbGl0KCcuJyk7XG4gICAgaGVhZGVyID0ganNvbkV2YWwoYmFzZTY0RGVjb2RlKHBhcnRzWzBdKSB8fCAnJykgYXMgb2JqZWN0O1xuICAgIGNsYWltcyA9IGpzb25FdmFsKGJhc2U2NERlY29kZShwYXJ0c1sxXSkgfHwgJycpIGFzIENsYWltcztcbiAgICBzaWduYXR1cmUgPSBwYXJ0c1syXTtcbiAgICBkYXRhID0gY2xhaW1zWydkJ10gfHwge307XG4gICAgZGVsZXRlIGNsYWltc1snZCddO1xuICB9IGNhdGNoIChlKSB7fVxuXG4gIHJldHVybiB7XG4gICAgaGVhZGVyLFxuICAgIGNsYWltcyxcbiAgICBkYXRhLFxuICAgIHNpZ25hdHVyZVxuICB9O1xufTtcblxuaW50ZXJmYWNlIERlY29kZWRUb2tlbiB7XG4gIGhlYWRlcjogb2JqZWN0O1xuICBjbGFpbXM6IENsYWltcztcbiAgZGF0YTogb2JqZWN0O1xuICBzaWduYXR1cmU6IHN0cmluZztcbn1cblxuLyoqXG4gKiBEZWNvZGVzIGEgRmlyZWJhc2UgYXV0aC4gdG9rZW4gYW5kIGNoZWNrcyB0aGUgdmFsaWRpdHkgb2YgaXRzIHRpbWUtYmFzZWQgY2xhaW1zLiBXaWxsIHJldHVybiB0cnVlIGlmIHRoZVxuICogdG9rZW4gaXMgd2l0aGluIHRoZSB0aW1lIHdpbmRvdyBhdXRob3JpemVkIGJ5IHRoZSAnbmJmJyAobm90LWJlZm9yZSkgYW5kICdpYXQnIChpc3N1ZWQtYXQpIGNsYWltcy5cbiAqXG4gKiBOb3RlczpcbiAqIC0gTWF5IHJldHVybiBhIGZhbHNlIG5lZ2F0aXZlIGlmIHRoZXJlJ3Mgbm8gbmF0aXZlIGJhc2U2NCBkZWNvZGluZyBzdXBwb3J0LlxuICogLSBEb2Vzbid0IGNoZWNrIGlmIHRoZSB0b2tlbiBpcyBhY3R1YWxseSB2YWxpZC5cbiAqL1xuZXhwb3J0IGNvbnN0IGlzVmFsaWRUaW1lc3RhbXAgPSBmdW5jdGlvbiAodG9rZW46IHN0cmluZyk6IGJvb2xlYW4ge1xuICBjb25zdCBjbGFpbXM6IENsYWltcyA9IGRlY29kZSh0b2tlbikuY2xhaW1zO1xuICBjb25zdCBub3c6IG51bWJlciA9IE1hdGguZmxvb3IobmV3IERhdGUoKS5nZXRUaW1lKCkgLyAxMDAwKTtcbiAgbGV0IHZhbGlkU2luY2U6IG51bWJlciA9IDAsXG4gICAgdmFsaWRVbnRpbDogbnVtYmVyID0gMDtcblxuICBpZiAodHlwZW9mIGNsYWltcyA9PT0gJ29iamVjdCcpIHtcbiAgICBpZiAoY2xhaW1zLmhhc093blByb3BlcnR5KCduYmYnKSkge1xuICAgICAgdmFsaWRTaW5jZSA9IGNsYWltc1snbmJmJ10gYXMgbnVtYmVyO1xuICAgIH0gZWxzZSBpZiAoY2xhaW1zLmhhc093blByb3BlcnR5KCdpYXQnKSkge1xuICAgICAgdmFsaWRTaW5jZSA9IGNsYWltc1snaWF0J10gYXMgbnVtYmVyO1xuICAgIH1cblxuICAgIGlmIChjbGFpbXMuaGFzT3duUHJvcGVydHkoJ2V4cCcpKSB7XG4gICAgICB2YWxpZFVudGlsID0gY2xhaW1zWydleHAnXSBhcyBudW1iZXI7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIHRva2VuIHdpbGwgZXhwaXJlIGFmdGVyIDI0aCBieSBkZWZhdWx0XG4gICAgICB2YWxpZFVudGlsID0gdmFsaWRTaW5jZSArIDg2NDAwO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiAoXG4gICAgISFub3cgJiZcbiAgICAhIXZhbGlkU2luY2UgJiZcbiAgICAhIXZhbGlkVW50aWwgJiZcbiAgICBub3cgPj0gdmFsaWRTaW5jZSAmJlxuICAgIG5vdyA8PSB2YWxpZFVudGlsXG4gICk7XG59O1xuXG4vKipcbiAqIERlY29kZXMgYSBGaXJlYmFzZSBhdXRoLiB0b2tlbiBhbmQgcmV0dXJucyBpdHMgaXNzdWVkIGF0IHRpbWUgaWYgdmFsaWQsIG51bGwgb3RoZXJ3aXNlLlxuICpcbiAqIE5vdGVzOlxuICogLSBNYXkgcmV0dXJuIG51bGwgaWYgdGhlcmUncyBubyBuYXRpdmUgYmFzZTY0IGRlY29kaW5nIHN1cHBvcnQuXG4gKiAtIERvZXNuJ3QgY2hlY2sgaWYgdGhlIHRva2VuIGlzIGFjdHVhbGx5IHZhbGlkLlxuICovXG5leHBvcnQgY29uc3QgaXNzdWVkQXRUaW1lID0gZnVuY3Rpb24gKHRva2VuOiBzdHJpbmcpOiBudW1iZXIgfCBudWxsIHtcbiAgY29uc3QgY2xhaW1zOiBDbGFpbXMgPSBkZWNvZGUodG9rZW4pLmNsYWltcztcbiAgaWYgKHR5cGVvZiBjbGFpbXMgPT09ICdvYmplY3QnICYmIGNsYWltcy5oYXNPd25Qcm9wZXJ0eSgnaWF0JykpIHtcbiAgICByZXR1cm4gY2xhaW1zWydpYXQnXSBhcyBudW1iZXI7XG4gIH1cbiAgcmV0dXJuIG51bGw7XG59O1xuXG4vKipcbiAqIERlY29kZXMgYSBGaXJlYmFzZSBhdXRoLiB0b2tlbiBhbmQgY2hlY2tzIHRoZSB2YWxpZGl0eSBvZiBpdHMgZm9ybWF0LiBFeHBlY3RzIGEgdmFsaWQgaXNzdWVkLWF0IHRpbWUuXG4gKlxuICogTm90ZXM6XG4gKiAtIE1heSByZXR1cm4gYSBmYWxzZSBuZWdhdGl2ZSBpZiB0aGVyZSdzIG5vIG5hdGl2ZSBiYXNlNjQgZGVjb2Rpbmcgc3VwcG9ydC5cbiAqIC0gRG9lc24ndCBjaGVjayBpZiB0aGUgdG9rZW4gaXMgYWN0dWFsbHkgdmFsaWQuXG4gKi9cbmV4cG9ydCBjb25zdCBpc1ZhbGlkRm9ybWF0ID0gZnVuY3Rpb24gKHRva2VuOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgY29uc3QgZGVjb2RlZCA9IGRlY29kZSh0b2tlbiksXG4gICAgY2xhaW1zID0gZGVjb2RlZC5jbGFpbXM7XG5cbiAgcmV0dXJuICEhY2xhaW1zICYmIHR5cGVvZiBjbGFpbXMgPT09ICdvYmplY3QnICYmIGNsYWltcy5oYXNPd25Qcm9wZXJ0eSgnaWF0Jyk7XG59O1xuXG4vKipcbiAqIEF0dGVtcHRzIHRvIHBlZXIgaW50byBhbiBhdXRoIHRva2VuIGFuZCBkZXRlcm1pbmUgaWYgaXQncyBhbiBhZG1pbiBhdXRoIHRva2VuIGJ5IGxvb2tpbmcgYXQgdGhlIGNsYWltcyBwb3J0aW9uLlxuICpcbiAqIE5vdGVzOlxuICogLSBNYXkgcmV0dXJuIGEgZmFsc2UgbmVnYXRpdmUgaWYgdGhlcmUncyBubyBuYXRpdmUgYmFzZTY0IGRlY29kaW5nIHN1cHBvcnQuXG4gKiAtIERvZXNuJ3QgY2hlY2sgaWYgdGhlIHRva2VuIGlzIGFjdHVhbGx5IHZhbGlkLlxuICovXG5leHBvcnQgY29uc3QgaXNBZG1pbiA9IGZ1bmN0aW9uICh0b2tlbjogc3RyaW5nKTogYm9vbGVhbiB7XG4gIGNvbnN0IGNsYWltczogQ2xhaW1zID0gZGVjb2RlKHRva2VuKS5jbGFpbXM7XG4gIHJldHVybiB0eXBlb2YgY2xhaW1zID09PSAnb2JqZWN0JyAmJiBjbGFpbXNbJ2FkbWluJ10gPT09IHRydWU7XG59O1xuIiwgIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmV4cG9ydCBmdW5jdGlvbiBjb250YWluczxUIGV4dGVuZHMgb2JqZWN0PihvYmo6IFQsIGtleTogc3RyaW5nKTogYm9vbGVhbiB7XG4gIHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBrZXkpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gc2FmZUdldDxUIGV4dGVuZHMgb2JqZWN0LCBLIGV4dGVuZHMga2V5b2YgVD4oXG4gIG9iajogVCxcbiAga2V5OiBLXG4pOiBUW0tdIHwgdW5kZWZpbmVkIHtcbiAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGtleSkpIHtcbiAgICByZXR1cm4gb2JqW2tleV07XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNFbXB0eShvYmo6IG9iamVjdCk6IG9iaiBpcyB7fSB7XG4gIGZvciAoY29uc3Qga2V5IGluIG9iaikge1xuICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBrZXkpKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG4gIHJldHVybiB0cnVlO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gbWFwPEsgZXh0ZW5kcyBzdHJpbmcsIFYsIFU+KFxuICBvYmo6IHsgW2tleSBpbiBLXTogViB9LFxuICBmbjogKHZhbHVlOiBWLCBrZXk6IEssIG9iajogeyBba2V5IGluIEtdOiBWIH0pID0+IFUsXG4gIGNvbnRleHRPYmo/OiB1bmtub3duXG4pOiB7IFtrZXkgaW4gS106IFUgfSB7XG4gIGNvbnN0IHJlczogUGFydGlhbDx7IFtrZXkgaW4gS106IFUgfT4gPSB7fTtcbiAgZm9yIChjb25zdCBrZXkgaW4gb2JqKSB7XG4gICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGtleSkpIHtcbiAgICAgIHJlc1trZXldID0gZm4uY2FsbChjb250ZXh0T2JqLCBvYmpba2V5XSwga2V5LCBvYmopO1xuICAgIH1cbiAgfVxuICByZXR1cm4gcmVzIGFzIHsgW2tleSBpbiBLXTogVSB9O1xufVxuXG4vKipcbiAqIERlZXAgZXF1YWwgdHdvIG9iamVjdHMuIFN1cHBvcnQgQXJyYXlzIGFuZCBPYmplY3RzLlxuICovXG5leHBvcnQgZnVuY3Rpb24gZGVlcEVxdWFsKGE6IG9iamVjdCwgYjogb2JqZWN0KTogYm9vbGVhbiB7XG4gIGlmIChhID09PSBiKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICBjb25zdCBhS2V5cyA9IE9iamVjdC5rZXlzKGEpO1xuICBjb25zdCBiS2V5cyA9IE9iamVjdC5rZXlzKGIpO1xuICBmb3IgKGNvbnN0IGsgb2YgYUtleXMpIHtcbiAgICBpZiAoIWJLZXlzLmluY2x1ZGVzKGspKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgY29uc3QgYVByb3AgPSAoYSBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPilba107XG4gICAgY29uc3QgYlByb3AgPSAoYiBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPilba107XG4gICAgaWYgKGlzT2JqZWN0KGFQcm9wKSAmJiBpc09iamVjdChiUHJvcCkpIHtcbiAgICAgIGlmICghZGVlcEVxdWFsKGFQcm9wLCBiUHJvcCkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoYVByb3AgIT09IGJQcm9wKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgZm9yIChjb25zdCBrIG9mIGJLZXlzKSB7XG4gICAgaWYgKCFhS2V5cy5pbmNsdWRlcyhrKSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuICByZXR1cm4gdHJ1ZTtcbn1cblxuZnVuY3Rpb24gaXNPYmplY3QodGhpbmc6IHVua25vd24pOiB0aGluZyBpcyBvYmplY3Qge1xuICByZXR1cm4gdGhpbmcgIT09IG51bGwgJiYgdHlwZW9mIHRoaW5nID09PSAnb2JqZWN0Jztcbn1cbiIsICIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG4vKipcbiAqIFJldHVybnMgYSBxdWVyeXN0cmluZy1mb3JtYXR0ZWQgc3RyaW5nIChlLmcuICZhcmc9dmFsJmFyZzI9dmFsMikgZnJvbSBhXG4gKiBwYXJhbXMgb2JqZWN0IChlLmcuIHthcmc6ICd2YWwnLCBhcmcyOiAndmFsMid9KVxuICogTm90ZTogWW91IG11c3QgcHJlcGVuZCBpdCB3aXRoID8gd2hlbiBhZGRpbmcgaXQgdG8gYSBVUkwuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBxdWVyeXN0cmluZyhxdWVyeXN0cmluZ1BhcmFtczoge1xuICBba2V5OiBzdHJpbmddOiBzdHJpbmcgfCBudW1iZXI7XG59KTogc3RyaW5nIHtcbiAgY29uc3QgcGFyYW1zID0gW107XG4gIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKHF1ZXJ5c3RyaW5nUGFyYW1zKSkge1xuICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSkge1xuICAgICAgdmFsdWUuZm9yRWFjaChhcnJheVZhbCA9PiB7XG4gICAgICAgIHBhcmFtcy5wdXNoKFxuICAgICAgICAgIGVuY29kZVVSSUNvbXBvbmVudChrZXkpICsgJz0nICsgZW5jb2RlVVJJQ29tcG9uZW50KGFycmF5VmFsKVxuICAgICAgICApO1xuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHBhcmFtcy5wdXNoKGVuY29kZVVSSUNvbXBvbmVudChrZXkpICsgJz0nICsgZW5jb2RlVVJJQ29tcG9uZW50KHZhbHVlKSk7XG4gICAgfVxuICB9XG4gIHJldHVybiBwYXJhbXMubGVuZ3RoID8gJyYnICsgcGFyYW1zLmpvaW4oJyYnKSA6ICcnO1xufVxuXG4vKipcbiAqIERlY29kZXMgYSBxdWVyeXN0cmluZyAoZS5nLiA/YXJnPXZhbCZhcmcyPXZhbDIpIGludG8gYSBwYXJhbXMgb2JqZWN0XG4gKiAoZS5nLiB7YXJnOiAndmFsJywgYXJnMjogJ3ZhbDInfSlcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHF1ZXJ5c3RyaW5nRGVjb2RlKHF1ZXJ5c3RyaW5nOiBzdHJpbmcpOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+IHtcbiAgY29uc3Qgb2JqOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+ID0ge307XG4gIGNvbnN0IHRva2VucyA9IHF1ZXJ5c3RyaW5nLnJlcGxhY2UoL15cXD8vLCAnJykuc3BsaXQoJyYnKTtcblxuICB0b2tlbnMuZm9yRWFjaCh0b2tlbiA9PiB7XG4gICAgaWYgKHRva2VuKSB7XG4gICAgICBjb25zdCBba2V5LCB2YWx1ZV0gPSB0b2tlbi5zcGxpdCgnPScpO1xuICAgICAgb2JqW2RlY29kZVVSSUNvbXBvbmVudChrZXkpXSA9IGRlY29kZVVSSUNvbXBvbmVudCh2YWx1ZSk7XG4gICAgfVxuICB9KTtcbiAgcmV0dXJuIG9iajtcbn1cblxuLyoqXG4gKiBFeHRyYWN0IHRoZSBxdWVyeSBzdHJpbmcgcGFydCBvZiBhIFVSTCwgaW5jbHVkaW5nIHRoZSBsZWFkaW5nIHF1ZXN0aW9uIG1hcmsgKGlmIHByZXNlbnQpLlxuICovXG5leHBvcnQgZnVuY3Rpb24gZXh0cmFjdFF1ZXJ5c3RyaW5nKHVybDogc3RyaW5nKTogc3RyaW5nIHtcbiAgY29uc3QgcXVlcnlTdGFydCA9IHVybC5pbmRleE9mKCc/Jyk7XG4gIGlmICghcXVlcnlTdGFydCkge1xuICAgIHJldHVybiAnJztcbiAgfVxuICBjb25zdCBmcmFnbWVudFN0YXJ0ID0gdXJsLmluZGV4T2YoJyMnLCBxdWVyeVN0YXJ0KTtcbiAgcmV0dXJuIHVybC5zdWJzdHJpbmcoXG4gICAgcXVlcnlTdGFydCxcbiAgICBmcmFnbWVudFN0YXJ0ID4gMCA/IGZyYWdtZW50U3RhcnQgOiB1bmRlZmluZWRcbiAgKTtcbn1cbiIsICIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG4vKipcbiAqIEBmaWxlb3ZlcnZpZXcgU0hBLTEgY3J5cHRvZ3JhcGhpYyBoYXNoLlxuICogVmFyaWFibGUgbmFtZXMgZm9sbG93IHRoZSBub3RhdGlvbiBpbiBGSVBTIFBVQiAxODAtMzpcbiAqIGh0dHA6Ly9jc3JjLm5pc3QuZ292L3B1YmxpY2F0aW9ucy9maXBzL2ZpcHMxODAtMy9maXBzMTgwLTNfZmluYWwucGRmLlxuICpcbiAqIFVzYWdlOlxuICogICB2YXIgc2hhMSA9IG5ldyBzaGExKCk7XG4gKiAgIHNoYTEudXBkYXRlKGJ5dGVzKTtcbiAqICAgdmFyIGhhc2ggPSBzaGExLmRpZ2VzdCgpO1xuICpcbiAqIFBlcmZvcm1hbmNlOlxuICogICBDaHJvbWUgMjM6ICAgfjQwMCBNYml0L3NcbiAqICAgRmlyZWZveCAxNjogIH4yNTAgTWJpdC9zXG4gKlxuICovXG5cbi8qKlxuICogU0hBLTEgY3J5cHRvZ3JhcGhpYyBoYXNoIGNvbnN0cnVjdG9yLlxuICpcbiAqIFRoZSBwcm9wZXJ0aWVzIGRlY2xhcmVkIGhlcmUgYXJlIGRpc2N1c3NlZCBpbiB0aGUgYWJvdmUgYWxnb3JpdGhtIGRvY3VtZW50LlxuICogQGNvbnN0cnVjdG9yXG4gKiBAZmluYWxcbiAqIEBzdHJ1Y3RcbiAqL1xuZXhwb3J0IGNsYXNzIFNoYTEge1xuICAvKipcbiAgICogSG9sZHMgdGhlIHByZXZpb3VzIHZhbHVlcyBvZiBhY2N1bXVsYXRlZCB2YXJpYWJsZXMgYS1lIGluIHRoZSBjb21wcmVzc19cbiAgICogZnVuY3Rpb24uXG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBwcml2YXRlIGNoYWluXzogbnVtYmVyW10gPSBbXTtcblxuICAvKipcbiAgICogQSBidWZmZXIgaG9sZGluZyB0aGUgcGFydGlhbGx5IGNvbXB1dGVkIGhhc2ggcmVzdWx0LlxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgcHJpdmF0ZSBidWZfOiBudW1iZXJbXSA9IFtdO1xuXG4gIC8qKlxuICAgKiBBbiBhcnJheSBvZiA4MCBieXRlcywgZWFjaCBhIHBhcnQgb2YgdGhlIG1lc3NhZ2UgdG8gYmUgaGFzaGVkLiAgUmVmZXJyZWQgdG9cbiAgICogYXMgdGhlIG1lc3NhZ2Ugc2NoZWR1bGUgaW4gdGhlIGRvY3MuXG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBwcml2YXRlIFdfOiBudW1iZXJbXSA9IFtdO1xuXG4gIC8qKlxuICAgKiBDb250YWlucyBkYXRhIG5lZWRlZCB0byBwYWQgbWVzc2FnZXMgbGVzcyB0aGFuIDY0IGJ5dGVzLlxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgcHJpdmF0ZSBwYWRfOiBudW1iZXJbXSA9IFtdO1xuXG4gIC8qKlxuICAgKiBAcHJpdmF0ZSB7bnVtYmVyfVxuICAgKi9cbiAgcHJpdmF0ZSBpbmJ1Zl86IG51bWJlciA9IDA7XG5cbiAgLyoqXG4gICAqIEBwcml2YXRlIHtudW1iZXJ9XG4gICAqL1xuICBwcml2YXRlIHRvdGFsXzogbnVtYmVyID0gMDtcblxuICBibG9ja1NpemU6IG51bWJlcjtcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLmJsb2NrU2l6ZSA9IDUxMiAvIDg7XG5cbiAgICB0aGlzLnBhZF9bMF0gPSAxMjg7XG4gICAgZm9yIChsZXQgaSA9IDE7IGkgPCB0aGlzLmJsb2NrU2l6ZTsgKytpKSB7XG4gICAgICB0aGlzLnBhZF9baV0gPSAwO1xuICAgIH1cblxuICAgIHRoaXMucmVzZXQoKTtcbiAgfVxuXG4gIHJlc2V0KCk6IHZvaWQge1xuICAgIHRoaXMuY2hhaW5fWzBdID0gMHg2NzQ1MjMwMTtcbiAgICB0aGlzLmNoYWluX1sxXSA9IDB4ZWZjZGFiODk7XG4gICAgdGhpcy5jaGFpbl9bMl0gPSAweDk4YmFkY2ZlO1xuICAgIHRoaXMuY2hhaW5fWzNdID0gMHgxMDMyNTQ3NjtcbiAgICB0aGlzLmNoYWluX1s0XSA9IDB4YzNkMmUxZjA7XG5cbiAgICB0aGlzLmluYnVmXyA9IDA7XG4gICAgdGhpcy50b3RhbF8gPSAwO1xuICB9XG5cbiAgLyoqXG4gICAqIEludGVybmFsIGNvbXByZXNzIGhlbHBlciBmdW5jdGlvbi5cbiAgICogQHBhcmFtIGJ1ZiBCbG9jayB0byBjb21wcmVzcy5cbiAgICogQHBhcmFtIG9mZnNldCBPZmZzZXQgb2YgdGhlIGJsb2NrIGluIHRoZSBidWZmZXIuXG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBjb21wcmVzc18oYnVmOiBudW1iZXJbXSB8IFVpbnQ4QXJyYXkgfCBzdHJpbmcsIG9mZnNldD86IG51bWJlcik6IHZvaWQge1xuICAgIGlmICghb2Zmc2V0KSB7XG4gICAgICBvZmZzZXQgPSAwO1xuICAgIH1cblxuICAgIGNvbnN0IFcgPSB0aGlzLldfO1xuXG4gICAgLy8gZ2V0IDE2IGJpZyBlbmRpYW4gd29yZHNcbiAgICBpZiAodHlwZW9mIGJ1ZiA9PT0gJ3N0cmluZycpIHtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMTY7IGkrKykge1xuICAgICAgICAvLyBUT0RPKHVzZXIpOiBbYnVnIDgxNDAxMjJdIFJlY2VudCB2ZXJzaW9ucyBvZiBTYWZhcmkgZm9yIE1hYyBPUyBhbmQgaU9TXG4gICAgICAgIC8vIGhhdmUgYSBidWcgdGhhdCB0dXJucyB0aGUgcG9zdC1pbmNyZW1lbnQgKysgb3BlcmF0b3IgaW50byBwcmUtaW5jcmVtZW50XG4gICAgICAgIC8vIGR1cmluZyBKSVQgY29tcGlsYXRpb24uICBXZSBoYXZlIGNvZGUgdGhhdCBkZXBlbmRzIGhlYXZpbHkgb24gU0hBLTEgZm9yXG4gICAgICAgIC8vIGNvcnJlY3RuZXNzIGFuZCB3aGljaCBpcyBhZmZlY3RlZCBieSB0aGlzIGJ1Zywgc28gSSd2ZSByZW1vdmVkIGFsbCB1c2VzXG4gICAgICAgIC8vIG9mIHBvc3QtaW5jcmVtZW50ICsrIGluIHdoaWNoIHRoZSByZXN1bHQgdmFsdWUgaXMgdXNlZC4gIFdlIGNhbiByZXZlcnRcbiAgICAgICAgLy8gdGhpcyBjaGFuZ2Ugb25jZSB0aGUgU2FmYXJpIGJ1Z1xuICAgICAgICAvLyAoaHR0cHM6Ly9idWdzLndlYmtpdC5vcmcvc2hvd19idWcuY2dpP2lkPTEwOTAzNikgaGFzIGJlZW4gZml4ZWQgYW5kXG4gICAgICAgIC8vIG1vc3QgY2xpZW50cyBoYXZlIGJlZW4gdXBkYXRlZC5cbiAgICAgICAgV1tpXSA9XG4gICAgICAgICAgKGJ1Zi5jaGFyQ29kZUF0KG9mZnNldCkgPDwgMjQpIHxcbiAgICAgICAgICAoYnVmLmNoYXJDb2RlQXQob2Zmc2V0ICsgMSkgPDwgMTYpIHxcbiAgICAgICAgICAoYnVmLmNoYXJDb2RlQXQob2Zmc2V0ICsgMikgPDwgOCkgfFxuICAgICAgICAgIGJ1Zi5jaGFyQ29kZUF0KG9mZnNldCArIDMpO1xuICAgICAgICBvZmZzZXQgKz0gNDtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAxNjsgaSsrKSB7XG4gICAgICAgIFdbaV0gPVxuICAgICAgICAgIChidWZbb2Zmc2V0XSA8PCAyNCkgfFxuICAgICAgICAgIChidWZbb2Zmc2V0ICsgMV0gPDwgMTYpIHxcbiAgICAgICAgICAoYnVmW29mZnNldCArIDJdIDw8IDgpIHxcbiAgICAgICAgICBidWZbb2Zmc2V0ICsgM107XG4gICAgICAgIG9mZnNldCArPSA0O1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIGV4cGFuZCB0byA4MCB3b3Jkc1xuICAgIGZvciAobGV0IGkgPSAxNjsgaSA8IDgwOyBpKyspIHtcbiAgICAgIGNvbnN0IHQgPSBXW2kgLSAzXSBeIFdbaSAtIDhdIF4gV1tpIC0gMTRdIF4gV1tpIC0gMTZdO1xuICAgICAgV1tpXSA9ICgodCA8PCAxKSB8ICh0ID4+PiAzMSkpICYgMHhmZmZmZmZmZjtcbiAgICB9XG5cbiAgICBsZXQgYSA9IHRoaXMuY2hhaW5fWzBdO1xuICAgIGxldCBiID0gdGhpcy5jaGFpbl9bMV07XG4gICAgbGV0IGMgPSB0aGlzLmNoYWluX1syXTtcbiAgICBsZXQgZCA9IHRoaXMuY2hhaW5fWzNdO1xuICAgIGxldCBlID0gdGhpcy5jaGFpbl9bNF07XG4gICAgbGV0IGYsIGs7XG5cbiAgICAvLyBUT0RPKHVzZXIpOiBUcnkgdG8gdW5yb2xsIHRoaXMgbG9vcCB0byBzcGVlZCB1cCB0aGUgY29tcHV0YXRpb24uXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCA4MDsgaSsrKSB7XG4gICAgICBpZiAoaSA8IDQwKSB7XG4gICAgICAgIGlmIChpIDwgMjApIHtcbiAgICAgICAgICBmID0gZCBeIChiICYgKGMgXiBkKSk7XG4gICAgICAgICAgayA9IDB4NWE4Mjc5OTk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZiA9IGIgXiBjIF4gZDtcbiAgICAgICAgICBrID0gMHg2ZWQ5ZWJhMTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKGkgPCA2MCkge1xuICAgICAgICAgIGYgPSAoYiAmIGMpIHwgKGQgJiAoYiB8IGMpKTtcbiAgICAgICAgICBrID0gMHg4ZjFiYmNkYztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBmID0gYiBeIGMgXiBkO1xuICAgICAgICAgIGsgPSAweGNhNjJjMWQ2O1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHQgPSAoKChhIDw8IDUpIHwgKGEgPj4+IDI3KSkgKyBmICsgZSArIGsgKyBXW2ldKSAmIDB4ZmZmZmZmZmY7XG4gICAgICBlID0gZDtcbiAgICAgIGQgPSBjO1xuICAgICAgYyA9ICgoYiA8PCAzMCkgfCAoYiA+Pj4gMikpICYgMHhmZmZmZmZmZjtcbiAgICAgIGIgPSBhO1xuICAgICAgYSA9IHQ7XG4gICAgfVxuXG4gICAgdGhpcy5jaGFpbl9bMF0gPSAodGhpcy5jaGFpbl9bMF0gKyBhKSAmIDB4ZmZmZmZmZmY7XG4gICAgdGhpcy5jaGFpbl9bMV0gPSAodGhpcy5jaGFpbl9bMV0gKyBiKSAmIDB4ZmZmZmZmZmY7XG4gICAgdGhpcy5jaGFpbl9bMl0gPSAodGhpcy5jaGFpbl9bMl0gKyBjKSAmIDB4ZmZmZmZmZmY7XG4gICAgdGhpcy5jaGFpbl9bM10gPSAodGhpcy5jaGFpbl9bM10gKyBkKSAmIDB4ZmZmZmZmZmY7XG4gICAgdGhpcy5jaGFpbl9bNF0gPSAodGhpcy5jaGFpbl9bNF0gKyBlKSAmIDB4ZmZmZmZmZmY7XG4gIH1cblxuICB1cGRhdGUoYnl0ZXM/OiBudW1iZXJbXSB8IFVpbnQ4QXJyYXkgfCBzdHJpbmcsIGxlbmd0aD86IG51bWJlcik6IHZvaWQge1xuICAgIC8vIFRPRE8oam9obmxlbnopOiB0aWdodGVuIHRoZSBmdW5jdGlvbiBzaWduYXR1cmUgYW5kIHJlbW92ZSB0aGlzIGNoZWNrXG4gICAgaWYgKGJ5dGVzID09IG51bGwpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAobGVuZ3RoID09PSB1bmRlZmluZWQpIHtcbiAgICAgIGxlbmd0aCA9IGJ5dGVzLmxlbmd0aDtcbiAgICB9XG5cbiAgICBjb25zdCBsZW5ndGhNaW51c0Jsb2NrID0gbGVuZ3RoIC0gdGhpcy5ibG9ja1NpemU7XG4gICAgbGV0IG4gPSAwO1xuICAgIC8vIFVzaW5nIGxvY2FsIGluc3RlYWQgb2YgbWVtYmVyIHZhcmlhYmxlcyBnaXZlcyB+NSUgc3BlZWR1cCBvbiBGaXJlZm94IDE2LlxuICAgIGNvbnN0IGJ1ZiA9IHRoaXMuYnVmXztcbiAgICBsZXQgaW5idWYgPSB0aGlzLmluYnVmXztcblxuICAgIC8vIFRoZSBvdXRlciB3aGlsZSBsb29wIHNob3VsZCBleGVjdXRlIGF0IG1vc3QgdHdpY2UuXG4gICAgd2hpbGUgKG4gPCBsZW5ndGgpIHtcbiAgICAgIC8vIFdoZW4gd2UgaGF2ZSBubyBkYXRhIGluIHRoZSBibG9jayB0byB0b3AgdXAsIHdlIGNhbiBkaXJlY3RseSBwcm9jZXNzIHRoZVxuICAgICAgLy8gaW5wdXQgYnVmZmVyIChhc3N1bWluZyBpdCBjb250YWlucyBzdWZmaWNpZW50IGRhdGEpLiBUaGlzIGdpdmVzIH4yNSVcbiAgICAgIC8vIHNwZWVkdXAgb24gQ2hyb21lIDIzIGFuZCB+MTUlIHNwZWVkdXAgb24gRmlyZWZveCAxNiwgYnV0IHJlcXVpcmVzIHRoYXRcbiAgICAgIC8vIHRoZSBkYXRhIGlzIHByb3ZpZGVkIGluIGxhcmdlIGNodW5rcyAob3IgaW4gbXVsdGlwbGVzIG9mIDY0IGJ5dGVzKS5cbiAgICAgIGlmIChpbmJ1ZiA9PT0gMCkge1xuICAgICAgICB3aGlsZSAobiA8PSBsZW5ndGhNaW51c0Jsb2NrKSB7XG4gICAgICAgICAgdGhpcy5jb21wcmVzc18oYnl0ZXMsIG4pO1xuICAgICAgICAgIG4gKz0gdGhpcy5ibG9ja1NpemU7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKHR5cGVvZiBieXRlcyA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgd2hpbGUgKG4gPCBsZW5ndGgpIHtcbiAgICAgICAgICBidWZbaW5idWZdID0gYnl0ZXMuY2hhckNvZGVBdChuKTtcbiAgICAgICAgICArK2luYnVmO1xuICAgICAgICAgICsrbjtcbiAgICAgICAgICBpZiAoaW5idWYgPT09IHRoaXMuYmxvY2tTaXplKSB7XG4gICAgICAgICAgICB0aGlzLmNvbXByZXNzXyhidWYpO1xuICAgICAgICAgICAgaW5idWYgPSAwO1xuICAgICAgICAgICAgLy8gSnVtcCB0byB0aGUgb3V0ZXIgbG9vcCBzbyB3ZSB1c2UgdGhlIGZ1bGwtYmxvY2sgb3B0aW1pemF0aW9uLlxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB3aGlsZSAobiA8IGxlbmd0aCkge1xuICAgICAgICAgIGJ1ZltpbmJ1Zl0gPSBieXRlc1tuXTtcbiAgICAgICAgICArK2luYnVmO1xuICAgICAgICAgICsrbjtcbiAgICAgICAgICBpZiAoaW5idWYgPT09IHRoaXMuYmxvY2tTaXplKSB7XG4gICAgICAgICAgICB0aGlzLmNvbXByZXNzXyhidWYpO1xuICAgICAgICAgICAgaW5idWYgPSAwO1xuICAgICAgICAgICAgLy8gSnVtcCB0byB0aGUgb3V0ZXIgbG9vcCBzbyB3ZSB1c2UgdGhlIGZ1bGwtYmxvY2sgb3B0aW1pemF0aW9uLlxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5pbmJ1Zl8gPSBpbmJ1ZjtcbiAgICB0aGlzLnRvdGFsXyArPSBsZW5ndGg7XG4gIH1cblxuICAvKiogQG92ZXJyaWRlICovXG4gIGRpZ2VzdCgpOiBudW1iZXJbXSB7XG4gICAgY29uc3QgZGlnZXN0OiBudW1iZXJbXSA9IFtdO1xuICAgIGxldCB0b3RhbEJpdHMgPSB0aGlzLnRvdGFsXyAqIDg7XG5cbiAgICAvLyBBZGQgcGFkIDB4ODAgMHgwMCouXG4gICAgaWYgKHRoaXMuaW5idWZfIDwgNTYpIHtcbiAgICAgIHRoaXMudXBkYXRlKHRoaXMucGFkXywgNTYgLSB0aGlzLmluYnVmXyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMudXBkYXRlKHRoaXMucGFkXywgdGhpcy5ibG9ja1NpemUgLSAodGhpcy5pbmJ1Zl8gLSA1NikpO1xuICAgIH1cblxuICAgIC8vIEFkZCAjIGJpdHMuXG4gICAgZm9yIChsZXQgaSA9IHRoaXMuYmxvY2tTaXplIC0gMTsgaSA+PSA1NjsgaS0tKSB7XG4gICAgICB0aGlzLmJ1Zl9baV0gPSB0b3RhbEJpdHMgJiAyNTU7XG4gICAgICB0b3RhbEJpdHMgLz0gMjU2OyAvLyBEb24ndCB1c2UgYml0LXNoaWZ0aW5nIGhlcmUhXG4gICAgfVxuXG4gICAgdGhpcy5jb21wcmVzc18odGhpcy5idWZfKTtcblxuICAgIGxldCBuID0gMDtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDU7IGkrKykge1xuICAgICAgZm9yIChsZXQgaiA9IDI0OyBqID49IDA7IGogLT0gOCkge1xuICAgICAgICBkaWdlc3Rbbl0gPSAodGhpcy5jaGFpbl9baV0gPj4gaikgJiAyNTU7XG4gICAgICAgICsrbjtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGRpZ2VzdDtcbiAgfVxufVxuIiwgIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5leHBvcnQgdHlwZSBOZXh0Rm48VD4gPSAodmFsdWU6IFQpID0+IHZvaWQ7XG5leHBvcnQgdHlwZSBFcnJvckZuID0gKGVycm9yOiBFcnJvcikgPT4gdm9pZDtcbmV4cG9ydCB0eXBlIENvbXBsZXRlRm4gPSAoKSA9PiB2b2lkO1xuXG5leHBvcnQgaW50ZXJmYWNlIE9ic2VydmVyPFQ+IHtcbiAgLy8gQ2FsbGVkIG9uY2UgZm9yIGVhY2ggdmFsdWUgaW4gYSBzdHJlYW0gb2YgdmFsdWVzLlxuICBuZXh0OiBOZXh0Rm48VD47XG5cbiAgLy8gQSBzdHJlYW0gdGVybWluYXRlcyBieSBhIHNpbmdsZSBjYWxsIHRvIEVJVEhFUiBlcnJvcigpIG9yIGNvbXBsZXRlKCkuXG4gIGVycm9yOiBFcnJvckZuO1xuXG4gIC8vIE5vIGV2ZW50cyB3aWxsIGJlIHNlbnQgdG8gbmV4dCgpIG9uY2UgY29tcGxldGUoKSBpcyBjYWxsZWQuXG4gIGNvbXBsZXRlOiBDb21wbGV0ZUZuO1xufVxuXG5leHBvcnQgdHlwZSBQYXJ0aWFsT2JzZXJ2ZXI8VD4gPSBQYXJ0aWFsPE9ic2VydmVyPFQ+PjtcblxuLy8gVE9ETzogU3VwcG9ydCBhbHNvIFVuc3Vic2NyaWJlLnVuc3Vic2NyaWJlP1xuZXhwb3J0IHR5cGUgVW5zdWJzY3JpYmUgPSAoKSA9PiB2b2lkO1xuXG4vKipcbiAqIFRoZSBTdWJzY3JpYmUgaW50ZXJmYWNlIGhhcyB0d28gZm9ybXMgLSBwYXNzaW5nIHRoZSBpbmxpbmUgZnVuY3Rpb25cbiAqIGNhbGxiYWNrcywgb3IgYSBvYmplY3QgaW50ZXJmYWNlIHdpdGggY2FsbGJhY2sgcHJvcGVydGllcy5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBTdWJzY3JpYmU8VD4ge1xuICAobmV4dD86IE5leHRGbjxUPiwgZXJyb3I/OiBFcnJvckZuLCBjb21wbGV0ZT86IENvbXBsZXRlRm4pOiBVbnN1YnNjcmliZTtcbiAgKG9ic2VydmVyOiBQYXJ0aWFsT2JzZXJ2ZXI8VD4pOiBVbnN1YnNjcmliZTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBPYnNlcnZhYmxlPFQ+IHtcbiAgLy8gU3Vic2NyaWJlIG1ldGhvZFxuICBzdWJzY3JpYmU6IFN1YnNjcmliZTxUPjtcbn1cblxuZXhwb3J0IHR5cGUgRXhlY3V0b3I8VD4gPSAob2JzZXJ2ZXI6IE9ic2VydmVyPFQ+KSA9PiB2b2lkO1xuXG4vKipcbiAqIEhlbHBlciB0byBtYWtlIGEgU3Vic2NyaWJlIGZ1bmN0aW9uIChqdXN0IGxpa2UgUHJvbWlzZSBoZWxwcyBtYWtlIGFcbiAqIFRoZW5hYmxlKS5cbiAqXG4gKiBAcGFyYW0gZXhlY3V0b3IgRnVuY3Rpb24gd2hpY2ggY2FuIG1ha2UgY2FsbHMgdG8gYSBzaW5nbGUgT2JzZXJ2ZXJcbiAqICAgICBhcyBhIHByb3h5LlxuICogQHBhcmFtIG9uTm9PYnNlcnZlcnMgQ2FsbGJhY2sgd2hlbiBjb3VudCBvZiBPYnNlcnZlcnMgZ29lcyB0byB6ZXJvLlxuICovXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlU3Vic2NyaWJlPFQ+KFxuICBleGVjdXRvcjogRXhlY3V0b3I8VD4sXG4gIG9uTm9PYnNlcnZlcnM/OiBFeGVjdXRvcjxUPlxuKTogU3Vic2NyaWJlPFQ+IHtcbiAgY29uc3QgcHJveHkgPSBuZXcgT2JzZXJ2ZXJQcm94eTxUPihleGVjdXRvciwgb25Ob09ic2VydmVycyk7XG4gIHJldHVybiBwcm94eS5zdWJzY3JpYmUuYmluZChwcm94eSk7XG59XG5cbi8qKlxuICogSW1wbGVtZW50IGZhbi1vdXQgZm9yIGFueSBudW1iZXIgb2YgT2JzZXJ2ZXJzIGF0dGFjaGVkIHZpYSBhIHN1YnNjcmliZVxuICogZnVuY3Rpb24uXG4gKi9cbmNsYXNzIE9ic2VydmVyUHJveHk8VD4gaW1wbGVtZW50cyBPYnNlcnZlcjxUPiB7XG4gIHByaXZhdGUgb2JzZXJ2ZXJzOiBBcnJheTxPYnNlcnZlcjxUPj4gfCB1bmRlZmluZWQgPSBbXTtcbiAgcHJpdmF0ZSB1bnN1YnNjcmliZXM6IFVuc3Vic2NyaWJlW10gPSBbXTtcbiAgcHJpdmF0ZSBvbk5vT2JzZXJ2ZXJzOiBFeGVjdXRvcjxUPiB8IHVuZGVmaW5lZDtcbiAgcHJpdmF0ZSBvYnNlcnZlckNvdW50ID0gMDtcbiAgLy8gTWljcm8tdGFzayBzY2hlZHVsaW5nIGJ5IGNhbGxpbmcgdGFzay50aGVuKCkuXG4gIHByaXZhdGUgdGFzayA9IFByb21pc2UucmVzb2x2ZSgpO1xuICBwcml2YXRlIGZpbmFsaXplZCA9IGZhbHNlO1xuICBwcml2YXRlIGZpbmFsRXJyb3I/OiBFcnJvcjtcblxuICAvKipcbiAgICogQHBhcmFtIGV4ZWN1dG9yIEZ1bmN0aW9uIHdoaWNoIGNhbiBtYWtlIGNhbGxzIHRvIGEgc2luZ2xlIE9ic2VydmVyXG4gICAqICAgICBhcyBhIHByb3h5LlxuICAgKiBAcGFyYW0gb25Ob09ic2VydmVycyBDYWxsYmFjayB3aGVuIGNvdW50IG9mIE9ic2VydmVycyBnb2VzIHRvIHplcm8uXG4gICAqL1xuICBjb25zdHJ1Y3RvcihleGVjdXRvcjogRXhlY3V0b3I8VD4sIG9uTm9PYnNlcnZlcnM/OiBFeGVjdXRvcjxUPikge1xuICAgIHRoaXMub25Ob09ic2VydmVycyA9IG9uTm9PYnNlcnZlcnM7XG4gICAgLy8gQ2FsbCB0aGUgZXhlY3V0b3IgYXN5bmNocm9ub3VzbHkgc28gc3Vic2NyaWJlcnMgdGhhdCBhcmUgY2FsbGVkXG4gICAgLy8gc3luY2hyb25vdXNseSBhZnRlciB0aGUgY3JlYXRpb24gb2YgdGhlIHN1YnNjcmliZSBmdW5jdGlvblxuICAgIC8vIGNhbiBzdGlsbCByZWNlaXZlIHRoZSB2ZXJ5IGZpcnN0IHZhbHVlIGdlbmVyYXRlZCBpbiB0aGUgZXhlY3V0b3IuXG4gICAgdGhpcy50YXNrXG4gICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgIGV4ZWN1dG9yKHRoaXMpO1xuICAgICAgfSlcbiAgICAgIC5jYXRjaChlID0+IHtcbiAgICAgICAgdGhpcy5lcnJvcihlKTtcbiAgICAgIH0pO1xuICB9XG5cbiAgbmV4dCh2YWx1ZTogVCk6IHZvaWQge1xuICAgIHRoaXMuZm9yRWFjaE9ic2VydmVyKChvYnNlcnZlcjogT2JzZXJ2ZXI8VD4pID0+IHtcbiAgICAgIG9ic2VydmVyLm5leHQodmFsdWUpO1xuICAgIH0pO1xuICB9XG5cbiAgZXJyb3IoZXJyb3I6IEVycm9yKTogdm9pZCB7XG4gICAgdGhpcy5mb3JFYWNoT2JzZXJ2ZXIoKG9ic2VydmVyOiBPYnNlcnZlcjxUPikgPT4ge1xuICAgICAgb2JzZXJ2ZXIuZXJyb3IoZXJyb3IpO1xuICAgIH0pO1xuICAgIHRoaXMuY2xvc2UoZXJyb3IpO1xuICB9XG5cbiAgY29tcGxldGUoKTogdm9pZCB7XG4gICAgdGhpcy5mb3JFYWNoT2JzZXJ2ZXIoKG9ic2VydmVyOiBPYnNlcnZlcjxUPikgPT4ge1xuICAgICAgb2JzZXJ2ZXIuY29tcGxldGUoKTtcbiAgICB9KTtcbiAgICB0aGlzLmNsb3NlKCk7XG4gIH1cblxuICAvKipcbiAgICogU3Vic2NyaWJlIGZ1bmN0aW9uIHRoYXQgY2FuIGJlIHVzZWQgdG8gYWRkIGFuIE9ic2VydmVyIHRvIHRoZSBmYW4tb3V0IGxpc3QuXG4gICAqXG4gICAqIC0gV2UgcmVxdWlyZSB0aGF0IG5vIGV2ZW50IGlzIHNlbnQgdG8gYSBzdWJzY3JpYmVyIHN5Y2hyb25vdXNseSB0byB0aGVpclxuICAgKiAgIGNhbGwgdG8gc3Vic2NyaWJlKCkuXG4gICAqL1xuICBzdWJzY3JpYmUoXG4gICAgbmV4dE9yT2JzZXJ2ZXI/OiBOZXh0Rm48VD4gfCBQYXJ0aWFsT2JzZXJ2ZXI8VD4sXG4gICAgZXJyb3I/OiBFcnJvckZuLFxuICAgIGNvbXBsZXRlPzogQ29tcGxldGVGblxuICApOiBVbnN1YnNjcmliZSB7XG4gICAgbGV0IG9ic2VydmVyOiBPYnNlcnZlcjxUPjtcblxuICAgIGlmIChcbiAgICAgIG5leHRPck9ic2VydmVyID09PSB1bmRlZmluZWQgJiZcbiAgICAgIGVycm9yID09PSB1bmRlZmluZWQgJiZcbiAgICAgIGNvbXBsZXRlID09PSB1bmRlZmluZWRcbiAgICApIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignTWlzc2luZyBPYnNlcnZlci4nKTtcbiAgICB9XG5cbiAgICAvLyBBc3NlbWJsZSBhbiBPYnNlcnZlciBvYmplY3Qgd2hlbiBwYXNzZWQgYXMgY2FsbGJhY2sgZnVuY3Rpb25zLlxuICAgIGlmIChcbiAgICAgIGltcGxlbWVudHNBbnlNZXRob2RzKG5leHRPck9ic2VydmVyIGFzIHsgW2tleTogc3RyaW5nXTogdW5rbm93biB9LCBbXG4gICAgICAgICduZXh0JyxcbiAgICAgICAgJ2Vycm9yJyxcbiAgICAgICAgJ2NvbXBsZXRlJ1xuICAgICAgXSlcbiAgICApIHtcbiAgICAgIG9ic2VydmVyID0gbmV4dE9yT2JzZXJ2ZXIgYXMgT2JzZXJ2ZXI8VD47XG4gICAgfSBlbHNlIHtcbiAgICAgIG9ic2VydmVyID0ge1xuICAgICAgICBuZXh0OiBuZXh0T3JPYnNlcnZlciBhcyBOZXh0Rm48VD4sXG4gICAgICAgIGVycm9yLFxuICAgICAgICBjb21wbGV0ZVxuICAgICAgfSBhcyBPYnNlcnZlcjxUPjtcbiAgICB9XG5cbiAgICBpZiAob2JzZXJ2ZXIubmV4dCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICBvYnNlcnZlci5uZXh0ID0gbm9vcCBhcyBOZXh0Rm48VD47XG4gICAgfVxuICAgIGlmIChvYnNlcnZlci5lcnJvciA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICBvYnNlcnZlci5lcnJvciA9IG5vb3AgYXMgRXJyb3JGbjtcbiAgICB9XG4gICAgaWYgKG9ic2VydmVyLmNvbXBsZXRlID09PSB1bmRlZmluZWQpIHtcbiAgICAgIG9ic2VydmVyLmNvbXBsZXRlID0gbm9vcCBhcyBDb21wbGV0ZUZuO1xuICAgIH1cblxuICAgIGNvbnN0IHVuc3ViID0gdGhpcy51bnN1YnNjcmliZU9uZS5iaW5kKHRoaXMsIHRoaXMub2JzZXJ2ZXJzIS5sZW5ndGgpO1xuXG4gICAgLy8gQXR0ZW1wdCB0byBzdWJzY3JpYmUgdG8gYSB0ZXJtaW5hdGVkIE9ic2VydmFibGUgLSB3ZVxuICAgIC8vIGp1c3QgcmVzcG9uZCB0byB0aGUgT2JzZXJ2ZXIgd2l0aCB0aGUgZmluYWwgZXJyb3Igb3IgY29tcGxldGVcbiAgICAvLyBldmVudC5cbiAgICBpZiAodGhpcy5maW5hbGl6ZWQpIHtcbiAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZmxvYXRpbmctcHJvbWlzZXNcbiAgICAgIHRoaXMudGFzay50aGVuKCgpID0+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBpZiAodGhpcy5maW5hbEVycm9yKSB7XG4gICAgICAgICAgICBvYnNlcnZlci5lcnJvcih0aGlzLmZpbmFsRXJyb3IpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBvYnNlcnZlci5jb21wbGV0ZSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgIC8vIG5vdGhpbmdcbiAgICAgICAgfVxuICAgICAgICByZXR1cm47XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICB0aGlzLm9ic2VydmVycyEucHVzaChvYnNlcnZlciBhcyBPYnNlcnZlcjxUPik7XG5cbiAgICByZXR1cm4gdW5zdWI7XG4gIH1cblxuICAvLyBVbnN1YnNjcmliZSBpcyBzeW5jaHJvbm91cyAtIHdlIGd1YXJhbnRlZSB0aGF0IG5vIGV2ZW50cyBhcmUgc2VudCB0b1xuICAvLyBhbnkgdW5zdWJzY3JpYmVkIE9ic2VydmVyLlxuICBwcml2YXRlIHVuc3Vic2NyaWJlT25lKGk6IG51bWJlcik6IHZvaWQge1xuICAgIGlmICh0aGlzLm9ic2VydmVycyA9PT0gdW5kZWZpbmVkIHx8IHRoaXMub2JzZXJ2ZXJzW2ldID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBkZWxldGUgdGhpcy5vYnNlcnZlcnNbaV07XG5cbiAgICB0aGlzLm9ic2VydmVyQ291bnQgLT0gMTtcbiAgICBpZiAodGhpcy5vYnNlcnZlckNvdW50ID09PSAwICYmIHRoaXMub25Ob09ic2VydmVycyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICB0aGlzLm9uTm9PYnNlcnZlcnModGhpcyk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBmb3JFYWNoT2JzZXJ2ZXIoZm46IChvYnNlcnZlcjogT2JzZXJ2ZXI8VD4pID0+IHZvaWQpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5maW5hbGl6ZWQpIHtcbiAgICAgIC8vIEFscmVhZHkgY2xvc2VkIGJ5IHByZXZpb3VzIGV2ZW50Li4uLmp1c3QgZWF0IHRoZSBhZGRpdGlvbmFsIHZhbHVlcy5cbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBTaW5jZSBzZW5kT25lIGNhbGxzIGFzeW5jaHJvbm91c2x5IC0gdGhlcmUgaXMgbm8gY2hhbmNlIHRoYXRcbiAgICAvLyB0aGlzLm9ic2VydmVycyB3aWxsIGJlY29tZSB1bmRlZmluZWQuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLm9ic2VydmVycyEubGVuZ3RoOyBpKyspIHtcbiAgICAgIHRoaXMuc2VuZE9uZShpLCBmbik7XG4gICAgfVxuICB9XG5cbiAgLy8gQ2FsbCB0aGUgT2JzZXJ2ZXIgdmlhIG9uZSBvZiBpdCdzIGNhbGxiYWNrIGZ1bmN0aW9uLiBXZSBhcmUgY2FyZWZ1bCB0b1xuICAvLyBjb25maXJtIHRoYXQgdGhlIG9ic2VydmUgaGFzIG5vdCBiZWVuIHVuc3Vic2NyaWJlZCBzaW5jZSB0aGlzIGFzeW5jaHJvbm91c1xuICAvLyBmdW5jdGlvbiBoYWQgYmVlbiBxdWV1ZWQuXG4gIHByaXZhdGUgc2VuZE9uZShpOiBudW1iZXIsIGZuOiAob2JzZXJ2ZXI6IE9ic2VydmVyPFQ+KSA9PiB2b2lkKTogdm9pZCB7XG4gICAgLy8gRXhlY3V0ZSB0aGUgY2FsbGJhY2sgYXN5bmNocm9ub3VzbHlcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWZsb2F0aW5nLXByb21pc2VzXG4gICAgdGhpcy50YXNrLnRoZW4oKCkgPT4ge1xuICAgICAgaWYgKHRoaXMub2JzZXJ2ZXJzICE9PSB1bmRlZmluZWQgJiYgdGhpcy5vYnNlcnZlcnNbaV0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGZuKHRoaXMub2JzZXJ2ZXJzW2ldKTtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgIC8vIElnbm9yZSBleGNlcHRpb25zIHJhaXNlZCBpbiBPYnNlcnZlcnMgb3IgbWlzc2luZyBtZXRob2RzIG9mIGFuXG4gICAgICAgICAgLy8gT2JzZXJ2ZXIuXG4gICAgICAgICAgLy8gTG9nIGVycm9yIHRvIGNvbnNvbGUuIGIvMzE0MDQ4MDZcbiAgICAgICAgICBpZiAodHlwZW9mIGNvbnNvbGUgIT09ICd1bmRlZmluZWQnICYmIGNvbnNvbGUuZXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGNsb3NlKGVycj86IEVycm9yKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuZmluYWxpemVkKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuZmluYWxpemVkID0gdHJ1ZTtcbiAgICBpZiAoZXJyICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHRoaXMuZmluYWxFcnJvciA9IGVycjtcbiAgICB9XG4gICAgLy8gUHJveHkgaXMgbm8gbG9uZ2VyIG5lZWRlZCAtIGdhcmJhZ2UgY29sbGVjdCByZWZlcmVuY2VzXG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1mbG9hdGluZy1wcm9taXNlc1xuICAgIHRoaXMudGFzay50aGVuKCgpID0+IHtcbiAgICAgIHRoaXMub2JzZXJ2ZXJzID0gdW5kZWZpbmVkO1xuICAgICAgdGhpcy5vbk5vT2JzZXJ2ZXJzID0gdW5kZWZpbmVkO1xuICAgIH0pO1xuICB9XG59XG5cbi8qKiBUdXJuIHN5bmNocm9ub3VzIGZ1bmN0aW9uIGludG8gb25lIGNhbGxlZCBhc3luY2hyb25vdXNseS4gKi9cbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvYmFuLXR5cGVzXG5leHBvcnQgZnVuY3Rpb24gYXN5bmMoZm46IEZ1bmN0aW9uLCBvbkVycm9yPzogRXJyb3JGbik6IEZ1bmN0aW9uIHtcbiAgcmV0dXJuICguLi5hcmdzOiB1bmtub3duW10pID0+IHtcbiAgICBQcm9taXNlLnJlc29sdmUodHJ1ZSlcbiAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgZm4oLi4uYXJncyk7XG4gICAgICB9KVxuICAgICAgLmNhdGNoKChlcnJvcjogRXJyb3IpID0+IHtcbiAgICAgICAgaWYgKG9uRXJyb3IpIHtcbiAgICAgICAgICBvbkVycm9yKGVycm9yKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gIH07XG59XG5cbi8qKlxuICogUmV0dXJuIHRydWUgaWYgdGhlIG9iamVjdCBwYXNzZWQgaW4gaW1wbGVtZW50cyBhbnkgb2YgdGhlIG5hbWVkIG1ldGhvZHMuXG4gKi9cbmZ1bmN0aW9uIGltcGxlbWVudHNBbnlNZXRob2RzKFxuICBvYmo6IHsgW2tleTogc3RyaW5nXTogdW5rbm93biB9LFxuICBtZXRob2RzOiBzdHJpbmdbXVxuKTogYm9vbGVhbiB7XG4gIGlmICh0eXBlb2Ygb2JqICE9PSAnb2JqZWN0JyB8fCBvYmogPT09IG51bGwpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBmb3IgKGNvbnN0IG1ldGhvZCBvZiBtZXRob2RzKSB7XG4gICAgaWYgKG1ldGhvZCBpbiBvYmogJiYgdHlwZW9mIG9ialttZXRob2RdID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gZmFsc2U7XG59XG5cbmZ1bmN0aW9uIG5vb3AoKTogdm9pZCB7XG4gIC8vIGRvIG5vdGhpbmdcbn1cbiIsICIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG4vKipcbiAqIENoZWNrIHRvIG1ha2Ugc3VyZSB0aGUgYXBwcm9wcmlhdGUgbnVtYmVyIG9mIGFyZ3VtZW50cyBhcmUgcHJvdmlkZWQgZm9yIGEgcHVibGljIGZ1bmN0aW9uLlxuICogVGhyb3dzIGFuIGVycm9yIGlmIGl0IGZhaWxzLlxuICpcbiAqIEBwYXJhbSBmbk5hbWUgVGhlIGZ1bmN0aW9uIG5hbWVcbiAqIEBwYXJhbSBtaW5Db3VudCBUaGUgbWluaW11bSBudW1iZXIgb2YgYXJndW1lbnRzIHRvIGFsbG93IGZvciB0aGUgZnVuY3Rpb24gY2FsbFxuICogQHBhcmFtIG1heENvdW50IFRoZSBtYXhpbXVtIG51bWJlciBvZiBhcmd1bWVudCB0byBhbGxvdyBmb3IgdGhlIGZ1bmN0aW9uIGNhbGxcbiAqIEBwYXJhbSBhcmdDb3VudCBUaGUgYWN0dWFsIG51bWJlciBvZiBhcmd1bWVudHMgcHJvdmlkZWQuXG4gKi9cbmV4cG9ydCBjb25zdCB2YWxpZGF0ZUFyZ0NvdW50ID0gZnVuY3Rpb24gKFxuICBmbk5hbWU6IHN0cmluZyxcbiAgbWluQ291bnQ6IG51bWJlcixcbiAgbWF4Q291bnQ6IG51bWJlcixcbiAgYXJnQ291bnQ6IG51bWJlclxuKTogdm9pZCB7XG4gIGxldCBhcmdFcnJvcjtcbiAgaWYgKGFyZ0NvdW50IDwgbWluQ291bnQpIHtcbiAgICBhcmdFcnJvciA9ICdhdCBsZWFzdCAnICsgbWluQ291bnQ7XG4gIH0gZWxzZSBpZiAoYXJnQ291bnQgPiBtYXhDb3VudCkge1xuICAgIGFyZ0Vycm9yID0gbWF4Q291bnQgPT09IDAgPyAnbm9uZScgOiAnbm8gbW9yZSB0aGFuICcgKyBtYXhDb3VudDtcbiAgfVxuICBpZiAoYXJnRXJyb3IpIHtcbiAgICBjb25zdCBlcnJvciA9XG4gICAgICBmbk5hbWUgK1xuICAgICAgJyBmYWlsZWQ6IFdhcyBjYWxsZWQgd2l0aCAnICtcbiAgICAgIGFyZ0NvdW50ICtcbiAgICAgIChhcmdDb3VudCA9PT0gMSA/ICcgYXJndW1lbnQuJyA6ICcgYXJndW1lbnRzLicpICtcbiAgICAgICcgRXhwZWN0cyAnICtcbiAgICAgIGFyZ0Vycm9yICtcbiAgICAgICcuJztcbiAgICB0aHJvdyBuZXcgRXJyb3IoZXJyb3IpO1xuICB9XG59O1xuXG4vKipcbiAqIEdlbmVyYXRlcyBhIHN0cmluZyB0byBwcmVmaXggYW4gZXJyb3IgbWVzc2FnZSBhYm91dCBmYWlsZWQgYXJndW1lbnQgdmFsaWRhdGlvblxuICpcbiAqIEBwYXJhbSBmbk5hbWUgVGhlIGZ1bmN0aW9uIG5hbWVcbiAqIEBwYXJhbSBhcmdOYW1lIFRoZSBuYW1lIG9mIHRoZSBhcmd1bWVudFxuICogQHJldHVybiBUaGUgcHJlZml4IHRvIGFkZCB0byB0aGUgZXJyb3IgdGhyb3duIGZvciB2YWxpZGF0aW9uLlxuICovXG5leHBvcnQgZnVuY3Rpb24gZXJyb3JQcmVmaXgoZm5OYW1lOiBzdHJpbmcsIGFyZ05hbWU6IHN0cmluZyk6IHN0cmluZyB7XG4gIHJldHVybiBgJHtmbk5hbWV9IGZhaWxlZDogJHthcmdOYW1lfSBhcmd1bWVudCBgO1xufVxuXG4vKipcbiAqIEBwYXJhbSBmbk5hbWVcbiAqIEBwYXJhbSBhcmd1bWVudE51bWJlclxuICogQHBhcmFtIG5hbWVzcGFjZVxuICogQHBhcmFtIG9wdGlvbmFsXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB2YWxpZGF0ZU5hbWVzcGFjZShcbiAgZm5OYW1lOiBzdHJpbmcsXG4gIG5hbWVzcGFjZTogc3RyaW5nLFxuICBvcHRpb25hbDogYm9vbGVhblxuKTogdm9pZCB7XG4gIGlmIChvcHRpb25hbCAmJiAhbmFtZXNwYWNlKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIGlmICh0eXBlb2YgbmFtZXNwYWNlICE9PSAnc3RyaW5nJykge1xuICAgIC8vVE9ETzogSSBzaG91bGQgZG8gbW9yZSB2YWxpZGF0aW9uIGhlcmUuIFdlIG9ubHkgYWxsb3cgY2VydGFpbiBjaGFycyBpbiBuYW1lc3BhY2VzLlxuICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgIGVycm9yUHJlZml4KGZuTmFtZSwgJ25hbWVzcGFjZScpICsgJ211c3QgYmUgYSB2YWxpZCBmaXJlYmFzZSBuYW1lc3BhY2UuJ1xuICAgICk7XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHZhbGlkYXRlQ2FsbGJhY2soXG4gIGZuTmFtZTogc3RyaW5nLFxuICBhcmd1bWVudE5hbWU6IHN0cmluZyxcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9iYW4tdHlwZXNcbiAgY2FsbGJhY2s6IEZ1bmN0aW9uLFxuICBvcHRpb25hbDogYm9vbGVhblxuKTogdm9pZCB7XG4gIGlmIChvcHRpb25hbCAmJiAhY2FsbGJhY2spIHtcbiAgICByZXR1cm47XG4gIH1cbiAgaWYgKHR5cGVvZiBjYWxsYmFjayAhPT0gJ2Z1bmN0aW9uJykge1xuICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgIGVycm9yUHJlZml4KGZuTmFtZSwgYXJndW1lbnROYW1lKSArICdtdXN0IGJlIGEgdmFsaWQgZnVuY3Rpb24uJ1xuICAgICk7XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHZhbGlkYXRlQ29udGV4dE9iamVjdChcbiAgZm5OYW1lOiBzdHJpbmcsXG4gIGFyZ3VtZW50TmFtZTogc3RyaW5nLFxuICBjb250ZXh0OiB1bmtub3duLFxuICBvcHRpb25hbDogYm9vbGVhblxuKTogdm9pZCB7XG4gIGlmIChvcHRpb25hbCAmJiAhY29udGV4dCkge1xuICAgIHJldHVybjtcbiAgfVxuICBpZiAodHlwZW9mIGNvbnRleHQgIT09ICdvYmplY3QnIHx8IGNvbnRleHQgPT09IG51bGwpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICBlcnJvclByZWZpeChmbk5hbWUsIGFyZ3VtZW50TmFtZSkgKyAnbXVzdCBiZSBhIHZhbGlkIGNvbnRleHQgb2JqZWN0LidcbiAgICApO1xuICB9XG59XG4iLCAiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHsgYXNzZXJ0IH0gZnJvbSAnLi9hc3NlcnQnO1xuXG4vLyBDb2RlIG9yaWdpbmFsbHkgY2FtZSBmcm9tIGdvb2cuY3J5cHQuc3RyaW5nVG9VdGY4Qnl0ZUFycmF5LCBidXQgZm9yIHNvbWUgcmVhc29uIHRoZXlcbi8vIGF1dG9tYXRpY2FsbHkgcmVwbGFjZWQgJ1xcclxcbicgd2l0aCAnXFxuJywgYW5kIHRoZXkgZGlkbid0IGhhbmRsZSBzdXJyb2dhdGUgcGFpcnMsXG4vLyBzbyBpdCdzIGJlZW4gbW9kaWZpZWQuXG5cbi8vIE5vdGUgdGhhdCBub3QgYWxsIFVuaWNvZGUgY2hhcmFjdGVycyBhcHBlYXIgYXMgc2luZ2xlIGNoYXJhY3RlcnMgaW4gSmF2YVNjcmlwdCBzdHJpbmdzLlxuLy8gZnJvbUNoYXJDb2RlIHJldHVybnMgdGhlIFVURi0xNiBlbmNvZGluZyBvZiBhIGNoYXJhY3RlciAtIHNvIHNvbWUgVW5pY29kZSBjaGFyYWN0ZXJzXG4vLyB1c2UgMiBjaGFyYWN0ZXJzIGluIEphdmFzY3JpcHQuICBBbGwgNC1ieXRlIFVURi04IGNoYXJhY3RlcnMgYmVnaW4gd2l0aCBhIGZpcnN0XG4vLyBjaGFyYWN0ZXIgaW4gdGhlIHJhbmdlIDB4RDgwMCAtIDB4REJGRiAodGhlIGZpcnN0IGNoYXJhY3RlciBvZiBhIHNvLWNhbGxlZCBzdXJyb2dhdGVcbi8vIHBhaXIpLlxuLy8gU2VlIGh0dHA6Ly93d3cuZWNtYS1pbnRlcm5hdGlvbmFsLm9yZy9lY21hLTI2Mi81LjEvI3NlYy0xNS4xLjNcblxuLyoqXG4gKiBAcGFyYW0ge3N0cmluZ30gc3RyXG4gKiBAcmV0dXJuIHtBcnJheX1cbiAqL1xuZXhwb3J0IGNvbnN0IHN0cmluZ1RvQnl0ZUFycmF5ID0gZnVuY3Rpb24gKHN0cjogc3RyaW5nKTogbnVtYmVyW10ge1xuICBjb25zdCBvdXQ6IG51bWJlcltdID0gW107XG4gIGxldCBwID0gMDtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBzdHIubGVuZ3RoOyBpKyspIHtcbiAgICBsZXQgYyA9IHN0ci5jaGFyQ29kZUF0KGkpO1xuXG4gICAgLy8gSXMgdGhpcyB0aGUgbGVhZCBzdXJyb2dhdGUgaW4gYSBzdXJyb2dhdGUgcGFpcj9cbiAgICBpZiAoYyA+PSAweGQ4MDAgJiYgYyA8PSAweGRiZmYpIHtcbiAgICAgIGNvbnN0IGhpZ2ggPSBjIC0gMHhkODAwOyAvLyB0aGUgaGlnaCAxMCBiaXRzLlxuICAgICAgaSsrO1xuICAgICAgYXNzZXJ0KGkgPCBzdHIubGVuZ3RoLCAnU3Vycm9nYXRlIHBhaXIgbWlzc2luZyB0cmFpbCBzdXJyb2dhdGUuJyk7XG4gICAgICBjb25zdCBsb3cgPSBzdHIuY2hhckNvZGVBdChpKSAtIDB4ZGMwMDsgLy8gdGhlIGxvdyAxMCBiaXRzLlxuICAgICAgYyA9IDB4MTAwMDAgKyAoaGlnaCA8PCAxMCkgKyBsb3c7XG4gICAgfVxuXG4gICAgaWYgKGMgPCAxMjgpIHtcbiAgICAgIG91dFtwKytdID0gYztcbiAgICB9IGVsc2UgaWYgKGMgPCAyMDQ4KSB7XG4gICAgICBvdXRbcCsrXSA9IChjID4+IDYpIHwgMTkyO1xuICAgICAgb3V0W3ArK10gPSAoYyAmIDYzKSB8IDEyODtcbiAgICB9IGVsc2UgaWYgKGMgPCA2NTUzNikge1xuICAgICAgb3V0W3ArK10gPSAoYyA+PiAxMikgfCAyMjQ7XG4gICAgICBvdXRbcCsrXSA9ICgoYyA+PiA2KSAmIDYzKSB8IDEyODtcbiAgICAgIG91dFtwKytdID0gKGMgJiA2MykgfCAxMjg7XG4gICAgfSBlbHNlIHtcbiAgICAgIG91dFtwKytdID0gKGMgPj4gMTgpIHwgMjQwO1xuICAgICAgb3V0W3ArK10gPSAoKGMgPj4gMTIpICYgNjMpIHwgMTI4O1xuICAgICAgb3V0W3ArK10gPSAoKGMgPj4gNikgJiA2MykgfCAxMjg7XG4gICAgICBvdXRbcCsrXSA9IChjICYgNjMpIHwgMTI4O1xuICAgIH1cbiAgfVxuICByZXR1cm4gb3V0O1xufTtcblxuLyoqXG4gKiBDYWxjdWxhdGUgbGVuZ3RoIHdpdGhvdXQgYWN0dWFsbHkgY29udmVydGluZzsgdXNlZnVsIGZvciBkb2luZyBjaGVhcGVyIHZhbGlkYXRpb24uXG4gKiBAcGFyYW0ge3N0cmluZ30gc3RyXG4gKiBAcmV0dXJuIHtudW1iZXJ9XG4gKi9cbmV4cG9ydCBjb25zdCBzdHJpbmdMZW5ndGggPSBmdW5jdGlvbiAoc3RyOiBzdHJpbmcpOiBudW1iZXIge1xuICBsZXQgcCA9IDA7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgc3RyLmxlbmd0aDsgaSsrKSB7XG4gICAgY29uc3QgYyA9IHN0ci5jaGFyQ29kZUF0KGkpO1xuICAgIGlmIChjIDwgMTI4KSB7XG4gICAgICBwKys7XG4gICAgfSBlbHNlIGlmIChjIDwgMjA0OCkge1xuICAgICAgcCArPSAyO1xuICAgIH0gZWxzZSBpZiAoYyA+PSAweGQ4MDAgJiYgYyA8PSAweGRiZmYpIHtcbiAgICAgIC8vIExlYWQgc3Vycm9nYXRlIG9mIGEgc3Vycm9nYXRlIHBhaXIuICBUaGUgcGFpciB0b2dldGhlciB3aWxsIHRha2UgNCBieXRlcyB0byByZXByZXNlbnQuXG4gICAgICBwICs9IDQ7XG4gICAgICBpKys7IC8vIHNraXAgdHJhaWwgc3Vycm9nYXRlLlxuICAgIH0gZWxzZSB7XG4gICAgICBwICs9IDM7XG4gICAgfVxuICB9XG4gIHJldHVybiBwO1xufTtcbiIsICIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG4vKipcbiAqIFRoZSBhbW91bnQgb2YgbWlsbGlzZWNvbmRzIHRvIGV4cG9uZW50aWFsbHkgaW5jcmVhc2UuXG4gKi9cbmNvbnN0IERFRkFVTFRfSU5URVJWQUxfTUlMTElTID0gMTAwMDtcblxuLyoqXG4gKiBUaGUgZmFjdG9yIHRvIGJhY2tvZmYgYnkuXG4gKiBTaG91bGQgYmUgYSBudW1iZXIgZ3JlYXRlciB0aGFuIDEuXG4gKi9cbmNvbnN0IERFRkFVTFRfQkFDS09GRl9GQUNUT1IgPSAyO1xuXG4vKipcbiAqIFRoZSBtYXhpbXVtIG1pbGxpc2Vjb25kcyB0byBpbmNyZWFzZSB0by5cbiAqXG4gKiA8cD5WaXNpYmxlIGZvciB0ZXN0aW5nXG4gKi9cbmV4cG9ydCBjb25zdCBNQVhfVkFMVUVfTUlMTElTID0gNCAqIDYwICogNjAgKiAxMDAwOyAvLyBGb3VyIGhvdXJzLCBsaWtlIGlPUyBhbmQgQW5kcm9pZC5cblxuLyoqXG4gKiBUaGUgcGVyY2VudGFnZSBvZiBiYWNrb2ZmIHRpbWUgdG8gcmFuZG9taXplIGJ5LlxuICogU2VlXG4gKiBodHRwOi8vZ28vc2FmZS1jbGllbnQtYmVoYXZpb3Ijc3RlcC0xLWRldGVybWluZS10aGUtYXBwcm9wcmlhdGUtcmV0cnktaW50ZXJ2YWwtdG8taGFuZGxlLXNwaWtlLXRyYWZmaWNcbiAqIGZvciBjb250ZXh0LlxuICpcbiAqIDxwPlZpc2libGUgZm9yIHRlc3RpbmdcbiAqL1xuZXhwb3J0IGNvbnN0IFJBTkRPTV9GQUNUT1IgPSAwLjU7XG5cbi8qKlxuICogQmFzZWQgb24gdGhlIGJhY2tvZmYgbWV0aG9kIGZyb21cbiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9nb29nbGUvY2xvc3VyZS1saWJyYXJ5L2Jsb2IvbWFzdGVyL2Nsb3N1cmUvZ29vZy9tYXRoL2V4cG9uZW50aWFsYmFja29mZi5qcy5cbiAqIEV4dHJhY3RlZCBoZXJlIHNvIHdlIGRvbid0IG5lZWQgdG8gcGFzcyBtZXRhZGF0YSBhbmQgYSBzdGF0ZWZ1bCBFeHBvbmVudGlhbEJhY2tvZmYgb2JqZWN0IGFyb3VuZC5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNhbGN1bGF0ZUJhY2tvZmZNaWxsaXMoXG4gIGJhY2tvZmZDb3VudDogbnVtYmVyLFxuICBpbnRlcnZhbE1pbGxpczogbnVtYmVyID0gREVGQVVMVF9JTlRFUlZBTF9NSUxMSVMsXG4gIGJhY2tvZmZGYWN0b3I6IG51bWJlciA9IERFRkFVTFRfQkFDS09GRl9GQUNUT1Jcbik6IG51bWJlciB7XG4gIC8vIENhbGN1bGF0ZXMgYW4gZXhwb25lbnRpYWxseSBpbmNyZWFzaW5nIHZhbHVlLlxuICAvLyBEZXZpYXRpb246IGNhbGN1bGF0ZXMgdmFsdWUgZnJvbSBjb3VudCBhbmQgYSBjb25zdGFudCBpbnRlcnZhbCwgc28gd2Ugb25seSBuZWVkIHRvIHNhdmUgdmFsdWVcbiAgLy8gYW5kIGNvdW50IHRvIHJlc3RvcmUgc3RhdGUuXG4gIGNvbnN0IGN1cnJCYXNlVmFsdWUgPSBpbnRlcnZhbE1pbGxpcyAqIE1hdGgucG93KGJhY2tvZmZGYWN0b3IsIGJhY2tvZmZDb3VudCk7XG5cbiAgLy8gQSByYW5kb20gXCJmdXp6XCIgdG8gYXZvaWQgd2F2ZXMgb2YgcmV0cmllcy5cbiAgLy8gRGV2aWF0aW9uOiByYW5kb21GYWN0b3IgaXMgcmVxdWlyZWQuXG4gIGNvbnN0IHJhbmRvbVdhaXQgPSBNYXRoLnJvdW5kKFxuICAgIC8vIEEgZnJhY3Rpb24gb2YgdGhlIGJhY2tvZmYgdmFsdWUgdG8gYWRkL3N1YnRyYWN0LlxuICAgIC8vIERldmlhdGlvbjogY2hhbmdlcyBtdWx0aXBsaWNhdGlvbiBvcmRlciB0byBpbXByb3ZlIHJlYWRhYmlsaXR5LlxuICAgIFJBTkRPTV9GQUNUT1IgKlxuICAgICAgY3VyckJhc2VWYWx1ZSAqXG4gICAgICAvLyBBIHJhbmRvbSBmbG9hdCAocm91bmRlZCB0byBpbnQgYnkgTWF0aC5yb3VuZCBhYm92ZSkgaW4gdGhlIHJhbmdlIFstMSwgMV0uIERldGVybWluZXNcbiAgICAgIC8vIGlmIHdlIGFkZCBvciBzdWJ0cmFjdC5cbiAgICAgIChNYXRoLnJhbmRvbSgpIC0gMC41KSAqXG4gICAgICAyXG4gICk7XG5cbiAgLy8gTGltaXRzIGJhY2tvZmYgdG8gbWF4IHRvIGF2b2lkIGVmZmVjdGl2ZWx5IHBlcm1hbmVudCBiYWNrb2ZmLlxuICByZXR1cm4gTWF0aC5taW4oTUFYX1ZBTFVFX01JTExJUywgY3VyckJhc2VWYWx1ZSArIHJhbmRvbVdhaXQpO1xufVxuIiwgIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbi8qKlxuICogUHJvdmlkZSBFbmdsaXNoIG9yZGluYWwgbGV0dGVycyBhZnRlciBhIG51bWJlclxuICovXG5leHBvcnQgZnVuY3Rpb24gb3JkaW5hbChpOiBudW1iZXIpOiBzdHJpbmcge1xuICBpZiAoIU51bWJlci5pc0Zpbml0ZShpKSkge1xuICAgIHJldHVybiBgJHtpfWA7XG4gIH1cbiAgcmV0dXJuIGkgKyBpbmRpY2F0b3IoaSk7XG59XG5cbmZ1bmN0aW9uIGluZGljYXRvcihpOiBudW1iZXIpOiBzdHJpbmcge1xuICBpID0gTWF0aC5hYnMoaSk7XG4gIGNvbnN0IGNlbnQgPSBpICUgMTAwO1xuICBpZiAoY2VudCA+PSAxMCAmJiBjZW50IDw9IDIwKSB7XG4gICAgcmV0dXJuICd0aCc7XG4gIH1cbiAgY29uc3QgZGVjID0gaSAlIDEwO1xuICBpZiAoZGVjID09PSAxKSB7XG4gICAgcmV0dXJuICdzdCc7XG4gIH1cbiAgaWYgKGRlYyA9PT0gMikge1xuICAgIHJldHVybiAnbmQnO1xuICB9XG4gIGlmIChkZWMgPT09IDMpIHtcbiAgICByZXR1cm4gJ3JkJztcbiAgfVxuICByZXR1cm4gJ3RoJztcbn1cbiIsICIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMSBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5leHBvcnQgaW50ZXJmYWNlIENvbXBhdDxUPiB7XG4gIF9kZWxlZ2F0ZTogVDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldE1vZHVsYXJJbnN0YW5jZTxFeHBTZXJ2aWNlPihcbiAgc2VydmljZTogQ29tcGF0PEV4cFNlcnZpY2U+IHwgRXhwU2VydmljZVxuKTogRXhwU2VydmljZSB7XG4gIGlmIChzZXJ2aWNlICYmIChzZXJ2aWNlIGFzIENvbXBhdDxFeHBTZXJ2aWNlPikuX2RlbGVnYXRlKSB7XG4gICAgcmV0dXJuIChzZXJ2aWNlIGFzIENvbXBhdDxFeHBTZXJ2aWNlPikuX2RlbGVnYXRlO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiBzZXJ2aWNlIGFzIEV4cFNlcnZpY2U7XG4gIH1cbn1cbiIsICIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuaW1wb3J0IHtcbiAgSW5zdGFudGlhdGlvbk1vZGUsXG4gIEluc3RhbmNlRmFjdG9yeSxcbiAgQ29tcG9uZW50VHlwZSxcbiAgRGljdGlvbmFyeSxcbiAgTmFtZSxcbiAgb25JbnN0YW5jZUNyZWF0ZWRDYWxsYmFja1xufSBmcm9tICcuL3R5cGVzJztcblxuLyoqXG4gKiBDb21wb25lbnQgZm9yIHNlcnZpY2UgbmFtZSBULCBlLmcuIGBhdXRoYCwgYGF1dGgtaW50ZXJuYWxgXG4gKi9cbmV4cG9ydCBjbGFzcyBDb21wb25lbnQ8VCBleHRlbmRzIE5hbWUgPSBOYW1lPiB7XG4gIG11bHRpcGxlSW5zdGFuY2VzID0gZmFsc2U7XG4gIC8qKlxuICAgKiBQcm9wZXJ0aWVzIHRvIGJlIGFkZGVkIHRvIHRoZSBzZXJ2aWNlIG5hbWVzcGFjZVxuICAgKi9cbiAgc2VydmljZVByb3BzOiBEaWN0aW9uYXJ5ID0ge307XG5cbiAgaW5zdGFudGlhdGlvbk1vZGUgPSBJbnN0YW50aWF0aW9uTW9kZS5MQVpZO1xuXG4gIG9uSW5zdGFuY2VDcmVhdGVkOiBvbkluc3RhbmNlQ3JlYXRlZENhbGxiYWNrPFQ+IHwgbnVsbCA9IG51bGw7XG5cbiAgLyoqXG4gICAqXG4gICAqIEBwYXJhbSBuYW1lIFRoZSBwdWJsaWMgc2VydmljZSBuYW1lLCBlLmcuIGFwcCwgYXV0aCwgZmlyZXN0b3JlLCBkYXRhYmFzZVxuICAgKiBAcGFyYW0gaW5zdGFuY2VGYWN0b3J5IFNlcnZpY2UgZmFjdG9yeSByZXNwb25zaWJsZSBmb3IgY3JlYXRpbmcgdGhlIHB1YmxpYyBpbnRlcmZhY2VcbiAgICogQHBhcmFtIHR5cGUgd2hldGhlciB0aGUgc2VydmljZSBwcm92aWRlZCBieSB0aGUgY29tcG9uZW50IGlzIHB1YmxpYyBvciBwcml2YXRlXG4gICAqL1xuICBjb25zdHJ1Y3RvcihcbiAgICByZWFkb25seSBuYW1lOiBULFxuICAgIHJlYWRvbmx5IGluc3RhbmNlRmFjdG9yeTogSW5zdGFuY2VGYWN0b3J5PFQ+LFxuICAgIHJlYWRvbmx5IHR5cGU6IENvbXBvbmVudFR5cGVcbiAgKSB7fVxuXG4gIHNldEluc3RhbnRpYXRpb25Nb2RlKG1vZGU6IEluc3RhbnRpYXRpb25Nb2RlKTogdGhpcyB7XG4gICAgdGhpcy5pbnN0YW50aWF0aW9uTW9kZSA9IG1vZGU7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBzZXRNdWx0aXBsZUluc3RhbmNlcyhtdWx0aXBsZUluc3RhbmNlczogYm9vbGVhbik6IHRoaXMge1xuICAgIHRoaXMubXVsdGlwbGVJbnN0YW5jZXMgPSBtdWx0aXBsZUluc3RhbmNlcztcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIHNldFNlcnZpY2VQcm9wcyhwcm9wczogRGljdGlvbmFyeSk6IHRoaXMge1xuICAgIHRoaXMuc2VydmljZVByb3BzID0gcHJvcHM7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBzZXRJbnN0YW5jZUNyZWF0ZWRDYWxsYmFjayhjYWxsYmFjazogb25JbnN0YW5jZUNyZWF0ZWRDYWxsYmFjazxUPik6IHRoaXMge1xuICAgIHRoaXMub25JbnN0YW5jZUNyZWF0ZWQgPSBjYWxsYmFjaztcbiAgICByZXR1cm4gdGhpcztcbiAgfVxufVxuIiwgIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmV4cG9ydCBjb25zdCBERUZBVUxUX0VOVFJZX05BTUUgPSAnW0RFRkFVTFRdJztcbiIsICIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQgeyBEZWZlcnJlZCB9IGZyb20gJ0BmaXJlYmFzZS91dGlsJztcbmltcG9ydCB7IENvbXBvbmVudENvbnRhaW5lciB9IGZyb20gJy4vY29tcG9uZW50X2NvbnRhaW5lcic7XG5pbXBvcnQgeyBERUZBVUxUX0VOVFJZX05BTUUgfSBmcm9tICcuL2NvbnN0YW50cyc7XG5pbXBvcnQge1xuICBJbml0aWFsaXplT3B0aW9ucyxcbiAgSW5zdGFudGlhdGlvbk1vZGUsXG4gIE5hbWUsXG4gIE5hbWVTZXJ2aWNlTWFwcGluZyxcbiAgT25Jbml0Q2FsbEJhY2tcbn0gZnJvbSAnLi90eXBlcyc7XG5pbXBvcnQgeyBDb21wb25lbnQgfSBmcm9tICcuL2NvbXBvbmVudCc7XG5cbi8qKlxuICogUHJvdmlkZXIgZm9yIGluc3RhbmNlIGZvciBzZXJ2aWNlIG5hbWUgVCwgZS5nLiAnYXV0aCcsICdhdXRoLWludGVybmFsJ1xuICogTmFtZVNlcnZpY2VNYXBwaW5nW1RdIGlzIGFuIGFsaWFzIGZvciB0aGUgdHlwZSBvZiB0aGUgaW5zdGFuY2VcbiAqL1xuZXhwb3J0IGNsYXNzIFByb3ZpZGVyPFQgZXh0ZW5kcyBOYW1lPiB7XG4gIHByaXZhdGUgY29tcG9uZW50OiBDb21wb25lbnQ8VD4gfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSByZWFkb25seSBpbnN0YW5jZXM6IE1hcDxzdHJpbmcsIE5hbWVTZXJ2aWNlTWFwcGluZ1tUXT4gPSBuZXcgTWFwKCk7XG4gIHByaXZhdGUgcmVhZG9ubHkgaW5zdGFuY2VzRGVmZXJyZWQ6IE1hcDxcbiAgICBzdHJpbmcsXG4gICAgRGVmZXJyZWQ8TmFtZVNlcnZpY2VNYXBwaW5nW1RdPlxuICA+ID0gbmV3IE1hcCgpO1xuICBwcml2YXRlIHJlYWRvbmx5IGluc3RhbmNlc09wdGlvbnM6IE1hcDxzdHJpbmcsIFJlY29yZDxzdHJpbmcsIHVua25vd24+PiA9XG4gICAgbmV3IE1hcCgpO1xuICBwcml2YXRlIG9uSW5pdENhbGxiYWNrczogTWFwPHN0cmluZywgU2V0PE9uSW5pdENhbGxCYWNrPFQ+Pj4gPSBuZXcgTWFwKCk7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSByZWFkb25seSBuYW1lOiBULFxuICAgIHByaXZhdGUgcmVhZG9ubHkgY29udGFpbmVyOiBDb21wb25lbnRDb250YWluZXJcbiAgKSB7fVxuXG4gIC8qKlxuICAgKiBAcGFyYW0gaWRlbnRpZmllciBBIHByb3ZpZGVyIGNhbiBwcm92aWRlIG11bGl0cGxlIGluc3RhbmNlcyBvZiBhIHNlcnZpY2VcbiAgICogaWYgdGhpcy5jb21wb25lbnQubXVsdGlwbGVJbnN0YW5jZXMgaXMgdHJ1ZS5cbiAgICovXG4gIGdldChpZGVudGlmaWVyPzogc3RyaW5nKTogUHJvbWlzZTxOYW1lU2VydmljZU1hcHBpbmdbVF0+IHtcbiAgICAvLyBpZiBtdWx0aXBsZUluc3RhbmNlcyBpcyBub3Qgc3VwcG9ydGVkLCB1c2UgdGhlIGRlZmF1bHQgbmFtZVxuICAgIGNvbnN0IG5vcm1hbGl6ZWRJZGVudGlmaWVyID0gdGhpcy5ub3JtYWxpemVJbnN0YW5jZUlkZW50aWZpZXIoaWRlbnRpZmllcik7XG5cbiAgICBpZiAoIXRoaXMuaW5zdGFuY2VzRGVmZXJyZWQuaGFzKG5vcm1hbGl6ZWRJZGVudGlmaWVyKSkge1xuICAgICAgY29uc3QgZGVmZXJyZWQgPSBuZXcgRGVmZXJyZWQ8TmFtZVNlcnZpY2VNYXBwaW5nW1RdPigpO1xuICAgICAgdGhpcy5pbnN0YW5jZXNEZWZlcnJlZC5zZXQobm9ybWFsaXplZElkZW50aWZpZXIsIGRlZmVycmVkKTtcblxuICAgICAgaWYgKFxuICAgICAgICB0aGlzLmlzSW5pdGlhbGl6ZWQobm9ybWFsaXplZElkZW50aWZpZXIpIHx8XG4gICAgICAgIHRoaXMuc2hvdWxkQXV0b0luaXRpYWxpemUoKVxuICAgICAgKSB7XG4gICAgICAgIC8vIGluaXRpYWxpemUgdGhlIHNlcnZpY2UgaWYgaXQgY2FuIGJlIGF1dG8taW5pdGlhbGl6ZWRcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjb25zdCBpbnN0YW5jZSA9IHRoaXMuZ2V0T3JJbml0aWFsaXplU2VydmljZSh7XG4gICAgICAgICAgICBpbnN0YW5jZUlkZW50aWZpZXI6IG5vcm1hbGl6ZWRJZGVudGlmaWVyXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgaWYgKGluc3RhbmNlKSB7XG4gICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKGluc3RhbmNlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAvLyB3aGVuIHRoZSBpbnN0YW5jZSBmYWN0b3J5IHRocm93cyBhbiBleGNlcHRpb24gZHVyaW5nIGdldCgpLCBpdCBzaG91bGQgbm90IGNhdXNlXG4gICAgICAgICAgLy8gYSBmYXRhbCBlcnJvci4gV2UganVzdCByZXR1cm4gdGhlIHVucmVzb2x2ZWQgcHJvbWlzZSBpbiB0aGlzIGNhc2UuXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5pbnN0YW5jZXNEZWZlcnJlZC5nZXQobm9ybWFsaXplZElkZW50aWZpZXIpIS5wcm9taXNlO1xuICB9XG5cbiAgLyoqXG4gICAqXG4gICAqIEBwYXJhbSBvcHRpb25zLmlkZW50aWZpZXIgQSBwcm92aWRlciBjYW4gcHJvdmlkZSBtdWxpdHBsZSBpbnN0YW5jZXMgb2YgYSBzZXJ2aWNlXG4gICAqIGlmIHRoaXMuY29tcG9uZW50Lm11bHRpcGxlSW5zdGFuY2VzIGlzIHRydWUuXG4gICAqIEBwYXJhbSBvcHRpb25zLm9wdGlvbmFsIElmIG9wdGlvbmFsIGlzIGZhbHNlIG9yIG5vdCBwcm92aWRlZCwgdGhlIG1ldGhvZCB0aHJvd3MgYW4gZXJyb3Igd2hlblxuICAgKiB0aGUgc2VydmljZSBpcyBub3QgaW1tZWRpYXRlbHkgYXZhaWxhYmxlLlxuICAgKiBJZiBvcHRpb25hbCBpcyB0cnVlLCB0aGUgbWV0aG9kIHJldHVybnMgbnVsbCBpZiB0aGUgc2VydmljZSBpcyBub3QgaW1tZWRpYXRlbHkgYXZhaWxhYmxlLlxuICAgKi9cbiAgZ2V0SW1tZWRpYXRlKG9wdGlvbnM6IHtcbiAgICBpZGVudGlmaWVyPzogc3RyaW5nO1xuICAgIG9wdGlvbmFsOiB0cnVlO1xuICB9KTogTmFtZVNlcnZpY2VNYXBwaW5nW1RdIHwgbnVsbDtcbiAgZ2V0SW1tZWRpYXRlKG9wdGlvbnM/OiB7XG4gICAgaWRlbnRpZmllcj86IHN0cmluZztcbiAgICBvcHRpb25hbD86IGZhbHNlO1xuICB9KTogTmFtZVNlcnZpY2VNYXBwaW5nW1RdO1xuICBnZXRJbW1lZGlhdGUob3B0aW9ucz86IHtcbiAgICBpZGVudGlmaWVyPzogc3RyaW5nO1xuICAgIG9wdGlvbmFsPzogYm9vbGVhbjtcbiAgfSk6IE5hbWVTZXJ2aWNlTWFwcGluZ1tUXSB8IG51bGwge1xuICAgIC8vIGlmIG11bHRpcGxlSW5zdGFuY2VzIGlzIG5vdCBzdXBwb3J0ZWQsIHVzZSB0aGUgZGVmYXVsdCBuYW1lXG4gICAgY29uc3Qgbm9ybWFsaXplZElkZW50aWZpZXIgPSB0aGlzLm5vcm1hbGl6ZUluc3RhbmNlSWRlbnRpZmllcihcbiAgICAgIG9wdGlvbnM/LmlkZW50aWZpZXJcbiAgICApO1xuICAgIGNvbnN0IG9wdGlvbmFsID0gb3B0aW9ucz8ub3B0aW9uYWwgPz8gZmFsc2U7XG5cbiAgICBpZiAoXG4gICAgICB0aGlzLmlzSW5pdGlhbGl6ZWQobm9ybWFsaXplZElkZW50aWZpZXIpIHx8XG4gICAgICB0aGlzLnNob3VsZEF1dG9Jbml0aWFsaXplKClcbiAgICApIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldE9ySW5pdGlhbGl6ZVNlcnZpY2Uoe1xuICAgICAgICAgIGluc3RhbmNlSWRlbnRpZmllcjogbm9ybWFsaXplZElkZW50aWZpZXJcbiAgICAgICAgfSk7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIGlmIChvcHRpb25hbCkge1xuICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRocm93IGU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgLy8gSW4gY2FzZSBhIGNvbXBvbmVudCBpcyBub3QgaW5pdGlhbGl6ZWQgYW5kIHNob3VsZC9jYW4gbm90IGJlIGF1dG8taW5pdGlhbGl6ZWQgYXQgdGhlIG1vbWVudCwgcmV0dXJuIG51bGwgaWYgdGhlIG9wdGlvbmFsIGZsYWcgaXMgc2V0LCBvciB0aHJvd1xuICAgICAgaWYgKG9wdGlvbmFsKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgRXJyb3IoYFNlcnZpY2UgJHt0aGlzLm5hbWV9IGlzIG5vdCBhdmFpbGFibGVgKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBnZXRDb21wb25lbnQoKTogQ29tcG9uZW50PFQ+IHwgbnVsbCB7XG4gICAgcmV0dXJuIHRoaXMuY29tcG9uZW50O1xuICB9XG5cbiAgc2V0Q29tcG9uZW50KGNvbXBvbmVudDogQ29tcG9uZW50PFQ+KTogdm9pZCB7XG4gICAgaWYgKGNvbXBvbmVudC5uYW1lICE9PSB0aGlzLm5hbWUpIHtcbiAgICAgIHRocm93IEVycm9yKFxuICAgICAgICBgTWlzbWF0Y2hpbmcgQ29tcG9uZW50ICR7Y29tcG9uZW50Lm5hbWV9IGZvciBQcm92aWRlciAke3RoaXMubmFtZX0uYFxuICAgICAgKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5jb21wb25lbnQpIHtcbiAgICAgIHRocm93IEVycm9yKGBDb21wb25lbnQgZm9yICR7dGhpcy5uYW1lfSBoYXMgYWxyZWFkeSBiZWVuIHByb3ZpZGVkYCk7XG4gICAgfVxuXG4gICAgdGhpcy5jb21wb25lbnQgPSBjb21wb25lbnQ7XG5cbiAgICAvLyByZXR1cm4gZWFybHkgd2l0aG91dCBhdHRlbXB0aW5nIHRvIGluaXRpYWxpemUgdGhlIGNvbXBvbmVudCBpZiB0aGUgY29tcG9uZW50IHJlcXVpcmVzIGV4cGxpY2l0IGluaXRpYWxpemF0aW9uIChjYWxsaW5nIGBQcm92aWRlci5pbml0aWFsaXplKClgKVxuICAgIGlmICghdGhpcy5zaG91bGRBdXRvSW5pdGlhbGl6ZSgpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gaWYgdGhlIHNlcnZpY2UgaXMgZWFnZXIsIGluaXRpYWxpemUgdGhlIGRlZmF1bHQgaW5zdGFuY2VcbiAgICBpZiAoaXNDb21wb25lbnRFYWdlcihjb21wb25lbnQpKSB7XG4gICAgICB0cnkge1xuICAgICAgICB0aGlzLmdldE9ySW5pdGlhbGl6ZVNlcnZpY2UoeyBpbnN0YW5jZUlkZW50aWZpZXI6IERFRkFVTFRfRU5UUllfTkFNRSB9KTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgLy8gd2hlbiB0aGUgaW5zdGFuY2UgZmFjdG9yeSBmb3IgYW4gZWFnZXIgQ29tcG9uZW50IHRocm93cyBhbiBleGNlcHRpb24gZHVyaW5nIHRoZSBlYWdlclxuICAgICAgICAvLyBpbml0aWFsaXphdGlvbiwgaXQgc2hvdWxkIG5vdCBjYXVzZSBhIGZhdGFsIGVycm9yLlxuICAgICAgICAvLyBUT0RPOiBJbnZlc3RpZ2F0ZSBpZiB3ZSBuZWVkIHRvIG1ha2UgaXQgY29uZmlndXJhYmxlLCBiZWNhdXNlIHNvbWUgY29tcG9uZW50IG1heSB3YW50IHRvIGNhdXNlXG4gICAgICAgIC8vIGEgZmF0YWwgZXJyb3IgaW4gdGhpcyBjYXNlP1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIENyZWF0ZSBzZXJ2aWNlIGluc3RhbmNlcyBmb3IgdGhlIHBlbmRpbmcgcHJvbWlzZXMgYW5kIHJlc29sdmUgdGhlbVxuICAgIC8vIE5PVEU6IGlmIHRoaXMubXVsdGlwbGVJbnN0YW5jZXMgaXMgZmFsc2UsIG9ubHkgdGhlIGRlZmF1bHQgaW5zdGFuY2Ugd2lsbCBiZSBjcmVhdGVkXG4gICAgLy8gYW5kIGFsbCBwcm9taXNlcyB3aXRoIHJlc29sdmUgd2l0aCBpdCByZWdhcmRsZXNzIG9mIHRoZSBpZGVudGlmaWVyLlxuICAgIGZvciAoY29uc3QgW1xuICAgICAgaW5zdGFuY2VJZGVudGlmaWVyLFxuICAgICAgaW5zdGFuY2VEZWZlcnJlZFxuICAgIF0gb2YgdGhpcy5pbnN0YW5jZXNEZWZlcnJlZC5lbnRyaWVzKCkpIHtcbiAgICAgIGNvbnN0IG5vcm1hbGl6ZWRJZGVudGlmaWVyID1cbiAgICAgICAgdGhpcy5ub3JtYWxpemVJbnN0YW5jZUlkZW50aWZpZXIoaW5zdGFuY2VJZGVudGlmaWVyKTtcblxuICAgICAgdHJ5IHtcbiAgICAgICAgLy8gYGdldE9ySW5pdGlhbGl6ZVNlcnZpY2UoKWAgc2hvdWxkIGFsd2F5cyByZXR1cm4gYSB2YWxpZCBpbnN0YW5jZSBzaW5jZSBhIGNvbXBvbmVudCBpcyBndWFyYW50ZWVkLiB1c2UgISB0byBtYWtlIHR5cGVzY3JpcHQgaGFwcHkuXG4gICAgICAgIGNvbnN0IGluc3RhbmNlID0gdGhpcy5nZXRPckluaXRpYWxpemVTZXJ2aWNlKHtcbiAgICAgICAgICBpbnN0YW5jZUlkZW50aWZpZXI6IG5vcm1hbGl6ZWRJZGVudGlmaWVyXG4gICAgICAgIH0pITtcbiAgICAgICAgaW5zdGFuY2VEZWZlcnJlZC5yZXNvbHZlKGluc3RhbmNlKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgLy8gd2hlbiB0aGUgaW5zdGFuY2UgZmFjdG9yeSB0aHJvd3MgYW4gZXhjZXB0aW9uLCBpdCBzaG91bGQgbm90IGNhdXNlXG4gICAgICAgIC8vIGEgZmF0YWwgZXJyb3IuIFdlIGp1c3QgbGVhdmUgdGhlIHByb21pc2UgdW5yZXNvbHZlZC5cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBjbGVhckluc3RhbmNlKGlkZW50aWZpZXI6IHN0cmluZyA9IERFRkFVTFRfRU5UUllfTkFNRSk6IHZvaWQge1xuICAgIHRoaXMuaW5zdGFuY2VzRGVmZXJyZWQuZGVsZXRlKGlkZW50aWZpZXIpO1xuICAgIHRoaXMuaW5zdGFuY2VzT3B0aW9ucy5kZWxldGUoaWRlbnRpZmllcik7XG4gICAgdGhpcy5pbnN0YW5jZXMuZGVsZXRlKGlkZW50aWZpZXIpO1xuICB9XG5cbiAgLy8gYXBwLmRlbGV0ZSgpIHdpbGwgY2FsbCB0aGlzIG1ldGhvZCBvbiBldmVyeSBwcm92aWRlciB0byBkZWxldGUgdGhlIHNlcnZpY2VzXG4gIC8vIFRPRE86IHNob3VsZCB3ZSBtYXJrIHRoZSBwcm92aWRlciBhcyBkZWxldGVkP1xuICBhc3luYyBkZWxldGUoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3Qgc2VydmljZXMgPSBBcnJheS5mcm9tKHRoaXMuaW5zdGFuY2VzLnZhbHVlcygpKTtcblxuICAgIGF3YWl0IFByb21pc2UuYWxsKFtcbiAgICAgIC4uLnNlcnZpY2VzXG4gICAgICAgIC5maWx0ZXIoc2VydmljZSA9PiAnSU5URVJOQUwnIGluIHNlcnZpY2UpIC8vIGxlZ2FjeSBzZXJ2aWNlc1xuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICAgICAgICAubWFwKHNlcnZpY2UgPT4gKHNlcnZpY2UgYXMgYW55KS5JTlRFUk5BTCEuZGVsZXRlKCkpLFxuICAgICAgLi4uc2VydmljZXNcbiAgICAgICAgLmZpbHRlcihzZXJ2aWNlID0+ICdfZGVsZXRlJyBpbiBzZXJ2aWNlKSAvLyBtb2R1bGFyaXplZCBzZXJ2aWNlc1xuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICAgICAgICAubWFwKHNlcnZpY2UgPT4gKHNlcnZpY2UgYXMgYW55KS5fZGVsZXRlKCkpXG4gICAgXSk7XG4gIH1cblxuICBpc0NvbXBvbmVudFNldCgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5jb21wb25lbnQgIT0gbnVsbDtcbiAgfVxuXG4gIGlzSW5pdGlhbGl6ZWQoaWRlbnRpZmllcjogc3RyaW5nID0gREVGQVVMVF9FTlRSWV9OQU1FKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuaW5zdGFuY2VzLmhhcyhpZGVudGlmaWVyKTtcbiAgfVxuXG4gIGdldE9wdGlvbnMoaWRlbnRpZmllcjogc3RyaW5nID0gREVGQVVMVF9FTlRSWV9OQU1FKTogUmVjb3JkPHN0cmluZywgdW5rbm93bj4ge1xuICAgIHJldHVybiB0aGlzLmluc3RhbmNlc09wdGlvbnMuZ2V0KGlkZW50aWZpZXIpIHx8IHt9O1xuICB9XG5cbiAgaW5pdGlhbGl6ZShvcHRzOiBJbml0aWFsaXplT3B0aW9ucyA9IHt9KTogTmFtZVNlcnZpY2VNYXBwaW5nW1RdIHtcbiAgICBjb25zdCB7IG9wdGlvbnMgPSB7fSB9ID0gb3B0cztcbiAgICBjb25zdCBub3JtYWxpemVkSWRlbnRpZmllciA9IHRoaXMubm9ybWFsaXplSW5zdGFuY2VJZGVudGlmaWVyKFxuICAgICAgb3B0cy5pbnN0YW5jZUlkZW50aWZpZXJcbiAgICApO1xuICAgIGlmICh0aGlzLmlzSW5pdGlhbGl6ZWQobm9ybWFsaXplZElkZW50aWZpZXIpKSB7XG4gICAgICB0aHJvdyBFcnJvcihcbiAgICAgICAgYCR7dGhpcy5uYW1lfSgke25vcm1hbGl6ZWRJZGVudGlmaWVyfSkgaGFzIGFscmVhZHkgYmVlbiBpbml0aWFsaXplZGBcbiAgICAgICk7XG4gICAgfVxuXG4gICAgaWYgKCF0aGlzLmlzQ29tcG9uZW50U2V0KCkpIHtcbiAgICAgIHRocm93IEVycm9yKGBDb21wb25lbnQgJHt0aGlzLm5hbWV9IGhhcyBub3QgYmVlbiByZWdpc3RlcmVkIHlldGApO1xuICAgIH1cblxuICAgIGNvbnN0IGluc3RhbmNlID0gdGhpcy5nZXRPckluaXRpYWxpemVTZXJ2aWNlKHtcbiAgICAgIGluc3RhbmNlSWRlbnRpZmllcjogbm9ybWFsaXplZElkZW50aWZpZXIsXG4gICAgICBvcHRpb25zXG4gICAgfSkhO1xuXG4gICAgLy8gcmVzb2x2ZSBhbnkgcGVuZGluZyBwcm9taXNlIHdhaXRpbmcgZm9yIHRoZSBzZXJ2aWNlIGluc3RhbmNlXG4gICAgZm9yIChjb25zdCBbXG4gICAgICBpbnN0YW5jZUlkZW50aWZpZXIsXG4gICAgICBpbnN0YW5jZURlZmVycmVkXG4gICAgXSBvZiB0aGlzLmluc3RhbmNlc0RlZmVycmVkLmVudHJpZXMoKSkge1xuICAgICAgY29uc3Qgbm9ybWFsaXplZERlZmVycmVkSWRlbnRpZmllciA9XG4gICAgICAgIHRoaXMubm9ybWFsaXplSW5zdGFuY2VJZGVudGlmaWVyKGluc3RhbmNlSWRlbnRpZmllcik7XG4gICAgICBpZiAobm9ybWFsaXplZElkZW50aWZpZXIgPT09IG5vcm1hbGl6ZWREZWZlcnJlZElkZW50aWZpZXIpIHtcbiAgICAgICAgaW5zdGFuY2VEZWZlcnJlZC5yZXNvbHZlKGluc3RhbmNlKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gaW5zdGFuY2U7XG4gIH1cblxuICAvKipcbiAgICpcbiAgICogQHBhcmFtIGNhbGxiYWNrIC0gYSBmdW5jdGlvbiB0aGF0IHdpbGwgYmUgaW52b2tlZCAgYWZ0ZXIgdGhlIHByb3ZpZGVyIGhhcyBiZWVuIGluaXRpYWxpemVkIGJ5IGNhbGxpbmcgcHJvdmlkZXIuaW5pdGlhbGl6ZSgpLlxuICAgKiBUaGUgZnVuY3Rpb24gaXMgaW52b2tlZCBTWU5DSFJPTk9VU0xZLCBzbyBpdCBzaG91bGQgbm90IGV4ZWN1dGUgYW55IGxvbmdydW5uaW5nIHRhc2tzIGluIG9yZGVyIHRvIG5vdCBibG9jayB0aGUgcHJvZ3JhbS5cbiAgICpcbiAgICogQHBhcmFtIGlkZW50aWZpZXIgQW4gb3B0aW9uYWwgaW5zdGFuY2UgaWRlbnRpZmllclxuICAgKiBAcmV0dXJucyBhIGZ1bmN0aW9uIHRvIHVucmVnaXN0ZXIgdGhlIGNhbGxiYWNrXG4gICAqL1xuICBvbkluaXQoY2FsbGJhY2s6IE9uSW5pdENhbGxCYWNrPFQ+LCBpZGVudGlmaWVyPzogc3RyaW5nKTogKCkgPT4gdm9pZCB7XG4gICAgY29uc3Qgbm9ybWFsaXplZElkZW50aWZpZXIgPSB0aGlzLm5vcm1hbGl6ZUluc3RhbmNlSWRlbnRpZmllcihpZGVudGlmaWVyKTtcbiAgICBjb25zdCBleGlzdGluZ0NhbGxiYWNrcyA9XG4gICAgICB0aGlzLm9uSW5pdENhbGxiYWNrcy5nZXQobm9ybWFsaXplZElkZW50aWZpZXIpID8/XG4gICAgICBuZXcgU2V0PE9uSW5pdENhbGxCYWNrPFQ+PigpO1xuICAgIGV4aXN0aW5nQ2FsbGJhY2tzLmFkZChjYWxsYmFjayk7XG4gICAgdGhpcy5vbkluaXRDYWxsYmFja3Muc2V0KG5vcm1hbGl6ZWRJZGVudGlmaWVyLCBleGlzdGluZ0NhbGxiYWNrcyk7XG5cbiAgICBjb25zdCBleGlzdGluZ0luc3RhbmNlID0gdGhpcy5pbnN0YW5jZXMuZ2V0KG5vcm1hbGl6ZWRJZGVudGlmaWVyKTtcbiAgICBpZiAoZXhpc3RpbmdJbnN0YW5jZSkge1xuICAgICAgY2FsbGJhY2soZXhpc3RpbmdJbnN0YW5jZSwgbm9ybWFsaXplZElkZW50aWZpZXIpO1xuICAgIH1cblxuICAgIHJldHVybiAoKSA9PiB7XG4gICAgICBleGlzdGluZ0NhbGxiYWNrcy5kZWxldGUoY2FsbGJhY2spO1xuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogSW52b2tlIG9uSW5pdCBjYWxsYmFja3Mgc3luY2hyb25vdXNseVxuICAgKiBAcGFyYW0gaW5zdGFuY2UgdGhlIHNlcnZpY2UgaW5zdGFuY2VgXG4gICAqL1xuICBwcml2YXRlIGludm9rZU9uSW5pdENhbGxiYWNrcyhcbiAgICBpbnN0YW5jZTogTmFtZVNlcnZpY2VNYXBwaW5nW1RdLFxuICAgIGlkZW50aWZpZXI6IHN0cmluZ1xuICApOiB2b2lkIHtcbiAgICBjb25zdCBjYWxsYmFja3MgPSB0aGlzLm9uSW5pdENhbGxiYWNrcy5nZXQoaWRlbnRpZmllcik7XG4gICAgaWYgKCFjYWxsYmFja3MpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgZm9yIChjb25zdCBjYWxsYmFjayBvZiBjYWxsYmFja3MpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNhbGxiYWNrKGluc3RhbmNlLCBpZGVudGlmaWVyKTtcbiAgICAgIH0gY2F0Y2gge1xuICAgICAgICAvLyBpZ25vcmUgZXJyb3JzIGluIHRoZSBvbkluaXQgY2FsbGJhY2tcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGdldE9ySW5pdGlhbGl6ZVNlcnZpY2Uoe1xuICAgIGluc3RhbmNlSWRlbnRpZmllcixcbiAgICBvcHRpb25zID0ge31cbiAgfToge1xuICAgIGluc3RhbmNlSWRlbnRpZmllcjogc3RyaW5nO1xuICAgIG9wdGlvbnM/OiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPjtcbiAgfSk6IE5hbWVTZXJ2aWNlTWFwcGluZ1tUXSB8IG51bGwge1xuICAgIGxldCBpbnN0YW5jZSA9IHRoaXMuaW5zdGFuY2VzLmdldChpbnN0YW5jZUlkZW50aWZpZXIpO1xuICAgIGlmICghaW5zdGFuY2UgJiYgdGhpcy5jb21wb25lbnQpIHtcbiAgICAgIGluc3RhbmNlID0gdGhpcy5jb21wb25lbnQuaW5zdGFuY2VGYWN0b3J5KHRoaXMuY29udGFpbmVyLCB7XG4gICAgICAgIGluc3RhbmNlSWRlbnRpZmllcjogbm9ybWFsaXplSWRlbnRpZmllckZvckZhY3RvcnkoaW5zdGFuY2VJZGVudGlmaWVyKSxcbiAgICAgICAgb3B0aW9uc1xuICAgICAgfSk7XG4gICAgICB0aGlzLmluc3RhbmNlcy5zZXQoaW5zdGFuY2VJZGVudGlmaWVyLCBpbnN0YW5jZSk7XG4gICAgICB0aGlzLmluc3RhbmNlc09wdGlvbnMuc2V0KGluc3RhbmNlSWRlbnRpZmllciwgb3B0aW9ucyk7XG5cbiAgICAgIC8qKlxuICAgICAgICogSW52b2tlIG9uSW5pdCBsaXN0ZW5lcnMuXG4gICAgICAgKiBOb3RlIHRoaXMuY29tcG9uZW50Lm9uSW5zdGFuY2VDcmVhdGVkIGlzIGRpZmZlcmVudCwgd2hpY2ggaXMgdXNlZCBieSB0aGUgY29tcG9uZW50IGNyZWF0b3IsXG4gICAgICAgKiB3aGlsZSBvbkluaXQgbGlzdGVuZXJzIGFyZSByZWdpc3RlcmVkIGJ5IGNvbnN1bWVycyBvZiB0aGUgcHJvdmlkZXIuXG4gICAgICAgKi9cbiAgICAgIHRoaXMuaW52b2tlT25Jbml0Q2FsbGJhY2tzKGluc3RhbmNlLCBpbnN0YW5jZUlkZW50aWZpZXIpO1xuXG4gICAgICAvKipcbiAgICAgICAqIE9yZGVyIGlzIGltcG9ydGFudFxuICAgICAgICogb25JbnN0YW5jZUNyZWF0ZWQoKSBzaG91bGQgYmUgY2FsbGVkIGFmdGVyIHRoaXMuaW5zdGFuY2VzLnNldChpbnN0YW5jZUlkZW50aWZpZXIsIGluc3RhbmNlKTsgd2hpY2hcbiAgICAgICAqIG1ha2VzIGBpc0luaXRpYWxpemVkKClgIHJldHVybiB0cnVlLlxuICAgICAgICovXG4gICAgICBpZiAodGhpcy5jb21wb25lbnQub25JbnN0YW5jZUNyZWF0ZWQpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICB0aGlzLmNvbXBvbmVudC5vbkluc3RhbmNlQ3JlYXRlZChcbiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLFxuICAgICAgICAgICAgaW5zdGFuY2VJZGVudGlmaWVyLFxuICAgICAgICAgICAgaW5zdGFuY2VcbiAgICAgICAgICApO1xuICAgICAgICB9IGNhdGNoIHtcbiAgICAgICAgICAvLyBpZ25vcmUgZXJyb3JzIGluIHRoZSBvbkluc3RhbmNlQ3JlYXRlZENhbGxiYWNrXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gaW5zdGFuY2UgfHwgbnVsbDtcbiAgfVxuXG4gIHByaXZhdGUgbm9ybWFsaXplSW5zdGFuY2VJZGVudGlmaWVyKFxuICAgIGlkZW50aWZpZXI6IHN0cmluZyA9IERFRkFVTFRfRU5UUllfTkFNRVxuICApOiBzdHJpbmcge1xuICAgIGlmICh0aGlzLmNvbXBvbmVudCkge1xuICAgICAgcmV0dXJuIHRoaXMuY29tcG9uZW50Lm11bHRpcGxlSW5zdGFuY2VzID8gaWRlbnRpZmllciA6IERFRkFVTFRfRU5UUllfTkFNRTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGlkZW50aWZpZXI7IC8vIGFzc3VtZSBtdWx0aXBsZSBpbnN0YW5jZXMgYXJlIHN1cHBvcnRlZCBiZWZvcmUgdGhlIGNvbXBvbmVudCBpcyBwcm92aWRlZC5cbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHNob3VsZEF1dG9Jbml0aWFsaXplKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAoXG4gICAgICAhIXRoaXMuY29tcG9uZW50ICYmXG4gICAgICB0aGlzLmNvbXBvbmVudC5pbnN0YW50aWF0aW9uTW9kZSAhPT0gSW5zdGFudGlhdGlvbk1vZGUuRVhQTElDSVRcbiAgICApO1xuICB9XG59XG5cbi8vIHVuZGVmaW5lZCBzaG91bGQgYmUgcGFzc2VkIHRvIHRoZSBzZXJ2aWNlIGZhY3RvcnkgZm9yIHRoZSBkZWZhdWx0IGluc3RhbmNlXG5mdW5jdGlvbiBub3JtYWxpemVJZGVudGlmaWVyRm9yRmFjdG9yeShpZGVudGlmaWVyOiBzdHJpbmcpOiBzdHJpbmcgfCB1bmRlZmluZWQge1xuICByZXR1cm4gaWRlbnRpZmllciA9PT0gREVGQVVMVF9FTlRSWV9OQU1FID8gdW5kZWZpbmVkIDogaWRlbnRpZmllcjtcbn1cblxuZnVuY3Rpb24gaXNDb21wb25lbnRFYWdlcjxUIGV4dGVuZHMgTmFtZT4oY29tcG9uZW50OiBDb21wb25lbnQ8VD4pOiBib29sZWFuIHtcbiAgcmV0dXJuIGNvbXBvbmVudC5pbnN0YW50aWF0aW9uTW9kZSA9PT0gSW5zdGFudGlhdGlvbk1vZGUuRUFHRVI7XG59XG4iLCAiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHsgUHJvdmlkZXIgfSBmcm9tICcuL3Byb3ZpZGVyJztcbmltcG9ydCB7IENvbXBvbmVudCB9IGZyb20gJy4vY29tcG9uZW50JztcbmltcG9ydCB7IE5hbWUgfSBmcm9tICcuL3R5cGVzJztcblxuLyoqXG4gKiBDb21wb25lbnRDb250YWluZXIgdGhhdCBwcm92aWRlcyBQcm92aWRlcnMgZm9yIHNlcnZpY2UgbmFtZSBULCBlLmcuIGBhdXRoYCwgYGF1dGgtaW50ZXJuYWxgXG4gKi9cbmV4cG9ydCBjbGFzcyBDb21wb25lbnRDb250YWluZXIge1xuICBwcml2YXRlIHJlYWRvbmx5IHByb3ZpZGVycyA9IG5ldyBNYXA8c3RyaW5nLCBQcm92aWRlcjxOYW1lPj4oKTtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlYWRvbmx5IG5hbWU6IHN0cmluZykge31cblxuICAvKipcbiAgICpcbiAgICogQHBhcmFtIGNvbXBvbmVudCBDb21wb25lbnQgYmVpbmcgYWRkZWRcbiAgICogQHBhcmFtIG92ZXJ3cml0ZSBXaGVuIGEgY29tcG9uZW50IHdpdGggdGhlIHNhbWUgbmFtZSBoYXMgYWxyZWFkeSBiZWVuIHJlZ2lzdGVyZWQsXG4gICAqIGlmIG92ZXJ3cml0ZSBpcyB0cnVlOiBvdmVyd3JpdGUgdGhlIGV4aXN0aW5nIGNvbXBvbmVudCB3aXRoIHRoZSBuZXcgY29tcG9uZW50IGFuZCBjcmVhdGUgYSBuZXdcbiAgICogcHJvdmlkZXIgd2l0aCB0aGUgbmV3IGNvbXBvbmVudC4gSXQgY2FuIGJlIHVzZWZ1bCBpbiB0ZXN0cyB3aGVyZSB5b3Ugd2FudCB0byB1c2UgZGlmZmVyZW50IG1vY2tzXG4gICAqIGZvciBkaWZmZXJlbnQgdGVzdHMuXG4gICAqIGlmIG92ZXJ3cml0ZSBpcyBmYWxzZTogdGhyb3cgYW4gZXhjZXB0aW9uXG4gICAqL1xuICBhZGRDb21wb25lbnQ8VCBleHRlbmRzIE5hbWU+KGNvbXBvbmVudDogQ29tcG9uZW50PFQ+KTogdm9pZCB7XG4gICAgY29uc3QgcHJvdmlkZXIgPSB0aGlzLmdldFByb3ZpZGVyKGNvbXBvbmVudC5uYW1lKTtcbiAgICBpZiAocHJvdmlkZXIuaXNDb21wb25lbnRTZXQoKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICBgQ29tcG9uZW50ICR7Y29tcG9uZW50Lm5hbWV9IGhhcyBhbHJlYWR5IGJlZW4gcmVnaXN0ZXJlZCB3aXRoICR7dGhpcy5uYW1lfWBcbiAgICAgICk7XG4gICAgfVxuXG4gICAgcHJvdmlkZXIuc2V0Q29tcG9uZW50KGNvbXBvbmVudCk7XG4gIH1cblxuICBhZGRPck92ZXJ3cml0ZUNvbXBvbmVudDxUIGV4dGVuZHMgTmFtZT4oY29tcG9uZW50OiBDb21wb25lbnQ8VD4pOiB2b2lkIHtcbiAgICBjb25zdCBwcm92aWRlciA9IHRoaXMuZ2V0UHJvdmlkZXIoY29tcG9uZW50Lm5hbWUpO1xuICAgIGlmIChwcm92aWRlci5pc0NvbXBvbmVudFNldCgpKSB7XG4gICAgICAvLyBkZWxldGUgdGhlIGV4aXN0aW5nIHByb3ZpZGVyIGZyb20gdGhlIGNvbnRhaW5lciwgc28gd2UgY2FuIHJlZ2lzdGVyIHRoZSBuZXcgY29tcG9uZW50XG4gICAgICB0aGlzLnByb3ZpZGVycy5kZWxldGUoY29tcG9uZW50Lm5hbWUpO1xuICAgIH1cblxuICAgIHRoaXMuYWRkQ29tcG9uZW50KGNvbXBvbmVudCk7XG4gIH1cblxuICAvKipcbiAgICogZ2V0UHJvdmlkZXIgcHJvdmlkZXMgYSB0eXBlIHNhZmUgaW50ZXJmYWNlIHdoZXJlIGl0IGNhbiBvbmx5IGJlIGNhbGxlZCB3aXRoIGEgZmllbGQgbmFtZVxuICAgKiBwcmVzZW50IGluIE5hbWVTZXJ2aWNlTWFwcGluZyBpbnRlcmZhY2UuXG4gICAqXG4gICAqIEZpcmViYXNlIFNES3MgcHJvdmlkaW5nIHNlcnZpY2VzIHNob3VsZCBleHRlbmQgTmFtZVNlcnZpY2VNYXBwaW5nIGludGVyZmFjZSB0byByZWdpc3RlclxuICAgKiB0aGVtc2VsdmVzLlxuICAgKi9cbiAgZ2V0UHJvdmlkZXI8VCBleHRlbmRzIE5hbWU+KG5hbWU6IFQpOiBQcm92aWRlcjxUPiB7XG4gICAgaWYgKHRoaXMucHJvdmlkZXJzLmhhcyhuYW1lKSkge1xuICAgICAgcmV0dXJuIHRoaXMucHJvdmlkZXJzLmdldChuYW1lKSBhcyB1bmtub3duIGFzIFByb3ZpZGVyPFQ+O1xuICAgIH1cblxuICAgIC8vIGNyZWF0ZSBhIFByb3ZpZGVyIGZvciBhIHNlcnZpY2UgdGhhdCBoYXNuJ3QgcmVnaXN0ZXJlZCB3aXRoIEZpcmViYXNlXG4gICAgY29uc3QgcHJvdmlkZXIgPSBuZXcgUHJvdmlkZXI8VD4obmFtZSwgdGhpcyk7XG4gICAgdGhpcy5wcm92aWRlcnMuc2V0KG5hbWUsIHByb3ZpZGVyIGFzIHVua25vd24gYXMgUHJvdmlkZXI8TmFtZT4pO1xuXG4gICAgcmV0dXJuIHByb3ZpZGVyIGFzIFByb3ZpZGVyPFQ+O1xuICB9XG5cbiAgZ2V0UHJvdmlkZXJzKCk6IEFycmF5PFByb3ZpZGVyPE5hbWU+PiB7XG4gICAgcmV0dXJuIEFycmF5LmZyb20odGhpcy5wcm92aWRlcnMudmFsdWVzKCkpO1xuICB9XG59XG4iLCAiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuZXhwb3J0IHR5cGUgTG9nTGV2ZWxTdHJpbmcgPVxuICB8ICdkZWJ1ZydcbiAgfCAndmVyYm9zZSdcbiAgfCAnaW5mbydcbiAgfCAnd2FybidcbiAgfCAnZXJyb3InXG4gIHwgJ3NpbGVudCc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgTG9nT3B0aW9ucyB7XG4gIGxldmVsOiBMb2dMZXZlbFN0cmluZztcbn1cblxuZXhwb3J0IHR5cGUgTG9nQ2FsbGJhY2sgPSAoY2FsbGJhY2tQYXJhbXM6IExvZ0NhbGxiYWNrUGFyYW1zKSA9PiB2b2lkO1xuXG5leHBvcnQgaW50ZXJmYWNlIExvZ0NhbGxiYWNrUGFyYW1zIHtcbiAgbGV2ZWw6IExvZ0xldmVsU3RyaW5nO1xuICBtZXNzYWdlOiBzdHJpbmc7XG4gIGFyZ3M6IHVua25vd25bXTtcbiAgdHlwZTogc3RyaW5nO1xufVxuXG4vKipcbiAqIEEgY29udGFpbmVyIGZvciBhbGwgb2YgdGhlIExvZ2dlciBpbnN0YW5jZXNcbiAqL1xuZXhwb3J0IGNvbnN0IGluc3RhbmNlczogTG9nZ2VyW10gPSBbXTtcblxuLyoqXG4gKiBUaGUgSlMgU0RLIHN1cHBvcnRzIDUgbG9nIGxldmVscyBhbmQgYWxzbyBhbGxvd3MgYSB1c2VyIHRoZSBhYmlsaXR5IHRvXG4gKiBzaWxlbmNlIHRoZSBsb2dzIGFsdG9nZXRoZXIuXG4gKlxuICogVGhlIG9yZGVyIGlzIGEgZm9sbG93czpcbiAqIERFQlVHIDwgVkVSQk9TRSA8IElORk8gPCBXQVJOIDwgRVJST1JcbiAqXG4gKiBBbGwgb2YgdGhlIGxvZyB0eXBlcyBhYm92ZSB0aGUgY3VycmVudCBsb2cgbGV2ZWwgd2lsbCBiZSBjYXB0dXJlZCAoaS5lLiBpZlxuICogeW91IHNldCB0aGUgbG9nIGxldmVsIHRvIGBJTkZPYCwgZXJyb3JzIHdpbGwgc3RpbGwgYmUgbG9nZ2VkLCBidXQgYERFQlVHYCBhbmRcbiAqIGBWRVJCT1NFYCBsb2dzIHdpbGwgbm90KVxuICovXG5leHBvcnQgZW51bSBMb2dMZXZlbCB7XG4gIERFQlVHLFxuICBWRVJCT1NFLFxuICBJTkZPLFxuICBXQVJOLFxuICBFUlJPUixcbiAgU0lMRU5UXG59XG5cbmNvbnN0IGxldmVsU3RyaW5nVG9FbnVtOiB7IFtrZXkgaW4gTG9nTGV2ZWxTdHJpbmddOiBMb2dMZXZlbCB9ID0ge1xuICAnZGVidWcnOiBMb2dMZXZlbC5ERUJVRyxcbiAgJ3ZlcmJvc2UnOiBMb2dMZXZlbC5WRVJCT1NFLFxuICAnaW5mbyc6IExvZ0xldmVsLklORk8sXG4gICd3YXJuJzogTG9nTGV2ZWwuV0FSTixcbiAgJ2Vycm9yJzogTG9nTGV2ZWwuRVJST1IsXG4gICdzaWxlbnQnOiBMb2dMZXZlbC5TSUxFTlRcbn07XG5cbi8qKlxuICogVGhlIGRlZmF1bHQgbG9nIGxldmVsXG4gKi9cbmNvbnN0IGRlZmF1bHRMb2dMZXZlbDogTG9nTGV2ZWwgPSBMb2dMZXZlbC5JTkZPO1xuXG4vKipcbiAqIFdlIGFsbG93IHVzZXJzIHRoZSBhYmlsaXR5IHRvIHBhc3MgdGhlaXIgb3duIGxvZyBoYW5kbGVyLiBXZSB3aWxsIHBhc3MgdGhlXG4gKiB0eXBlIG9mIGxvZywgdGhlIGN1cnJlbnQgbG9nIGxldmVsLCBhbmQgYW55IG90aGVyIGFyZ3VtZW50cyBwYXNzZWQgKGkuZS4gdGhlXG4gKiBtZXNzYWdlcyB0aGF0IHRoZSB1c2VyIHdhbnRzIHRvIGxvZykgdG8gdGhpcyBmdW5jdGlvbi5cbiAqL1xuZXhwb3J0IHR5cGUgTG9nSGFuZGxlciA9IChcbiAgbG9nZ2VySW5zdGFuY2U6IExvZ2dlcixcbiAgbG9nVHlwZTogTG9nTGV2ZWwsXG4gIC4uLmFyZ3M6IHVua25vd25bXVxuKSA9PiB2b2lkO1xuXG4vKipcbiAqIEJ5IGRlZmF1bHQsIGBjb25zb2xlLmRlYnVnYCBpcyBub3QgZGlzcGxheWVkIGluIHRoZSBkZXZlbG9wZXIgY29uc29sZSAoaW5cbiAqIGNocm9tZSkuIFRvIGF2b2lkIGZvcmNpbmcgdXNlcnMgdG8gaGF2ZSB0byBvcHQtaW4gdG8gdGhlc2UgbG9ncyB0d2ljZVxuICogKGkuZS4gb25jZSBmb3IgZmlyZWJhc2UsIGFuZCBvbmNlIGluIHRoZSBjb25zb2xlKSwgd2UgYXJlIHNlbmRpbmcgYERFQlVHYFxuICogbG9ncyB0byB0aGUgYGNvbnNvbGUubG9nYCBmdW5jdGlvbi5cbiAqL1xuY29uc3QgQ29uc29sZU1ldGhvZCA9IHtcbiAgW0xvZ0xldmVsLkRFQlVHXTogJ2xvZycsXG4gIFtMb2dMZXZlbC5WRVJCT1NFXTogJ2xvZycsXG4gIFtMb2dMZXZlbC5JTkZPXTogJ2luZm8nLFxuICBbTG9nTGV2ZWwuV0FSTl06ICd3YXJuJyxcbiAgW0xvZ0xldmVsLkVSUk9SXTogJ2Vycm9yJ1xufTtcblxuLyoqXG4gKiBUaGUgZGVmYXVsdCBsb2cgaGFuZGxlciB3aWxsIGZvcndhcmQgREVCVUcsIFZFUkJPU0UsIElORk8sIFdBUk4sIGFuZCBFUlJPUlxuICogbWVzc2FnZXMgb24gdG8gdGhlaXIgY29ycmVzcG9uZGluZyBjb25zb2xlIGNvdW50ZXJwYXJ0cyAoaWYgdGhlIGxvZyBtZXRob2RcbiAqIGlzIHN1cHBvcnRlZCBieSB0aGUgY3VycmVudCBsb2cgbGV2ZWwpXG4gKi9cbmNvbnN0IGRlZmF1bHRMb2dIYW5kbGVyOiBMb2dIYW5kbGVyID0gKGluc3RhbmNlLCBsb2dUeXBlLCAuLi5hcmdzKTogdm9pZCA9PiB7XG4gIGlmIChsb2dUeXBlIDwgaW5zdGFuY2UubG9nTGV2ZWwpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgY29uc3Qgbm93ID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xuICBjb25zdCBtZXRob2QgPSBDb25zb2xlTWV0aG9kW2xvZ1R5cGUgYXMga2V5b2YgdHlwZW9mIENvbnNvbGVNZXRob2RdO1xuICBpZiAobWV0aG9kKSB7XG4gICAgY29uc29sZVttZXRob2QgYXMgJ2xvZycgfCAnaW5mbycgfCAnd2FybicgfCAnZXJyb3InXShcbiAgICAgIGBbJHtub3d9XSAgJHtpbnN0YW5jZS5uYW1lfTpgLFxuICAgICAgLi4uYXJnc1xuICAgICk7XG4gIH0gZWxzZSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgYEF0dGVtcHRlZCB0byBsb2cgYSBtZXNzYWdlIHdpdGggYW4gaW52YWxpZCBsb2dUeXBlICh2YWx1ZTogJHtsb2dUeXBlfSlgXG4gICAgKTtcbiAgfVxufTtcblxuZXhwb3J0IGNsYXNzIExvZ2dlciB7XG4gIC8qKlxuICAgKiBHaXZlcyB5b3UgYW4gaW5zdGFuY2Ugb2YgYSBMb2dnZXIgdG8gY2FwdHVyZSBtZXNzYWdlcyBhY2NvcmRpbmcgdG9cbiAgICogRmlyZWJhc2UncyBsb2dnaW5nIHNjaGVtZS5cbiAgICpcbiAgICogQHBhcmFtIG5hbWUgVGhlIG5hbWUgdGhhdCB0aGUgbG9ncyB3aWxsIGJlIGFzc29jaWF0ZWQgd2l0aFxuICAgKi9cbiAgY29uc3RydWN0b3IocHVibGljIG5hbWU6IHN0cmluZykge1xuICAgIC8qKlxuICAgICAqIENhcHR1cmUgdGhlIGN1cnJlbnQgaW5zdGFuY2UgZm9yIGxhdGVyIHVzZVxuICAgICAqL1xuICAgIGluc3RhbmNlcy5wdXNoKHRoaXMpO1xuICB9XG5cbiAgLyoqXG4gICAqIFRoZSBsb2cgbGV2ZWwgb2YgdGhlIGdpdmVuIExvZ2dlciBpbnN0YW5jZS5cbiAgICovXG4gIHByaXZhdGUgX2xvZ0xldmVsID0gZGVmYXVsdExvZ0xldmVsO1xuXG4gIGdldCBsb2dMZXZlbCgpOiBMb2dMZXZlbCB7XG4gICAgcmV0dXJuIHRoaXMuX2xvZ0xldmVsO1xuICB9XG5cbiAgc2V0IGxvZ0xldmVsKHZhbDogTG9nTGV2ZWwpIHtcbiAgICBpZiAoISh2YWwgaW4gTG9nTGV2ZWwpKSB7XG4gICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKGBJbnZhbGlkIHZhbHVlIFwiJHt2YWx9XCIgYXNzaWduZWQgdG8gXFxgbG9nTGV2ZWxcXGBgKTtcbiAgICB9XG4gICAgdGhpcy5fbG9nTGV2ZWwgPSB2YWw7XG4gIH1cblxuICAvLyBXb3JrYXJvdW5kIGZvciBzZXR0ZXIvZ2V0dGVyIGhhdmluZyB0byBiZSB0aGUgc2FtZSB0eXBlLlxuICBzZXRMb2dMZXZlbCh2YWw6IExvZ0xldmVsIHwgTG9nTGV2ZWxTdHJpbmcpOiB2b2lkIHtcbiAgICB0aGlzLl9sb2dMZXZlbCA9IHR5cGVvZiB2YWwgPT09ICdzdHJpbmcnID8gbGV2ZWxTdHJpbmdUb0VudW1bdmFsXSA6IHZhbDtcbiAgfVxuXG4gIC8qKlxuICAgKiBUaGUgbWFpbiAoaW50ZXJuYWwpIGxvZyBoYW5kbGVyIGZvciB0aGUgTG9nZ2VyIGluc3RhbmNlLlxuICAgKiBDYW4gYmUgc2V0IHRvIGEgbmV3IGZ1bmN0aW9uIGluIGludGVybmFsIHBhY2thZ2UgY29kZSBidXQgbm90IGJ5IHVzZXIuXG4gICAqL1xuICBwcml2YXRlIF9sb2dIYW5kbGVyOiBMb2dIYW5kbGVyID0gZGVmYXVsdExvZ0hhbmRsZXI7XG4gIGdldCBsb2dIYW5kbGVyKCk6IExvZ0hhbmRsZXIge1xuICAgIHJldHVybiB0aGlzLl9sb2dIYW5kbGVyO1xuICB9XG4gIHNldCBsb2dIYW5kbGVyKHZhbDogTG9nSGFuZGxlcikge1xuICAgIGlmICh0eXBlb2YgdmFsICE9PSAnZnVuY3Rpb24nKSB7XG4gICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdWYWx1ZSBhc3NpZ25lZCB0byBgbG9nSGFuZGxlcmAgbXVzdCBiZSBhIGZ1bmN0aW9uJyk7XG4gICAgfVxuICAgIHRoaXMuX2xvZ0hhbmRsZXIgPSB2YWw7XG4gIH1cblxuICAvKipcbiAgICogVGhlIG9wdGlvbmFsLCBhZGRpdGlvbmFsLCB1c2VyLWRlZmluZWQgbG9nIGhhbmRsZXIgZm9yIHRoZSBMb2dnZXIgaW5zdGFuY2UuXG4gICAqL1xuICBwcml2YXRlIF91c2VyTG9nSGFuZGxlcjogTG9nSGFuZGxlciB8IG51bGwgPSBudWxsO1xuICBnZXQgdXNlckxvZ0hhbmRsZXIoKTogTG9nSGFuZGxlciB8IG51bGwge1xuICAgIHJldHVybiB0aGlzLl91c2VyTG9nSGFuZGxlcjtcbiAgfVxuICBzZXQgdXNlckxvZ0hhbmRsZXIodmFsOiBMb2dIYW5kbGVyIHwgbnVsbCkge1xuICAgIHRoaXMuX3VzZXJMb2dIYW5kbGVyID0gdmFsO1xuICB9XG5cbiAgLyoqXG4gICAqIFRoZSBmdW5jdGlvbnMgYmVsb3cgYXJlIGFsbCBiYXNlZCBvbiB0aGUgYGNvbnNvbGVgIGludGVyZmFjZVxuICAgKi9cblxuICBkZWJ1ZyguLi5hcmdzOiB1bmtub3duW10pOiB2b2lkIHtcbiAgICB0aGlzLl91c2VyTG9nSGFuZGxlciAmJiB0aGlzLl91c2VyTG9nSGFuZGxlcih0aGlzLCBMb2dMZXZlbC5ERUJVRywgLi4uYXJncyk7XG4gICAgdGhpcy5fbG9nSGFuZGxlcih0aGlzLCBMb2dMZXZlbC5ERUJVRywgLi4uYXJncyk7XG4gIH1cbiAgbG9nKC4uLmFyZ3M6IHVua25vd25bXSk6IHZvaWQge1xuICAgIHRoaXMuX3VzZXJMb2dIYW5kbGVyICYmXG4gICAgICB0aGlzLl91c2VyTG9nSGFuZGxlcih0aGlzLCBMb2dMZXZlbC5WRVJCT1NFLCAuLi5hcmdzKTtcbiAgICB0aGlzLl9sb2dIYW5kbGVyKHRoaXMsIExvZ0xldmVsLlZFUkJPU0UsIC4uLmFyZ3MpO1xuICB9XG4gIGluZm8oLi4uYXJnczogdW5rbm93bltdKTogdm9pZCB7XG4gICAgdGhpcy5fdXNlckxvZ0hhbmRsZXIgJiYgdGhpcy5fdXNlckxvZ0hhbmRsZXIodGhpcywgTG9nTGV2ZWwuSU5GTywgLi4uYXJncyk7XG4gICAgdGhpcy5fbG9nSGFuZGxlcih0aGlzLCBMb2dMZXZlbC5JTkZPLCAuLi5hcmdzKTtcbiAgfVxuICB3YXJuKC4uLmFyZ3M6IHVua25vd25bXSk6IHZvaWQge1xuICAgIHRoaXMuX3VzZXJMb2dIYW5kbGVyICYmIHRoaXMuX3VzZXJMb2dIYW5kbGVyKHRoaXMsIExvZ0xldmVsLldBUk4sIC4uLmFyZ3MpO1xuICAgIHRoaXMuX2xvZ0hhbmRsZXIodGhpcywgTG9nTGV2ZWwuV0FSTiwgLi4uYXJncyk7XG4gIH1cbiAgZXJyb3IoLi4uYXJnczogdW5rbm93bltdKTogdm9pZCB7XG4gICAgdGhpcy5fdXNlckxvZ0hhbmRsZXIgJiYgdGhpcy5fdXNlckxvZ0hhbmRsZXIodGhpcywgTG9nTGV2ZWwuRVJST1IsIC4uLmFyZ3MpO1xuICAgIHRoaXMuX2xvZ0hhbmRsZXIodGhpcywgTG9nTGV2ZWwuRVJST1IsIC4uLmFyZ3MpO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBzZXRMb2dMZXZlbChsZXZlbDogTG9nTGV2ZWxTdHJpbmcgfCBMb2dMZXZlbCk6IHZvaWQge1xuICBpbnN0YW5jZXMuZm9yRWFjaChpbnN0ID0+IHtcbiAgICBpbnN0LnNldExvZ0xldmVsKGxldmVsKTtcbiAgfSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBzZXRVc2VyTG9nSGFuZGxlcihcbiAgbG9nQ2FsbGJhY2s6IExvZ0NhbGxiYWNrIHwgbnVsbCxcbiAgb3B0aW9ucz86IExvZ09wdGlvbnNcbik6IHZvaWQge1xuICBmb3IgKGNvbnN0IGluc3RhbmNlIG9mIGluc3RhbmNlcykge1xuICAgIGxldCBjdXN0b21Mb2dMZXZlbDogTG9nTGV2ZWwgfCBudWxsID0gbnVsbDtcbiAgICBpZiAob3B0aW9ucyAmJiBvcHRpb25zLmxldmVsKSB7XG4gICAgICBjdXN0b21Mb2dMZXZlbCA9IGxldmVsU3RyaW5nVG9FbnVtW29wdGlvbnMubGV2ZWxdO1xuICAgIH1cbiAgICBpZiAobG9nQ2FsbGJhY2sgPT09IG51bGwpIHtcbiAgICAgIGluc3RhbmNlLnVzZXJMb2dIYW5kbGVyID0gbnVsbDtcbiAgICB9IGVsc2Uge1xuICAgICAgaW5zdGFuY2UudXNlckxvZ0hhbmRsZXIgPSAoXG4gICAgICAgIGluc3RhbmNlOiBMb2dnZXIsXG4gICAgICAgIGxldmVsOiBMb2dMZXZlbCxcbiAgICAgICAgLi4uYXJnczogdW5rbm93bltdXG4gICAgICApID0+IHtcbiAgICAgICAgY29uc3QgbWVzc2FnZSA9IGFyZ3NcbiAgICAgICAgICAubWFwKGFyZyA9PiB7XG4gICAgICAgICAgICBpZiAoYXJnID09IG51bGwpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBhcmcgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgIHJldHVybiBhcmc7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBhcmcgPT09ICdudW1iZXInIHx8IHR5cGVvZiBhcmcgPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICByZXR1cm4gYXJnLnRvU3RyaW5nKCk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGFyZyBpbnN0YW5jZW9mIEVycm9yKSB7XG4gICAgICAgICAgICAgIHJldHVybiBhcmcubWVzc2FnZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KGFyZyk7XG4gICAgICAgICAgICAgIH0gY2F0Y2ggKGlnbm9yZWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pXG4gICAgICAgICAgLmZpbHRlcihhcmcgPT4gYXJnKVxuICAgICAgICAgIC5qb2luKCcgJyk7XG4gICAgICAgIGlmIChsZXZlbCA+PSAoY3VzdG9tTG9nTGV2ZWwgPz8gaW5zdGFuY2UubG9nTGV2ZWwpKSB7XG4gICAgICAgICAgbG9nQ2FsbGJhY2soe1xuICAgICAgICAgICAgbGV2ZWw6IExvZ0xldmVsW2xldmVsXS50b0xvd2VyQ2FzZSgpIGFzIExvZ0xldmVsU3RyaW5nLFxuICAgICAgICAgICAgbWVzc2FnZSxcbiAgICAgICAgICAgIGFyZ3MsXG4gICAgICAgICAgICB0eXBlOiBpbnN0YW5jZS5uYW1lXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfVxuICB9XG59XG4iLCAiY29uc3QgaW5zdGFuY2VPZkFueSA9IChvYmplY3QsIGNvbnN0cnVjdG9ycykgPT4gY29uc3RydWN0b3JzLnNvbWUoKGMpID0+IG9iamVjdCBpbnN0YW5jZW9mIGMpO1xuXG5sZXQgaWRiUHJveHlhYmxlVHlwZXM7XG5sZXQgY3Vyc29yQWR2YW5jZU1ldGhvZHM7XG4vLyBUaGlzIGlzIGEgZnVuY3Rpb24gdG8gcHJldmVudCBpdCB0aHJvd2luZyB1cCBpbiBub2RlIGVudmlyb25tZW50cy5cbmZ1bmN0aW9uIGdldElkYlByb3h5YWJsZVR5cGVzKCkge1xuICAgIHJldHVybiAoaWRiUHJveHlhYmxlVHlwZXMgfHxcbiAgICAgICAgKGlkYlByb3h5YWJsZVR5cGVzID0gW1xuICAgICAgICAgICAgSURCRGF0YWJhc2UsXG4gICAgICAgICAgICBJREJPYmplY3RTdG9yZSxcbiAgICAgICAgICAgIElEQkluZGV4LFxuICAgICAgICAgICAgSURCQ3Vyc29yLFxuICAgICAgICAgICAgSURCVHJhbnNhY3Rpb24sXG4gICAgICAgIF0pKTtcbn1cbi8vIFRoaXMgaXMgYSBmdW5jdGlvbiB0byBwcmV2ZW50IGl0IHRocm93aW5nIHVwIGluIG5vZGUgZW52aXJvbm1lbnRzLlxuZnVuY3Rpb24gZ2V0Q3Vyc29yQWR2YW5jZU1ldGhvZHMoKSB7XG4gICAgcmV0dXJuIChjdXJzb3JBZHZhbmNlTWV0aG9kcyB8fFxuICAgICAgICAoY3Vyc29yQWR2YW5jZU1ldGhvZHMgPSBbXG4gICAgICAgICAgICBJREJDdXJzb3IucHJvdG90eXBlLmFkdmFuY2UsXG4gICAgICAgICAgICBJREJDdXJzb3IucHJvdG90eXBlLmNvbnRpbnVlLFxuICAgICAgICAgICAgSURCQ3Vyc29yLnByb3RvdHlwZS5jb250aW51ZVByaW1hcnlLZXksXG4gICAgICAgIF0pKTtcbn1cbmNvbnN0IGN1cnNvclJlcXVlc3RNYXAgPSBuZXcgV2Vha01hcCgpO1xuY29uc3QgdHJhbnNhY3Rpb25Eb25lTWFwID0gbmV3IFdlYWtNYXAoKTtcbmNvbnN0IHRyYW5zYWN0aW9uU3RvcmVOYW1lc01hcCA9IG5ldyBXZWFrTWFwKCk7XG5jb25zdCB0cmFuc2Zvcm1DYWNoZSA9IG5ldyBXZWFrTWFwKCk7XG5jb25zdCByZXZlcnNlVHJhbnNmb3JtQ2FjaGUgPSBuZXcgV2Vha01hcCgpO1xuZnVuY3Rpb24gcHJvbWlzaWZ5UmVxdWVzdChyZXF1ZXN0KSB7XG4gICAgY29uc3QgcHJvbWlzZSA9IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgY29uc3QgdW5saXN0ZW4gPSAoKSA9PiB7XG4gICAgICAgICAgICByZXF1ZXN0LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3N1Y2Nlc3MnLCBzdWNjZXNzKTtcbiAgICAgICAgICAgIHJlcXVlc3QucmVtb3ZlRXZlbnRMaXN0ZW5lcignZXJyb3InLCBlcnJvcik7XG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IHN1Y2Nlc3MgPSAoKSA9PiB7XG4gICAgICAgICAgICByZXNvbHZlKHdyYXAocmVxdWVzdC5yZXN1bHQpKTtcbiAgICAgICAgICAgIHVubGlzdGVuKCk7XG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IGVycm9yID0gKCkgPT4ge1xuICAgICAgICAgICAgcmVqZWN0KHJlcXVlc3QuZXJyb3IpO1xuICAgICAgICAgICAgdW5saXN0ZW4oKTtcbiAgICAgICAgfTtcbiAgICAgICAgcmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKCdzdWNjZXNzJywgc3VjY2Vzcyk7XG4gICAgICAgIHJlcXVlc3QuYWRkRXZlbnRMaXN0ZW5lcignZXJyb3InLCBlcnJvcik7XG4gICAgfSk7XG4gICAgcHJvbWlzZVxuICAgICAgICAudGhlbigodmFsdWUpID0+IHtcbiAgICAgICAgLy8gU2luY2UgY3Vyc29yaW5nIHJldXNlcyB0aGUgSURCUmVxdWVzdCAoKnNpZ2gqKSwgd2UgY2FjaGUgaXQgZm9yIGxhdGVyIHJldHJpZXZhbFxuICAgICAgICAvLyAoc2VlIHdyYXBGdW5jdGlvbikuXG4gICAgICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIElEQkN1cnNvcikge1xuICAgICAgICAgICAgY3Vyc29yUmVxdWVzdE1hcC5zZXQodmFsdWUsIHJlcXVlc3QpO1xuICAgICAgICB9XG4gICAgICAgIC8vIENhdGNoaW5nIHRvIGF2b2lkIFwiVW5jYXVnaHQgUHJvbWlzZSBleGNlcHRpb25zXCJcbiAgICB9KVxuICAgICAgICAuY2F0Y2goKCkgPT4geyB9KTtcbiAgICAvLyBUaGlzIG1hcHBpbmcgZXhpc3RzIGluIHJldmVyc2VUcmFuc2Zvcm1DYWNoZSBidXQgZG9lc24ndCBkb2Vzbid0IGV4aXN0IGluIHRyYW5zZm9ybUNhY2hlLiBUaGlzXG4gICAgLy8gaXMgYmVjYXVzZSB3ZSBjcmVhdGUgbWFueSBwcm9taXNlcyBmcm9tIGEgc2luZ2xlIElEQlJlcXVlc3QuXG4gICAgcmV2ZXJzZVRyYW5zZm9ybUNhY2hlLnNldChwcm9taXNlLCByZXF1ZXN0KTtcbiAgICByZXR1cm4gcHJvbWlzZTtcbn1cbmZ1bmN0aW9uIGNhY2hlRG9uZVByb21pc2VGb3JUcmFuc2FjdGlvbih0eCkge1xuICAgIC8vIEVhcmx5IGJhaWwgaWYgd2UndmUgYWxyZWFkeSBjcmVhdGVkIGEgZG9uZSBwcm9taXNlIGZvciB0aGlzIHRyYW5zYWN0aW9uLlxuICAgIGlmICh0cmFuc2FjdGlvbkRvbmVNYXAuaGFzKHR4KSlcbiAgICAgICAgcmV0dXJuO1xuICAgIGNvbnN0IGRvbmUgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgIGNvbnN0IHVubGlzdGVuID0gKCkgPT4ge1xuICAgICAgICAgICAgdHgucmVtb3ZlRXZlbnRMaXN0ZW5lcignY29tcGxldGUnLCBjb21wbGV0ZSk7XG4gICAgICAgICAgICB0eC5yZW1vdmVFdmVudExpc3RlbmVyKCdlcnJvcicsIGVycm9yKTtcbiAgICAgICAgICAgIHR4LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2Fib3J0JywgZXJyb3IpO1xuICAgICAgICB9O1xuICAgICAgICBjb25zdCBjb21wbGV0ZSA9ICgpID0+IHtcbiAgICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgICAgIHVubGlzdGVuKCk7XG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IGVycm9yID0gKCkgPT4ge1xuICAgICAgICAgICAgcmVqZWN0KHR4LmVycm9yIHx8IG5ldyBET01FeGNlcHRpb24oJ0Fib3J0RXJyb3InLCAnQWJvcnRFcnJvcicpKTtcbiAgICAgICAgICAgIHVubGlzdGVuKCk7XG4gICAgICAgIH07XG4gICAgICAgIHR4LmFkZEV2ZW50TGlzdGVuZXIoJ2NvbXBsZXRlJywgY29tcGxldGUpO1xuICAgICAgICB0eC5hZGRFdmVudExpc3RlbmVyKCdlcnJvcicsIGVycm9yKTtcbiAgICAgICAgdHguYWRkRXZlbnRMaXN0ZW5lcignYWJvcnQnLCBlcnJvcik7XG4gICAgfSk7XG4gICAgLy8gQ2FjaGUgaXQgZm9yIGxhdGVyIHJldHJpZXZhbC5cbiAgICB0cmFuc2FjdGlvbkRvbmVNYXAuc2V0KHR4LCBkb25lKTtcbn1cbmxldCBpZGJQcm94eVRyYXBzID0ge1xuICAgIGdldCh0YXJnZXQsIHByb3AsIHJlY2VpdmVyKSB7XG4gICAgICAgIGlmICh0YXJnZXQgaW5zdGFuY2VvZiBJREJUcmFuc2FjdGlvbikge1xuICAgICAgICAgICAgLy8gU3BlY2lhbCBoYW5kbGluZyBmb3IgdHJhbnNhY3Rpb24uZG9uZS5cbiAgICAgICAgICAgIGlmIChwcm9wID09PSAnZG9uZScpXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRyYW5zYWN0aW9uRG9uZU1hcC5nZXQodGFyZ2V0KTtcbiAgICAgICAgICAgIC8vIFBvbHlmaWxsIGZvciBvYmplY3RTdG9yZU5hbWVzIGJlY2F1c2Ugb2YgRWRnZS5cbiAgICAgICAgICAgIGlmIChwcm9wID09PSAnb2JqZWN0U3RvcmVOYW1lcycpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGFyZ2V0Lm9iamVjdFN0b3JlTmFtZXMgfHwgdHJhbnNhY3Rpb25TdG9yZU5hbWVzTWFwLmdldCh0YXJnZXQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gTWFrZSB0eC5zdG9yZSByZXR1cm4gdGhlIG9ubHkgc3RvcmUgaW4gdGhlIHRyYW5zYWN0aW9uLCBvciB1bmRlZmluZWQgaWYgdGhlcmUgYXJlIG1hbnkuXG4gICAgICAgICAgICBpZiAocHJvcCA9PT0gJ3N0b3JlJykge1xuICAgICAgICAgICAgICAgIHJldHVybiByZWNlaXZlci5vYmplY3RTdG9yZU5hbWVzWzFdXG4gICAgICAgICAgICAgICAgICAgID8gdW5kZWZpbmVkXG4gICAgICAgICAgICAgICAgICAgIDogcmVjZWl2ZXIub2JqZWN0U3RvcmUocmVjZWl2ZXIub2JqZWN0U3RvcmVOYW1lc1swXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLy8gRWxzZSB0cmFuc2Zvcm0gd2hhdGV2ZXIgd2UgZ2V0IGJhY2suXG4gICAgICAgIHJldHVybiB3cmFwKHRhcmdldFtwcm9wXSk7XG4gICAgfSxcbiAgICBzZXQodGFyZ2V0LCBwcm9wLCB2YWx1ZSkge1xuICAgICAgICB0YXJnZXRbcHJvcF0gPSB2YWx1ZTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSxcbiAgICBoYXModGFyZ2V0LCBwcm9wKSB7XG4gICAgICAgIGlmICh0YXJnZXQgaW5zdGFuY2VvZiBJREJUcmFuc2FjdGlvbiAmJlxuICAgICAgICAgICAgKHByb3AgPT09ICdkb25lJyB8fCBwcm9wID09PSAnc3RvcmUnKSkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHByb3AgaW4gdGFyZ2V0O1xuICAgIH0sXG59O1xuZnVuY3Rpb24gcmVwbGFjZVRyYXBzKGNhbGxiYWNrKSB7XG4gICAgaWRiUHJveHlUcmFwcyA9IGNhbGxiYWNrKGlkYlByb3h5VHJhcHMpO1xufVxuZnVuY3Rpb24gd3JhcEZ1bmN0aW9uKGZ1bmMpIHtcbiAgICAvLyBEdWUgdG8gZXhwZWN0ZWQgb2JqZWN0IGVxdWFsaXR5ICh3aGljaCBpcyBlbmZvcmNlZCBieSB0aGUgY2FjaGluZyBpbiBgd3JhcGApLCB3ZVxuICAgIC8vIG9ubHkgY3JlYXRlIG9uZSBuZXcgZnVuYyBwZXIgZnVuYy5cbiAgICAvLyBFZGdlIGRvZXNuJ3Qgc3VwcG9ydCBvYmplY3RTdG9yZU5hbWVzIChib29vKSwgc28gd2UgcG9seWZpbGwgaXQgaGVyZS5cbiAgICBpZiAoZnVuYyA9PT0gSURCRGF0YWJhc2UucHJvdG90eXBlLnRyYW5zYWN0aW9uICYmXG4gICAgICAgICEoJ29iamVjdFN0b3JlTmFtZXMnIGluIElEQlRyYW5zYWN0aW9uLnByb3RvdHlwZSkpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChzdG9yZU5hbWVzLCAuLi5hcmdzKSB7XG4gICAgICAgICAgICBjb25zdCB0eCA9IGZ1bmMuY2FsbCh1bndyYXAodGhpcyksIHN0b3JlTmFtZXMsIC4uLmFyZ3MpO1xuICAgICAgICAgICAgdHJhbnNhY3Rpb25TdG9yZU5hbWVzTWFwLnNldCh0eCwgc3RvcmVOYW1lcy5zb3J0ID8gc3RvcmVOYW1lcy5zb3J0KCkgOiBbc3RvcmVOYW1lc10pO1xuICAgICAgICAgICAgcmV0dXJuIHdyYXAodHgpO1xuICAgICAgICB9O1xuICAgIH1cbiAgICAvLyBDdXJzb3IgbWV0aG9kcyBhcmUgc3BlY2lhbCwgYXMgdGhlIGJlaGF2aW91ciBpcyBhIGxpdHRsZSBtb3JlIGRpZmZlcmVudCB0byBzdGFuZGFyZCBJREIuIEluXG4gICAgLy8gSURCLCB5b3UgYWR2YW5jZSB0aGUgY3Vyc29yIGFuZCB3YWl0IGZvciBhIG5ldyAnc3VjY2Vzcycgb24gdGhlIElEQlJlcXVlc3QgdGhhdCBnYXZlIHlvdSB0aGVcbiAgICAvLyBjdXJzb3IuIEl0J3Mga2luZGEgbGlrZSBhIHByb21pc2UgdGhhdCBjYW4gcmVzb2x2ZSB3aXRoIG1hbnkgdmFsdWVzLiBUaGF0IGRvZXNuJ3QgbWFrZSBzZW5zZVxuICAgIC8vIHdpdGggcmVhbCBwcm9taXNlcywgc28gZWFjaCBhZHZhbmNlIG1ldGhvZHMgcmV0dXJucyBhIG5ldyBwcm9taXNlIGZvciB0aGUgY3Vyc29yIG9iamVjdCwgb3JcbiAgICAvLyB1bmRlZmluZWQgaWYgdGhlIGVuZCBvZiB0aGUgY3Vyc29yIGhhcyBiZWVuIHJlYWNoZWQuXG4gICAgaWYgKGdldEN1cnNvckFkdmFuY2VNZXRob2RzKCkuaW5jbHVkZXMoZnVuYykpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICguLi5hcmdzKSB7XG4gICAgICAgICAgICAvLyBDYWxsaW5nIHRoZSBvcmlnaW5hbCBmdW5jdGlvbiB3aXRoIHRoZSBwcm94eSBhcyAndGhpcycgY2F1c2VzIElMTEVHQUwgSU5WT0NBVElPTiwgc28gd2UgdXNlXG4gICAgICAgICAgICAvLyB0aGUgb3JpZ2luYWwgb2JqZWN0LlxuICAgICAgICAgICAgZnVuYy5hcHBseSh1bndyYXAodGhpcyksIGFyZ3MpO1xuICAgICAgICAgICAgcmV0dXJuIHdyYXAoY3Vyc29yUmVxdWVzdE1hcC5nZXQodGhpcykpO1xuICAgICAgICB9O1xuICAgIH1cbiAgICByZXR1cm4gZnVuY3Rpb24gKC4uLmFyZ3MpIHtcbiAgICAgICAgLy8gQ2FsbGluZyB0aGUgb3JpZ2luYWwgZnVuY3Rpb24gd2l0aCB0aGUgcHJveHkgYXMgJ3RoaXMnIGNhdXNlcyBJTExFR0FMIElOVk9DQVRJT04sIHNvIHdlIHVzZVxuICAgICAgICAvLyB0aGUgb3JpZ2luYWwgb2JqZWN0LlxuICAgICAgICByZXR1cm4gd3JhcChmdW5jLmFwcGx5KHVud3JhcCh0aGlzKSwgYXJncykpO1xuICAgIH07XG59XG5mdW5jdGlvbiB0cmFuc2Zvcm1DYWNoYWJsZVZhbHVlKHZhbHVlKSB7XG4gICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJylcbiAgICAgICAgcmV0dXJuIHdyYXBGdW5jdGlvbih2YWx1ZSk7XG4gICAgLy8gVGhpcyBkb2Vzbid0IHJldHVybiwgaXQganVzdCBjcmVhdGVzIGEgJ2RvbmUnIHByb21pc2UgZm9yIHRoZSB0cmFuc2FjdGlvbixcbiAgICAvLyB3aGljaCBpcyBsYXRlciByZXR1cm5lZCBmb3IgdHJhbnNhY3Rpb24uZG9uZSAoc2VlIGlkYk9iamVjdEhhbmRsZXIpLlxuICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIElEQlRyYW5zYWN0aW9uKVxuICAgICAgICBjYWNoZURvbmVQcm9taXNlRm9yVHJhbnNhY3Rpb24odmFsdWUpO1xuICAgIGlmIChpbnN0YW5jZU9mQW55KHZhbHVlLCBnZXRJZGJQcm94eWFibGVUeXBlcygpKSlcbiAgICAgICAgcmV0dXJuIG5ldyBQcm94eSh2YWx1ZSwgaWRiUHJveHlUcmFwcyk7XG4gICAgLy8gUmV0dXJuIHRoZSBzYW1lIHZhbHVlIGJhY2sgaWYgd2UncmUgbm90IGdvaW5nIHRvIHRyYW5zZm9ybSBpdC5cbiAgICByZXR1cm4gdmFsdWU7XG59XG5mdW5jdGlvbiB3cmFwKHZhbHVlKSB7XG4gICAgLy8gV2Ugc29tZXRpbWVzIGdlbmVyYXRlIG11bHRpcGxlIHByb21pc2VzIGZyb20gYSBzaW5nbGUgSURCUmVxdWVzdCAoZWcgd2hlbiBjdXJzb3JpbmcpLCBiZWNhdXNlXG4gICAgLy8gSURCIGlzIHdlaXJkIGFuZCBhIHNpbmdsZSBJREJSZXF1ZXN0IGNhbiB5aWVsZCBtYW55IHJlc3BvbnNlcywgc28gdGhlc2UgY2FuJ3QgYmUgY2FjaGVkLlxuICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIElEQlJlcXVlc3QpXG4gICAgICAgIHJldHVybiBwcm9taXNpZnlSZXF1ZXN0KHZhbHVlKTtcbiAgICAvLyBJZiB3ZSd2ZSBhbHJlYWR5IHRyYW5zZm9ybWVkIHRoaXMgdmFsdWUgYmVmb3JlLCByZXVzZSB0aGUgdHJhbnNmb3JtZWQgdmFsdWUuXG4gICAgLy8gVGhpcyBpcyBmYXN0ZXIsIGJ1dCBpdCBhbHNvIHByb3ZpZGVzIG9iamVjdCBlcXVhbGl0eS5cbiAgICBpZiAodHJhbnNmb3JtQ2FjaGUuaGFzKHZhbHVlKSlcbiAgICAgICAgcmV0dXJuIHRyYW5zZm9ybUNhY2hlLmdldCh2YWx1ZSk7XG4gICAgY29uc3QgbmV3VmFsdWUgPSB0cmFuc2Zvcm1DYWNoYWJsZVZhbHVlKHZhbHVlKTtcbiAgICAvLyBOb3QgYWxsIHR5cGVzIGFyZSB0cmFuc2Zvcm1lZC5cbiAgICAvLyBUaGVzZSBtYXkgYmUgcHJpbWl0aXZlIHR5cGVzLCBzbyB0aGV5IGNhbid0IGJlIFdlYWtNYXAga2V5cy5cbiAgICBpZiAobmV3VmFsdWUgIT09IHZhbHVlKSB7XG4gICAgICAgIHRyYW5zZm9ybUNhY2hlLnNldCh2YWx1ZSwgbmV3VmFsdWUpO1xuICAgICAgICByZXZlcnNlVHJhbnNmb3JtQ2FjaGUuc2V0KG5ld1ZhbHVlLCB2YWx1ZSk7XG4gICAgfVxuICAgIHJldHVybiBuZXdWYWx1ZTtcbn1cbmNvbnN0IHVud3JhcCA9ICh2YWx1ZSkgPT4gcmV2ZXJzZVRyYW5zZm9ybUNhY2hlLmdldCh2YWx1ZSk7XG5cbmV4cG9ydCB7IHJldmVyc2VUcmFuc2Zvcm1DYWNoZSBhcyBhLCBpbnN0YW5jZU9mQW55IGFzIGksIHJlcGxhY2VUcmFwcyBhcyByLCB1bndyYXAgYXMgdSwgd3JhcCBhcyB3IH07XG4iLCAiaW1wb3J0IHsgdyBhcyB3cmFwLCByIGFzIHJlcGxhY2VUcmFwcyB9IGZyb20gJy4vd3JhcC1pZGItdmFsdWUuanMnO1xuZXhwb3J0IHsgdSBhcyB1bndyYXAsIHcgYXMgd3JhcCB9IGZyb20gJy4vd3JhcC1pZGItdmFsdWUuanMnO1xuXG4vKipcbiAqIE9wZW4gYSBkYXRhYmFzZS5cbiAqXG4gKiBAcGFyYW0gbmFtZSBOYW1lIG9mIHRoZSBkYXRhYmFzZS5cbiAqIEBwYXJhbSB2ZXJzaW9uIFNjaGVtYSB2ZXJzaW9uLlxuICogQHBhcmFtIGNhbGxiYWNrcyBBZGRpdGlvbmFsIGNhbGxiYWNrcy5cbiAqL1xuZnVuY3Rpb24gb3BlbkRCKG5hbWUsIHZlcnNpb24sIHsgYmxvY2tlZCwgdXBncmFkZSwgYmxvY2tpbmcsIHRlcm1pbmF0ZWQgfSA9IHt9KSB7XG4gICAgY29uc3QgcmVxdWVzdCA9IGluZGV4ZWREQi5vcGVuKG5hbWUsIHZlcnNpb24pO1xuICAgIGNvbnN0IG9wZW5Qcm9taXNlID0gd3JhcChyZXF1ZXN0KTtcbiAgICBpZiAodXBncmFkZSkge1xuICAgICAgICByZXF1ZXN0LmFkZEV2ZW50TGlzdGVuZXIoJ3VwZ3JhZGVuZWVkZWQnLCAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgIHVwZ3JhZGUod3JhcChyZXF1ZXN0LnJlc3VsdCksIGV2ZW50Lm9sZFZlcnNpb24sIGV2ZW50Lm5ld1ZlcnNpb24sIHdyYXAocmVxdWVzdC50cmFuc2FjdGlvbikpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgaWYgKGJsb2NrZWQpXG4gICAgICAgIHJlcXVlc3QuYWRkRXZlbnRMaXN0ZW5lcignYmxvY2tlZCcsICgpID0+IGJsb2NrZWQoKSk7XG4gICAgb3BlblByb21pc2VcbiAgICAgICAgLnRoZW4oKGRiKSA9PiB7XG4gICAgICAgIGlmICh0ZXJtaW5hdGVkKVxuICAgICAgICAgICAgZGIuYWRkRXZlbnRMaXN0ZW5lcignY2xvc2UnLCAoKSA9PiB0ZXJtaW5hdGVkKCkpO1xuICAgICAgICBpZiAoYmxvY2tpbmcpXG4gICAgICAgICAgICBkYi5hZGRFdmVudExpc3RlbmVyKCd2ZXJzaW9uY2hhbmdlJywgKCkgPT4gYmxvY2tpbmcoKSk7XG4gICAgfSlcbiAgICAgICAgLmNhdGNoKCgpID0+IHsgfSk7XG4gICAgcmV0dXJuIG9wZW5Qcm9taXNlO1xufVxuLyoqXG4gKiBEZWxldGUgYSBkYXRhYmFzZS5cbiAqXG4gKiBAcGFyYW0gbmFtZSBOYW1lIG9mIHRoZSBkYXRhYmFzZS5cbiAqL1xuZnVuY3Rpb24gZGVsZXRlREIobmFtZSwgeyBibG9ja2VkIH0gPSB7fSkge1xuICAgIGNvbnN0IHJlcXVlc3QgPSBpbmRleGVkREIuZGVsZXRlRGF0YWJhc2UobmFtZSk7XG4gICAgaWYgKGJsb2NrZWQpXG4gICAgICAgIHJlcXVlc3QuYWRkRXZlbnRMaXN0ZW5lcignYmxvY2tlZCcsICgpID0+IGJsb2NrZWQoKSk7XG4gICAgcmV0dXJuIHdyYXAocmVxdWVzdCkudGhlbigoKSA9PiB1bmRlZmluZWQpO1xufVxuXG5jb25zdCByZWFkTWV0aG9kcyA9IFsnZ2V0JywgJ2dldEtleScsICdnZXRBbGwnLCAnZ2V0QWxsS2V5cycsICdjb3VudCddO1xuY29uc3Qgd3JpdGVNZXRob2RzID0gWydwdXQnLCAnYWRkJywgJ2RlbGV0ZScsICdjbGVhciddO1xuY29uc3QgY2FjaGVkTWV0aG9kcyA9IG5ldyBNYXAoKTtcbmZ1bmN0aW9uIGdldE1ldGhvZCh0YXJnZXQsIHByb3ApIHtcbiAgICBpZiAoISh0YXJnZXQgaW5zdGFuY2VvZiBJREJEYXRhYmFzZSAmJlxuICAgICAgICAhKHByb3AgaW4gdGFyZ2V0KSAmJlxuICAgICAgICB0eXBlb2YgcHJvcCA9PT0gJ3N0cmluZycpKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKGNhY2hlZE1ldGhvZHMuZ2V0KHByb3ApKVxuICAgICAgICByZXR1cm4gY2FjaGVkTWV0aG9kcy5nZXQocHJvcCk7XG4gICAgY29uc3QgdGFyZ2V0RnVuY05hbWUgPSBwcm9wLnJlcGxhY2UoL0Zyb21JbmRleCQvLCAnJyk7XG4gICAgY29uc3QgdXNlSW5kZXggPSBwcm9wICE9PSB0YXJnZXRGdW5jTmFtZTtcbiAgICBjb25zdCBpc1dyaXRlID0gd3JpdGVNZXRob2RzLmluY2x1ZGVzKHRhcmdldEZ1bmNOYW1lKTtcbiAgICBpZiAoXG4gICAgLy8gQmFpbCBpZiB0aGUgdGFyZ2V0IGRvZXNuJ3QgZXhpc3Qgb24gdGhlIHRhcmdldC4gRWcsIGdldEFsbCBpc24ndCBpbiBFZGdlLlxuICAgICEodGFyZ2V0RnVuY05hbWUgaW4gKHVzZUluZGV4ID8gSURCSW5kZXggOiBJREJPYmplY3RTdG9yZSkucHJvdG90eXBlKSB8fFxuICAgICAgICAhKGlzV3JpdGUgfHwgcmVhZE1ldGhvZHMuaW5jbHVkZXModGFyZ2V0RnVuY05hbWUpKSkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IG1ldGhvZCA9IGFzeW5jIGZ1bmN0aW9uIChzdG9yZU5hbWUsIC4uLmFyZ3MpIHtcbiAgICAgICAgLy8gaXNXcml0ZSA/ICdyZWFkd3JpdGUnIDogdW5kZWZpbmVkIGd6aXBwcyBiZXR0ZXIsIGJ1dCBmYWlscyBpbiBFZGdlIDooXG4gICAgICAgIGNvbnN0IHR4ID0gdGhpcy50cmFuc2FjdGlvbihzdG9yZU5hbWUsIGlzV3JpdGUgPyAncmVhZHdyaXRlJyA6ICdyZWFkb25seScpO1xuICAgICAgICBsZXQgdGFyZ2V0ID0gdHguc3RvcmU7XG4gICAgICAgIGlmICh1c2VJbmRleClcbiAgICAgICAgICAgIHRhcmdldCA9IHRhcmdldC5pbmRleChhcmdzLnNoaWZ0KCkpO1xuICAgICAgICAvLyBNdXN0IHJlamVjdCBpZiBvcCByZWplY3RzLlxuICAgICAgICAvLyBJZiBpdCdzIGEgd3JpdGUgb3BlcmF0aW9uLCBtdXN0IHJlamVjdCBpZiB0eC5kb25lIHJlamVjdHMuXG4gICAgICAgIC8vIE11c3QgcmVqZWN0IHdpdGggb3AgcmVqZWN0aW9uIGZpcnN0LlxuICAgICAgICAvLyBNdXN0IHJlc29sdmUgd2l0aCBvcCB2YWx1ZS5cbiAgICAgICAgLy8gTXVzdCBoYW5kbGUgYm90aCBwcm9taXNlcyAobm8gdW5oYW5kbGVkIHJlamVjdGlvbnMpXG4gICAgICAgIHJldHVybiAoYXdhaXQgUHJvbWlzZS5hbGwoW1xuICAgICAgICAgICAgdGFyZ2V0W3RhcmdldEZ1bmNOYW1lXSguLi5hcmdzKSxcbiAgICAgICAgICAgIGlzV3JpdGUgJiYgdHguZG9uZSxcbiAgICAgICAgXSkpWzBdO1xuICAgIH07XG4gICAgY2FjaGVkTWV0aG9kcy5zZXQocHJvcCwgbWV0aG9kKTtcbiAgICByZXR1cm4gbWV0aG9kO1xufVxucmVwbGFjZVRyYXBzKChvbGRUcmFwcykgPT4gKHtcbiAgICAuLi5vbGRUcmFwcyxcbiAgICBnZXQ6ICh0YXJnZXQsIHByb3AsIHJlY2VpdmVyKSA9PiBnZXRNZXRob2QodGFyZ2V0LCBwcm9wKSB8fCBvbGRUcmFwcy5nZXQodGFyZ2V0LCBwcm9wLCByZWNlaXZlciksXG4gICAgaGFzOiAodGFyZ2V0LCBwcm9wKSA9PiAhIWdldE1ldGhvZCh0YXJnZXQsIHByb3ApIHx8IG9sZFRyYXBzLmhhcyh0YXJnZXQsIHByb3ApLFxufSkpO1xuXG5leHBvcnQgeyBkZWxldGVEQiwgb3BlbkRCIH07XG4iLCAiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHtcbiAgQ29tcG9uZW50Q29udGFpbmVyLFxuICBDb21wb25lbnRUeXBlLFxuICBQcm92aWRlcixcbiAgTmFtZVxufSBmcm9tICdAZmlyZWJhc2UvY29tcG9uZW50JztcbmltcG9ydCB7IFBsYXRmb3JtTG9nZ2VyU2VydmljZSwgVmVyc2lvblNlcnZpY2UgfSBmcm9tICcuL3R5cGVzJztcblxuZXhwb3J0IGNsYXNzIFBsYXRmb3JtTG9nZ2VyU2VydmljZUltcGwgaW1wbGVtZW50cyBQbGF0Zm9ybUxvZ2dlclNlcnZpY2Uge1xuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlYWRvbmx5IGNvbnRhaW5lcjogQ29tcG9uZW50Q29udGFpbmVyKSB7fVxuICAvLyBJbiBpbml0aWFsIGltcGxlbWVudGF0aW9uLCB0aGlzIHdpbGwgYmUgY2FsbGVkIGJ5IGluc3RhbGxhdGlvbnMgb25cbiAgLy8gYXV0aCB0b2tlbiByZWZyZXNoLCBhbmQgaW5zdGFsbGF0aW9ucyB3aWxsIHNlbmQgdGhpcyBzdHJpbmcuXG4gIGdldFBsYXRmb3JtSW5mb1N0cmluZygpOiBzdHJpbmcge1xuICAgIGNvbnN0IHByb3ZpZGVycyA9IHRoaXMuY29udGFpbmVyLmdldFByb3ZpZGVycygpO1xuICAgIC8vIExvb3AgdGhyb3VnaCBwcm92aWRlcnMgYW5kIGdldCBsaWJyYXJ5L3ZlcnNpb24gcGFpcnMgZnJvbSBhbnkgdGhhdCBhcmVcbiAgICAvLyB2ZXJzaW9uIGNvbXBvbmVudHMuXG4gICAgcmV0dXJuIHByb3ZpZGVyc1xuICAgICAgLm1hcChwcm92aWRlciA9PiB7XG4gICAgICAgIGlmIChpc1ZlcnNpb25TZXJ2aWNlUHJvdmlkZXIocHJvdmlkZXIpKSB7XG4gICAgICAgICAgY29uc3Qgc2VydmljZSA9IHByb3ZpZGVyLmdldEltbWVkaWF0ZSgpIGFzIFZlcnNpb25TZXJ2aWNlO1xuICAgICAgICAgIHJldHVybiBgJHtzZXJ2aWNlLmxpYnJhcnl9LyR7c2VydmljZS52ZXJzaW9ufWA7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgICAuZmlsdGVyKGxvZ1N0cmluZyA9PiBsb2dTdHJpbmcpXG4gICAgICAuam9pbignICcpO1xuICB9XG59XG4vKipcbiAqXG4gKiBAcGFyYW0gcHJvdmlkZXIgY2hlY2sgaWYgdGhpcyBwcm92aWRlciBwcm92aWRlcyBhIFZlcnNpb25TZXJ2aWNlXG4gKlxuICogTk9URTogVXNpbmcgUHJvdmlkZXI8J2FwcC12ZXJzaW9uJz4gaXMgYSBoYWNrIHRvIGluZGljYXRlIHRoYXQgdGhlIHByb3ZpZGVyXG4gKiBwcm92aWRlcyBWZXJzaW9uU2VydmljZS4gVGhlIHByb3ZpZGVyIGlzIG5vdCBuZWNlc3NhcmlseSBhICdhcHAtdmVyc2lvbidcbiAqIHByb3ZpZGVyLlxuICovXG5mdW5jdGlvbiBpc1ZlcnNpb25TZXJ2aWNlUHJvdmlkZXIocHJvdmlkZXI6IFByb3ZpZGVyPE5hbWU+KTogYm9vbGVhbiB7XG4gIGNvbnN0IGNvbXBvbmVudCA9IHByb3ZpZGVyLmdldENvbXBvbmVudCgpO1xuICByZXR1cm4gY29tcG9uZW50Py50eXBlID09PSBDb21wb25lbnRUeXBlLlZFUlNJT047XG59XG4iLCAiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHsgTG9nZ2VyIH0gZnJvbSAnQGZpcmViYXNlL2xvZ2dlcic7XG5cbmV4cG9ydCBjb25zdCBsb2dnZXIgPSBuZXcgTG9nZ2VyKCdAZmlyZWJhc2UvYXBwJyk7XG4iLCAiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHsgbmFtZSBhcyBhcHBOYW1lIH0gZnJvbSAnLi4vcGFja2FnZS5qc29uJztcbmltcG9ydCB7IG5hbWUgYXMgYXBwQ29tcGF0TmFtZSB9IGZyb20gJy4uLy4uL2FwcC1jb21wYXQvcGFja2FnZS5qc29uJztcbmltcG9ydCB7IG5hbWUgYXMgYW5hbHl0aWNzQ29tcGF0TmFtZSB9IGZyb20gJy4uLy4uLy4uL3BhY2thZ2VzL2FuYWx5dGljcy1jb21wYXQvcGFja2FnZS5qc29uJztcbmltcG9ydCB7IG5hbWUgYXMgYW5hbHl0aWNzTmFtZSB9IGZyb20gJy4uLy4uLy4uL3BhY2thZ2VzL2FuYWx5dGljcy9wYWNrYWdlLmpzb24nO1xuaW1wb3J0IHsgbmFtZSBhcyBhcHBDaGVja0NvbXBhdE5hbWUgfSBmcm9tICcuLi8uLi8uLi9wYWNrYWdlcy9hcHAtY2hlY2stY29tcGF0L3BhY2thZ2UuanNvbic7XG5pbXBvcnQgeyBuYW1lIGFzIGFwcENoZWNrTmFtZSB9IGZyb20gJy4uLy4uLy4uL3BhY2thZ2VzL2FwcC1jaGVjay9wYWNrYWdlLmpzb24nO1xuaW1wb3J0IHsgbmFtZSBhcyBhdXRoTmFtZSB9IGZyb20gJy4uLy4uLy4uL3BhY2thZ2VzL2F1dGgvcGFja2FnZS5qc29uJztcbmltcG9ydCB7IG5hbWUgYXMgYXV0aENvbXBhdE5hbWUgfSBmcm9tICcuLi8uLi8uLi9wYWNrYWdlcy9hdXRoLWNvbXBhdC9wYWNrYWdlLmpzb24nO1xuaW1wb3J0IHsgbmFtZSBhcyBkYXRhYmFzZU5hbWUgfSBmcm9tICcuLi8uLi8uLi9wYWNrYWdlcy9kYXRhYmFzZS9wYWNrYWdlLmpzb24nO1xuaW1wb3J0IHsgbmFtZSBhcyBkYXRhYmFzZUNvbXBhdE5hbWUgfSBmcm9tICcuLi8uLi8uLi9wYWNrYWdlcy9kYXRhYmFzZS1jb21wYXQvcGFja2FnZS5qc29uJztcbmltcG9ydCB7IG5hbWUgYXMgZnVuY3Rpb25zTmFtZSB9IGZyb20gJy4uLy4uLy4uL3BhY2thZ2VzL2Z1bmN0aW9ucy9wYWNrYWdlLmpzb24nO1xuaW1wb3J0IHsgbmFtZSBhcyBmdW5jdGlvbnNDb21wYXROYW1lIH0gZnJvbSAnLi4vLi4vLi4vcGFja2FnZXMvZnVuY3Rpb25zLWNvbXBhdC9wYWNrYWdlLmpzb24nO1xuaW1wb3J0IHsgbmFtZSBhcyBpbnN0YWxsYXRpb25zTmFtZSB9IGZyb20gJy4uLy4uLy4uL3BhY2thZ2VzL2luc3RhbGxhdGlvbnMvcGFja2FnZS5qc29uJztcbmltcG9ydCB7IG5hbWUgYXMgaW5zdGFsbGF0aW9uc0NvbXBhdE5hbWUgfSBmcm9tICcuLi8uLi8uLi9wYWNrYWdlcy9pbnN0YWxsYXRpb25zLWNvbXBhdC9wYWNrYWdlLmpzb24nO1xuaW1wb3J0IHsgbmFtZSBhcyBtZXNzYWdpbmdOYW1lIH0gZnJvbSAnLi4vLi4vLi4vcGFja2FnZXMvbWVzc2FnaW5nL3BhY2thZ2UuanNvbic7XG5pbXBvcnQgeyBuYW1lIGFzIG1lc3NhZ2luZ0NvbXBhdE5hbWUgfSBmcm9tICcuLi8uLi8uLi9wYWNrYWdlcy9tZXNzYWdpbmctY29tcGF0L3BhY2thZ2UuanNvbic7XG5pbXBvcnQgeyBuYW1lIGFzIHBlcmZvcm1hbmNlTmFtZSB9IGZyb20gJy4uLy4uLy4uL3BhY2thZ2VzL3BlcmZvcm1hbmNlL3BhY2thZ2UuanNvbic7XG5pbXBvcnQgeyBuYW1lIGFzIHBlcmZvcm1hbmNlQ29tcGF0TmFtZSB9IGZyb20gJy4uLy4uLy4uL3BhY2thZ2VzL3BlcmZvcm1hbmNlLWNvbXBhdC9wYWNrYWdlLmpzb24nO1xuaW1wb3J0IHsgbmFtZSBhcyByZW1vdGVDb25maWdOYW1lIH0gZnJvbSAnLi4vLi4vLi4vcGFja2FnZXMvcmVtb3RlLWNvbmZpZy9wYWNrYWdlLmpzb24nO1xuaW1wb3J0IHsgbmFtZSBhcyByZW1vdGVDb25maWdDb21wYXROYW1lIH0gZnJvbSAnLi4vLi4vLi4vcGFja2FnZXMvcmVtb3RlLWNvbmZpZy1jb21wYXQvcGFja2FnZS5qc29uJztcbmltcG9ydCB7IG5hbWUgYXMgc3RvcmFnZU5hbWUgfSBmcm9tICcuLi8uLi8uLi9wYWNrYWdlcy9zdG9yYWdlL3BhY2thZ2UuanNvbic7XG5pbXBvcnQgeyBuYW1lIGFzIHN0b3JhZ2VDb21wYXROYW1lIH0gZnJvbSAnLi4vLi4vLi4vcGFja2FnZXMvc3RvcmFnZS1jb21wYXQvcGFja2FnZS5qc29uJztcbmltcG9ydCB7IG5hbWUgYXMgZmlyZXN0b3JlTmFtZSB9IGZyb20gJy4uLy4uLy4uL3BhY2thZ2VzL2ZpcmVzdG9yZS9wYWNrYWdlLmpzb24nO1xuaW1wb3J0IHsgbmFtZSBhcyBmaXJlc3RvcmVDb21wYXROYW1lIH0gZnJvbSAnLi4vLi4vLi4vcGFja2FnZXMvZmlyZXN0b3JlLWNvbXBhdC9wYWNrYWdlLmpzb24nO1xuaW1wb3J0IHsgbmFtZSBhcyBwYWNrYWdlTmFtZSB9IGZyb20gJy4uLy4uLy4uL3BhY2thZ2VzL2ZpcmViYXNlL3BhY2thZ2UuanNvbic7XG5cbi8qKlxuICogVGhlIGRlZmF1bHQgYXBwIG5hbWVcbiAqXG4gKiBAaW50ZXJuYWxcbiAqL1xuZXhwb3J0IGNvbnN0IERFRkFVTFRfRU5UUllfTkFNRSA9ICdbREVGQVVMVF0nO1xuXG5leHBvcnQgY29uc3QgUExBVEZPUk1fTE9HX1NUUklORyA9IHtcbiAgW2FwcE5hbWVdOiAnZmlyZS1jb3JlJyxcbiAgW2FwcENvbXBhdE5hbWVdOiAnZmlyZS1jb3JlLWNvbXBhdCcsXG4gIFthbmFseXRpY3NOYW1lXTogJ2ZpcmUtYW5hbHl0aWNzJyxcbiAgW2FuYWx5dGljc0NvbXBhdE5hbWVdOiAnZmlyZS1hbmFseXRpY3MtY29tcGF0JyxcbiAgW2FwcENoZWNrTmFtZV06ICdmaXJlLWFwcC1jaGVjaycsXG4gIFthcHBDaGVja0NvbXBhdE5hbWVdOiAnZmlyZS1hcHAtY2hlY2stY29tcGF0JyxcbiAgW2F1dGhOYW1lXTogJ2ZpcmUtYXV0aCcsXG4gIFthdXRoQ29tcGF0TmFtZV06ICdmaXJlLWF1dGgtY29tcGF0JyxcbiAgW2RhdGFiYXNlTmFtZV06ICdmaXJlLXJ0ZGInLFxuICBbZGF0YWJhc2VDb21wYXROYW1lXTogJ2ZpcmUtcnRkYi1jb21wYXQnLFxuICBbZnVuY3Rpb25zTmFtZV06ICdmaXJlLWZuJyxcbiAgW2Z1bmN0aW9uc0NvbXBhdE5hbWVdOiAnZmlyZS1mbi1jb21wYXQnLFxuICBbaW5zdGFsbGF0aW9uc05hbWVdOiAnZmlyZS1paWQnLFxuICBbaW5zdGFsbGF0aW9uc0NvbXBhdE5hbWVdOiAnZmlyZS1paWQtY29tcGF0JyxcbiAgW21lc3NhZ2luZ05hbWVdOiAnZmlyZS1mY20nLFxuICBbbWVzc2FnaW5nQ29tcGF0TmFtZV06ICdmaXJlLWZjbS1jb21wYXQnLFxuICBbcGVyZm9ybWFuY2VOYW1lXTogJ2ZpcmUtcGVyZicsXG4gIFtwZXJmb3JtYW5jZUNvbXBhdE5hbWVdOiAnZmlyZS1wZXJmLWNvbXBhdCcsXG4gIFtyZW1vdGVDb25maWdOYW1lXTogJ2ZpcmUtcmMnLFxuICBbcmVtb3RlQ29uZmlnQ29tcGF0TmFtZV06ICdmaXJlLXJjLWNvbXBhdCcsXG4gIFtzdG9yYWdlTmFtZV06ICdmaXJlLWdjcycsXG4gIFtzdG9yYWdlQ29tcGF0TmFtZV06ICdmaXJlLWdjcy1jb21wYXQnLFxuICBbZmlyZXN0b3JlTmFtZV06ICdmaXJlLWZzdCcsXG4gIFtmaXJlc3RvcmVDb21wYXROYW1lXTogJ2ZpcmUtZnN0LWNvbXBhdCcsXG4gICdmaXJlLWpzJzogJ2ZpcmUtanMnLCAvLyBQbGF0Zm9ybSBpZGVudGlmaWVyIGZvciBKUyBTREsuXG4gIFtwYWNrYWdlTmFtZV06ICdmaXJlLWpzLWFsbCdcbn0gYXMgY29uc3Q7XG4iLCAiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHsgRmlyZWJhc2VBcHAgfSBmcm9tICcuL3B1YmxpYy10eXBlcyc7XG5pbXBvcnQgeyBDb21wb25lbnQsIFByb3ZpZGVyLCBOYW1lIH0gZnJvbSAnQGZpcmViYXNlL2NvbXBvbmVudCc7XG5pbXBvcnQgeyBsb2dnZXIgfSBmcm9tICcuL2xvZ2dlcic7XG5pbXBvcnQgeyBERUZBVUxUX0VOVFJZX05BTUUgfSBmcm9tICcuL2NvbnN0YW50cyc7XG5pbXBvcnQgeyBGaXJlYmFzZUFwcEltcGwgfSBmcm9tICcuL2ZpcmViYXNlQXBwJztcblxuLyoqXG4gKiBAaW50ZXJuYWxcbiAqL1xuZXhwb3J0IGNvbnN0IF9hcHBzID0gbmV3IE1hcDxzdHJpbmcsIEZpcmViYXNlQXBwPigpO1xuXG4vKipcbiAqIFJlZ2lzdGVyZWQgY29tcG9uZW50cy5cbiAqXG4gKiBAaW50ZXJuYWxcbiAqL1xuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbmV4cG9ydCBjb25zdCBfY29tcG9uZW50cyA9IG5ldyBNYXA8c3RyaW5nLCBDb21wb25lbnQ8YW55Pj4oKTtcblxuLyoqXG4gKiBAcGFyYW0gY29tcG9uZW50IC0gdGhlIGNvbXBvbmVudCBiZWluZyBhZGRlZCB0byB0aGlzIGFwcCdzIGNvbnRhaW5lclxuICpcbiAqIEBpbnRlcm5hbFxuICovXG5leHBvcnQgZnVuY3Rpb24gX2FkZENvbXBvbmVudDxUIGV4dGVuZHMgTmFtZT4oXG4gIGFwcDogRmlyZWJhc2VBcHAsXG4gIGNvbXBvbmVudDogQ29tcG9uZW50PFQ+XG4pOiB2b2lkIHtcbiAgdHJ5IHtcbiAgICAoYXBwIGFzIEZpcmViYXNlQXBwSW1wbCkuY29udGFpbmVyLmFkZENvbXBvbmVudChjb21wb25lbnQpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgbG9nZ2VyLmRlYnVnKFxuICAgICAgYENvbXBvbmVudCAke2NvbXBvbmVudC5uYW1lfSBmYWlsZWQgdG8gcmVnaXN0ZXIgd2l0aCBGaXJlYmFzZUFwcCAke2FwcC5uYW1lfWAsXG4gICAgICBlXG4gICAgKTtcbiAgfVxufVxuXG4vKipcbiAqXG4gKiBAaW50ZXJuYWxcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIF9hZGRPck92ZXJ3cml0ZUNvbXBvbmVudChcbiAgYXBwOiBGaXJlYmFzZUFwcCxcbiAgY29tcG9uZW50OiBDb21wb25lbnRcbik6IHZvaWQge1xuICAoYXBwIGFzIEZpcmViYXNlQXBwSW1wbCkuY29udGFpbmVyLmFkZE9yT3ZlcndyaXRlQ29tcG9uZW50KGNvbXBvbmVudCk7XG59XG5cbi8qKlxuICpcbiAqIEBwYXJhbSBjb21wb25lbnQgLSB0aGUgY29tcG9uZW50IHRvIHJlZ2lzdGVyXG4gKiBAcmV0dXJucyB3aGV0aGVyIG9yIG5vdCB0aGUgY29tcG9uZW50IGlzIHJlZ2lzdGVyZWQgc3VjY2Vzc2Z1bGx5XG4gKlxuICogQGludGVybmFsXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBfcmVnaXN0ZXJDb21wb25lbnQ8VCBleHRlbmRzIE5hbWU+KFxuICBjb21wb25lbnQ6IENvbXBvbmVudDxUPlxuKTogYm9vbGVhbiB7XG4gIGNvbnN0IGNvbXBvbmVudE5hbWUgPSBjb21wb25lbnQubmFtZTtcbiAgaWYgKF9jb21wb25lbnRzLmhhcyhjb21wb25lbnROYW1lKSkge1xuICAgIGxvZ2dlci5kZWJ1ZyhcbiAgICAgIGBUaGVyZSB3ZXJlIG11bHRpcGxlIGF0dGVtcHRzIHRvIHJlZ2lzdGVyIGNvbXBvbmVudCAke2NvbXBvbmVudE5hbWV9LmBcbiAgICApO1xuXG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgX2NvbXBvbmVudHMuc2V0KGNvbXBvbmVudE5hbWUsIGNvbXBvbmVudCk7XG5cbiAgLy8gYWRkIHRoZSBjb21wb25lbnQgdG8gZXhpc3RpbmcgYXBwIGluc3RhbmNlc1xuICBmb3IgKGNvbnN0IGFwcCBvZiBfYXBwcy52YWx1ZXMoKSkge1xuICAgIF9hZGRDb21wb25lbnQoYXBwIGFzIEZpcmViYXNlQXBwSW1wbCwgY29tcG9uZW50KTtcbiAgfVxuXG4gIHJldHVybiB0cnVlO1xufVxuXG4vKipcbiAqXG4gKiBAcGFyYW0gYXBwIC0gRmlyZWJhc2VBcHAgaW5zdGFuY2VcbiAqIEBwYXJhbSBuYW1lIC0gc2VydmljZSBuYW1lXG4gKlxuICogQHJldHVybnMgdGhlIHByb3ZpZGVyIGZvciB0aGUgc2VydmljZSB3aXRoIHRoZSBtYXRjaGluZyBuYW1lXG4gKlxuICogQGludGVybmFsXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBfZ2V0UHJvdmlkZXI8VCBleHRlbmRzIE5hbWU+KFxuICBhcHA6IEZpcmViYXNlQXBwLFxuICBuYW1lOiBUXG4pOiBQcm92aWRlcjxUPiB7XG4gIGNvbnN0IGhlYXJ0YmVhdENvbnRyb2xsZXIgPSAoYXBwIGFzIEZpcmViYXNlQXBwSW1wbCkuY29udGFpbmVyXG4gICAgLmdldFByb3ZpZGVyKCdoZWFydGJlYXQnKVxuICAgIC5nZXRJbW1lZGlhdGUoeyBvcHRpb25hbDogdHJ1ZSB9KTtcbiAgaWYgKGhlYXJ0YmVhdENvbnRyb2xsZXIpIHtcbiAgICB2b2lkIGhlYXJ0YmVhdENvbnRyb2xsZXIudHJpZ2dlckhlYXJ0YmVhdCgpO1xuICB9XG4gIHJldHVybiAoYXBwIGFzIEZpcmViYXNlQXBwSW1wbCkuY29udGFpbmVyLmdldFByb3ZpZGVyKG5hbWUpO1xufVxuXG4vKipcbiAqXG4gKiBAcGFyYW0gYXBwIC0gRmlyZWJhc2VBcHAgaW5zdGFuY2VcbiAqIEBwYXJhbSBuYW1lIC0gc2VydmljZSBuYW1lXG4gKiBAcGFyYW0gaW5zdGFuY2VJZGVudGlmaWVyIC0gc2VydmljZSBpbnN0YW5jZSBpZGVudGlmaWVyIGluIGNhc2UgdGhlIHNlcnZpY2Ugc3VwcG9ydHMgbXVsdGlwbGUgaW5zdGFuY2VzXG4gKlxuICogQGludGVybmFsXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBfcmVtb3ZlU2VydmljZUluc3RhbmNlPFQgZXh0ZW5kcyBOYW1lPihcbiAgYXBwOiBGaXJlYmFzZUFwcCxcbiAgbmFtZTogVCxcbiAgaW5zdGFuY2VJZGVudGlmaWVyOiBzdHJpbmcgPSBERUZBVUxUX0VOVFJZX05BTUVcbik6IHZvaWQge1xuICBfZ2V0UHJvdmlkZXIoYXBwLCBuYW1lKS5jbGVhckluc3RhbmNlKGluc3RhbmNlSWRlbnRpZmllcik7XG59XG5cbi8qKlxuICogVGVzdCBvbmx5XG4gKlxuICogQGludGVybmFsXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBfY2xlYXJDb21wb25lbnRzKCk6IHZvaWQge1xuICBfY29tcG9uZW50cy5jbGVhcigpO1xufVxuXG4vKipcbiAqIEV4cG9ydGVkIGluIG9yZGVyIHRvIGJlIHVzZWQgaW4gYXBwLWNvbXBhdCBwYWNrYWdlXG4gKi9cbmV4cG9ydCB7IERFRkFVTFRfRU5UUllfTkFNRSBhcyBfREVGQVVMVF9FTlRSWV9OQU1FIH07XG4iLCAiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHsgRXJyb3JGYWN0b3J5LCBFcnJvck1hcCB9IGZyb20gJ0BmaXJlYmFzZS91dGlsJztcblxuZXhwb3J0IGNvbnN0IGVudW0gQXBwRXJyb3Ige1xuICBOT19BUFAgPSAnbm8tYXBwJyxcbiAgQkFEX0FQUF9OQU1FID0gJ2JhZC1hcHAtbmFtZScsXG4gIERVUExJQ0FURV9BUFAgPSAnZHVwbGljYXRlLWFwcCcsXG4gIEFQUF9ERUxFVEVEID0gJ2FwcC1kZWxldGVkJyxcbiAgSU5WQUxJRF9BUFBfQVJHVU1FTlQgPSAnaW52YWxpZC1hcHAtYXJndW1lbnQnLFxuICBJTlZBTElEX0xPR19BUkdVTUVOVCA9ICdpbnZhbGlkLWxvZy1hcmd1bWVudCcsXG4gIFNUT1JBR0VfT1BFTiA9ICdzdG9yYWdlLW9wZW4nLFxuICBTVE9SQUdFX0dFVCA9ICdzdG9yYWdlLWdldCcsXG4gIFNUT1JBR0VfV1JJVEUgPSAnc3RvcmFnZS1zZXQnLFxuICBTVE9SQUdFX0RFTEVURSA9ICdzdG9yYWdlLWRlbGV0ZSdcbn1cblxuY29uc3QgRVJST1JTOiBFcnJvck1hcDxBcHBFcnJvcj4gPSB7XG4gIFtBcHBFcnJvci5OT19BUFBdOlxuICAgIFwiTm8gRmlyZWJhc2UgQXBwICd7JGFwcE5hbWV9JyBoYXMgYmVlbiBjcmVhdGVkIC0gXCIgK1xuICAgICdjYWxsIEZpcmViYXNlIEFwcC5pbml0aWFsaXplQXBwKCknLFxuICBbQXBwRXJyb3IuQkFEX0FQUF9OQU1FXTogXCJJbGxlZ2FsIEFwcCBuYW1lOiAneyRhcHBOYW1lfVwiLFxuICBbQXBwRXJyb3IuRFVQTElDQVRFX0FQUF06XG4gICAgXCJGaXJlYmFzZSBBcHAgbmFtZWQgJ3skYXBwTmFtZX0nIGFscmVhZHkgZXhpc3RzIHdpdGggZGlmZmVyZW50IG9wdGlvbnMgb3IgY29uZmlnXCIsXG4gIFtBcHBFcnJvci5BUFBfREVMRVRFRF06IFwiRmlyZWJhc2UgQXBwIG5hbWVkICd7JGFwcE5hbWV9JyBhbHJlYWR5IGRlbGV0ZWRcIixcbiAgW0FwcEVycm9yLklOVkFMSURfQVBQX0FSR1VNRU5UXTpcbiAgICAnZmlyZWJhc2UueyRhcHBOYW1lfSgpIHRha2VzIGVpdGhlciBubyBhcmd1bWVudCBvciBhICcgK1xuICAgICdGaXJlYmFzZSBBcHAgaW5zdGFuY2UuJyxcbiAgW0FwcEVycm9yLklOVkFMSURfTE9HX0FSR1VNRU5UXTpcbiAgICAnRmlyc3QgYXJndW1lbnQgdG8gYG9uTG9nYCBtdXN0IGJlIG51bGwgb3IgYSBmdW5jdGlvbi4nLFxuICBbQXBwRXJyb3IuU1RPUkFHRV9PUEVOXTpcbiAgICAnRXJyb3IgdGhyb3duIHdoZW4gb3BlbmluZyBzdG9yYWdlLiBPcmlnaW5hbCBlcnJvcjogeyRvcmlnaW5hbEVycm9yTWVzc2FnZX0uJyxcbiAgW0FwcEVycm9yLlNUT1JBR0VfR0VUXTpcbiAgICAnRXJyb3IgdGhyb3duIHdoZW4gcmVhZGluZyBmcm9tIHN0b3JhZ2UuIE9yaWdpbmFsIGVycm9yOiB7JG9yaWdpbmFsRXJyb3JNZXNzYWdlfS4nLFxuICBbQXBwRXJyb3IuU1RPUkFHRV9XUklURV06XG4gICAgJ0Vycm9yIHRocm93biB3aGVuIHdyaXRpbmcgdG8gc3RvcmFnZS4gT3JpZ2luYWwgZXJyb3I6IHskb3JpZ2luYWxFcnJvck1lc3NhZ2V9LicsXG4gIFtBcHBFcnJvci5TVE9SQUdFX0RFTEVURV06XG4gICAgJ0Vycm9yIHRocm93biB3aGVuIGRlbGV0aW5nIGZyb20gc3RvcmFnZS4gT3JpZ2luYWwgZXJyb3I6IHskb3JpZ2luYWxFcnJvck1lc3NhZ2V9Lidcbn07XG5cbmludGVyZmFjZSBFcnJvclBhcmFtcyB7XG4gIFtBcHBFcnJvci5OT19BUFBdOiB7IGFwcE5hbWU6IHN0cmluZyB9O1xuICBbQXBwRXJyb3IuQkFEX0FQUF9OQU1FXTogeyBhcHBOYW1lOiBzdHJpbmcgfTtcbiAgW0FwcEVycm9yLkRVUExJQ0FURV9BUFBdOiB7IGFwcE5hbWU6IHN0cmluZyB9O1xuICBbQXBwRXJyb3IuQVBQX0RFTEVURURdOiB7IGFwcE5hbWU6IHN0cmluZyB9O1xuICBbQXBwRXJyb3IuSU5WQUxJRF9BUFBfQVJHVU1FTlRdOiB7IGFwcE5hbWU6IHN0cmluZyB9O1xuICBbQXBwRXJyb3IuU1RPUkFHRV9PUEVOXTogeyBvcmlnaW5hbEVycm9yTWVzc2FnZT86IHN0cmluZyB9O1xuICBbQXBwRXJyb3IuU1RPUkFHRV9HRVRdOiB7IG9yaWdpbmFsRXJyb3JNZXNzYWdlPzogc3RyaW5nIH07XG4gIFtBcHBFcnJvci5TVE9SQUdFX1dSSVRFXTogeyBvcmlnaW5hbEVycm9yTWVzc2FnZT86IHN0cmluZyB9O1xuICBbQXBwRXJyb3IuU1RPUkFHRV9ERUxFVEVdOiB7IG9yaWdpbmFsRXJyb3JNZXNzYWdlPzogc3RyaW5nIH07XG59XG5cbmV4cG9ydCBjb25zdCBFUlJPUl9GQUNUT1JZID0gbmV3IEVycm9yRmFjdG9yeTxBcHBFcnJvciwgRXJyb3JQYXJhbXM+KFxuICAnYXBwJyxcbiAgJ0ZpcmViYXNlJyxcbiAgRVJST1JTXG4pO1xuIiwgIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7XG4gIEZpcmViYXNlQXBwLFxuICBGaXJlYmFzZU9wdGlvbnMsXG4gIEZpcmViYXNlQXBwU2V0dGluZ3Ncbn0gZnJvbSAnLi9wdWJsaWMtdHlwZXMnO1xuaW1wb3J0IHtcbiAgQ29tcG9uZW50Q29udGFpbmVyLFxuICBDb21wb25lbnQsXG4gIENvbXBvbmVudFR5cGVcbn0gZnJvbSAnQGZpcmViYXNlL2NvbXBvbmVudCc7XG5pbXBvcnQgeyBFUlJPUl9GQUNUT1JZLCBBcHBFcnJvciB9IGZyb20gJy4vZXJyb3JzJztcblxuZXhwb3J0IGNsYXNzIEZpcmViYXNlQXBwSW1wbCBpbXBsZW1lbnRzIEZpcmViYXNlQXBwIHtcbiAgcHJpdmF0ZSByZWFkb25seSBfb3B0aW9uczogRmlyZWJhc2VPcHRpb25zO1xuICBwcml2YXRlIHJlYWRvbmx5IF9uYW1lOiBzdHJpbmc7XG4gIC8qKlxuICAgKiBPcmlnaW5hbCBjb25maWcgdmFsdWVzIHBhc3NlZCBpbiBhcyBhIGNvbnN0cnVjdG9yIHBhcmFtZXRlci5cbiAgICogSXQgaXMgb25seSB1c2VkIHRvIGNvbXBhcmUgd2l0aCBhbm90aGVyIGNvbmZpZyBvYmplY3QgdG8gc3VwcG9ydCBpZGVtcG90ZW50IGluaXRpYWxpemVBcHAoKS5cbiAgICpcbiAgICogVXBkYXRpbmcgYXV0b21hdGljRGF0YUNvbGxlY3Rpb25FbmFibGVkIG9uIHRoZSBBcHAgaW5zdGFuY2Ugd2lsbCBub3QgY2hhbmdlIGl0cyB2YWx1ZSBpbiBfY29uZmlnLlxuICAgKi9cbiAgcHJpdmF0ZSByZWFkb25seSBfY29uZmlnOiBSZXF1aXJlZDxGaXJlYmFzZUFwcFNldHRpbmdzPjtcbiAgcHJpdmF0ZSBfYXV0b21hdGljRGF0YUNvbGxlY3Rpb25FbmFibGVkOiBib29sZWFuO1xuICBwcml2YXRlIF9pc0RlbGV0ZWQgPSBmYWxzZTtcbiAgcHJpdmF0ZSByZWFkb25seSBfY29udGFpbmVyOiBDb21wb25lbnRDb250YWluZXI7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgb3B0aW9uczogRmlyZWJhc2VPcHRpb25zLFxuICAgIGNvbmZpZzogUmVxdWlyZWQ8RmlyZWJhc2VBcHBTZXR0aW5ncz4sXG4gICAgY29udGFpbmVyOiBDb21wb25lbnRDb250YWluZXJcbiAgKSB7XG4gICAgdGhpcy5fb3B0aW9ucyA9IHsgLi4ub3B0aW9ucyB9O1xuICAgIHRoaXMuX2NvbmZpZyA9IHsgLi4uY29uZmlnIH07XG4gICAgdGhpcy5fbmFtZSA9IGNvbmZpZy5uYW1lO1xuICAgIHRoaXMuX2F1dG9tYXRpY0RhdGFDb2xsZWN0aW9uRW5hYmxlZCA9XG4gICAgICBjb25maWcuYXV0b21hdGljRGF0YUNvbGxlY3Rpb25FbmFibGVkO1xuICAgIHRoaXMuX2NvbnRhaW5lciA9IGNvbnRhaW5lcjtcbiAgICB0aGlzLmNvbnRhaW5lci5hZGRDb21wb25lbnQoXG4gICAgICBuZXcgQ29tcG9uZW50KCdhcHAnLCAoKSA9PiB0aGlzLCBDb21wb25lbnRUeXBlLlBVQkxJQylcbiAgICApO1xuICB9XG5cbiAgZ2V0IGF1dG9tYXRpY0RhdGFDb2xsZWN0aW9uRW5hYmxlZCgpOiBib29sZWFuIHtcbiAgICB0aGlzLmNoZWNrRGVzdHJveWVkKCk7XG4gICAgcmV0dXJuIHRoaXMuX2F1dG9tYXRpY0RhdGFDb2xsZWN0aW9uRW5hYmxlZDtcbiAgfVxuXG4gIHNldCBhdXRvbWF0aWNEYXRhQ29sbGVjdGlvbkVuYWJsZWQodmFsOiBib29sZWFuKSB7XG4gICAgdGhpcy5jaGVja0Rlc3Ryb3llZCgpO1xuICAgIHRoaXMuX2F1dG9tYXRpY0RhdGFDb2xsZWN0aW9uRW5hYmxlZCA9IHZhbDtcbiAgfVxuXG4gIGdldCBuYW1lKCk6IHN0cmluZyB7XG4gICAgdGhpcy5jaGVja0Rlc3Ryb3llZCgpO1xuICAgIHJldHVybiB0aGlzLl9uYW1lO1xuICB9XG5cbiAgZ2V0IG9wdGlvbnMoKTogRmlyZWJhc2VPcHRpb25zIHtcbiAgICB0aGlzLmNoZWNrRGVzdHJveWVkKCk7XG4gICAgcmV0dXJuIHRoaXMuX29wdGlvbnM7XG4gIH1cblxuICBnZXQgY29uZmlnKCk6IFJlcXVpcmVkPEZpcmViYXNlQXBwU2V0dGluZ3M+IHtcbiAgICB0aGlzLmNoZWNrRGVzdHJveWVkKCk7XG4gICAgcmV0dXJuIHRoaXMuX2NvbmZpZztcbiAgfVxuXG4gIGdldCBjb250YWluZXIoKTogQ29tcG9uZW50Q29udGFpbmVyIHtcbiAgICByZXR1cm4gdGhpcy5fY29udGFpbmVyO1xuICB9XG5cbiAgZ2V0IGlzRGVsZXRlZCgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5faXNEZWxldGVkO1xuICB9XG5cbiAgc2V0IGlzRGVsZXRlZCh2YWw6IGJvb2xlYW4pIHtcbiAgICB0aGlzLl9pc0RlbGV0ZWQgPSB2YWw7XG4gIH1cblxuICAvKipcbiAgICogVGhpcyBmdW5jdGlvbiB3aWxsIHRocm93IGFuIEVycm9yIGlmIHRoZSBBcHAgaGFzIGFscmVhZHkgYmVlbiBkZWxldGVkIC1cbiAgICogdXNlIGJlZm9yZSBwZXJmb3JtaW5nIEFQSSBhY3Rpb25zIG9uIHRoZSBBcHAuXG4gICAqL1xuICBwcml2YXRlIGNoZWNrRGVzdHJveWVkKCk6IHZvaWQge1xuICAgIGlmICh0aGlzLmlzRGVsZXRlZCkge1xuICAgICAgdGhyb3cgRVJST1JfRkFDVE9SWS5jcmVhdGUoQXBwRXJyb3IuQVBQX0RFTEVURUQsIHsgYXBwTmFtZTogdGhpcy5fbmFtZSB9KTtcbiAgICB9XG4gIH1cbn1cbiIsICIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQge1xuICBGaXJlYmFzZUFwcCxcbiAgRmlyZWJhc2VPcHRpb25zLFxuICBGaXJlYmFzZUFwcFNldHRpbmdzXG59IGZyb20gJy4vcHVibGljLXR5cGVzJztcbmltcG9ydCB7IERFRkFVTFRfRU5UUllfTkFNRSwgUExBVEZPUk1fTE9HX1NUUklORyB9IGZyb20gJy4vY29uc3RhbnRzJztcbmltcG9ydCB7IEVSUk9SX0ZBQ1RPUlksIEFwcEVycm9yIH0gZnJvbSAnLi9lcnJvcnMnO1xuaW1wb3J0IHtcbiAgQ29tcG9uZW50Q29udGFpbmVyLFxuICBDb21wb25lbnQsXG4gIE5hbWUsXG4gIENvbXBvbmVudFR5cGVcbn0gZnJvbSAnQGZpcmViYXNlL2NvbXBvbmVudCc7XG5pbXBvcnQgeyB2ZXJzaW9uIH0gZnJvbSAnLi4vLi4vZmlyZWJhc2UvcGFja2FnZS5qc29uJztcbmltcG9ydCB7IEZpcmViYXNlQXBwSW1wbCB9IGZyb20gJy4vZmlyZWJhc2VBcHAnO1xuaW1wb3J0IHsgX2FwcHMsIF9jb21wb25lbnRzLCBfcmVnaXN0ZXJDb21wb25lbnQgfSBmcm9tICcuL2ludGVybmFsJztcbmltcG9ydCB7IGxvZ2dlciB9IGZyb20gJy4vbG9nZ2VyJztcbmltcG9ydCB7XG4gIExvZ0xldmVsU3RyaW5nLFxuICBzZXRMb2dMZXZlbCBhcyBzZXRMb2dMZXZlbEltcGwsXG4gIExvZ0NhbGxiYWNrLFxuICBMb2dPcHRpb25zLFxuICBzZXRVc2VyTG9nSGFuZGxlclxufSBmcm9tICdAZmlyZWJhc2UvbG9nZ2VyJztcbmltcG9ydCB7IGRlZXBFcXVhbCB9IGZyb20gJ0BmaXJlYmFzZS91dGlsJztcblxuZXhwb3J0IHsgRmlyZWJhc2VFcnJvciB9IGZyb20gJ0BmaXJlYmFzZS91dGlsJztcblxuLyoqXG4gKiBUaGUgY3VycmVudCBTREsgdmVyc2lvbi5cbiAqXG4gKiBAcHVibGljXG4gKi9cbmV4cG9ydCBjb25zdCBTREtfVkVSU0lPTiA9IHZlcnNpb247XG5cbi8qKlxuICogQ3JlYXRlcyBhbmQgaW5pdGlhbGl6ZXMgYSB7QGxpbmsgQGZpcmViYXNlL2FwcCNGaXJlYmFzZUFwcH0gaW5zdGFuY2UuXG4gKlxuICogU2VlXG4gKiB7QGxpbmtcbiAqICAgaHR0cHM6Ly9maXJlYmFzZS5nb29nbGUuY29tL2RvY3Mvd2ViL3NldHVwI2FkZF9maXJlYmFzZV90b195b3VyX2FwcFxuICogICB8IEFkZCBGaXJlYmFzZSB0byB5b3VyIGFwcH0gYW5kXG4gKiB7QGxpbmtcbiAqICAgaHR0cHM6Ly9maXJlYmFzZS5nb29nbGUuY29tL2RvY3Mvd2ViL3NldHVwI211bHRpcGxlLXByb2plY3RzXG4gKiAgIHwgSW5pdGlhbGl6ZSBtdWx0aXBsZSBwcm9qZWN0c30gZm9yIGRldGFpbGVkIGRvY3VtZW50YXRpb24uXG4gKlxuICogQGV4YW1wbGVcbiAqIGBgYGphdmFzY3JpcHRcbiAqXG4gKiAvLyBJbml0aWFsaXplIGRlZmF1bHQgYXBwXG4gKiAvLyBSZXRyaWV2ZSB5b3VyIG93biBvcHRpb25zIHZhbHVlcyBieSBhZGRpbmcgYSB3ZWIgYXBwIG9uXG4gKiAvLyBodHRwczovL2NvbnNvbGUuZmlyZWJhc2UuZ29vZ2xlLmNvbVxuICogaW5pdGlhbGl6ZUFwcCh7XG4gKiAgIGFwaUtleTogXCJBSXphLi4uLlwiLCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQXV0aCAvIEdlbmVyYWwgVXNlXG4gKiAgIGF1dGhEb21haW46IFwiWU9VUl9BUFAuZmlyZWJhc2VhcHAuY29tXCIsICAgICAgICAgLy8gQXV0aCB3aXRoIHBvcHVwL3JlZGlyZWN0XG4gKiAgIGRhdGFiYXNlVVJMOiBcImh0dHBzOi8vWU9VUl9BUFAuZmlyZWJhc2Vpby5jb21cIiwgLy8gUmVhbHRpbWUgRGF0YWJhc2VcbiAqICAgc3RvcmFnZUJ1Y2tldDogXCJZT1VSX0FQUC5hcHBzcG90LmNvbVwiLCAgICAgICAgICAvLyBTdG9yYWdlXG4gKiAgIG1lc3NhZ2luZ1NlbmRlcklkOiBcIjEyMzQ1Njc4OVwiICAgICAgICAgICAgICAgICAgLy8gQ2xvdWQgTWVzc2FnaW5nXG4gKiB9KTtcbiAqIGBgYFxuICpcbiAqIEBleGFtcGxlXG4gKiBgYGBqYXZhc2NyaXB0XG4gKlxuICogLy8gSW5pdGlhbGl6ZSBhbm90aGVyIGFwcFxuICogY29uc3Qgb3RoZXJBcHAgPSBpbml0aWFsaXplQXBwKHtcbiAqICAgZGF0YWJhc2VVUkw6IFwiaHR0cHM6Ly88T1RIRVJfREFUQUJBU0VfTkFNRT4uZmlyZWJhc2Vpby5jb21cIixcbiAqICAgc3RvcmFnZUJ1Y2tldDogXCI8T1RIRVJfU1RPUkFHRV9CVUNLRVQ+LmFwcHNwb3QuY29tXCJcbiAqIH0sIFwib3RoZXJBcHBcIik7XG4gKiBgYGBcbiAqXG4gKiBAcGFyYW0gb3B0aW9ucyAtIE9wdGlvbnMgdG8gY29uZmlndXJlIHRoZSBhcHAncyBzZXJ2aWNlcy5cbiAqIEBwYXJhbSBuYW1lIC0gT3B0aW9uYWwgbmFtZSBvZiB0aGUgYXBwIHRvIGluaXRpYWxpemUuIElmIG5vIG5hbWVcbiAqICAgaXMgcHJvdmlkZWQsIHRoZSBkZWZhdWx0IGlzIGBcIltERUZBVUxUXVwiYC5cbiAqXG4gKiBAcmV0dXJucyBUaGUgaW5pdGlhbGl6ZWQgYXBwLlxuICpcbiAqIEBwdWJsaWNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGluaXRpYWxpemVBcHAoXG4gIG9wdGlvbnM6IEZpcmViYXNlT3B0aW9ucyxcbiAgbmFtZT86IHN0cmluZ1xuKTogRmlyZWJhc2VBcHA7XG4vKipcbiAqIENyZWF0ZXMgYW5kIGluaXRpYWxpemVzIGEgRmlyZWJhc2VBcHAgaW5zdGFuY2UuXG4gKlxuICogQHBhcmFtIG9wdGlvbnMgLSBPcHRpb25zIHRvIGNvbmZpZ3VyZSB0aGUgYXBwJ3Mgc2VydmljZXMuXG4gKiBAcGFyYW0gY29uZmlnIC0gRmlyZWJhc2VBcHAgQ29uZmlndXJhdGlvblxuICpcbiAqIEBwdWJsaWNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGluaXRpYWxpemVBcHAoXG4gIG9wdGlvbnM6IEZpcmViYXNlT3B0aW9ucyxcbiAgY29uZmlnPzogRmlyZWJhc2VBcHBTZXR0aW5nc1xuKTogRmlyZWJhc2VBcHA7XG5leHBvcnQgZnVuY3Rpb24gaW5pdGlhbGl6ZUFwcChcbiAgb3B0aW9uczogRmlyZWJhc2VPcHRpb25zLFxuICByYXdDb25maWcgPSB7fVxuKTogRmlyZWJhc2VBcHAge1xuICBpZiAodHlwZW9mIHJhd0NvbmZpZyAhPT0gJ29iamVjdCcpIHtcbiAgICBjb25zdCBuYW1lID0gcmF3Q29uZmlnO1xuICAgIHJhd0NvbmZpZyA9IHsgbmFtZSB9O1xuICB9XG5cbiAgY29uc3QgY29uZmlnOiBSZXF1aXJlZDxGaXJlYmFzZUFwcFNldHRpbmdzPiA9IHtcbiAgICBuYW1lOiBERUZBVUxUX0VOVFJZX05BTUUsXG4gICAgYXV0b21hdGljRGF0YUNvbGxlY3Rpb25FbmFibGVkOiBmYWxzZSxcbiAgICAuLi5yYXdDb25maWdcbiAgfTtcbiAgY29uc3QgbmFtZSA9IGNvbmZpZy5uYW1lO1xuXG4gIGlmICh0eXBlb2YgbmFtZSAhPT0gJ3N0cmluZycgfHwgIW5hbWUpIHtcbiAgICB0aHJvdyBFUlJPUl9GQUNUT1JZLmNyZWF0ZShBcHBFcnJvci5CQURfQVBQX05BTUUsIHtcbiAgICAgIGFwcE5hbWU6IFN0cmluZyhuYW1lKVxuICAgIH0pO1xuICB9XG5cbiAgY29uc3QgZXhpc3RpbmdBcHAgPSBfYXBwcy5nZXQobmFtZSkgYXMgRmlyZWJhc2VBcHBJbXBsO1xuICBpZiAoZXhpc3RpbmdBcHApIHtcbiAgICAvLyByZXR1cm4gdGhlIGV4aXN0aW5nIGFwcCBpZiBvcHRpb25zIGFuZCBjb25maWcgZGVlcCBlcXVhbCB0aGUgb25lcyBpbiB0aGUgZXhpc3RpbmcgYXBwLlxuICAgIGlmIChcbiAgICAgIGRlZXBFcXVhbChvcHRpb25zLCBleGlzdGluZ0FwcC5vcHRpb25zKSAmJlxuICAgICAgZGVlcEVxdWFsKGNvbmZpZywgZXhpc3RpbmdBcHAuY29uZmlnKVxuICAgICkge1xuICAgICAgcmV0dXJuIGV4aXN0aW5nQXBwO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBFUlJPUl9GQUNUT1JZLmNyZWF0ZShBcHBFcnJvci5EVVBMSUNBVEVfQVBQLCB7IGFwcE5hbWU6IG5hbWUgfSk7XG4gICAgfVxuICB9XG5cbiAgY29uc3QgY29udGFpbmVyID0gbmV3IENvbXBvbmVudENvbnRhaW5lcihuYW1lKTtcbiAgZm9yIChjb25zdCBjb21wb25lbnQgb2YgX2NvbXBvbmVudHMudmFsdWVzKCkpIHtcbiAgICBjb250YWluZXIuYWRkQ29tcG9uZW50KGNvbXBvbmVudCk7XG4gIH1cblxuICBjb25zdCBuZXdBcHAgPSBuZXcgRmlyZWJhc2VBcHBJbXBsKG9wdGlvbnMsIGNvbmZpZywgY29udGFpbmVyKTtcblxuICBfYXBwcy5zZXQobmFtZSwgbmV3QXBwKTtcblxuICByZXR1cm4gbmV3QXBwO1xufVxuXG4vKipcbiAqIFJldHJpZXZlcyBhIHtAbGluayBAZmlyZWJhc2UvYXBwI0ZpcmViYXNlQXBwfSBpbnN0YW5jZS5cbiAqXG4gKiBXaGVuIGNhbGxlZCB3aXRoIG5vIGFyZ3VtZW50cywgdGhlIGRlZmF1bHQgYXBwIGlzIHJldHVybmVkLiBXaGVuIGFuIGFwcCBuYW1lXG4gKiBpcyBwcm92aWRlZCwgdGhlIGFwcCBjb3JyZXNwb25kaW5nIHRvIHRoYXQgbmFtZSBpcyByZXR1cm5lZC5cbiAqXG4gKiBBbiBleGNlcHRpb24gaXMgdGhyb3duIGlmIHRoZSBhcHAgYmVpbmcgcmV0cmlldmVkIGhhcyBub3QgeWV0IGJlZW5cbiAqIGluaXRpYWxpemVkLlxuICpcbiAqIEBleGFtcGxlXG4gKiBgYGBqYXZhc2NyaXB0XG4gKiAvLyBSZXR1cm4gdGhlIGRlZmF1bHQgYXBwXG4gKiBjb25zdCBhcHAgPSBnZXRBcHAoKTtcbiAqIGBgYFxuICpcbiAqIEBleGFtcGxlXG4gKiBgYGBqYXZhc2NyaXB0XG4gKiAvLyBSZXR1cm4gYSBuYW1lZCBhcHBcbiAqIGNvbnN0IG90aGVyQXBwID0gZ2V0QXBwKFwib3RoZXJBcHBcIik7XG4gKiBgYGBcbiAqXG4gKiBAcGFyYW0gbmFtZSAtIE9wdGlvbmFsIG5hbWUgb2YgdGhlIGFwcCB0byByZXR1cm4uIElmIG5vIG5hbWUgaXNcbiAqICAgcHJvdmlkZWQsIHRoZSBkZWZhdWx0IGlzIGBcIltERUZBVUxUXVwiYC5cbiAqXG4gKiBAcmV0dXJucyBUaGUgYXBwIGNvcnJlc3BvbmRpbmcgdG8gdGhlIHByb3ZpZGVkIGFwcCBuYW1lLlxuICogICBJZiBubyBhcHAgbmFtZSBpcyBwcm92aWRlZCwgdGhlIGRlZmF1bHQgYXBwIGlzIHJldHVybmVkLlxuICpcbiAqIEBwdWJsaWNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldEFwcChuYW1lOiBzdHJpbmcgPSBERUZBVUxUX0VOVFJZX05BTUUpOiBGaXJlYmFzZUFwcCB7XG4gIGNvbnN0IGFwcCA9IF9hcHBzLmdldChuYW1lKTtcbiAgaWYgKCFhcHApIHtcbiAgICB0aHJvdyBFUlJPUl9GQUNUT1JZLmNyZWF0ZShBcHBFcnJvci5OT19BUFAsIHsgYXBwTmFtZTogbmFtZSB9KTtcbiAgfVxuXG4gIHJldHVybiBhcHA7XG59XG5cbi8qKlxuICogQSAocmVhZC1vbmx5KSBhcnJheSBvZiBhbGwgaW5pdGlhbGl6ZWQgYXBwcy5cbiAqIEBwdWJsaWNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldEFwcHMoKTogRmlyZWJhc2VBcHBbXSB7XG4gIHJldHVybiBBcnJheS5mcm9tKF9hcHBzLnZhbHVlcygpKTtcbn1cblxuLyoqXG4gKiBSZW5kZXJzIHRoaXMgYXBwIHVudXNhYmxlIGFuZCBmcmVlcyB0aGUgcmVzb3VyY2VzIG9mIGFsbCBhc3NvY2lhdGVkXG4gKiBzZXJ2aWNlcy5cbiAqXG4gKiBAZXhhbXBsZVxuICogYGBgamF2YXNjcmlwdFxuICogZGVsZXRlQXBwKGFwcClcbiAqICAgLnRoZW4oZnVuY3Rpb24oKSB7XG4gKiAgICAgY29uc29sZS5sb2coXCJBcHAgZGVsZXRlZCBzdWNjZXNzZnVsbHlcIik7XG4gKiAgIH0pXG4gKiAgIC5jYXRjaChmdW5jdGlvbihlcnJvcikge1xuICogICAgIGNvbnNvbGUubG9nKFwiRXJyb3IgZGVsZXRpbmcgYXBwOlwiLCBlcnJvcik7XG4gKiAgIH0pO1xuICogYGBgXG4gKlxuICogQHB1YmxpY1xuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZGVsZXRlQXBwKGFwcDogRmlyZWJhc2VBcHApOiBQcm9taXNlPHZvaWQ+IHtcbiAgY29uc3QgbmFtZSA9IGFwcC5uYW1lO1xuICBpZiAoX2FwcHMuaGFzKG5hbWUpKSB7XG4gICAgX2FwcHMuZGVsZXRlKG5hbWUpO1xuICAgIGF3YWl0IFByb21pc2UuYWxsKFxuICAgICAgKGFwcCBhcyBGaXJlYmFzZUFwcEltcGwpLmNvbnRhaW5lclxuICAgICAgICAuZ2V0UHJvdmlkZXJzKClcbiAgICAgICAgLm1hcChwcm92aWRlciA9PiBwcm92aWRlci5kZWxldGUoKSlcbiAgICApO1xuICAgIChhcHAgYXMgRmlyZWJhc2VBcHBJbXBsKS5pc0RlbGV0ZWQgPSB0cnVlO1xuICB9XG59XG5cbi8qKlxuICogUmVnaXN0ZXJzIGEgbGlicmFyeSdzIG5hbWUgYW5kIHZlcnNpb24gZm9yIHBsYXRmb3JtIGxvZ2dpbmcgcHVycG9zZXMuXG4gKiBAcGFyYW0gbGlicmFyeSAtIE5hbWUgb2YgMXAgb3IgM3AgbGlicmFyeSAoZS5nLiBmaXJlc3RvcmUsIGFuZ3VsYXJmaXJlKVxuICogQHBhcmFtIHZlcnNpb24gLSBDdXJyZW50IHZlcnNpb24gb2YgdGhhdCBsaWJyYXJ5LlxuICogQHBhcmFtIHZhcmlhbnQgLSBCdW5kbGUgdmFyaWFudCwgZS5nLiwgbm9kZSwgcm4sIGV0Yy5cbiAqXG4gKiBAcHVibGljXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiByZWdpc3RlclZlcnNpb24oXG4gIGxpYnJhcnlLZXlPck5hbWU6IHN0cmluZyxcbiAgdmVyc2lvbjogc3RyaW5nLFxuICB2YXJpYW50Pzogc3RyaW5nXG4pOiB2b2lkIHtcbiAgLy8gVE9ETzogV2UgY2FuIHVzZSB0aGlzIGNoZWNrIHRvIHdoaXRlbGlzdCBzdHJpbmdzIHdoZW4vaWYgd2Ugc2V0IHVwXG4gIC8vIGEgZ29vZCB3aGl0ZWxpc3Qgc3lzdGVtLlxuICBsZXQgbGlicmFyeSA9IFBMQVRGT1JNX0xPR19TVFJJTkdbbGlicmFyeUtleU9yTmFtZV0gPz8gbGlicmFyeUtleU9yTmFtZTtcbiAgaWYgKHZhcmlhbnQpIHtcbiAgICBsaWJyYXJ5ICs9IGAtJHt2YXJpYW50fWA7XG4gIH1cbiAgY29uc3QgbGlicmFyeU1pc21hdGNoID0gbGlicmFyeS5tYXRjaCgvXFxzfFxcLy8pO1xuICBjb25zdCB2ZXJzaW9uTWlzbWF0Y2ggPSB2ZXJzaW9uLm1hdGNoKC9cXHN8XFwvLyk7XG4gIGlmIChsaWJyYXJ5TWlzbWF0Y2ggfHwgdmVyc2lvbk1pc21hdGNoKSB7XG4gICAgY29uc3Qgd2FybmluZyA9IFtcbiAgICAgIGBVbmFibGUgdG8gcmVnaXN0ZXIgbGlicmFyeSBcIiR7bGlicmFyeX1cIiB3aXRoIHZlcnNpb24gXCIke3ZlcnNpb259XCI6YFxuICAgIF07XG4gICAgaWYgKGxpYnJhcnlNaXNtYXRjaCkge1xuICAgICAgd2FybmluZy5wdXNoKFxuICAgICAgICBgbGlicmFyeSBuYW1lIFwiJHtsaWJyYXJ5fVwiIGNvbnRhaW5zIGlsbGVnYWwgY2hhcmFjdGVycyAod2hpdGVzcGFjZSBvciBcIi9cIilgXG4gICAgICApO1xuICAgIH1cbiAgICBpZiAobGlicmFyeU1pc21hdGNoICYmIHZlcnNpb25NaXNtYXRjaCkge1xuICAgICAgd2FybmluZy5wdXNoKCdhbmQnKTtcbiAgICB9XG4gICAgaWYgKHZlcnNpb25NaXNtYXRjaCkge1xuICAgICAgd2FybmluZy5wdXNoKFxuICAgICAgICBgdmVyc2lvbiBuYW1lIFwiJHt2ZXJzaW9ufVwiIGNvbnRhaW5zIGlsbGVnYWwgY2hhcmFjdGVycyAod2hpdGVzcGFjZSBvciBcIi9cIilgXG4gICAgICApO1xuICAgIH1cbiAgICBsb2dnZXIud2Fybih3YXJuaW5nLmpvaW4oJyAnKSk7XG4gICAgcmV0dXJuO1xuICB9XG4gIF9yZWdpc3RlckNvbXBvbmVudChcbiAgICBuZXcgQ29tcG9uZW50KFxuICAgICAgYCR7bGlicmFyeX0tdmVyc2lvbmAgYXMgTmFtZSxcbiAgICAgICgpID0+ICh7IGxpYnJhcnksIHZlcnNpb24gfSksXG4gICAgICBDb21wb25lbnRUeXBlLlZFUlNJT05cbiAgICApXG4gICk7XG59XG5cbi8qKlxuICogU2V0cyBsb2cgaGFuZGxlciBmb3IgYWxsIEZpcmViYXNlIFNES3MuXG4gKiBAcGFyYW0gbG9nQ2FsbGJhY2sgLSBBbiBvcHRpb25hbCBjdXN0b20gbG9nIGhhbmRsZXIgdGhhdCBleGVjdXRlcyB1c2VyIGNvZGUgd2hlbmV2ZXJcbiAqIHRoZSBGaXJlYmFzZSBTREsgbWFrZXMgYSBsb2dnaW5nIGNhbGwuXG4gKlxuICogQHB1YmxpY1xuICovXG5leHBvcnQgZnVuY3Rpb24gb25Mb2coXG4gIGxvZ0NhbGxiYWNrOiBMb2dDYWxsYmFjayB8IG51bGwsXG4gIG9wdGlvbnM/OiBMb2dPcHRpb25zXG4pOiB2b2lkIHtcbiAgaWYgKGxvZ0NhbGxiYWNrICE9PSBudWxsICYmIHR5cGVvZiBsb2dDYWxsYmFjayAhPT0gJ2Z1bmN0aW9uJykge1xuICAgIHRocm93IEVSUk9SX0ZBQ1RPUlkuY3JlYXRlKEFwcEVycm9yLklOVkFMSURfTE9HX0FSR1VNRU5UKTtcbiAgfVxuICBzZXRVc2VyTG9nSGFuZGxlcihsb2dDYWxsYmFjaywgb3B0aW9ucyk7XG59XG5cbi8qKlxuICogU2V0cyBsb2cgbGV2ZWwgZm9yIGFsbCBGaXJlYmFzZSBTREtzLlxuICpcbiAqIEFsbCBvZiB0aGUgbG9nIHR5cGVzIGFib3ZlIHRoZSBjdXJyZW50IGxvZyBsZXZlbCBhcmUgY2FwdHVyZWQgKGkuZS4gaWZcbiAqIHlvdSBzZXQgdGhlIGxvZyBsZXZlbCB0byBgaW5mb2AsIGVycm9ycyBhcmUgbG9nZ2VkLCBidXQgYGRlYnVnYCBhbmRcbiAqIGB2ZXJib3NlYCBsb2dzIGFyZSBub3QpLlxuICpcbiAqIEBwdWJsaWNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHNldExvZ0xldmVsKGxvZ0xldmVsOiBMb2dMZXZlbFN0cmluZyk6IHZvaWQge1xuICBzZXRMb2dMZXZlbEltcGwobG9nTGV2ZWwpO1xufVxuIiwgIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIxIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7IERCU2NoZW1hLCBvcGVuREIsIElEQlBEYXRhYmFzZSB9IGZyb20gJ2lkYic7XG5pbXBvcnQgeyBBcHBFcnJvciwgRVJST1JfRkFDVE9SWSB9IGZyb20gJy4vZXJyb3JzJztcbmltcG9ydCB7IEZpcmViYXNlQXBwIH0gZnJvbSAnLi9wdWJsaWMtdHlwZXMnO1xuaW1wb3J0IHsgSGVhcnRiZWF0c0luSW5kZXhlZERCIH0gZnJvbSAnLi90eXBlcyc7XG5cbmNvbnN0IERCX05BTUUgPSAnZmlyZWJhc2UtaGVhcnRiZWF0LWRhdGFiYXNlJztcbmNvbnN0IERCX1ZFUlNJT04gPSAxO1xuY29uc3QgU1RPUkVfTkFNRSA9ICdmaXJlYmFzZS1oZWFydGJlYXQtc3RvcmUnO1xuXG5pbnRlcmZhY2UgQXBwREIgZXh0ZW5kcyBEQlNjaGVtYSB7XG4gICdmaXJlYmFzZS1oZWFydGJlYXQtc3RvcmUnOiB7XG4gICAga2V5OiBzdHJpbmc7XG4gICAgdmFsdWU6IEhlYXJ0YmVhdHNJbkluZGV4ZWREQjtcbiAgfTtcbn1cblxubGV0IGRiUHJvbWlzZTogUHJvbWlzZTxJREJQRGF0YWJhc2U8QXBwREI+PiB8IG51bGwgPSBudWxsO1xuZnVuY3Rpb24gZ2V0RGJQcm9taXNlKCk6IFByb21pc2U8SURCUERhdGFiYXNlPEFwcERCPj4ge1xuICBpZiAoIWRiUHJvbWlzZSkge1xuICAgIGRiUHJvbWlzZSA9IG9wZW5EQjxBcHBEQj4oREJfTkFNRSwgREJfVkVSU0lPTiwge1xuICAgICAgdXBncmFkZTogKGRiLCBvbGRWZXJzaW9uKSA9PiB7XG4gICAgICAgIC8vIFdlIGRvbid0IHVzZSAnYnJlYWsnIGluIHRoaXMgc3dpdGNoIHN0YXRlbWVudCwgdGhlIGZhbGwtdGhyb3VnaFxuICAgICAgICAvLyBiZWhhdmlvciBpcyB3aGF0IHdlIHdhbnQsIGJlY2F1c2UgaWYgdGhlcmUgYXJlIG11bHRpcGxlIHZlcnNpb25zIGJldHdlZW5cbiAgICAgICAgLy8gdGhlIG9sZCB2ZXJzaW9uIGFuZCB0aGUgY3VycmVudCB2ZXJzaW9uLCB3ZSB3YW50IEFMTCB0aGUgbWlncmF0aW9uc1xuICAgICAgICAvLyB0aGF0IGNvcnJlc3BvbmQgdG8gdGhvc2UgdmVyc2lvbnMgdG8gcnVuLCBub3Qgb25seSB0aGUgbGFzdCBvbmUuXG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBkZWZhdWx0LWNhc2VcbiAgICAgICAgc3dpdGNoIChvbGRWZXJzaW9uKSB7XG4gICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgZGIuY3JlYXRlT2JqZWN0U3RvcmUoU1RPUkVfTkFNRSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KS5jYXRjaChlID0+IHtcbiAgICAgIHRocm93IEVSUk9SX0ZBQ1RPUlkuY3JlYXRlKEFwcEVycm9yLlNUT1JBR0VfT1BFTiwge1xuICAgICAgICBvcmlnaW5hbEVycm9yTWVzc2FnZTogZS5tZXNzYWdlXG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuICByZXR1cm4gZGJQcm9taXNlO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcmVhZEhlYXJ0YmVhdHNGcm9tSW5kZXhlZERCKFxuICBhcHA6IEZpcmViYXNlQXBwXG4pOiBQcm9taXNlPEhlYXJ0YmVhdHNJbkluZGV4ZWREQiB8IHVuZGVmaW5lZD4ge1xuICB0cnkge1xuICAgIGNvbnN0IGRiID0gYXdhaXQgZ2V0RGJQcm9taXNlKCk7XG4gICAgcmV0dXJuIGRiXG4gICAgICAudHJhbnNhY3Rpb24oU1RPUkVfTkFNRSlcbiAgICAgIC5vYmplY3RTdG9yZShTVE9SRV9OQU1FKVxuICAgICAgLmdldChjb21wdXRlS2V5KGFwcCkpIGFzIFByb21pc2U8SGVhcnRiZWF0c0luSW5kZXhlZERCIHwgdW5kZWZpbmVkPjtcbiAgfSBjYXRjaCAoZSkge1xuICAgIHRocm93IEVSUk9SX0ZBQ1RPUlkuY3JlYXRlKEFwcEVycm9yLlNUT1JBR0VfR0VULCB7XG4gICAgICBvcmlnaW5hbEVycm9yTWVzc2FnZTogZS5tZXNzYWdlXG4gICAgfSk7XG4gIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHdyaXRlSGVhcnRiZWF0c1RvSW5kZXhlZERCKFxuICBhcHA6IEZpcmViYXNlQXBwLFxuICBoZWFydGJlYXRPYmplY3Q6IEhlYXJ0YmVhdHNJbkluZGV4ZWREQlxuKTogUHJvbWlzZTx2b2lkPiB7XG4gIHRyeSB7XG4gICAgY29uc3QgZGIgPSBhd2FpdCBnZXREYlByb21pc2UoKTtcbiAgICBjb25zdCB0eCA9IGRiLnRyYW5zYWN0aW9uKFNUT1JFX05BTUUsICdyZWFkd3JpdGUnKTtcbiAgICBjb25zdCBvYmplY3RTdG9yZSA9IHR4Lm9iamVjdFN0b3JlKFNUT1JFX05BTUUpO1xuICAgIGF3YWl0IG9iamVjdFN0b3JlLnB1dChoZWFydGJlYXRPYmplY3QsIGNvbXB1dGVLZXkoYXBwKSk7XG4gICAgcmV0dXJuIHR4LmRvbmU7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICB0aHJvdyBFUlJPUl9GQUNUT1JZLmNyZWF0ZShBcHBFcnJvci5TVE9SQUdFX1dSSVRFLCB7XG4gICAgICBvcmlnaW5hbEVycm9yTWVzc2FnZTogZS5tZXNzYWdlXG4gICAgfSk7XG4gIH1cbn1cblxuZnVuY3Rpb24gY29tcHV0ZUtleShhcHA6IEZpcmViYXNlQXBwKTogc3RyaW5nIHtcbiAgcmV0dXJuIGAke2FwcC5uYW1lfSEke2FwcC5vcHRpb25zLmFwcElkfWA7XG59XG4iLCAiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjEgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHsgQ29tcG9uZW50Q29udGFpbmVyIH0gZnJvbSAnQGZpcmViYXNlL2NvbXBvbmVudCc7XG5pbXBvcnQge1xuICBiYXNlNjR1cmxFbmNvZGVXaXRob3V0UGFkZGluZyxcbiAgaXNJbmRleGVkREJBdmFpbGFibGUsXG4gIHZhbGlkYXRlSW5kZXhlZERCT3BlbmFibGVcbn0gZnJvbSAnQGZpcmViYXNlL3V0aWwnO1xuaW1wb3J0IHtcbiAgcmVhZEhlYXJ0YmVhdHNGcm9tSW5kZXhlZERCLFxuICB3cml0ZUhlYXJ0YmVhdHNUb0luZGV4ZWREQlxufSBmcm9tICcuL2luZGV4ZWRkYic7XG5pbXBvcnQgeyBGaXJlYmFzZUFwcCB9IGZyb20gJy4vcHVibGljLXR5cGVzJztcbmltcG9ydCB7XG4gIEhlYXJ0YmVhdHNCeVVzZXJBZ2VudCxcbiAgSGVhcnRiZWF0U2VydmljZSxcbiAgSGVhcnRiZWF0c0luSW5kZXhlZERCLFxuICBIZWFydGJlYXRTdG9yYWdlLFxuICBTaW5nbGVEYXRlSGVhcnRiZWF0XG59IGZyb20gJy4vdHlwZXMnO1xuXG5jb25zdCBNQVhfSEVBREVSX0JZVEVTID0gMTAyNDtcbi8vIDMwIGRheXNcbmNvbnN0IFNUT1JFRF9IRUFSVEJFQVRfUkVURU5USU9OX01BWF9NSUxMSVMgPSAzMCAqIDI0ICogNjAgKiA2MCAqIDEwMDA7XG5cbmV4cG9ydCBjbGFzcyBIZWFydGJlYXRTZXJ2aWNlSW1wbCBpbXBsZW1lbnRzIEhlYXJ0YmVhdFNlcnZpY2Uge1xuICAvKipcbiAgICogVGhlIHBlcnNpc3RlbmNlIGxheWVyIGZvciBoZWFydGJlYXRzXG4gICAqIExlYXZlIHB1YmxpYyBmb3IgZWFzaWVyIHRlc3RpbmcuXG4gICAqL1xuICBfc3RvcmFnZTogSGVhcnRiZWF0U3RvcmFnZUltcGw7XG5cbiAgLyoqXG4gICAqIEluLW1lbW9yeSBjYWNoZSBmb3IgaGVhcnRiZWF0cywgdXNlZCBieSBnZXRIZWFydGJlYXRzSGVhZGVyKCkgdG8gZ2VuZXJhdGVcbiAgICogdGhlIGhlYWRlciBzdHJpbmcuXG4gICAqIFN0b3JlcyBvbmUgcmVjb3JkIHBlciBkYXRlLiBUaGlzIHdpbGwgYmUgY29uc29saWRhdGVkIGludG8gdGhlIHN0YW5kYXJkXG4gICAqIGZvcm1hdCBvZiBvbmUgcmVjb3JkIHBlciB1c2VyIGFnZW50IHN0cmluZyBiZWZvcmUgYmVpbmcgc2VudCBhcyBhIGhlYWRlci5cbiAgICogUG9wdWxhdGVkIGZyb20gaW5kZXhlZERCIHdoZW4gdGhlIGNvbnRyb2xsZXIgaXMgaW5zdGFudGlhdGVkIGFuZCBzaG91bGRcbiAgICogYmUga2VwdCBpbiBzeW5jIHdpdGggaW5kZXhlZERCLlxuICAgKiBMZWF2ZSBwdWJsaWMgZm9yIGVhc2llciB0ZXN0aW5nLlxuICAgKi9cbiAgX2hlYXJ0YmVhdHNDYWNoZTogSGVhcnRiZWF0c0luSW5kZXhlZERCIHwgbnVsbCA9IG51bGw7XG5cbiAgLyoqXG4gICAqIHRoZSBpbml0aWFsaXphdGlvbiBwcm9taXNlIGZvciBwb3B1bGF0aW5nIGhlYXJ0YmVhdENhY2hlLlxuICAgKiBJZiBnZXRIZWFydGJlYXRzSGVhZGVyKCkgaXMgY2FsbGVkIGJlZm9yZSB0aGUgcHJvbWlzZSByZXNvbHZlc1xuICAgKiAoaGVhcmJlYXRzQ2FjaGUgPT0gbnVsbCksIGl0IHNob3VsZCB3YWl0IGZvciB0aGlzIHByb21pc2VcbiAgICogTGVhdmUgcHVibGljIGZvciBlYXNpZXIgdGVzdGluZy5cbiAgICovXG4gIF9oZWFydGJlYXRzQ2FjaGVQcm9taXNlOiBQcm9taXNlPEhlYXJ0YmVhdHNJbkluZGV4ZWREQj47XG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgcmVhZG9ubHkgY29udGFpbmVyOiBDb21wb25lbnRDb250YWluZXIpIHtcbiAgICBjb25zdCBhcHAgPSB0aGlzLmNvbnRhaW5lci5nZXRQcm92aWRlcignYXBwJykuZ2V0SW1tZWRpYXRlKCk7XG4gICAgdGhpcy5fc3RvcmFnZSA9IG5ldyBIZWFydGJlYXRTdG9yYWdlSW1wbChhcHApO1xuICAgIHRoaXMuX2hlYXJ0YmVhdHNDYWNoZVByb21pc2UgPSB0aGlzLl9zdG9yYWdlLnJlYWQoKS50aGVuKHJlc3VsdCA9PiB7XG4gICAgICB0aGlzLl9oZWFydGJlYXRzQ2FjaGUgPSByZXN1bHQ7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIENhbGxlZCB0byByZXBvcnQgYSBoZWFydGJlYXQuIFRoZSBmdW5jdGlvbiB3aWxsIGdlbmVyYXRlXG4gICAqIGEgSGVhcnRiZWF0c0J5VXNlckFnZW50IG9iamVjdCwgdXBkYXRlIGhlYXJ0YmVhdHNDYWNoZSwgYW5kIHBlcnNpc3QgaXRcbiAgICogdG8gSW5kZXhlZERCLlxuICAgKiBOb3RlIHRoYXQgd2Ugb25seSBzdG9yZSBvbmUgaGVhcnRiZWF0IHBlciBkYXkuIFNvIGlmIGEgaGVhcnRiZWF0IGZvciB0b2RheSBpc1xuICAgKiBhbHJlYWR5IGxvZ2dlZCwgc3Vic2VxdWVudCBjYWxscyB0byB0aGlzIGZ1bmN0aW9uIGluIHRoZSBzYW1lIGRheSB3aWxsIGJlIGlnbm9yZWQuXG4gICAqL1xuICBhc3luYyB0cmlnZ2VySGVhcnRiZWF0KCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IHBsYXRmb3JtTG9nZ2VyID0gdGhpcy5jb250YWluZXJcbiAgICAgIC5nZXRQcm92aWRlcigncGxhdGZvcm0tbG9nZ2VyJylcbiAgICAgIC5nZXRJbW1lZGlhdGUoKTtcblxuICAgIC8vIFRoaXMgaXMgdGhlIFwiRmlyZWJhc2UgdXNlciBhZ2VudFwiIHN0cmluZyBmcm9tIHRoZSBwbGF0Zm9ybSBsb2dnZXJcbiAgICAvLyBzZXJ2aWNlLCBub3QgdGhlIGJyb3dzZXIgdXNlciBhZ2VudC5cbiAgICBjb25zdCBhZ2VudCA9IHBsYXRmb3JtTG9nZ2VyLmdldFBsYXRmb3JtSW5mb1N0cmluZygpO1xuICAgIGNvbnN0IGRhdGUgPSBnZXRVVENEYXRlU3RyaW5nKCk7XG4gICAgaWYgKHRoaXMuX2hlYXJ0YmVhdHNDYWNoZSA9PT0gbnVsbCkge1xuICAgICAgdGhpcy5faGVhcnRiZWF0c0NhY2hlID0gYXdhaXQgdGhpcy5faGVhcnRiZWF0c0NhY2hlUHJvbWlzZTtcbiAgICB9XG4gICAgLy8gRG8gbm90IHN0b3JlIGEgaGVhcnRiZWF0IGlmIG9uZSBpcyBhbHJlYWR5IHN0b3JlZCBmb3IgdGhpcyBkYXlcbiAgICAvLyBvciBpZiBhIGhlYWRlciBoYXMgYWxyZWFkeSBiZWVuIHNlbnQgdG9kYXkuXG4gICAgaWYgKFxuICAgICAgdGhpcy5faGVhcnRiZWF0c0NhY2hlLmxhc3RTZW50SGVhcnRiZWF0RGF0ZSA9PT0gZGF0ZSB8fFxuICAgICAgdGhpcy5faGVhcnRiZWF0c0NhY2hlLmhlYXJ0YmVhdHMuc29tZShcbiAgICAgICAgc2luZ2xlRGF0ZUhlYXJ0YmVhdCA9PiBzaW5nbGVEYXRlSGVhcnRiZWF0LmRhdGUgPT09IGRhdGVcbiAgICAgIClcbiAgICApIHtcbiAgICAgIHJldHVybjtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gVGhlcmUgaXMgbm8gZW50cnkgZm9yIHRoaXMgZGF0ZS4gQ3JlYXRlIG9uZS5cbiAgICAgIHRoaXMuX2hlYXJ0YmVhdHNDYWNoZS5oZWFydGJlYXRzLnB1c2goeyBkYXRlLCBhZ2VudCB9KTtcbiAgICB9XG4gICAgLy8gUmVtb3ZlIGVudHJpZXMgb2xkZXIgdGhhbiAzMCBkYXlzLlxuICAgIHRoaXMuX2hlYXJ0YmVhdHNDYWNoZS5oZWFydGJlYXRzID0gdGhpcy5faGVhcnRiZWF0c0NhY2hlLmhlYXJ0YmVhdHMuZmlsdGVyKFxuICAgICAgc2luZ2xlRGF0ZUhlYXJ0YmVhdCA9PiB7XG4gICAgICAgIGNvbnN0IGhiVGltZXN0YW1wID0gbmV3IERhdGUoc2luZ2xlRGF0ZUhlYXJ0YmVhdC5kYXRlKS52YWx1ZU9mKCk7XG4gICAgICAgIGNvbnN0IG5vdyA9IERhdGUubm93KCk7XG4gICAgICAgIHJldHVybiBub3cgLSBoYlRpbWVzdGFtcCA8PSBTVE9SRURfSEVBUlRCRUFUX1JFVEVOVElPTl9NQVhfTUlMTElTO1xuICAgICAgfVxuICAgICk7XG4gICAgcmV0dXJuIHRoaXMuX3N0b3JhZ2Uub3ZlcndyaXRlKHRoaXMuX2hlYXJ0YmVhdHNDYWNoZSk7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyBhIGJhc2U2NCBlbmNvZGVkIHN0cmluZyB3aGljaCBjYW4gYmUgYXR0YWNoZWQgdG8gdGhlIGhlYXJ0YmVhdC1zcGVjaWZpYyBoZWFkZXIgZGlyZWN0bHkuXG4gICAqIEl0IGFsc28gY2xlYXJzIGFsbCBoZWFydGJlYXRzIGZyb20gbWVtb3J5IGFzIHdlbGwgYXMgaW4gSW5kZXhlZERCLlxuICAgKlxuICAgKiBOT1RFOiBDb25zdW1pbmcgcHJvZHVjdCBTREtzIHNob3VsZCBub3Qgc2VuZCB0aGUgaGVhZGVyIGlmIHRoaXMgbWV0aG9kXG4gICAqIHJldHVybnMgYW4gZW1wdHkgc3RyaW5nLlxuICAgKi9cbiAgYXN5bmMgZ2V0SGVhcnRiZWF0c0hlYWRlcigpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIGlmICh0aGlzLl9oZWFydGJlYXRzQ2FjaGUgPT09IG51bGwpIHtcbiAgICAgIGF3YWl0IHRoaXMuX2hlYXJ0YmVhdHNDYWNoZVByb21pc2U7XG4gICAgfVxuICAgIC8vIElmIGl0J3Mgc3RpbGwgbnVsbCBvciB0aGUgYXJyYXkgaXMgZW1wdHksIHRoZXJlIGlzIG5vIGRhdGEgdG8gc2VuZC5cbiAgICBpZiAoXG4gICAgICB0aGlzLl9oZWFydGJlYXRzQ2FjaGUgPT09IG51bGwgfHxcbiAgICAgIHRoaXMuX2hlYXJ0YmVhdHNDYWNoZS5oZWFydGJlYXRzLmxlbmd0aCA9PT0gMFxuICAgICkge1xuICAgICAgcmV0dXJuICcnO1xuICAgIH1cbiAgICBjb25zdCBkYXRlID0gZ2V0VVRDRGF0ZVN0cmluZygpO1xuICAgIC8vIEV4dHJhY3QgYXMgbWFueSBoZWFydGJlYXRzIGZyb20gdGhlIGNhY2hlIGFzIHdpbGwgZml0IHVuZGVyIHRoZSBzaXplIGxpbWl0LlxuICAgIGNvbnN0IHsgaGVhcnRiZWF0c1RvU2VuZCwgdW5zZW50RW50cmllcyB9ID0gZXh0cmFjdEhlYXJ0YmVhdHNGb3JIZWFkZXIoXG4gICAgICB0aGlzLl9oZWFydGJlYXRzQ2FjaGUuaGVhcnRiZWF0c1xuICAgICk7XG4gICAgY29uc3QgaGVhZGVyU3RyaW5nID0gYmFzZTY0dXJsRW5jb2RlV2l0aG91dFBhZGRpbmcoXG4gICAgICBKU09OLnN0cmluZ2lmeSh7IHZlcnNpb246IDIsIGhlYXJ0YmVhdHM6IGhlYXJ0YmVhdHNUb1NlbmQgfSlcbiAgICApO1xuICAgIC8vIFN0b3JlIGxhc3Qgc2VudCBkYXRlIHRvIHByZXZlbnQgYW5vdGhlciBiZWluZyBsb2dnZWQvc2VudCBmb3IgdGhlIHNhbWUgZGF5LlxuICAgIHRoaXMuX2hlYXJ0YmVhdHNDYWNoZS5sYXN0U2VudEhlYXJ0YmVhdERhdGUgPSBkYXRlO1xuICAgIGlmICh1bnNlbnRFbnRyaWVzLmxlbmd0aCA+IDApIHtcbiAgICAgIC8vIFN0b3JlIGFueSB1bnNlbnQgZW50cmllcyBpZiB0aGV5IGV4aXN0LlxuICAgICAgdGhpcy5faGVhcnRiZWF0c0NhY2hlLmhlYXJ0YmVhdHMgPSB1bnNlbnRFbnRyaWVzO1xuICAgICAgLy8gVGhpcyBzZWVtcyBtb3JlIGxpa2VseSB0aGFuIGVtcHR5aW5nIHRoZSBhcnJheSAoYmVsb3cpIHRvIGxlYWQgdG8gc29tZSBvZGQgc3RhdGVcbiAgICAgIC8vIHNpbmNlIHRoZSBjYWNoZSBpc24ndCBlbXB0eSBhbmQgdGhpcyB3aWxsIGJlIGNhbGxlZCBhZ2FpbiBvbiB0aGUgbmV4dCByZXF1ZXN0LFxuICAgICAgLy8gYW5kIGlzIHByb2JhYmx5IHNhZmVzdCBpZiB3ZSBhd2FpdCBpdC5cbiAgICAgIGF3YWl0IHRoaXMuX3N0b3JhZ2Uub3ZlcndyaXRlKHRoaXMuX2hlYXJ0YmVhdHNDYWNoZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX2hlYXJ0YmVhdHNDYWNoZS5oZWFydGJlYXRzID0gW107XG4gICAgICAvLyBEbyBub3Qgd2FpdCBmb3IgdGhpcywgdG8gcmVkdWNlIGxhdGVuY3kuXG4gICAgICB2b2lkIHRoaXMuX3N0b3JhZ2Uub3ZlcndyaXRlKHRoaXMuX2hlYXJ0YmVhdHNDYWNoZSk7XG4gICAgfVxuICAgIHJldHVybiBoZWFkZXJTdHJpbmc7XG4gIH1cbn1cblxuZnVuY3Rpb24gZ2V0VVRDRGF0ZVN0cmluZygpOiBzdHJpbmcge1xuICBjb25zdCB0b2RheSA9IG5ldyBEYXRlKCk7XG4gIC8vIFJldHVybnMgZGF0ZSBmb3JtYXQgJ1lZWVktTU0tREQnXG4gIHJldHVybiB0b2RheS50b0lTT1N0cmluZygpLnN1YnN0cmluZygwLCAxMCk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBleHRyYWN0SGVhcnRiZWF0c0ZvckhlYWRlcihcbiAgaGVhcnRiZWF0c0NhY2hlOiBTaW5nbGVEYXRlSGVhcnRiZWF0W10sXG4gIG1heFNpemUgPSBNQVhfSEVBREVSX0JZVEVTXG4pOiB7XG4gIGhlYXJ0YmVhdHNUb1NlbmQ6IEhlYXJ0YmVhdHNCeVVzZXJBZ2VudFtdO1xuICB1bnNlbnRFbnRyaWVzOiBTaW5nbGVEYXRlSGVhcnRiZWF0W107XG59IHtcbiAgLy8gSGVhcnRiZWF0cyBncm91cGVkIGJ5IHVzZXIgYWdlbnQgaW4gdGhlIHN0YW5kYXJkIGZvcm1hdCB0byBiZSBzZW50IGluXG4gIC8vIHRoZSBoZWFkZXIuXG4gIGNvbnN0IGhlYXJ0YmVhdHNUb1NlbmQ6IEhlYXJ0YmVhdHNCeVVzZXJBZ2VudFtdID0gW107XG4gIC8vIFNpbmdsZSBkYXRlIGZvcm1hdCBoZWFydGJlYXRzIHRoYXQgYXJlIG5vdCBzZW50LlxuICBsZXQgdW5zZW50RW50cmllcyA9IGhlYXJ0YmVhdHNDYWNoZS5zbGljZSgpO1xuICBmb3IgKGNvbnN0IHNpbmdsZURhdGVIZWFydGJlYXQgb2YgaGVhcnRiZWF0c0NhY2hlKSB7XG4gICAgLy8gTG9vayBmb3IgYW4gZXhpc3RpbmcgZW50cnkgd2l0aCB0aGUgc2FtZSB1c2VyIGFnZW50LlxuICAgIGNvbnN0IGhlYXJ0YmVhdEVudHJ5ID0gaGVhcnRiZWF0c1RvU2VuZC5maW5kKFxuICAgICAgaGIgPT4gaGIuYWdlbnQgPT09IHNpbmdsZURhdGVIZWFydGJlYXQuYWdlbnRcbiAgICApO1xuICAgIGlmICghaGVhcnRiZWF0RW50cnkpIHtcbiAgICAgIC8vIElmIG5vIGVudHJ5IGZvciB0aGlzIHVzZXIgYWdlbnQgZXhpc3RzLCBjcmVhdGUgb25lLlxuICAgICAgaGVhcnRiZWF0c1RvU2VuZC5wdXNoKHtcbiAgICAgICAgYWdlbnQ6IHNpbmdsZURhdGVIZWFydGJlYXQuYWdlbnQsXG4gICAgICAgIGRhdGVzOiBbc2luZ2xlRGF0ZUhlYXJ0YmVhdC5kYXRlXVxuICAgICAgfSk7XG4gICAgICBpZiAoY291bnRCeXRlcyhoZWFydGJlYXRzVG9TZW5kKSA+IG1heFNpemUpIHtcbiAgICAgICAgLy8gSWYgdGhlIGhlYWRlciB3b3VsZCBleGNlZWQgbWF4IHNpemUsIHJlbW92ZSB0aGUgYWRkZWQgaGVhcnRiZWF0XG4gICAgICAgIC8vIGVudHJ5IGFuZCBzdG9wIGFkZGluZyB0byB0aGUgaGVhZGVyLlxuICAgICAgICBoZWFydGJlYXRzVG9TZW5kLnBvcCgpO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgaGVhcnRiZWF0RW50cnkuZGF0ZXMucHVzaChzaW5nbGVEYXRlSGVhcnRiZWF0LmRhdGUpO1xuICAgICAgLy8gSWYgdGhlIGhlYWRlciB3b3VsZCBleGNlZWQgbWF4IHNpemUsIHJlbW92ZSB0aGUgYWRkZWQgZGF0ZVxuICAgICAgLy8gYW5kIHN0b3AgYWRkaW5nIHRvIHRoZSBoZWFkZXIuXG4gICAgICBpZiAoY291bnRCeXRlcyhoZWFydGJlYXRzVG9TZW5kKSA+IG1heFNpemUpIHtcbiAgICAgICAgaGVhcnRiZWF0RW50cnkuZGF0ZXMucG9wKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cbiAgICAvLyBQb3AgdW5zZW50IGVudHJ5IGZyb20gcXVldWUuIChTa2lwcGVkIGlmIGFkZGluZyB0aGUgZW50cnkgZXhjZWVkZWRcbiAgICAvLyBxdW90YSBhbmQgdGhlIGxvb3AgYnJlYWtzIGVhcmx5LilcbiAgICB1bnNlbnRFbnRyaWVzID0gdW5zZW50RW50cmllcy5zbGljZSgxKTtcbiAgfVxuICByZXR1cm4ge1xuICAgIGhlYXJ0YmVhdHNUb1NlbmQsXG4gICAgdW5zZW50RW50cmllc1xuICB9O1xufVxuXG5leHBvcnQgY2xhc3MgSGVhcnRiZWF0U3RvcmFnZUltcGwgaW1wbGVtZW50cyBIZWFydGJlYXRTdG9yYWdlIHtcbiAgcHJpdmF0ZSBfY2FuVXNlSW5kZXhlZERCUHJvbWlzZTogUHJvbWlzZTxib29sZWFuPjtcbiAgY29uc3RydWN0b3IocHVibGljIGFwcDogRmlyZWJhc2VBcHApIHtcbiAgICB0aGlzLl9jYW5Vc2VJbmRleGVkREJQcm9taXNlID0gdGhpcy5ydW5JbmRleGVkREJFbnZpcm9ubWVudENoZWNrKCk7XG4gIH1cbiAgYXN5bmMgcnVuSW5kZXhlZERCRW52aXJvbm1lbnRDaGVjaygpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICBpZiAoIWlzSW5kZXhlZERCQXZhaWxhYmxlKCkpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHZhbGlkYXRlSW5kZXhlZERCT3BlbmFibGUoKVxuICAgICAgICAudGhlbigoKSA9PiB0cnVlKVxuICAgICAgICAuY2F0Y2goKCkgPT4gZmFsc2UpO1xuICAgIH1cbiAgfVxuICAvKipcbiAgICogUmVhZCBhbGwgaGVhcnRiZWF0cy5cbiAgICovXG4gIGFzeW5jIHJlYWQoKTogUHJvbWlzZTxIZWFydGJlYXRzSW5JbmRleGVkREI+IHtcbiAgICBjb25zdCBjYW5Vc2VJbmRleGVkREIgPSBhd2FpdCB0aGlzLl9jYW5Vc2VJbmRleGVkREJQcm9taXNlO1xuICAgIGlmICghY2FuVXNlSW5kZXhlZERCKSB7XG4gICAgICByZXR1cm4geyBoZWFydGJlYXRzOiBbXSB9O1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBpZGJIZWFydGJlYXRPYmplY3QgPSBhd2FpdCByZWFkSGVhcnRiZWF0c0Zyb21JbmRleGVkREIodGhpcy5hcHApO1xuICAgICAgcmV0dXJuIGlkYkhlYXJ0YmVhdE9iamVjdCB8fCB7IGhlYXJ0YmVhdHM6IFtdIH07XG4gICAgfVxuICB9XG4gIC8vIG92ZXJ3cml0ZSB0aGUgc3RvcmFnZSB3aXRoIHRoZSBwcm92aWRlZCBoZWFydGJlYXRzXG4gIGFzeW5jIG92ZXJ3cml0ZShoZWFydGJlYXRzT2JqZWN0OiBIZWFydGJlYXRzSW5JbmRleGVkREIpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCBjYW5Vc2VJbmRleGVkREIgPSBhd2FpdCB0aGlzLl9jYW5Vc2VJbmRleGVkREJQcm9taXNlO1xuICAgIGlmICghY2FuVXNlSW5kZXhlZERCKSB7XG4gICAgICByZXR1cm47XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IGV4aXN0aW5nSGVhcnRiZWF0c09iamVjdCA9IGF3YWl0IHRoaXMucmVhZCgpO1xuICAgICAgcmV0dXJuIHdyaXRlSGVhcnRiZWF0c1RvSW5kZXhlZERCKHRoaXMuYXBwLCB7XG4gICAgICAgIGxhc3RTZW50SGVhcnRiZWF0RGF0ZTpcbiAgICAgICAgICBoZWFydGJlYXRzT2JqZWN0Lmxhc3RTZW50SGVhcnRiZWF0RGF0ZSA/P1xuICAgICAgICAgIGV4aXN0aW5nSGVhcnRiZWF0c09iamVjdC5sYXN0U2VudEhlYXJ0YmVhdERhdGUsXG4gICAgICAgIGhlYXJ0YmVhdHM6IGhlYXJ0YmVhdHNPYmplY3QuaGVhcnRiZWF0c1xuICAgICAgfSk7XG4gICAgfVxuICB9XG4gIC8vIGFkZCBoZWFydGJlYXRzXG4gIGFzeW5jIGFkZChoZWFydGJlYXRzT2JqZWN0OiBIZWFydGJlYXRzSW5JbmRleGVkREIpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCBjYW5Vc2VJbmRleGVkREIgPSBhd2FpdCB0aGlzLl9jYW5Vc2VJbmRleGVkREJQcm9taXNlO1xuICAgIGlmICghY2FuVXNlSW5kZXhlZERCKSB7XG4gICAgICByZXR1cm47XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IGV4aXN0aW5nSGVhcnRiZWF0c09iamVjdCA9IGF3YWl0IHRoaXMucmVhZCgpO1xuICAgICAgcmV0dXJuIHdyaXRlSGVhcnRiZWF0c1RvSW5kZXhlZERCKHRoaXMuYXBwLCB7XG4gICAgICAgIGxhc3RTZW50SGVhcnRiZWF0RGF0ZTpcbiAgICAgICAgICBoZWFydGJlYXRzT2JqZWN0Lmxhc3RTZW50SGVhcnRiZWF0RGF0ZSA/P1xuICAgICAgICAgIGV4aXN0aW5nSGVhcnRiZWF0c09iamVjdC5sYXN0U2VudEhlYXJ0YmVhdERhdGUsXG4gICAgICAgIGhlYXJ0YmVhdHM6IFtcbiAgICAgICAgICAuLi5leGlzdGluZ0hlYXJ0YmVhdHNPYmplY3QuaGVhcnRiZWF0cyxcbiAgICAgICAgICAuLi5oZWFydGJlYXRzT2JqZWN0LmhlYXJ0YmVhdHNcbiAgICAgICAgXVxuICAgICAgfSk7XG4gICAgfVxuICB9XG59XG5cbi8qKlxuICogQ2FsY3VsYXRlIGJ5dGVzIG9mIGEgSGVhcnRiZWF0c0J5VXNlckFnZW50IGFycmF5IGFmdGVyIGJlaW5nIHdyYXBwZWRcbiAqIGluIGEgcGxhdGZvcm0gbG9nZ2luZyBoZWFkZXIgSlNPTiBvYmplY3QsIHN0cmluZ2lmaWVkLCBhbmQgY29udmVydGVkXG4gKiB0byBiYXNlIDY0LlxuICovXG5leHBvcnQgZnVuY3Rpb24gY291bnRCeXRlcyhoZWFydGJlYXRzQ2FjaGU6IEhlYXJ0YmVhdHNCeVVzZXJBZ2VudFtdKTogbnVtYmVyIHtcbiAgLy8gYmFzZTY0IGhhcyBhIHJlc3RyaWN0ZWQgc2V0IG9mIGNoYXJhY3RlcnMsIGFsbCBvZiB3aGljaCBzaG91bGQgYmUgMSBieXRlLlxuICByZXR1cm4gYmFzZTY0dXJsRW5jb2RlV2l0aG91dFBhZGRpbmcoXG4gICAgLy8gaGVhcnRiZWF0c0NhY2hlIHdyYXBwZXIgcHJvcGVydGllc1xuICAgIEpTT04uc3RyaW5naWZ5KHsgdmVyc2lvbjogMiwgaGVhcnRiZWF0czogaGVhcnRiZWF0c0NhY2hlIH0pXG4gICkubGVuZ3RoO1xufVxuIiwgIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7IENvbXBvbmVudCwgQ29tcG9uZW50VHlwZSB9IGZyb20gJ0BmaXJlYmFzZS9jb21wb25lbnQnO1xuaW1wb3J0IHsgUGxhdGZvcm1Mb2dnZXJTZXJ2aWNlSW1wbCB9IGZyb20gJy4vcGxhdGZvcm1Mb2dnZXJTZXJ2aWNlJztcbmltcG9ydCB7IG5hbWUsIHZlcnNpb24gfSBmcm9tICcuLi9wYWNrYWdlLmpzb24nO1xuaW1wb3J0IHsgX3JlZ2lzdGVyQ29tcG9uZW50IH0gZnJvbSAnLi9pbnRlcm5hbCc7XG5pbXBvcnQgeyByZWdpc3RlclZlcnNpb24gfSBmcm9tICcuL2FwaSc7XG5pbXBvcnQgeyBIZWFydGJlYXRTZXJ2aWNlSW1wbCB9IGZyb20gJy4vaGVhcnRiZWF0U2VydmljZSc7XG5cbmV4cG9ydCBmdW5jdGlvbiByZWdpc3RlckNvcmVDb21wb25lbnRzKHZhcmlhbnQ/OiBzdHJpbmcpOiB2b2lkIHtcbiAgX3JlZ2lzdGVyQ29tcG9uZW50KFxuICAgIG5ldyBDb21wb25lbnQoXG4gICAgICAncGxhdGZvcm0tbG9nZ2VyJyxcbiAgICAgIGNvbnRhaW5lciA9PiBuZXcgUGxhdGZvcm1Mb2dnZXJTZXJ2aWNlSW1wbChjb250YWluZXIpLFxuICAgICAgQ29tcG9uZW50VHlwZS5QUklWQVRFXG4gICAgKVxuICApO1xuICBfcmVnaXN0ZXJDb21wb25lbnQoXG4gICAgbmV3IENvbXBvbmVudChcbiAgICAgICdoZWFydGJlYXQnLFxuICAgICAgY29udGFpbmVyID0+IG5ldyBIZWFydGJlYXRTZXJ2aWNlSW1wbChjb250YWluZXIpLFxuICAgICAgQ29tcG9uZW50VHlwZS5QUklWQVRFXG4gICAgKVxuICApO1xuXG4gIC8vIFJlZ2lzdGVyIGBhcHBgIHBhY2thZ2UuXG4gIHJlZ2lzdGVyVmVyc2lvbihuYW1lLCB2ZXJzaW9uLCB2YXJpYW50KTtcbiAgLy8gQlVJTERfVEFSR0VUIHdpbGwgYmUgcmVwbGFjZWQgYnkgdmFsdWVzIGxpa2UgZXNtNSwgZXNtMjAxNywgY2pzNSwgZXRjIGR1cmluZyB0aGUgY29tcGlsYXRpb25cbiAgcmVnaXN0ZXJWZXJzaW9uKG5hbWUsIHZlcnNpb24sICdfX0JVSUxEX1RBUkdFVF9fJyk7XG4gIC8vIFJlZ2lzdGVyIHBsYXRmb3JtIFNESyBpZGVudGlmaWVyIChubyB2ZXJzaW9uKS5cbiAgcmVnaXN0ZXJWZXJzaW9uKCdmaXJlLWpzJywgJycpO1xufVxuIiwgIi8qKlxuICogRmlyZWJhc2UgQXBwXG4gKlxuICogQHJlbWFya3MgVGhpcyBwYWNrYWdlIGNvb3JkaW5hdGVzIHRoZSBjb21tdW5pY2F0aW9uIGJldHdlZW4gdGhlIGRpZmZlcmVudCBGaXJlYmFzZSBjb21wb25lbnRzXG4gKiBAcGFja2FnZURvY3VtZW50YXRpb25cbiAqL1xuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQgeyByZWdpc3RlckNvcmVDb21wb25lbnRzIH0gZnJvbSAnLi9yZWdpc3RlckNvcmVDb21wb25lbnRzJztcblxuZXhwb3J0ICogZnJvbSAnLi9hcGknO1xuZXhwb3J0ICogZnJvbSAnLi9pbnRlcm5hbCc7XG5leHBvcnQgKiBmcm9tICcuL3B1YmxpYy10eXBlcyc7XG5cbnJlZ2lzdGVyQ29yZUNvbXBvbmVudHMoJ19fUlVOVElNRV9FTlZfXycpO1xuIiwgIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5pbXBvcnQgeyByZWdpc3RlclZlcnNpb24gfSBmcm9tICdAZmlyZWJhc2UvYXBwJztcbmltcG9ydCB7IG5hbWUsIHZlcnNpb24gfSBmcm9tICcuLi9wYWNrYWdlLmpzb24nO1xuXG5yZWdpc3RlclZlcnNpb24obmFtZSwgdmVyc2lvbiwgJ2FwcCcpO1xuZXhwb3J0ICogZnJvbSAnQGZpcmViYXNlL2FwcCc7XG4iLCAiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IFRoZSBDbG9zdXJlIExpYnJhcnkgQXV0aG9ycy5cbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBAZmlsZW92ZXJ2aWV3IEJvb3RzdHJhcCBmb3IgdGhlIEdvb2dsZSBKUyBMaWJyYXJ5IChDbG9zdXJlKS5cbiAqXG4gKiBJbiB1bmNvbXBpbGVkIG1vZGUgYmFzZS5qcyB3aWxsIGF0dGVtcHQgdG8gbG9hZCBDbG9zdXJlJ3MgZGVwcyBmaWxlLCB1bmxlc3NcbiAqIHRoZSBnbG9iYWwgPGNvZGU+Q0xPU1VSRV9OT19ERVBTPC9jb2RlPiBpcyBzZXQgdG8gdHJ1ZS4gIFRoaXMgYWxsb3dzIHByb2plY3RzXG4gKiB0byBpbmNsdWRlIHRoZWlyIG93biBkZXBzIGZpbGUocykgZnJvbSBkaWZmZXJlbnQgbG9jYXRpb25zLlxuICpcbiAqIEF2b2lkIGluY2x1ZGluZyBiYXNlLmpzIG1vcmUgdGhhbiBvbmNlLiBUaGlzIGlzIHN0cmljdGx5IGRpc2NvdXJhZ2VkIGFuZCBub3RcbiAqIHN1cHBvcnRlZC4gZ29vZy5yZXF1aXJlKC4uLikgd29uJ3Qgd29yayBwcm9wZXJseSBpbiB0aGF0IGNhc2UuXG4gKlxuICogQHByb3ZpZGVHb29nXG4gKi9cblxuXG4vKipcbiAqIEBkZWZpbmUge2Jvb2xlYW59IE92ZXJyaWRkZW4gdG8gdHJ1ZSBieSB0aGUgY29tcGlsZXIuXG4gKi9cbnZhciBDT01QSUxFRCA9IGZhbHNlO1xuXG5cbi8qKlxuICogQmFzZSBuYW1lc3BhY2UgZm9yIHRoZSBDbG9zdXJlIGxpYnJhcnkuICBDaGVja3MgdG8gc2VlIGdvb2cgaXMgYWxyZWFkeVxuICogZGVmaW5lZCBpbiB0aGUgY3VycmVudCBzY29wZSBiZWZvcmUgYXNzaWduaW5nIHRvIHByZXZlbnQgY2xvYmJlcmluZyBpZlxuICogYmFzZS5qcyBpcyBsb2FkZWQgbW9yZSB0aGFuIG9uY2UuXG4gKlxuICogQGNvbnN0XG4gKi9cbnZhciBnb29nID0gZ29vZyB8fCB7fTtcblxuLyoqXG4gKiBSZWZlcmVuY2UgdG8gdGhlIGdsb2JhbCBvYmplY3QuXG4gKiBodHRwczovL3d3dy5lY21hLWludGVybmF0aW9uYWwub3JnL2VjbWEtMjYyLzkuMC9pbmRleC5odG1sI3NlYy1nbG9iYWwtb2JqZWN0XG4gKlxuICogTW9yZSBpbmZvIG9uIHRoaXMgaW1wbGVtZW50YXRpb24gaGVyZTpcbiAqIGh0dHBzOi8vZG9jcy5nb29nbGUuY29tL2RvY3VtZW50L2QvMU5BZVc0V2s3STdGVjBZMnRjVUZ2UWRHTWM4OWsydmRnU1hJbnc4X252Q0kvZWRpdFxuICpcbiAqIEBjb25zdFxuICogQHN1cHByZXNzIHt1bmRlZmluZWRWYXJzfSBzZWxmIHdvbid0IGJlIHJlZmVyZW5jZWQgdW5sZXNzIGB0aGlzYCBpcyBmYWxzeS5cbiAqIEB0eXBlIHshR2xvYmFsfVxuICovXG5nb29nLmdsb2JhbCA9XG4gICAgLy8gQ2hlY2sgYHRoaXNgIGZpcnN0IGZvciBiYWNrd2FyZHMgY29tcGF0aWJpbGl0eS5cbiAgICAvLyBWYWxpZCB1bmxlc3MgcnVubmluZyBhcyBhbiBFUyBtb2R1bGUgb3IgaW4gYSBmdW5jdGlvbiB3cmFwcGVyIGNhbGxlZFxuICAgIC8vICAgd2l0aG91dCBzZXR0aW5nIGB0aGlzYCBwcm9wZXJseS5cbiAgICAvLyBOb3RlIHRoYXQgYmFzZS5qcyBjYW4ndCB1c2VmdWxseSBiZSBpbXBvcnRlZCBhcyBhbiBFUyBtb2R1bGUsIGJ1dCBpdCBtYXlcbiAgICAvLyBiZSBjb21waWxlZCBpbnRvIGJ1bmRsZXMgdGhhdCBhcmUgbG9hZGFibGUgYXMgRVMgbW9kdWxlcy5cbiAgICB0aGlzIHx8XG4gICAgLy8gaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL1dpbmRvdy9zZWxmXG4gICAgLy8gRm9yIGluLXBhZ2UgYnJvd3NlciBlbnZpcm9ubWVudHMgYW5kIHdvcmtlcnMuXG4gICAgc2VsZjtcblxuXG4vKipcbiAqIEEgaG9vayBmb3Igb3ZlcnJpZGluZyB0aGUgZGVmaW5lIHZhbHVlcyBpbiB1bmNvbXBpbGVkIG1vZGUuXG4gKlxuICogSW4gdW5jb21waWxlZCBtb2RlLCBgQ0xPU1VSRV9VTkNPTVBJTEVEX0RFRklORVNgIG1heSBiZSBkZWZpbmVkIGJlZm9yZVxuICogbG9hZGluZyBiYXNlLmpzLiAgSWYgYSBrZXkgaXMgZGVmaW5lZCBpbiBgQ0xPU1VSRV9VTkNPTVBJTEVEX0RFRklORVNgLFxuICogYGdvb2cuZGVmaW5lYCB3aWxsIHVzZSB0aGUgdmFsdWUgaW5zdGVhZCBvZiB0aGUgZGVmYXVsdCB2YWx1ZS4gIFRoaXNcbiAqIGFsbG93cyBmbGFncyB0byBiZSBvdmVyd3JpdHRlbiB3aXRob3V0IGNvbXBpbGF0aW9uICh0aGlzIGlzIG5vcm1hbGx5XG4gKiBhY2NvbXBsaXNoZWQgd2l0aCB0aGUgY29tcGlsZXIncyBcImRlZmluZVwiIGZsYWcpLlxuICpcbiAqIEV4YW1wbGU6XG4gKiA8cHJlPlxuICogICB2YXIgQ0xPU1VSRV9VTkNPTVBJTEVEX0RFRklORVMgPSB7J2dvb2cuREVCVUcnOiBmYWxzZX07XG4gKiA8L3ByZT5cbiAqXG4gKiBAdHlwZSB7T2JqZWN0PHN0cmluZywgKHN0cmluZ3xudW1iZXJ8Ym9vbGVhbik+fHVuZGVmaW5lZH1cbiAqL1xuZ29vZy5nbG9iYWwuQ0xPU1VSRV9VTkNPTVBJTEVEX0RFRklORVM7XG5cblxuLyoqXG4gKiBBIGhvb2sgZm9yIG92ZXJyaWRpbmcgdGhlIGRlZmluZSB2YWx1ZXMgaW4gdW5jb21waWxlZCBvciBjb21waWxlZCBtb2RlLFxuICogbGlrZSBDTE9TVVJFX1VOQ09NUElMRURfREVGSU5FUyBidXQgZWZmZWN0aXZlIGluIGNvbXBpbGVkIGNvZGUuICBJblxuICogdW5jb21waWxlZCBjb2RlIENMT1NVUkVfVU5DT01QSUxFRF9ERUZJTkVTIHRha2VzIHByZWNlZGVuY2UuXG4gKlxuICogQWxzbyB1bmxpa2UgQ0xPU1VSRV9VTkNPTVBJTEVEX0RFRklORVMgdGhlIHZhbHVlcyBtdXN0IGJlIG51bWJlciwgYm9vbGVhbiBvclxuICogc3RyaW5nIGxpdGVyYWxzIG9yIHRoZSBjb21waWxlciB3aWxsIGVtaXQgYW4gZXJyb3IuXG4gKlxuICogV2hpbGUgYW55IEBkZWZpbmUgdmFsdWUgbWF5IGJlIHNldCwgb25seSB0aG9zZSBzZXQgd2l0aCBnb29nLmRlZmluZSB3aWxsIGJlXG4gKiBlZmZlY3RpdmUgZm9yIHVuY29tcGlsZWQgY29kZS5cbiAqXG4gKiBFeGFtcGxlOlxuICogPHByZT5cbiAqICAgdmFyIENMT1NVUkVfREVGSU5FUyA9IHsnZ29vZy5ERUJVRyc6IGZhbHNlfSA7XG4gKiA8L3ByZT5cbiAqXG4gKiBAdHlwZSB7T2JqZWN0PHN0cmluZywgKHN0cmluZ3xudW1iZXJ8Ym9vbGVhbik+fHVuZGVmaW5lZH1cbiAqL1xuZ29vZy5nbG9iYWwuQ0xPU1VSRV9ERUZJTkVTO1xuXG5cbi8qKlxuICogQnVpbGRzIGFuIG9iamVjdCBzdHJ1Y3R1cmUgZm9yIHRoZSBwcm92aWRlZCBuYW1lc3BhY2UgcGF0aCwgZW5zdXJpbmcgdGhhdFxuICogbmFtZXMgdGhhdCBhbHJlYWR5IGV4aXN0IGFyZSBub3Qgb3ZlcndyaXR0ZW4uIEZvciBleGFtcGxlOlxuICogXCJhLmIuY1wiIC0+IGEgPSB7fTthLmI9e307YS5iLmM9e307XG4gKiBVc2VkIGJ5IGdvb2cucHJvdmlkZSBhbmQgZ29vZy5leHBvcnRTeW1ib2wuXG4gKiBAcGFyYW0ge3N0cmluZ30gbmFtZSBUaGUgbmFtZSBvZiB0aGUgb2JqZWN0IHRoYXQgdGhpcyBmaWxlIGRlZmluZXMuXG4gKiBAcGFyYW0geyo9fSBvYmplY3QgVGhlIG9iamVjdCB0byBleHBvc2UgYXQgdGhlIGVuZCBvZiB0aGUgcGF0aC5cbiAqIEBwYXJhbSB7Ym9vbGVhbj19IG92ZXJ3cml0ZUltcGxpY2l0IElmIG9iamVjdCBpcyBzZXQgYW5kIGEgcHJldmlvdXMgY2FsbFxuICogICAgIGltcGxpY2l0bHkgY29uc3RydWN0ZWQgdGhlIG5hbWVzcGFjZSBnaXZlbiBieSBuYW1lLCB0aGlzIHBhcmFtZXRlclxuICogICAgIGNvbnRyb2xzIHdoZXRoZXIgb2JqZWN0IHNob3VsZCBvdmVyd3JpdGUgdGhlIGltcGxpY2l0bHkgY29uc3RydWN0ZWRcbiAqICAgICBuYW1lc3BhY2Ugb3IgYmUgbWVyZ2VkIGludG8gaXQuIERlZmF1bHRzIHRvIGZhbHNlLlxuICogQHBhcmFtIHs/T2JqZWN0PX0gb2JqZWN0VG9FeHBvcnRUbyBUaGUgb2JqZWN0IHRvIGFkZCB0aGUgcGF0aCB0bzsgaWYgdGhpc1xuICogICAgIGZpZWxkIGlzIG5vdCBzcGVjaWZpZWQsIGl0cyB2YWx1ZSBkZWZhdWx0cyB0byBgZ29vZy5nbG9iYWxgLlxuICogQHByaXZhdGVcbiAqL1xuZ29vZy5leHBvcnRQYXRoXyA9IGZ1bmN0aW9uKG5hbWUsIG9iamVjdCwgb3ZlcndyaXRlSW1wbGljaXQsIG9iamVjdFRvRXhwb3J0VG8pIHtcbiAgdmFyIHBhcnRzID0gbmFtZS5zcGxpdCgnLicpO1xuICB2YXIgY3VyID0gb2JqZWN0VG9FeHBvcnRUbyB8fCBnb29nLmdsb2JhbDtcblxuICAvLyBJbnRlcm5ldCBFeHBsb3JlciBleGhpYml0cyBzdHJhbmdlIGJlaGF2aW9yIHdoZW4gdGhyb3dpbmcgZXJyb3JzIGZyb21cbiAgLy8gbWV0aG9kcyBleHRlcm5lZCBpbiB0aGlzIG1hbm5lci4gIFNlZSB0aGUgdGVzdEV4cG9ydFN5bWJvbEV4Y2VwdGlvbnMgaW5cbiAgLy8gYmFzZV90ZXN0Lmh0bWwgZm9yIGFuIGV4YW1wbGUuXG4gIGlmICghKHBhcnRzWzBdIGluIGN1cikgJiYgdHlwZW9mIGN1ci5leGVjU2NyaXB0ICE9ICd1bmRlZmluZWQnKSB7XG4gICAgY3VyLmV4ZWNTY3JpcHQoJ3ZhciAnICsgcGFydHNbMF0pO1xuICB9XG5cbiAgZm9yICh2YXIgcGFydDsgcGFydHMubGVuZ3RoICYmIChwYXJ0ID0gcGFydHMuc2hpZnQoKSk7KSB7XG4gICAgaWYgKCFwYXJ0cy5sZW5ndGggJiYgb2JqZWN0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGlmICghb3ZlcndyaXRlSW1wbGljaXQgJiYgZ29vZy5pc09iamVjdChvYmplY3QpICYmXG4gICAgICAgICAgZ29vZy5pc09iamVjdChjdXJbcGFydF0pKSB7XG4gICAgICAgIC8vIE1lcmdlIHByb3BlcnRpZXMgb24gb2JqZWN0ICh0aGUgaW5wdXQgcGFyYW1ldGVyKSB3aXRoIHRoZSBleGlzdGluZ1xuICAgICAgICAvLyBpbXBsaWNpdGx5IGRlZmluZWQgbmFtZXNwYWNlLCBzbyBhcyB0byBub3QgY2xvYmJlciBwcmV2aW91c2x5XG4gICAgICAgIC8vIGRlZmluZWQgY2hpbGQgbmFtZXNwYWNlcy5cbiAgICAgICAgZm9yICh2YXIgcHJvcCBpbiBvYmplY3QpIHtcbiAgICAgICAgICBpZiAob2JqZWN0Lmhhc093blByb3BlcnR5KHByb3ApKSB7XG4gICAgICAgICAgICBjdXJbcGFydF1bcHJvcF0gPSBvYmplY3RbcHJvcF07XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBFaXRoZXIgdGhlcmUgaXMgbm8gZXhpc3RpbmcgaW1wbGljaXQgbmFtZXNwYWNlLCBvciBvdmVyd3JpdGVJbXBsaWNpdFxuICAgICAgICAvLyBpcyBzZXQgdG8gdHJ1ZSwgc28gZGlyZWN0bHkgYXNzaWduIG9iamVjdCAodGhlIGlucHV0IHBhcmFtZXRlcikgdG9cbiAgICAgICAgLy8gdGhlIG5hbWVzcGFjZS5cbiAgICAgICAgY3VyW3BhcnRdID0gb2JqZWN0O1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoY3VyW3BhcnRdICYmIGN1cltwYXJ0XSAhPT0gT2JqZWN0LnByb3RvdHlwZVtwYXJ0XSkge1xuICAgICAgY3VyID0gY3VyW3BhcnRdO1xuICAgIH0gZWxzZSB7XG4gICAgICBjdXIgPSBjdXJbcGFydF0gPSB7fTtcbiAgICB9XG4gIH1cbn07XG5cblxuLyoqXG4gKiBEZWZpbmVzIGEgbmFtZWQgdmFsdWUuIEluIHVuY29tcGlsZWQgbW9kZSwgdGhlIHZhbHVlIGlzIHJldHJpZXZlZCBmcm9tXG4gKiBDTE9TVVJFX0RFRklORVMgb3IgQ0xPU1VSRV9VTkNPTVBJTEVEX0RFRklORVMgaWYgdGhlIG9iamVjdCBpcyBkZWZpbmVkIGFuZFxuICogaGFzIHRoZSBwcm9wZXJ0eSBzcGVjaWZpZWQsIGFuZCBvdGhlcndpc2UgdXNlZCB0aGUgZGVmaW5lZCBkZWZhdWx0VmFsdWUuXG4gKiBXaGVuIGNvbXBpbGVkIHRoZSBkZWZhdWx0IGNhbiBiZSBvdmVycmlkZGVuIHVzaW5nIHRoZSBjb21waWxlciBvcHRpb25zIG9yIHRoZVxuICogdmFsdWUgc2V0IGluIHRoZSBDTE9TVVJFX0RFRklORVMgb2JqZWN0LiBSZXR1cm5zIHRoZSBkZWZpbmVkIHZhbHVlIHNvIHRoYXQgaXRcbiAqIGNhbiBiZSB1c2VkIHNhZmVseSBpbiBtb2R1bGVzLiBOb3RlIHRoYXQgdGhlIHZhbHVlIHR5cGUgTVVTVCBiZSBlaXRoZXJcbiAqIGJvb2xlYW4sIG51bWJlciwgb3Igc3RyaW5nLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIFRoZSBkaXN0aW5ndWlzaGVkIG5hbWUgdG8gcHJvdmlkZS5cbiAqIEBwYXJhbSB7VH0gZGVmYXVsdFZhbHVlXG4gKiBAcmV0dXJuIHtUfSBUaGUgZGVmaW5lZCB2YWx1ZS5cbiAqIEB0ZW1wbGF0ZSBUXG4gKi9cbmdvb2cuZGVmaW5lID0gZnVuY3Rpb24obmFtZSwgZGVmYXVsdFZhbHVlKSB7XG4gIHZhciB2YWx1ZSA9IGRlZmF1bHRWYWx1ZTtcbiAgaWYgKCFDT01QSUxFRCkge1xuICAgIHZhciB1bmNvbXBpbGVkRGVmaW5lcyA9IGdvb2cuZ2xvYmFsLkNMT1NVUkVfVU5DT01QSUxFRF9ERUZJTkVTO1xuICAgIHZhciBkZWZpbmVzID0gZ29vZy5nbG9iYWwuQ0xPU1VSRV9ERUZJTkVTO1xuICAgIGlmICh1bmNvbXBpbGVkRGVmaW5lcyAmJlxuICAgICAgICAvLyBBbnRpIERPTS1jbG9iYmVyaW5nIHJ1bnRpbWUgY2hlY2sgKGIvMzc3MzY1NzYpLlxuICAgICAgICAvKiogQHR5cGUgez99ICovICh1bmNvbXBpbGVkRGVmaW5lcykubm9kZVR5cGUgPT09IHVuZGVmaW5lZCAmJlxuICAgICAgICBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwodW5jb21waWxlZERlZmluZXMsIG5hbWUpKSB7XG4gICAgICB2YWx1ZSA9IHVuY29tcGlsZWREZWZpbmVzW25hbWVdO1xuICAgIH0gZWxzZSBpZiAoXG4gICAgICAgIGRlZmluZXMgJiZcbiAgICAgICAgLy8gQW50aSBET00tY2xvYmJlcmluZyBydW50aW1lIGNoZWNrIChiLzM3NzM2NTc2KS5cbiAgICAgICAgLyoqIEB0eXBlIHs/fSAqLyAoZGVmaW5lcykubm9kZVR5cGUgPT09IHVuZGVmaW5lZCAmJlxuICAgICAgICBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZGVmaW5lcywgbmFtZSkpIHtcbiAgICAgIHZhbHVlID0gZGVmaW5lc1tuYW1lXTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHZhbHVlO1xufTtcblxuXG4vKipcbiAqIEBkZWZpbmUge251bWJlcn0gSW50ZWdlciB5ZWFyIGluZGljYXRpbmcgdGhlIHNldCBvZiBicm93c2VyIGZlYXR1cmVzIHRoYXQgYXJlXG4gKiBndWFyYW50ZWVkIHRvIGJlIHByZXNlbnQuICBUaGlzIGlzIGRlZmluZWQgdG8gaW5jbHVkZSBleGFjdGx5IGZlYXR1cmVzIHRoYXRcbiAqIHdvcmsgY29ycmVjdGx5IG9uIGFsbCBcIm1vZGVyblwiIGJyb3dzZXJzIHRoYXQgYXJlIHN0YWJsZSBvbiBKYW51YXJ5IDEgb2YgdGhlXG4gKiBzcGVjaWZpZWQgeWVhci4gIEZvciBleGFtcGxlLFxuICogYGBganNcbiAqIGlmIChnb29nLkZFQVRVUkVTRVRfWUVBUiA+PSAyMDE5KSB7XG4gKiAgIC8vIHVzZSBBUElzIGtub3duIHRvIGJlIGF2YWlsYWJsZSBvbiBhbGwgbWFqb3Igc3RhYmxlIGJyb3dzZXJzIEphbiAxLCAyMDE5XG4gKiB9IGVsc2Uge1xuICogICAvLyBwb2x5ZmlsbCBmb3Igb2xkZXIgYnJvd3NlcnNcbiAqIH1cbiAqIGBgYFxuICogVGhpcyBpcyBpbnRlbmRlZCB0byBiZSB0aGUgcHJpbWFyeSBkZWZpbmUgZm9yIHJlbW92aW5nXG4gKiB1bm5lY2Vzc2FyeSBicm93c2VyIGNvbXBhdGliaWxpdHkgY29kZSAoc3VjaCBhcyBwb255ZmlsbHMgYW5kIHdvcmthcm91bmRzKSxcbiAqIGFuZCBzaG91bGQgaW5mb3JtIHRoZSBkZWZhdWx0IHZhbHVlIGZvciBtb3N0IG90aGVyIGRlZmluZXM6XG4gKiBgYGBqc1xuICogY29uc3QgQVNTVU1FX05BVElWRV9QUk9NSVNFID1cbiAqICAgICBnb29nLmRlZmluZSgnQVNTVU1FX05BVElWRV9QUk9NSVNFJywgZ29vZy5GRUFUVVJFU0VUX1lFQVIgPj0gMjAxNik7XG4gKiBgYGBcbiAqXG4gKiBUaGUgZGVmYXVsdCBhc3N1bXB0aW9uIGlzIHRoYXQgSUU5IGlzIHRoZSBsb3dlc3Qgc3VwcG9ydGVkIGJyb3dzZXIsIHdoaWNoIHdhc1xuICogZmlyc3QgYXZhaWxhYmxlIEphbiAxLCAyMDEyLlxuICpcbiAqIFRPRE8odXNlcik6IFJlZmVyZW5jZSBtb3JlIHRob3JvdWdoIGRvY3VtZW50YXRpb24gd2hlbiBpdCdzIGF2YWlsYWJsZS5cbiAqL1xuZ29vZy5GRUFUVVJFU0VUX1lFQVIgPSBnb29nLmRlZmluZSgnZ29vZy5GRUFUVVJFU0VUX1lFQVInLCAyMDEyKTtcblxuXG4vKipcbiAqIEBkZWZpbmUge2Jvb2xlYW59IERFQlVHIGlzIHByb3ZpZGVkIGFzIGEgY29udmVuaWVuY2Ugc28gdGhhdCBkZWJ1Z2dpbmcgY29kZVxuICogdGhhdCBzaG91bGQgbm90IGJlIGluY2x1ZGVkIGluIGEgcHJvZHVjdGlvbi4gSXQgY2FuIGJlIGVhc2lseSBzdHJpcHBlZFxuICogYnkgc3BlY2lmeWluZyAtLWRlZmluZSBnb29nLkRFQlVHPWZhbHNlIHRvIHRoZSBDbG9zdXJlIENvbXBpbGVyIGFrYVxuICogSlNDb21waWxlci4gRm9yIGV4YW1wbGUsIG1vc3QgdG9TdHJpbmcoKSBtZXRob2RzIHNob3VsZCBiZSBkZWNsYXJlZCBpbnNpZGUgYW5cbiAqIFwiaWYgKGdvb2cuREVCVUcpXCIgY29uZGl0aW9uYWwgYmVjYXVzZSB0aGV5IGFyZSBnZW5lcmFsbHkgdXNlZCBmb3IgZGVidWdnaW5nXG4gKiBwdXJwb3NlcyBhbmQgaXQgaXMgZGlmZmljdWx0IGZvciB0aGUgSlNDb21waWxlciB0byBzdGF0aWNhbGx5IGRldGVybWluZVxuICogd2hldGhlciB0aGV5IGFyZSB1c2VkLlxuICovXG5nb29nLkRFQlVHID0gZ29vZy5kZWZpbmUoJ2dvb2cuREVCVUcnLCB0cnVlKTtcblxuXG4vKipcbiAqIEBkZWZpbmUge3N0cmluZ30gTE9DQUxFIGRlZmluZXMgdGhlIGxvY2FsZSBiZWluZyB1c2VkIGZvciBjb21waWxhdGlvbi4gSXQgaXNcbiAqIHVzZWQgdG8gc2VsZWN0IGxvY2FsZSBzcGVjaWZpYyBkYXRhIHRvIGJlIGNvbXBpbGVkIGluIGpzIGJpbmFyeS4gQlVJTEQgcnVsZVxuICogY2FuIHNwZWNpZnkgdGhpcyB2YWx1ZSBieSBcIi0tZGVmaW5lIGdvb2cuTE9DQUxFPTxsb2NhbGVfbmFtZT5cIiBhcyBhIGNvbXBpbGVyXG4gKiBvcHRpb24uXG4gKlxuICogVGFrZSBpbnRvIGFjY291bnQgdGhhdCB0aGUgbG9jYWxlIGNvZGUgZm9ybWF0IGlzIGltcG9ydGFudC4gWW91IHNob3VsZCB1c2VcbiAqIHRoZSBjYW5vbmljYWwgVW5pY29kZSBmb3JtYXQgd2l0aCBoeXBoZW4gYXMgYSBkZWxpbWl0ZXIuIExhbmd1YWdlIG11c3QgYmVcbiAqIGxvd2VyY2FzZSwgTGFuZ3VhZ2UgU2NyaXB0IC0gQ2FwaXRhbGl6ZWQsIFJlZ2lvbiAtIFVQUEVSQ0FTRS5cbiAqIFRoZXJlIGFyZSBmZXcgZXhhbXBsZXM6IHB0LUJSLCBlbiwgZW4tVVMsIHNyLUxhdGluLUJPLCB6aC1IYW5zLUNOLlxuICpcbiAqIFNlZSBtb3JlIGluZm8gYWJvdXQgbG9jYWxlIGNvZGVzIGhlcmU6XG4gKiBodHRwOi8vd3d3LnVuaWNvZGUub3JnL3JlcG9ydHMvdHIzNS8jVW5pY29kZV9MYW5ndWFnZV9hbmRfTG9jYWxlX0lkZW50aWZpZXJzXG4gKlxuICogRm9yIGxhbmd1YWdlIGNvZGVzIHlvdSBzaG91bGQgdXNlIHZhbHVlcyBkZWZpbmVkIGJ5IElTTyA2OTMtMS4gU2VlIGl0IGhlcmVcbiAqIGh0dHA6Ly93d3cudzMub3JnL1dBSS9FUi9JRy9lcnQvaXNvNjM5Lmh0bS4gVGhlcmUgaXMgb25seSBvbmUgZXhjZXB0aW9uIGZyb21cbiAqIHRoaXMgcnVsZTogdGhlIEhlYnJldyBsYW5ndWFnZS4gRm9yIGxlZ2FjeSByZWFzb25zIHRoZSBvbGQgY29kZSAoaXcpIHNob3VsZFxuICogYmUgdXNlZCBpbnN0ZWFkIG9mIHRoZSBuZXcgY29kZSAoaGUpLlxuICpcbiAqL1xuZ29vZy5MT0NBTEUgPSBnb29nLmRlZmluZSgnZ29vZy5MT0NBTEUnLCAnZW4nKTsgIC8vIGRlZmF1bHQgdG8gZW5cblxuXG4vKipcbiAqIEBkZWZpbmUge2Jvb2xlYW59IFdoZXRoZXIgdGhpcyBjb2RlIGlzIHJ1bm5pbmcgb24gdHJ1c3RlZCBzaXRlcy5cbiAqXG4gKiBPbiB1bnRydXN0ZWQgc2l0ZXMsIHNldmVyYWwgbmF0aXZlIGZ1bmN0aW9ucyBjYW4gYmUgZGVmaW5lZCBvciBvdmVycmlkZGVuIGJ5XG4gKiBleHRlcm5hbCBsaWJyYXJpZXMgbGlrZSBQcm90b3R5cGUsIERhdGVqcywgYW5kIEpRdWVyeSBhbmQgc2V0dGluZyB0aGlzIGZsYWdcbiAqIHRvIGZhbHNlIGZvcmNlcyBjbG9zdXJlIHRvIHVzZSBpdHMgb3duIGltcGxlbWVudGF0aW9ucyB3aGVuIHBvc3NpYmxlLlxuICpcbiAqIElmIHlvdXIgSmF2YVNjcmlwdCBjYW4gYmUgbG9hZGVkIGJ5IGEgdGhpcmQgcGFydHkgc2l0ZSBhbmQgeW91IGFyZSB3YXJ5IGFib3V0XG4gKiByZWx5aW5nIG9uIG5vbi1zdGFuZGFyZCBpbXBsZW1lbnRhdGlvbnMsIHNwZWNpZnlcbiAqIFwiLS1kZWZpbmUgZ29vZy5UUlVTVEVEX1NJVEU9ZmFsc2VcIiB0byB0aGUgY29tcGlsZXIuXG4gKi9cbmdvb2cuVFJVU1RFRF9TSVRFID0gZ29vZy5kZWZpbmUoJ2dvb2cuVFJVU1RFRF9TSVRFJywgdHJ1ZSk7XG5cblxuLyoqXG4gKiBAZGVmaW5lIHtib29sZWFufSBXaGV0aGVyIGNvZGUgdGhhdCBjYWxscyB7QGxpbmsgZ29vZy5zZXRUZXN0T25seX0gc2hvdWxkXG4gKiAgICAgYmUgZGlzYWxsb3dlZCBpbiB0aGUgY29tcGlsYXRpb24gdW5pdC5cbiAqL1xuZ29vZy5ESVNBTExPV19URVNUX09OTFlfQ09ERSA9XG4gICAgZ29vZy5kZWZpbmUoJ2dvb2cuRElTQUxMT1dfVEVTVF9PTkxZX0NPREUnLCBDT01QSUxFRCAmJiAhZ29vZy5ERUJVRyk7XG5cblxuLyoqXG4gKiBAZGVmaW5lIHtib29sZWFufSBXaGV0aGVyIHRvIHVzZSBhIENocm9tZSBhcHAgQ1NQLWNvbXBsaWFudCBtZXRob2QgZm9yXG4gKiAgICAgbG9hZGluZyBzY3JpcHRzIHZpYSBnb29nLnJlcXVpcmUuIEBzZWUgYXBwZW5kU2NyaXB0U3JjTm9kZV8uXG4gKi9cbmdvb2cuRU5BQkxFX0NIUk9NRV9BUFBfU0FGRV9TQ1JJUFRfTE9BRElORyA9XG4gICAgZ29vZy5kZWZpbmUoJ2dvb2cuRU5BQkxFX0NIUk9NRV9BUFBfU0FGRV9TQ1JJUFRfTE9BRElORycsIGZhbHNlKTtcblxuXG4vKipcbiAqIERlZmluZXMgYSBuYW1lc3BhY2UgaW4gQ2xvc3VyZS5cbiAqXG4gKiBBIG5hbWVzcGFjZSBtYXkgb25seSBiZSBkZWZpbmVkIG9uY2UgaW4gYSBjb2RlYmFzZS4gSXQgbWF5IGJlIGRlZmluZWQgdXNpbmdcbiAqIGdvb2cucHJvdmlkZSgpIG9yIGdvb2cubW9kdWxlKCkuXG4gKlxuICogVGhlIHByZXNlbmNlIG9mIG9uZSBvciBtb3JlIGdvb2cucHJvdmlkZSgpIGNhbGxzIGluIGEgZmlsZSBpbmRpY2F0ZXNcbiAqIHRoYXQgdGhlIGZpbGUgZGVmaW5lcyB0aGUgZ2l2ZW4gb2JqZWN0cy9uYW1lc3BhY2VzLlxuICogUHJvdmlkZWQgc3ltYm9scyBtdXN0IG5vdCBiZSBudWxsIG9yIHVuZGVmaW5lZC5cbiAqXG4gKiBJbiBhZGRpdGlvbiwgZ29vZy5wcm92aWRlKCkgY3JlYXRlcyB0aGUgb2JqZWN0IHN0dWJzIGZvciBhIG5hbWVzcGFjZVxuICogKGZvciBleGFtcGxlLCBnb29nLnByb3ZpZGUoXCJnb29nLmZvby5iYXJcIikgd2lsbCBjcmVhdGUgdGhlIG9iamVjdFxuICogZ29vZy5mb28uYmFyIGlmIGl0IGRvZXMgbm90IGFscmVhZHkgZXhpc3QpLlxuICpcbiAqIEJ1aWxkIHRvb2xzIGFsc28gc2NhbiBmb3IgcHJvdmlkZS9yZXF1aXJlL21vZHVsZSBzdGF0ZW1lbnRzXG4gKiB0byBkaXNjZXJuIGRlcGVuZGVuY2llcywgYnVpbGQgZGVwZW5kZW5jeSBmaWxlcyAoc2VlIGRlcHMuanMpLCBldGMuXG4gKlxuICogQHNlZSBnb29nLnJlcXVpcmVcbiAqIEBzZWUgZ29vZy5tb2R1bGVcbiAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIE5hbWVzcGFjZSBwcm92aWRlZCBieSB0aGlzIGZpbGUgaW4gdGhlIGZvcm1cbiAqICAgICBcImdvb2cucGFja2FnZS5wYXJ0XCIuXG4gKiBkZXByZWNhdGVkIFVzZSBnb29nLm1vZHVsZSAoc2VlIGIvMTU5Mjg5NDA1KVxuICovXG5nb29nLnByb3ZpZGUgPSBmdW5jdGlvbihuYW1lKSB7XG4gIGlmIChnb29nLmlzSW5Nb2R1bGVMb2FkZXJfKCkpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ2dvb2cucHJvdmlkZSBjYW5ub3QgYmUgdXNlZCB3aXRoaW4gYSBtb2R1bGUuJyk7XG4gIH1cbiAgaWYgKCFDT01QSUxFRCkge1xuICAgIC8vIEVuc3VyZSB0aGF0IHRoZSBzYW1lIG5hbWVzcGFjZSBpc24ndCBwcm92aWRlZCB0d2ljZS5cbiAgICAvLyBBIGdvb2cubW9kdWxlL2dvb2cucHJvdmlkZSBtYXBzIGEgZ29vZy5yZXF1aXJlIHRvIGEgc3BlY2lmaWMgZmlsZVxuICAgIGlmIChnb29nLmlzUHJvdmlkZWRfKG5hbWUpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ05hbWVzcGFjZSBcIicgKyBuYW1lICsgJ1wiIGFscmVhZHkgZGVjbGFyZWQuJyk7XG4gICAgfVxuICB9XG5cbiAgZ29vZy5jb25zdHJ1Y3ROYW1lc3BhY2VfKG5hbWUpO1xufTtcblxuXG4vKipcbiAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIE5hbWVzcGFjZSBwcm92aWRlZCBieSB0aGlzIGZpbGUgaW4gdGhlIGZvcm1cbiAqICAgICBcImdvb2cucGFja2FnZS5wYXJ0XCIuXG4gKiBAcGFyYW0gez9PYmplY3Q9fSBvYmplY3QgVGhlIG9iamVjdCB0byBlbWJlZCBpbiB0aGUgbmFtZXNwYWNlLlxuICogQHBhcmFtIHtib29sZWFuPX0gb3ZlcndyaXRlSW1wbGljaXQgSWYgb2JqZWN0IGlzIHNldCBhbmQgYSBwcmV2aW91cyBjYWxsXG4gKiAgICAgaW1wbGljaXRseSBjb25zdHJ1Y3RlZCB0aGUgbmFtZXNwYWNlIGdpdmVuIGJ5IG5hbWUsIHRoaXMgcGFyYW1ldGVyXG4gKiAgICAgY29udHJvbHMgd2hldGhlciBvcHRfb2JqIHNob3VsZCBvdmVyd3JpdGUgdGhlIGltcGxpY2l0bHkgY29uc3RydWN0ZWRcbiAqICAgICBuYW1lc3BhY2Ugb3IgYmUgbWVyZ2VkIGludG8gaXQuIERlZmF1bHRzIHRvIGZhbHNlLlxuICogQHByaXZhdGVcbiAqL1xuZ29vZy5jb25zdHJ1Y3ROYW1lc3BhY2VfID0gZnVuY3Rpb24obmFtZSwgb2JqZWN0LCBvdmVyd3JpdGVJbXBsaWNpdCkge1xuICBpZiAoIUNPTVBJTEVEKSB7XG4gICAgZGVsZXRlIGdvb2cuaW1wbGljaXROYW1lc3BhY2VzX1tuYW1lXTtcblxuICAgIHZhciBuYW1lc3BhY2UgPSBuYW1lO1xuICAgIHdoaWxlICgobmFtZXNwYWNlID0gbmFtZXNwYWNlLnN1YnN0cmluZygwLCBuYW1lc3BhY2UubGFzdEluZGV4T2YoJy4nKSkpKSB7XG4gICAgICBpZiAoZ29vZy5nZXRPYmplY3RCeU5hbWUobmFtZXNwYWNlKSkge1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGdvb2cuaW1wbGljaXROYW1lc3BhY2VzX1tuYW1lc3BhY2VdID0gdHJ1ZTtcbiAgICB9XG4gIH1cblxuICBnb29nLmV4cG9ydFBhdGhfKG5hbWUsIG9iamVjdCwgb3ZlcndyaXRlSW1wbGljaXQpO1xufTtcblxuXG4vKipcbiAqIFJldHVybnMgQ1NQIG5vbmNlLCBpZiBzZXQgZm9yIGFueSBzY3JpcHQgdGFnLlxuICogQHBhcmFtIHs/V2luZG93PX0gb3B0X3dpbmRvdyBUaGUgd2luZG93IGNvbnRleHQgdXNlZCB0byByZXRyaWV2ZSB0aGUgbm9uY2UuXG4gKiAgICAgRGVmYXVsdHMgdG8gZ2xvYmFsIGNvbnRleHQuXG4gKiBAcmV0dXJuIHtzdHJpbmd9IENTUCBub25jZSBvciBlbXB0eSBzdHJpbmcgaWYgbm8gbm9uY2UgaXMgcHJlc2VudC5cbiAqL1xuZ29vZy5nZXRTY3JpcHROb25jZSA9IGZ1bmN0aW9uKG9wdF93aW5kb3cpIHtcbiAgaWYgKG9wdF93aW5kb3cgJiYgb3B0X3dpbmRvdyAhPSBnb29nLmdsb2JhbCkge1xuICAgIHJldHVybiBnb29nLmdldFNjcmlwdE5vbmNlXyhvcHRfd2luZG93LmRvY3VtZW50KTtcbiAgfVxuICBpZiAoZ29vZy5jc3BOb25jZV8gPT09IG51bGwpIHtcbiAgICBnb29nLmNzcE5vbmNlXyA9IGdvb2cuZ2V0U2NyaXB0Tm9uY2VfKGdvb2cuZ2xvYmFsLmRvY3VtZW50KTtcbiAgfVxuICByZXR1cm4gZ29vZy5jc3BOb25jZV87XG59O1xuXG5cbi8qKlxuICogQWNjb3JkaW5nIHRvIHRoZSBDU1AzIHNwZWMgYSBub25jZSBtdXN0IGJlIGEgdmFsaWQgYmFzZTY0IHN0cmluZy5cbiAqIEBzZWUgaHR0cHM6Ly93d3cudzMub3JnL1RSL0NTUDMvI2dyYW1tYXJkZWYtYmFzZTY0LXZhbHVlXG4gKiBAcHJpdmF0ZSBAY29uc3RcbiAqL1xuZ29vZy5OT05DRV9QQVRURVJOXyA9IC9eW1xcdysvXy1dK1s9XXswLDJ9JC87XG5cblxuLyoqXG4gKiBAcHJpdmF0ZSB7P3N0cmluZ31cbiAqL1xuZ29vZy5jc3BOb25jZV8gPSBudWxsO1xuXG5cbi8qKlxuICogUmV0dXJucyBDU1Agbm9uY2UsIGlmIHNldCBmb3IgYW55IHNjcmlwdCB0YWcuXG4gKiBAcGFyYW0geyFEb2N1bWVudH0gZG9jXG4gKiBAcmV0dXJuIHtzdHJpbmd9IENTUCBub25jZSBvciBlbXB0eSBzdHJpbmcgaWYgbm8gbm9uY2UgaXMgcHJlc2VudC5cbiAqIEBwcml2YXRlXG4gKi9cbmdvb2cuZ2V0U2NyaXB0Tm9uY2VfID0gZnVuY3Rpb24oZG9jKSB7XG4gIHZhciBzY3JpcHQgPSBkb2MucXVlcnlTZWxlY3RvciAmJiBkb2MucXVlcnlTZWxlY3Rvcignc2NyaXB0W25vbmNlXScpO1xuICBpZiAoc2NyaXB0KSB7XG4gICAgLy8gVHJ5IHRvIGdldCB0aGUgbm9uY2UgZnJvbSB0aGUgSURMIHByb3BlcnR5IGZpcnN0LCBiZWNhdXNlIGJyb3dzZXJzIHRoYXRcbiAgICAvLyBpbXBsZW1lbnQgYWRkaXRpb25hbCBub25jZSBwcm90ZWN0aW9uIGZlYXR1cmVzIChjdXJyZW50bHkgb25seSBDaHJvbWUpIHRvXG4gICAgLy8gcHJldmVudCBub25jZSBzdGVhbGluZyB2aWEgQ1NTIGRvIG5vdCBleHBvc2UgdGhlIG5vbmNlIHZpYSBhdHRyaWJ1dGVzLlxuICAgIC8vIFNlZSBodHRwczovL2dpdGh1Yi5jb20vd2hhdHdnL2h0bWwvaXNzdWVzLzIzNjlcbiAgICB2YXIgbm9uY2UgPSBzY3JpcHRbJ25vbmNlJ10gfHwgc2NyaXB0LmdldEF0dHJpYnV0ZSgnbm9uY2UnKTtcbiAgICBpZiAobm9uY2UgJiYgZ29vZy5OT05DRV9QQVRURVJOXy50ZXN0KG5vbmNlKSkge1xuICAgICAgcmV0dXJuIG5vbmNlO1xuICAgIH1cbiAgfVxuICByZXR1cm4gJyc7XG59O1xuXG5cbi8qKlxuICogTW9kdWxlIGlkZW50aWZpZXIgdmFsaWRhdGlvbiByZWdleHAuXG4gKiBOb3RlOiBUaGlzIGlzIGEgY29uc2VydmF0aXZlIGNoZWNrLCBpdCBpcyB2ZXJ5IHBvc3NpYmxlIHRvIGJlIG1vcmUgbGVuaWVudCxcbiAqICAgdGhlIHByaW1hcnkgZXhjbHVzaW9uIGhlcmUgaXMgXCIvXCIgYW5kIFwiXFxcIiBhbmQgYSBsZWFkaW5nIFwiLlwiLCB0aGVzZVxuICogICByZXN0cmljdGlvbnMgYXJlIGludGVuZGVkIHRvIGxlYXZlIHRoZSBkb29yIG9wZW4gZm9yIHVzaW5nIGdvb2cucmVxdWlyZVxuICogICB3aXRoIHJlbGF0aXZlIGZpbGUgcGF0aHMgcmF0aGVyIHRoYW4gbW9kdWxlIGlkZW50aWZpZXJzLlxuICogQHByaXZhdGVcbiAqL1xuZ29vZy5WQUxJRF9NT0RVTEVfUkVfID0gL15bYS16QS1aXyRdW2EtekEtWjAtOS5fJF0qJC87XG5cblxuLyoqXG4gKiBEZWZpbmVzIGEgbW9kdWxlIGluIENsb3N1cmUuXG4gKlxuICogTWFya3MgdGhhdCB0aGlzIGZpbGUgbXVzdCBiZSBsb2FkZWQgYXMgYSBtb2R1bGUgYW5kIGNsYWltcyB0aGUgbmFtZXNwYWNlLlxuICpcbiAqIEEgbmFtZXNwYWNlIG1heSBvbmx5IGJlIGRlZmluZWQgb25jZSBpbiBhIGNvZGViYXNlLiBJdCBtYXkgYmUgZGVmaW5lZCB1c2luZ1xuICogZ29vZy5wcm92aWRlKCkgb3IgZ29vZy5tb2R1bGUoKS5cbiAqXG4gKiBnb29nLm1vZHVsZSgpIGhhcyB0aHJlZSByZXF1aXJlbWVudHM6XG4gKiAtIGdvb2cubW9kdWxlIG1heSBub3QgYmUgdXNlZCBpbiB0aGUgc2FtZSBmaWxlIGFzIGdvb2cucHJvdmlkZS5cbiAqIC0gZ29vZy5tb2R1bGUgbXVzdCBiZSB0aGUgZmlyc3Qgc3RhdGVtZW50IGluIHRoZSBmaWxlLlxuICogLSBvbmx5IG9uZSBnb29nLm1vZHVsZSBpcyBhbGxvd2VkIHBlciBmaWxlLlxuICpcbiAqIFdoZW4gYSBnb29nLm1vZHVsZSBhbm5vdGF0ZWQgZmlsZSBpcyBsb2FkZWQsIGl0IGlzIGVuY2xvc2VkIGluXG4gKiBhIHN0cmljdCBmdW5jdGlvbiBjbG9zdXJlLiBUaGlzIG1lYW5zIHRoYXQ6XG4gKiAtIGFueSB2YXJpYWJsZXMgZGVjbGFyZWQgaW4gYSBnb29nLm1vZHVsZSBmaWxlIGFyZSBwcml2YXRlIHRvIHRoZSBmaWxlXG4gKiAobm90IGdsb2JhbCksIHRob3VnaCB0aGUgY29tcGlsZXIgaXMgZXhwZWN0ZWQgdG8gaW5saW5lIHRoZSBtb2R1bGUuXG4gKiAtIFRoZSBjb2RlIG11c3Qgb2JleSBhbGwgdGhlIHJ1bGVzIG9mIFwic3RyaWN0XCIgSmF2YVNjcmlwdC5cbiAqIC0gdGhlIGZpbGUgd2lsbCBiZSBtYXJrZWQgYXMgXCJ1c2Ugc3RyaWN0XCJcbiAqXG4gKiBOT1RFOiB1bmxpa2UgZ29vZy5wcm92aWRlLCBnb29nLm1vZHVsZSBkb2VzIG5vdCBkZWNsYXJlIGFueSBzeW1ib2xzIGJ5XG4gKiBpdHNlbGYuIElmIGRlY2xhcmVkIHN5bWJvbHMgYXJlIGRlc2lyZWQsIHVzZVxuICogZ29vZy5tb2R1bGUuZGVjbGFyZUxlZ2FjeU5hbWVzcGFjZSgpLlxuICpcbiAqXG4gKiBTZWUgdGhlIHB1YmxpYyBnb29nLm1vZHVsZSBwcm9wb3NhbDogaHR0cDovL2dvby5nbC9WYTFoaW5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gbmFtZSBOYW1lc3BhY2UgcHJvdmlkZWQgYnkgdGhpcyBmaWxlIGluIHRoZSBmb3JtXG4gKiAgICAgXCJnb29nLnBhY2thZ2UucGFydFwiLCBpcyBleHBlY3RlZCBidXQgbm90IHJlcXVpcmVkLlxuICogQHJldHVybiB7dm9pZH1cbiAqL1xuZ29vZy5tb2R1bGUgPSBmdW5jdGlvbihuYW1lKSB7XG4gIGlmICh0eXBlb2YgbmFtZSAhPT0gJ3N0cmluZycgfHwgIW5hbWUgfHxcbiAgICAgIG5hbWUuc2VhcmNoKGdvb2cuVkFMSURfTU9EVUxFX1JFXykgPT0gLTEpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgbW9kdWxlIGlkZW50aWZpZXInKTtcbiAgfVxuICBpZiAoIWdvb2cuaXNJbkdvb2dNb2R1bGVMb2FkZXJfKCkpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICdNb2R1bGUgJyArIG5hbWUgKyAnIGhhcyBiZWVuIGxvYWRlZCBpbmNvcnJlY3RseS4gTm90ZSwgJyArXG4gICAgICAgICdtb2R1bGVzIGNhbm5vdCBiZSBsb2FkZWQgYXMgbm9ybWFsIHNjcmlwdHMuIFRoZXkgcmVxdWlyZSBzb21lIGtpbmQgb2YgJyArXG4gICAgICAgICdwcmUtcHJvY2Vzc2luZyBzdGVwLiBZb3VcXCdyZSBsaWtlbHkgdHJ5aW5nIHRvIGxvYWQgYSBtb2R1bGUgdmlhIGEgJyArXG4gICAgICAgICdzY3JpcHQgdGFnIG9yIGFzIGEgcGFydCBvZiBhIGNvbmNhdGVuYXRlZCBidW5kbGUgd2l0aG91dCByZXdyaXRpbmcgdGhlICcgK1xuICAgICAgICAnbW9kdWxlLiBGb3IgbW9yZSBpbmZvIHNlZTogJyArXG4gICAgICAgICdodHRwczovL2dpdGh1Yi5jb20vZ29vZ2xlL2Nsb3N1cmUtbGlicmFyeS93aWtpL2dvb2cubW9kdWxlOi1hbi1FUzYtbW9kdWxlLWxpa2UtYWx0ZXJuYXRpdmUtdG8tZ29vZy5wcm92aWRlLicpO1xuICB9XG4gIGlmIChnb29nLm1vZHVsZUxvYWRlclN0YXRlXy5tb2R1bGVOYW1lKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdnb29nLm1vZHVsZSBtYXkgb25seSBiZSBjYWxsZWQgb25jZSBwZXIgbW9kdWxlLicpO1xuICB9XG5cbiAgLy8gU3RvcmUgdGhlIG1vZHVsZSBuYW1lIGZvciB0aGUgbG9hZGVyLlxuICBnb29nLm1vZHVsZUxvYWRlclN0YXRlXy5tb2R1bGVOYW1lID0gbmFtZTtcbiAgaWYgKCFDT01QSUxFRCkge1xuICAgIC8vIEVuc3VyZSB0aGF0IHRoZSBzYW1lIG5hbWVzcGFjZSBpc24ndCBwcm92aWRlZCB0d2ljZS5cbiAgICAvLyBBIGdvb2cubW9kdWxlL2dvb2cucHJvdmlkZSBtYXBzIGEgZ29vZy5yZXF1aXJlIHRvIGEgc3BlY2lmaWMgZmlsZVxuICAgIGlmIChnb29nLmlzUHJvdmlkZWRfKG5hbWUpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ05hbWVzcGFjZSBcIicgKyBuYW1lICsgJ1wiIGFscmVhZHkgZGVjbGFyZWQuJyk7XG4gICAgfVxuICAgIGRlbGV0ZSBnb29nLmltcGxpY2l0TmFtZXNwYWNlc19bbmFtZV07XG4gIH1cbn07XG5cblxuLyoqXG4gKiBAcGFyYW0ge3N0cmluZ30gbmFtZSBUaGUgbW9kdWxlIGlkZW50aWZpZXIuXG4gKiBAcmV0dXJuIHs/fSBUaGUgbW9kdWxlIGV4cG9ydHMgZm9yIGFuIGFscmVhZHkgbG9hZGVkIG1vZHVsZSBvciBudWxsLlxuICpcbiAqIE5vdGU6IFRoaXMgaXMgbm90IGFuIGFsdGVybmF0aXZlIHRvIGdvb2cucmVxdWlyZSwgaXQgZG9lcyBub3RcbiAqIGluZGljYXRlIGEgaGFyZCBkZXBlbmRlbmN5LCBpbnN0ZWFkIGl0IGlzIHVzZWQgdG8gaW5kaWNhdGVcbiAqIGFuIG9wdGlvbmFsIGRlcGVuZGVuY3kgb3IgdG8gYWNjZXNzIHRoZSBleHBvcnRzIG9mIGEgbW9kdWxlXG4gKiB0aGF0IGhhcyBhbHJlYWR5IGJlZW4gbG9hZGVkLlxuICogQHN1cHByZXNzIHttaXNzaW5nUHJvdmlkZX1cbiAqL1xuZ29vZy5tb2R1bGUuZ2V0ID0gZnVuY3Rpb24obmFtZSkge1xuICByZXR1cm4gZ29vZy5tb2R1bGUuZ2V0SW50ZXJuYWxfKG5hbWUpO1xufTtcblxuXG4vKipcbiAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIFRoZSBtb2R1bGUgaWRlbnRpZmllci5cbiAqIEByZXR1cm4gez99IFRoZSBtb2R1bGUgZXhwb3J0cyBmb3IgYW4gYWxyZWFkeSBsb2FkZWQgbW9kdWxlIG9yIG51bGwuXG4gKiBAcHJpdmF0ZVxuICovXG5nb29nLm1vZHVsZS5nZXRJbnRlcm5hbF8gPSBmdW5jdGlvbihuYW1lKSB7XG4gIGlmICghQ09NUElMRUQpIHtcbiAgICBpZiAobmFtZSBpbiBnb29nLmxvYWRlZE1vZHVsZXNfKSB7XG4gICAgICByZXR1cm4gZ29vZy5sb2FkZWRNb2R1bGVzX1tuYW1lXS5leHBvcnRzO1xuICAgIH0gZWxzZSBpZiAoIWdvb2cuaW1wbGljaXROYW1lc3BhY2VzX1tuYW1lXSkge1xuICAgICAgdmFyIG5zID0gZ29vZy5nZXRPYmplY3RCeU5hbWUobmFtZSk7XG4gICAgICByZXR1cm4gbnMgIT0gbnVsbCA/IG5zIDogbnVsbDtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIG51bGw7XG59O1xuXG5cbi8qKlxuICogVHlwZXMgb2YgbW9kdWxlcyB0aGUgZGVidWcgbG9hZGVyIGNhbiBsb2FkLlxuICogQGVudW0ge3N0cmluZ31cbiAqL1xuZ29vZy5Nb2R1bGVUeXBlID0ge1xuICBFUzY6ICdlczYnLFxuICBHT09HOiAnZ29vZydcbn07XG5cblxuLyoqXG4gKiBAcHJpdmF0ZSB7P3tcbiAqICAgbW9kdWxlTmFtZTogKHN0cmluZ3x1bmRlZmluZWQpLFxuICogICBkZWNsYXJlTGVnYWN5TmFtZXNwYWNlOmJvb2xlYW4sXG4gKiAgIHR5cGU6ID9nb29nLk1vZHVsZVR5cGVcbiAqIH19XG4gKi9cbmdvb2cubW9kdWxlTG9hZGVyU3RhdGVfID0gbnVsbDtcblxuXG4vKipcbiAqIEBwcml2YXRlXG4gKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIGEgZ29vZy5tb2R1bGUgb3IgYW4gZXM2IG1vZHVsZSBpcyBjdXJyZW50bHkgYmVpbmdcbiAqICAgICBpbml0aWFsaXplZC5cbiAqL1xuZ29vZy5pc0luTW9kdWxlTG9hZGVyXyA9IGZ1bmN0aW9uKCkge1xuICByZXR1cm4gZ29vZy5pc0luR29vZ01vZHVsZUxvYWRlcl8oKSB8fCBnb29nLmlzSW5FczZNb2R1bGVMb2FkZXJfKCk7XG59O1xuXG5cbi8qKlxuICogQHByaXZhdGVcbiAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgYSBnb29nLm1vZHVsZSBpcyBjdXJyZW50bHkgYmVpbmcgaW5pdGlhbGl6ZWQuXG4gKi9cbmdvb2cuaXNJbkdvb2dNb2R1bGVMb2FkZXJfID0gZnVuY3Rpb24oKSB7XG4gIHJldHVybiAhIWdvb2cubW9kdWxlTG9hZGVyU3RhdGVfICYmXG4gICAgICBnb29nLm1vZHVsZUxvYWRlclN0YXRlXy50eXBlID09IGdvb2cuTW9kdWxlVHlwZS5HT09HO1xufTtcblxuXG4vKipcbiAqIEBwcml2YXRlXG4gKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIGFuIGVzNiBtb2R1bGUgaXMgY3VycmVudGx5IGJlaW5nIGluaXRpYWxpemVkLlxuICovXG5nb29nLmlzSW5FczZNb2R1bGVMb2FkZXJfID0gZnVuY3Rpb24oKSB7XG4gIHZhciBpbkxvYWRlciA9ICEhZ29vZy5tb2R1bGVMb2FkZXJTdGF0ZV8gJiZcbiAgICAgIGdvb2cubW9kdWxlTG9hZGVyU3RhdGVfLnR5cGUgPT0gZ29vZy5Nb2R1bGVUeXBlLkVTNjtcblxuICBpZiAoaW5Mb2FkZXIpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIHZhciBqc2NvbXAgPSBnb29nLmdsb2JhbFsnJGpzY29tcCddO1xuXG4gIGlmIChqc2NvbXApIHtcbiAgICAvLyBqc2NvbXAgbWF5IG5vdCBoYXZlIGdldEN1cnJlbnRNb2R1bGVQYXRoIGlmIHRoaXMgaXMgYSBjb21waWxlZCBidW5kbGVcbiAgICAvLyB0aGF0IGhhcyBzb21lIG9mIHRoZSBydW50aW1lLCBidXQgbm90IGFsbCBvZiBpdC4gVGhpcyBjYW4gaGFwcGVuIGlmXG4gICAgLy8gb3B0aW1pemF0aW9ucyBhcmUgdHVybmVkIG9uIHNvIHRoZSB1bnVzZWQgcnVudGltZSBpcyByZW1vdmVkIGJ1dCByZW5hbWluZ1xuICAgIC8vIGFuZCBDbG9zdXJlIHBhc3MgYXJlIG9mZiAoc28gJGpzY29tcCBpcyBzdGlsbCBuYW1lZCAkanNjb21wIGFuZCB0aGVcbiAgICAvLyBnb29nLnByb3ZpZGUvcmVxdWlyZSBjYWxscyBzdGlsbCBleGlzdCkuXG4gICAgaWYgKHR5cGVvZiBqc2NvbXAuZ2V0Q3VycmVudE1vZHVsZVBhdGggIT0gJ2Z1bmN0aW9uJykge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIC8vIEJ1bmRsZWQgRVM2IG1vZHVsZS5cbiAgICByZXR1cm4gISFqc2NvbXAuZ2V0Q3VycmVudE1vZHVsZVBhdGgoKTtcbiAgfVxuXG4gIHJldHVybiBmYWxzZTtcbn07XG5cblxuLyoqXG4gKiBQcm92aWRlIHRoZSBtb2R1bGUncyBleHBvcnRzIGFzIGEgZ2xvYmFsbHkgYWNjZXNzaWJsZSBvYmplY3QgdW5kZXIgdGhlXG4gKiBtb2R1bGUncyBkZWNsYXJlZCBuYW1lLiAgVGhpcyBpcyBpbnRlbmRlZCB0byBlYXNlIG1pZ3JhdGlvbiB0byBnb29nLm1vZHVsZVxuICogZm9yIGZpbGVzIHRoYXQgaGF2ZSBleGlzdGluZyB1c2FnZXMuXG4gKiBAc3VwcHJlc3Mge21pc3NpbmdQcm92aWRlfVxuICovXG5nb29nLm1vZHVsZS5kZWNsYXJlTGVnYWN5TmFtZXNwYWNlID0gZnVuY3Rpb24oKSB7XG4gIGlmICghQ09NUElMRUQgJiYgIWdvb2cuaXNJbkdvb2dNb2R1bGVMb2FkZXJfKCkpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICdnb29nLm1vZHVsZS5kZWNsYXJlTGVnYWN5TmFtZXNwYWNlIG11c3QgYmUgY2FsbGVkIGZyb20gJyArXG4gICAgICAgICd3aXRoaW4gYSBnb29nLm1vZHVsZScpO1xuICB9XG4gIGlmICghQ09NUElMRUQgJiYgIWdvb2cubW9kdWxlTG9hZGVyU3RhdGVfLm1vZHVsZU5hbWUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICdnb29nLm1vZHVsZSBtdXN0IGJlIGNhbGxlZCBwcmlvciB0byAnICtcbiAgICAgICAgJ2dvb2cubW9kdWxlLmRlY2xhcmVMZWdhY3lOYW1lc3BhY2UuJyk7XG4gIH1cbiAgZ29vZy5tb2R1bGVMb2FkZXJTdGF0ZV8uZGVjbGFyZUxlZ2FjeU5hbWVzcGFjZSA9IHRydWU7XG59O1xuXG5cbi8qKlxuICogQXNzb2NpYXRlcyBhbiBFUzYgbW9kdWxlIHdpdGggYSBDbG9zdXJlIG1vZHVsZSBJRCBzbyB0aGF0IGlzIGF2YWlsYWJsZSB2aWFcbiAqIGdvb2cucmVxdWlyZS4gVGhlIGFzc29jaWF0ZWQgSUQgIGFjdHMgbGlrZSBhIGdvb2cubW9kdWxlIElEIC0gaXQgZG9lcyBub3RcbiAqIGNyZWF0ZSBhbnkgZ2xvYmFsIG5hbWVzLCBpdCBpcyBtZXJlbHkgYXZhaWxhYmxlIHZpYSBnb29nLnJlcXVpcmUgL1xuICogZ29vZy5tb2R1bGUuZ2V0IC8gZ29vZy5mb3J3YXJkRGVjbGFyZSAvIGdvb2cucmVxdWlyZVR5cGUuIGdvb2cucmVxdWlyZSBhbmRcbiAqIGdvb2cubW9kdWxlLmdldCB3aWxsIHJldHVybiB0aGUgZW50aXJlIG1vZHVsZSBhcyBpZiBpdCB3YXMgaW1wb3J0IConZC4gVGhpc1xuICogYWxsb3dzIENsb3N1cmUgZmlsZXMgdG8gcmVmZXJlbmNlIEVTNiBtb2R1bGVzIGZvciB0aGUgc2FrZSBvZiBtaWdyYXRpb24uXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IG5hbWVzcGFjZVxuICogQHN1cHByZXNzIHttaXNzaW5nUHJvdmlkZX1cbiAqL1xuZ29vZy5kZWNsYXJlTW9kdWxlSWQgPSBmdW5jdGlvbihuYW1lc3BhY2UpIHtcbiAgaWYgKCFDT01QSUxFRCkge1xuICAgIGlmICghZ29vZy5pc0luRXM2TW9kdWxlTG9hZGVyXygpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgJ2dvb2cuZGVjbGFyZU1vZHVsZUlkIG1heSBvbmx5IGJlIGNhbGxlZCBmcm9tICcgK1xuICAgICAgICAgICd3aXRoaW4gYW4gRVM2IG1vZHVsZScpO1xuICAgIH1cbiAgICBpZiAoZ29vZy5tb2R1bGVMb2FkZXJTdGF0ZV8gJiYgZ29vZy5tb2R1bGVMb2FkZXJTdGF0ZV8ubW9kdWxlTmFtZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICdnb29nLmRlY2xhcmVNb2R1bGVJZCBtYXkgb25seSBiZSBjYWxsZWQgb25jZSBwZXIgbW9kdWxlLicpO1xuICAgIH1cbiAgICBpZiAobmFtZXNwYWNlIGluIGdvb2cubG9hZGVkTW9kdWxlc18pIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAnTW9kdWxlIHdpdGggbmFtZXNwYWNlIFwiJyArIG5hbWVzcGFjZSArICdcIiBhbHJlYWR5IGV4aXN0cy4nKTtcbiAgICB9XG4gIH1cbiAgaWYgKGdvb2cubW9kdWxlTG9hZGVyU3RhdGVfKSB7XG4gICAgLy8gTm90IGJ1bmRsZWQgLSBkZWJ1ZyBsb2FkaW5nLlxuICAgIGdvb2cubW9kdWxlTG9hZGVyU3RhdGVfLm1vZHVsZU5hbWUgPSBuYW1lc3BhY2U7XG4gIH0gZWxzZSB7XG4gICAgLy8gQnVuZGxlZCAtIG5vdCBkZWJ1ZyBsb2FkaW5nLCBubyBtb2R1bGUgbG9hZGVyIHN0YXRlLlxuICAgIHZhciBqc2NvbXAgPSBnb29nLmdsb2JhbFsnJGpzY29tcCddO1xuICAgIGlmICghanNjb21wIHx8IHR5cGVvZiBqc2NvbXAuZ2V0Q3VycmVudE1vZHVsZVBhdGggIT0gJ2Z1bmN0aW9uJykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICdNb2R1bGUgd2l0aCBuYW1lc3BhY2UgXCInICsgbmFtZXNwYWNlICtcbiAgICAgICAgICAnXCIgaGFzIGJlZW4gbG9hZGVkIGluY29ycmVjdGx5LicpO1xuICAgIH1cbiAgICB2YXIgZXhwb3J0cyA9IGpzY29tcC5yZXF1aXJlKGpzY29tcC5nZXRDdXJyZW50TW9kdWxlUGF0aCgpKTtcbiAgICBnb29nLmxvYWRlZE1vZHVsZXNfW25hbWVzcGFjZV0gPSB7XG4gICAgICBleHBvcnRzOiBleHBvcnRzLFxuICAgICAgdHlwZTogZ29vZy5Nb2R1bGVUeXBlLkVTNixcbiAgICAgIG1vZHVsZUlkOiBuYW1lc3BhY2VcbiAgICB9O1xuICB9XG59O1xuXG5cbi8qKlxuICogTWFya3MgdGhhdCB0aGUgY3VycmVudCBmaWxlIHNob3VsZCBvbmx5IGJlIHVzZWQgZm9yIHRlc3RpbmcsIGFuZCBuZXZlciBmb3JcbiAqIGxpdmUgY29kZSBpbiBwcm9kdWN0aW9uLlxuICpcbiAqIEluIHRoZSBjYXNlIG9mIHVuaXQgdGVzdHMsIHRoZSBtZXNzYWdlIG1heSBvcHRpb25hbGx5IGJlIGFuIGV4YWN0IG5hbWVzcGFjZVxuICogZm9yIHRoZSB0ZXN0IChlLmcuICdnb29nLnN0cmluZ1Rlc3QnKS4gVGhlIGxpbnRlciB3aWxsIHRoZW4gaWdub3JlIHRoZSBleHRyYVxuICogcHJvdmlkZSAoaWYgbm90IGV4cGxpY2l0bHkgZGVmaW5lZCBpbiB0aGUgY29kZSkuXG4gKlxuICogQHBhcmFtIHtzdHJpbmc9fSBvcHRfbWVzc2FnZSBPcHRpb25hbCBtZXNzYWdlIHRvIGFkZCB0byB0aGUgZXJyb3IgdGhhdCdzXG4gKiAgICAgcmFpc2VkIHdoZW4gdXNlZCBpbiBwcm9kdWN0aW9uIGNvZGUuXG4gKi9cbmdvb2cuc2V0VGVzdE9ubHkgPSBmdW5jdGlvbihvcHRfbWVzc2FnZSkge1xuICBpZiAoZ29vZy5ESVNBTExPV19URVNUX09OTFlfQ09ERSkge1xuICAgIG9wdF9tZXNzYWdlID0gb3B0X21lc3NhZ2UgfHwgJyc7XG4gICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAnSW1wb3J0aW5nIHRlc3Qtb25seSBjb2RlIGludG8gbm9uLWRlYnVnIGVudmlyb25tZW50JyArXG4gICAgICAgIChvcHRfbWVzc2FnZSA/ICc6ICcgKyBvcHRfbWVzc2FnZSA6ICcuJykpO1xuICB9XG59O1xuXG5cbi8qKlxuICogRm9yd2FyZCBkZWNsYXJlcyBhIHN5bWJvbC4gVGhpcyBpcyBhbiBpbmRpY2F0aW9uIHRvIHRoZSBjb21waWxlciB0aGF0IHRoZVxuICogc3ltYm9sIG1heSBiZSB1c2VkIGluIHRoZSBzb3VyY2UgeWV0IGlzIG5vdCByZXF1aXJlZCBhbmQgbWF5IG5vdCBiZSBwcm92aWRlZFxuICogaW4gY29tcGlsYXRpb24uXG4gKlxuICogVGhlIG1vc3QgY29tbW9uIHVzYWdlIG9mIGZvcndhcmQgZGVjbGFyYXRpb24gaXMgY29kZSB0aGF0IHRha2VzIGEgdHlwZSBhcyBhXG4gKiBmdW5jdGlvbiBwYXJhbWV0ZXIgYnV0IGRvZXMgbm90IG5lZWQgdG8gcmVxdWlyZSBpdC4gQnkgZm9yd2FyZCBkZWNsYXJpbmdcbiAqIGluc3RlYWQgb2YgcmVxdWlyaW5nLCBubyBoYXJkIGRlcGVuZGVuY3kgaXMgbWFkZSwgYW5kIChpZiBub3QgcmVxdWlyZWRcbiAqIGVsc2V3aGVyZSkgdGhlIG5hbWVzcGFjZSBtYXkgbmV2ZXIgYmUgcmVxdWlyZWQgYW5kIHRodXMsIG5vdCBiZSBwdWxsZWRcbiAqIGludG8gdGhlIEphdmFTY3JpcHQgYmluYXJ5LiBJZiBpdCBpcyByZXF1aXJlZCBlbHNld2hlcmUsIGl0IHdpbGwgYmUgdHlwZVxuICogY2hlY2tlZCBhcyBub3JtYWwuXG4gKlxuICogQmVmb3JlIHVzaW5nIGdvb2cuZm9yd2FyZERlY2xhcmUsIHBsZWFzZSByZWFkIHRoZSBkb2N1bWVudGF0aW9uIGF0XG4gKiBodHRwczovL2dpdGh1Yi5jb20vZ29vZ2xlL2Nsb3N1cmUtY29tcGlsZXIvd2lraS9CYWQtVHlwZS1Bbm5vdGF0aW9uIHRvXG4gKiB1bmRlcnN0YW5kIHRoZSBvcHRpb25zIGFuZCB0cmFkZW9mZnMgd2hlbiB3b3JraW5nIHdpdGggZm9yd2FyZCBkZWNsYXJhdGlvbnMuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IG5hbWUgVGhlIG5hbWVzcGFjZSB0byBmb3J3YXJkIGRlY2xhcmUgaW4gdGhlIGZvcm0gb2ZcbiAqICAgICBcImdvb2cucGFja2FnZS5wYXJ0XCIuXG4gKiBAZGVwcmVjYXRlZCBTZWUgZ28vbm9mb3J3YXJkZGVjbGFyYXRpb24sIFVzZSBgZ29vZy5yZXF1aXJlVHlwZWAgaW5zdGVhZC5cbiAqL1xuZ29vZy5mb3J3YXJkRGVjbGFyZSA9IGZ1bmN0aW9uKG5hbWUpIHt9O1xuXG5cbi8qKlxuICogRm9yd2FyZCBkZWNsYXJlIHR5cGUgaW5mb3JtYXRpb24uIFVzZWQgdG8gYXNzaWduIHR5cGVzIHRvIGdvb2cuZ2xvYmFsXG4gKiByZWZlcmVuY2VkIG9iamVjdCB0aGF0IHdvdWxkIG90aGVyd2lzZSByZXN1bHQgaW4gdW5rbm93biB0eXBlIHJlZmVyZW5jZXNcbiAqIGFuZCB0aHVzIGJsb2NrIHByb3BlcnR5IGRpc2FtYmlndWF0aW9uLlxuICovXG5nb29nLmZvcndhcmREZWNsYXJlKCdEb2N1bWVudCcpO1xuZ29vZy5mb3J3YXJkRGVjbGFyZSgnSFRNTFNjcmlwdEVsZW1lbnQnKTtcbmdvb2cuZm9yd2FyZERlY2xhcmUoJ1hNTEh0dHBSZXF1ZXN0Jyk7XG5cblxuaWYgKCFDT01QSUxFRCkge1xuICAvKipcbiAgICogQ2hlY2sgaWYgdGhlIGdpdmVuIG5hbWUgaGFzIGJlZW4gZ29vZy5wcm92aWRlZC4gVGhpcyB3aWxsIHJldHVybiBmYWxzZSBmb3JcbiAgICogbmFtZXMgdGhhdCBhcmUgYXZhaWxhYmxlIG9ubHkgYXMgaW1wbGljaXQgbmFtZXNwYWNlcy5cbiAgICogQHBhcmFtIHtzdHJpbmd9IG5hbWUgbmFtZSBvZiB0aGUgb2JqZWN0IHRvIGxvb2sgZm9yLlxuICAgKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoZSBuYW1lIGhhcyBiZWVuIHByb3ZpZGVkLlxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgZ29vZy5pc1Byb3ZpZGVkXyA9IGZ1bmN0aW9uKG5hbWUpIHtcbiAgICByZXR1cm4gKG5hbWUgaW4gZ29vZy5sb2FkZWRNb2R1bGVzXykgfHxcbiAgICAgICAgKCFnb29nLmltcGxpY2l0TmFtZXNwYWNlc19bbmFtZV0gJiYgZ29vZy5nZXRPYmplY3RCeU5hbWUobmFtZSkgIT0gbnVsbCk7XG4gIH07XG5cbiAgLyoqXG4gICAqIE5hbWVzcGFjZXMgaW1wbGljaXRseSBkZWZpbmVkIGJ5IGdvb2cucHJvdmlkZS4gRm9yIGV4YW1wbGUsXG4gICAqIGdvb2cucHJvdmlkZSgnZ29vZy5ldmVudHMuRXZlbnQnKSBpbXBsaWNpdGx5IGRlY2xhcmVzIHRoYXQgJ2dvb2cnIGFuZFxuICAgKiAnZ29vZy5ldmVudHMnIG11c3QgYmUgbmFtZXNwYWNlcy5cbiAgICpcbiAgICogQHR5cGUgeyFPYmplY3Q8c3RyaW5nLCAoYm9vbGVhbnx1bmRlZmluZWQpPn1cbiAgICogQHByaXZhdGVcbiAgICovXG4gIGdvb2cuaW1wbGljaXROYW1lc3BhY2VzXyA9IHsnZ29vZy5tb2R1bGUnOiB0cnVlfTtcblxuICAvLyBOT1RFOiBXZSBhZGQgZ29vZy5tb2R1bGUgYXMgYW4gaW1wbGljaXQgbmFtZXNwYWNlIGFzIGdvb2cubW9kdWxlIGlzIGRlZmluZWRcbiAgLy8gaGVyZSBhbmQgYmVjYXVzZSB0aGUgZXhpc3RpbmcgbW9kdWxlIHBhY2thZ2UgaGFzIG5vdCBiZWVuIG1vdmVkIHlldCBvdXQgb2ZcbiAgLy8gdGhlIGdvb2cubW9kdWxlIG5hbWVzcGFjZS4gVGhpcyBzYXRpc2lmaWVzIGJvdGggdGhlIGRlYnVnIGxvYWRlciBhbmRcbiAgLy8gYWhlYWQtb2YtdGltZSBkZXBlbmRlbmN5IG1hbmFnZW1lbnQuXG59XG5cblxuLyoqXG4gKiBSZXR1cm5zIGFuIG9iamVjdCBiYXNlZCBvbiBpdHMgZnVsbHkgcXVhbGlmaWVkIGV4dGVybmFsIG5hbWUuICBUaGUgb2JqZWN0XG4gKiBpcyBub3QgZm91bmQgaWYgbnVsbCBvciB1bmRlZmluZWQuICBJZiB5b3UgYXJlIHVzaW5nIGEgY29tcGlsYXRpb24gcGFzcyB0aGF0XG4gKiByZW5hbWVzIHByb3BlcnR5IG5hbWVzIGJld2FyZSB0aGF0IHVzaW5nIHRoaXMgZnVuY3Rpb24gd2lsbCBub3QgZmluZCByZW5hbWVkXG4gKiBwcm9wZXJ0aWVzLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIFRoZSBmdWxseSBxdWFsaWZpZWQgbmFtZS5cbiAqIEBwYXJhbSB7T2JqZWN0PX0gb3B0X29iaiBUaGUgb2JqZWN0IHdpdGhpbiB3aGljaCB0byBsb29rOyBkZWZhdWx0IGlzXG4gKiAgICAgfGdvb2cuZ2xvYmFsfC5cbiAqIEByZXR1cm4gez99IFRoZSB2YWx1ZSAob2JqZWN0IG9yIHByaW1pdGl2ZSkgb3IsIGlmIG5vdCBmb3VuZCwgbnVsbC5cbiAqL1xuZ29vZy5nZXRPYmplY3RCeU5hbWUgPSBmdW5jdGlvbihuYW1lLCBvcHRfb2JqKSB7XG4gIHZhciBwYXJ0cyA9IG5hbWUuc3BsaXQoJy4nKTtcbiAgdmFyIGN1ciA9IG9wdF9vYmogfHwgZ29vZy5nbG9iYWw7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgcGFydHMubGVuZ3RoOyBpKyspIHtcbiAgICBjdXIgPSBjdXJbcGFydHNbaV1dO1xuICAgIGlmIChjdXIgPT0gbnVsbCkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICB9XG4gIHJldHVybiBjdXI7XG59O1xuXG5cbi8qKlxuICogQWRkcyBhIGRlcGVuZGVuY3kgZnJvbSBhIGZpbGUgdG8gdGhlIGZpbGVzIGl0IHJlcXVpcmVzLlxuICogQHBhcmFtIHtzdHJpbmd9IHJlbFBhdGggVGhlIHBhdGggdG8gdGhlIGpzIGZpbGUuXG4gKiBAcGFyYW0geyFBcnJheTxzdHJpbmc+fSBwcm92aWRlcyBBbiBhcnJheSBvZiBzdHJpbmdzIHdpdGhcbiAqICAgICB0aGUgbmFtZXMgb2YgdGhlIG9iamVjdHMgdGhpcyBmaWxlIHByb3ZpZGVzLlxuICogQHBhcmFtIHshQXJyYXk8c3RyaW5nPn0gcmVxdWlyZXMgQW4gYXJyYXkgb2Ygc3RyaW5ncyB3aXRoXG4gKiAgICAgdGhlIG5hbWVzIG9mIHRoZSBvYmplY3RzIHRoaXMgZmlsZSByZXF1aXJlcy5cbiAqIEBwYXJhbSB7Ym9vbGVhbnwhT2JqZWN0PHN0cmluZz49fSBvcHRfbG9hZEZsYWdzIFBhcmFtZXRlcnMgaW5kaWNhdGluZ1xuICogICAgIGhvdyB0aGUgZmlsZSBtdXN0IGJlIGxvYWRlZC4gIFRoZSBib29sZWFuICd0cnVlJyBpcyBlcXVpdmFsZW50XG4gKiAgICAgdG8geydtb2R1bGUnOiAnZ29vZyd9IGZvciBiYWNrd2FyZHMtY29tcGF0aWJpbGl0eS4gIFZhbGlkIHByb3BlcnRpZXNcbiAqICAgICBhbmQgdmFsdWVzIGluY2x1ZGUgeydtb2R1bGUnOiAnZ29vZyd9IGFuZCB7J2xhbmcnOiAnZXM2J30uXG4gKi9cbmdvb2cuYWRkRGVwZW5kZW5jeSA9IGZ1bmN0aW9uKHJlbFBhdGgsIHByb3ZpZGVzLCByZXF1aXJlcywgb3B0X2xvYWRGbGFncykge1xuICBpZiAoIUNPTVBJTEVEICYmIGdvb2cuREVQRU5ERU5DSUVTX0VOQUJMRUQpIHtcbiAgICBnb29nLmRlYnVnTG9hZGVyXy5hZGREZXBlbmRlbmN5KHJlbFBhdGgsIHByb3ZpZGVzLCByZXF1aXJlcywgb3B0X2xvYWRGbGFncyk7XG4gIH1cbn07XG5cblxuLy8gTk9URShubmF6ZSk6IFRoZSBkZWJ1ZyBET00gbG9hZGVyIHdhcyBpbmNsdWRlZCBpbiBiYXNlLmpzIGFzIGFuIG9yaWdpbmFsIHdheVxuLy8gdG8gZG8gXCJkZWJ1Zy1tb2RlXCIgZGV2ZWxvcG1lbnQuICBUaGUgZGVwZW5kZW5jeSBzeXN0ZW0gY2FuIHNvbWV0aW1lcyBiZVxuLy8gY29uZnVzaW5nLCBhcyBjYW4gdGhlIGRlYnVnIERPTSBsb2FkZXIncyBhc3luY2hyb25vdXMgbmF0dXJlLlxuLy9cbi8vIFdpdGggdGhlIERPTSBsb2FkZXIsIGEgY2FsbCB0byBnb29nLnJlcXVpcmUoKSBpcyBub3QgYmxvY2tpbmcgLS0gdGhlIHNjcmlwdFxuLy8gd2lsbCBub3QgbG9hZCB1bnRpbCBzb21lIHBvaW50IGFmdGVyIHRoZSBjdXJyZW50IHNjcmlwdC4gIElmIGEgbmFtZXNwYWNlIGlzXG4vLyBuZWVkZWQgYXQgcnVudGltZSwgaXQgbmVlZHMgdG8gYmUgZGVmaW5lZCBpbiBhIHByZXZpb3VzIHNjcmlwdCwgb3IgbG9hZGVkIHZpYVxuLy8gcmVxdWlyZSgpIHdpdGggaXRzIHJlZ2lzdGVyZWQgZGVwZW5kZW5jaWVzLlxuLy9cbi8vIFVzZXItZGVmaW5lZCBuYW1lc3BhY2VzIG1heSBuZWVkIHRoZWlyIG93biBkZXBzIGZpbGUuIEZvciBhIHJlZmVyZW5jZSBvblxuLy8gY3JlYXRpbmcgYSBkZXBzIGZpbGUsIHNlZTpcbi8vIEV4dGVybmFsbHk6IGh0dHBzOi8vZGV2ZWxvcGVycy5nb29nbGUuY29tL2Nsb3N1cmUvbGlicmFyeS9kb2NzL2RlcHN3cml0ZXJcbi8vXG4vLyBCZWNhdXNlIG9mIGxlZ2FjeSBjbGllbnRzLCB0aGUgRE9NIGxvYWRlciBjYW4ndCBiZSBlYXNpbHkgcmVtb3ZlZCBmcm9tXG4vLyBiYXNlLmpzLiAgV29yayB3YXMgZG9uZSB0byBtYWtlIGl0IGRpc2FibGVhYmxlIG9yIHJlcGxhY2VhYmxlIGZvclxuLy8gZGlmZmVyZW50IGVudmlyb25tZW50cyAoRE9NLWxlc3MgSmF2YVNjcmlwdCBpbnRlcnByZXRlcnMgbGlrZSBSaGlubyBvciBWOCxcbi8vIGZvciBleGFtcGxlKS4gU2VlIGJvb3RzdHJhcC8gZm9yIG1vcmUgaW5mb3JtYXRpb24uXG5cblxuLyoqXG4gKiBAZGVmaW5lIHtib29sZWFufSBXaGV0aGVyIHRvIGVuYWJsZSB0aGUgZGVidWcgbG9hZGVyLlxuICpcbiAqIElmIGVuYWJsZWQsIGEgY2FsbCB0byBnb29nLnJlcXVpcmUoKSB3aWxsIGF0dGVtcHQgdG8gbG9hZCB0aGUgbmFtZXNwYWNlIGJ5XG4gKiBhcHBlbmRpbmcgYSBzY3JpcHQgdGFnIHRvIHRoZSBET00gKGlmIHRoZSBuYW1lc3BhY2UgaGFzIGJlZW4gcmVnaXN0ZXJlZCkuXG4gKlxuICogSWYgZGlzYWJsZWQsIGdvb2cucmVxdWlyZSgpIHdpbGwgc2ltcGx5IGFzc2VydCB0aGF0IHRoZSBuYW1lc3BhY2UgaGFzIGJlZW5cbiAqIHByb3ZpZGVkIChhbmQgZGVwZW5kIG9uIHRoZSBmYWN0IHRoYXQgc29tZSBvdXRzaWRlIHRvb2wgY29ycmVjdGx5IG9yZGVyZWRcbiAqIHRoZSBzY3JpcHQpLlxuICovXG5nb29nLkVOQUJMRV9ERUJVR19MT0FERVIgPSBnb29nLmRlZmluZSgnZ29vZy5FTkFCTEVfREVCVUdfTE9BREVSJywgdHJ1ZSk7XG5cblxuLyoqXG4gKiBAcGFyYW0ge3N0cmluZ30gbXNnXG4gKiBAcHJpdmF0ZVxuICovXG5nb29nLmxvZ1RvQ29uc29sZV8gPSBmdW5jdGlvbihtc2cpIHtcbiAgaWYgKGdvb2cuZ2xvYmFsLmNvbnNvbGUpIHtcbiAgICBnb29nLmdsb2JhbC5jb25zb2xlWydlcnJvciddKG1zZyk7XG4gIH1cbn07XG5cblxuLyoqXG4gKiBJbXBsZW1lbnRzIGEgc3lzdGVtIGZvciB0aGUgZHluYW1pYyByZXNvbHV0aW9uIG9mIGRlcGVuZGVuY2llcyB0aGF0IHdvcmtzIGluXG4gKiBwYXJhbGxlbCB3aXRoIHRoZSBCVUlMRCBzeXN0ZW0uXG4gKlxuICogTm90ZSB0aGF0IGFsbCBjYWxscyB0byBnb29nLnJlcXVpcmUgd2lsbCBiZSBzdHJpcHBlZCBieSB0aGUgY29tcGlsZXIuXG4gKlxuICogQHNlZSBnb29nLnByb3ZpZGVcbiAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lc3BhY2UgTmFtZXNwYWNlIChhcyB3YXMgZ2l2ZW4gaW4gZ29vZy5wcm92aWRlLFxuICogICAgIGdvb2cubW9kdWxlLCBvciBnb29nLmRlY2xhcmVNb2R1bGVJZCkgaW4gdGhlIGZvcm1cbiAqICAgICBcImdvb2cucGFja2FnZS5wYXJ0XCIuXG4gKiBAcmV0dXJuIHs/fSBJZiBjYWxsZWQgd2l0aGluIGEgZ29vZy5tb2R1bGUgb3IgRVM2IG1vZHVsZSBmaWxlLCB0aGUgYXNzb2NpYXRlZFxuICogICAgIG5hbWVzcGFjZSBvciBtb2R1bGUgb3RoZXJ3aXNlIG51bGwuXG4gKi9cbmdvb2cucmVxdWlyZSA9IGZ1bmN0aW9uKG5hbWVzcGFjZSkge1xuICBpZiAoIUNPTVBJTEVEKSB7XG4gICAgLy8gTWlnaHQgbmVlZCB0byBsYXp5IGxvYWQgb24gb2xkIElFLlxuICAgIGlmIChnb29nLkVOQUJMRV9ERUJVR19MT0FERVIpIHtcbiAgICAgIGdvb2cuZGVidWdMb2FkZXJfLnJlcXVlc3RlZChuYW1lc3BhY2UpO1xuICAgIH1cblxuICAgIC8vIElmIHRoZSBvYmplY3QgYWxyZWFkeSBleGlzdHMgd2UgZG8gbm90IG5lZWQgdG8gZG8gYW55dGhpbmcuXG4gICAgaWYgKGdvb2cuaXNQcm92aWRlZF8obmFtZXNwYWNlKSkge1xuICAgICAgaWYgKGdvb2cuaXNJbk1vZHVsZUxvYWRlcl8oKSkge1xuICAgICAgICByZXR1cm4gZ29vZy5tb2R1bGUuZ2V0SW50ZXJuYWxfKG5hbWVzcGFjZSk7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChnb29nLkVOQUJMRV9ERUJVR19MT0FERVIpIHtcbiAgICAgIHZhciBtb2R1bGVMb2FkZXJTdGF0ZSA9IGdvb2cubW9kdWxlTG9hZGVyU3RhdGVfO1xuICAgICAgZ29vZy5tb2R1bGVMb2FkZXJTdGF0ZV8gPSBudWxsO1xuICAgICAgdHJ5IHtcbiAgICAgICAgZ29vZy5kZWJ1Z0xvYWRlcl8ubG9hZF8obmFtZXNwYWNlKTtcbiAgICAgIH0gZmluYWxseSB7XG4gICAgICAgIGdvb2cubW9kdWxlTG9hZGVyU3RhdGVfID0gbW9kdWxlTG9hZGVyU3RhdGU7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbn07XG5cblxuLyoqXG4gKiBSZXF1aXJlcyBhIHN5bWJvbCBmb3IgaXRzIHR5cGUgaW5mb3JtYXRpb24uIFRoaXMgaXMgYW4gaW5kaWNhdGlvbiB0byB0aGVcbiAqIGNvbXBpbGVyIHRoYXQgdGhlIHN5bWJvbCBtYXkgYXBwZWFyIGluIHR5cGUgYW5ub3RhdGlvbnMsIHlldCBpdCBpcyBub3RcbiAqIHJlZmVyZW5jZWQgYXQgcnVudGltZS5cbiAqXG4gKiBXaGVuIGNhbGxlZCB3aXRoaW4gYSBnb29nLm1vZHVsZSBvciBFUzYgbW9kdWxlIGZpbGUsIHRoZSByZXR1cm4gdmFsdWUgbWF5IGJlXG4gKiBhc3NpZ25lZCB0byBvciBkZXN0cnVjdHVyZWQgaW50byBhIHZhcmlhYmxlLCBidXQgaXQgbWF5IG5vdCBiZSBvdGhlcndpc2UgdXNlZFxuICogaW4gY29kZSBvdXRzaWRlIG9mIGEgdHlwZSBhbm5vdGF0aW9uLlxuICpcbiAqIE5vdGUgdGhhdCBhbGwgY2FsbHMgdG8gZ29vZy5yZXF1aXJlVHlwZSB3aWxsIGJlIHN0cmlwcGVkIGJ5IHRoZSBjb21waWxlci5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gbmFtZXNwYWNlIE5hbWVzcGFjZSAoYXMgd2FzIGdpdmVuIGluIGdvb2cucHJvdmlkZSxcbiAqICAgICBnb29nLm1vZHVsZSwgb3IgZ29vZy5kZWNsYXJlTW9kdWxlSWQpIGluIHRoZSBmb3JtXG4gKiAgICAgXCJnb29nLnBhY2thZ2UucGFydFwiLlxuICogQHJldHVybiB7P31cbiAqL1xuZ29vZy5yZXF1aXJlVHlwZSA9IGZ1bmN0aW9uKG5hbWVzcGFjZSkge1xuICAvLyBSZXR1cm4gYW4gZW1wdHkgb2JqZWN0IHNvIHRoYXQgc2luZ2xlLWxldmVsIGRlc3RydWN0dXJpbmcgb2YgdGhlIHJldHVyblxuICAvLyB2YWx1ZSBkb2Vzbid0IGNyYXNoIGF0IHJ1bnRpbWUgd2hlbiB1c2luZyB0aGUgZGVidWcgbG9hZGVyLiBNdWx0aS1sZXZlbFxuICAvLyBkZXN0cnVjdHVyaW5nIGlzbid0IHN1cHBvcnRlZC5cbiAgcmV0dXJuIHt9O1xufTtcblxuXG4vKipcbiAqIFBhdGggZm9yIGluY2x1ZGVkIHNjcmlwdHMuXG4gKiBAdHlwZSB7c3RyaW5nfVxuICovXG5nb29nLmJhc2VQYXRoID0gJyc7XG5cblxuLyoqXG4gKiBBIGhvb2sgZm9yIG92ZXJyaWRpbmcgdGhlIGJhc2UgcGF0aC5cbiAqIEB0eXBlIHtzdHJpbmd8dW5kZWZpbmVkfVxuICovXG5nb29nLmdsb2JhbC5DTE9TVVJFX0JBU0VfUEFUSDtcblxuXG4vKipcbiAqIFdoZXRoZXIgdG8gYXR0ZW1wdCB0byBsb2FkIENsb3N1cmUncyBkZXBzIGZpbGUuIEJ5IGRlZmF1bHQsIHdoZW4gdW5jb21waWxlZCxcbiAqIGRlcHMgZmlsZXMgd2lsbCBhdHRlbXB0IHRvIGJlIGxvYWRlZC5cbiAqIEB0eXBlIHtib29sZWFufHVuZGVmaW5lZH1cbiAqL1xuZ29vZy5nbG9iYWwuQ0xPU1VSRV9OT19ERVBTO1xuXG5cbi8qKlxuICogQSBmdW5jdGlvbiB0byBpbXBvcnQgYSBzaW5nbGUgc2NyaXB0LiBUaGlzIGlzIG1lYW50IHRvIGJlIG92ZXJyaWRkZW4gd2hlblxuICogQ2xvc3VyZSBpcyBiZWluZyBydW4gaW4gbm9uLUhUTUwgY29udGV4dHMsIHN1Y2ggYXMgd2ViIHdvcmtlcnMuIEl0J3MgZGVmaW5lZFxuICogaW4gdGhlIGdsb2JhbCBzY29wZSBzbyB0aGF0IGl0IGNhbiBiZSBzZXQgYmVmb3JlIGJhc2UuanMgaXMgbG9hZGVkLCB3aGljaFxuICogYWxsb3dzIGRlcHMuanMgdG8gYmUgaW1wb3J0ZWQgcHJvcGVybHkuXG4gKlxuICogVGhlIGZpcnN0IHBhcmFtZXRlciB0aGUgc2NyaXB0IHNvdXJjZSwgd2hpY2ggaXMgYSByZWxhdGl2ZSBVUkkuIFRoZSBzZWNvbmQsXG4gKiBvcHRpb25hbCBwYXJhbWV0ZXIgaXMgdGhlIHNjcmlwdCBjb250ZW50cywgaW4gdGhlIGV2ZW50IHRoZSBzY3JpcHQgbmVlZGVkXG4gKiB0cmFuc2Zvcm1hdGlvbi4gSXQgc2hvdWxkIHJldHVybiB0cnVlIGlmIHRoZSBzY3JpcHQgd2FzIGltcG9ydGVkLCBmYWxzZVxuICogb3RoZXJ3aXNlLlxuICogQHR5cGUgeyhmdW5jdGlvbihzdHJpbmcsIHN0cmluZz0pOiBib29sZWFuKXx1bmRlZmluZWR9XG4gKi9cbmdvb2cuZ2xvYmFsLkNMT1NVUkVfSU1QT1JUX1NDUklQVDtcblxuXG4vKipcbiAqIE51bGwgZnVuY3Rpb24gdXNlZCBmb3IgZGVmYXVsdCB2YWx1ZXMgb2YgY2FsbGJhY2tzLCBldGMuXG4gKiBAcmV0dXJuIHt2b2lkfSBOb3RoaW5nLlxuICogQGRlcHJlY2F0ZWQgdXNlICcoKT0+e30nIG9yICdmdW5jdGlvbigpe30nIGluc3RlYWQuXG4gKi9cbmdvb2cubnVsbEZ1bmN0aW9uID0gZnVuY3Rpb24oKSB7fTtcblxuXG4vKipcbiAqIFdoZW4gZGVmaW5pbmcgYSBjbGFzcyBGb28gd2l0aCBhbiBhYnN0cmFjdCBtZXRob2QgYmFyKCksIHlvdSBjYW4gZG86XG4gKiBGb28ucHJvdG90eXBlLmJhciA9IGdvb2cuYWJzdHJhY3RNZXRob2RcbiAqXG4gKiBOb3cgaWYgYSBzdWJjbGFzcyBvZiBGb28gZmFpbHMgdG8gb3ZlcnJpZGUgYmFyKCksIGFuIGVycm9yIHdpbGwgYmUgdGhyb3duXG4gKiB3aGVuIGJhcigpIGlzIGludm9rZWQuXG4gKlxuICogQHR5cGUgeyFGdW5jdGlvbn1cbiAqIEB0aHJvd3Mge0Vycm9yfSB3aGVuIGludm9rZWQgdG8gaW5kaWNhdGUgdGhlIG1ldGhvZCBzaG91bGQgYmUgb3ZlcnJpZGRlbi5cbiAqIEBkZXByZWNhdGVkIFVzZSBcIkBhYnN0cmFjdFwiIGFubm90YXRpb24gaW5zdGVhZCBvZiBnb29nLmFic3RyYWN0TWV0aG9kIGluIG5ld1xuICogICAgIGNvZGUuIFNlZVxuICogICAgIGh0dHBzOi8vZ2l0aHViLmNvbS9nb29nbGUvY2xvc3VyZS1jb21waWxlci93aWtpL0BhYnN0cmFjdC1jbGFzc2VzLWFuZC1tZXRob2RzXG4gKi9cbmdvb2cuYWJzdHJhY3RNZXRob2QgPSBmdW5jdGlvbigpIHtcbiAgdGhyb3cgbmV3IEVycm9yKCd1bmltcGxlbWVudGVkIGFic3RyYWN0IG1ldGhvZCcpO1xufTtcblxuXG4vKipcbiAqIEFkZHMgYSBgZ2V0SW5zdGFuY2VgIHN0YXRpYyBtZXRob2QgdGhhdCBhbHdheXMgcmV0dXJucyB0aGUgc2FtZVxuICogaW5zdGFuY2Ugb2JqZWN0LlxuICogQHBhcmFtIHshRnVuY3Rpb259IGN0b3IgVGhlIGNvbnN0cnVjdG9yIGZvciB0aGUgY2xhc3MgdG8gYWRkIHRoZSBzdGF0aWNcbiAqICAgICBtZXRob2QgdG8uXG4gKiBAc3VwcHJlc3Mge21pc3NpbmdQcm9wZXJ0aWVzfSAnaW5zdGFuY2VfJyBpc24ndCBhIHByb3BlcnR5IG9uICdGdW5jdGlvbidcbiAqICAgICBidXQgd2UgZG9uJ3QgaGF2ZSBhIGJldHRlciB0eXBlIHRvIHVzZSBoZXJlLlxuICovXG5nb29nLmFkZFNpbmdsZXRvbkdldHRlciA9IGZ1bmN0aW9uKGN0b3IpIHtcbiAgLy8gaW5zdGFuY2VfIGlzIGltbWVkaWF0ZWx5IHNldCB0byBwcmV2ZW50IGlzc3VlcyB3aXRoIHNlYWxlZCBjb25zdHJ1Y3RvcnNcbiAgLy8gc3VjaCBhcyBhcmUgZW5jb3VudGVyZWQgd2hlbiBhIGNvbnN0cnVjdG9yIGlzIHJldHVybmVkIGFzIHRoZSBleHBvcnQgb2JqZWN0XG4gIC8vIG9mIGEgZ29vZy5tb2R1bGUgaW4gdW5vcHRpbWl6ZWQgY29kZS5cbiAgLy8gRGVsY2FyZSB0eXBlIHRvIGF2b2lkIGNvbmZvcm1hbmNlIHZpb2xhdGlvbnMgdGhhdCBjdG9yLmluc3RhbmNlXyBpcyB1bmtub3duXG4gIC8qKiBAdHlwZSB7dW5kZWZpbmVkfCFPYmplY3R9IEBzdXBwcmVzcyB7dW5kZXJzY29yZX0gKi9cbiAgY3Rvci5pbnN0YW5jZV8gPSB1bmRlZmluZWQ7XG4gIGN0b3IuZ2V0SW5zdGFuY2UgPSBmdW5jdGlvbigpIHtcbiAgICBpZiAoY3Rvci5pbnN0YW5jZV8pIHtcbiAgICAgIHJldHVybiBjdG9yLmluc3RhbmNlXztcbiAgICB9XG4gICAgaWYgKGdvb2cuREVCVUcpIHtcbiAgICAgIC8vIE5PVEU6IEpTQ29tcGlsZXIgY2FuJ3Qgb3B0aW1pemUgYXdheSBBcnJheSNwdXNoLlxuICAgICAgZ29vZy5pbnN0YW50aWF0ZWRTaW5nbGV0b25zX1tnb29nLmluc3RhbnRpYXRlZFNpbmdsZXRvbnNfLmxlbmd0aF0gPSBjdG9yO1xuICAgIH1cbiAgICAvLyBDYXN0IHRvIGF2b2lkIGNvbmZvcm1hbmNlIHZpb2xhdGlvbnMgdGhhdCBjdG9yLmluc3RhbmNlXyBpcyB1bmtub3duXG4gICAgcmV0dXJuIC8qKiBAdHlwZSB7IU9iamVjdHx1bmRlZmluZWR9ICovIChjdG9yLmluc3RhbmNlXykgPSBuZXcgY3RvcjtcbiAgfTtcbn07XG5cblxuLyoqXG4gKiBBbGwgc2luZ2xldG9uIGNsYXNzZXMgdGhhdCBoYXZlIGJlZW4gaW5zdGFudGlhdGVkLCBmb3IgdGVzdGluZy4gRG9uJ3QgcmVhZFxuICogaXQgZGlyZWN0bHksIHVzZSB0aGUgYGdvb2cudGVzdGluZy5zaW5nbGV0b25gIG1vZHVsZS4gVGhlIGNvbXBpbGVyXG4gKiByZW1vdmVzIHRoaXMgdmFyaWFibGUgaWYgdW51c2VkLlxuICogQHR5cGUgeyFBcnJheTwhRnVuY3Rpb24+fVxuICogQHByaXZhdGVcbiAqL1xuZ29vZy5pbnN0YW50aWF0ZWRTaW5nbGV0b25zXyA9IFtdO1xuXG5cbi8qKlxuICogQGRlZmluZSB7Ym9vbGVhbn0gV2hldGhlciB0byBsb2FkIGdvb2cubW9kdWxlcyB1c2luZyBgZXZhbGAgd2hlbiB1c2luZ1xuICogdGhlIGRlYnVnIGxvYWRlci4gIFRoaXMgcHJvdmlkZXMgYSBiZXR0ZXIgZGVidWdnaW5nIGV4cGVyaWVuY2UgYXMgdGhlXG4gKiBzb3VyY2UgaXMgdW5tb2RpZmllZCBhbmQgY2FuIGJlIGVkaXRlZCB1c2luZyBDaHJvbWUgV29ya3NwYWNlcyBvciBzaW1pbGFyLlxuICogSG93ZXZlciBpbiBzb21lIGVudmlyb25tZW50cyB0aGUgdXNlIG9mIGBldmFsYCBpcyBiYW5uZWRcbiAqIHNvIHdlIHByb3ZpZGUgYW4gYWx0ZXJuYXRpdmUuXG4gKi9cbmdvb2cuTE9BRF9NT0RVTEVfVVNJTkdfRVZBTCA9IGdvb2cuZGVmaW5lKCdnb29nLkxPQURfTU9EVUxFX1VTSU5HX0VWQUwnLCB0cnVlKTtcblxuXG4vKipcbiAqIEBkZWZpbmUge2Jvb2xlYW59IFdoZXRoZXIgdGhlIGV4cG9ydHMgb2YgZ29vZy5tb2R1bGVzIHNob3VsZCBiZSBzZWFsZWQgd2hlblxuICogcG9zc2libGUuXG4gKi9cbmdvb2cuU0VBTF9NT0RVTEVfRVhQT1JUUyA9IGdvb2cuZGVmaW5lKCdnb29nLlNFQUxfTU9EVUxFX0VYUE9SVFMnLCBnb29nLkRFQlVHKTtcblxuXG4vKipcbiAqIFRoZSByZWdpc3RyeSBvZiBpbml0aWFsaXplZCBtb2R1bGVzOlxuICogVGhlIG1vZHVsZSBpZGVudGlmaWVyIG9yIHBhdGggdG8gbW9kdWxlIGV4cG9ydHMgbWFwLlxuICogQHByaXZhdGUgQGNvbnN0IHshT2JqZWN0PHN0cmluZywge2V4cG9ydHM6Pyx0eXBlOnN0cmluZyxtb2R1bGVJZDpzdHJpbmd9Pn1cbiAqL1xuZ29vZy5sb2FkZWRNb2R1bGVzXyA9IHt9O1xuXG5cbi8qKlxuICogVHJ1ZSBpZiB0aGUgZGVidWcgbG9hZGVyIGVuYWJsZWQgYW5kIHVzZWQuXG4gKiBAY29uc3Qge2Jvb2xlYW59XG4gKi9cbmdvb2cuREVQRU5ERU5DSUVTX0VOQUJMRUQgPSAhQ09NUElMRUQgJiYgZ29vZy5FTkFCTEVfREVCVUdfTE9BREVSO1xuXG5cbi8qKlxuICogQGRlZmluZSB7c3RyaW5nfSBIb3cgdG8gZGVjaWRlIHdoZXRoZXIgdG8gdHJhbnNwaWxlLiAgVmFsaWQgdmFsdWVzXG4gKiBhcmUgJ2Fsd2F5cycsICduZXZlcicsIGFuZCAnZGV0ZWN0Jy4gIFRoZSBkZWZhdWx0ICgnZGV0ZWN0JykgaXMgdG9cbiAqIHVzZSBmZWF0dXJlIGRldGVjdGlvbiB0byBkZXRlcm1pbmUgd2hpY2ggbGFuZ3VhZ2UgbGV2ZWxzIG5lZWRcbiAqIHRyYW5zcGlsYXRpb24uXG4gKi9cbi8vIE5PVEUoc2RoKTogd2UgY291bGQgZXhwYW5kIHRoaXMgdG8gYWNjZXB0IGEgbGFuZ3VhZ2UgbGV2ZWwgdG8gYnlwYXNzXG4vLyBkZXRlY3Rpb246IGUuZy4gZ29vZy5UUkFOU1BJTEUgPT0gJ2VzNScgd291bGQgdHJhbnNwaWxlIEVTNiBmaWxlcyBidXRcbi8vIHdvdWxkIGxlYXZlIEVTMyBhbmQgRVM1IGZpbGVzIGFsb25lLlxuZ29vZy5UUkFOU1BJTEUgPSBnb29nLmRlZmluZSgnZ29vZy5UUkFOU1BJTEUnLCAnZGV0ZWN0Jyk7XG5cbi8qKlxuICogQGRlZmluZSB7Ym9vbGVhbn0gSWYgdHJ1ZSBhc3N1bWUgdGhhdCBFUyBtb2R1bGVzIGhhdmUgYWxyZWFkeSBiZWVuXG4gKiB0cmFuc3BpbGVkIGJ5IHRoZSBqc2NvbXBpbGVyIChpbiB0aGUgc2FtZSB3YXkgdGhhdCB0cmFuc3BpbGUuanMgd291bGRcbiAqIHRyYW5zcGlsZSB0aGVtIC0gdG8ganNjb21wIG1vZHVsZXMpLiBVc2VmdWwgb25seSBmb3Igc2VydmVycyB0aGF0IHdpc2ggdG8gdXNlXG4gKiB0aGUgZGVidWcgbG9hZGVyIGFuZCB0cmFuc3BpbGUgc2VydmVyIHNpZGUuIFRodXMgdGhpcyBpcyBvbmx5IHJlc3BlY3RlZCBpZlxuICogZ29vZy5UUkFOU1BJTEUgaXMgXCJuZXZlclwiLlxuICovXG5nb29nLkFTU1VNRV9FU19NT0RVTEVTX1RSQU5TUElMRUQgPVxuICAgIGdvb2cuZGVmaW5lKCdnb29nLkFTU1VNRV9FU19NT0RVTEVTX1RSQU5TUElMRUQnLCBmYWxzZSk7XG5cblxuLyoqXG4gKiBAZGVmaW5lIHtzdHJpbmd9IElmIGEgZmlsZSBuZWVkcyB0byBiZSB0cmFuc3BpbGVkIHdoYXQgdGhlIG91dHB1dCBsYW5ndWFnZVxuICogc2hvdWxkIGJlLiBCeSBkZWZhdWx0IHRoaXMgaXMgdGhlIGhpZ2hlc3QgbGFuZ3VhZ2UgbGV2ZWwgdGhpcyBmaWxlIGRldGVjdHNcbiAqIHRoZSBjdXJyZW50IGVudmlyb25tZW50IHN1cHBvcnRzLiBHZW5lcmFsbHkgdGhpcyBmbGFnIHNob3VsZCBub3QgYmUgc2V0LCBidXRcbiAqIGl0IGNvdWxkIGJlIHVzZWZ1bCB0byBvdmVycmlkZS4gRXhhbXBsZTogSWYgdGhlIGN1cnJlbnQgZW52aXJvbm1lbnQgc3VwcG9ydHNcbiAqIEVTNiB0aGVuIGJ5IGRlZmF1bHQgRVM3KyBmaWxlcyB3aWxsIGJlIHRyYW5zcGlsZWQgdG8gRVM2LCB1bmxlc3MgdGhpcyBpc1xuICogb3ZlcnJpZGRlbi5cbiAqXG4gKiBWYWxpZCB2YWx1ZXMgaW5jbHVkZTogZXMzLCBlczUsIGVzNiwgZXM3LCBhbmQgZXM4LiBBbnl0aGluZyBub3QgcmVjb2duaXplZFxuICogaXMgdHJlYXRlZCBhcyBlczMuXG4gKlxuICogTm90ZSB0aGF0IHNldHRpbmcgdGhpcyB2YWx1ZSBkb2VzIG5vdCBmb3JjZSB0cmFuc3BpbGF0aW9uLiBKdXN0IGlmXG4gKiB0cmFuc3BpbGF0aW9uIG9jY3VycyB0aGlzIHdpbGwgYmUgdGhlIG91dHB1dC4gU28gdGhpcyBpcyBtb3N0IHVzZWZ1bCB3aGVuXG4gKiBnb29nLlRSQU5TUElMRSBpcyBzZXQgdG8gJ2Fsd2F5cycgYW5kIHRoZW4gZm9yY2luZyB0aGUgbGFuZ3VhZ2UgbGV2ZWwgdG8gYmVcbiAqIHNvbWV0aGluZyBsb3dlciB0aGFuIHdoYXQgdGhlIGVudmlyb25tZW50IGRldGVjdHMuXG4gKi9cbmdvb2cuVFJBTlNQSUxFX1RPX0xBTkdVQUdFID0gZ29vZy5kZWZpbmUoJ2dvb2cuVFJBTlNQSUxFX1RPX0xBTkdVQUdFJywgJycpO1xuXG5cbi8qKlxuICogQGRlZmluZSB7c3RyaW5nfSBQYXRoIHRvIHRoZSB0cmFuc3BpbGVyLiAgRXhlY3V0aW5nIHRoZSBzY3JpcHQgYXQgdGhpc1xuICogcGF0aCAocmVsYXRpdmUgdG8gYmFzZS5qcykgc2hvdWxkIGRlZmluZSBhIGZ1bmN0aW9uICRqc2NvbXAudHJhbnNwaWxlLlxuICovXG5nb29nLlRSQU5TUElMRVIgPSBnb29nLmRlZmluZSgnZ29vZy5UUkFOU1BJTEVSJywgJ3RyYW5zcGlsZS5qcycpO1xuXG5cbi8qKlxuICogQGRlZmluZSB7c3RyaW5nfSBUcnVzdGVkIFR5cGVzIHBvbGljeSBuYW1lLiBJZiBub24tZW1wdHkgdGhlbiBDbG9zdXJlIHdpbGxcbiAqIHVzZSBUcnVzdGVkIFR5cGVzLlxuICovXG5nb29nLlRSVVNURURfVFlQRVNfUE9MSUNZX05BTUUgPVxuICAgIGdvb2cuZGVmaW5lKCdnb29nLlRSVVNURURfVFlQRVNfUE9MSUNZX05BTUUnLCAnZ29vZycpO1xuXG5cbi8qKlxuICogQHBhY2thZ2Ugez9ib29sZWFufVxuICogVmlzaWJsZSBmb3IgdGVzdGluZy5cbiAqL1xuZ29vZy5oYXNCYWRMZXRTY29waW5nID0gbnVsbDtcblxuXG4vKipcbiAqIEBwYXJhbSB7ZnVuY3Rpb24oPyk6P3xzdHJpbmd9IG1vZHVsZURlZiBUaGUgbW9kdWxlIGRlZmluaXRpb24uXG4gKi9cbmdvb2cubG9hZE1vZHVsZSA9IGZ1bmN0aW9uKG1vZHVsZURlZikge1xuICAvLyBOT1RFOiB3ZSBhbGxvdyBmdW5jdGlvbiBkZWZpbml0aW9ucyB0byBiZSBlaXRoZXIgaW4gdGhlIGZyb21cbiAgLy8gb2YgYSBzdHJpbmcgdG8gZXZhbCAod2hpY2gga2VlcHMgdGhlIG9yaWdpbmFsIHNvdXJjZSBpbnRhY3QpIG9yXG4gIC8vIGluIGEgZXZhbCBmb3JiaWRkZW4gZW52aXJvbm1lbnQgKENTUCkgd2UgYWxsb3cgYSBmdW5jdGlvbiBkZWZpbml0aW9uXG4gIC8vIHdoaWNoIGluIGl0cyBib2R5IG11c3QgY2FsbCBgZ29vZy5tb2R1bGVgLCBhbmQgcmV0dXJuIHRoZSBleHBvcnRzXG4gIC8vIG9mIHRoZSBtb2R1bGUuXG4gIHZhciBwcmV2aW91c1N0YXRlID0gZ29vZy5tb2R1bGVMb2FkZXJTdGF0ZV87XG4gIHRyeSB7XG4gICAgZ29vZy5tb2R1bGVMb2FkZXJTdGF0ZV8gPSB7XG4gICAgICBtb2R1bGVOYW1lOiAnJyxcbiAgICAgIGRlY2xhcmVMZWdhY3lOYW1lc3BhY2U6IGZhbHNlLFxuICAgICAgdHlwZTogZ29vZy5Nb2R1bGVUeXBlLkdPT0dcbiAgICB9O1xuICAgIHZhciBvcmlnRXhwb3J0cyA9IHt9O1xuICAgIHZhciBleHBvcnRzID0gb3JpZ0V4cG9ydHM7XG4gICAgaWYgKHR5cGVvZiBtb2R1bGVEZWYgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgIGV4cG9ydHMgPSBtb2R1bGVEZWYuY2FsbCh1bmRlZmluZWQsIGV4cG9ydHMpO1xuICAgIH0gZWxzZSBpZiAodHlwZW9mIG1vZHVsZURlZiA9PT0gJ3N0cmluZycpIHtcbiAgICAgIGV4cG9ydHMgPSBnb29nLmxvYWRNb2R1bGVGcm9tU291cmNlXy5jYWxsKHVuZGVmaW5lZCwgZXhwb3J0cywgbW9kdWxlRGVmKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIG1vZHVsZSBkZWZpbml0aW9uJyk7XG4gICAgfVxuXG4gICAgdmFyIG1vZHVsZU5hbWUgPSBnb29nLm1vZHVsZUxvYWRlclN0YXRlXy5tb2R1bGVOYW1lO1xuICAgIGlmICh0eXBlb2YgbW9kdWxlTmFtZSA9PT0gJ3N0cmluZycgJiYgbW9kdWxlTmFtZSkge1xuICAgICAgLy8gRG9uJ3Qgc2VhbCBsZWdhY3kgbmFtZXNwYWNlcyBhcyB0aGV5IG1heSBiZSB1c2VkIGFzIGEgcGFyZW50IG9mXG4gICAgICAvLyBhbm90aGVyIG5hbWVzcGFjZVxuICAgICAgaWYgKGdvb2cubW9kdWxlTG9hZGVyU3RhdGVfLmRlY2xhcmVMZWdhY3lOYW1lc3BhY2UpIHtcbiAgICAgICAgLy8gV2hldGhlciBleHBvcnRzIHdhcyBvdmVyd3JpdHRlbiB2aWEgZGVmYXVsdCBleHBvcnQgYXNzaWdubWVudC5cbiAgICAgICAgLy8gVGhpcyBpcyBpbXBvcnRhbnQgZm9yIGxlZ2FjeSBuYW1lc3BhY2VzIGFzIGl0IGRpY3RhdGVzIHdoZXRoZXJcbiAgICAgICAgLy8gcHJldmlvdXNseSBhIHByZXZpb3VzbHkgbG9hZGVkIGltcGxpY2l0IG5hbWVzcGFjZSBzaG91bGQgYmUgY2xvYmJlcmVkXG4gICAgICAgIC8vIG9yIG5vdC5cbiAgICAgICAgdmFyIGlzRGVmYXVsdEV4cG9ydCA9IG9yaWdFeHBvcnRzICE9PSBleHBvcnRzO1xuICAgICAgICBnb29nLmNvbnN0cnVjdE5hbWVzcGFjZV8obW9kdWxlTmFtZSwgZXhwb3J0cywgaXNEZWZhdWx0RXhwb3J0KTtcbiAgICAgIH0gZWxzZSBpZiAoXG4gICAgICAgICAgZ29vZy5TRUFMX01PRFVMRV9FWFBPUlRTICYmIE9iamVjdC5zZWFsICYmXG4gICAgICAgICAgdHlwZW9mIGV4cG9ydHMgPT0gJ29iamVjdCcgJiYgZXhwb3J0cyAhPSBudWxsKSB7XG4gICAgICAgIE9iamVjdC5zZWFsKGV4cG9ydHMpO1xuICAgICAgfVxuXG4gICAgICB2YXIgZGF0YSA9IHtcbiAgICAgICAgZXhwb3J0czogZXhwb3J0cyxcbiAgICAgICAgdHlwZTogZ29vZy5Nb2R1bGVUeXBlLkdPT0csXG4gICAgICAgIG1vZHVsZUlkOiBnb29nLm1vZHVsZUxvYWRlclN0YXRlXy5tb2R1bGVOYW1lXG4gICAgICB9O1xuICAgICAgZ29vZy5sb2FkZWRNb2R1bGVzX1ttb2R1bGVOYW1lXSA9IGRhdGE7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBtb2R1bGUgbmFtZSBcXFwiJyArIG1vZHVsZU5hbWUgKyAnXFxcIicpO1xuICAgIH1cbiAgfSBmaW5hbGx5IHtcbiAgICBnb29nLm1vZHVsZUxvYWRlclN0YXRlXyA9IHByZXZpb3VzU3RhdGU7XG4gIH1cbn07XG5cblxuLyoqXG4gKiBAcHJpdmF0ZSBAY29uc3RcbiAqL1xuZ29vZy5sb2FkTW9kdWxlRnJvbVNvdXJjZV8gPVxuICAgIC8qKiBAdHlwZSB7ZnVuY3Rpb24oIU9iamVjdCwgc3RyaW5nKTo/fSAqLyAoZnVuY3Rpb24oZXhwb3J0cykge1xuICAgICAgLy8gTk9URTogd2UgYXZvaWQgZGVjbGFyaW5nIHBhcmFtZXRlcnMgb3IgbG9jYWwgdmFyaWFibGVzIGhlcmUgdG8gYXZvaWRcbiAgICAgIC8vIG1hc2tpbmcgZ2xvYmFscyBvciBsZWFraW5nIHZhbHVlcyBpbnRvIHRoZSBtb2R1bGUgZGVmaW5pdGlvbi5cbiAgICAgICd1c2Ugc3RyaWN0JztcbiAgICAgIGV2YWwoZ29vZy5DTE9TVVJFX0VWQUxfUFJFRklMVEVSXy5jcmVhdGVTY3JpcHQoYXJndW1lbnRzWzFdKSk7XG4gICAgICByZXR1cm4gZXhwb3J0cztcbiAgICB9KTtcblxuXG4vKipcbiAqIE5vcm1hbGl6ZSBhIGZpbGUgcGF0aCBieSByZW1vdmluZyByZWR1bmRhbnQgXCIuLlwiIGFuZCBleHRyYW5lb3VzIFwiLlwiIGZpbGVcbiAqIHBhdGggY29tcG9uZW50cy5cbiAqIEBwYXJhbSB7c3RyaW5nfSBwYXRoXG4gKiBAcmV0dXJuIHtzdHJpbmd9XG4gKiBAcHJpdmF0ZVxuICovXG5nb29nLm5vcm1hbGl6ZVBhdGhfID0gZnVuY3Rpb24ocGF0aCkge1xuICB2YXIgY29tcG9uZW50cyA9IHBhdGguc3BsaXQoJy8nKTtcbiAgdmFyIGkgPSAwO1xuICB3aGlsZSAoaSA8IGNvbXBvbmVudHMubGVuZ3RoKSB7XG4gICAgaWYgKGNvbXBvbmVudHNbaV0gPT0gJy4nKSB7XG4gICAgICBjb21wb25lbnRzLnNwbGljZShpLCAxKTtcbiAgICB9IGVsc2UgaWYgKFxuICAgICAgICBpICYmIGNvbXBvbmVudHNbaV0gPT0gJy4uJyAmJiBjb21wb25lbnRzW2kgLSAxXSAmJlxuICAgICAgICBjb21wb25lbnRzW2kgLSAxXSAhPSAnLi4nKSB7XG4gICAgICBjb21wb25lbnRzLnNwbGljZSgtLWksIDIpO1xuICAgIH0gZWxzZSB7XG4gICAgICBpKys7XG4gICAgfVxuICB9XG4gIHJldHVybiBjb21wb25lbnRzLmpvaW4oJy8nKTtcbn07XG5cblxuLyoqXG4gKiBQcm92aWRlcyBhIGhvb2sgZm9yIGxvYWRpbmcgYSBmaWxlIHdoZW4gdXNpbmcgQ2xvc3VyZSdzIGdvb2cucmVxdWlyZSgpIEFQSVxuICogd2l0aCBnb29nLm1vZHVsZXMuICBJbiBwYXJ0aWN1bGFyIHRoaXMgaG9vayBpcyBwcm92aWRlZCB0byBzdXBwb3J0IE5vZGUuanMuXG4gKlxuICogQHR5cGUgeyhmdW5jdGlvbihzdHJpbmcpOnN0cmluZyl8dW5kZWZpbmVkfVxuICovXG5nb29nLmdsb2JhbC5DTE9TVVJFX0xPQURfRklMRV9TWU5DO1xuXG5cbi8qKlxuICogTG9hZHMgZmlsZSBieSBzeW5jaHJvbm91cyBYSFIuIFNob3VsZCBub3QgYmUgdXNlZCBpbiBwcm9kdWN0aW9uIGVudmlyb25tZW50cy5cbiAqIEBwYXJhbSB7c3RyaW5nfSBzcmMgU291cmNlIFVSTC5cbiAqIEByZXR1cm4gez9zdHJpbmd9IEZpbGUgY29udGVudHMsIG9yIG51bGwgaWYgbG9hZCBmYWlsZWQuXG4gKiBAcHJpdmF0ZVxuICovXG5nb29nLmxvYWRGaWxlU3luY18gPSBmdW5jdGlvbihzcmMpIHtcbiAgaWYgKGdvb2cuZ2xvYmFsLkNMT1NVUkVfTE9BRF9GSUxFX1NZTkMpIHtcbiAgICByZXR1cm4gZ29vZy5nbG9iYWwuQ0xPU1VSRV9MT0FEX0ZJTEVfU1lOQyhzcmMpO1xuICB9IGVsc2Uge1xuICAgIHRyeSB7XG4gICAgICAvKiogQHR5cGUge1hNTEh0dHBSZXF1ZXN0fSAqL1xuICAgICAgdmFyIHhociA9IG5ldyBnb29nLmdsb2JhbFsnWE1MSHR0cFJlcXVlc3QnXSgpO1xuICAgICAgeGhyLm9wZW4oJ2dldCcsIHNyYywgZmFsc2UpO1xuICAgICAgeGhyLnNlbmQoKTtcbiAgICAgIC8vIE5PVEU6IFN1Y2Nlc3NmdWwgaHR0cDogcmVxdWVzdHMgaGF2ZSBhIHN0YXR1cyBvZiAyMDAsIGJ1dCBzdWNjZXNzZnVsXG4gICAgICAvLyBmaWxlOiByZXF1ZXN0cyBtYXkgaGF2ZSBhIHN0YXR1cyBvZiB6ZXJvLiAgQW55IG90aGVyIHN0YXR1cywgb3IgYVxuICAgICAgLy8gdGhyb3duIGV4Y2VwdGlvbiAocGFydGljdWxhcmx5IGluIGNhc2Ugb2YgZmlsZTogcmVxdWVzdHMpIGluZGljYXRlc1xuICAgICAgLy8gc29tZSBzb3J0IG9mIGVycm9yLCB3aGljaCB3ZSB0cmVhdCBhcyBhIG1pc3Npbmcgb3IgdW5hdmFpbGFibGUgZmlsZS5cbiAgICAgIHJldHVybiB4aHIuc3RhdHVzID09IDAgfHwgeGhyLnN0YXR1cyA9PSAyMDAgPyB4aHIucmVzcG9uc2VUZXh0IDogbnVsbDtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIC8vIE5vIG5lZWQgdG8gcmV0aHJvdyBvciBsb2csIHNpbmNlIGVycm9ycyBzaG91bGQgc2hvdyB1cCBvbiB0aGVpciBvd24uXG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gIH1cbn07XG5cblxuLyoqXG4gKiBMYXppbHkgcmV0cmlldmVzIHRoZSB0cmFuc3BpbGVyIGFuZCBhcHBsaWVzIGl0IHRvIHRoZSBzb3VyY2UuXG4gKiBAcGFyYW0ge3N0cmluZ30gY29kZSBKUyBjb2RlLlxuICogQHBhcmFtIHtzdHJpbmd9IHBhdGggUGF0aCB0byB0aGUgY29kZS5cbiAqIEBwYXJhbSB7c3RyaW5nfSB0YXJnZXQgTGFuZ3VhZ2UgbGV2ZWwgb3V0cHV0LlxuICogQHJldHVybiB7c3RyaW5nfSBUaGUgdHJhbnNwaWxlZCBjb2RlLlxuICogQHByaXZhdGVcbiAqL1xuZ29vZy50cmFuc3BpbGVfID0gZnVuY3Rpb24oY29kZSwgcGF0aCwgdGFyZ2V0KSB7XG4gIHZhciBqc2NvbXAgPSBnb29nLmdsb2JhbFsnJGpzY29tcCddO1xuICBpZiAoIWpzY29tcCkge1xuICAgIGdvb2cuZ2xvYmFsWyckanNjb21wJ10gPSBqc2NvbXAgPSB7fTtcbiAgfVxuICB2YXIgdHJhbnNwaWxlID0ganNjb21wLnRyYW5zcGlsZTtcbiAgaWYgKCF0cmFuc3BpbGUpIHtcbiAgICB2YXIgdHJhbnNwaWxlclBhdGggPSBnb29nLmJhc2VQYXRoICsgZ29vZy5UUkFOU1BJTEVSO1xuICAgIHZhciB0cmFuc3BpbGVyQ29kZSA9IGdvb2cubG9hZEZpbGVTeW5jXyh0cmFuc3BpbGVyUGF0aCk7XG4gICAgaWYgKHRyYW5zcGlsZXJDb2RlKSB7XG4gICAgICAvLyBUaGlzIG11c3QgYmUgZXhlY3V0ZWQgc3luY2hyb25vdXNseSwgc2luY2UgYnkgdGhlIHRpbWUgd2Uga25vdyB3ZVxuICAgICAgLy8gbmVlZCBpdCwgd2UncmUgYWJvdXQgdG8gbG9hZCBhbmQgd3JpdGUgdGhlIEVTNiBjb2RlIHN5bmNocm9ub3VzbHksXG4gICAgICAvLyBzbyBhIG5vcm1hbCBzY3JpcHQtdGFnIGxvYWQgd2lsbCBiZSB0b28gc2xvdy4gV3JhcHBlZCBpbiBhIGZ1bmN0aW9uXG4gICAgICAvLyBzbyB0aGF0IGNvZGUgaXMgZXZhbCdkIGluIHRoZSBnbG9iYWwgc2NvcGUuXG4gICAgICAoZnVuY3Rpb24oKSB7XG4gICAgICAgICgwLCBldmFsKSh0cmFuc3BpbGVyQ29kZSArICdcXG4vLyMgc291cmNlVVJMPScgKyB0cmFuc3BpbGVyUGF0aCk7XG4gICAgICB9KS5jYWxsKGdvb2cuZ2xvYmFsKTtcbiAgICAgIC8vIEV2ZW4gdGhvdWdoIHRoZSB0cmFuc3BpbGVyIGlzIG9wdGlvbmFsLCBpZiAkZ3d0RXhwb3J0IGlzIGZvdW5kLCBpdCdzXG4gICAgICAvLyBhIHNpZ24gdGhlIHRyYW5zcGlsZXIgd2FzIGxvYWRlZCBhbmQgdGhlICRqc2NvbXAudHJhbnNwaWxlICpzaG91bGQqXG4gICAgICAvLyBiZSB0aGVyZS5cbiAgICAgIGlmIChnb29nLmdsb2JhbFsnJGd3dEV4cG9ydCddICYmIGdvb2cuZ2xvYmFsWyckZ3d0RXhwb3J0J11bJyRqc2NvbXAnXSAmJlxuICAgICAgICAgICFnb29nLmdsb2JhbFsnJGd3dEV4cG9ydCddWyckanNjb21wJ11bJ3RyYW5zcGlsZSddKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAgICdUaGUgdHJhbnNwaWxlciBkaWQgbm90IHByb3Blcmx5IGV4cG9ydCB0aGUgXCJ0cmFuc3BpbGVcIiAnICtcbiAgICAgICAgICAgICdtZXRob2QuICRnd3RFeHBvcnQ6ICcgKyBKU09OLnN0cmluZ2lmeShnb29nLmdsb2JhbFsnJGd3dEV4cG9ydCddKSk7XG4gICAgICB9XG4gICAgICAvLyB0cmFuc3BpbGUuanMgb25seSBleHBvcnRzIGEgc2luZ2xlICRqc2NvbXAgZnVuY3Rpb24sIHRyYW5zcGlsZS4gV2VcbiAgICAgIC8vIGdyYWIganVzdCB0aGF0IGFuZCBhZGQgaXQgdG8gdGhlIGV4aXN0aW5nIGRlZmluaXRpb24gb2YgJGpzY29tcCB3aGljaFxuICAgICAgLy8gY29udGFpbnMgdGhlIHBvbHlmaWxscy5cbiAgICAgIGdvb2cuZ2xvYmFsWyckanNjb21wJ10udHJhbnNwaWxlID1cbiAgICAgICAgICBnb29nLmdsb2JhbFsnJGd3dEV4cG9ydCddWyckanNjb21wJ11bJ3RyYW5zcGlsZSddO1xuICAgICAganNjb21wID0gZ29vZy5nbG9iYWxbJyRqc2NvbXAnXTtcbiAgICAgIHRyYW5zcGlsZSA9IGpzY29tcC50cmFuc3BpbGU7XG4gICAgfVxuICB9XG4gIGlmICghdHJhbnNwaWxlKSB7XG4gICAgLy8gVGhlIHRyYW5zcGlsZXIgaXMgYW4gb3B0aW9uYWwgY29tcG9uZW50LiAgSWYgaXQncyBub3QgYXZhaWxhYmxlIHRoZW5cbiAgICAvLyByZXBsYWNlIGl0IHdpdGggYSBwYXNzLXRocm91Z2ggZnVuY3Rpb24gdGhhdCBzaW1wbHkgbG9ncy5cbiAgICB2YXIgc3VmZml4ID0gJyByZXF1aXJlcyB0cmFuc3BpbGF0aW9uIGJ1dCBubyB0cmFuc3BpbGVyIHdhcyBmb3VuZC4nO1xuICAgIHRyYW5zcGlsZSA9IGpzY29tcC50cmFuc3BpbGUgPSBmdW5jdGlvbihjb2RlLCBwYXRoKSB7XG4gICAgICAvLyBUT0RPKHNkaCk6IGZpZ3VyZSBvdXQgc29tZSB3YXkgdG8gZ2V0IHRoaXMgZXJyb3IgdG8gc2hvdyB1cFxuICAgICAgLy8gaW4gdGVzdCByZXN1bHRzLCBub3RpbmcgdGhhdCB0aGUgZmFpbHVyZSBtYXkgb2NjdXIgaW4gbWFueVxuICAgICAgLy8gZGlmZmVyZW50IHdheXMsIGluY2x1ZGluZyBpbiBsb2FkTW9kdWxlKCkgYmVmb3JlIHRoZSB0ZXN0XG4gICAgICAvLyBydW5uZXIgZXZlbiBjb21lcyB1cC5cbiAgICAgIGdvb2cubG9nVG9Db25zb2xlXyhwYXRoICsgc3VmZml4KTtcbiAgICAgIHJldHVybiBjb2RlO1xuICAgIH07XG4gIH1cbiAgLy8gTm90ZTogYW55IHRyYW5zcGlsYXRpb24gZXJyb3JzL3dhcm5pbmdzIHdpbGwgYmUgbG9nZ2VkIHRvIHRoZSBjb25zb2xlLlxuICByZXR1cm4gdHJhbnNwaWxlKGNvZGUsIHBhdGgsIHRhcmdldCk7XG59O1xuXG4vLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gTGFuZ3VhZ2UgRW5oYW5jZW1lbnRzXG4vLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5cbi8qKlxuICogVGhpcyBpcyBhIFwiZml4ZWRcIiB2ZXJzaW9uIG9mIHRoZSB0eXBlb2Ygb3BlcmF0b3IuICBJdCBkaWZmZXJzIGZyb20gdGhlIHR5cGVvZlxuICogb3BlcmF0b3IgaW4gc3VjaCBhIHdheSB0aGF0IG51bGwgcmV0dXJucyAnbnVsbCcgYW5kIGFycmF5cyByZXR1cm4gJ2FycmF5Jy5cbiAqIEBwYXJhbSB7P30gdmFsdWUgVGhlIHZhbHVlIHRvIGdldCB0aGUgdHlwZSBvZi5cbiAqIEByZXR1cm4ge3N0cmluZ30gVGhlIG5hbWUgb2YgdGhlIHR5cGUuXG4gKi9cbmdvb2cudHlwZU9mID0gZnVuY3Rpb24odmFsdWUpIHtcbiAgdmFyIHMgPSB0eXBlb2YgdmFsdWU7XG5cbiAgaWYgKHMgIT0gJ29iamVjdCcpIHtcbiAgICByZXR1cm4gcztcbiAgfVxuXG4gIGlmICghdmFsdWUpIHtcbiAgICByZXR1cm4gJ251bGwnO1xuICB9XG5cbiAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSB7XG4gICAgcmV0dXJuICdhcnJheSc7XG4gIH1cbiAgcmV0dXJuIHM7XG59O1xuXG5cbi8qKlxuICogUmV0dXJucyB0cnVlIGlmIHRoZSBvYmplY3QgbG9va3MgbGlrZSBhbiBhcnJheS4gVG8gcXVhbGlmeSBhcyBhcnJheSBsaWtlXG4gKiB0aGUgdmFsdWUgbmVlZHMgdG8gYmUgZWl0aGVyIGEgTm9kZUxpc3Qgb3IgYW4gb2JqZWN0IHdpdGggYSBOdW1iZXIgbGVuZ3RoXG4gKiBwcm9wZXJ0eS4gTm90ZSB0aGF0IGZvciB0aGlzIGZ1bmN0aW9uIG5laXRoZXIgc3RyaW5ncyBub3IgZnVuY3Rpb25zIGFyZVxuICogY29uc2lkZXJlZCBcImFycmF5LWxpa2VcIi5cbiAqXG4gKiBAcGFyYW0gez99IHZhbCBWYXJpYWJsZSB0byB0ZXN0LlxuICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB2YXJpYWJsZSBpcyBhbiBhcnJheS5cbiAqL1xuZ29vZy5pc0FycmF5TGlrZSA9IGZ1bmN0aW9uKHZhbCkge1xuICB2YXIgdHlwZSA9IGdvb2cudHlwZU9mKHZhbCk7XG4gIC8vIFdlIGRvIG5vdCB1c2UgZ29vZy5pc09iamVjdCBoZXJlIGluIG9yZGVyIHRvIGV4Y2x1ZGUgZnVuY3Rpb24gdmFsdWVzLlxuICByZXR1cm4gdHlwZSA9PSAnYXJyYXknIHx8IHR5cGUgPT0gJ29iamVjdCcgJiYgdHlwZW9mIHZhbC5sZW5ndGggPT0gJ251bWJlcic7XG59O1xuXG5cbi8qKlxuICogUmV0dXJucyB0cnVlIGlmIHRoZSBvYmplY3QgbG9va3MgbGlrZSBhIERhdGUuIFRvIHF1YWxpZnkgYXMgRGF0ZS1saWtlIHRoZVxuICogdmFsdWUgbmVlZHMgdG8gYmUgYW4gb2JqZWN0IGFuZCBoYXZlIGEgZ2V0RnVsbFllYXIoKSBmdW5jdGlvbi5cbiAqIEBwYXJhbSB7P30gdmFsIFZhcmlhYmxlIHRvIHRlc3QuXG4gKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHZhcmlhYmxlIGlzIGEgbGlrZSBhIERhdGUuXG4gKi9cbmdvb2cuaXNEYXRlTGlrZSA9IGZ1bmN0aW9uKHZhbCkge1xuICByZXR1cm4gZ29vZy5pc09iamVjdCh2YWwpICYmIHR5cGVvZiB2YWwuZ2V0RnVsbFllYXIgPT0gJ2Z1bmN0aW9uJztcbn07XG5cblxuLyoqXG4gKiBSZXR1cm5zIHRydWUgaWYgdGhlIHNwZWNpZmllZCB2YWx1ZSBpcyBhbiBvYmplY3QuICBUaGlzIGluY2x1ZGVzIGFycmF5cyBhbmRcbiAqIGZ1bmN0aW9ucy5cbiAqIEBwYXJhbSB7P30gdmFsIFZhcmlhYmxlIHRvIHRlc3QuXG4gKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHZhcmlhYmxlIGlzIGFuIG9iamVjdC5cbiAqL1xuZ29vZy5pc09iamVjdCA9IGZ1bmN0aW9uKHZhbCkge1xuICB2YXIgdHlwZSA9IHR5cGVvZiB2YWw7XG4gIHJldHVybiB0eXBlID09ICdvYmplY3QnICYmIHZhbCAhPSBudWxsIHx8IHR5cGUgPT0gJ2Z1bmN0aW9uJztcbiAgLy8gcmV0dXJuIE9iamVjdCh2YWwpID09PSB2YWwgYWxzbyB3b3JrcywgYnV0IGlzIHNsb3dlciwgZXNwZWNpYWxseSBpZiB2YWwgaXNcbiAgLy8gbm90IGFuIG9iamVjdC5cbn07XG5cblxuLyoqXG4gKiBHZXRzIGEgdW5pcXVlIElEIGZvciBhbiBvYmplY3QuIFRoaXMgbXV0YXRlcyB0aGUgb2JqZWN0IHNvIHRoYXQgZnVydGhlciBjYWxsc1xuICogd2l0aCB0aGUgc2FtZSBvYmplY3QgYXMgYSBwYXJhbWV0ZXIgcmV0dXJucyB0aGUgc2FtZSB2YWx1ZS4gVGhlIHVuaXF1ZSBJRCBpc1xuICogZ3VhcmFudGVlZCB0byBiZSB1bmlxdWUgYWNyb3NzIHRoZSBjdXJyZW50IHNlc3Npb24gYW1vbmdzdCBvYmplY3RzIHRoYXQgYXJlXG4gKiBwYXNzZWQgaW50byBgZ2V0VWlkYC4gVGhlcmUgaXMgbm8gZ3VhcmFudGVlIHRoYXQgdGhlIElEIGlzIHVuaXF1ZSBvclxuICogY29uc2lzdGVudCBhY3Jvc3Mgc2Vzc2lvbnMuIEl0IGlzIHVuc2FmZSB0byBnZW5lcmF0ZSB1bmlxdWUgSUQgZm9yIGZ1bmN0aW9uXG4gKiBwcm90b3R5cGVzLlxuICpcbiAqIEBwYXJhbSB7T2JqZWN0fSBvYmogVGhlIG9iamVjdCB0byBnZXQgdGhlIHVuaXF1ZSBJRCBmb3IuXG4gKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSB1bmlxdWUgSUQgZm9yIHRoZSBvYmplY3QuXG4gKi9cbmdvb2cuZ2V0VWlkID0gZnVuY3Rpb24ob2JqKSB7XG4gIC8vIFRPRE8oYXJ2KTogTWFrZSB0aGUgdHlwZSBzdHJpY3RlciwgZG8gbm90IGFjY2VwdCBudWxsLlxuICByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwgZ29vZy5VSURfUFJPUEVSVFlfKSAmJlxuICAgICAgb2JqW2dvb2cuVUlEX1BST1BFUlRZX10gfHxcbiAgICAgIChvYmpbZ29vZy5VSURfUFJPUEVSVFlfXSA9ICsrZ29vZy51aWRDb3VudGVyXyk7XG59O1xuXG5cbi8qKlxuICogV2hldGhlciB0aGUgZ2l2ZW4gb2JqZWN0IGlzIGFscmVhZHkgYXNzaWduZWQgYSB1bmlxdWUgSUQuXG4gKlxuICogVGhpcyBkb2VzIG5vdCBtb2RpZnkgdGhlIG9iamVjdC5cbiAqXG4gKiBAcGFyYW0geyFPYmplY3R9IG9iaiBUaGUgb2JqZWN0IHRvIGNoZWNrLlxuICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGVyZSBpcyBhbiBhc3NpZ25lZCB1bmlxdWUgaWQgZm9yIHRoZSBvYmplY3QuXG4gKi9cbmdvb2cuaGFzVWlkID0gZnVuY3Rpb24ob2JqKSB7XG4gIHJldHVybiAhIW9ialtnb29nLlVJRF9QUk9QRVJUWV9dO1xufTtcblxuXG4vKipcbiAqIFJlbW92ZXMgdGhlIHVuaXF1ZSBJRCBmcm9tIGFuIG9iamVjdC4gVGhpcyBpcyB1c2VmdWwgaWYgdGhlIG9iamVjdCB3YXNcbiAqIHByZXZpb3VzbHkgbXV0YXRlZCB1c2luZyBgZ29vZy5nZXRVaWRgIGluIHdoaWNoIGNhc2UgdGhlIG11dGF0aW9uIGlzXG4gKiB1bmRvbmUuXG4gKiBAcGFyYW0ge09iamVjdH0gb2JqIFRoZSBvYmplY3QgdG8gcmVtb3ZlIHRoZSB1bmlxdWUgSUQgZmllbGQgZnJvbS5cbiAqL1xuZ29vZy5yZW1vdmVVaWQgPSBmdW5jdGlvbihvYmopIHtcbiAgLy8gVE9ETyhhcnYpOiBNYWtlIHRoZSB0eXBlIHN0cmljdGVyLCBkbyBub3QgYWNjZXB0IG51bGwuXG5cbiAgLy8gSW4gSUUsIERPTSBub2RlcyBhcmUgbm90IGluc3RhbmNlcyBvZiBPYmplY3QgYW5kIHRocm93IGFuIGV4Y2VwdGlvbiBpZiB3ZVxuICAvLyB0cnkgdG8gZGVsZXRlLiAgSW5zdGVhZCB3ZSB0cnkgdG8gdXNlIHJlbW92ZUF0dHJpYnV0ZS5cbiAgaWYgKG9iaiAhPT0gbnVsbCAmJiAncmVtb3ZlQXR0cmlidXRlJyBpbiBvYmopIHtcbiAgICBvYmoucmVtb3ZlQXR0cmlidXRlKGdvb2cuVUlEX1BST1BFUlRZXyk7XG4gIH1cblxuICB0cnkge1xuICAgIGRlbGV0ZSBvYmpbZ29vZy5VSURfUFJPUEVSVFlfXTtcbiAgfSBjYXRjaCAoZXgpIHtcbiAgfVxufTtcblxuXG4vKipcbiAqIE5hbWUgZm9yIHVuaXF1ZSBJRCBwcm9wZXJ0eS4gSW5pdGlhbGl6ZWQgaW4gYSB3YXkgdG8gaGVscCBhdm9pZCBjb2xsaXNpb25zXG4gKiB3aXRoIG90aGVyIGNsb3N1cmUgSmF2YVNjcmlwdCBvbiB0aGUgc2FtZSBwYWdlLlxuICogQHR5cGUge3N0cmluZ31cbiAqIEBwcml2YXRlXG4gKi9cbmdvb2cuVUlEX1BST1BFUlRZXyA9ICdjbG9zdXJlX3VpZF8nICsgKChNYXRoLnJhbmRvbSgpICogMWU5KSA+Pj4gMCk7XG5cblxuLyoqXG4gKiBDb3VudGVyIGZvciBVSUQuXG4gKiBAdHlwZSB7bnVtYmVyfVxuICogQHByaXZhdGVcbiAqL1xuZ29vZy51aWRDb3VudGVyXyA9IDA7XG5cblxuLyoqXG4gKiBDbG9uZXMgYSB2YWx1ZS4gVGhlIGlucHV0IG1heSBiZSBhbiBPYmplY3QsIEFycmF5LCBvciBiYXNpYyB0eXBlLiBPYmplY3RzIGFuZFxuICogYXJyYXlzIHdpbGwgYmUgY2xvbmVkIHJlY3Vyc2l2ZWx5LlxuICpcbiAqIFdBUk5JTkdTOlxuICogPGNvZGU+Z29vZy5jbG9uZU9iamVjdDwvY29kZT4gZG9lcyBub3QgZGV0ZWN0IHJlZmVyZW5jZSBsb29wcy4gT2JqZWN0cyB0aGF0XG4gKiByZWZlciB0byB0aGVtc2VsdmVzIHdpbGwgY2F1c2UgaW5maW5pdGUgcmVjdXJzaW9uLlxuICpcbiAqIDxjb2RlPmdvb2cuY2xvbmVPYmplY3Q8L2NvZGU+IGlzIHVuYXdhcmUgb2YgdW5pcXVlIGlkZW50aWZpZXJzLCBhbmQgY29waWVzXG4gKiBVSURzIGNyZWF0ZWQgYnkgPGNvZGU+Z2V0VWlkPC9jb2RlPiBpbnRvIGNsb25lZCByZXN1bHRzLlxuICpcbiAqIEBwYXJhbSB7Kn0gb2JqIFRoZSB2YWx1ZSB0byBjbG9uZS5cbiAqIEByZXR1cm4geyp9IEEgY2xvbmUgb2YgdGhlIGlucHV0IHZhbHVlLlxuICogQGRlcHJlY2F0ZWQgZ29vZy5jbG9uZU9iamVjdCBpcyB1bnNhZmUuIFByZWZlciB0aGUgZ29vZy5vYmplY3QgbWV0aG9kcy5cbiAqL1xuZ29vZy5jbG9uZU9iamVjdCA9IGZ1bmN0aW9uKG9iaikge1xuICB2YXIgdHlwZSA9IGdvb2cudHlwZU9mKG9iaik7XG4gIGlmICh0eXBlID09ICdvYmplY3QnIHx8IHR5cGUgPT0gJ2FycmF5Jykge1xuICAgIGlmICh0eXBlb2Ygb2JqLmNsb25lID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICByZXR1cm4gb2JqLmNsb25lKCk7XG4gICAgfVxuICAgIHZhciBjbG9uZSA9IHR5cGUgPT0gJ2FycmF5JyA/IFtdIDoge307XG4gICAgZm9yICh2YXIga2V5IGluIG9iaikge1xuICAgICAgY2xvbmVba2V5XSA9IGdvb2cuY2xvbmVPYmplY3Qob2JqW2tleV0pO1xuICAgIH1cbiAgICByZXR1cm4gY2xvbmU7XG4gIH1cblxuICByZXR1cm4gb2JqO1xufTtcblxuXG4vKipcbiAqIEEgbmF0aXZlIGltcGxlbWVudGF0aW9uIG9mIGdvb2cuYmluZC5cbiAqIEBwYXJhbSB7P2Z1bmN0aW9uKHRoaXM6VCwgLi4uKX0gZm4gQSBmdW5jdGlvbiB0byBwYXJ0aWFsbHkgYXBwbHkuXG4gKiBAcGFyYW0ge1R9IHNlbGZPYmogU3BlY2lmaWVzIHRoZSBvYmplY3Qgd2hpY2ggdGhpcyBzaG91bGQgcG9pbnQgdG8gd2hlbiB0aGVcbiAqICAgICBmdW5jdGlvbiBpcyBydW4uXG4gKiBAcGFyYW0gey4uLip9IHZhcl9hcmdzIEFkZGl0aW9uYWwgYXJndW1lbnRzIHRoYXQgYXJlIHBhcnRpYWxseSBhcHBsaWVkIHRvIHRoZVxuICogICAgIGZ1bmN0aW9uLlxuICogQHJldHVybiB7IUZ1bmN0aW9ufSBBIHBhcnRpYWxseS1hcHBsaWVkIGZvcm0gb2YgdGhlIGZ1bmN0aW9uIGdvb2cuYmluZCgpIHdhc1xuICogICAgIGludm9rZWQgYXMgYSBtZXRob2Qgb2YuXG4gKiBAdGVtcGxhdGUgVFxuICogQHByaXZhdGVcbiAqL1xuZ29vZy5iaW5kTmF0aXZlXyA9IGZ1bmN0aW9uKGZuLCBzZWxmT2JqLCB2YXJfYXJncykge1xuICByZXR1cm4gLyoqIEB0eXBlIHshRnVuY3Rpb259ICovIChmbi5jYWxsLmFwcGx5KGZuLmJpbmQsIGFyZ3VtZW50cykpO1xufTtcblxuXG4vKipcbiAqIEEgcHVyZS1KUyBpbXBsZW1lbnRhdGlvbiBvZiBnb29nLmJpbmQuXG4gKiBAcGFyYW0gez9mdW5jdGlvbih0aGlzOlQsIC4uLil9IGZuIEEgZnVuY3Rpb24gdG8gcGFydGlhbGx5IGFwcGx5LlxuICogQHBhcmFtIHtUfSBzZWxmT2JqIFNwZWNpZmllcyB0aGUgb2JqZWN0IHdoaWNoIHRoaXMgc2hvdWxkIHBvaW50IHRvIHdoZW4gdGhlXG4gKiAgICAgZnVuY3Rpb24gaXMgcnVuLlxuICogQHBhcmFtIHsuLi4qfSB2YXJfYXJncyBBZGRpdGlvbmFsIGFyZ3VtZW50cyB0aGF0IGFyZSBwYXJ0aWFsbHkgYXBwbGllZCB0byB0aGVcbiAqICAgICBmdW5jdGlvbi5cbiAqIEByZXR1cm4geyFGdW5jdGlvbn0gQSBwYXJ0aWFsbHktYXBwbGllZCBmb3JtIG9mIHRoZSBmdW5jdGlvbiBnb29nLmJpbmQoKSB3YXNcbiAqICAgICBpbnZva2VkIGFzIGEgbWV0aG9kIG9mLlxuICogQHRlbXBsYXRlIFRcbiAqIEBwcml2YXRlXG4gKi9cbmdvb2cuYmluZEpzXyA9IGZ1bmN0aW9uKGZuLCBzZWxmT2JqLCB2YXJfYXJncykge1xuICBpZiAoIWZuKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCk7XG4gIH1cblxuICBpZiAoYXJndW1lbnRzLmxlbmd0aCA+IDIpIHtcbiAgICB2YXIgYm91bmRBcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAyKTtcbiAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICAvLyBQcmVwZW5kIHRoZSBib3VuZCBhcmd1bWVudHMgdG8gdGhlIGN1cnJlbnQgYXJndW1lbnRzLlxuICAgICAgdmFyIG5ld0FyZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMpO1xuICAgICAgQXJyYXkucHJvdG90eXBlLnVuc2hpZnQuYXBwbHkobmV3QXJncywgYm91bmRBcmdzKTtcbiAgICAgIHJldHVybiBmbi5hcHBseShzZWxmT2JqLCBuZXdBcmdzKTtcbiAgICB9O1xuXG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIGZuLmFwcGx5KHNlbGZPYmosIGFyZ3VtZW50cyk7XG4gICAgfTtcbiAgfVxufTtcblxuXG4vKipcbiAqIFBhcnRpYWxseSBhcHBsaWVzIHRoaXMgZnVuY3Rpb24gdG8gYSBwYXJ0aWN1bGFyICd0aGlzIG9iamVjdCcgYW5kIHplcm8gb3JcbiAqIG1vcmUgYXJndW1lbnRzLiBUaGUgcmVzdWx0IGlzIGEgbmV3IGZ1bmN0aW9uIHdpdGggc29tZSBhcmd1bWVudHMgb2YgdGhlIGZpcnN0XG4gKiBmdW5jdGlvbiBwcmUtZmlsbGVkIGFuZCB0aGUgdmFsdWUgb2YgdGhpcyAncHJlLXNwZWNpZmllZCcuXG4gKlxuICogUmVtYWluaW5nIGFyZ3VtZW50cyBzcGVjaWZpZWQgYXQgY2FsbC10aW1lIGFyZSBhcHBlbmRlZCB0byB0aGUgcHJlLXNwZWNpZmllZFxuICogb25lcy5cbiAqXG4gKiBBbHNvIHNlZToge0BsaW5rICNwYXJ0aWFsfS5cbiAqXG4gKiBVc2FnZTpcbiAqIDxwcmU+dmFyIGJhck1ldGhCb3VuZCA9IGdvb2cuYmluZChteUZ1bmN0aW9uLCBteU9iaiwgJ2FyZzEnLCAnYXJnMicpO1xuICogYmFyTWV0aEJvdW5kKCdhcmczJywgJ2FyZzQnKTs8L3ByZT5cbiAqXG4gKiBAcGFyYW0gez9mdW5jdGlvbih0aGlzOlQsIC4uLil9IGZuIEEgZnVuY3Rpb24gdG8gcGFydGlhbGx5IGFwcGx5LlxuICogQHBhcmFtIHtUfSBzZWxmT2JqIFNwZWNpZmllcyB0aGUgb2JqZWN0IHdoaWNoIHRoaXMgc2hvdWxkIHBvaW50IHRvIHdoZW4gdGhlXG4gKiAgICAgZnVuY3Rpb24gaXMgcnVuLlxuICogQHBhcmFtIHsuLi4qfSB2YXJfYXJncyBBZGRpdGlvbmFsIGFyZ3VtZW50cyB0aGF0IGFyZSBwYXJ0aWFsbHkgYXBwbGllZCB0byB0aGVcbiAqICAgICBmdW5jdGlvbi5cbiAqIEByZXR1cm4geyFGdW5jdGlvbn0gQSBwYXJ0aWFsbHktYXBwbGllZCBmb3JtIG9mIHRoZSBmdW5jdGlvbiBnb29nLmJpbmQoKSB3YXNcbiAqICAgICBpbnZva2VkIGFzIGEgbWV0aG9kIG9mLlxuICogQHRlbXBsYXRlIFRcbiAqIEBzdXBwcmVzcyB7ZGVwcmVjYXRlZH0gU2VlIGFib3ZlLlxuICogQGRlcHJlY2F0ZWQgdXNlIGA9PiB7fWAgb3IgRnVuY3Rpb24ucHJvdG90eXBlLmJpbmQgaW5zdGVhZC5cbiAqL1xuZ29vZy5iaW5kID0gZnVuY3Rpb24oZm4sIHNlbGZPYmosIHZhcl9hcmdzKSB7XG4gIC8vIFRPRE8obmlja3NhbnRvcyk6IG5hcnJvdyB0aGUgdHlwZSBzaWduYXR1cmUuXG4gIGlmIChGdW5jdGlvbi5wcm90b3R5cGUuYmluZCAmJlxuICAgICAgLy8gTk9URShuaWNrc2FudG9zKTogU29tZWJvZHkgcHVsbGVkIGJhc2UuanMgaW50byB0aGUgZGVmYXVsdCBDaHJvbWVcbiAgICAgIC8vIGV4dGVuc2lvbiBlbnZpcm9ubWVudC4gVGhpcyBtZWFucyB0aGF0IGZvciBDaHJvbWUgZXh0ZW5zaW9ucywgdGhleSBnZXRcbiAgICAgIC8vIHRoZSBpbXBsZW1lbnRhdGlvbiBvZiBGdW5jdGlvbi5wcm90b3R5cGUuYmluZCB0aGF0IGNhbGxzIGdvb2cuYmluZFxuICAgICAgLy8gaW5zdGVhZCBvZiB0aGUgbmF0aXZlIG9uZS4gRXZlbiB3b3JzZSwgd2UgZG9uJ3Qgd2FudCB0byBpbnRyb2R1Y2UgYVxuICAgICAgLy8gY2lyY3VsYXIgZGVwZW5kZW5jeSBiZXR3ZWVuIGdvb2cuYmluZCBhbmQgRnVuY3Rpb24ucHJvdG90eXBlLmJpbmQsIHNvXG4gICAgICAvLyB3ZSBoYXZlIHRvIGhhY2sgdGhpcyB0byBtYWtlIHN1cmUgaXQgd29ya3MgY29ycmVjdGx5LlxuICAgICAgRnVuY3Rpb24ucHJvdG90eXBlLmJpbmQudG9TdHJpbmcoKS5pbmRleE9mKCduYXRpdmUgY29kZScpICE9IC0xKSB7XG4gICAgZ29vZy5iaW5kID0gZ29vZy5iaW5kTmF0aXZlXztcbiAgfSBlbHNlIHtcbiAgICBnb29nLmJpbmQgPSBnb29nLmJpbmRKc187XG4gIH1cbiAgcmV0dXJuIGdvb2cuYmluZC5hcHBseShudWxsLCBhcmd1bWVudHMpO1xufTtcblxuXG4vKipcbiAqIExpa2UgZ29vZy5iaW5kKCksIGV4Y2VwdCB0aGF0IGEgJ3RoaXMgb2JqZWN0JyBpcyBub3QgcmVxdWlyZWQuIFVzZWZ1bCB3aGVuXG4gKiB0aGUgdGFyZ2V0IGZ1bmN0aW9uIGlzIGFscmVhZHkgYm91bmQuXG4gKlxuICogVXNhZ2U6XG4gKiB2YXIgZyA9IGdvb2cucGFydGlhbChmLCBhcmcxLCBhcmcyKTtcbiAqIGcoYXJnMywgYXJnNCk7XG4gKlxuICogQHBhcmFtIHtGdW5jdGlvbn0gZm4gQSBmdW5jdGlvbiB0byBwYXJ0aWFsbHkgYXBwbHkuXG4gKiBAcGFyYW0gey4uLip9IHZhcl9hcmdzIEFkZGl0aW9uYWwgYXJndW1lbnRzIHRoYXQgYXJlIHBhcnRpYWxseSBhcHBsaWVkIHRvIGZuLlxuICogQHJldHVybiB7IUZ1bmN0aW9ufSBBIHBhcnRpYWxseS1hcHBsaWVkIGZvcm0gb2YgdGhlIGZ1bmN0aW9uIGdvb2cucGFydGlhbCgpXG4gKiAgICAgd2FzIGludm9rZWQgYXMgYSBtZXRob2Qgb2YuXG4gKi9cbmdvb2cucGFydGlhbCA9IGZ1bmN0aW9uKGZuLCB2YXJfYXJncykge1xuICB2YXIgYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSk7XG4gIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAvLyBDbG9uZSB0aGUgYXJyYXkgKHdpdGggc2xpY2UoKSkgYW5kIGFwcGVuZCBhZGRpdGlvbmFsIGFyZ3VtZW50c1xuICAgIC8vIHRvIHRoZSBleGlzdGluZyBhcmd1bWVudHMuXG4gICAgdmFyIG5ld0FyZ3MgPSBhcmdzLnNsaWNlKCk7XG4gICAgbmV3QXJncy5wdXNoLmFwcGx5KG5ld0FyZ3MsIGFyZ3VtZW50cyk7XG4gICAgcmV0dXJuIGZuLmFwcGx5KC8qKiBAdHlwZSB7P30gKi8gKHRoaXMpLCBuZXdBcmdzKTtcbiAgfTtcbn07XG5cblxuLyoqXG4gKiBDb3BpZXMgYWxsIHRoZSBtZW1iZXJzIG9mIGEgc291cmNlIG9iamVjdCB0byBhIHRhcmdldCBvYmplY3QuIFRoaXMgbWV0aG9kXG4gKiBkb2VzIG5vdCB3b3JrIG9uIGFsbCBicm93c2VycyBmb3IgYWxsIG9iamVjdHMgdGhhdCBjb250YWluIGtleXMgc3VjaCBhc1xuICogdG9TdHJpbmcgb3IgaGFzT3duUHJvcGVydHkuIFVzZSBnb29nLm9iamVjdC5leHRlbmQgZm9yIHRoaXMgcHVycG9zZS5cbiAqXG4gKiBOT1RFOiBTb21lIGhhdmUgYWR2b2NhdGVkIGZvciB0aGUgdXNlIG9mIGdvb2cubWl4aW4gdG8gc2V0dXAgY2xhc3Nlc1xuICogd2l0aCBtdWx0aXBsZSBpbmhlcml0ZW5jZSAodHJhaXRzLCBtaXhpbnMsIGV0YykuICBIb3dldmVyLCBhcyBpdCBzaW1wbHlcbiAqIHVzZXMgXCJmb3IgaW5cIiwgdGhpcyBpcyBub3QgY29tcGF0aWJsZSB3aXRoIEVTNiBjbGFzc2VzIHdob3NlIG1ldGhvZHMgYXJlXG4gKiBub24tZW51bWVyYWJsZS4gIENoYW5naW5nIHRoaXMsIHdvdWxkIGJyZWFrIGNhc2VzIHdoZXJlIG5vbi1lbnVtZXJhYmxlXG4gKiBwcm9wZXJ0aWVzIGFyZSBub3QgZXhwZWN0ZWQuXG4gKlxuICogQHBhcmFtIHtPYmplY3R9IHRhcmdldCBUYXJnZXQuXG4gKiBAcGFyYW0ge09iamVjdH0gc291cmNlIFNvdXJjZS5cbiAqIEBkZXByZWNhdGVkIFByZWZlciBPYmplY3QuYXNzaWduXG4gKi9cbmdvb2cubWl4aW4gPSBmdW5jdGlvbih0YXJnZXQsIHNvdXJjZSkge1xuICBmb3IgKHZhciB4IGluIHNvdXJjZSkge1xuICAgIHRhcmdldFt4XSA9IHNvdXJjZVt4XTtcbiAgfVxuXG4gIC8vIEZvciBJRTcgb3IgbG93ZXIsIHRoZSBmb3ItaW4tbG9vcCBkb2VzIG5vdCBjb250YWluIGFueSBwcm9wZXJ0aWVzIHRoYXQgYXJlXG4gIC8vIG5vdCBlbnVtZXJhYmxlIG9uIHRoZSBwcm90b3R5cGUgb2JqZWN0IChmb3IgZXhhbXBsZSwgaXNQcm90b3R5cGVPZiBmcm9tXG4gIC8vIE9iamVjdC5wcm90b3R5cGUpIGJ1dCBhbHNvIGl0IHdpbGwgbm90IGluY2x1ZGUgJ3JlcGxhY2UnIG9uIG9iamVjdHMgdGhhdFxuICAvLyBleHRlbmQgU3RyaW5nIGFuZCBjaGFuZ2UgJ3JlcGxhY2UnIChub3QgdGhhdCBpdCBpcyBjb21tb24gZm9yIGFueW9uZSB0b1xuICAvLyBleHRlbmQgYW55dGhpbmcgZXhjZXB0IE9iamVjdCkuXG59O1xuXG5cbi8qKlxuICogQHJldHVybiB7bnVtYmVyfSBBbiBpbnRlZ2VyIHZhbHVlIHJlcHJlc2VudGluZyB0aGUgbnVtYmVyIG9mIG1pbGxpc2Vjb25kc1xuICogICAgIGJldHdlZW4gbWlkbmlnaHQsIEphbnVhcnkgMSwgMTk3MCBhbmQgdGhlIGN1cnJlbnQgdGltZS5cbiAqIEBkZXByZWNhdGVkIFVzZSBEYXRlLm5vd1xuICovXG5nb29nLm5vdyA9IGZ1bmN0aW9uKCkge1xuICByZXR1cm4gRGF0ZS5ub3coKTtcbn07XG5cblxuLyoqXG4gKiBFdmFscyBKYXZhU2NyaXB0IGluIHRoZSBnbG9iYWwgc2NvcGUuXG4gKlxuICogVGhyb3dzIGFuIGV4Y2VwdGlvbiBpZiBuZWl0aGVyIGV4ZWNTY3JpcHQgb3IgZXZhbCBpcyBkZWZpbmVkLlxuICogQHBhcmFtIHtzdHJpbmd8IVRydXN0ZWRTY3JpcHR9IHNjcmlwdCBKYXZhU2NyaXB0IHN0cmluZy5cbiAqL1xuZ29vZy5nbG9iYWxFdmFsID0gZnVuY3Rpb24oc2NyaXB0KSB7XG4gICgwLCBldmFsKShzY3JpcHQpO1xufTtcblxuXG4vKipcbiAqIE9wdGlvbmFsIG1hcCBvZiBDU1MgY2xhc3MgbmFtZXMgdG8gb2JmdXNjYXRlZCBuYW1lcyB1c2VkIHdpdGhcbiAqIGdvb2cuZ2V0Q3NzTmFtZSgpLlxuICogQHByaXZhdGUgeyFPYmplY3Q8c3RyaW5nLCBzdHJpbmc+fHVuZGVmaW5lZH1cbiAqIEBzZWUgZ29vZy5zZXRDc3NOYW1lTWFwcGluZ1xuICovXG5nb29nLmNzc05hbWVNYXBwaW5nXztcblxuXG4vKipcbiAqIE9wdGlvbmFsIG9iZnVzY2F0aW9uIHN0eWxlIGZvciBDU1MgY2xhc3MgbmFtZXMuIFNob3VsZCBiZSBzZXQgdG8gZWl0aGVyXG4gKiAnQllfV0hPTEUnIG9yICdCWV9QQVJUJyBpZiBkZWZpbmVkLlxuICogQHR5cGUge3N0cmluZ3x1bmRlZmluZWR9XG4gKiBAcHJpdmF0ZVxuICogQHNlZSBnb29nLnNldENzc05hbWVNYXBwaW5nXG4gKi9cbmdvb2cuY3NzTmFtZU1hcHBpbmdTdHlsZV87XG5cblxuXG4vKipcbiAqIEEgaG9vayBmb3IgbW9kaWZ5aW5nIHRoZSBkZWZhdWx0IGJlaGF2aW9yIGdvb2cuZ2V0Q3NzTmFtZS4gVGhlIGZ1bmN0aW9uXG4gKiBpZiBwcmVzZW50LCB3aWxsIHJlY2VpdmUgdGhlIHN0YW5kYXJkIG91dHB1dCBvZiB0aGUgZ29vZy5nZXRDc3NOYW1lIGFzXG4gKiBpdHMgaW5wdXQuXG4gKlxuICogQHR5cGUgeyhmdW5jdGlvbihzdHJpbmcpOnN0cmluZyl8dW5kZWZpbmVkfVxuICovXG5nb29nLmdsb2JhbC5DTE9TVVJFX0NTU19OQU1FX01BUF9GTjtcblxuXG4vKipcbiAqIEhhbmRsZXMgc3RyaW5ncyB0aGF0IGFyZSBpbnRlbmRlZCB0byBiZSB1c2VkIGFzIENTUyBjbGFzcyBuYW1lcy5cbiAqXG4gKiBUaGlzIGZ1bmN0aW9uIHdvcmtzIGluIHRhbmRlbSB3aXRoIEBzZWUgZ29vZy5zZXRDc3NOYW1lTWFwcGluZy5cbiAqXG4gKiBXaXRob3V0IGFueSBtYXBwaW5nIHNldCwgdGhlIGFyZ3VtZW50cyBhcmUgc2ltcGxlIGpvaW5lZCB3aXRoIGEgaHlwaGVuIGFuZFxuICogcGFzc2VkIHRocm91Z2ggdW5hbHRlcmVkLlxuICpcbiAqIFdoZW4gdGhlcmUgaXMgYSBtYXBwaW5nLCB0aGVyZSBhcmUgdHdvIHBvc3NpYmxlIHN0eWxlcyBpbiB3aGljaCB0aGVzZVxuICogbWFwcGluZ3MgYXJlIHVzZWQuIEluIHRoZSBCWV9QQVJUIHN0eWxlLCBlYWNoIHBhcnQgKGkuZS4gaW4gYmV0d2VlbiBoeXBoZW5zKVxuICogb2YgdGhlIHBhc3NlZCBpbiBjc3MgbmFtZSBpcyByZXdyaXR0ZW4gYWNjb3JkaW5nIHRvIHRoZSBtYXAuIEluIHRoZSBCWV9XSE9MRVxuICogc3R5bGUsIHRoZSBmdWxsIGNzcyBuYW1lIGlzIGxvb2tlZCB1cCBpbiB0aGUgbWFwIGRpcmVjdGx5LiBJZiBhIHJld3JpdGUgaXNcbiAqIG5vdCBzcGVjaWZpZWQgYnkgdGhlIG1hcCwgdGhlIGNvbXBpbGVyIHdpbGwgb3V0cHV0IGEgd2FybmluZy5cbiAqXG4gKiBXaGVuIHRoZSBtYXBwaW5nIGlzIHBhc3NlZCB0byB0aGUgY29tcGlsZXIsIGl0IHdpbGwgcmVwbGFjZSBjYWxscyB0b1xuICogZ29vZy5nZXRDc3NOYW1lIHdpdGggdGhlIHN0cmluZ3MgZnJvbSB0aGUgbWFwcGluZywgZS5nLlxuICogICAgIHZhciB4ID0gZ29vZy5nZXRDc3NOYW1lKCdmb28nKTtcbiAqICAgICB2YXIgeSA9IGdvb2cuZ2V0Q3NzTmFtZSh0aGlzLmJhc2VDbGFzcywgJ2FjdGl2ZScpO1xuICogIGJlY29tZXM6XG4gKiAgICAgdmFyIHggPSAnZm9vJztcbiAqICAgICB2YXIgeSA9IHRoaXMuYmFzZUNsYXNzICsgJy1hY3RpdmUnO1xuICpcbiAqIElmIG9uZSBhcmd1bWVudCBpcyBwYXNzZWQgaXQgd2lsbCBiZSBwcm9jZXNzZWQsIGlmIHR3byBhcmUgcGFzc2VkIG9ubHkgdGhlXG4gKiBtb2RpZmllciB3aWxsIGJlIHByb2Nlc3NlZCwgYXMgaXQgaXMgYXNzdW1lZCB0aGUgZmlyc3QgYXJndW1lbnQgd2FzIGdlbmVyYXRlZFxuICogYXMgYSByZXN1bHQgb2YgY2FsbGluZyBnb29nLmdldENzc05hbWUuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IGNsYXNzTmFtZSBUaGUgY2xhc3MgbmFtZS5cbiAqIEBwYXJhbSB7c3RyaW5nPX0gb3B0X21vZGlmaWVyIEEgbW9kaWZpZXIgdG8gYmUgYXBwZW5kZWQgdG8gdGhlIGNsYXNzIG5hbWUuXG4gKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSBjbGFzcyBuYW1lIG9yIHRoZSBjb25jYXRlbmF0aW9uIG9mIHRoZSBjbGFzcyBuYW1lIGFuZFxuICogICAgIHRoZSBtb2RpZmllci5cbiAqL1xuZ29vZy5nZXRDc3NOYW1lID0gZnVuY3Rpb24oY2xhc3NOYW1lLCBvcHRfbW9kaWZpZXIpIHtcbiAgLy8gU3RyaW5nKCkgaXMgdXNlZCBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIGNvbXBpbGVkIHNveSB3aGVyZSB0aGUgcGFzc2VkXG4gIC8vIGNsYXNzTmFtZSBjYW4gYmUgbm9uLXN0cmluZyBvYmplY3RzLlxuICBpZiAoU3RyaW5nKGNsYXNzTmFtZSkuY2hhckF0KDApID09ICcuJykge1xuICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgJ2NsYXNzTmFtZSBwYXNzZWQgaW4gZ29vZy5nZXRDc3NOYW1lIG11c3Qgbm90IHN0YXJ0IHdpdGggXCIuXCIuJyArXG4gICAgICAgICcgWW91IHBhc3NlZDogJyArIGNsYXNzTmFtZSk7XG4gIH1cblxuICB2YXIgZ2V0TWFwcGluZyA9IGZ1bmN0aW9uKGNzc05hbWUpIHtcbiAgICByZXR1cm4gZ29vZy5jc3NOYW1lTWFwcGluZ19bY3NzTmFtZV0gfHwgY3NzTmFtZTtcbiAgfTtcblxuICB2YXIgcmVuYW1lQnlQYXJ0cyA9IGZ1bmN0aW9uKGNzc05hbWUpIHtcbiAgICAvLyBSZW1hcCBhbGwgdGhlIHBhcnRzIGluZGl2aWR1YWxseS5cbiAgICB2YXIgcGFydHMgPSBjc3NOYW1lLnNwbGl0KCctJyk7XG4gICAgdmFyIG1hcHBlZCA9IFtdO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcGFydHMubGVuZ3RoOyBpKyspIHtcbiAgICAgIG1hcHBlZC5wdXNoKGdldE1hcHBpbmcocGFydHNbaV0pKTtcbiAgICB9XG4gICAgcmV0dXJuIG1hcHBlZC5qb2luKCctJyk7XG4gIH07XG5cbiAgdmFyIHJlbmFtZTtcbiAgaWYgKGdvb2cuY3NzTmFtZU1hcHBpbmdfKSB7XG4gICAgcmVuYW1lID1cbiAgICAgICAgZ29vZy5jc3NOYW1lTWFwcGluZ1N0eWxlXyA9PSAnQllfV0hPTEUnID8gZ2V0TWFwcGluZyA6IHJlbmFtZUJ5UGFydHM7XG4gIH0gZWxzZSB7XG4gICAgcmVuYW1lID0gZnVuY3Rpb24oYSkge1xuICAgICAgcmV0dXJuIGE7XG4gICAgfTtcbiAgfVxuXG4gIHZhciByZXN1bHQgPVxuICAgICAgb3B0X21vZGlmaWVyID8gY2xhc3NOYW1lICsgJy0nICsgcmVuYW1lKG9wdF9tb2RpZmllcikgOiByZW5hbWUoY2xhc3NOYW1lKTtcblxuICAvLyBUaGUgc3BlY2lhbCBDTE9TVVJFX0NTU19OQU1FX01BUF9GTiBhbGxvd3MgdXNlcnMgdG8gc3BlY2lmeSBmdXJ0aGVyXG4gIC8vIHByb2Nlc3Npbmcgb2YgdGhlIGNsYXNzIG5hbWUuXG4gIGlmIChnb29nLmdsb2JhbC5DTE9TVVJFX0NTU19OQU1FX01BUF9GTikge1xuICAgIHJldHVybiBnb29nLmdsb2JhbC5DTE9TVVJFX0NTU19OQU1FX01BUF9GTihyZXN1bHQpO1xuICB9XG5cbiAgcmV0dXJuIHJlc3VsdDtcbn07XG5cblxuLyoqXG4gKiBTZXRzIHRoZSBtYXAgdG8gY2hlY2sgd2hlbiByZXR1cm5pbmcgYSB2YWx1ZSBmcm9tIGdvb2cuZ2V0Q3NzTmFtZSgpLiBFeGFtcGxlOlxuICogPHByZT5cbiAqIGdvb2cuc2V0Q3NzTmFtZU1hcHBpbmcoe1xuICogICBcImdvb2dcIjogXCJhXCIsXG4gKiAgIFwiZGlzYWJsZWRcIjogXCJiXCIsXG4gKiB9KTtcbiAqXG4gKiB2YXIgeCA9IGdvb2cuZ2V0Q3NzTmFtZSgnZ29vZycpO1xuICogLy8gVGhlIGZvbGxvd2luZyBldmFsdWF0ZXMgdG86IFwiYSBhLWJcIi5cbiAqIGdvb2cuZ2V0Q3NzTmFtZSgnZ29vZycpICsgJyAnICsgZ29vZy5nZXRDc3NOYW1lKHgsICdkaXNhYmxlZCcpXG4gKiA8L3ByZT5cbiAqIFdoZW4gZGVjbGFyZWQgYXMgYSBtYXAgb2Ygc3RyaW5nIGxpdGVyYWxzIHRvIHN0cmluZyBsaXRlcmFscywgdGhlIEpTQ29tcGlsZXJcbiAqIHdpbGwgcmVwbGFjZSBhbGwgY2FsbHMgdG8gZ29vZy5nZXRDc3NOYW1lKCkgdXNpbmcgdGhlIHN1cHBsaWVkIG1hcCBpZiB0aGVcbiAqIC0tcHJvY2Vzc19jbG9zdXJlX3ByaW1pdGl2ZXMgZmxhZyBpcyBzZXQuXG4gKlxuICogQHBhcmFtIHshT2JqZWN0fSBtYXBwaW5nIEEgbWFwIG9mIHN0cmluZ3MgdG8gc3RyaW5ncyB3aGVyZSBrZXlzIGFyZSBwb3NzaWJsZVxuICogICAgIGFyZ3VtZW50cyB0byBnb29nLmdldENzc05hbWUoKSBhbmQgdmFsdWVzIGFyZSB0aGUgY29ycmVzcG9uZGluZyB2YWx1ZXNcbiAqICAgICB0aGF0IHNob3VsZCBiZSByZXR1cm5lZC5cbiAqIEBwYXJhbSB7c3RyaW5nPX0gb3B0X3N0eWxlIFRoZSBzdHlsZSBvZiBjc3MgbmFtZSBtYXBwaW5nLiBUaGVyZSBhcmUgdHdvIHZhbGlkXG4gKiAgICAgb3B0aW9uczogJ0JZX1BBUlQnLCBhbmQgJ0JZX1dIT0xFJy5cbiAqIEBzZWUgZ29vZy5nZXRDc3NOYW1lIGZvciBhIGRlc2NyaXB0aW9uLlxuICovXG5nb29nLnNldENzc05hbWVNYXBwaW5nID0gZnVuY3Rpb24obWFwcGluZywgb3B0X3N0eWxlKSB7XG4gIGdvb2cuY3NzTmFtZU1hcHBpbmdfID0gbWFwcGluZztcbiAgZ29vZy5jc3NOYW1lTWFwcGluZ1N0eWxlXyA9IG9wdF9zdHlsZTtcbn07XG5cblxuLyoqXG4gKiBUbyB1c2UgQ1NTIHJlbmFtaW5nIGluIGNvbXBpbGVkIG1vZGUsIG9uZSBvZiB0aGUgaW5wdXQgZmlsZXMgc2hvdWxkIGhhdmUgYVxuICogY2FsbCB0byBnb29nLnNldENzc05hbWVNYXBwaW5nKCkgd2l0aCBhbiBvYmplY3QgbGl0ZXJhbCB0aGF0IHRoZSBKU0NvbXBpbGVyXG4gKiBjYW4gZXh0cmFjdCBhbmQgdXNlIHRvIHJlcGxhY2UgYWxsIGNhbGxzIHRvIGdvb2cuZ2V0Q3NzTmFtZSgpLiBJbiB1bmNvbXBpbGVkXG4gKiBtb2RlLCBKYXZhU2NyaXB0IGNvZGUgc2hvdWxkIGJlIGxvYWRlZCBiZWZvcmUgdGhpcyBiYXNlLmpzIGZpbGUgdGhhdCBkZWNsYXJlc1xuICogYSBnbG9iYWwgdmFyaWFibGUsIENMT1NVUkVfQ1NTX05BTUVfTUFQUElORywgd2hpY2ggaXMgdXNlZCBiZWxvdy4gVGhpcyBpc1xuICogdG8gZW5zdXJlIHRoYXQgdGhlIG1hcHBpbmcgaXMgbG9hZGVkIGJlZm9yZSBhbnkgY2FsbHMgdG8gZ29vZy5nZXRDc3NOYW1lKClcbiAqIGFyZSBtYWRlIGluIHVuY29tcGlsZWQgbW9kZS5cbiAqXG4gKiBBIGhvb2sgZm9yIG92ZXJyaWRpbmcgdGhlIENTUyBuYW1lIG1hcHBpbmcuXG4gKiBAdHlwZSB7IU9iamVjdDxzdHJpbmcsIHN0cmluZz58dW5kZWZpbmVkfVxuICovXG5nb29nLmdsb2JhbC5DTE9TVVJFX0NTU19OQU1FX01BUFBJTkc7XG5cblxuaWYgKCFDT01QSUxFRCAmJiBnb29nLmdsb2JhbC5DTE9TVVJFX0NTU19OQU1FX01BUFBJTkcpIHtcbiAgLy8gVGhpcyBkb2VzIG5vdCBjYWxsIGdvb2cuc2V0Q3NzTmFtZU1hcHBpbmcoKSBiZWNhdXNlIHRoZSBKU0NvbXBpbGVyXG4gIC8vIHJlcXVpcmVzIHRoYXQgZ29vZy5zZXRDc3NOYW1lTWFwcGluZygpIGJlIGNhbGxlZCB3aXRoIGFuIG9iamVjdCBsaXRlcmFsLlxuICBnb29nLmNzc05hbWVNYXBwaW5nXyA9IGdvb2cuZ2xvYmFsLkNMT1NVUkVfQ1NTX05BTUVfTUFQUElORztcbn1cblxuXG4vKipcbiAqIEdldHMgYSBsb2NhbGl6ZWQgbWVzc2FnZS5cbiAqXG4gKiBUaGlzIGZ1bmN0aW9uIGlzIGEgY29tcGlsZXIgcHJpbWl0aXZlLiBJZiB5b3UgZ2l2ZSB0aGUgY29tcGlsZXIgYSBsb2NhbGl6ZWRcbiAqIG1lc3NhZ2UgYnVuZGxlLCBpdCB3aWxsIHJlcGxhY2UgdGhlIHN0cmluZyBhdCBjb21waWxlLXRpbWUgd2l0aCBhIGxvY2FsaXplZFxuICogdmVyc2lvbiwgYW5kIGV4cGFuZCBnb29nLmdldE1zZyBjYWxsIHRvIGEgY29uY2F0ZW5hdGVkIHN0cmluZy5cbiAqXG4gKiBNZXNzYWdlcyBtdXN0IGJlIGluaXRpYWxpemVkIGluIHRoZSBmb3JtOlxuICogPGNvZGU+XG4gKiB2YXIgTVNHX05BTUUgPSBnb29nLmdldE1zZygnSGVsbG8geyRwbGFjZWhvbGRlcn0nLCB7J3BsYWNlaG9sZGVyJzogJ3dvcmxkJ30pO1xuICogPC9jb2RlPlxuICpcbiAqIFRoaXMgZnVuY3Rpb24gcHJvZHVjZXMgYSBzdHJpbmcgd2hpY2ggc2hvdWxkIGJlIHRyZWF0ZWQgYXMgcGxhaW4gdGV4dC4gVXNlXG4gKiB7QGxpbmsgZ29vZy5odG1sLlNhZmVIdG1sRm9ybWF0dGVyfSBpbiBjb25qdW5jdGlvbiB3aXRoIGdvb2cuZ2V0TXNnIHRvXG4gKiBwcm9kdWNlIFNhZmVIdG1sLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBzdHIgVHJhbnNsYXRhYmxlIHN0cmluZywgcGxhY2VzIGhvbGRlcnMgaW4gdGhlIGZvcm0geyRmb299LlxuICogQHBhcmFtIHtPYmplY3Q8c3RyaW5nLCBzdHJpbmc+PX0gb3B0X3ZhbHVlcyBNYXBzIHBsYWNlIGhvbGRlciBuYW1lIHRvIHZhbHVlLlxuICogQHBhcmFtIHt7aHRtbDogKGJvb2xlYW58dW5kZWZpbmVkKSxcbiAqICAgICAgICAgdW5lc2NhcGVIdG1sRW50aXRpZXM6IChib29sZWFufHVuZGVmaW5lZCl9PX0gb3B0X29wdGlvbnMgT3B0aW9uczpcbiAqICAgICBodG1sOiBFc2NhcGUgJzwnIGluIHN0ciB0byAnJmx0OycuIFVzZWQgYnkgQ2xvc3VyZSBUZW1wbGF0ZXMgd2hlcmUgdGhlXG4gKiAgICAgZ2VuZXJhdGVkIGNvZGUgc2l6ZSBhbmQgcGVyZm9ybWFuY2UgaXMgY3JpdGljYWwgd2hpY2ggaXMgd2h5IHtAbGlua1xuICogICAgIGdvb2cuaHRtbC5TYWZlSHRtbEZvcm1hdHRlcn0gaXMgbm90IHVzZWQuIFRoZSB2YWx1ZSBtdXN0IGJlIGxpdGVyYWwgdHJ1ZVxuICogICAgIG9yIGZhbHNlLlxuICogICAgIHVuZXNjYXBlSHRtbEVudGl0aWVzOiBVbmVzY2FwZSBjb21tb24gaHRtbCBlbnRpdGllczogJmd0OywgJmx0OywgJmFwb3M7LFxuICogICAgICZxdW90OyBhbmQgJmFtcDsuIFVzZWQgZm9yIG1lc3NhZ2VzIG5vdCBpbiBIVE1MIGNvbnRleHQsIHN1Y2ggYXMgd2l0aFxuICogICAgIGB0ZXh0Q29udGVudGAgcHJvcGVydHkuXG4gKiBAcmV0dXJuIHtzdHJpbmd9IG1lc3NhZ2Ugd2l0aCBwbGFjZWhvbGRlcnMgZmlsbGVkLlxuICovXG5nb29nLmdldE1zZyA9IGZ1bmN0aW9uKHN0ciwgb3B0X3ZhbHVlcywgb3B0X29wdGlvbnMpIHtcbiAgaWYgKG9wdF9vcHRpb25zICYmIG9wdF9vcHRpb25zLmh0bWwpIHtcbiAgICAvLyBOb3RlIHRoYXQgJyYnIGlzIG5vdCByZXBsYWNlZCBiZWNhdXNlIHRoZSB0cmFuc2xhdGlvbiBjYW4gY29udGFpbiBIVE1MXG4gICAgLy8gZW50aXRpZXMuXG4gICAgc3RyID0gc3RyLnJlcGxhY2UoLzwvZywgJyZsdDsnKTtcbiAgfVxuICBpZiAob3B0X29wdGlvbnMgJiYgb3B0X29wdGlvbnMudW5lc2NhcGVIdG1sRW50aXRpZXMpIHtcbiAgICAvLyBOb3RlIHRoYXQgXCImYW1wO1wiIG11c3QgYmUgdGhlIGxhc3QgdG8gYXZvaWQgXCJjcmVhdGluZ1wiIG5ldyBlbnRpdGllcy5cbiAgICBzdHIgPSBzdHIucmVwbGFjZSgvJmx0Oy9nLCAnPCcpXG4gICAgICAgICAgICAgIC5yZXBsYWNlKC8mZ3Q7L2csICc+JylcbiAgICAgICAgICAgICAgLnJlcGxhY2UoLyZhcG9zOy9nLCAnXFwnJylcbiAgICAgICAgICAgICAgLnJlcGxhY2UoLyZxdW90Oy9nLCAnXCInKVxuICAgICAgICAgICAgICAucmVwbGFjZSgvJmFtcDsvZywgJyYnKTtcbiAgfVxuICBpZiAob3B0X3ZhbHVlcykge1xuICAgIHN0ciA9IHN0ci5yZXBsYWNlKC9cXHtcXCQoW159XSspfS9nLCBmdW5jdGlvbihtYXRjaCwga2V5KSB7XG4gICAgICByZXR1cm4gKG9wdF92YWx1ZXMgIT0gbnVsbCAmJiBrZXkgaW4gb3B0X3ZhbHVlcykgPyBvcHRfdmFsdWVzW2tleV0gOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF0Y2g7XG4gICAgfSk7XG4gIH1cbiAgcmV0dXJuIHN0cjtcbn07XG5cblxuLyoqXG4gKiBHZXRzIGEgbG9jYWxpemVkIG1lc3NhZ2UuIElmIHRoZSBtZXNzYWdlIGRvZXMgbm90IGhhdmUgYSB0cmFuc2xhdGlvbiwgZ2l2ZXMgYVxuICogZmFsbGJhY2sgbWVzc2FnZS5cbiAqXG4gKiBUaGlzIGlzIHVzZWZ1bCB3aGVuIGludHJvZHVjaW5nIGEgbmV3IG1lc3NhZ2UgdGhhdCBoYXMgbm90IHlldCBiZWVuXG4gKiB0cmFuc2xhdGVkIGludG8gYWxsIGxhbmd1YWdlcy5cbiAqXG4gKiBUaGlzIGZ1bmN0aW9uIGlzIGEgY29tcGlsZXIgcHJpbWl0aXZlLiBNdXN0IGJlIHVzZWQgaW4gdGhlIGZvcm06XG4gKiA8Y29kZT52YXIgeCA9IGdvb2cuZ2V0TXNnV2l0aEZhbGxiYWNrKE1TR19BLCBNU0dfQik7PC9jb2RlPlxuICogd2hlcmUgTVNHX0EgYW5kIE1TR19CIHdlcmUgaW5pdGlhbGl6ZWQgd2l0aCBnb29nLmdldE1zZy5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gYSBUaGUgcHJlZmVycmVkIG1lc3NhZ2UuXG4gKiBAcGFyYW0ge3N0cmluZ30gYiBUaGUgZmFsbGJhY2sgbWVzc2FnZS5cbiAqIEByZXR1cm4ge3N0cmluZ30gVGhlIGJlc3QgdHJhbnNsYXRlZCBtZXNzYWdlLlxuICovXG5nb29nLmdldE1zZ1dpdGhGYWxsYmFjayA9IGZ1bmN0aW9uKGEsIGIpIHtcbiAgcmV0dXJuIGE7XG59O1xuXG5cbi8qKlxuICogRXhwb3NlcyBhbiB1bm9iZnVzY2F0ZWQgZ2xvYmFsIG5hbWVzcGFjZSBwYXRoIGZvciB0aGUgZ2l2ZW4gb2JqZWN0LlxuICogTm90ZSB0aGF0IGZpZWxkcyBvZiB0aGUgZXhwb3J0ZWQgb2JqZWN0ICp3aWxsKiBiZSBvYmZ1c2NhdGVkLCB1bmxlc3MgdGhleSBhcmVcbiAqIGV4cG9ydGVkIGluIHR1cm4gdmlhIHRoaXMgZnVuY3Rpb24gb3IgZ29vZy5leHBvcnRQcm9wZXJ0eS5cbiAqXG4gKiBBbHNvIGhhbmR5IGZvciBtYWtpbmcgcHVibGljIGl0ZW1zIHRoYXQgYXJlIGRlZmluZWQgaW4gYW5vbnltb3VzIGNsb3N1cmVzLlxuICpcbiAqIGV4LiBnb29nLmV4cG9ydFN5bWJvbCgncHVibGljLnBhdGguRm9vJywgRm9vKTtcbiAqXG4gKiBleC4gZ29vZy5leHBvcnRTeW1ib2woJ3B1YmxpYy5wYXRoLkZvby5zdGF0aWNGdW5jdGlvbicsIEZvby5zdGF0aWNGdW5jdGlvbik7XG4gKiAgICAgcHVibGljLnBhdGguRm9vLnN0YXRpY0Z1bmN0aW9uKCk7XG4gKlxuICogZXguIGdvb2cuZXhwb3J0U3ltYm9sKCdwdWJsaWMucGF0aC5Gb28ucHJvdG90eXBlLm15TWV0aG9kJyxcbiAqICAgICAgICAgICAgICAgICAgICAgICBGb28ucHJvdG90eXBlLm15TWV0aG9kKTtcbiAqICAgICBuZXcgcHVibGljLnBhdGguRm9vKCkubXlNZXRob2QoKTtcbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gcHVibGljUGF0aCBVbm9iZnVzY2F0ZWQgbmFtZSB0byBleHBvcnQuXG4gKiBAcGFyYW0geyp9IG9iamVjdCBPYmplY3QgdGhlIG5hbWUgc2hvdWxkIHBvaW50IHRvLlxuICogQHBhcmFtIHs/T2JqZWN0PX0gb2JqZWN0VG9FeHBvcnRUbyBUaGUgb2JqZWN0IHRvIGFkZCB0aGUgcGF0aCB0bzsgZGVmYXVsdFxuICogICAgIGlzIGdvb2cuZ2xvYmFsLlxuICovXG5nb29nLmV4cG9ydFN5bWJvbCA9IGZ1bmN0aW9uKHB1YmxpY1BhdGgsIG9iamVjdCwgb2JqZWN0VG9FeHBvcnRUbykge1xuICBnb29nLmV4cG9ydFBhdGhfKFxuICAgICAgcHVibGljUGF0aCwgb2JqZWN0LCAvKiBvdmVyd3JpdGVJbXBsaWNpdD0gKi8gdHJ1ZSwgb2JqZWN0VG9FeHBvcnRUbyk7XG59O1xuXG5cbi8qKlxuICogRXhwb3J0cyBhIHByb3BlcnR5IHVub2JmdXNjYXRlZCBpbnRvIHRoZSBvYmplY3QncyBuYW1lc3BhY2UuXG4gKiBleC4gZ29vZy5leHBvcnRQcm9wZXJ0eShGb28sICdzdGF0aWNGdW5jdGlvbicsIEZvby5zdGF0aWNGdW5jdGlvbik7XG4gKiBleC4gZ29vZy5leHBvcnRQcm9wZXJ0eShGb28ucHJvdG90eXBlLCAnbXlNZXRob2QnLCBGb28ucHJvdG90eXBlLm15TWV0aG9kKTtcbiAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgT2JqZWN0IHdob3NlIHN0YXRpYyBwcm9wZXJ0eSBpcyBiZWluZyBleHBvcnRlZC5cbiAqIEBwYXJhbSB7c3RyaW5nfSBwdWJsaWNOYW1lIFVub2JmdXNjYXRlZCBuYW1lIHRvIGV4cG9ydC5cbiAqIEBwYXJhbSB7Kn0gc3ltYm9sIE9iamVjdCB0aGUgbmFtZSBzaG91bGQgcG9pbnQgdG8uXG4gKi9cbmdvb2cuZXhwb3J0UHJvcGVydHkgPSBmdW5jdGlvbihvYmplY3QsIHB1YmxpY05hbWUsIHN5bWJvbCkge1xuICBvYmplY3RbcHVibGljTmFtZV0gPSBzeW1ib2w7XG59O1xuXG5cbi8qKlxuICogSW5oZXJpdCB0aGUgcHJvdG90eXBlIG1ldGhvZHMgZnJvbSBvbmUgY29uc3RydWN0b3IgaW50byBhbm90aGVyLlxuICpcbiAqIFVzYWdlOlxuICogPHByZT5cbiAqIGZ1bmN0aW9uIFBhcmVudENsYXNzKGEsIGIpIHsgfVxuICogUGFyZW50Q2xhc3MucHJvdG90eXBlLmZvbyA9IGZ1bmN0aW9uKGEpIHsgfTtcbiAqXG4gKiBmdW5jdGlvbiBDaGlsZENsYXNzKGEsIGIsIGMpIHtcbiAqICAgQ2hpbGRDbGFzcy5iYXNlKHRoaXMsICdjb25zdHJ1Y3RvcicsIGEsIGIpO1xuICogfVxuICogZ29vZy5pbmhlcml0cyhDaGlsZENsYXNzLCBQYXJlbnRDbGFzcyk7XG4gKlxuICogdmFyIGNoaWxkID0gbmV3IENoaWxkQ2xhc3MoJ2EnLCAnYicsICdzZWUnKTtcbiAqIGNoaWxkLmZvbygpOyAvLyBUaGlzIHdvcmtzLlxuICogPC9wcmU+XG4gKlxuICogQHBhcmFtIHshRnVuY3Rpb259IGNoaWxkQ3RvciBDaGlsZCBjbGFzcy5cbiAqIEBwYXJhbSB7IUZ1bmN0aW9ufSBwYXJlbnRDdG9yIFBhcmVudCBjbGFzcy5cbiAqIEBzdXBwcmVzcyB7c3RyaWN0TWlzc2luZ1Byb3BlcnRpZXN9IHN1cGVyQ2xhc3NfIGFuZCBiYXNlIGlzIG5vdCBkZWZpbmVkIG9uXG4gKiAgICBGdW5jdGlvbi5cbiAqIEBkZXByZWNhdGVkIFVzZSBFQ01BU2NyaXB0IGNsYXNzIHN5bnRheCBpbnN0ZWFkLlxuICovXG5nb29nLmluaGVyaXRzID0gZnVuY3Rpb24oY2hpbGRDdG9yLCBwYXJlbnRDdG9yKSB7XG4gIC8qKiBAY29uc3RydWN0b3IgKi9cbiAgZnVuY3Rpb24gdGVtcEN0b3IoKSB7fVxuICB0ZW1wQ3Rvci5wcm90b3R5cGUgPSBwYXJlbnRDdG9yLnByb3RvdHlwZTtcbiAgY2hpbGRDdG9yLnN1cGVyQ2xhc3NfID0gcGFyZW50Q3Rvci5wcm90b3R5cGU7XG4gIGNoaWxkQ3Rvci5wcm90b3R5cGUgPSBuZXcgdGVtcEN0b3IoKTtcbiAgLyoqIEBvdmVycmlkZSAqL1xuICBjaGlsZEN0b3IucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gY2hpbGRDdG9yO1xuXG4gIC8qKlxuICAgKiBDYWxscyBzdXBlcmNsYXNzIGNvbnN0cnVjdG9yL21ldGhvZC5cbiAgICpcbiAgICogVGhpcyBmdW5jdGlvbiBpcyBvbmx5IGF2YWlsYWJsZSBpZiB5b3UgdXNlIGdvb2cuaW5oZXJpdHMgdG9cbiAgICogZXhwcmVzcyBpbmhlcml0YW5jZSByZWxhdGlvbnNoaXBzIGJldHdlZW4gY2xhc3Nlcy5cbiAgICpcbiAgICogTk9URTogVGhpcyBpcyBhIHJlcGxhY2VtZW50IGZvciBnb29nLmJhc2UgYW5kIGZvciBzdXBlckNsYXNzX1xuICAgKiBwcm9wZXJ0eSBkZWZpbmVkIGluIGNoaWxkQ3Rvci5cbiAgICpcbiAgICogQHBhcmFtIHshT2JqZWN0fSBtZSBTaG91bGQgYWx3YXlzIGJlIFwidGhpc1wiLlxuICAgKiBAcGFyYW0ge3N0cmluZ30gbWV0aG9kTmFtZSBUaGUgbWV0aG9kIG5hbWUgdG8gY2FsbC4gQ2FsbGluZ1xuICAgKiAgICAgc3VwZXJjbGFzcyBjb25zdHJ1Y3RvciBjYW4gYmUgZG9uZSB3aXRoIHRoZSBzcGVjaWFsIHN0cmluZ1xuICAgKiAgICAgJ2NvbnN0cnVjdG9yJy5cbiAgICogQHBhcmFtIHsuLi4qfSB2YXJfYXJncyBUaGUgYXJndW1lbnRzIHRvIHBhc3MgdG8gc3VwZXJjbGFzc1xuICAgKiAgICAgbWV0aG9kL2NvbnN0cnVjdG9yLlxuICAgKiBAcmV0dXJuIHsqfSBUaGUgcmV0dXJuIHZhbHVlIG9mIHRoZSBzdXBlcmNsYXNzIG1ldGhvZC9jb25zdHJ1Y3Rvci5cbiAgICovXG4gIGNoaWxkQ3Rvci5iYXNlID0gZnVuY3Rpb24obWUsIG1ldGhvZE5hbWUsIHZhcl9hcmdzKSB7XG4gICAgLy8gQ29weWluZyB1c2luZyBsb29wIHRvIGF2b2lkIGRlb3AgZHVlIHRvIHBhc3NpbmcgYXJndW1lbnRzIG9iamVjdCB0b1xuICAgIC8vIGZ1bmN0aW9uLiBUaGlzIGlzIGZhc3RlciBpbiBtYW55IEpTIGVuZ2luZXMgYXMgb2YgbGF0ZSAyMDE0LlxuICAgIHZhciBhcmdzID0gbmV3IEFycmF5KGFyZ3VtZW50cy5sZW5ndGggLSAyKTtcbiAgICBmb3IgKHZhciBpID0gMjsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykge1xuICAgICAgYXJnc1tpIC0gMl0gPSBhcmd1bWVudHNbaV07XG4gICAgfVxuICAgIHJldHVybiBwYXJlbnRDdG9yLnByb3RvdHlwZVttZXRob2ROYW1lXS5hcHBseShtZSwgYXJncyk7XG4gIH07XG59O1xuXG5cbi8qKlxuICogQWxsb3cgZm9yIGFsaWFzaW5nIHdpdGhpbiBzY29wZSBmdW5jdGlvbnMuICBUaGlzIGZ1bmN0aW9uIGV4aXN0cyBmb3JcbiAqIHVuY29tcGlsZWQgY29kZSAtIGluIGNvbXBpbGVkIGNvZGUgdGhlIGNhbGxzIHdpbGwgYmUgaW5saW5lZCBhbmQgdGhlIGFsaWFzZXNcbiAqIGFwcGxpZWQuICBJbiB1bmNvbXBpbGVkIGNvZGUgdGhlIGZ1bmN0aW9uIGlzIHNpbXBseSBydW4gc2luY2UgdGhlIGFsaWFzZXMgYXNcbiAqIHdyaXR0ZW4gYXJlIHZhbGlkIEphdmFTY3JpcHQuXG4gKlxuICpcbiAqIEBwYXJhbSB7ZnVuY3Rpb24oKX0gZm4gRnVuY3Rpb24gdG8gY2FsbC4gIFRoaXMgZnVuY3Rpb24gY2FuIGNvbnRhaW4gYWxpYXNlc1xuICogICAgIHRvIG5hbWVzcGFjZXMgKGUuZy4gXCJ2YXIgZG9tID0gZ29vZy5kb21cIikgb3IgY2xhc3Nlc1xuICogICAgIChlLmcuIFwidmFyIFRpbWVyID0gZ29vZy5UaW1lclwiKS5cbiAqIEBkZXByZWNhdGVkIFVzZSBnb29nLm1vZHVsZSBpbnN0ZWFkLlxuICovXG5nb29nLnNjb3BlID0gZnVuY3Rpb24oZm4pIHtcbiAgaWYgKGdvb2cuaXNJbk1vZHVsZUxvYWRlcl8oKSkge1xuICAgIHRocm93IG5ldyBFcnJvcignZ29vZy5zY29wZSBpcyBub3Qgc3VwcG9ydGVkIHdpdGhpbiBhIG1vZHVsZS4nKTtcbiAgfVxuICBmbi5jYWxsKGdvb2cuZ2xvYmFsKTtcbn07XG5cblxuLypcbiAqIFRvIHN1cHBvcnQgdW5jb21waWxlZCwgc3RyaWN0IG1vZGUgYnVuZGxlcyB0aGF0IHVzZSBldmFsIHRvIGRpdmlkZSBzb3VyY2VcbiAqIGxpa2Ugc286XG4gKiAgICBldmFsKCdzb21lU291cmNlOy8vIyBzb3VyY2VVcmwgc291cmNlZmlsZS5qcycpO1xuICogV2UgbmVlZCB0byBleHBvcnQgdGhlIGdsb2JhbGx5IGRlZmluZWQgc3ltYm9scyBcImdvb2dcIiBhbmQgXCJDT01QSUxFRFwiLlxuICogRXhwb3J0aW5nIFwiZ29vZ1wiIGJyZWFrcyB0aGUgY29tcGlsZXIgb3B0aW1pemF0aW9ucywgc28gd2UgcmVxdWlyZWQgdGhhdFxuICogYmUgZGVmaW5lZCBleHRlcm5hbGx5LlxuICogTk9URTogV2UgZG9uJ3QgdXNlIGdvb2cuZXhwb3J0U3ltYm9sIGhlcmUgYmVjYXVzZSB3ZSBkb24ndCB3YW50IHRvIHRyaWdnZXJcbiAqIGV4dGVybiBnZW5lcmF0aW9uIHdoZW4gdGhhdCBjb21waWxlciBvcHRpb24gaXMgZW5hYmxlZC5cbiAqL1xuaWYgKCFDT01QSUxFRCkge1xuICBnb29nLmdsb2JhbFsnQ09NUElMRUQnXSA9IENPTVBJTEVEO1xufVxuXG5cbi8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBnb29nLmRlZmluZUNsYXNzIGltcGxlbWVudGF0aW9uXG4vLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5cbi8qKlxuICogQ3JlYXRlcyBhIHJlc3RyaWN0ZWQgZm9ybSBvZiBhIENsb3N1cmUgXCJjbGFzc1wiOlxuICogICAtIGZyb20gdGhlIGNvbXBpbGVyJ3MgcGVyc3BlY3RpdmUsIHRoZSBpbnN0YW5jZSByZXR1cm5lZCBmcm9tIHRoZVxuICogICAgIGNvbnN0cnVjdG9yIGlzIHNlYWxlZCAobm8gbmV3IHByb3BlcnRpZXMgbWF5IGJlIGFkZGVkKS4gIFRoaXMgZW5hYmxlc1xuICogICAgIGJldHRlciBjaGVja3MuXG4gKiAgIC0gdGhlIGNvbXBpbGVyIHdpbGwgcmV3cml0ZSB0aGlzIGRlZmluaXRpb24gdG8gYSBmb3JtIHRoYXQgaXMgb3B0aW1hbFxuICogICAgIGZvciB0eXBlIGNoZWNraW5nIGFuZCBvcHRpbWl6YXRpb24gKGluaXRpYWxseSB0aGlzIHdpbGwgYmUgYSBtb3JlXG4gKiAgICAgdHJhZGl0aW9uYWwgZm9ybSkuXG4gKlxuICogQHBhcmFtIHtGdW5jdGlvbn0gc3VwZXJDbGFzcyBUaGUgc3VwZXJjbGFzcywgT2JqZWN0IG9yIG51bGwuXG4gKiBAcGFyYW0ge2dvb2cuZGVmaW5lQ2xhc3MuQ2xhc3NEZXNjcmlwdG9yfSBkZWZcbiAqICAgICBBbiBvYmplY3QgbGl0ZXJhbCBkZXNjcmliaW5nXG4gKiAgICAgdGhlIGNsYXNzLiAgSXQgbWF5IGhhdmUgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOlxuICogICAgIFwiY29uc3RydWN0b3JcIjogdGhlIGNvbnN0cnVjdG9yIGZ1bmN0aW9uXG4gKiAgICAgXCJzdGF0aWNzXCI6IGFuIG9iamVjdCBsaXRlcmFsIGNvbnRhaW5pbmcgbWV0aG9kcyB0byBhZGQgdG8gdGhlIGNvbnN0cnVjdG9yXG4gKiAgICAgICAgYXMgXCJzdGF0aWNcIiBtZXRob2RzIG9yIGEgZnVuY3Rpb24gdGhhdCB3aWxsIHJlY2VpdmUgdGhlIGNvbnN0cnVjdG9yXG4gKiAgICAgICAgZnVuY3Rpb24gYXMgaXRzIG9ubHkgcGFyYW1ldGVyIHRvIHdoaWNoIHN0YXRpYyBwcm9wZXJ0aWVzIGNhblxuICogICAgICAgIGJlIGFkZGVkLlxuICogICAgIGFsbCBvdGhlciBwcm9wZXJ0aWVzIGFyZSBhZGRlZCB0byB0aGUgcHJvdG90eXBlLlxuICogQHJldHVybiB7IUZ1bmN0aW9ufSBUaGUgY2xhc3MgY29uc3RydWN0b3IuXG4gKiBAZGVwcmVjYXRlZCBVc2UgRUNNQVNjcmlwdCBjbGFzcyBzeW50YXggaW5zdGVhZC5cbiAqL1xuZ29vZy5kZWZpbmVDbGFzcyA9IGZ1bmN0aW9uKHN1cGVyQ2xhc3MsIGRlZikge1xuICAvLyBUT0RPKGpvaG5sZW56KTogY29uc2lkZXIgbWFraW5nIHRoZSBzdXBlckNsYXNzIGFuIG9wdGlvbmFsIHBhcmFtZXRlci5cbiAgdmFyIGNvbnN0cnVjdG9yID0gZGVmLmNvbnN0cnVjdG9yO1xuICB2YXIgc3RhdGljcyA9IGRlZi5zdGF0aWNzO1xuICAvLyBXcmFwIHRoZSBjb25zdHJ1Y3RvciBwcmlvciB0byBzZXR0aW5nIHVwIHRoZSBwcm90b3R5cGUgYW5kIHN0YXRpYyBtZXRob2RzLlxuICBpZiAoIWNvbnN0cnVjdG9yIHx8IGNvbnN0cnVjdG9yID09IE9iamVjdC5wcm90b3R5cGUuY29uc3RydWN0b3IpIHtcbiAgICBjb25zdHJ1Y3RvciA9IGZ1bmN0aW9uKCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICdjYW5ub3QgaW5zdGFudGlhdGUgYW4gaW50ZXJmYWNlIChubyBjb25zdHJ1Y3RvciBkZWZpbmVkKS4nKTtcbiAgICB9O1xuICB9XG5cbiAgdmFyIGNscyA9IGdvb2cuZGVmaW5lQ2xhc3MuY3JlYXRlU2VhbGluZ0NvbnN0cnVjdG9yXyhjb25zdHJ1Y3Rvciwgc3VwZXJDbGFzcyk7XG4gIGlmIChzdXBlckNsYXNzKSB7XG4gICAgZ29vZy5pbmhlcml0cyhjbHMsIHN1cGVyQ2xhc3MpO1xuICB9XG5cbiAgLy8gUmVtb3ZlIGFsbCB0aGUgcHJvcGVydGllcyB0aGF0IHNob3VsZCBub3QgYmUgY29waWVkIHRvIHRoZSBwcm90b3R5cGUuXG4gIGRlbGV0ZSBkZWYuY29uc3RydWN0b3I7XG4gIGRlbGV0ZSBkZWYuc3RhdGljcztcblxuICBnb29nLmRlZmluZUNsYXNzLmFwcGx5UHJvcGVydGllc18oY2xzLnByb3RvdHlwZSwgZGVmKTtcbiAgaWYgKHN0YXRpY3MgIT0gbnVsbCkge1xuICAgIGlmIChzdGF0aWNzIGluc3RhbmNlb2YgRnVuY3Rpb24pIHtcbiAgICAgIHN0YXRpY3MoY2xzKTtcbiAgICB9IGVsc2Uge1xuICAgICAgZ29vZy5kZWZpbmVDbGFzcy5hcHBseVByb3BlcnRpZXNfKGNscywgc3RhdGljcyk7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIGNscztcbn07XG5cblxuLyoqXG4gKiBAdHlwZWRlZiB7e1xuICogICBjb25zdHJ1Y3RvcjogKCFGdW5jdGlvbnx1bmRlZmluZWQpLFxuICogICBzdGF0aWNzOiAoT2JqZWN0fHVuZGVmaW5lZHxmdW5jdGlvbihGdW5jdGlvbik6dm9pZClcbiAqIH19XG4gKi9cbmdvb2cuZGVmaW5lQ2xhc3MuQ2xhc3NEZXNjcmlwdG9yO1xuXG5cbi8qKlxuICogQGRlZmluZSB7Ym9vbGVhbn0gV2hldGhlciB0aGUgaW5zdGFuY2VzIHJldHVybmVkIGJ5IGdvb2cuZGVmaW5lQ2xhc3Mgc2hvdWxkXG4gKiAgICAgYmUgc2VhbGVkIHdoZW4gcG9zc2libGUuXG4gKlxuICogV2hlbiBzZWFsaW5nIGlzIGRpc2FibGVkIHRoZSBjb25zdHJ1Y3RvciBmdW5jdGlvbiB3aWxsIG5vdCBiZSB3cmFwcGVkIGJ5XG4gKiBnb29nLmRlZmluZUNsYXNzLCBtYWtpbmcgaXQgaW5jb21wYXRpYmxlIHdpdGggRVM2IGNsYXNzIG1ldGhvZHMuXG4gKi9cbmdvb2cuZGVmaW5lQ2xhc3MuU0VBTF9DTEFTU19JTlNUQU5DRVMgPVxuICAgIGdvb2cuZGVmaW5lKCdnb29nLmRlZmluZUNsYXNzLlNFQUxfQ0xBU1NfSU5TVEFOQ0VTJywgZ29vZy5ERUJVRyk7XG5cblxuLyoqXG4gKiBJZiBnb29nLmRlZmluZUNsYXNzLlNFQUxfQ0xBU1NfSU5TVEFOQ0VTIGlzIGVuYWJsZWQgYW5kIE9iamVjdC5zZWFsIGlzXG4gKiBkZWZpbmVkLCB0aGlzIGZ1bmN0aW9uIHdpbGwgd3JhcCB0aGUgY29uc3RydWN0b3IgaW4gYSBmdW5jdGlvbiB0aGF0IHNlYWxzIHRoZVxuICogcmVzdWx0cyBvZiB0aGUgcHJvdmlkZWQgY29uc3RydWN0b3IgZnVuY3Rpb24uXG4gKlxuICogQHBhcmFtIHshRnVuY3Rpb259IGN0ciBUaGUgY29uc3RydWN0b3Igd2hvc2UgcmVzdWx0cyBtYXliZSBiZSBzZWFsZWQuXG4gKiBAcGFyYW0ge0Z1bmN0aW9ufSBzdXBlckNsYXNzIFRoZSBzdXBlcmNsYXNzIGNvbnN0cnVjdG9yLlxuICogQHJldHVybiB7IUZ1bmN0aW9ufSBUaGUgcmVwbGFjZW1lbnQgY29uc3RydWN0b3IuXG4gKiBAcHJpdmF0ZVxuICovXG5nb29nLmRlZmluZUNsYXNzLmNyZWF0ZVNlYWxpbmdDb25zdHJ1Y3Rvcl8gPSBmdW5jdGlvbihjdHIsIHN1cGVyQ2xhc3MpIHtcbiAgaWYgKCFnb29nLmRlZmluZUNsYXNzLlNFQUxfQ0xBU1NfSU5TVEFOQ0VTKSB7XG4gICAgLy8gRG8gbm93IHdyYXAgdGhlIGNvbnN0cnVjdG9yIHdoZW4gc2VhbGluZyBpcyBkaXNhYmxlZC4gQW5ndWxhciBjb2RlXG4gICAgLy8gZGVwZW5kcyBvbiB0aGlzIGZvciBpbmplY3Rpb24gdG8gd29yayBwcm9wZXJseS5cbiAgICByZXR1cm4gY3RyO1xuICB9XG5cbiAgLy8gTk9URTogVGhlIHNlYWxpbmcgYmVoYXZpb3IgaGFzIGJlZW4gcmVtb3ZlZFxuXG4gIC8qKlxuICAgKiBAdGhpcyB7T2JqZWN0fVxuICAgKiBAcmV0dXJuIHs/fVxuICAgKi9cbiAgdmFyIHdyYXBwZWRDdHIgPSBmdW5jdGlvbigpIHtcbiAgICAvLyBEb24ndCBzZWFsIGFuIGluc3RhbmNlIG9mIGEgc3ViY2xhc3Mgd2hlbiBpdCBjYWxscyB0aGUgY29uc3RydWN0b3Igb2ZcbiAgICAvLyBpdHMgc3VwZXIgY2xhc3MgYXMgdGhlcmUgaXMgbW9zdCBsaWtlbHkgc3RpbGwgc2V0dXAgdG8gZG8uXG4gICAgdmFyIGluc3RhbmNlID0gY3RyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcbiAgICBpbnN0YW5jZVtnb29nLlVJRF9QUk9QRVJUWV9dID0gaW5zdGFuY2VbZ29vZy5VSURfUFJPUEVSVFlfXTtcblxuICAgIHJldHVybiBpbnN0YW5jZTtcbiAgfTtcblxuICByZXR1cm4gd3JhcHBlZEN0cjtcbn07XG5cblxuXG4vLyBUT0RPKGpvaG5sZW56KTogc2hhcmUgdGhlc2UgdmFsdWVzIHdpdGggdGhlIGdvb2cub2JqZWN0XG4vKipcbiAqIFRoZSBuYW1lcyBvZiB0aGUgZmllbGRzIHRoYXQgYXJlIGRlZmluZWQgb24gT2JqZWN0LnByb3RvdHlwZS5cbiAqIEB0eXBlIHshQXJyYXk8c3RyaW5nPn1cbiAqIEBwcml2YXRlXG4gKiBAY29uc3RcbiAqL1xuZ29vZy5kZWZpbmVDbGFzcy5PQkpFQ1RfUFJPVE9UWVBFX0ZJRUxEU18gPSBbXG4gICdjb25zdHJ1Y3RvcicsICdoYXNPd25Qcm9wZXJ0eScsICdpc1Byb3RvdHlwZU9mJywgJ3Byb3BlcnR5SXNFbnVtZXJhYmxlJyxcbiAgJ3RvTG9jYWxlU3RyaW5nJywgJ3RvU3RyaW5nJywgJ3ZhbHVlT2YnXG5dO1xuXG5cbi8vIFRPRE8oam9obmxlbnopOiBzaGFyZSB0aGlzIGZ1bmN0aW9uIHdpdGggdGhlIGdvb2cub2JqZWN0XG4vKipcbiAqIEBwYXJhbSB7IU9iamVjdH0gdGFyZ2V0IFRoZSBvYmplY3QgdG8gYWRkIHByb3BlcnRpZXMgdG8uXG4gKiBAcGFyYW0geyFPYmplY3R9IHNvdXJjZSBUaGUgb2JqZWN0IHRvIGNvcHkgcHJvcGVydGllcyBmcm9tLlxuICogQHByaXZhdGVcbiAqL1xuZ29vZy5kZWZpbmVDbGFzcy5hcHBseVByb3BlcnRpZXNfID0gZnVuY3Rpb24odGFyZ2V0LCBzb3VyY2UpIHtcbiAgLy8gVE9ETyhqb2hubGVueik6IHVwZGF0ZSB0aGlzIHRvIHN1cHBvcnQgRVM1IGdldHRlcnMvc2V0dGVyc1xuXG4gIHZhciBrZXk7XG4gIGZvciAoa2V5IGluIHNvdXJjZSkge1xuICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoc291cmNlLCBrZXkpKSB7XG4gICAgICB0YXJnZXRba2V5XSA9IHNvdXJjZVtrZXldO1xuICAgIH1cbiAgfVxuXG4gIC8vIEZvciBJRSB0aGUgZm9yLWluLWxvb3AgZG9lcyBub3QgY29udGFpbiBhbnkgcHJvcGVydGllcyB0aGF0IGFyZSBub3RcbiAgLy8gZW51bWVyYWJsZSBvbiB0aGUgcHJvdG90eXBlIG9iamVjdCAoZm9yIGV4YW1wbGUgaXNQcm90b3R5cGVPZiBmcm9tXG4gIC8vIE9iamVjdC5wcm90b3R5cGUpIGFuZCBpdCB3aWxsIGFsc28gbm90IGluY2x1ZGUgJ3JlcGxhY2UnIG9uIG9iamVjdHMgdGhhdFxuICAvLyBleHRlbmQgU3RyaW5nIGFuZCBjaGFuZ2UgJ3JlcGxhY2UnIChub3QgdGhhdCBpdCBpcyBjb21tb24gZm9yIGFueW9uZSB0b1xuICAvLyBleHRlbmQgYW55dGhpbmcgZXhjZXB0IE9iamVjdCkuXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgZ29vZy5kZWZpbmVDbGFzcy5PQkpFQ1RfUFJPVE9UWVBFX0ZJRUxEU18ubGVuZ3RoOyBpKyspIHtcbiAgICBrZXkgPSBnb29nLmRlZmluZUNsYXNzLk9CSkVDVF9QUk9UT1RZUEVfRklFTERTX1tpXTtcbiAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHNvdXJjZSwga2V5KSkge1xuICAgICAgdGFyZ2V0W2tleV0gPSBzb3VyY2Vba2V5XTtcbiAgICB9XG4gIH1cbn07XG5cbi8qKlxuICogUmV0dXJucyB0aGUgcGFyYW1ldGVyLlxuICogQHBhcmFtIHtzdHJpbmd9IHNcbiAqIEByZXR1cm4ge3N0cmluZ31cbiAqIEBwcml2YXRlXG4gKi9cbmdvb2cuaWRlbnRpdHlfID0gZnVuY3Rpb24ocykge1xuICByZXR1cm4gcztcbn07XG5cblxuLyoqXG4gKiBDcmVhdGVzIFRydXN0ZWQgVHlwZXMgcG9saWN5IGlmIFRydXN0ZWQgVHlwZXMgYXJlIHN1cHBvcnRlZCBieSB0aGUgYnJvd3Nlci5cbiAqIFRoZSBwb2xpY3kganVzdCBibGVzc2VzIGFueSBzdHJpbmcgYXMgYSBUcnVzdGVkIFR5cGUuIEl0IGlzIG5vdCB2aXNpYmlsaXR5XG4gKiByZXN0cmljdGVkIGJlY2F1c2UgYW55b25lIGNhbiBhbHNvIGNhbGwgdHJ1c3RlZFR5cGVzLmNyZWF0ZVBvbGljeSBkaXJlY3RseS5cbiAqIEhvd2V2ZXIsIHRoZSBhbGxvd2VkIG5hbWVzIHNob3VsZCBiZSByZXN0cmljdGVkIGJ5IGEgSFRUUCBoZWFkZXIgYW5kIHRoZVxuICogcmVmZXJlbmNlIHRvIHRoZSBjcmVhdGVkIHBvbGljeSBzaG91bGQgYmUgdmlzaWJpbGl0eSByZXN0cmljdGVkLlxuICogQHBhcmFtIHtzdHJpbmd9IG5hbWVcbiAqIEByZXR1cm4gez9UcnVzdGVkVHlwZVBvbGljeX1cbiAqL1xuZ29vZy5jcmVhdGVUcnVzdGVkVHlwZXNQb2xpY3kgPSBmdW5jdGlvbihuYW1lKSB7XG4gIHZhciBwb2xpY3kgPSBudWxsO1xuICB2YXIgcG9saWN5RmFjdG9yeSA9IGdvb2cuZ2xvYmFsLnRydXN0ZWRUeXBlcztcbiAgaWYgKCFwb2xpY3lGYWN0b3J5IHx8ICFwb2xpY3lGYWN0b3J5LmNyZWF0ZVBvbGljeSkge1xuICAgIHJldHVybiBwb2xpY3k7XG4gIH1cbiAgLy8gdHJ1c3RlZFR5cGVzLmNyZWF0ZVBvbGljeSB0aHJvd3MgaWYgY2FsbGVkIHdpdGggYSBuYW1lIHRoYXQgaXMgYWxyZWFkeVxuICAvLyByZWdpc3RlcmVkLCBldmVuIGluIHJlcG9ydC1vbmx5IG1vZGUuIFVudGlsIHRoZSBBUEkgY2hhbmdlcywgY2F0Y2ggdGhlXG4gIC8vIGVycm9yIG5vdCB0byBicmVhayB0aGUgYXBwbGljYXRpb25zIGZ1bmN0aW9uYWxseS4gSW4gc3VjaCBjYXNlLCB0aGUgY29kZVxuICAvLyB3aWxsIGZhbGwgYmFjayB0byB1c2luZyByZWd1bGFyIFNhZmUgVHlwZXMuXG4gIC8vIFRPRE8oa290byk6IFJlbW92ZSBjYXRjaGluZyBvbmNlIGNyZWF0ZVBvbGljeSBBUEkgc3RvcHMgdGhyb3dpbmcuXG4gIHRyeSB7XG4gICAgcG9saWN5ID0gcG9saWN5RmFjdG9yeS5jcmVhdGVQb2xpY3kobmFtZSwge1xuICAgICAgY3JlYXRlSFRNTDogZ29vZy5pZGVudGl0eV8sXG4gICAgICBjcmVhdGVTY3JpcHQ6IGdvb2cuaWRlbnRpdHlfLFxuICAgICAgY3JlYXRlU2NyaXB0VVJMOiBnb29nLmlkZW50aXR5X1xuICAgIH0pO1xuICB9IGNhdGNoIChlKSB7XG4gICAgZ29vZy5sb2dUb0NvbnNvbGVfKGUubWVzc2FnZSk7XG4gIH1cbiAgcmV0dXJuIHBvbGljeTtcbn07XG5cbi8vIFRoZXJlJ3MgYSBidWcgaW4gdGhlIGNvbXBpbGVyIHdoZXJlIHdpdGhvdXQgY29sbGFwc2UgcHJvcGVydGllcyB0aGVcbi8vIENsb3N1cmUgbmFtZXNwYWNlIGRlZmluZXMgZG8gbm90IGd1YXJkIGNvZGUgY29ycmVjdGx5LiBUbyBoZWxwIHJlZHVjZSBjb2RlXG4vLyBzaXplIGFsc28gY2hlY2sgZm9yICFDT01QSUxFRCBldmVuIHRob3VnaCBpdCByZWR1bmRhbnQgdW50aWwgdGhpcyBpcyBmaXhlZC5cbmlmICghQ09NUElMRUQgJiYgZ29vZy5ERVBFTkRFTkNJRVNfRU5BQkxFRCkge1xuXG5cbiAgLyoqXG4gICAqIFRyaWVzIHRvIGRldGVjdCB3aGV0aGVyIHRoZSBjdXJyZW50IGJyb3dzZXIgaXMgRWRnZSwgYmFzZWQgb24gdGhlIHVzZXJcbiAgICogYWdlbnQuIFRoaXMgbWF0Y2hlcyBvbmx5IHByZS1DaHJvbWl1bSBFZGdlLlxuICAgKiBAc2VlIGh0dHBzOi8vZG9jcy5taWNyb3NvZnQuY29tL2VuLXVzL21pY3Jvc29mdC1lZGdlL3dlYi1wbGF0Zm9ybS91c2VyLWFnZW50LXN0cmluZ1xuICAgKiBAcmV0dXJuIHtib29sZWFufSBUcnVlIGlmIHRoZSBjdXJyZW50IGJyb3dzZXIgaXMgRWRnZS5cbiAgICogQHByaXZhdGVcbiAgICovXG4gIGdvb2cuaXNFZGdlXyA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciB1c2VyQWdlbnQgPSBnb29nLmdsb2JhbC5uYXZpZ2F0b3IgJiYgZ29vZy5nbG9iYWwubmF2aWdhdG9yLnVzZXJBZ2VudCA/XG4gICAgICAgIGdvb2cuZ2xvYmFsLm5hdmlnYXRvci51c2VyQWdlbnQgOlxuICAgICAgICAnJztcbiAgICB2YXIgZWRnZVJlID0gL0VkZ2VcXC8oXFxkKykoXFwuXFxkKSovaTtcbiAgICByZXR1cm4gISF1c2VyQWdlbnQubWF0Y2goZWRnZVJlKTtcbiAgfTtcblxuXG4gIC8qKlxuICAgKiBUcmllcyB0byBkZXRlY3Qgd2hldGhlciBpcyBpbiB0aGUgY29udGV4dCBvZiBhbiBIVE1MIGRvY3VtZW50LlxuICAgKiBAcmV0dXJuIHtib29sZWFufSBUcnVlIGlmIGl0IGxvb2tzIGxpa2UgSFRNTCBkb2N1bWVudC5cbiAgICogQHByaXZhdGVcbiAgICovXG4gIGdvb2cuaW5IdG1sRG9jdW1lbnRfID0gZnVuY3Rpb24oKSB7XG4gICAgLyoqIEB0eXBlIHshRG9jdW1lbnR9ICovXG4gICAgdmFyIGRvYyA9IGdvb2cuZ2xvYmFsLmRvY3VtZW50O1xuICAgIHJldHVybiBkb2MgIT0gbnVsbCAmJiAnd3JpdGUnIGluIGRvYzsgIC8vIFhVTERvY3VtZW50IG1pc3NlcyB3cml0ZS5cbiAgfTtcblxuXG4gIC8qKlxuICAgKiBXZSdkIGxpa2UgdG8gY2hlY2sgZm9yIGlmIHRoZSBkb2N1bWVudCByZWFkeVN0YXRlIGlzICdsb2FkaW5nJzsgaG93ZXZlclxuICAgKiB0aGVyZSBhcmUgYnVncyBvbiBJRSAxMCBhbmQgYmVsb3cgd2hlcmUgdGhlIHJlYWR5U3RhdGUgYmVpbmcgYW55dGhpbmcgb3RoZXJcbiAgICogdGhhbiAnY29tcGxldGUnIGlzIG5vdCByZWxpYWJsZS5cbiAgICogQHJldHVybiB7Ym9vbGVhbn1cbiAgICogQHByaXZhdGVcbiAgICovXG4gIGdvb2cuaXNEb2N1bWVudExvYWRpbmdfID0gZnVuY3Rpb24oKSB7XG4gICAgLy8gYXR0YWNoRXZlbnQgaXMgYXZhaWxhYmxlIG9uIElFIDYgdGhydSAxMCBvbmx5LCBhbmQgdGh1cyBjYW4gYmUgdXNlZCB0b1xuICAgIC8vIGRldGVjdCB0aG9zZSBicm93c2Vycy5cbiAgICAvKiogQHR5cGUgeyFIVE1MRG9jdW1lbnR9ICovXG4gICAgdmFyIGRvYyA9IGdvb2cuZ2xvYmFsLmRvY3VtZW50O1xuICAgIHJldHVybiBkb2MuYXR0YWNoRXZlbnQgPyBkb2MucmVhZHlTdGF0ZSAhPSAnY29tcGxldGUnIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jLnJlYWR5U3RhdGUgPT0gJ2xvYWRpbmcnO1xuICB9O1xuXG5cbiAgLyoqXG4gICAqIFRyaWVzIHRvIGRldGVjdCB0aGUgYmFzZSBwYXRoIG9mIGJhc2UuanMgc2NyaXB0IHRoYXQgYm9vdHN0cmFwcyBDbG9zdXJlLlxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgZ29vZy5maW5kQmFzZVBhdGhfID0gZnVuY3Rpb24oKSB7XG4gICAgaWYgKGdvb2cuZ2xvYmFsLkNMT1NVUkVfQkFTRV9QQVRIICE9IHVuZGVmaW5lZCAmJlxuICAgICAgICAvLyBBbnRpIERPTS1jbG9iYmVyaW5nIHJ1bnRpbWUgY2hlY2sgKGIvMzc3MzY1NzYpLlxuICAgICAgICB0eXBlb2YgZ29vZy5nbG9iYWwuQ0xPU1VSRV9CQVNFX1BBVEggPT09ICdzdHJpbmcnKSB7XG4gICAgICBnb29nLmJhc2VQYXRoID0gZ29vZy5nbG9iYWwuQ0xPU1VSRV9CQVNFX1BBVEg7XG4gICAgICByZXR1cm47XG4gICAgfSBlbHNlIGlmICghZ29vZy5pbkh0bWxEb2N1bWVudF8oKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICAvKiogQHR5cGUgeyFEb2N1bWVudH0gKi9cbiAgICB2YXIgZG9jID0gZ29vZy5nbG9iYWwuZG9jdW1lbnQ7XG4gICAgLy8gSWYgd2UgaGF2ZSBhIGN1cnJlbnRTY3JpcHQgYXZhaWxhYmxlLCB1c2UgaXQgZXhjbHVzaXZlbHkuXG4gICAgdmFyIGN1cnJlbnRTY3JpcHQgPSBkb2MuY3VycmVudFNjcmlwdDtcbiAgICBpZiAoY3VycmVudFNjcmlwdCkge1xuICAgICAgdmFyIHNjcmlwdHMgPSBbY3VycmVudFNjcmlwdF07XG4gICAgfSBlbHNlIHtcbiAgICAgIHZhciBzY3JpcHRzID0gZG9jLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdTQ1JJUFQnKTtcbiAgICB9XG4gICAgLy8gU2VhcmNoIGJhY2t3YXJkcyBzaW5jZSB0aGUgY3VycmVudCBzY3JpcHQgaXMgaW4gYWxtb3N0IGFsbCBjYXNlcyB0aGUgb25lXG4gICAgLy8gdGhhdCBoYXMgYmFzZS5qcy5cbiAgICBmb3IgKHZhciBpID0gc2NyaXB0cy5sZW5ndGggLSAxOyBpID49IDA7IC0taSkge1xuICAgICAgdmFyIHNjcmlwdCA9IC8qKiBAdHlwZSB7IUhUTUxTY3JpcHRFbGVtZW50fSAqLyAoc2NyaXB0c1tpXSk7XG4gICAgICB2YXIgc3JjID0gc2NyaXB0LnNyYztcbiAgICAgIHZhciBxbWFyayA9IHNyYy5sYXN0SW5kZXhPZignPycpO1xuICAgICAgdmFyIGwgPSBxbWFyayA9PSAtMSA/IHNyYy5sZW5ndGggOiBxbWFyaztcbiAgICAgIGlmIChzcmMuc3Vic3RyKGwgLSA3LCA3KSA9PSAnYmFzZS5qcycpIHtcbiAgICAgICAgZ29vZy5iYXNlUGF0aCA9IHNyYy5zdWJzdHIoMCwgbCAtIDcpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIGdvb2cuZmluZEJhc2VQYXRoXygpO1xuXG4gIC8qKiBAc3RydWN0IEBjb25zdHJ1Y3RvciBAZmluYWwgKi9cbiAgZ29vZy5UcmFuc3BpbGVyID0gZnVuY3Rpb24oKSB7XG4gICAgLyoqIEBwcml2YXRlIHs/T2JqZWN0PHN0cmluZywgYm9vbGVhbj59ICovXG4gICAgdGhpcy5yZXF1aXJlc1RyYW5zcGlsYXRpb25fID0gbnVsbDtcbiAgICAvKiogQHByaXZhdGUge3N0cmluZ30gKi9cbiAgICB0aGlzLnRyYW5zcGlsYXRpb25UYXJnZXRfID0gZ29vZy5UUkFOU1BJTEVfVE9fTEFOR1VBR0U7XG4gIH07XG4gIC8qKlxuICAgKiBSZXR1cm5zIGEgbmV3bHkgY3JlYXRlZCBtYXAgZnJvbSBsYW5ndWFnZSBtb2RlIHN0cmluZyB0byBhIGJvb2xlYW5cbiAgICogaW5kaWNhdGluZyB3aGV0aGVyIHRyYW5zcGlsYXRpb24gc2hvdWxkIGJlIGRvbmUgZm9yIHRoYXQgbW9kZSBhcyB3ZWxsIGFzXG4gICAqIHRoZSBoaWdoZXN0IGxldmVsIGxhbmd1YWdlIHRoYXQgdGhpcyBlbnZpcm9ubWVudCBzdXBwb3J0cy5cbiAgICpcbiAgICogR3VhcmFudGVlZCBpbnZhcmlhbnQ6XG4gICAqIEZvciBhbnkgdHdvIG1vZGVzLCBsMSBhbmQgbDIgd2hlcmUgbDIgaXMgYSBuZXdlciBtb2RlIHRoYW4gbDEsXG4gICAqIGBtYXBbbDFdID09IHRydWVgIGltcGxpZXMgdGhhdCBgbWFwW2wyXSA9PSB0cnVlYC5cbiAgICpcbiAgICogTm90ZSB0aGlzIG1ldGhvZCBpcyBleHRyYWN0ZWQgYW5kIHVzZWQgZWxzZXdoZXJlLCBzbyBpdCBjYW5ub3QgcmVseSBvblxuICAgKiBhbnl0aGluZyBleHRlcm5hbCAoaXQgc2hvdWxkIGVhc2lseSBiZSBhYmxlIHRvIGJlIHRyYW5zZm9ybWVkIGludG8gYVxuICAgKiBzdGFuZGFsb25lLCB0b3AgbGV2ZWwgZnVuY3Rpb24pLlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAcmV0dXJuIHt7XG4gICAqICAgdGFyZ2V0OiBzdHJpbmcsXG4gICAqICAgbWFwOiAhT2JqZWN0PHN0cmluZywgYm9vbGVhbj5cbiAgICogfX1cbiAgICovXG4gIGdvb2cuVHJhbnNwaWxlci5wcm90b3R5cGUuY3JlYXRlUmVxdWlyZXNUcmFuc3BpbGF0aW9uXyA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciB0cmFuc3BpbGF0aW9uVGFyZ2V0ID0gJ2VzMyc7XG4gICAgdmFyIC8qKiAhT2JqZWN0PHN0cmluZywgYm9vbGVhbj4gKi8gcmVxdWlyZXNUcmFuc3BpbGF0aW9uID0geydlczMnOiBmYWxzZX07XG4gICAgdmFyIHRyYW5zcGlsYXRpb25SZXF1aXJlZEZvckFsbExhdGVyTW9kZXMgPSBmYWxzZTtcblxuICAgIC8qKlxuICAgICAqIEFkZHMgYW4gZW50cnkgdG8gcmVxdWlyZXNUcmFuc3BsaWF0aW9uIGZvciB0aGUgZ2l2ZW4gbGFuZ3VhZ2UgbW9kZS5cbiAgICAgKlxuICAgICAqIElNUE9SVEFOVDogQ2FsbHMgbXVzdCBiZSBtYWRlIGluIG9yZGVyIGZyb20gb2xkZXN0IHRvIG5ld2VzdCBsYW5ndWFnZVxuICAgICAqIG1vZGUuXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IG1vZGVOYW1lXG4gICAgICogQHBhcmFtIHtmdW5jdGlvbigpOiBib29sZWFufSBpc1N1cHBvcnRlZCBSZXR1cm5zIHRydWUgaWYgdGhlIEpTIGVuZ2luZVxuICAgICAqICAgICBzdXBwb3J0cyB0aGUgZ2l2ZW4gbW9kZS5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBhZGROZXdlckxhbmd1YWdlVHJhbnNwaWxhdGlvbkNoZWNrKG1vZGVOYW1lLCBpc1N1cHBvcnRlZCkge1xuICAgICAgaWYgKHRyYW5zcGlsYXRpb25SZXF1aXJlZEZvckFsbExhdGVyTW9kZXMpIHtcbiAgICAgICAgcmVxdWlyZXNUcmFuc3BpbGF0aW9uW21vZGVOYW1lXSA9IHRydWU7XG4gICAgICB9IGVsc2UgaWYgKGlzU3VwcG9ydGVkKCkpIHtcbiAgICAgICAgdHJhbnNwaWxhdGlvblRhcmdldCA9IG1vZGVOYW1lO1xuICAgICAgICByZXF1aXJlc1RyYW5zcGlsYXRpb25bbW9kZU5hbWVdID0gZmFsc2U7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXF1aXJlc1RyYW5zcGlsYXRpb25bbW9kZU5hbWVdID0gdHJ1ZTtcbiAgICAgICAgdHJhbnNwaWxhdGlvblJlcXVpcmVkRm9yQWxsTGF0ZXJNb2RlcyA9IHRydWU7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRG9lcyB0aGUgZ2l2ZW4gY29kZSBldmFsdWF0ZSB3aXRob3V0IHN5bnRheCBlcnJvcnMgYW5kIHJldHVybiBhIHRydXRoeVxuICAgICAqIHJlc3VsdD9cbiAgICAgKi9cbiAgICBmdW5jdGlvbiAvKiogYm9vbGVhbiAqLyBldmFsQ2hlY2soLyoqIHN0cmluZyAqLyBjb2RlKSB7XG4gICAgICB0cnkge1xuICAgICAgICByZXR1cm4gISFldmFsKGdvb2cuQ0xPU1VSRV9FVkFMX1BSRUZJTFRFUl8uY3JlYXRlU2NyaXB0KGNvZGUpKTtcbiAgICAgIH0gY2F0Y2ggKGlnbm9yZWQpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIElkZW50aWZ5IEVTMy1vbmx5IGJyb3dzZXJzIGJ5IHRoZWlyIGluY29ycmVjdCB0cmVhdG1lbnQgb2YgY29tbWFzLlxuICAgIGFkZE5ld2VyTGFuZ3VhZ2VUcmFuc3BpbGF0aW9uQ2hlY2soJ2VzNScsIGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIGV2YWxDaGVjaygnWzEsXS5sZW5ndGg9PTEnKTtcbiAgICB9KTtcbiAgICBhZGROZXdlckxhbmd1YWdlVHJhbnNwaWxhdGlvbkNoZWNrKCdlczYnLCBmdW5jdGlvbigpIHtcbiAgICAgIC8vIEVkZ2UgaGFzIGEgbm9uLWRldGVybWluaXN0aWMgKGkuZS4sIG5vdCByZXByb2R1Y2libGUpIGJ1ZyB3aXRoIEVTNjpcbiAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9NaWNyb3NvZnQvQ2hha3JhQ29yZS9pc3N1ZXMvMTQ5Ni5cbiAgICAgIGlmIChnb29nLmlzRWRnZV8oKSkge1xuICAgICAgICAvLyBUaGUgUmVmbGVjdC5jb25zdHJ1Y3QgdGVzdCBiZWxvdyBpcyBmbGFreSBvbiBFZGdlLiBJdCBjYW4gc29tZXRpbWVzXG4gICAgICAgIC8vIHBhc3Mgb3IgZmFpbCBvbiA0MCAxNS4xNTA2Mywgc28ganVzdCBleGl0IGVhcmx5IGZvciBFZGdlIGFuZCB0cmVhdFxuICAgICAgICAvLyBpdCBhcyBFUzUuIFVudGlsIHdlJ3JlIG9uIGEgbW9yZSB1cCB0byBkYXRlIHZlcnNpb24ganVzdCBhbHdheXMgdXNlXG4gICAgICAgIC8vIEVTNS4gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9NaWNyb3NvZnQvQ2hha3JhQ29yZS9pc3N1ZXMvMzIxNy5cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgLy8gVGVzdCBlczY6IFtGRjUwICg/KSwgRWRnZSAxNCAoPyksIENocm9tZSA1MF1cbiAgICAgIC8vICAgKGEpIGRlZmF1bHQgcGFyYW1zIChzcGVjaWZpY2FsbHkgc2hhZG93aW5nIGxvY2FscyksXG4gICAgICAvLyAgIChiKSBkZXN0cnVjdHVyaW5nLCAoYykgYmxvY2stc2NvcGVkIGZ1bmN0aW9ucyxcbiAgICAgIC8vICAgKGQpIGZvci1vZiAoY29uc3QpLCAoZSkgbmV3LnRhcmdldC9SZWZsZWN0LmNvbnN0cnVjdFxuICAgICAgdmFyIGVzNmZ1bGxUZXN0ID1cbiAgICAgICAgICAnY2xhc3MgWHtjb25zdHJ1Y3Rvcigpe2lmKG5ldy50YXJnZXQhPVN0cmluZyl0aHJvdyAxO3RoaXMueD00Mn19JyArXG4gICAgICAgICAgJ2xldCBxPVJlZmxlY3QuY29uc3RydWN0KFgsW10sU3RyaW5nKTtpZihxLnghPTQyfHwhKHEgaW5zdGFuY2VvZiAnICtcbiAgICAgICAgICAnU3RyaW5nKSl0aHJvdyAxO2Zvcihjb25zdCBhIG9mWzIsM10pe2lmKGE9PTIpY29udGludWU7ZnVuY3Rpb24gJyArXG4gICAgICAgICAgJ2Yoej17YX0pe2xldCBhPTA7cmV0dXJuIHouYX17ZnVuY3Rpb24gZigpe3JldHVybiAwO319cmV0dXJuIGYoKScgK1xuICAgICAgICAgICc9PTN9JztcblxuICAgICAgcmV0dXJuIGV2YWxDaGVjaygnKCgpPT57XCJ1c2Ugc3RyaWN0XCI7JyArIGVzNmZ1bGxUZXN0ICsgJ30pKCknKTtcbiAgICB9KTtcbiAgICAvLyAqKiBhbmQgKio9IGFyZSB0aGUgb25seSBuZXcgZmVhdHVyZXMgaW4gJ2VzNydcbiAgICBhZGROZXdlckxhbmd1YWdlVHJhbnNwaWxhdGlvbkNoZWNrKCdlczcnLCBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiBldmFsQ2hlY2soJzIqKjM9PTgnKTtcbiAgICB9KTtcbiAgICAvLyBhc3luYyBmdW5jdGlvbnMgYXJlIHRoZSBvbmx5IG5ldyBmZWF0dXJlcyBpbiAnZXM4J1xuICAgIGFkZE5ld2VyTGFuZ3VhZ2VUcmFuc3BpbGF0aW9uQ2hlY2soJ2VzOCcsIGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIGV2YWxDaGVjaygnYXN5bmMoKT0+MSwxJyk7XG4gICAgfSk7XG4gICAgYWRkTmV3ZXJMYW5ndWFnZVRyYW5zcGlsYXRpb25DaGVjaygnZXM5JywgZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gZXZhbENoZWNrKCcoey4uLnJlc3R9PXt9KSwxJyk7XG4gICAgfSk7XG4gICAgLy8gb3B0aW9uYWwgY2F0Y2ggYmluZGluZywgdW5lc2NhcGVkIHVuaWNvZGUgcGFyYWdyYXBoIHNlcGFyYXRvciBpbiBzdHJpbmdzXG4gICAgYWRkTmV3ZXJMYW5ndWFnZVRyYW5zcGlsYXRpb25DaGVjaygnZXNfMjAxOScsIGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIGV2YWxDaGVjaygnbGV0IHI7dHJ5e3Rocm93IDB9Y2F0Y2h7cj1cIlxcdTIwMjlcIn07cicpO1xuICAgIH0pO1xuICAgIC8vIG9wdGlvbmFsIGNoYWluaW5nLCBudWxsaXNoIGNvYWxlc2NpbmdcbiAgICAvLyB1bnRlc3RlZC91bnN1cHBvcnRlZDogYmlnaW50LCBpbXBvcnQgbWV0YVxuICAgIGFkZE5ld2VyTGFuZ3VhZ2VUcmFuc3BpbGF0aW9uQ2hlY2soJ2VzXzIwMjAnLCBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiBldmFsQ2hlY2soJ251bGw/Lng/PzEnKTtcbiAgICB9KTtcbiAgICBhZGROZXdlckxhbmd1YWdlVHJhbnNwaWxhdGlvbkNoZWNrKCdlc19uZXh0JywgZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gZmFsc2U7ICAvLyBhc3N1bWUgaXQgYWx3YXlzIG5lZWQgdG8gdHJhbnNwaWxlXG4gICAgfSk7XG4gICAgcmV0dXJuIHt0YXJnZXQ6IHRyYW5zcGlsYXRpb25UYXJnZXQsIG1hcDogcmVxdWlyZXNUcmFuc3BpbGF0aW9ufTtcbiAgfTtcblxuXG4gIC8qKlxuICAgKiBEZXRlcm1pbmVzIHdoZXRoZXIgdGhlIGdpdmVuIGxhbmd1YWdlIG5lZWRzIHRvIGJlIHRyYW5zcGlsZWQuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBsYW5nXG4gICAqIEBwYXJhbSB7c3RyaW5nfHVuZGVmaW5lZH0gbW9kdWxlXG4gICAqIEByZXR1cm4ge2Jvb2xlYW59XG4gICAqL1xuICBnb29nLlRyYW5zcGlsZXIucHJvdG90eXBlLm5lZWRzVHJhbnNwaWxlID0gZnVuY3Rpb24obGFuZywgbW9kdWxlKSB7XG4gICAgaWYgKGdvb2cuVFJBTlNQSUxFID09ICdhbHdheXMnKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9IGVsc2UgaWYgKGdvb2cuVFJBTlNQSUxFID09ICduZXZlcicpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9IGVsc2UgaWYgKCF0aGlzLnJlcXVpcmVzVHJhbnNwaWxhdGlvbl8pIHtcbiAgICAgIHZhciBvYmogPSB0aGlzLmNyZWF0ZVJlcXVpcmVzVHJhbnNwaWxhdGlvbl8oKTtcbiAgICAgIHRoaXMucmVxdWlyZXNUcmFuc3BpbGF0aW9uXyA9IG9iai5tYXA7XG4gICAgICB0aGlzLnRyYW5zcGlsYXRpb25UYXJnZXRfID0gdGhpcy50cmFuc3BpbGF0aW9uVGFyZ2V0XyB8fCBvYmoudGFyZ2V0O1xuICAgIH1cbiAgICBpZiAobGFuZyBpbiB0aGlzLnJlcXVpcmVzVHJhbnNwaWxhdGlvbl8pIHtcbiAgICAgIGlmICh0aGlzLnJlcXVpcmVzVHJhbnNwaWxhdGlvbl9bbGFuZ10pIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9IGVsc2UgaWYgKFxuICAgICAgICAgIGdvb2cuaW5IdG1sRG9jdW1lbnRfKCkgJiYgbW9kdWxlID09ICdlczYnICYmXG4gICAgICAgICAgISgnbm9Nb2R1bGUnIGluIGdvb2cuZ2xvYmFsLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpKSkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdVbmtub3duIGxhbmd1YWdlIG1vZGU6ICcgKyBsYW5nKTtcbiAgICB9XG4gIH07XG5cblxuICAvKipcbiAgICogTGF6aWx5IHJldHJpZXZlcyB0aGUgdHJhbnNwaWxlciBhbmQgYXBwbGllcyBpdCB0byB0aGUgc291cmNlLlxuICAgKiBAcGFyYW0ge3N0cmluZ30gY29kZSBKUyBjb2RlLlxuICAgKiBAcGFyYW0ge3N0cmluZ30gcGF0aCBQYXRoIHRvIHRoZSBjb2RlLlxuICAgKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSB0cmFuc3BpbGVkIGNvZGUuXG4gICAqL1xuICBnb29nLlRyYW5zcGlsZXIucHJvdG90eXBlLnRyYW5zcGlsZSA9IGZ1bmN0aW9uKGNvZGUsIHBhdGgpIHtcbiAgICAvLyBUT0RPKGpvaG5wbGFpc3RlZCk6IFdlIHNob3VsZCBkZWxldGUgZ29vZy50cmFuc3BpbGVfIGFuZCBqdXN0IGhhdmUgdGhpc1xuICAgIC8vIGZ1bmN0aW9uLiBCdXQgdGhlcmUncyBzb21lIGNvbXBpbGUgZXJyb3IgYXRtIHdoZXJlIGdvb2cuZ2xvYmFsIGlzIGJlaW5nXG4gICAgLy8gc3RyaXBwZWQgaW5jb3JyZWN0bHkgd2l0aG91dCB0aGlzLlxuICAgIHJldHVybiBnb29nLnRyYW5zcGlsZV8oY29kZSwgcGF0aCwgdGhpcy50cmFuc3BpbGF0aW9uVGFyZ2V0Xyk7XG4gIH07XG5cblxuICAvKiogQHByaXZhdGUgQGZpbmFsIHshZ29vZy5UcmFuc3BpbGVyfSAqL1xuICBnb29nLnRyYW5zcGlsZXJfID0gbmV3IGdvb2cuVHJhbnNwaWxlcigpO1xuXG4gIC8qKlxuICAgKiBSZXdyaXRlcyBjbG9zaW5nIHNjcmlwdCB0YWdzIGluIGlucHV0IHRvIGF2b2lkIGVuZGluZyBhbiBlbmNsb3Npbmcgc2NyaXB0XG4gICAqIHRhZy5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IHN0clxuICAgKiBAcmV0dXJuIHtzdHJpbmd9XG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBnb29nLnByb3RlY3RTY3JpcHRUYWdfID0gZnVuY3Rpb24oc3RyKSB7XG4gICAgcmV0dXJuIHN0ci5yZXBsYWNlKC88XFwvKFNDUklQVCkvaWcsICdcXFxceDNjLyQxJyk7XG4gIH07XG5cblxuICAvKipcbiAgICogQSBkZWJ1ZyBsb2FkZXIgaXMgcmVzcG9uc2libGUgZm9yIGRvd25sb2FkaW5nIGFuZCBleGVjdXRpbmcgamF2YXNjcmlwdFxuICAgKiBmaWxlcyBpbiBhbiB1bmJ1bmRsZWQsIHVuY29tcGlsZWQgZW52aXJvbm1lbnQuXG4gICAqXG4gICAqIFRoaXMgY2FuIGJlIGN1c3RpbWl6ZWQgdmlhIHRoZSBzZXREZXBlbmRlbmN5RmFjdG9yeSBtZXRob2QsIG9yIGJ5XG4gICAqIENMT1NVUkVfSU1QT1JUX1NDUklQVC9DTE9TVVJFX0xPQURfRklMRV9TWU5DLlxuICAgKlxuICAgKiBAc3RydWN0IEBjb25zdHJ1Y3RvciBAZmluYWwgQHByaXZhdGVcbiAgICovXG4gIGdvb2cuRGVidWdMb2FkZXJfID0gZnVuY3Rpb24oKSB7XG4gICAgLyoqIEBwcml2YXRlIEBjb25zdCB7IU9iamVjdDxzdHJpbmcsICFnb29nLkRlcGVuZGVuY3k+fSAqL1xuICAgIHRoaXMuZGVwZW5kZW5jaWVzXyA9IHt9O1xuICAgIC8qKiBAcHJpdmF0ZSBAY29uc3QgeyFPYmplY3Q8c3RyaW5nLCBzdHJpbmc+fSAqL1xuICAgIHRoaXMuaWRUb1BhdGhfID0ge307XG4gICAgLyoqIEBwcml2YXRlIEBjb25zdCB7IU9iamVjdDxzdHJpbmcsIGJvb2xlYW4+fSAqL1xuICAgIHRoaXMud3JpdHRlbl8gPSB7fTtcbiAgICAvKiogQHByaXZhdGUgQGNvbnN0IHshQXJyYXk8IWdvb2cuRGVwZW5kZW5jeT59ICovXG4gICAgdGhpcy5sb2FkaW5nRGVwc18gPSBbXTtcbiAgICAvKiogQHByaXZhdGUgeyFBcnJheTwhZ29vZy5EZXBlbmRlbmN5Pn0gKi9cbiAgICB0aGlzLmRlcHNUb0xvYWRfID0gW107XG4gICAgLyoqIEBwcml2YXRlIHtib29sZWFufSAqL1xuICAgIHRoaXMucGF1c2VkXyA9IGZhbHNlO1xuICAgIC8qKiBAcHJpdmF0ZSB7IWdvb2cuRGVwZW5kZW5jeUZhY3Rvcnl9ICovXG4gICAgdGhpcy5mYWN0b3J5XyA9IG5ldyBnb29nLkRlcGVuZGVuY3lGYWN0b3J5KGdvb2cudHJhbnNwaWxlcl8pO1xuICAgIC8qKiBAcHJpdmF0ZSBAY29uc3QgeyFPYmplY3Q8c3RyaW5nLCAhRnVuY3Rpb24+fSAqL1xuICAgIHRoaXMuZGVmZXJyZWRDYWxsYmFja3NfID0ge307XG4gICAgLyoqIEBwcml2YXRlIEBjb25zdCB7IUFycmF5PHN0cmluZz59ICovXG4gICAgdGhpcy5kZWZlcnJlZFF1ZXVlXyA9IFtdO1xuICB9O1xuXG4gIC8qKlxuICAgKiBAcGFyYW0geyFBcnJheTxzdHJpbmc+fSBuYW1lc3BhY2VzXG4gICAqIEBwYXJhbSB7ZnVuY3Rpb24oKTogdW5kZWZpbmVkfSBjYWxsYmFjayBGdW5jdGlvbiB0byBjYWxsIG9uY2UgYWxsIHRoZVxuICAgKiAgICAgbmFtZXNwYWNlcyBoYXZlIGxvYWRlZC5cbiAgICovXG4gIGdvb2cuRGVidWdMb2FkZXJfLnByb3RvdHlwZS5ib290c3RyYXAgPSBmdW5jdGlvbihuYW1lc3BhY2VzLCBjYWxsYmFjaykge1xuICAgIHZhciBjYiA9IGNhbGxiYWNrO1xuICAgIGZ1bmN0aW9uIHJlc29sdmUoKSB7XG4gICAgICBpZiAoY2IpIHtcbiAgICAgICAgZ29vZy5nbG9iYWwuc2V0VGltZW91dChjYiwgMCk7XG4gICAgICAgIGNiID0gbnVsbDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoIW5hbWVzcGFjZXMubGVuZ3RoKSB7XG4gICAgICByZXNvbHZlKCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdmFyIGRlcHMgPSBbXTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IG5hbWVzcGFjZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhciBwYXRoID0gdGhpcy5nZXRQYXRoRnJvbURlcHNfKG5hbWVzcGFjZXNbaV0pO1xuICAgICAgaWYgKCFwYXRoKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignVW5yZWdvbml6ZWQgbmFtZXNwYWNlOiAnICsgbmFtZXNwYWNlc1tpXSk7XG4gICAgICB9XG4gICAgICBkZXBzLnB1c2godGhpcy5kZXBlbmRlbmNpZXNfW3BhdGhdKTtcbiAgICB9XG5cbiAgICB2YXIgcmVxdWlyZSA9IGdvb2cucmVxdWlyZTtcbiAgICB2YXIgbG9hZGVkID0gMDtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IG5hbWVzcGFjZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIHJlcXVpcmUobmFtZXNwYWNlc1tpXSk7XG4gICAgICBkZXBzW2ldLm9uTG9hZChmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKCsrbG9hZGVkID09IG5hbWVzcGFjZXMubGVuZ3RoKSB7XG4gICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gIH07XG5cblxuICAvKipcbiAgICogTG9hZHMgdGhlIENsb3N1cmUgRGVwZW5kZW5jeSBmaWxlLlxuICAgKlxuICAgKiBFeHBvc2VkIGEgcHVibGljIGZ1bmN0aW9uIHNvIENMT1NVUkVfTk9fREVQUyBjYW4gYmUgc2V0IHRvIGZhbHNlLCBiYXNlXG4gICAqIGxvYWRlZCwgc2V0RGVwZW5kZW5jeUZhY3RvcnkgY2FsbGVkLCBhbmQgdGhlbiB0aGlzIGNhbGxlZC4gaS5lLiBhbGxvd3NcbiAgICogY3VzdG9tIGxvYWRpbmcgb2YgdGhlIGRlcHMgZmlsZS5cbiAgICovXG4gIGdvb2cuRGVidWdMb2FkZXJfLnByb3RvdHlwZS5sb2FkQ2xvc3VyZURlcHMgPSBmdW5jdGlvbigpIHtcbiAgICAvLyBDaXJjdW12ZW50IGFkZERlcGVuZGVuY3ksIHdoaWNoIHdvdWxkIHRyeSB0byB0cmFuc3BpbGUgZGVwcy5qcyBpZlxuICAgIC8vIHRyYW5zcGlsZSBpcyBzZXQgdG8gYWx3YXlzLlxuICAgIHZhciByZWxQYXRoID0gJ2RlcHMuanMnO1xuICAgIHRoaXMuZGVwc1RvTG9hZF8ucHVzaCh0aGlzLmZhY3RvcnlfLmNyZWF0ZURlcGVuZGVuY3koXG4gICAgICAgIGdvb2cubm9ybWFsaXplUGF0aF8oZ29vZy5iYXNlUGF0aCArIHJlbFBhdGgpLCByZWxQYXRoLCBbXSwgW10sIHt9LFxuICAgICAgICBmYWxzZSkpO1xuICAgIHRoaXMubG9hZERlcHNfKCk7XG4gIH07XG5cblxuICAvKipcbiAgICogTm90aWZpZXMgdGhlIGRlYnVnIGxvYWRlciB3aGVuIGEgZGVwZW5kZW5jeSBoYXMgYmVlbiByZXF1ZXN0ZWQuXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBhYnNQYXRoT3JJZCBQYXRoIG9mIHRoZSBkZXBlbmRlbmN5IG9yIGdvb2cgaWQuXG4gICAqIEBwYXJhbSB7Ym9vbGVhbj19IG9wdF9mb3JjZVxuICAgKi9cbiAgZ29vZy5EZWJ1Z0xvYWRlcl8ucHJvdG90eXBlLnJlcXVlc3RlZCA9IGZ1bmN0aW9uKGFic1BhdGhPcklkLCBvcHRfZm9yY2UpIHtcbiAgICB2YXIgcGF0aCA9IHRoaXMuZ2V0UGF0aEZyb21EZXBzXyhhYnNQYXRoT3JJZCk7XG4gICAgaWYgKHBhdGggJiZcbiAgICAgICAgKG9wdF9mb3JjZSB8fCB0aGlzLmFyZURlcHNMb2FkZWRfKHRoaXMuZGVwZW5kZW5jaWVzX1twYXRoXS5yZXF1aXJlcykpKSB7XG4gICAgICB2YXIgY2FsbGJhY2sgPSB0aGlzLmRlZmVycmVkQ2FsbGJhY2tzX1twYXRoXTtcbiAgICAgIGlmIChjYWxsYmFjaykge1xuICAgICAgICBkZWxldGUgdGhpcy5kZWZlcnJlZENhbGxiYWNrc19bcGF0aF07XG4gICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG5cbiAgLyoqXG4gICAqIFNldHMgdGhlIGRlcGVuZGVuY3kgZmFjdG9yeSwgd2hpY2ggY2FuIGJlIHVzZWQgdG8gY3JlYXRlIGN1c3RvbVxuICAgKiBnb29nLkRlcGVuZGVuY3kgaW1wbGVtZW50YXRpb25zIHRvIGNvbnRyb2wgaG93IGRlcGVuZGVuY2llcyBhcmUgbG9hZGVkLlxuICAgKlxuICAgKiBAcGFyYW0geyFnb29nLkRlcGVuZGVuY3lGYWN0b3J5fSBmYWN0b3J5XG4gICAqL1xuICBnb29nLkRlYnVnTG9hZGVyXy5wcm90b3R5cGUuc2V0RGVwZW5kZW5jeUZhY3RvcnkgPSBmdW5jdGlvbihmYWN0b3J5KSB7XG4gICAgdGhpcy5mYWN0b3J5XyA9IGZhY3Rvcnk7XG4gIH07XG5cblxuICAvKipcbiAgICogVHJhdnNlcnNlcyB0aGUgZGVwZW5kZW5jeSBncmFwaCBhbmQgcXVldWVzIHRoZSBnaXZlbiBkZXBlbmRlbmN5LCBhbmQgYWxsIG9mXG4gICAqIGl0cyB0cmFuc2l0aXZlIGRlcGVuZGVuY2llcywgZm9yIGxvYWRpbmcgYW5kIHRoZW4gc3RhcnRzIGxvYWRpbmcgaWYgbm90XG4gICAqIHBhdXNlZC5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IG5hbWVzcGFjZVxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgZ29vZy5EZWJ1Z0xvYWRlcl8ucHJvdG90eXBlLmxvYWRfID0gZnVuY3Rpb24obmFtZXNwYWNlKSB7XG4gICAgaWYgKCF0aGlzLmdldFBhdGhGcm9tRGVwc18obmFtZXNwYWNlKSkge1xuICAgICAgdmFyIGVycm9yTWVzc2FnZSA9ICdnb29nLnJlcXVpcmUgY291bGQgbm90IGZpbmQ6ICcgKyBuYW1lc3BhY2U7XG4gICAgICBnb29nLmxvZ1RvQ29uc29sZV8oZXJyb3JNZXNzYWdlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdmFyIGxvYWRlciA9IHRoaXM7XG5cbiAgICAgIHZhciBkZXBzID0gW107XG5cbiAgICAgIC8qKiBAcGFyYW0ge3N0cmluZ30gbmFtZXNwYWNlICovXG4gICAgICB2YXIgdmlzaXQgPSBmdW5jdGlvbihuYW1lc3BhY2UpIHtcbiAgICAgICAgdmFyIHBhdGggPSBsb2FkZXIuZ2V0UGF0aEZyb21EZXBzXyhuYW1lc3BhY2UpO1xuXG4gICAgICAgIGlmICghcGF0aCkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQmFkIGRlcGVuZGVuY3kgcGF0aCBvciBzeW1ib2w6ICcgKyBuYW1lc3BhY2UpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGxvYWRlci53cml0dGVuX1twYXRoXSkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGxvYWRlci53cml0dGVuX1twYXRoXSA9IHRydWU7XG5cbiAgICAgICAgdmFyIGRlcCA9IGxvYWRlci5kZXBlbmRlbmNpZXNfW3BhdGhdO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGRlcC5yZXF1aXJlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgIGlmICghZ29vZy5pc1Byb3ZpZGVkXyhkZXAucmVxdWlyZXNbaV0pKSB7XG4gICAgICAgICAgICB2aXNpdChkZXAucmVxdWlyZXNbaV0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGRlcHMucHVzaChkZXApO1xuICAgICAgfTtcblxuICAgICAgdmlzaXQobmFtZXNwYWNlKTtcblxuICAgICAgdmFyIHdhc0xvYWRpbmcgPSAhIXRoaXMuZGVwc1RvTG9hZF8ubGVuZ3RoO1xuICAgICAgdGhpcy5kZXBzVG9Mb2FkXyA9IHRoaXMuZGVwc1RvTG9hZF8uY29uY2F0KGRlcHMpO1xuXG4gICAgICBpZiAoIXRoaXMucGF1c2VkXyAmJiAhd2FzTG9hZGluZykge1xuICAgICAgICB0aGlzLmxvYWREZXBzXygpO1xuICAgICAgfVxuICAgIH1cbiAgfTtcblxuXG4gIC8qKlxuICAgKiBMb2FkcyBhbnkgcXVldWVkIGRlcGVuZGVuY2llcyB1bnRpbCB0aGV5IGFyZSBhbGwgbG9hZGVkIG9yIHBhdXNlZC5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICovXG4gIGdvb2cuRGVidWdMb2FkZXJfLnByb3RvdHlwZS5sb2FkRGVwc18gPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgbG9hZGVyID0gdGhpcztcbiAgICB2YXIgcGF1c2VkID0gdGhpcy5wYXVzZWRfO1xuXG4gICAgd2hpbGUgKHRoaXMuZGVwc1RvTG9hZF8ubGVuZ3RoICYmICFwYXVzZWQpIHtcbiAgICAgIChmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGxvYWRDYWxsRG9uZSA9IGZhbHNlO1xuICAgICAgICB2YXIgZGVwID0gbG9hZGVyLmRlcHNUb0xvYWRfLnNoaWZ0KCk7XG5cbiAgICAgICAgdmFyIGxvYWRlZCA9IGZhbHNlO1xuICAgICAgICBsb2FkZXIubG9hZGluZ18oZGVwKTtcblxuICAgICAgICB2YXIgY29udHJvbGxlciA9IHtcbiAgICAgICAgICBwYXVzZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAobG9hZENhbGxEb25lKSB7XG4gICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQ2Fubm90IGNhbGwgcGF1c2UgYWZ0ZXIgdGhlIGNhbGwgdG8gbG9hZC4nKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHBhdXNlZCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICByZXN1bWU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKGxvYWRDYWxsRG9uZSkge1xuICAgICAgICAgICAgICBsb2FkZXIucmVzdW1lXygpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgLy8gU29tZSBkZXAgY2FsbGVkIHBhdXNlIGFuZCB0aGVuIHJlc3VtZSBpbiB0aGUgc2FtZSBsb2FkIGNhbGwuXG4gICAgICAgICAgICAgIC8vIEp1c3Qga2VlcCBydW5uaW5nIHRoaXMgc2FtZSBsb29wLlxuICAgICAgICAgICAgICBwYXVzZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIGxvYWRlZDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAobG9hZGVkKSB7XG4gICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignRG91YmxlIGNhbGwgdG8gbG9hZGVkLicpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBsb2FkZWQgPSB0cnVlO1xuICAgICAgICAgICAgbG9hZGVyLmxvYWRlZF8oZGVwKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHBlbmRpbmc6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgLy8gRGVmZW5zaXZlIGNvcHkuXG4gICAgICAgICAgICB2YXIgcGVuZGluZyA9IFtdO1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsb2FkZXIubG9hZGluZ0RlcHNfLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgIHBlbmRpbmcucHVzaChsb2FkZXIubG9hZGluZ0RlcHNfW2ldKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBwZW5kaW5nO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgLyoqXG4gICAgICAgICAgICogQHBhcmFtIHtnb29nLk1vZHVsZVR5cGV9IHR5cGVcbiAgICAgICAgICAgKi9cbiAgICAgICAgICBzZXRNb2R1bGVTdGF0ZTogZnVuY3Rpb24odHlwZSkge1xuICAgICAgICAgICAgZ29vZy5tb2R1bGVMb2FkZXJTdGF0ZV8gPSB7XG4gICAgICAgICAgICAgIHR5cGU6IHR5cGUsXG4gICAgICAgICAgICAgIG1vZHVsZU5hbWU6ICcnLFxuICAgICAgICAgICAgICBkZWNsYXJlTGVnYWN5TmFtZXNwYWNlOiBmYWxzZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIC8qKiBAdHlwZSB7ZnVuY3Rpb24oc3RyaW5nLCBzdHJpbmcsIHN0cmluZz0pfSAqL1xuICAgICAgICAgIHJlZ2lzdGVyRXM2TW9kdWxlRXhwb3J0czogZnVuY3Rpb24oXG4gICAgICAgICAgICAgIHBhdGgsIGV4cG9ydHMsIG9wdF9jbG9zdXJlTmFtZXNwYWNlKSB7XG4gICAgICAgICAgICBpZiAob3B0X2Nsb3N1cmVOYW1lc3BhY2UpIHtcbiAgICAgICAgICAgICAgZ29vZy5sb2FkZWRNb2R1bGVzX1tvcHRfY2xvc3VyZU5hbWVzcGFjZV0gPSB7XG4gICAgICAgICAgICAgICAgZXhwb3J0czogZXhwb3J0cyxcbiAgICAgICAgICAgICAgICB0eXBlOiBnb29nLk1vZHVsZVR5cGUuRVM2LFxuICAgICAgICAgICAgICAgIG1vZHVsZUlkOiBvcHRfY2xvc3VyZU5hbWVzcGFjZSB8fCAnJ1xuICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgLyoqIEB0eXBlIHtmdW5jdGlvbihzdHJpbmcsID8pfSAqL1xuICAgICAgICAgIHJlZ2lzdGVyR29vZ01vZHVsZUV4cG9ydHM6IGZ1bmN0aW9uKG1vZHVsZUlkLCBleHBvcnRzKSB7XG4gICAgICAgICAgICBnb29nLmxvYWRlZE1vZHVsZXNfW21vZHVsZUlkXSA9IHtcbiAgICAgICAgICAgICAgZXhwb3J0czogZXhwb3J0cyxcbiAgICAgICAgICAgICAgdHlwZTogZ29vZy5Nb2R1bGVUeXBlLkdPT0csXG4gICAgICAgICAgICAgIG1vZHVsZUlkOiBtb2R1bGVJZFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGNsZWFyTW9kdWxlU3RhdGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgZ29vZy5tb2R1bGVMb2FkZXJTdGF0ZV8gPSBudWxsO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZGVmZXI6IGZ1bmN0aW9uKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICBpZiAobG9hZENhbGxEb25lKSB7XG4gICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAgICAgICAgICdDYW5ub3QgcmVnaXN0ZXIgd2l0aCBkZWZlciBhZnRlciB0aGUgY2FsbCB0byBsb2FkLicpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbG9hZGVyLmRlZmVyXyhkZXAsIGNhbGxiYWNrKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGFyZURlcHNMb2FkZWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIGxvYWRlci5hcmVEZXBzTG9hZGVkXyhkZXAucmVxdWlyZXMpO1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB0cnkge1xuICAgICAgICAgIGRlcC5sb2FkKGNvbnRyb2xsZXIpO1xuICAgICAgICB9IGZpbmFsbHkge1xuICAgICAgICAgIGxvYWRDYWxsRG9uZSA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgIH0pKCk7XG4gICAgfVxuXG4gICAgaWYgKHBhdXNlZCkge1xuICAgICAgdGhpcy5wYXVzZV8oKTtcbiAgICB9XG4gIH07XG5cblxuICAvKiogQHByaXZhdGUgKi9cbiAgZ29vZy5EZWJ1Z0xvYWRlcl8ucHJvdG90eXBlLnBhdXNlXyA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMucGF1c2VkXyA9IHRydWU7XG4gIH07XG5cblxuICAvKiogQHByaXZhdGUgKi9cbiAgZ29vZy5EZWJ1Z0xvYWRlcl8ucHJvdG90eXBlLnJlc3VtZV8gPSBmdW5jdGlvbigpIHtcbiAgICBpZiAodGhpcy5wYXVzZWRfKSB7XG4gICAgICB0aGlzLnBhdXNlZF8gPSBmYWxzZTtcbiAgICAgIHRoaXMubG9hZERlcHNfKCk7XG4gICAgfVxuICB9O1xuXG5cbiAgLyoqXG4gICAqIE1hcmtzIHRoZSBnaXZlbiBkZXBlbmRlbmN5IGFzIGxvYWRpbmcgKGxvYWQgaGFzIGJlZW4gY2FsbGVkIGJ1dCBpdCBoYXMgbm90XG4gICAqIHlldCBtYXJrZWQgaXRzZWxmIGFzIGZpbmlzaGVkKS4gVXNlZnVsIGZvciBkZXBlbmRlbmNpZXMgdGhhdCB3YW50IHRvIGtub3dcbiAgICogd2hhdCBlbHNlIGlzIGxvYWRpbmcuIEV4YW1wbGU6IGdvb2cubW9kdWxlcyBjYW5ub3QgZXZhbCBpZiB0aGVyZSBhcmVcbiAgICogbG9hZGluZyBkZXBlbmRlbmNpZXMuXG4gICAqXG4gICAqIEBwYXJhbSB7IWdvb2cuRGVwZW5kZW5jeX0gZGVwXG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBnb29nLkRlYnVnTG9hZGVyXy5wcm90b3R5cGUubG9hZGluZ18gPSBmdW5jdGlvbihkZXApIHtcbiAgICB0aGlzLmxvYWRpbmdEZXBzXy5wdXNoKGRlcCk7XG4gIH07XG5cblxuICAvKipcbiAgICogTWFya3MgdGhlIGdpdmVuIGRlcGVuZGVuY3kgYXMgaGF2aW5nIGZpbmlzaGVkIGxvYWRpbmcgYW5kIGJlaW5nIGF2YWlsYWJsZVxuICAgKiBmb3IgcmVxdWlyZS5cbiAgICpcbiAgICogQHBhcmFtIHshZ29vZy5EZXBlbmRlbmN5fSBkZXBcbiAgICogQHByaXZhdGVcbiAgICovXG4gIGdvb2cuRGVidWdMb2FkZXJfLnByb3RvdHlwZS5sb2FkZWRfID0gZnVuY3Rpb24oZGVwKSB7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmxvYWRpbmdEZXBzXy5sZW5ndGg7IGkrKykge1xuICAgICAgaWYgKHRoaXMubG9hZGluZ0RlcHNfW2ldID09IGRlcCkge1xuICAgICAgICB0aGlzLmxvYWRpbmdEZXBzXy5zcGxpY2UoaSwgMSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cblxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5kZWZlcnJlZFF1ZXVlXy5sZW5ndGg7IGkrKykge1xuICAgICAgaWYgKHRoaXMuZGVmZXJyZWRRdWV1ZV9baV0gPT0gZGVwLnBhdGgpIHtcbiAgICAgICAgdGhpcy5kZWZlcnJlZFF1ZXVlXy5zcGxpY2UoaSwgMSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmICh0aGlzLmxvYWRpbmdEZXBzXy5sZW5ndGggPT0gdGhpcy5kZWZlcnJlZFF1ZXVlXy5sZW5ndGggJiZcbiAgICAgICAgIXRoaXMuZGVwc1RvTG9hZF8ubGVuZ3RoKSB7XG4gICAgICAvLyBTb21ldGhpbmcgaGFzIGFza2VkIHRvIGxvYWQgdGhlc2UsIGJ1dCB0aGV5IG1heSBub3QgYmUgZGlyZWN0bHlcbiAgICAgIC8vIHJlcXVpcmVkIGFnYWluIGxhdGVyLCBzbyBsb2FkIHRoZW0gbm93IHRoYXQgd2Uga25vdyB3ZSdyZSBkb25lIGxvYWRpbmdcbiAgICAgIC8vIGV2ZXJ5dGhpbmcgZWxzZS4gZS5nLiBhIGdvb2cgbW9kdWxlIGVudHJ5IHBvaW50LlxuICAgICAgd2hpbGUgKHRoaXMuZGVmZXJyZWRRdWV1ZV8ubGVuZ3RoKSB7XG4gICAgICAgIHRoaXMucmVxdWVzdGVkKHRoaXMuZGVmZXJyZWRRdWV1ZV8uc2hpZnQoKSwgdHJ1ZSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgZGVwLmxvYWRlZCgpO1xuICB9O1xuXG5cbiAgLyoqXG4gICAqIEBwYXJhbSB7IUFycmF5PHN0cmluZz59IHBhdGhzT3JJZHNcbiAgICogQHJldHVybiB7Ym9vbGVhbn1cbiAgICogQHByaXZhdGVcbiAgICovXG4gIGdvb2cuRGVidWdMb2FkZXJfLnByb3RvdHlwZS5hcmVEZXBzTG9hZGVkXyA9IGZ1bmN0aW9uKHBhdGhzT3JJZHMpIHtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHBhdGhzT3JJZHMubGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhciBwYXRoID0gdGhpcy5nZXRQYXRoRnJvbURlcHNfKHBhdGhzT3JJZHNbaV0pO1xuICAgICAgaWYgKCFwYXRoIHx8XG4gICAgICAgICAgKCEocGF0aCBpbiB0aGlzLmRlZmVycmVkQ2FsbGJhY2tzXykgJiZcbiAgICAgICAgICAgIWdvb2cuaXNQcm92aWRlZF8ocGF0aHNPcklkc1tpXSkpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfTtcblxuXG4gIC8qKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gYWJzUGF0aE9ySWRcbiAgICogQHJldHVybiB7P3N0cmluZ31cbiAgICogQHByaXZhdGVcbiAgICovXG4gIGdvb2cuRGVidWdMb2FkZXJfLnByb3RvdHlwZS5nZXRQYXRoRnJvbURlcHNfID0gZnVuY3Rpb24oYWJzUGF0aE9ySWQpIHtcbiAgICBpZiAoYWJzUGF0aE9ySWQgaW4gdGhpcy5pZFRvUGF0aF8pIHtcbiAgICAgIHJldHVybiB0aGlzLmlkVG9QYXRoX1thYnNQYXRoT3JJZF07XG4gICAgfSBlbHNlIGlmIChhYnNQYXRoT3JJZCBpbiB0aGlzLmRlcGVuZGVuY2llc18pIHtcbiAgICAgIHJldHVybiBhYnNQYXRoT3JJZDtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICB9O1xuXG5cbiAgLyoqXG4gICAqIEBwYXJhbSB7IWdvb2cuRGVwZW5kZW5jeX0gZGVwZW5kZW5jeVxuICAgKiBAcGFyYW0geyFGdW5jdGlvbn0gY2FsbGJhY2tcbiAgICogQHByaXZhdGVcbiAgICovXG4gIGdvb2cuRGVidWdMb2FkZXJfLnByb3RvdHlwZS5kZWZlcl8gPSBmdW5jdGlvbihkZXBlbmRlbmN5LCBjYWxsYmFjaykge1xuICAgIHRoaXMuZGVmZXJyZWRDYWxsYmFja3NfW2RlcGVuZGVuY3kucGF0aF0gPSBjYWxsYmFjaztcbiAgICB0aGlzLmRlZmVycmVkUXVldWVfLnB1c2goZGVwZW5kZW5jeS5wYXRoKTtcbiAgfTtcblxuXG4gIC8qKlxuICAgKiBJbnRlcmZhY2UgZm9yIGdvb2cuRGVwZW5kZW5jeSBpbXBsZW1lbnRhdGlvbnMgdG8gaGF2ZSBzb21lIGNvbnRyb2wgb3ZlclxuICAgKiBsb2FkaW5nIG9mIGRlcGVuZGVuY2llcy5cbiAgICpcbiAgICogQHJlY29yZFxuICAgKi9cbiAgZ29vZy5Mb2FkQ29udHJvbGxlciA9IGZ1bmN0aW9uKCkge307XG5cblxuICAvKipcbiAgICogVGVsbHMgdGhlIGNvbnRyb2xsZXIgdG8gaGFsdCBsb2FkaW5nIG9mIG1vcmUgZGVwZW5kZW5jaWVzLlxuICAgKi9cbiAgZ29vZy5Mb2FkQ29udHJvbGxlci5wcm90b3R5cGUucGF1c2UgPSBmdW5jdGlvbigpIHt9O1xuXG5cbiAgLyoqXG4gICAqIFRlbGxzIHRoZSBjb250cm9sbGVyIHRvIHJlc3VtZSBsb2FkaW5nIG9mIG1vcmUgZGVwZW5kZW5jaWVzIGlmIHBhdXNlZC5cbiAgICovXG4gIGdvb2cuTG9hZENvbnRyb2xsZXIucHJvdG90eXBlLnJlc3VtZSA9IGZ1bmN0aW9uKCkge307XG5cblxuICAvKipcbiAgICogVGVsbHMgdGhlIGNvbnRyb2xsZXIgdGhhdCB0aGlzIGRlcGVuZGVuY3kgaGFzIGZpbmlzaGVkIGxvYWRpbmcuXG4gICAqXG4gICAqIFRoaXMgY2F1c2VzIHRoaXMgdG8gYmUgcmVtb3ZlZCBmcm9tIHBlbmRpbmcoKSBhbmQgYW55IGxvYWQgY2FsbGJhY2tzIHRvXG4gICAqIGZpcmUuXG4gICAqL1xuICBnb29nLkxvYWRDb250cm9sbGVyLnByb3RvdHlwZS5sb2FkZWQgPSBmdW5jdGlvbigpIHt9O1xuXG5cbiAgLyoqXG4gICAqIExpc3Qgb2YgZGVwZW5kZW5jaWVzIG9uIHdoaWNoIGxvYWQgaGFzIGJlZW4gY2FsbGVkIGJ1dCB3aGljaCBoYXZlIG5vdFxuICAgKiBjYWxsZWQgbG9hZGVkIG9uIHRoZWlyIGNvbnRyb2xsZXIuIFRoaXMgaW5jbHVkZXMgdGhlIGN1cnJlbnQgZGVwZW5kZW5jeS5cbiAgICpcbiAgICogQHJldHVybiB7IUFycmF5PCFnb29nLkRlcGVuZGVuY3k+fVxuICAgKi9cbiAgZ29vZy5Mb2FkQ29udHJvbGxlci5wcm90b3R5cGUucGVuZGluZyA9IGZ1bmN0aW9uKCkge307XG5cblxuICAvKipcbiAgICogUmVnaXN0ZXJzIGFuIG9iamVjdCBhcyBhbiBFUzYgbW9kdWxlJ3MgZXhwb3J0cyBzbyB0aGF0IGdvb2cubW9kdWxlcyBtYXlcbiAgICogcmVxdWlyZSBpdCBieSBwYXRoLlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gcGF0aCBGdWxsIHBhdGggb2YgdGhlIG1vZHVsZS5cbiAgICogQHBhcmFtIHs/fSBleHBvcnRzXG4gICAqIEBwYXJhbSB7c3RyaW5nPX0gb3B0X2Nsb3N1cmVOYW1lc3BhY2UgQ2xvc3VyZSBuYW1lc3BhY2UgdG8gYXNzb2NpYXRlIHdpdGhcbiAgICogICAgIHRoaXMgbW9kdWxlLlxuICAgKi9cbiAgZ29vZy5Mb2FkQ29udHJvbGxlci5wcm90b3R5cGUucmVnaXN0ZXJFczZNb2R1bGVFeHBvcnRzID0gZnVuY3Rpb24oXG4gICAgICBwYXRoLCBleHBvcnRzLCBvcHRfY2xvc3VyZU5hbWVzcGFjZSkge307XG5cblxuICAvKipcbiAgICogU2V0cyB0aGUgY3VycmVudCBtb2R1bGUgc3RhdGUuXG4gICAqXG4gICAqIEBwYXJhbSB7Z29vZy5Nb2R1bGVUeXBlfSB0eXBlIFR5cGUgb2YgbW9kdWxlLlxuICAgKi9cbiAgZ29vZy5Mb2FkQ29udHJvbGxlci5wcm90b3R5cGUuc2V0TW9kdWxlU3RhdGUgPSBmdW5jdGlvbih0eXBlKSB7fTtcblxuXG4gIC8qKlxuICAgKiBDbGVhcnMgdGhlIGN1cnJlbnQgbW9kdWxlIHN0YXRlLlxuICAgKi9cbiAgZ29vZy5Mb2FkQ29udHJvbGxlci5wcm90b3R5cGUuY2xlYXJNb2R1bGVTdGF0ZSA9IGZ1bmN0aW9uKCkge307XG5cblxuICAvKipcbiAgICogUmVnaXN0ZXJzIGEgY2FsbGJhY2sgdG8gY2FsbCBvbmNlIHRoZSBkZXBlbmRlbmN5IGlzIGFjdHVhbGx5IHJlcXVlc3RlZFxuICAgKiB2aWEgZ29vZy5yZXF1aXJlICsgYWxsIG9mIHRoZSBpbW1lZGlhdGUgZGVwZW5kZW5jaWVzIGhhdmUgYmVlbiBsb2FkZWQgb3JcbiAgICogYWxsIG90aGVyIGZpbGVzIGhhdmUgYmVlbiBsb2FkZWQuIEFsbG93cyBmb3IgbGF6eSBsb2FkaW5nIHVudGlsXG4gICAqIHJlcXVpcmUnZCB3aXRob3V0IHBhdXNpbmcgZGVwZW5kZW5jeSBsb2FkaW5nLCB3aGljaCBpcyBuZWVkZWQgb24gb2xkIElFLlxuICAgKlxuICAgKiBAcGFyYW0geyFGdW5jdGlvbn0gY2FsbGJhY2tcbiAgICovXG4gIGdvb2cuTG9hZENvbnRyb2xsZXIucHJvdG90eXBlLmRlZmVyID0gZnVuY3Rpb24oY2FsbGJhY2spIHt9O1xuXG5cbiAgLyoqXG4gICAqIEByZXR1cm4ge2Jvb2xlYW59XG4gICAqL1xuICBnb29nLkxvYWRDb250cm9sbGVyLnByb3RvdHlwZS5hcmVEZXBzTG9hZGVkID0gZnVuY3Rpb24oKSB7fTtcblxuXG4gIC8qKlxuICAgKiBCYXNpYyBzdXBlciBjbGFzcyBmb3IgYWxsIGRlcGVuZGVuY2llcyBDbG9zdXJlIExpYnJhcnkgY2FuIGxvYWQuXG4gICAqXG4gICAqIFRoaXMgZGVmYXVsdCBpbXBsZW1lbnRhdGlvbiBpcyBkZXNpZ25lZCB0byBsb2FkIHVudHJhbnNwaWxlZCwgbm9uLW1vZHVsZVxuICAgKiBzY3JpcHRzIGluIGEgd2ViIGJyb3N3ZXIuXG4gICAqXG4gICAqIEZvciB0cmFuc3BpbGVkIG5vbi1nb29nLm1vZHVsZSBmaWxlcyB7QHNlZSBnb29nLlRyYW5zcGlsZWREZXBlbmRlbmN5fS5cbiAgICogRm9yIGdvb2cubW9kdWxlcyBzZWUge0BzZWUgZ29vZy5Hb29nTW9kdWxlRGVwZW5kZW5jeX0uXG4gICAqIEZvciB1bnRyYW5zcGlsZWQgRVM2IG1vZHVsZXMge0BzZWUgZ29vZy5FczZNb2R1bGVEZXBlbmRlbmN5fS5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IHBhdGggQWJzb2x1dGUgcGF0aCBvZiB0aGlzIHNjcmlwdC5cbiAgICogQHBhcmFtIHtzdHJpbmd9IHJlbGF0aXZlUGF0aCBQYXRoIG9mIHRoaXMgc2NyaXB0IHJlbGF0aXZlIHRvIGdvb2cuYmFzZVBhdGguXG4gICAqIEBwYXJhbSB7IUFycmF5PHN0cmluZz59IHByb3ZpZGVzIGdvb2cucHJvdmlkZWQgb3IgZ29vZy5tb2R1bGUgc3ltYm9sc1xuICAgKiAgICAgaW4gdGhpcyBmaWxlLlxuICAgKiBAcGFyYW0geyFBcnJheTxzdHJpbmc+fSByZXF1aXJlcyBnb29nIHN5bWJvbHMgb3IgcmVsYXRpdmUgcGF0aHMgdG8gQ2xvc3VyZVxuICAgKiAgICAgdGhpcyBkZXBlbmRzIG9uLlxuICAgKiBAcGFyYW0geyFPYmplY3Q8c3RyaW5nLCBzdHJpbmc+fSBsb2FkRmxhZ3NcbiAgICogQHN0cnVjdCBAY29uc3RydWN0b3JcbiAgICovXG4gIGdvb2cuRGVwZW5kZW5jeSA9IGZ1bmN0aW9uKFxuICAgICAgcGF0aCwgcmVsYXRpdmVQYXRoLCBwcm92aWRlcywgcmVxdWlyZXMsIGxvYWRGbGFncykge1xuICAgIC8qKiBAY29uc3QgKi9cbiAgICB0aGlzLnBhdGggPSBwYXRoO1xuICAgIC8qKiBAY29uc3QgKi9cbiAgICB0aGlzLnJlbGF0aXZlUGF0aCA9IHJlbGF0aXZlUGF0aDtcbiAgICAvKiogQGNvbnN0ICovXG4gICAgdGhpcy5wcm92aWRlcyA9IHByb3ZpZGVzO1xuICAgIC8qKiBAY29uc3QgKi9cbiAgICB0aGlzLnJlcXVpcmVzID0gcmVxdWlyZXM7XG4gICAgLyoqIEBjb25zdCAqL1xuICAgIHRoaXMubG9hZEZsYWdzID0gbG9hZEZsYWdzO1xuICAgIC8qKiBAcHJpdmF0ZSB7Ym9vbGVhbn0gKi9cbiAgICB0aGlzLmxvYWRlZF8gPSBmYWxzZTtcbiAgICAvKiogQHByaXZhdGUgeyFBcnJheTxmdW5jdGlvbigpPn0gKi9cbiAgICB0aGlzLmxvYWRDYWxsYmFja3NfID0gW107XG4gIH07XG5cblxuICAvKipcbiAgICogQHJldHVybiB7c3RyaW5nfSBUaGUgcGF0aG5hbWUgcGFydCBvZiB0aGlzIGRlcGVuZGVuY3kncyBwYXRoIGlmIGl0IGlzIGFcbiAgICogICAgIFVSSS5cbiAgICovXG4gIGdvb2cuRGVwZW5kZW5jeS5wcm90b3R5cGUuZ2V0UGF0aE5hbWUgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgcGF0aE5hbWUgPSB0aGlzLnBhdGg7XG4gICAgdmFyIHByb3RvY29sSW5kZXggPSBwYXRoTmFtZS5pbmRleE9mKCc6Ly8nKTtcbiAgICBpZiAocHJvdG9jb2xJbmRleCA+PSAwKSB7XG4gICAgICBwYXRoTmFtZSA9IHBhdGhOYW1lLnN1YnN0cmluZyhwcm90b2NvbEluZGV4ICsgMyk7XG4gICAgICB2YXIgc2xhc2hJbmRleCA9IHBhdGhOYW1lLmluZGV4T2YoJy8nKTtcbiAgICAgIGlmIChzbGFzaEluZGV4ID49IDApIHtcbiAgICAgICAgcGF0aE5hbWUgPSBwYXRoTmFtZS5zdWJzdHJpbmcoc2xhc2hJbmRleCArIDEpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcGF0aE5hbWU7XG4gIH07XG5cblxuICAvKipcbiAgICogQHBhcmFtIHtmdW5jdGlvbigpfSBjYWxsYmFjayBDYWxsYmFjayB0byBmaXJlIGFzIHNvb24gYXMgdGhpcyBoYXMgbG9hZGVkLlxuICAgKiBAZmluYWxcbiAgICovXG4gIGdvb2cuRGVwZW5kZW5jeS5wcm90b3R5cGUub25Mb2FkID0gZnVuY3Rpb24oY2FsbGJhY2spIHtcbiAgICBpZiAodGhpcy5sb2FkZWRfKSB7XG4gICAgICBjYWxsYmFjaygpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmxvYWRDYWxsYmFja3NfLnB1c2goY2FsbGJhY2spO1xuICAgIH1cbiAgfTtcblxuXG4gIC8qKlxuICAgKiBNYXJrcyB0aGlzIGRlcGVuZGVuY3kgYXMgbG9hZGVkIGFuZCBmaXJlcyBhbnkgY2FsbGJhY2tzIHJlZ2lzdGVyZWQgd2l0aFxuICAgKiBvbkxvYWQuXG4gICAqIEBmaW5hbFxuICAgKi9cbiAgZ29vZy5EZXBlbmRlbmN5LnByb3RvdHlwZS5sb2FkZWQgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmxvYWRlZF8gPSB0cnVlO1xuICAgIHZhciBjYWxsYmFja3MgPSB0aGlzLmxvYWRDYWxsYmFja3NfO1xuICAgIHRoaXMubG9hZENhbGxiYWNrc18gPSBbXTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNhbGxiYWNrcy5sZW5ndGg7IGkrKykge1xuICAgICAgY2FsbGJhY2tzW2ldKCk7XG4gICAgfVxuICB9O1xuXG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgb3Igbm90IGRvY3VtZW50LndyaXR0ZW4gLyBhcHBlbmRlZCBzY3JpcHQgdGFncyBzaG91bGQgYmUgZGVmZXJyZWQuXG4gICAqXG4gICAqIEBwcml2YXRlIHtib29sZWFufVxuICAgKi9cbiAgZ29vZy5EZXBlbmRlbmN5LmRlZmVyXyA9IGZhbHNlO1xuXG5cbiAgLyoqXG4gICAqIE1hcCBvZiBzY3JpcHQgcmVhZHkgLyBzdGF0ZSBjaGFuZ2UgY2FsbGJhY2tzLiBPbGQgSUUgY2Fubm90IGhhbmRsZSBwdXR0aW5nXG4gICAqIHRoZXNlIHByb3BlcnRpZXMgb24gZ29vZy5nbG9iYWwuXG4gICAqXG4gICAqIEBwcml2YXRlIEBjb25zdCB7IU9iamVjdDxzdHJpbmcsIGZ1bmN0aW9uKD8pOnVuZGVmaW5lZD59XG4gICAqL1xuICBnb29nLkRlcGVuZGVuY3kuY2FsbGJhY2tNYXBfID0ge307XG5cblxuICAvKipcbiAgICogQHBhcmFtIHtmdW5jdGlvbiguLi4/KTo/fSBjYWxsYmFja1xuICAgKiBAcmV0dXJuIHtzdHJpbmd9XG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBnb29nLkRlcGVuZGVuY3kucmVnaXN0ZXJDYWxsYmFja18gPSBmdW5jdGlvbihjYWxsYmFjaykge1xuICAgIHZhciBrZXkgPSBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDMyKTtcbiAgICBnb29nLkRlcGVuZGVuY3kuY2FsbGJhY2tNYXBfW2tleV0gPSBjYWxsYmFjaztcbiAgICByZXR1cm4ga2V5O1xuICB9O1xuXG5cbiAgLyoqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBrZXlcbiAgICogQHByaXZhdGVcbiAgICovXG4gIGdvb2cuRGVwZW5kZW5jeS51bnJlZ2lzdGVyQ2FsbGJhY2tfID0gZnVuY3Rpb24oa2V5KSB7XG4gICAgZGVsZXRlIGdvb2cuRGVwZW5kZW5jeS5jYWxsYmFja01hcF9ba2V5XTtcbiAgfTtcblxuXG4gIC8qKlxuICAgKiBAcGFyYW0ge3N0cmluZ30ga2V5XG4gICAqIEBwYXJhbSB7Li4uP30gdmFyX2FyZ3NcbiAgICogQHByaXZhdGVcbiAgICogQHN1cHByZXNzIHt1bnVzZWRQcml2YXRlTWVtYmVyc31cbiAgICovXG4gIGdvb2cuRGVwZW5kZW5jeS5jYWxsYmFja18gPSBmdW5jdGlvbihrZXksIHZhcl9hcmdzKSB7XG4gICAgaWYgKGtleSBpbiBnb29nLkRlcGVuZGVuY3kuY2FsbGJhY2tNYXBfKSB7XG4gICAgICB2YXIgY2FsbGJhY2sgPSBnb29nLkRlcGVuZGVuY3kuY2FsbGJhY2tNYXBfW2tleV07XG4gICAgICB2YXIgYXJncyA9IFtdO1xuICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgYXJncy5wdXNoKGFyZ3VtZW50c1tpXSk7XG4gICAgICB9XG4gICAgICBjYWxsYmFjay5hcHBseSh1bmRlZmluZWQsIGFyZ3MpO1xuICAgIH0gZWxzZSB7XG4gICAgICB2YXIgZXJyb3JNZXNzYWdlID0gJ0NhbGxiYWNrIGtleSAnICsga2V5ICtcbiAgICAgICAgICAnIGRvZXMgbm90IGV4aXN0ICh3YXMgYmFzZS5qcyBsb2FkZWQgbW9yZSB0aGFuIG9uY2U/KS4nO1xuICAgICAgdGhyb3cgRXJyb3IoZXJyb3JNZXNzYWdlKTtcbiAgICB9XG4gIH07XG5cblxuICAvKipcbiAgICogU3RhcnRzIGxvYWRpbmcgdGhpcyBkZXBlbmRlbmN5LiBUaGlzIGRlcGVuZGVuY3kgY2FuIHBhdXNlIGxvYWRpbmcgaWYgaXRcbiAgICogbmVlZHMgdG8gYW5kIHJlc3VtZSBpdCBsYXRlciB2aWEgdGhlIGNvbnRyb2xsZXIgaW50ZXJmYWNlLlxuICAgKlxuICAgKiBXaGVuIHRoaXMgaXMgbG9hZGVkIGl0IHNob3VsZCBjYWxsIGNvbnRyb2xsZXIubG9hZGVkKCkuIE5vdGUgdGhhdCB0aGlzIHdpbGxcbiAgICogZW5kIHVwIGNhbGxpbmcgdGhlIGxvYWRlZCBtZXRob2Qgb2YgdGhpcyBkZXBlbmRlbmN5OyB0aGVyZSBpcyBubyBuZWVkIHRvXG4gICAqIGNhbGwgaXQgZXhwbGljaXRseS5cbiAgICpcbiAgICogQHBhcmFtIHshZ29vZy5Mb2FkQ29udHJvbGxlcn0gY29udHJvbGxlclxuICAgKi9cbiAgZ29vZy5EZXBlbmRlbmN5LnByb3RvdHlwZS5sb2FkID0gZnVuY3Rpb24oY29udHJvbGxlcikge1xuICAgIGlmIChnb29nLmdsb2JhbC5DTE9TVVJFX0lNUE9SVF9TQ1JJUFQpIHtcbiAgICAgIGlmIChnb29nLmdsb2JhbC5DTE9TVVJFX0lNUE9SVF9TQ1JJUFQodGhpcy5wYXRoKSkge1xuICAgICAgICBjb250cm9sbGVyLmxvYWRlZCgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29udHJvbGxlci5wYXVzZSgpO1xuICAgICAgfVxuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmICghZ29vZy5pbkh0bWxEb2N1bWVudF8oKSkge1xuICAgICAgZ29vZy5sb2dUb0NvbnNvbGVfKFxuICAgICAgICAgICdDYW5ub3QgdXNlIGRlZmF1bHQgZGVidWcgbG9hZGVyIG91dHNpZGUgb2YgSFRNTCBkb2N1bWVudHMuJyk7XG4gICAgICBpZiAodGhpcy5yZWxhdGl2ZVBhdGggPT0gJ2RlcHMuanMnKSB7XG4gICAgICAgIC8vIFNvbWUgb2xkIGNvZGUgaXMgcmVseWluZyBvbiBiYXNlLmpzIGF1dG8gbG9hZGluZyBkZXBzLmpzIGZhaWxpbmcgd2l0aFxuICAgICAgICAvLyBubyBlcnJvciBiZWZvcmUgbGF0ZXIgc2V0dGluZyBDTE9TVVJFX0lNUE9SVF9TQ1JJUFQuXG4gICAgICAgIC8vIENMT1NVUkVfSU1QT1JUX1NDUklQVCBzaG91bGQgYmUgc2V0ICpiZWZvcmUqIGJhc2UuanMgaXMgbG9hZGVkLCBvclxuICAgICAgICAvLyBDTE9TVVJFX05PX0RFUFMgc2V0IHRvIHRydWUuXG4gICAgICAgIGdvb2cubG9nVG9Db25zb2xlXyhcbiAgICAgICAgICAgICdDb25zaWRlciBzZXR0aW5nIENMT1NVUkVfSU1QT1JUX1NDUklQVCBiZWZvcmUgbG9hZGluZyBiYXNlLmpzLCAnICtcbiAgICAgICAgICAgICdvciBzZXR0aW5nIENMT1NVUkVfTk9fREVQUyB0byB0cnVlLicpO1xuICAgICAgICBjb250cm9sbGVyLmxvYWRlZCgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29udHJvbGxlci5wYXVzZSgpO1xuICAgICAgfVxuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8qKiBAdHlwZSB7IUhUTUxEb2N1bWVudH0gKi9cbiAgICB2YXIgZG9jID0gZ29vZy5nbG9iYWwuZG9jdW1lbnQ7XG5cbiAgICAvLyBJZiB0aGUgdXNlciB0cmllcyB0byByZXF1aXJlIGEgbmV3IHN5bWJvbCBhZnRlciBkb2N1bWVudCBsb2FkLFxuICAgIC8vIHNvbWV0aGluZyBoYXMgZ29uZSB0ZXJyaWJseSB3cm9uZy4gRG9pbmcgYSBkb2N1bWVudC53cml0ZSB3b3VsZFxuICAgIC8vIHdpcGUgb3V0IHRoZSBwYWdlLiBUaGlzIGRvZXMgbm90IGFwcGx5IHRvIHRoZSBDU1AtY29tcGxpYW50IG1ldGhvZFxuICAgIC8vIG9mIHdyaXRpbmcgc2NyaXB0IHRhZ3MuXG4gICAgaWYgKGRvYy5yZWFkeVN0YXRlID09ICdjb21wbGV0ZScgJiZcbiAgICAgICAgIWdvb2cuRU5BQkxFX0NIUk9NRV9BUFBfU0FGRV9TQ1JJUFRfTE9BRElORykge1xuICAgICAgLy8gQ2VydGFpbiB0ZXN0IGZyYW1ld29ya3MgbG9hZCBiYXNlLmpzIG11bHRpcGxlIHRpbWVzLCB3aGljaCB0cmllc1xuICAgICAgLy8gdG8gd3JpdGUgZGVwcy5qcyBlYWNoIHRpbWUuIElmIHRoYXQgaGFwcGVucywganVzdCBmYWlsIHNpbGVudGx5LlxuICAgICAgLy8gVGhlc2UgZnJhbWV3b3JrcyB3aXBlIHRoZSBwYWdlIGJldHdlZW4gZWFjaCBsb2FkIG9mIGJhc2UuanMsIHNvIHRoaXNcbiAgICAgIC8vIGlzIE9LLlxuICAgICAgdmFyIGlzRGVwcyA9IC9cXGJkZXBzLmpzJC8udGVzdCh0aGlzLnBhdGgpO1xuICAgICAgaWYgKGlzRGVwcykge1xuICAgICAgICBjb250cm9sbGVyLmxvYWRlZCgpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aHJvdyBFcnJvcignQ2Fubm90IHdyaXRlIFwiJyArIHRoaXMucGF0aCArICdcIiBhZnRlciBkb2N1bWVudCBsb2FkJyk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdmFyIG5vbmNlID0gZ29vZy5nZXRTY3JpcHROb25jZSgpO1xuICAgIGlmICghZ29vZy5FTkFCTEVfQ0hST01FX0FQUF9TQUZFX1NDUklQVF9MT0FESU5HICYmXG4gICAgICAgIGdvb2cuaXNEb2N1bWVudExvYWRpbmdfKCkpIHtcbiAgICAgIHZhciBrZXk7XG4gICAgICB2YXIgY2FsbGJhY2sgPSBmdW5jdGlvbihzY3JpcHQpIHtcbiAgICAgICAgaWYgKHNjcmlwdC5yZWFkeVN0YXRlICYmIHNjcmlwdC5yZWFkeVN0YXRlICE9ICdjb21wbGV0ZScpIHtcbiAgICAgICAgICBzY3JpcHQub25sb2FkID0gY2FsbGJhY2s7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGdvb2cuRGVwZW5kZW5jeS51bnJlZ2lzdGVyQ2FsbGJhY2tfKGtleSk7XG4gICAgICAgIGNvbnRyb2xsZXIubG9hZGVkKCk7XG4gICAgICB9O1xuICAgICAga2V5ID0gZ29vZy5EZXBlbmRlbmN5LnJlZ2lzdGVyQ2FsbGJhY2tfKGNhbGxiYWNrKTtcblxuICAgICAgdmFyIGRlZmVyID0gZ29vZy5EZXBlbmRlbmN5LmRlZmVyXyA/ICcgZGVmZXInIDogJyc7XG4gICAgICB2YXIgbm9uY2VBdHRyID0gbm9uY2UgPyAnIG5vbmNlPVwiJyArIG5vbmNlICsgJ1wiJyA6ICcnO1xuICAgICAgdmFyIHNjcmlwdCA9ICc8c2NyaXB0IHNyYz1cIicgKyB0aGlzLnBhdGggKyAnXCInICsgbm9uY2VBdHRyICsgZGVmZXIgK1xuICAgICAgICAgICcgaWQ9XCJzY3JpcHQtJyArIGtleSArICdcIj48XFwvc2NyaXB0Pic7XG5cbiAgICAgIHNjcmlwdCArPSAnPHNjcmlwdCcgKyBub25jZUF0dHIgKyAnPic7XG5cbiAgICAgIGlmIChnb29nLkRlcGVuZGVuY3kuZGVmZXJfKSB7XG4gICAgICAgIHNjcmlwdCArPSAnZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXFwnc2NyaXB0LScgKyBrZXkgK1xuICAgICAgICAgICAgJ1xcJykub25sb2FkID0gZnVuY3Rpb24oKSB7XFxuJyArXG4gICAgICAgICAgICAnICBnb29nLkRlcGVuZGVuY3kuY2FsbGJhY2tfKFxcJycgKyBrZXkgKyAnXFwnLCB0aGlzKTtcXG4nICtcbiAgICAgICAgICAgICd9O1xcbic7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzY3JpcHQgKz0gJ2dvb2cuRGVwZW5kZW5jeS5jYWxsYmFja18oXFwnJyArIGtleSArXG4gICAgICAgICAgICAnXFwnLCBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcXCdzY3JpcHQtJyArIGtleSArICdcXCcpKTsnO1xuICAgICAgfVxuXG4gICAgICBzY3JpcHQgKz0gJzxcXC9zY3JpcHQ+JztcblxuICAgICAgZG9jLndyaXRlKFxuICAgICAgICAgIGdvb2cuVFJVU1RFRF9UWVBFU19QT0xJQ1lfID9cbiAgICAgICAgICAgICAgZ29vZy5UUlVTVEVEX1RZUEVTX1BPTElDWV8uY3JlYXRlSFRNTChzY3JpcHQpIDpcbiAgICAgICAgICAgICAgc2NyaXB0KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdmFyIHNjcmlwdEVsID1cbiAgICAgICAgICAvKiogQHR5cGUgeyFIVE1MU2NyaXB0RWxlbWVudH0gKi8gKGRvYy5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKSk7XG4gICAgICBzY3JpcHRFbC5kZWZlciA9IGdvb2cuRGVwZW5kZW5jeS5kZWZlcl87XG4gICAgICBzY3JpcHRFbC5hc3luYyA9IGZhbHNlO1xuXG4gICAgICAvLyBJZiBDU1Agbm9uY2VzIGFyZSB1c2VkLCBwcm9wYWdhdGUgdGhlbSB0byBkeW5hbWljYWxseSBjcmVhdGVkIHNjcmlwdHMuXG4gICAgICAvLyBUaGlzIGlzIG5lY2Vzc2FyeSB0byBhbGxvdyBub25jZS1iYXNlZCBDU1BzIHdpdGhvdXQgJ3N0cmljdC1keW5hbWljJy5cbiAgICAgIGlmIChub25jZSkge1xuICAgICAgICBzY3JpcHRFbC5ub25jZSA9IG5vbmNlO1xuICAgICAgfVxuXG4gICAgICBpZiAoZ29vZy5EZWJ1Z0xvYWRlcl8uSVNfT0xEX0lFXykge1xuICAgICAgICAvLyBFeGVjdXRpb24gb3JkZXIgaXMgbm90IGd1YXJhbnRlZWQgb24gb2xkIElFLCBoYWx0IGxvYWRpbmcgYW5kIHdyaXRlXG4gICAgICAgIC8vIHRoZXNlIHNjcmlwdHMgb25lIGF0IGEgdGltZSwgYWZ0ZXIgZWFjaCBsb2Fkcy5cbiAgICAgICAgY29udHJvbGxlci5wYXVzZSgpO1xuICAgICAgICBzY3JpcHRFbC5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICBpZiAoc2NyaXB0RWwucmVhZHlTdGF0ZSA9PSAnbG9hZGVkJyB8fFxuICAgICAgICAgICAgICBzY3JpcHRFbC5yZWFkeVN0YXRlID09ICdjb21wbGV0ZScpIHtcbiAgICAgICAgICAgIGNvbnRyb2xsZXIubG9hZGVkKCk7XG4gICAgICAgICAgICBjb250cm9sbGVyLnJlc3VtZSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHNjcmlwdEVsLm9ubG9hZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHNjcmlwdEVsLm9ubG9hZCA9IG51bGw7XG4gICAgICAgICAgY29udHJvbGxlci5sb2FkZWQoKTtcbiAgICAgICAgfTtcbiAgICAgIH1cblxuICAgICAgc2NyaXB0RWwuc3JjID0gZ29vZy5UUlVTVEVEX1RZUEVTX1BPTElDWV8gP1xuICAgICAgICAgIGdvb2cuVFJVU1RFRF9UWVBFU19QT0xJQ1lfLmNyZWF0ZVNjcmlwdFVSTCh0aGlzLnBhdGgpIDpcbiAgICAgICAgICB0aGlzLnBhdGg7XG4gICAgICBkb2MuaGVhZC5hcHBlbmRDaGlsZChzY3JpcHRFbCk7XG4gICAgfVxuICB9O1xuXG5cbiAgLyoqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBwYXRoIEFic29sdXRlIHBhdGggb2YgdGhpcyBzY3JpcHQuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSByZWxhdGl2ZVBhdGggUGF0aCBvZiB0aGlzIHNjcmlwdCByZWxhdGl2ZSB0byBnb29nLmJhc2VQYXRoLlxuICAgKiBAcGFyYW0geyFBcnJheTxzdHJpbmc+fSBwcm92aWRlcyBTaG91bGQgYmUgYW4gZW1wdHkgYXJyYXkuXG4gICAqICAgICBUT0RPKGpvaG5wbGFpc3RlZCkgYWRkIHN1cHBvcnQgZm9yIGFkZGluZyBjbG9zdXJlIG5hbWVzcGFjZXMgdG8gRVM2XG4gICAqICAgICBtb2R1bGVzIGZvciBpbnRlcm9wIHB1cnBvc2VzLlxuICAgKiBAcGFyYW0geyFBcnJheTxzdHJpbmc+fSByZXF1aXJlcyBnb29nIHN5bWJvbHMgb3IgcmVsYXRpdmUgcGF0aHMgdG8gQ2xvc3VyZVxuICAgKiAgICAgdGhpcyBkZXBlbmRzIG9uLlxuICAgKiBAcGFyYW0geyFPYmplY3Q8c3RyaW5nLCBzdHJpbmc+fSBsb2FkRmxhZ3NcbiAgICogQHN0cnVjdCBAY29uc3RydWN0b3JcbiAgICogQGV4dGVuZHMge2dvb2cuRGVwZW5kZW5jeX1cbiAgICovXG4gIGdvb2cuRXM2TW9kdWxlRGVwZW5kZW5jeSA9IGZ1bmN0aW9uKFxuICAgICAgcGF0aCwgcmVsYXRpdmVQYXRoLCBwcm92aWRlcywgcmVxdWlyZXMsIGxvYWRGbGFncykge1xuICAgIGdvb2cuRXM2TW9kdWxlRGVwZW5kZW5jeS5iYXNlKFxuICAgICAgICB0aGlzLCAnY29uc3RydWN0b3InLCBwYXRoLCByZWxhdGl2ZVBhdGgsIHByb3ZpZGVzLCByZXF1aXJlcywgbG9hZEZsYWdzKTtcbiAgfTtcbiAgZ29vZy5pbmhlcml0cyhnb29nLkVzNk1vZHVsZURlcGVuZGVuY3ksIGdvb2cuRGVwZW5kZW5jeSk7XG5cblxuICAvKipcbiAgICogQG92ZXJyaWRlXG4gICAqIEBwYXJhbSB7IWdvb2cuTG9hZENvbnRyb2xsZXJ9IGNvbnRyb2xsZXJcbiAgICovXG4gIGdvb2cuRXM2TW9kdWxlRGVwZW5kZW5jeS5wcm90b3R5cGUubG9hZCA9IGZ1bmN0aW9uKGNvbnRyb2xsZXIpIHtcbiAgICBpZiAoZ29vZy5nbG9iYWwuQ0xPU1VSRV9JTVBPUlRfU0NSSVBUKSB7XG4gICAgICBpZiAoZ29vZy5nbG9iYWwuQ0xPU1VSRV9JTVBPUlRfU0NSSVBUKHRoaXMucGF0aCkpIHtcbiAgICAgICAgY29udHJvbGxlci5sb2FkZWQoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnRyb2xsZXIucGF1c2UoKTtcbiAgICAgIH1cbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAoIWdvb2cuaW5IdG1sRG9jdW1lbnRfKCkpIHtcbiAgICAgIGdvb2cubG9nVG9Db25zb2xlXyhcbiAgICAgICAgICAnQ2Fubm90IHVzZSBkZWZhdWx0IGRlYnVnIGxvYWRlciBvdXRzaWRlIG9mIEhUTUwgZG9jdW1lbnRzLicpO1xuICAgICAgY29udHJvbGxlci5wYXVzZSgpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8qKiBAdHlwZSB7IUhUTUxEb2N1bWVudH0gKi9cbiAgICB2YXIgZG9jID0gZ29vZy5nbG9iYWwuZG9jdW1lbnQ7XG5cbiAgICB2YXIgZGVwID0gdGhpcztcblxuICAgIC8vIFRPRE8oam9obnBsYWlzdGVkKTogRG9lcyBkb2N1bWVudC53cml0aW5nIHJlYWxseSBzcGVlZCB1cCBhbnl0aGluZz8gQW55XG4gICAgLy8gZGlmZmVyZW5jZSBiZXR3ZWVuIHRoaXMgYW5kIGp1c3Qgd2FpdGluZyBmb3IgaW50ZXJhY3RpdmUgbW9kZSBhbmQgdGhlblxuICAgIC8vIGFwcGVuZGluZz9cbiAgICBmdW5jdGlvbiB3cml0ZShzcmMsIGNvbnRlbnRzKSB7XG4gICAgICB2YXIgbm9uY2VBdHRyID0gJyc7XG4gICAgICB2YXIgbm9uY2UgPSBnb29nLmdldFNjcmlwdE5vbmNlKCk7XG4gICAgICBpZiAobm9uY2UpIHtcbiAgICAgICAgbm9uY2VBdHRyID0gJyBub25jZT1cIicgKyBub25jZSArICdcIic7XG4gICAgICB9XG5cbiAgICAgIGlmIChjb250ZW50cykge1xuICAgICAgICB2YXIgc2NyaXB0ID0gJzxzY3JpcHQgdHlwZT1cIm1vZHVsZVwiIGNyb3Nzb3JpZ2luJyArIG5vbmNlQXR0ciArICc+JyArXG4gICAgICAgICAgICBjb250ZW50cyArICc8LycgK1xuICAgICAgICAgICAgJ3NjcmlwdD4nO1xuICAgICAgICBkb2Mud3JpdGUoXG4gICAgICAgICAgICBnb29nLlRSVVNURURfVFlQRVNfUE9MSUNZXyA/XG4gICAgICAgICAgICAgICAgZ29vZy5UUlVTVEVEX1RZUEVTX1BPTElDWV8uY3JlYXRlSFRNTChzY3JpcHQpIDpcbiAgICAgICAgICAgICAgICBzY3JpcHQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIHNjcmlwdCA9ICc8c2NyaXB0IHR5cGU9XCJtb2R1bGVcIiBjcm9zc29yaWdpbiBzcmM9XCInICsgc3JjICsgJ1wiJyArXG4gICAgICAgICAgICBub25jZUF0dHIgKyAnPjwvJyArXG4gICAgICAgICAgICAnc2NyaXB0Pic7XG4gICAgICAgIGRvYy53cml0ZShcbiAgICAgICAgICAgIGdvb2cuVFJVU1RFRF9UWVBFU19QT0xJQ1lfID9cbiAgICAgICAgICAgICAgICBnb29nLlRSVVNURURfVFlQRVNfUE9MSUNZXy5jcmVhdGVIVE1MKHNjcmlwdCkgOlxuICAgICAgICAgICAgICAgIHNjcmlwdCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gYXBwZW5kKHNyYywgY29udGVudHMpIHtcbiAgICAgIHZhciBzY3JpcHRFbCA9XG4gICAgICAgICAgLyoqIEB0eXBlIHshSFRNTFNjcmlwdEVsZW1lbnR9ICovIChkb2MuY3JlYXRlRWxlbWVudCgnc2NyaXB0JykpO1xuICAgICAgc2NyaXB0RWwuZGVmZXIgPSB0cnVlO1xuICAgICAgc2NyaXB0RWwuYXN5bmMgPSBmYWxzZTtcbiAgICAgIHNjcmlwdEVsLnR5cGUgPSAnbW9kdWxlJztcbiAgICAgIHNjcmlwdEVsLnNldEF0dHJpYnV0ZSgnY3Jvc3NvcmlnaW4nLCB0cnVlKTtcblxuICAgICAgLy8gSWYgQ1NQIG5vbmNlcyBhcmUgdXNlZCwgcHJvcGFnYXRlIHRoZW0gdG8gZHluYW1pY2FsbHkgY3JlYXRlZCBzY3JpcHRzLlxuICAgICAgLy8gVGhpcyBpcyBuZWNlc3NhcnkgdG8gYWxsb3cgbm9uY2UtYmFzZWQgQ1NQcyB3aXRob3V0ICdzdHJpY3QtZHluYW1pYycuXG4gICAgICB2YXIgbm9uY2UgPSBnb29nLmdldFNjcmlwdE5vbmNlKCk7XG4gICAgICBpZiAobm9uY2UpIHtcbiAgICAgICAgc2NyaXB0RWwubm9uY2UgPSBub25jZTtcbiAgICAgIH1cblxuICAgICAgaWYgKGNvbnRlbnRzKSB7XG4gICAgICAgIHNjcmlwdEVsLnRleHQgPSBnb29nLlRSVVNURURfVFlQRVNfUE9MSUNZXyA/XG4gICAgICAgICAgICBnb29nLlRSVVNURURfVFlQRVNfUE9MSUNZXy5jcmVhdGVTY3JpcHQoY29udGVudHMpIDpcbiAgICAgICAgICAgIGNvbnRlbnRzO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgc2NyaXB0RWwuc3JjID0gZ29vZy5UUlVTVEVEX1RZUEVTX1BPTElDWV8gP1xuICAgICAgICAgICAgZ29vZy5UUlVTVEVEX1RZUEVTX1BPTElDWV8uY3JlYXRlU2NyaXB0VVJMKHNyYykgOlxuICAgICAgICAgICAgc3JjO1xuICAgICAgfVxuXG4gICAgICBkb2MuaGVhZC5hcHBlbmRDaGlsZChzY3JpcHRFbCk7XG4gICAgfVxuXG4gICAgdmFyIGNyZWF0ZTtcblxuICAgIGlmIChnb29nLmlzRG9jdW1lbnRMb2FkaW5nXygpKSB7XG4gICAgICBjcmVhdGUgPSB3cml0ZTtcbiAgICAgIC8vIFdlIGNhbiBPTkxZIGNhbGwgZG9jdW1lbnQud3JpdGUgaWYgd2UgYXJlIGd1YXJhbnRlZWQgdGhhdCBhbnlcbiAgICAgIC8vIG5vbi1tb2R1bGUgc2NyaXB0IHRhZ3MgZG9jdW1lbnQud3JpdHRlbiBhZnRlciB0aGlzIGFyZSBkZWZlcnJlZC5cbiAgICAgIC8vIFNtYWxsIG9wdGltaXphdGlvbiwgaW4gdGhlb3J5IGRvY3VtZW50LndyaXRpbmcgaXMgZmFzdGVyLlxuICAgICAgZ29vZy5EZXBlbmRlbmN5LmRlZmVyXyA9IHRydWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNyZWF0ZSA9IGFwcGVuZDtcbiAgICB9XG5cbiAgICAvLyBXcml0ZSA0IHNlcGFyYXRlIHRhZ3MgaGVyZTpcbiAgICAvLyAxKSBTZXRzIHRoZSBtb2R1bGUgc3RhdGUgYXQgdGhlIGNvcnJlY3QgdGltZSAoanVzdCBiZWZvcmUgZXhlY3V0aW9uKS5cbiAgICAvLyAyKSBBIHNyYyBub2RlIGZvciB0aGlzLCB3aGljaCBqdXN0IGhvcGVmdWxseSBsZXRzIHRoZSBicm93c2VyIGxvYWQgaXQgYVxuICAgIC8vICAgIGxpdHRsZSBlYXJseSAobm8gbmVlZCB0byBwYXJzZSAjMykuXG4gICAgLy8gMykgSW1wb3J0IHRoZSBtb2R1bGUgYW5kIHJlZ2lzdGVyIGl0LlxuICAgIC8vIDQpIENsZWFyIHRoZSBtb2R1bGUgc3RhdGUgYXQgdGhlIGNvcnJlY3QgdGltZS4gR3VhcmFudGVlZCB0byBydW4gZXZlblxuICAgIC8vICAgIGlmIHRoZXJlIGlzIGFuIGVycm9yIGluIHRoZSBtb2R1bGUgKCMzIHdpbGwgbm90IHJ1biBpZiB0aGVyZSBpcyBhblxuICAgIC8vICAgIGVycm9yIGluIHRoZSBtb2R1bGUpLlxuICAgIHZhciBiZWZvcmVLZXkgPSBnb29nLkRlcGVuZGVuY3kucmVnaXN0ZXJDYWxsYmFja18oZnVuY3Rpb24oKSB7XG4gICAgICBnb29nLkRlcGVuZGVuY3kudW5yZWdpc3RlckNhbGxiYWNrXyhiZWZvcmVLZXkpO1xuICAgICAgY29udHJvbGxlci5zZXRNb2R1bGVTdGF0ZShnb29nLk1vZHVsZVR5cGUuRVM2KTtcbiAgICB9KTtcbiAgICBjcmVhdGUodW5kZWZpbmVkLCAnZ29vZy5EZXBlbmRlbmN5LmNhbGxiYWNrXyhcIicgKyBiZWZvcmVLZXkgKyAnXCIpJyk7XG5cbiAgICAvLyBUT0RPKGpvaG5wbGFpc3RlZCk6IERvZXMgdGhpcyByZWFsbHkgc3BlZWQgdXAgYW55dGhpbmc/XG4gICAgY3JlYXRlKHRoaXMucGF0aCwgdW5kZWZpbmVkKTtcblxuICAgIHZhciByZWdpc3RlcktleSA9IGdvb2cuRGVwZW5kZW5jeS5yZWdpc3RlckNhbGxiYWNrXyhmdW5jdGlvbihleHBvcnRzKSB7XG4gICAgICBnb29nLkRlcGVuZGVuY3kudW5yZWdpc3RlckNhbGxiYWNrXyhyZWdpc3RlcktleSk7XG4gICAgICBjb250cm9sbGVyLnJlZ2lzdGVyRXM2TW9kdWxlRXhwb3J0cyhcbiAgICAgICAgICBkZXAucGF0aCwgZXhwb3J0cywgZ29vZy5tb2R1bGVMb2FkZXJTdGF0ZV8ubW9kdWxlTmFtZSk7XG4gICAgfSk7XG4gICAgY3JlYXRlKFxuICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICdpbXBvcnQgKiBhcyBtIGZyb20gXCInICsgdGhpcy5wYXRoICsgJ1wiOyBnb29nLkRlcGVuZGVuY3kuY2FsbGJhY2tfKFwiJyArXG4gICAgICAgICAgICByZWdpc3RlcktleSArICdcIiwgbSknKTtcblxuICAgIHZhciBhZnRlcktleSA9IGdvb2cuRGVwZW5kZW5jeS5yZWdpc3RlckNhbGxiYWNrXyhmdW5jdGlvbigpIHtcbiAgICAgIGdvb2cuRGVwZW5kZW5jeS51bnJlZ2lzdGVyQ2FsbGJhY2tfKGFmdGVyS2V5KTtcbiAgICAgIGNvbnRyb2xsZXIuY2xlYXJNb2R1bGVTdGF0ZSgpO1xuICAgICAgY29udHJvbGxlci5sb2FkZWQoKTtcbiAgICB9KTtcbiAgICBjcmVhdGUodW5kZWZpbmVkLCAnZ29vZy5EZXBlbmRlbmN5LmNhbGxiYWNrXyhcIicgKyBhZnRlcktleSArICdcIiknKTtcbiAgfTtcblxuXG4gIC8qKlxuICAgKiBTdXBlcmNsYXNzIG9mIGFueSBkZXBlbmRlbmN5IHRoYXQgbmVlZHMgdG8gYmUgbG9hZGVkIGludG8gbWVtb3J5LFxuICAgKiB0cmFuc2Zvcm1lZCwgYW5kIHRoZW4gZXZhbCdkIChnb29nLm1vZHVsZXMgYW5kIHRyYW5zcGlsZWQgZmlsZXMpLlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gcGF0aCBBYnNvbHV0ZSBwYXRoIG9mIHRoaXMgc2NyaXB0LlxuICAgKiBAcGFyYW0ge3N0cmluZ30gcmVsYXRpdmVQYXRoIFBhdGggb2YgdGhpcyBzY3JpcHQgcmVsYXRpdmUgdG8gZ29vZy5iYXNlUGF0aC5cbiAgICogQHBhcmFtIHshQXJyYXk8c3RyaW5nPn0gcHJvdmlkZXMgZ29vZy5wcm92aWRlZCBvciBnb29nLm1vZHVsZSBzeW1ib2xzXG4gICAqICAgICBpbiB0aGlzIGZpbGUuXG4gICAqIEBwYXJhbSB7IUFycmF5PHN0cmluZz59IHJlcXVpcmVzIGdvb2cgc3ltYm9scyBvciByZWxhdGl2ZSBwYXRocyB0byBDbG9zdXJlXG4gICAqICAgICB0aGlzIGRlcGVuZHMgb24uXG4gICAqIEBwYXJhbSB7IU9iamVjdDxzdHJpbmcsIHN0cmluZz59IGxvYWRGbGFnc1xuICAgKiBAc3RydWN0IEBjb25zdHJ1Y3RvciBAYWJzdHJhY3RcbiAgICogQGV4dGVuZHMge2dvb2cuRGVwZW5kZW5jeX1cbiAgICovXG4gIGdvb2cuVHJhbnNmb3JtZWREZXBlbmRlbmN5ID0gZnVuY3Rpb24oXG4gICAgICBwYXRoLCByZWxhdGl2ZVBhdGgsIHByb3ZpZGVzLCByZXF1aXJlcywgbG9hZEZsYWdzKSB7XG4gICAgZ29vZy5UcmFuc2Zvcm1lZERlcGVuZGVuY3kuYmFzZShcbiAgICAgICAgdGhpcywgJ2NvbnN0cnVjdG9yJywgcGF0aCwgcmVsYXRpdmVQYXRoLCBwcm92aWRlcywgcmVxdWlyZXMsIGxvYWRGbGFncyk7XG4gICAgLyoqIEBwcml2YXRlIHs/c3RyaW5nfSAqL1xuICAgIHRoaXMuY29udGVudHNfID0gbnVsbDtcblxuICAgIC8qKlxuICAgICAqIFdoZXRoZXIgdG8gbGF6aWx5IG1ha2UgdGhlIHN5bmNocm9ub3VzIFhIUiAod2hlbiBnb29nLnJlcXVpcmUnZCkgb3IgbWFrZVxuICAgICAqIHRoZSBzeW5jaHJvbm91cyBYSFIgd2hlbiBpbml0aWFsbHkgbG9hZGluZy4gT24gRmlyZUZveCA2MSB0aGVyZSBpcyBhIGJ1Z1xuICAgICAqIHdoZXJlIGFuIEVTNiBtb2R1bGUgY2Fubm90IG1ha2UgYSBzeW5jaHJvbm91cyBYSFIgKHJhdGhlciwgaXQgY2FuLCBidXQgaWZcbiAgICAgKiBpdCBkb2VzIHRoZW4gbm8gb3RoZXIgRVM2IG1vZHVsZXMgd2lsbCBsb2FkIGFmdGVyKS5cbiAgICAgKlxuICAgICAqIHRsO2RyIHdlIGxhenkgbG9hZCBkdWUgdG8gYnVncyBvbiBvbGRlciBicm93c2VycyBhbmQgZWFnZXIgbG9hZCBkdWUgdG9cbiAgICAgKiBidWdzIG9uIG5ld2VyIG9uZXMuXG4gICAgICpcbiAgICAgKiBodHRwczovL2J1Z3ppbGxhLm1vemlsbGEub3JnL3Nob3dfYnVnLmNnaT9pZD0xNDc3MDkwXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZSBAY29uc3Qge2Jvb2xlYW59XG4gICAgICovXG4gICAgdGhpcy5sYXp5RmV0Y2hfID0gIWdvb2cuaW5IdG1sRG9jdW1lbnRfKCkgfHxcbiAgICAgICAgISgnbm9Nb2R1bGUnIGluIGdvb2cuZ2xvYmFsLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpKTtcbiAgfTtcbiAgZ29vZy5pbmhlcml0cyhnb29nLlRyYW5zZm9ybWVkRGVwZW5kZW5jeSwgZ29vZy5EZXBlbmRlbmN5KTtcblxuXG4gIC8qKlxuICAgKiBAb3ZlcnJpZGVcbiAgICogQHBhcmFtIHshZ29vZy5Mb2FkQ29udHJvbGxlcn0gY29udHJvbGxlclxuICAgKi9cbiAgZ29vZy5UcmFuc2Zvcm1lZERlcGVuZGVuY3kucHJvdG90eXBlLmxvYWQgPSBmdW5jdGlvbihjb250cm9sbGVyKSB7XG4gICAgdmFyIGRlcCA9IHRoaXM7XG5cbiAgICBmdW5jdGlvbiBmZXRjaCgpIHtcbiAgICAgIGRlcC5jb250ZW50c18gPSBnb29nLmxvYWRGaWxlU3luY18oZGVwLnBhdGgpO1xuXG4gICAgICBpZiAoZGVwLmNvbnRlbnRzXykge1xuICAgICAgICBkZXAuY29udGVudHNfID0gZGVwLnRyYW5zZm9ybShkZXAuY29udGVudHNfKTtcbiAgICAgICAgaWYgKGRlcC5jb250ZW50c18pIHtcbiAgICAgICAgICBkZXAuY29udGVudHNfICs9ICdcXG4vLyMgc291cmNlVVJMPScgKyBkZXAucGF0aDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChnb29nLmdsb2JhbC5DTE9TVVJFX0lNUE9SVF9TQ1JJUFQpIHtcbiAgICAgIGZldGNoKCk7XG4gICAgICBpZiAodGhpcy5jb250ZW50c18gJiZcbiAgICAgICAgICBnb29nLmdsb2JhbC5DTE9TVVJFX0lNUE9SVF9TQ1JJUFQoJycsIHRoaXMuY29udGVudHNfKSkge1xuICAgICAgICB0aGlzLmNvbnRlbnRzXyA9IG51bGw7XG4gICAgICAgIGNvbnRyb2xsZXIubG9hZGVkKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb250cm9sbGVyLnBhdXNlKCk7XG4gICAgICB9XG4gICAgICByZXR1cm47XG4gICAgfVxuXG5cbiAgICB2YXIgaXNFczYgPSB0aGlzLmxvYWRGbGFnc1snbW9kdWxlJ10gPT0gZ29vZy5Nb2R1bGVUeXBlLkVTNjtcblxuICAgIGlmICghdGhpcy5sYXp5RmV0Y2hfKSB7XG4gICAgICBmZXRjaCgpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGxvYWQoKSB7XG4gICAgICBpZiAoZGVwLmxhenlGZXRjaF8pIHtcbiAgICAgICAgZmV0Y2goKTtcbiAgICAgIH1cblxuICAgICAgaWYgKCFkZXAuY29udGVudHNfKSB7XG4gICAgICAgIC8vIGxvYWRGaWxlU3luY18gb3IgdHJhbnNmb3JtIGFyZSByZXNwb25zaWJsZS4gQXNzdW1lIHRoZXkgbG9nZ2VkIGFuXG4gICAgICAgIC8vIGVycm9yLlxuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGlmIChpc0VzNikge1xuICAgICAgICBjb250cm9sbGVyLnNldE1vZHVsZVN0YXRlKGdvb2cuTW9kdWxlVHlwZS5FUzYpO1xuICAgICAgfVxuXG4gICAgICB2YXIgbmFtZXNwYWNlO1xuXG4gICAgICB0cnkge1xuICAgICAgICB2YXIgY29udGVudHMgPSBkZXAuY29udGVudHNfO1xuICAgICAgICBkZXAuY29udGVudHNfID0gbnVsbDtcbiAgICAgICAgZ29vZy5nbG9iYWxFdmFsKGdvb2cuQ0xPU1VSRV9FVkFMX1BSRUZJTFRFUl8uY3JlYXRlU2NyaXB0KGNvbnRlbnRzKSk7XG4gICAgICAgIGlmIChpc0VzNikge1xuICAgICAgICAgIG5hbWVzcGFjZSA9IGdvb2cubW9kdWxlTG9hZGVyU3RhdGVfLm1vZHVsZU5hbWU7XG4gICAgICAgIH1cbiAgICAgIH0gZmluYWxseSB7XG4gICAgICAgIGlmIChpc0VzNikge1xuICAgICAgICAgIGNvbnRyb2xsZXIuY2xlYXJNb2R1bGVTdGF0ZSgpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmIChpc0VzNikge1xuICAgICAgICAvLyBEdWUgdG8gY2lyY3VsYXIgZGVwZW5kZW5jaWVzIHRoaXMgbWF5IG5vdCBiZSBhdmFpbGFibGUgZm9yIHJlcXVpcmVcbiAgICAgICAgLy8gcmlnaHQgbm93LlxuICAgICAgICBnb29nLmdsb2JhbFsnJGpzY29tcCddWydyZXF1aXJlJ11bJ2Vuc3VyZSddKFxuICAgICAgICAgICAgW2RlcC5nZXRQYXRoTmFtZSgpXSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgIGNvbnRyb2xsZXIucmVnaXN0ZXJFczZNb2R1bGVFeHBvcnRzKFxuICAgICAgICAgICAgICAgICAgZGVwLnBhdGgsXG4gICAgICAgICAgICAgICAgICBnb29nLmdsb2JhbFsnJGpzY29tcCddWydyZXF1aXJlJ10oZGVwLmdldFBhdGhOYW1lKCkpLFxuICAgICAgICAgICAgICAgICAgbmFtZXNwYWNlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBjb250cm9sbGVyLmxvYWRlZCgpO1xuICAgIH1cblxuICAgIC8vIERvIG5vdCBmZXRjaCBub3c7IGluIEZpcmVGb3ggNDcgdGhlIHN5bmNocm9ub3VzIFhIUiBkb2Vzbid0IGJsb2NrIGFsbFxuICAgIC8vIGV2ZW50cy4gSWYgd2UgZmV0Y2hlZCBub3cgYW5kIHRoZW4gZG9jdW1lbnQud3JpdGUnZCB0aGUgY29udGVudHMgdGhlXG4gICAgLy8gZG9jdW1lbnQud3JpdGUgd291bGQgYmUgYW4gZXZhbCBhbmQgd291bGQgZXhlY3V0ZSB0b28gc29vbiEgSW5zdGVhZCB3cml0ZVxuICAgIC8vIGEgc2NyaXB0IHRhZyB0byBmZXRjaCBhbmQgZXZhbCBzeW5jaHJvbm91c2x5IGF0IHRoZSBjb3JyZWN0IHRpbWUuXG4gICAgZnVuY3Rpb24gZmV0Y2hJbk93blNjcmlwdFRoZW5Mb2FkKCkge1xuICAgICAgLyoqIEB0eXBlIHshSFRNTERvY3VtZW50fSAqL1xuICAgICAgdmFyIGRvYyA9IGdvb2cuZ2xvYmFsLmRvY3VtZW50O1xuXG4gICAgICB2YXIga2V5ID0gZ29vZy5EZXBlbmRlbmN5LnJlZ2lzdGVyQ2FsbGJhY2tfKGZ1bmN0aW9uKCkge1xuICAgICAgICBnb29nLkRlcGVuZGVuY3kudW5yZWdpc3RlckNhbGxiYWNrXyhrZXkpO1xuICAgICAgICBsb2FkKCk7XG4gICAgICB9KTtcblxuICAgICAgdmFyIG5vbmNlID0gZ29vZy5nZXRTY3JpcHROb25jZSgpO1xuICAgICAgdmFyIG5vbmNlQXR0ciA9IG5vbmNlID8gJyBub25jZT1cIicgKyBub25jZSArICdcIicgOiAnJztcbiAgICAgIHZhciBzY3JpcHQgPSAnPHNjcmlwdCcgKyBub25jZUF0dHIgKyAnPicgK1xuICAgICAgICAgIGdvb2cucHJvdGVjdFNjcmlwdFRhZ18oJ2dvb2cuRGVwZW5kZW5jeS5jYWxsYmFja18oXCInICsga2V5ICsgJ1wiKTsnKSArXG4gICAgICAgICAgJzwvJyArXG4gICAgICAgICAgJ3NjcmlwdD4nO1xuICAgICAgZG9jLndyaXRlKFxuICAgICAgICAgIGdvb2cuVFJVU1RFRF9UWVBFU19QT0xJQ1lfID9cbiAgICAgICAgICAgICAgZ29vZy5UUlVTVEVEX1RZUEVTX1BPTElDWV8uY3JlYXRlSFRNTChzY3JpcHQpIDpcbiAgICAgICAgICAgICAgc2NyaXB0KTtcbiAgICB9XG5cbiAgICAvLyBJZiBvbmUgdGhpbmcgaXMgcGVuZGluZyBpdCBpcyB0aGlzLlxuICAgIHZhciBhbnl0aGluZ0Vsc2VQZW5kaW5nID0gY29udHJvbGxlci5wZW5kaW5nKCkubGVuZ3RoID4gMTtcblxuICAgIC8vIElmIGFueXRoaW5nIGVsc2UgaXMgbG9hZGluZyB3ZSBuZWVkIHRvIGxhenkgbG9hZCBkdWUgdG8gYnVncyBpbiBvbGQgSUUuXG4gICAgLy8gU3BlY2lmaWNhbGx5IHNjcmlwdCB0YWdzIHdpdGggc3JjIGFuZCBzY3JpcHQgdGFncyB3aXRoIGNvbnRlbnRzIGNvdWxkXG4gICAgLy8gZXhlY3V0ZSBvdXQgb2Ygb3JkZXIgaWYgZG9jdW1lbnQud3JpdGUgaXMgdXNlZCwgc28gd2UgY2Fubm90IHVzZVxuICAgIC8vIGRvY3VtZW50LndyaXRlLiBEbyBub3QgcGF1c2UgaGVyZTsgaXQgYnJlYWtzIG9sZCBJRSBhcyB3ZWxsLlxuICAgIHZhciB1c2VPbGRJZVdvcmtBcm91bmQgPVxuICAgICAgICBhbnl0aGluZ0Vsc2VQZW5kaW5nICYmIGdvb2cuRGVidWdMb2FkZXJfLklTX09MRF9JRV87XG5cbiAgICAvLyBBZGRpdGlvbmFsbHkgaWYgd2UgYXJlIG1lYW50IHRvIGRlZmVyIHNjcmlwdHMgYnV0IHRoZSBwYWdlIGlzIHN0aWxsXG4gICAgLy8gbG9hZGluZyAoZS5nLiBhbiBFUzYgbW9kdWxlIGlzIGxvYWRpbmcpIHRoZW4gYWxzbyBkZWZlci4gT3IgaWYgd2UgYXJlXG4gICAgLy8gbWVhbnQgdG8gZGVmZXIgYW5kIGFueXRoaW5nIGVsc2UgaXMgcGVuZGluZyB0aGVuIGRlZmVyICh0aG9zZSBtYXkgYmVcbiAgICAvLyBzY3JpcHRzIHRoYXQgZGlkIG5vdCBuZWVkIHRyYW5zZm9ybWF0aW9uIGFuZCBhcmUganVzdCBzY3JpcHQgdGFncyB3aXRoXG4gICAgLy8gZGVmZXIgc2V0IHRvIHRydWUsIGFuZCB3ZSBuZWVkIHRvIGV2YWx1YXRlIGFmdGVyIHRoYXQgZGVmZXJyZWQgc2NyaXB0KS5cbiAgICB2YXIgbmVlZHNBc3luY0xvYWRpbmcgPSBnb29nLkRlcGVuZGVuY3kuZGVmZXJfICYmXG4gICAgICAgIChhbnl0aGluZ0Vsc2VQZW5kaW5nIHx8IGdvb2cuaXNEb2N1bWVudExvYWRpbmdfKCkpO1xuXG4gICAgaWYgKHVzZU9sZEllV29ya0Fyb3VuZCB8fCBuZWVkc0FzeW5jTG9hZGluZykge1xuICAgICAgLy8gTm90ZSB0aGF0IHdlIG9ubHkgZGVmZXIgd2hlbiB3ZSBoYXZlIHRvIHJhdGhlciB0aGFuIDEwMCUgb2YgdGhlIHRpbWUuXG4gICAgICAvLyBBbHdheXMgZGVmZXJpbmcgd291bGQgd29yaywgYnV0IHRoZW4gaW4gdGhlb3J5IHRoZSBvcmRlciBvZlxuICAgICAgLy8gZ29vZy5yZXF1aXJlIGNhbGxzIHdvdWxkIHRoZW4gbWF0dGVyLiBXZSB3YW50IHRvIGVuZm9yY2UgdGhhdCBtb3N0IG9mXG4gICAgICAvLyB0aGUgdGltZSB0aGUgb3JkZXIgb2YgdGhlIHJlcXVpcmUgY2FsbHMgZG9lcyBub3QgbWF0dGVyLlxuICAgICAgY29udHJvbGxlci5kZWZlcihmdW5jdGlvbigpIHtcbiAgICAgICAgbG9hZCgpO1xuICAgICAgfSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIC8vIFRPRE8oam9obnBsYWlzdGVkKTogRXh0ZXJucyBhcmUgbWlzc2luZyBvbnJlYWR5c3RhdGVjaGFuZ2UgZm9yXG4gICAgLy8gSFRNTERvY3VtZW50LlxuICAgIC8qKiBAdHlwZSB7P30gKi9cbiAgICB2YXIgZG9jID0gZ29vZy5nbG9iYWwuZG9jdW1lbnQ7XG5cbiAgICB2YXIgaXNJbnRlcm5ldEV4cGxvcmVyT3JFZGdlID0gZ29vZy5pbkh0bWxEb2N1bWVudF8oKSAmJlxuICAgICAgICAoJ0FjdGl2ZVhPYmplY3QnIGluIGdvb2cuZ2xvYmFsIHx8IGdvb2cuaXNFZGdlXygpKTtcblxuICAgIC8vIERvbid0IGRlbGF5IGluIGFueSB2ZXJzaW9uIG9mIElFIG9yIHByZS1DaHJvbWl1bSBFZGdlLiBUaGVyZSdzIGEgYnVnXG4gICAgLy8gYXJvdW5kIHRoaXMgdGhhdCB3aWxsIGNhdXNlIG91dCBvZiBvcmRlciBzY3JpcHQgZXhlY3V0aW9uLiBUaGlzIG1lYW5zXG4gICAgLy8gdGhhdCBvbiBvbGRlciBJRSBFUzYgbW9kdWxlcyB3aWxsIGxvYWQgdG9vIGVhcmx5ICh3aGlsZSB0aGUgZG9jdW1lbnQgaXNcbiAgICAvLyBzdGlsbCBsb2FkaW5nICsgdGhlIGRvbSBpcyBub3QgYXZhaWxhYmxlKS4gVGhlIG90aGVyIG9wdGlvbiBpcyB0byBsb2FkXG4gICAgLy8gdG9vIGxhdGUgKHdoZW4gdGhlIGRvY3VtZW50IGlzIGNvbXBsZXRlIGFuZCB0aGUgb25sb2FkIGV2ZW4gd2lsbCBuZXZlclxuICAgIC8vIGZpcmUpLiBUaGlzIHNlZW1zIHRvIGJlIHRoZSBsZXNzZXIgb2YgdHdvIGV2aWxzIGFzIHNjcmlwdHMgYWxyZWFkeSBhY3RcbiAgICAvLyBsaWtlIHRoZSBmb3JtZXIuXG4gICAgaWYgKGlzRXM2ICYmIGdvb2cuaW5IdG1sRG9jdW1lbnRfKCkgJiYgZ29vZy5pc0RvY3VtZW50TG9hZGluZ18oKSAmJlxuICAgICAgICAhaXNJbnRlcm5ldEV4cGxvcmVyT3JFZGdlKSB7XG4gICAgICBnb29nLkRlcGVuZGVuY3kuZGVmZXJfID0gdHJ1ZTtcbiAgICAgIC8vIFRyYW5zcGlsZWQgRVM2IG1vZHVsZXMgc3RpbGwgbmVlZCB0byBsb2FkIGxpa2UgcmVndWxhciBFUzYgbW9kdWxlcyxcbiAgICAgIC8vIGFrYSBvbmx5IGFmdGVyIHRoZSBkb2N1bWVudCBpcyBpbnRlcmFjdGl2ZS5cbiAgICAgIGNvbnRyb2xsZXIucGF1c2UoKTtcbiAgICAgIHZhciBvbGRDYWxsYmFjayA9IGRvYy5vbnJlYWR5c3RhdGVjaGFuZ2U7XG4gICAgICBkb2Mub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmIChkb2MucmVhZHlTdGF0ZSA9PSAnaW50ZXJhY3RpdmUnKSB7XG4gICAgICAgICAgZG9jLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IG9sZENhbGxiYWNrO1xuICAgICAgICAgIGxvYWQoKTtcbiAgICAgICAgICBjb250cm9sbGVyLnJlc3VtZSgpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0eXBlb2Ygb2xkQ2FsbGJhY2sgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICBvbGRDYWxsYmFjay5hcHBseSh1bmRlZmluZWQsIGFyZ3VtZW50cyk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIEFsd2F5cyBldmFsIG9uIG9sZCBJRS5cbiAgICAgIGlmIChnb29nLkRlYnVnTG9hZGVyXy5JU19PTERfSUVfIHx8ICFnb29nLmluSHRtbERvY3VtZW50XygpIHx8XG4gICAgICAgICAgIWdvb2cuaXNEb2N1bWVudExvYWRpbmdfKCkpIHtcbiAgICAgICAgbG9hZCgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZmV0Y2hJbk93blNjcmlwdFRoZW5Mb2FkKCk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG5cbiAgLyoqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBjb250ZW50c1xuICAgKiBAcmV0dXJuIHtzdHJpbmd9XG4gICAqIEBhYnN0cmFjdFxuICAgKi9cbiAgZ29vZy5UcmFuc2Zvcm1lZERlcGVuZGVuY3kucHJvdG90eXBlLnRyYW5zZm9ybSA9IGZ1bmN0aW9uKGNvbnRlbnRzKSB7fTtcblxuXG4gIC8qKlxuICAgKiBBbnkgbm9uLWdvb2cubW9kdWxlIGRlcGVuZGVuY3kgd2hpY2ggbmVlZHMgdG8gYmUgdHJhbnNwaWxlZCBiZWZvcmUgZXZhbC5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IHBhdGggQWJzb2x1dGUgcGF0aCBvZiB0aGlzIHNjcmlwdC5cbiAgICogQHBhcmFtIHtzdHJpbmd9IHJlbGF0aXZlUGF0aCBQYXRoIG9mIHRoaXMgc2NyaXB0IHJlbGF0aXZlIHRvIGdvb2cuYmFzZVBhdGguXG4gICAqIEBwYXJhbSB7IUFycmF5PHN0cmluZz59IHByb3ZpZGVzIGdvb2cucHJvdmlkZWQgb3IgZ29vZy5tb2R1bGUgc3ltYm9sc1xuICAgKiAgICAgaW4gdGhpcyBmaWxlLlxuICAgKiBAcGFyYW0geyFBcnJheTxzdHJpbmc+fSByZXF1aXJlcyBnb29nIHN5bWJvbHMgb3IgcmVsYXRpdmUgcGF0aHMgdG8gQ2xvc3VyZVxuICAgKiAgICAgdGhpcyBkZXBlbmRzIG9uLlxuICAgKiBAcGFyYW0geyFPYmplY3Q8c3RyaW5nLCBzdHJpbmc+fSBsb2FkRmxhZ3NcbiAgICogQHBhcmFtIHshZ29vZy5UcmFuc3BpbGVyfSB0cmFuc3BpbGVyXG4gICAqIEBzdHJ1Y3QgQGNvbnN0cnVjdG9yXG4gICAqIEBleHRlbmRzIHtnb29nLlRyYW5zZm9ybWVkRGVwZW5kZW5jeX1cbiAgICovXG4gIGdvb2cuVHJhbnNwaWxlZERlcGVuZGVuY3kgPSBmdW5jdGlvbihcbiAgICAgIHBhdGgsIHJlbGF0aXZlUGF0aCwgcHJvdmlkZXMsIHJlcXVpcmVzLCBsb2FkRmxhZ3MsIHRyYW5zcGlsZXIpIHtcbiAgICBnb29nLlRyYW5zcGlsZWREZXBlbmRlbmN5LmJhc2UoXG4gICAgICAgIHRoaXMsICdjb25zdHJ1Y3RvcicsIHBhdGgsIHJlbGF0aXZlUGF0aCwgcHJvdmlkZXMsIHJlcXVpcmVzLCBsb2FkRmxhZ3MpO1xuICAgIC8qKiBAcHJvdGVjdGVkIEBjb25zdCovXG4gICAgdGhpcy50cmFuc3BpbGVyID0gdHJhbnNwaWxlcjtcbiAgfTtcbiAgZ29vZy5pbmhlcml0cyhnb29nLlRyYW5zcGlsZWREZXBlbmRlbmN5LCBnb29nLlRyYW5zZm9ybWVkRGVwZW5kZW5jeSk7XG5cblxuICAvKipcbiAgICogQG92ZXJyaWRlXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBjb250ZW50c1xuICAgKiBAcmV0dXJuIHtzdHJpbmd9XG4gICAqL1xuICBnb29nLlRyYW5zcGlsZWREZXBlbmRlbmN5LnByb3RvdHlwZS50cmFuc2Zvcm0gPSBmdW5jdGlvbihjb250ZW50cykge1xuICAgIC8vIFRyYW5zcGlsZSB3aXRoIHRoZSBwYXRobmFtZSBzbyB0aGF0IEVTNiBtb2R1bGVzIGFyZSBkb21haW4gYWdub3N0aWMuXG4gICAgcmV0dXJuIHRoaXMudHJhbnNwaWxlci50cmFuc3BpbGUoY29udGVudHMsIHRoaXMuZ2V0UGF0aE5hbWUoKSk7XG4gIH07XG5cblxuICAvKipcbiAgICogQW4gRVM2IG1vZHVsZSBkZXBlbmRlbmN5IHRoYXQgd2FzIHRyYW5zcGlsZWQgdG8gYSBqc2NvbXAgbW9kdWxlIG91dHNpZGVcbiAgICogb2YgdGhlIGRlYnVnIGxvYWRlciwgZS5nLiBzZXJ2ZXIgc2lkZS5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IHBhdGggQWJzb2x1dGUgcGF0aCBvZiB0aGlzIHNjcmlwdC5cbiAgICogQHBhcmFtIHtzdHJpbmd9IHJlbGF0aXZlUGF0aCBQYXRoIG9mIHRoaXMgc2NyaXB0IHJlbGF0aXZlIHRvIGdvb2cuYmFzZVBhdGguXG4gICAqIEBwYXJhbSB7IUFycmF5PHN0cmluZz59IHByb3ZpZGVzIGdvb2cucHJvdmlkZWQgb3IgZ29vZy5tb2R1bGUgc3ltYm9sc1xuICAgKiAgICAgaW4gdGhpcyBmaWxlLlxuICAgKiBAcGFyYW0geyFBcnJheTxzdHJpbmc+fSByZXF1aXJlcyBnb29nIHN5bWJvbHMgb3IgcmVsYXRpdmUgcGF0aHMgdG8gQ2xvc3VyZVxuICAgKiAgICAgdGhpcyBkZXBlbmRzIG9uLlxuICAgKiBAcGFyYW0geyFPYmplY3Q8c3RyaW5nLCBzdHJpbmc+fSBsb2FkRmxhZ3NcbiAgICogQHN0cnVjdCBAY29uc3RydWN0b3JcbiAgICogQGV4dGVuZHMge2dvb2cuVHJhbnNmb3JtZWREZXBlbmRlbmN5fVxuICAgKi9cbiAgZ29vZy5QcmVUcmFuc3BpbGVkRXM2TW9kdWxlRGVwZW5kZW5jeSA9IGZ1bmN0aW9uKFxuICAgICAgcGF0aCwgcmVsYXRpdmVQYXRoLCBwcm92aWRlcywgcmVxdWlyZXMsIGxvYWRGbGFncykge1xuICAgIGdvb2cuUHJlVHJhbnNwaWxlZEVzNk1vZHVsZURlcGVuZGVuY3kuYmFzZShcbiAgICAgICAgdGhpcywgJ2NvbnN0cnVjdG9yJywgcGF0aCwgcmVsYXRpdmVQYXRoLCBwcm92aWRlcywgcmVxdWlyZXMsIGxvYWRGbGFncyk7XG4gIH07XG4gIGdvb2cuaW5oZXJpdHMoXG4gICAgICBnb29nLlByZVRyYW5zcGlsZWRFczZNb2R1bGVEZXBlbmRlbmN5LCBnb29nLlRyYW5zZm9ybWVkRGVwZW5kZW5jeSk7XG5cblxuICAvKipcbiAgICogQG92ZXJyaWRlXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBjb250ZW50c1xuICAgKiBAcmV0dXJuIHtzdHJpbmd9XG4gICAqL1xuICBnb29nLlByZVRyYW5zcGlsZWRFczZNb2R1bGVEZXBlbmRlbmN5LnByb3RvdHlwZS50cmFuc2Zvcm0gPSBmdW5jdGlvbihcbiAgICAgIGNvbnRlbnRzKSB7XG4gICAgcmV0dXJuIGNvbnRlbnRzO1xuICB9O1xuXG5cbiAgLyoqXG4gICAqIEEgZ29vZy5tb2R1bGUsIHRyYW5zcGlsZWQgb3Igbm90LiBXaWxsIGFsd2F5cyBwZXJmb3JtIHNvbWUgbWluaW1hbFxuICAgKiB0cmFuc2Zvcm1hdGlvbiBldmVuIHdoZW4gbm90IHRyYW5zcGlsZWQgdG8gd3JhcCBpbiBhIGdvb2cubG9hZE1vZHVsZVxuICAgKiBzdGF0ZW1lbnQuXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBwYXRoIEFic29sdXRlIHBhdGggb2YgdGhpcyBzY3JpcHQuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSByZWxhdGl2ZVBhdGggUGF0aCBvZiB0aGlzIHNjcmlwdCByZWxhdGl2ZSB0byBnb29nLmJhc2VQYXRoLlxuICAgKiBAcGFyYW0geyFBcnJheTxzdHJpbmc+fSBwcm92aWRlcyBnb29nLnByb3ZpZGVkIG9yIGdvb2cubW9kdWxlIHN5bWJvbHNcbiAgICogICAgIGluIHRoaXMgZmlsZS5cbiAgICogQHBhcmFtIHshQXJyYXk8c3RyaW5nPn0gcmVxdWlyZXMgZ29vZyBzeW1ib2xzIG9yIHJlbGF0aXZlIHBhdGhzIHRvIENsb3N1cmVcbiAgICogICAgIHRoaXMgZGVwZW5kcyBvbi5cbiAgICogQHBhcmFtIHshT2JqZWN0PHN0cmluZywgc3RyaW5nPn0gbG9hZEZsYWdzXG4gICAqIEBwYXJhbSB7Ym9vbGVhbn0gbmVlZHNUcmFuc3BpbGVcbiAgICogQHBhcmFtIHshZ29vZy5UcmFuc3BpbGVyfSB0cmFuc3BpbGVyXG4gICAqIEBzdHJ1Y3QgQGNvbnN0cnVjdG9yXG4gICAqIEBleHRlbmRzIHtnb29nLlRyYW5zZm9ybWVkRGVwZW5kZW5jeX1cbiAgICovXG4gIGdvb2cuR29vZ01vZHVsZURlcGVuZGVuY3kgPSBmdW5jdGlvbihcbiAgICAgIHBhdGgsIHJlbGF0aXZlUGF0aCwgcHJvdmlkZXMsIHJlcXVpcmVzLCBsb2FkRmxhZ3MsIG5lZWRzVHJhbnNwaWxlLFxuICAgICAgdHJhbnNwaWxlcikge1xuICAgIGdvb2cuR29vZ01vZHVsZURlcGVuZGVuY3kuYmFzZShcbiAgICAgICAgdGhpcywgJ2NvbnN0cnVjdG9yJywgcGF0aCwgcmVsYXRpdmVQYXRoLCBwcm92aWRlcywgcmVxdWlyZXMsIGxvYWRGbGFncyk7XG4gICAgLyoqIEBwcml2YXRlIEBjb25zdCAqL1xuICAgIHRoaXMubmVlZHNUcmFuc3BpbGVfID0gbmVlZHNUcmFuc3BpbGU7XG4gICAgLyoqIEBwcml2YXRlIEBjb25zdCAqL1xuICAgIHRoaXMudHJhbnNwaWxlcl8gPSB0cmFuc3BpbGVyO1xuICB9O1xuICBnb29nLmluaGVyaXRzKGdvb2cuR29vZ01vZHVsZURlcGVuZGVuY3ksIGdvb2cuVHJhbnNmb3JtZWREZXBlbmRlbmN5KTtcblxuXG4gIC8qKlxuICAgKiBAb3ZlcnJpZGVcbiAgICogQHBhcmFtIHtzdHJpbmd9IGNvbnRlbnRzXG4gICAqIEByZXR1cm4ge3N0cmluZ31cbiAgICovXG4gIGdvb2cuR29vZ01vZHVsZURlcGVuZGVuY3kucHJvdG90eXBlLnRyYW5zZm9ybSA9IGZ1bmN0aW9uKGNvbnRlbnRzKSB7XG4gICAgaWYgKHRoaXMubmVlZHNUcmFuc3BpbGVfKSB7XG4gICAgICBjb250ZW50cyA9IHRoaXMudHJhbnNwaWxlcl8udHJhbnNwaWxlKGNvbnRlbnRzLCB0aGlzLmdldFBhdGhOYW1lKCkpO1xuICAgIH1cblxuICAgIGlmICghZ29vZy5MT0FEX01PRFVMRV9VU0lOR19FVkFMIHx8IGdvb2cuZ2xvYmFsLkpTT04gPT09IHVuZGVmaW5lZCkge1xuICAgICAgcmV0dXJuICcnICtcbiAgICAgICAgICAnZ29vZy5sb2FkTW9kdWxlKGZ1bmN0aW9uKGV4cG9ydHMpIHsnICtcbiAgICAgICAgICAnXCJ1c2Ugc3RyaWN0XCI7JyArIGNvbnRlbnRzICtcbiAgICAgICAgICAnXFxuJyArICAvLyB0ZXJtaW5hdGUgYW55IHRyYWlsaW5nIHNpbmdsZSBsaW5lIGNvbW1lbnQuXG4gICAgICAgICAgJztyZXR1cm4gZXhwb3J0cycgK1xuICAgICAgICAgICd9KTsnICtcbiAgICAgICAgICAnXFxuLy8jIHNvdXJjZVVSTD0nICsgdGhpcy5wYXRoICsgJ1xcbic7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiAnJyArXG4gICAgICAgICAgJ2dvb2cubG9hZE1vZHVsZSgnICtcbiAgICAgICAgICBnb29nLmdsb2JhbC5KU09OLnN0cmluZ2lmeShcbiAgICAgICAgICAgICAgY29udGVudHMgKyAnXFxuLy8jIHNvdXJjZVVSTD0nICsgdGhpcy5wYXRoICsgJ1xcbicpICtcbiAgICAgICAgICAnKTsnO1xuICAgIH1cbiAgfTtcblxuXG4gIC8qKlxuICAgKiBXaGV0aGVyIHRoZSBicm93c2VyIGlzIElFOSBvciBlYXJsaWVyLCB3aGljaCBuZWVkcyBzcGVjaWFsIGhhbmRsaW5nXG4gICAqIGZvciBkZWZlcnJlZCBtb2R1bGVzLlxuICAgKiBAY29uc3QgQHByaXZhdGUge2Jvb2xlYW59XG4gICAqL1xuICBnb29nLkRlYnVnTG9hZGVyXy5JU19PTERfSUVfID0gISEoXG4gICAgICAhZ29vZy5nbG9iYWwuYXRvYiAmJiBnb29nLmdsb2JhbC5kb2N1bWVudCAmJiBnb29nLmdsb2JhbC5kb2N1bWVudFsnYWxsJ10pO1xuXG5cbiAgLyoqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSByZWxQYXRoXG4gICAqIEBwYXJhbSB7IUFycmF5PHN0cmluZz58dW5kZWZpbmVkfSBwcm92aWRlc1xuICAgKiBAcGFyYW0geyFBcnJheTxzdHJpbmc+fSByZXF1aXJlc1xuICAgKiBAcGFyYW0ge2Jvb2xlYW58IU9iamVjdDxzdHJpbmc+PX0gb3B0X2xvYWRGbGFnc1xuICAgKiBAc2VlIGdvb2cuYWRkRGVwZW5kZW5jeVxuICAgKi9cbiAgZ29vZy5EZWJ1Z0xvYWRlcl8ucHJvdG90eXBlLmFkZERlcGVuZGVuY3kgPSBmdW5jdGlvbihcbiAgICAgIHJlbFBhdGgsIHByb3ZpZGVzLCByZXF1aXJlcywgb3B0X2xvYWRGbGFncykge1xuICAgIHByb3ZpZGVzID0gcHJvdmlkZXMgfHwgW107XG4gICAgcmVsUGF0aCA9IHJlbFBhdGgucmVwbGFjZSgvXFxcXC9nLCAnLycpO1xuICAgIHZhciBwYXRoID0gZ29vZy5ub3JtYWxpemVQYXRoXyhnb29nLmJhc2VQYXRoICsgcmVsUGF0aCk7XG4gICAgaWYgKCFvcHRfbG9hZEZsYWdzIHx8IHR5cGVvZiBvcHRfbG9hZEZsYWdzID09PSAnYm9vbGVhbicpIHtcbiAgICAgIG9wdF9sb2FkRmxhZ3MgPSBvcHRfbG9hZEZsYWdzID8geydtb2R1bGUnOiBnb29nLk1vZHVsZVR5cGUuR09PR30gOiB7fTtcbiAgICB9XG4gICAgdmFyIGRlcCA9IHRoaXMuZmFjdG9yeV8uY3JlYXRlRGVwZW5kZW5jeShcbiAgICAgICAgcGF0aCwgcmVsUGF0aCwgcHJvdmlkZXMsIHJlcXVpcmVzLCBvcHRfbG9hZEZsYWdzLFxuICAgICAgICBnb29nLnRyYW5zcGlsZXJfLm5lZWRzVHJhbnNwaWxlKFxuICAgICAgICAgICAgb3B0X2xvYWRGbGFnc1snbGFuZyddIHx8ICdlczMnLCBvcHRfbG9hZEZsYWdzWydtb2R1bGUnXSkpO1xuICAgIHRoaXMuZGVwZW5kZW5jaWVzX1twYXRoXSA9IGRlcDtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHByb3ZpZGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICB0aGlzLmlkVG9QYXRoX1twcm92aWRlc1tpXV0gPSBwYXRoO1xuICAgIH1cbiAgICB0aGlzLmlkVG9QYXRoX1tyZWxQYXRoXSA9IHBhdGg7XG4gIH07XG5cblxuICAvKipcbiAgICogQ3JlYXRlcyBnb29nLkRlcGVuZGVuY3kgaW5zdGFuY2VzIGZvciB0aGUgZGVidWcgbG9hZGVyIHRvIGxvYWQuXG4gICAqXG4gICAqIFNob3VsZCBiZSBvdmVycmlkZGVuIHRvIGhhdmUgdGhlIGRlYnVnIGxvYWRlciB1c2UgY3VzdG9tIHN1YmNsYXNzZXMgb2ZcbiAgICogZ29vZy5EZXBlbmRlbmN5LlxuICAgKlxuICAgKiBAcGFyYW0geyFnb29nLlRyYW5zcGlsZXJ9IHRyYW5zcGlsZXJcbiAgICogQHN0cnVjdCBAY29uc3RydWN0b3JcbiAgICovXG4gIGdvb2cuRGVwZW5kZW5jeUZhY3RvcnkgPSBmdW5jdGlvbih0cmFuc3BpbGVyKSB7XG4gICAgLyoqIEBwcm90ZWN0ZWQgQGNvbnN0ICovXG4gICAgdGhpcy50cmFuc3BpbGVyID0gdHJhbnNwaWxlcjtcbiAgfTtcblxuXG4gIC8qKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gcGF0aCBBYnNvbHV0ZSBwYXRoIG9mIHRoZSBmaWxlLlxuICAgKiBAcGFyYW0ge3N0cmluZ30gcmVsYXRpdmVQYXRoIFBhdGggcmVsYXRpdmUgdG8gY2xvc3VyZVx1MjAxOXMgYmFzZS5qcy5cbiAgICogQHBhcmFtIHshQXJyYXk8c3RyaW5nPn0gcHJvdmlkZXMgQXJyYXkgb2YgcHJvdmlkZWQgZ29vZy5wcm92aWRlL21vZHVsZSBpZHMuXG4gICAqIEBwYXJhbSB7IUFycmF5PHN0cmluZz59IHJlcXVpcmVzIEFycmF5IG9mIHJlcXVpcmVkIGdvb2cucHJvdmlkZS9tb2R1bGUgL1xuICAgKiAgICAgcmVsYXRpdmUgRVM2IG1vZHVsZSBwYXRocy5cbiAgICogQHBhcmFtIHshT2JqZWN0PHN0cmluZywgc3RyaW5nPn0gbG9hZEZsYWdzXG4gICAqIEBwYXJhbSB7Ym9vbGVhbn0gbmVlZHNUcmFuc3BpbGUgVHJ1ZSBpZiB0aGUgZmlsZSBuZWVkcyB0byBiZSB0cmFuc3BpbGVkXG4gICAqICAgICBwZXIgdGhlIGdvb2cuVHJhbnNwaWxlci5cbiAgICogQHJldHVybiB7IWdvb2cuRGVwZW5kZW5jeX1cbiAgICovXG4gIGdvb2cuRGVwZW5kZW5jeUZhY3RvcnkucHJvdG90eXBlLmNyZWF0ZURlcGVuZGVuY3kgPSBmdW5jdGlvbihcbiAgICAgIHBhdGgsIHJlbGF0aXZlUGF0aCwgcHJvdmlkZXMsIHJlcXVpcmVzLCBsb2FkRmxhZ3MsIG5lZWRzVHJhbnNwaWxlKSB7XG5cbiAgICBpZiAobG9hZEZsYWdzWydtb2R1bGUnXSA9PSBnb29nLk1vZHVsZVR5cGUuR09PRykge1xuICAgICAgcmV0dXJuIG5ldyBnb29nLkdvb2dNb2R1bGVEZXBlbmRlbmN5KFxuICAgICAgICAgIHBhdGgsIHJlbGF0aXZlUGF0aCwgcHJvdmlkZXMsIHJlcXVpcmVzLCBsb2FkRmxhZ3MsIG5lZWRzVHJhbnNwaWxlLFxuICAgICAgICAgIHRoaXMudHJhbnNwaWxlcik7XG4gICAgfSBlbHNlIGlmIChuZWVkc1RyYW5zcGlsZSkge1xuICAgICAgcmV0dXJuIG5ldyBnb29nLlRyYW5zcGlsZWREZXBlbmRlbmN5KFxuICAgICAgICAgIHBhdGgsIHJlbGF0aXZlUGF0aCwgcHJvdmlkZXMsIHJlcXVpcmVzLCBsb2FkRmxhZ3MsIHRoaXMudHJhbnNwaWxlcik7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChsb2FkRmxhZ3NbJ21vZHVsZSddID09IGdvb2cuTW9kdWxlVHlwZS5FUzYpIHtcbiAgICAgICAgaWYgKGdvb2cuVFJBTlNQSUxFID09ICduZXZlcicgJiYgZ29vZy5BU1NVTUVfRVNfTU9EVUxFU19UUkFOU1BJTEVEKSB7XG4gICAgICAgICAgcmV0dXJuIG5ldyBnb29nLlByZVRyYW5zcGlsZWRFczZNb2R1bGVEZXBlbmRlbmN5KFxuICAgICAgICAgICAgICBwYXRoLCByZWxhdGl2ZVBhdGgsIHByb3ZpZGVzLCByZXF1aXJlcywgbG9hZEZsYWdzKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gbmV3IGdvb2cuRXM2TW9kdWxlRGVwZW5kZW5jeShcbiAgICAgICAgICAgICAgcGF0aCwgcmVsYXRpdmVQYXRoLCBwcm92aWRlcywgcmVxdWlyZXMsIGxvYWRGbGFncyk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBuZXcgZ29vZy5EZXBlbmRlbmN5KFxuICAgICAgICAgICAgcGF0aCwgcmVsYXRpdmVQYXRoLCBwcm92aWRlcywgcmVxdWlyZXMsIGxvYWRGbGFncyk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG5cbiAgLyoqIEBwcml2YXRlIEBjb25zdCAqL1xuICBnb29nLmRlYnVnTG9hZGVyXyA9IG5ldyBnb29nLkRlYnVnTG9hZGVyXygpO1xuXG5cbiAgLyoqXG4gICAqIExvYWRzIHRoZSBDbG9zdXJlIERlcGVuZGVuY3kgZmlsZS5cbiAgICpcbiAgICogRXhwb3NlZCBhIHB1YmxpYyBmdW5jdGlvbiBzbyBDTE9TVVJFX05PX0RFUFMgY2FuIGJlIHNldCB0byBmYWxzZSwgYmFzZVxuICAgKiBsb2FkZWQsIHNldERlcGVuZGVuY3lGYWN0b3J5IGNhbGxlZCwgYW5kIHRoZW4gdGhpcyBjYWxsZWQuIGkuZS4gYWxsb3dzXG4gICAqIGN1c3RvbSBsb2FkaW5nIG9mIHRoZSBkZXBzIGZpbGUuXG4gICAqL1xuICBnb29nLmxvYWRDbG9zdXJlRGVwcyA9IGZ1bmN0aW9uKCkge1xuICAgIGdvb2cuZGVidWdMb2FkZXJfLmxvYWRDbG9zdXJlRGVwcygpO1xuICB9O1xuXG5cbiAgLyoqXG4gICAqIFNldHMgdGhlIGRlcGVuZGVuY3kgZmFjdG9yeSwgd2hpY2ggY2FuIGJlIHVzZWQgdG8gY3JlYXRlIGN1c3RvbVxuICAgKiBnb29nLkRlcGVuZGVuY3kgaW1wbGVtZW50YXRpb25zIHRvIGNvbnRyb2wgaG93IGRlcGVuZGVuY2llcyBhcmUgbG9hZGVkLlxuICAgKlxuICAgKiBOb3RlOiBpZiB5b3Ugd2lzaCB0byBjYWxsIHRoaXMgZnVuY3Rpb24gYW5kIHByb3ZpZGUgeW91ciBvd24gaW1wbGVtbmV0YXRpb25cbiAgICogaXQgaXMgYSB3aXNlIGlkZWEgdG8gc2V0IENMT1NVUkVfTk9fREVQUyB0byB0cnVlLCBvdGhlcndpc2UgdGhlIGRlcGVuZGVuY3lcbiAgICogZmlsZSBhbmQgYWxsIG9mIGl0cyBnb29nLmFkZERlcGVuZGVuY3kgY2FsbHMgd2lsbCB1c2UgdGhlIGRlZmF1bHQgZmFjdG9yeS5cbiAgICogWW91IGNhbiBjYWxsIGdvb2cubG9hZENsb3N1cmVEZXBzIHRvIGxvYWQgdGhlIENsb3N1cmUgZGVwZW5kZW5jeSBmaWxlXG4gICAqIGxhdGVyLCBhZnRlciB5b3VyIGZhY3RvcnkgaXMgaW5qZWN0ZWQuXG4gICAqXG4gICAqIEBwYXJhbSB7IWdvb2cuRGVwZW5kZW5jeUZhY3Rvcnl9IGZhY3RvcnlcbiAgICovXG4gIGdvb2cuc2V0RGVwZW5kZW5jeUZhY3RvcnkgPSBmdW5jdGlvbihmYWN0b3J5KSB7XG4gICAgZ29vZy5kZWJ1Z0xvYWRlcl8uc2V0RGVwZW5kZW5jeUZhY3RvcnkoZmFjdG9yeSk7XG4gIH07XG5cblxuICAvKipcbiAgICogVHJ1c3RlZCBUeXBlcyBwb2xpY3kgZm9yIHRoZSBkZWJ1ZyBsb2FkZXIuXG4gICAqIEBwcml2YXRlIEBjb25zdCB7P1RydXN0ZWRUeXBlUG9saWN5fVxuICAgKi9cbiAgZ29vZy5UUlVTVEVEX1RZUEVTX1BPTElDWV8gPSBnb29nLlRSVVNURURfVFlQRVNfUE9MSUNZX05BTUUgP1xuICAgICAgZ29vZy5jcmVhdGVUcnVzdGVkVHlwZXNQb2xpY3koZ29vZy5UUlVTVEVEX1RZUEVTX1BPTElDWV9OQU1FICsgJyNiYXNlJykgOlxuICAgICAgbnVsbDtcblxuICBpZiAoIWdvb2cuZ2xvYmFsLkNMT1NVUkVfTk9fREVQUykge1xuICAgIGdvb2cuZGVidWdMb2FkZXJfLmxvYWRDbG9zdXJlRGVwcygpO1xuICB9XG5cblxuICAvKipcbiAgICogQm9vdHN0cmFwcyB0aGUgZ2l2ZW4gbmFtZXNwYWNlcyBhbmQgY2FsbHMgdGhlIGNhbGxiYWNrIG9uY2UgdGhleSBhcmVcbiAgICogYXZhaWxhYmxlIGVpdGhlciB2aWEgZ29vZy5yZXF1aXJlLiBUaGlzIGlzIGEgcmVwbGFjZW1lbnQgZm9yIHVzaW5nXG4gICAqIGBnb29nLnJlcXVpcmVgIHRvIGJvb3RzdHJhcCBDbG9zdXJlIEphdmFTY3JpcHQuIFByZXZpb3VzbHkgYSBgZ29vZy5yZXF1aXJlYFxuICAgKiBpbiBhbiBIVE1MIGZpbGUgd291bGQgZ3VhcmFudGVlIHRoYXQgdGhlIHJlcXVpcmUnZCBuYW1lc3BhY2Ugd2FzIGF2YWlsYWJsZVxuICAgKiBpbiB0aGUgbmV4dCBpbW1lZGlhdGUgc2NyaXB0IHRhZy4gV2l0aCBFUzYgbW9kdWxlcyB0aGlzIG5vIGxvbmdlciBhXG4gICAqIGd1YXJhbnRlZS5cbiAgICpcbiAgICogQHBhcmFtIHshQXJyYXk8c3RyaW5nPn0gbmFtZXNwYWNlc1xuICAgKiBAcGFyYW0ge2Z1bmN0aW9uKCk6ID99IGNhbGxiYWNrIEZ1bmN0aW9uIHRvIGNhbGwgb25jZSBhbGwgdGhlIG5hbWVzcGFjZXNcbiAgICogICAgIGhhdmUgbG9hZGVkLiBBbHdheXMgY2FsbGVkIGFzeW5jaHJvbm91c2x5LlxuICAgKi9cbiAgZ29vZy5ib290c3RyYXAgPSBmdW5jdGlvbihuYW1lc3BhY2VzLCBjYWxsYmFjaykge1xuICAgIGdvb2cuZGVidWdMb2FkZXJfLmJvb3RzdHJhcChuYW1lc3BhY2VzLCBjYWxsYmFjayk7XG4gIH07XG59XG5cblxuaWYgKCFDT01QSUxFRCkge1xuICB2YXIgaXNDaHJvbWU4NyA9IGZhbHNlO1xuICAvLyBDYW5ub3QgcnVuIGNoZWNrIGZvciBDaHJvbWUgPDg3IGJ1ZyBpbiBjYXNlIG9mIHN0cmljdCBDU1AgZW52aXJvbm1lbnRzLlxuICAvLyBUT0RPKHVzZXIpOiBSZW1vdmUgb25jZSBDaHJvbWUgPDg3IGJ1ZyBpcyBubyBsb25nZXIgYSBwcm9ibGVtLlxuICB0cnkge1xuICAgIGlzQ2hyb21lODcgPSBldmFsKGdvb2cuZ2xvYmFsLnRydXN0ZWRUeXBlcy5lbXB0eVNjcmlwdCkgIT09XG4gICAgICAgIGdvb2cuZ2xvYmFsLnRydXN0ZWRUeXBlcy5lbXB0eVNjcmlwdDtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gIH1cblxuICAvKipcbiAgICogVHJ1c3RlZCBUeXBlcyBmb3IgcnVubmluZyBkZXYgc2VydmVycy5cbiAgICpcbiAgICogQHByaXZhdGUgQGNvbnN0XG4gICAqL1xuICBnb29nLkNMT1NVUkVfRVZBTF9QUkVGSUxURVJfID1cbiAgICAgIC8vIERldGVjdCBDaHJvbWUgPDg3IGJ1ZyB3aXRoIFRUIGFuZCBldmFsLlxuICAgICAgZ29vZy5nbG9iYWwudHJ1c3RlZFR5cGVzICYmIGlzQ2hyb21lODcgJiZcbiAgICAgICAgICBnb29nLmNyZWF0ZVRydXN0ZWRUeXBlc1BvbGljeSgnZ29vZyNiYXNlI2Rldm9ubHkjZXZhbCcpIHx8XG4gICAgICB7Y3JlYXRlU2NyaXB0OiBnb29nLmlkZW50aXR5X307XG59XG4iLCAiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IFRoZSBDbG9zdXJlIExpYnJhcnkgQXV0aG9ycy5cbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBAZmlsZW92ZXJ2aWV3IEltcGxlbWVudHMgdGhlIGRpc3Bvc2FibGUgaW50ZXJmYWNlLlxuICovXG5cbmdvb2cucHJvdmlkZSgnZ29vZy5EaXNwb3NhYmxlJyk7XG5cbmdvb2cucmVxdWlyZSgnZ29vZy5kaXNwb3NhYmxlLklEaXNwb3NhYmxlJyk7XG5nb29nLnJlcXVpcmUoJ2dvb2cuZGlzcG9zZScpO1xuLyoqXG4gKiBUT0RPKHVzZXIpOiBSZW1vdmUgdGhpcyByZXF1aXJlLlxuICogQHN1cHByZXNzIHtleHRyYVJlcXVpcmV9XG4gKi9cbmdvb2cucmVxdWlyZSgnZ29vZy5kaXNwb3NlQWxsJyk7XG5cbi8qKlxuICogQ2xhc3MgdGhhdCBwcm92aWRlcyB0aGUgYmFzaWMgaW1wbGVtZW50YXRpb24gZm9yIGRpc3Bvc2FibGUgb2JqZWN0cy4gSWYgeW91clxuICogY2xhc3MgaG9sZHMgcmVmZXJlbmNlcyBvciByZXNvdXJjZXMgdGhhdCBjYW4ndCBiZSBjb2xsZWN0ZWQgYnkgc3RhbmRhcmQgR0MsXG4gKiBpdCBzaG91bGQgZXh0ZW5kIHRoaXMgY2xhc3Mgb3IgaW1wbGVtZW50IHRoZSBkaXNwb3NhYmxlIGludGVyZmFjZSAoZGVmaW5lZFxuICogaW4gZ29vZy5kaXNwb3NhYmxlLklEaXNwb3NhYmxlKS4gU2VlIGRlc2NyaXB0aW9uIG9mXG4gKiBnb29nLmRpc3Bvc2FibGUuSURpc3Bvc2FibGUgZm9yIGV4YW1wbGVzIG9mIGNsZWFudXAuXG4gKiBAY29uc3RydWN0b3JcbiAqIEBpbXBsZW1lbnRzIHtnb29nLmRpc3Bvc2FibGUuSURpc3Bvc2FibGV9XG4gKi9cbmdvb2cuRGlzcG9zYWJsZSA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIC8qKlxuICAgKiBJZiBtb25pdG9yaW5nIHRoZSBnb29nLkRpc3Bvc2FibGUgaW5zdGFuY2VzIGlzIGVuYWJsZWQsIHN0b3JlcyB0aGUgY3JlYXRpb25cbiAgICogc3RhY2sgdHJhY2Ugb2YgdGhlIERpc3Bvc2FibGUgaW5zdGFuY2UuXG4gICAqIEB0eXBlIHtzdHJpbmd8dW5kZWZpbmVkfVxuICAgKi9cbiAgdGhpcy5jcmVhdGlvblN0YWNrO1xuXG4gIGlmIChnb29nLkRpc3Bvc2FibGUuTU9OSVRPUklOR19NT0RFICE9IGdvb2cuRGlzcG9zYWJsZS5Nb25pdG9yaW5nTW9kZS5PRkYpIHtcbiAgICBpZiAoZ29vZy5EaXNwb3NhYmxlLklOQ0xVREVfU1RBQ0tfT05fQ1JFQVRJT04pIHtcbiAgICAgIHRoaXMuY3JlYXRpb25TdGFjayA9IG5ldyBFcnJvcigpLnN0YWNrO1xuICAgIH1cbiAgICBnb29nLkRpc3Bvc2FibGUuaW5zdGFuY2VzX1tnb29nLmdldFVpZCh0aGlzKV0gPSB0aGlzO1xuICB9XG4gIC8vIFN1cHBvcnQgc2VhbGluZ1xuICB0aGlzLmRpc3Bvc2VkXyA9IHRoaXMuZGlzcG9zZWRfO1xuICB0aGlzLm9uRGlzcG9zZUNhbGxiYWNrc18gPSB0aGlzLm9uRGlzcG9zZUNhbGxiYWNrc187XG59O1xuXG5cbi8qKlxuICogQGVudW0ge251bWJlcn0gRGlmZmVyZW50IG1vbml0b3JpbmcgbW9kZXMgZm9yIERpc3Bvc2FibGUuXG4gKi9cbmdvb2cuRGlzcG9zYWJsZS5Nb25pdG9yaW5nTW9kZSA9IHtcbiAgLyoqXG4gICAqIE5vIG1vbml0b3JpbmcuXG4gICAqL1xuICBPRkY6IDAsXG4gIC8qKlxuICAgKiBDcmVhdGluZyBhbmQgZGlzcG9zaW5nIHRoZSBnb29nLkRpc3Bvc2FibGUgaW5zdGFuY2VzIGlzIG1vbml0b3JlZC4gQWxsXG4gICAqIGRpc3Bvc2FibGUgb2JqZWN0cyBuZWVkIHRvIGNhbGwgdGhlIGBnb29nLkRpc3Bvc2FibGVgIGJhc2VcbiAgICogY29uc3RydWN0b3IuIFRoZSBQRVJNQU5FTlQgbW9kZSBtdXN0IGJlIHN3aXRjaGVkIG9uIGJlZm9yZSBjcmVhdGluZyBhbnlcbiAgICogZ29vZy5EaXNwb3NhYmxlIGluc3RhbmNlcy5cbiAgICovXG4gIFBFUk1BTkVOVDogMSxcbiAgLyoqXG4gICAqIElOVEVSQUNUSVZFIG1vZGUgY2FuIGJlIHN3aXRjaGVkIG9uIGFuZCBvZmYgb24gdGhlIGZseSB3aXRob3V0IHByb2R1Y2luZ1xuICAgKiBlcnJvcnMuIEl0IGFsc28gZG9lc24ndCB3YXJuIGlmIHRoZSBkaXNwb3NhYmxlIG9iamVjdHMgZG9uJ3QgY2FsbCB0aGVcbiAgICogYGdvb2cuRGlzcG9zYWJsZWAgYmFzZSBjb25zdHJ1Y3Rvci5cbiAgICovXG4gIElOVEVSQUNUSVZFOiAyXG59O1xuXG5cbi8qKlxuICogQGRlZmluZSB7bnVtYmVyfSBUaGUgbW9uaXRvcmluZyBtb2RlIG9mIHRoZSBnb29nLkRpc3Bvc2FibGVcbiAqICAgICBpbnN0YW5jZXMuIERlZmF1bHQgaXMgT0ZGLiBTd2l0Y2hpbmcgb24gdGhlIG1vbml0b3JpbmcgaXMgb25seVxuICogICAgIHJlY29tbWVuZGVkIGZvciBkZWJ1Z2dpbmcgYmVjYXVzZSBpdCBoYXMgYSBzaWduaWZpY2FudCBpbXBhY3Qgb25cbiAqICAgICBwZXJmb3JtYW5jZSBhbmQgbWVtb3J5IHVzYWdlLiBJZiBzd2l0Y2hlZCBvZmYsIHRoZSBtb25pdG9yaW5nIGNvZGVcbiAqICAgICBjb21waWxlcyBkb3duIHRvIDAgYnl0ZXMuXG4gKi9cbmdvb2cuRGlzcG9zYWJsZS5NT05JVE9SSU5HX01PREUgPVxuICAgIGdvb2cuZGVmaW5lKCdnb29nLkRpc3Bvc2FibGUuTU9OSVRPUklOR19NT0RFJywgMCk7XG5cblxuLyoqXG4gKiBAZGVmaW5lIHtib29sZWFufSBXaGV0aGVyIHRvIGF0dGFjaCBjcmVhdGlvbiBzdGFjayB0byBlYWNoIGNyZWF0ZWQgZGlzcG9zYWJsZVxuICogICAgIGluc3RhbmNlOyBUaGlzIGlzIG9ubHkgcmVsZXZhbnQgZm9yIHdoZW4gTW9uaXRvcmluZ01vZGUgIT0gT0ZGLlxuICovXG5nb29nLkRpc3Bvc2FibGUuSU5DTFVERV9TVEFDS19PTl9DUkVBVElPTiA9XG4gICAgZ29vZy5kZWZpbmUoJ2dvb2cuRGlzcG9zYWJsZS5JTkNMVURFX1NUQUNLX09OX0NSRUFUSU9OJywgdHJ1ZSk7XG5cblxuLyoqXG4gKiBNYXBzIHRoZSB1bmlxdWUgSUQgb2YgZXZlcnkgdW5kaXNwb3NlZCBgZ29vZy5EaXNwb3NhYmxlYCBvYmplY3QgdG9cbiAqIHRoZSBvYmplY3QgaXRzZWxmLlxuICogQHR5cGUgeyFPYmplY3Q8bnVtYmVyLCAhZ29vZy5EaXNwb3NhYmxlPn1cbiAqIEBwcml2YXRlXG4gKi9cbmdvb2cuRGlzcG9zYWJsZS5pbnN0YW5jZXNfID0ge307XG5cblxuLyoqXG4gKiBAcmV0dXJuIHshQXJyYXk8IWdvb2cuRGlzcG9zYWJsZT59IEFsbCBgZ29vZy5EaXNwb3NhYmxlYCBvYmplY3RzIHRoYXRcbiAqICAgICBoYXZlbid0IGJlZW4gZGlzcG9zZWQgb2YuXG4gKi9cbmdvb2cuRGlzcG9zYWJsZS5nZXRVbmRpc3Bvc2VkT2JqZWN0cyA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIHZhciByZXQgPSBbXTtcbiAgZm9yICh2YXIgaWQgaW4gZ29vZy5EaXNwb3NhYmxlLmluc3RhbmNlc18pIHtcbiAgICBpZiAoZ29vZy5EaXNwb3NhYmxlLmluc3RhbmNlc18uaGFzT3duUHJvcGVydHkoaWQpKSB7XG4gICAgICByZXQucHVzaChnb29nLkRpc3Bvc2FibGUuaW5zdGFuY2VzX1tOdW1iZXIoaWQpXSk7XG4gICAgfVxuICB9XG4gIHJldHVybiByZXQ7XG59O1xuXG5cbi8qKlxuICogQ2xlYXJzIHRoZSByZWdpc3RyeSBvZiB1bmRpc3Bvc2VkIG9iamVjdHMgYnV0IGRvZXNuJ3QgZGlzcG9zZSBvZiB0aGVtLlxuICovXG5nb29nLkRpc3Bvc2FibGUuY2xlYXJVbmRpc3Bvc2VkT2JqZWN0cyA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIGdvb2cuRGlzcG9zYWJsZS5pbnN0YW5jZXNfID0ge307XG59O1xuXG5cbi8qKlxuICogV2hldGhlciB0aGUgb2JqZWN0IGhhcyBiZWVuIGRpc3Bvc2VkIG9mLlxuICogQHR5cGUge2Jvb2xlYW59XG4gKiBAcHJpdmF0ZVxuICovXG5nb29nLkRpc3Bvc2FibGUucHJvdG90eXBlLmRpc3Bvc2VkXyA9IGZhbHNlO1xuXG5cbi8qKlxuICogQ2FsbGJhY2tzIHRvIGludm9rZSB3aGVuIHRoaXMgb2JqZWN0IGlzIGRpc3Bvc2VkLlxuICogQHR5cGUge0FycmF5PCFGdW5jdGlvbj59XG4gKiBAcHJpdmF0ZVxuICovXG5nb29nLkRpc3Bvc2FibGUucHJvdG90eXBlLm9uRGlzcG9zZUNhbGxiYWNrc187XG5cblxuLyoqXG4gKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoZSBvYmplY3QgaGFzIGJlZW4gZGlzcG9zZWQgb2YuXG4gKiBAb3ZlcnJpZGVcbiAqL1xuZ29vZy5EaXNwb3NhYmxlLnByb3RvdHlwZS5pc0Rpc3Bvc2VkID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmV0dXJuIHRoaXMuZGlzcG9zZWRfO1xufTtcblxuXG4vKipcbiAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgdGhlIG9iamVjdCBoYXMgYmVlbiBkaXNwb3NlZCBvZi5cbiAqIEBkZXByZWNhdGVkIFVzZSB7QGxpbmsgI2lzRGlzcG9zZWR9IGluc3RlYWQuXG4gKi9cbmdvb2cuRGlzcG9zYWJsZS5wcm90b3R5cGUuZ2V0RGlzcG9zZWQgPSBnb29nLkRpc3Bvc2FibGUucHJvdG90eXBlLmlzRGlzcG9zZWQ7XG5cblxuLyoqXG4gKiBEaXNwb3NlcyBvZiB0aGUgb2JqZWN0LiBJZiB0aGUgb2JqZWN0IGhhc24ndCBhbHJlYWR5IGJlZW4gZGlzcG9zZWQgb2YsIGNhbGxzXG4gKiB7QGxpbmsgI2Rpc3Bvc2VJbnRlcm5hbH0uIENsYXNzZXMgdGhhdCBleHRlbmQgYGdvb2cuRGlzcG9zYWJsZWAgc2hvdWxkXG4gKiBvdmVycmlkZSB7QGxpbmsgI2Rpc3Bvc2VJbnRlcm5hbH0gaW4gb3JkZXIgdG8gY2xlYW51cCByZWZlcmVuY2VzLCByZXNvdXJjZXNcbiAqIGFuZCBvdGhlciBkaXNwb3NhYmxlIG9iamVjdHMuIFJlZW50cmFudC5cbiAqXG4gKiBAcmV0dXJuIHt2b2lkfSBOb3RoaW5nLlxuICogQG92ZXJyaWRlXG4gKi9cbmdvb2cuRGlzcG9zYWJsZS5wcm90b3R5cGUuZGlzcG9zZSA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIGlmICghdGhpcy5kaXNwb3NlZF8pIHtcbiAgICAvLyBTZXQgZGlzcG9zZWRfIHRvIHRydWUgZmlyc3QsIGluIGNhc2UgZHVyaW5nIHRoZSBjaGFpbiBvZiBkaXNwb3NhbCB0aGlzXG4gICAgLy8gZ2V0cyBkaXNwb3NlZCByZWN1cnNpdmVseS5cbiAgICB0aGlzLmRpc3Bvc2VkXyA9IHRydWU7XG4gICAgdGhpcy5kaXNwb3NlSW50ZXJuYWwoKTtcbiAgICBpZiAoZ29vZy5EaXNwb3NhYmxlLk1PTklUT1JJTkdfTU9ERSAhPSBnb29nLkRpc3Bvc2FibGUuTW9uaXRvcmluZ01vZGUuT0ZGKSB7XG4gICAgICB2YXIgdWlkID0gZ29vZy5nZXRVaWQodGhpcyk7XG4gICAgICBpZiAoZ29vZy5EaXNwb3NhYmxlLk1PTklUT1JJTkdfTU9ERSA9PVxuICAgICAgICAgICAgICBnb29nLkRpc3Bvc2FibGUuTW9uaXRvcmluZ01vZGUuUEVSTUFORU5UICYmXG4gICAgICAgICAgIWdvb2cuRGlzcG9zYWJsZS5pbnN0YW5jZXNfLmhhc093blByb3BlcnR5KHVpZCkpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICAgdGhpcyArICcgZGlkIG5vdCBjYWxsIHRoZSBnb29nLkRpc3Bvc2FibGUgYmFzZSAnICtcbiAgICAgICAgICAgICdjb25zdHJ1Y3RvciBvciB3YXMgZGlzcG9zZWQgb2YgYWZ0ZXIgYSBjbGVhclVuZGlzcG9zZWRPYmplY3RzICcgK1xuICAgICAgICAgICAgJ2NhbGwnKTtcbiAgICAgIH1cbiAgICAgIGlmIChnb29nLkRpc3Bvc2FibGUuTU9OSVRPUklOR19NT0RFICE9XG4gICAgICAgICAgICAgIGdvb2cuRGlzcG9zYWJsZS5Nb25pdG9yaW5nTW9kZS5PRkYgJiZcbiAgICAgICAgICB0aGlzLm9uRGlzcG9zZUNhbGxiYWNrc18gJiYgdGhpcy5vbkRpc3Bvc2VDYWxsYmFja3NfLmxlbmd0aCA+IDApIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICAgdGhpcyArICcgZGlkIG5vdCBlbXB0eSBpdHMgb25EaXNwb3NlQ2FsbGJhY2tzIHF1ZXVlLiBUaGlzICcgK1xuICAgICAgICAgICAgJ3Byb2JhYmx5IG1lYW5zIGl0IG92ZXJyb2RlIGRpc3Bvc2UoKSBvciBkaXNwb3NlSW50ZXJuYWwoKSAnICtcbiAgICAgICAgICAgICd3aXRob3V0IGNhbGxpbmcgdGhlIHN1cGVyY2xhc3NcXCcgbWV0aG9kLicpO1xuICAgICAgfVxuICAgICAgZGVsZXRlIGdvb2cuRGlzcG9zYWJsZS5pbnN0YW5jZXNfW3VpZF07XG4gICAgfVxuICB9XG59O1xuXG5cbi8qKlxuICogQXNzb2NpYXRlcyBhIGRpc3Bvc2FibGUgb2JqZWN0IHdpdGggdGhpcyBvYmplY3Qgc28gdGhhdCB0aGV5IHdpbGwgYmUgZGlzcG9zZWRcbiAqIHRvZ2V0aGVyLlxuICogQHBhcmFtIHtnb29nLmRpc3Bvc2FibGUuSURpc3Bvc2FibGV9IGRpc3Bvc2FibGUgdGhhdCB3aWxsIGJlIGRpc3Bvc2VkIHdoZW5cbiAqICAgICB0aGlzIG9iamVjdCBpcyBkaXNwb3NlZC5cbiAqL1xuZ29vZy5EaXNwb3NhYmxlLnByb3RvdHlwZS5yZWdpc3RlckRpc3Bvc2FibGUgPSBmdW5jdGlvbihkaXNwb3NhYmxlKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgdGhpcy5hZGRPbkRpc3Bvc2VDYWxsYmFjayhnb29nLnBhcnRpYWwoZ29vZy5kaXNwb3NlLCBkaXNwb3NhYmxlKSk7XG59O1xuXG5cbi8qKlxuICogSW52b2tlcyBhIGNhbGxiYWNrIGZ1bmN0aW9uIHdoZW4gdGhpcyBvYmplY3QgaXMgZGlzcG9zZWQuIENhbGxiYWNrcyBhcmVcbiAqIGludm9rZWQgaW4gdGhlIG9yZGVyIGluIHdoaWNoIHRoZXkgd2VyZSBhZGRlZC4gSWYgYSBjYWxsYmFjayBpcyBhZGRlZCB0b1xuICogYW4gYWxyZWFkeSBkaXNwb3NlZCBEaXNwb3NhYmxlLCBpdCB3aWxsIGJlIGNhbGxlZCBpbW1lZGlhdGVseS5cbiAqIEBwYXJhbSB7ZnVuY3Rpb24odGhpczpUKTo/fSBjYWxsYmFjayBUaGUgY2FsbGJhY2sgZnVuY3Rpb24uXG4gKiBAcGFyYW0ge1Q9fSBvcHRfc2NvcGUgQW4gb3B0aW9uYWwgc2NvcGUgdG8gY2FsbCB0aGUgY2FsbGJhY2sgaW4uXG4gKiBAdGVtcGxhdGUgVFxuICovXG5nb29nLkRpc3Bvc2FibGUucHJvdG90eXBlLmFkZE9uRGlzcG9zZUNhbGxiYWNrID0gZnVuY3Rpb24oY2FsbGJhY2ssIG9wdF9zY29wZSkge1xuICAndXNlIHN0cmljdCc7XG4gIGlmICh0aGlzLmRpc3Bvc2VkXykge1xuICAgIG9wdF9zY29wZSAhPT0gdW5kZWZpbmVkID8gY2FsbGJhY2suY2FsbChvcHRfc2NvcGUpIDogY2FsbGJhY2soKTtcbiAgICByZXR1cm47XG4gIH1cbiAgaWYgKCF0aGlzLm9uRGlzcG9zZUNhbGxiYWNrc18pIHtcbiAgICB0aGlzLm9uRGlzcG9zZUNhbGxiYWNrc18gPSBbXTtcbiAgfVxuXG4gIHRoaXMub25EaXNwb3NlQ2FsbGJhY2tzXy5wdXNoKFxuICAgICAgb3B0X3Njb3BlICE9PSB1bmRlZmluZWQgPyBnb29nLmJpbmQoY2FsbGJhY2ssIG9wdF9zY29wZSkgOiBjYWxsYmFjayk7XG59O1xuXG5cbi8qKlxuICogUGVyZm9ybXMgYXBwcm9wcmlhdGUgY2xlYW51cC4gU2VlIGRlc2NyaXB0aW9uIG9mIGdvb2cuZGlzcG9zYWJsZS5JRGlzcG9zYWJsZVxuICogZm9yIGV4YW1wbGVzLiBDbGFzc2VzIHRoYXQgZXh0ZW5kIGBnb29nLkRpc3Bvc2FibGVgIHNob3VsZCBvdmVycmlkZSB0aGlzXG4gKiBtZXRob2QuIE5vdCByZWVudHJhbnQuIFRvIGF2b2lkIGNhbGxpbmcgaXQgdHdpY2UsIGl0IG11c3Qgb25seSBiZSBjYWxsZWQgZnJvbVxuICogdGhlIHN1YmNsYXNzJyBgZGlzcG9zZUludGVybmFsYCBtZXRob2QuIEV2ZXJ5d2hlcmUgZWxzZSB0aGUgcHVibGljIGBkaXNwb3NlYFxuICogbWV0aG9kIG11c3QgYmUgdXNlZC4gRm9yIGV4YW1wbGU6XG4gKlxuICogPHByZT5cbiAqIG15cGFja2FnZS5NeUNsYXNzID0gZnVuY3Rpb24oKSB7XG4gKiBteXBhY2thZ2UuTXlDbGFzcy5iYXNlKHRoaXMsICdjb25zdHJ1Y3RvcicpO1xuICogICAgIC8vIENvbnN0cnVjdG9yIGxvZ2ljIHNwZWNpZmljIHRvIE15Q2xhc3MuXG4gKiAgICAgLi4uXG4gKiAgIH07XG4gKiAgIGdvb2cuaW5oZXJpdHMobXlwYWNrYWdlLk15Q2xhc3MsIGdvb2cuRGlzcG9zYWJsZSk7XG4gKlxuICogICBteXBhY2thZ2UuTXlDbGFzcy5wcm90b3R5cGUuZGlzcG9zZUludGVybmFsID0gZnVuY3Rpb24oKSB7XG4gKiAgICAgLy8gRGlzcG9zZSBsb2dpYyBzcGVjaWZpYyB0byBNeUNsYXNzLlxuICogICAgIC4uLlxuICogICAgIC8vIENhbGwgc3VwZXJjbGFzcydzIGRpc3Bvc2VJbnRlcm5hbCBhdCB0aGUgZW5kIG9mIHRoZSBzdWJjbGFzcydzLCBsaWtlXG4gKiAgICAgLy8gaW4gQysrLCB0byBhdm9pZCBoYXJkLXRvLWNhdGNoIGlzc3Vlcy5cbiAqICAgICBteXBhY2thZ2UuTXlDbGFzcy5iYXNlKHRoaXMsICdkaXNwb3NlSW50ZXJuYWwnKTtcbiAqICAgfTtcbiAqIDwvcHJlPlxuICpcbiAqIEBwcm90ZWN0ZWRcbiAqL1xuZ29vZy5EaXNwb3NhYmxlLnByb3RvdHlwZS5kaXNwb3NlSW50ZXJuYWwgPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBpZiAodGhpcy5vbkRpc3Bvc2VDYWxsYmFja3NfKSB7XG4gICAgd2hpbGUgKHRoaXMub25EaXNwb3NlQ2FsbGJhY2tzXy5sZW5ndGgpIHtcbiAgICAgIHRoaXMub25EaXNwb3NlQ2FsbGJhY2tzXy5zaGlmdCgpKCk7XG4gICAgfVxuICB9XG59O1xuXG5cbi8qKlxuICogUmV0dXJucyBUcnVlIGlmIHdlIGNhbiB2ZXJpZnkgdGhlIG9iamVjdCBpcyBkaXNwb3NlZC5cbiAqIENhbGxzIGBpc0Rpc3Bvc2VkYCBvbiB0aGUgYXJndW1lbnQgaWYgaXQgc3VwcG9ydHMgaXQuICBJZiBvYmpcbiAqIGlzIG5vdCBhbiBvYmplY3Qgd2l0aCBhbiBpc0Rpc3Bvc2VkKCkgbWV0aG9kLCByZXR1cm4gZmFsc2UuXG4gKiBAcGFyYW0geyp9IG9iaiBUaGUgb2JqZWN0IHRvIGludmVzdGlnYXRlLlxuICogQHJldHVybiB7Ym9vbGVhbn0gVHJ1ZSBpZiB3ZSBjYW4gdmVyaWZ5IHRoZSBvYmplY3QgaXMgZGlzcG9zZWQuXG4gKi9cbmdvb2cuRGlzcG9zYWJsZS5pc0Rpc3Bvc2VkID0gZnVuY3Rpb24ob2JqKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgaWYgKG9iaiAmJiB0eXBlb2Ygb2JqLmlzRGlzcG9zZWQgPT0gJ2Z1bmN0aW9uJykge1xuICAgIHJldHVybiBvYmouaXNEaXNwb3NlZCgpO1xuICB9XG4gIHJldHVybiBmYWxzZTtcbn07XG4iLCAiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IFRoZSBDbG9zdXJlIExpYnJhcnkgQXV0aG9ycy5cbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBAZmlsZW92ZXJ2aWV3IFV0aWxpdGllcyBmb3IgbWFuaXB1bGF0aW5nIGFycmF5cy5cbiAqL1xuXG5cbmdvb2cubW9kdWxlKCdnb29nLmFycmF5Jyk7XG5nb29nLm1vZHVsZS5kZWNsYXJlTGVnYWN5TmFtZXNwYWNlKCk7XG5cbmNvbnN0IGFzc2VydHMgPSBnb29nLnJlcXVpcmUoJ2dvb2cuYXNzZXJ0cycpO1xuXG5cbi8qKlxuICogQGRlZmluZSB7Ym9vbGVhbn0gTkFUSVZFX0FSUkFZX1BST1RPVFlQRVMgaW5kaWNhdGVzIHdoZXRoZXIgdGhlIGNvZGUgc2hvdWxkXG4gKiByZWx5IG9uIEFycmF5LnByb3RvdHlwZSBmdW5jdGlvbnMsIGlmIGF2YWlsYWJsZS5cbiAqXG4gKiBUaGUgQXJyYXkucHJvdG90eXBlIGZ1bmN0aW9ucyBjYW4gYmUgZGVmaW5lZCBieSBleHRlcm5hbCBsaWJyYXJpZXMgbGlrZVxuICogUHJvdG90eXBlIGFuZCBzZXR0aW5nIHRoaXMgZmxhZyB0byBmYWxzZSBmb3JjZXMgY2xvc3VyZSB0byB1c2UgaXRzIG93blxuICogZ29vZy5hcnJheSBpbXBsZW1lbnRhdGlvbi5cbiAqXG4gKiBJZiB5b3VyIGphdmFzY3JpcHQgY2FuIGJlIGxvYWRlZCBieSBhIHRoaXJkIHBhcnR5IHNpdGUgYW5kIHlvdSBhcmUgd2FyeSBhYm91dFxuICogcmVseWluZyBvbiB0aGUgcHJvdG90eXBlIGZ1bmN0aW9ucywgc3BlY2lmeVxuICogXCItLWRlZmluZSBnb29nLk5BVElWRV9BUlJBWV9QUk9UT1RZUEVTPWZhbHNlXCIgdG8gdGhlIEpTQ29tcGlsZXIuXG4gKlxuICogU2V0dGluZyBnb29nLlRSVVNURURfU0lURSB0byBmYWxzZSB3aWxsIGF1dG9tYXRpY2FsbHkgc2V0XG4gKiBOQVRJVkVfQVJSQVlfUFJPVE9UWVBFUyB0byBmYWxzZS5cbiAqL1xuZ29vZy5OQVRJVkVfQVJSQVlfUFJPVE9UWVBFUyA9XG4gICAgZ29vZy5kZWZpbmUoJ2dvb2cuTkFUSVZFX0FSUkFZX1BST1RPVFlQRVMnLCBnb29nLlRSVVNURURfU0lURSk7XG5cblxuLyoqXG4gKiBAZGVmaW5lIHtib29sZWFufSBJZiB0cnVlLCBKU0NvbXBpbGVyIHdpbGwgdXNlIHRoZSBuYXRpdmUgaW1wbGVtZW50YXRpb24gb2ZcbiAqIGFycmF5IGZ1bmN0aW9ucyB3aGVyZSBhcHByb3ByaWF0ZSAoZS5nLiwgYEFycmF5I2ZpbHRlcmApIGFuZCByZW1vdmUgdGhlXG4gKiB1bnVzZWQgcHVyZSBKUyBpbXBsZW1lbnRhdGlvbi5cbiAqL1xuY29uc3QgQVNTVU1FX05BVElWRV9GVU5DVElPTlMgPSBnb29nLmRlZmluZShcbiAgICAnZ29vZy5hcnJheS5BU1NVTUVfTkFUSVZFX0ZVTkNUSU9OUycsIGdvb2cuRkVBVFVSRVNFVF9ZRUFSID4gMjAxMik7XG5leHBvcnRzLkFTU1VNRV9OQVRJVkVfRlVOQ1RJT05TID0gQVNTVU1FX05BVElWRV9GVU5DVElPTlM7XG5cblxuLyoqXG4gKiBSZXR1cm5zIHRoZSBsYXN0IGVsZW1lbnQgaW4gYW4gYXJyYXkgd2l0aG91dCByZW1vdmluZyBpdC5cbiAqIFNhbWUgYXMge0BsaW5rIGdvb2cuYXJyYXkubGFzdH0uXG4gKiBAcGFyYW0ge0lBcnJheUxpa2U8VD58c3RyaW5nfSBhcnJheSBUaGUgYXJyYXkuXG4gKiBAcmV0dXJuIHtUfSBMYXN0IGl0ZW0gaW4gYXJyYXkuXG4gKiBAdGVtcGxhdGUgVFxuICovXG5mdW5jdGlvbiBwZWVrKGFycmF5KSB7XG4gIHJldHVybiBhcnJheVthcnJheS5sZW5ndGggLSAxXTtcbn1cbmV4cG9ydHMucGVlayA9IHBlZWs7XG5cblxuLyoqXG4gKiBSZXR1cm5zIHRoZSBsYXN0IGVsZW1lbnQgaW4gYW4gYXJyYXkgd2l0aG91dCByZW1vdmluZyBpdC5cbiAqIFNhbWUgYXMge0BsaW5rIGdvb2cuYXJyYXkucGVla30uXG4gKiBAcGFyYW0ge0lBcnJheUxpa2U8VD58c3RyaW5nfSBhcnJheSBUaGUgYXJyYXkuXG4gKiBAcmV0dXJuIHtUfSBMYXN0IGl0ZW0gaW4gYXJyYXkuXG4gKiBAdGVtcGxhdGUgVFxuICovXG5leHBvcnRzLmxhc3QgPSBwZWVrO1xuXG4vLyBOT1RFKGFydik6IFNpbmNlIG1vc3Qgb2YgdGhlIGFycmF5IGZ1bmN0aW9ucyBhcmUgZ2VuZXJpYyBpdCBhbGxvd3MgeW91IHRvXG4vLyBwYXNzIGFuIGFycmF5LWxpa2Ugb2JqZWN0LiBTdHJpbmdzIGhhdmUgYSBsZW5ndGggYW5kIGFyZSBjb25zaWRlcmVkIGFycmF5LVxuLy8gbGlrZS4gSG93ZXZlciwgdGhlICdpbicgb3BlcmF0b3IgZG9lcyBub3Qgd29yayBvbiBzdHJpbmdzIHNvIHdlIGNhbm5vdCBqdXN0XG4vLyB1c2UgdGhlIGFycmF5IHBhdGggZXZlbiBpZiB0aGUgYnJvd3NlciBzdXBwb3J0cyBpbmRleGluZyBpbnRvIHN0cmluZ3MuIFdlXG4vLyB0aGVyZWZvcmUgZW5kIHVwIHNwbGl0dGluZyB0aGUgc3RyaW5nLlxuXG5cbi8qKlxuICogUmV0dXJucyB0aGUgaW5kZXggb2YgdGhlIGZpcnN0IGVsZW1lbnQgb2YgYW4gYXJyYXkgd2l0aCBhIHNwZWNpZmllZCB2YWx1ZSwgb3JcbiAqIC0xIGlmIHRoZSBlbGVtZW50IGlzIG5vdCBwcmVzZW50IGluIHRoZSBhcnJheS5cbiAqXG4gKiBTZWUge0BsaW5rIGh0dHA6Ly90aW55dXJsLmNvbS9kZXZlbG9wZXItbW96aWxsYS1vcmctYXJyYXktaW5kZXhvZn1cbiAqXG4gKiBAcGFyYW0ge0lBcnJheUxpa2U8VD58c3RyaW5nfSBhcnIgVGhlIGFycmF5IHRvIGJlIHNlYXJjaGVkLlxuICogQHBhcmFtIHtUfSBvYmogVGhlIG9iamVjdCBmb3Igd2hpY2ggd2UgYXJlIHNlYXJjaGluZy5cbiAqIEBwYXJhbSB7bnVtYmVyPX0gb3B0X2Zyb21JbmRleCBUaGUgaW5kZXggYXQgd2hpY2ggdG8gc3RhcnQgdGhlIHNlYXJjaC4gSWZcbiAqICAgICBvbWl0dGVkIHRoZSBzZWFyY2ggc3RhcnRzIGF0IGluZGV4IDAuXG4gKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBpbmRleCBvZiB0aGUgZmlyc3QgbWF0Y2hpbmcgYXJyYXkgZWxlbWVudC5cbiAqIEB0ZW1wbGF0ZSBUXG4gKi9cbmNvbnN0IGluZGV4T2YgPSBnb29nLk5BVElWRV9BUlJBWV9QUk9UT1RZUEVTICYmXG4gICAgICAgIChBU1NVTUVfTkFUSVZFX0ZVTkNUSU9OUyB8fCBBcnJheS5wcm90b3R5cGUuaW5kZXhPZikgP1xuICAgIGZ1bmN0aW9uKGFyciwgb2JqLCBvcHRfZnJvbUluZGV4KSB7XG4gICAgICBhc3NlcnRzLmFzc2VydChhcnIubGVuZ3RoICE9IG51bGwpO1xuXG4gICAgICByZXR1cm4gQXJyYXkucHJvdG90eXBlLmluZGV4T2YuY2FsbChhcnIsIG9iaiwgb3B0X2Zyb21JbmRleCk7XG4gICAgfSA6XG4gICAgZnVuY3Rpb24oYXJyLCBvYmosIG9wdF9mcm9tSW5kZXgpIHtcbiAgICAgIGNvbnN0IGZyb21JbmRleCA9IG9wdF9mcm9tSW5kZXggPT0gbnVsbCA/XG4gICAgICAgICAgMCA6XG4gICAgICAgICAgKG9wdF9mcm9tSW5kZXggPCAwID8gTWF0aC5tYXgoMCwgYXJyLmxlbmd0aCArIG9wdF9mcm9tSW5kZXgpIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRfZnJvbUluZGV4KTtcblxuICAgICAgaWYgKHR5cGVvZiBhcnIgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgIC8vIEFycmF5LnByb3RvdHlwZS5pbmRleE9mIHVzZXMgPT09IHNvIG9ubHkgc3RyaW5ncyBzaG91bGQgYmUgZm91bmQuXG4gICAgICAgIGlmICh0eXBlb2Ygb2JqICE9PSAnc3RyaW5nJyB8fCBvYmoubGVuZ3RoICE9IDEpIHtcbiAgICAgICAgICByZXR1cm4gLTE7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGFyci5pbmRleE9mKG9iaiwgZnJvbUluZGV4KTtcbiAgICAgIH1cblxuICAgICAgZm9yIChsZXQgaSA9IGZyb21JbmRleDsgaSA8IGFyci5sZW5ndGg7IGkrKykge1xuICAgICAgICBpZiAoaSBpbiBhcnIgJiYgYXJyW2ldID09PSBvYmopIHJldHVybiBpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIC0xO1xuICAgIH07XG5leHBvcnRzLmluZGV4T2YgPSBpbmRleE9mO1xuXG5cbi8qKlxuICogUmV0dXJucyB0aGUgaW5kZXggb2YgdGhlIGxhc3QgZWxlbWVudCBvZiBhbiBhcnJheSB3aXRoIGEgc3BlY2lmaWVkIHZhbHVlLCBvclxuICogLTEgaWYgdGhlIGVsZW1lbnQgaXMgbm90IHByZXNlbnQgaW4gdGhlIGFycmF5LlxuICpcbiAqIFNlZSB7QGxpbmsgaHR0cDovL3Rpbnl1cmwuY29tL2RldmVsb3Blci1tb3ppbGxhLW9yZy1hcnJheS1sYXN0aW5kZXhvZn1cbiAqXG4gKiBAcGFyYW0geyFJQXJyYXlMaWtlPFQ+fHN0cmluZ30gYXJyIFRoZSBhcnJheSB0byBiZSBzZWFyY2hlZC5cbiAqIEBwYXJhbSB7VH0gb2JqIFRoZSBvYmplY3QgZm9yIHdoaWNoIHdlIGFyZSBzZWFyY2hpbmcuXG4gKiBAcGFyYW0gez9udW1iZXI9fSBvcHRfZnJvbUluZGV4IFRoZSBpbmRleCBhdCB3aGljaCB0byBzdGFydCB0aGUgc2VhcmNoLiBJZlxuICogICAgIG9taXR0ZWQgdGhlIHNlYXJjaCBzdGFydHMgYXQgdGhlIGVuZCBvZiB0aGUgYXJyYXkuXG4gKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBpbmRleCBvZiB0aGUgbGFzdCBtYXRjaGluZyBhcnJheSBlbGVtZW50LlxuICogQHRlbXBsYXRlIFRcbiAqL1xuY29uc3QgbGFzdEluZGV4T2YgPSBnb29nLk5BVElWRV9BUlJBWV9QUk9UT1RZUEVTICYmXG4gICAgICAgIChBU1NVTUVfTkFUSVZFX0ZVTkNUSU9OUyB8fCBBcnJheS5wcm90b3R5cGUubGFzdEluZGV4T2YpID9cbiAgICBmdW5jdGlvbihhcnIsIG9iaiwgb3B0X2Zyb21JbmRleCkge1xuICAgICAgYXNzZXJ0cy5hc3NlcnQoYXJyLmxlbmd0aCAhPSBudWxsKTtcblxuICAgICAgLy8gRmlyZWZveCB0cmVhdHMgdW5kZWZpbmVkIGFuZCBudWxsIGFzIDAgaW4gdGhlIGZyb21JbmRleCBhcmd1bWVudCB3aGljaFxuICAgICAgLy8gbGVhZHMgaXQgdG8gYWx3YXlzIHJldHVybiAtMVxuICAgICAgY29uc3QgZnJvbUluZGV4ID0gb3B0X2Zyb21JbmRleCA9PSBudWxsID8gYXJyLmxlbmd0aCAtIDEgOiBvcHRfZnJvbUluZGV4O1xuICAgICAgcmV0dXJuIEFycmF5LnByb3RvdHlwZS5sYXN0SW5kZXhPZi5jYWxsKGFyciwgb2JqLCBmcm9tSW5kZXgpO1xuICAgIH0gOlxuICAgIGZ1bmN0aW9uKGFyciwgb2JqLCBvcHRfZnJvbUluZGV4KSB7XG4gICAgICBsZXQgZnJvbUluZGV4ID0gb3B0X2Zyb21JbmRleCA9PSBudWxsID8gYXJyLmxlbmd0aCAtIDEgOiBvcHRfZnJvbUluZGV4O1xuXG4gICAgICBpZiAoZnJvbUluZGV4IDwgMCkge1xuICAgICAgICBmcm9tSW5kZXggPSBNYXRoLm1heCgwLCBhcnIubGVuZ3RoICsgZnJvbUluZGV4KTtcbiAgICAgIH1cblxuICAgICAgaWYgKHR5cGVvZiBhcnIgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgIC8vIEFycmF5LnByb3RvdHlwZS5sYXN0SW5kZXhPZiB1c2VzID09PSBzbyBvbmx5IHN0cmluZ3Mgc2hvdWxkIGJlIGZvdW5kLlxuICAgICAgICBpZiAodHlwZW9mIG9iaiAhPT0gJ3N0cmluZycgfHwgb2JqLmxlbmd0aCAhPSAxKSB7XG4gICAgICAgICAgcmV0dXJuIC0xO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBhcnIubGFzdEluZGV4T2Yob2JqLCBmcm9tSW5kZXgpO1xuICAgICAgfVxuXG4gICAgICBmb3IgKGxldCBpID0gZnJvbUluZGV4OyBpID49IDA7IGktLSkge1xuICAgICAgICBpZiAoaSBpbiBhcnIgJiYgYXJyW2ldID09PSBvYmopIHJldHVybiBpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIC0xO1xuICAgIH07XG5leHBvcnRzLmxhc3RJbmRleE9mID0gbGFzdEluZGV4T2Y7XG5cblxuLyoqXG4gKiBDYWxscyBhIGZ1bmN0aW9uIGZvciBlYWNoIGVsZW1lbnQgaW4gYW4gYXJyYXkuIFNraXBzIGhvbGVzIGluIHRoZSBhcnJheS5cbiAqIFNlZSB7QGxpbmsgaHR0cDovL3Rpbnl1cmwuY29tL2RldmVsb3Blci1tb3ppbGxhLW9yZy1hcnJheS1mb3JlYWNofVxuICpcbiAqIEBwYXJhbSB7SUFycmF5TGlrZTxUPnxzdHJpbmd9IGFyciBBcnJheSBvciBhcnJheSBsaWtlIG9iamVjdCBvdmVyXG4gKiAgICAgd2hpY2ggdG8gaXRlcmF0ZS5cbiAqIEBwYXJhbSB7P2Z1bmN0aW9uKHRoaXM6IFMsIFQsIG51bWJlciwgPyk6ID99IGYgVGhlIGZ1bmN0aW9uIHRvIGNhbGwgZm9yIGV2ZXJ5XG4gKiAgICAgZWxlbWVudC4gVGhpcyBmdW5jdGlvbiB0YWtlcyAzIGFyZ3VtZW50cyAodGhlIGVsZW1lbnQsIHRoZSBpbmRleCBhbmQgdGhlXG4gKiAgICAgYXJyYXkpLiBUaGUgcmV0dXJuIHZhbHVlIGlzIGlnbm9yZWQuXG4gKiBAcGFyYW0ge1M9fSBvcHRfb2JqIFRoZSBvYmplY3QgdG8gYmUgdXNlZCBhcyB0aGUgdmFsdWUgb2YgJ3RoaXMnIHdpdGhpbiBmLlxuICogQHRlbXBsYXRlIFQsU1xuICovXG5jb25zdCBmb3JFYWNoID0gZ29vZy5OQVRJVkVfQVJSQVlfUFJPVE9UWVBFUyAmJlxuICAgICAgICAoQVNTVU1FX05BVElWRV9GVU5DVElPTlMgfHwgQXJyYXkucHJvdG90eXBlLmZvckVhY2gpID9cbiAgICBmdW5jdGlvbihhcnIsIGYsIG9wdF9vYmopIHtcbiAgICAgIGFzc2VydHMuYXNzZXJ0KGFyci5sZW5ndGggIT0gbnVsbCk7XG5cbiAgICAgIEFycmF5LnByb3RvdHlwZS5mb3JFYWNoLmNhbGwoYXJyLCBmLCBvcHRfb2JqKTtcbiAgICB9IDpcbiAgICBmdW5jdGlvbihhcnIsIGYsIG9wdF9vYmopIHtcbiAgICAgIGNvbnN0IGwgPSBhcnIubGVuZ3RoOyAgLy8gbXVzdCBiZSBmaXhlZCBkdXJpbmcgbG9vcC4uLiBzZWUgZG9jc1xuICAgICAgY29uc3QgYXJyMiA9ICh0eXBlb2YgYXJyID09PSAnc3RyaW5nJykgPyBhcnIuc3BsaXQoJycpIDogYXJyO1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsOyBpKyspIHtcbiAgICAgICAgaWYgKGkgaW4gYXJyMikge1xuICAgICAgICAgIGYuY2FsbCgvKiogQHR5cGUgez99ICovIChvcHRfb2JqKSwgYXJyMltpXSwgaSwgYXJyKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH07XG5leHBvcnRzLmZvckVhY2ggPSBmb3JFYWNoO1xuXG5cbi8qKlxuICogQ2FsbHMgYSBmdW5jdGlvbiBmb3IgZWFjaCBlbGVtZW50IGluIGFuIGFycmF5LCBzdGFydGluZyBmcm9tIHRoZSBsYXN0XG4gKiBlbGVtZW50IHJhdGhlciB0aGFuIHRoZSBmaXJzdC5cbiAqXG4gKiBAcGFyYW0ge0lBcnJheUxpa2U8VD58c3RyaW5nfSBhcnIgQXJyYXkgb3IgYXJyYXlcbiAqICAgICBsaWtlIG9iamVjdCBvdmVyIHdoaWNoIHRvIGl0ZXJhdGUuXG4gKiBAcGFyYW0gez9mdW5jdGlvbih0aGlzOiBTLCBULCBudW1iZXIsID8pOiA/fSBmIFRoZSBmdW5jdGlvbiB0byBjYWxsIGZvciBldmVyeVxuICogICAgIGVsZW1lbnQuIFRoaXMgZnVuY3Rpb25cbiAqICAgICB0YWtlcyAzIGFyZ3VtZW50cyAodGhlIGVsZW1lbnQsIHRoZSBpbmRleCBhbmQgdGhlIGFycmF5KS4gVGhlIHJldHVyblxuICogICAgIHZhbHVlIGlzIGlnbm9yZWQuXG4gKiBAcGFyYW0ge1M9fSBvcHRfb2JqIFRoZSBvYmplY3QgdG8gYmUgdXNlZCBhcyB0aGUgdmFsdWUgb2YgJ3RoaXMnXG4gKiAgICAgd2l0aGluIGYuXG4gKiBAdGVtcGxhdGUgVCxTXG4gKi9cbmZ1bmN0aW9uIGZvckVhY2hSaWdodChhcnIsIGYsIG9wdF9vYmopIHtcbiAgY29uc3QgbCA9IGFyci5sZW5ndGg7ICAvLyBtdXN0IGJlIGZpeGVkIGR1cmluZyBsb29wLi4uIHNlZSBkb2NzXG4gIGNvbnN0IGFycjIgPSAodHlwZW9mIGFyciA9PT0gJ3N0cmluZycpID8gYXJyLnNwbGl0KCcnKSA6IGFycjtcbiAgZm9yIChsZXQgaSA9IGwgLSAxOyBpID49IDA7IC0taSkge1xuICAgIGlmIChpIGluIGFycjIpIHtcbiAgICAgIGYuY2FsbCgvKiogQHR5cGUgez99ICovIChvcHRfb2JqKSwgYXJyMltpXSwgaSwgYXJyKTtcbiAgICB9XG4gIH1cbn1cbmV4cG9ydHMuZm9yRWFjaFJpZ2h0ID0gZm9yRWFjaFJpZ2h0O1xuXG5cbi8qKlxuICogQ2FsbHMgYSBmdW5jdGlvbiBmb3IgZWFjaCBlbGVtZW50IGluIGFuIGFycmF5LCBhbmQgaWYgdGhlIGZ1bmN0aW9uIHJldHVybnNcbiAqIHRydWUgYWRkcyB0aGUgZWxlbWVudCB0byBhIG5ldyBhcnJheS5cbiAqXG4gKiBTZWUge0BsaW5rIGh0dHA6Ly90aW55dXJsLmNvbS9kZXZlbG9wZXItbW96aWxsYS1vcmctYXJyYXktZmlsdGVyfVxuICpcbiAqIEBwYXJhbSB7SUFycmF5TGlrZTxUPnxzdHJpbmd9IGFyciBBcnJheSBvciBhcnJheVxuICogICAgIGxpa2Ugb2JqZWN0IG92ZXIgd2hpY2ggdG8gaXRlcmF0ZS5cbiAqIEBwYXJhbSB7P2Z1bmN0aW9uKHRoaXM6UywgVCwgbnVtYmVyLCA/KTpib29sZWFufSBmIFRoZSBmdW5jdGlvbiB0byBjYWxsIGZvclxuICogICAgIGV2ZXJ5IGVsZW1lbnQuIFRoaXMgZnVuY3Rpb25cbiAqICAgICB0YWtlcyAzIGFyZ3VtZW50cyAodGhlIGVsZW1lbnQsIHRoZSBpbmRleCBhbmQgdGhlIGFycmF5KSBhbmQgbXVzdFxuICogICAgIHJldHVybiBhIEJvb2xlYW4uIElmIHRoZSByZXR1cm4gdmFsdWUgaXMgdHJ1ZSB0aGUgZWxlbWVudCBpcyBhZGRlZCB0byB0aGVcbiAqICAgICByZXN1bHQgYXJyYXkuIElmIGl0IGlzIGZhbHNlIHRoZSBlbGVtZW50IGlzIG5vdCBpbmNsdWRlZC5cbiAqIEBwYXJhbSB7Uz19IG9wdF9vYmogVGhlIG9iamVjdCB0byBiZSB1c2VkIGFzIHRoZSB2YWx1ZSBvZiAndGhpcydcbiAqICAgICB3aXRoaW4gZi5cbiAqIEByZXR1cm4geyFBcnJheTxUPn0gYSBuZXcgYXJyYXkgaW4gd2hpY2ggb25seSBlbGVtZW50cyB0aGF0IHBhc3NlZCB0aGUgdGVzdFxuICogICAgIGFyZSBwcmVzZW50LlxuICogQHRlbXBsYXRlIFQsU1xuICovXG5jb25zdCBmaWx0ZXIgPSBnb29nLk5BVElWRV9BUlJBWV9QUk9UT1RZUEVTICYmXG4gICAgICAgIChBU1NVTUVfTkFUSVZFX0ZVTkNUSU9OUyB8fCBBcnJheS5wcm90b3R5cGUuZmlsdGVyKSA/XG4gICAgZnVuY3Rpb24oYXJyLCBmLCBvcHRfb2JqKSB7XG4gICAgICBhc3NlcnRzLmFzc2VydChhcnIubGVuZ3RoICE9IG51bGwpO1xuXG4gICAgICByZXR1cm4gQXJyYXkucHJvdG90eXBlLmZpbHRlci5jYWxsKGFyciwgZiwgb3B0X29iaik7XG4gICAgfSA6XG4gICAgZnVuY3Rpb24oYXJyLCBmLCBvcHRfb2JqKSB7XG4gICAgICBjb25zdCBsID0gYXJyLmxlbmd0aDsgIC8vIG11c3QgYmUgZml4ZWQgZHVyaW5nIGxvb3AuLi4gc2VlIGRvY3NcbiAgICAgIGNvbnN0IHJlcyA9IFtdO1xuICAgICAgbGV0IHJlc0xlbmd0aCA9IDA7XG4gICAgICBjb25zdCBhcnIyID0gKHR5cGVvZiBhcnIgPT09ICdzdHJpbmcnKSA/IGFyci5zcGxpdCgnJykgOiBhcnI7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGw7IGkrKykge1xuICAgICAgICBpZiAoaSBpbiBhcnIyKSB7XG4gICAgICAgICAgY29uc3QgdmFsID0gYXJyMltpXTsgIC8vIGluIGNhc2UgZiBtdXRhdGVzIGFycjJcbiAgICAgICAgICBpZiAoZi5jYWxsKC8qKiBAdHlwZSB7P30gKi8gKG9wdF9vYmopLCB2YWwsIGksIGFycikpIHtcbiAgICAgICAgICAgIHJlc1tyZXNMZW5ndGgrK10gPSB2YWw7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzO1xuICAgIH07XG5leHBvcnRzLmZpbHRlciA9IGZpbHRlcjtcblxuXG4vKipcbiAqIENhbGxzIGEgZnVuY3Rpb24gZm9yIGVhY2ggZWxlbWVudCBpbiBhbiBhcnJheSBhbmQgaW5zZXJ0cyB0aGUgcmVzdWx0IGludG8gYVxuICogbmV3IGFycmF5LlxuICpcbiAqIFNlZSB7QGxpbmsgaHR0cDovL3Rpbnl1cmwuY29tL2RldmVsb3Blci1tb3ppbGxhLW9yZy1hcnJheS1tYXB9XG4gKlxuICogQHBhcmFtIHtJQXJyYXlMaWtlPFZBTFVFPnxzdHJpbmd9IGFyciBBcnJheSBvciBhcnJheSBsaWtlIG9iamVjdFxuICogICAgIG92ZXIgd2hpY2ggdG8gaXRlcmF0ZS5cbiAqIEBwYXJhbSB7ZnVuY3Rpb24odGhpczpUSElTLCBWQUxVRSwgbnVtYmVyLCA/KTogUkVTVUxUfSBmIFRoZSBmdW5jdGlvbiB0byBjYWxsXG4gKiAgICAgZm9yIGV2ZXJ5IGVsZW1lbnQuIFRoaXMgZnVuY3Rpb24gdGFrZXMgMyBhcmd1bWVudHMgKHRoZSBlbGVtZW50LFxuICogICAgIHRoZSBpbmRleCBhbmQgdGhlIGFycmF5KSBhbmQgc2hvdWxkIHJldHVybiBzb21ldGhpbmcuIFRoZSByZXN1bHQgd2lsbCBiZVxuICogICAgIGluc2VydGVkIGludG8gYSBuZXcgYXJyYXkuXG4gKiBAcGFyYW0ge1RISVM9fSBvcHRfb2JqIFRoZSBvYmplY3QgdG8gYmUgdXNlZCBhcyB0aGUgdmFsdWUgb2YgJ3RoaXMnIHdpdGhpbiBmLlxuICogQHJldHVybiB7IUFycmF5PFJFU1VMVD59IGEgbmV3IGFycmF5IHdpdGggdGhlIHJlc3VsdHMgZnJvbSBmLlxuICogQHRlbXBsYXRlIFRISVMsIFZBTFVFLCBSRVNVTFRcbiAqL1xuY29uc3QgbWFwID0gZ29vZy5OQVRJVkVfQVJSQVlfUFJPVE9UWVBFUyAmJlxuICAgICAgICAoQVNTVU1FX05BVElWRV9GVU5DVElPTlMgfHwgQXJyYXkucHJvdG90eXBlLm1hcCkgP1xuICAgIGZ1bmN0aW9uKGFyciwgZiwgb3B0X29iaikge1xuICAgICAgYXNzZXJ0cy5hc3NlcnQoYXJyLmxlbmd0aCAhPSBudWxsKTtcblxuICAgICAgcmV0dXJuIEFycmF5LnByb3RvdHlwZS5tYXAuY2FsbChhcnIsIGYsIG9wdF9vYmopO1xuICAgIH0gOlxuICAgIGZ1bmN0aW9uKGFyciwgZiwgb3B0X29iaikge1xuICAgICAgY29uc3QgbCA9IGFyci5sZW5ndGg7ICAvLyBtdXN0IGJlIGZpeGVkIGR1cmluZyBsb29wLi4uIHNlZSBkb2NzXG4gICAgICBjb25zdCByZXMgPSBuZXcgQXJyYXkobCk7XG4gICAgICBjb25zdCBhcnIyID0gKHR5cGVvZiBhcnIgPT09ICdzdHJpbmcnKSA/IGFyci5zcGxpdCgnJykgOiBhcnI7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGw7IGkrKykge1xuICAgICAgICBpZiAoaSBpbiBhcnIyKSB7XG4gICAgICAgICAgcmVzW2ldID0gZi5jYWxsKC8qKiBAdHlwZSB7P30gKi8gKG9wdF9vYmopLCBhcnIyW2ldLCBpLCBhcnIpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzO1xuICAgIH07XG5leHBvcnRzLm1hcCA9IG1hcDtcblxuXG4vKipcbiAqIFBhc3NlcyBldmVyeSBlbGVtZW50IG9mIGFuIGFycmF5IGludG8gYSBmdW5jdGlvbiBhbmQgYWNjdW11bGF0ZXMgdGhlIHJlc3VsdC5cbiAqXG4gKiBTZWUge0BsaW5rIGh0dHA6Ly90aW55dXJsLmNvbS9kZXZlbG9wZXItbW96aWxsYS1vcmctYXJyYXktcmVkdWNlfVxuICogTm90ZSB0aGF0IHRoaXMgaW1wbGVtZW50YXRpb24gZGlmZmVycyBmcm9tIHRoZSBuYXRpdmUgQXJyYXkucHJvdG90eXBlLnJlZHVjZVxuICogaW4gdGhhdCB0aGUgaW5pdGlhbCB2YWx1ZSBpcyBhc3N1bWVkIHRvIGJlIGRlZmluZWQgKHRoZSBNRE4gZG9jcyBsaW5rZWQgYWJvdmVcbiAqIHJlY29tbWVuZCBub3Qgb21pdHRpbmcgdGhpcyBwYXJhbWV0ZXIsIGFsdGhvdWdoIGl0IGlzIHRlY2huaWNhbGx5IG9wdGlvbmFsKS5cbiAqXG4gKiBGb3IgZXhhbXBsZTpcbiAqIHZhciBhID0gWzEsIDIsIDMsIDRdO1xuICogcmVkdWNlKGEsIGZ1bmN0aW9uKHIsIHYsIGksIGFycikge3JldHVybiByICsgdjt9LCAwKTtcbiAqIHJldHVybnMgMTBcbiAqXG4gKiBAcGFyYW0ge0lBcnJheUxpa2U8VD58c3RyaW5nfSBhcnIgQXJyYXkgb3IgYXJyYXlcbiAqICAgICBsaWtlIG9iamVjdCBvdmVyIHdoaWNoIHRvIGl0ZXJhdGUuXG4gKiBAcGFyYW0ge2Z1bmN0aW9uKHRoaXM6UywgUiwgVCwgbnVtYmVyLCA/KSA6IFJ9IGYgVGhlIGZ1bmN0aW9uIHRvIGNhbGwgZm9yXG4gKiAgICAgZXZlcnkgZWxlbWVudC4gVGhpcyBmdW5jdGlvblxuICogICAgIHRha2VzIDQgYXJndW1lbnRzICh0aGUgZnVuY3Rpb24ncyBwcmV2aW91cyByZXN1bHQgb3IgdGhlIGluaXRpYWwgdmFsdWUsXG4gKiAgICAgdGhlIHZhbHVlIG9mIHRoZSBjdXJyZW50IGFycmF5IGVsZW1lbnQsIHRoZSBjdXJyZW50IGFycmF5IGluZGV4LCBhbmQgdGhlXG4gKiAgICAgYXJyYXkgaXRzZWxmKVxuICogICAgIGZ1bmN0aW9uKHByZXZpb3VzVmFsdWUsIGN1cnJlbnRWYWx1ZSwgaW5kZXgsIGFycmF5KS5cbiAqIEBwYXJhbSB7P30gdmFsIFRoZSBpbml0aWFsIHZhbHVlIHRvIHBhc3MgaW50byB0aGUgZnVuY3Rpb24gb24gdGhlIGZpcnN0IGNhbGwuXG4gKiBAcGFyYW0ge1M9fSBvcHRfb2JqICBUaGUgb2JqZWN0IHRvIGJlIHVzZWQgYXMgdGhlIHZhbHVlIG9mICd0aGlzJ1xuICogICAgIHdpdGhpbiBmLlxuICogQHJldHVybiB7Un0gUmVzdWx0IG9mIGV2YWx1YXRpbmcgZiByZXBlYXRlZGx5IGFjcm9zcyB0aGUgdmFsdWVzIG9mIHRoZSBhcnJheS5cbiAqIEB0ZW1wbGF0ZSBULFMsUlxuICovXG5jb25zdCByZWR1Y2UgPSBnb29nLk5BVElWRV9BUlJBWV9QUk9UT1RZUEVTICYmXG4gICAgICAgIChBU1NVTUVfTkFUSVZFX0ZVTkNUSU9OUyB8fCBBcnJheS5wcm90b3R5cGUucmVkdWNlKSA/XG4gICAgZnVuY3Rpb24oYXJyLCBmLCB2YWwsIG9wdF9vYmopIHtcbiAgICAgIGFzc2VydHMuYXNzZXJ0KGFyci5sZW5ndGggIT0gbnVsbCk7XG4gICAgICBpZiAob3B0X29iaikge1xuICAgICAgICBmID0gZ29vZy5iaW5kKGYsIG9wdF9vYmopO1xuICAgICAgfVxuICAgICAgcmV0dXJuIEFycmF5LnByb3RvdHlwZS5yZWR1Y2UuY2FsbChhcnIsIGYsIHZhbCk7XG4gICAgfSA6XG4gICAgZnVuY3Rpb24oYXJyLCBmLCB2YWwsIG9wdF9vYmopIHtcbiAgICAgIGxldCBydmFsID0gdmFsO1xuICAgICAgZm9yRWFjaChhcnIsIGZ1bmN0aW9uKHZhbCwgaW5kZXgpIHtcbiAgICAgICAgcnZhbCA9IGYuY2FsbCgvKiogQHR5cGUgez99ICovIChvcHRfb2JqKSwgcnZhbCwgdmFsLCBpbmRleCwgYXJyKTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHJ2YWw7XG4gICAgfTtcbmV4cG9ydHMucmVkdWNlID0gcmVkdWNlO1xuXG5cbi8qKlxuICogUGFzc2VzIGV2ZXJ5IGVsZW1lbnQgb2YgYW4gYXJyYXkgaW50byBhIGZ1bmN0aW9uIGFuZCBhY2N1bXVsYXRlcyB0aGUgcmVzdWx0LFxuICogc3RhcnRpbmcgZnJvbSB0aGUgbGFzdCBlbGVtZW50IGFuZCB3b3JraW5nIHRvd2FyZHMgdGhlIGZpcnN0LlxuICpcbiAqIFNlZSB7QGxpbmsgaHR0cDovL3Rpbnl1cmwuY29tL2RldmVsb3Blci1tb3ppbGxhLW9yZy1hcnJheS1yZWR1Y2VyaWdodH1cbiAqXG4gKiBGb3IgZXhhbXBsZTpcbiAqIHZhciBhID0gWydhJywgJ2InLCAnYyddO1xuICogcmVkdWNlUmlnaHQoYSwgZnVuY3Rpb24ociwgdiwgaSwgYXJyKSB7cmV0dXJuIHIgKyB2O30sICcnKTtcbiAqIHJldHVybnMgJ2NiYSdcbiAqXG4gKiBAcGFyYW0ge0lBcnJheUxpa2U8VD58c3RyaW5nfSBhcnIgQXJyYXkgb3IgYXJyYXlcbiAqICAgICBsaWtlIG9iamVjdCBvdmVyIHdoaWNoIHRvIGl0ZXJhdGUuXG4gKiBAcGFyYW0gez9mdW5jdGlvbih0aGlzOlMsIFIsIFQsIG51bWJlciwgPykgOiBSfSBmIFRoZSBmdW5jdGlvbiB0byBjYWxsIGZvclxuICogICAgIGV2ZXJ5IGVsZW1lbnQuIFRoaXMgZnVuY3Rpb25cbiAqICAgICB0YWtlcyA0IGFyZ3VtZW50cyAodGhlIGZ1bmN0aW9uJ3MgcHJldmlvdXMgcmVzdWx0IG9yIHRoZSBpbml0aWFsIHZhbHVlLFxuICogICAgIHRoZSB2YWx1ZSBvZiB0aGUgY3VycmVudCBhcnJheSBlbGVtZW50LCB0aGUgY3VycmVudCBhcnJheSBpbmRleCwgYW5kIHRoZVxuICogICAgIGFycmF5IGl0c2VsZilcbiAqICAgICBmdW5jdGlvbihwcmV2aW91c1ZhbHVlLCBjdXJyZW50VmFsdWUsIGluZGV4LCBhcnJheSkuXG4gKiBAcGFyYW0gez99IHZhbCBUaGUgaW5pdGlhbCB2YWx1ZSB0byBwYXNzIGludG8gdGhlIGZ1bmN0aW9uIG9uIHRoZSBmaXJzdCBjYWxsLlxuICogQHBhcmFtIHtTPX0gb3B0X29iaiBUaGUgb2JqZWN0IHRvIGJlIHVzZWQgYXMgdGhlIHZhbHVlIG9mICd0aGlzJ1xuICogICAgIHdpdGhpbiBmLlxuICogQHJldHVybiB7Un0gT2JqZWN0IHJldHVybmVkIGFzIGEgcmVzdWx0IG9mIGV2YWx1YXRpbmcgZiByZXBlYXRlZGx5IGFjcm9zcyB0aGVcbiAqICAgICB2YWx1ZXMgb2YgdGhlIGFycmF5LlxuICogQHRlbXBsYXRlIFQsUyxSXG4gKi9cbmNvbnN0IHJlZHVjZVJpZ2h0ID0gZ29vZy5OQVRJVkVfQVJSQVlfUFJPVE9UWVBFUyAmJlxuICAgICAgICAoQVNTVU1FX05BVElWRV9GVU5DVElPTlMgfHwgQXJyYXkucHJvdG90eXBlLnJlZHVjZVJpZ2h0KSA/XG4gICAgZnVuY3Rpb24oYXJyLCBmLCB2YWwsIG9wdF9vYmopIHtcbiAgICAgIGFzc2VydHMuYXNzZXJ0KGFyci5sZW5ndGggIT0gbnVsbCk7XG4gICAgICBhc3NlcnRzLmFzc2VydChmICE9IG51bGwpO1xuICAgICAgaWYgKG9wdF9vYmopIHtcbiAgICAgICAgZiA9IGdvb2cuYmluZChmLCBvcHRfb2JqKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBBcnJheS5wcm90b3R5cGUucmVkdWNlUmlnaHQuY2FsbChhcnIsIGYsIHZhbCk7XG4gICAgfSA6XG4gICAgZnVuY3Rpb24oYXJyLCBmLCB2YWwsIG9wdF9vYmopIHtcbiAgICAgIGxldCBydmFsID0gdmFsO1xuICAgICAgZm9yRWFjaFJpZ2h0KGFyciwgZnVuY3Rpb24odmFsLCBpbmRleCkge1xuICAgICAgICBydmFsID0gZi5jYWxsKC8qKiBAdHlwZSB7P30gKi8gKG9wdF9vYmopLCBydmFsLCB2YWwsIGluZGV4LCBhcnIpO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gcnZhbDtcbiAgICB9O1xuZXhwb3J0cy5yZWR1Y2VSaWdodCA9IHJlZHVjZVJpZ2h0O1xuXG5cbi8qKlxuICogQ2FsbHMgZiBmb3IgZWFjaCBlbGVtZW50IG9mIGFuIGFycmF5LiBJZiBhbnkgY2FsbCByZXR1cm5zIHRydWUsIHNvbWUoKVxuICogcmV0dXJucyB0cnVlICh3aXRob3V0IGNoZWNraW5nIHRoZSByZW1haW5pbmcgZWxlbWVudHMpLiBJZiBhbGwgY2FsbHNcbiAqIHJldHVybiBmYWxzZSwgc29tZSgpIHJldHVybnMgZmFsc2UuXG4gKlxuICogU2VlIHtAbGluayBodHRwOi8vdGlueXVybC5jb20vZGV2ZWxvcGVyLW1vemlsbGEtb3JnLWFycmF5LXNvbWV9XG4gKlxuICogQHBhcmFtIHtJQXJyYXlMaWtlPFQ+fHN0cmluZ30gYXJyIEFycmF5IG9yIGFycmF5XG4gKiAgICAgbGlrZSBvYmplY3Qgb3ZlciB3aGljaCB0byBpdGVyYXRlLlxuICogQHBhcmFtIHs/ZnVuY3Rpb24odGhpczpTLCBULCBudW1iZXIsID8pIDogYm9vbGVhbn0gZiBUaGUgZnVuY3Rpb24gdG8gY2FsbCBmb3JcbiAqICAgICBmb3IgZXZlcnkgZWxlbWVudC4gVGhpcyBmdW5jdGlvbiB0YWtlcyAzIGFyZ3VtZW50cyAodGhlIGVsZW1lbnQsIHRoZVxuICogICAgIGluZGV4IGFuZCB0aGUgYXJyYXkpIGFuZCBzaG91bGQgcmV0dXJuIGEgYm9vbGVhbi5cbiAqIEBwYXJhbSB7Uz19IG9wdF9vYmogIFRoZSBvYmplY3QgdG8gYmUgdXNlZCBhcyB0aGUgdmFsdWUgb2YgJ3RoaXMnXG4gKiAgICAgd2l0aGluIGYuXG4gKiBAcmV0dXJuIHtib29sZWFufSB0cnVlIGlmIGFueSBlbGVtZW50IHBhc3NlcyB0aGUgdGVzdC5cbiAqIEB0ZW1wbGF0ZSBULFNcbiAqL1xuY29uc3Qgc29tZSA9IGdvb2cuTkFUSVZFX0FSUkFZX1BST1RPVFlQRVMgJiZcbiAgICAgICAgKEFTU1VNRV9OQVRJVkVfRlVOQ1RJT05TIHx8IEFycmF5LnByb3RvdHlwZS5zb21lKSA/XG4gICAgZnVuY3Rpb24oYXJyLCBmLCBvcHRfb2JqKSB7XG4gICAgICBhc3NlcnRzLmFzc2VydChhcnIubGVuZ3RoICE9IG51bGwpO1xuXG4gICAgICByZXR1cm4gQXJyYXkucHJvdG90eXBlLnNvbWUuY2FsbChhcnIsIGYsIG9wdF9vYmopO1xuICAgIH0gOlxuICAgIGZ1bmN0aW9uKGFyciwgZiwgb3B0X29iaikge1xuICAgICAgY29uc3QgbCA9IGFyci5sZW5ndGg7ICAvLyBtdXN0IGJlIGZpeGVkIGR1cmluZyBsb29wLi4uIHNlZSBkb2NzXG4gICAgICBjb25zdCBhcnIyID0gKHR5cGVvZiBhcnIgPT09ICdzdHJpbmcnKSA/IGFyci5zcGxpdCgnJykgOiBhcnI7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGw7IGkrKykge1xuICAgICAgICBpZiAoaSBpbiBhcnIyICYmIGYuY2FsbCgvKiogQHR5cGUgez99ICovIChvcHRfb2JqKSwgYXJyMltpXSwgaSwgYXJyKSkge1xuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfTtcbmV4cG9ydHMuc29tZSA9IHNvbWU7XG5cblxuLyoqXG4gKiBDYWxsIGYgZm9yIGVhY2ggZWxlbWVudCBvZiBhbiBhcnJheS4gSWYgYWxsIGNhbGxzIHJldHVybiB0cnVlLCBldmVyeSgpXG4gKiByZXR1cm5zIHRydWUuIElmIGFueSBjYWxsIHJldHVybnMgZmFsc2UsIGV2ZXJ5KCkgcmV0dXJucyBmYWxzZSBhbmRcbiAqIGRvZXMgbm90IGNvbnRpbnVlIHRvIGNoZWNrIHRoZSByZW1haW5pbmcgZWxlbWVudHMuXG4gKlxuICogU2VlIHtAbGluayBodHRwOi8vdGlueXVybC5jb20vZGV2ZWxvcGVyLW1vemlsbGEtb3JnLWFycmF5LWV2ZXJ5fVxuICpcbiAqIEBwYXJhbSB7SUFycmF5TGlrZTxUPnxzdHJpbmd9IGFyciBBcnJheSBvciBhcnJheVxuICogICAgIGxpa2Ugb2JqZWN0IG92ZXIgd2hpY2ggdG8gaXRlcmF0ZS5cbiAqIEBwYXJhbSB7P2Z1bmN0aW9uKHRoaXM6UywgVCwgbnVtYmVyLCA/KSA6IGJvb2xlYW59IGYgVGhlIGZ1bmN0aW9uIHRvIGNhbGwgZm9yXG4gKiAgICAgZm9yIGV2ZXJ5IGVsZW1lbnQuIFRoaXMgZnVuY3Rpb24gdGFrZXMgMyBhcmd1bWVudHMgKHRoZSBlbGVtZW50LCB0aGVcbiAqICAgICBpbmRleCBhbmQgdGhlIGFycmF5KSBhbmQgc2hvdWxkIHJldHVybiBhIGJvb2xlYW4uXG4gKiBAcGFyYW0ge1M9fSBvcHRfb2JqIFRoZSBvYmplY3QgdG8gYmUgdXNlZCBhcyB0aGUgdmFsdWUgb2YgJ3RoaXMnXG4gKiAgICAgd2l0aGluIGYuXG4gKiBAcmV0dXJuIHtib29sZWFufSBmYWxzZSBpZiBhbnkgZWxlbWVudCBmYWlscyB0aGUgdGVzdC5cbiAqIEB0ZW1wbGF0ZSBULFNcbiAqL1xuY29uc3QgZXZlcnkgPSBnb29nLk5BVElWRV9BUlJBWV9QUk9UT1RZUEVTICYmXG4gICAgICAgIChBU1NVTUVfTkFUSVZFX0ZVTkNUSU9OUyB8fCBBcnJheS5wcm90b3R5cGUuZXZlcnkpID9cbiAgICBmdW5jdGlvbihhcnIsIGYsIG9wdF9vYmopIHtcbiAgICAgIGFzc2VydHMuYXNzZXJ0KGFyci5sZW5ndGggIT0gbnVsbCk7XG5cbiAgICAgIHJldHVybiBBcnJheS5wcm90b3R5cGUuZXZlcnkuY2FsbChhcnIsIGYsIG9wdF9vYmopO1xuICAgIH0gOlxuICAgIGZ1bmN0aW9uKGFyciwgZiwgb3B0X29iaikge1xuICAgICAgY29uc3QgbCA9IGFyci5sZW5ndGg7ICAvLyBtdXN0IGJlIGZpeGVkIGR1cmluZyBsb29wLi4uIHNlZSBkb2NzXG4gICAgICBjb25zdCBhcnIyID0gKHR5cGVvZiBhcnIgPT09ICdzdHJpbmcnKSA/IGFyci5zcGxpdCgnJykgOiBhcnI7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGw7IGkrKykge1xuICAgICAgICBpZiAoaSBpbiBhcnIyICYmICFmLmNhbGwoLyoqIEB0eXBlIHs/fSAqLyAob3B0X29iaiksIGFycjJbaV0sIGksIGFycikpIHtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH07XG5leHBvcnRzLmV2ZXJ5ID0gZXZlcnk7XG5cblxuLyoqXG4gKiBDb3VudHMgdGhlIGFycmF5IGVsZW1lbnRzIHRoYXQgZnVsZmlsbCB0aGUgcHJlZGljYXRlLCBpLmUuIGZvciB3aGljaCB0aGVcbiAqIGNhbGxiYWNrIGZ1bmN0aW9uIHJldHVybnMgdHJ1ZS4gU2tpcHMgaG9sZXMgaW4gdGhlIGFycmF5LlxuICpcbiAqIEBwYXJhbSB7IUlBcnJheUxpa2U8VD58c3RyaW5nfSBhcnIgQXJyYXkgb3IgYXJyYXkgbGlrZSBvYmplY3RcbiAqICAgICBvdmVyIHdoaWNoIHRvIGl0ZXJhdGUuXG4gKiBAcGFyYW0ge2Z1bmN0aW9uKHRoaXM6IFMsIFQsIG51bWJlciwgPyk6IGJvb2xlYW59IGYgVGhlIGZ1bmN0aW9uIHRvIGNhbGwgZm9yXG4gKiAgICAgZXZlcnkgZWxlbWVudC4gVGFrZXMgMyBhcmd1bWVudHMgKHRoZSBlbGVtZW50LCB0aGUgaW5kZXggYW5kIHRoZSBhcnJheSkuXG4gKiBAcGFyYW0ge1M9fSBvcHRfb2JqIFRoZSBvYmplY3QgdG8gYmUgdXNlZCBhcyB0aGUgdmFsdWUgb2YgJ3RoaXMnIHdpdGhpbiBmLlxuICogQHJldHVybiB7bnVtYmVyfSBUaGUgbnVtYmVyIG9mIHRoZSBtYXRjaGluZyBlbGVtZW50cy5cbiAqIEB0ZW1wbGF0ZSBULFNcbiAqL1xuZnVuY3Rpb24gY291bnQoYXJyLCBmLCBvcHRfb2JqKSB7XG4gIGxldCBjb3VudCA9IDA7XG4gIGZvckVhY2goYXJyLCBmdW5jdGlvbihlbGVtZW50LCBpbmRleCwgYXJyKSB7XG4gICAgaWYgKGYuY2FsbCgvKiogQHR5cGUgez99ICovIChvcHRfb2JqKSwgZWxlbWVudCwgaW5kZXgsIGFycikpIHtcbiAgICAgICsrY291bnQ7XG4gICAgfVxuICB9LCBvcHRfb2JqKTtcbiAgcmV0dXJuIGNvdW50O1xufVxuZXhwb3J0cy5jb3VudCA9IGNvdW50O1xuXG5cbi8qKlxuICogU2VhcmNoIGFuIGFycmF5IGZvciB0aGUgZmlyc3QgZWxlbWVudCB0aGF0IHNhdGlzZmllcyBhIGdpdmVuIGNvbmRpdGlvbiBhbmRcbiAqIHJldHVybiB0aGF0IGVsZW1lbnQuXG4gKiBAcGFyYW0ge0lBcnJheUxpa2U8VD58c3RyaW5nfSBhcnIgQXJyYXkgb3IgYXJyYXlcbiAqICAgICBsaWtlIG9iamVjdCBvdmVyIHdoaWNoIHRvIGl0ZXJhdGUuXG4gKiBAcGFyYW0gez9mdW5jdGlvbih0aGlzOlMsIFQsIG51bWJlciwgPykgOiBib29sZWFufSBmIFRoZSBmdW5jdGlvbiB0byBjYWxsXG4gKiAgICAgZm9yIGV2ZXJ5IGVsZW1lbnQuIFRoaXMgZnVuY3Rpb24gdGFrZXMgMyBhcmd1bWVudHMgKHRoZSBlbGVtZW50LCB0aGVcbiAqICAgICBpbmRleCBhbmQgdGhlIGFycmF5KSBhbmQgc2hvdWxkIHJldHVybiBhIGJvb2xlYW4uXG4gKiBAcGFyYW0ge1M9fSBvcHRfb2JqIEFuIG9wdGlvbmFsIFwidGhpc1wiIGNvbnRleHQgZm9yIHRoZSBmdW5jdGlvbi5cbiAqIEByZXR1cm4ge1R8bnVsbH0gVGhlIGZpcnN0IGFycmF5IGVsZW1lbnQgdGhhdCBwYXNzZXMgdGhlIHRlc3QsIG9yIG51bGwgaWYgbm9cbiAqICAgICBlbGVtZW50IGlzIGZvdW5kLlxuICogQHRlbXBsYXRlIFQsU1xuICovXG5mdW5jdGlvbiBmaW5kKGFyciwgZiwgb3B0X29iaikge1xuICBjb25zdCBpID0gZmluZEluZGV4KGFyciwgZiwgb3B0X29iaik7XG4gIHJldHVybiBpIDwgMCA/IG51bGwgOiB0eXBlb2YgYXJyID09PSAnc3RyaW5nJyA/IGFyci5jaGFyQXQoaSkgOiBhcnJbaV07XG59XG5leHBvcnRzLmZpbmQgPSBmaW5kO1xuXG5cbi8qKlxuICogU2VhcmNoIGFuIGFycmF5IGZvciB0aGUgZmlyc3QgZWxlbWVudCB0aGF0IHNhdGlzZmllcyBhIGdpdmVuIGNvbmRpdGlvbiBhbmRcbiAqIHJldHVybiBpdHMgaW5kZXguXG4gKiBAcGFyYW0ge0lBcnJheUxpa2U8VD58c3RyaW5nfSBhcnIgQXJyYXkgb3IgYXJyYXlcbiAqICAgICBsaWtlIG9iamVjdCBvdmVyIHdoaWNoIHRvIGl0ZXJhdGUuXG4gKiBAcGFyYW0gez9mdW5jdGlvbih0aGlzOlMsIFQsIG51bWJlciwgPykgOiBib29sZWFufSBmIFRoZSBmdW5jdGlvbiB0byBjYWxsIGZvclxuICogICAgIGV2ZXJ5IGVsZW1lbnQuIFRoaXMgZnVuY3Rpb25cbiAqICAgICB0YWtlcyAzIGFyZ3VtZW50cyAodGhlIGVsZW1lbnQsIHRoZSBpbmRleCBhbmQgdGhlIGFycmF5KSBhbmQgc2hvdWxkXG4gKiAgICAgcmV0dXJuIGEgYm9vbGVhbi5cbiAqIEBwYXJhbSB7Uz19IG9wdF9vYmogQW4gb3B0aW9uYWwgXCJ0aGlzXCIgY29udGV4dCBmb3IgdGhlIGZ1bmN0aW9uLlxuICogQHJldHVybiB7bnVtYmVyfSBUaGUgaW5kZXggb2YgdGhlIGZpcnN0IGFycmF5IGVsZW1lbnQgdGhhdCBwYXNzZXMgdGhlIHRlc3QsXG4gKiAgICAgb3IgLTEgaWYgbm8gZWxlbWVudCBpcyBmb3VuZC5cbiAqIEB0ZW1wbGF0ZSBULFNcbiAqL1xuZnVuY3Rpb24gZmluZEluZGV4KGFyciwgZiwgb3B0X29iaikge1xuICBjb25zdCBsID0gYXJyLmxlbmd0aDsgIC8vIG11c3QgYmUgZml4ZWQgZHVyaW5nIGxvb3AuLi4gc2VlIGRvY3NcbiAgY29uc3QgYXJyMiA9ICh0eXBlb2YgYXJyID09PSAnc3RyaW5nJykgPyBhcnIuc3BsaXQoJycpIDogYXJyO1xuICBmb3IgKGxldCBpID0gMDsgaSA8IGw7IGkrKykge1xuICAgIGlmIChpIGluIGFycjIgJiYgZi5jYWxsKC8qKiBAdHlwZSB7P30gKi8gKG9wdF9vYmopLCBhcnIyW2ldLCBpLCBhcnIpKSB7XG4gICAgICByZXR1cm4gaTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIC0xO1xufVxuZXhwb3J0cy5maW5kSW5kZXggPSBmaW5kSW5kZXg7XG5cblxuLyoqXG4gKiBTZWFyY2ggYW4gYXJyYXkgKGluIHJldmVyc2Ugb3JkZXIpIGZvciB0aGUgbGFzdCBlbGVtZW50IHRoYXQgc2F0aXNmaWVzIGFcbiAqIGdpdmVuIGNvbmRpdGlvbiBhbmQgcmV0dXJuIHRoYXQgZWxlbWVudC5cbiAqIEBwYXJhbSB7SUFycmF5TGlrZTxUPnxzdHJpbmd9IGFyciBBcnJheSBvciBhcnJheVxuICogICAgIGxpa2Ugb2JqZWN0IG92ZXIgd2hpY2ggdG8gaXRlcmF0ZS5cbiAqIEBwYXJhbSB7P2Z1bmN0aW9uKHRoaXM6UywgVCwgbnVtYmVyLCA/KSA6IGJvb2xlYW59IGYgVGhlIGZ1bmN0aW9uIHRvIGNhbGxcbiAqICAgICBmb3IgZXZlcnkgZWxlbWVudC4gVGhpcyBmdW5jdGlvblxuICogICAgIHRha2VzIDMgYXJndW1lbnRzICh0aGUgZWxlbWVudCwgdGhlIGluZGV4IGFuZCB0aGUgYXJyYXkpIGFuZCBzaG91bGRcbiAqICAgICByZXR1cm4gYSBib29sZWFuLlxuICogQHBhcmFtIHtTPX0gb3B0X29iaiBBbiBvcHRpb25hbCBcInRoaXNcIiBjb250ZXh0IGZvciB0aGUgZnVuY3Rpb24uXG4gKiBAcmV0dXJuIHtUfG51bGx9IFRoZSBsYXN0IGFycmF5IGVsZW1lbnQgdGhhdCBwYXNzZXMgdGhlIHRlc3QsIG9yIG51bGwgaWYgbm9cbiAqICAgICBlbGVtZW50IGlzIGZvdW5kLlxuICogQHRlbXBsYXRlIFQsU1xuICovXG5mdW5jdGlvbiBmaW5kUmlnaHQoYXJyLCBmLCBvcHRfb2JqKSB7XG4gIGNvbnN0IGkgPSBmaW5kSW5kZXhSaWdodChhcnIsIGYsIG9wdF9vYmopO1xuICByZXR1cm4gaSA8IDAgPyBudWxsIDogdHlwZW9mIGFyciA9PT0gJ3N0cmluZycgPyBhcnIuY2hhckF0KGkpIDogYXJyW2ldO1xufVxuZXhwb3J0cy5maW5kUmlnaHQgPSBmaW5kUmlnaHQ7XG5cblxuLyoqXG4gKiBTZWFyY2ggYW4gYXJyYXkgKGluIHJldmVyc2Ugb3JkZXIpIGZvciB0aGUgbGFzdCBlbGVtZW50IHRoYXQgc2F0aXNmaWVzIGFcbiAqIGdpdmVuIGNvbmRpdGlvbiBhbmQgcmV0dXJuIGl0cyBpbmRleC5cbiAqIEBwYXJhbSB7SUFycmF5TGlrZTxUPnxzdHJpbmd9IGFyciBBcnJheSBvciBhcnJheVxuICogICAgIGxpa2Ugb2JqZWN0IG92ZXIgd2hpY2ggdG8gaXRlcmF0ZS5cbiAqIEBwYXJhbSB7P2Z1bmN0aW9uKHRoaXM6UywgVCwgbnVtYmVyLCA/KSA6IGJvb2xlYW59IGYgVGhlIGZ1bmN0aW9uIHRvIGNhbGxcbiAqICAgICBmb3IgZXZlcnkgZWxlbWVudC4gVGhpcyBmdW5jdGlvblxuICogICAgIHRha2VzIDMgYXJndW1lbnRzICh0aGUgZWxlbWVudCwgdGhlIGluZGV4IGFuZCB0aGUgYXJyYXkpIGFuZCBzaG91bGRcbiAqICAgICByZXR1cm4gYSBib29sZWFuLlxuICogQHBhcmFtIHtTPX0gb3B0X29iaiBBbiBvcHRpb25hbCBcInRoaXNcIiBjb250ZXh0IGZvciB0aGUgZnVuY3Rpb24uXG4gKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBpbmRleCBvZiB0aGUgbGFzdCBhcnJheSBlbGVtZW50IHRoYXQgcGFzc2VzIHRoZSB0ZXN0LFxuICogICAgIG9yIC0xIGlmIG5vIGVsZW1lbnQgaXMgZm91bmQuXG4gKiBAdGVtcGxhdGUgVCxTXG4gKi9cbmZ1bmN0aW9uIGZpbmRJbmRleFJpZ2h0KGFyciwgZiwgb3B0X29iaikge1xuICBjb25zdCBsID0gYXJyLmxlbmd0aDsgIC8vIG11c3QgYmUgZml4ZWQgZHVyaW5nIGxvb3AuLi4gc2VlIGRvY3NcbiAgY29uc3QgYXJyMiA9ICh0eXBlb2YgYXJyID09PSAnc3RyaW5nJykgPyBhcnIuc3BsaXQoJycpIDogYXJyO1xuICBmb3IgKGxldCBpID0gbCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgaWYgKGkgaW4gYXJyMiAmJiBmLmNhbGwoLyoqIEB0eXBlIHs/fSAqLyAob3B0X29iaiksIGFycjJbaV0sIGksIGFycikpIHtcbiAgICAgIHJldHVybiBpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gLTE7XG59XG5leHBvcnRzLmZpbmRJbmRleFJpZ2h0ID0gZmluZEluZGV4UmlnaHQ7XG5cblxuLyoqXG4gKiBXaGV0aGVyIHRoZSBhcnJheSBjb250YWlucyB0aGUgZ2l2ZW4gb2JqZWN0LlxuICogQHBhcmFtIHtJQXJyYXlMaWtlPD8+fHN0cmluZ30gYXJyIFRoZSBhcnJheSB0byB0ZXN0IGZvciB0aGUgcHJlc2VuY2Ugb2YgdGhlXG4gKiAgICAgZWxlbWVudC5cbiAqIEBwYXJhbSB7Kn0gb2JqIFRoZSBvYmplY3QgZm9yIHdoaWNoIHRvIHRlc3QuXG4gKiBAcmV0dXJuIHtib29sZWFufSB0cnVlIGlmIG9iaiBpcyBwcmVzZW50LlxuICovXG5mdW5jdGlvbiBjb250YWlucyhhcnIsIG9iaikge1xuICByZXR1cm4gaW5kZXhPZihhcnIsIG9iaikgPj0gMDtcbn1cbmV4cG9ydHMuY29udGFpbnMgPSBjb250YWlucztcblxuXG4vKipcbiAqIFdoZXRoZXIgdGhlIGFycmF5IGlzIGVtcHR5LlxuICogQHBhcmFtIHtJQXJyYXlMaWtlPD8+fHN0cmluZ30gYXJyIFRoZSBhcnJheSB0byB0ZXN0LlxuICogQHJldHVybiB7Ym9vbGVhbn0gdHJ1ZSBpZiBlbXB0eS5cbiAqL1xuZnVuY3Rpb24gaXNFbXB0eShhcnIpIHtcbiAgcmV0dXJuIGFyci5sZW5ndGggPT0gMDtcbn1cbmV4cG9ydHMuaXNFbXB0eSA9IGlzRW1wdHk7XG5cblxuLyoqXG4gKiBDbGVhcnMgdGhlIGFycmF5LlxuICogQHBhcmFtIHtJQXJyYXlMaWtlPD8+fSBhcnIgQXJyYXkgb3IgYXJyYXkgbGlrZSBvYmplY3QgdG8gY2xlYXIuXG4gKi9cbmZ1bmN0aW9uIGNsZWFyKGFycikge1xuICAvLyBGb3Igbm9uIHJlYWwgYXJyYXlzIHdlIGRvbid0IGhhdmUgdGhlIG1hZ2ljIGxlbmd0aCBzbyB3ZSBkZWxldGUgdGhlXG4gIC8vIGluZGljZXMuXG4gIGlmICghQXJyYXkuaXNBcnJheShhcnIpKSB7XG4gICAgZm9yIChsZXQgaSA9IGFyci5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgZGVsZXRlIGFycltpXTtcbiAgICB9XG4gIH1cbiAgYXJyLmxlbmd0aCA9IDA7XG59XG5leHBvcnRzLmNsZWFyID0gY2xlYXI7XG5cblxuLyoqXG4gKiBQdXNoZXMgYW4gaXRlbSBpbnRvIGFuIGFycmF5LCBpZiBpdCdzIG5vdCBhbHJlYWR5IGluIHRoZSBhcnJheS5cbiAqIEBwYXJhbSB7QXJyYXk8VD59IGFyciBBcnJheSBpbnRvIHdoaWNoIHRvIGluc2VydCB0aGUgaXRlbS5cbiAqIEBwYXJhbSB7VH0gb2JqIFZhbHVlIHRvIGFkZC5cbiAqIEB0ZW1wbGF0ZSBUXG4gKi9cbmZ1bmN0aW9uIGluc2VydChhcnIsIG9iaikge1xuICBpZiAoIWNvbnRhaW5zKGFyciwgb2JqKSkge1xuICAgIGFyci5wdXNoKG9iaik7XG4gIH1cbn1cbmV4cG9ydHMuaW5zZXJ0ID0gaW5zZXJ0O1xuXG5cbi8qKlxuICogSW5zZXJ0cyBhbiBvYmplY3QgYXQgdGhlIGdpdmVuIGluZGV4IG9mIHRoZSBhcnJheS5cbiAqIEBwYXJhbSB7SUFycmF5TGlrZTw/Pn0gYXJyIFRoZSBhcnJheSB0byBtb2RpZnkuXG4gKiBAcGFyYW0geyp9IG9iaiBUaGUgb2JqZWN0IHRvIGluc2VydC5cbiAqIEBwYXJhbSB7bnVtYmVyPX0gb3B0X2kgVGhlIGluZGV4IGF0IHdoaWNoIHRvIGluc2VydCB0aGUgb2JqZWN0LiBJZiBvbWl0dGVkLFxuICogICAgICB0cmVhdGVkIGFzIDAuIEEgbmVnYXRpdmUgaW5kZXggaXMgY291bnRlZCBmcm9tIHRoZSBlbmQgb2YgdGhlIGFycmF5LlxuICovXG5mdW5jdGlvbiBpbnNlcnRBdChhcnIsIG9iaiwgb3B0X2kpIHtcbiAgc3BsaWNlKGFyciwgb3B0X2ksIDAsIG9iaik7XG59XG5leHBvcnRzLmluc2VydEF0ID0gaW5zZXJ0QXQ7XG5cblxuLyoqXG4gKiBJbnNlcnRzIGF0IHRoZSBnaXZlbiBpbmRleCBvZiB0aGUgYXJyYXksIGFsbCBlbGVtZW50cyBvZiBhbm90aGVyIGFycmF5LlxuICogQHBhcmFtIHtJQXJyYXlMaWtlPD8+fSBhcnIgVGhlIGFycmF5IHRvIG1vZGlmeS5cbiAqIEBwYXJhbSB7SUFycmF5TGlrZTw/Pn0gZWxlbWVudHNUb0FkZCBUaGUgYXJyYXkgb2YgZWxlbWVudHMgdG8gYWRkLlxuICogQHBhcmFtIHtudW1iZXI9fSBvcHRfaSBUaGUgaW5kZXggYXQgd2hpY2ggdG8gaW5zZXJ0IHRoZSBvYmplY3QuIElmIG9taXR0ZWQsXG4gKiAgICAgIHRyZWF0ZWQgYXMgMC4gQSBuZWdhdGl2ZSBpbmRleCBpcyBjb3VudGVkIGZyb20gdGhlIGVuZCBvZiB0aGUgYXJyYXkuXG4gKi9cbmZ1bmN0aW9uIGluc2VydEFycmF5QXQoYXJyLCBlbGVtZW50c1RvQWRkLCBvcHRfaSkge1xuICBnb29nLnBhcnRpYWwoc3BsaWNlLCBhcnIsIG9wdF9pLCAwKS5hcHBseShudWxsLCBlbGVtZW50c1RvQWRkKTtcbn1cbmV4cG9ydHMuaW5zZXJ0QXJyYXlBdCA9IGluc2VydEFycmF5QXQ7XG5cblxuLyoqXG4gKiBJbnNlcnRzIGFuIG9iamVjdCBpbnRvIGFuIGFycmF5IGJlZm9yZSBhIHNwZWNpZmllZCBvYmplY3QuXG4gKiBAcGFyYW0ge0FycmF5PFQ+fSBhcnIgVGhlIGFycmF5IHRvIG1vZGlmeS5cbiAqIEBwYXJhbSB7VH0gb2JqIFRoZSBvYmplY3QgdG8gaW5zZXJ0LlxuICogQHBhcmFtIHtUPX0gb3B0X29iajIgVGhlIG9iamVjdCBiZWZvcmUgd2hpY2ggb2JqIHNob3VsZCBiZSBpbnNlcnRlZC4gSWYgb2JqMlxuICogICAgIGlzIG9taXR0ZWQgb3Igbm90IGZvdW5kLCBvYmogaXMgaW5zZXJ0ZWQgYXQgdGhlIGVuZCBvZiB0aGUgYXJyYXkuXG4gKiBAdGVtcGxhdGUgVFxuICovXG5mdW5jdGlvbiBpbnNlcnRCZWZvcmUoYXJyLCBvYmosIG9wdF9vYmoyKSB7XG4gIGxldCBpO1xuICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PSAyIHx8IChpID0gaW5kZXhPZihhcnIsIG9wdF9vYmoyKSkgPCAwKSB7XG4gICAgYXJyLnB1c2gob2JqKTtcbiAgfSBlbHNlIHtcbiAgICBpbnNlcnRBdChhcnIsIG9iaiwgaSk7XG4gIH1cbn1cbmV4cG9ydHMuaW5zZXJ0QmVmb3JlID0gaW5zZXJ0QmVmb3JlO1xuXG5cbi8qKlxuICogUmVtb3ZlcyB0aGUgZmlyc3Qgb2NjdXJyZW5jZSBvZiBhIHBhcnRpY3VsYXIgdmFsdWUgZnJvbSBhbiBhcnJheS5cbiAqIEBwYXJhbSB7SUFycmF5TGlrZTxUPn0gYXJyIEFycmF5IGZyb20gd2hpY2ggdG8gcmVtb3ZlXG4gKiAgICAgdmFsdWUuXG4gKiBAcGFyYW0ge1R9IG9iaiBPYmplY3QgdG8gcmVtb3ZlLlxuICogQHJldHVybiB7Ym9vbGVhbn0gVHJ1ZSBpZiBhbiBlbGVtZW50IHdhcyByZW1vdmVkLlxuICogQHRlbXBsYXRlIFRcbiAqL1xuZnVuY3Rpb24gcmVtb3ZlKGFyciwgb2JqKSB7XG4gIGNvbnN0IGkgPSBpbmRleE9mKGFyciwgb2JqKTtcbiAgbGV0IHJ2O1xuICBpZiAoKHJ2ID0gaSA+PSAwKSkge1xuICAgIHJlbW92ZUF0KGFyciwgaSk7XG4gIH1cbiAgcmV0dXJuIHJ2O1xufVxuZXhwb3J0cy5yZW1vdmUgPSByZW1vdmU7XG5cblxuLyoqXG4gKiBSZW1vdmVzIHRoZSBsYXN0IG9jY3VycmVuY2Ugb2YgYSBwYXJ0aWN1bGFyIHZhbHVlIGZyb20gYW4gYXJyYXkuXG4gKiBAcGFyYW0geyFJQXJyYXlMaWtlPFQ+fSBhcnIgQXJyYXkgZnJvbSB3aGljaCB0byByZW1vdmUgdmFsdWUuXG4gKiBAcGFyYW0ge1R9IG9iaiBPYmplY3QgdG8gcmVtb3ZlLlxuICogQHJldHVybiB7Ym9vbGVhbn0gVHJ1ZSBpZiBhbiBlbGVtZW50IHdhcyByZW1vdmVkLlxuICogQHRlbXBsYXRlIFRcbiAqL1xuZnVuY3Rpb24gcmVtb3ZlTGFzdChhcnIsIG9iaikge1xuICBjb25zdCBpID0gbGFzdEluZGV4T2YoYXJyLCBvYmopO1xuICBpZiAoaSA+PSAwKSB7XG4gICAgcmVtb3ZlQXQoYXJyLCBpKTtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICByZXR1cm4gZmFsc2U7XG59XG5leHBvcnRzLnJlbW92ZUxhc3QgPSByZW1vdmVMYXN0O1xuXG5cbi8qKlxuICogUmVtb3ZlcyBmcm9tIGFuIGFycmF5IHRoZSBlbGVtZW50IGF0IGluZGV4IGlcbiAqIEBwYXJhbSB7SUFycmF5TGlrZTw/Pn0gYXJyIEFycmF5IG9yIGFycmF5IGxpa2Ugb2JqZWN0IGZyb20gd2hpY2ggdG9cbiAqICAgICByZW1vdmUgdmFsdWUuXG4gKiBAcGFyYW0ge251bWJlcn0gaSBUaGUgaW5kZXggdG8gcmVtb3ZlLlxuICogQHJldHVybiB7Ym9vbGVhbn0gVHJ1ZSBpZiBhbiBlbGVtZW50IHdhcyByZW1vdmVkLlxuICovXG5mdW5jdGlvbiByZW1vdmVBdChhcnIsIGkpIHtcbiAgYXNzZXJ0cy5hc3NlcnQoYXJyLmxlbmd0aCAhPSBudWxsKTtcblxuICAvLyB1c2UgZ2VuZXJpYyBmb3JtIG9mIHNwbGljZVxuICAvLyBzcGxpY2UgcmV0dXJucyB0aGUgcmVtb3ZlZCBpdGVtcyBhbmQgaWYgc3VjY2Vzc2Z1bCB0aGUgbGVuZ3RoIG9mIHRoYXRcbiAgLy8gd2lsbCBiZSAxXG4gIHJldHVybiBBcnJheS5wcm90b3R5cGUuc3BsaWNlLmNhbGwoYXJyLCBpLCAxKS5sZW5ndGggPT0gMTtcbn1cbmV4cG9ydHMucmVtb3ZlQXQgPSByZW1vdmVBdDtcblxuXG4vKipcbiAqIFJlbW92ZXMgdGhlIGZpcnN0IHZhbHVlIHRoYXQgc2F0aXNmaWVzIHRoZSBnaXZlbiBjb25kaXRpb24uXG4gKiBAcGFyYW0ge0lBcnJheUxpa2U8VD59IGFyciBBcnJheSBvciBhcnJheVxuICogICAgIGxpa2Ugb2JqZWN0IG92ZXIgd2hpY2ggdG8gaXRlcmF0ZS5cbiAqIEBwYXJhbSB7P2Z1bmN0aW9uKHRoaXM6UywgVCwgbnVtYmVyLCA/KSA6IGJvb2xlYW59IGYgVGhlIGZ1bmN0aW9uIHRvIGNhbGxcbiAqICAgICBmb3IgZXZlcnkgZWxlbWVudC4gVGhpcyBmdW5jdGlvblxuICogICAgIHRha2VzIDMgYXJndW1lbnRzICh0aGUgZWxlbWVudCwgdGhlIGluZGV4IGFuZCB0aGUgYXJyYXkpIGFuZCBzaG91bGRcbiAqICAgICByZXR1cm4gYSBib29sZWFuLlxuICogQHBhcmFtIHtTPX0gb3B0X29iaiBBbiBvcHRpb25hbCBcInRoaXNcIiBjb250ZXh0IGZvciB0aGUgZnVuY3Rpb24uXG4gKiBAcmV0dXJuIHtib29sZWFufSBUcnVlIGlmIGFuIGVsZW1lbnQgd2FzIHJlbW92ZWQuXG4gKiBAdGVtcGxhdGUgVCxTXG4gKi9cbmZ1bmN0aW9uIHJlbW92ZUlmKGFyciwgZiwgb3B0X29iaikge1xuICBjb25zdCBpID0gZmluZEluZGV4KGFyciwgZiwgb3B0X29iaik7XG4gIGlmIChpID49IDApIHtcbiAgICByZW1vdmVBdChhcnIsIGkpO1xuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIHJldHVybiBmYWxzZTtcbn1cbmV4cG9ydHMucmVtb3ZlSWYgPSByZW1vdmVJZjtcblxuXG4vKipcbiAqIFJlbW92ZXMgYWxsIHZhbHVlcyB0aGF0IHNhdGlzZnkgdGhlIGdpdmVuIGNvbmRpdGlvbi5cbiAqIEBwYXJhbSB7SUFycmF5TGlrZTxUPn0gYXJyIEFycmF5IG9yIGFycmF5XG4gKiAgICAgbGlrZSBvYmplY3Qgb3ZlciB3aGljaCB0byBpdGVyYXRlLlxuICogQHBhcmFtIHs/ZnVuY3Rpb24odGhpczpTLCBULCBudW1iZXIsID8pIDogYm9vbGVhbn0gZiBUaGUgZnVuY3Rpb24gdG8gY2FsbFxuICogICAgIGZvciBldmVyeSBlbGVtZW50LiBUaGlzIGZ1bmN0aW9uXG4gKiAgICAgdGFrZXMgMyBhcmd1bWVudHMgKHRoZSBlbGVtZW50LCB0aGUgaW5kZXggYW5kIHRoZSBhcnJheSkgYW5kIHNob3VsZFxuICogICAgIHJldHVybiBhIGJvb2xlYW4uXG4gKiBAcGFyYW0ge1M9fSBvcHRfb2JqIEFuIG9wdGlvbmFsIFwidGhpc1wiIGNvbnRleHQgZm9yIHRoZSBmdW5jdGlvbi5cbiAqIEByZXR1cm4ge251bWJlcn0gVGhlIG51bWJlciBvZiBpdGVtcyByZW1vdmVkXG4gKiBAdGVtcGxhdGUgVCxTXG4gKi9cbmZ1bmN0aW9uIHJlbW92ZUFsbElmKGFyciwgZiwgb3B0X29iaikge1xuICBsZXQgcmVtb3ZlZENvdW50ID0gMDtcbiAgZm9yRWFjaFJpZ2h0KGFyciwgZnVuY3Rpb24odmFsLCBpbmRleCkge1xuICAgIGlmIChmLmNhbGwoLyoqIEB0eXBlIHs/fSAqLyAob3B0X29iaiksIHZhbCwgaW5kZXgsIGFycikpIHtcbiAgICAgIGlmIChyZW1vdmVBdChhcnIsIGluZGV4KSkge1xuICAgICAgICByZW1vdmVkQ291bnQrKztcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xuICByZXR1cm4gcmVtb3ZlZENvdW50O1xufVxuZXhwb3J0cy5yZW1vdmVBbGxJZiA9IHJlbW92ZUFsbElmO1xuXG5cbi8qKlxuICogUmV0dXJucyBhIG5ldyBhcnJheSB0aGF0IGlzIHRoZSByZXN1bHQgb2Ygam9pbmluZyB0aGUgYXJndW1lbnRzLiAgSWYgYXJyYXlzXG4gKiBhcmUgcGFzc2VkIHRoZW4gdGhlaXIgaXRlbXMgYXJlIGFkZGVkLCBob3dldmVyLCBpZiBub24tYXJyYXlzIGFyZSBwYXNzZWQgdGhleVxuICogd2lsbCBiZSBhZGRlZCB0byB0aGUgcmV0dXJuIGFycmF5IGFzIGlzLlxuICpcbiAqIE5vdGUgdGhhdCBBcnJheUxpa2Ugb2JqZWN0cyB3aWxsIGJlIGFkZGVkIGFzIGlzLCByYXRoZXIgdGhhbiBoYXZpbmcgdGhlaXJcbiAqIGl0ZW1zIGFkZGVkLlxuICpcbiAqIGNvbmNhdChbMSwgMl0sIFszLCA0XSkgLT4gWzEsIDIsIDMsIDRdXG4gKiBjb25jYXQoMCwgWzEsIDJdKSAtPiBbMCwgMSwgMl1cbiAqIGNvbmNhdChbMSwgMl0sIG51bGwpIC0+IFsxLCAyLCBudWxsXVxuICpcbiAqIFRoZXJlIGlzIGJ1ZyBpbiBhbGwgY3VycmVudCB2ZXJzaW9ucyBvZiBJRSAoNiwgNyBhbmQgOCkgd2hlcmUgYXJyYXlzIGNyZWF0ZWRcbiAqIGluIGFuIGlmcmFtZSBiZWNvbWUgY29ycnVwdGVkIHNvb24gKG5vdCBpbW1lZGlhdGVseSkgYWZ0ZXIgdGhlIGlmcmFtZSBpc1xuICogZGVzdHJveWVkLiBUaGlzIGlzIGNvbW1vbiBpZiBsb2FkaW5nIGRhdGEgdmlhIGdvb2cubmV0LklmcmFtZUlvLCBmb3IgZXhhbXBsZS5cbiAqIFRoaXMgY29ycnVwdGlvbiBvbmx5IGFmZmVjdHMgdGhlIGNvbmNhdCBtZXRob2Qgd2hpY2ggd2lsbCBzdGFydCB0aHJvd2luZ1xuICogQ2F0YXN0cm9waGljIEVycm9ycyAoIy0yMTQ3NDE4MTEzKS5cbiAqXG4gKiBTZWUgaHR0cDovL2VuZG9mbG93LmNvbS9zY3JhdGNoL2NvcnJ1cHRlZC1hcnJheXMuaHRtbCBmb3IgYSB0ZXN0IGNhc2UuXG4gKlxuICogSW50ZXJuYWxseSBnb29nLmFycmF5IHNob3VsZCB1c2UgdGhpcywgc28gdGhhdCBhbGwgbWV0aG9kcyB3aWxsIGNvbnRpbnVlIHRvXG4gKiB3b3JrIG9uIHRoZXNlIGJyb2tlbiBhcnJheSBvYmplY3RzLlxuICpcbiAqIEBwYXJhbSB7Li4uKn0gdmFyX2FyZ3MgSXRlbXMgdG8gY29uY2F0ZW5hdGUuICBBcnJheXMgd2lsbCBoYXZlIGVhY2ggaXRlbVxuICogICAgIGFkZGVkLCB3aGlsZSBwcmltaXRpdmVzIGFuZCBvYmplY3RzIHdpbGwgYmUgYWRkZWQgYXMgaXMuXG4gKiBAcmV0dXJuIHshQXJyYXk8Pz59IFRoZSBuZXcgcmVzdWx0YW50IGFycmF5LlxuICovXG5mdW5jdGlvbiBjb25jYXQodmFyX2FyZ3MpIHtcbiAgcmV0dXJuIEFycmF5LnByb3RvdHlwZS5jb25jYXQuYXBwbHkoW10sIGFyZ3VtZW50cyk7XG59XG5leHBvcnRzLmNvbmNhdCA9IGNvbmNhdDtcblxuXG4vKipcbiAqIFJldHVybnMgYSBuZXcgYXJyYXkgdGhhdCBjb250YWlucyB0aGUgY29udGVudHMgb2YgYWxsIHRoZSBhcnJheXMgcGFzc2VkLlxuICogQHBhcmFtIHsuLi4hQXJyYXk8VD59IHZhcl9hcmdzXG4gKiBAcmV0dXJuIHshQXJyYXk8VD59XG4gKiBAdGVtcGxhdGUgVFxuICovXG5mdW5jdGlvbiBqb2luKHZhcl9hcmdzKSB7XG4gIHJldHVybiBBcnJheS5wcm90b3R5cGUuY29uY2F0LmFwcGx5KFtdLCBhcmd1bWVudHMpO1xufVxuZXhwb3J0cy5qb2luID0gam9pbjtcblxuXG4vKipcbiAqIENvbnZlcnRzIGFuIG9iamVjdCB0byBhbiBhcnJheS5cbiAqIEBwYXJhbSB7SUFycmF5TGlrZTxUPnxzdHJpbmd9IG9iamVjdCAgVGhlIG9iamVjdCB0byBjb252ZXJ0IHRvIGFuXG4gKiAgICAgYXJyYXkuXG4gKiBAcmV0dXJuIHshQXJyYXk8VD59IFRoZSBvYmplY3QgY29udmVydGVkIGludG8gYW4gYXJyYXkuIElmIG9iamVjdCBoYXMgYVxuICogICAgIGxlbmd0aCBwcm9wZXJ0eSwgZXZlcnkgcHJvcGVydHkgaW5kZXhlZCB3aXRoIGEgbm9uLW5lZ2F0aXZlIG51bWJlclxuICogICAgIGxlc3MgdGhhbiBsZW5ndGggd2lsbCBiZSBpbmNsdWRlZCBpbiB0aGUgcmVzdWx0LiBJZiBvYmplY3QgZG9lcyBub3RcbiAqICAgICBoYXZlIGEgbGVuZ3RoIHByb3BlcnR5LCBhbiBlbXB0eSBhcnJheSB3aWxsIGJlIHJldHVybmVkLlxuICogQHRlbXBsYXRlIFRcbiAqL1xuZnVuY3Rpb24gdG9BcnJheShvYmplY3QpIHtcbiAgY29uc3QgbGVuZ3RoID0gb2JqZWN0Lmxlbmd0aDtcblxuICAvLyBJZiBsZW5ndGggaXMgbm90IGEgbnVtYmVyIHRoZSBmb2xsb3dpbmcgaXMgZmFsc2UuIFRoaXMgY2FzZSBpcyBrZXB0IGZvclxuICAvLyBiYWNrd2FyZHMgY29tcGF0aWJpbGl0eSBzaW5jZSB0aGVyZSBhcmUgY2FsbGVycyB0aGF0IHBhc3Mgb2JqZWN0cyB0aGF0IGFyZVxuICAvLyBub3QgYXJyYXkgbGlrZS5cbiAgaWYgKGxlbmd0aCA+IDApIHtcbiAgICBjb25zdCBydiA9IG5ldyBBcnJheShsZW5ndGgpO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgIHJ2W2ldID0gb2JqZWN0W2ldO1xuICAgIH1cbiAgICByZXR1cm4gcnY7XG4gIH1cbiAgcmV0dXJuIFtdO1xufVxuZXhwb3J0cy50b0FycmF5ID0gdG9BcnJheTtcblxuXG4vKipcbiAqIERvZXMgYSBzaGFsbG93IGNvcHkgb2YgYW4gYXJyYXkuXG4gKiBAcGFyYW0ge0lBcnJheUxpa2U8VD58c3RyaW5nfSBhcnIgIEFycmF5IG9yIGFycmF5LWxpa2Ugb2JqZWN0IHRvXG4gKiAgICAgY2xvbmUuXG4gKiBAcmV0dXJuIHshQXJyYXk8VD59IENsb25lIG9mIHRoZSBpbnB1dCBhcnJheS5cbiAqIEB0ZW1wbGF0ZSBUXG4gKi9cbmNvbnN0IGNsb25lID0gdG9BcnJheTtcbmV4cG9ydHMuY2xvbmUgPSBjbG9uZTtcblxuXG4vKipcbiAqIEV4dGVuZHMgYW4gYXJyYXkgd2l0aCBhbm90aGVyIGFycmF5LCBlbGVtZW50LCBvciBcImFycmF5IGxpa2VcIiBvYmplY3QuXG4gKiBUaGlzIGZ1bmN0aW9uIG9wZXJhdGVzICdpbi1wbGFjZScsIGl0IGRvZXMgbm90IGNyZWF0ZSBhIG5ldyBBcnJheS5cbiAqXG4gKiBFeGFtcGxlOlxuICogdmFyIGEgPSBbXTtcbiAqIGV4dGVuZChhLCBbMCwgMV0pO1xuICogYTsgLy8gWzAsIDFdXG4gKiBleHRlbmQoYSwgMik7XG4gKiBhOyAvLyBbMCwgMSwgMl1cbiAqXG4gKiBAcGFyYW0ge0FycmF5PFZBTFVFPn0gYXJyMSAgVGhlIGFycmF5IHRvIG1vZGlmeS5cbiAqIEBwYXJhbSB7Li4uKElBcnJheUxpa2U8VkFMVUU+fFZBTFVFKX0gdmFyX2FyZ3MgVGhlIGVsZW1lbnRzIG9yIGFycmF5cyBvZlxuICogICAgIGVsZW1lbnRzIHRvIGFkZCB0byBhcnIxLlxuICogQHRlbXBsYXRlIFZBTFVFXG4gKi9cbmZ1bmN0aW9uIGV4dGVuZChhcnIxLCB2YXJfYXJncykge1xuICBmb3IgKGxldCBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykge1xuICAgIGNvbnN0IGFycjIgPSBhcmd1bWVudHNbaV07XG4gICAgaWYgKGdvb2cuaXNBcnJheUxpa2UoYXJyMikpIHtcbiAgICAgIGNvbnN0IGxlbjEgPSBhcnIxLmxlbmd0aCB8fCAwO1xuICAgICAgY29uc3QgbGVuMiA9IGFycjIubGVuZ3RoIHx8IDA7XG4gICAgICBhcnIxLmxlbmd0aCA9IGxlbjEgKyBsZW4yO1xuICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBsZW4yOyBqKyspIHtcbiAgICAgICAgYXJyMVtsZW4xICsgal0gPSBhcnIyW2pdO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBhcnIxLnB1c2goYXJyMik7XG4gICAgfVxuICB9XG59XG5leHBvcnRzLmV4dGVuZCA9IGV4dGVuZDtcblxuXG4vKipcbiAqIEFkZHMgb3IgcmVtb3ZlcyBlbGVtZW50cyBmcm9tIGFuIGFycmF5LiBUaGlzIGlzIGEgZ2VuZXJpYyB2ZXJzaW9uIG9mIEFycmF5XG4gKiBzcGxpY2UuIFRoaXMgbWVhbnMgdGhhdCBpdCBtaWdodCB3b3JrIG9uIG90aGVyIG9iamVjdHMgc2ltaWxhciB0byBhcnJheXMsXG4gKiBzdWNoIGFzIHRoZSBhcmd1bWVudHMgb2JqZWN0LlxuICpcbiAqIEBwYXJhbSB7SUFycmF5TGlrZTxUPn0gYXJyIFRoZSBhcnJheSB0byBtb2RpZnkuXG4gKiBAcGFyYW0ge251bWJlcnx1bmRlZmluZWR9IGluZGV4IFRoZSBpbmRleCBhdCB3aGljaCB0byBzdGFydCBjaGFuZ2luZyB0aGVcbiAqICAgICBhcnJheS4gSWYgbm90IGRlZmluZWQsIHRyZWF0ZWQgYXMgMC5cbiAqIEBwYXJhbSB7bnVtYmVyfSBob3dNYW55IEhvdyBtYW55IGVsZW1lbnRzIHRvIHJlbW92ZSAoMCBtZWFucyBubyByZW1vdmFsLiBBXG4gKiAgICAgdmFsdWUgYmVsb3cgMCBpcyB0cmVhdGVkIGFzIHplcm8gYW5kIHNvIGlzIGFueSBvdGhlciBub24gbnVtYmVyLiBOdW1iZXJzXG4gKiAgICAgYXJlIGZsb29yZWQpLlxuICogQHBhcmFtIHsuLi5UfSB2YXJfYXJncyBPcHRpb25hbCwgYWRkaXRpb25hbCBlbGVtZW50cyB0byBpbnNlcnQgaW50byB0aGVcbiAqICAgICBhcnJheS5cbiAqIEByZXR1cm4geyFBcnJheTxUPn0gdGhlIHJlbW92ZWQgZWxlbWVudHMuXG4gKiBAdGVtcGxhdGUgVFxuICovXG5mdW5jdGlvbiBzcGxpY2UoYXJyLCBpbmRleCwgaG93TWFueSwgdmFyX2FyZ3MpIHtcbiAgYXNzZXJ0cy5hc3NlcnQoYXJyLmxlbmd0aCAhPSBudWxsKTtcblxuICByZXR1cm4gQXJyYXkucHJvdG90eXBlLnNwbGljZS5hcHBseShhcnIsIHNsaWNlKGFyZ3VtZW50cywgMSkpO1xufVxuZXhwb3J0cy5zcGxpY2UgPSBzcGxpY2U7XG5cblxuLyoqXG4gKiBSZXR1cm5zIGEgbmV3IGFycmF5IGZyb20gYSBzZWdtZW50IG9mIGFuIGFycmF5LiBUaGlzIGlzIGEgZ2VuZXJpYyB2ZXJzaW9uIG9mXG4gKiBBcnJheSBzbGljZS4gVGhpcyBtZWFucyB0aGF0IGl0IG1pZ2h0IHdvcmsgb24gb3RoZXIgb2JqZWN0cyBzaW1pbGFyIHRvXG4gKiBhcnJheXMsIHN1Y2ggYXMgdGhlIGFyZ3VtZW50cyBvYmplY3QuXG4gKlxuICogQHBhcmFtIHtJQXJyYXlMaWtlPFQ+fHN0cmluZ30gYXJyIFRoZSBhcnJheSBmcm9tXG4gKiB3aGljaCB0byBjb3B5IGEgc2VnbWVudC5cbiAqIEBwYXJhbSB7bnVtYmVyfSBzdGFydCBUaGUgaW5kZXggb2YgdGhlIGZpcnN0IGVsZW1lbnQgdG8gY29weS5cbiAqIEBwYXJhbSB7bnVtYmVyPX0gb3B0X2VuZCBUaGUgaW5kZXggYWZ0ZXIgdGhlIGxhc3QgZWxlbWVudCB0byBjb3B5LlxuICogQHJldHVybiB7IUFycmF5PFQ+fSBBIG5ldyBhcnJheSBjb250YWluaW5nIHRoZSBzcGVjaWZpZWQgc2VnbWVudCBvZiB0aGVcbiAqICAgICBvcmlnaW5hbCBhcnJheS5cbiAqIEB0ZW1wbGF0ZSBUXG4gKi9cbmZ1bmN0aW9uIHNsaWNlKGFyciwgc3RhcnQsIG9wdF9lbmQpIHtcbiAgYXNzZXJ0cy5hc3NlcnQoYXJyLmxlbmd0aCAhPSBudWxsKTtcblxuICAvLyBwYXNzaW5nIDEgYXJnIHRvIHNsaWNlIGlzIG5vdCB0aGUgc2FtZSBhcyBwYXNzaW5nIDIgd2hlcmUgdGhlIHNlY29uZCBpc1xuICAvLyBudWxsIG9yIHVuZGVmaW5lZCAoaW4gdGhhdCBjYXNlIHRoZSBzZWNvbmQgYXJndW1lbnQgaXMgdHJlYXRlZCBhcyAwKS5cbiAgLy8gd2UgY291bGQgdXNlIHNsaWNlIG9uIHRoZSBhcmd1bWVudHMgb2JqZWN0IGFuZCB0aGVuIHVzZSBhcHBseSBpbnN0ZWFkIG9mXG4gIC8vIHRlc3RpbmcgdGhlIGxlbmd0aFxuICBpZiAoYXJndW1lbnRzLmxlbmd0aCA8PSAyKSB7XG4gICAgcmV0dXJuIEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyciwgc3RhcnQpO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcnIsIHN0YXJ0LCBvcHRfZW5kKTtcbiAgfVxufVxuZXhwb3J0cy5zbGljZSA9IHNsaWNlO1xuXG5cbi8qKlxuICogUmVtb3ZlcyBhbGwgZHVwbGljYXRlcyBmcm9tIGFuIGFycmF5IChyZXRhaW5pbmcgb25seSB0aGUgZmlyc3RcbiAqIG9jY3VycmVuY2Ugb2YgZWFjaCBhcnJheSBlbGVtZW50KS4gIFRoaXMgZnVuY3Rpb24gbW9kaWZpZXMgdGhlXG4gKiBhcnJheSBpbiBwbGFjZSBhbmQgZG9lc24ndCBjaGFuZ2UgdGhlIG9yZGVyIG9mIHRoZSBub24tZHVwbGljYXRlIGl0ZW1zLlxuICpcbiAqIEZvciBvYmplY3RzLCBkdXBsaWNhdGVzIGFyZSBpZGVudGlmaWVkIGFzIGhhdmluZyB0aGUgc2FtZSB1bmlxdWUgSUQgYXNcbiAqIGRlZmluZWQgYnkge0BsaW5rIGdvb2cuZ2V0VWlkfS5cbiAqXG4gKiBBbHRlcm5hdGl2ZWx5IHlvdSBjYW4gc3BlY2lmeSBhIGN1c3RvbSBoYXNoIGZ1bmN0aW9uIHRoYXQgcmV0dXJucyBhIHVuaXF1ZVxuICogdmFsdWUgZm9yIGVhY2ggaXRlbSBpbiB0aGUgYXJyYXkgaXQgc2hvdWxkIGNvbnNpZGVyIHVuaXF1ZS5cbiAqXG4gKiBSdW50aW1lOiBOLFxuICogV29yc3RjYXNlIHNwYWNlOiAyTiAobm8gZHVwZXMpXG4gKlxuICogQHBhcmFtIHtJQXJyYXlMaWtlPFQ+fSBhcnIgVGhlIGFycmF5IGZyb20gd2hpY2ggdG8gcmVtb3ZlXG4gKiAgICAgZHVwbGljYXRlcy5cbiAqIEBwYXJhbSB7QXJyYXk9fSBvcHRfcnYgQW4gb3B0aW9uYWwgYXJyYXkgaW4gd2hpY2ggdG8gcmV0dXJuIHRoZSByZXN1bHRzLFxuICogICAgIGluc3RlYWQgb2YgcGVyZm9ybWluZyB0aGUgcmVtb3ZhbCBpbnBsYWNlLiAgSWYgc3BlY2lmaWVkLCB0aGUgb3JpZ2luYWxcbiAqICAgICBhcnJheSB3aWxsIHJlbWFpbiB1bmNoYW5nZWQuXG4gKiBAcGFyYW0ge2Z1bmN0aW9uKFQpOnN0cmluZz19IG9wdF9oYXNoRm4gQW4gb3B0aW9uYWwgZnVuY3Rpb24gdG8gdXNlIHRvXG4gKiAgICAgYXBwbHkgdG8gZXZlcnkgaXRlbSBpbiB0aGUgYXJyYXkuIFRoaXMgZnVuY3Rpb24gc2hvdWxkIHJldHVybiBhIHVuaXF1ZVxuICogICAgIHZhbHVlIGZvciBlYWNoIGl0ZW0gaW4gdGhlIGFycmF5IGl0IHNob3VsZCBjb25zaWRlciB1bmlxdWUuXG4gKiBAdGVtcGxhdGUgVFxuICovXG5mdW5jdGlvbiByZW1vdmVEdXBsaWNhdGVzKGFyciwgb3B0X3J2LCBvcHRfaGFzaEZuKSB7XG4gIGNvbnN0IHJldHVybkFycmF5ID0gb3B0X3J2IHx8IGFycjtcbiAgY29uc3QgZGVmYXVsdEhhc2hGbiA9IGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAvLyBQcmVmaXggZWFjaCB0eXBlIHdpdGggYSBzaW5nbGUgY2hhcmFjdGVyIHJlcHJlc2VudGluZyB0aGUgdHlwZSB0b1xuICAgIC8vIHByZXZlbnQgY29uZmxpY3Rpbmcga2V5cyAoZS5nLiB0cnVlIGFuZCAndHJ1ZScpLlxuICAgIHJldHVybiBnb29nLmlzT2JqZWN0KGl0ZW0pID8gJ28nICsgZ29vZy5nZXRVaWQoaXRlbSkgOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHR5cGVvZiBpdGVtKS5jaGFyQXQoMCkgKyBpdGVtO1xuICB9O1xuICBjb25zdCBoYXNoRm4gPSBvcHRfaGFzaEZuIHx8IGRlZmF1bHRIYXNoRm47XG5cbiAgbGV0IGN1cnNvckluc2VydCA9IDA7XG4gIGxldCBjdXJzb3JSZWFkID0gMDtcbiAgY29uc3Qgc2VlbiA9IHt9O1xuXG4gIHdoaWxlIChjdXJzb3JSZWFkIDwgYXJyLmxlbmd0aCkge1xuICAgIGNvbnN0IGN1cnJlbnQgPSBhcnJbY3Vyc29yUmVhZCsrXTtcbiAgICBjb25zdCBrZXkgPSBoYXNoRm4oY3VycmVudCk7XG4gICAgaWYgKCFPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoc2Vlbiwga2V5KSkge1xuICAgICAgc2VlbltrZXldID0gdHJ1ZTtcbiAgICAgIHJldHVybkFycmF5W2N1cnNvckluc2VydCsrXSA9IGN1cnJlbnQ7XG4gICAgfVxuICB9XG4gIHJldHVybkFycmF5Lmxlbmd0aCA9IGN1cnNvckluc2VydDtcbn1cbmV4cG9ydHMucmVtb3ZlRHVwbGljYXRlcyA9IHJlbW92ZUR1cGxpY2F0ZXM7XG5cblxuLyoqXG4gKiBTZWFyY2hlcyB0aGUgc3BlY2lmaWVkIGFycmF5IGZvciB0aGUgc3BlY2lmaWVkIHRhcmdldCB1c2luZyB0aGUgYmluYXJ5XG4gKiBzZWFyY2ggYWxnb3JpdGhtLiAgSWYgbm8gb3B0X2NvbXBhcmVGbiBpcyBzcGVjaWZpZWQsIGVsZW1lbnRzIGFyZSBjb21wYXJlZFxuICogdXNpbmcgPGNvZGU+ZGVmYXVsdENvbXBhcmU8L2NvZGU+LCB3aGljaCBjb21wYXJlcyB0aGUgZWxlbWVudHNcbiAqIHVzaW5nIHRoZSBidWlsdCBpbiA8IGFuZCA+IG9wZXJhdG9ycy4gIFRoaXMgd2lsbCBwcm9kdWNlIHRoZSBleHBlY3RlZFxuICogYmVoYXZpb3IgZm9yIGhvbW9nZW5lb3VzIGFycmF5cyBvZiBTdHJpbmcocykgYW5kIE51bWJlcihzKS4gVGhlIGFycmF5XG4gKiBzcGVjaWZpZWQgPGI+bXVzdDwvYj4gYmUgc29ydGVkIGluIGFzY2VuZGluZyBvcmRlciAoYXMgZGVmaW5lZCBieSB0aGVcbiAqIGNvbXBhcmlzb24gZnVuY3Rpb24pLiAgSWYgdGhlIGFycmF5IGlzIG5vdCBzb3J0ZWQsIHJlc3VsdHMgYXJlIHVuZGVmaW5lZC5cbiAqIElmIHRoZSBhcnJheSBjb250YWlucyBtdWx0aXBsZSBpbnN0YW5jZXMgb2YgdGhlIHNwZWNpZmllZCB0YXJnZXQgdmFsdWUsIHRoZVxuICogbGVmdC1tb3N0IGluc3RhbmNlIHdpbGwgYmUgZm91bmQuXG4gKlxuICogUnVudGltZTogTyhsb2cgbilcbiAqXG4gKiBAcGFyYW0ge0lBcnJheUxpa2U8VkFMVUU+fSBhcnIgVGhlIGFycmF5IHRvIGJlIHNlYXJjaGVkLlxuICogQHBhcmFtIHtUQVJHRVR9IHRhcmdldCBUaGUgc291Z2h0IHZhbHVlLlxuICogQHBhcmFtIHtmdW5jdGlvbihUQVJHRVQsIFZBTFVFKTogbnVtYmVyPX0gb3B0X2NvbXBhcmVGbiBPcHRpb25hbCBjb21wYXJpc29uXG4gKiAgICAgZnVuY3Rpb24gYnkgd2hpY2ggdGhlIGFycmF5IGlzIG9yZGVyZWQuIFNob3VsZCB0YWtlIDIgYXJndW1lbnRzIHRvXG4gKiAgICAgY29tcGFyZSwgdGhlIHRhcmdldCB2YWx1ZSBhbmQgYW4gZWxlbWVudCBmcm9tIHlvdXIgYXJyYXksIGFuZCByZXR1cm4gYVxuICogICAgIG5lZ2F0aXZlIG51bWJlciwgemVybywgb3IgYSBwb3NpdGl2ZSBudW1iZXIgZGVwZW5kaW5nIG9uIHdoZXRoZXIgdGhlXG4gKiAgICAgZmlyc3QgYXJndW1lbnQgaXMgbGVzcyB0aGFuLCBlcXVhbCB0bywgb3IgZ3JlYXRlciB0aGFuIHRoZSBzZWNvbmQuXG4gKiBAcmV0dXJuIHtudW1iZXJ9IExvd2VzdCBpbmRleCBvZiB0aGUgdGFyZ2V0IHZhbHVlIGlmIGZvdW5kLCBvdGhlcndpc2VcbiAqICAgICAoLShpbnNlcnRpb24gcG9pbnQpIC0gMSkuIFRoZSBpbnNlcnRpb24gcG9pbnQgaXMgd2hlcmUgdGhlIHZhbHVlIHNob3VsZFxuICogICAgIGJlIGluc2VydGVkIGludG8gYXJyIHRvIHByZXNlcnZlIHRoZSBzb3J0ZWQgcHJvcGVydHkuICBSZXR1cm4gdmFsdWUgPj0gMFxuICogICAgIGlmZiB0YXJnZXQgaXMgZm91bmQuXG4gKiBAdGVtcGxhdGUgVEFSR0VULCBWQUxVRVxuICovXG5mdW5jdGlvbiBiaW5hcnlTZWFyY2goYXJyLCB0YXJnZXQsIG9wdF9jb21wYXJlRm4pIHtcbiAgcmV0dXJuIGJpbmFyeVNlYXJjaF8oXG4gICAgICBhcnIsIG9wdF9jb21wYXJlRm4gfHwgZGVmYXVsdENvbXBhcmUsIGZhbHNlIC8qIGlzRXZhbHVhdG9yICovLCB0YXJnZXQpO1xufVxuZXhwb3J0cy5iaW5hcnlTZWFyY2ggPSBiaW5hcnlTZWFyY2g7XG5cblxuLyoqXG4gKiBTZWxlY3RzIGFuIGluZGV4IGluIHRoZSBzcGVjaWZpZWQgYXJyYXkgdXNpbmcgdGhlIGJpbmFyeSBzZWFyY2ggYWxnb3JpdGhtLlxuICogVGhlIGV2YWx1YXRvciByZWNlaXZlcyBhbiBlbGVtZW50IGFuZCBkZXRlcm1pbmVzIHdoZXRoZXIgdGhlIGRlc2lyZWQgaW5kZXhcbiAqIGlzIGJlZm9yZSwgYXQsIG9yIGFmdGVyIGl0LiAgVGhlIGV2YWx1YXRvciBtdXN0IGJlIGNvbnNpc3RlbnQgKGZvcm1hbGx5LFxuICogbWFwKG1hcChhcnIsIGV2YWx1YXRvciwgb3B0X29iaiksIGdvb2cubWF0aC5zaWduKVxuICogbXVzdCBiZSBtb25vdG9uaWNhbGx5IG5vbi1pbmNyZWFzaW5nKS5cbiAqXG4gKiBSdW50aW1lOiBPKGxvZyBuKVxuICpcbiAqIEBwYXJhbSB7SUFycmF5TGlrZTxWQUxVRT59IGFyciBUaGUgYXJyYXkgdG8gYmUgc2VhcmNoZWQuXG4gKiBAcGFyYW0ge2Z1bmN0aW9uKHRoaXM6VEhJUywgVkFMVUUsIG51bWJlciwgPyk6IG51bWJlcn0gZXZhbHVhdG9yXG4gKiAgICAgRXZhbHVhdG9yIGZ1bmN0aW9uIHRoYXQgcmVjZWl2ZXMgMyBhcmd1bWVudHMgKHRoZSBlbGVtZW50LCB0aGUgaW5kZXggYW5kXG4gKiAgICAgdGhlIGFycmF5KS4gU2hvdWxkIHJldHVybiBhIG5lZ2F0aXZlIG51bWJlciwgemVybywgb3IgYSBwb3NpdGl2ZSBudW1iZXJcbiAqICAgICBkZXBlbmRpbmcgb24gd2hldGhlciB0aGUgZGVzaXJlZCBpbmRleCBpcyBiZWZvcmUsIGF0LCBvciBhZnRlciB0aGVcbiAqICAgICBlbGVtZW50IHBhc3NlZCB0byBpdC5cbiAqIEBwYXJhbSB7VEhJUz19IG9wdF9vYmogVGhlIG9iamVjdCB0byBiZSB1c2VkIGFzIHRoZSB2YWx1ZSBvZiAndGhpcydcbiAqICAgICB3aXRoaW4gZXZhbHVhdG9yLlxuICogQHJldHVybiB7bnVtYmVyfSBJbmRleCBvZiB0aGUgbGVmdG1vc3QgZWxlbWVudCBtYXRjaGVkIGJ5IHRoZSBldmFsdWF0b3IsIGlmXG4gKiAgICAgc3VjaCBleGlzdHM7IG90aGVyd2lzZSAoLShpbnNlcnRpb24gcG9pbnQpIC0gMSkuIFRoZSBpbnNlcnRpb24gcG9pbnQgaXNcbiAqICAgICB0aGUgaW5kZXggb2YgdGhlIGZpcnN0IGVsZW1lbnQgZm9yIHdoaWNoIHRoZSBldmFsdWF0b3IgcmV0dXJucyBuZWdhdGl2ZSxcbiAqICAgICBvciBhcnIubGVuZ3RoIGlmIG5vIHN1Y2ggZWxlbWVudCBleGlzdHMuIFRoZSByZXR1cm4gdmFsdWUgaXMgbm9uLW5lZ2F0aXZlXG4gKiAgICAgaWZmIGEgbWF0Y2ggaXMgZm91bmQuXG4gKiBAdGVtcGxhdGUgVEhJUywgVkFMVUVcbiAqL1xuZnVuY3Rpb24gYmluYXJ5U2VsZWN0KGFyciwgZXZhbHVhdG9yLCBvcHRfb2JqKSB7XG4gIHJldHVybiBiaW5hcnlTZWFyY2hfKFxuICAgICAgYXJyLCBldmFsdWF0b3IsIHRydWUgLyogaXNFdmFsdWF0b3IgKi8sIHVuZGVmaW5lZCAvKiBvcHRfdGFyZ2V0ICovLFxuICAgICAgb3B0X29iaik7XG59XG5leHBvcnRzLmJpbmFyeVNlbGVjdCA9IGJpbmFyeVNlbGVjdDtcblxuXG4vKipcbiAqIEltcGxlbWVudGF0aW9uIG9mIGEgYmluYXJ5IHNlYXJjaCBhbGdvcml0aG0gd2hpY2gga25vd3MgaG93IHRvIHVzZSBib3RoXG4gKiBjb21wYXJpc29uIGZ1bmN0aW9ucyBhbmQgZXZhbHVhdG9ycy4gSWYgYW4gZXZhbHVhdG9yIGlzIHByb3ZpZGVkLCB3aWxsIGNhbGxcbiAqIHRoZSBldmFsdWF0b3Igd2l0aCB0aGUgZ2l2ZW4gb3B0aW9uYWwgZGF0YSBvYmplY3QsIGNvbmZvcm1pbmcgdG8gdGhlXG4gKiBpbnRlcmZhY2UgZGVmaW5lZCBpbiBiaW5hcnlTZWxlY3QuIE90aGVyd2lzZSwgaWYgYSBjb21wYXJpc29uIGZ1bmN0aW9uIGlzXG4gKiBwcm92aWRlZCwgd2lsbCBjYWxsIHRoZSBjb21wYXJpc29uIGZ1bmN0aW9uIGFnYWluc3QgdGhlIGdpdmVuIGRhdGEgb2JqZWN0LlxuICpcbiAqIFRoaXMgaW1wbGVtZW50YXRpb24gcHVycG9zZWZ1bGx5IGRvZXMgbm90IHVzZSBnb29nLmJpbmQgb3IgZ29vZy5wYXJ0aWFsIGZvclxuICogcGVyZm9ybWFuY2UgcmVhc29ucy5cbiAqXG4gKiBSdW50aW1lOiBPKGxvZyBuKVxuICpcbiAqIEBwYXJhbSB7SUFycmF5TGlrZTw/Pn0gYXJyIFRoZSBhcnJheSB0byBiZSBzZWFyY2hlZC5cbiAqIEBwYXJhbSB7ZnVuY3Rpb24oPywgPywgPyk6IG51bWJlciB8IGZ1bmN0aW9uKD8sID8pOiBudW1iZXJ9IGNvbXBhcmVGblxuICogICAgIEVpdGhlciBhbiBldmFsdWF0b3Igb3IgYSBjb21wYXJpc29uIGZ1bmN0aW9uLCBhcyBkZWZpbmVkIGJ5IGJpbmFyeVNlYXJjaFxuICogICAgIGFuZCBiaW5hcnlTZWxlY3QgYWJvdmUuXG4gKiBAcGFyYW0ge2Jvb2xlYW59IGlzRXZhbHVhdG9yIFdoZXRoZXIgdGhlIGZ1bmN0aW9uIGlzIGFuIGV2YWx1YXRvciBvciBhXG4gKiAgICAgY29tcGFyaXNvbiBmdW5jdGlvbi5cbiAqIEBwYXJhbSB7Pz19IG9wdF90YXJnZXQgSWYgdGhlIGZ1bmN0aW9uIGlzIGEgY29tcGFyaXNvbiBmdW5jdGlvbiwgdGhlblxuICogICAgIHRoaXMgaXMgdGhlIHRhcmdldCB0byBiaW5hcnkgc2VhcmNoIGZvci5cbiAqIEBwYXJhbSB7T2JqZWN0PX0gb3B0X3NlbGZPYmogSWYgdGhlIGZ1bmN0aW9uIGlzIGFuIGV2YWx1YXRvciwgdGhpcyBpcyBhblxuICogICAgIG9wdGlvbmFsIHRoaXMgb2JqZWN0IGZvciB0aGUgZXZhbHVhdG9yLlxuICogQHJldHVybiB7bnVtYmVyfSBMb3dlc3QgaW5kZXggb2YgdGhlIHRhcmdldCB2YWx1ZSBpZiBmb3VuZCwgb3RoZXJ3aXNlXG4gKiAgICAgKC0oaW5zZXJ0aW9uIHBvaW50KSAtIDEpLiBUaGUgaW5zZXJ0aW9uIHBvaW50IGlzIHdoZXJlIHRoZSB2YWx1ZSBzaG91bGRcbiAqICAgICBiZSBpbnNlcnRlZCBpbnRvIGFyciB0byBwcmVzZXJ2ZSB0aGUgc29ydGVkIHByb3BlcnR5LiAgUmV0dXJuIHZhbHVlID49IDBcbiAqICAgICBpZmYgdGFyZ2V0IGlzIGZvdW5kLlxuICogQHByaXZhdGVcbiAqL1xuZnVuY3Rpb24gYmluYXJ5U2VhcmNoXyhhcnIsIGNvbXBhcmVGbiwgaXNFdmFsdWF0b3IsIG9wdF90YXJnZXQsIG9wdF9zZWxmT2JqKSB7XG4gIGxldCBsZWZ0ID0gMDsgICAgICAgICAgICAvLyBpbmNsdXNpdmVcbiAgbGV0IHJpZ2h0ID0gYXJyLmxlbmd0aDsgIC8vIGV4Y2x1c2l2ZVxuICBsZXQgZm91bmQ7XG4gIHdoaWxlIChsZWZ0IDwgcmlnaHQpIHtcbiAgICBjb25zdCBtaWRkbGUgPSBsZWZ0ICsgKChyaWdodCAtIGxlZnQpID4+PiAxKTtcbiAgICBsZXQgY29tcGFyZVJlc3VsdDtcbiAgICBpZiAoaXNFdmFsdWF0b3IpIHtcbiAgICAgIGNvbXBhcmVSZXN1bHQgPSBjb21wYXJlRm4uY2FsbChvcHRfc2VsZk9iaiwgYXJyW21pZGRsZV0sIG1pZGRsZSwgYXJyKTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gTk9URShkaW12YXIpOiBUbyBhdm9pZCB0aGlzIGNhc3QsIHdlJ2QgaGF2ZSB0byB1c2UgZnVuY3Rpb24gb3ZlcmxvYWRpbmdcbiAgICAgIC8vIGZvciB0aGUgdHlwZSBvZiBiaW5hcnlTZWFyY2hfLCB3aGljaCB0aGUgdHlwZSBzeXN0ZW0gY2FuJ3QgZXhwcmVzcyB5ZXQuXG4gICAgICBjb21wYXJlUmVzdWx0ID0gLyoqIEB0eXBlIHtmdW5jdGlvbig/LCA/KTogbnVtYmVyfSAqLyAoY29tcGFyZUZuKShcbiAgICAgICAgICBvcHRfdGFyZ2V0LCBhcnJbbWlkZGxlXSk7XG4gICAgfVxuICAgIGlmIChjb21wYXJlUmVzdWx0ID4gMCkge1xuICAgICAgbGVmdCA9IG1pZGRsZSArIDE7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJpZ2h0ID0gbWlkZGxlO1xuICAgICAgLy8gV2UgYXJlIGxvb2tpbmcgZm9yIHRoZSBsb3dlc3QgaW5kZXggc28gd2UgY2FuJ3QgcmV0dXJuIGltbWVkaWF0ZWx5LlxuICAgICAgZm91bmQgPSAhY29tcGFyZVJlc3VsdDtcbiAgICB9XG4gIH1cbiAgLy8gbGVmdCBpcyB0aGUgaW5kZXggaWYgZm91bmQsIG9yIHRoZSBpbnNlcnRpb24gcG9pbnQgb3RoZXJ3aXNlLlxuICAvLyBBdm9pZGluZyBiaXR3aXNlIG5vdCBvcGVyYXRvciwgYXMgdGhhdCBjYXVzZXMgYSBsb3NzIGluIHByZWNpc2lvbiBmb3IgYXJyYXlcbiAgLy8gaW5kZXhlcyBvdXRzaWRlIHRoZSBib3VuZHMgb2YgYSAzMi1iaXQgc2lnbmVkIGludGVnZXIuICBBcnJheSBpbmRleGVzIGhhdmVcbiAgLy8gYSBtYXhpbXVtIHZhbHVlIG9mIDJeMzItMiBodHRwczovL3RjMzkuZXMvZWNtYTI2Mi8jYXJyYXktaW5kZXhcbiAgcmV0dXJuIGZvdW5kID8gbGVmdCA6IC1sZWZ0IC0gMTtcbn1cblxuXG4vKipcbiAqIFNvcnRzIHRoZSBzcGVjaWZpZWQgYXJyYXkgaW50byBhc2NlbmRpbmcgb3JkZXIuICBJZiBubyBvcHRfY29tcGFyZUZuIGlzXG4gKiBzcGVjaWZpZWQsIGVsZW1lbnRzIGFyZSBjb21wYXJlZCB1c2luZ1xuICogPGNvZGU+ZGVmYXVsdENvbXBhcmU8L2NvZGU+LCB3aGljaCBjb21wYXJlcyB0aGUgZWxlbWVudHMgdXNpbmdcbiAqIHRoZSBidWlsdCBpbiA8IGFuZCA+IG9wZXJhdG9ycy4gIFRoaXMgd2lsbCBwcm9kdWNlIHRoZSBleHBlY3RlZCBiZWhhdmlvclxuICogZm9yIGhvbW9nZW5lb3VzIGFycmF5cyBvZiBTdHJpbmcocykgYW5kIE51bWJlcihzKSwgdW5saWtlIHRoZSBuYXRpdmUgc29ydCxcbiAqIGJ1dCB3aWxsIGdpdmUgdW5wcmVkaWN0YWJsZSByZXN1bHRzIGZvciBoZXRlcm9nZW5lb3VzIGxpc3RzIG9mIHN0cmluZ3MgYW5kXG4gKiBudW1iZXJzIHdpdGggZGlmZmVyZW50IG51bWJlcnMgb2YgZGlnaXRzLlxuICpcbiAqIFRoaXMgc29ydCBpcyBub3QgZ3VhcmFudGVlZCB0byBiZSBzdGFibGUuXG4gKlxuICogUnVudGltZTogU2FtZSBhcyBgQXJyYXkucHJvdG90eXBlLnNvcnRgXG4gKlxuICogQHBhcmFtIHtBcnJheTxUPn0gYXJyIFRoZSBhcnJheSB0byBiZSBzb3J0ZWQuXG4gKiBAcGFyYW0gez9mdW5jdGlvbihULFQpOm51bWJlcj19IG9wdF9jb21wYXJlRm4gT3B0aW9uYWwgY29tcGFyaXNvblxuICogICAgIGZ1bmN0aW9uIGJ5IHdoaWNoIHRoZVxuICogICAgIGFycmF5IGlzIHRvIGJlIG9yZGVyZWQuIFNob3VsZCB0YWtlIDIgYXJndW1lbnRzIHRvIGNvbXBhcmUsIGFuZCByZXR1cm4gYVxuICogICAgIG5lZ2F0aXZlIG51bWJlciwgemVybywgb3IgYSBwb3NpdGl2ZSBudW1iZXIgZGVwZW5kaW5nIG9uIHdoZXRoZXIgdGhlXG4gKiAgICAgZmlyc3QgYXJndW1lbnQgaXMgbGVzcyB0aGFuLCBlcXVhbCB0bywgb3IgZ3JlYXRlciB0aGFuIHRoZSBzZWNvbmQuXG4gKiBAdGVtcGxhdGUgVFxuICovXG5mdW5jdGlvbiBzb3J0KGFyciwgb3B0X2NvbXBhcmVGbikge1xuICAvLyBUT0RPKGFydik6IFVwZGF0ZSB0eXBlIGFubm90YXRpb24gc2luY2UgbnVsbCBpcyBub3QgYWNjZXB0ZWQuXG4gIGFyci5zb3J0KG9wdF9jb21wYXJlRm4gfHwgZGVmYXVsdENvbXBhcmUpO1xufVxuZXhwb3J0cy5zb3J0ID0gc29ydDtcblxuXG4vKipcbiAqIFNvcnRzIHRoZSBzcGVjaWZpZWQgYXJyYXkgaW50byBhc2NlbmRpbmcgb3JkZXIgaW4gYSBzdGFibGUgd2F5LiAgSWYgbm9cbiAqIG9wdF9jb21wYXJlRm4gaXMgc3BlY2lmaWVkLCBlbGVtZW50cyBhcmUgY29tcGFyZWQgdXNpbmdcbiAqIDxjb2RlPmRlZmF1bHRDb21wYXJlPC9jb2RlPiwgd2hpY2ggY29tcGFyZXMgdGhlIGVsZW1lbnRzIHVzaW5nXG4gKiB0aGUgYnVpbHQgaW4gPCBhbmQgPiBvcGVyYXRvcnMuICBUaGlzIHdpbGwgcHJvZHVjZSB0aGUgZXhwZWN0ZWQgYmVoYXZpb3JcbiAqIGZvciBob21vZ2VuZW91cyBhcnJheXMgb2YgU3RyaW5nKHMpIGFuZCBOdW1iZXIocykuXG4gKlxuICogUnVudGltZTogU2FtZSBhcyBgQXJyYXkucHJvdG90eXBlLnNvcnRgLCBwbHVzIGFuIGFkZGl0aW9uYWxcbiAqIE8obikgb3ZlcmhlYWQgb2YgY29weWluZyB0aGUgYXJyYXkgdHdpY2UuXG4gKlxuICogQHBhcmFtIHtBcnJheTxUPn0gYXJyIFRoZSBhcnJheSB0byBiZSBzb3J0ZWQuXG4gKiBAcGFyYW0gez9mdW5jdGlvbihULCBUKTogbnVtYmVyPX0gb3B0X2NvbXBhcmVGbiBPcHRpb25hbCBjb21wYXJpc29uIGZ1bmN0aW9uXG4gKiAgICAgYnkgd2hpY2ggdGhlIGFycmF5IGlzIHRvIGJlIG9yZGVyZWQuIFNob3VsZCB0YWtlIDIgYXJndW1lbnRzIHRvIGNvbXBhcmUsXG4gKiAgICAgYW5kIHJldHVybiBhIG5lZ2F0aXZlIG51bWJlciwgemVybywgb3IgYSBwb3NpdGl2ZSBudW1iZXIgZGVwZW5kaW5nIG9uXG4gKiAgICAgd2hldGhlciB0aGUgZmlyc3QgYXJndW1lbnQgaXMgbGVzcyB0aGFuLCBlcXVhbCB0bywgb3IgZ3JlYXRlciB0aGFuIHRoZVxuICogICAgIHNlY29uZC5cbiAqIEB0ZW1wbGF0ZSBUXG4gKi9cbmZ1bmN0aW9uIHN0YWJsZVNvcnQoYXJyLCBvcHRfY29tcGFyZUZuKSB7XG4gIGNvbnN0IGNvbXBBcnIgPSBuZXcgQXJyYXkoYXJyLmxlbmd0aCk7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgYXJyLmxlbmd0aDsgaSsrKSB7XG4gICAgY29tcEFycltpXSA9IHtpbmRleDogaSwgdmFsdWU6IGFycltpXX07XG4gIH1cbiAgY29uc3QgdmFsdWVDb21wYXJlRm4gPSBvcHRfY29tcGFyZUZuIHx8IGRlZmF1bHRDb21wYXJlO1xuICBmdW5jdGlvbiBzdGFibGVDb21wYXJlRm4ob2JqMSwgb2JqMikge1xuICAgIHJldHVybiB2YWx1ZUNvbXBhcmVGbihvYmoxLnZhbHVlLCBvYmoyLnZhbHVlKSB8fCBvYmoxLmluZGV4IC0gb2JqMi5pbmRleDtcbiAgfVxuICBzb3J0KGNvbXBBcnIsIHN0YWJsZUNvbXBhcmVGbik7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgYXJyLmxlbmd0aDsgaSsrKSB7XG4gICAgYXJyW2ldID0gY29tcEFycltpXS52YWx1ZTtcbiAgfVxufVxuZXhwb3J0cy5zdGFibGVTb3J0ID0gc3RhYmxlU29ydDtcblxuXG4vKipcbiAqIFNvcnQgdGhlIHNwZWNpZmllZCBhcnJheSBpbnRvIGFzY2VuZGluZyBvcmRlciBiYXNlZCBvbiBpdGVtIGtleXNcbiAqIHJldHVybmVkIGJ5IHRoZSBzcGVjaWZpZWQga2V5IGZ1bmN0aW9uLlxuICogSWYgbm8gb3B0X2NvbXBhcmVGbiBpcyBzcGVjaWZpZWQsIHRoZSBrZXlzIGFyZSBjb21wYXJlZCBpbiBhc2NlbmRpbmcgb3JkZXJcbiAqIHVzaW5nIDxjb2RlPmRlZmF1bHRDb21wYXJlPC9jb2RlPi5cbiAqXG4gKiBSdW50aW1lOiBPKFMoZihuKSksIHdoZXJlIFMgaXMgcnVudGltZSBvZiA8Y29kZT5zb3J0PC9jb2RlPlxuICogYW5kIGYobikgaXMgcnVudGltZSBvZiB0aGUga2V5IGZ1bmN0aW9uLlxuICpcbiAqIEBwYXJhbSB7QXJyYXk8VD59IGFyciBUaGUgYXJyYXkgdG8gYmUgc29ydGVkLlxuICogQHBhcmFtIHtmdW5jdGlvbihUKTogS30ga2V5Rm4gRnVuY3Rpb24gdGFraW5nIGFycmF5IGVsZW1lbnQgYW5kIHJldHVybmluZ1xuICogICAgIGEga2V5IHVzZWQgZm9yIHNvcnRpbmcgdGhpcyBlbGVtZW50LlxuICogQHBhcmFtIHs/ZnVuY3Rpb24oSywgSyk6IG51bWJlcj19IG9wdF9jb21wYXJlRm4gT3B0aW9uYWwgY29tcGFyaXNvbiBmdW5jdGlvblxuICogICAgIGJ5IHdoaWNoIHRoZSBrZXlzIGFyZSB0byBiZSBvcmRlcmVkLiBTaG91bGQgdGFrZSAyIGFyZ3VtZW50cyB0byBjb21wYXJlLFxuICogICAgIGFuZCByZXR1cm4gYSBuZWdhdGl2ZSBudW1iZXIsIHplcm8sIG9yIGEgcG9zaXRpdmUgbnVtYmVyIGRlcGVuZGluZyBvblxuICogICAgIHdoZXRoZXIgdGhlIGZpcnN0IGFyZ3VtZW50IGlzIGxlc3MgdGhhbiwgZXF1YWwgdG8sIG9yIGdyZWF0ZXIgdGhhbiB0aGVcbiAqICAgICBzZWNvbmQuXG4gKiBAdGVtcGxhdGUgVCxLXG4gKi9cbmZ1bmN0aW9uIHNvcnRCeUtleShhcnIsIGtleUZuLCBvcHRfY29tcGFyZUZuKSB7XG4gIGNvbnN0IGtleUNvbXBhcmVGbiA9IG9wdF9jb21wYXJlRm4gfHwgZGVmYXVsdENvbXBhcmU7XG4gIHNvcnQoYXJyLCBmdW5jdGlvbihhLCBiKSB7XG4gICAgcmV0dXJuIGtleUNvbXBhcmVGbihrZXlGbihhKSwga2V5Rm4oYikpO1xuICB9KTtcbn1cbmV4cG9ydHMuc29ydEJ5S2V5ID0gc29ydEJ5S2V5O1xuXG5cbi8qKlxuICogU29ydHMgYW4gYXJyYXkgb2Ygb2JqZWN0cyBieSB0aGUgc3BlY2lmaWVkIG9iamVjdCBrZXkgYW5kIGNvbXBhcmVcbiAqIGZ1bmN0aW9uLiBJZiBubyBjb21wYXJlIGZ1bmN0aW9uIGlzIHByb3ZpZGVkLCB0aGUga2V5IHZhbHVlcyBhcmVcbiAqIGNvbXBhcmVkIGluIGFzY2VuZGluZyBvcmRlciB1c2luZyA8Y29kZT5kZWZhdWx0Q29tcGFyZTwvY29kZT4uXG4gKiBUaGlzIHdvbid0IHdvcmsgZm9yIGtleXMgdGhhdCBnZXQgcmVuYW1lZCBieSB0aGUgY29tcGlsZXIuIFNvIHVzZVxuICogeydmb28nOiAxLCAnYmFyJzogMn0gcmF0aGVyIHRoYW4ge2ZvbzogMSwgYmFyOiAyfS5cbiAqIEBwYXJhbSB7QXJyYXk8T2JqZWN0Pn0gYXJyIEFuIGFycmF5IG9mIG9iamVjdHMgdG8gc29ydC5cbiAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIG9iamVjdCBrZXkgdG8gc29ydCBieS5cbiAqIEBwYXJhbSB7RnVuY3Rpb249fSBvcHRfY29tcGFyZUZuIFRoZSBmdW5jdGlvbiB0byB1c2UgdG8gY29tcGFyZSBrZXlcbiAqICAgICB2YWx1ZXMuXG4gKi9cbmZ1bmN0aW9uIHNvcnRPYmplY3RzQnlLZXkoYXJyLCBrZXksIG9wdF9jb21wYXJlRm4pIHtcbiAgc29ydEJ5S2V5KGFyciwgZnVuY3Rpb24ob2JqKSB7XG4gICAgcmV0dXJuIG9ialtrZXldO1xuICB9LCBvcHRfY29tcGFyZUZuKTtcbn1cbmV4cG9ydHMuc29ydE9iamVjdHNCeUtleSA9IHNvcnRPYmplY3RzQnlLZXk7XG5cblxuLyoqXG4gKiBUZWxscyBpZiB0aGUgYXJyYXkgaXMgc29ydGVkLlxuICogQHBhcmFtIHshSUFycmF5TGlrZTxUPn0gYXJyIFRoZSBhcnJheS5cbiAqIEBwYXJhbSB7P2Z1bmN0aW9uKFQsVCk6bnVtYmVyPX0gb3B0X2NvbXBhcmVGbiBGdW5jdGlvbiB0byBjb21wYXJlIHRoZVxuICogICAgIGFycmF5IGVsZW1lbnRzLlxuICogICAgIFNob3VsZCB0YWtlIDIgYXJndW1lbnRzIHRvIGNvbXBhcmUsIGFuZCByZXR1cm4gYSBuZWdhdGl2ZSBudW1iZXIsIHplcm8sXG4gKiAgICAgb3IgYSBwb3NpdGl2ZSBudW1iZXIgZGVwZW5kaW5nIG9uIHdoZXRoZXIgdGhlIGZpcnN0IGFyZ3VtZW50IGlzIGxlc3NcbiAqICAgICB0aGFuLCBlcXVhbCB0bywgb3IgZ3JlYXRlciB0aGFuIHRoZSBzZWNvbmQuXG4gKiBAcGFyYW0ge2Jvb2xlYW49fSBvcHRfc3RyaWN0IElmIHRydWUgbm8gZXF1YWwgZWxlbWVudHMgYXJlIGFsbG93ZWQuXG4gKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoZSBhcnJheSBpcyBzb3J0ZWQuXG4gKiBAdGVtcGxhdGUgVFxuICovXG5mdW5jdGlvbiBpc1NvcnRlZChhcnIsIG9wdF9jb21wYXJlRm4sIG9wdF9zdHJpY3QpIHtcbiAgY29uc3QgY29tcGFyZSA9IG9wdF9jb21wYXJlRm4gfHwgZGVmYXVsdENvbXBhcmU7XG4gIGZvciAobGV0IGkgPSAxOyBpIDwgYXJyLmxlbmd0aDsgaSsrKSB7XG4gICAgY29uc3QgY29tcGFyZVJlc3VsdCA9IGNvbXBhcmUoYXJyW2kgLSAxXSwgYXJyW2ldKTtcbiAgICBpZiAoY29tcGFyZVJlc3VsdCA+IDAgfHwgY29tcGFyZVJlc3VsdCA9PSAwICYmIG9wdF9zdHJpY3QpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLmlzU29ydGVkID0gaXNTb3J0ZWQ7XG5cblxuLyoqXG4gKiBDb21wYXJlcyB0d28gYXJyYXlzIGZvciBlcXVhbGl0eS4gVHdvIGFycmF5cyBhcmUgY29uc2lkZXJlZCBlcXVhbCBpZiB0aGV5XG4gKiBoYXZlIHRoZSBzYW1lIGxlbmd0aCBhbmQgdGhlaXIgY29ycmVzcG9uZGluZyBlbGVtZW50cyBhcmUgZXF1YWwgYWNjb3JkaW5nIHRvXG4gKiB0aGUgY29tcGFyaXNvbiBmdW5jdGlvbi5cbiAqXG4gKiBAcGFyYW0ge0lBcnJheUxpa2U8QT59IGFycjEgVGhlIGZpcnN0IGFycmF5IHRvIGNvbXBhcmUuXG4gKiBAcGFyYW0ge0lBcnJheUxpa2U8Qj59IGFycjIgVGhlIHNlY29uZCBhcnJheSB0byBjb21wYXJlLlxuICogQHBhcmFtIHs/ZnVuY3Rpb24oQSxCKTpib29sZWFuPX0gb3B0X2VxdWFsc0ZuIE9wdGlvbmFsIGNvbXBhcmlzb24gZnVuY3Rpb24uXG4gKiAgICAgU2hvdWxkIHRha2UgMiBhcmd1bWVudHMgdG8gY29tcGFyZSwgYW5kIHJldHVybiB0cnVlIGlmIHRoZSBhcmd1bWVudHNcbiAqICAgICBhcmUgZXF1YWwuIERlZmF1bHRzIHRvIHtAbGluayBnb29nLmFycmF5LmRlZmF1bHRDb21wYXJlRXF1YWxpdHl9IHdoaWNoXG4gKiAgICAgY29tcGFyZXMgdGhlIGVsZW1lbnRzIHVzaW5nIHRoZSBidWlsdC1pbiAnPT09JyBvcGVyYXRvci5cbiAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgdGhlIHR3byBhcnJheXMgYXJlIGVxdWFsLlxuICogQHRlbXBsYXRlIEFcbiAqIEB0ZW1wbGF0ZSBCXG4gKi9cbmZ1bmN0aW9uIGVxdWFscyhhcnIxLCBhcnIyLCBvcHRfZXF1YWxzRm4pIHtcbiAgaWYgKCFnb29nLmlzQXJyYXlMaWtlKGFycjEpIHx8ICFnb29nLmlzQXJyYXlMaWtlKGFycjIpIHx8XG4gICAgICBhcnIxLmxlbmd0aCAhPSBhcnIyLmxlbmd0aCkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICBjb25zdCBsID0gYXJyMS5sZW5ndGg7XG4gIGNvbnN0IGVxdWFsc0ZuID0gb3B0X2VxdWFsc0ZuIHx8IGRlZmF1bHRDb21wYXJlRXF1YWxpdHk7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgbDsgaSsrKSB7XG4gICAgaWYgKCFlcXVhbHNGbihhcnIxW2ldLCBhcnIyW2ldKSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuZXF1YWxzID0gZXF1YWxzO1xuXG5cbi8qKlxuICogMy13YXkgYXJyYXkgY29tcGFyZSBmdW5jdGlvbi5cbiAqIEBwYXJhbSB7IUlBcnJheUxpa2U8VkFMVUU+fSBhcnIxIFRoZSBmaXJzdCBhcnJheSB0b1xuICogICAgIGNvbXBhcmUuXG4gKiBAcGFyYW0geyFJQXJyYXlMaWtlPFZBTFVFPn0gYXJyMiBUaGUgc2Vjb25kIGFycmF5IHRvXG4gKiAgICAgY29tcGFyZS5cbiAqIEBwYXJhbSB7ZnVuY3Rpb24oVkFMVUUsIFZBTFVFKTogbnVtYmVyPX0gb3B0X2NvbXBhcmVGbiBPcHRpb25hbCBjb21wYXJpc29uXG4gKiAgICAgZnVuY3Rpb24gYnkgd2hpY2ggdGhlIGFycmF5IGlzIHRvIGJlIG9yZGVyZWQuIFNob3VsZCB0YWtlIDIgYXJndW1lbnRzIHRvXG4gKiAgICAgY29tcGFyZSwgYW5kIHJldHVybiBhIG5lZ2F0aXZlIG51bWJlciwgemVybywgb3IgYSBwb3NpdGl2ZSBudW1iZXJcbiAqICAgICBkZXBlbmRpbmcgb24gd2hldGhlciB0aGUgZmlyc3QgYXJndW1lbnQgaXMgbGVzcyB0aGFuLCBlcXVhbCB0bywgb3JcbiAqICAgICBncmVhdGVyIHRoYW4gdGhlIHNlY29uZC5cbiAqIEByZXR1cm4ge251bWJlcn0gTmVnYXRpdmUgbnVtYmVyLCB6ZXJvLCBvciBhIHBvc2l0aXZlIG51bWJlciBkZXBlbmRpbmcgb25cbiAqICAgICB3aGV0aGVyIHRoZSBmaXJzdCBhcmd1bWVudCBpcyBsZXNzIHRoYW4sIGVxdWFsIHRvLCBvciBncmVhdGVyIHRoYW4gdGhlXG4gKiAgICAgc2Vjb25kLlxuICogQHRlbXBsYXRlIFZBTFVFXG4gKi9cbmZ1bmN0aW9uIGNvbXBhcmUzKGFycjEsIGFycjIsIG9wdF9jb21wYXJlRm4pIHtcbiAgY29uc3QgY29tcGFyZSA9IG9wdF9jb21wYXJlRm4gfHwgZGVmYXVsdENvbXBhcmU7XG4gIGNvbnN0IGwgPSBNYXRoLm1pbihhcnIxLmxlbmd0aCwgYXJyMi5sZW5ndGgpO1xuICBmb3IgKGxldCBpID0gMDsgaSA8IGw7IGkrKykge1xuICAgIGNvbnN0IHJlc3VsdCA9IGNvbXBhcmUoYXJyMVtpXSwgYXJyMltpXSk7XG4gICAgaWYgKHJlc3VsdCAhPSAwKSB7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cbiAgfVxuICByZXR1cm4gZGVmYXVsdENvbXBhcmUoYXJyMS5sZW5ndGgsIGFycjIubGVuZ3RoKTtcbn1cbmV4cG9ydHMuY29tcGFyZTMgPSBjb21wYXJlMztcblxuXG4vKipcbiAqIENvbXBhcmVzIGl0cyB0d28gYXJndW1lbnRzIGZvciBvcmRlciwgdXNpbmcgdGhlIGJ1aWx0IGluIDwgYW5kID5cbiAqIG9wZXJhdG9ycy5cbiAqIEBwYXJhbSB7VkFMVUV9IGEgVGhlIGZpcnN0IG9iamVjdCB0byBiZSBjb21wYXJlZC5cbiAqIEBwYXJhbSB7VkFMVUV9IGIgVGhlIHNlY29uZCBvYmplY3QgdG8gYmUgY29tcGFyZWQuXG4gKiBAcmV0dXJuIHtudW1iZXJ9IEEgbmVnYXRpdmUgbnVtYmVyLCB6ZXJvLCBvciBhIHBvc2l0aXZlIG51bWJlciBhcyB0aGUgZmlyc3RcbiAqICAgICBhcmd1bWVudCBpcyBsZXNzIHRoYW4sIGVxdWFsIHRvLCBvciBncmVhdGVyIHRoYW4gdGhlIHNlY29uZCxcbiAqICAgICByZXNwZWN0aXZlbHkuXG4gKiBAdGVtcGxhdGUgVkFMVUVcbiAqL1xuZnVuY3Rpb24gZGVmYXVsdENvbXBhcmUoYSwgYikge1xuICByZXR1cm4gYSA+IGIgPyAxIDogYSA8IGIgPyAtMSA6IDA7XG59XG5leHBvcnRzLmRlZmF1bHRDb21wYXJlID0gZGVmYXVsdENvbXBhcmU7XG5cblxuLyoqXG4gKiBDb21wYXJlcyBpdHMgdHdvIGFyZ3VtZW50cyBmb3IgaW52ZXJzZSBvcmRlciwgdXNpbmcgdGhlIGJ1aWx0IGluIDwgYW5kID5cbiAqIG9wZXJhdG9ycy5cbiAqIEBwYXJhbSB7VkFMVUV9IGEgVGhlIGZpcnN0IG9iamVjdCB0byBiZSBjb21wYXJlZC5cbiAqIEBwYXJhbSB7VkFMVUV9IGIgVGhlIHNlY29uZCBvYmplY3QgdG8gYmUgY29tcGFyZWQuXG4gKiBAcmV0dXJuIHtudW1iZXJ9IEEgbmVnYXRpdmUgbnVtYmVyLCB6ZXJvLCBvciBhIHBvc2l0aXZlIG51bWJlciBhcyB0aGUgZmlyc3RcbiAqICAgICBhcmd1bWVudCBpcyBncmVhdGVyIHRoYW4sIGVxdWFsIHRvLCBvciBsZXNzIHRoYW4gdGhlIHNlY29uZCxcbiAqICAgICByZXNwZWN0aXZlbHkuXG4gKiBAdGVtcGxhdGUgVkFMVUVcbiAqL1xuZnVuY3Rpb24gaW52ZXJzZURlZmF1bHRDb21wYXJlKGEsIGIpIHtcbiAgcmV0dXJuIC1kZWZhdWx0Q29tcGFyZShhLCBiKTtcbn1cbmV4cG9ydHMuaW52ZXJzZURlZmF1bHRDb21wYXJlID0gaW52ZXJzZURlZmF1bHRDb21wYXJlO1xuXG5cbi8qKlxuICogQ29tcGFyZXMgaXRzIHR3byBhcmd1bWVudHMgZm9yIGVxdWFsaXR5LCB1c2luZyB0aGUgYnVpbHQgaW4gPT09IG9wZXJhdG9yLlxuICogQHBhcmFtIHsqfSBhIFRoZSBmaXJzdCBvYmplY3QgdG8gY29tcGFyZS5cbiAqIEBwYXJhbSB7Kn0gYiBUaGUgc2Vjb25kIG9iamVjdCB0byBjb21wYXJlLlxuICogQHJldHVybiB7Ym9vbGVhbn0gVHJ1ZSBpZiB0aGUgdHdvIGFyZ3VtZW50cyBhcmUgZXF1YWwsIGZhbHNlIG90aGVyd2lzZS5cbiAqL1xuZnVuY3Rpb24gZGVmYXVsdENvbXBhcmVFcXVhbGl0eShhLCBiKSB7XG4gIHJldHVybiBhID09PSBiO1xufVxuZXhwb3J0cy5kZWZhdWx0Q29tcGFyZUVxdWFsaXR5ID0gZGVmYXVsdENvbXBhcmVFcXVhbGl0eTtcblxuXG4vKipcbiAqIEluc2VydHMgYSB2YWx1ZSBpbnRvIGEgc29ydGVkIGFycmF5LiBUaGUgYXJyYXkgaXMgbm90IG1vZGlmaWVkIGlmIHRoZVxuICogdmFsdWUgaXMgYWxyZWFkeSBwcmVzZW50LlxuICogQHBhcmFtIHtJQXJyYXlMaWtlPFZBTFVFPn0gYXJyYXkgVGhlIGFycmF5IHRvIG1vZGlmeS5cbiAqIEBwYXJhbSB7VkFMVUV9IHZhbHVlIFRoZSBvYmplY3QgdG8gaW5zZXJ0LlxuICogQHBhcmFtIHtmdW5jdGlvbihWQUxVRSwgVkFMVUUpOiBudW1iZXI9fSBvcHRfY29tcGFyZUZuIE9wdGlvbmFsIGNvbXBhcmlzb25cbiAqICAgICBmdW5jdGlvbiBieSB3aGljaCB0aGUgYXJyYXkgaXMgb3JkZXJlZC4gU2hvdWxkIHRha2UgMiBhcmd1bWVudHMgdG9cbiAqICAgICBjb21wYXJlLCBhbmQgcmV0dXJuIGEgbmVnYXRpdmUgbnVtYmVyLCB6ZXJvLCBvciBhIHBvc2l0aXZlIG51bWJlclxuICogICAgIGRlcGVuZGluZyBvbiB3aGV0aGVyIHRoZSBmaXJzdCBhcmd1bWVudCBpcyBsZXNzIHRoYW4sIGVxdWFsIHRvLCBvclxuICogICAgIGdyZWF0ZXIgdGhhbiB0aGUgc2Vjb25kLlxuICogQHJldHVybiB7Ym9vbGVhbn0gVHJ1ZSBpZiBhbiBlbGVtZW50IHdhcyBpbnNlcnRlZC5cbiAqIEB0ZW1wbGF0ZSBWQUxVRVxuICovXG5mdW5jdGlvbiBiaW5hcnlJbnNlcnQoYXJyYXksIHZhbHVlLCBvcHRfY29tcGFyZUZuKSB7XG4gIGNvbnN0IGluZGV4ID0gYmluYXJ5U2VhcmNoKGFycmF5LCB2YWx1ZSwgb3B0X2NvbXBhcmVGbik7XG4gIGlmIChpbmRleCA8IDApIHtcbiAgICBpbnNlcnRBdChhcnJheSwgdmFsdWUsIC0oaW5kZXggKyAxKSk7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgcmV0dXJuIGZhbHNlO1xufVxuZXhwb3J0cy5iaW5hcnlJbnNlcnQgPSBiaW5hcnlJbnNlcnQ7XG5cblxuLyoqXG4gKiBSZW1vdmVzIGEgdmFsdWUgZnJvbSBhIHNvcnRlZCBhcnJheS5cbiAqIEBwYXJhbSB7IUlBcnJheUxpa2U8VkFMVUU+fSBhcnJheSBUaGUgYXJyYXkgdG8gbW9kaWZ5LlxuICogQHBhcmFtIHtWQUxVRX0gdmFsdWUgVGhlIG9iamVjdCB0byByZW1vdmUuXG4gKiBAcGFyYW0ge2Z1bmN0aW9uKFZBTFVFLCBWQUxVRSk6IG51bWJlcj19IG9wdF9jb21wYXJlRm4gT3B0aW9uYWwgY29tcGFyaXNvblxuICogICAgIGZ1bmN0aW9uIGJ5IHdoaWNoIHRoZSBhcnJheSBpcyBvcmRlcmVkLiBTaG91bGQgdGFrZSAyIGFyZ3VtZW50cyB0b1xuICogICAgIGNvbXBhcmUsIGFuZCByZXR1cm4gYSBuZWdhdGl2ZSBudW1iZXIsIHplcm8sIG9yIGEgcG9zaXRpdmUgbnVtYmVyXG4gKiAgICAgZGVwZW5kaW5nIG9uIHdoZXRoZXIgdGhlIGZpcnN0IGFyZ3VtZW50IGlzIGxlc3MgdGhhbiwgZXF1YWwgdG8sIG9yXG4gKiAgICAgZ3JlYXRlciB0aGFuIHRoZSBzZWNvbmQuXG4gKiBAcmV0dXJuIHtib29sZWFufSBUcnVlIGlmIGFuIGVsZW1lbnQgd2FzIHJlbW92ZWQuXG4gKiBAdGVtcGxhdGUgVkFMVUVcbiAqL1xuZnVuY3Rpb24gYmluYXJ5UmVtb3ZlKGFycmF5LCB2YWx1ZSwgb3B0X2NvbXBhcmVGbikge1xuICBjb25zdCBpbmRleCA9IGJpbmFyeVNlYXJjaChhcnJheSwgdmFsdWUsIG9wdF9jb21wYXJlRm4pO1xuICByZXR1cm4gKGluZGV4ID49IDApID8gcmVtb3ZlQXQoYXJyYXksIGluZGV4KSA6IGZhbHNlO1xufVxuZXhwb3J0cy5iaW5hcnlSZW1vdmUgPSBiaW5hcnlSZW1vdmU7XG5cblxuLyoqXG4gKiBTcGxpdHMgYW4gYXJyYXkgaW50byBkaXNqb2ludCBidWNrZXRzIGFjY29yZGluZyB0byBhIHNwbGl0dGluZyBmdW5jdGlvbi5cbiAqIEBwYXJhbSB7SUFycmF5TGlrZTxUPn0gYXJyYXkgVGhlIGFycmF5LlxuICogQHBhcmFtIHtmdW5jdGlvbih0aGlzOlMsIFQsIG51bWJlciwgIUlBcnJheUxpa2U8VD4pOj99IHNvcnRlciBGdW5jdGlvbiB0b1xuICogICAgIGNhbGwgZm9yIGV2ZXJ5IGVsZW1lbnQuICBUaGlzIHRha2VzIDMgYXJndW1lbnRzICh0aGUgZWxlbWVudCwgdGhlIGluZGV4XG4gKiAgICAgYW5kIHRoZSBhcnJheSkgYW5kIG11c3QgcmV0dXJuIGEgdmFsaWQgb2JqZWN0IGtleSAoYSBzdHJpbmcsIG51bWJlcixcbiAqICAgICBldGMpLCBvciB1bmRlZmluZWQsIGlmIHRoYXQgb2JqZWN0IHNob3VsZCBub3QgYmUgcGxhY2VkIGluIGEgYnVja2V0LlxuICogQHBhcmFtIHtTPX0gb3B0X29iaiBUaGUgb2JqZWN0IHRvIGJlIHVzZWQgYXMgdGhlIHZhbHVlIG9mICd0aGlzJyB3aXRoaW5cbiAqICAgICBzb3J0ZXIuXG4gKiBAcmV0dXJuIHshT2JqZWN0PCFBcnJheTxUPj59IEFuIG9iamVjdCwgd2l0aCBrZXlzIGJlaW5nIGFsbCBvZiB0aGUgdW5pcXVlXG4gKiAgICAgcmV0dXJuIHZhbHVlcyBvZiBzb3J0ZXIsIGFuZCB2YWx1ZXMgYmVpbmcgYXJyYXlzIGNvbnRhaW5pbmcgdGhlIGl0ZW1zIGZvclxuICogICAgIHdoaWNoIHRoZSBzcGxpdHRlciByZXR1cm5lZCB0aGF0IGtleS5cbiAqIEB0ZW1wbGF0ZSBULFNcbiAqL1xuZnVuY3Rpb24gYnVja2V0KGFycmF5LCBzb3J0ZXIsIG9wdF9vYmopIHtcbiAgY29uc3QgYnVja2V0cyA9IHt9O1xuXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgYXJyYXkubGVuZ3RoOyBpKyspIHtcbiAgICBjb25zdCB2YWx1ZSA9IGFycmF5W2ldO1xuICAgIGNvbnN0IGtleSA9IHNvcnRlci5jYWxsKC8qKiBAdHlwZSB7P30gKi8gKG9wdF9vYmopLCB2YWx1ZSwgaSwgYXJyYXkpO1xuICAgIGlmIChrZXkgIT09IHVuZGVmaW5lZCkge1xuICAgICAgLy8gUHVzaCB0aGUgdmFsdWUgdG8gdGhlIHJpZ2h0IGJ1Y2tldCwgY3JlYXRpbmcgaXQgaWYgbmVjZXNzYXJ5LlxuICAgICAgY29uc3QgYnVja2V0ID0gYnVja2V0c1trZXldIHx8IChidWNrZXRzW2tleV0gPSBbXSk7XG4gICAgICBidWNrZXQucHVzaCh2YWx1ZSk7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIGJ1Y2tldHM7XG59XG5leHBvcnRzLmJ1Y2tldCA9IGJ1Y2tldDtcblxuXG4vKipcbiAqIENyZWF0ZXMgYSBuZXcgb2JqZWN0IGJ1aWx0IGZyb20gdGhlIHByb3ZpZGVkIGFycmF5IGFuZCB0aGUga2V5LWdlbmVyYXRpb25cbiAqIGZ1bmN0aW9uLlxuICogQHBhcmFtIHtJQXJyYXlMaWtlPFQ+fSBhcnIgQXJyYXkgb3IgYXJyYXkgbGlrZSBvYmplY3Qgb3ZlclxuICogICAgIHdoaWNoIHRvIGl0ZXJhdGUgd2hvc2UgZWxlbWVudHMgd2lsbCBiZSB0aGUgdmFsdWVzIGluIHRoZSBuZXcgb2JqZWN0LlxuICogQHBhcmFtIHs/ZnVuY3Rpb24odGhpczpTLCBULCBudW1iZXIsID8pIDogc3RyaW5nfSBrZXlGdW5jIFRoZSBmdW5jdGlvbiB0b1xuICogICAgIGNhbGwgZm9yIGV2ZXJ5IGVsZW1lbnQuIFRoaXMgZnVuY3Rpb24gdGFrZXMgMyBhcmd1bWVudHMgKHRoZSBlbGVtZW50LCB0aGVcbiAqICAgICBpbmRleCBhbmQgdGhlIGFycmF5KSBhbmQgc2hvdWxkIHJldHVybiBhIHN0cmluZyB0aGF0IHdpbGwgYmUgdXNlZCBhcyB0aGVcbiAqICAgICBrZXkgZm9yIHRoZSBlbGVtZW50IGluIHRoZSBuZXcgb2JqZWN0LiBJZiB0aGUgZnVuY3Rpb24gcmV0dXJucyB0aGUgc2FtZVxuICogICAgIGtleSBmb3IgbW9yZSB0aGFuIG9uZSBlbGVtZW50LCB0aGUgdmFsdWUgZm9yIHRoYXQga2V5IGlzXG4gKiAgICAgaW1wbGVtZW50YXRpb24tZGVmaW5lZC5cbiAqIEBwYXJhbSB7Uz19IG9wdF9vYmogVGhlIG9iamVjdCB0byBiZSB1c2VkIGFzIHRoZSB2YWx1ZSBvZiAndGhpcydcbiAqICAgICB3aXRoaW4ga2V5RnVuYy5cbiAqIEByZXR1cm4geyFPYmplY3Q8VD59IFRoZSBuZXcgb2JqZWN0LlxuICogQHRlbXBsYXRlIFQsU1xuICovXG5mdW5jdGlvbiB0b09iamVjdChhcnIsIGtleUZ1bmMsIG9wdF9vYmopIHtcbiAgY29uc3QgcmV0ID0ge307XG4gIGZvckVhY2goYXJyLCBmdW5jdGlvbihlbGVtZW50LCBpbmRleCkge1xuICAgIHJldFtrZXlGdW5jLmNhbGwoLyoqIEB0eXBlIHs/fSAqLyAob3B0X29iaiksIGVsZW1lbnQsIGluZGV4LCBhcnIpXSA9XG4gICAgICAgIGVsZW1lbnQ7XG4gIH0pO1xuICByZXR1cm4gcmV0O1xufVxuZXhwb3J0cy50b09iamVjdCA9IHRvT2JqZWN0O1xuXG5cbi8qKlxuICogQ3JlYXRlcyBhIHJhbmdlIG9mIG51bWJlcnMgaW4gYW4gYXJpdGhtZXRpYyBwcm9ncmVzc2lvbi5cbiAqXG4gKiBSYW5nZSB0YWtlcyAxLCAyLCBvciAzIGFyZ3VtZW50czpcbiAqIDxwcmU+XG4gKiByYW5nZSg1KSBpcyB0aGUgc2FtZSBhcyByYW5nZSgwLCA1LCAxKSBhbmQgcHJvZHVjZXMgWzAsIDEsIDIsIDMsIDRdXG4gKiByYW5nZSgyLCA1KSBpcyB0aGUgc2FtZSBhcyByYW5nZSgyLCA1LCAxKSBhbmQgcHJvZHVjZXMgWzIsIDMsIDRdXG4gKiByYW5nZSgtMiwgLTUsIC0xKSBwcm9kdWNlcyBbLTIsIC0zLCAtNF1cbiAqIHJhbmdlKC0yLCAtNSwgMSkgcHJvZHVjZXMgW10sIHNpbmNlIHN0ZXBwaW5nIGJ5IDEgd291bGRuJ3QgZXZlciByZWFjaCAtNS5cbiAqIDwvcHJlPlxuICpcbiAqIEBwYXJhbSB7bnVtYmVyfSBzdGFydE9yRW5kIFRoZSBzdGFydGluZyB2YWx1ZSBvZiB0aGUgcmFuZ2UgaWYgYW4gZW5kIGFyZ3VtZW50XG4gKiAgICAgaXMgcHJvdmlkZWQuIE90aGVyd2lzZSwgdGhlIHN0YXJ0IHZhbHVlIGlzIDAsIGFuZCB0aGlzIGlzIHRoZSBlbmQgdmFsdWUuXG4gKiBAcGFyYW0ge251bWJlcj19IG9wdF9lbmQgVGhlIG9wdGlvbmFsIGVuZCB2YWx1ZSBvZiB0aGUgcmFuZ2UuXG4gKiBAcGFyYW0ge251bWJlcj19IG9wdF9zdGVwIFRoZSBzdGVwIHNpemUgYmV0d2VlbiByYW5nZSB2YWx1ZXMuIERlZmF1bHRzIHRvIDFcbiAqICAgICBpZiBvcHRfc3RlcCBpcyB1bmRlZmluZWQgb3IgMC5cbiAqIEByZXR1cm4geyFBcnJheTxudW1iZXI+fSBBbiBhcnJheSBvZiBudW1iZXJzIGZvciB0aGUgcmVxdWVzdGVkIHJhbmdlLiBNYXkgYmVcbiAqICAgICBhbiBlbXB0eSBhcnJheSBpZiBhZGRpbmcgdGhlIHN0ZXAgd291bGQgbm90IGNvbnZlcmdlIHRvd2FyZCB0aGUgZW5kXG4gKiAgICAgdmFsdWUuXG4gKi9cbmZ1bmN0aW9uIHJhbmdlKHN0YXJ0T3JFbmQsIG9wdF9lbmQsIG9wdF9zdGVwKSB7XG4gIGNvbnN0IGFycmF5ID0gW107XG4gIGxldCBzdGFydCA9IDA7XG4gIGxldCBlbmQgPSBzdGFydE9yRW5kO1xuICBjb25zdCBzdGVwID0gb3B0X3N0ZXAgfHwgMTtcbiAgaWYgKG9wdF9lbmQgIT09IHVuZGVmaW5lZCkge1xuICAgIHN0YXJ0ID0gc3RhcnRPckVuZDtcbiAgICBlbmQgPSBvcHRfZW5kO1xuICB9XG5cbiAgaWYgKHN0ZXAgKiAoZW5kIC0gc3RhcnQpIDwgMCkge1xuICAgIC8vIFNpZ24gbWlzbWF0Y2g6IHN0YXJ0ICsgc3RlcCB3aWxsIG5ldmVyIHJlYWNoIHRoZSBlbmQgdmFsdWUuXG4gICAgcmV0dXJuIFtdO1xuICB9XG5cbiAgaWYgKHN0ZXAgPiAwKSB7XG4gICAgZm9yIChsZXQgaSA9IHN0YXJ0OyBpIDwgZW5kOyBpICs9IHN0ZXApIHtcbiAgICAgIGFycmF5LnB1c2goaSk7XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIGZvciAobGV0IGkgPSBzdGFydDsgaSA+IGVuZDsgaSArPSBzdGVwKSB7XG4gICAgICBhcnJheS5wdXNoKGkpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gYXJyYXk7XG59XG5leHBvcnRzLnJhbmdlID0gcmFuZ2U7XG5cblxuLyoqXG4gKiBSZXR1cm5zIGFuIGFycmF5IGNvbnNpc3Rpbmcgb2YgdGhlIGdpdmVuIHZhbHVlIHJlcGVhdGVkIE4gdGltZXMuXG4gKlxuICogQHBhcmFtIHtWQUxVRX0gdmFsdWUgVGhlIHZhbHVlIHRvIHJlcGVhdC5cbiAqIEBwYXJhbSB7bnVtYmVyfSBuIFRoZSByZXBlYXQgY291bnQuXG4gKiBAcmV0dXJuIHshQXJyYXk8VkFMVUU+fSBBbiBhcnJheSB3aXRoIHRoZSByZXBlYXRlZCB2YWx1ZS5cbiAqIEB0ZW1wbGF0ZSBWQUxVRVxuICovXG5mdW5jdGlvbiByZXBlYXQodmFsdWUsIG4pIHtcbiAgY29uc3QgYXJyYXkgPSBbXTtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBuOyBpKyspIHtcbiAgICBhcnJheVtpXSA9IHZhbHVlO1xuICB9XG4gIHJldHVybiBhcnJheTtcbn1cbmV4cG9ydHMucmVwZWF0ID0gcmVwZWF0O1xuXG5cbi8qKlxuICogUmV0dXJucyBhbiBhcnJheSBjb25zaXN0aW5nIG9mIGV2ZXJ5IGFyZ3VtZW50IHdpdGggYWxsIGFycmF5c1xuICogZXhwYW5kZWQgaW4tcGxhY2UgcmVjdXJzaXZlbHkuXG4gKlxuICogQHBhcmFtIHsuLi4qfSB2YXJfYXJncyBUaGUgdmFsdWVzIHRvIGZsYXR0ZW4uXG4gKiBAcmV0dXJuIHshQXJyYXk8Pz59IEFuIGFycmF5IGNvbnRhaW5pbmcgdGhlIGZsYXR0ZW5lZCB2YWx1ZXMuXG4gKi9cbmZ1bmN0aW9uIGZsYXR0ZW4odmFyX2FyZ3MpIHtcbiAgY29uc3QgQ0hVTktfU0laRSA9IDgxOTI7XG5cbiAgY29uc3QgcmVzdWx0ID0gW107XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgY29uc3QgZWxlbWVudCA9IGFyZ3VtZW50c1tpXTtcbiAgICBpZiAoQXJyYXkuaXNBcnJheShlbGVtZW50KSkge1xuICAgICAgZm9yIChsZXQgYyA9IDA7IGMgPCBlbGVtZW50Lmxlbmd0aDsgYyArPSBDSFVOS19TSVpFKSB7XG4gICAgICAgIGNvbnN0IGNodW5rID0gc2xpY2UoZWxlbWVudCwgYywgYyArIENIVU5LX1NJWkUpO1xuICAgICAgICBjb25zdCByZWN1cnNlUmVzdWx0ID0gZmxhdHRlbi5hcHBseShudWxsLCBjaHVuayk7XG4gICAgICAgIGZvciAobGV0IHIgPSAwOyByIDwgcmVjdXJzZVJlc3VsdC5sZW5ndGg7IHIrKykge1xuICAgICAgICAgIHJlc3VsdC5wdXNoKHJlY3Vyc2VSZXN1bHRbcl0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHJlc3VsdC5wdXNoKGVsZW1lbnQpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufVxuZXhwb3J0cy5mbGF0dGVuID0gZmxhdHRlbjtcblxuXG4vKipcbiAqIFJvdGF0ZXMgYW4gYXJyYXkgaW4tcGxhY2UuIEFmdGVyIGNhbGxpbmcgdGhpcyBtZXRob2QsIHRoZSBlbGVtZW50IGF0XG4gKiBpbmRleCBpIHdpbGwgYmUgdGhlIGVsZW1lbnQgcHJldmlvdXNseSBhdCBpbmRleCAoaSAtIG4pICVcbiAqIGFycmF5Lmxlbmd0aCwgZm9yIGFsbCB2YWx1ZXMgb2YgaSBiZXR3ZWVuIDAgYW5kIGFycmF5Lmxlbmd0aCAtIDEsXG4gKiBpbmNsdXNpdmUuXG4gKlxuICogRm9yIGV4YW1wbGUsIHN1cHBvc2UgbGlzdCBjb21wcmlzZXMgW3QsIGEsIG4sIGssIHNdLiBBZnRlciBpbnZva2luZ1xuICogcm90YXRlKGFycmF5LCAxKSAob3Igcm90YXRlKGFycmF5LCAtNCkpLCBhcnJheSB3aWxsIGNvbXByaXNlIFtzLCB0LCBhLCBuLCBrXS5cbiAqXG4gKiBAcGFyYW0geyFBcnJheTxUPn0gYXJyYXkgVGhlIGFycmF5IHRvIHJvdGF0ZS5cbiAqIEBwYXJhbSB7bnVtYmVyfSBuIFRoZSBhbW91bnQgdG8gcm90YXRlLlxuICogQHJldHVybiB7IUFycmF5PFQ+fSBUaGUgYXJyYXkuXG4gKiBAdGVtcGxhdGUgVFxuICovXG5mdW5jdGlvbiByb3RhdGUoYXJyYXksIG4pIHtcbiAgYXNzZXJ0cy5hc3NlcnQoYXJyYXkubGVuZ3RoICE9IG51bGwpO1xuXG4gIGlmIChhcnJheS5sZW5ndGgpIHtcbiAgICBuICU9IGFycmF5Lmxlbmd0aDtcbiAgICBpZiAobiA+IDApIHtcbiAgICAgIEFycmF5LnByb3RvdHlwZS51bnNoaWZ0LmFwcGx5KGFycmF5LCBhcnJheS5zcGxpY2UoLW4sIG4pKTtcbiAgICB9IGVsc2UgaWYgKG4gPCAwKSB7XG4gICAgICBBcnJheS5wcm90b3R5cGUucHVzaC5hcHBseShhcnJheSwgYXJyYXkuc3BsaWNlKDAsIC1uKSk7XG4gICAgfVxuICB9XG4gIHJldHVybiBhcnJheTtcbn1cbmV4cG9ydHMucm90YXRlID0gcm90YXRlO1xuXG5cbi8qKlxuICogTW92ZXMgb25lIGl0ZW0gb2YgYW4gYXJyYXkgdG8gYSBuZXcgcG9zaXRpb24ga2VlcGluZyB0aGUgb3JkZXIgb2YgdGhlIHJlc3RcbiAqIG9mIHRoZSBpdGVtcy4gRXhhbXBsZSB1c2UgY2FzZToga2VlcGluZyBhIGxpc3Qgb2YgSmF2YVNjcmlwdCBvYmplY3RzXG4gKiBzeW5jaHJvbml6ZWQgd2l0aCB0aGUgY29ycmVzcG9uZGluZyBsaXN0IG9mIERPTSBlbGVtZW50cyBhZnRlciBvbmUgb2YgdGhlXG4gKiBlbGVtZW50cyBoYXMgYmVlbiBkcmFnZ2VkIHRvIGEgbmV3IHBvc2l0aW9uLlxuICogQHBhcmFtIHshSUFycmF5TGlrZTw/Pn0gYXJyIFRoZSBhcnJheSB0byBtb2RpZnkuXG4gKiBAcGFyYW0ge251bWJlcn0gZnJvbUluZGV4IEluZGV4IG9mIHRoZSBpdGVtIHRvIG1vdmUgYmV0d2VlbiAwIGFuZFxuICogICAgIGBhcnIubGVuZ3RoIC0gMWAuXG4gKiBAcGFyYW0ge251bWJlcn0gdG9JbmRleCBUYXJnZXQgaW5kZXggYmV0d2VlbiAwIGFuZCBgYXJyLmxlbmd0aCAtIDFgLlxuICovXG5mdW5jdGlvbiBtb3ZlSXRlbShhcnIsIGZyb21JbmRleCwgdG9JbmRleCkge1xuICBhc3NlcnRzLmFzc2VydChmcm9tSW5kZXggPj0gMCAmJiBmcm9tSW5kZXggPCBhcnIubGVuZ3RoKTtcbiAgYXNzZXJ0cy5hc3NlcnQodG9JbmRleCA+PSAwICYmIHRvSW5kZXggPCBhcnIubGVuZ3RoKTtcbiAgLy8gUmVtb3ZlIDEgaXRlbSBhdCBmcm9tSW5kZXguXG4gIGNvbnN0IHJlbW92ZWRJdGVtcyA9IEFycmF5LnByb3RvdHlwZS5zcGxpY2UuY2FsbChhcnIsIGZyb21JbmRleCwgMSk7XG4gIC8vIEluc2VydCB0aGUgcmVtb3ZlZCBpdGVtIGF0IHRvSW5kZXguXG4gIEFycmF5LnByb3RvdHlwZS5zcGxpY2UuY2FsbChhcnIsIHRvSW5kZXgsIDAsIHJlbW92ZWRJdGVtc1swXSk7XG4gIC8vIFdlIGRvbid0IHVzZSBnb29nLmFycmF5Lmluc2VydEF0IGFuZCBnb29nLmFycmF5LnJlbW92ZUF0LCBiZWNhdXNlIHRoZXkncmVcbiAgLy8gc2lnbmlmaWNhbnRseSBzbG93ZXIgdGhhbiBzcGxpY2UuXG59XG5leHBvcnRzLm1vdmVJdGVtID0gbW92ZUl0ZW07XG5cblxuLyoqXG4gKiBDcmVhdGVzIGEgbmV3IGFycmF5IGZvciB3aGljaCB0aGUgZWxlbWVudCBhdCBwb3NpdGlvbiBpIGlzIGFuIGFycmF5IG9mIHRoZVxuICogaXRoIGVsZW1lbnQgb2YgdGhlIHByb3ZpZGVkIGFycmF5cy4gIFRoZSByZXR1cm5lZCBhcnJheSB3aWxsIG9ubHkgYmUgYXMgbG9uZ1xuICogYXMgdGhlIHNob3J0ZXN0IGFycmF5IHByb3ZpZGVkOyBhZGRpdGlvbmFsIHZhbHVlcyBhcmUgaWdub3JlZC4gIEZvciBleGFtcGxlLFxuICogdGhlIHJlc3VsdCBvZiB6aXBwaW5nIFsxLCAyXSBhbmQgWzMsIDQsIDVdIGlzIFtbMSwzXSwgWzIsIDRdXS5cbiAqXG4gKiBUaGlzIGlzIHNpbWlsYXIgdG8gdGhlIHppcCgpIGZ1bmN0aW9uIGluIFB5dGhvbi4gIFNlZSB7QGxpbmtcbiAqIGh0dHA6Ly9kb2NzLnB5dGhvbi5vcmcvbGlicmFyeS9mdW5jdGlvbnMuaHRtbCN6aXB9XG4gKlxuICogQHBhcmFtIHsuLi4hSUFycmF5TGlrZTw/Pn0gdmFyX2FyZ3MgQXJyYXlzIHRvIGJlIGNvbWJpbmVkLlxuICogQHJldHVybiB7IUFycmF5PCFBcnJheTw/Pj59IEEgbmV3IGFycmF5IG9mIGFycmF5cyBjcmVhdGVkIGZyb21cbiAqICAgICBwcm92aWRlZCBhcnJheXMuXG4gKi9cbmZ1bmN0aW9uIHppcCh2YXJfYXJncykge1xuICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHtcbiAgICByZXR1cm4gW107XG4gIH1cbiAgY29uc3QgcmVzdWx0ID0gW107XG4gIGxldCBtaW5MZW4gPSBhcmd1bWVudHNbMF0ubGVuZ3RoO1xuICBmb3IgKGxldCBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykge1xuICAgIGlmIChhcmd1bWVudHNbaV0ubGVuZ3RoIDwgbWluTGVuKSB7XG4gICAgICBtaW5MZW4gPSBhcmd1bWVudHNbaV0ubGVuZ3RoO1xuICAgIH1cbiAgfVxuICBmb3IgKGxldCBpID0gMDsgaSA8IG1pbkxlbjsgaSsrKSB7XG4gICAgY29uc3QgdmFsdWUgPSBbXTtcbiAgICBmb3IgKGxldCBqID0gMDsgaiA8IGFyZ3VtZW50cy5sZW5ndGg7IGorKykge1xuICAgICAgdmFsdWUucHVzaChhcmd1bWVudHNbal1baV0pO1xuICAgIH1cbiAgICByZXN1bHQucHVzaCh2YWx1ZSk7XG4gIH1cbiAgcmV0dXJuIHJlc3VsdDtcbn1cbmV4cG9ydHMuemlwID0gemlwO1xuXG5cbi8qKlxuICogU2h1ZmZsZXMgdGhlIHZhbHVlcyBpbiB0aGUgc3BlY2lmaWVkIGFycmF5IHVzaW5nIHRoZSBGaXNoZXItWWF0ZXMgaW4tcGxhY2VcbiAqIHNodWZmbGUgKGFsc28ga25vd24gYXMgdGhlIEtudXRoIFNodWZmbGUpLiBCeSBkZWZhdWx0LCBjYWxscyBNYXRoLnJhbmRvbSgpXG4gKiBhbmQgc28gcmVzZXRzIHRoZSBzdGF0ZSBvZiB0aGF0IHJhbmRvbSBudW1iZXIgZ2VuZXJhdG9yLiBTaW1pbGFybHksIG1heSByZXNldFxuICogdGhlIHN0YXRlIG9mIGFueSBvdGhlciBzcGVjaWZpZWQgcmFuZG9tIG51bWJlciBnZW5lcmF0b3IuXG4gKlxuICogUnVudGltZTogTyhuKVxuICpcbiAqIEBwYXJhbSB7IUFycmF5PD8+fSBhcnIgVGhlIGFycmF5IHRvIGJlIHNodWZmbGVkLlxuICogQHBhcmFtIHtmdW5jdGlvbigpOm51bWJlcj19IG9wdF9yYW5kRm4gT3B0aW9uYWwgcmFuZG9tIGZ1bmN0aW9uIHRvIHVzZSBmb3JcbiAqICAgICBzaHVmZmxpbmcuXG4gKiAgICAgVGFrZXMgbm8gYXJndW1lbnRzLCBhbmQgcmV0dXJucyBhIHJhbmRvbSBudW1iZXIgb24gdGhlIGludGVydmFsIFswLCAxKS5cbiAqICAgICBEZWZhdWx0cyB0byBNYXRoLnJhbmRvbSgpIHVzaW5nIEphdmFTY3JpcHQncyBidWlsdC1pbiBNYXRoIGxpYnJhcnkuXG4gKi9cbmZ1bmN0aW9uIHNodWZmbGUoYXJyLCBvcHRfcmFuZEZuKSB7XG4gIGNvbnN0IHJhbmRGbiA9IG9wdF9yYW5kRm4gfHwgTWF0aC5yYW5kb207XG5cbiAgZm9yIChsZXQgaSA9IGFyci5sZW5ndGggLSAxOyBpID4gMDsgaS0tKSB7XG4gICAgLy8gQ2hvb3NlIGEgcmFuZG9tIGFycmF5IGluZGV4IGluIFswLCBpXSAoaW5jbHVzaXZlIHdpdGggaSkuXG4gICAgY29uc3QgaiA9IE1hdGguZmxvb3IocmFuZEZuKCkgKiAoaSArIDEpKTtcblxuICAgIGNvbnN0IHRtcCA9IGFycltpXTtcbiAgICBhcnJbaV0gPSBhcnJbal07XG4gICAgYXJyW2pdID0gdG1wO1xuICB9XG59XG5leHBvcnRzLnNodWZmbGUgPSBzaHVmZmxlO1xuXG5cbi8qKlxuICogUmV0dXJucyBhIG5ldyBhcnJheSBvZiBlbGVtZW50cyBmcm9tIGFyciwgYmFzZWQgb24gdGhlIGluZGV4ZXMgb2YgZWxlbWVudHNcbiAqIHByb3ZpZGVkIGJ5IGluZGV4X2Fyci4gRm9yIGV4YW1wbGUsIHRoZSByZXN1bHQgb2YgaW5kZXggY29weWluZ1xuICogWydhJywgJ2InLCAnYyddIHdpdGggaW5kZXhfYXJyIFsxLDAsMCwyXSBpcyBbJ2InLCAnYScsICdhJywgJ2MnXS5cbiAqXG4gKiBAcGFyYW0geyFJQXJyYXlMaWtlPFQ+fSBhcnIgVGhlIGFycmF5IHRvIGdldCBhIGluZGV4ZWQgY29weSBmcm9tLlxuICogQHBhcmFtIHshSUFycmF5TGlrZTxudW1iZXI+fSBpbmRleF9hcnIgQW4gYXJyYXkgb2YgaW5kZXhlcyB0byBnZXQgZnJvbSBhcnIuXG4gKiBAcmV0dXJuIHshQXJyYXk8VD59IEEgbmV3IGFycmF5IG9mIGVsZW1lbnRzIGZyb20gYXJyIGluIGluZGV4X2FyciBvcmRlci5cbiAqIEB0ZW1wbGF0ZSBUXG4gKi9cbmZ1bmN0aW9uIGNvcHlCeUluZGV4KGFyciwgaW5kZXhfYXJyKSB7XG4gIGNvbnN0IHJlc3VsdCA9IFtdO1xuICBmb3JFYWNoKGluZGV4X2FyciwgZnVuY3Rpb24oaW5kZXgpIHtcbiAgICByZXN1bHQucHVzaChhcnJbaW5kZXhdKTtcbiAgfSk7XG4gIHJldHVybiByZXN1bHQ7XG59XG5leHBvcnRzLmNvcHlCeUluZGV4ID0gY29weUJ5SW5kZXg7XG5cblxuLyoqXG4gKiBNYXBzIGVhY2ggZWxlbWVudCBvZiB0aGUgaW5wdXQgYXJyYXkgaW50byB6ZXJvIG9yIG1vcmUgZWxlbWVudHMgb2YgdGhlIG91dHB1dFxuICogYXJyYXkuXG4gKlxuICogQHBhcmFtIHshSUFycmF5TGlrZTxWQUxVRT58c3RyaW5nfSBhcnIgQXJyYXkgb3IgYXJyYXkgbGlrZSBvYmplY3RcbiAqICAgICBvdmVyIHdoaWNoIHRvIGl0ZXJhdGUuXG4gKiBAcGFyYW0ge2Z1bmN0aW9uKHRoaXM6VEhJUywgVkFMVUUsIG51bWJlciwgPyk6ICFBcnJheTxSRVNVTFQ+fSBmIFRoZSBmdW5jdGlvblxuICogICAgIHRvIGNhbGwgZm9yIGV2ZXJ5IGVsZW1lbnQuIFRoaXMgZnVuY3Rpb24gdGFrZXMgMyBhcmd1bWVudHMgKHRoZSBlbGVtZW50LFxuICogICAgIHRoZSBpbmRleCBhbmQgdGhlIGFycmF5KSBhbmQgc2hvdWxkIHJldHVybiBhbiBhcnJheS4gVGhlIHJlc3VsdCB3aWxsIGJlXG4gKiAgICAgdXNlZCB0byBleHRlbmQgYSBuZXcgYXJyYXkuXG4gKiBAcGFyYW0ge1RISVM9fSBvcHRfb2JqIFRoZSBvYmplY3QgdG8gYmUgdXNlZCBhcyB0aGUgdmFsdWUgb2YgJ3RoaXMnIHdpdGhpbiBmLlxuICogQHJldHVybiB7IUFycmF5PFJFU1VMVD59IGEgbmV3IGFycmF5IHdpdGggdGhlIGNvbmNhdGVuYXRpb24gb2YgYWxsIGFycmF5c1xuICogICAgIHJldHVybmVkIGZyb20gZi5cbiAqIEB0ZW1wbGF0ZSBUSElTLCBWQUxVRSwgUkVTVUxUXG4gKi9cbmZ1bmN0aW9uIGNvbmNhdE1hcChhcnIsIGYsIG9wdF9vYmopIHtcbiAgcmV0dXJuIGNvbmNhdC5hcHBseShbXSwgbWFwKGFyciwgZiwgb3B0X29iaikpO1xufVxuZXhwb3J0cy5jb25jYXRNYXAgPSBjb25jYXRNYXA7XG4iLCAiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IFRoZSBDbG9zdXJlIExpYnJhcnkgQXV0aG9ycy5cbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBAZmlsZW92ZXJ2aWV3IFdyYXBwZXIgY2xhc3MgZm9yIGhhbmRsaW5nIFhtbEh0dHBSZXF1ZXN0cy5cbiAqXG4gKiBPbmUgb2ZmIHJlcXVlc3RzIGNhbiBiZSBzZW50IHRocm91Z2ggZ29vZy5uZXQuWGhySW8uc2VuZCgpIG9yIGFuXG4gKiBpbnN0YW5jZSBjYW4gYmUgY3JlYXRlZCB0byBzZW5kIG11bHRpcGxlIHJlcXVlc3RzLiAgRWFjaCByZXF1ZXN0IHVzZXMgaXRzXG4gKiBvd24gWG1sSHR0cFJlcXVlc3Qgb2JqZWN0IGFuZCBoYW5kbGVzIGNsZWFyaW5nIG9mIHRoZSBldmVudCBjYWxsYmFjayB0b1xuICogZW5zdXJlIG5vIGxlYWtzLlxuICpcbiAqIFhocklvIGlzIGV2ZW50IGJhc2VkLCBpdCBkaXNwYXRjaGVzIGV2ZW50cyBvbiBzdWNjZXNzLCBmYWlsdXJlLCBmaW5pc2hpbmcsXG4gKiByZWFkeS1zdGF0ZSBjaGFuZ2UsIG9yIHByb2dyZXNzIChkb3dubG9hZCBhbmQgdXBsb2FkKS5cbiAqXG4gKiBUaGUgcmVhZHktc3RhdGUgb3IgdGltZW91dCBldmVudCBmaXJlcyBmaXJzdCwgZm9sbG93ZWQgYnlcbiAqIGEgZ2VuZXJpYyBjb21wbGV0ZWQgZXZlbnQuIFRoZW4gdGhlIGFib3J0LCBlcnJvciwgb3Igc3VjY2VzcyBldmVudFxuICogaXMgZmlyZWQgYXMgYXBwcm9wcmlhdGUuIFByb2dyZXNzIGV2ZW50cyBhcmUgZmlyZWQgYXMgdGhleSBhcmVcbiAqIHJlY2VpdmVkLiBMYXN0bHksIHRoZSByZWFkeSBldmVudCB3aWxsIGZpcmUgdG8gaW5kaWNhdGUgdGhhdCB0aGVcbiAqIG9iamVjdCBtYXkgYmUgdXNlZCB0byBtYWtlIGFub3RoZXIgcmVxdWVzdC5cbiAqXG4gKiBUaGUgZXJyb3IgZXZlbnQgbWF5IGFsc28gYmUgY2FsbGVkIGJlZm9yZSBjb21wbGV0ZWQgYW5kXG4gKiByZWFkeS1zdGF0ZS1jaGFuZ2UgaWYgdGhlIFhtbEh0dHBSZXF1ZXN0Lm9wZW4oKSBvciAuc2VuZCgpIG1ldGhvZHMgdGhyb3cuXG4gKlxuICogVGhpcyBjbGFzcyBkb2VzIG5vdCBzdXBwb3J0IG11bHRpcGxlIHJlcXVlc3RzLCBxdWV1aW5nLCBvciBwcmlvcml0aXphdGlvbi5cbiAqXG4gKiBXaGVuIHByb2dyZXNzIGV2ZW50cyBhcmUgc3VwcG9ydGVkIGJ5IHRoZSBicm93c2VyLCBhbmQgcHJvZ3Jlc3MgaXNcbiAqIGVuYWJsZWQgdmlhIC5zZXRQcm9ncmVzc0V2ZW50c0VuYWJsZWQodHJ1ZSksIHRoZVxuICogZ29vZy5uZXQuRXZlbnRUeXBlLlBST0dSRVNTIGV2ZW50IHdpbGwgYmUgdGhlIHJlLWRpc3BhdGNoZWQgYnJvd3NlclxuICogcHJvZ3Jlc3MgZXZlbnQuIEFkZGl0aW9uYWxseSwgYSBET1dOTE9BRF9QUk9HUkVTUyBvciBVUExPQURfUFJPR1JFU1MgZXZlbnRcbiAqIHdpbGwgYmUgZmlyZWQgZm9yIGRvd25sb2FkIGFuZCB1cGxvYWQgcHJvZ3Jlc3MgcmVzcGVjdGl2ZWx5LlxuICovXG5cblxuZ29vZy5wcm92aWRlKCdnb29nLm5ldC5YaHJJbycpO1xuZ29vZy5wcm92aWRlKCdnb29nLm5ldC5YaHJJby5SZXNwb25zZVR5cGUnKTtcblxuZ29vZy5yZXF1aXJlKCdnb29nLlRpbWVyJyk7XG5nb29nLnJlcXVpcmUoJ2dvb2cuYXJyYXknKTtcbmdvb2cucmVxdWlyZSgnZ29vZy5hc3NlcnRzJyk7XG5nb29nLnJlcXVpcmUoJ2dvb2cuZGVidWcuZW50cnlQb2ludFJlZ2lzdHJ5Jyk7XG5nb29nLnJlcXVpcmUoJ2dvb2cuZXZlbnRzLkV2ZW50VGFyZ2V0Jyk7XG5nb29nLnJlcXVpcmUoJ2dvb2cuanNvbi5oeWJyaWQnKTtcbmdvb2cucmVxdWlyZSgnZ29vZy5sb2cnKTtcbmdvb2cucmVxdWlyZSgnZ29vZy5uZXQuRXJyb3JDb2RlJyk7XG5nb29nLnJlcXVpcmUoJ2dvb2cubmV0LkV2ZW50VHlwZScpO1xuZ29vZy5yZXF1aXJlKCdnb29nLm5ldC5IdHRwU3RhdHVzJyk7XG5nb29nLnJlcXVpcmUoJ2dvb2cubmV0LlhtbEh0dHAnKTtcbmdvb2cucmVxdWlyZSgnZ29vZy5vYmplY3QnKTtcbmdvb2cucmVxdWlyZSgnZ29vZy5zdHJpbmcnKTtcbmdvb2cucmVxdWlyZSgnZ29vZy5zdHJ1Y3RzJyk7XG5nb29nLnJlcXVpcmUoJ2dvb2cuc3RydWN0cy5NYXAnKTtcbmdvb2cucmVxdWlyZSgnZ29vZy51cmkudXRpbHMnKTtcbmdvb2cucmVxdWlyZSgnZ29vZy51c2VyQWdlbnQnKTtcbmdvb2cucmVxdWlyZVR5cGUoJ2dvb2cuVXJpJyk7XG5nb29nLnJlcXVpcmVUeXBlKCdnb29nLmRlYnVnLkVycm9ySGFuZGxlcicpO1xuZ29vZy5yZXF1aXJlVHlwZSgnZ29vZy5uZXQuWGhyTGlrZScpO1xuZ29vZy5yZXF1aXJlVHlwZSgnZ29vZy5uZXQuWG1sSHR0cEZhY3RvcnknKTtcblxuZ29vZy5zY29wZShmdW5jdGlvbigpIHtcblxuJ3VzZSBzdHJpY3QnO1xuLyoqXG4gKiBCYXNpYyBjbGFzcyBmb3IgaGFuZGxpbmcgWE1MSHR0cFJlcXVlc3RzLlxuICogQHBhcmFtIHtnb29nLm5ldC5YbWxIdHRwRmFjdG9yeT19IG9wdF94bWxIdHRwRmFjdG9yeSBGYWN0b3J5IHRvIHVzZSB3aGVuXG4gKiAgICAgY3JlYXRpbmcgWE1MSHR0cFJlcXVlc3Qgb2JqZWN0cy5cbiAqIEBjb25zdHJ1Y3RvclxuICogQGV4dGVuZHMge2dvb2cuZXZlbnRzLkV2ZW50VGFyZ2V0fVxuICovXG5nb29nLm5ldC5YaHJJbyA9IGZ1bmN0aW9uKG9wdF94bWxIdHRwRmFjdG9yeSkge1xuICAndXNlIHN0cmljdCc7XG4gIFhocklvLmJhc2UodGhpcywgJ2NvbnN0cnVjdG9yJyk7XG5cbiAgLyoqXG4gICAqIE1hcCBvZiBkZWZhdWx0IGhlYWRlcnMgdG8gYWRkIHRvIGV2ZXJ5IHJlcXVlc3QsIHVzZTpcbiAgICogWGhySW8uaGVhZGVycy5zZXQobmFtZSwgdmFsdWUpXG4gICAqIEB0eXBlIHshZ29vZy5zdHJ1Y3RzLk1hcH1cbiAgICovXG4gIHRoaXMuaGVhZGVycyA9IG5ldyBnb29nLnN0cnVjdHMuTWFwKCk7XG5cbiAgLyoqXG4gICAqIE9wdGlvbmFsIFhtbEh0dHBGYWN0b3J5XG4gICAqIEBwcml2YXRlIHtnb29nLm5ldC5YbWxIdHRwRmFjdG9yeX1cbiAgICovXG4gIHRoaXMueG1sSHR0cEZhY3RvcnlfID0gb3B0X3htbEh0dHBGYWN0b3J5IHx8IG51bGw7XG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgWE1MSHR0cFJlcXVlc3QgaXMgYWN0aXZlLiAgQSByZXF1ZXN0IGlzIGFjdGl2ZSBmcm9tIHRoZSB0aW1lIHNlbmQoKVxuICAgKiBpcyBjYWxsZWQgdW50aWwgb25SZWFkeVN0YXRlQ2hhbmdlKCkgaXMgY29tcGxldGUsIG9yIGVycm9yKCkgb3IgYWJvcnQoKVxuICAgKiBpcyBjYWxsZWQuXG4gICAqIEBwcml2YXRlIHtib29sZWFufVxuICAgKi9cbiAgdGhpcy5hY3RpdmVfID0gZmFsc2U7XG5cbiAgLyoqXG4gICAqIFRoZSBYTUxIdHRwUmVxdWVzdCBvYmplY3QgdGhhdCBpcyBiZWluZyB1c2VkIGZvciB0aGUgdHJhbnNmZXIuXG4gICAqIEBwcml2YXRlIHs/Z29vZy5uZXQuWGhyTGlrZS5Pck5hdGl2ZX1cbiAgICovXG4gIHRoaXMueGhyXyA9IG51bGw7XG5cbiAgLyoqXG4gICAqIFRoZSBvcHRpb25zIHRvIHVzZSB3aXRoIHRoZSBjdXJyZW50IFhNTEh0dHBSZXF1ZXN0IG9iamVjdC5cbiAgICogQHByaXZhdGUgez9PYmplY3R9XG4gICAqL1xuICB0aGlzLnhock9wdGlvbnNfID0gbnVsbDtcblxuICAvKipcbiAgICogTGFzdCBVUkwgdGhhdCB3YXMgcmVxdWVzdGVkLlxuICAgKiBAcHJpdmF0ZSB7c3RyaW5nfGdvb2cuVXJpfVxuICAgKi9cbiAgdGhpcy5sYXN0VXJpXyA9ICcnO1xuXG4gIC8qKlxuICAgKiBNZXRob2QgZm9yIHRoZSBsYXN0IHJlcXVlc3QuXG4gICAqIEBwcml2YXRlIHtzdHJpbmd9XG4gICAqL1xuICB0aGlzLmxhc3RNZXRob2RfID0gJyc7XG5cbiAgLyoqXG4gICAqIExhc3QgZXJyb3IgY29kZS5cbiAgICogQHByaXZhdGUgeyFnb29nLm5ldC5FcnJvckNvZGV9XG4gICAqL1xuICB0aGlzLmxhc3RFcnJvckNvZGVfID0gZ29vZy5uZXQuRXJyb3JDb2RlLk5PX0VSUk9SO1xuXG4gIC8qKlxuICAgKiBMYXN0IGVycm9yIG1lc3NhZ2UuXG4gICAqIEBwcml2YXRlIHtFcnJvcnxzdHJpbmd9XG4gICAqL1xuICB0aGlzLmxhc3RFcnJvcl8gPSAnJztcblxuICAvKipcbiAgICogVXNlZCB0byBlbnN1cmUgdGhhdCB3ZSBkb24ndCBkaXNwYXRjaCBhbiBtdWx0aXBsZSBFUlJPUiBldmVudHMuIFRoaXMgY2FuXG4gICAqIGhhcHBlbiBpbiBJRSB3aGVuIGl0IGRvZXMgYSBzeW5jaHJvbm91cyBsb2FkIGFuZCBvbmUgZXJyb3IgaXMgaGFuZGxlZCBpblxuICAgKiB0aGUgcmVhZHkgc3RhdGUgY2hhbmdlIGFuZCBvbmUgaXMgaGFuZGxlZCBkdWUgdG8gc2VuZCgpIHRocm93aW5nIGFuXG4gICAqIGV4Y2VwdGlvbi5cbiAgICogQHByaXZhdGUge2Jvb2xlYW59XG4gICAqL1xuICB0aGlzLmVycm9yRGlzcGF0Y2hlZF8gPSBmYWxzZTtcblxuICAvKipcbiAgICogVXNlZCB0byBtYWtlIHN1cmUgd2UgZG9uJ3QgZmlyZSB0aGUgY29tcGxldGUgZXZlbnQgZnJvbSBpbnNpZGUgYSBzZW5kIGNhbGwuXG4gICAqIEBwcml2YXRlIHtib29sZWFufVxuICAgKi9cbiAgdGhpcy5pblNlbmRfID0gZmFsc2U7XG5cbiAgLyoqXG4gICAqIFVzZWQgaW4gZGV0ZXJtaW5pbmcgaWYgYSBjYWxsIHRvIHtAbGluayAjb25SZWFkeVN0YXRlQ2hhbmdlX30gaXMgZnJvbVxuICAgKiB3aXRoaW4gYSBjYWxsIHRvIHRoaXMueGhyXy5vcGVuLlxuICAgKiBAcHJpdmF0ZSB7Ym9vbGVhbn1cbiAgICovXG4gIHRoaXMuaW5PcGVuXyA9IGZhbHNlO1xuXG4gIC8qKlxuICAgKiBVc2VkIGluIGRldGVybWluaW5nIGlmIGEgY2FsbCB0byB7QGxpbmsgI29uUmVhZHlTdGF0ZUNoYW5nZV99IGlzIGZyb21cbiAgICogd2l0aGluIGEgY2FsbCB0byB0aGlzLnhocl8uYWJvcnQuXG4gICAqIEBwcml2YXRlIHtib29sZWFufVxuICAgKi9cbiAgdGhpcy5pbkFib3J0XyA9IGZhbHNlO1xuXG4gIC8qKlxuICAgKiBOdW1iZXIgb2YgbWlsbGlzZWNvbmRzIGFmdGVyIHdoaWNoIGFuIGluY29tcGxldGUgcmVxdWVzdCB3aWxsIGJlIGFib3J0ZWRcbiAgICogYW5kIGEge0BsaW5rIGdvb2cubmV0LkV2ZW50VHlwZS5USU1FT1VUfSBldmVudCByYWlzZWQ7IDAgbWVhbnMgbm8gdGltZW91dFxuICAgKiBpcyBzZXQuXG4gICAqIEBwcml2YXRlIHtudW1iZXJ9XG4gICAqL1xuICB0aGlzLnRpbWVvdXRJbnRlcnZhbF8gPSAwO1xuXG4gIC8qKlxuICAgKiBUaW1lciB0byB0cmFjayByZXF1ZXN0IHRpbWVvdXQuXG4gICAqIEBwcml2YXRlIHs/bnVtYmVyfVxuICAgKi9cbiAgdGhpcy50aW1lb3V0SWRfID0gbnVsbDtcblxuICAvKipcbiAgICogVGhlIHJlcXVlc3RlZCB0eXBlIGZvciB0aGUgcmVzcG9uc2UuIFRoZSBlbXB0eSBzdHJpbmcgbWVhbnMgdXNlIHRoZSBkZWZhdWx0XG4gICAqIFhIUiBiZWhhdmlvci5cbiAgICogQHByaXZhdGUge2dvb2cubmV0LlhocklvLlJlc3BvbnNlVHlwZX1cbiAgICovXG4gIHRoaXMucmVzcG9uc2VUeXBlXyA9IFJlc3BvbnNlVHlwZS5ERUZBVUxUO1xuXG4gIC8qKlxuICAgKiBXaGV0aGVyIGEgXCJjcmVkZW50aWFsZWRcIiByZXF1ZXN0IGlzIHRvIGJlIHNlbnQgKG9uZSB0aGF0IGlzIGF3YXJlIG9mXG4gICAqIGNvb2tpZXMgYW5kIGF1dGhlbnRpY2F0aW9uKS4gVGhpcyBpcyBhcHBsaWNhYmxlIG9ubHkgZm9yIGNyb3NzLWRvbWFpblxuICAgKiByZXF1ZXN0cyBhbmQgbW9yZSByZWNlbnQgYnJvd3NlcnMgdGhhdCBzdXBwb3J0IHRoaXMgcGFydCBvZiB0aGUgSFRUUCBBY2Nlc3NcbiAgICogQ29udHJvbCBzdGFuZGFyZC5cbiAgICpcbiAgICogQHNlZSBodHRwOi8vd3d3LnczLm9yZy9UUi9YTUxIdHRwUmVxdWVzdC8jdGhlLXdpdGhjcmVkZW50aWFscy1hdHRyaWJ1dGVcbiAgICpcbiAgICogQHByaXZhdGUge2Jvb2xlYW59XG4gICAqL1xuICB0aGlzLndpdGhDcmVkZW50aWFsc18gPSBmYWxzZTtcblxuICAvKipcbiAgICogV2hldGhlciBwcm9ncmVzcyBldmVudHMgYXJlIGVuYWJsZWQgZm9yIHRoaXMgcmVxdWVzdC4gVGhpcyBpc1xuICAgKiBkaXNhYmxlZCBieSBkZWZhdWx0IGJlY2F1c2Ugc2V0dGluZyBhIHByb2dyZXNzIGV2ZW50IGhhbmRsZXJcbiAgICogY2F1c2VzIHByZS1mbGlnaHQgT1BUSU9OUyByZXF1ZXN0cyB0byBiZSBzZW50IGZvciBDT1JTIHJlcXVlc3RzLFxuICAgKiBldmVuIGluIGNhc2VzIHdoZXJlIGEgcHJlLWZsaWdodCByZXF1ZXN0IHdvdWxkIG5vdCBvdGhlcndpc2UgYmVcbiAgICogc2VudC5cbiAgICpcbiAgICogQHNlZSBodHRwOi8veGhyLnNwZWMud2hhdHdnLm9yZy8jc2VjdXJpdHktY29uc2lkZXJhdGlvbnNcbiAgICpcbiAgICogTm90ZSB0aGF0IHRoaXMgY2FuIGNhdXNlIHByb2JsZW1zIGZvciBGaXJlZm94IDIyIGFuZCBiZWxvdywgYXMgYW5cbiAgICogb2xkZXIgXCJMU1Byb2dyZXNzRXZlbnRcIiB3aWxsIGJlIGRpc3BhdGNoZWQgYnkgdGhlIGJyb3dzZXIuIFRoYXRcbiAgICogcHJvZ3Jlc3MgZXZlbnQgaXMgbm8gbG9uZ2VyIHN1cHBvcnRlZCwgYW5kIGNhbiBsZWFkIHRvIGZhaWx1cmVzLFxuICAgKiBpbmNsdWRpbmcgdGhyb3dpbmcgZXhjZXB0aW9ucy5cbiAgICpcbiAgICogQHNlZSBodHRwOi8vYnVnemlsbGEubW96aWxsYS5vcmcvc2hvd19idWcuY2dpP2lkPTg0NTYzMVxuICAgKiBAc2VlIGIvMjM0Njk3OTNcbiAgICpcbiAgICogQHByaXZhdGUge2Jvb2xlYW59XG4gICAqL1xuICB0aGlzLnByb2dyZXNzRXZlbnRzRW5hYmxlZF8gPSBmYWxzZTtcblxuICAvKipcbiAgICogVHJ1ZSBpZiB3ZSBjYW4gdXNlIFhNTEh0dHBSZXF1ZXN0J3MgdGltZW91dCBkaXJlY3RseS5cbiAgICogQHByaXZhdGUge2Jvb2xlYW59XG4gICAqL1xuICB0aGlzLnVzZVhocjJUaW1lb3V0XyA9IGZhbHNlO1xuXG4gIC8qKlxuICAgKiBTcGVjaWZpY2F0aW9uIGZvciBUcnVzdCBUb2tlbiBvcGVyYXRpb25zIChpc3N1YW5jZSwgc2lnbmluZywgYW5kXG4gICAqIHJlZGVtcHRpb24pLlxuICAgKiBAcHJpdmF0ZSB7P1RydXN0VG9rZW5BdHRyaWJ1dGVUeXBlfVxuICAgKi9cbiAgdGhpcy50cnVzdFRva2VuXyA9IG51bGw7XG59O1xuZ29vZy5pbmhlcml0cyhnb29nLm5ldC5YaHJJbywgZ29vZy5ldmVudHMuRXZlbnRUYXJnZXQpO1xuXG5jb25zdCBYaHJJbyA9IGdvb2cubmV0LlhocklvO1xuXG4vKipcbiAqIFJlc3BvbnNlIHR5cGVzIHRoYXQgbWF5IGJlIHJlcXVlc3RlZCBmb3IgWE1MSHR0cFJlcXVlc3RzLlxuICogQGVudW0ge3N0cmluZ31cbiAqIEBzZWUgaHR0cDovL3d3dy53My5vcmcvVFIvWE1MSHR0cFJlcXVlc3QvI3RoZS1yZXNwb25zZXR5cGUtYXR0cmlidXRlXG4gKi9cbmdvb2cubmV0LlhocklvLlJlc3BvbnNlVHlwZSA9IHtcbiAgREVGQVVMVDogJycsXG4gIFRFWFQ6ICd0ZXh0JyxcbiAgRE9DVU1FTlQ6ICdkb2N1bWVudCcsXG4gIC8vIE5vdCBzdXBwb3J0ZWQgYXMgb2YgQ2hyb21lIDEwLjAuNjEyLjEgZGV2XG4gIEJMT0I6ICdibG9iJyxcbiAgQVJSQVlfQlVGRkVSOiAnYXJyYXlidWZmZXInLFxufTtcblxuY29uc3QgUmVzcG9uc2VUeXBlID0gZ29vZy5uZXQuWGhySW8uUmVzcG9uc2VUeXBlO1xuXG5cbi8qKlxuICogQSByZWZlcmVuY2UgdG8gdGhlIFhocklvIGxvZ2dlclxuICogQHByaXZhdGUgez9nb29nLmxvZy5Mb2dnZXJ9XG4gKiBAY29uc3RcbiAqL1xuZ29vZy5uZXQuWGhySW8ucHJvdG90eXBlLmxvZ2dlcl8gPSBnb29nLmxvZy5nZXRMb2dnZXIoJ2dvb2cubmV0LlhocklvJyk7XG5cblxuLyoqXG4gKiBUaGUgQ29udGVudC1UeXBlIEhUVFAgaGVhZGVyIG5hbWVcbiAqIEB0eXBlIHtzdHJpbmd9XG4gKi9cbmdvb2cubmV0LlhocklvLkNPTlRFTlRfVFlQRV9IRUFERVIgPSAnQ29udGVudC1UeXBlJztcblxuXG4vKipcbiAqIFRoZSBDb250ZW50LVRyYW5zZmVyLUVuY29kaW5nIEhUVFAgaGVhZGVyIG5hbWVcbiAqIEB0eXBlIHtzdHJpbmd9XG4gKi9cbmdvb2cubmV0LlhocklvLkNPTlRFTlRfVFJBTlNGRVJfRU5DT0RJTkcgPSAnQ29udGVudC1UcmFuc2Zlci1FbmNvZGluZyc7XG5cblxuLyoqXG4gKiBUaGUgcGF0dGVybiBtYXRjaGluZyB0aGUgJ2h0dHAnIGFuZCAnaHR0cHMnIFVSSSBzY2hlbWVzXG4gKiBAdHlwZSB7IVJlZ0V4cH1cbiAqL1xuZ29vZy5uZXQuWGhySW8uSFRUUF9TQ0hFTUVfUEFUVEVSTiA9IC9eaHR0cHM/JC9pO1xuXG5jb25zdCBIVFRQX1NDSEVNRV9QQVRURVJOID0gZ29vZy5uZXQuWGhySW8uSFRUUF9TQ0hFTUVfUEFUVEVSTjtcblxuXG4vKipcbiAqIFRoZSBtZXRob2RzIHRoYXQgdHlwaWNhbGx5IGNvbWUgYWxvbmcgd2l0aCBmb3JtIGRhdGEuICBXZSBzZXQgZGlmZmVyZW50XG4gKiBoZWFkZXJzIGRlcGVuZGluZyBvbiB3aGV0aGVyIHRoZSBIVFRQIGFjdGlvbiBpcyBvbmUgb2YgdGhlc2UuXG4gKiBAdHlwZSB7IUFycmF5PHN0cmluZz59XG4gKi9cbmdvb2cubmV0LlhocklvLk1FVEhPRFNfV0lUSF9GT1JNX0RBVEEgPSBbJ1BPU1QnLCAnUFVUJ107XG5cblxuLyoqXG4gKiBUaGUgQ29udGVudC1UeXBlIEhUVFAgaGVhZGVyIHZhbHVlIGZvciBhIHVybC1lbmNvZGVkIGZvcm1cbiAqIEB0eXBlIHtzdHJpbmd9XG4gKi9cbmdvb2cubmV0LlhocklvLkZPUk1fQ09OVEVOVF9UWVBFID1cbiAgICAnYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkO2NoYXJzZXQ9dXRmLTgnO1xuXG5cbi8qKlxuICogVGhlIFhNTEh0dHBSZXF1ZXN0IExldmVsIHR3byB0aW1lb3V0IGRlbGF5IG1zIHByb3BlcnR5IG5hbWUuXG4gKlxuICogQHNlZSBodHRwOi8vd3d3LnczLm9yZy9UUi9YTUxIdHRwUmVxdWVzdC8jdGhlLXRpbWVvdXQtYXR0cmlidXRlXG4gKlxuICogQHByaXZhdGUge3N0cmluZ31cbiAqIEBjb25zdFxuICovXG5nb29nLm5ldC5YaHJJby5YSFIyX1RJTUVPVVRfID0gJ3RpbWVvdXQnO1xuXG5cbi8qKlxuICogVGhlIFhNTEh0dHBSZXF1ZXN0IExldmVsIHR3byBvbnRpbWVvdXQgaGFuZGxlciBwcm9wZXJ0eSBuYW1lLlxuICpcbiAqIEBzZWUgaHR0cDovL3d3dy53My5vcmcvVFIvWE1MSHR0cFJlcXVlc3QvI3RoZS10aW1lb3V0LWF0dHJpYnV0ZVxuICpcbiAqIEBwcml2YXRlIHtzdHJpbmd9XG4gKiBAY29uc3RcbiAqL1xuZ29vZy5uZXQuWGhySW8uWEhSMl9PTl9USU1FT1VUXyA9ICdvbnRpbWVvdXQnO1xuXG5cbi8qKlxuICogQWxsIG5vbi1kaXNwb3NlZCBpbnN0YW5jZXMgb2YgZ29vZy5uZXQuWGhySW8gY3JlYXRlZFxuICogYnkge0BsaW5rIGdvb2cubmV0LlhocklvLnNlbmR9IGFyZSBpbiB0aGlzIEFycmF5LlxuICogQHNlZSBnb29nLm5ldC5YaHJJby5jbGVhbnVwXG4gKiBAcHJpdmF0ZSB7IUFycmF5PCFnb29nLm5ldC5YaHJJbz59XG4gKi9cbmdvb2cubmV0LlhocklvLnNlbmRJbnN0YW5jZXNfID0gW107XG5cblxuLyoqXG4gKiBTdGF0aWMgc2VuZCB0aGF0IGNyZWF0ZXMgYSBzaG9ydCBsaXZlZCBpbnN0YW5jZSBvZiBYaHJJbyB0byBzZW5kIHRoZVxuICogcmVxdWVzdC5cbiAqIEBzZWUgZ29vZy5uZXQuWGhySW8uY2xlYW51cFxuICogQHBhcmFtIHtzdHJpbmd8Z29vZy5Vcml9IHVybCBVcmkgdG8gbWFrZSByZXF1ZXN0IHRvLlxuICogQHBhcmFtIHs/ZnVuY3Rpb24odGhpczpnb29nLm5ldC5YaHJJbywgPyk9fSBvcHRfY2FsbGJhY2sgQ2FsbGJhY2sgZnVuY3Rpb25cbiAqICAgICBmb3Igd2hlbiByZXF1ZXN0IGlzIGNvbXBsZXRlLlxuICogQHBhcmFtIHtzdHJpbmc9fSBvcHRfbWV0aG9kIFNlbmQgbWV0aG9kLCBkZWZhdWx0OiBHRVQuXG4gKiBAcGFyYW0ge0FycmF5QnVmZmVyfEFycmF5QnVmZmVyVmlld3xCbG9ifERvY3VtZW50fEZvcm1EYXRhfHN0cmluZz19XG4gKiAgICAgb3B0X2NvbnRlbnQgQm9keSBkYXRhLlxuICogQHBhcmFtIHtPYmplY3R8Z29vZy5zdHJ1Y3RzLk1hcD19IG9wdF9oZWFkZXJzIE1hcCBvZiBoZWFkZXJzIHRvIGFkZCB0byB0aGVcbiAqICAgICByZXF1ZXN0LlxuICogQHBhcmFtIHtudW1iZXI9fSBvcHRfdGltZW91dEludGVydmFsIE51bWJlciBvZiBtaWxsaXNlY29uZHMgYWZ0ZXIgd2hpY2ggYW5cbiAqICAgICBpbmNvbXBsZXRlIHJlcXVlc3Qgd2lsbCBiZSBhYm9ydGVkOyAwIG1lYW5zIG5vIHRpbWVvdXQgaXMgc2V0LlxuICogQHBhcmFtIHtib29sZWFuPX0gb3B0X3dpdGhDcmVkZW50aWFscyBXaGV0aGVyIHRvIHNlbmQgY3JlZGVudGlhbHMgd2l0aCB0aGVcbiAqICAgICByZXF1ZXN0LiBEZWZhdWx0IHRvIGZhbHNlLiBTZWUge0BsaW5rIGdvb2cubmV0LlhocklvI3NldFdpdGhDcmVkZW50aWFsc30uXG4gKiBAcmV0dXJuIHshZ29vZy5uZXQuWGhySW99IFRoZSBzZW50IFhocklvLlxuICovXG5nb29nLm5ldC5YaHJJby5zZW5kID0gZnVuY3Rpb24oXG4gICAgdXJsLCBvcHRfY2FsbGJhY2ssIG9wdF9tZXRob2QsIG9wdF9jb250ZW50LCBvcHRfaGVhZGVycyxcbiAgICBvcHRfdGltZW91dEludGVydmFsLCBvcHRfd2l0aENyZWRlbnRpYWxzKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgY29uc3QgeCA9IG5ldyBnb29nLm5ldC5YaHJJbygpO1xuICBnb29nLm5ldC5YaHJJby5zZW5kSW5zdGFuY2VzXy5wdXNoKHgpO1xuICBpZiAob3B0X2NhbGxiYWNrKSB7XG4gICAgeC5saXN0ZW4oZ29vZy5uZXQuRXZlbnRUeXBlLkNPTVBMRVRFLCBvcHRfY2FsbGJhY2spO1xuICB9XG4gIHgubGlzdGVuT25jZShnb29nLm5ldC5FdmVudFR5cGUuUkVBRFksIHguY2xlYW51cFNlbmRfKTtcbiAgaWYgKG9wdF90aW1lb3V0SW50ZXJ2YWwpIHtcbiAgICB4LnNldFRpbWVvdXRJbnRlcnZhbChvcHRfdGltZW91dEludGVydmFsKTtcbiAgfVxuICBpZiAob3B0X3dpdGhDcmVkZW50aWFscykge1xuICAgIHguc2V0V2l0aENyZWRlbnRpYWxzKG9wdF93aXRoQ3JlZGVudGlhbHMpO1xuICB9XG4gIHguc2VuZCh1cmwsIG9wdF9tZXRob2QsIG9wdF9jb250ZW50LCBvcHRfaGVhZGVycyk7XG4gIHJldHVybiB4O1xufTtcblxuXG4vKipcbiAqIERpc3Bvc2VzIGFsbCBub24tZGlzcG9zZWQgaW5zdGFuY2VzIG9mIGdvb2cubmV0LlhocklvIGNyZWF0ZWQgYnlcbiAqIHtAbGluayBnb29nLm5ldC5YaHJJby5zZW5kfS5cbiAqIHtAbGluayBnb29nLm5ldC5YaHJJby5zZW5kfSBjbGVhbnMgdXAgdGhlIGdvb2cubmV0LlhocklvIGluc3RhbmNlXG4gKiBpdCBjcmVhdGVzIHdoZW4gdGhlIHJlcXVlc3QgY29tcGxldGVzIG9yIGZhaWxzLiAgSG93ZXZlciwgaWZcbiAqIHRoZSByZXF1ZXN0IG5ldmVyIGNvbXBsZXRlcywgdGhlbiB0aGUgZ29vZy5uZXQuWGhySW8gaXMgbm90IGRpc3Bvc2VkLlxuICogVGhpcyBjYW4gb2NjdXIgaWYgdGhlIHdpbmRvdyBpcyB1bmxvYWRlZCBiZWZvcmUgdGhlIHJlcXVlc3QgY29tcGxldGVzLlxuICogV2UgY291bGQgaGF2ZSB7QGxpbmsgZ29vZy5uZXQuWGhySW8uc2VuZH0gcmV0dXJuIHRoZSBnb29nLm5ldC5YaHJJb1xuICogaXQgY3JlYXRlcyBhbmQgbWFrZSB0aGUgY2xpZW50IG9mIHtAbGluayBnb29nLm5ldC5YaHJJby5zZW5kfSBiZVxuICogcmVzcG9uc2libGUgZm9yIGRpc3Bvc2luZyBpdCBpbiB0aGlzIGNhc2UuICBIb3dldmVyLCB0aGlzIG1ha2VzIHRoaW5nc1xuICogc2lnbmlmaWNhbnRseSBtb3JlIGNvbXBsaWNhdGVkIGZvciB0aGUgY2xpZW50LCBhbmQgdGhlIHdob2xlIHBvaW50XG4gKiBvZiB7QGxpbmsgZ29vZy5uZXQuWGhySW8uc2VuZH0gaXMgdGhhdCBpdCdzIHNpbXBsZSBhbmQgZWFzeSB0byB1c2UuXG4gKiBDbGllbnRzIG9mIHtAbGluayBnb29nLm5ldC5YaHJJby5zZW5kfSBzaG91bGQgY2FsbFxuICoge0BsaW5rIGdvb2cubmV0LlhocklvLmNsZWFudXB9IHdoZW4gZG9pbmcgZmluYWxcbiAqIGNsZWFudXAgb24gd2luZG93IHVubG9hZC5cbiAqL1xuZ29vZy5uZXQuWGhySW8uY2xlYW51cCA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIGNvbnN0IGluc3RhbmNlcyA9IGdvb2cubmV0LlhocklvLnNlbmRJbnN0YW5jZXNfO1xuICB3aGlsZSAoaW5zdGFuY2VzLmxlbmd0aCkge1xuICAgIGluc3RhbmNlcy5wb3AoKS5kaXNwb3NlKCk7XG4gIH1cbn07XG5cblxuLyoqXG4gKiBJbnN0YWxscyBleGNlcHRpb24gcHJvdGVjdGlvbiBmb3IgYWxsIGVudHJ5IHBvaW50IGludHJvZHVjZWQgYnlcbiAqIGdvb2cubmV0LlhocklvIGluc3RhbmNlcyB3aGljaCBhcmUgbm90IHByb3RlY3RlZCBieVxuICoge0BsaW5rIGdvb2cuZGVidWcuRXJyb3JIYW5kbGVyI3Byb3RlY3RXaW5kb3dTZXRUaW1lb3V0fSxcbiAqIHtAbGluayBnb29nLmRlYnVnLkVycm9ySGFuZGxlciNwcm90ZWN0V2luZG93U2V0SW50ZXJ2YWx9LCBvclxuICoge0BsaW5rIGdvb2cuZXZlbnRzLnByb3RlY3RCcm93c2VyRXZlbnRFbnRyeVBvaW50fS5cbiAqXG4gKiBAcGFyYW0ge2dvb2cuZGVidWcuRXJyb3JIYW5kbGVyfSBlcnJvckhhbmRsZXIgRXJyb3IgaGFuZGxlciB3aXRoIHdoaWNoIHRvXG4gKiAgICAgcHJvdGVjdCB0aGUgZW50cnkgcG9pbnQocykuXG4gKi9cbmdvb2cubmV0LlhocklvLnByb3RlY3RFbnRyeVBvaW50cyA9IGZ1bmN0aW9uKGVycm9ySGFuZGxlcikge1xuICAndXNlIHN0cmljdCc7XG4gIGdvb2cubmV0LlhocklvLnByb3RvdHlwZS5vblJlYWR5U3RhdGVDaGFuZ2VFbnRyeVBvaW50XyA9XG4gICAgICBlcnJvckhhbmRsZXIucHJvdGVjdEVudHJ5UG9pbnQoXG4gICAgICAgICAgZ29vZy5uZXQuWGhySW8ucHJvdG90eXBlLm9uUmVhZHlTdGF0ZUNoYW5nZUVudHJ5UG9pbnRfKTtcbn07XG5cblxuLyoqXG4gKiBEaXNwb3NlcyBvZiB0aGUgc3BlY2lmaWVkIGdvb2cubmV0LlhocklvIGNyZWF0ZWQgYnlcbiAqIHtAbGluayBnb29nLm5ldC5YaHJJby5zZW5kfSBhbmQgcmVtb3ZlcyBpdCBmcm9tXG4gKiB7QGxpbmsgZ29vZy5uZXQuWGhySW8ucGVuZGluZ1N0YXRpY1NlbmRJbnN0YW5jZXNffS5cbiAqIEBwcml2YXRlXG4gKi9cbmdvb2cubmV0LlhocklvLnByb3RvdHlwZS5jbGVhbnVwU2VuZF8gPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICB0aGlzLmRpc3Bvc2UoKTtcbiAgZ29vZy5hcnJheS5yZW1vdmUoZ29vZy5uZXQuWGhySW8uc2VuZEluc3RhbmNlc18sIHRoaXMpO1xufTtcblxuXG4vKipcbiAqIFJldHVybnMgdGhlIG51bWJlciBvZiBtaWxsaXNlY29uZHMgYWZ0ZXIgd2hpY2ggYW4gaW5jb21wbGV0ZSByZXF1ZXN0IHdpbGwgYmVcbiAqIGFib3J0ZWQsIG9yIDAgaWYgbm8gdGltZW91dCBpcyBzZXQuXG4gKiBAcmV0dXJuIHtudW1iZXJ9IFRpbWVvdXQgaW50ZXJ2YWwgaW4gbWlsbGlzZWNvbmRzLlxuICovXG5nb29nLm5ldC5YaHJJby5wcm90b3R5cGUuZ2V0VGltZW91dEludGVydmFsID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmV0dXJuIHRoaXMudGltZW91dEludGVydmFsXztcbn07XG5cblxuLyoqXG4gKiBTZXRzIHRoZSBudW1iZXIgb2YgbWlsbGlzZWNvbmRzIGFmdGVyIHdoaWNoIGFuIGluY29tcGxldGUgcmVxdWVzdCB3aWxsIGJlXG4gKiBhYm9ydGVkIGFuZCBhIHtAbGluayBnb29nLm5ldC5FdmVudFR5cGUuVElNRU9VVH0gZXZlbnQgcmFpc2VkOyAwIG1lYW5zIG5vXG4gKiB0aW1lb3V0IGlzIHNldC5cbiAqIEBwYXJhbSB7bnVtYmVyfSBtcyBUaW1lb3V0IGludGVydmFsIGluIG1pbGxpc2Vjb25kczsgMCBtZWFucyBub25lLlxuICovXG5nb29nLm5ldC5YaHJJby5wcm90b3R5cGUuc2V0VGltZW91dEludGVydmFsID0gZnVuY3Rpb24obXMpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICB0aGlzLnRpbWVvdXRJbnRlcnZhbF8gPSBNYXRoLm1heCgwLCBtcyk7XG59O1xuXG5cbi8qKlxuICogU2V0cyB0aGUgZGVzaXJlZCB0eXBlIGZvciB0aGUgcmVzcG9uc2UuIEF0IHRpbWUgb2Ygd3JpdGluZywgdGhpcyBpcyBvbmx5XG4gKiBzdXBwb3J0ZWQgaW4gdmVyeSByZWNlbnQgdmVyc2lvbnMgb2YgV2ViS2l0ICgxMC4wLjYxMi4xIGRldiBhbmQgbGF0ZXIpLlxuICpcbiAqIElmIHRoaXMgaXMgdXNlZCwgdGhlIHJlc3BvbnNlIG1heSBvbmx5IGJlIGFjY2Vzc2VkIHZpYSB7QGxpbmsgI2dldFJlc3BvbnNlfS5cbiAqXG4gKiBAcGFyYW0ge2dvb2cubmV0LlhocklvLlJlc3BvbnNlVHlwZX0gdHlwZSBUaGUgZGVzaXJlZCB0eXBlIGZvciB0aGUgcmVzcG9uc2UuXG4gKi9cbmdvb2cubmV0LlhocklvLnByb3RvdHlwZS5zZXRSZXNwb25zZVR5cGUgPSBmdW5jdGlvbih0eXBlKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgdGhpcy5yZXNwb25zZVR5cGVfID0gdHlwZTtcbn07XG5cblxuLyoqXG4gKiBHZXRzIHRoZSBkZXNpcmVkIHR5cGUgZm9yIHRoZSByZXNwb25zZS5cbiAqIEByZXR1cm4ge2dvb2cubmV0LlhocklvLlJlc3BvbnNlVHlwZX0gVGhlIGRlc2lyZWQgdHlwZSBmb3IgdGhlIHJlc3BvbnNlLlxuICovXG5nb29nLm5ldC5YaHJJby5wcm90b3R5cGUuZ2V0UmVzcG9uc2VUeXBlID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmV0dXJuIHRoaXMucmVzcG9uc2VUeXBlXztcbn07XG5cblxuLyoqXG4gKiBTZXRzIHdoZXRoZXIgYSBcImNyZWRlbnRpYWxlZFwiIHJlcXVlc3QgdGhhdCBpcyBhd2FyZSBvZiBjb29raWUgYW5kXG4gKiBhdXRoZW50aWNhdGlvbiBpbmZvcm1hdGlvbiBzaG91bGQgYmUgbWFkZS4gVGhpcyBvcHRpb24gaXMgb25seSBzdXBwb3J0ZWQgYnlcbiAqIGJyb3dzZXJzIHRoYXQgc3VwcG9ydCBIVFRQIEFjY2VzcyBDb250cm9sLiBBcyBvZiB0aGlzIHdyaXRpbmcsIHRoaXMgb3B0aW9uXG4gKiBpcyBub3Qgc3VwcG9ydGVkIGluIElFLlxuICpcbiAqIEBwYXJhbSB7Ym9vbGVhbn0gd2l0aENyZWRlbnRpYWxzIFdoZXRoZXIgdGhpcyBzaG91bGQgYmUgYSBcImNyZWRlbnRpYWxlZFwiXG4gKiAgICAgcmVxdWVzdC5cbiAqL1xuZ29vZy5uZXQuWGhySW8ucHJvdG90eXBlLnNldFdpdGhDcmVkZW50aWFscyA9IGZ1bmN0aW9uKHdpdGhDcmVkZW50aWFscykge1xuICAndXNlIHN0cmljdCc7XG4gIHRoaXMud2l0aENyZWRlbnRpYWxzXyA9IHdpdGhDcmVkZW50aWFscztcbn07XG5cblxuLyoqXG4gKiBHZXRzIHdoZXRoZXIgYSBcImNyZWRlbnRpYWxlZFwiIHJlcXVlc3QgaXMgdG8gYmUgc2VudC5cbiAqIEByZXR1cm4ge2Jvb2xlYW59IFRoZSBkZXNpcmVkIHR5cGUgZm9yIHRoZSByZXNwb25zZS5cbiAqL1xuZ29vZy5uZXQuWGhySW8ucHJvdG90eXBlLmdldFdpdGhDcmVkZW50aWFscyA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIHJldHVybiB0aGlzLndpdGhDcmVkZW50aWFsc187XG59O1xuXG5cbi8qKlxuICogU2V0cyB3aGV0aGVyIHByb2dyZXNzIGV2ZW50cyBhcmUgZW5hYmxlZCBmb3IgdGhpcyByZXF1ZXN0LiBOb3RlXG4gKiB0aGF0IHByb2dyZXNzIGV2ZW50cyByZXF1aXJlIHByZS1mbGlnaHQgT1BUSU9OUyByZXF1ZXN0IGhhbmRsaW5nXG4gKiBmb3IgQ09SUyByZXF1ZXN0cywgYW5kIG1heSBjYXVzZSB0cm91YmxlIHdpdGggb2xkZXIgYnJvd3NlcnMuIFNlZVxuICogcHJvZ3Jlc3NFdmVudHNFbmFibGVkXyBmb3IgZGV0YWlscy5cbiAqIEBwYXJhbSB7Ym9vbGVhbn0gZW5hYmxlZCBXaGV0aGVyIHByb2dyZXNzIGV2ZW50cyBzaG91bGQgYmUgZW5hYmxlZC5cbiAqL1xuZ29vZy5uZXQuWGhySW8ucHJvdG90eXBlLnNldFByb2dyZXNzRXZlbnRzRW5hYmxlZCA9IGZ1bmN0aW9uKGVuYWJsZWQpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICB0aGlzLnByb2dyZXNzRXZlbnRzRW5hYmxlZF8gPSBlbmFibGVkO1xufTtcblxuXG4vKipcbiAqIEdldHMgd2hldGhlciBwcm9ncmVzcyBldmVudHMgYXJlIGVuYWJsZWQuXG4gKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHByb2dyZXNzIGV2ZW50cyBhcmUgZW5hYmxlZCBmb3IgdGhpcyByZXF1ZXN0LlxuICovXG5nb29nLm5ldC5YaHJJby5wcm90b3R5cGUuZ2V0UHJvZ3Jlc3NFdmVudHNFbmFibGVkID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmV0dXJuIHRoaXMucHJvZ3Jlc3NFdmVudHNFbmFibGVkXztcbn07XG5cbi8qKlxuICogU3BlY2lmeSBhIFRydXN0IFRva2VucyBvcGVyYXRpb24gdG8gZXhlY3V0ZSBhbG9uZ3NpZGUgdGhlIHJlcXVlc3QuXG4gKiBAcGFyYW0geyFUcnVzdFRva2VuQXR0cmlidXRlVHlwZX0gdHJ1c3RUb2tlbiBhIFRydXN0IFRva2VucyBvcGVyYXRpb24gdG9cbiAqICAgICBleGVjdXRlLlxuICovXG5nb29nLm5ldC5YaHJJby5wcm90b3R5cGUuc2V0VHJ1c3RUb2tlbiA9IGZ1bmN0aW9uKHRydXN0VG9rZW4pIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICB0aGlzLnRydXN0VG9rZW5fID0gdHJ1c3RUb2tlbjtcbn07XG5cbi8qKlxuICogSW5zdGFuY2Ugc2VuZCB0aGF0IGFjdHVhbGx5IHVzZXMgWE1MSHR0cFJlcXVlc3QgdG8gbWFrZSBhIHNlcnZlciBjYWxsLlxuICogQHBhcmFtIHtzdHJpbmd8Z29vZy5Vcml9IHVybCBVcmkgdG8gbWFrZSByZXF1ZXN0IHRvLlxuICogQHBhcmFtIHtzdHJpbmc9fSBvcHRfbWV0aG9kIFNlbmQgbWV0aG9kLCBkZWZhdWx0OiBHRVQuXG4gKiBAcGFyYW0ge0FycmF5QnVmZmVyfEFycmF5QnVmZmVyVmlld3xCbG9ifERvY3VtZW50fEZvcm1EYXRhfHN0cmluZz19XG4gKiAgICAgb3B0X2NvbnRlbnQgQm9keSBkYXRhLlxuICogQHBhcmFtIHtPYmplY3R8Z29vZy5zdHJ1Y3RzLk1hcD19IG9wdF9oZWFkZXJzIE1hcCBvZiBoZWFkZXJzIHRvIGFkZCB0byB0aGVcbiAqICAgICByZXF1ZXN0LlxuICogQHN1cHByZXNzIHtkZXByZWNhdGVkfSBVc2UgZGVwcmVjYXRlZCBnb29nLnN0cnVjdHMuZm9yRWFjaCB0byBhbGxvdyBkaWZmZXJlbnRcbiAqIHR5cGVzIG9mIHBhcmFtZXRlcnMgZm9yIG9wdF9oZWFkZXJzLlxuICovXG5nb29nLm5ldC5YaHJJby5wcm90b3R5cGUuc2VuZCA9IGZ1bmN0aW9uKFxuICAgIHVybCwgb3B0X21ldGhvZCwgb3B0X2NvbnRlbnQsIG9wdF9oZWFkZXJzKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgaWYgKHRoaXMueGhyXykge1xuICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgJ1tnb29nLm5ldC5YaHJJb10gT2JqZWN0IGlzIGFjdGl2ZSB3aXRoIGFub3RoZXIgcmVxdWVzdD0nICtcbiAgICAgICAgdGhpcy5sYXN0VXJpXyArICc7IG5ld1VyaT0nICsgdXJsKTtcbiAgfVxuXG4gIGNvbnN0IG1ldGhvZCA9IG9wdF9tZXRob2QgPyBvcHRfbWV0aG9kLnRvVXBwZXJDYXNlKCkgOiAnR0VUJztcblxuICB0aGlzLmxhc3RVcmlfID0gdXJsO1xuICB0aGlzLmxhc3RFcnJvcl8gPSAnJztcbiAgdGhpcy5sYXN0RXJyb3JDb2RlXyA9IGdvb2cubmV0LkVycm9yQ29kZS5OT19FUlJPUjtcbiAgdGhpcy5sYXN0TWV0aG9kXyA9IG1ldGhvZDtcbiAgdGhpcy5lcnJvckRpc3BhdGNoZWRfID0gZmFsc2U7XG4gIHRoaXMuYWN0aXZlXyA9IHRydWU7XG5cbiAgLy8gVXNlIHRoZSBmYWN0b3J5IHRvIGNyZWF0ZSB0aGUgWEhSIG9iamVjdCBhbmQgb3B0aW9uc1xuICB0aGlzLnhocl8gPSB0aGlzLmNyZWF0ZVhocigpO1xuICB0aGlzLnhock9wdGlvbnNfID0gdGhpcy54bWxIdHRwRmFjdG9yeV8gPyB0aGlzLnhtbEh0dHBGYWN0b3J5Xy5nZXRPcHRpb25zKCkgOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnb29nLm5ldC5YbWxIdHRwLmdldE9wdGlvbnMoKTtcblxuICAvLyBTZXQgdXAgdGhlIG9ucmVhZHlzdGF0ZWNoYW5nZSBjYWxsYmFja1xuICB0aGlzLnhocl8ub25yZWFkeXN0YXRlY2hhbmdlID0gZ29vZy5iaW5kKHRoaXMub25SZWFkeVN0YXRlQ2hhbmdlXywgdGhpcyk7XG5cbiAgLy8gU2V0IHVwIHVwbG9hZC9kb3dubG9hZCBwcm9ncmVzcyBldmVudHMsIGlmIHByb2dyZXNzIGV2ZW50cyBhcmUgc3VwcG9ydGVkLlxuICBpZiAodGhpcy5nZXRQcm9ncmVzc0V2ZW50c0VuYWJsZWQoKSAmJiAnb25wcm9ncmVzcycgaW4gdGhpcy54aHJfKSB7XG4gICAgdGhpcy54aHJfLm9ucHJvZ3Jlc3MgPSBnb29nLmJpbmQoZnVuY3Rpb24oZSkge1xuICAgICAgJ3VzZSBzdHJpY3QnO1xuICAgICAgdGhpcy5vblByb2dyZXNzSGFuZGxlcl8oZSwgdHJ1ZSk7XG4gICAgfSwgdGhpcyk7XG4gICAgaWYgKHRoaXMueGhyXy51cGxvYWQpIHtcbiAgICAgIHRoaXMueGhyXy51cGxvYWQub25wcm9ncmVzcyA9IGdvb2cuYmluZCh0aGlzLm9uUHJvZ3Jlc3NIYW5kbGVyXywgdGhpcyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFRyeSB0byBvcGVuIHRoZSBYTUxIdHRwUmVxdWVzdCAoYWx3YXlzIGFzeW5jKSwgaWYgYW4gZXJyb3Igb2NjdXJzIGhlcmUgaXRcbiAgICogaXMgZ2VuZXJhbGx5IHBlcm1pc3Npb24gZGVuaWVkXG4gICAqL1xuICB0cnkge1xuICAgIGdvb2cubG9nLmZpbmUodGhpcy5sb2dnZXJfLCB0aGlzLmZvcm1hdE1zZ18oJ09wZW5pbmcgWGhyJykpO1xuICAgIHRoaXMuaW5PcGVuXyA9IHRydWU7XG4gICAgdGhpcy54aHJfLm9wZW4obWV0aG9kLCBTdHJpbmcodXJsKSwgdHJ1ZSk7ICAvLyBBbHdheXMgYXN5bmMhXG4gICAgdGhpcy5pbk9wZW5fID0gZmFsc2U7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGdvb2cubG9nLmZpbmUoXG4gICAgICAgIHRoaXMubG9nZ2VyXywgdGhpcy5mb3JtYXRNc2dfKCdFcnJvciBvcGVuaW5nIFhocjogJyArIGVyci5tZXNzYWdlKSk7XG4gICAgdGhpcy5lcnJvcl8oZ29vZy5uZXQuRXJyb3JDb2RlLkVYQ0VQVElPTiwgZXJyKTtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBXZSBjYW4ndCB1c2UgbnVsbCBzaW5jZSB0aGlzIHdvbid0IGFsbG93IHJlcXVlc3RzIHdpdGggZm9ybSBkYXRhIHRvIGhhdmUgYVxuICAvLyBjb250ZW50IGxlbmd0aCBzcGVjaWZpZWQgd2hpY2ggd2lsbCBjYXVzZSBzb21lIHByb3hpZXMgdG8gcmV0dXJuIGEgNDExXG4gIC8vIGVycm9yLlxuICBjb25zdCBjb250ZW50ID0gb3B0X2NvbnRlbnQgfHwgJyc7XG5cbiAgY29uc3QgaGVhZGVycyA9IHRoaXMuaGVhZGVycy5jbG9uZSgpO1xuXG4gIC8vIEFkZCBoZWFkZXJzIHNwZWNpZmljIHRvIHRoaXMgcmVxdWVzdFxuICBpZiAob3B0X2hlYWRlcnMpIHtcbiAgICBnb29nLnN0cnVjdHMuZm9yRWFjaChvcHRfaGVhZGVycywgZnVuY3Rpb24odmFsdWUsIGtleSkge1xuICAgICAgJ3VzZSBzdHJpY3QnO1xuICAgICAgaGVhZGVycy5zZXQoa2V5LCB2YWx1ZSk7XG4gICAgfSk7XG4gIH1cblxuICAvLyBGaW5kIHdoZXRoZXIgYSBjb250ZW50IHR5cGUgaGVhZGVyIGlzIHNldCwgaWdub3JpbmcgY2FzZS5cbiAgLy8gSFRUUCBoZWFkZXIgbmFtZXMgYXJlIGNhc2UtaW5zZW5zaXRpdmUuICBTZWU6XG4gIC8vIGh0dHA6Ly93d3cudzMub3JnL1Byb3RvY29scy9yZmMyNjE2L3JmYzI2MTYtc2VjNC5odG1sI3NlYzQuMlxuICBjb25zdCBjb250ZW50VHlwZUtleSA9XG4gICAgICBnb29nLmFycmF5LmZpbmQoaGVhZGVycy5nZXRLZXlzKCksIGdvb2cubmV0LlhocklvLmlzQ29udGVudFR5cGVIZWFkZXJfKTtcblxuICBjb25zdCBjb250ZW50SXNGb3JtRGF0YSA9XG4gICAgICAoZ29vZy5nbG9iYWxbJ0Zvcm1EYXRhJ10gJiYgKGNvbnRlbnQgaW5zdGFuY2VvZiBnb29nLmdsb2JhbFsnRm9ybURhdGEnXSkpO1xuICBpZiAoZ29vZy5hcnJheS5jb250YWlucyhnb29nLm5ldC5YaHJJby5NRVRIT0RTX1dJVEhfRk9STV9EQVRBLCBtZXRob2QpICYmXG4gICAgICAhY29udGVudFR5cGVLZXkgJiYgIWNvbnRlbnRJc0Zvcm1EYXRhKSB7XG4gICAgLy8gRm9yIHJlcXVlc3RzIHR5cGljYWxseSB3aXRoIGZvcm0gZGF0YSwgZGVmYXVsdCB0byB0aGUgdXJsLWVuY29kZWQgZm9ybVxuICAgIC8vIGNvbnRlbnQgdHlwZSB1bmxlc3MgdGhpcyBpcyBhIEZvcm1EYXRhIHJlcXVlc3QuICBGb3IgRm9ybURhdGEsXG4gICAgLy8gdGhlIGJyb3dzZXIgd2lsbCBhdXRvbWF0aWNhbGx5IGFkZCBhIG11bHRpcGFydC9mb3JtLWRhdGEgY29udGVudCB0eXBlXG4gICAgLy8gd2l0aCBhbiBhcHByb3ByaWF0ZSBtdWx0aXBhcnQgYm91bmRhcnkuXG4gICAgaGVhZGVycy5zZXQoXG4gICAgICAgIGdvb2cubmV0LlhocklvLkNPTlRFTlRfVFlQRV9IRUFERVIsIGdvb2cubmV0LlhocklvLkZPUk1fQ09OVEVOVF9UWVBFKTtcbiAgfVxuXG4gIC8vIEFkZCB0aGUgaGVhZGVycyB0byB0aGUgWGhyIG9iamVjdFxuICBoZWFkZXJzLmZvckVhY2goZnVuY3Rpb24odmFsdWUsIGtleSkge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICB0aGlzLnhocl8uc2V0UmVxdWVzdEhlYWRlcihrZXksIHZhbHVlKTtcbiAgfSwgdGhpcyk7XG5cbiAgaWYgKHRoaXMucmVzcG9uc2VUeXBlXykge1xuICAgIHRoaXMueGhyXy5yZXNwb25zZVR5cGUgPSB0aGlzLnJlc3BvbnNlVHlwZV87XG4gIH1cbiAgLy8gU2V0IHhocl8ud2l0aENyZWRlbnRpYWxzIG9ubHkgd2hlbiB0aGUgdmFsdWUgaXMgZGlmZmVyZW50LCBvciBlbHNlIGluXG4gIC8vIHN5bmNocm9ub3VzIFhNTEh0cHBSZXF1ZXN0Lm9wZW4gRmlyZWZveCB3aWxsIHRocm93IGFuIGV4Y2VwdGlvbi5cbiAgLy8gaHR0cHM6Ly9idWd6aWxsYS5tb3ppbGxhLm9yZy9zaG93X2J1Zy5jZ2k/aWQ9NzM2MzQwXG4gIGlmICgnd2l0aENyZWRlbnRpYWxzJyBpbiB0aGlzLnhocl8gJiZcbiAgICAgIHRoaXMueGhyXy53aXRoQ3JlZGVudGlhbHMgIT09IHRoaXMud2l0aENyZWRlbnRpYWxzXykge1xuICAgIHRoaXMueGhyXy53aXRoQ3JlZGVudGlhbHMgPSB0aGlzLndpdGhDcmVkZW50aWFsc187XG4gIH1cblxuICBpZiAoJ3NldFRydXN0VG9rZW4nIGluIHRoaXMueGhyXyAmJiB0aGlzLnRydXN0VG9rZW5fKSB7XG4gICAgdHJ5IHtcbiAgICAgIHRoaXMueGhyXy5zZXRUcnVzdFRva2VuKHRoaXMudHJ1c3RUb2tlbl8pO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgZ29vZy5sb2cuZmluZShcbiAgICAgICAgICB0aGlzLmxvZ2dlcl8sIHRoaXMuZm9ybWF0TXNnXygnRXJyb3IgU2V0VHJ1c3RUb2tlbjogJyArIGVyci5tZXNzYWdlKSk7XG4gICAgfVxuICB9XG4gIC8qKlxuICAgKiBUcnkgdG8gc2VuZCB0aGUgcmVxdWVzdCwgb3Igb3RoZXIgd2lzZSByZXBvcnQgYW4gZXJyb3IgKDQwNCBub3QgZm91bmQpLlxuICAgKi9cbiAgdHJ5IHtcbiAgICB0aGlzLmNsZWFuVXBUaW1lb3V0VGltZXJfKCk7ICAvLyBQYXJhbm9pZCwgc2hvdWxkIG5ldmVyIGJlIHJ1bm5pbmcuXG4gICAgaWYgKHRoaXMudGltZW91dEludGVydmFsXyA+IDApIHtcbiAgICAgIHRoaXMudXNlWGhyMlRpbWVvdXRfID0gZ29vZy5uZXQuWGhySW8uc2hvdWxkVXNlWGhyMlRpbWVvdXRfKHRoaXMueGhyXyk7XG4gICAgICBnb29nLmxvZy5maW5lKFxuICAgICAgICAgIHRoaXMubG9nZ2VyXywgdGhpcy5mb3JtYXRNc2dfKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdXaWxsIGFib3J0IGFmdGVyICcgKyB0aGlzLnRpbWVvdXRJbnRlcnZhbF8gK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdtcyBpZiBpbmNvbXBsZXRlLCB4aHIyICcgKyB0aGlzLnVzZVhocjJUaW1lb3V0XykpO1xuICAgICAgaWYgKHRoaXMudXNlWGhyMlRpbWVvdXRfKSB7XG4gICAgICAgIHRoaXMueGhyX1tnb29nLm5ldC5YaHJJby5YSFIyX1RJTUVPVVRfXSA9IHRoaXMudGltZW91dEludGVydmFsXztcbiAgICAgICAgdGhpcy54aHJfW2dvb2cubmV0LlhocklvLlhIUjJfT05fVElNRU9VVF9dID1cbiAgICAgICAgICAgIGdvb2cuYmluZCh0aGlzLnRpbWVvdXRfLCB0aGlzKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMudGltZW91dElkXyA9XG4gICAgICAgICAgICBnb29nLlRpbWVyLmNhbGxPbmNlKHRoaXMudGltZW91dF8sIHRoaXMudGltZW91dEludGVydmFsXywgdGhpcyk7XG4gICAgICB9XG4gICAgfVxuICAgIGdvb2cubG9nLmZpbmUodGhpcy5sb2dnZXJfLCB0aGlzLmZvcm1hdE1zZ18oJ1NlbmRpbmcgcmVxdWVzdCcpKTtcbiAgICB0aGlzLmluU2VuZF8gPSB0cnVlO1xuICAgIHRoaXMueGhyXy5zZW5kKGNvbnRlbnQpO1xuICAgIHRoaXMuaW5TZW5kXyA9IGZhbHNlO1xuXG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGdvb2cubG9nLmZpbmUodGhpcy5sb2dnZXJfLCB0aGlzLmZvcm1hdE1zZ18oJ1NlbmQgZXJyb3I6ICcgKyBlcnIubWVzc2FnZSkpO1xuICAgIHRoaXMuZXJyb3JfKGdvb2cubmV0LkVycm9yQ29kZS5FWENFUFRJT04sIGVycik7XG4gIH1cbn07XG5cblxuLyoqXG4gKiBEZXRlcm1pbmVzIGlmIHRoZSBhcmd1bWVudCBpcyBhbiBYTUxIdHRwUmVxdWVzdCB0aGF0IHN1cHBvcnRzIHRoZSBsZXZlbCAyXG4gKiB0aW1lb3V0IHZhbHVlIGFuZCBldmVudC5cbiAqXG4gKiBDdXJyZW50bHksIEZGIDIxLjAgT1MgWCBoYXMgdGhlIGZpZWxkcyBidXQgd29uJ3QgYWN0dWFsbHkgY2FsbCB0aGUgdGltZW91dFxuICogaGFuZGxlci4gIFBlcmhhcHMgdGhlIGNvbmZ1c2lvbiBpbiB0aGUgYnVnIHJlZmVyZW5jZWQgYmVsb3cgaGFzbid0XG4gKiBlbnRpcmVseSBiZWVuIHJlc29sdmVkLlxuICpcbiAqIEBzZWUgaHR0cDovL3d3dy53My5vcmcvVFIvWE1MSHR0cFJlcXVlc3QvI3RoZS10aW1lb3V0LWF0dHJpYnV0ZVxuICogQHNlZSBodHRwczovL2J1Z3ppbGxhLm1vemlsbGEub3JnL3Nob3dfYnVnLmNnaT9pZD01MjU4MTZcbiAqXG4gKiBAcGFyYW0geyFnb29nLm5ldC5YaHJMaWtlLk9yTmF0aXZlfSB4aHIgVGhlIHJlcXVlc3QuXG4gKiBAcmV0dXJuIHtib29sZWFufSBUcnVlIGlmIHRoZSByZXF1ZXN0IHN1cHBvcnRzIGxldmVsIDIgdGltZW91dC5cbiAqIEBwcml2YXRlXG4gKi9cbmdvb2cubmV0LlhocklvLnNob3VsZFVzZVhocjJUaW1lb3V0XyA9IGZ1bmN0aW9uKHhocikge1xuICAndXNlIHN0cmljdCc7XG4gIHJldHVybiBnb29nLnVzZXJBZ2VudC5JRSAmJiBnb29nLnVzZXJBZ2VudC5pc1ZlcnNpb25PckhpZ2hlcig5KSAmJlxuICAgICAgdHlwZW9mIHhocltnb29nLm5ldC5YaHJJby5YSFIyX1RJTUVPVVRfXSA9PT0gJ251bWJlcicgJiZcbiAgICAgIHhocltnb29nLm5ldC5YaHJJby5YSFIyX09OX1RJTUVPVVRfXSAhPT0gdW5kZWZpbmVkO1xufTtcblxuXG4vKipcbiAqIEBwYXJhbSB7c3RyaW5nfSBoZWFkZXIgQW4gSFRUUCBoZWFkZXIga2V5LlxuICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGUga2V5IGlzIGEgY29udGVudCB0eXBlIGhlYWRlciAoaWdub3JpbmdcbiAqICAgICBjYXNlLlxuICogQHByaXZhdGVcbiAqL1xuZ29vZy5uZXQuWGhySW8uaXNDb250ZW50VHlwZUhlYWRlcl8gPSBmdW5jdGlvbihoZWFkZXIpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gZ29vZy5zdHJpbmcuY2FzZUluc2Vuc2l0aXZlRXF1YWxzKFxuICAgICAgZ29vZy5uZXQuWGhySW8uQ09OVEVOVF9UWVBFX0hFQURFUiwgaGVhZGVyKTtcbn07XG5cblxuLyoqXG4gKiBDcmVhdGVzIGEgbmV3IFhIUiBvYmplY3QuXG4gKiBAcmV0dXJuIHshZ29vZy5uZXQuWGhyTGlrZS5Pck5hdGl2ZX0gVGhlIG5ld2x5IGNyZWF0ZWQgWEhSIG9iamVjdC5cbiAqIEBwcm90ZWN0ZWRcbiAqL1xuZ29vZy5uZXQuWGhySW8ucHJvdG90eXBlLmNyZWF0ZVhociA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIHJldHVybiB0aGlzLnhtbEh0dHBGYWN0b3J5XyA/IHRoaXMueG1sSHR0cEZhY3RvcnlfLmNyZWF0ZUluc3RhbmNlKCkgOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnb29nLm5ldC5YbWxIdHRwKCk7XG59O1xuXG5cbi8qKlxuICogVGhlIHJlcXVlc3QgZGlkbid0IGNvbXBsZXRlIGFmdGVyIHtAbGluayBnb29nLm5ldC5YaHJJbyN0aW1lb3V0SW50ZXJ2YWxffVxuICogbWlsbGlzZWNvbmRzOyByYWlzZXMgYSB7QGxpbmsgZ29vZy5uZXQuRXZlbnRUeXBlLlRJTUVPVVR9IGV2ZW50IGFuZCBhYm9ydHNcbiAqIHRoZSByZXF1ZXN0LlxuICogQHByaXZhdGVcbiAqL1xuZ29vZy5uZXQuWGhySW8ucHJvdG90eXBlLnRpbWVvdXRfID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgaWYgKHR5cGVvZiBnb29nID09ICd1bmRlZmluZWQnKSB7XG4gICAgLy8gSWYgZ29vZyBpcyB1bmRlZmluZWQgdGhlbiB0aGUgY2FsbGJhY2sgaGFzIG9jY3VycmVkIGFzIHRoZSBhcHBsaWNhdGlvblxuICAgIC8vIGlzIHVubG9hZGluZyBhbmQgd2lsbCBlcnJvci4gIFRodXMgd2UgbGV0IGl0IHNpbGVudGx5IGZhaWwuXG4gIH0gZWxzZSBpZiAodGhpcy54aHJfKSB7XG4gICAgdGhpcy5sYXN0RXJyb3JfID1cbiAgICAgICAgJ1RpbWVkIG91dCBhZnRlciAnICsgdGhpcy50aW1lb3V0SW50ZXJ2YWxfICsgJ21zLCBhYm9ydGluZyc7XG4gICAgdGhpcy5sYXN0RXJyb3JDb2RlXyA9IGdvb2cubmV0LkVycm9yQ29kZS5USU1FT1VUO1xuICAgIGdvb2cubG9nLmZpbmUodGhpcy5sb2dnZXJfLCB0aGlzLmZvcm1hdE1zZ18odGhpcy5sYXN0RXJyb3JfKSk7XG4gICAgdGhpcy5kaXNwYXRjaEV2ZW50KGdvb2cubmV0LkV2ZW50VHlwZS5USU1FT1VUKTtcbiAgICB0aGlzLmFib3J0KGdvb2cubmV0LkVycm9yQ29kZS5USU1FT1VUKTtcbiAgfVxufTtcblxuXG4vKipcbiAqIFNvbWV0aGluZyBlcnJvcnJlZCwgc28gaW5hY3RpdmF0ZSwgZmlyZSBlcnJvciBjYWxsYmFjayBhbmQgY2xlYW4gdXBcbiAqIEBwYXJhbSB7Z29vZy5uZXQuRXJyb3JDb2RlfSBlcnJvckNvZGUgVGhlIGVycm9yIGNvZGUuXG4gKiBAcGFyYW0ge0Vycm9yfSBlcnIgVGhlIGVycm9yIG9iamVjdC5cbiAqIEBwcml2YXRlXG4gKi9cbmdvb2cubmV0LlhocklvLnByb3RvdHlwZS5lcnJvcl8gPSBmdW5jdGlvbihlcnJvckNvZGUsIGVycikge1xuICAndXNlIHN0cmljdCc7XG4gIHRoaXMuYWN0aXZlXyA9IGZhbHNlO1xuICBpZiAodGhpcy54aHJfKSB7XG4gICAgdGhpcy5pbkFib3J0XyA9IHRydWU7XG4gICAgdGhpcy54aHJfLmFib3J0KCk7ICAvLyBFbnN1cmVzIFhIUiBpc24ndCBodW5nIChGRilcbiAgICB0aGlzLmluQWJvcnRfID0gZmFsc2U7XG4gIH1cbiAgdGhpcy5sYXN0RXJyb3JfID0gZXJyO1xuICB0aGlzLmxhc3RFcnJvckNvZGVfID0gZXJyb3JDb2RlO1xuICB0aGlzLmRpc3BhdGNoRXJyb3JzXygpO1xuICB0aGlzLmNsZWFuVXBYaHJfKCk7XG59O1xuXG5cbi8qKlxuICogRGlzcGF0Y2hlcyBDT01QTEVURSBhbmQgRVJST1IgaW4gY2FzZSBvZiBhbiBlcnJvci4gVGhpcyBlbnN1cmVzIHRoYXQgd2UgZG9cbiAqIG5vdCBkaXNwYXRjaCBtdWx0aXBsZSBlcnJvciBldmVudHMuXG4gKiBAcHJpdmF0ZVxuICovXG5nb29nLm5ldC5YaHJJby5wcm90b3R5cGUuZGlzcGF0Y2hFcnJvcnNfID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgaWYgKCF0aGlzLmVycm9yRGlzcGF0Y2hlZF8pIHtcbiAgICB0aGlzLmVycm9yRGlzcGF0Y2hlZF8gPSB0cnVlO1xuICAgIHRoaXMuZGlzcGF0Y2hFdmVudChnb29nLm5ldC5FdmVudFR5cGUuQ09NUExFVEUpO1xuICAgIHRoaXMuZGlzcGF0Y2hFdmVudChnb29nLm5ldC5FdmVudFR5cGUuRVJST1IpO1xuICB9XG59O1xuXG5cbi8qKlxuICogQWJvcnQgdGhlIGN1cnJlbnQgWE1MSHR0cFJlcXVlc3RcbiAqIEBwYXJhbSB7Z29vZy5uZXQuRXJyb3JDb2RlPX0gb3B0X2ZhaWx1cmVDb2RlIE9wdGlvbmFsIGVycm9yIGNvZGUgdG8gdXNlIC1cbiAqICAgICBkZWZhdWx0cyB0byBBQk9SVC5cbiAqL1xuZ29vZy5uZXQuWGhySW8ucHJvdG90eXBlLmFib3J0ID0gZnVuY3Rpb24ob3B0X2ZhaWx1cmVDb2RlKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgaWYgKHRoaXMueGhyXyAmJiB0aGlzLmFjdGl2ZV8pIHtcbiAgICBnb29nLmxvZy5maW5lKHRoaXMubG9nZ2VyXywgdGhpcy5mb3JtYXRNc2dfKCdBYm9ydGluZycpKTtcbiAgICB0aGlzLmFjdGl2ZV8gPSBmYWxzZTtcbiAgICB0aGlzLmluQWJvcnRfID0gdHJ1ZTtcbiAgICB0aGlzLnhocl8uYWJvcnQoKTtcbiAgICB0aGlzLmluQWJvcnRfID0gZmFsc2U7XG4gICAgdGhpcy5sYXN0RXJyb3JDb2RlXyA9IG9wdF9mYWlsdXJlQ29kZSB8fCBnb29nLm5ldC5FcnJvckNvZGUuQUJPUlQ7XG4gICAgdGhpcy5kaXNwYXRjaEV2ZW50KGdvb2cubmV0LkV2ZW50VHlwZS5DT01QTEVURSk7XG4gICAgdGhpcy5kaXNwYXRjaEV2ZW50KGdvb2cubmV0LkV2ZW50VHlwZS5BQk9SVCk7XG4gICAgdGhpcy5jbGVhblVwWGhyXygpO1xuICB9XG59O1xuXG5cbi8qKlxuICogTnVsbGlmaWVzIGFsbCBjYWxsYmFja3MgdG8gcmVkdWNlIHJpc2tzIG9mIGxlYWtzLlxuICogQG92ZXJyaWRlXG4gKiBAcHJvdGVjdGVkXG4gKi9cbmdvb2cubmV0LlhocklvLnByb3RvdHlwZS5kaXNwb3NlSW50ZXJuYWwgPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBpZiAodGhpcy54aHJfKSB7XG4gICAgLy8gV2UgZXhwbGljaXRseSBkbyBub3QgY2FsbCB4aHJfLmFib3J0KCkgdW5sZXNzIGFjdGl2ZV8gaXMgc3RpbGwgdHJ1ZS5cbiAgICAvLyBUaGlzIGlzIHRvIGF2b2lkIHVubmVjZXNzYXJpbHkgYWJvcnRpbmcgYSBzdWNjZXNzZnVsIHJlcXVlc3Qgd2hlblxuICAgIC8vIGRpc3Bvc2UoKSBpcyBjYWxsZWQgaW4gYSBjYWxsYmFjayB0cmlnZ2VyZWQgYnkgYSBjb21wbGV0ZSByZXNwb25zZSwgYnV0XG4gICAgLy8gaW4gd2hpY2ggYnJvd3NlciBjbGVhbnVwIGhhcyBub3QgeWV0IGZpbmlzaGVkLlxuICAgIC8vIChTZWUgaHR0cDovL2IvaXNzdWU/aWQ9MTY4NDIxNy4pXG4gICAgaWYgKHRoaXMuYWN0aXZlXykge1xuICAgICAgdGhpcy5hY3RpdmVfID0gZmFsc2U7XG4gICAgICB0aGlzLmluQWJvcnRfID0gdHJ1ZTtcbiAgICAgIHRoaXMueGhyXy5hYm9ydCgpO1xuICAgICAgdGhpcy5pbkFib3J0XyA9IGZhbHNlO1xuICAgIH1cbiAgICB0aGlzLmNsZWFuVXBYaHJfKHRydWUpO1xuICB9XG5cbiAgWGhySW8uYmFzZSh0aGlzLCAnZGlzcG9zZUludGVybmFsJyk7XG59O1xuXG5cbi8qKlxuICogSW50ZXJuYWwgaGFuZGxlciBmb3IgdGhlIFhIUiBvYmplY3QncyByZWFkeXN0YXRlY2hhbmdlIGV2ZW50LiAgVGhpcyBtZXRob2RcbiAqIGNoZWNrcyB0aGUgc3RhdHVzIGFuZCB0aGUgcmVhZHlzdGF0ZSBhbmQgZmlyZXMgdGhlIGNvcnJlY3QgY2FsbGJhY2tzLlxuICogSWYgdGhlIHJlcXVlc3QgaGFzIGVuZGVkLCB0aGUgaGFuZGxlcnMgYXJlIGNsZWFuZWQgdXAgYW5kIHRoZSBYSFIgb2JqZWN0IGlzXG4gKiBudWxsaWZpZWQuXG4gKiBAcHJpdmF0ZVxuICovXG5nb29nLm5ldC5YaHJJby5wcm90b3R5cGUub25SZWFkeVN0YXRlQ2hhbmdlXyA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIGlmICh0aGlzLmlzRGlzcG9zZWQoKSkge1xuICAgIC8vIFRoaXMgbWV0aG9kIGlzIHRoZSB0YXJnZXQgb2YgYW4gdW50cmFja2VkIGdvb2cuVGltZXIuY2FsbE9uY2UoKS5cbiAgICByZXR1cm47XG4gIH1cbiAgaWYgKCF0aGlzLmluT3Blbl8gJiYgIXRoaXMuaW5TZW5kXyAmJiAhdGhpcy5pbkFib3J0Xykge1xuICAgIC8vIFdlcmUgbm90IGJlaW5nIGNhbGxlZCBmcm9tIHdpdGhpbiBhIGNhbGwgdG8gdGhpcy54aHJfLnNlbmRcbiAgICAvLyB0aGlzLnhocl8uYWJvcnQsIG9yIHRoaXMueGhyXy5vcGVuLCBzbyB0aGlzIGlzIGFuIGVudHJ5IHBvaW50XG4gICAgdGhpcy5vblJlYWR5U3RhdGVDaGFuZ2VFbnRyeVBvaW50XygpO1xuICB9IGVsc2Uge1xuICAgIHRoaXMub25SZWFkeVN0YXRlQ2hhbmdlSGVscGVyXygpO1xuICB9XG59O1xuXG5cbi8qKlxuICogVXNlZCB0byBwcm90ZWN0IHRoZSBvbnJlYWR5c3RhdGVjaGFuZ2UgaGFuZGxlciBlbnRyeSBwb2ludC4gIE5lY2Vzc2FyeVxuICogYXMgeyNvblJlYWR5U3RhdGVDaGFuZ2VffSBtYXliZSBjYWxsZWQgZnJvbSB3aXRoaW4gc2VuZCBvciBhYm9ydCwgdGhpc1xuICogbWV0aG9kIGlzIG9ubHkgY2FsbGVkIHdoZW4geyNvblJlYWR5U3RhdGVDaGFuZ2VffSBpcyBjYWxsZWQgYXMgYW5cbiAqIGVudHJ5IHBvaW50LlxuICoge0BzZWUgI3Byb3RlY3RFbnRyeVBvaW50c31cbiAqIEBwcml2YXRlXG4gKi9cbmdvb2cubmV0LlhocklvLnByb3RvdHlwZS5vblJlYWR5U3RhdGVDaGFuZ2VFbnRyeVBvaW50XyA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIHRoaXMub25SZWFkeVN0YXRlQ2hhbmdlSGVscGVyXygpO1xufTtcblxuXG4vKipcbiAqIEhlbHBlciBmb3Ige0BsaW5rICNvblJlYWR5U3RhdGVDaGFuZ2VffS4gIFRoaXMgaXMgdXNlZCBzbyB0aGF0XG4gKiBlbnRyeSBwb2ludCBjYWxscyB0byB7QGxpbmsgI29uUmVhZHlTdGF0ZUNoYW5nZV99IGNhbiBiZSByb3V0ZWQgdGhyb3VnaFxuICoge0BsaW5rICNvblJlYWR5U3RhdGVDaGFuZ2VFbnRyeVBvaW50X30uXG4gKiBAcHJpdmF0ZVxuICovXG5nb29nLm5ldC5YaHJJby5wcm90b3R5cGUub25SZWFkeVN0YXRlQ2hhbmdlSGVscGVyXyA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIGlmICghdGhpcy5hY3RpdmVfKSB7XG4gICAgLy8gY2FuIGdldCBjYWxsZWQgaW5zaWRlIGFib3J0IGNhbGxcbiAgICByZXR1cm47XG4gIH1cblxuICBpZiAodHlwZW9mIGdvb2cgPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAvLyBOT1RFKHVzZXIpOiBJZiBnb29nIGlzIHVuZGVmaW5lZCB0aGVuIHRoZSBjYWxsYmFjayBoYXMgb2NjdXJyZWQgYXMgdGhlXG4gICAgLy8gYXBwbGljYXRpb24gaXMgdW5sb2FkaW5nIGFuZCB3aWxsIGVycm9yLiAgVGh1cyB3ZSBsZXQgaXQgc2lsZW50bHkgZmFpbC5cblxuICB9IGVsc2UgaWYgKFxuICAgICAgdGhpcy54aHJPcHRpb25zX1tnb29nLm5ldC5YbWxIdHRwLk9wdGlvblR5cGUuTE9DQUxfUkVRVUVTVF9FUlJPUl0gJiZcbiAgICAgIHRoaXMuZ2V0UmVhZHlTdGF0ZSgpID09IGdvb2cubmV0LlhtbEh0dHAuUmVhZHlTdGF0ZS5DT01QTEVURSAmJlxuICAgICAgdGhpcy5nZXRTdGF0dXMoKSA9PSAyKSB7XG4gICAgLy8gTk9URSh1c2VyKTogSW4gSUUgaWYgc2VuZCgpIGVycm9ycyBvbiBhICpsb2NhbCogcmVxdWVzdCB0aGUgcmVhZHlzdGF0ZVxuICAgIC8vIGlzIHN0aWxsIGNoYW5nZWQgdG8gQ09NUExFVEUuICBXZSBuZWVkIHRvIGlnbm9yZSBpdCBhbmQgYWxsb3cgdGhlXG4gICAgLy8gdHJ5L2NhdGNoIGFyb3VuZCBzZW5kKCkgdG8gcGljayB1cCB0aGUgZXJyb3IuXG4gICAgZ29vZy5sb2cuZmluZShcbiAgICAgICAgdGhpcy5sb2dnZXJfLFxuICAgICAgICB0aGlzLmZvcm1hdE1zZ18oJ0xvY2FsIHJlcXVlc3QgZXJyb3IgZGV0ZWN0ZWQgYW5kIGlnbm9yZWQnKSk7XG5cbiAgfSBlbHNlIHtcbiAgICAvLyBJbiBJRSB3aGVuIHRoZSByZXNwb25zZSBoYXMgYmVlbiBjYWNoZWQgd2Ugc29tZXRpbWVzIGdldCB0aGUgY2FsbGJhY2tcbiAgICAvLyBmcm9tIGluc2lkZSB0aGUgc2VuZCBjYWxsIGFuZCB0aGlzIHVzdWFsbHkgYnJlYWtzIGNvZGUgdGhhdCBhc3N1bWVzIHRoYXRcbiAgICAvLyBYaHJJbyBpcyBhc3luY2hyb25vdXMuICBJZiB0aGF0IGlzIHRoZSBjYXNlIHdlIGRlbGF5IHRoZSBjYWxsYmFja1xuICAgIC8vIHVzaW5nIGEgdGltZXIuXG4gICAgaWYgKHRoaXMuaW5TZW5kXyAmJlxuICAgICAgICB0aGlzLmdldFJlYWR5U3RhdGUoKSA9PSBnb29nLm5ldC5YbWxIdHRwLlJlYWR5U3RhdGUuQ09NUExFVEUpIHtcbiAgICAgIGdvb2cuVGltZXIuY2FsbE9uY2UodGhpcy5vblJlYWR5U3RhdGVDaGFuZ2VfLCAwLCB0aGlzKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLmRpc3BhdGNoRXZlbnQoZ29vZy5uZXQuRXZlbnRUeXBlLlJFQURZX1NUQVRFX0NIQU5HRSk7XG5cbiAgICAvLyByZWFkeVN0YXRlIGluZGljYXRlcyB0aGUgdHJhbnNmZXIgaGFzIGZpbmlzaGVkXG4gICAgaWYgKHRoaXMuaXNDb21wbGV0ZSgpKSB7XG4gICAgICBnb29nLmxvZy5maW5lKHRoaXMubG9nZ2VyXywgdGhpcy5mb3JtYXRNc2dfKCdSZXF1ZXN0IGNvbXBsZXRlJykpO1xuXG4gICAgICB0aGlzLmFjdGl2ZV8gPSBmYWxzZTtcblxuICAgICAgdHJ5IHtcbiAgICAgICAgLy8gQ2FsbCB0aGUgc3BlY2lmaWMgY2FsbGJhY2tzIGZvciBzdWNjZXNzIG9yIGZhaWx1cmUuIE9ubHkgY2FsbCB0aGVcbiAgICAgICAgLy8gc3VjY2VzcyBpZiB0aGUgc3RhdHVzIGlzIDIwMCAoSFRUUF9PSykgb3IgMzA0IChIVFRQX0NBQ0hFRClcbiAgICAgICAgaWYgKHRoaXMuaXNTdWNjZXNzKCkpIHtcbiAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoZ29vZy5uZXQuRXZlbnRUeXBlLkNPTVBMRVRFKTtcbiAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoZ29vZy5uZXQuRXZlbnRUeXBlLlNVQ0NFU1MpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMubGFzdEVycm9yQ29kZV8gPSBnb29nLm5ldC5FcnJvckNvZGUuSFRUUF9FUlJPUjtcbiAgICAgICAgICB0aGlzLmxhc3RFcnJvcl8gPVxuICAgICAgICAgICAgICB0aGlzLmdldFN0YXR1c1RleHQoKSArICcgWycgKyB0aGlzLmdldFN0YXR1cygpICsgJ10nO1xuICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFcnJvcnNfKCk7XG4gICAgICAgIH1cbiAgICAgIH0gZmluYWxseSB7XG4gICAgICAgIHRoaXMuY2xlYW5VcFhocl8oKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbn07XG5cblxuLyoqXG4gKiBJbnRlcm5hbCBoYW5kbGVyIGZvciB0aGUgWEhSIG9iamVjdCdzIG9ucHJvZ3Jlc3MgZXZlbnQuIEZpcmVzIGJvdGggYSBnZW5lcmljXG4gKiBQUk9HUkVTUyBldmVudCBhbmQgZWl0aGVyIGEgRE9XTkxPQURfUFJPR1JFU1Mgb3IgVVBMT0FEX1BST0dSRVNTIGV2ZW50IHRvXG4gKiBhbGxvdyBzcGVjaWZpYyBiaW5kaW5nIGZvciBlYWNoIFhIUiBwcm9ncmVzcyBldmVudC5cbiAqIEBwYXJhbSB7IVByb2dyZXNzRXZlbnR9IGUgWEhSIHByb2dyZXNzIGV2ZW50LlxuICogQHBhcmFtIHtib29sZWFuPX0gb3B0X2lzRG93bmxvYWQgV2hldGhlciB0aGUgY3VycmVudCBwcm9ncmVzcyBldmVudCBpcyBmcm9tIGFcbiAqICAgICBkb3dubG9hZC4gVXNlZCB0byBkZXRlcm1pbmUgd2hldGhlciBET1dOTE9BRF9QUk9HUkVTUyBvciBVUExPQURfUFJPR1JFU1NcbiAqICAgICBldmVudCBzaG91bGQgYmUgZGlzcGF0Y2hlZC5cbiAqIEBwcml2YXRlXG4gKi9cbmdvb2cubmV0LlhocklvLnByb3RvdHlwZS5vblByb2dyZXNzSGFuZGxlcl8gPSBmdW5jdGlvbihlLCBvcHRfaXNEb3dubG9hZCkge1xuICAndXNlIHN0cmljdCc7XG4gIGdvb2cuYXNzZXJ0cy5hc3NlcnQoXG4gICAgICBlLnR5cGUgPT09IGdvb2cubmV0LkV2ZW50VHlwZS5QUk9HUkVTUyxcbiAgICAgICdnb29nLm5ldC5FdmVudFR5cGUuUFJPR1JFU1MgaXMgb2YgdGhlIHNhbWUgdHlwZSBhcyByYXcgWEhSIHByb2dyZXNzLicpO1xuICB0aGlzLmRpc3BhdGNoRXZlbnQoXG4gICAgICBnb29nLm5ldC5YaHJJby5idWlsZFByb2dyZXNzRXZlbnRfKGUsIGdvb2cubmV0LkV2ZW50VHlwZS5QUk9HUkVTUykpO1xuICB0aGlzLmRpc3BhdGNoRXZlbnQoXG4gICAgICBnb29nLm5ldC5YaHJJby5idWlsZFByb2dyZXNzRXZlbnRfKFxuICAgICAgICAgIGUsIG9wdF9pc0Rvd25sb2FkID8gZ29vZy5uZXQuRXZlbnRUeXBlLkRPV05MT0FEX1BST0dSRVNTIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdvb2cubmV0LkV2ZW50VHlwZS5VUExPQURfUFJPR1JFU1MpKTtcbn07XG5cblxuLyoqXG4gKiBDcmVhdGVzIGEgcmVwcmVzZW50YXRpb24gb2YgdGhlIG5hdGl2ZSBQcm9ncmVzc0V2ZW50LiBJRSBkb2Vzbid0IHN1cHBvcnRcbiAqIGNvbnN0cnVjdGluZyBQcm9ncmVzc0V2ZW50IHZpYSBcIm5ld1wiLCBhbmQgdGhlIGFsdGVybmF0aXZlcyAoZS5nLixcbiAqIFByb2dyZXNzRXZlbnQuaW5pdFByb2dyZXNzRXZlbnQpIGFyZSBub24tc3RhbmRhcmQgb3IgZGVwcmVjYXRlZC5cbiAqIEBwYXJhbSB7IVByb2dyZXNzRXZlbnR9IGUgWEhSIHByb2dyZXNzIGV2ZW50LlxuICogQHBhcmFtIHshZ29vZy5uZXQuRXZlbnRUeXBlfSBldmVudFR5cGUgVGhlIHR5cGUgb2YgdGhlIGV2ZW50LlxuICogQHJldHVybiB7IVByb2dyZXNzRXZlbnR9IFRoZSBwcm9ncmVzcyBldmVudC5cbiAqIEBwcml2YXRlXG4gKi9cbmdvb2cubmV0LlhocklvLmJ1aWxkUHJvZ3Jlc3NFdmVudF8gPSBmdW5jdGlvbihlLCBldmVudFR5cGUpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gLyoqIEB0eXBlIHshUHJvZ3Jlc3NFdmVudH0gKi8gKHtcbiAgICB0eXBlOiBldmVudFR5cGUsXG4gICAgbGVuZ3RoQ29tcHV0YWJsZTogZS5sZW5ndGhDb21wdXRhYmxlLFxuICAgIGxvYWRlZDogZS5sb2FkZWQsXG4gICAgdG90YWw6IGUudG90YWwsXG4gIH0pO1xufTtcblxuXG4vKipcbiAqIFJlbW92ZSB0aGUgbGlzdGVuZXIgdG8gcHJvdGVjdCBhZ2FpbnN0IGxlYWtzLCBhbmQgbnVsbGlmeSB0aGUgWE1MSHR0cFJlcXVlc3RcbiAqIG9iamVjdC5cbiAqIEBwYXJhbSB7Ym9vbGVhbj19IG9wdF9mcm9tRGlzcG9zZSBJZiB0aGlzIGlzIGZyb20gdGhlIGRpc3Bvc2UgKGRvbid0IHdhbnQgdG9cbiAqICAgICBmaXJlIGFueSBldmVudHMpLlxuICogQHByaXZhdGVcbiAqL1xuZ29vZy5uZXQuWGhySW8ucHJvdG90eXBlLmNsZWFuVXBYaHJfID0gZnVuY3Rpb24ob3B0X2Zyb21EaXNwb3NlKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgaWYgKHRoaXMueGhyXykge1xuICAgIC8vIENhbmNlbCBhbnkgcGVuZGluZyB0aW1lb3V0IGV2ZW50IGhhbmRsZXIuXG4gICAgdGhpcy5jbGVhblVwVGltZW91dFRpbWVyXygpO1xuXG4gICAgLy8gU2F2ZSByZWZlcmVuY2Ugc28gd2UgY2FuIG1hcmsgaXQgYXMgY2xvc2VkIGFmdGVyIHRoZSBSRUFEWSBldmVudC4gIFRoZVxuICAgIC8vIFJFQURZIGV2ZW50IG1heSB0cmlnZ2VyIGFub3RoZXIgcmVxdWVzdCwgdGh1cyB3ZSBtdXN0IG51bGxpZnkgdGhpcy54aHJfXG4gICAgY29uc3QgeGhyID0gdGhpcy54aHJfO1xuICAgIGNvbnN0IGNsZWFyZWRPblJlYWR5U3RhdGVDaGFuZ2UgPVxuICAgICAgICB0aGlzLnhock9wdGlvbnNfW2dvb2cubmV0LlhtbEh0dHAuT3B0aW9uVHlwZS5VU0VfTlVMTF9GVU5DVElPTl0gP1xuICAgICAgICBnb29nLm51bGxGdW5jdGlvbiA6XG4gICAgICAgIG51bGw7XG4gICAgdGhpcy54aHJfID0gbnVsbDtcbiAgICB0aGlzLnhock9wdGlvbnNfID0gbnVsbDtcblxuICAgIGlmICghb3B0X2Zyb21EaXNwb3NlKSB7XG4gICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoZ29vZy5uZXQuRXZlbnRUeXBlLlJFQURZKTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgLy8gTk9URSh1c2VyKTogTm90IG51bGxpZnlpbmcgaW4gRmlyZUZveCBjYW4gc3RpbGwgbGVhayBpZiB0aGUgY2FsbGJhY2tzXG4gICAgICAvLyBhcmUgZGVmaW5lZCBpbiB0aGUgc2FtZSBzY29wZSBhcyB0aGUgaW5zdGFuY2Ugb2YgWGhySW8uIEJ1dCwgSUUgZG9lc24ndFxuICAgICAgLy8gYWxsb3cgeW91IHRvIHNldCB0aGUgb25yZWFkeXN0YXRlY2hhbmdlIHRvIE5VTEwgc28gbnVsbEZ1bmN0aW9uIGlzXG4gICAgICAvLyB1c2VkLlxuICAgICAgeGhyLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGNsZWFyZWRPblJlYWR5U3RhdGVDaGFuZ2U7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgLy8gVGhpcyBzZWVtcyB0byBvY2N1ciB3aXRoIGEgR2VhcnMgSFRUUCByZXF1ZXN0LiBEZWxheWVkIHRoZSBzZXR0aW5nIG9mXG4gICAgICAvLyB0aGlzIG9ucmVhZHlzdGF0ZWNoYW5nZSB1bnRpbCBhZnRlciBSRUFEWSBpcyBzZW50IG91dCBhbmQgY2F0Y2hpbmcgdGhlXG4gICAgICAvLyBlcnJvciB0byBzZWUgaWYgd2UgY2FuIHRyYWNrIGRvd24gdGhlIHByb2JsZW0uXG4gICAgICBnb29nLmxvZy5lcnJvcihcbiAgICAgICAgICB0aGlzLmxvZ2dlcl8sXG4gICAgICAgICAgJ1Byb2JsZW0gZW5jb3VudGVyZWQgcmVzZXR0aW5nIG9ucmVhZHlzdGF0ZWNoYW5nZTogJyArIGUubWVzc2FnZSk7XG4gICAgfVxuICB9XG59O1xuXG5cbi8qKlxuICogTWFrZSBzdXJlIHRoZSB0aW1lb3V0IHRpbWVyIGlzbid0IHJ1bm5pbmcuXG4gKiBAcHJpdmF0ZVxuICovXG5nb29nLm5ldC5YaHJJby5wcm90b3R5cGUuY2xlYW5VcFRpbWVvdXRUaW1lcl8gPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBpZiAodGhpcy54aHJfICYmIHRoaXMudXNlWGhyMlRpbWVvdXRfKSB7XG4gICAgdGhpcy54aHJfW2dvb2cubmV0LlhocklvLlhIUjJfT05fVElNRU9VVF9dID0gbnVsbDtcbiAgfVxuICBpZiAodGhpcy50aW1lb3V0SWRfKSB7XG4gICAgZ29vZy5UaW1lci5jbGVhcih0aGlzLnRpbWVvdXRJZF8pO1xuICAgIHRoaXMudGltZW91dElkXyA9IG51bGw7XG4gIH1cbn07XG5cblxuLyoqXG4gKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoZXJlIGlzIGFuIGFjdGl2ZSByZXF1ZXN0LlxuICovXG5nb29nLm5ldC5YaHJJby5wcm90b3R5cGUuaXNBY3RpdmUgPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gISF0aGlzLnhocl87XG59O1xuXG5cbi8qKlxuICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGUgcmVxdWVzdCBoYXMgY29tcGxldGVkLlxuICovXG5nb29nLm5ldC5YaHJJby5wcm90b3R5cGUuaXNDb21wbGV0ZSA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIHJldHVybiB0aGlzLmdldFJlYWR5U3RhdGUoKSA9PSBnb29nLm5ldC5YbWxIdHRwLlJlYWR5U3RhdGUuQ09NUExFVEU7XG59O1xuXG5cbi8qKlxuICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGUgcmVxdWVzdCBjb21wbGV0ZWQgd2l0aCBhIHN1Y2Nlc3MuXG4gKi9cbmdvb2cubmV0LlhocklvLnByb3RvdHlwZS5pc1N1Y2Nlc3MgPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBjb25zdCBzdGF0dXMgPSB0aGlzLmdldFN0YXR1cygpO1xuICAvLyBBIHplcm8gc3RhdHVzIGNvZGUgaXMgY29uc2lkZXJlZCBzdWNjZXNzZnVsIGZvciBsb2NhbCBmaWxlcy5cbiAgcmV0dXJuIGdvb2cubmV0Lkh0dHBTdGF0dXMuaXNTdWNjZXNzKHN0YXR1cykgfHxcbiAgICAgIHN0YXR1cyA9PT0gMCAmJiAhdGhpcy5pc0xhc3RVcmlFZmZlY3RpdmVTY2hlbWVIdHRwXygpO1xufTtcblxuXG4vKipcbiAqIEByZXR1cm4ge2Jvb2xlYW59IHdoZXRoZXIgdGhlIGVmZmVjdGl2ZSBzY2hlbWUgb2YgdGhlIGxhc3QgVVJJIHRoYXQgd2FzXG4gKiAgICAgZmV0Y2hlZCB3YXMgJ2h0dHAnIG9yICdodHRwcycuXG4gKiBAcHJpdmF0ZVxuICovXG5nb29nLm5ldC5YaHJJby5wcm90b3R5cGUuaXNMYXN0VXJpRWZmZWN0aXZlU2NoZW1lSHR0cF8gPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBjb25zdCBzY2hlbWUgPSBnb29nLnVyaS51dGlscy5nZXRFZmZlY3RpdmVTY2hlbWUoU3RyaW5nKHRoaXMubGFzdFVyaV8pKTtcbiAgcmV0dXJuIEhUVFBfU0NIRU1FX1BBVFRFUk4udGVzdChzY2hlbWUpO1xufTtcblxuXG4vKipcbiAqIEdldCB0aGUgcmVhZHlzdGF0ZSBmcm9tIHRoZSBYaHIgb2JqZWN0XG4gKiBXaWxsIG9ubHkgcmV0dXJuIGNvcnJlY3QgcmVzdWx0IHdoZW4gY2FsbGVkIGZyb20gdGhlIGNvbnRleHQgb2YgYSBjYWxsYmFja1xuICogQHJldHVybiB7Z29vZy5uZXQuWG1sSHR0cC5SZWFkeVN0YXRlfSBnb29nLm5ldC5YbWxIdHRwLlJlYWR5U3RhdGUuKi5cbiAqL1xuZ29vZy5uZXQuWGhySW8ucHJvdG90eXBlLmdldFJlYWR5U3RhdGUgPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gdGhpcy54aHJfID9cbiAgICAgIC8qKiBAdHlwZSB7Z29vZy5uZXQuWG1sSHR0cC5SZWFkeVN0YXRlfSAqLyAodGhpcy54aHJfLnJlYWR5U3RhdGUpIDpcbiAgICAgIGdvb2cubmV0LlhtbEh0dHAuUmVhZHlTdGF0ZS5VTklOSVRJQUxJWkVEO1xufTtcblxuXG4vKipcbiAqIEdldCB0aGUgc3RhdHVzIGZyb20gdGhlIFhociBvYmplY3RcbiAqIFdpbGwgb25seSByZXR1cm4gY29ycmVjdCByZXN1bHQgd2hlbiBjYWxsZWQgZnJvbSB0aGUgY29udGV4dCBvZiBhIGNhbGxiYWNrXG4gKiBAcmV0dXJuIHtudW1iZXJ9IEh0dHAgc3RhdHVzLlxuICovXG5nb29nLm5ldC5YaHJJby5wcm90b3R5cGUuZ2V0U3RhdHVzID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgLyoqXG4gICAqIElFIGRvZXNuJ3QgbGlrZSB5b3UgY2hlY2tpbmcgc3RhdHVzIHVudGlsIHRoZSByZWFkeXN0YXRlIGlzIGdyZWF0ZXIgdGhhbiAyXG4gICAqIChpLmUuIGl0IGlzIHJlY2VpdmluZyBvciBjb21wbGV0ZSkuICBUaGUgdHJ5L2NhdGNoIGlzIHVzZWQgZm9yIHdoZW4gdGhlXG4gICAqIHBhZ2UgaXMgdW5sb2FkaW5nIGFuZCBhbiBFUlJPUl9OT1RfQVZBSUxBQkxFIG1heSBvY2N1ciB3aGVuIGFjY2Vzc2luZyB4aHJfLlxuICAgKi9cbiAgdHJ5IHtcbiAgICByZXR1cm4gdGhpcy5nZXRSZWFkeVN0YXRlKCkgPiBnb29nLm5ldC5YbWxIdHRwLlJlYWR5U3RhdGUuTE9BREVEID9cbiAgICAgICAgdGhpcy54aHJfLnN0YXR1cyA6XG4gICAgICAgIC0xO1xuICB9IGNhdGNoIChlKSB7XG4gICAgcmV0dXJuIC0xO1xuICB9XG59O1xuXG5cbi8qKlxuICogR2V0IHRoZSBzdGF0dXMgdGV4dCBmcm9tIHRoZSBYaHIgb2JqZWN0XG4gKiBXaWxsIG9ubHkgcmV0dXJuIGNvcnJlY3QgcmVzdWx0IHdoZW4gY2FsbGVkIGZyb20gdGhlIGNvbnRleHQgb2YgYSBjYWxsYmFja1xuICogQHJldHVybiB7c3RyaW5nfSBTdGF0dXMgdGV4dC5cbiAqL1xuZ29vZy5uZXQuWGhySW8ucHJvdG90eXBlLmdldFN0YXR1c1RleHQgPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICAvKipcbiAgICogSUUgZG9lc24ndCBsaWtlIHlvdSBjaGVja2luZyBzdGF0dXMgdW50aWwgdGhlIHJlYWR5c3RhdGUgaXMgZ3JlYXRlciB0aGFuIDJcbiAgICogKGkuZS4gaXQgaXMgcmVjZWl2aW5nIG9yIGNvbXBsZXRlKS4gIFRoZSB0cnkvY2F0Y2ggaXMgdXNlZCBmb3Igd2hlbiB0aGVcbiAgICogcGFnZSBpcyB1bmxvYWRpbmcgYW5kIGFuIEVSUk9SX05PVF9BVkFJTEFCTEUgbWF5IG9jY3VyIHdoZW4gYWNjZXNzaW5nIHhocl8uXG4gICAqL1xuICB0cnkge1xuICAgIHJldHVybiB0aGlzLmdldFJlYWR5U3RhdGUoKSA+IGdvb2cubmV0LlhtbEh0dHAuUmVhZHlTdGF0ZS5MT0FERUQgP1xuICAgICAgICB0aGlzLnhocl8uc3RhdHVzVGV4dCA6XG4gICAgICAgICcnO1xuICB9IGNhdGNoIChlKSB7XG4gICAgZ29vZy5sb2cuZmluZSh0aGlzLmxvZ2dlcl8sICdDYW4gbm90IGdldCBzdGF0dXM6ICcgKyBlLm1lc3NhZ2UpO1xuICAgIHJldHVybiAnJztcbiAgfVxufTtcblxuXG4vKipcbiAqIEdldCB0aGUgbGFzdCBVcmkgdGhhdCB3YXMgcmVxdWVzdGVkXG4gKiBAcmV0dXJuIHtzdHJpbmd9IExhc3QgVXJpLlxuICovXG5nb29nLm5ldC5YaHJJby5wcm90b3R5cGUuZ2V0TGFzdFVyaSA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIHJldHVybiBTdHJpbmcodGhpcy5sYXN0VXJpXyk7XG59O1xuXG5cbi8qKlxuICogR2V0IHRoZSByZXNwb25zZSB0ZXh0IGZyb20gdGhlIFhociBvYmplY3RcbiAqIFdpbGwgb25seSByZXR1cm4gY29ycmVjdCByZXN1bHQgd2hlbiBjYWxsZWQgZnJvbSB0aGUgY29udGV4dCBvZiBhIGNhbGxiYWNrLlxuICogQHJldHVybiB7c3RyaW5nfSBSZXN1bHQgZnJvbSB0aGUgc2VydmVyLCBvciAnJyBpZiBubyByZXN1bHQgYXZhaWxhYmxlLlxuICovXG5nb29nLm5ldC5YaHJJby5wcm90b3R5cGUuZ2V0UmVzcG9uc2VUZXh0ID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgdHJ5IHtcbiAgICByZXR1cm4gdGhpcy54aHJfID8gdGhpcy54aHJfLnJlc3BvbnNlVGV4dCA6ICcnO1xuICB9IGNhdGNoIChlKSB7XG4gICAgLy8gaHR0cDovL3d3dy53My5vcmcvVFIvWE1MSHR0cFJlcXVlc3QvI3RoZS1yZXNwb25zZXRleHQtYXR0cmlidXRlXG4gICAgLy8gc3RhdGVzIHRoYXQgcmVzcG9uc2VUZXh0IHNob3VsZCByZXR1cm4gJycgKGFuZCByZXNwb25zZVhNTCBudWxsKVxuICAgIC8vIHdoZW4gdGhlIHN0YXRlIGlzIG5vdCBMT0FESU5HIG9yIERPTkUuIEluc3RlYWQsIElFIGNhblxuICAgIC8vIHRocm93IHVuZXhwZWN0ZWQgZXhjZXB0aW9ucywgZm9yIGV4YW1wbGUgd2hlbiBhIHJlcXVlc3QgaXMgYWJvcnRlZFxuICAgIC8vIG9yIG5vIGRhdGEgaXMgYXZhaWxhYmxlIHlldC5cbiAgICBnb29nLmxvZy5maW5lKHRoaXMubG9nZ2VyXywgJ0NhbiBub3QgZ2V0IHJlc3BvbnNlVGV4dDogJyArIGUubWVzc2FnZSk7XG4gICAgcmV0dXJuICcnO1xuICB9XG59O1xuXG5cbi8qKlxuICogR2V0IHRoZSByZXNwb25zZSBib2R5IGZyb20gdGhlIFhociBvYmplY3QuIFRoaXMgcHJvcGVydHkgaXMgb25seSBhdmFpbGFibGVcbiAqIGluIElFIHNpbmNlIHZlcnNpb24gNyBhY2NvcmRpbmcgdG8gTVNETjpcbiAqIGh0dHA6Ly9tc2RuLm1pY3Jvc29mdC5jb20vZW4tdXMvbGlicmFyeS9pZS9tczUzNDM2OCh2PXZzLjg1KS5hc3B4XG4gKiBXaWxsIG9ubHkgcmV0dXJuIGNvcnJlY3QgcmVzdWx0IHdoZW4gY2FsbGVkIGZyb20gdGhlIGNvbnRleHQgb2YgYSBjYWxsYmFjay5cbiAqXG4gKiBPbmUgb3B0aW9uIGlzIHRvIGNvbnN0cnVjdCBhIFZCQXJyYXkgZnJvbSB0aGUgcmV0dXJuZWQgb2JqZWN0IGFuZCBjb252ZXJ0XG4gKiBpdCB0byBhIEphdmFTY3JpcHQgYXJyYXkgdXNpbmcgdGhlIHRvQXJyYXkgbWV0aG9kOlxuICogYChuZXcgd2luZG93WydWQkFycmF5J10oeGhySW8uZ2V0UmVzcG9uc2VCb2R5KCkpKS50b0FycmF5KClgXG4gKiBUaGlzIHdpbGwgcmVzdWx0IGluIGFuIGFycmF5IG9mIG51bWJlcnMgaW4gdGhlIHJhbmdlIG9mIFswLi4yNTVdXG4gKlxuICogQW5vdGhlciBvcHRpb24gaXMgdG8gdXNlIHRoZSBWQlNjcmlwdCBDU3RyIG1ldGhvZCB0byBjb252ZXJ0IGl0IGludG8gYVxuICogc3RyaW5nIGFzIG91dGxpbmVkIGluIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMTkxOTk3MlxuICpcbiAqIEByZXR1cm4ge09iamVjdH0gQmluYXJ5IHJlc3VsdCBmcm9tIHRoZSBzZXJ2ZXIgb3IgbnVsbCBpZiBub3QgYXZhaWxhYmxlLlxuICovXG5nb29nLm5ldC5YaHJJby5wcm90b3R5cGUuZ2V0UmVzcG9uc2VCb2R5ID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgdHJ5IHtcbiAgICBpZiAodGhpcy54aHJfICYmICdyZXNwb25zZUJvZHknIGluIHRoaXMueGhyXykge1xuICAgICAgcmV0dXJuIHRoaXMueGhyX1sncmVzcG9uc2VCb2R5J107XG4gICAgfVxuICB9IGNhdGNoIChlKSB7XG4gICAgLy8gSUUgY2FuIHRocm93IHVuZXhwZWN0ZWQgZXhjZXB0aW9ucywgZm9yIGV4YW1wbGUgd2hlbiBhIHJlcXVlc3QgaXMgYWJvcnRlZFxuICAgIC8vIG9yIG5vIGRhdGEgaXMgeWV0IGF2YWlsYWJsZS5cbiAgICBnb29nLmxvZy5maW5lKHRoaXMubG9nZ2VyXywgJ0NhbiBub3QgZ2V0IHJlc3BvbnNlQm9keTogJyArIGUubWVzc2FnZSk7XG4gIH1cbiAgcmV0dXJuIG51bGw7XG59O1xuXG5cbi8qKlxuICogR2V0IHRoZSByZXNwb25zZSBYTUwgZnJvbSB0aGUgWGhyIG9iamVjdFxuICogV2lsbCBvbmx5IHJldHVybiBjb3JyZWN0IHJlc3VsdCB3aGVuIGNhbGxlZCBmcm9tIHRoZSBjb250ZXh0IG9mIGEgY2FsbGJhY2suXG4gKiBAcmV0dXJuIHtEb2N1bWVudH0gVGhlIERPTSBEb2N1bWVudCByZXByZXNlbnRpbmcgdGhlIFhNTCBmaWxlLCBvciBudWxsXG4gKiBpZiBubyByZXN1bHQgYXZhaWxhYmxlLlxuICovXG5nb29nLm5ldC5YaHJJby5wcm90b3R5cGUuZ2V0UmVzcG9uc2VYbWwgPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICB0cnkge1xuICAgIHJldHVybiB0aGlzLnhocl8gPyB0aGlzLnhocl8ucmVzcG9uc2VYTUwgOiBudWxsO1xuICB9IGNhdGNoIChlKSB7XG4gICAgZ29vZy5sb2cuZmluZSh0aGlzLmxvZ2dlcl8sICdDYW4gbm90IGdldCByZXNwb25zZVhNTDogJyArIGUubWVzc2FnZSk7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbn07XG5cblxuLyoqXG4gKiBHZXQgdGhlIHJlc3BvbnNlIGFuZCBldmFsdWF0ZXMgaXQgYXMgSlNPTiBmcm9tIHRoZSBYaHIgb2JqZWN0XG4gKiBXaWxsIG9ubHkgcmV0dXJuIGNvcnJlY3QgcmVzdWx0IHdoZW4gY2FsbGVkIGZyb20gdGhlIGNvbnRleHQgb2YgYSBjYWxsYmFja1xuICogQHBhcmFtIHtzdHJpbmc9fSBvcHRfeHNzaVByZWZpeCBPcHRpb25hbCBYU1NJIHByZWZpeCBzdHJpbmcgdG8gdXNlIGZvclxuICogICAgIHN0cmlwcGluZyBvZiB0aGUgcmVzcG9uc2UgYmVmb3JlIHBhcnNpbmcuIFRoaXMgbmVlZHMgdG8gYmUgc2V0IG9ubHkgaWZcbiAqICAgICB5b3VyIGJhY2tlbmQgc2VydmVyIHByZXBlbmRzIHRoZSBzYW1lIHByZWZpeCBzdHJpbmcgdG8gdGhlIEpTT04gcmVzcG9uc2UuXG4gKiBAdGhyb3dzIEVycm9yIGlmIHRoZSByZXNwb25zZSB0ZXh0IGlzIGludmFsaWQgSlNPTi5cbiAqIEByZXR1cm4ge09iamVjdHx1bmRlZmluZWR9IEphdmFTY3JpcHQgb2JqZWN0LlxuICovXG5nb29nLm5ldC5YaHJJby5wcm90b3R5cGUuZ2V0UmVzcG9uc2VKc29uID0gZnVuY3Rpb24ob3B0X3hzc2lQcmVmaXgpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBpZiAoIXRoaXMueGhyXykge1xuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cblxuICBsZXQgcmVzcG9uc2VUZXh0ID0gdGhpcy54aHJfLnJlc3BvbnNlVGV4dDtcbiAgaWYgKG9wdF94c3NpUHJlZml4ICYmIHJlc3BvbnNlVGV4dC5pbmRleE9mKG9wdF94c3NpUHJlZml4KSA9PSAwKSB7XG4gICAgcmVzcG9uc2VUZXh0ID0gcmVzcG9uc2VUZXh0LnN1YnN0cmluZyhvcHRfeHNzaVByZWZpeC5sZW5ndGgpO1xuICB9XG5cbiAgcmV0dXJuIGdvb2cuanNvbi5oeWJyaWQucGFyc2UocmVzcG9uc2VUZXh0KTtcbn07XG5cblxuLyoqXG4gKiBHZXQgdGhlIHJlc3BvbnNlIGFzIHRoZSB0eXBlIHNwZWNpZmljZWQgYnkge0BsaW5rICNzZXRSZXNwb25zZVR5cGV9LiBBdCB0aW1lXG4gKiBvZiB3cml0aW5nLCB0aGlzIGlzIG9ubHkgZGlyZWN0bHkgc3VwcG9ydGVkIGluIHZlcnkgcmVjZW50IHZlcnNpb25zIG9mIFdlYktpdFxuICogKDEwLjAuNjEyLjEgZGV2IGFuZCBsYXRlcikuIElmIHRoZSBmaWVsZCBpcyBub3Qgc3VwcG9ydGVkIGRpcmVjdGx5LCB3ZSB3aWxsXG4gKiB0cnkgdG8gZW11bGF0ZSBpdC5cbiAqXG4gKiBFbXVsYXRpbmcgdGhlIHJlc3BvbnNlIG1lYW5zIGZvbGxvd2luZyB0aGUgcnVsZXMgbGFpZCBvdXQgYXRcbiAqIGh0dHA6Ly93d3cudzMub3JnL1RSL1hNTEh0dHBSZXF1ZXN0LyN0aGUtcmVzcG9uc2UtYXR0cmlidXRlXG4gKlxuICogT24gYnJvd3NlcnMgd2l0aCBubyBzdXBwb3J0IGZvciB0aGlzIChDaHJvbWUgPCAxMCwgRmlyZWZveCA8IDQsIGV0YyksIG9ubHlcbiAqIHJlc3BvbnNlIHR5cGVzIG9mIERFRkFVTFQgb3IgVEVYVCBtYXkgYmUgdXNlZCwgYW5kIHRoZSByZXNwb25zZSByZXR1cm5lZCB3aWxsXG4gKiBiZSB0aGUgdGV4dCByZXNwb25zZS5cbiAqXG4gKiBPbiBicm93c2VycyB3aXRoIE1vemlsbGEncyBkcmFmdCBzdXBwb3J0IGZvciBhcnJheSBidWZmZXJzIChGaXJlZm94IDQsIDUpLFxuICogb25seSByZXNwb25zZSB0eXBlcyBvZiBERUZBVUxULCBURVhULCBhbmQgQVJSQVlfQlVGRkVSIG1heSBiZSB1c2VkLCBhbmQgdGhlXG4gKiByZXNwb25zZSByZXR1cm5lZCB3aWxsIGJlIGVpdGhlciB0aGUgdGV4dCByZXNwb25zZSBvciB0aGUgTW96aWxsYVxuICogaW1wbGVtZW50YXRpb24gb2YgdGhlIGFycmF5IGJ1ZmZlciByZXNwb25zZS5cbiAqXG4gKiBPbiBicm93c2VycyB3aWxsIGZ1bGwgc3VwcG9ydCwgYW55IHZhbGlkIHJlc3BvbnNlIHR5cGUgc3VwcG9ydGVkIGJ5IHRoZVxuICogYnJvd3NlciBtYXkgYmUgdXNlZCwgYW5kIHRoZSByZXNwb25zZSBwcm92aWRlZCBieSB0aGUgYnJvd3NlciB3aWxsIGJlXG4gKiByZXR1cm5lZC5cbiAqXG4gKiBAcmV0dXJuIHsqfSBUaGUgcmVzcG9uc2UuXG4gKi9cbmdvb2cubmV0LlhocklvLnByb3RvdHlwZS5nZXRSZXNwb25zZSA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIHRyeSB7XG4gICAgaWYgKCF0aGlzLnhocl8pIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBpZiAoJ3Jlc3BvbnNlJyBpbiB0aGlzLnhocl8pIHtcbiAgICAgIHJldHVybiB0aGlzLnhocl8ucmVzcG9uc2U7XG4gICAgfVxuICAgIHN3aXRjaCAodGhpcy5yZXNwb25zZVR5cGVfKSB7XG4gICAgICBjYXNlIFJlc3BvbnNlVHlwZS5ERUZBVUxUOlxuICAgICAgY2FzZSBSZXNwb25zZVR5cGUuVEVYVDpcbiAgICAgICAgcmV0dXJuIHRoaXMueGhyXy5yZXNwb25zZVRleHQ7XG4gICAgICAvLyBET0NVTUVOVCBhbmQgQkxPQiBkb24ndCBuZWVkIHRvIGJlIGhhbmRsZWQgaGVyZSBiZWNhdXNlIHRoZXkgYXJlXG4gICAgICAvLyBpbnRyb2R1Y2VkIGluIHRoZSBzYW1lIHNwZWMgdGhhdCBhZGRzIHRoZSAucmVzcG9uc2UgZmllbGQsIGFuZCB3b3VsZFxuICAgICAgLy8gaGF2ZSBiZWVuIGNhdWdodCBhYm92ZS5cbiAgICAgIC8vIEFSUkFZX0JVRkZFUiBuZWVkcyBhbiBpbXBsZW1lbnRhdGlvbiBmb3IgRmlyZWZveCA0LCB3aGVyZSBpdCB3YXNcbiAgICAgIC8vIGltcGxlbWVudGVkIHVzaW5nIGEgZHJhZnQgc3BlYyByYXRoZXIgdGhhbiB0aGUgZmluYWwgc3BlYy5cbiAgICAgIGNhc2UgUmVzcG9uc2VUeXBlLkFSUkFZX0JVRkZFUjpcbiAgICAgICAgaWYgKCdtb3pSZXNwb25zZUFycmF5QnVmZmVyJyBpbiB0aGlzLnhocl8pIHtcbiAgICAgICAgICByZXR1cm4gdGhpcy54aHJfLm1velJlc3BvbnNlQXJyYXlCdWZmZXI7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy8gRmVsbCB0aHJvdWdoIHRvIGEgcmVzcG9uc2UgdHlwZSB0aGF0IGlzIG5vdCBzdXBwb3J0ZWQgb24gdGhpcyBicm93c2VyLlxuICAgIGdvb2cubG9nLmVycm9yKFxuICAgICAgICB0aGlzLmxvZ2dlcl8sICdSZXNwb25zZSB0eXBlICcgKyB0aGlzLnJlc3BvbnNlVHlwZV8gKyAnIGlzIG5vdCAnICtcbiAgICAgICAgICAgICdzdXBwb3J0ZWQgb24gdGhpcyBicm93c2VyJyk7XG4gICAgcmV0dXJuIG51bGw7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBnb29nLmxvZy5maW5lKHRoaXMubG9nZ2VyXywgJ0NhbiBub3QgZ2V0IHJlc3BvbnNlOiAnICsgZS5tZXNzYWdlKTtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxufTtcblxuXG4vKipcbiAqIEdldCB0aGUgdmFsdWUgb2YgdGhlIHJlc3BvbnNlLWhlYWRlciB3aXRoIHRoZSBnaXZlbiBuYW1lIGZyb20gdGhlIFhociBvYmplY3RcbiAqIFdpbGwgb25seSByZXR1cm4gY29ycmVjdCByZXN1bHQgd2hlbiBjYWxsZWQgZnJvbSB0aGUgY29udGV4dCBvZiBhIGNhbGxiYWNrXG4gKiBhbmQgdGhlIHJlcXVlc3QgaGFzIGNvbXBsZXRlZFxuICogQHBhcmFtIHtzdHJpbmd9IGtleSBUaGUgbmFtZSBvZiB0aGUgcmVzcG9uc2UtaGVhZGVyIHRvIHJldHJpZXZlLlxuICogQHJldHVybiB7c3RyaW5nfHVuZGVmaW5lZH0gVGhlIHZhbHVlIG9mIHRoZSByZXNwb25zZS1oZWFkZXIgbmFtZWQga2V5LlxuICovXG5nb29nLm5ldC5YaHJJby5wcm90b3R5cGUuZ2V0UmVzcG9uc2VIZWFkZXIgPSBmdW5jdGlvbihrZXkpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBpZiAoIXRoaXMueGhyXyB8fCAhdGhpcy5pc0NvbXBsZXRlKCkpIHtcbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9XG5cbiAgY29uc3QgdmFsdWUgPSB0aGlzLnhocl8uZ2V0UmVzcG9uc2VIZWFkZXIoa2V5KTtcbiAgcmV0dXJuIHZhbHVlID09PSBudWxsID8gdW5kZWZpbmVkIDogdmFsdWU7XG59O1xuXG5cbi8qKlxuICogR2V0cyB0aGUgdGV4dCBvZiBhbGwgdGhlIGhlYWRlcnMgaW4gdGhlIHJlc3BvbnNlLlxuICogV2lsbCBvbmx5IHJldHVybiBjb3JyZWN0IHJlc3VsdCB3aGVuIGNhbGxlZCBmcm9tIHRoZSBjb250ZXh0IG9mIGEgY2FsbGJhY2tcbiAqIGFuZCB0aGUgcmVxdWVzdCBoYXMgY29tcGxldGVkLlxuICogQHJldHVybiB7c3RyaW5nfSBUaGUgdmFsdWUgb2YgdGhlIHJlc3BvbnNlIGhlYWRlcnMgb3IgZW1wdHkgc3RyaW5nLlxuICovXG5nb29nLm5ldC5YaHJJby5wcm90b3R5cGUuZ2V0QWxsUmVzcG9uc2VIZWFkZXJzID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgLy8gZ2V0QWxsUmVzcG9uc2VIZWFkZXJzIGNhbiByZXR1cm4gbnVsbCBpZiBubyByZXNwb25zZSBoYXMgYmVlbiByZWNlaXZlZCxcbiAgLy8gZW5zdXJlIHdlIGFsd2F5cyByZXR1cm4gYW4gZW1wdHkgc3RyaW5nLlxuICByZXR1cm4gdGhpcy54aHJfICYmIHRoaXMuaXNDb21wbGV0ZSgpID9cbiAgICAgICh0aGlzLnhocl8uZ2V0QWxsUmVzcG9uc2VIZWFkZXJzKCkgfHwgJycpIDpcbiAgICAgICcnO1xufTtcblxuXG4vKipcbiAqIFJldHVybnMgYWxsIHJlc3BvbnNlIGhlYWRlcnMgYXMgYSBrZXktdmFsdWUgbWFwLlxuICogTXVsdGlwbGUgdmFsdWVzIGZvciB0aGUgc2FtZSBoZWFkZXIga2V5IGNhbiBiZSBjb21iaW5lZCBpbnRvIG9uZSxcbiAqIHNlcGFyYXRlZCBieSBhIGNvbW1hIGFuZCBhIHNwYWNlLlxuICogTm90ZSB0aGF0IHRoZSBuYXRpdmUgZ2V0UmVzcG9uc2VIZWFkZXIgbWV0aG9kIGZvciByZXRyaWV2aW5nIGEgc2luZ2xlIGhlYWRlclxuICogZG9lcyBhIGNhc2UgaW5zZW5zaXRpdmUgbWF0Y2ggb24gdGhlIGhlYWRlciBuYW1lLiBUaGlzIG1ldGhvZCBkb2VzIG5vdFxuICogaW5jbHVkZSBhbnkgY2FzZSBub3JtYWxpemF0aW9uIGxvZ2ljLCBpdCB3aWxsIGp1c3QgcmV0dXJuIGEga2V5LXZhbHVlXG4gKiByZXByZXNlbnRhdGlvbiBvZiB0aGUgaGVhZGVycy5cbiAqIFNlZTogaHR0cDovL3d3dy53My5vcmcvVFIvWE1MSHR0cFJlcXVlc3QvI3RoZS1nZXRyZXNwb25zZWhlYWRlcigpLW1ldGhvZFxuICogQHJldHVybiB7IU9iamVjdDxzdHJpbmcsIHN0cmluZz59IEFuIG9iamVjdCB3aXRoIHRoZSBoZWFkZXIga2V5cyBhcyBrZXlzXG4gKiAgICAgYW5kIGhlYWRlciB2YWx1ZXMgYXMgdmFsdWVzLlxuICovXG5nb29nLm5ldC5YaHJJby5wcm90b3R5cGUuZ2V0UmVzcG9uc2VIZWFkZXJzID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgLy8gVE9ETyh1c2VyKTogTWFrZSB0aGlzIGZ1bmN0aW9uIHBhcnNlIGhlYWRlcnMgYXMgcGVyIHRoZSBzcGVjXG4gIC8vIChodHRwczovL3Rvb2xzLmlldGYub3JnL2h0bWwvcmZjMjYxNiNzZWN0aW9uLTQuMikuXG5cbiAgY29uc3QgaGVhZGVyc09iamVjdCA9IHt9O1xuICBjb25zdCBoZWFkZXJzQXJyYXkgPSB0aGlzLmdldEFsbFJlc3BvbnNlSGVhZGVycygpLnNwbGl0KCdcXHJcXG4nKTtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBoZWFkZXJzQXJyYXkubGVuZ3RoOyBpKyspIHtcbiAgICBpZiAoZ29vZy5zdHJpbmcuaXNFbXB0eU9yV2hpdGVzcGFjZShoZWFkZXJzQXJyYXlbaV0pKSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG4gICAgY29uc3Qga2V5VmFsdWUgPVxuICAgICAgICBnb29nLnN0cmluZy5zcGxpdExpbWl0KGhlYWRlcnNBcnJheVtpXSwgJzonLCAvKiBtYXhTcGxpdENvdW50PSAqLyAxKTtcbiAgICBjb25zdCBrZXkgPSBrZXlWYWx1ZVswXTtcbiAgICBsZXQgdmFsdWUgPSBrZXlWYWx1ZVsxXTtcblxuICAgIGlmICh0eXBlb2YgdmFsdWUgIT09ICdzdHJpbmcnKSB7XG4gICAgICAvLyBUaGVyZSBtdXN0IGJlIGEgdmFsdWUgYnV0IGl0IGNhbiBiZSB0aGUgZW1wdHkgc3RyaW5nLlxuICAgICAgY29udGludWU7XG4gICAgfVxuXG4gICAgLy8gV2hpdGVzcGFjZSBhdCB0aGUgc3RhcnQgYW5kIGVuZCBvZiB0aGUgdmFsdWUgaXMgbWVhbmluZ2xlc3MuXG4gICAgdmFsdWUgPSB2YWx1ZS50cmltKCk7XG4gICAgLy8gVGhlIGtleSBzaG91bGQgbm90IGNvbnRhaW4gd2hpdGVzcGFjZSBidXQgd2UgY3VycmVudGx5IGlnbm9yZSB0aGF0LlxuXG4gICAgY29uc3QgdmFsdWVzID0gaGVhZGVyc09iamVjdFtrZXldIHx8IFtdO1xuICAgIGhlYWRlcnNPYmplY3Rba2V5XSA9IHZhbHVlcztcbiAgICB2YWx1ZXMucHVzaCh2YWx1ZSk7XG4gIH1cblxuICByZXR1cm4gZ29vZy5vYmplY3QubWFwKGhlYWRlcnNPYmplY3QsIGZ1bmN0aW9uKHZhbHVlcykge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICByZXR1cm4gdmFsdWVzLmpvaW4oJywgJyk7XG4gIH0pO1xufTtcblxuXG4vKipcbiAqIEdldCB0aGUgdmFsdWUgb2YgdGhlIHJlc3BvbnNlLWhlYWRlciB3aXRoIHRoZSBnaXZlbiBuYW1lIGZyb20gdGhlIFhociBvYmplY3QuXG4gKiBBcyBvcHBvc2VkIHRvIHtAbGluayAjZ2V0UmVzcG9uc2VIZWFkZXJ9LCB0aGlzIG1ldGhvZCBkb2VzIG5vdCByZXF1aXJlIHRoYXRcbiAqIHRoZSByZXF1ZXN0IGhhcyBjb21wbGV0ZWQuXG4gKiBAcGFyYW0ge3N0cmluZ30ga2V5IFRoZSBuYW1lIG9mIHRoZSByZXNwb25zZS1oZWFkZXIgdG8gcmV0cmlldmUuXG4gKiBAcmV0dXJuIHs/c3RyaW5nfSBUaGUgdmFsdWUgb2YgdGhlIHJlc3BvbnNlLWhlYWRlciwgb3IgbnVsbCBpZiBpdCBpc1xuICogICAgIHVuYXZhaWxhYmxlLlxuICovXG5nb29nLm5ldC5YaHJJby5wcm90b3R5cGUuZ2V0U3RyZWFtaW5nUmVzcG9uc2VIZWFkZXIgPSBmdW5jdGlvbihrZXkpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gdGhpcy54aHJfID8gdGhpcy54aHJfLmdldFJlc3BvbnNlSGVhZGVyKGtleSkgOiBudWxsO1xufTtcblxuXG4vKipcbiAqIEdldHMgdGhlIHRleHQgb2YgYWxsIHRoZSBoZWFkZXJzIGluIHRoZSByZXNwb25zZS4gQXMgb3Bwb3NlZCB0b1xuICoge0BsaW5rICNnZXRBbGxSZXNwb25zZUhlYWRlcnN9LCB0aGlzIG1ldGhvZCBkb2VzIG5vdCByZXF1aXJlIHRoYXQgdGhlIHJlcXVlc3RcbiAqIGhhcyBjb21wbGV0ZWQuXG4gKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSB2YWx1ZSBvZiB0aGUgcmVzcG9uc2UgaGVhZGVycyBvciBlbXB0eSBzdHJpbmcuXG4gKi9cbmdvb2cubmV0LlhocklvLnByb3RvdHlwZS5nZXRBbGxTdHJlYW1pbmdSZXNwb25zZUhlYWRlcnMgPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gdGhpcy54aHJfID8gdGhpcy54aHJfLmdldEFsbFJlc3BvbnNlSGVhZGVycygpIDogJyc7XG59O1xuXG5cbi8qKlxuICogR2V0IHRoZSBsYXN0IGVycm9yIG1lc3NhZ2VcbiAqIEByZXR1cm4geyFnb29nLm5ldC5FcnJvckNvZGV9IExhc3QgZXJyb3IgY29kZS5cbiAqL1xuZ29vZy5uZXQuWGhySW8ucHJvdG90eXBlLmdldExhc3RFcnJvckNvZGUgPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gdGhpcy5sYXN0RXJyb3JDb2RlXztcbn07XG5cblxuLyoqXG4gKiBHZXQgdGhlIGxhc3QgZXJyb3IgbWVzc2FnZVxuICogQHJldHVybiB7c3RyaW5nfSBMYXN0IGVycm9yIG1lc3NhZ2UuXG4gKi9cbmdvb2cubmV0LlhocklvLnByb3RvdHlwZS5nZXRMYXN0RXJyb3IgPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gdHlwZW9mIHRoaXMubGFzdEVycm9yXyA9PT0gJ3N0cmluZycgPyB0aGlzLmxhc3RFcnJvcl8gOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTdHJpbmcodGhpcy5sYXN0RXJyb3JfKTtcbn07XG5cblxuLyoqXG4gKiBBZGRzIHRoZSBsYXN0IG1ldGhvZCwgc3RhdHVzIGFuZCBVUkkgdG8gdGhlIG1lc3NhZ2UuICBUaGlzIGlzIHVzZWQgdG8gYWRkXG4gKiB0aGlzIGluZm9ybWF0aW9uIHRvIHRoZSBsb2dnaW5nIGNhbGxzLlxuICogQHBhcmFtIHtzdHJpbmd9IG1zZyBUaGUgbWVzc2FnZSB0ZXh0IHRoYXQgd2Ugd2FudCB0byBhZGQgdGhlIGV4dHJhIHRleHQgdG8uXG4gKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSBtZXNzYWdlIHdpdGggdGhlIGV4dHJhIHRleHQgYXBwZW5kZWQuXG4gKiBAcHJpdmF0ZVxuICovXG5nb29nLm5ldC5YaHJJby5wcm90b3R5cGUuZm9ybWF0TXNnXyA9IGZ1bmN0aW9uKG1zZykge1xuICAndXNlIHN0cmljdCc7XG4gIHJldHVybiBtc2cgKyAnIFsnICsgdGhpcy5sYXN0TWV0aG9kXyArICcgJyArIHRoaXMubGFzdFVyaV8gKyAnICcgK1xuICAgICAgdGhpcy5nZXRTdGF0dXMoKSArICddJztcbn07XG5cblxuLy8gUmVnaXN0ZXIgdGhlIHhociBoYW5kbGVyIGFzIGFuIGVudHJ5IHBvaW50LCBzbyB0aGF0XG4vLyBpdCBjYW4gYmUgbW9uaXRvcmVkIGZvciBleGNlcHRpb24gaGFuZGxpbmcsIGV0Yy5cbmdvb2cuZGVidWcuZW50cnlQb2ludFJlZ2lzdHJ5LnJlZ2lzdGVyKFxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7ZnVuY3Rpb24oIUZ1bmN0aW9uKTogIUZ1bmN0aW9ufSB0cmFuc2Zvcm1lciBUaGUgdHJhbnNmb3JtaW5nXG4gICAgICogICAgIGZ1bmN0aW9uLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uKHRyYW5zZm9ybWVyKSB7XG4gICAgICAndXNlIHN0cmljdCc7XG4gICAgICBnb29nLm5ldC5YaHJJby5wcm90b3R5cGUub25SZWFkeVN0YXRlQ2hhbmdlRW50cnlQb2ludF8gPVxuICAgICAgICAgIHRyYW5zZm9ybWVyKGdvb2cubmV0LlhocklvLnByb3RvdHlwZS5vblJlYWR5U3RhdGVDaGFuZ2VFbnRyeVBvaW50Xyk7XG4gICAgfSk7XG59KTsgIC8vIGdvb2cuc2NvcGVcbiIsICIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgVGhlIENsb3N1cmUgTGlicmFyeSBBdXRob3JzLlxuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIEBmaWxlb3ZlcnZpZXcgU3RyaW5nIGZ1bmN0aW9ucyBjYWxsZWQgZnJvbSBDbG9zdXJlIHBhY2thZ2VzIHRoYXQgY291bGRuJ3RcbiAqIGRlcGVuZCBvbiBlYWNoIG90aGVyLiBPdXRzaWRlIENsb3N1cmUsIHVzZSBnb29nLnN0cmluZyBmdW5jdGlvbiB3aGljaFxuICogZGVsZWdhdGUgdG8gdGhlc2UuXG4gKi9cblxuXG5nb29nLnByb3ZpZGUoJ2dvb2cuc3RyaW5nLmludGVybmFsJyk7XG5cblxuLyoqXG4gKiBGYXN0IHByZWZpeC1jaGVja2VyLlxuICogQHBhcmFtIHtzdHJpbmd9IHN0ciBUaGUgc3RyaW5nIHRvIGNoZWNrLlxuICogQHBhcmFtIHtzdHJpbmd9IHByZWZpeCBBIHN0cmluZyB0byBsb29rIGZvciBhdCB0aGUgc3RhcnQgb2YgYHN0cmAuXG4gKiBAcmV0dXJuIHtib29sZWFufSBUcnVlIGlmIGBzdHJgIGJlZ2lucyB3aXRoIGBwcmVmaXhgLlxuICogQHNlZSBnb29nLnN0cmluZy5zdGFydHNXaXRoXG4gKi9cbmdvb2cuc3RyaW5nLmludGVybmFsLnN0YXJ0c1dpdGggPSBmdW5jdGlvbihzdHIsIHByZWZpeCkge1xuICAndXNlIHN0cmljdCc7XG4gIHJldHVybiBzdHIubGFzdEluZGV4T2YocHJlZml4LCAwKSA9PSAwO1xufTtcblxuXG4vKipcbiAqIEZhc3Qgc3VmZml4LWNoZWNrZXIuXG4gKiBAcGFyYW0ge3N0cmluZ30gc3RyIFRoZSBzdHJpbmcgdG8gY2hlY2suXG4gKiBAcGFyYW0ge3N0cmluZ30gc3VmZml4IEEgc3RyaW5nIHRvIGxvb2sgZm9yIGF0IHRoZSBlbmQgb2YgYHN0cmAuXG4gKiBAcmV0dXJuIHtib29sZWFufSBUcnVlIGlmIGBzdHJgIGVuZHMgd2l0aCBgc3VmZml4YC5cbiAqIEBzZWUgZ29vZy5zdHJpbmcuZW5kc1dpdGhcbiAqL1xuZ29vZy5zdHJpbmcuaW50ZXJuYWwuZW5kc1dpdGggPSBmdW5jdGlvbihzdHIsIHN1ZmZpeCkge1xuICAndXNlIHN0cmljdCc7XG4gIGNvbnN0IGwgPSBzdHIubGVuZ3RoIC0gc3VmZml4Lmxlbmd0aDtcbiAgcmV0dXJuIGwgPj0gMCAmJiBzdHIuaW5kZXhPZihzdWZmaXgsIGwpID09IGw7XG59O1xuXG5cbi8qKlxuICogQ2FzZS1pbnNlbnNpdGl2ZSBwcmVmaXgtY2hlY2tlci5cbiAqIEBwYXJhbSB7c3RyaW5nfSBzdHIgVGhlIHN0cmluZyB0byBjaGVjay5cbiAqIEBwYXJhbSB7c3RyaW5nfSBwcmVmaXggIEEgc3RyaW5nIHRvIGxvb2sgZm9yIGF0IHRoZSBlbmQgb2YgYHN0cmAuXG4gKiBAcmV0dXJuIHtib29sZWFufSBUcnVlIGlmIGBzdHJgIGJlZ2lucyB3aXRoIGBwcmVmaXhgIChpZ25vcmluZ1xuICogICAgIGNhc2UpLlxuICogQHNlZSBnb29nLnN0cmluZy5jYXNlSW5zZW5zaXRpdmVTdGFydHNXaXRoXG4gKi9cbmdvb2cuc3RyaW5nLmludGVybmFsLmNhc2VJbnNlbnNpdGl2ZVN0YXJ0c1dpdGggPSBmdW5jdGlvbihzdHIsIHByZWZpeCkge1xuICAndXNlIHN0cmljdCc7XG4gIHJldHVybiBnb29nLnN0cmluZy5pbnRlcm5hbC5jYXNlSW5zZW5zaXRpdmVDb21wYXJlKFxuICAgICAgICAgICAgIHByZWZpeCwgc3RyLnN1YnN0cigwLCBwcmVmaXgubGVuZ3RoKSkgPT0gMDtcbn07XG5cblxuLyoqXG4gKiBDYXNlLWluc2Vuc2l0aXZlIHN1ZmZpeC1jaGVja2VyLlxuICogQHBhcmFtIHtzdHJpbmd9IHN0ciBUaGUgc3RyaW5nIHRvIGNoZWNrLlxuICogQHBhcmFtIHtzdHJpbmd9IHN1ZmZpeCBBIHN0cmluZyB0byBsb29rIGZvciBhdCB0aGUgZW5kIG9mIGBzdHJgLlxuICogQHJldHVybiB7Ym9vbGVhbn0gVHJ1ZSBpZiBgc3RyYCBlbmRzIHdpdGggYHN1ZmZpeGAgKGlnbm9yaW5nXG4gKiAgICAgY2FzZSkuXG4gKiBAc2VlIGdvb2cuc3RyaW5nLmNhc2VJbnNlbnNpdGl2ZUVuZHNXaXRoXG4gKi9cbmdvb2cuc3RyaW5nLmludGVybmFsLmNhc2VJbnNlbnNpdGl2ZUVuZHNXaXRoID0gZnVuY3Rpb24oc3RyLCBzdWZmaXgpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gKFxuICAgICAgZ29vZy5zdHJpbmcuaW50ZXJuYWwuY2FzZUluc2Vuc2l0aXZlQ29tcGFyZShcbiAgICAgICAgICBzdWZmaXgsIHN0ci5zdWJzdHIoc3RyLmxlbmd0aCAtIHN1ZmZpeC5sZW5ndGgsIHN1ZmZpeC5sZW5ndGgpKSA9PSAwKTtcbn07XG5cblxuLyoqXG4gKiBDYXNlLWluc2Vuc2l0aXZlIGVxdWFsaXR5IGNoZWNrZXIuXG4gKiBAcGFyYW0ge3N0cmluZ30gc3RyMSBGaXJzdCBzdHJpbmcgdG8gY2hlY2suXG4gKiBAcGFyYW0ge3N0cmluZ30gc3RyMiBTZWNvbmQgc3RyaW5nIHRvIGNoZWNrLlxuICogQHJldHVybiB7Ym9vbGVhbn0gVHJ1ZSBpZiBgc3RyMWAgYW5kIGBzdHIyYCBhcmUgdGhlIHNhbWUgc3RyaW5nLFxuICogICAgIGlnbm9yaW5nIGNhc2UuXG4gKiBAc2VlIGdvb2cuc3RyaW5nLmNhc2VJbnNlbnNpdGl2ZUVxdWFsc1xuICovXG5nb29nLnN0cmluZy5pbnRlcm5hbC5jYXNlSW5zZW5zaXRpdmVFcXVhbHMgPSBmdW5jdGlvbihzdHIxLCBzdHIyKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmV0dXJuIHN0cjEudG9Mb3dlckNhc2UoKSA9PSBzdHIyLnRvTG93ZXJDYXNlKCk7XG59O1xuXG5cbi8qKlxuICogQ2hlY2tzIGlmIGEgc3RyaW5nIGlzIGVtcHR5IG9yIGNvbnRhaW5zIG9ubHkgd2hpdGVzcGFjZXMuXG4gKiBAcGFyYW0ge3N0cmluZ30gc3RyIFRoZSBzdHJpbmcgdG8gY2hlY2suXG4gKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIGBzdHJgIGlzIGVtcHR5IG9yIHdoaXRlc3BhY2Ugb25seS5cbiAqIEBzZWUgZ29vZy5zdHJpbmcuaXNFbXB0eU9yV2hpdGVzcGFjZVxuICovXG5nb29nLnN0cmluZy5pbnRlcm5hbC5pc0VtcHR5T3JXaGl0ZXNwYWNlID0gZnVuY3Rpb24oc3RyKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgLy8gdGVzdGluZyBsZW5ndGggPT0gMCBmaXJzdCBpcyBhY3R1YWxseSBzbG93ZXIgaW4gYWxsIGJyb3dzZXJzIChhYm91dCB0aGVcbiAgLy8gc2FtZSBpbiBPcGVyYSkuXG4gIC8vIFNpbmNlIElFIGRvZXNuJ3QgaW5jbHVkZSBub24tYnJlYWtpbmctc3BhY2UgKDB4YTApIGluIHRoZWlyIFxccyBjaGFyYWN0ZXJcbiAgLy8gY2xhc3MgKGFzIHJlcXVpcmVkIGJ5IHNlY3Rpb24gNy4yIG9mIHRoZSBFQ01BU2NyaXB0IHNwZWMpLCB3ZSBleHBsaWNpdGx5XG4gIC8vIGluY2x1ZGUgaXQgaW4gdGhlIHJlZ2V4cCB0byBlbmZvcmNlIGNvbnNpc3RlbnQgY3Jvc3MtYnJvd3NlciBiZWhhdmlvci5cbiAgcmV0dXJuIC9eW1xcc1xceGEwXSokLy50ZXN0KHN0cik7XG59O1xuXG5cbi8qKlxuICogVHJpbXMgd2hpdGUgc3BhY2VzIHRvIHRoZSBsZWZ0IGFuZCByaWdodCBvZiBhIHN0cmluZy5cbiAqIEBwYXJhbSB7c3RyaW5nfSBzdHIgVGhlIHN0cmluZyB0byB0cmltLlxuICogQHJldHVybiB7c3RyaW5nfSBBIHRyaW1tZWQgY29weSBvZiBgc3RyYC5cbiAqL1xuZ29vZy5zdHJpbmcuaW50ZXJuYWwudHJpbSA9XG4gICAgKGdvb2cuVFJVU1RFRF9TSVRFICYmIFN0cmluZy5wcm90b3R5cGUudHJpbSkgPyBmdW5jdGlvbihzdHIpIHtcbiAgICAgICd1c2Ugc3RyaWN0JztcbiAgICAgIHJldHVybiBzdHIudHJpbSgpO1xuICAgIH0gOiBmdW5jdGlvbihzdHIpIHtcbiAgICAgICd1c2Ugc3RyaWN0JztcbiAgICAgIC8vIFNpbmNlIElFIGRvZXNuJ3QgaW5jbHVkZSBub24tYnJlYWtpbmctc3BhY2UgKDB4YTApIGluIHRoZWlyIFxcc1xuICAgICAgLy8gY2hhcmFjdGVyIGNsYXNzIChhcyByZXF1aXJlZCBieSBzZWN0aW9uIDcuMiBvZiB0aGUgRUNNQVNjcmlwdCBzcGVjKSxcbiAgICAgIC8vIHdlIGV4cGxpY2l0bHkgaW5jbHVkZSBpdCBpbiB0aGUgcmVnZXhwIHRvIGVuZm9yY2UgY29uc2lzdGVudFxuICAgICAgLy8gY3Jvc3MtYnJvd3NlciBiZWhhdmlvci5cbiAgICAgIC8vIE5PVEU6IFdlIGRvbid0IHVzZSBTdHJpbmcjcmVwbGFjZSBiZWNhdXNlIGl0IG1pZ2h0IGhhdmUgc2lkZSBlZmZlY3RzXG4gICAgICAvLyBjYXVzaW5nIHRoaXMgZnVuY3Rpb24gdG8gbm90IGNvbXBpbGUgdG8gMCBieXRlcy5cbiAgICAgIHJldHVybiAvXltcXHNcXHhhMF0qKFtcXHNcXFNdKj8pW1xcc1xceGEwXSokLy5leGVjKHN0cilbMV07XG4gICAgfTtcblxuXG4vKipcbiAqIEEgc3RyaW5nIGNvbXBhcmF0b3IgdGhhdCBpZ25vcmVzIGNhc2UuXG4gKiAtMSA9IHN0cjEgbGVzcyB0aGFuIHN0cjJcbiAqICAwID0gc3RyMSBlcXVhbHMgc3RyMlxuICogIDEgPSBzdHIxIGdyZWF0ZXIgdGhhbiBzdHIyXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHN0cjEgVGhlIHN0cmluZyB0byBjb21wYXJlLlxuICogQHBhcmFtIHtzdHJpbmd9IHN0cjIgVGhlIHN0cmluZyB0byBjb21wYXJlIGBzdHIxYCB0by5cbiAqIEByZXR1cm4ge251bWJlcn0gVGhlIGNvbXBhcmF0b3IgcmVzdWx0LCBhcyBkZXNjcmliZWQgYWJvdmUuXG4gKiBAc2VlIGdvb2cuc3RyaW5nLmNhc2VJbnNlbnNpdGl2ZUNvbXBhcmVcbiAqL1xuZ29vZy5zdHJpbmcuaW50ZXJuYWwuY2FzZUluc2Vuc2l0aXZlQ29tcGFyZSA9IGZ1bmN0aW9uKHN0cjEsIHN0cjIpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBjb25zdCB0ZXN0MSA9IFN0cmluZyhzdHIxKS50b0xvd2VyQ2FzZSgpO1xuICBjb25zdCB0ZXN0MiA9IFN0cmluZyhzdHIyKS50b0xvd2VyQ2FzZSgpO1xuXG4gIGlmICh0ZXN0MSA8IHRlc3QyKSB7XG4gICAgcmV0dXJuIC0xO1xuICB9IGVsc2UgaWYgKHRlc3QxID09IHRlc3QyKSB7XG4gICAgcmV0dXJuIDA7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIDE7XG4gIH1cbn07XG5cblxuLyoqXG4gKiBDb252ZXJ0cyBcXG4gdG8gPGJyPnMgb3IgPGJyIC8+cy5cbiAqIEBwYXJhbSB7c3RyaW5nfSBzdHIgVGhlIHN0cmluZyBpbiB3aGljaCB0byBjb252ZXJ0IG5ld2xpbmVzLlxuICogQHBhcmFtIHtib29sZWFuPX0gb3B0X3htbCBXaGV0aGVyIHRvIHVzZSBYTUwgY29tcGF0aWJsZSB0YWdzLlxuICogQHJldHVybiB7c3RyaW5nfSBBIGNvcHkgb2YgYHN0cmAgd2l0aCBjb252ZXJ0ZWQgbmV3bGluZXMuXG4gKiBAc2VlIGdvb2cuc3RyaW5nLm5ld0xpbmVUb0JyXG4gKi9cbmdvb2cuc3RyaW5nLmludGVybmFsLm5ld0xpbmVUb0JyID0gZnVuY3Rpb24oc3RyLCBvcHRfeG1sKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmV0dXJuIHN0ci5yZXBsYWNlKC8oXFxyXFxufFxccnxcXG4pL2csIG9wdF94bWwgPyAnPGJyIC8+JyA6ICc8YnI+Jyk7XG59O1xuXG5cbi8qKlxuICogRXNjYXBlcyBkb3VibGUgcXVvdGUgJ1wiJyBhbmQgc2luZ2xlIHF1b3RlICdcXCcnIGNoYXJhY3RlcnMgaW4gYWRkaXRpb24gdG9cbiAqICcmJywgJzwnLCBhbmQgJz4nIHNvIHRoYXQgYSBzdHJpbmcgY2FuIGJlIGluY2x1ZGVkIGluIGFuIEhUTUwgdGFnIGF0dHJpYnV0ZVxuICogdmFsdWUgd2l0aGluIGRvdWJsZSBvciBzaW5nbGUgcXVvdGVzLlxuICogQHBhcmFtIHtzdHJpbmd9IHN0ciBzdHJpbmcgdG8gYmUgZXNjYXBlZC5cbiAqIEBwYXJhbSB7Ym9vbGVhbj19IG9wdF9pc0xpa2VseVRvQ29udGFpbkh0bWxDaGFyc1xuICogQHJldHVybiB7c3RyaW5nfSBBbiBlc2NhcGVkIGNvcHkgb2YgYHN0cmAuXG4gKiBAc2VlIGdvb2cuc3RyaW5nLmh0bWxFc2NhcGVcbiAqL1xuZ29vZy5zdHJpbmcuaW50ZXJuYWwuaHRtbEVzY2FwZSA9IGZ1bmN0aW9uKFxuICAgIHN0ciwgb3B0X2lzTGlrZWx5VG9Db250YWluSHRtbENoYXJzKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgaWYgKG9wdF9pc0xpa2VseVRvQ29udGFpbkh0bWxDaGFycykge1xuICAgIHN0ciA9IHN0ci5yZXBsYWNlKGdvb2cuc3RyaW5nLmludGVybmFsLkFNUF9SRV8sICcmYW1wOycpXG4gICAgICAgICAgICAgIC5yZXBsYWNlKGdvb2cuc3RyaW5nLmludGVybmFsLkxUX1JFXywgJyZsdDsnKVxuICAgICAgICAgICAgICAucmVwbGFjZShnb29nLnN0cmluZy5pbnRlcm5hbC5HVF9SRV8sICcmZ3Q7JylcbiAgICAgICAgICAgICAgLnJlcGxhY2UoZ29vZy5zdHJpbmcuaW50ZXJuYWwuUVVPVF9SRV8sICcmcXVvdDsnKVxuICAgICAgICAgICAgICAucmVwbGFjZShnb29nLnN0cmluZy5pbnRlcm5hbC5TSU5HTEVfUVVPVEVfUkVfLCAnJiMzOTsnKVxuICAgICAgICAgICAgICAucmVwbGFjZShnb29nLnN0cmluZy5pbnRlcm5hbC5OVUxMX1JFXywgJyYjMDsnKTtcbiAgICByZXR1cm4gc3RyO1xuXG4gIH0gZWxzZSB7XG4gICAgLy8gcXVpY2sgdGVzdCBoZWxwcyBpbiB0aGUgY2FzZSB3aGVuIHRoZXJlIGFyZSBubyBjaGFycyB0byByZXBsYWNlLCBpblxuICAgIC8vIHdvcnN0IGNhc2UgdGhpcyBtYWtlcyBiYXJlbHkgYSBkaWZmZXJlbmNlIHRvIHRoZSB0aW1lIHRha2VuXG4gICAgaWYgKCFnb29nLnN0cmluZy5pbnRlcm5hbC5BTExfUkVfLnRlc3Qoc3RyKSkgcmV0dXJuIHN0cjtcblxuICAgIC8vIHN0ci5pbmRleE9mIGlzIGZhc3RlciB0aGFuIHJlZ2V4LnRlc3QgaW4gdGhpcyBjYXNlXG4gICAgaWYgKHN0ci5pbmRleE9mKCcmJykgIT0gLTEpIHtcbiAgICAgIHN0ciA9IHN0ci5yZXBsYWNlKGdvb2cuc3RyaW5nLmludGVybmFsLkFNUF9SRV8sICcmYW1wOycpO1xuICAgIH1cbiAgICBpZiAoc3RyLmluZGV4T2YoJzwnKSAhPSAtMSkge1xuICAgICAgc3RyID0gc3RyLnJlcGxhY2UoZ29vZy5zdHJpbmcuaW50ZXJuYWwuTFRfUkVfLCAnJmx0OycpO1xuICAgIH1cbiAgICBpZiAoc3RyLmluZGV4T2YoJz4nKSAhPSAtMSkge1xuICAgICAgc3RyID0gc3RyLnJlcGxhY2UoZ29vZy5zdHJpbmcuaW50ZXJuYWwuR1RfUkVfLCAnJmd0OycpO1xuICAgIH1cbiAgICBpZiAoc3RyLmluZGV4T2YoJ1wiJykgIT0gLTEpIHtcbiAgICAgIHN0ciA9IHN0ci5yZXBsYWNlKGdvb2cuc3RyaW5nLmludGVybmFsLlFVT1RfUkVfLCAnJnF1b3Q7Jyk7XG4gICAgfVxuICAgIGlmIChzdHIuaW5kZXhPZignXFwnJykgIT0gLTEpIHtcbiAgICAgIHN0ciA9IHN0ci5yZXBsYWNlKGdvb2cuc3RyaW5nLmludGVybmFsLlNJTkdMRV9RVU9URV9SRV8sICcmIzM5OycpO1xuICAgIH1cbiAgICBpZiAoc3RyLmluZGV4T2YoJ1xceDAwJykgIT0gLTEpIHtcbiAgICAgIHN0ciA9IHN0ci5yZXBsYWNlKGdvb2cuc3RyaW5nLmludGVybmFsLk5VTExfUkVfLCAnJiMwOycpO1xuICAgIH1cbiAgICByZXR1cm4gc3RyO1xuICB9XG59O1xuXG5cbi8qKlxuICogUmVndWxhciBleHByZXNzaW9uIHRoYXQgbWF0Y2hlcyBhbiBhbXBlcnNhbmQsIGZvciB1c2UgaW4gZXNjYXBpbmcuXG4gKiBAY29uc3QgeyFSZWdFeHB9XG4gKiBAcHJpdmF0ZVxuICovXG5nb29nLnN0cmluZy5pbnRlcm5hbC5BTVBfUkVfID0gLyYvZztcblxuXG4vKipcbiAqIFJlZ3VsYXIgZXhwcmVzc2lvbiB0aGF0IG1hdGNoZXMgYSBsZXNzIHRoYW4gc2lnbiwgZm9yIHVzZSBpbiBlc2NhcGluZy5cbiAqIEBjb25zdCB7IVJlZ0V4cH1cbiAqIEBwcml2YXRlXG4gKi9cbmdvb2cuc3RyaW5nLmludGVybmFsLkxUX1JFXyA9IC88L2c7XG5cblxuLyoqXG4gKiBSZWd1bGFyIGV4cHJlc3Npb24gdGhhdCBtYXRjaGVzIGEgZ3JlYXRlciB0aGFuIHNpZ24sIGZvciB1c2UgaW4gZXNjYXBpbmcuXG4gKiBAY29uc3QgeyFSZWdFeHB9XG4gKiBAcHJpdmF0ZVxuICovXG5nb29nLnN0cmluZy5pbnRlcm5hbC5HVF9SRV8gPSAvPi9nO1xuXG5cbi8qKlxuICogUmVndWxhciBleHByZXNzaW9uIHRoYXQgbWF0Y2hlcyBhIGRvdWJsZSBxdW90ZSwgZm9yIHVzZSBpbiBlc2NhcGluZy5cbiAqIEBjb25zdCB7IVJlZ0V4cH1cbiAqIEBwcml2YXRlXG4gKi9cbmdvb2cuc3RyaW5nLmludGVybmFsLlFVT1RfUkVfID0gL1wiL2c7XG5cblxuLyoqXG4gKiBSZWd1bGFyIGV4cHJlc3Npb24gdGhhdCBtYXRjaGVzIGEgc2luZ2xlIHF1b3RlLCBmb3IgdXNlIGluIGVzY2FwaW5nLlxuICogQGNvbnN0IHshUmVnRXhwfVxuICogQHByaXZhdGVcbiAqL1xuZ29vZy5zdHJpbmcuaW50ZXJuYWwuU0lOR0xFX1FVT1RFX1JFXyA9IC8nL2c7XG5cblxuLyoqXG4gKiBSZWd1bGFyIGV4cHJlc3Npb24gdGhhdCBtYXRjaGVzIG51bGwgY2hhcmFjdGVyLCBmb3IgdXNlIGluIGVzY2FwaW5nLlxuICogQGNvbnN0IHshUmVnRXhwfVxuICogQHByaXZhdGVcbiAqL1xuZ29vZy5zdHJpbmcuaW50ZXJuYWwuTlVMTF9SRV8gPSAvXFx4MDAvZztcblxuXG4vKipcbiAqIFJlZ3VsYXIgZXhwcmVzc2lvbiB0aGF0IG1hdGNoZXMgYW55IGNoYXJhY3RlciB0aGF0IG5lZWRzIHRvIGJlIGVzY2FwZWQuXG4gKiBAY29uc3QgeyFSZWdFeHB9XG4gKiBAcHJpdmF0ZVxuICovXG5nb29nLnN0cmluZy5pbnRlcm5hbC5BTExfUkVfID0gL1tcXHgwMCY8PlwiJ10vO1xuXG5cbi8qKlxuICogRG8gZXNjYXBpbmcgb2Ygd2hpdGVzcGFjZSB0byBwcmVzZXJ2ZSBzcGF0aWFsIGZvcm1hdHRpbmcuIFdlIHVzZSBjaGFyYWN0ZXJcbiAqIGVudGl0eSAjMTYwIHRvIG1ha2UgaXQgc2FmZXIgZm9yIHhtbC5cbiAqIEBwYXJhbSB7c3RyaW5nfSBzdHIgVGhlIHN0cmluZyBpbiB3aGljaCB0byBlc2NhcGUgd2hpdGVzcGFjZS5cbiAqIEBwYXJhbSB7Ym9vbGVhbj19IG9wdF94bWwgV2hldGhlciB0byB1c2UgWE1MIGNvbXBhdGlibGUgdGFncy5cbiAqIEByZXR1cm4ge3N0cmluZ30gQW4gZXNjYXBlZCBjb3B5IG9mIGBzdHJgLlxuICogQHNlZSBnb29nLnN0cmluZy53aGl0ZXNwYWNlRXNjYXBlXG4gKi9cbmdvb2cuc3RyaW5nLmludGVybmFsLndoaXRlc3BhY2VFc2NhcGUgPSBmdW5jdGlvbihzdHIsIG9wdF94bWwpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICAvLyBUaGlzIGRvZXNuJ3QgdXNlIGdvb2cuc3RyaW5nLnByZXNlcnZlU3BhY2VzIGZvciBiYWNrd2FyZHMgY29tcGF0aWJpbGl0eS5cbiAgcmV0dXJuIGdvb2cuc3RyaW5nLmludGVybmFsLm5ld0xpbmVUb0JyKFxuICAgICAgc3RyLnJlcGxhY2UoLyAgL2csICcgJiMxNjA7JyksIG9wdF94bWwpO1xufTtcblxuXG4vKipcbiAqIERldGVybWluZXMgd2hldGhlciBhIHN0cmluZyBjb250YWlucyBhIHN1YnN0cmluZy5cbiAqIEBwYXJhbSB7c3RyaW5nfSBzdHIgVGhlIHN0cmluZyB0byBzZWFyY2guXG4gKiBAcGFyYW0ge3N0cmluZ30gc3ViU3RyaW5nIFRoZSBzdWJzdHJpbmcgdG8gc2VhcmNoIGZvci5cbiAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgYHN0cmAgY29udGFpbnMgYHN1YlN0cmluZ2AuXG4gKiBAc2VlIGdvb2cuc3RyaW5nLmNvbnRhaW5zXG4gKi9cbmdvb2cuc3RyaW5nLmludGVybmFsLmNvbnRhaW5zID0gZnVuY3Rpb24oc3RyLCBzdWJTdHJpbmcpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gc3RyLmluZGV4T2Yoc3ViU3RyaW5nKSAhPSAtMTtcbn07XG5cblxuLyoqXG4gKiBEZXRlcm1pbmVzIHdoZXRoZXIgYSBzdHJpbmcgY29udGFpbnMgYSBzdWJzdHJpbmcsIGlnbm9yaW5nIGNhc2UuXG4gKiBAcGFyYW0ge3N0cmluZ30gc3RyIFRoZSBzdHJpbmcgdG8gc2VhcmNoLlxuICogQHBhcmFtIHtzdHJpbmd9IHN1YlN0cmluZyBUaGUgc3Vic3RyaW5nIHRvIHNlYXJjaCBmb3IuXG4gKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIGBzdHJgIGNvbnRhaW5zIGBzdWJTdHJpbmdgLlxuICogQHNlZSBnb29nLnN0cmluZy5jYXNlSW5zZW5zaXRpdmVDb250YWluc1xuICovXG5nb29nLnN0cmluZy5pbnRlcm5hbC5jYXNlSW5zZW5zaXRpdmVDb250YWlucyA9IGZ1bmN0aW9uKHN0ciwgc3ViU3RyaW5nKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmV0dXJuIGdvb2cuc3RyaW5nLmludGVybmFsLmNvbnRhaW5zKFxuICAgICAgc3RyLnRvTG93ZXJDYXNlKCksIHN1YlN0cmluZy50b0xvd2VyQ2FzZSgpKTtcbn07XG5cblxuLyoqXG4gKiBDb21wYXJlcyB0d28gdmVyc2lvbiBudW1iZXJzLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfG51bWJlcn0gdmVyc2lvbjEgVmVyc2lvbiBvZiBmaXJzdCBpdGVtLlxuICogQHBhcmFtIHtzdHJpbmd8bnVtYmVyfSB2ZXJzaW9uMiBWZXJzaW9uIG9mIHNlY29uZCBpdGVtLlxuICpcbiAqIEByZXR1cm4ge251bWJlcn0gIDEgaWYgYHZlcnNpb24xYCBpcyBoaWdoZXIuXG4gKiAgICAgICAgICAgICAgICAgICAwIGlmIGFyZ3VtZW50cyBhcmUgZXF1YWwuXG4gKiAgICAgICAgICAgICAgICAgIC0xIGlmIGB2ZXJzaW9uMmAgaXMgaGlnaGVyLlxuICogQHNlZSBnb29nLnN0cmluZy5jb21wYXJlVmVyc2lvbnNcbiAqL1xuZ29vZy5zdHJpbmcuaW50ZXJuYWwuY29tcGFyZVZlcnNpb25zID0gZnVuY3Rpb24odmVyc2lvbjEsIHZlcnNpb24yKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgbGV0IG9yZGVyID0gMDtcbiAgLy8gVHJpbSBsZWFkaW5nIGFuZCB0cmFpbGluZyB3aGl0ZXNwYWNlIGFuZCBzcGxpdCB0aGUgdmVyc2lvbnMgaW50b1xuICAvLyBzdWJ2ZXJzaW9ucy5cbiAgY29uc3QgdjFTdWJzID0gZ29vZy5zdHJpbmcuaW50ZXJuYWwudHJpbShTdHJpbmcodmVyc2lvbjEpKS5zcGxpdCgnLicpO1xuICBjb25zdCB2MlN1YnMgPSBnb29nLnN0cmluZy5pbnRlcm5hbC50cmltKFN0cmluZyh2ZXJzaW9uMikpLnNwbGl0KCcuJyk7XG4gIGNvbnN0IHN1YkNvdW50ID0gTWF0aC5tYXgodjFTdWJzLmxlbmd0aCwgdjJTdWJzLmxlbmd0aCk7XG5cbiAgLy8gSXRlcmF0ZSBvdmVyIHRoZSBzdWJ2ZXJzaW9ucywgYXMgbG9uZyBhcyB0aGV5IGFwcGVhciB0byBiZSBlcXVpdmFsZW50LlxuICBmb3IgKGxldCBzdWJJZHggPSAwOyBvcmRlciA9PSAwICYmIHN1YklkeCA8IHN1YkNvdW50OyBzdWJJZHgrKykge1xuICAgIGxldCB2MVN1YiA9IHYxU3Vic1tzdWJJZHhdIHx8ICcnO1xuICAgIGxldCB2MlN1YiA9IHYyU3Vic1tzdWJJZHhdIHx8ICcnO1xuXG4gICAgZG8ge1xuICAgICAgLy8gU3BsaXQgdGhlIHN1YnZlcnNpb25zIGludG8gcGFpcnMgb2YgbnVtYmVycyBhbmQgcXVhbGlmaWVycyAobGlrZSAnYicpLlxuICAgICAgLy8gVHdvIGRpZmZlcmVudCBSZWdFeHAgb2JqZWN0cyBhcmUgdXNlIHRvIG1ha2UgaXQgY2xlYXIgdGhlIGNvZGVcbiAgICAgIC8vIGlzIHNpZGUtZWZmZWN0IGZyZWVcbiAgICAgIGNvbnN0IHYxQ29tcCA9IC8oXFxkKikoXFxEKikoLiopLy5leGVjKHYxU3ViKSB8fCBbJycsICcnLCAnJywgJyddO1xuICAgICAgY29uc3QgdjJDb21wID0gLyhcXGQqKShcXEQqKSguKikvLmV4ZWModjJTdWIpIHx8IFsnJywgJycsICcnLCAnJ107XG4gICAgICAvLyBCcmVhayBpZiB0aGVyZSBhcmUgbm8gbW9yZSBtYXRjaGVzLlxuICAgICAgaWYgKHYxQ29tcFswXS5sZW5ndGggPT0gMCAmJiB2MkNvbXBbMF0ubGVuZ3RoID09IDApIHtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG5cbiAgICAgIC8vIFBhcnNlIHRoZSBudW1lcmljIHBhcnQgb2YgdGhlIHN1YnZlcnNpb24uIEEgbWlzc2luZyBudW1iZXIgaXNcbiAgICAgIC8vIGVxdWl2YWxlbnQgdG8gMC5cbiAgICAgIGNvbnN0IHYxQ29tcE51bSA9IHYxQ29tcFsxXS5sZW5ndGggPT0gMCA/IDAgOiBwYXJzZUludCh2MUNvbXBbMV0sIDEwKTtcbiAgICAgIGNvbnN0IHYyQ29tcE51bSA9IHYyQ29tcFsxXS5sZW5ndGggPT0gMCA/IDAgOiBwYXJzZUludCh2MkNvbXBbMV0sIDEwKTtcblxuICAgICAgLy8gQ29tcGFyZSB0aGUgc3VidmVyc2lvbiBjb21wb25lbnRzLiBUaGUgbnVtYmVyIGhhcyB0aGUgaGlnaGVzdFxuICAgICAgLy8gcHJlY2VkZW5jZS4gTmV4dCwgaWYgdGhlIG51bWJlcnMgYXJlIGVxdWFsLCBhIHN1YnZlcnNpb24gd2l0aG91dCBhbnlcbiAgICAgIC8vIHF1YWxpZmllciBpcyBhbHdheXMgaGlnaGVyIHRoYW4gYSBzdWJ2ZXJzaW9uIHdpdGggYW55IHF1YWxpZmllci4gTmV4dCxcbiAgICAgIC8vIHRoZSBxdWFsaWZpZXJzIGFyZSBjb21wYXJlZCBhcyBzdHJpbmdzLlxuICAgICAgb3JkZXIgPSBnb29nLnN0cmluZy5pbnRlcm5hbC5jb21wYXJlRWxlbWVudHNfKHYxQ29tcE51bSwgdjJDb21wTnVtKSB8fFxuICAgICAgICAgIGdvb2cuc3RyaW5nLmludGVybmFsLmNvbXBhcmVFbGVtZW50c18oXG4gICAgICAgICAgICAgIHYxQ29tcFsyXS5sZW5ndGggPT0gMCwgdjJDb21wWzJdLmxlbmd0aCA9PSAwKSB8fFxuICAgICAgICAgIGdvb2cuc3RyaW5nLmludGVybmFsLmNvbXBhcmVFbGVtZW50c18odjFDb21wWzJdLCB2MkNvbXBbMl0pO1xuICAgICAgLy8gU3RvcCBhcyBzb29uIGFzIGFuIGluZXF1YWxpdHkgaXMgZGlzY292ZXJlZC5cblxuICAgICAgdjFTdWIgPSB2MUNvbXBbM107XG4gICAgICB2MlN1YiA9IHYyQ29tcFszXTtcbiAgICB9IHdoaWxlIChvcmRlciA9PSAwKTtcbiAgfVxuXG4gIHJldHVybiBvcmRlcjtcbn07XG5cblxuLyoqXG4gKiBDb21wYXJlcyBlbGVtZW50cyBvZiBhIHZlcnNpb24gbnVtYmVyLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfG51bWJlcnxib29sZWFufSBsZWZ0IEFuIGVsZW1lbnQgZnJvbSBhIHZlcnNpb24gbnVtYmVyLlxuICogQHBhcmFtIHtzdHJpbmd8bnVtYmVyfGJvb2xlYW59IHJpZ2h0IEFuIGVsZW1lbnQgZnJvbSBhIHZlcnNpb24gbnVtYmVyLlxuICpcbiAqIEByZXR1cm4ge251bWJlcn0gIDEgaWYgYGxlZnRgIGlzIGhpZ2hlci5cbiAqICAgICAgICAgICAgICAgICAgIDAgaWYgYXJndW1lbnRzIGFyZSBlcXVhbC5cbiAqICAgICAgICAgICAgICAgICAgLTEgaWYgYHJpZ2h0YCBpcyBoaWdoZXIuXG4gKiBAcHJpdmF0ZVxuICovXG5nb29nLnN0cmluZy5pbnRlcm5hbC5jb21wYXJlRWxlbWVudHNfID0gZnVuY3Rpb24obGVmdCwgcmlnaHQpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBpZiAobGVmdCA8IHJpZ2h0KSB7XG4gICAgcmV0dXJuIC0xO1xuICB9IGVsc2UgaWYgKGxlZnQgPiByaWdodCkge1xuICAgIHJldHVybiAxO1xuICB9XG4gIHJldHVybiAwO1xufTtcbiIsICIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgVGhlIENsb3N1cmUgTGlicmFyeSBBdXRob3JzLlxuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIEBmaWxlb3ZlcnZpZXcgVXRpbGl0aWVzIHVzZWQgYnkgZ29vZy5sYWJzLnVzZXJBZ2VudCB0b29scy4gVGhlc2UgZnVuY3Rpb25zXG4gKiBzaG91bGQgbm90IGJlIHVzZWQgb3V0c2lkZSBvZiBnb29nLmxhYnMudXNlckFnZW50LiouXG4gKlxuICovXG5cbmdvb2cucHJvdmlkZSgnZ29vZy5sYWJzLnVzZXJBZ2VudC51dGlsJyk7XG5cbmdvb2cucmVxdWlyZSgnZ29vZy5zdHJpbmcuaW50ZXJuYWwnKTtcblxuXG4vKipcbiAqIEdldHMgdGhlIG5hdGl2ZSB1c2VyQWdlbnQgc3RyaW5nIGZyb20gbmF2aWdhdG9yIGlmIGl0IGV4aXN0cy5cbiAqIElmIG5hdmlnYXRvciBvciBuYXZpZ2F0b3IudXNlckFnZW50IHN0cmluZyBpcyBtaXNzaW5nLCByZXR1cm5zIGFuIGVtcHR5XG4gKiBzdHJpbmcuXG4gKiBAcmV0dXJuIHtzdHJpbmd9XG4gKiBAcHJpdmF0ZVxuICovXG5nb29nLmxhYnMudXNlckFnZW50LnV0aWwuZ2V0TmF0aXZlVXNlckFnZW50U3RyaW5nXyA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIHZhciBuYXZpZ2F0b3IgPSBnb29nLmxhYnMudXNlckFnZW50LnV0aWwuZ2V0TmF2aWdhdG9yXygpO1xuICBpZiAobmF2aWdhdG9yKSB7XG4gICAgdmFyIHVzZXJBZ2VudCA9IG5hdmlnYXRvci51c2VyQWdlbnQ7XG4gICAgaWYgKHVzZXJBZ2VudCkge1xuICAgICAgcmV0dXJuIHVzZXJBZ2VudDtcbiAgICB9XG4gIH1cbiAgcmV0dXJuICcnO1xufTtcblxuXG4vKipcbiAqIEdldHRlciBmb3IgdGhlIG5hdGl2ZSBuYXZpZ2F0b3IuXG4gKiBUaGlzIGlzIGEgc2VwYXJhdGUgZnVuY3Rpb24gc28gaXQgY2FuIGJlIHN0dWJiZWQgb3V0IGluIHRlc3RpbmcuXG4gKiBAcmV0dXJuIHshTmF2aWdhdG9yfVxuICogQHByaXZhdGVcbiAqL1xuZ29vZy5sYWJzLnVzZXJBZ2VudC51dGlsLmdldE5hdmlnYXRvcl8gPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gZ29vZy5nbG9iYWwubmF2aWdhdG9yO1xufTtcblxuXG4vKipcbiAqIEEgcG9zc2libGUgb3ZlcnJpZGUgZm9yIGFwcGxpY2F0aW9ucyB3aGljaCB3aXNoIHRvIG5vdCBjaGVja1xuICogbmF2aWdhdG9yLnVzZXJBZ2VudCBidXQgdXNlIGEgc3BlY2lmaWVkIHZhbHVlIGZvciBkZXRlY3Rpb24gaW5zdGVhZC5cbiAqIEBwcml2YXRlIHtzdHJpbmd9XG4gKi9cbmdvb2cubGFicy51c2VyQWdlbnQudXRpbC51c2VyQWdlbnRfID1cbiAgICBnb29nLmxhYnMudXNlckFnZW50LnV0aWwuZ2V0TmF0aXZlVXNlckFnZW50U3RyaW5nXygpO1xuXG5cbi8qKlxuICogQXBwbGljYXRpb25zIG1heSBvdmVycmlkZSBicm93c2VyIGRldGVjdGlvbiBvbiB0aGUgYnVpbHQgaW5cbiAqIG5hdmlnYXRvci51c2VyQWdlbnQgb2JqZWN0IGJ5IHNldHRpbmcgdGhpcyBzdHJpbmcuIFNldCB0byBudWxsIHRvIHVzZSB0aGVcbiAqIGJyb3dzZXIgb2JqZWN0IGluc3RlYWQuXG4gKiBAcGFyYW0gez9zdHJpbmc9fSBvcHRfdXNlckFnZW50IFRoZSBVc2VyLUFnZW50IG92ZXJyaWRlLlxuICogQHJldHVybiB7dm9pZH1cbiAqL1xuZ29vZy5sYWJzLnVzZXJBZ2VudC51dGlsLnNldFVzZXJBZ2VudCA9IGZ1bmN0aW9uKG9wdF91c2VyQWdlbnQpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBnb29nLmxhYnMudXNlckFnZW50LnV0aWwudXNlckFnZW50XyA9XG4gICAgICBvcHRfdXNlckFnZW50IHx8IGdvb2cubGFicy51c2VyQWdlbnQudXRpbC5nZXROYXRpdmVVc2VyQWdlbnRTdHJpbmdfKCk7XG59O1xuXG5cbi8qKlxuICogQHJldHVybiB7c3RyaW5nfSBUaGUgdXNlciBhZ2VudCBzdHJpbmcuXG4gKi9cbmdvb2cubGFicy51c2VyQWdlbnQudXRpbC5nZXRVc2VyQWdlbnQgPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gZ29vZy5sYWJzLnVzZXJBZ2VudC51dGlsLnVzZXJBZ2VudF87XG59O1xuXG5cbi8qKlxuICogQHBhcmFtIHtzdHJpbmd9IHN0clxuICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGUgdXNlciBhZ2VudCBjb250YWlucyB0aGUgZ2l2ZW4gc3RyaW5nLlxuICovXG5nb29nLmxhYnMudXNlckFnZW50LnV0aWwubWF0Y2hVc2VyQWdlbnQgPSBmdW5jdGlvbihzdHIpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICB2YXIgdXNlckFnZW50ID0gZ29vZy5sYWJzLnVzZXJBZ2VudC51dGlsLmdldFVzZXJBZ2VudCgpO1xuICByZXR1cm4gZ29vZy5zdHJpbmcuaW50ZXJuYWwuY29udGFpbnModXNlckFnZW50LCBzdHIpO1xufTtcblxuXG4vKipcbiAqIEBwYXJhbSB7c3RyaW5nfSBzdHJcbiAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgdGhlIHVzZXIgYWdlbnQgY29udGFpbnMgdGhlIGdpdmVuIHN0cmluZywgaWdub3JpbmdcbiAqICAgICBjYXNlLlxuICovXG5nb29nLmxhYnMudXNlckFnZW50LnV0aWwubWF0Y2hVc2VyQWdlbnRJZ25vcmVDYXNlID0gZnVuY3Rpb24oc3RyKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgdmFyIHVzZXJBZ2VudCA9IGdvb2cubGFicy51c2VyQWdlbnQudXRpbC5nZXRVc2VyQWdlbnQoKTtcbiAgcmV0dXJuIGdvb2cuc3RyaW5nLmludGVybmFsLmNhc2VJbnNlbnNpdGl2ZUNvbnRhaW5zKHVzZXJBZ2VudCwgc3RyKTtcbn07XG5cblxuLyoqXG4gKiBQYXJzZXMgdGhlIHVzZXIgYWdlbnQgaW50byB0dXBsZXMgZm9yIGVhY2ggc2VjdGlvbi5cbiAqIEBwYXJhbSB7c3RyaW5nfSB1c2VyQWdlbnRcbiAqIEByZXR1cm4geyFBcnJheTwhQXJyYXk8c3RyaW5nPj59IFR1cGxlcyBvZiBrZXksIHZlcnNpb24sIGFuZCB0aGUgY29udGVudHNcbiAqICAgICBvZiB0aGUgcGFyZW50aGV0aWNhbC5cbiAqL1xuZ29vZy5sYWJzLnVzZXJBZ2VudC51dGlsLmV4dHJhY3RWZXJzaW9uVHVwbGVzID0gZnVuY3Rpb24odXNlckFnZW50KSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgLy8gTWF0Y2hlcyBlYWNoIHNlY3Rpb24gb2YgYSB1c2VyIGFnZW50IHN0cmluZy5cbiAgLy8gRXhhbXBsZSBVQTpcbiAgLy8gTW96aWxsYS81LjAgKGlQYWQ7IFU7IENQVSBPUyAzXzJfMSBsaWtlIE1hYyBPUyBYOyBlbi11cylcbiAgLy8gQXBwbGVXZWJLaXQvNTMxLjIxLjEwIChLSFRNTCwgbGlrZSBHZWNrbykgTW9iaWxlLzdCNDA1XG4gIC8vIFRoaXMgaGFzIHRocmVlIHZlcnNpb24gdHVwbGVzOiBNb3ppbGxhLCBBcHBsZVdlYktpdCwgYW5kIE1vYmlsZS5cblxuICB2YXIgdmVyc2lvblJlZ0V4cCA9IG5ldyBSZWdFeHAoXG4gICAgICAvLyBLZXkuIE5vdGUgdGhhdCBhIGtleSBtYXkgaGF2ZSBhIHNwYWNlLlxuICAgICAgLy8gKGkuZS4gJ01vYmlsZSBTYWZhcmknIGluICdNb2JpbGUgU2FmYXJpLzUuMCcpXG4gICAgICAnKFxcXFx3W1xcXFx3IF0rKScgK1xuXG4gICAgICAgICAgJy8nICsgICAgICAgICAgICAgICAgLy8gc2xhc2hcbiAgICAgICAgICAnKFteXFxcXHNdKyknICsgICAgICAgIC8vIHZlcnNpb24gKGkuZS4gJzUuMGInKVxuICAgICAgICAgICdcXFxccyonICsgICAgICAgICAgICAgLy8gd2hpdGVzcGFjZVxuICAgICAgICAgICcoPzpcXFxcKCguKj8pXFxcXCkpPycsICAvLyBwYXJlbnRoZXRpY2FsIGluZm8uIHBhcmVudGhlc2VzIG5vdCBtYXRjaGVkLlxuICAgICAgJ2cnKTtcblxuICB2YXIgZGF0YSA9IFtdO1xuICB2YXIgbWF0Y2g7XG5cbiAgLy8gSXRlcmF0ZSBhbmQgY29sbGVjdCB0aGUgdmVyc2lvbiB0dXBsZXMuICBFYWNoIGl0ZXJhdGlvbiB3aWxsIGJlIHRoZVxuICAvLyBuZXh0IHJlZ2V4IG1hdGNoLlxuICB3aGlsZSAobWF0Y2ggPSB2ZXJzaW9uUmVnRXhwLmV4ZWModXNlckFnZW50KSkge1xuICAgIGRhdGEucHVzaChbXG4gICAgICBtYXRjaFsxXSwgIC8vIGtleVxuICAgICAgbWF0Y2hbMl0sICAvLyB2YWx1ZVxuICAgICAgLy8gfHwgdW5kZWZpbmVkIGFzIHRoaXMgaXMgbm90IHVuZGVmaW5lZCBpbiBJRTcgYW5kIElFOFxuICAgICAgbWF0Y2hbM10gfHwgdW5kZWZpbmVkICAvLyBpbmZvXG4gICAgXSk7XG4gIH1cblxuICByZXR1cm4gZGF0YTtcbn07XG4iLCAiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IFRoZSBDbG9zdXJlIExpYnJhcnkgQXV0aG9ycy5cbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBAZmlsZW92ZXJ2aWV3IFV0aWxpdGllcyBmb3IgbWFuaXB1bGF0aW5nIG9iamVjdHMvbWFwcy9oYXNoZXMuXG4gKi9cblxuZ29vZy5wcm92aWRlKCdnb29nLm9iamVjdCcpO1xuXG5cbi8qKlxuICogQ2FsbHMgYSBmdW5jdGlvbiBmb3IgZWFjaCBlbGVtZW50IGluIGFuIG9iamVjdC9tYXAvaGFzaC5cbiAqXG4gKiBAcGFyYW0ge09iamVjdDxLLFY+fSBvYmogVGhlIG9iamVjdCBvdmVyIHdoaWNoIHRvIGl0ZXJhdGUuXG4gKiBAcGFyYW0ge2Z1bmN0aW9uKHRoaXM6VCxWLD8sT2JqZWN0PEssVj4pOj99IGYgVGhlIGZ1bmN0aW9uIHRvIGNhbGxcbiAqICAgICBmb3IgZXZlcnkgZWxlbWVudC4gVGhpcyBmdW5jdGlvbiB0YWtlcyAzIGFyZ3VtZW50cyAodGhlIHZhbHVlLCB0aGVcbiAqICAgICBrZXkgYW5kIHRoZSBvYmplY3QpIGFuZCB0aGUgcmV0dXJuIHZhbHVlIGlzIGlnbm9yZWQuXG4gKiBAcGFyYW0ge1Q9fSBvcHRfb2JqIFRoaXMgaXMgdXNlZCBhcyB0aGUgJ3RoaXMnIG9iamVjdCB3aXRoaW4gZi5cbiAqIEByZXR1cm4ge3ZvaWR9XG4gKiBAdGVtcGxhdGUgVCxLLFZcbiAqL1xuZ29vZy5vYmplY3QuZm9yRWFjaCA9IGZ1bmN0aW9uKG9iaiwgZiwgb3B0X29iaikge1xuICAndXNlIHN0cmljdCc7XG4gIGZvciAoY29uc3Qga2V5IGluIG9iaikge1xuICAgIGYuY2FsbCgvKiogQHR5cGUgez99ICovIChvcHRfb2JqKSwgb2JqW2tleV0sIGtleSwgb2JqKTtcbiAgfVxufTtcblxuXG4vKipcbiAqIENhbGxzIGEgZnVuY3Rpb24gZm9yIGVhY2ggZWxlbWVudCBpbiBhbiBvYmplY3QvbWFwL2hhc2guIElmIHRoYXQgY2FsbCByZXR1cm5zXG4gKiB0cnVlLCBhZGRzIHRoZSBlbGVtZW50IHRvIGEgbmV3IG9iamVjdC5cbiAqXG4gKiBAcGFyYW0ge09iamVjdDxLLFY+fSBvYmogVGhlIG9iamVjdCBvdmVyIHdoaWNoIHRvIGl0ZXJhdGUuXG4gKiBAcGFyYW0ge2Z1bmN0aW9uKHRoaXM6VCxWLD8sT2JqZWN0PEssVj4pOmJvb2xlYW59IGYgVGhlIGZ1bmN0aW9uIHRvIGNhbGxcbiAqICAgICBmb3IgZXZlcnkgZWxlbWVudC4gVGhpc1xuICogICAgIGZ1bmN0aW9uIHRha2VzIDMgYXJndW1lbnRzICh0aGUgdmFsdWUsIHRoZSBrZXkgYW5kIHRoZSBvYmplY3QpXG4gKiAgICAgYW5kIHNob3VsZCByZXR1cm4gYSBib29sZWFuLiBJZiB0aGUgcmV0dXJuIHZhbHVlIGlzIHRydWUgdGhlXG4gKiAgICAgZWxlbWVudCBpcyBhZGRlZCB0byB0aGUgcmVzdWx0IG9iamVjdC4gSWYgaXQgaXMgZmFsc2UgdGhlXG4gKiAgICAgZWxlbWVudCBpcyBub3QgaW5jbHVkZWQuXG4gKiBAcGFyYW0ge1Q9fSBvcHRfb2JqIFRoaXMgaXMgdXNlZCBhcyB0aGUgJ3RoaXMnIG9iamVjdCB3aXRoaW4gZi5cbiAqIEByZXR1cm4geyFPYmplY3Q8SyxWPn0gYSBuZXcgb2JqZWN0IGluIHdoaWNoIG9ubHkgZWxlbWVudHMgdGhhdCBwYXNzZWQgdGhlXG4gKiAgICAgdGVzdCBhcmUgcHJlc2VudC5cbiAqIEB0ZW1wbGF0ZSBULEssVlxuICovXG5nb29nLm9iamVjdC5maWx0ZXIgPSBmdW5jdGlvbihvYmosIGYsIG9wdF9vYmopIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBjb25zdCByZXMgPSB7fTtcbiAgZm9yIChjb25zdCBrZXkgaW4gb2JqKSB7XG4gICAgaWYgKGYuY2FsbCgvKiogQHR5cGUgez99ICovIChvcHRfb2JqKSwgb2JqW2tleV0sIGtleSwgb2JqKSkge1xuICAgICAgcmVzW2tleV0gPSBvYmpba2V5XTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHJlcztcbn07XG5cblxuLyoqXG4gKiBGb3IgZXZlcnkgZWxlbWVudCBpbiBhbiBvYmplY3QvbWFwL2hhc2ggY2FsbHMgYSBmdW5jdGlvbiBhbmQgaW5zZXJ0cyB0aGVcbiAqIHJlc3VsdCBpbnRvIGEgbmV3IG9iamVjdC5cbiAqXG4gKiBAcGFyYW0ge09iamVjdDxLLFY+fSBvYmogVGhlIG9iamVjdCBvdmVyIHdoaWNoIHRvIGl0ZXJhdGUuXG4gKiBAcGFyYW0ge2Z1bmN0aW9uKHRoaXM6VCxWLD8sT2JqZWN0PEssVj4pOlJ9IGYgVGhlIGZ1bmN0aW9uIHRvIGNhbGxcbiAqICAgICBmb3IgZXZlcnkgZWxlbWVudC4gVGhpcyBmdW5jdGlvblxuICogICAgIHRha2VzIDMgYXJndW1lbnRzICh0aGUgdmFsdWUsIHRoZSBrZXkgYW5kIHRoZSBvYmplY3QpXG4gKiAgICAgYW5kIHNob3VsZCByZXR1cm4gc29tZXRoaW5nLiBUaGUgcmVzdWx0IHdpbGwgYmUgaW5zZXJ0ZWRcbiAqICAgICBpbnRvIGEgbmV3IG9iamVjdC5cbiAqIEBwYXJhbSB7VD19IG9wdF9vYmogVGhpcyBpcyB1c2VkIGFzIHRoZSAndGhpcycgb2JqZWN0IHdpdGhpbiBmLlxuICogQHJldHVybiB7IU9iamVjdDxLLFI+fSBhIG5ldyBvYmplY3Qgd2l0aCB0aGUgcmVzdWx0cyBmcm9tIGYuXG4gKiBAdGVtcGxhdGUgVCxLLFYsUlxuICovXG5nb29nLm9iamVjdC5tYXAgPSBmdW5jdGlvbihvYmosIGYsIG9wdF9vYmopIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBjb25zdCByZXMgPSB7fTtcbiAgZm9yIChjb25zdCBrZXkgaW4gb2JqKSB7XG4gICAgcmVzW2tleV0gPSBmLmNhbGwoLyoqIEB0eXBlIHs/fSAqLyAob3B0X29iaiksIG9ialtrZXldLCBrZXksIG9iaik7XG4gIH1cbiAgcmV0dXJuIHJlcztcbn07XG5cblxuLyoqXG4gKiBDYWxscyBhIGZ1bmN0aW9uIGZvciBlYWNoIGVsZW1lbnQgaW4gYW4gb2JqZWN0L21hcC9oYXNoLiBJZiBhbnlcbiAqIGNhbGwgcmV0dXJucyB0cnVlLCByZXR1cm5zIHRydWUgKHdpdGhvdXQgY2hlY2tpbmcgdGhlIHJlc3QpLiBJZlxuICogYWxsIGNhbGxzIHJldHVybiBmYWxzZSwgcmV0dXJucyBmYWxzZS5cbiAqXG4gKiBAcGFyYW0ge09iamVjdDxLLFY+fSBvYmogVGhlIG9iamVjdCB0byBjaGVjay5cbiAqIEBwYXJhbSB7ZnVuY3Rpb24odGhpczpULFYsPyxPYmplY3Q8SyxWPik6Ym9vbGVhbn0gZiBUaGUgZnVuY3Rpb24gdG9cbiAqICAgICBjYWxsIGZvciBldmVyeSBlbGVtZW50LiBUaGlzIGZ1bmN0aW9uXG4gKiAgICAgdGFrZXMgMyBhcmd1bWVudHMgKHRoZSB2YWx1ZSwgdGhlIGtleSBhbmQgdGhlIG9iamVjdCkgYW5kIHNob3VsZFxuICogICAgIHJldHVybiBhIGJvb2xlYW4uXG4gKiBAcGFyYW0ge1Q9fSBvcHRfb2JqIFRoaXMgaXMgdXNlZCBhcyB0aGUgJ3RoaXMnIG9iamVjdCB3aXRoaW4gZi5cbiAqIEByZXR1cm4ge2Jvb2xlYW59IHRydWUgaWYgYW55IGVsZW1lbnQgcGFzc2VzIHRoZSB0ZXN0LlxuICogQHRlbXBsYXRlIFQsSyxWXG4gKi9cbmdvb2cub2JqZWN0LnNvbWUgPSBmdW5jdGlvbihvYmosIGYsIG9wdF9vYmopIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBmb3IgKGNvbnN0IGtleSBpbiBvYmopIHtcbiAgICBpZiAoZi5jYWxsKC8qKiBAdHlwZSB7P30gKi8gKG9wdF9vYmopLCBvYmpba2V5XSwga2V5LCBvYmopKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGZhbHNlO1xufTtcblxuXG4vKipcbiAqIENhbGxzIGEgZnVuY3Rpb24gZm9yIGVhY2ggZWxlbWVudCBpbiBhbiBvYmplY3QvbWFwL2hhc2guIElmXG4gKiBhbGwgY2FsbHMgcmV0dXJuIHRydWUsIHJldHVybnMgdHJ1ZS4gSWYgYW55IGNhbGwgcmV0dXJucyBmYWxzZSwgcmV0dXJuc1xuICogZmFsc2UgYXQgdGhpcyBwb2ludCBhbmQgZG9lcyBub3QgY29udGludWUgdG8gY2hlY2sgdGhlIHJlbWFpbmluZyBlbGVtZW50cy5cbiAqXG4gKiBAcGFyYW0ge09iamVjdDxLLFY+fSBvYmogVGhlIG9iamVjdCB0byBjaGVjay5cbiAqIEBwYXJhbSB7P2Z1bmN0aW9uKHRoaXM6VCxWLD8sT2JqZWN0PEssVj4pOmJvb2xlYW59IGYgVGhlIGZ1bmN0aW9uIHRvXG4gKiAgICAgY2FsbCBmb3IgZXZlcnkgZWxlbWVudC4gVGhpcyBmdW5jdGlvblxuICogICAgIHRha2VzIDMgYXJndW1lbnRzICh0aGUgdmFsdWUsIHRoZSBrZXkgYW5kIHRoZSBvYmplY3QpIGFuZCBzaG91bGRcbiAqICAgICByZXR1cm4gYSBib29sZWFuLlxuICogQHBhcmFtIHtUPX0gb3B0X29iaiBUaGlzIGlzIHVzZWQgYXMgdGhlICd0aGlzJyBvYmplY3Qgd2l0aGluIGYuXG4gKiBAcmV0dXJuIHtib29sZWFufSBmYWxzZSBpZiBhbnkgZWxlbWVudCBmYWlscyB0aGUgdGVzdC5cbiAqIEB0ZW1wbGF0ZSBULEssVlxuICovXG5nb29nLm9iamVjdC5ldmVyeSA9IGZ1bmN0aW9uKG9iaiwgZiwgb3B0X29iaikge1xuICAndXNlIHN0cmljdCc7XG4gIGZvciAoY29uc3Qga2V5IGluIG9iaikge1xuICAgIGlmICghZi5jYWxsKC8qKiBAdHlwZSB7P30gKi8gKG9wdF9vYmopLCBvYmpba2V5XSwga2V5LCBvYmopKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG4gIHJldHVybiB0cnVlO1xufTtcblxuXG4vKipcbiAqIFJldHVybnMgdGhlIG51bWJlciBvZiBrZXktdmFsdWUgcGFpcnMgaW4gdGhlIG9iamVjdCBtYXAuXG4gKlxuICogQHBhcmFtIHtPYmplY3R9IG9iaiBUaGUgb2JqZWN0IGZvciB3aGljaCB0byBnZXQgdGhlIG51bWJlciBvZiBrZXktdmFsdWVcbiAqICAgICBwYWlycy5cbiAqIEByZXR1cm4ge251bWJlcn0gVGhlIG51bWJlciBvZiBrZXktdmFsdWUgcGFpcnMgaW4gdGhlIG9iamVjdCBtYXAuXG4gKi9cbmdvb2cub2JqZWN0LmdldENvdW50ID0gZnVuY3Rpb24ob2JqKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgbGV0IHJ2ID0gMDtcbiAgZm9yIChjb25zdCBrZXkgaW4gb2JqKSB7XG4gICAgcnYrKztcbiAgfVxuICByZXR1cm4gcnY7XG59O1xuXG5cbi8qKlxuICogUmV0dXJucyBvbmUga2V5IGZyb20gdGhlIG9iamVjdCBtYXAsIGlmIGFueSBleGlzdHMuXG4gKiBGb3IgbWFwIGxpdGVyYWxzIHRoZSByZXR1cm5lZCBrZXkgd2lsbCBiZSB0aGUgZmlyc3Qgb25lIGluIG1vc3Qgb2YgdGhlXG4gKiBicm93c2VycyAoYSBrbm93IGV4Y2VwdGlvbiBpcyBLb25xdWVyb3IpLlxuICpcbiAqIEBwYXJhbSB7T2JqZWN0fSBvYmogVGhlIG9iamVjdCB0byBwaWNrIGEga2V5IGZyb20uXG4gKiBAcmV0dXJuIHtzdHJpbmd8dW5kZWZpbmVkfSBUaGUga2V5IG9yIHVuZGVmaW5lZCBpZiB0aGUgb2JqZWN0IGlzIGVtcHR5LlxuICovXG5nb29nLm9iamVjdC5nZXRBbnlLZXkgPSBmdW5jdGlvbihvYmopIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBmb3IgKGNvbnN0IGtleSBpbiBvYmopIHtcbiAgICByZXR1cm4ga2V5O1xuICB9XG59O1xuXG5cbi8qKlxuICogUmV0dXJucyBvbmUgdmFsdWUgZnJvbSB0aGUgb2JqZWN0IG1hcCwgaWYgYW55IGV4aXN0cy5cbiAqIEZvciBtYXAgbGl0ZXJhbHMgdGhlIHJldHVybmVkIHZhbHVlIHdpbGwgYmUgdGhlIGZpcnN0IG9uZSBpbiBtb3N0IG9mIHRoZVxuICogYnJvd3NlcnMgKGEga25vdyBleGNlcHRpb24gaXMgS29ucXVlcm9yKS5cbiAqXG4gKiBAcGFyYW0ge09iamVjdDxLLFY+fSBvYmogVGhlIG9iamVjdCB0byBwaWNrIGEgdmFsdWUgZnJvbS5cbiAqIEByZXR1cm4ge1Z8dW5kZWZpbmVkfSBUaGUgdmFsdWUgb3IgdW5kZWZpbmVkIGlmIHRoZSBvYmplY3QgaXMgZW1wdHkuXG4gKiBAdGVtcGxhdGUgSyxWXG4gKi9cbmdvb2cub2JqZWN0LmdldEFueVZhbHVlID0gZnVuY3Rpb24ob2JqKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgZm9yIChjb25zdCBrZXkgaW4gb2JqKSB7XG4gICAgcmV0dXJuIG9ialtrZXldO1xuICB9XG59O1xuXG5cbi8qKlxuICogV2hldGhlciB0aGUgb2JqZWN0L2hhc2gvbWFwIGNvbnRhaW5zIHRoZSBnaXZlbiBvYmplY3QgYXMgYSB2YWx1ZS5cbiAqIEFuIGFsaWFzIGZvciBnb29nLm9iamVjdC5jb250YWluc1ZhbHVlKG9iaiwgdmFsKS5cbiAqXG4gKiBAcGFyYW0ge09iamVjdDxLLFY+fSBvYmogVGhlIG9iamVjdCBpbiB3aGljaCB0byBsb29rIGZvciB2YWwuXG4gKiBAcGFyYW0ge1Z9IHZhbCBUaGUgb2JqZWN0IGZvciB3aGljaCB0byBjaGVjay5cbiAqIEByZXR1cm4ge2Jvb2xlYW59IHRydWUgaWYgdmFsIGlzIHByZXNlbnQuXG4gKiBAdGVtcGxhdGUgSyxWXG4gKi9cbmdvb2cub2JqZWN0LmNvbnRhaW5zID0gZnVuY3Rpb24ob2JqLCB2YWwpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gZ29vZy5vYmplY3QuY29udGFpbnNWYWx1ZShvYmosIHZhbCk7XG59O1xuXG5cbi8qKlxuICogUmV0dXJucyB0aGUgdmFsdWVzIG9mIHRoZSBvYmplY3QvbWFwL2hhc2guXG4gKlxuICogQHBhcmFtIHtPYmplY3Q8SyxWPn0gb2JqIFRoZSBvYmplY3QgZnJvbSB3aGljaCB0byBnZXQgdGhlIHZhbHVlcy5cbiAqIEByZXR1cm4geyFBcnJheTxWPn0gVGhlIHZhbHVlcyBpbiB0aGUgb2JqZWN0L21hcC9oYXNoLlxuICogQHRlbXBsYXRlIEssVlxuICovXG5nb29nLm9iamVjdC5nZXRWYWx1ZXMgPSBmdW5jdGlvbihvYmopIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBjb25zdCByZXMgPSBbXTtcbiAgbGV0IGkgPSAwO1xuICBmb3IgKGNvbnN0IGtleSBpbiBvYmopIHtcbiAgICByZXNbaSsrXSA9IG9ialtrZXldO1xuICB9XG4gIHJldHVybiByZXM7XG59O1xuXG5cbi8qKlxuICogUmV0dXJucyB0aGUga2V5cyBvZiB0aGUgb2JqZWN0L21hcC9oYXNoLlxuICpcbiAqIEBwYXJhbSB7T2JqZWN0fSBvYmogVGhlIG9iamVjdCBmcm9tIHdoaWNoIHRvIGdldCB0aGUga2V5cy5cbiAqIEByZXR1cm4geyFBcnJheTxzdHJpbmc+fSBBcnJheSBvZiBwcm9wZXJ0eSBrZXlzLlxuICovXG5nb29nLm9iamVjdC5nZXRLZXlzID0gZnVuY3Rpb24ob2JqKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgY29uc3QgcmVzID0gW107XG4gIGxldCBpID0gMDtcbiAgZm9yIChjb25zdCBrZXkgaW4gb2JqKSB7XG4gICAgcmVzW2krK10gPSBrZXk7XG4gIH1cbiAgcmV0dXJuIHJlcztcbn07XG5cblxuLyoqXG4gKiBHZXQgYSB2YWx1ZSBmcm9tIGFuIG9iamVjdCBtdWx0aXBsZSBsZXZlbHMgZGVlcC4gIFRoaXMgaXMgdXNlZnVsIGZvclxuICogcHVsbGluZyB2YWx1ZXMgZnJvbSBkZWVwbHkgbmVzdGVkIG9iamVjdHMsIHN1Y2ggYXMgSlNPTiByZXNwb25zZXMuXG4gKiBFeGFtcGxlIHVzYWdlOiBnZXRWYWx1ZUJ5S2V5cyhqc29uT2JqLCAnZm9vJywgJ2VudHJpZXMnLCAzKVxuICpcbiAqIEBwYXJhbSB7IU9iamVjdH0gb2JqIEFuIG9iamVjdCB0byBnZXQgdGhlIHZhbHVlIGZyb20uICBDYW4gYmUgYXJyYXktbGlrZS5cbiAqIEBwYXJhbSB7Li4uKHN0cmluZ3xudW1iZXJ8IUlBcnJheUxpa2U8bnVtYmVyfHN0cmluZz4pfVxuICogICAgIHZhcl9hcmdzIEEgbnVtYmVyIG9mIGtleXNcbiAqICAgICAoYXMgc3RyaW5ncywgb3IgbnVtYmVycywgZm9yIGFycmF5LWxpa2Ugb2JqZWN0cykuICBDYW4gYWxzbyBiZVxuICogICAgIHNwZWNpZmllZCBhcyBhIHNpbmdsZSBhcnJheSBvZiBrZXlzLlxuICogQHJldHVybiB7Kn0gVGhlIHJlc3VsdGluZyB2YWx1ZS4gIElmLCBhdCBhbnkgcG9pbnQsIHRoZSB2YWx1ZSBmb3IgYSBrZXlcbiAqICAgICBpbiB0aGUgY3VycmVudCBvYmplY3QgaXMgbnVsbCBvciB1bmRlZmluZWQsIHJldHVybnMgdW5kZWZpbmVkLlxuICovXG5nb29nLm9iamVjdC5nZXRWYWx1ZUJ5S2V5cyA9IGZ1bmN0aW9uKG9iaiwgdmFyX2FyZ3MpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBjb25zdCBpc0FycmF5TGlrZSA9IGdvb2cuaXNBcnJheUxpa2UodmFyX2FyZ3MpO1xuICBjb25zdCBrZXlzID0gaXNBcnJheUxpa2UgP1xuICAgICAgLyoqIEB0eXBlIHshSUFycmF5TGlrZTxudW1iZXJ8c3RyaW5nPn0gKi8gKHZhcl9hcmdzKSA6XG4gICAgICBhcmd1bWVudHM7XG5cbiAgLy8gU3RhcnQgd2l0aCB0aGUgMm5kIHBhcmFtZXRlciBmb3IgdGhlIHZhcmlhYmxlIHBhcmFtZXRlcnMgc3ludGF4LlxuICBmb3IgKGxldCBpID0gaXNBcnJheUxpa2UgPyAwIDogMTsgaSA8IGtleXMubGVuZ3RoOyBpKyspIHtcbiAgICBpZiAob2JqID09IG51bGwpIHJldHVybiB1bmRlZmluZWQ7XG4gICAgb2JqID0gb2JqW2tleXNbaV1dO1xuICB9XG5cbiAgcmV0dXJuIG9iajtcbn07XG5cblxuLyoqXG4gKiBXaGV0aGVyIHRoZSBvYmplY3QvbWFwL2hhc2ggY29udGFpbnMgdGhlIGdpdmVuIGtleS5cbiAqXG4gKiBAcGFyYW0ge09iamVjdH0gb2JqIFRoZSBvYmplY3QgaW4gd2hpY2ggdG8gbG9vayBmb3Iga2V5LlxuICogQHBhcmFtIHs/fSBrZXkgVGhlIGtleSBmb3Igd2hpY2ggdG8gY2hlY2suXG4gKiBAcmV0dXJuIHtib29sZWFufSB0cnVlIElmIHRoZSBtYXAgY29udGFpbnMgdGhlIGtleS5cbiAqL1xuZ29vZy5vYmplY3QuY29udGFpbnNLZXkgPSBmdW5jdGlvbihvYmosIGtleSkge1xuICAndXNlIHN0cmljdCc7XG4gIHJldHVybiBvYmogIT09IG51bGwgJiYga2V5IGluIG9iajtcbn07XG5cblxuLyoqXG4gKiBXaGV0aGVyIHRoZSBvYmplY3QvbWFwL2hhc2ggY29udGFpbnMgdGhlIGdpdmVuIHZhbHVlLiBUaGlzIGlzIE8obikuXG4gKlxuICogQHBhcmFtIHtPYmplY3Q8SyxWPn0gb2JqIFRoZSBvYmplY3QgaW4gd2hpY2ggdG8gbG9vayBmb3IgdmFsLlxuICogQHBhcmFtIHtWfSB2YWwgVGhlIHZhbHVlIGZvciB3aGljaCB0byBjaGVjay5cbiAqIEByZXR1cm4ge2Jvb2xlYW59IHRydWUgSWYgdGhlIG1hcCBjb250YWlucyB0aGUgdmFsdWUuXG4gKiBAdGVtcGxhdGUgSyxWXG4gKi9cbmdvb2cub2JqZWN0LmNvbnRhaW5zVmFsdWUgPSBmdW5jdGlvbihvYmosIHZhbCkge1xuICAndXNlIHN0cmljdCc7XG4gIGZvciAoY29uc3Qga2V5IGluIG9iaikge1xuICAgIGlmIChvYmpba2V5XSA9PSB2YWwpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgfVxuICByZXR1cm4gZmFsc2U7XG59O1xuXG5cbi8qKlxuICogU2VhcmNoZXMgYW4gb2JqZWN0IGZvciBhbiBlbGVtZW50IHRoYXQgc2F0aXNmaWVzIHRoZSBnaXZlbiBjb25kaXRpb24gYW5kXG4gKiByZXR1cm5zIGl0cyBrZXkuXG4gKiBAcGFyYW0ge09iamVjdDxLLFY+fSBvYmogVGhlIG9iamVjdCB0byBzZWFyY2ggaW4uXG4gKiBAcGFyYW0ge2Z1bmN0aW9uKHRoaXM6VCxWLHN0cmluZyxPYmplY3Q8SyxWPik6Ym9vbGVhbn0gZiBUaGVcbiAqICAgICAgZnVuY3Rpb24gdG8gY2FsbCBmb3IgZXZlcnkgZWxlbWVudC4gVGFrZXMgMyBhcmd1bWVudHMgKHRoZSB2YWx1ZSxcbiAqICAgICB0aGUga2V5IGFuZCB0aGUgb2JqZWN0KSBhbmQgc2hvdWxkIHJldHVybiBhIGJvb2xlYW4uXG4gKiBAcGFyYW0ge1Q9fSBvcHRfdGhpcyBBbiBvcHRpb25hbCBcInRoaXNcIiBjb250ZXh0IGZvciB0aGUgZnVuY3Rpb24uXG4gKiBAcmV0dXJuIHtzdHJpbmd8dW5kZWZpbmVkfSBUaGUga2V5IG9mIGFuIGVsZW1lbnQgZm9yIHdoaWNoIHRoZSBmdW5jdGlvblxuICogICAgIHJldHVybnMgdHJ1ZSBvciB1bmRlZmluZWQgaWYgbm8gc3VjaCBlbGVtZW50IGlzIGZvdW5kLlxuICogQHRlbXBsYXRlIFQsSyxWXG4gKi9cbmdvb2cub2JqZWN0LmZpbmRLZXkgPSBmdW5jdGlvbihvYmosIGYsIG9wdF90aGlzKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgZm9yIChjb25zdCBrZXkgaW4gb2JqKSB7XG4gICAgaWYgKGYuY2FsbCgvKiogQHR5cGUgez99ICovIChvcHRfdGhpcyksIG9ialtrZXldLCBrZXksIG9iaikpIHtcbiAgICAgIHJldHVybiBrZXk7XG4gICAgfVxuICB9XG4gIHJldHVybiB1bmRlZmluZWQ7XG59O1xuXG5cbi8qKlxuICogU2VhcmNoZXMgYW4gb2JqZWN0IGZvciBhbiBlbGVtZW50IHRoYXQgc2F0aXNmaWVzIHRoZSBnaXZlbiBjb25kaXRpb24gYW5kXG4gKiByZXR1cm5zIGl0cyB2YWx1ZS5cbiAqIEBwYXJhbSB7T2JqZWN0PEssVj59IG9iaiBUaGUgb2JqZWN0IHRvIHNlYXJjaCBpbi5cbiAqIEBwYXJhbSB7ZnVuY3Rpb24odGhpczpULFYsc3RyaW5nLE9iamVjdDxLLFY+KTpib29sZWFufSBmIFRoZSBmdW5jdGlvblxuICogICAgIHRvIGNhbGwgZm9yIGV2ZXJ5IGVsZW1lbnQuIFRha2VzIDMgYXJndW1lbnRzICh0aGUgdmFsdWUsIHRoZSBrZXlcbiAqICAgICBhbmQgdGhlIG9iamVjdCkgYW5kIHNob3VsZCByZXR1cm4gYSBib29sZWFuLlxuICogQHBhcmFtIHtUPX0gb3B0X3RoaXMgQW4gb3B0aW9uYWwgXCJ0aGlzXCIgY29udGV4dCBmb3IgdGhlIGZ1bmN0aW9uLlxuICogQHJldHVybiB7Vn0gVGhlIHZhbHVlIG9mIGFuIGVsZW1lbnQgZm9yIHdoaWNoIHRoZSBmdW5jdGlvbiByZXR1cm5zIHRydWUgb3JcbiAqICAgICB1bmRlZmluZWQgaWYgbm8gc3VjaCBlbGVtZW50IGlzIGZvdW5kLlxuICogQHRlbXBsYXRlIFQsSyxWXG4gKi9cbmdvb2cub2JqZWN0LmZpbmRWYWx1ZSA9IGZ1bmN0aW9uKG9iaiwgZiwgb3B0X3RoaXMpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBjb25zdCBrZXkgPSBnb29nLm9iamVjdC5maW5kS2V5KG9iaiwgZiwgb3B0X3RoaXMpO1xuICByZXR1cm4ga2V5ICYmIG9ialtrZXldO1xufTtcblxuXG4vKipcbiAqIFdoZXRoZXIgdGhlIG9iamVjdC9tYXAvaGFzaCBpcyBlbXB0eS5cbiAqXG4gKiBAcGFyYW0ge09iamVjdH0gb2JqIFRoZSBvYmplY3QgdG8gdGVzdC5cbiAqIEByZXR1cm4ge2Jvb2xlYW59IHRydWUgaWYgb2JqIGlzIGVtcHR5LlxuICovXG5nb29nLm9iamVjdC5pc0VtcHR5ID0gZnVuY3Rpb24ob2JqKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgZm9yIChjb25zdCBrZXkgaW4gb2JqKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIHJldHVybiB0cnVlO1xufTtcblxuXG4vKipcbiAqIFJlbW92ZXMgYWxsIGtleSB2YWx1ZSBwYWlycyBmcm9tIHRoZSBvYmplY3QvbWFwL2hhc2guXG4gKlxuICogQHBhcmFtIHtPYmplY3R9IG9iaiBUaGUgb2JqZWN0IHRvIGNsZWFyLlxuICogQHJldHVybiB7dm9pZH1cbiAqL1xuZ29vZy5vYmplY3QuY2xlYXIgPSBmdW5jdGlvbihvYmopIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBmb3IgKGNvbnN0IGkgaW4gb2JqKSB7XG4gICAgZGVsZXRlIG9ialtpXTtcbiAgfVxufTtcblxuXG4vKipcbiAqIFJlbW92ZXMgYSBrZXktdmFsdWUgcGFpciBiYXNlZCBvbiB0aGUga2V5LlxuICpcbiAqIEBwYXJhbSB7T2JqZWN0fSBvYmogVGhlIG9iamVjdCBmcm9tIHdoaWNoIHRvIHJlbW92ZSB0aGUga2V5LlxuICogQHBhcmFtIHs/fSBrZXkgVGhlIGtleSB0byByZW1vdmUuXG4gKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIGFuIGVsZW1lbnQgd2FzIHJlbW92ZWQuXG4gKi9cbmdvb2cub2JqZWN0LnJlbW92ZSA9IGZ1bmN0aW9uKG9iaiwga2V5KSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgbGV0IHJ2O1xuICBpZiAocnYgPSBrZXkgaW4gLyoqIEB0eXBlIHshT2JqZWN0fSAqLyAob2JqKSkge1xuICAgIGRlbGV0ZSBvYmpba2V5XTtcbiAgfVxuICByZXR1cm4gcnY7XG59O1xuXG5cbi8qKlxuICogQWRkcyBhIGtleS12YWx1ZSBwYWlyIHRvIHRoZSBvYmplY3QuIFRocm93cyBhbiBleGNlcHRpb24gaWYgdGhlIGtleSBpc1xuICogYWxyZWFkeSBpbiB1c2UuIFVzZSBzZXQgaWYgeW91IHdhbnQgdG8gY2hhbmdlIGFuIGV4aXN0aW5nIHBhaXIuXG4gKlxuICogQHBhcmFtIHtPYmplY3Q8SyxWPn0gb2JqIFRoZSBvYmplY3QgdG8gd2hpY2ggdG8gYWRkIHRoZSBrZXktdmFsdWUgcGFpci5cbiAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIGtleSB0byBhZGQuXG4gKiBAcGFyYW0ge1Z9IHZhbCBUaGUgdmFsdWUgdG8gYWRkLlxuICogQHJldHVybiB7dm9pZH1cbiAqIEB0ZW1wbGF0ZSBLLFZcbiAqL1xuZ29vZy5vYmplY3QuYWRkID0gZnVuY3Rpb24ob2JqLCBrZXksIHZhbCkge1xuICAndXNlIHN0cmljdCc7XG4gIGlmIChvYmogIT09IG51bGwgJiYga2V5IGluIG9iaikge1xuICAgIHRocm93IG5ldyBFcnJvcignVGhlIG9iamVjdCBhbHJlYWR5IGNvbnRhaW5zIHRoZSBrZXkgXCInICsga2V5ICsgJ1wiJyk7XG4gIH1cbiAgZ29vZy5vYmplY3Quc2V0KG9iaiwga2V5LCB2YWwpO1xufTtcblxuXG4vKipcbiAqIFJldHVybnMgdGhlIHZhbHVlIGZvciB0aGUgZ2l2ZW4ga2V5LlxuICpcbiAqIEBwYXJhbSB7T2JqZWN0PEssVj59IG9iaiBUaGUgb2JqZWN0IGZyb20gd2hpY2ggdG8gZ2V0IHRoZSB2YWx1ZS5cbiAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIGtleSBmb3Igd2hpY2ggdG8gZ2V0IHRoZSB2YWx1ZS5cbiAqIEBwYXJhbSB7Uj19IG9wdF92YWwgVGhlIHZhbHVlIHRvIHJldHVybiBpZiBubyBpdGVtIGlzIGZvdW5kIGZvciB0aGUgZ2l2ZW5cbiAqICAgICBrZXkgKGRlZmF1bHQgaXMgdW5kZWZpbmVkKS5cbiAqIEByZXR1cm4ge1Z8Unx1bmRlZmluZWR9IFRoZSB2YWx1ZSBmb3IgdGhlIGdpdmVuIGtleS5cbiAqIEB0ZW1wbGF0ZSBLLFYsUlxuICovXG5nb29nLm9iamVjdC5nZXQgPSBmdW5jdGlvbihvYmosIGtleSwgb3B0X3ZhbCkge1xuICAndXNlIHN0cmljdCc7XG4gIGlmIChvYmogIT09IG51bGwgJiYga2V5IGluIG9iaikge1xuICAgIHJldHVybiBvYmpba2V5XTtcbiAgfVxuICByZXR1cm4gb3B0X3ZhbDtcbn07XG5cblxuLyoqXG4gKiBBZGRzIGEga2V5LXZhbHVlIHBhaXIgdG8gdGhlIG9iamVjdC9tYXAvaGFzaC5cbiAqXG4gKiBAcGFyYW0ge09iamVjdDxLLFY+fSBvYmogVGhlIG9iamVjdCB0byB3aGljaCB0byBhZGQgdGhlIGtleS12YWx1ZSBwYWlyLlxuICogQHBhcmFtIHtzdHJpbmd9IGtleSBUaGUga2V5IHRvIGFkZC5cbiAqIEBwYXJhbSB7Vn0gdmFsdWUgVGhlIHZhbHVlIHRvIGFkZC5cbiAqIEB0ZW1wbGF0ZSBLLFZcbiAqIEByZXR1cm4ge3ZvaWR9XG4gKi9cbmdvb2cub2JqZWN0LnNldCA9IGZ1bmN0aW9uKG9iaiwga2V5LCB2YWx1ZSkge1xuICAndXNlIHN0cmljdCc7XG4gIG9ialtrZXldID0gdmFsdWU7XG59O1xuXG5cbi8qKlxuICogQWRkcyBhIGtleS12YWx1ZSBwYWlyIHRvIHRoZSBvYmplY3QvbWFwL2hhc2ggaWYgaXQgZG9lc24ndCBleGlzdCB5ZXQuXG4gKlxuICogQHBhcmFtIHtPYmplY3Q8SyxWPn0gb2JqIFRoZSBvYmplY3QgdG8gd2hpY2ggdG8gYWRkIHRoZSBrZXktdmFsdWUgcGFpci5cbiAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIGtleSB0byBhZGQuXG4gKiBAcGFyYW0ge1Z9IHZhbHVlIFRoZSB2YWx1ZSB0byBhZGQgaWYgdGhlIGtleSB3YXNuJ3QgcHJlc2VudC5cbiAqIEByZXR1cm4ge1Z9IFRoZSB2YWx1ZSBvZiB0aGUgZW50cnkgYXQgdGhlIGVuZCBvZiB0aGUgZnVuY3Rpb24uXG4gKiBAdGVtcGxhdGUgSyxWXG4gKi9cbmdvb2cub2JqZWN0LnNldElmVW5kZWZpbmVkID0gZnVuY3Rpb24ob2JqLCBrZXksIHZhbHVlKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmV0dXJuIGtleSBpbiAvKiogQHR5cGUgeyFPYmplY3R9ICovIChvYmopID8gb2JqW2tleV0gOiAob2JqW2tleV0gPSB2YWx1ZSk7XG59O1xuXG5cbi8qKlxuICogU2V0cyBhIGtleSBhbmQgdmFsdWUgdG8gYW4gb2JqZWN0IGlmIHRoZSBrZXkgaXMgbm90IHNldC4gVGhlIHZhbHVlIHdpbGwgYmVcbiAqIHRoZSByZXR1cm4gdmFsdWUgb2YgdGhlIGdpdmVuIGZ1bmN0aW9uLiBJZiB0aGUga2V5IGFscmVhZHkgZXhpc3RzLCB0aGVcbiAqIG9iamVjdCB3aWxsIG5vdCBiZSBjaGFuZ2VkIGFuZCB0aGUgZnVuY3Rpb24gd2lsbCBub3QgYmUgY2FsbGVkICh0aGUgZnVuY3Rpb25cbiAqIHdpbGwgYmUgbGF6aWx5IGV2YWx1YXRlZCAtLSBvbmx5IGNhbGxlZCBpZiBuZWNlc3NhcnkpLlxuICpcbiAqIFRoaXMgZnVuY3Rpb24gaXMgcGFydGljdWxhcmx5IHVzZWZ1bCB3aGVuIHVzZWQgd2l0aCBhbiBgT2JqZWN0YCB3aGljaCBpc1xuICogYWN0aW5nIGFzIGEgY2FjaGUuXG4gKlxuICogQHBhcmFtIHshT2JqZWN0PEssVj59IG9iaiBUaGUgb2JqZWN0IHRvIHdoaWNoIHRvIGFkZCB0aGUga2V5LXZhbHVlIHBhaXIuXG4gKiBAcGFyYW0ge3N0cmluZ30ga2V5IFRoZSBrZXkgdG8gYWRkLlxuICogQHBhcmFtIHtmdW5jdGlvbigpOlZ9IGYgVGhlIHZhbHVlIHRvIGFkZCBpZiB0aGUga2V5IHdhc24ndCBwcmVzZW50LlxuICogQHJldHVybiB7Vn0gVGhlIHZhbHVlIG9mIHRoZSBlbnRyeSBhdCB0aGUgZW5kIG9mIHRoZSBmdW5jdGlvbi5cbiAqIEB0ZW1wbGF0ZSBLLFZcbiAqL1xuZ29vZy5vYmplY3Quc2V0V2l0aFJldHVyblZhbHVlSWZOb3RTZXQgPSBmdW5jdGlvbihvYmosIGtleSwgZikge1xuICAndXNlIHN0cmljdCc7XG4gIGlmIChrZXkgaW4gb2JqKSB7XG4gICAgcmV0dXJuIG9ialtrZXldO1xuICB9XG5cbiAgY29uc3QgdmFsID0gZigpO1xuICBvYmpba2V5XSA9IHZhbDtcbiAgcmV0dXJuIHZhbDtcbn07XG5cblxuLyoqXG4gKiBDb21wYXJlcyB0d28gb2JqZWN0cyBmb3IgZXF1YWxpdHkgdXNpbmcgPT09IG9uIHRoZSB2YWx1ZXMuXG4gKlxuICogQHBhcmFtIHshT2JqZWN0PEssVj59IGFcbiAqIEBwYXJhbSB7IU9iamVjdDxLLFY+fSBiXG4gKiBAcmV0dXJuIHtib29sZWFufVxuICogQHRlbXBsYXRlIEssVlxuICovXG5nb29nLm9iamVjdC5lcXVhbHMgPSBmdW5jdGlvbihhLCBiKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgZm9yIChjb25zdCBrIGluIGEpIHtcbiAgICBpZiAoIShrIGluIGIpIHx8IGFba10gIT09IGJba10pIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cbiAgZm9yIChjb25zdCBrIGluIGIpIHtcbiAgICBpZiAoIShrIGluIGEpKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG4gIHJldHVybiB0cnVlO1xufTtcblxuXG4vKipcbiAqIFJldHVybnMgYSBzaGFsbG93IGNsb25lIG9mIHRoZSBvYmplY3QuXG4gKlxuICogQHBhcmFtIHtPYmplY3Q8SyxWPn0gb2JqIE9iamVjdCB0byBjbG9uZS5cbiAqIEByZXR1cm4geyFPYmplY3Q8SyxWPn0gQ2xvbmUgb2YgdGhlIGlucHV0IG9iamVjdC5cbiAqIEB0ZW1wbGF0ZSBLLFZcbiAqL1xuZ29vZy5vYmplY3QuY2xvbmUgPSBmdW5jdGlvbihvYmopIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBjb25zdCByZXMgPSB7fTtcbiAgZm9yIChjb25zdCBrZXkgaW4gb2JqKSB7XG4gICAgcmVzW2tleV0gPSBvYmpba2V5XTtcbiAgfVxuICByZXR1cm4gcmVzO1xufTtcblxuXG4vKipcbiAqIENsb25lcyBhIHZhbHVlLiBUaGUgaW5wdXQgbWF5IGJlIGFuIE9iamVjdCwgQXJyYXksIG9yIGJhc2ljIHR5cGUuIE9iamVjdHMgYW5kXG4gKiBhcnJheXMgd2lsbCBiZSBjbG9uZWQgcmVjdXJzaXZlbHkuXG4gKlxuICogV0FSTklOR1M6XG4gKiA8Y29kZT5nb29nLm9iamVjdC51bnNhZmVDbG9uZTwvY29kZT4gZG9lcyBub3QgZGV0ZWN0IHJlZmVyZW5jZSBsb29wcy4gT2JqZWN0c1xuICogdGhhdCByZWZlciB0byB0aGVtc2VsdmVzIHdpbGwgY2F1c2UgaW5maW5pdGUgcmVjdXJzaW9uLlxuICpcbiAqIDxjb2RlPmdvb2cub2JqZWN0LnVuc2FmZUNsb25lPC9jb2RlPiBpcyB1bmF3YXJlIG9mIHVuaXF1ZSBpZGVudGlmaWVycywgYW5kXG4gKiBjb3BpZXMgVUlEcyBjcmVhdGVkIGJ5IDxjb2RlPmdldFVpZDwvY29kZT4gaW50byBjbG9uZWQgcmVzdWx0cy5cbiAqXG4gKiBAcGFyYW0ge1R9IG9iaiBUaGUgdmFsdWUgdG8gY2xvbmUuXG4gKiBAcmV0dXJuIHtUfSBBIGNsb25lIG9mIHRoZSBpbnB1dCB2YWx1ZS5cbiAqIEB0ZW1wbGF0ZSBUXG4gKi9cbmdvb2cub2JqZWN0LnVuc2FmZUNsb25lID0gZnVuY3Rpb24ob2JqKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgaWYgKCFvYmogfHwgdHlwZW9mIG9iaiAhPT0gJ29iamVjdCcpIHJldHVybiBvYmo7XG4gIGlmICh0eXBlb2Ygb2JqLmNsb25lID09PSAnZnVuY3Rpb24nKSByZXR1cm4gb2JqLmNsb25lKCk7XG4gIGNvbnN0IGNsb25lID0gQXJyYXkuaXNBcnJheShvYmopID8gW10gOlxuICAgICAgdHlwZW9mIEFycmF5QnVmZmVyID09PSAnZnVuY3Rpb24nICYmXG4gICAgICAgICAgdHlwZW9mIEFycmF5QnVmZmVyLmlzVmlldyA9PT0gJ2Z1bmN0aW9uJyAmJiBBcnJheUJ1ZmZlci5pc1ZpZXcob2JqKSAmJlxuICAgICAgICAgICEob2JqIGluc3RhbmNlb2YgRGF0YVZpZXcpID9cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgb2JqLmNvbnN0cnVjdG9yKG9iai5sZW5ndGgpIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7fTtcbiAgZm9yIChjb25zdCBrZXkgaW4gb2JqKSB7XG4gICAgY2xvbmVba2V5XSA9IGdvb2cub2JqZWN0LnVuc2FmZUNsb25lKG9ialtrZXldKTtcbiAgfVxuICByZXR1cm4gY2xvbmU7XG59O1xuXG5cbi8qKlxuICogUmV0dXJucyBhIG5ldyBvYmplY3QgaW4gd2hpY2ggYWxsIHRoZSBrZXlzIGFuZCB2YWx1ZXMgYXJlIGludGVyY2hhbmdlZFxuICogKGtleXMgYmVjb21lIHZhbHVlcyBhbmQgdmFsdWVzIGJlY29tZSBrZXlzKS4gSWYgbXVsdGlwbGUga2V5cyBtYXAgdG8gdGhlXG4gKiBzYW1lIHZhbHVlLCB0aGUgY2hvc2VuIHRyYW5zcG9zZWQgdmFsdWUgaXMgaW1wbGVtZW50YXRpb24tZGVwZW5kZW50LlxuICpcbiAqIEBwYXJhbSB7T2JqZWN0fSBvYmogVGhlIG9iamVjdCB0byB0cmFuc3Bvc2UuXG4gKiBAcmV0dXJuIHshT2JqZWN0fSBUaGUgdHJhbnNwb3NlZCBvYmplY3QuXG4gKi9cbmdvb2cub2JqZWN0LnRyYW5zcG9zZSA9IGZ1bmN0aW9uKG9iaikge1xuICAndXNlIHN0cmljdCc7XG4gIGNvbnN0IHRyYW5zcG9zZWQgPSB7fTtcbiAgZm9yIChjb25zdCBrZXkgaW4gb2JqKSB7XG4gICAgdHJhbnNwb3NlZFtvYmpba2V5XV0gPSBrZXk7XG4gIH1cbiAgcmV0dXJuIHRyYW5zcG9zZWQ7XG59O1xuXG5cbi8qKlxuICogVGhlIG5hbWVzIG9mIHRoZSBmaWVsZHMgdGhhdCBhcmUgZGVmaW5lZCBvbiBPYmplY3QucHJvdG90eXBlLlxuICogQHR5cGUge0FycmF5PHN0cmluZz59XG4gKiBAcHJpdmF0ZVxuICovXG5nb29nLm9iamVjdC5QUk9UT1RZUEVfRklFTERTXyA9IFtcbiAgJ2NvbnN0cnVjdG9yJywgJ2hhc093blByb3BlcnR5JywgJ2lzUHJvdG90eXBlT2YnLCAncHJvcGVydHlJc0VudW1lcmFibGUnLFxuICAndG9Mb2NhbGVTdHJpbmcnLCAndG9TdHJpbmcnLCAndmFsdWVPZidcbl07XG5cblxuLyoqXG4gKiBFeHRlbmRzIGFuIG9iamVjdCB3aXRoIGFub3RoZXIgb2JqZWN0LlxuICogVGhpcyBvcGVyYXRlcyAnaW4tcGxhY2UnOyBpdCBkb2VzIG5vdCBjcmVhdGUgYSBuZXcgT2JqZWN0LlxuICpcbiAqIEV4YW1wbGU6XG4gKiB2YXIgbyA9IHt9O1xuICogZ29vZy5vYmplY3QuZXh0ZW5kKG8sIHthOiAwLCBiOiAxfSk7XG4gKiBvOyAvLyB7YTogMCwgYjogMX1cbiAqIGdvb2cub2JqZWN0LmV4dGVuZChvLCB7YjogMiwgYzogM30pO1xuICogbzsgLy8ge2E6IDAsIGI6IDIsIGM6IDN9XG4gKlxuICogQHBhcmFtIHtPYmplY3R9IHRhcmdldCBUaGUgb2JqZWN0IHRvIG1vZGlmeS4gRXhpc3RpbmcgcHJvcGVydGllcyB3aWxsIGJlXG4gKiAgICAgb3ZlcndyaXR0ZW4gaWYgdGhleSBhcmUgYWxzbyBwcmVzZW50IGluIG9uZSBvZiB0aGUgb2JqZWN0cyBpblxuICogICAgIGB2YXJfYXJnc2AuXG4gKiBAcGFyYW0gey4uLihPYmplY3R8bnVsbHx1bmRlZmluZWQpfSB2YXJfYXJncyBUaGUgb2JqZWN0cyBmcm9tIHdoaWNoIHZhbHVlc1xuICogICAgIHdpbGwgYmUgY29waWVkLlxuICogQHJldHVybiB7dm9pZH1cbiAqIEBkZXByZWNhdGVkIFByZWZlciBPYmplY3QuYXNzaWduXG4gKi9cbmdvb2cub2JqZWN0LmV4dGVuZCA9IGZ1bmN0aW9uKHRhcmdldCwgdmFyX2FyZ3MpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBsZXQga2V5O1xuICBsZXQgc291cmNlO1xuICBmb3IgKGxldCBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykge1xuICAgIHNvdXJjZSA9IGFyZ3VtZW50c1tpXTtcbiAgICBmb3IgKGtleSBpbiBzb3VyY2UpIHtcbiAgICAgIHRhcmdldFtrZXldID0gc291cmNlW2tleV07XG4gICAgfVxuXG4gICAgLy8gRm9yIElFIHRoZSBmb3ItaW4tbG9vcCBkb2VzIG5vdCBjb250YWluIGFueSBwcm9wZXJ0aWVzIHRoYXQgYXJlIG5vdFxuICAgIC8vIGVudW1lcmFibGUgb24gdGhlIHByb3RvdHlwZSBvYmplY3QgKGZvciBleGFtcGxlIGlzUHJvdG90eXBlT2YgZnJvbVxuICAgIC8vIE9iamVjdC5wcm90b3R5cGUpIGFuZCBpdCB3aWxsIGFsc28gbm90IGluY2x1ZGUgJ3JlcGxhY2UnIG9uIG9iamVjdHMgdGhhdFxuICAgIC8vIGV4dGVuZCBTdHJpbmcgYW5kIGNoYW5nZSAncmVwbGFjZScgKG5vdCB0aGF0IGl0IGlzIGNvbW1vbiBmb3IgYW55b25lIHRvXG4gICAgLy8gZXh0ZW5kIGFueXRoaW5nIGV4Y2VwdCBPYmplY3QpLlxuXG4gICAgZm9yIChsZXQgaiA9IDA7IGogPCBnb29nLm9iamVjdC5QUk9UT1RZUEVfRklFTERTXy5sZW5ndGg7IGorKykge1xuICAgICAga2V5ID0gZ29vZy5vYmplY3QuUFJPVE9UWVBFX0ZJRUxEU19bal07XG4gICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHNvdXJjZSwga2V5KSkge1xuICAgICAgICB0YXJnZXRba2V5XSA9IHNvdXJjZVtrZXldO1xuICAgICAgfVxuICAgIH1cbiAgfVxufTtcblxuXG4vKipcbiAqIENyZWF0ZXMgYSBuZXcgb2JqZWN0IGJ1aWx0IGZyb20gdGhlIGtleS12YWx1ZSBwYWlycyBwcm92aWRlZCBhcyBhcmd1bWVudHMuXG4gKiBAcGFyYW0gey4uLip9IHZhcl9hcmdzIElmIG9ubHkgb25lIGFyZ3VtZW50IGlzIHByb3ZpZGVkIGFuZCBpdCBpcyBhbiBhcnJheVxuICogICAgIHRoZW4gdGhpcyBpcyB1c2VkIGFzIHRoZSBhcmd1bWVudHMsIG90aGVyd2lzZSBldmVuIGFyZ3VtZW50cyBhcmUgdXNlZCBhc1xuICogICAgIHRoZSBwcm9wZXJ0eSBuYW1lcyBhbmQgb2RkIGFyZ3VtZW50cyBhcmUgdXNlZCBhcyB0aGUgcHJvcGVydHkgdmFsdWVzLlxuICogQHJldHVybiB7IU9iamVjdH0gVGhlIG5ldyBvYmplY3QuXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlcmUgYXJlIHVuZXZlbiBudW1iZXIgb2YgYXJndW1lbnRzIG9yIHRoZXJlIGlzIG9ubHkgb25lXG4gKiAgICAgbm9uIGFycmF5IGFyZ3VtZW50LlxuICovXG5nb29nLm9iamVjdC5jcmVhdGUgPSBmdW5jdGlvbih2YXJfYXJncykge1xuICAndXNlIHN0cmljdCc7XG4gIGNvbnN0IGFyZ0xlbmd0aCA9IGFyZ3VtZW50cy5sZW5ndGg7XG4gIGlmIChhcmdMZW5ndGggPT0gMSAmJiBBcnJheS5pc0FycmF5KGFyZ3VtZW50c1swXSkpIHtcbiAgICByZXR1cm4gZ29vZy5vYmplY3QuY3JlYXRlLmFwcGx5KG51bGwsIGFyZ3VtZW50c1swXSk7XG4gIH1cblxuICBpZiAoYXJnTGVuZ3RoICUgMikge1xuICAgIHRocm93IG5ldyBFcnJvcignVW5ldmVuIG51bWJlciBvZiBhcmd1bWVudHMnKTtcbiAgfVxuXG4gIGNvbnN0IHJ2ID0ge307XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgYXJnTGVuZ3RoOyBpICs9IDIpIHtcbiAgICBydlthcmd1bWVudHNbaV1dID0gYXJndW1lbnRzW2kgKyAxXTtcbiAgfVxuICByZXR1cm4gcnY7XG59O1xuXG5cbi8qKlxuICogQ3JlYXRlcyBhIG5ldyBvYmplY3Qgd2hlcmUgdGhlIHByb3BlcnR5IG5hbWVzIGNvbWUgZnJvbSB0aGUgYXJndW1lbnRzIGJ1dFxuICogdGhlIHZhbHVlIGlzIGFsd2F5cyBzZXQgdG8gdHJ1ZVxuICogQHBhcmFtIHsuLi4qfSB2YXJfYXJncyBJZiBvbmx5IG9uZSBhcmd1bWVudCBpcyBwcm92aWRlZCBhbmQgaXQgaXMgYW4gYXJyYXlcbiAqICAgICB0aGVuIHRoaXMgaXMgdXNlZCBhcyB0aGUgYXJndW1lbnRzLCBvdGhlcndpc2UgdGhlIGFyZ3VtZW50cyBhcmUgdXNlZFxuICogICAgIGFzIHRoZSBwcm9wZXJ0eSBuYW1lcy5cbiAqIEByZXR1cm4geyFPYmplY3R9IFRoZSBuZXcgb2JqZWN0LlxuICovXG5nb29nLm9iamVjdC5jcmVhdGVTZXQgPSBmdW5jdGlvbih2YXJfYXJncykge1xuICAndXNlIHN0cmljdCc7XG4gIGNvbnN0IGFyZ0xlbmd0aCA9IGFyZ3VtZW50cy5sZW5ndGg7XG4gIGlmIChhcmdMZW5ndGggPT0gMSAmJiBBcnJheS5pc0FycmF5KGFyZ3VtZW50c1swXSkpIHtcbiAgICByZXR1cm4gZ29vZy5vYmplY3QuY3JlYXRlU2V0LmFwcGx5KG51bGwsIGFyZ3VtZW50c1swXSk7XG4gIH1cblxuICBjb25zdCBydiA9IHt9O1xuICBmb3IgKGxldCBpID0gMDsgaSA8IGFyZ0xlbmd0aDsgaSsrKSB7XG4gICAgcnZbYXJndW1lbnRzW2ldXSA9IHRydWU7XG4gIH1cbiAgcmV0dXJuIHJ2O1xufTtcblxuXG4vKipcbiAqIENyZWF0ZXMgYW4gaW1tdXRhYmxlIHZpZXcgb2YgdGhlIHVuZGVybHlpbmcgb2JqZWN0LCBpZiB0aGUgYnJvd3NlclxuICogc3VwcG9ydHMgaW1tdXRhYmxlIG9iamVjdHMuXG4gKlxuICogSW4gZGVmYXVsdCBtb2RlLCB3cml0ZXMgdG8gdGhpcyB2aWV3IHdpbGwgZmFpbCBzaWxlbnRseS4gSW4gc3RyaWN0IG1vZGUsXG4gKiB0aGV5IHdpbGwgdGhyb3cgYW4gZXJyb3IuXG4gKlxuICogQHBhcmFtIHshT2JqZWN0PEssVj59IG9iaiBBbiBvYmplY3QuXG4gKiBAcmV0dXJuIHshT2JqZWN0PEssVj59IEFuIGltbXV0YWJsZSB2aWV3IG9mIHRoYXQgb2JqZWN0LCBvciB0aGVcbiAqICAgICBvcmlnaW5hbCBvYmplY3QgaWYgdGhpcyBicm93c2VyIGRvZXMgbm90IHN1cHBvcnQgaW1tdXRhYmxlcy5cbiAqIEB0ZW1wbGF0ZSBLLFZcbiAqL1xuZ29vZy5vYmplY3QuY3JlYXRlSW1tdXRhYmxlVmlldyA9IGZ1bmN0aW9uKG9iaikge1xuICAndXNlIHN0cmljdCc7XG4gIGxldCByZXN1bHQgPSBvYmo7XG4gIGlmIChPYmplY3QuaXNGcm96ZW4gJiYgIU9iamVjdC5pc0Zyb3plbihvYmopKSB7XG4gICAgcmVzdWx0ID0gT2JqZWN0LmNyZWF0ZShvYmopO1xuICAgIE9iamVjdC5mcmVlemUocmVzdWx0KTtcbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufTtcblxuXG4vKipcbiAqIEBwYXJhbSB7IU9iamVjdH0gb2JqIEFuIG9iamVjdC5cbiAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgdGhpcyBpcyBhbiBpbW11dGFibGUgdmlldyBvZiB0aGUgb2JqZWN0LlxuICovXG5nb29nLm9iamVjdC5pc0ltbXV0YWJsZVZpZXcgPSBmdW5jdGlvbihvYmopIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gISFPYmplY3QuaXNGcm96ZW4gJiYgT2JqZWN0LmlzRnJvemVuKG9iaik7XG59O1xuXG5cbi8qKlxuICogR2V0IGFsbCBwcm9wZXJ0aWVzIG5hbWVzIG9uIGEgZ2l2ZW4gT2JqZWN0IHJlZ2FyZGxlc3Mgb2YgZW51bWVyYWJpbGl0eS5cbiAqXG4gKiA8cD4gSWYgdGhlIGJyb3dzZXIgZG9lcyBub3Qgc3VwcG9ydCBgT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXNgIG5vclxuICogYE9iamVjdC5nZXRQcm90b3R5cGVPZmAgdGhlbiB0aGlzIGlzIGVxdWl2YWxlbnQgdG8gdXNpbmdcbiAqIGBnb29nLm9iamVjdC5nZXRLZXlzYFxuICpcbiAqIEBwYXJhbSB7P09iamVjdH0gb2JqIFRoZSBvYmplY3QgdG8gZ2V0IHRoZSBwcm9wZXJ0aWVzIG9mLlxuICogQHBhcmFtIHtib29sZWFuPX0gb3B0X2luY2x1ZGVPYmplY3RQcm90b3R5cGUgV2hldGhlciBwcm9wZXJ0aWVzIGRlZmluZWQgb25cbiAqICAgICBgT2JqZWN0LnByb3RvdHlwZWAgc2hvdWxkIGJlIGluY2x1ZGVkIGluIHRoZSByZXN1bHQuXG4gKiBAcGFyYW0ge2Jvb2xlYW49fSBvcHRfaW5jbHVkZUZ1bmN0aW9uUHJvdG90eXBlIFdoZXRoZXIgcHJvcGVydGllcyBkZWZpbmVkIG9uXG4gKiAgICAgYEZ1bmN0aW9uLnByb3RvdHlwZWAgc2hvdWxkIGJlIGluY2x1ZGVkIGluIHRoZSByZXN1bHQuXG4gKiBAcmV0dXJuIHshQXJyYXk8c3RyaW5nPn1cbiAqIEBwdWJsaWNcbiAqL1xuZ29vZy5vYmplY3QuZ2V0QWxsUHJvcGVydHlOYW1lcyA9IGZ1bmN0aW9uKFxuICAgIG9iaiwgb3B0X2luY2x1ZGVPYmplY3RQcm90b3R5cGUsIG9wdF9pbmNsdWRlRnVuY3Rpb25Qcm90b3R5cGUpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBpZiAoIW9iaikge1xuICAgIHJldHVybiBbXTtcbiAgfVxuXG4gIC8vIE5haXZlbHkgdXNlIGEgZm9yLi5pbiBsb29wIHRvIGdldCB0aGUgcHJvcGVydHkgbmFtZXMgaWYgdGhlIGJyb3dzZXIgZG9lc24ndFxuICAvLyBzdXBwb3J0IGFueSBvdGhlciBBUElzIGZvciBnZXR0aW5nIGl0LlxuICBpZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzIHx8ICFPYmplY3QuZ2V0UHJvdG90eXBlT2YpIHtcbiAgICByZXR1cm4gZ29vZy5vYmplY3QuZ2V0S2V5cyhvYmopO1xuICB9XG5cbiAgY29uc3QgdmlzaXRlZFNldCA9IHt9O1xuXG4gIC8vIFRyYXZlcnNlIHRoZSBwcm90b3R5cGUgY2hhaW4gYW5kIGFkZCBhbGwgcHJvcGVydGllcyB0byB0aGUgdmlzaXRlZCBzZXQuXG4gIGxldCBwcm90byA9IG9iajtcbiAgd2hpbGUgKHByb3RvICYmXG4gICAgICAgICAocHJvdG8gIT09IE9iamVjdC5wcm90b3R5cGUgfHwgISFvcHRfaW5jbHVkZU9iamVjdFByb3RvdHlwZSkgJiZcbiAgICAgICAgIChwcm90byAhPT0gRnVuY3Rpb24ucHJvdG90eXBlIHx8ICEhb3B0X2luY2x1ZGVGdW5jdGlvblByb3RvdHlwZSkpIHtcbiAgICBjb25zdCBuYW1lcyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKHByb3RvKTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IG5hbWVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICB2aXNpdGVkU2V0W25hbWVzW2ldXSA9IHRydWU7XG4gICAgfVxuICAgIHByb3RvID0gT2JqZWN0LmdldFByb3RvdHlwZU9mKHByb3RvKTtcbiAgfVxuXG4gIHJldHVybiBnb29nLm9iamVjdC5nZXRLZXlzKHZpc2l0ZWRTZXQpO1xufTtcblxuXG4vKipcbiAqIEdpdmVuIGEgRVM1IG9yIEVTNiBjbGFzcyByZWZlcmVuY2UsIHJldHVybiBpdHMgc3VwZXIgY2xhc3MgLyBzdXBlclxuICogY29uc3RydWN0b3IuXG4gKlxuICogVGhpcyBzaG91bGQgYmUgdXNlZCBpbiByYXJlIGNhc2VzIHdoZXJlIHlvdSBuZWVkIHRvIHdhbGsgdXAgdGhlIGluaGVyaXRhbmNlXG4gKiB0cmVlICh0aGlzIGlzIGdlbmVyYWxseSBhIGJhZCBpZGVhKS4gQnV0IHRoaXMgd29yayB3aXRoIEVTNSBhbmQgRVM2IGNsYXNzZXMsXG4gKiB1bmxpa2UgcmVseWluZyBvbiB0aGUgc3VwZXJDbGFzc18gcHJvcGVydHkuXG4gKlxuICogTm90ZTogVG8gc3RhcnQgd2Fsa2luZyB1cCB0aGUgaGllcmFyY2h5IGZyb20gYW4gaW5zdGFuY2UgY2FsbCB0aGlzIHdpdGggaXRzXG4gKiBgY29uc3RydWN0b3JgIHByb3BlcnR5OyBlLmcuIGBnZXRTdXBlckNsYXNzKGluc3RhbmNlLmNvbnN0cnVjdG9yKWAuXG4gKlxuICogQHBhcmFtIHtmdW5jdGlvbihuZXc6ID8pfSBjb25zdHJ1Y3RvclxuICogQHJldHVybiB7P09iamVjdH1cbiAqL1xuZ29vZy5vYmplY3QuZ2V0U3VwZXJDbGFzcyA9IGZ1bmN0aW9uKGNvbnN0cnVjdG9yKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgdmFyIHByb3RvID0gT2JqZWN0LmdldFByb3RvdHlwZU9mKGNvbnN0cnVjdG9yLnByb3RvdHlwZSk7XG4gIHJldHVybiBwcm90byAmJiBwcm90by5jb25zdHJ1Y3Rvcjtcbn07XG4iLCAiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IFRoZSBDbG9zdXJlIExpYnJhcnkgQXV0aG9ycy5cbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBAZmlsZW92ZXJ2aWV3IFVzZWZ1bCBjb21waWxlciBpZGlvbXMuXG4gKi9cblxuZ29vZy5wcm92aWRlKCdnb29nLnJlZmxlY3QnKTtcblxuXG4vKipcbiAqIFN5bnRheCBmb3Igb2JqZWN0IGxpdGVyYWwgY2FzdHMuXG4gKiBAc2VlIGh0dHA6Ly9nby9qc2NvbXBpbGVyLXJlbmFtaW5nXG4gKiBAc2VlIGh0dHBzOi8vZ29vLmdsL0NSczA5UFxuICpcbiAqIFVzZSB0aGlzIGlmIHlvdSBoYXZlIGFuIG9iamVjdCBsaXRlcmFsIHdob3NlIGtleXMgbmVlZCB0byBoYXZlIHRoZSBzYW1lIG5hbWVzXG4gKiBhcyB0aGUgcHJvcGVydGllcyBvZiBzb21lIGNsYXNzIGV2ZW4gYWZ0ZXIgdGhleSBhcmUgcmVuYW1lZCBieSB0aGUgY29tcGlsZXIuXG4gKlxuICogQHBhcmFtIHshRnVuY3Rpb259IHR5cGUgVHlwZSB0byBjYXN0IHRvLlxuICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBPYmplY3QgbGl0ZXJhbCB0byBjYXN0LlxuICogQHJldHVybiB7T2JqZWN0fSBUaGUgb2JqZWN0IGxpdGVyYWwuXG4gKi9cbmdvb2cucmVmbGVjdC5vYmplY3QgPSBmdW5jdGlvbih0eXBlLCBvYmplY3QpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gb2JqZWN0O1xufTtcblxuLyoqXG4gKiBTeW50YXggZm9yIHJlbmFtaW5nIHByb3BlcnR5IHN0cmluZ3MuXG4gKiBAc2VlIGh0dHA6Ly9nby9qc2NvbXBpbGVyLXJlbmFtaW5nXG4gKiBAc2VlIGh0dHBzOi8vZ29vLmdsL0NSczA5UFxuICpcbiAqIFVzZSB0aGlzIGlmIHlvdSBoYXZlIGFuIG5lZWQgdG8gYWNjZXNzIGEgcHJvcGVydHkgYXMgYSBzdHJpbmcsIGJ1dCB3YW50XG4gKiB0byBhbHNvIGhhdmUgdGhlIHByb3BlcnR5IHJlbmFtZWQgYnkgdGhlIGNvbXBpbGVyLiBJbiBjb250cmFzdCB0b1xuICogZ29vZy5yZWZsZWN0Lm9iamVjdCwgdGhpcyBtZXRob2QgdGFrZXMgYW4gaW5zdGFuY2Ugb2YgYW4gb2JqZWN0LlxuICpcbiAqIFByb3BlcnRpZXMgbXVzdCBiZSBzaW1wbGUgbmFtZXMgKG5vdCBxdWFsaWZpZWQgbmFtZXMpLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBwcm9wIE5hbWUgb2YgdGhlIHByb3BlcnR5XG4gKiBAcGFyYW0geyFPYmplY3R9IG9iamVjdCBJbnN0YW5jZSBvZiB0aGUgb2JqZWN0IHdob3NlIHR5cGUgd2lsbCBiZSB1c2VkXG4gKiAgICAgZm9yIHJlbmFtaW5nXG4gKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSByZW5hbWVkIHByb3BlcnR5LlxuICovXG5nb29nLnJlZmxlY3Qub2JqZWN0UHJvcGVydHkgPSBmdW5jdGlvbihwcm9wLCBvYmplY3QpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gcHJvcDtcbn07XG5cbi8qKlxuICogVG8gYXNzZXJ0IHRvIHRoZSBjb21waWxlciB0aGF0IGFuIG9wZXJhdGlvbiBpcyBuZWVkZWQgd2hlbiBpdCB3b3VsZFxuICogb3RoZXJ3aXNlIGJlIHN0cmlwcGVkLiBGb3IgZXhhbXBsZTpcbiAqIDxjb2RlPlxuICogICAgIC8vIEZvcmNlIGEgbGF5b3V0XG4gKiAgICAgZ29vZy5yZWZsZWN0LnNpbmtWYWx1ZShkaWFsb2cub2Zmc2V0SGVpZ2h0KTtcbiAqIDwvY29kZT5cbiAqIEBwYXJhbSB7VH0geFxuICogQHJldHVybiB7VH1cbiAqIEB0ZW1wbGF0ZSBUXG4gKi9cbmdvb2cucmVmbGVjdC5zaW5rVmFsdWUgPSBmdW5jdGlvbih4KSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgZ29vZy5yZWZsZWN0LnNpbmtWYWx1ZVsnICddKHgpO1xuICByZXR1cm4geDtcbn07XG5cblxuLyoqXG4gKiBUaGUgY29tcGlsZXIgc2hvdWxkIG9wdGltaXplIHRoaXMgZnVuY3Rpb24gYXdheSBpZmYgbm8gb25lIGV2ZXIgdXNlc1xuICogZ29vZy5yZWZsZWN0LnNpbmtWYWx1ZS5cbiAqL1xuZ29vZy5yZWZsZWN0LnNpbmtWYWx1ZVsnICddID0gZ29vZy5udWxsRnVuY3Rpb247XG5cblxuLyoqXG4gKiBDaGVjayBpZiBhIHByb3BlcnR5IGNhbiBiZSBhY2Nlc3NlZCB3aXRob3V0IHRocm93aW5nIGFuIGV4Y2VwdGlvbi5cbiAqIEBwYXJhbSB7T2JqZWN0fSBvYmogVGhlIG93bmVyIG9mIHRoZSBwcm9wZXJ0eS5cbiAqIEBwYXJhbSB7c3RyaW5nfSBwcm9wIFRoZSBwcm9wZXJ0eSBuYW1lLlxuICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGUgcHJvcGVydHkgaXMgYWNjZXNzaWJsZS4gV2lsbCBhbHNvIHJldHVybiB0cnVlXG4gKiAgICAgaWYgb2JqIGlzIG51bGwuXG4gKi9cbmdvb2cucmVmbGVjdC5jYW5BY2Nlc3NQcm9wZXJ0eSA9IGZ1bmN0aW9uKG9iaiwgcHJvcCkge1xuICAndXNlIHN0cmljdCc7XG4gIHRyeSB7XG4gICAgZ29vZy5yZWZsZWN0LnNpbmtWYWx1ZShvYmpbcHJvcF0pO1xuICAgIHJldHVybiB0cnVlO1xuICB9IGNhdGNoIChlKSB7XG4gIH1cbiAgcmV0dXJuIGZhbHNlO1xufTtcblxuXG4vKipcbiAqIFJldHJpZXZlcyBhIHZhbHVlIGZyb20gYSBjYWNoZSBnaXZlbiBhIGtleS4gVGhlIGNvbXBpbGVyIHByb3ZpZGVzIHNwZWNpYWxcbiAqIGNvbnNpZGVyYXRpb24gZm9yIHRoaXMgY2FsbCBzdWNoIHRoYXQgaXQgaXMgZ2VuZXJhbGx5IGNvbnNpZGVyZWQgc2lkZS1lZmZlY3RcbiAqIGZyZWUuIEhvd2V2ZXIsIGlmIHRoZSBgb3B0X2tleUZuYCBvciBgdmFsdWVGbmAgaGF2ZSBzaWRlLWVmZmVjdHNcbiAqIHRoZW4gdGhlIGVudGlyZSBjYWxsIGlzIGNvbnNpZGVyZWQgdG8gaGF2ZSBzaWRlLWVmZmVjdHMuXG4gKlxuICogQ29udmVudGlvbmFsbHkgc3RvcmluZyB0aGUgdmFsdWUgb24gdGhlIGNhY2hlIHdvdWxkIGJlIGNvbnNpZGVyZWQgYVxuICogc2lkZS1lZmZlY3QgYW5kIHByZWNsdWRlIHVudXNlZCBjYWxscyBmcm9tIGJlaW5nIHBydW5lZCwgaWUuIGV2ZW4gaWZcbiAqIHRoZSB2YWx1ZSB3YXMgbmV2ZXIgdXNlZCwgaXQgd291bGQgc3RpbGwgYWx3YXlzIGJlIHN0b3JlZCBpbiB0aGUgY2FjaGUuXG4gKlxuICogUHJvdmlkaW5nIGEgc2lkZS1lZmZlY3QgZnJlZSBgdmFsdWVGbmAgYW5kIGBvcHRfa2V5Rm5gXG4gKiBhbGxvd3MgdW51c2VkIGNhbGxzIHRvIGBnb29nLnJlZmxlY3QuY2FjaGVgIHRvIGJlIHBydW5lZC5cbiAqXG4gKiBAcGFyYW0geyFPYmplY3Q8SywgVj59IGNhY2hlT2JqIFRoZSBvYmplY3QgdGhhdCBjb250YWlucyB0aGUgY2FjaGVkIHZhbHVlcy5cbiAqIEBwYXJhbSB7P30ga2V5IFRoZSBrZXkgdG8gbG9va3VwIGluIHRoZSBjYWNoZS4gSWYgaXQgaXMgbm90IHN0cmluZyBvciBudW1iZXJcbiAqICAgICB0aGVuIGEgYG9wdF9rZXlGbmAgc2hvdWxkIGJlIHByb3ZpZGVkLiBUaGUga2V5IGlzIGFsc28gdXNlZCBhcyB0aGVcbiAqICAgICBwYXJhbWV0ZXIgdG8gdGhlIGB2YWx1ZUZuYC5cbiAqIEBwYXJhbSB7ZnVuY3Rpb24oPyk6Vn0gdmFsdWVGbiBUaGUgdmFsdWUgcHJvdmlkZXIgdG8gdXNlIHRvIGNhbGN1bGF0ZSB0aGVcbiAqICAgICB2YWx1ZSB0byBzdG9yZSBpbiB0aGUgY2FjaGUuIFRoaXMgZnVuY3Rpb24gc2hvdWxkIGJlIHNpZGUtZWZmZWN0IGZyZWVcbiAqICAgICB0byB0YWtlIGFkdmFudGFnZSBvZiB0aGUgb3B0aW1pemF0aW9uLlxuICogQHBhcmFtIHtmdW5jdGlvbig/KTpLPX0gb3B0X2tleUZuIFRoZSBrZXkgcHJvdmlkZXIgdG8gZGV0ZXJtaW5lIHRoZSBjYWNoZVxuICogICAgIG1hcCBrZXkuIFRoaXMgc2hvdWxkIGJlIHVzZWQgaWYgdGhlIGdpdmVuIGtleSBpcyBub3QgYSBzdHJpbmcgb3IgbnVtYmVyLlxuICogICAgIElmIG5vdCBwcm92aWRlZCB0aGVuIHRoZSBnaXZlbiBrZXkgaXMgdXNlZC4gVGhpcyBmdW5jdGlvbiBzaG91bGQgYmVcbiAqICAgICBzaWRlLWVmZmVjdCBmcmVlIHRvIHRha2UgYWR2YW50YWdlIG9mIHRoZSBvcHRpbWl6YXRpb24uXG4gKiBAcmV0dXJuIHtWfSBUaGUgY2FjaGVkIG9yIGNhbGN1bGF0ZWQgdmFsdWUuXG4gKiBAdGVtcGxhdGUgS1xuICogQHRlbXBsYXRlIFZcbiAqL1xuZ29vZy5yZWZsZWN0LmNhY2hlID0gZnVuY3Rpb24oY2FjaGVPYmosIGtleSwgdmFsdWVGbiwgb3B0X2tleUZuKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgY29uc3Qgc3RvcmVkS2V5ID0gb3B0X2tleUZuID8gb3B0X2tleUZuKGtleSkgOiBrZXk7XG5cbiAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChjYWNoZU9iaiwgc3RvcmVkS2V5KSkge1xuICAgIHJldHVybiBjYWNoZU9ialtzdG9yZWRLZXldO1xuICB9XG5cbiAgcmV0dXJuIChjYWNoZU9ialtzdG9yZWRLZXldID0gdmFsdWVGbihrZXkpKTtcbn07XG4iLCAiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IFRoZSBDbG9zdXJlIExpYnJhcnkgQXV0aG9ycy5cbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBAZmlsZW92ZXJ2aWV3IFJlbmRlcmluZyBlbmdpbmUgZGV0ZWN0aW9uLlxuICogQHNlZSA8YSBocmVmPVwiaHR0cDovL3d3dy51c2VyYWdlbnRzdHJpbmcuY29tL1wiPlVzZXIgYWdlbnQgc3RyaW5nczwvYT5cbiAqIEZvciBpbmZvcm1hdGlvbiBvbiB0aGUgYnJvd3NlciBicmFuZCAoc3VjaCBhcyBTYWZhcmkgdmVyc3VzIENocm9tZSksIHNlZVxuICogZ29vZy51c2VyQWdlbnQucHJvZHVjdC5cbiAqIEBzZWUgLi4vZGVtb3MvdXNlcmFnZW50Lmh0bWxcbiAqL1xuXG5nb29nLnByb3ZpZGUoJ2dvb2cudXNlckFnZW50Jyk7XG5cbmdvb2cucmVxdWlyZSgnZ29vZy5sYWJzLnVzZXJBZ2VudC5icm93c2VyJyk7XG5nb29nLnJlcXVpcmUoJ2dvb2cubGFicy51c2VyQWdlbnQuZW5naW5lJyk7XG5nb29nLnJlcXVpcmUoJ2dvb2cubGFicy51c2VyQWdlbnQucGxhdGZvcm0nKTtcbmdvb2cucmVxdWlyZSgnZ29vZy5sYWJzLnVzZXJBZ2VudC51dGlsJyk7XG5nb29nLnJlcXVpcmUoJ2dvb2cucmVmbGVjdCcpO1xuZ29vZy5yZXF1aXJlKCdnb29nLnN0cmluZycpO1xuXG5cbi8qKlxuICogQGRlZmluZSB7Ym9vbGVhbn0gV2hldGhlciB3ZSBrbm93IGF0IGNvbXBpbGUtdGltZSB0aGF0IHRoZSBicm93c2VyIGlzIElFLlxuICovXG5nb29nLnVzZXJBZ2VudC5BU1NVTUVfSUUgPSBnb29nLmRlZmluZSgnZ29vZy51c2VyQWdlbnQuQVNTVU1FX0lFJywgZmFsc2UpO1xuXG5cbi8qKlxuICogQGRlZmluZSB7Ym9vbGVhbn0gV2hldGhlciB3ZSBrbm93IGF0IGNvbXBpbGUtdGltZSB0aGF0IHRoZSBicm93c2VyIGlzIEVER0UsXG4gKiByZWZlcnJpbmcgdG8gRWRnZUhUTUwgYmFzZWQgRWRnZS5cbiAqL1xuZ29vZy51c2VyQWdlbnQuQVNTVU1FX0VER0UgPSBnb29nLmRlZmluZSgnZ29vZy51c2VyQWdlbnQuQVNTVU1FX0VER0UnLCBmYWxzZSk7XG5cblxuLyoqXG4gKiBAZGVmaW5lIHtib29sZWFufSBXaGV0aGVyIHdlIGtub3cgYXQgY29tcGlsZS10aW1lIHRoYXQgdGhlIGJyb3dzZXIgaXMgR0VDS08uXG4gKi9cbmdvb2cudXNlckFnZW50LkFTU1VNRV9HRUNLTyA9IGdvb2cuZGVmaW5lKCdnb29nLnVzZXJBZ2VudC5BU1NVTUVfR0VDS08nLCBmYWxzZSk7XG5cblxuLyoqXG4gKiBAZGVmaW5lIHtib29sZWFufSBXaGV0aGVyIHdlIGtub3cgYXQgY29tcGlsZS10aW1lIHRoYXQgdGhlIGJyb3dzZXIgaXMgV0VCS0lULlxuICovXG5nb29nLnVzZXJBZ2VudC5BU1NVTUVfV0VCS0lUID1cbiAgICBnb29nLmRlZmluZSgnZ29vZy51c2VyQWdlbnQuQVNTVU1FX1dFQktJVCcsIGZhbHNlKTtcblxuXG4vKipcbiAqIEBkZWZpbmUge2Jvb2xlYW59IFdoZXRoZXIgd2Uga25vdyBhdCBjb21waWxlLXRpbWUgdGhhdCB0aGUgYnJvd3NlciBpcyBhXG4gKiAgICAgbW9iaWxlIGRldmljZSBydW5uaW5nIFdlYktpdCBlLmcuIGlQaG9uZSBvciBBbmRyb2lkLlxuICovXG5nb29nLnVzZXJBZ2VudC5BU1NVTUVfTU9CSUxFX1dFQktJVCA9XG4gICAgZ29vZy5kZWZpbmUoJ2dvb2cudXNlckFnZW50LkFTU1VNRV9NT0JJTEVfV0VCS0lUJywgZmFsc2UpO1xuXG5cbi8qKlxuICogQGRlZmluZSB7Ym9vbGVhbn0gV2hldGhlciB3ZSBrbm93IGF0IGNvbXBpbGUtdGltZSB0aGF0IHRoZSBicm93c2VyIGlzIE9QRVJBLFxuICogcmVmZXJyaW5nIHRvIFByZXN0by1iYXNlZCBPcGVyYS5cbiAqL1xuZ29vZy51c2VyQWdlbnQuQVNTVU1FX09QRVJBID0gZ29vZy5kZWZpbmUoJ2dvb2cudXNlckFnZW50LkFTU1VNRV9PUEVSQScsIGZhbHNlKTtcblxuXG4vKipcbiAqIEBkZWZpbmUge2Jvb2xlYW59IFdoZXRoZXIgdGhlXG4gKiAgICAgYGdvb2cudXNlckFnZW50LmlzVmVyc2lvbk9ySGlnaGVyYFxuICogICAgIGZ1bmN0aW9uIHdpbGwgcmV0dXJuIHRydWUgZm9yIGFueSB2ZXJzaW9uLlxuICovXG5nb29nLnVzZXJBZ2VudC5BU1NVTUVfQU5ZX1ZFUlNJT04gPVxuICAgIGdvb2cuZGVmaW5lKCdnb29nLnVzZXJBZ2VudC5BU1NVTUVfQU5ZX1ZFUlNJT04nLCBmYWxzZSk7XG5cblxuLyoqXG4gKiBXaGV0aGVyIHdlIGtub3cgdGhlIGJyb3dzZXIgZW5naW5lIGF0IGNvbXBpbGUtdGltZS5cbiAqIEB0eXBlIHtib29sZWFufVxuICogQHByaXZhdGVcbiAqL1xuZ29vZy51c2VyQWdlbnQuQlJPV1NFUl9LTk9XTl8gPSBnb29nLnVzZXJBZ2VudC5BU1NVTUVfSUUgfHxcbiAgICBnb29nLnVzZXJBZ2VudC5BU1NVTUVfRURHRSB8fCBnb29nLnVzZXJBZ2VudC5BU1NVTUVfR0VDS08gfHxcbiAgICBnb29nLnVzZXJBZ2VudC5BU1NVTUVfTU9CSUxFX1dFQktJVCB8fCBnb29nLnVzZXJBZ2VudC5BU1NVTUVfV0VCS0lUIHx8XG4gICAgZ29vZy51c2VyQWdlbnQuQVNTVU1FX09QRVJBO1xuXG5cbi8qKlxuICogUmV0dXJucyB0aGUgdXNlckFnZW50IHN0cmluZyBmb3IgdGhlIGN1cnJlbnQgYnJvd3Nlci5cbiAqXG4gKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSB1c2VyQWdlbnQgc3RyaW5nLlxuICovXG5nb29nLnVzZXJBZ2VudC5nZXRVc2VyQWdlbnRTdHJpbmcgPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gZ29vZy5sYWJzLnVzZXJBZ2VudC51dGlsLmdldFVzZXJBZ2VudCgpO1xufTtcblxuXG4vKipcbiAqIEByZXR1cm4gez9OYXZpZ2F0b3J9IFRoZSBuYXRpdmUgbmF2aWdhdG9yIG9iamVjdC5cbiAqL1xuZ29vZy51c2VyQWdlbnQuZ2V0TmF2aWdhdG9yVHlwZWQgPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICAvLyBOZWVkIGEgbG9jYWwgbmF2aWdhdG9yIHJlZmVyZW5jZSBpbnN0ZWFkIG9mIHVzaW5nIHRoZSBnbG9iYWwgb25lLFxuICAvLyB0byBhdm9pZCB0aGUgcmFyZSBjYXNlIHdoZXJlIHRoZXkgcmVmZXJlbmNlIGRpZmZlcmVudCBvYmplY3RzLlxuICAvLyAoaW4gYSBXb3JrZXJQb29sLCBmb3IgZXhhbXBsZSkuXG4gIHJldHVybiBnb29nLmdsb2JhbFsnbmF2aWdhdG9yJ10gfHwgbnVsbDtcbn07XG5cblxuLyoqXG4gKiBUT0RPKG5uYXplKTogQ2hhbmdlIHR5cGUgdG8gXCJOYXZpZ2F0b3JcIiBhbmQgdXBkYXRlIGNvbXBpbGF0aW9uIHRhcmdldHMuXG4gKiBAcmV0dXJuIHs/T2JqZWN0fSBUaGUgbmF0aXZlIG5hdmlnYXRvciBvYmplY3QuXG4gKi9cbmdvb2cudXNlckFnZW50LmdldE5hdmlnYXRvciA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIHJldHVybiBnb29nLnVzZXJBZ2VudC5nZXROYXZpZ2F0b3JUeXBlZCgpO1xufTtcblxuXG4vKipcbiAqIFdoZXRoZXIgdGhlIHVzZXIgYWdlbnQgaXMgUHJlc3RvLWJhc2VkIE9wZXJhLlxuICogQHR5cGUge2Jvb2xlYW59XG4gKi9cbmdvb2cudXNlckFnZW50Lk9QRVJBID0gZ29vZy51c2VyQWdlbnQuQlJPV1NFUl9LTk9XTl8gP1xuICAgIGdvb2cudXNlckFnZW50LkFTU1VNRV9PUEVSQSA6XG4gICAgZ29vZy5sYWJzLnVzZXJBZ2VudC5icm93c2VyLmlzT3BlcmEoKTtcblxuXG4vKipcbiAqIFdoZXRoZXIgdGhlIHVzZXIgYWdlbnQgaXMgSW50ZXJuZXQgRXhwbG9yZXIuXG4gKiBAdHlwZSB7Ym9vbGVhbn1cbiAqL1xuZ29vZy51c2VyQWdlbnQuSUUgPSBnb29nLnVzZXJBZ2VudC5CUk9XU0VSX0tOT1dOXyA/XG4gICAgZ29vZy51c2VyQWdlbnQuQVNTVU1FX0lFIDpcbiAgICBnb29nLmxhYnMudXNlckFnZW50LmJyb3dzZXIuaXNJRSgpO1xuXG5cbi8qKlxuICogV2hldGhlciB0aGUgdXNlciBhZ2VudCBpcyBNaWNyb3NvZnQgRWRnZSAoRWRnZUhUTUwgYmFzZWQpLlxuICogQHR5cGUge2Jvb2xlYW59XG4gKi9cbmdvb2cudXNlckFnZW50LkVER0UgPSBnb29nLnVzZXJBZ2VudC5CUk9XU0VSX0tOT1dOXyA/XG4gICAgZ29vZy51c2VyQWdlbnQuQVNTVU1FX0VER0UgOlxuICAgIGdvb2cubGFicy51c2VyQWdlbnQuZW5naW5lLmlzRWRnZSgpO1xuXG5cbi8qKlxuICogV2hldGhlciB0aGUgdXNlciBhZ2VudCBpcyBNUyBJbnRlcm5ldCBFeHBsb3JlciBvciBNUyBFZGdlIChFZGdlSFRNTCBiYXNlZCkuXG4gKiBAdHlwZSB7Ym9vbGVhbn1cbiAqL1xuZ29vZy51c2VyQWdlbnQuRURHRV9PUl9JRSA9IGdvb2cudXNlckFnZW50LkVER0UgfHwgZ29vZy51c2VyQWdlbnQuSUU7XG5cblxuLyoqXG4gKiBXaGV0aGVyIHRoZSB1c2VyIGFnZW50IGlzIEdlY2tvLiBHZWNrbyBpcyB0aGUgcmVuZGVyaW5nIGVuZ2luZSB1c2VkIGJ5XG4gKiBNb3ppbGxhLCBGaXJlZm94LCBhbmQgb3RoZXJzLlxuICogQHR5cGUge2Jvb2xlYW59XG4gKi9cbmdvb2cudXNlckFnZW50LkdFQ0tPID0gZ29vZy51c2VyQWdlbnQuQlJPV1NFUl9LTk9XTl8gP1xuICAgIGdvb2cudXNlckFnZW50LkFTU1VNRV9HRUNLTyA6XG4gICAgZ29vZy5sYWJzLnVzZXJBZ2VudC5lbmdpbmUuaXNHZWNrbygpO1xuXG5cbi8qKlxuICogV2hldGhlciB0aGUgdXNlciBhZ2VudCBpcyBXZWJLaXQuIFdlYktpdCBpcyB0aGUgcmVuZGVyaW5nIGVuZ2luZSB0aGF0XG4gKiBTYWZhcmksIEVkZ2UgQ2hyb21pdW0sIE9wZXJhIENocm9taXVtLCBBbmRyb2lkIGFuZCBvdGhlcnMgdXNlLlxuICogQHR5cGUge2Jvb2xlYW59XG4gKi9cbmdvb2cudXNlckFnZW50LldFQktJVCA9IGdvb2cudXNlckFnZW50LkJST1dTRVJfS05PV05fID9cbiAgICBnb29nLnVzZXJBZ2VudC5BU1NVTUVfV0VCS0lUIHx8IGdvb2cudXNlckFnZW50LkFTU1VNRV9NT0JJTEVfV0VCS0lUIDpcbiAgICBnb29nLmxhYnMudXNlckFnZW50LmVuZ2luZS5pc1dlYktpdCgpO1xuXG5cbi8qKlxuICogV2hldGhlciB0aGUgdXNlciBhZ2VudCBpcyBydW5uaW5nIG9uIGEgbW9iaWxlIGRldmljZS5cbiAqXG4gKiBUaGlzIGlzIGEgc2VwYXJhdGUgZnVuY3Rpb24gc28gdGhhdCB0aGUgbG9naWMgY2FuIGJlIHRlc3RlZC5cbiAqXG4gKiBUT0RPKG5uYXplKTogSW52ZXN0aWdhdGUgc3dhcHBpbmcgaW4gZ29vZy5sYWJzLnVzZXJBZ2VudC5kZXZpY2UuaXNNb2JpbGUoKS5cbiAqXG4gKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoZSB1c2VyIGFnZW50IGlzIHJ1bm5pbmcgb24gYSBtb2JpbGUgZGV2aWNlLlxuICogQHByaXZhdGVcbiAqL1xuZ29vZy51c2VyQWdlbnQuaXNNb2JpbGVfID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmV0dXJuIGdvb2cudXNlckFnZW50LldFQktJVCAmJlxuICAgICAgZ29vZy5sYWJzLnVzZXJBZ2VudC51dGlsLm1hdGNoVXNlckFnZW50KCdNb2JpbGUnKTtcbn07XG5cblxuLyoqXG4gKiBXaGV0aGVyIHRoZSB1c2VyIGFnZW50IGlzIHJ1bm5pbmcgb24gYSBtb2JpbGUgZGV2aWNlLlxuICpcbiAqIFRPRE8obm5hemUpOiBDb25zaWRlciBkZXByZWNhdGluZyBNT0JJTEUgd2hlbiBsYWJzLnVzZXJBZ2VudFxuICogICBpcyBwcm9tb3RlZCBhcyB0aGUgZ2Vja28vd2Via2l0IGxvZ2ljIGlzIGxpa2VseSBpbmFjY3VyYXRlLlxuICpcbiAqIEB0eXBlIHtib29sZWFufVxuICovXG5nb29nLnVzZXJBZ2VudC5NT0JJTEUgPVxuICAgIGdvb2cudXNlckFnZW50LkFTU1VNRV9NT0JJTEVfV0VCS0lUIHx8IGdvb2cudXNlckFnZW50LmlzTW9iaWxlXygpO1xuXG5cbi8qKlxuICogVXNlZCB3aGlsZSB0cmFuc2l0aW9uaW5nIGNvZGUgdG8gdXNlIFdFQktJVCBpbnN0ZWFkLlxuICogQHR5cGUge2Jvb2xlYW59XG4gKiBAZGVwcmVjYXRlZCBVc2Uge0BsaW5rIGdvb2cudXNlckFnZW50LnByb2R1Y3QuU0FGQVJJfSBpbnN0ZWFkLlxuICogVE9ETyhuaWNrc2FudG9zKTogRGVsZXRlIHRoaXMgZnJvbSBnb29nLnVzZXJBZ2VudC5cbiAqL1xuZ29vZy51c2VyQWdlbnQuU0FGQVJJID0gZ29vZy51c2VyQWdlbnQuV0VCS0lUO1xuXG5cbi8qKlxuICogQHJldHVybiB7c3RyaW5nfSB0aGUgcGxhdGZvcm0gKG9wZXJhdGluZyBzeXN0ZW0pIHRoZSB1c2VyIGFnZW50IGlzIHJ1bm5pbmdcbiAqICAgICBvbi4gRGVmYXVsdCB0byBlbXB0eSBzdHJpbmcgYmVjYXVzZSBuYXZpZ2F0b3IucGxhdGZvcm0gbWF5IG5vdCBiZSBkZWZpbmVkXG4gKiAgICAgKG9uIFJoaW5vLCBmb3IgZXhhbXBsZSkuXG4gKiBAcHJpdmF0ZVxuICovXG5nb29nLnVzZXJBZ2VudC5kZXRlcm1pbmVQbGF0Zm9ybV8gPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICB2YXIgbmF2aWdhdG9yID0gZ29vZy51c2VyQWdlbnQuZ2V0TmF2aWdhdG9yVHlwZWQoKTtcbiAgcmV0dXJuIG5hdmlnYXRvciAmJiBuYXZpZ2F0b3IucGxhdGZvcm0gfHwgJyc7XG59O1xuXG5cbi8qKlxuICogVGhlIHBsYXRmb3JtIChvcGVyYXRpbmcgc3lzdGVtKSB0aGUgdXNlciBhZ2VudCBpcyBydW5uaW5nIG9uLiBEZWZhdWx0IHRvXG4gKiBlbXB0eSBzdHJpbmcgYmVjYXVzZSBuYXZpZ2F0b3IucGxhdGZvcm0gbWF5IG5vdCBiZSBkZWZpbmVkIChvbiBSaGlubywgZm9yXG4gKiBleGFtcGxlKS5cbiAqIEB0eXBlIHtzdHJpbmd9XG4gKi9cbmdvb2cudXNlckFnZW50LlBMQVRGT1JNID0gZ29vZy51c2VyQWdlbnQuZGV0ZXJtaW5lUGxhdGZvcm1fKCk7XG5cblxuLyoqXG4gKiBAZGVmaW5lIHtib29sZWFufSBXaGV0aGVyIHRoZSB1c2VyIGFnZW50IGlzIHJ1bm5pbmcgb24gYSBNYWNpbnRvc2ggb3BlcmF0aW5nXG4gKiAgICAgc3lzdGVtLlxuICovXG5nb29nLnVzZXJBZ2VudC5BU1NVTUVfTUFDID0gZ29vZy5kZWZpbmUoJ2dvb2cudXNlckFnZW50LkFTU1VNRV9NQUMnLCBmYWxzZSk7XG5cblxuLyoqXG4gKiBAZGVmaW5lIHtib29sZWFufSBXaGV0aGVyIHRoZSB1c2VyIGFnZW50IGlzIHJ1bm5pbmcgb24gYSBXaW5kb3dzIG9wZXJhdGluZ1xuICogICAgIHN5c3RlbS5cbiAqL1xuZ29vZy51c2VyQWdlbnQuQVNTVU1FX1dJTkRPV1MgPVxuICAgIGdvb2cuZGVmaW5lKCdnb29nLnVzZXJBZ2VudC5BU1NVTUVfV0lORE9XUycsIGZhbHNlKTtcblxuXG4vKipcbiAqIEBkZWZpbmUge2Jvb2xlYW59IFdoZXRoZXIgdGhlIHVzZXIgYWdlbnQgaXMgcnVubmluZyBvbiBhIExpbnV4IG9wZXJhdGluZ1xuICogICAgIHN5c3RlbS5cbiAqL1xuZ29vZy51c2VyQWdlbnQuQVNTVU1FX0xJTlVYID0gZ29vZy5kZWZpbmUoJ2dvb2cudXNlckFnZW50LkFTU1VNRV9MSU5VWCcsIGZhbHNlKTtcblxuXG4vKipcbiAqIEBkZWZpbmUge2Jvb2xlYW59IFdoZXRoZXIgdGhlIHVzZXIgYWdlbnQgaXMgcnVubmluZyBvbiBhIFgxMSB3aW5kb3dpbmdcbiAqICAgICBzeXN0ZW0uXG4gKi9cbmdvb2cudXNlckFnZW50LkFTU1VNRV9YMTEgPSBnb29nLmRlZmluZSgnZ29vZy51c2VyQWdlbnQuQVNTVU1FX1gxMScsIGZhbHNlKTtcblxuXG4vKipcbiAqIEBkZWZpbmUge2Jvb2xlYW59IFdoZXRoZXIgdGhlIHVzZXIgYWdlbnQgaXMgcnVubmluZyBvbiBBbmRyb2lkLlxuICovXG5nb29nLnVzZXJBZ2VudC5BU1NVTUVfQU5EUk9JRCA9XG4gICAgZ29vZy5kZWZpbmUoJ2dvb2cudXNlckFnZW50LkFTU1VNRV9BTkRST0lEJywgZmFsc2UpO1xuXG5cbi8qKlxuICogQGRlZmluZSB7Ym9vbGVhbn0gV2hldGhlciB0aGUgdXNlciBhZ2VudCBpcyBydW5uaW5nIG9uIGFuIGlQaG9uZS5cbiAqL1xuZ29vZy51c2VyQWdlbnQuQVNTVU1FX0lQSE9ORSA9XG4gICAgZ29vZy5kZWZpbmUoJ2dvb2cudXNlckFnZW50LkFTU1VNRV9JUEhPTkUnLCBmYWxzZSk7XG5cblxuLyoqXG4gKiBAZGVmaW5lIHtib29sZWFufSBXaGV0aGVyIHRoZSB1c2VyIGFnZW50IGlzIHJ1bm5pbmcgb24gYW4gaVBhZC5cbiAqL1xuZ29vZy51c2VyQWdlbnQuQVNTVU1FX0lQQUQgPSBnb29nLmRlZmluZSgnZ29vZy51c2VyQWdlbnQuQVNTVU1FX0lQQUQnLCBmYWxzZSk7XG5cblxuLyoqXG4gKiBAZGVmaW5lIHtib29sZWFufSBXaGV0aGVyIHRoZSB1c2VyIGFnZW50IGlzIHJ1bm5pbmcgb24gYW4gaVBvZC5cbiAqL1xuZ29vZy51c2VyQWdlbnQuQVNTVU1FX0lQT0QgPSBnb29nLmRlZmluZSgnZ29vZy51c2VyQWdlbnQuQVNTVU1FX0lQT0QnLCBmYWxzZSk7XG5cblxuLyoqXG4gKiBAZGVmaW5lIHtib29sZWFufSBXaGV0aGVyIHRoZSB1c2VyIGFnZW50IGlzIHJ1bm5pbmcgb24gS2FpT1MuXG4gKi9cbmdvb2cudXNlckFnZW50LkFTU1VNRV9LQUlPUyA9IGdvb2cuZGVmaW5lKCdnb29nLnVzZXJBZ2VudC5BU1NVTUVfS0FJT1MnLCBmYWxzZSk7XG5cblxuLyoqXG4gKiBAdHlwZSB7Ym9vbGVhbn1cbiAqIEBwcml2YXRlXG4gKi9cbmdvb2cudXNlckFnZW50LlBMQVRGT1JNX0tOT1dOXyA9IGdvb2cudXNlckFnZW50LkFTU1VNRV9NQUMgfHxcbiAgICBnb29nLnVzZXJBZ2VudC5BU1NVTUVfV0lORE9XUyB8fCBnb29nLnVzZXJBZ2VudC5BU1NVTUVfTElOVVggfHxcbiAgICBnb29nLnVzZXJBZ2VudC5BU1NVTUVfWDExIHx8IGdvb2cudXNlckFnZW50LkFTU1VNRV9BTkRST0lEIHx8XG4gICAgZ29vZy51c2VyQWdlbnQuQVNTVU1FX0lQSE9ORSB8fCBnb29nLnVzZXJBZ2VudC5BU1NVTUVfSVBBRCB8fFxuICAgIGdvb2cudXNlckFnZW50LkFTU1VNRV9JUE9EO1xuXG5cbi8qKlxuICogV2hldGhlciB0aGUgdXNlciBhZ2VudCBpcyBydW5uaW5nIG9uIGEgTWFjaW50b3NoIG9wZXJhdGluZyBzeXN0ZW0uXG4gKiBAdHlwZSB7Ym9vbGVhbn1cbiAqL1xuZ29vZy51c2VyQWdlbnQuTUFDID0gZ29vZy51c2VyQWdlbnQuUExBVEZPUk1fS05PV05fID9cbiAgICBnb29nLnVzZXJBZ2VudC5BU1NVTUVfTUFDIDpcbiAgICBnb29nLmxhYnMudXNlckFnZW50LnBsYXRmb3JtLmlzTWFjaW50b3NoKCk7XG5cblxuLyoqXG4gKiBXaGV0aGVyIHRoZSB1c2VyIGFnZW50IGlzIHJ1bm5pbmcgb24gYSBXaW5kb3dzIG9wZXJhdGluZyBzeXN0ZW0uXG4gKiBAdHlwZSB7Ym9vbGVhbn1cbiAqL1xuZ29vZy51c2VyQWdlbnQuV0lORE9XUyA9IGdvb2cudXNlckFnZW50LlBMQVRGT1JNX0tOT1dOXyA/XG4gICAgZ29vZy51c2VyQWdlbnQuQVNTVU1FX1dJTkRPV1MgOlxuICAgIGdvb2cubGFicy51c2VyQWdlbnQucGxhdGZvcm0uaXNXaW5kb3dzKCk7XG5cblxuLyoqXG4gKiBXaGV0aGVyIHRoZSB1c2VyIGFnZW50IGlzIExpbnV4IHBlciB0aGUgbGVnYWN5IGJlaGF2aW9yIG9mXG4gKiBnb29nLnVzZXJBZ2VudC5MSU5VWCwgd2hpY2ggY29uc2lkZXJlZCBDaHJvbWVPUyB0byBhbHNvIGJlXG4gKiBMaW51eC5cbiAqIEByZXR1cm4ge2Jvb2xlYW59XG4gKiBAcHJpdmF0ZVxuICovXG5nb29nLnVzZXJBZ2VudC5pc0xlZ2FjeUxpbnV4XyA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIHJldHVybiBnb29nLmxhYnMudXNlckFnZW50LnBsYXRmb3JtLmlzTGludXgoKSB8fFxuICAgICAgZ29vZy5sYWJzLnVzZXJBZ2VudC5wbGF0Zm9ybS5pc0Nocm9tZU9TKCk7XG59O1xuXG5cbi8qKlxuICogV2hldGhlciB0aGUgdXNlciBhZ2VudCBpcyBydW5uaW5nIG9uIGEgTGludXggb3BlcmF0aW5nIHN5c3RlbS5cbiAqXG4gKiBOb3RlIHRoYXQgZ29vZy51c2VyQWdlbnQuTElOVVggY29uc2lkZXJzIENocm9tZU9TIHRvIGJlIExpbnV4LFxuICogd2hpbGUgZ29vZy5sYWJzLnVzZXJBZ2VudC5wbGF0Zm9ybSBjb25zaWRlcnMgQ2hyb21lT1MgYW5kXG4gKiBMaW51eCB0byBiZSBkaWZmZXJlbnQgT1Nlcy5cbiAqXG4gKiBAdHlwZSB7Ym9vbGVhbn1cbiAqL1xuZ29vZy51c2VyQWdlbnQuTElOVVggPSBnb29nLnVzZXJBZ2VudC5QTEFURk9STV9LTk9XTl8gP1xuICAgIGdvb2cudXNlckFnZW50LkFTU1VNRV9MSU5VWCA6XG4gICAgZ29vZy51c2VyQWdlbnQuaXNMZWdhY3lMaW51eF8oKTtcblxuXG4vKipcbiAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgdGhlIHVzZXIgYWdlbnQgaXMgYW4gWDExIHdpbmRvd2luZyBzeXN0ZW0uXG4gKiBAcHJpdmF0ZVxuICovXG5nb29nLnVzZXJBZ2VudC5pc1gxMV8gPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICB2YXIgbmF2aWdhdG9yID0gZ29vZy51c2VyQWdlbnQuZ2V0TmF2aWdhdG9yVHlwZWQoKTtcbiAgcmV0dXJuICEhbmF2aWdhdG9yICYmXG4gICAgICBnb29nLnN0cmluZy5jb250YWlucyhuYXZpZ2F0b3JbJ2FwcFZlcnNpb24nXSB8fCAnJywgJ1gxMScpO1xufTtcblxuXG4vKipcbiAqIFdoZXRoZXIgdGhlIHVzZXIgYWdlbnQgaXMgcnVubmluZyBvbiBhIFgxMSB3aW5kb3dpbmcgc3lzdGVtLlxuICogQHR5cGUge2Jvb2xlYW59XG4gKi9cbmdvb2cudXNlckFnZW50LlgxMSA9IGdvb2cudXNlckFnZW50LlBMQVRGT1JNX0tOT1dOXyA/XG4gICAgZ29vZy51c2VyQWdlbnQuQVNTVU1FX1gxMSA6XG4gICAgZ29vZy51c2VyQWdlbnQuaXNYMTFfKCk7XG5cblxuLyoqXG4gKiBXaGV0aGVyIHRoZSB1c2VyIGFnZW50IGlzIHJ1bm5pbmcgb24gQW5kcm9pZC5cbiAqIEB0eXBlIHtib29sZWFufVxuICovXG5nb29nLnVzZXJBZ2VudC5BTkRST0lEID0gZ29vZy51c2VyQWdlbnQuUExBVEZPUk1fS05PV05fID9cbiAgICBnb29nLnVzZXJBZ2VudC5BU1NVTUVfQU5EUk9JRCA6XG4gICAgZ29vZy5sYWJzLnVzZXJBZ2VudC5wbGF0Zm9ybS5pc0FuZHJvaWQoKTtcblxuXG4vKipcbiAqIFdoZXRoZXIgdGhlIHVzZXIgYWdlbnQgaXMgcnVubmluZyBvbiBhbiBpUGhvbmUuXG4gKiBAdHlwZSB7Ym9vbGVhbn1cbiAqL1xuZ29vZy51c2VyQWdlbnQuSVBIT05FID0gZ29vZy51c2VyQWdlbnQuUExBVEZPUk1fS05PV05fID9cbiAgICBnb29nLnVzZXJBZ2VudC5BU1NVTUVfSVBIT05FIDpcbiAgICBnb29nLmxhYnMudXNlckFnZW50LnBsYXRmb3JtLmlzSXBob25lKCk7XG5cblxuLyoqXG4gKiBXaGV0aGVyIHRoZSB1c2VyIGFnZW50IGlzIHJ1bm5pbmcgb24gYW4gaVBhZC5cbiAqIEB0eXBlIHtib29sZWFufVxuICovXG5nb29nLnVzZXJBZ2VudC5JUEFEID0gZ29vZy51c2VyQWdlbnQuUExBVEZPUk1fS05PV05fID9cbiAgICBnb29nLnVzZXJBZ2VudC5BU1NVTUVfSVBBRCA6XG4gICAgZ29vZy5sYWJzLnVzZXJBZ2VudC5wbGF0Zm9ybS5pc0lwYWQoKTtcblxuXG4vKipcbiAqIFdoZXRoZXIgdGhlIHVzZXIgYWdlbnQgaXMgcnVubmluZyBvbiBhbiBpUG9kLlxuICogQHR5cGUge2Jvb2xlYW59XG4gKi9cbmdvb2cudXNlckFnZW50LklQT0QgPSBnb29nLnVzZXJBZ2VudC5QTEFURk9STV9LTk9XTl8gP1xuICAgIGdvb2cudXNlckFnZW50LkFTU1VNRV9JUE9EIDpcbiAgICBnb29nLmxhYnMudXNlckFnZW50LnBsYXRmb3JtLmlzSXBvZCgpO1xuXG5cbi8qKlxuICogV2hldGhlciB0aGUgdXNlciBhZ2VudCBpcyBydW5uaW5nIG9uIGlPUy5cbiAqIEB0eXBlIHtib29sZWFufVxuICovXG5nb29nLnVzZXJBZ2VudC5JT1MgPSBnb29nLnVzZXJBZ2VudC5QTEFURk9STV9LTk9XTl8gP1xuICAgIChnb29nLnVzZXJBZ2VudC5BU1NVTUVfSVBIT05FIHx8IGdvb2cudXNlckFnZW50LkFTU1VNRV9JUEFEIHx8XG4gICAgIGdvb2cudXNlckFnZW50LkFTU1VNRV9JUE9EKSA6XG4gICAgZ29vZy5sYWJzLnVzZXJBZ2VudC5wbGF0Zm9ybS5pc0lvcygpO1xuXG4vKipcbiAqIFdoZXRoZXIgdGhlIHVzZXIgYWdlbnQgaXMgcnVubmluZyBvbiBLYWlPUy5cbiAqIEB0eXBlIHtib29sZWFufVxuICovXG5nb29nLnVzZXJBZ2VudC5LQUlPUyA9IGdvb2cudXNlckFnZW50LlBMQVRGT1JNX0tOT1dOXyA/XG4gICAgZ29vZy51c2VyQWdlbnQuQVNTVU1FX0tBSU9TIDpcbiAgICBnb29nLmxhYnMudXNlckFnZW50LnBsYXRmb3JtLmlzS2FpT1MoKTtcblxuXG4vKipcbiAqIEByZXR1cm4ge3N0cmluZ30gVGhlIHN0cmluZyB0aGF0IGRlc2NyaWJlcyB0aGUgdmVyc2lvbiBudW1iZXIgb2YgdGhlIHVzZXJcbiAqICAgICBhZ2VudC5cbiAqIEBwcml2YXRlXG4gKi9cbmdvb2cudXNlckFnZW50LmRldGVybWluZVZlcnNpb25fID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgLy8gQWxsIGJyb3dzZXJzIGhhdmUgZGlmZmVyZW50IHdheXMgdG8gZGV0ZWN0IHRoZSB2ZXJzaW9uIGFuZCB0aGV5IGFsbCBoYXZlXG4gIC8vIGRpZmZlcmVudCBuYW1pbmcgc2NoZW1lcy5cbiAgLy8gdmVyc2lvbiBpcyBhIHN0cmluZyByYXRoZXIgdGhhbiBhIG51bWJlciBiZWNhdXNlIGl0IG1heSBjb250YWluICdiJywgJ2EnLFxuICAvLyBhbmQgc28gb24uXG4gIHZhciB2ZXJzaW9uID0gJyc7XG4gIHZhciBhcnIgPSBnb29nLnVzZXJBZ2VudC5nZXRWZXJzaW9uUmVnZXhSZXN1bHRfKCk7XG4gIGlmIChhcnIpIHtcbiAgICB2ZXJzaW9uID0gYXJyID8gYXJyWzFdIDogJyc7XG4gIH1cblxuICBpZiAoZ29vZy51c2VyQWdlbnQuSUUpIHtcbiAgICAvLyBJRTkgY2FuIGJlIGluIGRvY3VtZW50IG1vZGUgOSBidXQgYmUgcmVwb3J0aW5nIGFuIGluY29uc2lzdGVudCB1c2VyIGFnZW50XG4gICAgLy8gdmVyc2lvbi4gIElmIGl0IGlzIGlkZW50aWZ5aW5nIGFzIGEgdmVyc2lvbiBsb3dlciB0aGFuIDkgd2UgdGFrZSB0aGVcbiAgICAvLyBkb2N1bWVudE1vZGUgYXMgdGhlIHZlcnNpb24gaW5zdGVhZC4gIElFOCBoYXMgc2ltaWxhciBiZWhhdmlvci5cbiAgICAvLyBJdCBpcyByZWNvbW1lbmRlZCB0byBzZXQgdGhlIFgtVUEtQ29tcGF0aWJsZSBoZWFkZXIgdG8gZW5zdXJlIHRoYXQgSUU5XG4gICAgLy8gdXNlcyBkb2N1bWVudE1vZGUgOS5cbiAgICB2YXIgZG9jTW9kZSA9IGdvb2cudXNlckFnZW50LmdldERvY3VtZW50TW9kZV8oKTtcbiAgICBpZiAoZG9jTW9kZSAhPSBudWxsICYmIGRvY01vZGUgPiBwYXJzZUZsb2F0KHZlcnNpb24pKSB7XG4gICAgICByZXR1cm4gU3RyaW5nKGRvY01vZGUpO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiB2ZXJzaW9uO1xufTtcblxuXG4vKipcbiAqIEByZXR1cm4gez9JQXJyYXlMaWtlPHN0cmluZz58dW5kZWZpbmVkfSBUaGUgdmVyc2lvbiByZWdleCBtYXRjaGVzIGZyb21cbiAqICAgICBwYXJzaW5nIHRoZSB1c2VyXG4gKiAgICAgYWdlbnQgc3RyaW5nLiBUaGVzZSByZWdleCBzdGF0ZW1lbnRzIG11c3QgYmUgZXhlY3V0ZWQgaW5saW5lIHNvIHRoZXkgY2FuXG4gKiAgICAgYmUgY29tcGlsZWQgb3V0IGJ5IHRoZSBjbG9zdXJlIGNvbXBpbGVyIHdpdGggdGhlIHJlc3Qgb2YgdGhlIHVzZXJhZ2VudFxuICogICAgIGRldGVjdGlvbiBsb2dpYyB3aGVuIEFTU1VNRV8qIGlzIHNwZWNpZmllZC5cbiAqIEBwcml2YXRlXG4gKi9cbmdvb2cudXNlckFnZW50LmdldFZlcnNpb25SZWdleFJlc3VsdF8gPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICB2YXIgdXNlckFnZW50ID0gZ29vZy51c2VyQWdlbnQuZ2V0VXNlckFnZW50U3RyaW5nKCk7XG4gIGlmIChnb29nLnVzZXJBZ2VudC5HRUNLTykge1xuICAgIHJldHVybiAvcnZcXDooW15cXCk7XSspKFxcKXw7KS8uZXhlYyh1c2VyQWdlbnQpO1xuICB9XG4gIGlmIChnb29nLnVzZXJBZ2VudC5FREdFKSB7XG4gICAgcmV0dXJuIC9FZGdlXFwvKFtcXGRcXC5dKykvLmV4ZWModXNlckFnZW50KTtcbiAgfVxuICBpZiAoZ29vZy51c2VyQWdlbnQuSUUpIHtcbiAgICByZXR1cm4gL1xcYig/Ok1TSUV8cnYpWzogXShbXlxcKTtdKykoXFwpfDspLy5leGVjKHVzZXJBZ2VudCk7XG4gIH1cbiAgaWYgKGdvb2cudXNlckFnZW50LldFQktJVCkge1xuICAgIC8vIFdlYktpdC8xMjUuNFxuICAgIHJldHVybiAvV2ViS2l0XFwvKFxcUyspLy5leGVjKHVzZXJBZ2VudCk7XG4gIH1cbiAgaWYgKGdvb2cudXNlckFnZW50Lk9QRVJBKSB7XG4gICAgLy8gSWYgbm9uZSBvZiB0aGUgYWJvdmUgYnJvd3NlcnMgd2VyZSBkZXRlY3RlZCBidXQgdGhlIGJyb3dzZXIgaXMgT3BlcmEsIHRoZVxuICAgIC8vIG9ubHkgc3RyaW5nIHRoYXQgaXMgb2YgaW50ZXJlc3QgaXMgJ1ZlcnNpb24vPG51bWJlcj4nLlxuICAgIHJldHVybiAvKD86VmVyc2lvbilbIFxcL10/KFxcUyspLy5leGVjKHVzZXJBZ2VudCk7XG4gIH1cbiAgcmV0dXJuIHVuZGVmaW5lZDtcbn07XG5cblxuLyoqXG4gKiBAcmV0dXJuIHtudW1iZXJ8dW5kZWZpbmVkfSBSZXR1cm5zIHRoZSBkb2N1bWVudCBtb2RlIChmb3IgdGVzdGluZykuXG4gKiBAcHJpdmF0ZVxuICovXG5nb29nLnVzZXJBZ2VudC5nZXREb2N1bWVudE1vZGVfID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgLy8gTk9URSh1c2VyKTogZ29vZy51c2VyQWdlbnQgbWF5IGJlIHVzZWQgaW4gY29udGV4dCB3aGVyZSB0aGVyZSBpcyBubyBET00uXG4gIHZhciBkb2MgPSBnb29nLmdsb2JhbFsnZG9jdW1lbnQnXTtcbiAgcmV0dXJuIGRvYyA/IGRvY1snZG9jdW1lbnRNb2RlJ10gOiB1bmRlZmluZWQ7XG59O1xuXG5cbi8qKlxuICogVGhlIHZlcnNpb24gb2YgdGhlIHVzZXIgYWdlbnQuIFRoaXMgaXMgYSBzdHJpbmcgYmVjYXVzZSBpdCBtaWdodCBjb250YWluXG4gKiAnYicgKGFzIGluIGJldGEpIGFzIHdlbGwgYXMgbXVsdGlwbGUgZG90cy5cbiAqIEB0eXBlIHtzdHJpbmd9XG4gKi9cbmdvb2cudXNlckFnZW50LlZFUlNJT04gPSBnb29nLnVzZXJBZ2VudC5kZXRlcm1pbmVWZXJzaW9uXygpO1xuXG5cbi8qKlxuICogQ29tcGFyZXMgdHdvIHZlcnNpb24gbnVtYmVycy5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gdjEgVmVyc2lvbiBvZiBmaXJzdCBpdGVtLlxuICogQHBhcmFtIHtzdHJpbmd9IHYyIFZlcnNpb24gb2Ygc2Vjb25kIGl0ZW0uXG4gKlxuICogQHJldHVybiB7bnVtYmVyfSAgMSBpZiBmaXJzdCBhcmd1bWVudCBpcyBoaWdoZXJcbiAqICAgICAgICAgICAgICAgICAgIDAgaWYgYXJndW1lbnRzIGFyZSBlcXVhbFxuICogICAgICAgICAgICAgICAgICAtMSBpZiBzZWNvbmQgYXJndW1lbnQgaXMgaGlnaGVyLlxuICogQGRlcHJlY2F0ZWQgVXNlIGdvb2cuc3RyaW5nLmNvbXBhcmVWZXJzaW9ucy5cbiAqL1xuZ29vZy51c2VyQWdlbnQuY29tcGFyZSA9IGZ1bmN0aW9uKHYxLCB2Mikge1xuICAndXNlIHN0cmljdCc7XG4gIHJldHVybiBnb29nLnN0cmluZy5jb21wYXJlVmVyc2lvbnModjEsIHYyKTtcbn07XG5cblxuLyoqXG4gKiBDYWNoZSBmb3Ige0BsaW5rIGdvb2cudXNlckFnZW50LmlzVmVyc2lvbk9ySGlnaGVyfS5cbiAqIENhbGxzIHRvIGNvbXBhcmVWZXJzaW9ucyBhcmUgc3VycHJpc2luZ2x5IGV4cGVuc2l2ZSBhbmQsIGFzIGEgYnJvd3NlcidzXG4gKiB2ZXJzaW9uIG51bWJlciBpcyB1bmxpa2VseSB0byBjaGFuZ2UgZHVyaW5nIGEgc2Vzc2lvbiwgd2UgY2FjaGUgdGhlIHJlc3VsdHMuXG4gKiBAY29uc3RcbiAqIEBwcml2YXRlXG4gKi9cbmdvb2cudXNlckFnZW50LmlzVmVyc2lvbk9ySGlnaGVyQ2FjaGVfID0ge307XG5cblxuLyoqXG4gKiBXaGV0aGVyIHRoZSB1c2VyIGFnZW50IHZlcnNpb24gaXMgaGlnaGVyIG9yIHRoZSBzYW1lIGFzIHRoZSBnaXZlbiB2ZXJzaW9uLlxuICogTk9URTogV2hlbiBjaGVja2luZyB0aGUgdmVyc2lvbiBudW1iZXJzIGZvciBGaXJlZm94IGFuZCBTYWZhcmksIGJlIHN1cmUgdG9cbiAqIHVzZSB0aGUgZW5naW5lJ3MgdmVyc2lvbiwgbm90IHRoZSBicm93c2VyJ3MgdmVyc2lvbiBudW1iZXIuICBGb3IgZXhhbXBsZSxcbiAqIEZpcmVmb3ggMy4wIGNvcnJlc3BvbmRzIHRvIEdlY2tvIDEuOSBhbmQgU2FmYXJpIDMuMCB0byBXZWJraXQgNTIyLjExLlxuICogT3BlcmEgYW5kIEludGVybmV0IEV4cGxvcmVyIHZlcnNpb25zIG1hdGNoIHRoZSBwcm9kdWN0IHJlbGVhc2UgbnVtYmVyLjxicj5cbiAqIEBzZWUgPGEgaHJlZj1cImh0dHA6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvU2FmYXJpX3ZlcnNpb25faGlzdG9yeVwiPlxuICogICAgIFdlYmtpdDwvYT5cbiAqIEBzZWUgPGEgaHJlZj1cImh0dHA6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvR2Vja29fZW5naW5lXCI+R2Vja288L2E+XG4gKlxuICogQHBhcmFtIHtzdHJpbmd8bnVtYmVyfSB2ZXJzaW9uIFRoZSB2ZXJzaW9uIHRvIGNoZWNrLlxuICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGUgdXNlciBhZ2VudCB2ZXJzaW9uIGlzIGhpZ2hlciBvciB0aGUgc2FtZSBhc1xuICogICAgIHRoZSBnaXZlbiB2ZXJzaW9uLlxuICovXG5nb29nLnVzZXJBZ2VudC5pc1ZlcnNpb25PckhpZ2hlciA9IGZ1bmN0aW9uKHZlcnNpb24pIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gZ29vZy51c2VyQWdlbnQuQVNTVU1FX0FOWV9WRVJTSU9OIHx8XG4gICAgICBnb29nLnJlZmxlY3QuY2FjaGUoXG4gICAgICAgICAgZ29vZy51c2VyQWdlbnQuaXNWZXJzaW9uT3JIaWdoZXJDYWNoZV8sIHZlcnNpb24sIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJ3VzZSBzdHJpY3QnO1xuICAgICAgICAgICAgcmV0dXJuIGdvb2cuc3RyaW5nLmNvbXBhcmVWZXJzaW9ucyhcbiAgICAgICAgICAgICAgICAgICAgICAgZ29vZy51c2VyQWdlbnQuVkVSU0lPTiwgdmVyc2lvbikgPj0gMDtcbiAgICAgICAgICB9KTtcbn07XG5cblxuLyoqXG4gKiBEZXByZWNhdGVkIGFsaWFzIHRvIGBnb29nLnVzZXJBZ2VudC5pc1ZlcnNpb25PckhpZ2hlcmAuXG4gKiBAcGFyYW0ge3N0cmluZ3xudW1iZXJ9IHZlcnNpb24gVGhlIHZlcnNpb24gdG8gY2hlY2suXG4gKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoZSB1c2VyIGFnZW50IHZlcnNpb24gaXMgaGlnaGVyIG9yIHRoZSBzYW1lIGFzXG4gKiAgICAgdGhlIGdpdmVuIHZlcnNpb24uXG4gKiBAZGVwcmVjYXRlZCBVc2UgZ29vZy51c2VyQWdlbnQuaXNWZXJzaW9uT3JIaWdoZXIoKS5cbiAqL1xuZ29vZy51c2VyQWdlbnQuaXNWZXJzaW9uID0gZ29vZy51c2VyQWdlbnQuaXNWZXJzaW9uT3JIaWdoZXI7XG5cblxuLyoqXG4gKiBXaGV0aGVyIHRoZSBJRSBlZmZlY3RpdmUgZG9jdW1lbnQgbW9kZSBpcyBoaWdoZXIgb3IgdGhlIHNhbWUgYXMgdGhlIGdpdmVuXG4gKiBkb2N1bWVudCBtb2RlIHZlcnNpb24uXG4gKiBOT1RFOiBPbmx5IGZvciBJRSwgcmV0dXJuIGZhbHNlIGZvciBhbm90aGVyIGJyb3dzZXIuXG4gKlxuICogQHBhcmFtIHtudW1iZXJ9IGRvY3VtZW50TW9kZSBUaGUgZG9jdW1lbnQgbW9kZSB2ZXJzaW9uIHRvIGNoZWNrLlxuICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGUgSUUgZWZmZWN0aXZlIGRvY3VtZW50IG1vZGUgaXMgaGlnaGVyIG9yIHRoZVxuICogICAgIHNhbWUgYXMgdGhlIGdpdmVuIHZlcnNpb24uXG4gKi9cbmdvb2cudXNlckFnZW50LmlzRG9jdW1lbnRNb2RlT3JIaWdoZXIgPSBmdW5jdGlvbihkb2N1bWVudE1vZGUpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gTnVtYmVyKGdvb2cudXNlckFnZW50LkRPQ1VNRU5UX01PREUpID49IGRvY3VtZW50TW9kZTtcbn07XG5cblxuLyoqXG4gKiBEZXByZWNhdGVkIGFsaWFzIHRvIGBnb29nLnVzZXJBZ2VudC5pc0RvY3VtZW50TW9kZU9ySGlnaGVyYC5cbiAqIEBwYXJhbSB7bnVtYmVyfSB2ZXJzaW9uIFRoZSB2ZXJzaW9uIHRvIGNoZWNrLlxuICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGUgSUUgZWZmZWN0aXZlIGRvY3VtZW50IG1vZGUgaXMgaGlnaGVyIG9yIHRoZVxuICogICAgICBzYW1lIGFzIHRoZSBnaXZlbiB2ZXJzaW9uLlxuICogQGRlcHJlY2F0ZWQgVXNlIGdvb2cudXNlckFnZW50LmlzRG9jdW1lbnRNb2RlT3JIaWdoZXIoKS5cbiAqL1xuZ29vZy51c2VyQWdlbnQuaXNEb2N1bWVudE1vZGUgPSBnb29nLnVzZXJBZ2VudC5pc0RvY3VtZW50TW9kZU9ySGlnaGVyO1xuXG5cbi8qKlxuICogRm9yIElFIHZlcnNpb24gPCA3LCBkb2N1bWVudE1vZGUgaXMgdW5kZWZpbmVkLCBzbyBhdHRlbXB0IHRvIHVzZSB0aGVcbiAqIENTUzFDb21wYXQgcHJvcGVydHkgdG8gc2VlIGlmIHdlIGFyZSBpbiBzdGFuZGFyZHMgbW9kZS4gSWYgd2UgYXJlIGluXG4gKiBzdGFuZGFyZHMgbW9kZSwgdHJlYXQgdGhlIGJyb3dzZXIgdmVyc2lvbiBhcyB0aGUgZG9jdW1lbnQgbW9kZS4gT3RoZXJ3aXNlLFxuICogSUUgaXMgZW11bGF0aW5nIHZlcnNpb24gNS5cbiAqXG4gKiBOT1RFKHVzZXIpOiBTdXBwb3J0IGZvciBJRSA8IDcgaXMgbG9uZyBnb25lLCBzbyB0aGlzIGlzIG5vdyBzaW1wbGlmaWVkLlxuICogSXQgcmV0dXJucyBkb2N1bWVudC5kb2N1bWVudE1vZGUgZm9yIElFIGFuZCB1bmRlZmluZWQgZm9yIGV2ZXJ5dGhpbmcgZWxzZS5cbiAqXG4gKiBAdHlwZSB7bnVtYmVyfHVuZGVmaW5lZH1cbiAqIEBjb25zdFxuICovXG5nb29nLnVzZXJBZ2VudC5ET0NVTUVOVF9NT0RFID0gKGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIHZhciBkb2MgPSBnb29nLmdsb2JhbFsnZG9jdW1lbnQnXTtcbiAgaWYgKCFkb2MgfHwgIWdvb2cudXNlckFnZW50LklFKSByZXR1cm4gdW5kZWZpbmVkO1xuICAvLyBUaGlzIG11c3QgYmUgYW4gSUUgdXNlciBhZ2VudC5cbiAgdmFyIGRvY3VtZW50TW9kZSA9IGdvb2cudXNlckFnZW50LmdldERvY3VtZW50TW9kZV8oKTtcbiAgaWYgKGRvY3VtZW50TW9kZSkgcmV0dXJuIGRvY3VtZW50TW9kZTtcbiAgLy8gVGhlIHVzZXIgYWdlbnQgdmVyc2lvbiBzdHJpbmcgYmVnaW5zIHdpdGggdGhlIG1ham9yIHZlcnNpb24uXG4gIC8vIFBhcnNlIHRoZSBtYWpvciB2ZXJzaW9uIGFuZCB0cnVuY2F0ZSBhbnl0aGluZyBmb2xsb3dpbmcuXG4gIHZhciBpZVZlcnNpb24gPSBwYXJzZUludChnb29nLnVzZXJBZ2VudC5WRVJTSU9OLCAxMCk7XG4gIHJldHVybiBpZVZlcnNpb24gfHwgdW5kZWZpbmVkO1xufSkoKTtcbiIsICIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgVGhlIENsb3N1cmUgTGlicmFyeSBBdXRob3JzLlxuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIEBmaWxlb3ZlcnZpZXcgQ2xvc3VyZSB1c2VyIGFnZW50IGRldGVjdGlvbiAoQnJvd3NlcikuXG4gKiBAc2VlIDxhIGhyZWY9XCJodHRwOi8vd3d3LnVzZXJhZ2VudHN0cmluZy5jb20vXCI+VXNlciBhZ2VudCBzdHJpbmdzPC9hPlxuICogRm9yIG1vcmUgaW5mb3JtYXRpb24gb24gcmVuZGVyaW5nIGVuZ2luZSwgcGxhdGZvcm0sIG9yIGRldmljZSBzZWUgdGhlIG90aGVyXG4gKiBzdWItbmFtZXNwYWNlcyBpbiBnb29nLmxhYnMudXNlckFnZW50LCBnb29nLmxhYnMudXNlckFnZW50LnBsYXRmb3JtLFxuICogZ29vZy5sYWJzLnVzZXJBZ2VudC5kZXZpY2UgcmVzcGVjdGl2ZWx5LilcbiAqL1xuXG5nb29nLnByb3ZpZGUoJ2dvb2cubGFicy51c2VyQWdlbnQuYnJvd3NlcicpO1xuXG5nb29nLnJlcXVpcmUoJ2dvb2cuYXJyYXknKTtcbmdvb2cucmVxdWlyZSgnZ29vZy5sYWJzLnVzZXJBZ2VudC51dGlsJyk7XG5nb29nLnJlcXVpcmUoJ2dvb2cub2JqZWN0Jyk7XG5nb29nLnJlcXVpcmUoJ2dvb2cuc3RyaW5nLmludGVybmFsJyk7XG5cblxuLy8gVE9ETyhubmF6ZSk6IFJlZmFjdG9yIHRvIHJlbW92ZSBleGNlc3NpdmUgZXhjbHVzaW9uIGxvZ2ljIGluIG1hdGNoaW5nXG4vLyBmdW5jdGlvbnMuXG5cblxuLyoqXG4gKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoZSB1c2VyJ3MgYnJvd3NlciBpcyBPcGVyYS4gIE5vdGU6IENocm9taXVtXG4gKiAgICAgYmFzZWQgT3BlcmEgKE9wZXJhIDE1KykgaXMgZGV0ZWN0ZWQgYXMgQ2hyb21lIHRvIGF2b2lkIHVubmVjZXNzYXJ5XG4gKiAgICAgc3BlY2lhbCBjYXNpbmcuXG4gKiBAcHJpdmF0ZVxuICovXG5nb29nLmxhYnMudXNlckFnZW50LmJyb3dzZXIubWF0Y2hPcGVyYV8gPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gZ29vZy5sYWJzLnVzZXJBZ2VudC51dGlsLm1hdGNoVXNlckFnZW50KCdPcGVyYScpO1xufTtcblxuXG4vKipcbiAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgdGhlIHVzZXIncyBicm93c2VyIGlzIElFLlxuICogQHByaXZhdGVcbiAqL1xuZ29vZy5sYWJzLnVzZXJBZ2VudC5icm93c2VyLm1hdGNoSUVfID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmV0dXJuIGdvb2cubGFicy51c2VyQWdlbnQudXRpbC5tYXRjaFVzZXJBZ2VudCgnVHJpZGVudCcpIHx8XG4gICAgICBnb29nLmxhYnMudXNlckFnZW50LnV0aWwubWF0Y2hVc2VyQWdlbnQoJ01TSUUnKTtcbn07XG5cblxuLyoqXG4gKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoZSB1c2VyJ3MgYnJvd3NlciBpcyBFZGdlLiBUaGlzIHJlZmVycyB0byBFZGdlSFRNTFxuICogYmFzZWQgRWRnZS5cbiAqIEBwcml2YXRlXG4gKi9cbmdvb2cubGFicy51c2VyQWdlbnQuYnJvd3Nlci5tYXRjaEVkZ2VIdG1sXyA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIHJldHVybiBnb29nLmxhYnMudXNlckFnZW50LnV0aWwubWF0Y2hVc2VyQWdlbnQoJ0VkZ2UnKTtcbn07XG5cblxuLyoqXG4gKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoZSB1c2VyJ3MgYnJvd3NlciBpcyBDaHJvbWl1bSBiYXNlZCBFZGdlLlxuICogQHByaXZhdGVcbiAqL1xuZ29vZy5sYWJzLnVzZXJBZ2VudC5icm93c2VyLm1hdGNoRWRnZUNocm9taXVtXyA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIHJldHVybiBnb29nLmxhYnMudXNlckFnZW50LnV0aWwubWF0Y2hVc2VyQWdlbnQoJ0VkZy8nKTtcbn07XG5cblxuLyoqXG4gKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoZSB1c2VyJ3MgYnJvd3NlciBpcyBDaHJvbWl1bSBiYXNlZCBPcGVyYS5cbiAqIEBwcml2YXRlXG4gKi9cbmdvb2cubGFicy51c2VyQWdlbnQuYnJvd3Nlci5tYXRjaE9wZXJhQ2hyb21pdW1fID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmV0dXJuIGdvb2cubGFicy51c2VyQWdlbnQudXRpbC5tYXRjaFVzZXJBZ2VudCgnT1BSJyk7XG59O1xuXG5cbi8qKlxuICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGUgdXNlcidzIGJyb3dzZXIgaXMgRmlyZWZveC5cbiAqIEBwcml2YXRlXG4gKi9cbmdvb2cubGFicy51c2VyQWdlbnQuYnJvd3Nlci5tYXRjaEZpcmVmb3hfID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmV0dXJuIGdvb2cubGFicy51c2VyQWdlbnQudXRpbC5tYXRjaFVzZXJBZ2VudCgnRmlyZWZveCcpIHx8XG4gICAgICBnb29nLmxhYnMudXNlckFnZW50LnV0aWwubWF0Y2hVc2VyQWdlbnQoJ0Z4aU9TJyk7XG59O1xuXG5cbi8qKlxuICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGUgdXNlcidzIGJyb3dzZXIgaXMgU2FmYXJpLlxuICogQHByaXZhdGVcbiAqL1xuZ29vZy5sYWJzLnVzZXJBZ2VudC5icm93c2VyLm1hdGNoU2FmYXJpXyA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIHJldHVybiBnb29nLmxhYnMudXNlckFnZW50LnV0aWwubWF0Y2hVc2VyQWdlbnQoJ1NhZmFyaScpICYmXG4gICAgICAhKGdvb2cubGFicy51c2VyQWdlbnQuYnJvd3Nlci5tYXRjaENocm9tZV8oKSB8fFxuICAgICAgICBnb29nLmxhYnMudXNlckFnZW50LmJyb3dzZXIubWF0Y2hDb2FzdF8oKSB8fFxuICAgICAgICBnb29nLmxhYnMudXNlckFnZW50LmJyb3dzZXIubWF0Y2hPcGVyYV8oKSB8fFxuICAgICAgICBnb29nLmxhYnMudXNlckFnZW50LmJyb3dzZXIubWF0Y2hFZGdlSHRtbF8oKSB8fFxuICAgICAgICBnb29nLmxhYnMudXNlckFnZW50LmJyb3dzZXIubWF0Y2hFZGdlQ2hyb21pdW1fKCkgfHxcbiAgICAgICAgZ29vZy5sYWJzLnVzZXJBZ2VudC5icm93c2VyLm1hdGNoT3BlcmFDaHJvbWl1bV8oKSB8fFxuICAgICAgICBnb29nLmxhYnMudXNlckFnZW50LmJyb3dzZXIubWF0Y2hGaXJlZm94XygpIHx8XG4gICAgICAgIGdvb2cubGFicy51c2VyQWdlbnQuYnJvd3Nlci5pc1NpbGsoKSB8fFxuICAgICAgICBnb29nLmxhYnMudXNlckFnZW50LnV0aWwubWF0Y2hVc2VyQWdlbnQoJ0FuZHJvaWQnKSk7XG59O1xuXG5cbi8qKlxuICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGUgdXNlcidzIGJyb3dzZXIgaXMgQ29hc3QgKE9wZXJhJ3MgV2Via2l0LWJhc2VkXG4gKiAgICAgaU9TIGJyb3dzZXIpLlxuICogQHByaXZhdGVcbiAqL1xuZ29vZy5sYWJzLnVzZXJBZ2VudC5icm93c2VyLm1hdGNoQ29hc3RfID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmV0dXJuIGdvb2cubGFicy51c2VyQWdlbnQudXRpbC5tYXRjaFVzZXJBZ2VudCgnQ29hc3QnKTtcbn07XG5cblxuLyoqXG4gKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoZSB1c2VyJ3MgYnJvd3NlciBpcyBpT1MgV2Vidmlldy5cbiAqIEBwcml2YXRlXG4gKi9cbmdvb2cubGFicy51c2VyQWdlbnQuYnJvd3Nlci5tYXRjaElvc1dlYnZpZXdfID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgLy8gaU9TIFdlYnZpZXcgZG9lcyBub3Qgc2hvdyB1cCBhcyBDaHJvbWUgb3IgU2FmYXJpLiBBbHNvIGNoZWNrIGZvciBPcGVyYSdzXG4gIC8vIFdlYktpdC1iYXNlZCBpT1MgYnJvd3NlciwgQ29hc3QuXG4gIHJldHVybiAoZ29vZy5sYWJzLnVzZXJBZ2VudC51dGlsLm1hdGNoVXNlckFnZW50KCdpUGFkJykgfHxcbiAgICAgICAgICBnb29nLmxhYnMudXNlckFnZW50LnV0aWwubWF0Y2hVc2VyQWdlbnQoJ2lQaG9uZScpKSAmJlxuICAgICAgIWdvb2cubGFicy51c2VyQWdlbnQuYnJvd3Nlci5tYXRjaFNhZmFyaV8oKSAmJlxuICAgICAgIWdvb2cubGFicy51c2VyQWdlbnQuYnJvd3Nlci5tYXRjaENocm9tZV8oKSAmJlxuICAgICAgIWdvb2cubGFicy51c2VyQWdlbnQuYnJvd3Nlci5tYXRjaENvYXN0XygpICYmXG4gICAgICAhZ29vZy5sYWJzLnVzZXJBZ2VudC5icm93c2VyLm1hdGNoRmlyZWZveF8oKSAmJlxuICAgICAgZ29vZy5sYWJzLnVzZXJBZ2VudC51dGlsLm1hdGNoVXNlckFnZW50KCdBcHBsZVdlYktpdCcpO1xufTtcblxuXG4vKipcbiAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgdGhlIHVzZXIncyBicm93c2VyIGlzIGFueSBDaHJvbWl1bSBicm93c2VyLiBUaGlzXG4gKiByZXR1cm5zIHRydWUgZm9yIENocm9tZSwgT3BlcmEgMTUrLCBhbmQgRWRnZSBDaHJvbWl1bS5cbiAqIEBwcml2YXRlXG4gKi9cbmdvb2cubGFicy51c2VyQWdlbnQuYnJvd3Nlci5tYXRjaENocm9tZV8gPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gKGdvb2cubGFicy51c2VyQWdlbnQudXRpbC5tYXRjaFVzZXJBZ2VudCgnQ2hyb21lJykgfHxcbiAgICAgICAgICBnb29nLmxhYnMudXNlckFnZW50LnV0aWwubWF0Y2hVc2VyQWdlbnQoJ0NyaU9TJykpICYmXG4gICAgICAhZ29vZy5sYWJzLnVzZXJBZ2VudC5icm93c2VyLm1hdGNoRWRnZUh0bWxfKCk7XG59O1xuXG5cbi8qKlxuICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGUgdXNlcidzIGJyb3dzZXIgaXMgdGhlIEFuZHJvaWQgYnJvd3Nlci5cbiAqIEBwcml2YXRlXG4gKi9cbmdvb2cubGFicy51c2VyQWdlbnQuYnJvd3Nlci5tYXRjaEFuZHJvaWRCcm93c2VyXyA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIC8vIEFuZHJvaWQgY2FuIGFwcGVhciBpbiB0aGUgdXNlciBhZ2VudCBzdHJpbmcgZm9yIENocm9tZSBvbiBBbmRyb2lkLlxuICAvLyBUaGlzIGlzIG5vdCB0aGUgQW5kcm9pZCBzdGFuZGFsb25lIGJyb3dzZXIgaWYgaXQgZG9lcy5cbiAgcmV0dXJuIGdvb2cubGFicy51c2VyQWdlbnQudXRpbC5tYXRjaFVzZXJBZ2VudCgnQW5kcm9pZCcpICYmXG4gICAgICAhKGdvb2cubGFicy51c2VyQWdlbnQuYnJvd3Nlci5pc0Nocm9tZSgpIHx8XG4gICAgICAgIGdvb2cubGFicy51c2VyQWdlbnQuYnJvd3Nlci5pc0ZpcmVmb3goKSB8fFxuICAgICAgICBnb29nLmxhYnMudXNlckFnZW50LmJyb3dzZXIuaXNPcGVyYSgpIHx8XG4gICAgICAgIGdvb2cubGFicy51c2VyQWdlbnQuYnJvd3Nlci5pc1NpbGsoKSk7XG59O1xuXG5cbi8qKlxuICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGUgdXNlcidzIGJyb3dzZXIgaXMgT3BlcmEuXG4gKi9cbmdvb2cubGFicy51c2VyQWdlbnQuYnJvd3Nlci5pc09wZXJhID0gZ29vZy5sYWJzLnVzZXJBZ2VudC5icm93c2VyLm1hdGNoT3BlcmFfO1xuXG5cbi8qKlxuICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGUgdXNlcidzIGJyb3dzZXIgaXMgSUUuXG4gKi9cbmdvb2cubGFicy51c2VyQWdlbnQuYnJvd3Nlci5pc0lFID0gZ29vZy5sYWJzLnVzZXJBZ2VudC5icm93c2VyLm1hdGNoSUVfO1xuXG5cbi8qKlxuICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGUgdXNlcidzIGJyb3dzZXIgaXMgRWRnZUhUTUwgYmFzZWQgRWRnZS5cbiAqL1xuZ29vZy5sYWJzLnVzZXJBZ2VudC5icm93c2VyLmlzRWRnZSA9IGdvb2cubGFicy51c2VyQWdlbnQuYnJvd3Nlci5tYXRjaEVkZ2VIdG1sXztcblxuXG4vKipcbiAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgdGhlIHVzZXIncyBicm93c2VyIGlzIENocm9taXVtIGJhc2VkIEVkZ2UuXG4gKi9cbmdvb2cubGFicy51c2VyQWdlbnQuYnJvd3Nlci5pc0VkZ2VDaHJvbWl1bSA9XG4gICAgZ29vZy5sYWJzLnVzZXJBZ2VudC5icm93c2VyLm1hdGNoRWRnZUNocm9taXVtXztcblxuLyoqXG4gKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoZSB1c2VyJ3MgYnJvd3NlciBpcyBDaHJvbWl1bSBiYXNlZCBPcGVyYS5cbiAqL1xuZ29vZy5sYWJzLnVzZXJBZ2VudC5icm93c2VyLmlzT3BlcmFDaHJvbWl1bSA9XG4gICAgZ29vZy5sYWJzLnVzZXJBZ2VudC5icm93c2VyLm1hdGNoT3BlcmFDaHJvbWl1bV87XG5cbi8qKlxuICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGUgdXNlcidzIGJyb3dzZXIgaXMgRmlyZWZveC5cbiAqL1xuZ29vZy5sYWJzLnVzZXJBZ2VudC5icm93c2VyLmlzRmlyZWZveCA9XG4gICAgZ29vZy5sYWJzLnVzZXJBZ2VudC5icm93c2VyLm1hdGNoRmlyZWZveF87XG5cblxuLyoqXG4gKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoZSB1c2VyJ3MgYnJvd3NlciBpcyBTYWZhcmkuXG4gKi9cbmdvb2cubGFicy51c2VyQWdlbnQuYnJvd3Nlci5pc1NhZmFyaSA9IGdvb2cubGFicy51c2VyQWdlbnQuYnJvd3Nlci5tYXRjaFNhZmFyaV87XG5cblxuLyoqXG4gKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoZSB1c2VyJ3MgYnJvd3NlciBpcyBDb2FzdCAoT3BlcmEncyBXZWJraXQtYmFzZWRcbiAqICAgICBpT1MgYnJvd3NlcikuXG4gKi9cbmdvb2cubGFicy51c2VyQWdlbnQuYnJvd3Nlci5pc0NvYXN0ID0gZ29vZy5sYWJzLnVzZXJBZ2VudC5icm93c2VyLm1hdGNoQ29hc3RfO1xuXG5cbi8qKlxuICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGUgdXNlcidzIGJyb3dzZXIgaXMgaU9TIFdlYnZpZXcuXG4gKi9cbmdvb2cubGFicy51c2VyQWdlbnQuYnJvd3Nlci5pc0lvc1dlYnZpZXcgPVxuICAgIGdvb2cubGFicy51c2VyQWdlbnQuYnJvd3Nlci5tYXRjaElvc1dlYnZpZXdfO1xuXG5cbi8qKlxuICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGUgdXNlcidzIGJyb3dzZXIgaXMgYW55IENocm9taXVtIGJhc2VkIGJyb3dzZXIgKFxuICogQ2hyb21lLCBCbGluay1iYXNlZCBPcGVyYSAoMTUrKSBhbmQgRWRnZSBDaHJvbWl1bSkuXG4gKi9cbmdvb2cubGFicy51c2VyQWdlbnQuYnJvd3Nlci5pc0Nocm9tZSA9IGdvb2cubGFicy51c2VyQWdlbnQuYnJvd3Nlci5tYXRjaENocm9tZV87XG5cblxuLyoqXG4gKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoZSB1c2VyJ3MgYnJvd3NlciBpcyB0aGUgQW5kcm9pZCBicm93c2VyLlxuICovXG5nb29nLmxhYnMudXNlckFnZW50LmJyb3dzZXIuaXNBbmRyb2lkQnJvd3NlciA9XG4gICAgZ29vZy5sYWJzLnVzZXJBZ2VudC5icm93c2VyLm1hdGNoQW5kcm9pZEJyb3dzZXJfO1xuXG5cbi8qKlxuICogRm9yIG1vcmUgaW5mb3JtYXRpb24sIHNlZTpcbiAqIGh0dHA6Ly9kb2NzLmF3cy5hbWF6b24uY29tL3NpbGsvbGF0ZXN0L2RldmVsb3Blcmd1aWRlL3VzZXItYWdlbnQuaHRtbFxuICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGUgdXNlcidzIGJyb3dzZXIgaXMgU2lsay5cbiAqL1xuZ29vZy5sYWJzLnVzZXJBZ2VudC5icm93c2VyLmlzU2lsayA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIHJldHVybiBnb29nLmxhYnMudXNlckFnZW50LnV0aWwubWF0Y2hVc2VyQWdlbnQoJ1NpbGsnKTtcbn07XG5cblxuLyoqXG4gKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSBicm93c2VyIHZlcnNpb24gb3IgZW1wdHkgc3RyaW5nIGlmIHZlcnNpb24gY2Fubm90IGJlXG4gKiAgICAgZGV0ZXJtaW5lZC4gTm90ZSB0aGF0IGZvciBJbnRlcm5ldCBFeHBsb3JlciwgdGhpcyByZXR1cm5zIHRoZSB2ZXJzaW9uIG9mXG4gKiAgICAgdGhlIGJyb3dzZXIsIG5vdCB0aGUgdmVyc2lvbiBvZiB0aGUgcmVuZGVyaW5nIGVuZ2luZS4gKElFIDggaW5cbiAqICAgICBjb21wYXRpYmlsaXR5IG1vZGUgd2lsbCByZXR1cm4gOC4wIHJhdGhlciB0aGFuIDcuMC4gVG8gZGV0ZXJtaW5lIHRoZVxuICogICAgIHJlbmRlcmluZyBlbmdpbmUgdmVyc2lvbiwgbG9vayBhdCBkb2N1bWVudC5kb2N1bWVudE1vZGUgaW5zdGVhZC4gU2VlXG4gKiAgICAgaHR0cDovL21zZG4ubWljcm9zb2Z0LmNvbS9lbi11cy9saWJyYXJ5L2NjMTk2OTg4KHY9dnMuODUpLmFzcHggZm9yIG1vcmVcbiAqICAgICBkZXRhaWxzLilcbiAqL1xuZ29vZy5sYWJzLnVzZXJBZ2VudC5icm93c2VyLmdldFZlcnNpb24gPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICB2YXIgdXNlckFnZW50U3RyaW5nID0gZ29vZy5sYWJzLnVzZXJBZ2VudC51dGlsLmdldFVzZXJBZ2VudCgpO1xuICAvLyBTcGVjaWFsIGNhc2UgSUUgc2luY2UgSUUncyB2ZXJzaW9uIGlzIGluc2lkZSB0aGUgcGFyZW50aGVzaXMgYW5kXG4gIC8vIHdpdGhvdXQgdGhlICcvJy5cbiAgaWYgKGdvb2cubGFicy51c2VyQWdlbnQuYnJvd3Nlci5pc0lFKCkpIHtcbiAgICByZXR1cm4gZ29vZy5sYWJzLnVzZXJBZ2VudC5icm93c2VyLmdldElFVmVyc2lvbl8odXNlckFnZW50U3RyaW5nKTtcbiAgfVxuXG4gIHZhciB2ZXJzaW9uVHVwbGVzID1cbiAgICAgIGdvb2cubGFicy51c2VyQWdlbnQudXRpbC5leHRyYWN0VmVyc2lvblR1cGxlcyh1c2VyQWdlbnRTdHJpbmcpO1xuXG4gIC8vIENvbnN0cnVjdCBhIG1hcCBmb3IgZWFzeSBsb29rdXAuXG4gIHZhciB2ZXJzaW9uTWFwID0ge307XG4gIGdvb2cuYXJyYXkuZm9yRWFjaCh2ZXJzaW9uVHVwbGVzLCBmdW5jdGlvbih0dXBsZSkge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICAvLyBOb3RlIHRoYXQgdGhlIHR1cGxlIGlzIG9mIGxlbmd0aCB0aHJlZSwgYnV0IHdlIG9ubHkgY2FyZSBhYm91dCB0aGVcbiAgICAvLyBmaXJzdCB0d28uXG4gICAgdmFyIGtleSA9IHR1cGxlWzBdO1xuICAgIHZhciB2YWx1ZSA9IHR1cGxlWzFdO1xuICAgIHZlcnNpb25NYXBba2V5XSA9IHZhbHVlO1xuICB9KTtcblxuICB2YXIgdmVyc2lvbk1hcEhhc0tleSA9IGdvb2cucGFydGlhbChnb29nLm9iamVjdC5jb250YWluc0tleSwgdmVyc2lvbk1hcCk7XG5cbiAgLy8gR2l2ZXMgdGhlIHZhbHVlIHdpdGggdGhlIGZpcnN0IGtleSBpdCBmaW5kcywgb3RoZXJ3aXNlIGVtcHR5IHN0cmluZy5cbiAgZnVuY3Rpb24gbG9va1VwVmFsdWVXaXRoS2V5cyhrZXlzKSB7XG4gICAgdmFyIGtleSA9IGdvb2cuYXJyYXkuZmluZChrZXlzLCB2ZXJzaW9uTWFwSGFzS2V5KTtcbiAgICByZXR1cm4gdmVyc2lvbk1hcFtrZXldIHx8ICcnO1xuICB9XG5cbiAgLy8gQ2hlY2sgT3BlcmEgYmVmb3JlIENocm9tZSBzaW5jZSBPcGVyYSAxNSsgaGFzIFwiQ2hyb21lXCIgaW4gdGhlIHN0cmluZy5cbiAgLy8gU2VlXG4gIC8vIGh0dHA6Ly9teS5vcGVyYS5jb20vT0RJTi9ibG9nLzIwMTMvMDcvMTUvb3BlcmEtdXNlci1hZ2VudC1zdHJpbmdzLW9wZXJhLTE1LWFuZC1iZXlvbmRcbiAgaWYgKGdvb2cubGFicy51c2VyQWdlbnQuYnJvd3Nlci5pc09wZXJhKCkpIHtcbiAgICAvLyBPcGVyYSAxMCBoYXMgVmVyc2lvbi8xMC4wIGJ1dCBPcGVyYS85LjgsIHNvIGxvb2sgZm9yIFwiVmVyc2lvblwiIGZpcnN0LlxuICAgIC8vIE9wZXJhIHVzZXMgJ09QUicgZm9yIG1vcmUgcmVjZW50IFVBcy5cbiAgICByZXR1cm4gbG9va1VwVmFsdWVXaXRoS2V5cyhbJ1ZlcnNpb24nLCAnT3BlcmEnXSk7XG4gIH1cblxuICAvLyBDaGVjayBFZGdlIGJlZm9yZSBDaHJvbWUgc2luY2UgaXQgaGFzIENocm9tZSBpbiB0aGUgc3RyaW5nLlxuICBpZiAoZ29vZy5sYWJzLnVzZXJBZ2VudC5icm93c2VyLmlzRWRnZSgpKSB7XG4gICAgcmV0dXJuIGxvb2tVcFZhbHVlV2l0aEtleXMoWydFZGdlJ10pO1xuICB9XG5cbiAgLy8gQ2hlY2sgQ2hyb21pdW0gRWRnZSBiZWZvcmUgQ2hyb21lIHNpbmNlIGl0IGhhcyBDaHJvbWUgaW4gdGhlIHN0cmluZy5cbiAgaWYgKGdvb2cubGFicy51c2VyQWdlbnQuYnJvd3Nlci5pc0VkZ2VDaHJvbWl1bSgpKSB7XG4gICAgcmV0dXJuIGxvb2tVcFZhbHVlV2l0aEtleXMoWydFZGcnXSk7XG4gIH1cblxuICBpZiAoZ29vZy5sYWJzLnVzZXJBZ2VudC5icm93c2VyLmlzQ2hyb21lKCkpIHtcbiAgICByZXR1cm4gbG9va1VwVmFsdWVXaXRoS2V5cyhbJ0Nocm9tZScsICdDcmlPUycsICdIZWFkbGVzc0Nocm9tZSddKTtcbiAgfVxuXG4gIC8vIFVzdWFsbHkgcHJvZHVjdHMgYnJvd3NlciB2ZXJzaW9ucyBhcmUgaW4gdGhlIHRoaXJkIHR1cGxlIGFmdGVyIFwiTW96aWxsYVwiXG4gIC8vIGFuZCB0aGUgZW5naW5lLlxuICB2YXIgdHVwbGUgPSB2ZXJzaW9uVHVwbGVzWzJdO1xuICByZXR1cm4gdHVwbGUgJiYgdHVwbGVbMV0gfHwgJyc7XG59O1xuXG5cbi8qKlxuICogQHBhcmFtIHtzdHJpbmd8bnVtYmVyfSB2ZXJzaW9uIFRoZSB2ZXJzaW9uIHRvIGNoZWNrLlxuICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGUgYnJvd3NlciB2ZXJzaW9uIGlzIGhpZ2hlciBvciB0aGUgc2FtZSBhcyB0aGVcbiAqICAgICBnaXZlbiB2ZXJzaW9uLlxuICovXG5nb29nLmxhYnMudXNlckFnZW50LmJyb3dzZXIuaXNWZXJzaW9uT3JIaWdoZXIgPSBmdW5jdGlvbih2ZXJzaW9uKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmV0dXJuIGdvb2cuc3RyaW5nLmludGVybmFsLmNvbXBhcmVWZXJzaW9ucyhcbiAgICAgICAgICAgICBnb29nLmxhYnMudXNlckFnZW50LmJyb3dzZXIuZ2V0VmVyc2lvbigpLCB2ZXJzaW9uKSA+PSAwO1xufTtcblxuXG4vKipcbiAqIERldGVybWluZXMgSUUgdmVyc2lvbi4gTW9yZSBpbmZvcm1hdGlvbjpcbiAqIGh0dHA6Ly9tc2RuLm1pY3Jvc29mdC5jb20vZW4tdXMvbGlicmFyeS9pZS9iZzE4MjYyNSh2PXZzLjg1KS5hc3B4I3VhU3RyaW5nXG4gKiBodHRwOi8vbXNkbi5taWNyb3NvZnQuY29tL2VuLXVzL2xpYnJhcnkvaGg4NjkzMDEodj12cy44NSkuYXNweFxuICogaHR0cDovL2Jsb2dzLm1zZG4uY29tL2IvaWUvYXJjaGl2ZS8yMDEwLzAzLzIzL2ludHJvZHVjaW5nLWllOS1zLXVzZXItYWdlbnQtc3RyaW5nLmFzcHhcbiAqIGh0dHA6Ly9ibG9ncy5tc2RuLmNvbS9iL2llL2FyY2hpdmUvMjAwOS8wMS8wOS90aGUtaW50ZXJuZXQtZXhwbG9yZXItOC11c2VyLWFnZW50LXN0cmluZy11cGRhdGVkLWVkaXRpb24uYXNweFxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSB1c2VyQWdlbnQgdGhlIFVzZXItQWdlbnQuXG4gKiBAcmV0dXJuIHtzdHJpbmd9XG4gKiBAcHJpdmF0ZVxuICovXG5nb29nLmxhYnMudXNlckFnZW50LmJyb3dzZXIuZ2V0SUVWZXJzaW9uXyA9IGZ1bmN0aW9uKHVzZXJBZ2VudCkge1xuICAndXNlIHN0cmljdCc7XG4gIC8vIElFMTEgbWF5IGlkZW50aWZ5IGl0c2VsZiBhcyBNU0lFIDkuMCBvciBNU0lFIDEwLjAgZHVlIHRvIGFuIElFIDExIHVwZ3JhZGVcbiAgLy8gYnVnLiBFeGFtcGxlIFVBOlxuICAvLyBNb3ppbGxhLzUuMCAoTVNJRSA5LjA7IFdpbmRvd3MgTlQgNi4xOyBXT1c2NDsgVHJpZGVudC83LjA7IHJ2OjExLjApXG4gIC8vIGxpa2UgR2Vja28uXG4gIC8vIFNlZSBodHRwOi8vd3d3LndoYXRpc215YnJvd3Nlci5jb20vZGV2ZWxvcGVycy91bmtub3duLXVzZXItYWdlbnQtZnJhZ21lbnRzLlxuICB2YXIgcnYgPSAvcnY6ICooW1xcZFxcLl0qKS8uZXhlYyh1c2VyQWdlbnQpO1xuICBpZiAocnYgJiYgcnZbMV0pIHtcbiAgICByZXR1cm4gcnZbMV07XG4gIH1cblxuICB2YXIgdmVyc2lvbiA9ICcnO1xuICB2YXIgbXNpZSA9IC9NU0lFICsoW1xcZFxcLl0rKS8uZXhlYyh1c2VyQWdlbnQpO1xuICBpZiAobXNpZSAmJiBtc2llWzFdKSB7XG4gICAgLy8gSUUgaW4gY29tcGF0aWJpbGl0eSBtb2RlIHVzdWFsbHkgaWRlbnRpZmllcyBpdHNlbGYgYXMgTVNJRSA3LjA7IGluIHRoaXNcbiAgICAvLyBjYXNlLCB1c2UgdGhlIFRyaWRlbnQgdmVyc2lvbiB0byBkZXRlcm1pbmUgdGhlIHZlcnNpb24gb2YgSUUuIEZvciBtb3JlXG4gICAgLy8gZGV0YWlscywgc2VlIHRoZSBsaW5rcyBhYm92ZS5cbiAgICB2YXIgdHJpZGVudFZlcnNpb24gPSAvVHJpZGVudFxcLyhcXGQuXFxkKS8uZXhlYyh1c2VyQWdlbnQpO1xuICAgIGlmIChtc2llWzFdID09ICc3LjAnKSB7XG4gICAgICBpZiAodHJpZGVudFZlcnNpb24gJiYgdHJpZGVudFZlcnNpb25bMV0pIHtcbiAgICAgICAgc3dpdGNoICh0cmlkZW50VmVyc2lvblsxXSkge1xuICAgICAgICAgIGNhc2UgJzQuMCc6XG4gICAgICAgICAgICB2ZXJzaW9uID0gJzguMCc7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlICc1LjAnOlxuICAgICAgICAgICAgdmVyc2lvbiA9ICc5LjAnO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSAnNi4wJzpcbiAgICAgICAgICAgIHZlcnNpb24gPSAnMTAuMCc7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlICc3LjAnOlxuICAgICAgICAgICAgdmVyc2lvbiA9ICcxMS4wJztcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2ZXJzaW9uID0gJzcuMCc7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHZlcnNpb24gPSBtc2llWzFdO1xuICAgIH1cbiAgfVxuICByZXR1cm4gdmVyc2lvbjtcbn07XG4iLCAiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IFRoZSBDbG9zdXJlIExpYnJhcnkgQXV0aG9ycy5cbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBAZmlsZW92ZXJ2aWV3IENsb3N1cmUgdXNlciBhZ2VudCBkZXRlY3Rpb24uXG4gKiBAc2VlIGh0dHA6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvVXNlcl9hZ2VudFxuICogRm9yIG1vcmUgaW5mb3JtYXRpb24gb24gYnJvd3NlciBicmFuZCwgcGxhdGZvcm0sIG9yIGRldmljZSBzZWUgdGhlIG90aGVyXG4gKiBzdWItbmFtZXNwYWNlcyBpbiBnb29nLmxhYnMudXNlckFnZW50IChicm93c2VyLCBwbGF0Zm9ybSwgYW5kIGRldmljZSkuXG4gKi9cblxuZ29vZy5wcm92aWRlKCdnb29nLmxhYnMudXNlckFnZW50LmVuZ2luZScpO1xuXG5nb29nLnJlcXVpcmUoJ2dvb2cuYXJyYXknKTtcbmdvb2cucmVxdWlyZSgnZ29vZy5sYWJzLnVzZXJBZ2VudC51dGlsJyk7XG5nb29nLnJlcXVpcmUoJ2dvb2cuc3RyaW5nJyk7XG5cblxuLyoqXG4gKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoZSByZW5kZXJpbmcgZW5naW5lIGlzIFByZXN0by5cbiAqL1xuZ29vZy5sYWJzLnVzZXJBZ2VudC5lbmdpbmUuaXNQcmVzdG8gPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gZ29vZy5sYWJzLnVzZXJBZ2VudC51dGlsLm1hdGNoVXNlckFnZW50KCdQcmVzdG8nKTtcbn07XG5cblxuLyoqXG4gKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoZSByZW5kZXJpbmcgZW5naW5lIGlzIFRyaWRlbnQuXG4gKi9cbmdvb2cubGFicy51c2VyQWdlbnQuZW5naW5lLmlzVHJpZGVudCA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIC8vIElFIG9ubHkgc3RhcnRlZCBpbmNsdWRpbmcgdGhlIFRyaWRlbnQgdG9rZW4gaW4gSUU4LlxuICByZXR1cm4gZ29vZy5sYWJzLnVzZXJBZ2VudC51dGlsLm1hdGNoVXNlckFnZW50KCdUcmlkZW50JykgfHxcbiAgICAgIGdvb2cubGFicy51c2VyQWdlbnQudXRpbC5tYXRjaFVzZXJBZ2VudCgnTVNJRScpO1xufTtcblxuXG4vKipcbiAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgdGhlIHJlbmRlcmluZyBlbmdpbmUgaXMgRWRnZUhUTUwuXG4gKi9cbmdvb2cubGFicy51c2VyQWdlbnQuZW5naW5lLmlzRWRnZSA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIHJldHVybiBnb29nLmxhYnMudXNlckFnZW50LnV0aWwubWF0Y2hVc2VyQWdlbnQoJ0VkZ2UnKTtcbn07XG5cblxuLyoqXG4gKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoZSByZW5kZXJpbmcgZW5naW5lIGlzIFdlYktpdC4gVGhpcyB3aWxsIHJldHVyblxuICogdHJ1ZSBmb3IgQ2hyb21lLCBCbGluay1iYXNlZCBPcGVyYSAoMTUrKSwgRWRnZSBDaHJvbWl1bSBhbmQgU2FmYXJpLlxuICovXG5nb29nLmxhYnMudXNlckFnZW50LmVuZ2luZS5pc1dlYktpdCA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIHJldHVybiBnb29nLmxhYnMudXNlckFnZW50LnV0aWwubWF0Y2hVc2VyQWdlbnRJZ25vcmVDYXNlKCdXZWJLaXQnKSAmJlxuICAgICAgIWdvb2cubGFicy51c2VyQWdlbnQuZW5naW5lLmlzRWRnZSgpO1xufTtcblxuXG4vKipcbiAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgdGhlIHJlbmRlcmluZyBlbmdpbmUgaXMgR2Vja28uXG4gKi9cbmdvb2cubGFicy51c2VyQWdlbnQuZW5naW5lLmlzR2Vja28gPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gZ29vZy5sYWJzLnVzZXJBZ2VudC51dGlsLm1hdGNoVXNlckFnZW50KCdHZWNrbycpICYmXG4gICAgICAhZ29vZy5sYWJzLnVzZXJBZ2VudC5lbmdpbmUuaXNXZWJLaXQoKSAmJlxuICAgICAgIWdvb2cubGFicy51c2VyQWdlbnQuZW5naW5lLmlzVHJpZGVudCgpICYmXG4gICAgICAhZ29vZy5sYWJzLnVzZXJBZ2VudC5lbmdpbmUuaXNFZGdlKCk7XG59O1xuXG5cbi8qKlxuICogQHJldHVybiB7c3RyaW5nfSBUaGUgcmVuZGVyaW5nIGVuZ2luZSdzIHZlcnNpb24gb3IgZW1wdHkgc3RyaW5nIGlmIHZlcnNpb25cbiAqICAgICBjYW4ndCBiZSBkZXRlcm1pbmVkLlxuICovXG5nb29nLmxhYnMudXNlckFnZW50LmVuZ2luZS5nZXRWZXJzaW9uID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgdmFyIHVzZXJBZ2VudFN0cmluZyA9IGdvb2cubGFicy51c2VyQWdlbnQudXRpbC5nZXRVc2VyQWdlbnQoKTtcbiAgaWYgKHVzZXJBZ2VudFN0cmluZykge1xuICAgIHZhciB0dXBsZXMgPSBnb29nLmxhYnMudXNlckFnZW50LnV0aWwuZXh0cmFjdFZlcnNpb25UdXBsZXModXNlckFnZW50U3RyaW5nKTtcblxuICAgIHZhciBlbmdpbmVUdXBsZSA9IGdvb2cubGFicy51c2VyQWdlbnQuZW5naW5lLmdldEVuZ2luZVR1cGxlXyh0dXBsZXMpO1xuICAgIGlmIChlbmdpbmVUdXBsZSkge1xuICAgICAgLy8gSW4gR2Vja28sIHRoZSB2ZXJzaW9uIHN0cmluZyBpcyBlaXRoZXIgaW4gdGhlIGJyb3dzZXIgaW5mbyBvciB0aGVcbiAgICAgIC8vIEZpcmVmb3ggdmVyc2lvbi4gIFNlZSBHZWNrbyB1c2VyIGFnZW50IHN0cmluZyByZWZlcmVuY2U6XG4gICAgICAvLyBodHRwOi8vZ29vLmdsL21VTHFhXG4gICAgICBpZiAoZW5naW5lVHVwbGVbMF0gPT0gJ0dlY2tvJykge1xuICAgICAgICByZXR1cm4gZ29vZy5sYWJzLnVzZXJBZ2VudC5lbmdpbmUuZ2V0VmVyc2lvbkZvcktleV8odHVwbGVzLCAnRmlyZWZveCcpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gZW5naW5lVHVwbGVbMV07XG4gICAgfVxuXG4gICAgLy8gTVNJRSBoYXMgb25seSBvbmUgdmVyc2lvbiBpZGVudGlmaWVyLCBhbmQgdGhlIFRyaWRlbnQgdmVyc2lvbiBpc1xuICAgIC8vIHNwZWNpZmllZCBpbiB0aGUgcGFyZW50aGV0aWNhbC4gSUUgRWRnZSBpcyBjb3ZlcmVkIGluIHRoZSBlbmdpbmUgdHVwbGVcbiAgICAvLyBkZXRlY3Rpb24uXG4gICAgdmFyIGJyb3dzZXJUdXBsZSA9IHR1cGxlc1swXTtcbiAgICB2YXIgaW5mbztcbiAgICBpZiAoYnJvd3NlclR1cGxlICYmIChpbmZvID0gYnJvd3NlclR1cGxlWzJdKSkge1xuICAgICAgdmFyIG1hdGNoID0gL1RyaWRlbnRcXC8oW15cXHM7XSspLy5leGVjKGluZm8pO1xuICAgICAgaWYgKG1hdGNoKSB7XG4gICAgICAgIHJldHVybiBtYXRjaFsxXTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuICcnO1xufTtcblxuXG4vKipcbiAqIEBwYXJhbSB7IUFycmF5PCFBcnJheTxzdHJpbmc+Pn0gdHVwbGVzIEV4dHJhY3RlZCB2ZXJzaW9uIHR1cGxlcy5cbiAqIEByZXR1cm4geyFBcnJheTxzdHJpbmc+fHVuZGVmaW5lZH0gVGhlIGVuZ2luZSB0dXBsZSBvciB1bmRlZmluZWQgaWYgbm90XG4gKiAgICAgZm91bmQuXG4gKiBAcHJpdmF0ZVxuICovXG5nb29nLmxhYnMudXNlckFnZW50LmVuZ2luZS5nZXRFbmdpbmVUdXBsZV8gPSBmdW5jdGlvbih0dXBsZXMpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBpZiAoIWdvb2cubGFicy51c2VyQWdlbnQuZW5naW5lLmlzRWRnZSgpKSB7XG4gICAgcmV0dXJuIHR1cGxlc1sxXTtcbiAgfVxuICBmb3IgKHZhciBpID0gMDsgaSA8IHR1cGxlcy5sZW5ndGg7IGkrKykge1xuICAgIHZhciB0dXBsZSA9IHR1cGxlc1tpXTtcbiAgICBpZiAodHVwbGVbMF0gPT0gJ0VkZ2UnKSB7XG4gICAgICByZXR1cm4gdHVwbGU7XG4gICAgfVxuICB9XG59O1xuXG5cbi8qKlxuICogQHBhcmFtIHtzdHJpbmd8bnVtYmVyfSB2ZXJzaW9uIFRoZSB2ZXJzaW9uIHRvIGNoZWNrLlxuICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGUgcmVuZGVyaW5nIGVuZ2luZSB2ZXJzaW9uIGlzIGhpZ2hlciBvciB0aGUgc2FtZVxuICogICAgIGFzIHRoZSBnaXZlbiB2ZXJzaW9uLlxuICovXG5nb29nLmxhYnMudXNlckFnZW50LmVuZ2luZS5pc1ZlcnNpb25PckhpZ2hlciA9IGZ1bmN0aW9uKHZlcnNpb24pIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gZ29vZy5zdHJpbmcuY29tcGFyZVZlcnNpb25zKFxuICAgICAgICAgICAgIGdvb2cubGFicy51c2VyQWdlbnQuZW5naW5lLmdldFZlcnNpb24oKSwgdmVyc2lvbikgPj0gMDtcbn07XG5cblxuLyoqXG4gKiBAcGFyYW0geyFBcnJheTwhQXJyYXk8c3RyaW5nPj59IHR1cGxlcyBWZXJzaW9uIHR1cGxlcy5cbiAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIGtleSB0byBsb29rIGZvci5cbiAqIEByZXR1cm4ge3N0cmluZ30gVGhlIHZlcnNpb24gc3RyaW5nIG9mIHRoZSBnaXZlbiBrZXksIGlmIHByZXNlbnQuXG4gKiAgICAgT3RoZXJ3aXNlLCB0aGUgZW1wdHkgc3RyaW5nLlxuICogQHByaXZhdGVcbiAqL1xuZ29vZy5sYWJzLnVzZXJBZ2VudC5lbmdpbmUuZ2V0VmVyc2lvbkZvcktleV8gPSBmdW5jdGlvbih0dXBsZXMsIGtleSkge1xuICAndXNlIHN0cmljdCc7XG4gIC8vIFRPRE8obm5hemUpOiBNb3ZlIHRvIHV0aWwgaWYgdXNlZnVsIGVsc2V3aGVyZS5cblxuICB2YXIgcGFpciA9IGdvb2cuYXJyYXkuZmluZCh0dXBsZXMsIGZ1bmN0aW9uKHBhaXIpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgcmV0dXJuIGtleSA9PSBwYWlyWzBdO1xuICB9KTtcblxuICByZXR1cm4gcGFpciAmJiBwYWlyWzFdIHx8ICcnO1xufTtcbiIsICIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgVGhlIENsb3N1cmUgTGlicmFyeSBBdXRob3JzLlxuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIEBmaWxlb3ZlcnZpZXcgQnJvd3NlciBjYXBhYmlsaXR5IGNoZWNrcyBmb3IgdGhlIGV2ZW50cyBwYWNrYWdlLlxuICovXG5cbmdvb2cubW9kdWxlKCdnb29nLmV2ZW50cy5Ccm93c2VyRmVhdHVyZScpO1xuZ29vZy5tb2R1bGUuZGVjbGFyZUxlZ2FjeU5hbWVzcGFjZSgpO1xuXG5cbi8qKlxuICogVHJpY2tzIENsb3N1cmUgQ29tcGlsZXIgaW50byBiZWxpZXZpbmcgdGhhdCBhIGZ1bmN0aW9uIGlzIHB1cmUuICBUaGUgY29tcGlsZXJcbiAqIGFzc3VtZXMgdGhhdCBhbnkgYHZhbHVlT2ZgIGZ1bmN0aW9uIGlzIHB1cmUsIHdpdGhvdXQgYW5hbHl6aW5nIGl0cyBjb250ZW50cy5cbiAqXG4gKiBAcGFyYW0ge2Z1bmN0aW9uKCk6IFR9IGZuXG4gKiBAcmV0dXJuIHtUfVxuICogQHRlbXBsYXRlIFRcbiAqL1xuY29uc3QgcHVyaWZ5ID0gKGZuKSA9PiB7XG4gIHJldHVybiAoe3ZhbHVlT2Y6IGZufSkudmFsdWVPZigpO1xufTtcblxuXG4vKipcbiAqIEVudW0gb2YgYnJvd3NlciBjYXBhYmlsaXRpZXMuXG4gKiBAZW51bSB7Ym9vbGVhbn1cbiAqL1xuZXhwb3J0cyA9IHtcbiAgLyoqXG4gICAqIFdoZXRoZXIgdGhlIGJ1dHRvbiBhdHRyaWJ1dGUgb2YgdGhlIGV2ZW50IGlzIFczQyBjb21wbGlhbnQuICBGYWxzZSBpblxuICAgKiBJbnRlcm5ldCBFeHBsb3JlciBwcmlvciB0byB2ZXJzaW9uIDk7IGRvY3VtZW50LXZlcnNpb24gZGVwZW5kZW50LlxuICAgKi9cbiAgSEFTX1czQ19CVVRUT046IHRydWUsXG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgdGhlIGJyb3dzZXIgc3VwcG9ydHMgZnVsbCBXM0MgZXZlbnQgbW9kZWwuXG4gICAqL1xuICBIQVNfVzNDX0VWRU5UX1NVUFBPUlQ6IHRydWUsXG5cbiAgLyoqXG4gICAqIFRvIHByZXZlbnQgZGVmYXVsdCBpbiBJRTctOCBmb3IgY2VydGFpbiBrZXlkb3duIGV2ZW50cyB3ZSBuZWVkIHNldCB0aGVcbiAgICoga2V5Q29kZSB0byAtMS5cbiAgICovXG4gIFNFVF9LRVlfQ09ERV9UT19QUkVWRU5UX0RFRkFVTFQ6IGZhbHNlLFxuXG4gIC8qKlxuICAgKiBXaGV0aGVyIHRoZSBgbmF2aWdhdG9yLm9uTGluZWAgcHJvcGVydHkgaXMgc3VwcG9ydGVkLlxuICAgKi9cbiAgSEFTX05BVklHQVRPUl9PTkxJTkVfUFJPUEVSVFk6IHRydWUsXG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgSFRNTDUgbmV0d29yayBvbmxpbmUvb2ZmbGluZSBldmVudHMgYXJlIHN1cHBvcnRlZC5cbiAgICovXG4gIEhBU19IVE1MNV9ORVRXT1JLX0VWRU5UX1NVUFBPUlQ6IHRydWUsXG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgSFRNTDUgbmV0d29yayBldmVudHMgZmlyZSBvbiBkb2N1bWVudC5ib2R5LCBvciBvdGhlcndpc2UgdGhlXG4gICAqIHdpbmRvdy5cbiAgICovXG4gIEhUTUw1X05FVFdPUktfRVZFTlRTX0ZJUkVfT05fQk9EWTogZmFsc2UsXG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgdG91Y2ggaXMgZW5hYmxlZCBpbiB0aGUgYnJvd3Nlci5cbiAgICovXG4gIFRPVUNIX0VOQUJMRUQ6XG4gICAgICAoJ29udG91Y2hzdGFydCcgaW4gZ29vZy5nbG9iYWwgfHxcbiAgICAgICAhIShnb29nLmdsb2JhbFsnZG9jdW1lbnQnXSAmJiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQgJiZcbiAgICAgICAgICAnb250b3VjaHN0YXJ0JyBpbiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQpIHx8XG4gICAgICAgLy8gSUUxMCB1c2VzIG5vbi1zdGFuZGFyZCB0b3VjaCBldmVudHMsIHNvIGl0IGhhcyBhIGRpZmZlcmVudCBjaGVjay5cbiAgICAgICAhIShnb29nLmdsb2JhbFsnbmF2aWdhdG9yJ10gJiZcbiAgICAgICAgICAoZ29vZy5nbG9iYWxbJ25hdmlnYXRvciddWydtYXhUb3VjaFBvaW50cyddIHx8XG4gICAgICAgICAgIGdvb2cuZ2xvYmFsWyduYXZpZ2F0b3InXVsnbXNNYXhUb3VjaFBvaW50cyddKSkpLFxuXG4gIC8qKlxuICAgKiBXaGV0aGVyIGFkZEV2ZW50TGlzdGVuZXIgc3VwcG9ydHMgVzNDIHN0YW5kYXJkIHBvaW50ZXIgZXZlbnRzLlxuICAgKiBodHRwOi8vd3d3LnczLm9yZy9UUi9wb2ludGVyZXZlbnRzL1xuICAgKi9cbiAgUE9JTlRFUl9FVkVOVFM6ICgnUG9pbnRlckV2ZW50JyBpbiBnb29nLmdsb2JhbCksXG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgYWRkRXZlbnRMaXN0ZW5lciBzdXBwb3J0cyBNU1BvaW50ZXIgZXZlbnRzIChvbmx5IHVzZWQgaW4gSUUxMCkuXG4gICAqIGh0dHA6Ly9tc2RuLm1pY3Jvc29mdC5jb20vZW4tdXMvbGlicmFyeS9pZS9oaDc3MjEwMyh2PXZzLjg1KS5hc3B4XG4gICAqIGh0dHA6Ly9tc2RuLm1pY3Jvc29mdC5jb20vbGlicmFyeS9oaDY3MzU1Nyh2PXZzLjg1KS5hc3B4XG4gICAqL1xuICBNU1BPSU5URVJfRVZFTlRTOlxuICAgICAgKCdNU1BvaW50ZXJFdmVudCcgaW4gZ29vZy5nbG9iYWwgJiZcbiAgICAgICAhIShnb29nLmdsb2JhbFsnbmF2aWdhdG9yJ10gJiZcbiAgICAgICAgICBnb29nLmdsb2JhbFsnbmF2aWdhdG9yJ11bJ21zUG9pbnRlckVuYWJsZWQnXSkpLFxuXG4gIC8qKlxuICAgKiBXaGV0aGVyIGFkZEV2ZW50TGlzdGVuZXIgc3VwcG9ydHMge3Bhc3NpdmU6IHRydWV9LlxuICAgKiBodHRwczovL2RldmVsb3BlcnMuZ29vZ2xlLmNvbS93ZWIvdXBkYXRlcy8yMDE2LzA2L3Bhc3NpdmUtZXZlbnQtbGlzdGVuZXJzXG4gICAqL1xuICBQQVNTSVZFX0VWRU5UUzogcHVyaWZ5KGZ1bmN0aW9uKCkge1xuICAgIC8vIElmIHdlJ3JlIGluIGEgd2ViIHdvcmtlciBvciBvdGhlciBjdXN0b20gZW52aXJvbm1lbnQsIHdlIGNhbid0IHRlbGwuXG4gICAgaWYgKCFnb29nLmdsb2JhbC5hZGRFdmVudExpc3RlbmVyIHx8ICFPYmplY3QuZGVmaW5lUHJvcGVydHkpIHsgIC8vIElFIDhcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICB2YXIgcGFzc2l2ZSA9IGZhbHNlO1xuICAgIHZhciBvcHRpb25zID0gT2JqZWN0LmRlZmluZVByb3BlcnR5KHt9LCAncGFzc2l2ZScsIHtcbiAgICAgIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHBhc3NpdmUgPSB0cnVlO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHRyeSB7XG4gICAgICBnb29nLmdsb2JhbC5hZGRFdmVudExpc3RlbmVyKCd0ZXN0JywgZ29vZy5udWxsRnVuY3Rpb24sIG9wdGlvbnMpO1xuICAgICAgZ29vZy5nbG9iYWwucmVtb3ZlRXZlbnRMaXN0ZW5lcigndGVzdCcsIGdvb2cubnVsbEZ1bmN0aW9uLCBvcHRpb25zKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgfVxuXG4gICAgcmV0dXJuIHBhc3NpdmU7XG4gIH0pXG59O1xuIiwgIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCBUaGUgQ2xvc3VyZSBMaWJyYXJ5IEF1dGhvcnMuXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogQGZpbGVvdmVydmlldyBBIGJhc2UgY2xhc3MgZm9yIGV2ZW50IG9iamVjdHMuXG4gKi9cblxuXG5nb29nLnByb3ZpZGUoJ2dvb2cuZXZlbnRzLkV2ZW50Jyk7XG5cbi8qKlxuICogZ29vZy5ldmVudHMuRXZlbnQgbm8gbG9uZ2VyIGRlcGVuZHMgb24gZ29vZy5EaXNwb3NhYmxlLiBLZWVwIHJlcXVpcmluZ1xuICogZ29vZy5EaXNwb3NhYmxlIGhlcmUgdG8gbm90IGJyZWFrIHByb2plY3RzIHdoaWNoIGFzc3VtZSB0aGlzIGRlcGVuZGVuY3kuXG4gKiBAc3VwcHJlc3Mge2V4dHJhUmVxdWlyZX1cbiAqL1xuZ29vZy5yZXF1aXJlKCdnb29nLkRpc3Bvc2FibGUnKTtcbmdvb2cucmVxdWlyZSgnZ29vZy5ldmVudHMuRXZlbnRJZCcpO1xuXG5cbi8qKlxuICogQSBiYXNlIGNsYXNzIGZvciBldmVudCBvYmplY3RzLCBzbyB0aGF0IHRoZXkgY2FuIHN1cHBvcnQgcHJldmVudERlZmF1bHQgYW5kXG4gKiBzdG9wUHJvcGFnYXRpb24uXG4gKlxuICogQHBhcmFtIHtzdHJpbmd8IWdvb2cuZXZlbnRzLkV2ZW50SWR9IHR5cGUgRXZlbnQgVHlwZS5cbiAqIEBwYXJhbSB7T2JqZWN0PX0gb3B0X3RhcmdldCBSZWZlcmVuY2UgdG8gdGhlIG9iamVjdCB0aGF0IGlzIHRoZSB0YXJnZXQgb2ZcbiAqICAgICB0aGlzIGV2ZW50LiBJdCBoYXMgdG8gaW1wbGVtZW50IHRoZSBgRXZlbnRUYXJnZXRgIGludGVyZmFjZVxuICogICAgIGRlY2xhcmVkIGF0IHtAbGluayBodHRwOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuL0RPTS9FdmVudFRhcmdldH0uXG4gKiBAY29uc3RydWN0b3JcbiAqL1xuZ29vZy5ldmVudHMuRXZlbnQgPSBmdW5jdGlvbih0eXBlLCBvcHRfdGFyZ2V0KSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgLyoqXG4gICAqIEV2ZW50IHR5cGUuXG4gICAqIEB0eXBlIHtzdHJpbmd9XG4gICAqL1xuICB0aGlzLnR5cGUgPSB0eXBlIGluc3RhbmNlb2YgZ29vZy5ldmVudHMuRXZlbnRJZCA/IFN0cmluZyh0eXBlKSA6IHR5cGU7XG5cbiAgLyoqXG4gICAqIFRPRE8odGJyZWlzYWNoZXIpOiBUaGUgdHlwZSBzaG91bGQgcHJvYmFibHkgYmVcbiAgICogRXZlbnRUYXJnZXR8Z29vZy5ldmVudHMuRXZlbnRUYXJnZXQuXG4gICAqXG4gICAqIFRhcmdldCBvZiB0aGUgZXZlbnQuXG4gICAqIEB0eXBlIHtPYmplY3R8dW5kZWZpbmVkfVxuICAgKi9cbiAgdGhpcy50YXJnZXQgPSBvcHRfdGFyZ2V0O1xuXG4gIC8qKlxuICAgKiBPYmplY3QgdGhhdCBoYWQgdGhlIGxpc3RlbmVyIGF0dGFjaGVkLlxuICAgKiBAdHlwZSB7T2JqZWN0fHVuZGVmaW5lZH1cbiAgICovXG4gIHRoaXMuY3VycmVudFRhcmdldCA9IHRoaXMudGFyZ2V0O1xuXG4gIC8qKlxuICAgKiBXaGV0aGVyIHRvIGNhbmNlbCB0aGUgZXZlbnQgaW4gaW50ZXJuYWwgY2FwdHVyZS9idWJibGUgcHJvY2Vzc2luZyBmb3IgSUUuXG4gICAqIEB0eXBlIHtib29sZWFufVxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgdGhpcy5wcm9wYWdhdGlvblN0b3BwZWRfID0gZmFsc2U7XG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgdGhlIGRlZmF1bHQgYWN0aW9uIGhhcyBiZWVuIHByZXZlbnRlZC5cbiAgICogVGhpcyBpcyBhIHByb3BlcnR5IHRvIG1hdGNoIHRoZSBXM0Mgc3BlY2lmaWNhdGlvbiBhdFxuICAgKiB7QGxpbmsgaHR0cDovL3d3dy53My5vcmcvVFIvRE9NLUxldmVsLTMtRXZlbnRzL1xuICAgKiAjZXZlbnRzLWV2ZW50LXR5cGUtZGVmYXVsdFByZXZlbnRlZH0uXG4gICAqIE11c3QgYmUgdHJlYXRlZCBhcyByZWFkLW9ubHkgb3V0c2lkZSB0aGUgY2xhc3MuXG4gICAqIEB0eXBlIHtib29sZWFufVxuICAgKi9cbiAgdGhpcy5kZWZhdWx0UHJldmVudGVkID0gZmFsc2U7XG59O1xuXG4vKipcbiAqIEByZXR1cm4ge2Jvb2xlYW59IHRydWUgaWZmIGludGVybmFsIHByb3BhZ2F0aW9uIGhhcyBiZWVuIHN0b3BwZWQuXG4gKi9cbmdvb2cuZXZlbnRzLkV2ZW50LnByb3RvdHlwZS5oYXNQcm9wYWdhdGlvblN0b3BwZWQgPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gdGhpcy5wcm9wYWdhdGlvblN0b3BwZWRfO1xufTtcblxuLyoqXG4gKiBTdG9wcyBldmVudCBwcm9wYWdhdGlvbi5cbiAqIEByZXR1cm4ge3ZvaWR9XG4gKi9cbmdvb2cuZXZlbnRzLkV2ZW50LnByb3RvdHlwZS5zdG9wUHJvcGFnYXRpb24gPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICB0aGlzLnByb3BhZ2F0aW9uU3RvcHBlZF8gPSB0cnVlO1xufTtcblxuXG4vKipcbiAqIFByZXZlbnRzIHRoZSBkZWZhdWx0IGFjdGlvbiwgZm9yIGV4YW1wbGUgYSBsaW5rIHJlZGlyZWN0aW5nIHRvIGEgdXJsLlxuICogQHJldHVybiB7dm9pZH1cbiAqL1xuZ29vZy5ldmVudHMuRXZlbnQucHJvdG90eXBlLnByZXZlbnREZWZhdWx0ID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgdGhpcy5kZWZhdWx0UHJldmVudGVkID0gdHJ1ZTtcbn07XG5cblxuLyoqXG4gKiBTdG9wcyB0aGUgcHJvcGFnYXRpb24gb2YgdGhlIGV2ZW50LiBJdCBpcyBlcXVpdmFsZW50IHRvXG4gKiBgZS5zdG9wUHJvcGFnYXRpb24oKWAsIGJ1dCBjYW4gYmUgdXNlZCBhcyB0aGUgY2FsbGJhY2sgYXJndW1lbnQgb2ZcbiAqIHtAbGluayBnb29nLmV2ZW50cy5saXN0ZW59IHdpdGhvdXQgZGVjbGFyaW5nIGFub3RoZXIgZnVuY3Rpb24uXG4gKiBAcGFyYW0geyFnb29nLmV2ZW50cy5FdmVudH0gZSBBbiBldmVudC5cbiAqIEByZXR1cm4ge3ZvaWR9XG4gKi9cbmdvb2cuZXZlbnRzLkV2ZW50LnN0b3BQcm9wYWdhdGlvbiA9IGZ1bmN0aW9uKGUpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBlLnN0b3BQcm9wYWdhdGlvbigpO1xufTtcblxuXG4vKipcbiAqIFByZXZlbnRzIHRoZSBkZWZhdWx0IGFjdGlvbi4gSXQgaXMgZXF1aXZhbGVudCB0b1xuICogYGUucHJldmVudERlZmF1bHQoKWAsIGJ1dCBjYW4gYmUgdXNlZCBhcyB0aGUgY2FsbGJhY2sgYXJndW1lbnQgb2ZcbiAqIHtAbGluayBnb29nLmV2ZW50cy5saXN0ZW59IHdpdGhvdXQgZGVjbGFyaW5nIGFub3RoZXIgZnVuY3Rpb24uXG4gKiBAcGFyYW0geyFnb29nLmV2ZW50cy5FdmVudH0gZSBBbiBldmVudC5cbiAqIEByZXR1cm4ge3ZvaWR9XG4gKi9cbmdvb2cuZXZlbnRzLkV2ZW50LnByZXZlbnREZWZhdWx0ID0gZnVuY3Rpb24oZSkge1xuICAndXNlIHN0cmljdCc7XG4gIGUucHJldmVudERlZmF1bHQoKTtcbn07XG4iLCAiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IFRoZSBDbG9zdXJlIExpYnJhcnkgQXV0aG9ycy5cbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBAZmlsZW92ZXJ2aWV3IEEgcGF0Y2hlZCwgc3RhbmRhcmRpemVkIGV2ZW50IG9iamVjdCBmb3IgYnJvd3NlciBldmVudHMuXG4gKlxuICogPHByZT5cbiAqIFRoZSBwYXRjaGVkIGV2ZW50IG9iamVjdCBjb250YWlucyB0aGUgZm9sbG93aW5nIG1lbWJlcnM6XG4gKiAtIHR5cGUgICAgICAgICAgIHtzdHJpbmd9ICAgIEV2ZW50IHR5cGUsIGUuZy4gJ2NsaWNrJ1xuICogLSB0YXJnZXQgICAgICAgICB7T2JqZWN0fSAgICBUaGUgZWxlbWVudCB0aGF0IGFjdHVhbGx5IHRyaWdnZXJlZCB0aGUgZXZlbnRcbiAqIC0gY3VycmVudFRhcmdldCAge09iamVjdH0gICAgVGhlIGVsZW1lbnQgdGhlIGxpc3RlbmVyIGlzIGF0dGFjaGVkIHRvXG4gKiAtIHJlbGF0ZWRUYXJnZXQgIHtPYmplY3R9ICAgIEZvciBtb3VzZW92ZXIgYW5kIG1vdXNlb3V0LCB0aGUgcHJldmlvdXMgb2JqZWN0XG4gKiAtIG9mZnNldFggICAgICAgIHtudW1iZXJ9ICAgIFgtY29vcmRpbmF0ZSByZWxhdGl2ZSB0byB0YXJnZXRcbiAqIC0gb2Zmc2V0WSAgICAgICAge251bWJlcn0gICAgWS1jb29yZGluYXRlIHJlbGF0aXZlIHRvIHRhcmdldFxuICogLSBjbGllbnRYICAgICAgICB7bnVtYmVyfSAgICBYLWNvb3JkaW5hdGUgcmVsYXRpdmUgdG8gdmlld3BvcnRcbiAqIC0gY2xpZW50WSAgICAgICAge251bWJlcn0gICAgWS1jb29yZGluYXRlIHJlbGF0aXZlIHRvIHZpZXdwb3J0XG4gKiAtIHNjcmVlblggICAgICAgIHtudW1iZXJ9ICAgIFgtY29vcmRpbmF0ZSByZWxhdGl2ZSB0byB0aGUgZWRnZSBvZiB0aGUgc2NyZWVuXG4gKiAtIHNjcmVlblkgICAgICAgIHtudW1iZXJ9ICAgIFktY29vcmRpbmF0ZSByZWxhdGl2ZSB0byB0aGUgZWRnZSBvZiB0aGUgc2NyZWVuXG4gKiAtIGJ1dHRvbiAgICAgICAgIHtudW1iZXJ9ICAgIE1vdXNlIGJ1dHRvbi4gVXNlIGlzQnV0dG9uKCkgdG8gdGVzdC5cbiAqIC0ga2V5Q29kZSAgICAgICAge251bWJlcn0gICAgS2V5LWNvZGVcbiAqIC0gY3RybEtleSAgICAgICAge2Jvb2xlYW59ICAgV2FzIGN0cmwga2V5IGRlcHJlc3NlZFxuICogLSBhbHRLZXkgICAgICAgICB7Ym9vbGVhbn0gICBXYXMgYWx0IGtleSBkZXByZXNzZWRcbiAqIC0gc2hpZnRLZXkgICAgICAge2Jvb2xlYW59ICAgV2FzIHNoaWZ0IGtleSBkZXByZXNzZWRcbiAqIC0gbWV0YUtleSAgICAgICAge2Jvb2xlYW59ICAgV2FzIG1ldGEga2V5IGRlcHJlc3NlZFxuICogLSBwb2ludGVySWQgICAgICB7bnVtYmVyfSAgICBQb2ludGVyIElEXG4gKiAtIHBvaW50ZXJUeXBlICAgIHtzdHJpbmd9ICAgIFBvaW50ZXIgdHlwZSwgZS5nLiAnbW91c2UnLCAncGVuJywgb3IgJ3RvdWNoJ1xuICogLSBkZWZhdWx0UHJldmVudGVkIHtib29sZWFufSBXaGV0aGVyIHRoZSBkZWZhdWx0IGFjdGlvbiBoYXMgYmVlbiBwcmV2ZW50ZWRcbiAqIC0gc3RhdGUgICAgICAgICAge09iamVjdH0gICAgSGlzdG9yeSBzdGF0ZSBvYmplY3RcbiAqXG4gKiBOT1RFOiBUaGUga2V5Q29kZSBtZW1iZXIgY29udGFpbnMgdGhlIHJhdyBicm93c2VyIGtleUNvZGUuIEZvciBub3JtYWxpemVkXG4gKiBrZXkgYW5kIGNoYXJhY3RlciBjb2RlIHVzZSB7QGxpbmsgZ29vZy5ldmVudHMuS2V5SGFuZGxlcn0uXG4gKiA8L3ByZT5cbiAqIEBzdXBwcmVzcyB7bWlzc2luZ1JlcXVpcmV9IFRPRE8odXNlcik6IHRoaXMgc2hvdWxkbid0IGJlIG5lZWRlZFxuICovXG5cbmdvb2cucHJvdmlkZSgnZ29vZy5ldmVudHMuQnJvd3NlckV2ZW50Jyk7XG5nb29nLnByb3ZpZGUoJ2dvb2cuZXZlbnRzLkJyb3dzZXJFdmVudC5Nb3VzZUJ1dHRvbicpO1xuZ29vZy5wcm92aWRlKCdnb29nLmV2ZW50cy5Ccm93c2VyRXZlbnQuUG9pbnRlclR5cGUnKTtcblxuZ29vZy5yZXF1aXJlKCdnb29nLmRlYnVnJyk7XG5nb29nLnJlcXVpcmUoJ2dvb2cuZXZlbnRzLkJyb3dzZXJGZWF0dXJlJyk7XG5nb29nLnJlcXVpcmUoJ2dvb2cuZXZlbnRzLkV2ZW50Jyk7XG5nb29nLnJlcXVpcmUoJ2dvb2cuZXZlbnRzLkV2ZW50VHlwZScpO1xuZ29vZy5yZXF1aXJlKCdnb29nLnJlZmxlY3QnKTtcbmdvb2cucmVxdWlyZSgnZ29vZy51c2VyQWdlbnQnKTtcblxuLyoqXG4gKiBAZGVmaW5lIHtib29sZWFufSBJZiB0cnVlLCB1c2UgdGhlIGxheWVyWCBhbmQgbGF5ZXJZIHByb3BlcnRpZXMgb2YgYSBuYXRpdmVcbiAqIGJyb3dzZXIgZXZlbnQgb3ZlciB0aGUgb2Zmc2V0WCBhbmQgb2Zmc2V0WSBwcm9wZXJ0aWVzLCB3aGljaCBjYXVzZSBleHBlbnNpdmVcbiAqIHJlZmxvdy4gSWYgbGF5ZXJYIG9yIGxheWVyWSBpcyBub3QgZGVmaW5lZCwgb2Zmc2V0WCBhbmQgb2Zmc2V0WSB3aWxsIGJlIHVzZWRcbiAqIGFzIHVzdWFsLlxuICovXG5nb29nLmV2ZW50cy5VU0VfTEFZRVJfWFlfQVNfT0ZGU0VUX1hZID1cbiAgICBnb29nLmRlZmluZSgnZ29vZy5ldmVudHMuVVNFX0xBWUVSX1hZX0FTX09GRlNFVF9YWScsIGZhbHNlKTtcblxuLyoqXG4gKiBBY2NlcHRzIGEgYnJvd3NlciBldmVudCBvYmplY3QgYW5kIGNyZWF0ZXMgYSBwYXRjaGVkLCBjcm9zcyBicm93c2VyIGV2ZW50XG4gKiBvYmplY3QuXG4gKiBUaGUgY29udGVudCBvZiB0aGlzIG9iamVjdCB3aWxsIG5vdCBiZSBpbml0aWFsaXplZCBpZiBubyBldmVudCBvYmplY3QgaXNcbiAqIHByb3ZpZGVkLiBJZiB0aGlzIGlzIHRoZSBjYXNlLCBpbml0KCkgbmVlZHMgdG8gYmUgaW52b2tlZCBzZXBhcmF0ZWx5LlxuICogQHBhcmFtIHtFdmVudD19IG9wdF9lIEJyb3dzZXIgZXZlbnQgb2JqZWN0LlxuICogQHBhcmFtIHtFdmVudFRhcmdldD19IG9wdF9jdXJyZW50VGFyZ2V0IEN1cnJlbnQgdGFyZ2V0IGZvciBldmVudC5cbiAqIEBjb25zdHJ1Y3RvclxuICogQGV4dGVuZHMge2dvb2cuZXZlbnRzLkV2ZW50fVxuICovXG5nb29nLmV2ZW50cy5Ccm93c2VyRXZlbnQgPSBmdW5jdGlvbihvcHRfZSwgb3B0X2N1cnJlbnRUYXJnZXQpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBnb29nLmV2ZW50cy5Ccm93c2VyRXZlbnQuYmFzZSh0aGlzLCAnY29uc3RydWN0b3InLCBvcHRfZSA/IG9wdF9lLnR5cGUgOiAnJyk7XG5cbiAgLyoqXG4gICAqIFRhcmdldCB0aGF0IGZpcmVkIHRoZSBldmVudC5cbiAgICogQG92ZXJyaWRlXG4gICAqIEB0eXBlIHs/Tm9kZX1cbiAgICovXG4gIHRoaXMudGFyZ2V0ID0gbnVsbDtcblxuICAvKipcbiAgICogTm9kZSB0aGF0IGhhZCB0aGUgbGlzdGVuZXIgYXR0YWNoZWQuXG4gICAqIEBvdmVycmlkZVxuICAgKiBAdHlwZSB7P05vZGV8dW5kZWZpbmVkfVxuICAgKi9cbiAgdGhpcy5jdXJyZW50VGFyZ2V0ID0gbnVsbDtcblxuICAvKipcbiAgICogRm9yIG1vdXNlb3ZlciBhbmQgbW91c2VvdXQgZXZlbnRzLCB0aGUgcmVsYXRlZCBvYmplY3QgZm9yIHRoZSBldmVudC5cbiAgICogQHR5cGUgez9Ob2RlfVxuICAgKi9cbiAgdGhpcy5yZWxhdGVkVGFyZ2V0ID0gbnVsbDtcblxuICAvKipcbiAgICogWC1jb29yZGluYXRlIHJlbGF0aXZlIHRvIHRhcmdldC5cbiAgICogQHR5cGUge251bWJlcn1cbiAgICovXG4gIHRoaXMub2Zmc2V0WCA9IDA7XG5cbiAgLyoqXG4gICAqIFktY29vcmRpbmF0ZSByZWxhdGl2ZSB0byB0YXJnZXQuXG4gICAqIEB0eXBlIHtudW1iZXJ9XG4gICAqL1xuICB0aGlzLm9mZnNldFkgPSAwO1xuXG4gIC8qKlxuICAgKiBYLWNvb3JkaW5hdGUgcmVsYXRpdmUgdG8gdGhlIHdpbmRvdy5cbiAgICogQHR5cGUge251bWJlcn1cbiAgICovXG4gIHRoaXMuY2xpZW50WCA9IDA7XG5cbiAgLyoqXG4gICAqIFktY29vcmRpbmF0ZSByZWxhdGl2ZSB0byB0aGUgd2luZG93LlxuICAgKiBAdHlwZSB7bnVtYmVyfVxuICAgKi9cbiAgdGhpcy5jbGllbnRZID0gMDtcblxuICAvKipcbiAgICogWC1jb29yZGluYXRlIHJlbGF0aXZlIHRvIHRoZSBtb25pdG9yLlxuICAgKiBAdHlwZSB7bnVtYmVyfVxuICAgKi9cbiAgdGhpcy5zY3JlZW5YID0gMDtcblxuICAvKipcbiAgICogWS1jb29yZGluYXRlIHJlbGF0aXZlIHRvIHRoZSBtb25pdG9yLlxuICAgKiBAdHlwZSB7bnVtYmVyfVxuICAgKi9cbiAgdGhpcy5zY3JlZW5ZID0gMDtcblxuICAvKipcbiAgICogV2hpY2ggbW91c2UgYnV0dG9uIHdhcyBwcmVzc2VkLlxuICAgKiBAdHlwZSB7bnVtYmVyfVxuICAgKi9cbiAgdGhpcy5idXR0b24gPSAwO1xuXG4gIC8qKlxuICAgKiBLZXkgb2Yga2V5IHByZXNzLlxuICAgKiBAdHlwZSB7c3RyaW5nfVxuICAgKi9cbiAgdGhpcy5rZXkgPSAnJztcblxuICAvKipcbiAgICogS2V5Y29kZSBvZiBrZXkgcHJlc3MuXG4gICAqIEB0eXBlIHtudW1iZXJ9XG4gICAqL1xuICB0aGlzLmtleUNvZGUgPSAwO1xuXG4gIC8qKlxuICAgKiBLZXljb2RlIG9mIGtleSBwcmVzcy5cbiAgICogQHR5cGUge251bWJlcn1cbiAgICovXG4gIHRoaXMuY2hhckNvZGUgPSAwO1xuXG4gIC8qKlxuICAgKiBXaGV0aGVyIGNvbnRyb2wgd2FzIHByZXNzZWQgYXQgdGltZSBvZiBldmVudC5cbiAgICogQHR5cGUge2Jvb2xlYW59XG4gICAqL1xuICB0aGlzLmN0cmxLZXkgPSBmYWxzZTtcblxuICAvKipcbiAgICogV2hldGhlciBhbHQgd2FzIHByZXNzZWQgYXQgdGltZSBvZiBldmVudC5cbiAgICogQHR5cGUge2Jvb2xlYW59XG4gICAqL1xuICB0aGlzLmFsdEtleSA9IGZhbHNlO1xuXG4gIC8qKlxuICAgKiBXaGV0aGVyIHNoaWZ0IHdhcyBwcmVzc2VkIGF0IHRpbWUgb2YgZXZlbnQuXG4gICAqIEB0eXBlIHtib29sZWFufVxuICAgKi9cbiAgdGhpcy5zaGlmdEtleSA9IGZhbHNlO1xuXG4gIC8qKlxuICAgKiBXaGV0aGVyIHRoZSBtZXRhIGtleSB3YXMgcHJlc3NlZCBhdCB0aW1lIG9mIGV2ZW50LlxuICAgKiBAdHlwZSB7Ym9vbGVhbn1cbiAgICovXG4gIHRoaXMubWV0YUtleSA9IGZhbHNlO1xuXG4gIC8qKlxuICAgKiBIaXN0b3J5IHN0YXRlIG9iamVjdCwgb25seSBzZXQgZm9yIFBvcFN0YXRlIGV2ZW50cyB3aGVyZSBpdCdzIGEgY29weSBvZiB0aGVcbiAgICogc3RhdGUgb2JqZWN0IHByb3ZpZGVkIHRvIHB1c2hTdGF0ZSBvciByZXBsYWNlU3RhdGUuXG4gICAqIEB0eXBlIHs/T2JqZWN0fVxuICAgKi9cbiAgdGhpcy5zdGF0ZSA9IG51bGw7XG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgdGhlIGRlZmF1bHQgcGxhdGZvcm0gbW9kaWZpZXIga2V5IHdhcyBwcmVzc2VkIGF0IHRpbWUgb2YgZXZlbnQuXG4gICAqIChUaGlzIGlzIGNvbnRyb2wgZm9yIGFsbCBwbGF0Zm9ybXMgZXhjZXB0IE1hYywgd2hlcmUgaXQncyBNZXRhLilcbiAgICogQHR5cGUge2Jvb2xlYW59XG4gICAqL1xuICB0aGlzLnBsYXRmb3JtTW9kaWZpZXJLZXkgPSBmYWxzZTtcblxuICAvKipcbiAgICogQHR5cGUge251bWJlcn1cbiAgICovXG4gIHRoaXMucG9pbnRlcklkID0gMDtcblxuICAvKipcbiAgICogQHR5cGUge3N0cmluZ31cbiAgICovXG4gIHRoaXMucG9pbnRlclR5cGUgPSAnJztcblxuICAvKipcbiAgICogVGhlIGJyb3dzZXIgZXZlbnQgb2JqZWN0LlxuICAgKiBAcHJpdmF0ZSB7P0V2ZW50fVxuICAgKi9cbiAgdGhpcy5ldmVudF8gPSBudWxsO1xuXG4gIGlmIChvcHRfZSkge1xuICAgIHRoaXMuaW5pdChvcHRfZSwgb3B0X2N1cnJlbnRUYXJnZXQpO1xuICB9XG59O1xuZ29vZy5pbmhlcml0cyhnb29nLmV2ZW50cy5Ccm93c2VyRXZlbnQsIGdvb2cuZXZlbnRzLkV2ZW50KTtcblxuXG4vKipcbiAqIE5vcm1hbGl6ZWQgYnV0dG9uIGNvbnN0YW50cyBmb3IgdGhlIG1vdXNlLlxuICogQGVudW0ge251bWJlcn1cbiAqL1xuZ29vZy5ldmVudHMuQnJvd3NlckV2ZW50Lk1vdXNlQnV0dG9uID0ge1xuICBMRUZUOiAwLFxuICBNSURETEU6IDEsXG4gIFJJR0hUOiAyXG59O1xuXG5cbi8qKlxuICogTm9ybWFsaXplZCBwb2ludGVyIHR5cGUgY29uc3RhbnRzIGZvciBwb2ludGVyIGV2ZW50cy5cbiAqIEBlbnVtIHtzdHJpbmd9XG4gKi9cbmdvb2cuZXZlbnRzLkJyb3dzZXJFdmVudC5Qb2ludGVyVHlwZSA9IHtcbiAgTU9VU0U6ICdtb3VzZScsXG4gIFBFTjogJ3BlbicsXG4gIFRPVUNIOiAndG91Y2gnXG59O1xuXG5cbi8qKlxuICogU3RhdGljIGRhdGEgZm9yIG1hcHBpbmcgbW91c2UgYnV0dG9ucy5cbiAqIEB0eXBlIHshQXJyYXk8bnVtYmVyPn1cbiAqIEBkZXByZWNhdGVkIFVzZSBgZ29vZy5ldmVudHMuQnJvd3NlckV2ZW50LklFX0JVVFRPTl9NQVBgIGluc3RlYWQuXG4gKi9cbmdvb2cuZXZlbnRzLkJyb3dzZXJFdmVudC5JRUJ1dHRvbk1hcCA9IGdvb2cuZGVidWcuZnJlZXplKFtcbiAgMSwgIC8vIExFRlRcbiAgNCwgIC8vIE1JRERMRVxuICAyICAgLy8gUklHSFRcbl0pO1xuXG5cbi8qKlxuICogU3RhdGljIGRhdGEgZm9yIG1hcHBpbmcgbW91c2UgYnV0dG9ucy5cbiAqIEBjb25zdCB7IUFycmF5PG51bWJlcj59XG4gKi9cbmdvb2cuZXZlbnRzLkJyb3dzZXJFdmVudC5JRV9CVVRUT05fTUFQID0gZ29vZy5ldmVudHMuQnJvd3NlckV2ZW50LklFQnV0dG9uTWFwO1xuXG5cbi8qKlxuICogU3RhdGljIGRhdGEgZm9yIG1hcHBpbmcgTVNQb2ludGVyRXZlbnQgdHlwZXMgdG8gUG9pbnRlckV2ZW50IHR5cGVzLlxuICogQGNvbnN0IHshT2JqZWN0PG51bWJlciwgZ29vZy5ldmVudHMuQnJvd3NlckV2ZW50LlBvaW50ZXJUeXBlPn1cbiAqL1xuZ29vZy5ldmVudHMuQnJvd3NlckV2ZW50LklFX1BPSU5URVJfVFlQRV9NQVAgPSBnb29nLmRlYnVnLmZyZWV6ZSh7XG4gIDI6IGdvb2cuZXZlbnRzLkJyb3dzZXJFdmVudC5Qb2ludGVyVHlwZS5UT1VDSCxcbiAgMzogZ29vZy5ldmVudHMuQnJvd3NlckV2ZW50LlBvaW50ZXJUeXBlLlBFTixcbiAgNDogZ29vZy5ldmVudHMuQnJvd3NlckV2ZW50LlBvaW50ZXJUeXBlLk1PVVNFXG59KTtcblxuXG4vKipcbiAqIEFjY2VwdHMgYSBicm93c2VyIGV2ZW50IG9iamVjdCBhbmQgY3JlYXRlcyBhIHBhdGNoZWQsIGNyb3NzIGJyb3dzZXIgZXZlbnRcbiAqIG9iamVjdC5cbiAqIEBwYXJhbSB7RXZlbnR9IGUgQnJvd3NlciBldmVudCBvYmplY3QuXG4gKiBAcGFyYW0ge0V2ZW50VGFyZ2V0PX0gb3B0X2N1cnJlbnRUYXJnZXQgQ3VycmVudCB0YXJnZXQgZm9yIGV2ZW50LlxuICovXG5nb29nLmV2ZW50cy5Ccm93c2VyRXZlbnQucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbihlLCBvcHRfY3VycmVudFRhcmdldCkge1xuICAndXNlIHN0cmljdCc7XG4gIHZhciB0eXBlID0gdGhpcy50eXBlID0gZS50eXBlO1xuXG4gIC8qKlxuICAgKiBPbiB0b3VjaCBkZXZpY2VzIHVzZSB0aGUgZmlyc3QgXCJjaGFuZ2VkIHRvdWNoXCIgYXMgdGhlIHJlbGV2YW50IHRvdWNoLlxuICAgKiBAdHlwZSB7P1RvdWNofVxuICAgKi9cbiAgdmFyIHJlbGV2YW50VG91Y2ggPVxuICAgICAgZS5jaGFuZ2VkVG91Y2hlcyAmJiBlLmNoYW5nZWRUb3VjaGVzLmxlbmd0aCA/IGUuY2hhbmdlZFRvdWNoZXNbMF0gOiBudWxsO1xuXG4gIC8vIFRPRE8obmlja3NhbnRvcyk6IENoYW5nZSB0aGlzLnRhcmdldCB0byB0eXBlIEV2ZW50VGFyZ2V0LlxuICB0aGlzLnRhcmdldCA9IC8qKiBAdHlwZSB7Tm9kZX0gKi8gKGUudGFyZ2V0KSB8fCBlLnNyY0VsZW1lbnQ7XG5cbiAgLy8gVE9ETyhuaWNrc2FudG9zKTogQ2hhbmdlIHRoaXMuY3VycmVudFRhcmdldCB0byB0eXBlIEV2ZW50VGFyZ2V0LlxuICB0aGlzLmN1cnJlbnRUYXJnZXQgPSAvKiogQHR5cGUge05vZGV9ICovIChvcHRfY3VycmVudFRhcmdldCk7XG5cbiAgdmFyIHJlbGF0ZWRUYXJnZXQgPSAvKiogQHR5cGUge05vZGV9ICovIChlLnJlbGF0ZWRUYXJnZXQpO1xuICBpZiAocmVsYXRlZFRhcmdldCkge1xuICAgIC8vIFRoZXJlJ3MgYSBidWcgaW4gRmlyZUZveCB3aGVyZSBzb21ldGltZXMsIHJlbGF0ZWRUYXJnZXQgd2lsbCBiZSBhXG4gICAgLy8gY2hyb21lIGVsZW1lbnQsIGFuZCBhY2Nlc3NpbmcgYW55IHByb3BlcnR5IG9mIGl0IHdpbGwgZ2V0IGEgcGVybWlzc2lvblxuICAgIC8vIGRlbmllZCBleGNlcHRpb24uIFNlZTpcbiAgICAvLyBodHRwczovL2J1Z3ppbGxhLm1vemlsbGEub3JnL3Nob3dfYnVnLmNnaT9pZD00OTc3ODBcbiAgICBpZiAoZ29vZy51c2VyQWdlbnQuR0VDS08pIHtcbiAgICAgIGlmICghZ29vZy5yZWZsZWN0LmNhbkFjY2Vzc1Byb3BlcnR5KHJlbGF0ZWRUYXJnZXQsICdub2RlTmFtZScpKSB7XG4gICAgICAgIHJlbGF0ZWRUYXJnZXQgPSBudWxsO1xuICAgICAgfVxuICAgIH1cbiAgfSBlbHNlIGlmICh0eXBlID09IGdvb2cuZXZlbnRzLkV2ZW50VHlwZS5NT1VTRU9WRVIpIHtcbiAgICByZWxhdGVkVGFyZ2V0ID0gZS5mcm9tRWxlbWVudDtcbiAgfSBlbHNlIGlmICh0eXBlID09IGdvb2cuZXZlbnRzLkV2ZW50VHlwZS5NT1VTRU9VVCkge1xuICAgIHJlbGF0ZWRUYXJnZXQgPSBlLnRvRWxlbWVudDtcbiAgfVxuXG4gIHRoaXMucmVsYXRlZFRhcmdldCA9IHJlbGF0ZWRUYXJnZXQ7XG5cbiAgaWYgKHJlbGV2YW50VG91Y2gpIHtcbiAgICB0aGlzLmNsaWVudFggPSByZWxldmFudFRvdWNoLmNsaWVudFggIT09IHVuZGVmaW5lZCA/IHJlbGV2YW50VG91Y2guY2xpZW50WCA6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWxldmFudFRvdWNoLnBhZ2VYO1xuICAgIHRoaXMuY2xpZW50WSA9IHJlbGV2YW50VG91Y2guY2xpZW50WSAhPT0gdW5kZWZpbmVkID8gcmVsZXZhbnRUb3VjaC5jbGllbnRZIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlbGV2YW50VG91Y2gucGFnZVk7XG4gICAgdGhpcy5zY3JlZW5YID0gcmVsZXZhbnRUb3VjaC5zY3JlZW5YIHx8IDA7XG4gICAgdGhpcy5zY3JlZW5ZID0gcmVsZXZhbnRUb3VjaC5zY3JlZW5ZIHx8IDA7XG4gIH0gZWxzZSB7XG4gICAgaWYgKGdvb2cuZXZlbnRzLlVTRV9MQVlFUl9YWV9BU19PRkZTRVRfWFkpIHtcbiAgICAgIHRoaXMub2Zmc2V0WCA9IChlLmxheWVyWCAhPT0gdW5kZWZpbmVkKSA/IGUubGF5ZXJYIDogZS5vZmZzZXRYO1xuICAgICAgdGhpcy5vZmZzZXRZID0gKGUubGF5ZXJZICE9PSB1bmRlZmluZWQpID8gZS5sYXllclkgOiBlLm9mZnNldFk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIFdlYmtpdCBlbWl0cyBhIGxhbWUgd2FybmluZyB3aGVuZXZlciBsYXllclgvbGF5ZXJZIGlzIGFjY2Vzc2VkLlxuICAgICAgLy8gaHR0cDovL2NvZGUuZ29vZ2xlLmNvbS9wL2Nocm9taXVtL2lzc3Vlcy9kZXRhaWw/aWQ9MTAxNzMzXG4gICAgICB0aGlzLm9mZnNldFggPSAoZ29vZy51c2VyQWdlbnQuV0VCS0lUIHx8IGUub2Zmc2V0WCAhPT0gdW5kZWZpbmVkKSA/XG4gICAgICAgICAgZS5vZmZzZXRYIDpcbiAgICAgICAgICBlLmxheWVyWDtcbiAgICAgIHRoaXMub2Zmc2V0WSA9IChnb29nLnVzZXJBZ2VudC5XRUJLSVQgfHwgZS5vZmZzZXRZICE9PSB1bmRlZmluZWQpID9cbiAgICAgICAgICBlLm9mZnNldFkgOlxuICAgICAgICAgIGUubGF5ZXJZO1xuICAgIH1cbiAgICB0aGlzLmNsaWVudFggPSBlLmNsaWVudFggIT09IHVuZGVmaW5lZCA/IGUuY2xpZW50WCA6IGUucGFnZVg7XG4gICAgdGhpcy5jbGllbnRZID0gZS5jbGllbnRZICE9PSB1bmRlZmluZWQgPyBlLmNsaWVudFkgOiBlLnBhZ2VZO1xuICAgIHRoaXMuc2NyZWVuWCA9IGUuc2NyZWVuWCB8fCAwO1xuICAgIHRoaXMuc2NyZWVuWSA9IGUuc2NyZWVuWSB8fCAwO1xuICB9XG5cbiAgdGhpcy5idXR0b24gPSBlLmJ1dHRvbjtcblxuICB0aGlzLmtleUNvZGUgPSBlLmtleUNvZGUgfHwgMDtcbiAgdGhpcy5rZXkgPSBlLmtleSB8fCAnJztcbiAgdGhpcy5jaGFyQ29kZSA9IGUuY2hhckNvZGUgfHwgKHR5cGUgPT0gJ2tleXByZXNzJyA/IGUua2V5Q29kZSA6IDApO1xuICB0aGlzLmN0cmxLZXkgPSBlLmN0cmxLZXk7XG4gIHRoaXMuYWx0S2V5ID0gZS5hbHRLZXk7XG4gIHRoaXMuc2hpZnRLZXkgPSBlLnNoaWZ0S2V5O1xuICB0aGlzLm1ldGFLZXkgPSBlLm1ldGFLZXk7XG4gIHRoaXMucGxhdGZvcm1Nb2RpZmllcktleSA9IGdvb2cudXNlckFnZW50Lk1BQyA/IGUubWV0YUtleSA6IGUuY3RybEtleTtcbiAgdGhpcy5wb2ludGVySWQgPSBlLnBvaW50ZXJJZCB8fCAwO1xuICB0aGlzLnBvaW50ZXJUeXBlID0gZ29vZy5ldmVudHMuQnJvd3NlckV2ZW50LmdldFBvaW50ZXJUeXBlXyhlKTtcbiAgdGhpcy5zdGF0ZSA9IGUuc3RhdGU7XG4gIHRoaXMuZXZlbnRfID0gZTtcbiAgaWYgKGUuZGVmYXVsdFByZXZlbnRlZCkge1xuICAgIC8vIFN5bmMgbmF0aXZlIGV2ZW50IHN0YXRlIHRvIGludGVybmFsIHN0YXRlIHZpYSBzdXBlciBjbGFzcywgd2hlcmUgZGVmYXVsdFxuICAgIC8vIHByZXZlbnRpb24gaXMgaW1wbGVtZW50ZWQgYW5kIG1hbmFnZWQuXG4gICAgZ29vZy5ldmVudHMuQnJvd3NlckV2ZW50LnN1cGVyQ2xhc3NfLnByZXZlbnREZWZhdWx0LmNhbGwodGhpcyk7XG4gIH1cbn07XG5cblxuLyoqXG4gKiBUZXN0cyB0byBzZWUgd2hpY2ggYnV0dG9uIHdhcyBwcmVzc2VkIGR1cmluZyB0aGUgZXZlbnQuIFRoaXMgaXMgcmVhbGx5IG9ubHlcbiAqIHVzZWZ1bCBpbiBJRSBhbmQgR2Vja28gYnJvd3NlcnMuIEFuZCBpbiBJRSwgaXQncyBvbmx5IHVzZWZ1bCBmb3JcbiAqIG1vdXNlZG93bi9tb3VzZXVwIGV2ZW50cywgYmVjYXVzZSBjbGljayBvbmx5IGZpcmVzIGZvciB0aGUgbGVmdCBtb3VzZSBidXR0b24uXG4gKlxuICogU2FmYXJpIDIgb25seSByZXBvcnRzIHRoZSBsZWZ0IGJ1dHRvbiBiZWluZyBjbGlja2VkLCBhbmQgdXNlcyB0aGUgdmFsdWUgJzEnXG4gKiBpbnN0ZWFkIG9mIDAuIE9wZXJhIG9ubHkgcmVwb3J0cyBhIG1vdXNlZG93biBldmVudCBmb3IgdGhlIG1pZGRsZSBidXR0b24sIGFuZFxuICogbm8gbW91c2UgZXZlbnRzIGZvciB0aGUgcmlnaHQgYnV0dG9uLiBPcGVyYSBoYXMgZGVmYXVsdCBiZWhhdmlvciBmb3IgbGVmdCBhbmRcbiAqIG1pZGRsZSBjbGljayB0aGF0IGNhbiBvbmx5IGJlIG92ZXJyaWRkZW4gdmlhIGEgY29uZmlndXJhdGlvbiBzZXR0aW5nLlxuICpcbiAqIFRoZXJlJ3MgYSBuaWNlIHRhYmxlIG9mIHRoaXMgbWVzcyBhdCBodHRwOi8vd3d3LnVuaXhwYXBhLmNvbS9qcy9tb3VzZS5odG1sLlxuICpcbiAqIEBwYXJhbSB7Z29vZy5ldmVudHMuQnJvd3NlckV2ZW50Lk1vdXNlQnV0dG9ufSBidXR0b24gVGhlIGJ1dHRvblxuICogICAgIHRvIHRlc3QgZm9yLlxuICogQHJldHVybiB7Ym9vbGVhbn0gVHJ1ZSBpZiBidXR0b24gd2FzIHByZXNzZWQuXG4gKi9cbmdvb2cuZXZlbnRzLkJyb3dzZXJFdmVudC5wcm90b3R5cGUuaXNCdXR0b24gPSBmdW5jdGlvbihidXR0b24pIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBpZiAoIWdvb2cuZXZlbnRzLkJyb3dzZXJGZWF0dXJlLkhBU19XM0NfQlVUVE9OKSB7XG4gICAgaWYgKHRoaXMudHlwZSA9PSAnY2xpY2snKSB7XG4gICAgICByZXR1cm4gYnV0dG9uID09IGdvb2cuZXZlbnRzLkJyb3dzZXJFdmVudC5Nb3VzZUJ1dHRvbi5MRUZUO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gISEoXG4gICAgICAgICAgdGhpcy5ldmVudF8uYnV0dG9uICYgZ29vZy5ldmVudHMuQnJvd3NlckV2ZW50LklFX0JVVFRPTl9NQVBbYnV0dG9uXSk7XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIHJldHVybiB0aGlzLmV2ZW50Xy5idXR0b24gPT0gYnV0dG9uO1xuICB9XG59O1xuXG5cbi8qKlxuICogV2hldGhlciB0aGlzIGhhcyBhbiBcImFjdGlvblwiLXByb2R1Y2luZyBtb3VzZSBidXR0b24uXG4gKlxuICogQnkgZGVmaW5pdGlvbiwgdGhpcyBpbmNsdWRlcyBsZWZ0LWNsaWNrIG9uIHdpbmRvd3MvbGludXgsIGFuZCBsZWZ0LWNsaWNrXG4gKiB3aXRob3V0IHRoZSBjdHJsIGtleSBvbiBNYWNzLlxuICpcbiAqIEByZXR1cm4ge2Jvb2xlYW59IFRoZSByZXN1bHQuXG4gKi9cbmdvb2cuZXZlbnRzLkJyb3dzZXJFdmVudC5wcm90b3R5cGUuaXNNb3VzZUFjdGlvbkJ1dHRvbiA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIC8vIEN0cmwrY2xpY2sgc2hvdWxkIG5ldmVyIGJlaGF2ZSBsaWtlIGEgbGVmdC1jbGljayBvbiBtYWMsIHJlZ2FyZGxlc3Mgb2ZcbiAgLy8gd2hldGhlciBvciBub3QgdGhlIGJyb3dzZXIgd2lsbCBhY3R1YWxseSBldmVyIGVtaXQgc3VjaCBhbiBldmVudC4gIElmXG4gIC8vIHdlIHNlZSBpdCwgdHJlYXQgaXQgbGlrZSByaWdodC1jbGljayBhbHdheXMuXG4gIHJldHVybiB0aGlzLmlzQnV0dG9uKGdvb2cuZXZlbnRzLkJyb3dzZXJFdmVudC5Nb3VzZUJ1dHRvbi5MRUZUKSAmJlxuICAgICAgIShnb29nLnVzZXJBZ2VudC5NQUMgJiYgdGhpcy5jdHJsS2V5KTtcbn07XG5cblxuLyoqXG4gKiBAb3ZlcnJpZGVcbiAqL1xuZ29vZy5ldmVudHMuQnJvd3NlckV2ZW50LnByb3RvdHlwZS5zdG9wUHJvcGFnYXRpb24gPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBnb29nLmV2ZW50cy5Ccm93c2VyRXZlbnQuc3VwZXJDbGFzc18uc3RvcFByb3BhZ2F0aW9uLmNhbGwodGhpcyk7XG4gIGlmICh0aGlzLmV2ZW50Xy5zdG9wUHJvcGFnYXRpb24pIHtcbiAgICB0aGlzLmV2ZW50Xy5zdG9wUHJvcGFnYXRpb24oKTtcbiAgfSBlbHNlIHtcbiAgICB0aGlzLmV2ZW50Xy5jYW5jZWxCdWJibGUgPSB0cnVlO1xuICB9XG59O1xuXG5cbi8qKlxuICogQG92ZXJyaWRlXG4gKi9cbmdvb2cuZXZlbnRzLkJyb3dzZXJFdmVudC5wcm90b3R5cGUucHJldmVudERlZmF1bHQgPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBnb29nLmV2ZW50cy5Ccm93c2VyRXZlbnQuc3VwZXJDbGFzc18ucHJldmVudERlZmF1bHQuY2FsbCh0aGlzKTtcbiAgdmFyIGJlID0gdGhpcy5ldmVudF87XG4gIGlmICghYmUucHJldmVudERlZmF1bHQpIHtcbiAgICBiZS5yZXR1cm5WYWx1ZSA9IGZhbHNlO1xuICAgIGlmIChnb29nLmV2ZW50cy5Ccm93c2VyRmVhdHVyZS5TRVRfS0VZX0NPREVfVE9fUFJFVkVOVF9ERUZBVUxUKSB7XG5cbiAgICAgIHRyeSB7XG4gICAgICAgIC8vIE1vc3Qga2V5cyBjYW4gYmUgcHJldmVudGVkIHVzaW5nIHJldHVyblZhbHVlLiBTb21lIHNwZWNpYWwga2V5c1xuICAgICAgICAvLyByZXF1aXJlIHNldHRpbmcgdGhlIGtleUNvZGUgdG8gLTEgYXMgd2VsbDpcbiAgICAgICAgLy9cbiAgICAgICAgLy8gSW4gSUU3OlxuICAgICAgICAvLyBGMywgRjUsIEYxMCwgRjExLCBDdHJsK1AsIENydGwrTywgQ3RybCtGICh0aGVzZSBhcmUgdGFrZW4gZnJvbSBJRTYpXG4gICAgICAgIC8vXG4gICAgICAgIC8vIEluIElFODpcbiAgICAgICAgLy8gQ3RybCtQLCBDcnRsK08sIEN0cmwrRiAoRjEtRjEyIGNhbm5vdCBiZSBzdG9wcGVkIHRocm91Z2ggdGhlIGV2ZW50KVxuICAgICAgICAvL1xuICAgICAgICAvLyBXZSB0aGVyZWZvcmUgZG8gdGhpcyBmb3IgYWxsIGZ1bmN0aW9uIGtleXMgYXMgd2VsbCBhcyB3aGVuIEN0cmwga2V5XG4gICAgICAgIC8vIGlzIHByZXNzZWQuXG4gICAgICAgIHZhciBWS19GMSA9IDExMjtcbiAgICAgICAgdmFyIFZLX0YxMiA9IDEyMztcbiAgICAgICAgaWYgKGJlLmN0cmxLZXkgfHwgYmUua2V5Q29kZSA+PSBWS19GMSAmJiBiZS5rZXlDb2RlIDw9IFZLX0YxMikge1xuICAgICAgICAgIGJlLmtleUNvZGUgPSAtMTtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZXgpIHtcbiAgICAgICAgLy8gSUUgdGhyb3dzIGFuICdhY2Nlc3MgZGVuaWVkJyBleGNlcHRpb24gd2hlbiB0cnlpbmcgdG8gY2hhbmdlXG4gICAgICAgIC8vIGtleUNvZGUgaW4gc29tZSBzaXR1YXRpb25zIChlLmcuIHNyY0VsZW1lbnQgaXMgaW5wdXRbdHlwZT1maWxlXSxcbiAgICAgICAgLy8gb3Igc3JjRWxlbWVudCBpcyBhbiBhbmNob3IgdGFnIHJld3JpdHRlbiBieSBwYXJlbnQncyBpbm5lckhUTUwpLlxuICAgICAgICAvLyBEbyBub3RoaW5nIGluIHRoaXMgY2FzZS5cbiAgICAgIH1cbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgYmUucHJldmVudERlZmF1bHQoKTtcbiAgfVxufTtcblxuXG4vKipcbiAqIEByZXR1cm4ge0V2ZW50fSBUaGUgdW5kZXJseWluZyBicm93c2VyIGV2ZW50IG9iamVjdC5cbiAqL1xuZ29vZy5ldmVudHMuQnJvd3NlckV2ZW50LnByb3RvdHlwZS5nZXRCcm93c2VyRXZlbnQgPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gdGhpcy5ldmVudF87XG59O1xuXG5cbi8qKlxuICogRXh0cmFjdHMgdGhlIHBvaW50ZXIgdHlwZSBmcm9tIHRoZSBnaXZlbiBldmVudC5cbiAqIEBwYXJhbSB7IUV2ZW50fSBlXG4gKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSBwb2ludGVyIHR5cGUsIGUuZy4gJ21vdXNlJywgJ3BlbicsIG9yICd0b3VjaCcuXG4gKiBAcHJpdmF0ZVxuICovXG5nb29nLmV2ZW50cy5Ccm93c2VyRXZlbnQuZ2V0UG9pbnRlclR5cGVfID0gZnVuY3Rpb24oZSkge1xuICAndXNlIHN0cmljdCc7XG4gIGlmICh0eXBlb2YgKGUucG9pbnRlclR5cGUpID09PSAnc3RyaW5nJykge1xuICAgIHJldHVybiBlLnBvaW50ZXJUeXBlO1xuICB9XG4gIC8vIElFMTAgdXNlcyBpbnRlZ2VyIGNvZGVzIGZvciBwb2ludGVyIHR5cGUuXG4gIC8vIGh0dHBzOi8vbXNkbi5taWNyb3NvZnQuY29tL2VuLXVzL2xpYnJhcnkvaGg3NzIzNTkodj12cy44NSkuYXNweFxuICByZXR1cm4gZ29vZy5ldmVudHMuQnJvd3NlckV2ZW50LklFX1BPSU5URVJfVFlQRV9NQVBbZS5wb2ludGVyVHlwZV0gfHwgJyc7XG59O1xuIiwgIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCBUaGUgQ2xvc3VyZSBMaWJyYXJ5IEF1dGhvcnMuXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogQGZpbGVvdmVydmlldyBFdmVudCBUeXBlcy5cbiAqIEBzdXBwcmVzcyB7bWlzc2luZ1JlcXVpcmV9IFRPRE8odXNlcik6IHRoaXMgc2hvdWxkbid0IGJlIG5lZWRlZFxuICovXG5cblxuZ29vZy5wcm92aWRlKCdnb29nLmV2ZW50cy5FdmVudFR5cGUnKTtcbmdvb2cucHJvdmlkZSgnZ29vZy5ldmVudHMuTW91c2VBc01vdXNlRXZlbnRUeXBlJyk7XG5nb29nLnByb3ZpZGUoJ2dvb2cuZXZlbnRzLk1vdXNlRXZlbnRzJyk7XG5nb29nLnByb3ZpZGUoJ2dvb2cuZXZlbnRzLlBvaW50ZXJBc01vdXNlRXZlbnRUeXBlJyk7XG5nb29nLnByb3ZpZGUoJ2dvb2cuZXZlbnRzLlBvaW50ZXJBc1RvdWNoRXZlbnRUeXBlJyk7XG5nb29nLnByb3ZpZGUoJ2dvb2cuZXZlbnRzLlBvaW50ZXJGYWxsYmFja0V2ZW50VHlwZScpO1xuZ29vZy5wcm92aWRlKCdnb29nLmV2ZW50cy5Qb2ludGVyVG91Y2hGYWxsYmFja0V2ZW50VHlwZScpO1xuXG5nb29nLnJlcXVpcmUoJ2dvb2cuZXZlbnRzLkJyb3dzZXJGZWF0dXJlJyk7XG5nb29nLnJlcXVpcmUoJ2dvb2cudXNlckFnZW50Jyk7XG5cblxuLyoqXG4gKiBSZXR1cm5zIGEgcHJlZml4ZWQgZXZlbnQgbmFtZSBmb3IgdGhlIGN1cnJlbnQgYnJvd3Nlci5cbiAqIEBwYXJhbSB7c3RyaW5nfSBldmVudE5hbWUgVGhlIG5hbWUgb2YgdGhlIGV2ZW50LlxuICogQHJldHVybiB7c3RyaW5nfSBUaGUgcHJlZml4ZWQgZXZlbnQgbmFtZS5cbiAqIEBwcml2YXRlXG4gKi9cbmdvb2cuZXZlbnRzLmdldFZlbmRvclByZWZpeGVkTmFtZV8gPSBmdW5jdGlvbihldmVudE5hbWUpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gZ29vZy51c2VyQWdlbnQuV0VCS0lUID9cbiAgICAgICd3ZWJraXQnICsgZXZlbnROYW1lIDpcbiAgICAgIChnb29nLnVzZXJBZ2VudC5PUEVSQSA/ICdvJyArIGV2ZW50TmFtZS50b0xvd2VyQ2FzZSgpIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50TmFtZS50b0xvd2VyQ2FzZSgpKTtcbn07XG5cblxuLyoqXG4gKiBDb25zdGFudHMgZm9yIGV2ZW50IG5hbWVzLlxuICogQGVudW0ge3N0cmluZ31cbiAqL1xuZ29vZy5ldmVudHMuRXZlbnRUeXBlID0ge1xuICAvLyBNb3VzZSBldmVudHNcbiAgQ0xJQ0s6ICdjbGljaycsXG4gIFJJR0hUQ0xJQ0s6ICdyaWdodGNsaWNrJyxcbiAgREJMQ0xJQ0s6ICdkYmxjbGljaycsXG4gIEFVWENMSUNLOiAnYXV4Y2xpY2snLFxuICBNT1VTRURPV046ICdtb3VzZWRvd24nLFxuICBNT1VTRVVQOiAnbW91c2V1cCcsXG4gIE1PVVNFT1ZFUjogJ21vdXNlb3ZlcicsXG4gIE1PVVNFT1VUOiAnbW91c2VvdXQnLFxuICBNT1VTRU1PVkU6ICdtb3VzZW1vdmUnLFxuICBNT1VTRUVOVEVSOiAnbW91c2VlbnRlcicsXG4gIE1PVVNFTEVBVkU6ICdtb3VzZWxlYXZlJyxcblxuICAvLyBOb24tZXhpc3RlbnQgZXZlbnQ7IHdpbGwgbmV2ZXIgZmlyZS4gVGhpcyBleGlzdHMgYXMgYSBtb3VzZSBjb3VudGVycGFydCB0b1xuICAvLyBQT0lOVEVSQ0FOQ0VMLlxuICBNT1VTRUNBTkNFTDogJ21vdXNlY2FuY2VsJyxcblxuICAvLyBTZWxlY3Rpb24gZXZlbnRzLlxuICAvLyBodHRwczovL3d3dy53My5vcmcvVFIvc2VsZWN0aW9uLWFwaS9cbiAgU0VMRUNUSU9OQ0hBTkdFOiAnc2VsZWN0aW9uY2hhbmdlJyxcbiAgU0VMRUNUU1RBUlQ6ICdzZWxlY3RzdGFydCcsICAvLyBJRSwgU2FmYXJpLCBDaHJvbWVcblxuICAvLyBXaGVlbCBldmVudHNcbiAgLy8gaHR0cDovL3d3dy53My5vcmcvVFIvRE9NLUxldmVsLTMtRXZlbnRzLyNldmVudHMtd2hlZWxldmVudHNcbiAgV0hFRUw6ICd3aGVlbCcsXG5cbiAgLy8gS2V5IGV2ZW50c1xuICBLRVlQUkVTUzogJ2tleXByZXNzJyxcbiAgS0VZRE9XTjogJ2tleWRvd24nLFxuICBLRVlVUDogJ2tleXVwJyxcblxuICAvLyBGb2N1c1xuICBCTFVSOiAnYmx1cicsXG4gIEZPQ1VTOiAnZm9jdXMnLFxuICBERUFDVElWQVRFOiAnZGVhY3RpdmF0ZScsICAvLyBJRSBvbmx5XG4gIEZPQ1VTSU46ICdmb2N1c2luJyxcbiAgRk9DVVNPVVQ6ICdmb2N1c291dCcsXG5cbiAgLy8gRm9ybXNcbiAgQ0hBTkdFOiAnY2hhbmdlJyxcbiAgUkVTRVQ6ICdyZXNldCcsXG4gIFNFTEVDVDogJ3NlbGVjdCcsXG4gIFNVQk1JVDogJ3N1Ym1pdCcsXG4gIElOUFVUOiAnaW5wdXQnLFxuICBQUk9QRVJUWUNIQU5HRTogJ3Byb3BlcnR5Y2hhbmdlJywgIC8vIElFIG9ubHlcblxuICAvLyBEcmFnIGFuZCBkcm9wXG4gIERSQUdTVEFSVDogJ2RyYWdzdGFydCcsXG4gIERSQUc6ICdkcmFnJyxcbiAgRFJBR0VOVEVSOiAnZHJhZ2VudGVyJyxcbiAgRFJBR09WRVI6ICdkcmFnb3ZlcicsXG4gIERSQUdMRUFWRTogJ2RyYWdsZWF2ZScsXG4gIERST1A6ICdkcm9wJyxcbiAgRFJBR0VORDogJ2RyYWdlbmQnLFxuXG4gIC8vIFRvdWNoIGV2ZW50c1xuICAvLyBOb3RlIHRoYXQgb3RoZXIgdG91Y2ggZXZlbnRzIGV4aXN0LCBidXQgd2Ugc2hvdWxkIGZvbGxvdyB0aGUgVzNDIGxpc3QgaGVyZS5cbiAgLy8gaHR0cDovL3d3dy53My5vcmcvVFIvdG91Y2gtZXZlbnRzLyNsaXN0LW9mLXRvdWNoZXZlbnQtdHlwZXNcbiAgVE9VQ0hTVEFSVDogJ3RvdWNoc3RhcnQnLFxuICBUT1VDSE1PVkU6ICd0b3VjaG1vdmUnLFxuICBUT1VDSEVORDogJ3RvdWNoZW5kJyxcbiAgVE9VQ0hDQU5DRUw6ICd0b3VjaGNhbmNlbCcsXG5cbiAgLy8gTWlzY1xuICBCRUZPUkVVTkxPQUQ6ICdiZWZvcmV1bmxvYWQnLFxuICBDT05TT0xFTUVTU0FHRTogJ2NvbnNvbGVtZXNzYWdlJyxcbiAgQ09OVEVYVE1FTlU6ICdjb250ZXh0bWVudScsXG4gIERFVklDRUNIQU5HRTogJ2RldmljZWNoYW5nZScsXG4gIERFVklDRU1PVElPTjogJ2RldmljZW1vdGlvbicsXG4gIERFVklDRU9SSUVOVEFUSU9OOiAnZGV2aWNlb3JpZW50YXRpb24nLFxuICBET01DT05URU5UTE9BREVEOiAnRE9NQ29udGVudExvYWRlZCcsXG4gIEVSUk9SOiAnZXJyb3InLFxuICBIRUxQOiAnaGVscCcsXG4gIExPQUQ6ICdsb2FkJyxcbiAgTE9TRUNBUFRVUkU6ICdsb3NlY2FwdHVyZScsXG4gIE9SSUVOVEFUSU9OQ0hBTkdFOiAnb3JpZW50YXRpb25jaGFuZ2UnLFxuICBSRUFEWVNUQVRFQ0hBTkdFOiAncmVhZHlzdGF0ZWNoYW5nZScsXG4gIFJFU0laRTogJ3Jlc2l6ZScsXG4gIFNDUk9MTDogJ3Njcm9sbCcsXG4gIFVOTE9BRDogJ3VubG9hZCcsXG5cbiAgLy8gTWVkaWEgZXZlbnRzXG4gIENBTlBMQVk6ICdjYW5wbGF5JyxcbiAgQ0FOUExBWVRIUk9VR0g6ICdjYW5wbGF5dGhyb3VnaCcsXG4gIERVUkFUSU9OQ0hBTkdFOiAnZHVyYXRpb25jaGFuZ2UnLFxuICBFTVBUSUVEOiAnZW1wdGllZCcsXG4gIEVOREVEOiAnZW5kZWQnLFxuICBMT0FERUREQVRBOiAnbG9hZGVkZGF0YScsXG4gIExPQURFRE1FVEFEQVRBOiAnbG9hZGVkbWV0YWRhdGEnLFxuICBQQVVTRTogJ3BhdXNlJyxcbiAgUExBWTogJ3BsYXknLFxuICBQTEFZSU5HOiAncGxheWluZycsXG4gIFBST0dSRVNTOiAncHJvZ3Jlc3MnLFxuICBSQVRFQ0hBTkdFOiAncmF0ZWNoYW5nZScsXG4gIFNFRUtFRDogJ3NlZWtlZCcsXG4gIFNFRUtJTkc6ICdzZWVraW5nJyxcbiAgU1RBTExFRDogJ3N0YWxsZWQnLFxuICBTVVNQRU5EOiAnc3VzcGVuZCcsXG4gIFRJTUVVUERBVEU6ICd0aW1ldXBkYXRlJyxcbiAgVk9MVU1FQ0hBTkdFOiAndm9sdW1lY2hhbmdlJyxcbiAgV0FJVElORzogJ3dhaXRpbmcnLFxuXG4gIC8vIE1lZGlhIFNvdXJjZSBFeHRlbnNpb25zIGV2ZW50c1xuICAvLyBodHRwczovL3d3dy53My5vcmcvVFIvbWVkaWEtc291cmNlLyNtZWRpYXNvdXJjZS1ldmVudHNcbiAgU09VUkNFT1BFTjogJ3NvdXJjZW9wZW4nLFxuICBTT1VSQ0VFTkRFRDogJ3NvdXJjZWVuZGVkJyxcbiAgU09VUkNFQ0xPU0VEOiAnc291cmNlY2xvc2VkJyxcbiAgLy8gaHR0cHM6Ly93d3cudzMub3JnL1RSL21lZGlhLXNvdXJjZS8jc291cmNlYnVmZmVyLWV2ZW50c1xuICBBQk9SVDogJ2Fib3J0JyxcbiAgVVBEQVRFOiAndXBkYXRlJyxcbiAgVVBEQVRFU1RBUlQ6ICd1cGRhdGVzdGFydCcsXG4gIFVQREFURUVORDogJ3VwZGF0ZWVuZCcsXG5cbiAgLy8gSFRNTCA1IEhpc3RvcnkgZXZlbnRzXG4gIC8vIFNlZSBodHRwOi8vd3d3LnczLm9yZy9UUi9odG1sNS9icm93c2Vycy5odG1sI2V2ZW50LWRlZmluaXRpb25zLTBcbiAgSEFTSENIQU5HRTogJ2hhc2hjaGFuZ2UnLFxuICBQQUdFSElERTogJ3BhZ2VoaWRlJyxcbiAgUEFHRVNIT1c6ICdwYWdlc2hvdycsXG4gIFBPUFNUQVRFOiAncG9wc3RhdGUnLFxuXG4gIC8vIENvcHkgYW5kIFBhc3RlXG4gIC8vIFN1cHBvcnQgaXMgbGltaXRlZC4gTWFrZSBzdXJlIGl0IHdvcmtzIG9uIHlvdXIgZmF2b3JpdGUgYnJvd3NlclxuICAvLyBiZWZvcmUgdXNpbmcuXG4gIC8vIGh0dHA6Ly93d3cucXVpcmtzbW9kZS5vcmcvZG9tL2V2ZW50cy9jdXRjb3B5cGFzdGUuaHRtbFxuICBDT1BZOiAnY29weScsXG4gIFBBU1RFOiAncGFzdGUnLFxuICBDVVQ6ICdjdXQnLFxuICBCRUZPUkVDT1BZOiAnYmVmb3JlY29weScsXG4gIEJFRk9SRUNVVDogJ2JlZm9yZWN1dCcsXG4gIEJFRk9SRVBBU1RFOiAnYmVmb3JlcGFzdGUnLFxuXG4gIC8vIEhUTUw1IG9ubGluZS9vZmZsaW5lIGV2ZW50cy5cbiAgLy8gaHR0cDovL3d3dy53My5vcmcvVFIvb2ZmbGluZS13ZWJhcHBzLyNyZWxhdGVkXG4gIE9OTElORTogJ29ubGluZScsXG4gIE9GRkxJTkU6ICdvZmZsaW5lJyxcblxuICAvLyBIVE1MIDUgd29ya2VyIGV2ZW50c1xuICBNRVNTQUdFOiAnbWVzc2FnZScsXG4gIENPTk5FQ1Q6ICdjb25uZWN0JyxcblxuICAvLyBTZXJ2aWNlIFdvcmtlciBFdmVudHMgLSBTZXJ2aWNlV29ya2VyR2xvYmFsU2NvcGUgY29udGV4dFxuICAvLyBTZWUgaHR0cHM6Ly93M2MuZ2l0aHViLmlvL1NlcnZpY2VXb3JrZXIvI2V4ZWN1dGlvbi1jb250ZXh0LWV2ZW50c1xuICAvLyBOb3RlOiBtZXNzYWdlIGV2ZW50IGRlZmluZWQgaW4gd29ya2VyIGV2ZW50cyBzZWN0aW9uXG4gIElOU1RBTEw6ICdpbnN0YWxsJyxcbiAgQUNUSVZBVEU6ICdhY3RpdmF0ZScsXG4gIEZFVENIOiAnZmV0Y2gnLFxuICBGT1JFSUdORkVUQ0g6ICdmb3JlaWduZmV0Y2gnLFxuICBNRVNTQUdFRVJST1I6ICdtZXNzYWdlZXJyb3InLFxuXG4gIC8vIFNlcnZpY2UgV29ya2VyIEV2ZW50cyAtIERvY3VtZW50IGNvbnRleHRcbiAgLy8gU2VlIGh0dHBzOi8vdzNjLmdpdGh1Yi5pby9TZXJ2aWNlV29ya2VyLyNkb2N1bWVudC1jb250ZXh0LWV2ZW50c1xuICBTVEFURUNIQU5HRTogJ3N0YXRlY2hhbmdlJyxcbiAgVVBEQVRFRk9VTkQ6ICd1cGRhdGVmb3VuZCcsXG4gIENPTlRST0xMRVJDSEFOR0U6ICdjb250cm9sbGVyY2hhbmdlJyxcblxuICAvLyBDU1MgYW5pbWF0aW9uIGV2ZW50cy5cbiAgQU5JTUFUSU9OU1RBUlQ6IGdvb2cuZXZlbnRzLmdldFZlbmRvclByZWZpeGVkTmFtZV8oJ0FuaW1hdGlvblN0YXJ0JyksXG4gIEFOSU1BVElPTkVORDogZ29vZy5ldmVudHMuZ2V0VmVuZG9yUHJlZml4ZWROYW1lXygnQW5pbWF0aW9uRW5kJyksXG4gIEFOSU1BVElPTklURVJBVElPTjogZ29vZy5ldmVudHMuZ2V0VmVuZG9yUHJlZml4ZWROYW1lXygnQW5pbWF0aW9uSXRlcmF0aW9uJyksXG5cbiAgLy8gQ1NTIHRyYW5zaXRpb24gZXZlbnRzLiBCYXNlZCBvbiB0aGUgYnJvd3NlciBzdXBwb3J0IGRlc2NyaWJlZCBhdDpcbiAgLy8gaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4vY3NzL2Nzc190cmFuc2l0aW9ucyNCcm93c2VyX2NvbXBhdGliaWxpdHlcbiAgVFJBTlNJVElPTkVORDogZ29vZy5ldmVudHMuZ2V0VmVuZG9yUHJlZml4ZWROYW1lXygnVHJhbnNpdGlvbkVuZCcpLFxuXG4gIC8vIFczQyBQb2ludGVyIEV2ZW50c1xuICAvLyBodHRwOi8vd3d3LnczLm9yZy9UUi9wb2ludGVyZXZlbnRzL1xuICBQT0lOVEVSRE9XTjogJ3BvaW50ZXJkb3duJyxcbiAgUE9JTlRFUlVQOiAncG9pbnRlcnVwJyxcbiAgUE9JTlRFUkNBTkNFTDogJ3BvaW50ZXJjYW5jZWwnLFxuICBQT0lOVEVSTU9WRTogJ3BvaW50ZXJtb3ZlJyxcbiAgUE9JTlRFUk9WRVI6ICdwb2ludGVyb3ZlcicsXG4gIFBPSU5URVJPVVQ6ICdwb2ludGVyb3V0JyxcbiAgUE9JTlRFUkVOVEVSOiAncG9pbnRlcmVudGVyJyxcbiAgUE9JTlRFUkxFQVZFOiAncG9pbnRlcmxlYXZlJyxcbiAgR09UUE9JTlRFUkNBUFRVUkU6ICdnb3Rwb2ludGVyY2FwdHVyZScsXG4gIExPU1RQT0lOVEVSQ0FQVFVSRTogJ2xvc3Rwb2ludGVyY2FwdHVyZScsXG5cbiAgLy8gSUUgc3BlY2lmaWMgZXZlbnRzLlxuICAvLyBTZWUgaHR0cDovL21zZG4ubWljcm9zb2Z0LmNvbS9lbi11cy9saWJyYXJ5L2llL2hoNzcyMTAzKHY9dnMuODUpLmFzcHhcbiAgLy8gTm90ZTogdGhlc2UgZXZlbnRzIHdpbGwgYmUgc3VwcGxhbnRlZCBpbiBJRTExLlxuICBNU0dFU1RVUkVDSEFOR0U6ICdNU0dlc3R1cmVDaGFuZ2UnLFxuICBNU0dFU1RVUkVFTkQ6ICdNU0dlc3R1cmVFbmQnLFxuICBNU0dFU1RVUkVIT0xEOiAnTVNHZXN0dXJlSG9sZCcsXG4gIE1TR0VTVFVSRVNUQVJUOiAnTVNHZXN0dXJlU3RhcnQnLFxuICBNU0dFU1RVUkVUQVA6ICdNU0dlc3R1cmVUYXAnLFxuICBNU0dPVFBPSU5URVJDQVBUVVJFOiAnTVNHb3RQb2ludGVyQ2FwdHVyZScsXG4gIE1TSU5FUlRJQVNUQVJUOiAnTVNJbmVydGlhU3RhcnQnLFxuICBNU0xPU1RQT0lOVEVSQ0FQVFVSRTogJ01TTG9zdFBvaW50ZXJDYXB0dXJlJyxcbiAgTVNQT0lOVEVSQ0FOQ0VMOiAnTVNQb2ludGVyQ2FuY2VsJyxcbiAgTVNQT0lOVEVSRE9XTjogJ01TUG9pbnRlckRvd24nLFxuICBNU1BPSU5URVJFTlRFUjogJ01TUG9pbnRlckVudGVyJyxcbiAgTVNQT0lOVEVSSE9WRVI6ICdNU1BvaW50ZXJIb3ZlcicsXG4gIE1TUE9JTlRFUkxFQVZFOiAnTVNQb2ludGVyTGVhdmUnLFxuICBNU1BPSU5URVJNT1ZFOiAnTVNQb2ludGVyTW92ZScsXG4gIE1TUE9JTlRFUk9VVDogJ01TUG9pbnRlck91dCcsXG4gIE1TUE9JTlRFUk9WRVI6ICdNU1BvaW50ZXJPdmVyJyxcbiAgTVNQT0lOVEVSVVA6ICdNU1BvaW50ZXJVcCcsXG5cbiAgLy8gTmF0aXZlIElNRXMvaW5wdXQgdG9vbHMgZXZlbnRzLlxuICBURVhUOiAndGV4dCcsXG4gIC8vIFRoZSB0ZXh0SW5wdXQgZXZlbnQgaXMgc3VwcG9ydGVkIGluIElFOSssIGJ1dCBvbmx5IGluIGxvd2VyIGNhc2UuIEFsbCBvdGhlclxuICAvLyBicm93c2VycyB1c2UgdGhlIGNhbWVsLWNhc2UgZXZlbnQgbmFtZS5cbiAgVEVYVElOUFVUOiBnb29nLnVzZXJBZ2VudC5JRSA/ICd0ZXh0aW5wdXQnIDogJ3RleHRJbnB1dCcsXG4gIENPTVBPU0lUSU9OU1RBUlQ6ICdjb21wb3NpdGlvbnN0YXJ0JyxcbiAgQ09NUE9TSVRJT05VUERBVEU6ICdjb21wb3NpdGlvbnVwZGF0ZScsXG4gIENPTVBPU0lUSU9ORU5EOiAnY29tcG9zaXRpb25lbmQnLFxuXG4gIC8vIFRoZSBiZWZvcmVpbnB1dCBldmVudCBpcyBpbml0aWFsbHkgb25seSBzdXBwb3J0ZWQgaW4gU2FmYXJpLiBTZWVcbiAgLy8gaHR0cHM6Ly9idWdzLmNocm9taXVtLm9yZy9wL2Nocm9taXVtL2lzc3Vlcy9kZXRhaWw/aWQ9MzQyNjcwIGZvciBDaHJvbWVcbiAgLy8gaW1wbGVtZW50YXRpb24gdHJhY2tpbmcuXG4gIEJFRk9SRUlOUFVUOiAnYmVmb3JlaW5wdXQnLFxuXG4gIC8vIFdlYnZpZXcgdGFnIGV2ZW50c1xuICAvLyBTZWUgaHR0cHM6Ly9kZXZlbG9wZXIuY2hyb21lLmNvbS9hcHBzL3RhZ3Mvd2Vidmlld1xuICBFWElUOiAnZXhpdCcsXG4gIExPQURBQk9SVDogJ2xvYWRhYm9ydCcsXG4gIExPQURDT01NSVQ6ICdsb2FkY29tbWl0JyxcbiAgTE9BRFJFRElSRUNUOiAnbG9hZHJlZGlyZWN0JyxcbiAgTE9BRFNUQVJUOiAnbG9hZHN0YXJ0JyxcbiAgTE9BRFNUT1A6ICdsb2Fkc3RvcCcsXG4gIFJFU1BPTlNJVkU6ICdyZXNwb25zaXZlJyxcbiAgU0laRUNIQU5HRUQ6ICdzaXplY2hhbmdlZCcsXG4gIFVOUkVTUE9OU0lWRTogJ3VucmVzcG9uc2l2ZScsXG5cbiAgLy8gSFRNTDUgUGFnZSBWaXNpYmlsaXR5IEFQSS4gIFNlZSBkZXRhaWxzIGF0XG4gIC8vIGBnb29nLmxhYnMuZG9tLlBhZ2VWaXNpYmlsaXR5TW9uaXRvcmAuXG4gIFZJU0lCSUxJVFlDSEFOR0U6ICd2aXNpYmlsaXR5Y2hhbmdlJyxcblxuICAvLyBMb2NhbFN0b3JhZ2UgZXZlbnQuXG4gIFNUT1JBR0U6ICdzdG9yYWdlJyxcblxuICAvLyBET00gTGV2ZWwgMiBtdXRhdGlvbiBldmVudHMgKGRlcHJlY2F0ZWQpLlxuICBET01TVUJUUkVFTU9ESUZJRUQ6ICdET01TdWJ0cmVlTW9kaWZpZWQnLFxuICBET01OT0RFSU5TRVJURUQ6ICdET01Ob2RlSW5zZXJ0ZWQnLFxuICBET01OT0RFUkVNT1ZFRDogJ0RPTU5vZGVSZW1vdmVkJyxcbiAgRE9NTk9ERVJFTU9WRURGUk9NRE9DVU1FTlQ6ICdET01Ob2RlUmVtb3ZlZEZyb21Eb2N1bWVudCcsXG4gIERPTU5PREVJTlNFUlRFRElOVE9ET0NVTUVOVDogJ0RPTU5vZGVJbnNlcnRlZEludG9Eb2N1bWVudCcsXG4gIERPTUFUVFJNT0RJRklFRDogJ0RPTUF0dHJNb2RpZmllZCcsXG4gIERPTUNIQVJBQ1RFUkRBVEFNT0RJRklFRDogJ0RPTUNoYXJhY3RlckRhdGFNb2RpZmllZCcsXG5cbiAgLy8gUHJpbnQgZXZlbnRzLlxuICBCRUZPUkVQUklOVDogJ2JlZm9yZXByaW50JyxcbiAgQUZURVJQUklOVDogJ2FmdGVycHJpbnQnLFxuXG4gIC8vIFdlYiBhcHAgbWFuaWZlc3QgZXZlbnRzLlxuICBCRUZPUkVJTlNUQUxMUFJPTVBUOiAnYmVmb3JlaW5zdGFsbHByb21wdCcsXG4gIEFQUElOU1RBTExFRDogJ2FwcGluc3RhbGxlZCdcbn07XG5cblxuLyoqXG4gKiBSZXR1cm5zIG9uZSBvZiB0aGUgZ2l2ZW4gcG9pbnRlciBmYWxsYmFjayBldmVudCBuYW1lcyBpbiBvcmRlciBvZiBwcmVmZXJlbmNlOlxuICogICAxLiBwb2ludGVyRXZlbnROYW1lXG4gKiAgIDIuIG1zUG9pbnRlckV2ZW50TmFtZVxuICogICAzLiBmYWxsYmFja0V2ZW50TmFtZVxuICogQHBhcmFtIHtzdHJpbmd9IHBvaW50ZXJFdmVudE5hbWVcbiAqIEBwYXJhbSB7c3RyaW5nfSBtc1BvaW50ZXJFdmVudE5hbWVcbiAqIEBwYXJhbSB7c3RyaW5nfSBmYWxsYmFja0V2ZW50TmFtZVxuICogQHJldHVybiB7c3RyaW5nfSBUaGUgc3VwcG9ydGVkIHBvaW50ZXIgb3IgZmFsbGJhY2sgKG1vdXNlIG9yIHRvdWNoKSBldmVudFxuICogICAgIG5hbWUuXG4gKiBAcHJpdmF0ZVxuICovXG5nb29nLmV2ZW50cy5nZXRQb2ludGVyRmFsbGJhY2tFdmVudE5hbWVfID0gZnVuY3Rpb24oXG4gICAgcG9pbnRlckV2ZW50TmFtZSwgbXNQb2ludGVyRXZlbnROYW1lLCBmYWxsYmFja0V2ZW50TmFtZSkge1xuICAndXNlIHN0cmljdCc7XG4gIGlmIChnb29nLmV2ZW50cy5Ccm93c2VyRmVhdHVyZS5QT0lOVEVSX0VWRU5UUykge1xuICAgIHJldHVybiBwb2ludGVyRXZlbnROYW1lO1xuICB9XG4gIGlmIChnb29nLmV2ZW50cy5Ccm93c2VyRmVhdHVyZS5NU1BPSU5URVJfRVZFTlRTKSB7XG4gICAgcmV0dXJuIG1zUG9pbnRlckV2ZW50TmFtZTtcbiAgfVxuICByZXR1cm4gZmFsbGJhY2tFdmVudE5hbWU7XG59O1xuXG5cbi8qKlxuICogQ29uc3RhbnRzIGZvciBwb2ludGVyIGV2ZW50IG5hbWVzIHRoYXQgZmFsbCBiYWNrIHRvIGNvcnJlc3BvbmRpbmcgbW91c2UgZXZlbnRcbiAqIG5hbWVzIG9uIHVuc3VwcG9ydGVkIHBsYXRmb3Jtcy4gVGhlc2UgYXJlIGludGVuZGVkIHRvIGJlIGRyb3AtaW4gcmVwbGFjZW1lbnRzXG4gKiBmb3IgY29ycmVzcG9uZGluZyB2YWx1ZXMgaW4gYGdvb2cuZXZlbnRzLkV2ZW50VHlwZWAuXG4gKiBAZW51bSB7c3RyaW5nfVxuICovXG5nb29nLmV2ZW50cy5Qb2ludGVyRmFsbGJhY2tFdmVudFR5cGUgPSB7XG4gIFBPSU5URVJET1dOOiBnb29nLmV2ZW50cy5nZXRQb2ludGVyRmFsbGJhY2tFdmVudE5hbWVfKFxuICAgICAgZ29vZy5ldmVudHMuRXZlbnRUeXBlLlBPSU5URVJET1dOLCBnb29nLmV2ZW50cy5FdmVudFR5cGUuTVNQT0lOVEVSRE9XTixcbiAgICAgIGdvb2cuZXZlbnRzLkV2ZW50VHlwZS5NT1VTRURPV04pLFxuICBQT0lOVEVSVVA6IGdvb2cuZXZlbnRzLmdldFBvaW50ZXJGYWxsYmFja0V2ZW50TmFtZV8oXG4gICAgICBnb29nLmV2ZW50cy5FdmVudFR5cGUuUE9JTlRFUlVQLCBnb29nLmV2ZW50cy5FdmVudFR5cGUuTVNQT0lOVEVSVVAsXG4gICAgICBnb29nLmV2ZW50cy5FdmVudFR5cGUuTU9VU0VVUCksXG4gIFBPSU5URVJDQU5DRUw6IGdvb2cuZXZlbnRzLmdldFBvaW50ZXJGYWxsYmFja0V2ZW50TmFtZV8oXG4gICAgICBnb29nLmV2ZW50cy5FdmVudFR5cGUuUE9JTlRFUkNBTkNFTCxcbiAgICAgIGdvb2cuZXZlbnRzLkV2ZW50VHlwZS5NU1BPSU5URVJDQU5DRUwsXG4gICAgICAvLyBXaGVuIGZhbGxpbmcgYmFjayB0byBtb3VzZSBldmVudHMsIHRoZXJlIGlzIG5vIE1PVVNFQ0FOQ0VMIGVxdWl2YWxlbnRcbiAgICAgIC8vIG9mIFBPSU5URVJDQU5DRUwuIEluIHRoaXMgY2FzZSBQT0lOVEVSVVAgYWxyZWFkeSBmYWxscyBiYWNrIHRvIE1PVVNFVVBcbiAgICAgIC8vIHdoaWNoIHJlcHJlc2VudHMgYm90aCBVUCBhbmQgQ0FOQ0VMLiBQT0lOVEVSQ0FOQ0VMIGRvZXMgbm90IGZhbGwgYmFja1xuICAgICAgLy8gdG8gTU9VU0VVUCB0byBwcmV2ZW50IGxpc3RlbmluZyB0d2ljZSBvbiB0aGUgc2FtZSBldmVudC5cbiAgICAgIGdvb2cuZXZlbnRzLkV2ZW50VHlwZS5NT1VTRUNBTkNFTCksXG4gIFBPSU5URVJNT1ZFOiBnb29nLmV2ZW50cy5nZXRQb2ludGVyRmFsbGJhY2tFdmVudE5hbWVfKFxuICAgICAgZ29vZy5ldmVudHMuRXZlbnRUeXBlLlBPSU5URVJNT1ZFLCBnb29nLmV2ZW50cy5FdmVudFR5cGUuTVNQT0lOVEVSTU9WRSxcbiAgICAgIGdvb2cuZXZlbnRzLkV2ZW50VHlwZS5NT1VTRU1PVkUpLFxuICBQT0lOVEVST1ZFUjogZ29vZy5ldmVudHMuZ2V0UG9pbnRlckZhbGxiYWNrRXZlbnROYW1lXyhcbiAgICAgIGdvb2cuZXZlbnRzLkV2ZW50VHlwZS5QT0lOVEVST1ZFUiwgZ29vZy5ldmVudHMuRXZlbnRUeXBlLk1TUE9JTlRFUk9WRVIsXG4gICAgICBnb29nLmV2ZW50cy5FdmVudFR5cGUuTU9VU0VPVkVSKSxcbiAgUE9JTlRFUk9VVDogZ29vZy5ldmVudHMuZ2V0UG9pbnRlckZhbGxiYWNrRXZlbnROYW1lXyhcbiAgICAgIGdvb2cuZXZlbnRzLkV2ZW50VHlwZS5QT0lOVEVST1VULCBnb29nLmV2ZW50cy5FdmVudFR5cGUuTVNQT0lOVEVST1VULFxuICAgICAgZ29vZy5ldmVudHMuRXZlbnRUeXBlLk1PVVNFT1VUKSxcbiAgUE9JTlRFUkVOVEVSOiBnb29nLmV2ZW50cy5nZXRQb2ludGVyRmFsbGJhY2tFdmVudE5hbWVfKFxuICAgICAgZ29vZy5ldmVudHMuRXZlbnRUeXBlLlBPSU5URVJFTlRFUiwgZ29vZy5ldmVudHMuRXZlbnRUeXBlLk1TUE9JTlRFUkVOVEVSLFxuICAgICAgZ29vZy5ldmVudHMuRXZlbnRUeXBlLk1PVVNFRU5URVIpLFxuICBQT0lOVEVSTEVBVkU6IGdvb2cuZXZlbnRzLmdldFBvaW50ZXJGYWxsYmFja0V2ZW50TmFtZV8oXG4gICAgICBnb29nLmV2ZW50cy5FdmVudFR5cGUuUE9JTlRFUkxFQVZFLCBnb29nLmV2ZW50cy5FdmVudFR5cGUuTVNQT0lOVEVSTEVBVkUsXG4gICAgICBnb29nLmV2ZW50cy5FdmVudFR5cGUuTU9VU0VMRUFWRSlcbn07XG5cblxuLyoqXG4gKiBDb25zdGFudHMgZm9yIHBvaW50ZXIgZXZlbnQgbmFtZXMgdGhhdCBmYWxsIGJhY2sgdG8gY29ycmVzcG9uZGluZyB0b3VjaCBldmVudFxuICogbmFtZXMgb24gdW5zdXBwb3J0ZWQgcGxhdGZvcm1zLiBUaGVzZSBhcmUgaW50ZW5kZWQgdG8gYmUgZHJvcC1pbiByZXBsYWNlbWVudHNcbiAqIGZvciBjb3JyZXNwb25kaW5nIHZhbHVlcyBpbiBgZ29vZy5ldmVudHMuRXZlbnRUeXBlYC5cbiAqIEBlbnVtIHtzdHJpbmd9XG4gKi9cbmdvb2cuZXZlbnRzLlBvaW50ZXJUb3VjaEZhbGxiYWNrRXZlbnRUeXBlID0ge1xuICBQT0lOVEVSRE9XTjogZ29vZy5ldmVudHMuZ2V0UG9pbnRlckZhbGxiYWNrRXZlbnROYW1lXyhcbiAgICAgIGdvb2cuZXZlbnRzLkV2ZW50VHlwZS5QT0lOVEVSRE9XTiwgZ29vZy5ldmVudHMuRXZlbnRUeXBlLk1TUE9JTlRFUkRPV04sXG4gICAgICBnb29nLmV2ZW50cy5FdmVudFR5cGUuVE9VQ0hTVEFSVCksXG4gIFBPSU5URVJVUDogZ29vZy5ldmVudHMuZ2V0UG9pbnRlckZhbGxiYWNrRXZlbnROYW1lXyhcbiAgICAgIGdvb2cuZXZlbnRzLkV2ZW50VHlwZS5QT0lOVEVSVVAsIGdvb2cuZXZlbnRzLkV2ZW50VHlwZS5NU1BPSU5URVJVUCxcbiAgICAgIGdvb2cuZXZlbnRzLkV2ZW50VHlwZS5UT1VDSEVORCksXG4gIFBPSU5URVJDQU5DRUw6IGdvb2cuZXZlbnRzLmdldFBvaW50ZXJGYWxsYmFja0V2ZW50TmFtZV8oXG4gICAgICBnb29nLmV2ZW50cy5FdmVudFR5cGUuUE9JTlRFUkNBTkNFTCxcbiAgICAgIGdvb2cuZXZlbnRzLkV2ZW50VHlwZS5NU1BPSU5URVJDQU5DRUwsIGdvb2cuZXZlbnRzLkV2ZW50VHlwZS5UT1VDSENBTkNFTCksXG4gIFBPSU5URVJNT1ZFOiBnb29nLmV2ZW50cy5nZXRQb2ludGVyRmFsbGJhY2tFdmVudE5hbWVfKFxuICAgICAgZ29vZy5ldmVudHMuRXZlbnRUeXBlLlBPSU5URVJNT1ZFLCBnb29nLmV2ZW50cy5FdmVudFR5cGUuTVNQT0lOVEVSTU9WRSxcbiAgICAgIGdvb2cuZXZlbnRzLkV2ZW50VHlwZS5UT1VDSE1PVkUpXG59O1xuXG5cbi8qKlxuICogTWFwcGluZyBvZiBtb3VzZSBldmVudCBuYW1lcyB0byB1bmRlcmx5aW5nIGJyb3dzZXIgZXZlbnQgbmFtZXMuXG4gKiBAdHlwZWRlZiB7e1xuICogICAgIE1PVVNFRE9XTjogc3RyaW5nLFxuICogICAgIE1PVVNFVVA6IHN0cmluZyxcbiAqICAgICBNT1VTRUNBTkNFTDpzdHJpbmcsXG4gKiAgICAgTU9VU0VNT1ZFOnN0cmluZyxcbiAqICAgICBNT1VTRU9WRVI6c3RyaW5nLFxuICogICAgIE1PVVNFT1VUOnN0cmluZyxcbiAqICAgICBNT1VTRUVOVEVSOnN0cmluZyxcbiAqICAgICBNT1VTRUxFQVZFOiBzdHJpbmcsXG4gKiB9fVxuICovXG5nb29nLmV2ZW50cy5Nb3VzZUV2ZW50cztcblxuXG4vKipcbiAqIEFuIGFsaWFzIGZvciBgZ29vZy5ldmVudHMuRXZlbnRUeXBlLk1PVVNFKmAgZXZlbnQgdHlwZXMgdGhhdCBpcyBvdmVycmlkZGVuIGJ5XG4gKiBjb3JyZXNwb25kaW5nIGBQT0lOVEVSKmAgZXZlbnQgdHlwZXMuXG4gKiBAY29uc3QgeyFnb29nLmV2ZW50cy5Nb3VzZUV2ZW50c31cbiAqL1xuZ29vZy5ldmVudHMuUG9pbnRlckFzTW91c2VFdmVudFR5cGUgPSB7XG4gIE1PVVNFRE9XTjogZ29vZy5ldmVudHMuUG9pbnRlckZhbGxiYWNrRXZlbnRUeXBlLlBPSU5URVJET1dOLFxuICBNT1VTRVVQOiBnb29nLmV2ZW50cy5Qb2ludGVyRmFsbGJhY2tFdmVudFR5cGUuUE9JTlRFUlVQLFxuICBNT1VTRUNBTkNFTDogZ29vZy5ldmVudHMuUG9pbnRlckZhbGxiYWNrRXZlbnRUeXBlLlBPSU5URVJDQU5DRUwsXG4gIE1PVVNFTU9WRTogZ29vZy5ldmVudHMuUG9pbnRlckZhbGxiYWNrRXZlbnRUeXBlLlBPSU5URVJNT1ZFLFxuICBNT1VTRU9WRVI6IGdvb2cuZXZlbnRzLlBvaW50ZXJGYWxsYmFja0V2ZW50VHlwZS5QT0lOVEVST1ZFUixcbiAgTU9VU0VPVVQ6IGdvb2cuZXZlbnRzLlBvaW50ZXJGYWxsYmFja0V2ZW50VHlwZS5QT0lOVEVST1VULFxuICBNT1VTRUVOVEVSOiBnb29nLmV2ZW50cy5Qb2ludGVyRmFsbGJhY2tFdmVudFR5cGUuUE9JTlRFUkVOVEVSLFxuICBNT1VTRUxFQVZFOiBnb29nLmV2ZW50cy5Qb2ludGVyRmFsbGJhY2tFdmVudFR5cGUuUE9JTlRFUkxFQVZFXG59O1xuXG5cbi8qKlxuICogQW4gYWxpYXMgZm9yIGBnb29nLmV2ZW50cy5FdmVudFR5cGUuTU9VU0UqYCBldmVudCB0eXBlcyB0aGF0IGNvbnRpbnVlIHRvIHVzZVxuICogbW91c2UgZXZlbnRzLlxuICogQGNvbnN0IHshZ29vZy5ldmVudHMuTW91c2VFdmVudHN9XG4gKi9cbmdvb2cuZXZlbnRzLk1vdXNlQXNNb3VzZUV2ZW50VHlwZSA9IHtcbiAgTU9VU0VET1dOOiBnb29nLmV2ZW50cy5FdmVudFR5cGUuTU9VU0VET1dOLFxuICBNT1VTRVVQOiBnb29nLmV2ZW50cy5FdmVudFR5cGUuTU9VU0VVUCxcbiAgTU9VU0VDQU5DRUw6IGdvb2cuZXZlbnRzLkV2ZW50VHlwZS5NT1VTRUNBTkNFTCxcbiAgTU9VU0VNT1ZFOiBnb29nLmV2ZW50cy5FdmVudFR5cGUuTU9VU0VNT1ZFLFxuICBNT1VTRU9WRVI6IGdvb2cuZXZlbnRzLkV2ZW50VHlwZS5NT1VTRU9WRVIsXG4gIE1PVVNFT1VUOiBnb29nLmV2ZW50cy5FdmVudFR5cGUuTU9VU0VPVVQsXG4gIE1PVVNFRU5URVI6IGdvb2cuZXZlbnRzLkV2ZW50VHlwZS5NT1VTRUVOVEVSLFxuICBNT1VTRUxFQVZFOiBnb29nLmV2ZW50cy5FdmVudFR5cGUuTU9VU0VMRUFWRVxufTtcblxuXG4vKipcbiAqIEFuIGFsaWFzIGZvciBgZ29vZy5ldmVudHMuRXZlbnRUeXBlLlRPVUNIKmAgZXZlbnQgdHlwZXMgdGhhdCBpcyBvdmVycmlkZGVuIGJ5XG4gKiBjb3JyZXNwb25kaW5nIGBQT0lOVEVSKmAgZXZlbnQgdHlwZXMuXG4gKiBAZW51bSB7c3RyaW5nfVxuICovXG5nb29nLmV2ZW50cy5Qb2ludGVyQXNUb3VjaEV2ZW50VHlwZSA9IHtcbiAgVE9VQ0hDQU5DRUw6IGdvb2cuZXZlbnRzLlBvaW50ZXJUb3VjaEZhbGxiYWNrRXZlbnRUeXBlLlBPSU5URVJDQU5DRUwsXG4gIFRPVUNIRU5EOiBnb29nLmV2ZW50cy5Qb2ludGVyVG91Y2hGYWxsYmFja0V2ZW50VHlwZS5QT0lOVEVSVVAsXG4gIFRPVUNITU9WRTogZ29vZy5ldmVudHMuUG9pbnRlclRvdWNoRmFsbGJhY2tFdmVudFR5cGUuUE9JTlRFUk1PVkUsXG4gIFRPVUNIU1RBUlQ6IGdvb2cuZXZlbnRzLlBvaW50ZXJUb3VjaEZhbGxiYWNrRXZlbnRUeXBlLlBPSU5URVJET1dOXG59O1xuIiwgIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCBUaGUgQ2xvc3VyZSBMaWJyYXJ5IEF1dGhvcnMuXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogQGZpbGVvdmVydmlldyBBbiBpbnRlcmZhY2UgZm9yIGEgbGlzdGVuYWJsZSBKYXZhU2NyaXB0IG9iamVjdC5cbiAqL1xuXG5nb29nLnByb3ZpZGUoJ2dvb2cuZXZlbnRzLkxpc3RlbmFibGUnKTtcblxuZ29vZy5yZXF1aXJlVHlwZSgnZ29vZy5ldmVudHMuRXZlbnRJZCcpO1xuZ29vZy5yZXF1aXJlVHlwZSgnZ29vZy5ldmVudHMuRXZlbnRMaWtlJyk7XG5nb29nLnJlcXVpcmVUeXBlKCdnb29nLmV2ZW50cy5MaXN0ZW5hYmxlS2V5Jyk7XG5cblxuLyoqXG4gKiBBIGxpc3RlbmFibGUgaW50ZXJmYWNlLiBBIGxpc3RlbmFibGUgaXMgYW4gb2JqZWN0IHdpdGggdGhlIGFiaWxpdHlcbiAqIHRvIGRpc3BhdGNoL2Jyb2FkY2FzdCBldmVudHMgdG8gXCJldmVudCBsaXN0ZW5lcnNcIiByZWdpc3RlcmVkIHZpYVxuICogbGlzdGVuL2xpc3Rlbk9uY2UuXG4gKlxuICogVGhlIGludGVyZmFjZSBhbGxvd3MgZm9yIGFuIGV2ZW50IHByb3BhZ2F0aW9uIG1lY2hhbmlzbSBzaW1pbGFyXG4gKiB0byBvbmUgb2ZmZXJlZCBieSBuYXRpdmUgYnJvd3NlciBldmVudCB0YXJnZXRzLCBzdWNoIGFzXG4gKiBjYXB0dXJlL2J1YmJsZSBtZWNoYW5pc20sIHN0b3BwaW5nIHByb3BhZ2F0aW9uLCBhbmQgcHJldmVudGluZ1xuICogZGVmYXVsdCBhY3Rpb25zLiBDYXB0dXJlL2J1YmJsZSBtZWNoYW5pc20gZGVwZW5kcyBvbiB0aGUgYW5jZXN0b3JcbiAqIHRyZWUgY29uc3RydWN0ZWQgdmlhIGAjZ2V0UGFyZW50RXZlbnRUYXJnZXRgOyB0aGlzIHRyZWVcbiAqIG11c3QgYmUgZGlyZWN0ZWQgYWN5Y2xpYyBncmFwaC4gVGhlIG1lYW5pbmcgb2YgZGVmYXVsdCBhY3Rpb24ocylcbiAqIGluIHByZXZlbnREZWZhdWx0IGlzIHNwZWNpZmljIHRvIGEgcGFydGljdWxhciB1c2UgY2FzZS5cbiAqXG4gKiBJbXBsZW1lbnRhdGlvbnMgdGhhdCBkbyBub3Qgc3VwcG9ydCBjYXB0dXJlL2J1YmJsZSBvciBjYW4gbm90IGhhdmVcbiAqIGEgcGFyZW50IGxpc3RlbmFibGUgY2FuIHNpbXBseSBub3QgaW1wbGVtZW50IGFueSBhYmlsaXR5IHRvIHNldCB0aGVcbiAqIHBhcmVudCBsaXN0ZW5hYmxlIChhbmQgaGF2ZSBgI2dldFBhcmVudEV2ZW50VGFyZ2V0YCByZXR1cm5cbiAqIG51bGwpLlxuICpcbiAqIEltcGxlbWVudGF0aW9uIG9mIHRoaXMgY2xhc3MgY2FuIGJlIHVzZWQgd2l0aCBvciBpbmRlcGVuZGVudGx5IGZyb21cbiAqIGdvb2cuZXZlbnRzLlxuICpcbiAqIEltcGxlbWVudGF0aW9uIG11c3QgY2FsbCBgI2FkZEltcGxlbWVudGF0aW9uKGltcGxDbGFzcylgLlxuICpcbiAqIEBpbnRlcmZhY2VcbiAqIEBzZWUgZ29vZy5ldmVudHNcbiAqIEBzZWUgaHR0cDovL3d3dy53My5vcmcvVFIvRE9NLUxldmVsLTItRXZlbnRzL2V2ZW50cy5odG1sXG4gKi9cbmdvb2cuZXZlbnRzLkxpc3RlbmFibGUgPSBmdW5jdGlvbigpIHt9O1xuXG5cbi8qKlxuICogQW4gZXhwYW5kbyBwcm9wZXJ0eSB0byBpbmRpY2F0ZSB0aGF0IGFuIG9iamVjdCBpbXBsZW1lbnRzXG4gKiBnb29nLmV2ZW50cy5MaXN0ZW5hYmxlLlxuICpcbiAqIFNlZSBhZGRJbXBsZW1lbnRhdGlvbi9pc0ltcGxlbWVudGVkQnkuXG4gKlxuICogQHR5cGUge3N0cmluZ31cbiAqIEBjb25zdFxuICovXG5nb29nLmV2ZW50cy5MaXN0ZW5hYmxlLklNUExFTUVOVEVEX0JZX1BST1AgPVxuICAgICdjbG9zdXJlX2xpc3RlbmFibGVfJyArICgoTWF0aC5yYW5kb20oKSAqIDFlNikgfCAwKTtcblxuXG4vKipcbiAqIE1hcmtzIGEgZ2l2ZW4gY2xhc3MgKGNvbnN0cnVjdG9yKSBhcyBhbiBpbXBsZW1lbnRhdGlvbiBvZlxuICogTGlzdGVuYWJsZSwgc28gdGhhdCB3ZSBjYW4gcXVlcnkgdGhhdCBmYWN0IGF0IHJ1bnRpbWUuIFRoZSBjbGFzc1xuICogbXVzdCBoYXZlIGFscmVhZHkgaW1wbGVtZW50ZWQgdGhlIGludGVyZmFjZS5cbiAqIEBwYXJhbSB7ZnVuY3Rpb24obmV3Omdvb2cuZXZlbnRzLkxpc3RlbmFibGUsLi4uKX0gY2xzIFRoZSBjbGFzcyBjb25zdHJ1Y3Rvci5cbiAqICAgICBUaGUgY29ycmVzcG9uZGluZyBjbGFzcyBtdXN0IGhhdmUgYWxyZWFkeSBpbXBsZW1lbnRlZCB0aGUgaW50ZXJmYWNlLlxuICovXG5nb29nLmV2ZW50cy5MaXN0ZW5hYmxlLmFkZEltcGxlbWVudGF0aW9uID0gZnVuY3Rpb24oY2xzKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgY2xzLnByb3RvdHlwZVtnb29nLmV2ZW50cy5MaXN0ZW5hYmxlLklNUExFTUVOVEVEX0JZX1BST1BdID0gdHJ1ZTtcbn07XG5cblxuLyoqXG4gKiBAcGFyYW0gez9PYmplY3R9IG9iaiBUaGUgb2JqZWN0IHRvIGNoZWNrLlxuICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciBhIGdpdmVuIGluc3RhbmNlIGltcGxlbWVudHMgTGlzdGVuYWJsZS4gVGhlXG4gKiAgICAgY2xhc3Mvc3VwZXJjbGFzcyBvZiB0aGUgaW5zdGFuY2UgbXVzdCBjYWxsIGFkZEltcGxlbWVudGF0aW9uLlxuICovXG5nb29nLmV2ZW50cy5MaXN0ZW5hYmxlLmlzSW1wbGVtZW50ZWRCeSA9IGZ1bmN0aW9uKG9iaikge1xuICAndXNlIHN0cmljdCc7XG4gIHJldHVybiAhIShvYmogJiYgb2JqW2dvb2cuZXZlbnRzLkxpc3RlbmFibGUuSU1QTEVNRU5URURfQllfUFJPUF0pO1xufTtcblxuXG4vKipcbiAqIEFkZHMgYW4gZXZlbnQgbGlzdGVuZXIuIEEgbGlzdGVuZXIgY2FuIG9ubHkgYmUgYWRkZWQgb25jZSB0byBhblxuICogb2JqZWN0IGFuZCBpZiBpdCBpcyBhZGRlZCBhZ2FpbiB0aGUga2V5IGZvciB0aGUgbGlzdGVuZXIgaXNcbiAqIHJldHVybmVkLiBOb3RlIHRoYXQgaWYgdGhlIGV4aXN0aW5nIGxpc3RlbmVyIGlzIGEgb25lLW9mZiBsaXN0ZW5lclxuICogKHJlZ2lzdGVyZWQgdmlhIGxpc3Rlbk9uY2UpLCBpdCB3aWxsIG5vIGxvbmdlciBiZSBhIG9uZS1vZmZcbiAqIGxpc3RlbmVyIGFmdGVyIGEgY2FsbCB0byBsaXN0ZW4oKS5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ3whZ29vZy5ldmVudHMuRXZlbnRJZDxFVkVOVE9CSj59IHR5cGUgVGhlIGV2ZW50IHR5cGUgaWQuXG4gKiBAcGFyYW0ge2Z1bmN0aW9uKHRoaXM6U0NPUEUsIEVWRU5UT0JKKTooYm9vbGVhbnx1bmRlZmluZWQpfSBsaXN0ZW5lciBDYWxsYmFja1xuICogICAgIG1ldGhvZC5cbiAqIEBwYXJhbSB7Ym9vbGVhbj19IG9wdF91c2VDYXB0dXJlIFdoZXRoZXIgdG8gZmlyZSBpbiBjYXB0dXJlIHBoYXNlXG4gKiAgICAgKGRlZmF1bHRzIHRvIGZhbHNlKS5cbiAqIEBwYXJhbSB7U0NPUEU9fSBvcHRfbGlzdGVuZXJTY29wZSBPYmplY3QgaW4gd2hvc2Ugc2NvcGUgdG8gY2FsbCB0aGVcbiAqICAgICBsaXN0ZW5lci5cbiAqIEByZXR1cm4geyFnb29nLmV2ZW50cy5MaXN0ZW5hYmxlS2V5fSBVbmlxdWUga2V5IGZvciB0aGUgbGlzdGVuZXIuXG4gKiBAdGVtcGxhdGUgU0NPUEUsRVZFTlRPQkpcbiAqL1xuZ29vZy5ldmVudHMuTGlzdGVuYWJsZS5wcm90b3R5cGUubGlzdGVuID0gZnVuY3Rpb24oXG4gICAgdHlwZSwgbGlzdGVuZXIsIG9wdF91c2VDYXB0dXJlLCBvcHRfbGlzdGVuZXJTY29wZSkge307XG5cblxuLyoqXG4gKiBBZGRzIGFuIGV2ZW50IGxpc3RlbmVyIHRoYXQgaXMgcmVtb3ZlZCBhdXRvbWF0aWNhbGx5IGFmdGVyIHRoZVxuICogbGlzdGVuZXIgZmlyZWQgb25jZS5cbiAqXG4gKiBJZiBhbiBleGlzdGluZyBsaXN0ZW5lciBhbHJlYWR5IGV4aXN0cywgbGlzdGVuT25jZSB3aWxsIGRvXG4gKiBub3RoaW5nLiBJbiBwYXJ0aWN1bGFyLCBpZiB0aGUgbGlzdGVuZXIgd2FzIHByZXZpb3VzbHkgcmVnaXN0ZXJlZFxuICogdmlhIGxpc3RlbigpLCBsaXN0ZW5PbmNlKCkgd2lsbCBub3QgdHVybiB0aGUgbGlzdGVuZXIgaW50byBhXG4gKiBvbmUtb2ZmIGxpc3RlbmVyLiBTaW1pbGFybHksIGlmIHRoZXJlIGlzIGFscmVhZHkgYW4gZXhpc3RpbmdcbiAqIG9uZS1vZmYgbGlzdGVuZXIsIGxpc3Rlbk9uY2UgZG9lcyBub3QgbW9kaWZ5IHRoZSBsaXN0ZW5lcnMgKGl0IGlzXG4gKiBzdGlsbCBhIG9uY2UgbGlzdGVuZXIpLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfCFnb29nLmV2ZW50cy5FdmVudElkPEVWRU5UT0JKPn0gdHlwZSBUaGUgZXZlbnQgdHlwZSBpZC5cbiAqIEBwYXJhbSB7ZnVuY3Rpb24odGhpczpTQ09QRSwgRVZFTlRPQkopOihib29sZWFufHVuZGVmaW5lZCl9IGxpc3RlbmVyIENhbGxiYWNrXG4gKiAgICAgbWV0aG9kLlxuICogQHBhcmFtIHtib29sZWFuPX0gb3B0X3VzZUNhcHR1cmUgV2hldGhlciB0byBmaXJlIGluIGNhcHR1cmUgcGhhc2VcbiAqICAgICAoZGVmYXVsdHMgdG8gZmFsc2UpLlxuICogQHBhcmFtIHtTQ09QRT19IG9wdF9saXN0ZW5lclNjb3BlIE9iamVjdCBpbiB3aG9zZSBzY29wZSB0byBjYWxsIHRoZVxuICogICAgIGxpc3RlbmVyLlxuICogQHJldHVybiB7IWdvb2cuZXZlbnRzLkxpc3RlbmFibGVLZXl9IFVuaXF1ZSBrZXkgZm9yIHRoZSBsaXN0ZW5lci5cbiAqIEB0ZW1wbGF0ZSBTQ09QRSxFVkVOVE9CSlxuICovXG5nb29nLmV2ZW50cy5MaXN0ZW5hYmxlLnByb3RvdHlwZS5saXN0ZW5PbmNlID0gZnVuY3Rpb24oXG4gICAgdHlwZSwgbGlzdGVuZXIsIG9wdF91c2VDYXB0dXJlLCBvcHRfbGlzdGVuZXJTY29wZSkge307XG5cblxuLyoqXG4gKiBSZW1vdmVzIGFuIGV2ZW50IGxpc3RlbmVyIHdoaWNoIHdhcyBhZGRlZCB3aXRoIGxpc3RlbigpIG9yIGxpc3Rlbk9uY2UoKS5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ3whZ29vZy5ldmVudHMuRXZlbnRJZDxFVkVOVE9CSj59IHR5cGUgVGhlIGV2ZW50IHR5cGUgaWQuXG4gKiBAcGFyYW0ge2Z1bmN0aW9uKHRoaXM6U0NPUEUsIEVWRU5UT0JKKTooYm9vbGVhbnx1bmRlZmluZWQpfSBsaXN0ZW5lciBDYWxsYmFja1xuICogICAgIG1ldGhvZC5cbiAqIEBwYXJhbSB7Ym9vbGVhbj19IG9wdF91c2VDYXB0dXJlIFdoZXRoZXIgdG8gZmlyZSBpbiBjYXB0dXJlIHBoYXNlXG4gKiAgICAgKGRlZmF1bHRzIHRvIGZhbHNlKS5cbiAqIEBwYXJhbSB7U0NPUEU9fSBvcHRfbGlzdGVuZXJTY29wZSBPYmplY3QgaW4gd2hvc2Ugc2NvcGUgdG8gY2FsbFxuICogICAgIHRoZSBsaXN0ZW5lci5cbiAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgYW55IGxpc3RlbmVyIHdhcyByZW1vdmVkLlxuICogQHRlbXBsYXRlIFNDT1BFLEVWRU5UT0JKXG4gKi9cbmdvb2cuZXZlbnRzLkxpc3RlbmFibGUucHJvdG90eXBlLnVubGlzdGVuID0gZnVuY3Rpb24oXG4gICAgdHlwZSwgbGlzdGVuZXIsIG9wdF91c2VDYXB0dXJlLCBvcHRfbGlzdGVuZXJTY29wZSkge307XG5cblxuLyoqXG4gKiBSZW1vdmVzIGFuIGV2ZW50IGxpc3RlbmVyIHdoaWNoIHdhcyBhZGRlZCB3aXRoIGxpc3RlbigpIGJ5IHRoZSBrZXlcbiAqIHJldHVybmVkIGJ5IGxpc3RlbigpLlxuICpcbiAqIEBwYXJhbSB7IWdvb2cuZXZlbnRzLkxpc3RlbmFibGVLZXl9IGtleSBUaGUga2V5IHJldHVybmVkIGJ5XG4gKiAgICAgbGlzdGVuKCkgb3IgbGlzdGVuT25jZSgpLlxuICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciBhbnkgbGlzdGVuZXIgd2FzIHJlbW92ZWQuXG4gKi9cbmdvb2cuZXZlbnRzLkxpc3RlbmFibGUucHJvdG90eXBlLnVubGlzdGVuQnlLZXkgPSBmdW5jdGlvbihrZXkpIHt9O1xuXG5cbi8qKlxuICogRGlzcGF0Y2hlcyBhbiBldmVudCAob3IgZXZlbnQgbGlrZSBvYmplY3QpIGFuZCBjYWxscyBhbGwgbGlzdGVuZXJzXG4gKiBsaXN0ZW5pbmcgZm9yIGV2ZW50cyBvZiB0aGlzIHR5cGUuIFRoZSB0eXBlIG9mIHRoZSBldmVudCBpcyBkZWNpZGVkIGJ5IHRoZVxuICogdHlwZSBwcm9wZXJ0eSBvbiB0aGUgZXZlbnQgb2JqZWN0LlxuICpcbiAqIElmIGFueSBvZiB0aGUgbGlzdGVuZXJzIHJldHVybnMgZmFsc2UgT1IgY2FsbHMgcHJldmVudERlZmF1bHQgdGhlbiB0aGlzXG4gKiBmdW5jdGlvbiB3aWxsIHJldHVybiBmYWxzZS4gIElmIG9uZSBvZiB0aGUgY2FwdHVyZSBsaXN0ZW5lcnMgY2FsbHNcbiAqIHN0b3BQcm9wYWdhdGlvbiwgdGhlbiB0aGUgYnViYmxlIGxpc3RlbmVycyB3b24ndCBmaXJlLlxuICpcbiAqIEBwYXJhbSB7P2dvb2cuZXZlbnRzLkV2ZW50TGlrZX0gZSBFdmVudCBvYmplY3QuXG4gKiBAcmV0dXJuIHtib29sZWFufSBJZiBhbnlvbmUgY2FsbGVkIHByZXZlbnREZWZhdWx0IG9uIHRoZSBldmVudCBvYmplY3QgKG9yXG4gKiAgICAgaWYgYW55IG9mIHRoZSBsaXN0ZW5lcnMgcmV0dXJucyBmYWxzZSkgdGhpcyB3aWxsIGFsc28gcmV0dXJuIGZhbHNlLlxuICovXG5nb29nLmV2ZW50cy5MaXN0ZW5hYmxlLnByb3RvdHlwZS5kaXNwYXRjaEV2ZW50ID0gZnVuY3Rpb24oZSkge307XG5cblxuLyoqXG4gKiBSZW1vdmVzIGFsbCBsaXN0ZW5lcnMgZnJvbSB0aGlzIGxpc3RlbmFibGUuIElmIHR5cGUgaXMgc3BlY2lmaWVkLFxuICogaXQgd2lsbCBvbmx5IHJlbW92ZSBsaXN0ZW5lcnMgb2YgdGhlIHBhcnRpY3VsYXIgdHlwZS4gb3RoZXJ3aXNlIGFsbFxuICogcmVnaXN0ZXJlZCBsaXN0ZW5lcnMgd2lsbCBiZSByZW1vdmVkLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfCFnb29nLmV2ZW50cy5FdmVudElkPX0gb3B0X3R5cGUgVHlwZSBvZiBldmVudCB0byByZW1vdmUsXG4gKiAgICAgZGVmYXVsdCBpcyB0byByZW1vdmUgYWxsIHR5cGVzLlxuICogQHJldHVybiB7bnVtYmVyfSBOdW1iZXIgb2YgbGlzdGVuZXJzIHJlbW92ZWQuXG4gKi9cbmdvb2cuZXZlbnRzLkxpc3RlbmFibGUucHJvdG90eXBlLnJlbW92ZUFsbExpc3RlbmVycyA9IGZ1bmN0aW9uKG9wdF90eXBlKSB7fTtcblxuXG4vKipcbiAqIFJldHVybnMgdGhlIHBhcmVudCBvZiB0aGlzIGV2ZW50IHRhcmdldCB0byB1c2UgZm9yIGNhcHR1cmUvYnViYmxlXG4gKiBtZWNoYW5pc20uXG4gKlxuICogTk9URShjaHJpc2hlbnJ5KTogVGhlIG5hbWUgcmVmbGVjdHMgdGhlIG9yaWdpbmFsIGltcGxlbWVudGF0aW9uIG9mXG4gKiBjdXN0b20gZXZlbnQgdGFyZ2V0IChgZ29vZy5ldmVudHMuRXZlbnRUYXJnZXRgKS4gV2UgZGVjaWRlZFxuICogdGhhdCBjaGFuZ2luZyB0aGUgbmFtZSBpcyBub3Qgd29ydGggaXQuXG4gKlxuICogQHJldHVybiB7P2dvb2cuZXZlbnRzLkxpc3RlbmFibGV9IFRoZSBwYXJlbnQgRXZlbnRUYXJnZXQgb3IgbnVsbCBpZlxuICogICAgIHRoZXJlIGlzIG5vIHBhcmVudC5cbiAqL1xuZ29vZy5ldmVudHMuTGlzdGVuYWJsZS5wcm90b3R5cGUuZ2V0UGFyZW50RXZlbnRUYXJnZXQgPSBmdW5jdGlvbigpIHt9O1xuXG5cbi8qKlxuICogRmlyZXMgYWxsIHJlZ2lzdGVyZWQgbGlzdGVuZXJzIGluIHRoaXMgbGlzdGVuYWJsZSBmb3IgdGhlIGdpdmVuXG4gKiB0eXBlIGFuZCBjYXB0dXJlIG1vZGUsIHBhc3NpbmcgdGhlbSB0aGUgZ2l2ZW4gZXZlbnRPYmplY3QuIFRoaXNcbiAqIGRvZXMgbm90IHBlcmZvcm0gYWN0dWFsIGNhcHR1cmUvYnViYmxlLiBPbmx5IGltcGxlbWVudG9ycyBvZiB0aGVcbiAqIGludGVyZmFjZSBzaG91bGQgYmUgdXNpbmcgdGhpcy5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ3whZ29vZy5ldmVudHMuRXZlbnRJZDxFVkVOVE9CSj59IHR5cGUgVGhlIHR5cGUgb2YgdGhlXG4gKiAgICAgbGlzdGVuZXJzIHRvIGZpcmUuXG4gKiBAcGFyYW0ge2Jvb2xlYW59IGNhcHR1cmUgVGhlIGNhcHR1cmUgbW9kZSBvZiB0aGUgbGlzdGVuZXJzIHRvIGZpcmUuXG4gKiBAcGFyYW0ge0VWRU5UT0JKfSBldmVudE9iamVjdCBUaGUgZXZlbnQgb2JqZWN0IHRvIGZpcmUuXG4gKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIGFsbCBsaXN0ZW5lcnMgc3VjY2VlZGVkIHdpdGhvdXRcbiAqICAgICBhdHRlbXB0aW5nIHRvIHByZXZlbnQgZGVmYXVsdCBiZWhhdmlvci4gSWYgYW55IGxpc3RlbmVyIHJldHVybnNcbiAqICAgICBmYWxzZSBvciBjYWxsZWQgZ29vZy5ldmVudHMuRXZlbnQjcHJldmVudERlZmF1bHQsIHRoaXMgcmV0dXJuc1xuICogICAgIGZhbHNlLlxuICogQHRlbXBsYXRlIEVWRU5UT0JKXG4gKi9cbmdvb2cuZXZlbnRzLkxpc3RlbmFibGUucHJvdG90eXBlLmZpcmVMaXN0ZW5lcnMgPSBmdW5jdGlvbihcbiAgICB0eXBlLCBjYXB0dXJlLCBldmVudE9iamVjdCkge307XG5cblxuLyoqXG4gKiBHZXRzIGFsbCBsaXN0ZW5lcnMgaW4gdGhpcyBsaXN0ZW5hYmxlIGZvciB0aGUgZ2l2ZW4gdHlwZSBhbmRcbiAqIGNhcHR1cmUgbW9kZS5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ3whZ29vZy5ldmVudHMuRXZlbnRJZH0gdHlwZSBUaGUgdHlwZSBvZiB0aGUgbGlzdGVuZXJzIHRvIGZpcmUuXG4gKiBAcGFyYW0ge2Jvb2xlYW59IGNhcHR1cmUgVGhlIGNhcHR1cmUgbW9kZSBvZiB0aGUgbGlzdGVuZXJzIHRvIGZpcmUuXG4gKiBAcmV0dXJuIHshQXJyYXk8IWdvb2cuZXZlbnRzLkxpc3RlbmFibGVLZXk+fSBBbiBhcnJheSBvZiByZWdpc3RlcmVkXG4gKiAgICAgbGlzdGVuZXJzLlxuICogQHRlbXBsYXRlIEVWRU5UT0JKXG4gKi9cbmdvb2cuZXZlbnRzLkxpc3RlbmFibGUucHJvdG90eXBlLmdldExpc3RlbmVycyA9IGZ1bmN0aW9uKHR5cGUsIGNhcHR1cmUpIHt9O1xuXG5cbi8qKlxuICogR2V0cyB0aGUgZ29vZy5ldmVudHMuTGlzdGVuYWJsZUtleSBmb3IgdGhlIGV2ZW50IG9yIG51bGwgaWYgbm8gc3VjaFxuICogbGlzdGVuZXIgaXMgaW4gdXNlLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfCFnb29nLmV2ZW50cy5FdmVudElkPEVWRU5UT0JKPn0gdHlwZSBUaGUgbmFtZSBvZiB0aGUgZXZlbnRcbiAqICAgICB3aXRob3V0IHRoZSAnb24nIHByZWZpeC5cbiAqIEBwYXJhbSB7ZnVuY3Rpb24odGhpczpTQ09QRSwgRVZFTlRPQkopOihib29sZWFufHVuZGVmaW5lZCl9IGxpc3RlbmVyIFRoZVxuICogICAgIGxpc3RlbmVyIGZ1bmN0aW9uIHRvIGdldC5cbiAqIEBwYXJhbSB7Ym9vbGVhbn0gY2FwdHVyZSBXaGV0aGVyIHRoZSBsaXN0ZW5lciBpcyBhIGNhcHR1cmluZyBsaXN0ZW5lci5cbiAqIEBwYXJhbSB7U0NPUEU9fSBvcHRfbGlzdGVuZXJTY29wZSBPYmplY3QgaW4gd2hvc2Ugc2NvcGUgdG8gY2FsbCB0aGVcbiAqICAgICBsaXN0ZW5lci5cbiAqIEByZXR1cm4gez9nb29nLmV2ZW50cy5MaXN0ZW5hYmxlS2V5fSB0aGUgZm91bmQgbGlzdGVuZXIgb3IgbnVsbCBpZiBub3QgZm91bmQuXG4gKiBAdGVtcGxhdGUgU0NPUEUsRVZFTlRPQkpcbiAqL1xuZ29vZy5ldmVudHMuTGlzdGVuYWJsZS5wcm90b3R5cGUuZ2V0TGlzdGVuZXIgPSBmdW5jdGlvbihcbiAgICB0eXBlLCBsaXN0ZW5lciwgY2FwdHVyZSwgb3B0X2xpc3RlbmVyU2NvcGUpIHt9O1xuXG5cbi8qKlxuICogV2hldGhlciB0aGVyZSBpcyBhbnkgYWN0aXZlIGxpc3RlbmVycyBtYXRjaGluZyB0aGUgc3BlY2lmaWVkXG4gKiBzaWduYXR1cmUuIElmIGVpdGhlciB0aGUgdHlwZSBvciBjYXB0dXJlIHBhcmFtZXRlcnMgYXJlXG4gKiB1bnNwZWNpZmllZCwgdGhlIGZ1bmN0aW9uIHdpbGwgbWF0Y2ggb24gdGhlIHJlbWFpbmluZyBjcml0ZXJpYS5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ3whZ29vZy5ldmVudHMuRXZlbnRJZDxFVkVOVE9CSj49fSBvcHRfdHlwZSBFdmVudCB0eXBlLlxuICogQHBhcmFtIHtib29sZWFuPX0gb3B0X2NhcHR1cmUgV2hldGhlciB0byBjaGVjayBmb3IgY2FwdHVyZSBvciBidWJibGVcbiAqICAgICBsaXN0ZW5lcnMuXG4gKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoZXJlIGlzIGFueSBhY3RpdmUgbGlzdGVuZXJzIG1hdGNoaW5nXG4gKiAgICAgdGhlIHJlcXVlc3RlZCB0eXBlIGFuZC9vciBjYXB0dXJlIHBoYXNlLlxuICogQHRlbXBsYXRlIEVWRU5UT0JKXG4gKi9cbmdvb2cuZXZlbnRzLkxpc3RlbmFibGUucHJvdG90eXBlLmhhc0xpc3RlbmVyID0gZnVuY3Rpb24oXG4gICAgb3B0X3R5cGUsIG9wdF9jYXB0dXJlKSB7fTtcbiIsICIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgVGhlIENsb3N1cmUgTGlicmFyeSBBdXRob3JzLlxuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIEBmaWxlb3ZlcnZpZXcgQW4gaW50ZXJmYWNlIHRoYXQgZGVzY3JpYmVzIGEgc2luZ2xlIHJlZ2lzdGVyZWQgbGlzdGVuZXIuXG4gKi9cbmdvb2cucHJvdmlkZSgnZ29vZy5ldmVudHMuTGlzdGVuYWJsZUtleScpO1xuXG5nb29nLnJlcXVpcmVUeXBlKCdnb29nLmV2ZW50cy5MaXN0ZW5hYmxlJyk7XG5cblxuLyoqXG4gKiBBbiBpbnRlcmZhY2UgdGhhdCBkZXNjcmliZXMgYSBzaW5nbGUgcmVnaXN0ZXJlZCBsaXN0ZW5lci5cbiAqIEBpbnRlcmZhY2VcbiAqL1xuZ29vZy5ldmVudHMuTGlzdGVuYWJsZUtleSA9IGZ1bmN0aW9uKCkge307XG5cblxuLyoqXG4gKiBDb3VudGVyIHVzZWQgdG8gY3JlYXRlIGEgdW5pcXVlIGtleVxuICogQHR5cGUge251bWJlcn1cbiAqIEBwcml2YXRlXG4gKi9cbmdvb2cuZXZlbnRzLkxpc3RlbmFibGVLZXkuY291bnRlcl8gPSAwO1xuXG5cbi8qKlxuICogUmVzZXJ2ZXMgYSBrZXkgdG8gYmUgdXNlZCBmb3IgTGlzdGVuYWJsZUtleSNrZXkgZmllbGQuXG4gKiBAcmV0dXJuIHtudW1iZXJ9IEEgbnVtYmVyIHRvIGJlIHVzZWQgdG8gZmlsbCBMaXN0ZW5hYmxlS2V5I2tleVxuICogICAgIGZpZWxkLlxuICovXG5nb29nLmV2ZW50cy5MaXN0ZW5hYmxlS2V5LnJlc2VydmVLZXkgPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gKytnb29nLmV2ZW50cy5MaXN0ZW5hYmxlS2V5LmNvdW50ZXJfO1xufTtcblxuXG4vKipcbiAqIFRoZSBzb3VyY2UgZXZlbnQgdGFyZ2V0LlxuICogQHR5cGUgez9PYmplY3R8P2dvb2cuZXZlbnRzLkxpc3RlbmFibGV9XG4gKi9cbmdvb2cuZXZlbnRzLkxpc3RlbmFibGVLZXkucHJvdG90eXBlLnNyYztcblxuXG4vKipcbiAqIFRoZSBldmVudCB0eXBlIHRoZSBsaXN0ZW5lciBpcyBsaXN0ZW5pbmcgdG8uXG4gKiBAdHlwZSB7c3RyaW5nfVxuICovXG5nb29nLmV2ZW50cy5MaXN0ZW5hYmxlS2V5LnByb3RvdHlwZS50eXBlO1xuXG5cbi8qKlxuICogVGhlIGxpc3RlbmVyIGZ1bmN0aW9uLlxuICogQHR5cGUge2Z1bmN0aW9uKD8pOj98e2hhbmRsZUV2ZW50OmZ1bmN0aW9uKD8pOj99fG51bGx9XG4gKi9cbmdvb2cuZXZlbnRzLkxpc3RlbmFibGVLZXkucHJvdG90eXBlLmxpc3RlbmVyO1xuXG5cbi8qKlxuICogV2hldGhlciB0aGUgbGlzdGVuZXIgd29ya3Mgb24gY2FwdHVyZSBwaGFzZS5cbiAqIEB0eXBlIHtib29sZWFufVxuICovXG5nb29nLmV2ZW50cy5MaXN0ZW5hYmxlS2V5LnByb3RvdHlwZS5jYXB0dXJlO1xuXG5cbi8qKlxuICogVGhlICd0aGlzJyBvYmplY3QgZm9yIHRoZSBsaXN0ZW5lciBmdW5jdGlvbidzIHNjb3BlLlxuICogQHR5cGUgez9PYmplY3R8dW5kZWZpbmVkfVxuICovXG5nb29nLmV2ZW50cy5MaXN0ZW5hYmxlS2V5LnByb3RvdHlwZS5oYW5kbGVyO1xuXG5cbi8qKlxuICogQSBnbG9iYWxseSB1bmlxdWUgbnVtYmVyIHRvIGlkZW50aWZ5IHRoZSBrZXkuXG4gKiBAdHlwZSB7bnVtYmVyfVxuICovXG5nb29nLmV2ZW50cy5MaXN0ZW5hYmxlS2V5LnByb3RvdHlwZS5rZXk7XG4iLCAiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IFRoZSBDbG9zdXJlIExpYnJhcnkgQXV0aG9ycy5cbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBAZmlsZW92ZXJ2aWV3IExpc3RlbmVyIG9iamVjdC5cbiAqIEBzZWUgLi4vZGVtb3MvZXZlbnRzLmh0bWxcbiAqL1xuXG5nb29nLnByb3ZpZGUoJ2dvb2cuZXZlbnRzLkxpc3RlbmVyJyk7XG5cbmdvb2cucmVxdWlyZSgnZ29vZy5ldmVudHMuTGlzdGVuYWJsZUtleScpO1xuZ29vZy5yZXF1aXJlVHlwZSgnZ29vZy5ldmVudHMuTGlzdGVuYWJsZScpO1xuXG5cblxuLyoqXG4gKiBTaW1wbGUgY2xhc3MgdGhhdCBzdG9yZXMgaW5mb3JtYXRpb24gYWJvdXQgYSBsaXN0ZW5lclxuICogQHBhcmFtIHtmdW5jdGlvbig/KTo/fSBsaXN0ZW5lciBDYWxsYmFjayBmdW5jdGlvbi5cbiAqIEBwYXJhbSB7RnVuY3Rpb259IHByb3h5IFdyYXBwZXIgZm9yIHRoZSBsaXN0ZW5lciB0aGF0IHBhdGNoZXMgdGhlIGV2ZW50LlxuICogQHBhcmFtIHtFdmVudFRhcmdldHxnb29nLmV2ZW50cy5MaXN0ZW5hYmxlfSBzcmMgU291cmNlIG9iamVjdCBmb3JcbiAqICAgICB0aGUgZXZlbnQuXG4gKiBAcGFyYW0ge3N0cmluZ30gdHlwZSBFdmVudCB0eXBlLlxuICogQHBhcmFtIHtib29sZWFufSBjYXB0dXJlIFdoZXRoZXIgaW4gY2FwdHVyZSBvciBidWJibGUgcGhhc2UuXG4gKiBAcGFyYW0ge09iamVjdD19IG9wdF9oYW5kbGVyIE9iamVjdCBpbiB3aG9zZSBjb250ZXh0IHRvIGV4ZWN1dGUgdGhlIGNhbGxiYWNrLlxuICogQGltcGxlbWVudHMge2dvb2cuZXZlbnRzLkxpc3RlbmFibGVLZXl9XG4gKiBAY29uc3RydWN0b3JcbiAqL1xuZ29vZy5ldmVudHMuTGlzdGVuZXIgPSBmdW5jdGlvbihcbiAgICBsaXN0ZW5lciwgcHJveHksIHNyYywgdHlwZSwgY2FwdHVyZSwgb3B0X2hhbmRsZXIpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBpZiAoZ29vZy5ldmVudHMuTGlzdGVuZXIuRU5BQkxFX01PTklUT1JJTkcpIHtcbiAgICB0aGlzLmNyZWF0aW9uU3RhY2sgPSBuZXcgRXJyb3IoKS5zdGFjaztcbiAgfVxuXG4gIC8qKiBAb3ZlcnJpZGUgKi9cbiAgdGhpcy5saXN0ZW5lciA9IGxpc3RlbmVyO1xuXG4gIC8qKlxuICAgKiBBIHdyYXBwZXIgb3ZlciB0aGUgb3JpZ2luYWwgbGlzdGVuZXIuIFRoaXMgaXMgdXNlZCBzb2xlbHkgdG9cbiAgICogaGFuZGxlIG5hdGl2ZSBicm93c2VyIGV2ZW50cyAoaXQgaXMgdXNlZCB0byBzaW11bGF0ZSB0aGUgY2FwdHVyZVxuICAgKiBwaGFzZSBhbmQgdG8gcGF0Y2ggdGhlIGV2ZW50IG9iamVjdCkuXG4gICAqIEB0eXBlIHtGdW5jdGlvbn1cbiAgICovXG4gIHRoaXMucHJveHkgPSBwcm94eTtcblxuICAvKipcbiAgICogT2JqZWN0IG9yIG5vZGUgdGhhdCBjYWxsYmFjayBpcyBsaXN0ZW5pbmcgdG9cbiAgICogQHR5cGUge0V2ZW50VGFyZ2V0fGdvb2cuZXZlbnRzLkxpc3RlbmFibGV9XG4gICAqL1xuICB0aGlzLnNyYyA9IHNyYztcblxuICAvKipcbiAgICogVGhlIGV2ZW50IHR5cGUuXG4gICAqIEBjb25zdCB7c3RyaW5nfVxuICAgKi9cbiAgdGhpcy50eXBlID0gdHlwZTtcblxuICAvKipcbiAgICogV2hldGhlciB0aGUgbGlzdGVuZXIgaXMgYmVpbmcgY2FsbGVkIGluIHRoZSBjYXB0dXJlIG9yIGJ1YmJsZSBwaGFzZVxuICAgKiBAY29uc3Qge2Jvb2xlYW59XG4gICAqL1xuICB0aGlzLmNhcHR1cmUgPSAhIWNhcHR1cmU7XG5cbiAgLyoqXG4gICAqIE9wdGlvbmFsIG9iamVjdCB3aG9zZSBjb250ZXh0IHRvIGV4ZWN1dGUgdGhlIGxpc3RlbmVyIGluXG4gICAqIEB0eXBlIHtPYmplY3R8dW5kZWZpbmVkfVxuICAgKi9cbiAgdGhpcy5oYW5kbGVyID0gb3B0X2hhbmRsZXI7XG5cbiAgLyoqXG4gICAqIFRoZSBrZXkgb2YgdGhlIGxpc3RlbmVyLlxuICAgKiBAY29uc3Qge251bWJlcn1cbiAgICogQG92ZXJyaWRlXG4gICAqL1xuICB0aGlzLmtleSA9IGdvb2cuZXZlbnRzLkxpc3RlbmFibGVLZXkucmVzZXJ2ZUtleSgpO1xuXG4gIC8qKlxuICAgKiBXaGV0aGVyIHRvIHJlbW92ZSB0aGUgbGlzdGVuZXIgYWZ0ZXIgaXQgaGFzIGJlZW4gY2FsbGVkLlxuICAgKiBAdHlwZSB7Ym9vbGVhbn1cbiAgICovXG4gIHRoaXMuY2FsbE9uY2UgPSBmYWxzZTtcblxuICAvKipcbiAgICogV2hldGhlciB0aGUgbGlzdGVuZXIgaGFzIGJlZW4gcmVtb3ZlZC5cbiAgICogQHR5cGUge2Jvb2xlYW59XG4gICAqL1xuICB0aGlzLnJlbW92ZWQgPSBmYWxzZTtcbn07XG5cblxuLyoqXG4gKiBAZGVmaW5lIHtib29sZWFufSBXaGV0aGVyIHRvIGVuYWJsZSB0aGUgbW9uaXRvcmluZyBvZiB0aGVcbiAqICAgICBnb29nLmV2ZW50cy5MaXN0ZW5lciBpbnN0YW5jZXMuIFN3aXRjaGluZyBvbiB0aGUgbW9uaXRvcmluZyBpcyBvbmx5XG4gKiAgICAgcmVjb21tZW5kZWQgZm9yIGRlYnVnZ2luZyBiZWNhdXNlIGl0IGhhcyBhIHNpZ25pZmljYW50IGltcGFjdCBvblxuICogICAgIHBlcmZvcm1hbmNlIGFuZCBtZW1vcnkgdXNhZ2UuIElmIHN3aXRjaGVkIG9mZiwgdGhlIG1vbml0b3JpbmcgY29kZVxuICogICAgIGNvbXBpbGVzIGRvd24gdG8gMCBieXRlcy5cbiAqL1xuZ29vZy5ldmVudHMuTGlzdGVuZXIuRU5BQkxFX01PTklUT1JJTkcgPVxuICAgIGdvb2cuZGVmaW5lKCdnb29nLmV2ZW50cy5MaXN0ZW5lci5FTkFCTEVfTU9OSVRPUklORycsIGZhbHNlKTtcblxuXG4vKipcbiAqIElmIG1vbml0b3JpbmcgdGhlIGdvb2cuZXZlbnRzLkxpc3RlbmVyIGluc3RhbmNlcyBpcyBlbmFibGVkLCBzdG9yZXMgdGhlXG4gKiBjcmVhdGlvbiBzdGFjayB0cmFjZSBvZiB0aGUgRGlzcG9zYWJsZSBpbnN0YW5jZS5cbiAqIEB0eXBlIHtzdHJpbmd9XG4gKi9cbmdvb2cuZXZlbnRzLkxpc3RlbmVyLnByb3RvdHlwZS5jcmVhdGlvblN0YWNrO1xuXG5cbi8qKlxuICogTWFya3MgdGhpcyBsaXN0ZW5lciBhcyByZW1vdmVkLiBUaGlzIGFsc28gcmVtb3ZlIHJlZmVyZW5jZXMgaGVsZCBieVxuICogdGhpcyBsaXN0ZW5lciBvYmplY3QgKHN1Y2ggYXMgbGlzdGVuZXIgYW5kIGV2ZW50IHNvdXJjZSkuXG4gKi9cbmdvb2cuZXZlbnRzLkxpc3RlbmVyLnByb3RvdHlwZS5tYXJrQXNSZW1vdmVkID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgdGhpcy5yZW1vdmVkID0gdHJ1ZTtcbiAgdGhpcy5saXN0ZW5lciA9IG51bGw7XG4gIHRoaXMucHJveHkgPSBudWxsO1xuICB0aGlzLnNyYyA9IG51bGw7XG4gIHRoaXMuaGFuZGxlciA9IG51bGw7XG59O1xuIiwgIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCBUaGUgQ2xvc3VyZSBMaWJyYXJ5IEF1dGhvcnMuXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogQGZpbGVvdmVydmlldyBBIG1hcCBvZiBsaXN0ZW5lcnMgdGhhdCBwcm92aWRlcyB1dGlsaXR5IGZ1bmN0aW9ucyB0b1xuICogZGVhbCB3aXRoIGxpc3RlbmVycyBvbiBhbiBldmVudCB0YXJnZXQuIFVzZWQgYnlcbiAqIGBnb29nLmV2ZW50cy5FdmVudFRhcmdldGAuXG4gKlxuICogV0FSTklORzogRG8gbm90IHVzZSB0aGlzIGNsYXNzIGZyb20gb3V0c2lkZSBnb29nLmV2ZW50cyBwYWNrYWdlLlxuICpcbiAqL1xuXG5nb29nLnByb3ZpZGUoJ2dvb2cuZXZlbnRzLkxpc3RlbmVyTWFwJyk7XG5cbmdvb2cucmVxdWlyZSgnZ29vZy5hcnJheScpO1xuZ29vZy5yZXF1aXJlKCdnb29nLmV2ZW50cy5MaXN0ZW5lcicpO1xuZ29vZy5yZXF1aXJlKCdnb29nLm9iamVjdCcpO1xuZ29vZy5yZXF1aXJlVHlwZSgnZ29vZy5ldmVudHMuRXZlbnRJZCcpO1xuZ29vZy5yZXF1aXJlVHlwZSgnZ29vZy5ldmVudHMuTGlzdGVuYWJsZScpO1xuZ29vZy5yZXF1aXJlVHlwZSgnZ29vZy5ldmVudHMuTGlzdGVuYWJsZUtleScpO1xuXG5cblxuLyoqXG4gKiBDcmVhdGVzIGEgbmV3IGxpc3RlbmVyIG1hcC5cbiAqIEBwYXJhbSB7RXZlbnRUYXJnZXR8Z29vZy5ldmVudHMuTGlzdGVuYWJsZX0gc3JjIFRoZSBzcmMgb2JqZWN0LlxuICogQGNvbnN0cnVjdG9yXG4gKiBAZmluYWxcbiAqL1xuZ29vZy5ldmVudHMuTGlzdGVuZXJNYXAgPSBmdW5jdGlvbihzcmMpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICAvKiogQHR5cGUge0V2ZW50VGFyZ2V0fGdvb2cuZXZlbnRzLkxpc3RlbmFibGV9ICovXG4gIHRoaXMuc3JjID0gc3JjO1xuXG4gIC8qKlxuICAgKiBNYXBzIG9mIGV2ZW50IHR5cGUgdG8gYW4gYXJyYXkgb2YgbGlzdGVuZXJzLlxuICAgKiBAdHlwZSB7IU9iamVjdDxzdHJpbmcsICFBcnJheTwhZ29vZy5ldmVudHMuTGlzdGVuZXI+Pn1cbiAgICovXG4gIHRoaXMubGlzdGVuZXJzID0ge307XG5cbiAgLyoqXG4gICAqIFRoZSBjb3VudCBvZiB0eXBlcyBpbiB0aGlzIG1hcCB0aGF0IGhhdmUgcmVnaXN0ZXJlZCBsaXN0ZW5lcnMuXG4gICAqIEBwcml2YXRlIHtudW1iZXJ9XG4gICAqL1xuICB0aGlzLnR5cGVDb3VudF8gPSAwO1xufTtcblxuXG4vKipcbiAqIEByZXR1cm4ge251bWJlcn0gVGhlIGNvdW50IG9mIGV2ZW50IHR5cGVzIGluIHRoaXMgbWFwIHRoYXQgYWN0dWFsbHlcbiAqICAgICBoYXZlIHJlZ2lzdGVyZWQgbGlzdGVuZXJzLlxuICovXG5nb29nLmV2ZW50cy5MaXN0ZW5lck1hcC5wcm90b3R5cGUuZ2V0VHlwZUNvdW50ID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmV0dXJuIHRoaXMudHlwZUNvdW50Xztcbn07XG5cblxuLyoqXG4gKiBAcmV0dXJuIHtudW1iZXJ9IFRvdGFsIG51bWJlciBvZiByZWdpc3RlcmVkIGxpc3RlbmVycy5cbiAqL1xuZ29vZy5ldmVudHMuTGlzdGVuZXJNYXAucHJvdG90eXBlLmdldExpc3RlbmVyQ291bnQgPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICB2YXIgY291bnQgPSAwO1xuICBmb3IgKHZhciB0eXBlIGluIHRoaXMubGlzdGVuZXJzKSB7XG4gICAgY291bnQgKz0gdGhpcy5saXN0ZW5lcnNbdHlwZV0ubGVuZ3RoO1xuICB9XG4gIHJldHVybiBjb3VudDtcbn07XG5cblxuLyoqXG4gKiBBZGRzIGFuIGV2ZW50IGxpc3RlbmVyLiBBIGxpc3RlbmVyIGNhbiBvbmx5IGJlIGFkZGVkIG9uY2UgdG8gYW5cbiAqIG9iamVjdCBhbmQgaWYgaXQgaXMgYWRkZWQgYWdhaW4gdGhlIGtleSBmb3IgdGhlIGxpc3RlbmVyIGlzXG4gKiByZXR1cm5lZC5cbiAqXG4gKiBOb3RlIHRoYXQgYSBvbmUtb2ZmIGxpc3RlbmVyIHdpbGwgbm90IGNoYW5nZSBhbiBleGlzdGluZyBsaXN0ZW5lcixcbiAqIGlmIGFueS4gT24gdGhlIG90aGVyIGhhbmQgYSBub3JtYWwgbGlzdGVuZXIgd2lsbCBjaGFuZ2UgZXhpc3RpbmdcbiAqIG9uZS1vZmYgbGlzdGVuZXIgdG8gYmVjb21lIGEgbm9ybWFsIGxpc3RlbmVyLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfCFnb29nLmV2ZW50cy5FdmVudElkfSB0eXBlIFRoZSBsaXN0ZW5lciBldmVudCB0eXBlLlxuICogQHBhcmFtIHshRnVuY3Rpb259IGxpc3RlbmVyIFRoaXMgbGlzdGVuZXIgY2FsbGJhY2sgbWV0aG9kLlxuICogQHBhcmFtIHtib29sZWFufSBjYWxsT25jZSBXaGV0aGVyIHRoZSBsaXN0ZW5lciBpcyBhIG9uZS1vZmZcbiAqICAgICBsaXN0ZW5lci5cbiAqIEBwYXJhbSB7Ym9vbGVhbj19IG9wdF91c2VDYXB0dXJlIFRoZSBjYXB0dXJlIG1vZGUgb2YgdGhlIGxpc3RlbmVyLlxuICogQHBhcmFtIHtPYmplY3Q9fSBvcHRfbGlzdGVuZXJTY29wZSBPYmplY3QgaW4gd2hvc2Ugc2NvcGUgdG8gY2FsbCB0aGVcbiAqICAgICBsaXN0ZW5lci5cbiAqIEByZXR1cm4geyFnb29nLmV2ZW50cy5MaXN0ZW5hYmxlS2V5fSBVbmlxdWUga2V5IGZvciB0aGUgbGlzdGVuZXIuXG4gKi9cbmdvb2cuZXZlbnRzLkxpc3RlbmVyTWFwLnByb3RvdHlwZS5hZGQgPSBmdW5jdGlvbihcbiAgICB0eXBlLCBsaXN0ZW5lciwgY2FsbE9uY2UsIG9wdF91c2VDYXB0dXJlLCBvcHRfbGlzdGVuZXJTY29wZSkge1xuICAndXNlIHN0cmljdCc7XG4gIHZhciB0eXBlU3RyID0gdHlwZS50b1N0cmluZygpO1xuICB2YXIgbGlzdGVuZXJBcnJheSA9IHRoaXMubGlzdGVuZXJzW3R5cGVTdHJdO1xuICBpZiAoIWxpc3RlbmVyQXJyYXkpIHtcbiAgICBsaXN0ZW5lckFycmF5ID0gdGhpcy5saXN0ZW5lcnNbdHlwZVN0cl0gPSBbXTtcbiAgICB0aGlzLnR5cGVDb3VudF8rKztcbiAgfVxuXG4gIHZhciBsaXN0ZW5lck9iajtcbiAgdmFyIGluZGV4ID0gZ29vZy5ldmVudHMuTGlzdGVuZXJNYXAuZmluZExpc3RlbmVySW5kZXhfKFxuICAgICAgbGlzdGVuZXJBcnJheSwgbGlzdGVuZXIsIG9wdF91c2VDYXB0dXJlLCBvcHRfbGlzdGVuZXJTY29wZSk7XG4gIGlmIChpbmRleCA+IC0xKSB7XG4gICAgbGlzdGVuZXJPYmogPSBsaXN0ZW5lckFycmF5W2luZGV4XTtcbiAgICBpZiAoIWNhbGxPbmNlKSB7XG4gICAgICAvLyBFbnN1cmUgdGhhdCwgaWYgdGhlcmUgaXMgYW4gZXhpc3RpbmcgY2FsbE9uY2UgbGlzdGVuZXIsIGl0IGlzIG5vXG4gICAgICAvLyBsb25nZXIgYSBjYWxsT25jZSBsaXN0ZW5lci5cbiAgICAgIGxpc3RlbmVyT2JqLmNhbGxPbmNlID0gZmFsc2U7XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIGxpc3RlbmVyT2JqID0gbmV3IGdvb2cuZXZlbnRzLkxpc3RlbmVyKFxuICAgICAgICBsaXN0ZW5lciwgbnVsbCwgdGhpcy5zcmMsIHR5cGVTdHIsICEhb3B0X3VzZUNhcHR1cmUsIG9wdF9saXN0ZW5lclNjb3BlKTtcbiAgICBsaXN0ZW5lck9iai5jYWxsT25jZSA9IGNhbGxPbmNlO1xuICAgIGxpc3RlbmVyQXJyYXkucHVzaChsaXN0ZW5lck9iaik7XG4gIH1cbiAgcmV0dXJuIGxpc3RlbmVyT2JqO1xufTtcblxuXG4vKipcbiAqIFJlbW92ZXMgYSBtYXRjaGluZyBsaXN0ZW5lci5cbiAqIEBwYXJhbSB7c3RyaW5nfCFnb29nLmV2ZW50cy5FdmVudElkfSB0eXBlIFRoZSBsaXN0ZW5lciBldmVudCB0eXBlLlxuICogQHBhcmFtIHshRnVuY3Rpb259IGxpc3RlbmVyIFRoaXMgbGlzdGVuZXIgY2FsbGJhY2sgbWV0aG9kLlxuICogQHBhcmFtIHtib29sZWFuPX0gb3B0X3VzZUNhcHR1cmUgVGhlIGNhcHR1cmUgbW9kZSBvZiB0aGUgbGlzdGVuZXIuXG4gKiBAcGFyYW0ge09iamVjdD19IG9wdF9saXN0ZW5lclNjb3BlIE9iamVjdCBpbiB3aG9zZSBzY29wZSB0byBjYWxsIHRoZVxuICogICAgIGxpc3RlbmVyLlxuICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciBhbnkgbGlzdGVuZXIgd2FzIHJlbW92ZWQuXG4gKi9cbmdvb2cuZXZlbnRzLkxpc3RlbmVyTWFwLnByb3RvdHlwZS5yZW1vdmUgPSBmdW5jdGlvbihcbiAgICB0eXBlLCBsaXN0ZW5lciwgb3B0X3VzZUNhcHR1cmUsIG9wdF9saXN0ZW5lclNjb3BlKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgdmFyIHR5cGVTdHIgPSB0eXBlLnRvU3RyaW5nKCk7XG4gIGlmICghKHR5cGVTdHIgaW4gdGhpcy5saXN0ZW5lcnMpKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgdmFyIGxpc3RlbmVyQXJyYXkgPSB0aGlzLmxpc3RlbmVyc1t0eXBlU3RyXTtcbiAgdmFyIGluZGV4ID0gZ29vZy5ldmVudHMuTGlzdGVuZXJNYXAuZmluZExpc3RlbmVySW5kZXhfKFxuICAgICAgbGlzdGVuZXJBcnJheSwgbGlzdGVuZXIsIG9wdF91c2VDYXB0dXJlLCBvcHRfbGlzdGVuZXJTY29wZSk7XG4gIGlmIChpbmRleCA+IC0xKSB7XG4gICAgdmFyIGxpc3RlbmVyT2JqID0gbGlzdGVuZXJBcnJheVtpbmRleF07XG4gICAgbGlzdGVuZXJPYmoubWFya0FzUmVtb3ZlZCgpO1xuICAgIGdvb2cuYXJyYXkucmVtb3ZlQXQobGlzdGVuZXJBcnJheSwgaW5kZXgpO1xuICAgIGlmIChsaXN0ZW5lckFycmF5Lmxlbmd0aCA9PSAwKSB7XG4gICAgICBkZWxldGUgdGhpcy5saXN0ZW5lcnNbdHlwZVN0cl07XG4gICAgICB0aGlzLnR5cGVDb3VudF8tLTtcbiAgICB9XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgcmV0dXJuIGZhbHNlO1xufTtcblxuXG4vKipcbiAqIFJlbW92ZXMgdGhlIGdpdmVuIGxpc3RlbmVyIG9iamVjdC5cbiAqIEBwYXJhbSB7IWdvb2cuZXZlbnRzLkxpc3RlbmFibGVLZXl9IGxpc3RlbmVyIFRoZSBsaXN0ZW5lciB0byByZW1vdmUuXG4gKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoZSBsaXN0ZW5lciBpcyByZW1vdmVkLlxuICovXG5nb29nLmV2ZW50cy5MaXN0ZW5lck1hcC5wcm90b3R5cGUucmVtb3ZlQnlLZXkgPSBmdW5jdGlvbihsaXN0ZW5lcikge1xuICAndXNlIHN0cmljdCc7XG4gIHZhciB0eXBlID0gbGlzdGVuZXIudHlwZTtcbiAgaWYgKCEodHlwZSBpbiB0aGlzLmxpc3RlbmVycykpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICB2YXIgcmVtb3ZlZCA9IGdvb2cuYXJyYXkucmVtb3ZlKHRoaXMubGlzdGVuZXJzW3R5cGVdLCBsaXN0ZW5lcik7XG4gIGlmIChyZW1vdmVkKSB7XG4gICAgLyoqIEB0eXBlIHshZ29vZy5ldmVudHMuTGlzdGVuZXJ9ICovIChsaXN0ZW5lcikubWFya0FzUmVtb3ZlZCgpO1xuICAgIGlmICh0aGlzLmxpc3RlbmVyc1t0eXBlXS5sZW5ndGggPT0gMCkge1xuICAgICAgZGVsZXRlIHRoaXMubGlzdGVuZXJzW3R5cGVdO1xuICAgICAgdGhpcy50eXBlQ291bnRfLS07XG4gICAgfVxuICB9XG4gIHJldHVybiByZW1vdmVkO1xufTtcblxuXG4vKipcbiAqIFJlbW92ZXMgYWxsIGxpc3RlbmVycyBmcm9tIHRoaXMgbWFwLiBJZiBvcHRfdHlwZSBpcyBwcm92aWRlZCwgb25seVxuICogbGlzdGVuZXJzIHRoYXQgbWF0Y2ggdGhlIGdpdmVuIHR5cGUgYXJlIHJlbW92ZWQuXG4gKiBAcGFyYW0ge3N0cmluZ3whZ29vZy5ldmVudHMuRXZlbnRJZD19IG9wdF90eXBlIFR5cGUgb2YgZXZlbnQgdG8gcmVtb3ZlLlxuICogQHJldHVybiB7bnVtYmVyfSBOdW1iZXIgb2YgbGlzdGVuZXJzIHJlbW92ZWQuXG4gKi9cbmdvb2cuZXZlbnRzLkxpc3RlbmVyTWFwLnByb3RvdHlwZS5yZW1vdmVBbGwgPSBmdW5jdGlvbihvcHRfdHlwZSkge1xuICAndXNlIHN0cmljdCc7XG4gIHZhciB0eXBlU3RyID0gb3B0X3R5cGUgJiYgb3B0X3R5cGUudG9TdHJpbmcoKTtcbiAgdmFyIGNvdW50ID0gMDtcbiAgZm9yICh2YXIgdHlwZSBpbiB0aGlzLmxpc3RlbmVycykge1xuICAgIGlmICghdHlwZVN0ciB8fCB0eXBlID09IHR5cGVTdHIpIHtcbiAgICAgIHZhciBsaXN0ZW5lckFycmF5ID0gdGhpcy5saXN0ZW5lcnNbdHlwZV07XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpc3RlbmVyQXJyYXkubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgKytjb3VudDtcbiAgICAgICAgbGlzdGVuZXJBcnJheVtpXS5tYXJrQXNSZW1vdmVkKCk7XG4gICAgICB9XG4gICAgICBkZWxldGUgdGhpcy5saXN0ZW5lcnNbdHlwZV07XG4gICAgICB0aGlzLnR5cGVDb3VudF8tLTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGNvdW50O1xufTtcblxuXG4vKipcbiAqIEdldHMgYWxsIGxpc3RlbmVycyB0aGF0IG1hdGNoIHRoZSBnaXZlbiB0eXBlIGFuZCBjYXB0dXJlIG1vZGUuIFRoZVxuICogcmV0dXJuZWQgYXJyYXkgaXMgYSBjb3B5IChidXQgdGhlIGxpc3RlbmVyIG9iamVjdHMgYXJlIG5vdCkuXG4gKiBAcGFyYW0ge3N0cmluZ3whZ29vZy5ldmVudHMuRXZlbnRJZH0gdHlwZSBUaGUgdHlwZSBvZiB0aGUgbGlzdGVuZXJzXG4gKiAgICAgdG8gcmV0cmlldmUuXG4gKiBAcGFyYW0ge2Jvb2xlYW59IGNhcHR1cmUgVGhlIGNhcHR1cmUgbW9kZSBvZiB0aGUgbGlzdGVuZXJzIHRvIHJldHJpZXZlLlxuICogQHJldHVybiB7IUFycmF5PCFnb29nLmV2ZW50cy5MaXN0ZW5hYmxlS2V5Pn0gQW4gYXJyYXkgb2YgbWF0Y2hpbmdcbiAqICAgICBsaXN0ZW5lcnMuXG4gKi9cbmdvb2cuZXZlbnRzLkxpc3RlbmVyTWFwLnByb3RvdHlwZS5nZXRMaXN0ZW5lcnMgPSBmdW5jdGlvbih0eXBlLCBjYXB0dXJlKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgdmFyIGxpc3RlbmVyQXJyYXkgPSB0aGlzLmxpc3RlbmVyc1t0eXBlLnRvU3RyaW5nKCldO1xuICB2YXIgcnYgPSBbXTtcbiAgaWYgKGxpc3RlbmVyQXJyYXkpIHtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpc3RlbmVyQXJyYXkubGVuZ3RoOyArK2kpIHtcbiAgICAgIHZhciBsaXN0ZW5lck9iaiA9IGxpc3RlbmVyQXJyYXlbaV07XG4gICAgICBpZiAobGlzdGVuZXJPYmouY2FwdHVyZSA9PSBjYXB0dXJlKSB7XG4gICAgICAgIHJ2LnB1c2gobGlzdGVuZXJPYmopO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICByZXR1cm4gcnY7XG59O1xuXG5cbi8qKlxuICogR2V0cyB0aGUgZ29vZy5ldmVudHMuTGlzdGVuYWJsZUtleSBmb3IgdGhlIGV2ZW50IG9yIG51bGwgaWYgbm8gc3VjaFxuICogbGlzdGVuZXIgaXMgaW4gdXNlLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfCFnb29nLmV2ZW50cy5FdmVudElkfSB0eXBlIFRoZSB0eXBlIG9mIHRoZSBsaXN0ZW5lclxuICogICAgIHRvIHJldHJpZXZlLlxuICogQHBhcmFtIHshRnVuY3Rpb259IGxpc3RlbmVyIFRoZSBsaXN0ZW5lciBmdW5jdGlvbiB0byBnZXQuXG4gKiBAcGFyYW0ge2Jvb2xlYW59IGNhcHR1cmUgV2hldGhlciB0aGUgbGlzdGVuZXIgaXMgYSBjYXB0dXJpbmcgbGlzdGVuZXIuXG4gKiBAcGFyYW0ge09iamVjdD19IG9wdF9saXN0ZW5lclNjb3BlIE9iamVjdCBpbiB3aG9zZSBzY29wZSB0byBjYWxsIHRoZVxuICogICAgIGxpc3RlbmVyLlxuICogQHJldHVybiB7Z29vZy5ldmVudHMuTGlzdGVuYWJsZUtleX0gdGhlIGZvdW5kIGxpc3RlbmVyIG9yIG51bGwgaWYgbm90IGZvdW5kLlxuICovXG5nb29nLmV2ZW50cy5MaXN0ZW5lck1hcC5wcm90b3R5cGUuZ2V0TGlzdGVuZXIgPSBmdW5jdGlvbihcbiAgICB0eXBlLCBsaXN0ZW5lciwgY2FwdHVyZSwgb3B0X2xpc3RlbmVyU2NvcGUpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICB2YXIgbGlzdGVuZXJBcnJheSA9IHRoaXMubGlzdGVuZXJzW3R5cGUudG9TdHJpbmcoKV07XG4gIHZhciBpID0gLTE7XG4gIGlmIChsaXN0ZW5lckFycmF5KSB7XG4gICAgaSA9IGdvb2cuZXZlbnRzLkxpc3RlbmVyTWFwLmZpbmRMaXN0ZW5lckluZGV4XyhcbiAgICAgICAgbGlzdGVuZXJBcnJheSwgbGlzdGVuZXIsIGNhcHR1cmUsIG9wdF9saXN0ZW5lclNjb3BlKTtcbiAgfVxuICByZXR1cm4gaSA+IC0xID8gbGlzdGVuZXJBcnJheVtpXSA6IG51bGw7XG59O1xuXG5cbi8qKlxuICogV2hldGhlciB0aGVyZSBpcyBhIG1hdGNoaW5nIGxpc3RlbmVyLiBJZiBlaXRoZXIgdGhlIHR5cGUgb3IgY2FwdHVyZVxuICogcGFyYW1ldGVycyBhcmUgdW5zcGVjaWZpZWQsIHRoZSBmdW5jdGlvbiB3aWxsIG1hdGNoIG9uIHRoZVxuICogcmVtYWluaW5nIGNyaXRlcmlhLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfCFnb29nLmV2ZW50cy5FdmVudElkPX0gb3B0X3R5cGUgVGhlIHR5cGUgb2YgdGhlIGxpc3RlbmVyLlxuICogQHBhcmFtIHtib29sZWFuPX0gb3B0X2NhcHR1cmUgVGhlIGNhcHR1cmUgbW9kZSBvZiB0aGUgbGlzdGVuZXIuXG4gKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoZXJlIGlzIGFuIGFjdGl2ZSBsaXN0ZW5lciBtYXRjaGluZ1xuICogICAgIHRoZSByZXF1ZXN0ZWQgdHlwZSBhbmQvb3IgY2FwdHVyZSBwaGFzZS5cbiAqL1xuZ29vZy5ldmVudHMuTGlzdGVuZXJNYXAucHJvdG90eXBlLmhhc0xpc3RlbmVyID0gZnVuY3Rpb24oXG4gICAgb3B0X3R5cGUsIG9wdF9jYXB0dXJlKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgdmFyIGhhc1R5cGUgPSAob3B0X3R5cGUgIT09IHVuZGVmaW5lZCk7XG4gIHZhciB0eXBlU3RyID0gaGFzVHlwZSA/IG9wdF90eXBlLnRvU3RyaW5nKCkgOiAnJztcbiAgdmFyIGhhc0NhcHR1cmUgPSAob3B0X2NhcHR1cmUgIT09IHVuZGVmaW5lZCk7XG5cbiAgcmV0dXJuIGdvb2cub2JqZWN0LnNvbWUodGhpcy5saXN0ZW5lcnMsIGZ1bmN0aW9uKGxpc3RlbmVyQXJyYXksIHR5cGUpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaXN0ZW5lckFycmF5Lmxlbmd0aDsgKytpKSB7XG4gICAgICBpZiAoKCFoYXNUeXBlIHx8IGxpc3RlbmVyQXJyYXlbaV0udHlwZSA9PSB0eXBlU3RyKSAmJlxuICAgICAgICAgICghaGFzQ2FwdHVyZSB8fCBsaXN0ZW5lckFycmF5W2ldLmNhcHR1cmUgPT0gb3B0X2NhcHR1cmUpKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBmYWxzZTtcbiAgfSk7XG59O1xuXG5cbi8qKlxuICogRmluZHMgdGhlIGluZGV4IG9mIGEgbWF0Y2hpbmcgZ29vZy5ldmVudHMuTGlzdGVuZXIgaW4gdGhlIGdpdmVuXG4gKiBsaXN0ZW5lckFycmF5LlxuICogQHBhcmFtIHshQXJyYXk8IWdvb2cuZXZlbnRzLkxpc3RlbmVyPn0gbGlzdGVuZXJBcnJheSBBcnJheSBvZiBsaXN0ZW5lci5cbiAqIEBwYXJhbSB7IUZ1bmN0aW9ufSBsaXN0ZW5lciBUaGUgbGlzdGVuZXIgZnVuY3Rpb24uXG4gKiBAcGFyYW0ge2Jvb2xlYW49fSBvcHRfdXNlQ2FwdHVyZSBUaGUgY2FwdHVyZSBmbGFnIGZvciB0aGUgbGlzdGVuZXIuXG4gKiBAcGFyYW0ge09iamVjdD19IG9wdF9saXN0ZW5lclNjb3BlIFRoZSBsaXN0ZW5lciBzY29wZS5cbiAqIEByZXR1cm4ge251bWJlcn0gVGhlIGluZGV4IG9mIHRoZSBtYXRjaGluZyBsaXN0ZW5lciB3aXRoaW4gdGhlXG4gKiAgICAgbGlzdGVuZXJBcnJheS5cbiAqIEBwcml2YXRlXG4gKi9cbmdvb2cuZXZlbnRzLkxpc3RlbmVyTWFwLmZpbmRMaXN0ZW5lckluZGV4XyA9IGZ1bmN0aW9uKFxuICAgIGxpc3RlbmVyQXJyYXksIGxpc3RlbmVyLCBvcHRfdXNlQ2FwdHVyZSwgb3B0X2xpc3RlbmVyU2NvcGUpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IGxpc3RlbmVyQXJyYXkubGVuZ3RoOyArK2kpIHtcbiAgICB2YXIgbGlzdGVuZXJPYmogPSBsaXN0ZW5lckFycmF5W2ldO1xuICAgIGlmICghbGlzdGVuZXJPYmoucmVtb3ZlZCAmJiBsaXN0ZW5lck9iai5saXN0ZW5lciA9PSBsaXN0ZW5lciAmJlxuICAgICAgICBsaXN0ZW5lck9iai5jYXB0dXJlID09ICEhb3B0X3VzZUNhcHR1cmUgJiZcbiAgICAgICAgbGlzdGVuZXJPYmouaGFuZGxlciA9PSBvcHRfbGlzdGVuZXJTY29wZSkge1xuICAgICAgcmV0dXJuIGk7XG4gICAgfVxuICB9XG4gIHJldHVybiAtMTtcbn07XG4iLCAiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IFRoZSBDbG9zdXJlIExpYnJhcnkgQXV0aG9ycy5cbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBAZmlsZW92ZXJ2aWV3IEFuIGV2ZW50IG1hbmFnZXIgZm9yIGJvdGggbmF0aXZlIGJyb3dzZXIgZXZlbnRcbiAqIHRhcmdldHMgYW5kIGN1c3RvbSBKYXZhU2NyaXB0IGV2ZW50IHRhcmdldHNcbiAqIChgZ29vZy5ldmVudHMuTGlzdGVuYWJsZWApLiBUaGlzIHByb3ZpZGVzIGFuIGFic3RyYWN0aW9uXG4gKiBvdmVyIGJyb3dzZXJzJyBldmVudCBzeXN0ZW1zLlxuICpcbiAqIEl0IGFsc28gcHJvdmlkZXMgYSBzaW11bGF0aW9uIG9mIFczQyBldmVudCBtb2RlbCdzIGNhcHR1cmUgcGhhc2UgaW5cbiAqIEludGVybmV0IEV4cGxvcmVyIChJRSA4IGFuZCBiZWxvdykuIENhdmVhdDogdGhlIHNpbXVsYXRpb24gZG9lcyBub3RcbiAqIGludGVyYWN0IHdlbGwgd2l0aCBsaXN0ZW5lcnMgcmVnaXN0ZXJlZCBkaXJlY3RseSBvbiB0aGUgZWxlbWVudHNcbiAqIChieXBhc3NpbmcgZ29vZy5ldmVudHMpIG9yIGV2ZW4gd2l0aCBsaXN0ZW5lcnMgcmVnaXN0ZXJlZCB2aWFcbiAqIGdvb2cuZXZlbnRzIGluIGEgc2VwYXJhdGUgSlMgYmluYXJ5LiBJbiB0aGVzZSBjYXNlcywgd2UgcHJvdmlkZVxuICogbm8gb3JkZXJpbmcgZ3VhcmFudGVlcy5cbiAqXG4gKiBUaGUgbGlzdGVuZXJzIHdpbGwgcmVjZWl2ZSBhIFwicGF0Y2hlZFwiIGV2ZW50IG9iamVjdC4gU3VjaCBldmVudCBvYmplY3RcbiAqIGNvbnRhaW5zIG5vcm1hbGl6ZWQgdmFsdWVzIGZvciBjZXJ0YWluIGV2ZW50IHByb3BlcnRpZXMgdGhhdCBkaWZmZXJzIGluXG4gKiBkaWZmZXJlbnQgYnJvd3NlcnMuXG4gKlxuICogRXhhbXBsZSB1c2FnZTpcbiAqIDxwcmU+XG4gKiBnb29nLmV2ZW50cy5saXN0ZW4obXlOb2RlLCAnY2xpY2snLCBmdW5jdGlvbihlKSB7IGFsZXJ0KCd3b28nKSB9KTtcbiAqIGdvb2cuZXZlbnRzLmxpc3RlbihteU5vZGUsICdtb3VzZW92ZXInLCBtb3VzZUhhbmRsZXIsIHRydWUpO1xuICogZ29vZy5ldmVudHMudW5saXN0ZW4obXlOb2RlLCAnbW91c2VvdmVyJywgbW91c2VIYW5kbGVyLCB0cnVlKTtcbiAqIGdvb2cuZXZlbnRzLnJlbW92ZUFsbChteU5vZGUpO1xuICogPC9wcmU+XG4gKlxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluIElFIGFuZCBldmVudCBvYmplY3QgcGF0Y2hpbmddXG4gKlxuICogQHNlZSAuLi9kZW1vcy9ldmVudHMuaHRtbFxuICogQHNlZSAuLi9kZW1vcy9ldmVudC1wcm9wYWdhdGlvbi5odG1sXG4gKiBAc2VlIC4uL2RlbW9zL3N0b3BldmVudC5odG1sXG4gKi9cblxuLy8gSU1QTEVNRU5UQVRJT04gTk9URVM6XG4vLyBnb29nLmV2ZW50cyBzdG9yZXMgYW4gYXV4aWxpYXJ5IGRhdGEgc3RydWN0dXJlIG9uIGVhY2ggRXZlbnRUYXJnZXRcbi8vIHNvdXJjZSBiZWluZyBsaXN0ZW5lZCBvbi4gVGhpcyBhbGxvd3MgdXMgdG8gdGFrZSBhZHZhbnRhZ2Ugb2YgR0MsXG4vLyBoYXZpbmcgdGhlIGRhdGEgc3RydWN0dXJlIEdDJ2Qgd2hlbiB0aGUgRXZlbnRUYXJnZXQgaXMgR0MnZC4gVGhpc1xuLy8gR0MgYmVoYXZpb3IgaXMgZXF1aXZhbGVudCB0byB1c2luZyBXM0MgRE9NIEV2ZW50cyBkaXJlY3RseS5cblxuZ29vZy5wcm92aWRlKCdnb29nLmV2ZW50cycpO1xuZ29vZy5wcm92aWRlKCdnb29nLmV2ZW50cy5DYXB0dXJlU2ltdWxhdGlvbk1vZGUnKTtcbmdvb2cucHJvdmlkZSgnZ29vZy5ldmVudHMuS2V5Jyk7XG5nb29nLnByb3ZpZGUoJ2dvb2cuZXZlbnRzLkxpc3RlbmFibGVUeXBlJyk7XG5cbmdvb2cucmVxdWlyZSgnZ29vZy5hc3NlcnRzJyk7XG5nb29nLnJlcXVpcmUoJ2dvb2cuZGVidWcuZW50cnlQb2ludFJlZ2lzdHJ5Jyk7XG5nb29nLnJlcXVpcmUoJ2dvb2cuZXZlbnRzLkJyb3dzZXJFdmVudCcpO1xuZ29vZy5yZXF1aXJlKCdnb29nLmV2ZW50cy5Ccm93c2VyRmVhdHVyZScpO1xuZ29vZy5yZXF1aXJlKCdnb29nLmV2ZW50cy5MaXN0ZW5hYmxlJyk7XG5nb29nLnJlcXVpcmUoJ2dvb2cuZXZlbnRzLkxpc3RlbmVyTWFwJyk7XG5nb29nLnJlcXVpcmVUeXBlKCdnb29nLmRlYnVnLkVycm9ySGFuZGxlcicpO1xuZ29vZy5yZXF1aXJlVHlwZSgnZ29vZy5ldmVudHMuRXZlbnRJZCcpO1xuZ29vZy5yZXF1aXJlVHlwZSgnZ29vZy5ldmVudHMuRXZlbnRMaWtlJyk7XG5nb29nLnJlcXVpcmVUeXBlKCdnb29nLmV2ZW50cy5FdmVudFdyYXBwZXInKTtcbmdvb2cucmVxdWlyZVR5cGUoJ2dvb2cuZXZlbnRzLkxpc3RlbmFibGVLZXknKTtcbmdvb2cucmVxdWlyZVR5cGUoJ2dvb2cuZXZlbnRzLkxpc3RlbmVyJyk7XG5cblxuLyoqXG4gKiBAdHlwZWRlZiB7bnVtYmVyfGdvb2cuZXZlbnRzLkxpc3RlbmFibGVLZXl9XG4gKi9cbmdvb2cuZXZlbnRzLktleTtcblxuXG4vKipcbiAqIEB0eXBlZGVmIHtFdmVudFRhcmdldHxnb29nLmV2ZW50cy5MaXN0ZW5hYmxlfVxuICovXG5nb29nLmV2ZW50cy5MaXN0ZW5hYmxlVHlwZTtcblxuXG4vKipcbiAqIFByb3BlcnR5IG5hbWUgb24gYSBuYXRpdmUgZXZlbnQgdGFyZ2V0IGZvciB0aGUgbGlzdGVuZXIgbWFwXG4gKiBhc3NvY2lhdGVkIHdpdGggdGhlIGV2ZW50IHRhcmdldC5cbiAqIEBwcml2YXRlIEBjb25zdCB7c3RyaW5nfVxuICovXG5nb29nLmV2ZW50cy5MSVNURU5FUl9NQVBfUFJPUF8gPSAnY2xvc3VyZV9sbV8nICsgKChNYXRoLnJhbmRvbSgpICogMWU2KSB8IDApO1xuXG5cbi8qKlxuICogU3RyaW5nIHVzZWQgdG8gcHJlcGVuZCB0byBJRSBldmVudCB0eXBlcy5cbiAqIEBjb25zdFxuICogQHByaXZhdGVcbiAqL1xuZ29vZy5ldmVudHMub25TdHJpbmdfID0gJ29uJztcblxuXG4vKipcbiAqIE1hcCBvZiBjb21wdXRlZCBcIm9uPGV2ZW50bmFtZT5cIiBzdHJpbmdzIGZvciBJRSBldmVudCB0eXBlcy4gQ2FjaGluZ1xuICogdGhpcyByZW1vdmVzIGFuIGV4dHJhIG9iamVjdCBhbGxvY2F0aW9uIGluIGdvb2cuZXZlbnRzLmxpc3RlbiB3aGljaFxuICogaW1wcm92ZXMgSUU2IHBlcmZvcm1hbmNlLlxuICogQGNvbnN0XG4gKiBAZGljdFxuICogQHByaXZhdGVcbiAqL1xuZ29vZy5ldmVudHMub25TdHJpbmdNYXBfID0ge307XG5cblxuLyoqXG4gKiBAZW51bSB7bnVtYmVyfSBEaWZmZXJlbnQgY2FwdHVyZSBzaW11bGF0aW9uIG1vZGUgZm9yIElFOC0uXG4gKi9cbmdvb2cuZXZlbnRzLkNhcHR1cmVTaW11bGF0aW9uTW9kZSA9IHtcbiAgLyoqXG4gICAqIERvZXMgbm90IHBlcmZvcm0gY2FwdHVyZSBzaW11bGF0aW9uLiBXaWxsIGFzc2VydHMgaW4gSUU4LSB3aGVuIHlvdVxuICAgKiBhZGQgY2FwdHVyZSBsaXN0ZW5lcnMuXG4gICAqL1xuICBPRkZfQU5EX0ZBSUw6IDAsXG5cbiAgLyoqXG4gICAqIERvZXMgbm90IHBlcmZvcm0gY2FwdHVyZSBzaW11bGF0aW9uLCBzaWxlbnRseSBpZ25vcmUgY2FwdHVyZVxuICAgKiBsaXN0ZW5lcnMuXG4gICAqL1xuICBPRkZfQU5EX1NJTEVOVDogMSxcblxuICAvKipcbiAgICogUGVyZm9ybXMgY2FwdHVyZSBzaW11bGF0aW9uLlxuICAgKi9cbiAgT046IDJcbn07XG5cblxuLyoqXG4gKiBAZGVmaW5lIHtudW1iZXJ9IFRoZSBjYXB0dXJlIHNpbXVsYXRpb24gbW9kZSBmb3IgSUU4LS4gQnkgZGVmYXVsdCxcbiAqICAgICB0aGlzIGlzIE9OLlxuICovXG5nb29nLmV2ZW50cy5DQVBUVVJFX1NJTVVMQVRJT05fTU9ERSA9XG4gICAgZ29vZy5kZWZpbmUoJ2dvb2cuZXZlbnRzLkNBUFRVUkVfU0lNVUxBVElPTl9NT0RFJywgMik7XG5cblxuLyoqXG4gKiBFc3RpbWF0ZWQgY291bnQgb2YgdG90YWwgbmF0aXZlIGxpc3RlbmVycy5cbiAqIEBwcml2YXRlIHtudW1iZXJ9XG4gKi9cbmdvb2cuZXZlbnRzLmxpc3RlbmVyQ291bnRFc3RpbWF0ZV8gPSAwO1xuXG5cbi8qKlxuICogQWRkcyBhbiBldmVudCBsaXN0ZW5lciBmb3IgYSBzcGVjaWZpYyBldmVudCBvbiBhIG5hdGl2ZSBldmVudFxuICogdGFyZ2V0IChzdWNoIGFzIGEgRE9NIGVsZW1lbnQpIG9yIGFuIG9iamVjdCB0aGF0IGhhcyBpbXBsZW1lbnRlZFxuICoge0BsaW5rIGdvb2cuZXZlbnRzLkxpc3RlbmFibGV9LiBBIGxpc3RlbmVyIGNhbiBvbmx5IGJlIGFkZGVkIG9uY2VcbiAqIHRvIGFuIG9iamVjdCBhbmQgaWYgaXQgaXMgYWRkZWQgYWdhaW4gdGhlIGtleSBmb3IgdGhlIGxpc3RlbmVyIGlzXG4gKiByZXR1cm5lZC4gTm90ZSB0aGF0IGlmIHRoZSBleGlzdGluZyBsaXN0ZW5lciBpcyBhIG9uZS1vZmYgbGlzdGVuZXJcbiAqIChyZWdpc3RlcmVkIHZpYSBsaXN0ZW5PbmNlKSwgaXQgd2lsbCBubyBsb25nZXIgYmUgYSBvbmUtb2ZmXG4gKiBsaXN0ZW5lciBhZnRlciBhIGNhbGwgdG8gbGlzdGVuKCkuXG4gKlxuICogQHBhcmFtIHtFdmVudFRhcmdldHxnb29nLmV2ZW50cy5MaXN0ZW5hYmxlfSBzcmMgVGhlIG5vZGUgdG8gbGlzdGVuXG4gKiAgICAgdG8gZXZlbnRzIG9uLlxuICogQHBhcmFtIHtzdHJpbmd8QXJyYXk8c3RyaW5nPnxcbiAqICAgICAhZ29vZy5ldmVudHMuRXZlbnRJZDxFVkVOVE9CSj58IUFycmF5PCFnb29nLmV2ZW50cy5FdmVudElkPEVWRU5UT0JKPj59XG4gKiAgICAgdHlwZSBFdmVudCB0eXBlIG9yIGFycmF5IG9mIGV2ZW50IHR5cGVzLlxuICogQHBhcmFtIHtmdW5jdGlvbih0aGlzOlQsIEVWRU5UT0JKKTo/fHtoYW5kbGVFdmVudDpmdW5jdGlvbig/KTo/fXxudWxsfVxuICogICAgIGxpc3RlbmVyIENhbGxiYWNrIG1ldGhvZCwgb3IgYW4gb2JqZWN0IHdpdGggYSBoYW5kbGVFdmVudCBmdW5jdGlvbi5cbiAqICAgICBXQVJOSU5HOiBwYXNzaW5nIGFuIE9iamVjdCBpcyBub3cgc29mdGx5IGRlcHJlY2F0ZWQuXG4gKiBAcGFyYW0geyhib29sZWFufCFBZGRFdmVudExpc3RlbmVyT3B0aW9ucyk9fSBvcHRfb3B0aW9uc1xuICogQHBhcmFtIHtUPX0gb3B0X2hhbmRsZXIgRWxlbWVudCBpbiB3aG9zZSBzY29wZSB0byBjYWxsIHRoZSBsaXN0ZW5lci5cbiAqIEByZXR1cm4ge2dvb2cuZXZlbnRzLktleX0gVW5pcXVlIGtleSBmb3IgdGhlIGxpc3RlbmVyLlxuICogQHRlbXBsYXRlIFQsRVZFTlRPQkpcbiAqL1xuZ29vZy5ldmVudHMubGlzdGVuID0gZnVuY3Rpb24oc3JjLCB0eXBlLCBsaXN0ZW5lciwgb3B0X29wdGlvbnMsIG9wdF9oYW5kbGVyKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgaWYgKG9wdF9vcHRpb25zICYmIG9wdF9vcHRpb25zLm9uY2UpIHtcbiAgICByZXR1cm4gZ29vZy5ldmVudHMubGlzdGVuT25jZShcbiAgICAgICAgc3JjLCB0eXBlLCBsaXN0ZW5lciwgb3B0X29wdGlvbnMsIG9wdF9oYW5kbGVyKTtcbiAgfVxuICBpZiAoQXJyYXkuaXNBcnJheSh0eXBlKSkge1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdHlwZS5sZW5ndGg7IGkrKykge1xuICAgICAgZ29vZy5ldmVudHMubGlzdGVuKHNyYywgdHlwZVtpXSwgbGlzdGVuZXIsIG9wdF9vcHRpb25zLCBvcHRfaGFuZGxlcik7XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgbGlzdGVuZXIgPSBnb29nLmV2ZW50cy53cmFwTGlzdGVuZXIobGlzdGVuZXIpO1xuICBpZiAoZ29vZy5ldmVudHMuTGlzdGVuYWJsZS5pc0ltcGxlbWVudGVkQnkoc3JjKSkge1xuICAgIHZhciBjYXB0dXJlID1cbiAgICAgICAgZ29vZy5pc09iamVjdChvcHRfb3B0aW9ucykgPyAhIW9wdF9vcHRpb25zLmNhcHR1cmUgOiAhIW9wdF9vcHRpb25zO1xuICAgIHJldHVybiBzcmMubGlzdGVuKFxuICAgICAgICAvKiogQHR5cGUge3N0cmluZ3whZ29vZy5ldmVudHMuRXZlbnRJZH0gKi8gKHR5cGUpLCBsaXN0ZW5lciwgY2FwdHVyZSxcbiAgICAgICAgb3B0X2hhbmRsZXIpO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiBnb29nLmV2ZW50cy5saXN0ZW5fKFxuICAgICAgICAvKiogQHR5cGUgeyFFdmVudFRhcmdldH0gKi8gKHNyYyksIHR5cGUsIGxpc3RlbmVyLFxuICAgICAgICAvKiBjYWxsT25jZSAqLyBmYWxzZSwgb3B0X29wdGlvbnMsIG9wdF9oYW5kbGVyKTtcbiAgfVxufTtcblxuXG4vKipcbiAqIEFkZHMgYW4gZXZlbnQgbGlzdGVuZXIgZm9yIGEgc3BlY2lmaWMgZXZlbnQgb24gYSBuYXRpdmUgZXZlbnRcbiAqIHRhcmdldC4gQSBsaXN0ZW5lciBjYW4gb25seSBiZSBhZGRlZCBvbmNlIHRvIGFuIG9iamVjdCBhbmQgaWYgaXRcbiAqIGlzIGFkZGVkIGFnYWluIHRoZSBrZXkgZm9yIHRoZSBsaXN0ZW5lciBpcyByZXR1cm5lZC5cbiAqXG4gKiBOb3RlIHRoYXQgYSBvbmUtb2ZmIGxpc3RlbmVyIHdpbGwgbm90IGNoYW5nZSBhbiBleGlzdGluZyBsaXN0ZW5lcixcbiAqIGlmIGFueS4gT24gdGhlIG90aGVyIGhhbmQgYSBub3JtYWwgbGlzdGVuZXIgd2lsbCBjaGFuZ2UgZXhpc3RpbmdcbiAqIG9uZS1vZmYgbGlzdGVuZXIgdG8gYmVjb21lIGEgbm9ybWFsIGxpc3RlbmVyLlxuICpcbiAqIEBwYXJhbSB7RXZlbnRUYXJnZXR9IHNyYyBUaGUgbm9kZSB0byBsaXN0ZW4gdG8gZXZlbnRzIG9uLlxuICogQHBhcmFtIHtzdHJpbmd8P2dvb2cuZXZlbnRzLkV2ZW50SWQ8RVZFTlRPQko+fSB0eXBlIEV2ZW50IHR5cGUuXG4gKiBAcGFyYW0geyFGdW5jdGlvbn0gbGlzdGVuZXIgQ2FsbGJhY2sgZnVuY3Rpb24uXG4gKiBAcGFyYW0ge2Jvb2xlYW59IGNhbGxPbmNlIFdoZXRoZXIgdGhlIGxpc3RlbmVyIGlzIGEgb25lLW9mZlxuICogICAgIGxpc3RlbmVyIG9yIG90aGVyd2lzZS5cbiAqIEBwYXJhbSB7KGJvb2xlYW58IUFkZEV2ZW50TGlzdGVuZXJPcHRpb25zKT19IG9wdF9vcHRpb25zXG4gKiBAcGFyYW0ge09iamVjdD19IG9wdF9oYW5kbGVyIEVsZW1lbnQgaW4gd2hvc2Ugc2NvcGUgdG8gY2FsbCB0aGUgbGlzdGVuZXIuXG4gKiBAcmV0dXJuIHtnb29nLmV2ZW50cy5MaXN0ZW5hYmxlS2V5fSBVbmlxdWUga2V5IGZvciB0aGUgbGlzdGVuZXIuXG4gKiBAdGVtcGxhdGUgRVZFTlRPQkpcbiAqIEBwcml2YXRlXG4gKi9cbmdvb2cuZXZlbnRzLmxpc3Rlbl8gPSBmdW5jdGlvbihcbiAgICBzcmMsIHR5cGUsIGxpc3RlbmVyLCBjYWxsT25jZSwgb3B0X29wdGlvbnMsIG9wdF9oYW5kbGVyKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgaWYgKCF0eXBlKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIGV2ZW50IHR5cGUnKTtcbiAgfVxuXG4gIHZhciBjYXB0dXJlID1cbiAgICAgIGdvb2cuaXNPYmplY3Qob3B0X29wdGlvbnMpID8gISFvcHRfb3B0aW9ucy5jYXB0dXJlIDogISFvcHRfb3B0aW9ucztcbiAgaWYgKGNhcHR1cmUgJiYgIWdvb2cuZXZlbnRzLkJyb3dzZXJGZWF0dXJlLkhBU19XM0NfRVZFTlRfU1VQUE9SVCkge1xuICAgIGlmIChnb29nLmV2ZW50cy5DQVBUVVJFX1NJTVVMQVRJT05fTU9ERSA9PVxuICAgICAgICBnb29nLmV2ZW50cy5DYXB0dXJlU2ltdWxhdGlvbk1vZGUuT0ZGX0FORF9GQUlMKSB7XG4gICAgICBnb29nLmFzc2VydHMuZmFpbCgnQ2FuIG5vdCByZWdpc3RlciBjYXB0dXJlIGxpc3RlbmVyIGluIElFOC0uJyk7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9IGVsc2UgaWYgKFxuICAgICAgICBnb29nLmV2ZW50cy5DQVBUVVJFX1NJTVVMQVRJT05fTU9ERSA9PVxuICAgICAgICBnb29nLmV2ZW50cy5DYXB0dXJlU2ltdWxhdGlvbk1vZGUuT0ZGX0FORF9TSUxFTlQpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgfVxuXG4gIHZhciBsaXN0ZW5lck1hcCA9IGdvb2cuZXZlbnRzLmdldExpc3RlbmVyTWFwXyhzcmMpO1xuICBpZiAoIWxpc3RlbmVyTWFwKSB7XG4gICAgc3JjW2dvb2cuZXZlbnRzLkxJU1RFTkVSX01BUF9QUk9QX10gPSBsaXN0ZW5lck1hcCA9XG4gICAgICAgIG5ldyBnb29nLmV2ZW50cy5MaXN0ZW5lck1hcChzcmMpO1xuICB9XG5cbiAgdmFyIGxpc3RlbmVyT2JqID0gLyoqIEB0eXBlIHtnb29nLmV2ZW50cy5MaXN0ZW5lcn0gKi8gKFxuICAgICAgbGlzdGVuZXJNYXAuYWRkKHR5cGUsIGxpc3RlbmVyLCBjYWxsT25jZSwgY2FwdHVyZSwgb3B0X2hhbmRsZXIpKTtcblxuICAvLyBJZiB0aGUgbGlzdGVuZXJPYmogYWxyZWFkeSBoYXMgYSBwcm94eSwgaXQgaGFzIGJlZW4gc2V0IHVwXG4gIC8vIHByZXZpb3VzbHkuIFdlIHNpbXBseSByZXR1cm4uXG4gIGlmIChsaXN0ZW5lck9iai5wcm94eSkge1xuICAgIHJldHVybiBsaXN0ZW5lck9iajtcbiAgfVxuXG4gIHZhciBwcm94eSA9IGdvb2cuZXZlbnRzLmdldFByb3h5KCk7XG4gIGxpc3RlbmVyT2JqLnByb3h5ID0gcHJveHk7XG5cbiAgcHJveHkuc3JjID0gc3JjO1xuICBwcm94eS5saXN0ZW5lciA9IGxpc3RlbmVyT2JqO1xuXG4gIC8vIEF0dGFjaCB0aGUgcHJveHkgdGhyb3VnaCB0aGUgYnJvd3NlcidzIEFQSVxuICBpZiAoc3JjLmFkZEV2ZW50TGlzdGVuZXIpIHtcbiAgICAvLyBEb24ndCBwYXNzIGFuIG9iamVjdCBhcyBgY2FwdHVyZWAgaWYgdGhlIGJyb3dzZXIgZG9lc24ndCBzdXBwb3J0IHRoYXQuXG4gICAgaWYgKCFnb29nLmV2ZW50cy5Ccm93c2VyRmVhdHVyZS5QQVNTSVZFX0VWRU5UUykge1xuICAgICAgb3B0X29wdGlvbnMgPSBjYXB0dXJlO1xuICAgIH1cbiAgICAvLyBEb24ndCBicmVhayB0ZXN0cyB0aGF0IGV4cGVjdCBhIGJvb2xlYW4uXG4gICAgaWYgKG9wdF9vcHRpb25zID09PSB1bmRlZmluZWQpIG9wdF9vcHRpb25zID0gZmFsc2U7XG4gICAgc3JjLmFkZEV2ZW50TGlzdGVuZXIodHlwZS50b1N0cmluZygpLCBwcm94eSwgb3B0X29wdGlvbnMpO1xuICB9IGVsc2UgaWYgKHNyYy5hdHRhY2hFdmVudCkge1xuICAgIC8vIFRoZSBlbHNlIGlmIGFib3ZlIHVzZWQgdG8gYmUgYW4gdW5jb25kaXRpb25hbCBlbHNlLiBJdCB3b3VsZCBjYWxsXG4gICAgLy8gYXR0YWNoRXZlbnQgY29tZSBnd3Mgb3IgaGlnaCB3YXRlci4gVGhpcyB3b3VsZCBzb21ldGltZXMgdGhyb3cgYW5cbiAgICAvLyBleGNlcHRpb24gb24gSUUxMSwgc3BvaWxpbmcgdGhlIGRheSBvZiBzb21lIGNhbGxlcnMuIFRoZSBwcmV2aW91c1xuICAgIC8vIGluY2FybmF0aW9uIG9mIHRoaXMgY29kZSwgZnJvbSAyMDA3LCBpbmRpY2F0ZXMgdGhhdCBpdCByZXBsYWNlZCBhblxuICAgIC8vIGVhcmxpZXIgc3RpbGwgdmVyc2lvbiB0aGF0IGNhdXNlZCBleGNlc3MgYWxsb2NhdGlvbnMgb24gSUU2LlxuICAgIHNyYy5hdHRhY2hFdmVudChnb29nLmV2ZW50cy5nZXRPblN0cmluZ18odHlwZS50b1N0cmluZygpKSwgcHJveHkpO1xuICB9IGVsc2UgaWYgKHNyYy5hZGRMaXN0ZW5lciAmJiBzcmMucmVtb3ZlTGlzdGVuZXIpIHtcbiAgICAvLyBJbiBJRSwgTWVkaWFRdWVyeUxpc3QgdXNlcyBhZGRMaXN0ZW5lcigpIGluc3RlYWRkIG9mIGFkZEV2ZW50TGlzdGVuZXIuIEluXG4gICAgLy8gU2FmYXJpLCB0aGVyZSBpcyBubyBnbG9iYWwgZm9yIHRoZSBNZWRpYVF1ZXJ5TGlzdCBjb25zdHJ1Y3Rvciwgc28gd2UganVzdFxuICAgIC8vIGNoZWNrIHdoZXRoZXIgdGhlIG9iamVjdCBcImxvb2tzIGxpa2VcIiBNZWRpYVF1ZXJ5TGlzdC5cbiAgICBnb29nLmFzc2VydHMuYXNzZXJ0KFxuICAgICAgICB0eXBlID09PSAnY2hhbmdlJywgJ01lZGlhUXVlcnlMaXN0IG9ubHkgaGFzIGEgY2hhbmdlIGV2ZW50Jyk7XG4gICAgc3JjLmFkZExpc3RlbmVyKHByb3h5KTtcbiAgfSBlbHNlIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ2FkZEV2ZW50TGlzdGVuZXIgYW5kIGF0dGFjaEV2ZW50IGFyZSB1bmF2YWlsYWJsZS4nKTtcbiAgfVxuXG4gIGdvb2cuZXZlbnRzLmxpc3RlbmVyQ291bnRFc3RpbWF0ZV8rKztcbiAgcmV0dXJuIGxpc3RlbmVyT2JqO1xufTtcblxuXG4vKipcbiAqIEhlbHBlciBmdW5jdGlvbiBmb3IgcmV0dXJuaW5nIGEgcHJveHkgZnVuY3Rpb24uXG4gKiBAcmV0dXJuIHshRnVuY3Rpb259IEEgbmV3IG9yIHJldXNlZCBmdW5jdGlvbiBvYmplY3QuXG4gKi9cbmdvb2cuZXZlbnRzLmdldFByb3h5ID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgdmFyIHByb3h5Q2FsbGJhY2tGdW5jdGlvbiA9IGdvb2cuZXZlbnRzLmhhbmRsZUJyb3dzZXJFdmVudF87XG4gIC8vIFVzZSBhIGxvY2FsIHZhciBmIHRvIHByZXZlbnQgb25lIGFsbG9jYXRpb24uXG4gIHZhciBmID1cbiAgICAgIGdvb2cuZXZlbnRzLkJyb3dzZXJGZWF0dXJlLkhBU19XM0NfRVZFTlRfU1VQUE9SVCA/IGZ1bmN0aW9uKGV2ZW50T2JqZWN0KSB7XG4gICAgICAgICd1c2Ugc3RyaWN0JztcbiAgICAgICAgcmV0dXJuIHByb3h5Q2FsbGJhY2tGdW5jdGlvbi5jYWxsKGYuc3JjLCBmLmxpc3RlbmVyLCBldmVudE9iamVjdCk7XG4gICAgICB9IDogZnVuY3Rpb24oZXZlbnRPYmplY3QpIHtcbiAgICAgICAgJ3VzZSBzdHJpY3QnO1xuICAgICAgICB2YXIgdiA9IHByb3h5Q2FsbGJhY2tGdW5jdGlvbi5jYWxsKGYuc3JjLCBmLmxpc3RlbmVyLCBldmVudE9iamVjdCk7XG4gICAgICAgIC8vIE5PVEUoY2hyaXNoZW5yeSk6IEluIElFLCB3ZSBoYWNrIGluIGEgY2FwdHVyZSBwaGFzZS4gSG93ZXZlciwgaWZcbiAgICAgICAgLy8gdGhlcmUgaXMgaW5saW5lIGV2ZW50IGhhbmRsZXIgd2hpY2ggdHJpZXMgdG8gcHJldmVudCBkZWZhdWx0IChmb3JcbiAgICAgICAgLy8gZXhhbXBsZSA8YSBocmVmPVwiLi4uXCIgb25jbGljaz1cInJldHVybiBmYWxzZVwiPi4uLjwvYT4pIGluIGFcbiAgICAgICAgLy8gZGVzY2VuZGFudCBlbGVtZW50LCB0aGUgcHJldmVudCBkZWZhdWx0IHdpbGwgYmUgb3ZlcnJpZGRlblxuICAgICAgICAvLyBieSB0aGlzIGxpc3RlbmVyIGlmIHRoaXMgbGlzdGVuZXIgd2VyZSB0byByZXR1cm4gdHJ1ZS4gSGVuY2UsIHdlXG4gICAgICAgIC8vIHJldHVybiB1bmRlZmluZWQuXG4gICAgICAgIGlmICghdikgcmV0dXJuIHY7XG4gICAgICB9O1xuICByZXR1cm4gZjtcbn07XG5cblxuLyoqXG4gKiBBZGRzIGFuIGV2ZW50IGxpc3RlbmVyIGZvciBhIHNwZWNpZmljIGV2ZW50IG9uIGEgbmF0aXZlIGV2ZW50XG4gKiB0YXJnZXQgKHN1Y2ggYXMgYSBET00gZWxlbWVudCkgb3IgYW4gb2JqZWN0IHRoYXQgaGFzIGltcGxlbWVudGVkXG4gKiB7QGxpbmsgZ29vZy5ldmVudHMuTGlzdGVuYWJsZX0uIEFmdGVyIHRoZSBldmVudCBoYXMgZmlyZWQgdGhlIGV2ZW50XG4gKiBsaXN0ZW5lciBpcyByZW1vdmVkIGZyb20gdGhlIHRhcmdldC5cbiAqXG4gKiBJZiBhbiBleGlzdGluZyBsaXN0ZW5lciBhbHJlYWR5IGV4aXN0cywgbGlzdGVuT25jZSB3aWxsIGRvXG4gKiBub3RoaW5nLiBJbiBwYXJ0aWN1bGFyLCBpZiB0aGUgbGlzdGVuZXIgd2FzIHByZXZpb3VzbHkgcmVnaXN0ZXJlZFxuICogdmlhIGxpc3RlbigpLCBsaXN0ZW5PbmNlKCkgd2lsbCBub3QgdHVybiB0aGUgbGlzdGVuZXIgaW50byBhXG4gKiBvbmUtb2ZmIGxpc3RlbmVyLiBTaW1pbGFybHksIGlmIHRoZXJlIGlzIGFscmVhZHkgYW4gZXhpc3RpbmdcbiAqIG9uZS1vZmYgbGlzdGVuZXIsIGxpc3Rlbk9uY2UgZG9lcyBub3QgbW9kaWZ5IHRoZSBsaXN0ZW5lcnMgKGl0IGlzXG4gKiBzdGlsbCBhIG9uY2UgbGlzdGVuZXIpLlxuICpcbiAqIEBwYXJhbSB7RXZlbnRUYXJnZXR8Z29vZy5ldmVudHMuTGlzdGVuYWJsZX0gc3JjIFRoZSBub2RlIHRvIGxpc3RlblxuICogICAgIHRvIGV2ZW50cyBvbi5cbiAqIEBwYXJhbSB7c3RyaW5nfEFycmF5PHN0cmluZz58XG4gKiAgICAgIWdvb2cuZXZlbnRzLkV2ZW50SWQ8RVZFTlRPQko+fCFBcnJheTwhZ29vZy5ldmVudHMuRXZlbnRJZDxFVkVOVE9CSj4+fVxuICogICAgIHR5cGUgRXZlbnQgdHlwZSBvciBhcnJheSBvZiBldmVudCB0eXBlcy5cbiAqIEBwYXJhbSB7ZnVuY3Rpb24odGhpczpULCBFVkVOVE9CSik6P3x7aGFuZGxlRXZlbnQ6ZnVuY3Rpb24oPyk6P318bnVsbH1cbiAqICAgICBsaXN0ZW5lciBDYWxsYmFjayBtZXRob2QuXG4gKiBAcGFyYW0geyhib29sZWFufCFBZGRFdmVudExpc3RlbmVyT3B0aW9ucyk9fSBvcHRfb3B0aW9uc1xuICogQHBhcmFtIHtUPX0gb3B0X2hhbmRsZXIgRWxlbWVudCBpbiB3aG9zZSBzY29wZSB0byBjYWxsIHRoZSBsaXN0ZW5lci5cbiAqIEByZXR1cm4ge2dvb2cuZXZlbnRzLktleX0gVW5pcXVlIGtleSBmb3IgdGhlIGxpc3RlbmVyLlxuICogQHRlbXBsYXRlIFQsRVZFTlRPQkpcbiAqL1xuZ29vZy5ldmVudHMubGlzdGVuT25jZSA9IGZ1bmN0aW9uKFxuICAgIHNyYywgdHlwZSwgbGlzdGVuZXIsIG9wdF9vcHRpb25zLCBvcHRfaGFuZGxlcikge1xuICAndXNlIHN0cmljdCc7XG4gIGlmIChBcnJheS5pc0FycmF5KHR5cGUpKSB7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0eXBlLmxlbmd0aDsgaSsrKSB7XG4gICAgICBnb29nLmV2ZW50cy5saXN0ZW5PbmNlKHNyYywgdHlwZVtpXSwgbGlzdGVuZXIsIG9wdF9vcHRpb25zLCBvcHRfaGFuZGxlcik7XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgbGlzdGVuZXIgPSBnb29nLmV2ZW50cy53cmFwTGlzdGVuZXIobGlzdGVuZXIpO1xuICBpZiAoZ29vZy5ldmVudHMuTGlzdGVuYWJsZS5pc0ltcGxlbWVudGVkQnkoc3JjKSkge1xuICAgIHZhciBjYXB0dXJlID1cbiAgICAgICAgZ29vZy5pc09iamVjdChvcHRfb3B0aW9ucykgPyAhIW9wdF9vcHRpb25zLmNhcHR1cmUgOiAhIW9wdF9vcHRpb25zO1xuICAgIHJldHVybiBzcmMubGlzdGVuT25jZShcbiAgICAgICAgLyoqIEB0eXBlIHtzdHJpbmd8IWdvb2cuZXZlbnRzLkV2ZW50SWR9ICovICh0eXBlKSwgbGlzdGVuZXIsIGNhcHR1cmUsXG4gICAgICAgIG9wdF9oYW5kbGVyKTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gZ29vZy5ldmVudHMubGlzdGVuXyhcbiAgICAgICAgLyoqIEB0eXBlIHshRXZlbnRUYXJnZXR9ICovIChzcmMpLCB0eXBlLCBsaXN0ZW5lcixcbiAgICAgICAgLyogY2FsbE9uY2UgKi8gdHJ1ZSwgb3B0X29wdGlvbnMsIG9wdF9oYW5kbGVyKTtcbiAgfVxufTtcblxuXG4vKipcbiAqIEFkZHMgYW4gZXZlbnQgbGlzdGVuZXIgd2l0aCBhIHNwZWNpZmljIGV2ZW50IHdyYXBwZXIgb24gYSBET00gTm9kZSBvciBhblxuICogb2JqZWN0IHRoYXQgaGFzIGltcGxlbWVudGVkIHtAbGluayBnb29nLmV2ZW50cy5MaXN0ZW5hYmxlfS4gQSBsaXN0ZW5lciBjYW5cbiAqIG9ubHkgYmUgYWRkZWQgb25jZSB0byBhbiBvYmplY3QuXG4gKlxuICogQHBhcmFtIHtFdmVudFRhcmdldHxnb29nLmV2ZW50cy5MaXN0ZW5hYmxlfSBzcmMgVGhlIHRhcmdldCB0b1xuICogICAgIGxpc3RlbiB0byBldmVudHMgb24uXG4gKiBAcGFyYW0ge2dvb2cuZXZlbnRzLkV2ZW50V3JhcHBlcn0gd3JhcHBlciBFdmVudCB3cmFwcGVyIHRvIHVzZS5cbiAqIEBwYXJhbSB7ZnVuY3Rpb24odGhpczpULCA/KTo/fHtoYW5kbGVFdmVudDpmdW5jdGlvbig/KTo/fXxudWxsfSBsaXN0ZW5lclxuICogICAgIENhbGxiYWNrIG1ldGhvZCwgb3IgYW4gb2JqZWN0IHdpdGggYSBoYW5kbGVFdmVudCBmdW5jdGlvbi5cbiAqIEBwYXJhbSB7Ym9vbGVhbj19IG9wdF9jYXB0IFdoZXRoZXIgdG8gZmlyZSBpbiBjYXB0dXJlIHBoYXNlIChkZWZhdWx0cyB0b1xuICogICAgIGZhbHNlKS5cbiAqIEBwYXJhbSB7VD19IG9wdF9oYW5kbGVyIEVsZW1lbnQgaW4gd2hvc2Ugc2NvcGUgdG8gY2FsbCB0aGUgbGlzdGVuZXIuXG4gKiBAdGVtcGxhdGUgVFxuICovXG5nb29nLmV2ZW50cy5saXN0ZW5XaXRoV3JhcHBlciA9IGZ1bmN0aW9uKFxuICAgIHNyYywgd3JhcHBlciwgbGlzdGVuZXIsIG9wdF9jYXB0LCBvcHRfaGFuZGxlcikge1xuICAndXNlIHN0cmljdCc7XG4gIHdyYXBwZXIubGlzdGVuKHNyYywgbGlzdGVuZXIsIG9wdF9jYXB0LCBvcHRfaGFuZGxlcik7XG59O1xuXG5cbi8qKlxuICogUmVtb3ZlcyBhbiBldmVudCBsaXN0ZW5lciB3aGljaCB3YXMgYWRkZWQgd2l0aCBsaXN0ZW4oKS5cbiAqXG4gKiBAcGFyYW0ge0V2ZW50VGFyZ2V0fGdvb2cuZXZlbnRzLkxpc3RlbmFibGV9IHNyYyBUaGUgdGFyZ2V0IHRvIHN0b3BcbiAqICAgICBsaXN0ZW5pbmcgdG8gZXZlbnRzIG9uLlxuICogQHBhcmFtIHtzdHJpbmd8QXJyYXk8c3RyaW5nPnxcbiAqICAgICAhZ29vZy5ldmVudHMuRXZlbnRJZDxFVkVOVE9CSj58IUFycmF5PCFnb29nLmV2ZW50cy5FdmVudElkPEVWRU5UT0JKPj59XG4gKiAgICAgdHlwZSBFdmVudCB0eXBlIG9yIGFycmF5IG9mIGV2ZW50IHR5cGVzIHRvIHVubGlzdGVuIHRvLlxuICogQHBhcmFtIHtmdW5jdGlvbig/KTo/fHtoYW5kbGVFdmVudDpmdW5jdGlvbig/KTo/fXxudWxsfSBsaXN0ZW5lciBUaGVcbiAqICAgICBsaXN0ZW5lciBmdW5jdGlvbiB0byByZW1vdmUuXG4gKiBAcGFyYW0geyhib29sZWFufCFFdmVudExpc3RlbmVyT3B0aW9ucyk9fSBvcHRfb3B0aW9uc1xuICogICAgIHdoZXRoZXIgdGhlIGxpc3RlbmVyIGlzIGZpcmVkIGR1cmluZyB0aGUgY2FwdHVyZSBvciBidWJibGUgcGhhc2Ugb2YgdGhlXG4gKiAgICAgZXZlbnQuXG4gKiBAcGFyYW0ge09iamVjdD19IG9wdF9oYW5kbGVyIEVsZW1lbnQgaW4gd2hvc2Ugc2NvcGUgdG8gY2FsbCB0aGUgbGlzdGVuZXIuXG4gKiBAcmV0dXJuIHs/Ym9vbGVhbn0gaW5kaWNhdGluZyB3aGV0aGVyIHRoZSBsaXN0ZW5lciB3YXMgdGhlcmUgdG8gcmVtb3ZlLlxuICogQHRlbXBsYXRlIEVWRU5UT0JKXG4gKi9cbmdvb2cuZXZlbnRzLnVubGlzdGVuID0gZnVuY3Rpb24oc3JjLCB0eXBlLCBsaXN0ZW5lciwgb3B0X29wdGlvbnMsIG9wdF9oYW5kbGVyKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgaWYgKEFycmF5LmlzQXJyYXkodHlwZSkpIHtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHR5cGUubGVuZ3RoOyBpKyspIHtcbiAgICAgIGdvb2cuZXZlbnRzLnVubGlzdGVuKHNyYywgdHlwZVtpXSwgbGlzdGVuZXIsIG9wdF9vcHRpb25zLCBvcHRfaGFuZGxlcik7XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9XG4gIHZhciBjYXB0dXJlID1cbiAgICAgIGdvb2cuaXNPYmplY3Qob3B0X29wdGlvbnMpID8gISFvcHRfb3B0aW9ucy5jYXB0dXJlIDogISFvcHRfb3B0aW9ucztcblxuICBsaXN0ZW5lciA9IGdvb2cuZXZlbnRzLndyYXBMaXN0ZW5lcihsaXN0ZW5lcik7XG4gIGlmIChnb29nLmV2ZW50cy5MaXN0ZW5hYmxlLmlzSW1wbGVtZW50ZWRCeShzcmMpKSB7XG4gICAgcmV0dXJuIHNyYy51bmxpc3RlbihcbiAgICAgICAgLyoqIEB0eXBlIHtzdHJpbmd8IWdvb2cuZXZlbnRzLkV2ZW50SWR9ICovICh0eXBlKSwgbGlzdGVuZXIsIGNhcHR1cmUsXG4gICAgICAgIG9wdF9oYW5kbGVyKTtcbiAgfVxuXG4gIGlmICghc3JjKSB7XG4gICAgLy8gVE9ETyhjaHJpc2hlbnJ5KTogV2Ugc2hvdWxkIHRpZ2h0ZW4gdGhlIEFQSSB0byBvbmx5IGFjY2VwdFxuICAgIC8vIG5vbi1udWxsIG9iamVjdHMsIG9yIGFkZCBhbiBhc3NlcnRpb24gaGVyZS5cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICB2YXIgbGlzdGVuZXJNYXAgPSBnb29nLmV2ZW50cy5nZXRMaXN0ZW5lck1hcF8oXG4gICAgICAvKiogQHR5cGUgeyFFdmVudFRhcmdldH0gKi8gKHNyYykpO1xuICBpZiAobGlzdGVuZXJNYXApIHtcbiAgICB2YXIgbGlzdGVuZXJPYmogPSBsaXN0ZW5lck1hcC5nZXRMaXN0ZW5lcihcbiAgICAgICAgLyoqIEB0eXBlIHtzdHJpbmd8IWdvb2cuZXZlbnRzLkV2ZW50SWR9ICovICh0eXBlKSwgbGlzdGVuZXIsIGNhcHR1cmUsXG4gICAgICAgIG9wdF9oYW5kbGVyKTtcbiAgICBpZiAobGlzdGVuZXJPYmopIHtcbiAgICAgIHJldHVybiBnb29nLmV2ZW50cy51bmxpc3RlbkJ5S2V5KGxpc3RlbmVyT2JqKTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gZmFsc2U7XG59O1xuXG5cbi8qKlxuICogUmVtb3ZlcyBhbiBldmVudCBsaXN0ZW5lciB3aGljaCB3YXMgYWRkZWQgd2l0aCBsaXN0ZW4oKSBieSB0aGUga2V5XG4gKiByZXR1cm5lZCBieSBsaXN0ZW4oKS5cbiAqXG4gKiBAcGFyYW0ge2dvb2cuZXZlbnRzLktleX0ga2V5IFRoZSBrZXkgcmV0dXJuZWQgYnkgbGlzdGVuKCkgZm9yIHRoaXNcbiAqICAgICBldmVudCBsaXN0ZW5lci5cbiAqIEByZXR1cm4ge2Jvb2xlYW59IGluZGljYXRpbmcgd2hldGhlciB0aGUgbGlzdGVuZXIgd2FzIHRoZXJlIHRvIHJlbW92ZS5cbiAqL1xuZ29vZy5ldmVudHMudW5saXN0ZW5CeUtleSA9IGZ1bmN0aW9uKGtleSkge1xuICAndXNlIHN0cmljdCc7XG4gIC8vIFRPRE8oY2hyaXNoZW5yeSk6IFJlbW92ZSB0aGlzIGNoZWNrIHdoZW4gdGVzdHMgdGhhdCByZWx5IG9uIHRoaXNcbiAgLy8gYXJlIGZpeGVkLlxuICBpZiAodHlwZW9mIGtleSA9PT0gJ251bWJlcicpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICB2YXIgbGlzdGVuZXIgPSBrZXk7XG4gIGlmICghbGlzdGVuZXIgfHwgbGlzdGVuZXIucmVtb3ZlZCkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIHZhciBzcmMgPSBsaXN0ZW5lci5zcmM7XG4gIGlmIChnb29nLmV2ZW50cy5MaXN0ZW5hYmxlLmlzSW1wbGVtZW50ZWRCeShzcmMpKSB7XG4gICAgcmV0dXJuIC8qKiBAdHlwZSB7IWdvb2cuZXZlbnRzLkxpc3RlbmFibGV9ICovIChzcmMpLnVubGlzdGVuQnlLZXkobGlzdGVuZXIpO1xuICB9XG5cbiAgdmFyIHR5cGUgPSBsaXN0ZW5lci50eXBlO1xuICB2YXIgcHJveHkgPSBsaXN0ZW5lci5wcm94eTtcbiAgaWYgKHNyYy5yZW1vdmVFdmVudExpc3RlbmVyKSB7XG4gICAgc3JjLnJlbW92ZUV2ZW50TGlzdGVuZXIodHlwZSwgcHJveHksIGxpc3RlbmVyLmNhcHR1cmUpO1xuICB9IGVsc2UgaWYgKHNyYy5kZXRhY2hFdmVudCkge1xuICAgIHNyYy5kZXRhY2hFdmVudChnb29nLmV2ZW50cy5nZXRPblN0cmluZ18odHlwZSksIHByb3h5KTtcbiAgfSBlbHNlIGlmIChzcmMuYWRkTGlzdGVuZXIgJiYgc3JjLnJlbW92ZUxpc3RlbmVyKSB7XG4gICAgc3JjLnJlbW92ZUxpc3RlbmVyKHByb3h5KTtcbiAgfVxuICBnb29nLmV2ZW50cy5saXN0ZW5lckNvdW50RXN0aW1hdGVfLS07XG5cbiAgdmFyIGxpc3RlbmVyTWFwID0gZ29vZy5ldmVudHMuZ2V0TGlzdGVuZXJNYXBfKFxuICAgICAgLyoqIEB0eXBlIHshRXZlbnRUYXJnZXR9ICovIChzcmMpKTtcbiAgLy8gVE9ETyhjaHJpc2hlbnJ5KTogVHJ5IHRvIHJlbW92ZSB0aGlzIGNvbmRpdGlvbmFsIGFuZCBleGVjdXRlIHRoZVxuICAvLyBmaXJzdCBicmFuY2ggYWx3YXlzLiBUaGlzIHNob3VsZCBiZSBzYWZlLlxuICBpZiAobGlzdGVuZXJNYXApIHtcbiAgICBsaXN0ZW5lck1hcC5yZW1vdmVCeUtleShsaXN0ZW5lcik7XG4gICAgaWYgKGxpc3RlbmVyTWFwLmdldFR5cGVDb3VudCgpID09IDApIHtcbiAgICAgIC8vIE51bGwgdGhlIHNyYywganVzdCBiZWNhdXNlIHRoaXMgaXMgc2ltcGxlIHRvIGRvIChhbmQgdXNlZnVsXG4gICAgICAvLyBmb3IgSUUgPD0gNykuXG4gICAgICBsaXN0ZW5lck1hcC5zcmMgPSBudWxsO1xuICAgICAgLy8gV2UgZG9uJ3QgdXNlIGRlbGV0ZSBoZXJlIGJlY2F1c2UgSUUgZG9lcyBub3QgYWxsb3cgZGVsZXRlXG4gICAgICAvLyBvbiBhIHdpbmRvdyBvYmplY3QuXG4gICAgICBzcmNbZ29vZy5ldmVudHMuTElTVEVORVJfTUFQX1BST1BfXSA9IG51bGw7XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIC8qKiBAdHlwZSB7IWdvb2cuZXZlbnRzLkxpc3RlbmVyfSAqLyAobGlzdGVuZXIpLm1hcmtBc1JlbW92ZWQoKTtcbiAgfVxuXG4gIHJldHVybiB0cnVlO1xufTtcblxuXG4vKipcbiAqIFJlbW92ZXMgYW4gZXZlbnQgbGlzdGVuZXIgd2hpY2ggd2FzIGFkZGVkIHdpdGggbGlzdGVuV2l0aFdyYXBwZXIoKS5cbiAqXG4gKiBAcGFyYW0ge0V2ZW50VGFyZ2V0fGdvb2cuZXZlbnRzLkxpc3RlbmFibGV9IHNyYyBUaGUgdGFyZ2V0IHRvIHN0b3BcbiAqICAgICBsaXN0ZW5pbmcgdG8gZXZlbnRzIG9uLlxuICogQHBhcmFtIHtnb29nLmV2ZW50cy5FdmVudFdyYXBwZXJ9IHdyYXBwZXIgRXZlbnQgd3JhcHBlciB0byB1c2UuXG4gKiBAcGFyYW0ge2Z1bmN0aW9uKD8pOj98e2hhbmRsZUV2ZW50OmZ1bmN0aW9uKD8pOj99fG51bGx9IGxpc3RlbmVyIFRoZVxuICogICAgIGxpc3RlbmVyIGZ1bmN0aW9uIHRvIHJlbW92ZS5cbiAqIEBwYXJhbSB7Ym9vbGVhbj19IG9wdF9jYXB0IEluIERPTS1jb21wbGlhbnQgYnJvd3NlcnMsIHRoaXMgZGV0ZXJtaW5lc1xuICogICAgIHdoZXRoZXIgdGhlIGxpc3RlbmVyIGlzIGZpcmVkIGR1cmluZyB0aGUgY2FwdHVyZSBvciBidWJibGUgcGhhc2Ugb2YgdGhlXG4gKiAgICAgZXZlbnQuXG4gKiBAcGFyYW0ge09iamVjdD19IG9wdF9oYW5kbGVyIEVsZW1lbnQgaW4gd2hvc2Ugc2NvcGUgdG8gY2FsbCB0aGUgbGlzdGVuZXIuXG4gKi9cbmdvb2cuZXZlbnRzLnVubGlzdGVuV2l0aFdyYXBwZXIgPSBmdW5jdGlvbihcbiAgICBzcmMsIHdyYXBwZXIsIGxpc3RlbmVyLCBvcHRfY2FwdCwgb3B0X2hhbmRsZXIpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICB3cmFwcGVyLnVubGlzdGVuKHNyYywgbGlzdGVuZXIsIG9wdF9jYXB0LCBvcHRfaGFuZGxlcik7XG59O1xuXG5cbi8qKlxuICogUmVtb3ZlcyBhbGwgbGlzdGVuZXJzIGZyb20gYW4gb2JqZWN0LiBZb3UgY2FuIGFsc28gb3B0aW9uYWxseVxuICogcmVtb3ZlIGxpc3RlbmVycyBvZiBhIHBhcnRpY3VsYXIgdHlwZS5cbiAqXG4gKiBAcGFyYW0ge09iamVjdHx1bmRlZmluZWR9IG9iaiBPYmplY3QgdG8gcmVtb3ZlIGxpc3RlbmVycyBmcm9tLiBNdXN0IGJlIGFuXG4gKiAgICAgRXZlbnRUYXJnZXQgb3IgYSBnb29nLmV2ZW50cy5MaXN0ZW5hYmxlLlxuICogQHBhcmFtIHtzdHJpbmd8IWdvb2cuZXZlbnRzLkV2ZW50SWQ9fSBvcHRfdHlwZSBUeXBlIG9mIGV2ZW50IHRvIHJlbW92ZS5cbiAqICAgICBEZWZhdWx0IGlzIGFsbCB0eXBlcy5cbiAqIEByZXR1cm4ge251bWJlcn0gTnVtYmVyIG9mIGxpc3RlbmVycyByZW1vdmVkLlxuICovXG5nb29nLmV2ZW50cy5yZW1vdmVBbGwgPSBmdW5jdGlvbihvYmosIG9wdF90eXBlKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgLy8gVE9ETyhjaHJpc2hlbnJ5KTogQ2hhbmdlIHRoZSB0eXBlIG9mIG9iaiB0b1xuICAvLyAoIUV2ZW50VGFyZ2V0fCFnb29nLmV2ZW50cy5MaXN0ZW5hYmxlKS5cblxuICBpZiAoIW9iaikge1xuICAgIHJldHVybiAwO1xuICB9XG5cbiAgaWYgKGdvb2cuZXZlbnRzLkxpc3RlbmFibGUuaXNJbXBsZW1lbnRlZEJ5KG9iaikpIHtcbiAgICByZXR1cm4gLyoqIEB0eXBlIHs/fSAqLyAob2JqKS5yZW1vdmVBbGxMaXN0ZW5lcnMob3B0X3R5cGUpO1xuICB9XG5cbiAgdmFyIGxpc3RlbmVyTWFwID0gZ29vZy5ldmVudHMuZ2V0TGlzdGVuZXJNYXBfKFxuICAgICAgLyoqIEB0eXBlIHshRXZlbnRUYXJnZXR9ICovIChvYmopKTtcbiAgaWYgKCFsaXN0ZW5lck1hcCkge1xuICAgIHJldHVybiAwO1xuICB9XG5cbiAgdmFyIGNvdW50ID0gMDtcbiAgdmFyIHR5cGVTdHIgPSBvcHRfdHlwZSAmJiBvcHRfdHlwZS50b1N0cmluZygpO1xuICBmb3IgKHZhciB0eXBlIGluIGxpc3RlbmVyTWFwLmxpc3RlbmVycykge1xuICAgIGlmICghdHlwZVN0ciB8fCB0eXBlID09IHR5cGVTdHIpIHtcbiAgICAgIC8vIENsb25lIHNvIHRoYXQgd2UgZG9uJ3QgbmVlZCB0byB3b3JyeSBhYm91dCB1bmxpc3RlbkJ5S2V5XG4gICAgICAvLyBjaGFuZ2luZyB0aGUgY29udGVudCBvZiB0aGUgTGlzdGVuZXJNYXAuXG4gICAgICB2YXIgbGlzdGVuZXJzID0gbGlzdGVuZXJNYXAubGlzdGVuZXJzW3R5cGVdLmNvbmNhdCgpO1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaXN0ZW5lcnMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgaWYgKGdvb2cuZXZlbnRzLnVubGlzdGVuQnlLZXkobGlzdGVuZXJzW2ldKSkge1xuICAgICAgICAgICsrY291bnQ7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIGNvdW50O1xufTtcblxuXG4vKipcbiAqIEdldHMgdGhlIGxpc3RlbmVycyBmb3IgYSBnaXZlbiBvYmplY3QsIHR5cGUgYW5kIGNhcHR1cmUgcGhhc2UuXG4gKlxuICogQHBhcmFtIHtPYmplY3R9IG9iaiBPYmplY3QgdG8gZ2V0IGxpc3RlbmVycyBmb3IuXG4gKiBAcGFyYW0ge3N0cmluZ3whZ29vZy5ldmVudHMuRXZlbnRJZH0gdHlwZSBFdmVudCB0eXBlLlxuICogQHBhcmFtIHtib29sZWFufSBjYXB0dXJlIENhcHR1cmUgcGhhc2U/LlxuICogQHJldHVybiB7IUFycmF5PCFnb29nLmV2ZW50cy5MaXN0ZW5lcj59IEFycmF5IG9mIGxpc3RlbmVyIG9iamVjdHMuXG4gKi9cbmdvb2cuZXZlbnRzLmdldExpc3RlbmVycyA9IGZ1bmN0aW9uKG9iaiwgdHlwZSwgY2FwdHVyZSkge1xuICAndXNlIHN0cmljdCc7XG4gIGlmIChnb29nLmV2ZW50cy5MaXN0ZW5hYmxlLmlzSW1wbGVtZW50ZWRCeShvYmopKSB7XG4gICAgcmV0dXJuIC8qKiBAdHlwZSB7IWdvb2cuZXZlbnRzLkxpc3RlbmFibGV9ICovIChvYmopLmdldExpc3RlbmVycyhcbiAgICAgICAgdHlwZSwgY2FwdHVyZSk7XG4gIH0gZWxzZSB7XG4gICAgaWYgKCFvYmopIHtcbiAgICAgIC8vIFRPRE8oY2hyaXNoZW5yeSk6IFdlIHNob3VsZCB0aWdodGVuIHRoZSBBUEkgdG8gYWNjZXB0XG4gICAgICAvLyAhRXZlbnRUYXJnZXR8Z29vZy5ldmVudHMuTGlzdGVuYWJsZSwgYW5kIGFkZCBhbiBhc3NlcnRpb24gaGVyZS5cbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG5cbiAgICB2YXIgbGlzdGVuZXJNYXAgPSBnb29nLmV2ZW50cy5nZXRMaXN0ZW5lck1hcF8oXG4gICAgICAgIC8qKiBAdHlwZSB7IUV2ZW50VGFyZ2V0fSAqLyAob2JqKSk7XG4gICAgcmV0dXJuIGxpc3RlbmVyTWFwID8gbGlzdGVuZXJNYXAuZ2V0TGlzdGVuZXJzKHR5cGUsIGNhcHR1cmUpIDogW107XG4gIH1cbn07XG5cblxuLyoqXG4gKiBHZXRzIHRoZSBnb29nLmV2ZW50cy5MaXN0ZW5lciBmb3IgdGhlIGV2ZW50IG9yIG51bGwgaWYgbm8gc3VjaCBsaXN0ZW5lciBpc1xuICogaW4gdXNlLlxuICpcbiAqIEBwYXJhbSB7RXZlbnRUYXJnZXR8Z29vZy5ldmVudHMuTGlzdGVuYWJsZX0gc3JjIFRoZSB0YXJnZXQgZnJvbVxuICogICAgIHdoaWNoIHRvIGdldCBsaXN0ZW5lcnMuXG4gKiBAcGFyYW0gez9zdHJpbmd8IWdvb2cuZXZlbnRzLkV2ZW50SWQ8RVZFTlRPQko+fSB0eXBlIFRoZSB0eXBlIG9mIHRoZSBldmVudC5cbiAqIEBwYXJhbSB7ZnVuY3Rpb24oRVZFTlRPQkopOj98e2hhbmRsZUV2ZW50OmZ1bmN0aW9uKD8pOj99fG51bGx9IGxpc3RlbmVyIFRoZVxuICogICAgIGxpc3RlbmVyIGZ1bmN0aW9uIHRvIGdldC5cbiAqIEBwYXJhbSB7Ym9vbGVhbj19IG9wdF9jYXB0IEluIERPTS1jb21wbGlhbnQgYnJvd3NlcnMsIHRoaXMgZGV0ZXJtaW5lc1xuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2hldGhlciB0aGUgbGlzdGVuZXIgaXMgZmlyZWQgZHVyaW5nIHRoZVxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FwdHVyZSBvciBidWJibGUgcGhhc2Ugb2YgdGhlIGV2ZW50LlxuICogQHBhcmFtIHtPYmplY3Q9fSBvcHRfaGFuZGxlciBFbGVtZW50IGluIHdob3NlIHNjb3BlIHRvIGNhbGwgdGhlIGxpc3RlbmVyLlxuICogQHJldHVybiB7Z29vZy5ldmVudHMuTGlzdGVuYWJsZUtleX0gdGhlIGZvdW5kIGxpc3RlbmVyIG9yIG51bGwgaWYgbm90IGZvdW5kLlxuICogQHRlbXBsYXRlIEVWRU5UT0JKXG4gKi9cbmdvb2cuZXZlbnRzLmdldExpc3RlbmVyID0gZnVuY3Rpb24oc3JjLCB0eXBlLCBsaXN0ZW5lciwgb3B0X2NhcHQsIG9wdF9oYW5kbGVyKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgLy8gVE9ETyhjaHJpc2hlbnJ5KTogQ2hhbmdlIHR5cGUgZnJvbSA/c3RyaW5nIHRvIHN0cmluZywgb3IgYWRkIGFzc2VydGlvbi5cbiAgdHlwZSA9IC8qKiBAdHlwZSB7c3RyaW5nfSAqLyAodHlwZSk7XG4gIGxpc3RlbmVyID0gZ29vZy5ldmVudHMud3JhcExpc3RlbmVyKGxpc3RlbmVyKTtcbiAgdmFyIGNhcHR1cmUgPSAhIW9wdF9jYXB0O1xuICBpZiAoZ29vZy5ldmVudHMuTGlzdGVuYWJsZS5pc0ltcGxlbWVudGVkQnkoc3JjKSkge1xuICAgIHJldHVybiBzcmMuZ2V0TGlzdGVuZXIodHlwZSwgbGlzdGVuZXIsIGNhcHR1cmUsIG9wdF9oYW5kbGVyKTtcbiAgfVxuXG4gIGlmICghc3JjKSB7XG4gICAgLy8gVE9ETyhjaHJpc2hlbnJ5KTogV2Ugc2hvdWxkIHRpZ2h0ZW4gdGhlIEFQSSB0byBvbmx5IGFjY2VwdFxuICAgIC8vIG5vbi1udWxsIG9iamVjdHMsIG9yIGFkZCBhbiBhc3NlcnRpb24gaGVyZS5cbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIHZhciBsaXN0ZW5lck1hcCA9IGdvb2cuZXZlbnRzLmdldExpc3RlbmVyTWFwXyhcbiAgICAgIC8qKiBAdHlwZSB7IUV2ZW50VGFyZ2V0fSAqLyAoc3JjKSk7XG4gIGlmIChsaXN0ZW5lck1hcCkge1xuICAgIHJldHVybiBsaXN0ZW5lck1hcC5nZXRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lciwgY2FwdHVyZSwgb3B0X2hhbmRsZXIpO1xuICB9XG4gIHJldHVybiBudWxsO1xufTtcblxuXG4vKipcbiAqIFJldHVybnMgd2hldGhlciBhbiBldmVudCB0YXJnZXQgaGFzIGFueSBhY3RpdmUgbGlzdGVuZXJzIG1hdGNoaW5nIHRoZVxuICogc3BlY2lmaWVkIHNpZ25hdHVyZS4gSWYgZWl0aGVyIHRoZSB0eXBlIG9yIGNhcHR1cmUgcGFyYW1ldGVycyBhcmVcbiAqIHVuc3BlY2lmaWVkLCB0aGUgZnVuY3Rpb24gd2lsbCBtYXRjaCBvbiB0aGUgcmVtYWluaW5nIGNyaXRlcmlhLlxuICpcbiAqIEBwYXJhbSB7RXZlbnRUYXJnZXR8Z29vZy5ldmVudHMuTGlzdGVuYWJsZX0gb2JqIFRhcmdldCB0byBnZXRcbiAqICAgICBsaXN0ZW5lcnMgZm9yLlxuICogQHBhcmFtIHtzdHJpbmd8IWdvb2cuZXZlbnRzLkV2ZW50SWQ9fSBvcHRfdHlwZSBFdmVudCB0eXBlLlxuICogQHBhcmFtIHtib29sZWFuPX0gb3B0X2NhcHR1cmUgV2hldGhlciB0byBjaGVjayBmb3IgY2FwdHVyZSBvciBidWJibGUtcGhhc2VcbiAqICAgICBsaXN0ZW5lcnMuXG4gKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIGFuIGV2ZW50IHRhcmdldCBoYXMgb25lIG9yIG1vcmUgbGlzdGVuZXJzIG1hdGNoaW5nXG4gKiAgICAgdGhlIHJlcXVlc3RlZCB0eXBlIGFuZC9vciBjYXB0dXJlIHBoYXNlLlxuICovXG5nb29nLmV2ZW50cy5oYXNMaXN0ZW5lciA9IGZ1bmN0aW9uKG9iaiwgb3B0X3R5cGUsIG9wdF9jYXB0dXJlKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgaWYgKGdvb2cuZXZlbnRzLkxpc3RlbmFibGUuaXNJbXBsZW1lbnRlZEJ5KG9iaikpIHtcbiAgICByZXR1cm4gb2JqLmhhc0xpc3RlbmVyKG9wdF90eXBlLCBvcHRfY2FwdHVyZSk7XG4gIH1cblxuICB2YXIgbGlzdGVuZXJNYXAgPSBnb29nLmV2ZW50cy5nZXRMaXN0ZW5lck1hcF8oXG4gICAgICAvKiogQHR5cGUgeyFFdmVudFRhcmdldH0gKi8gKG9iaikpO1xuICByZXR1cm4gISFsaXN0ZW5lck1hcCAmJiBsaXN0ZW5lck1hcC5oYXNMaXN0ZW5lcihvcHRfdHlwZSwgb3B0X2NhcHR1cmUpO1xufTtcblxuXG4vKipcbiAqIFByb3ZpZGVzIGEgbmljZSBzdHJpbmcgc2hvd2luZyB0aGUgbm9ybWFsaXplZCBldmVudCBvYmplY3RzIHB1YmxpYyBtZW1iZXJzXG4gKiBAcGFyYW0ge09iamVjdH0gZSBFdmVudCBPYmplY3QuXG4gKiBAcmV0dXJuIHtzdHJpbmd9IFN0cmluZyBvZiB0aGUgcHVibGljIG1lbWJlcnMgb2YgdGhlIG5vcm1hbGl6ZWQgZXZlbnQgb2JqZWN0LlxuICovXG5nb29nLmV2ZW50cy5leHBvc2UgPSBmdW5jdGlvbihlKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgdmFyIHN0ciA9IFtdO1xuICBmb3IgKHZhciBrZXkgaW4gZSkge1xuICAgIGlmIChlW2tleV0gJiYgZVtrZXldLmlkKSB7XG4gICAgICBzdHIucHVzaChrZXkgKyAnID0gJyArIGVba2V5XSArICcgKCcgKyBlW2tleV0uaWQgKyAnKScpO1xuICAgIH0gZWxzZSB7XG4gICAgICBzdHIucHVzaChrZXkgKyAnID0gJyArIGVba2V5XSk7XG4gICAgfVxuICB9XG4gIHJldHVybiBzdHIuam9pbignXFxuJyk7XG59O1xuXG5cbi8qKlxuICogUmV0dXJucyBhIHN0cmluZyB3aXRoIG9uIHByZXBlbmRlZCB0byB0aGUgc3BlY2lmaWVkIHR5cGUuIFRoaXMgaXMgdXNlZCBmb3IgSUVcbiAqIHdoaWNoIGV4cGVjdHMgXCJvblwiIHRvIGJlIHByZXBlbmRlZC4gVGhpcyBmdW5jdGlvbiBjYWNoZXMgdGhlIHN0cmluZyBpbiBvcmRlclxuICogdG8gYXZvaWQgZXh0cmEgYWxsb2NhdGlvbnMgaW4gc3RlYWR5IHN0YXRlLlxuICogQHBhcmFtIHtzdHJpbmd9IHR5cGUgRXZlbnQgdHlwZS5cbiAqIEByZXR1cm4ge3N0cmluZ30gVGhlIHR5cGUgc3RyaW5nIHdpdGggJ29uJyBwcmVwZW5kZWQuXG4gKiBAcHJpdmF0ZVxuICovXG5nb29nLmV2ZW50cy5nZXRPblN0cmluZ18gPSBmdW5jdGlvbih0eXBlKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgaWYgKHR5cGUgaW4gZ29vZy5ldmVudHMub25TdHJpbmdNYXBfKSB7XG4gICAgcmV0dXJuIGdvb2cuZXZlbnRzLm9uU3RyaW5nTWFwX1t0eXBlXTtcbiAgfVxuICByZXR1cm4gZ29vZy5ldmVudHMub25TdHJpbmdNYXBfW3R5cGVdID0gZ29vZy5ldmVudHMub25TdHJpbmdfICsgdHlwZTtcbn07XG5cblxuLyoqXG4gKiBGaXJlcyBhbiBvYmplY3QncyBsaXN0ZW5lcnMgb2YgYSBwYXJ0aWN1bGFyIHR5cGUgYW5kIHBoYXNlXG4gKlxuICogQHBhcmFtIHtPYmplY3R9IG9iaiBPYmplY3Qgd2hvc2UgbGlzdGVuZXJzIHRvIGNhbGwuXG4gKiBAcGFyYW0ge3N0cmluZ3whZ29vZy5ldmVudHMuRXZlbnRJZH0gdHlwZSBFdmVudCB0eXBlLlxuICogQHBhcmFtIHtib29sZWFufSBjYXB0dXJlIFdoaWNoIGV2ZW50IHBoYXNlLlxuICogQHBhcmFtIHtPYmplY3R9IGV2ZW50T2JqZWN0IEV2ZW50IG9iamVjdCB0byBiZSBwYXNzZWQgdG8gbGlzdGVuZXIuXG4gKiBAcmV0dXJuIHtib29sZWFufSBUcnVlIGlmIGFsbCBsaXN0ZW5lcnMgcmV0dXJuZWQgdHJ1ZSBlbHNlIGZhbHNlLlxuICovXG5nb29nLmV2ZW50cy5maXJlTGlzdGVuZXJzID0gZnVuY3Rpb24ob2JqLCB0eXBlLCBjYXB0dXJlLCBldmVudE9iamVjdCkge1xuICAndXNlIHN0cmljdCc7XG4gIGlmIChnb29nLmV2ZW50cy5MaXN0ZW5hYmxlLmlzSW1wbGVtZW50ZWRCeShvYmopKSB7XG4gICAgcmV0dXJuIC8qKiBAdHlwZSB7IWdvb2cuZXZlbnRzLkxpc3RlbmFibGV9ICovIChvYmopLmZpcmVMaXN0ZW5lcnMoXG4gICAgICAgIHR5cGUsIGNhcHR1cmUsIGV2ZW50T2JqZWN0KTtcbiAgfVxuXG4gIHJldHVybiBnb29nLmV2ZW50cy5maXJlTGlzdGVuZXJzXyhvYmosIHR5cGUsIGNhcHR1cmUsIGV2ZW50T2JqZWN0KTtcbn07XG5cblxuLyoqXG4gKiBGaXJlcyBhbiBvYmplY3QncyBsaXN0ZW5lcnMgb2YgYSBwYXJ0aWN1bGFyIHR5cGUgYW5kIHBoYXNlLlxuICogQHBhcmFtIHtPYmplY3R9IG9iaiBPYmplY3Qgd2hvc2UgbGlzdGVuZXJzIHRvIGNhbGwuXG4gKiBAcGFyYW0ge3N0cmluZ3whZ29vZy5ldmVudHMuRXZlbnRJZH0gdHlwZSBFdmVudCB0eXBlLlxuICogQHBhcmFtIHtib29sZWFufSBjYXB0dXJlIFdoaWNoIGV2ZW50IHBoYXNlLlxuICogQHBhcmFtIHtPYmplY3R9IGV2ZW50T2JqZWN0IEV2ZW50IG9iamVjdCB0byBiZSBwYXNzZWQgdG8gbGlzdGVuZXIuXG4gKiBAcmV0dXJuIHtib29sZWFufSBUcnVlIGlmIGFsbCBsaXN0ZW5lcnMgcmV0dXJuZWQgdHJ1ZSBlbHNlIGZhbHNlLlxuICogQHByaXZhdGVcbiAqL1xuZ29vZy5ldmVudHMuZmlyZUxpc3RlbmVyc18gPSBmdW5jdGlvbihvYmosIHR5cGUsIGNhcHR1cmUsIGV2ZW50T2JqZWN0KSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgLyoqIEB0eXBlIHtib29sZWFufSAqL1xuICB2YXIgcmV0dmFsID0gdHJ1ZTtcblxuICB2YXIgbGlzdGVuZXJNYXAgPSBnb29nLmV2ZW50cy5nZXRMaXN0ZW5lck1hcF8oXG4gICAgICAvKiogQHR5cGUge0V2ZW50VGFyZ2V0fSAqLyAob2JqKSk7XG4gIGlmIChsaXN0ZW5lck1hcCkge1xuICAgIC8vIFRPRE8oY2hyaXNoZW5yeSk6IE9yaWdpbmFsIGNvZGUgYXZvaWRzIGFycmF5IGNyZWF0aW9uIHdoZW4gdGhlcmVcbiAgICAvLyBpcyBubyBsaXN0ZW5lciwgc28gd2UgZG8gdGhlIHNhbWUuIElmIHRoaXMgb3B0aW1pemF0aW9uIHR1cm5zXG4gICAgLy8gb3V0IHRvIGJlIG5vdCByZXF1aXJlZCwgd2UgY2FuIHJlcGxhY2UgdGhpcyB3aXRoXG4gICAgLy8gbGlzdGVuZXJNYXAuZ2V0TGlzdGVuZXJzKHR5cGUsIGNhcHR1cmUpIGluc3RlYWQsIHdoaWNoIGlzIHNpbXBsZXIuXG4gICAgdmFyIGxpc3RlbmVyQXJyYXkgPSBsaXN0ZW5lck1hcC5saXN0ZW5lcnNbdHlwZS50b1N0cmluZygpXTtcbiAgICBpZiAobGlzdGVuZXJBcnJheSkge1xuICAgICAgbGlzdGVuZXJBcnJheSA9IGxpc3RlbmVyQXJyYXkuY29uY2F0KCk7XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpc3RlbmVyQXJyYXkubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgdmFyIGxpc3RlbmVyID0gbGlzdGVuZXJBcnJheVtpXTtcbiAgICAgICAgLy8gV2UgbWlnaHQgbm90IGhhdmUgYSBsaXN0ZW5lciBpZiB0aGUgbGlzdGVuZXIgd2FzIHJlbW92ZWQuXG4gICAgICAgIGlmIChsaXN0ZW5lciAmJiBsaXN0ZW5lci5jYXB0dXJlID09IGNhcHR1cmUgJiYgIWxpc3RlbmVyLnJlbW92ZWQpIHtcbiAgICAgICAgICB2YXIgcmVzdWx0ID0gZ29vZy5ldmVudHMuZmlyZUxpc3RlbmVyKGxpc3RlbmVyLCBldmVudE9iamVjdCk7XG4gICAgICAgICAgcmV0dmFsID0gcmV0dmFsICYmIChyZXN1bHQgIT09IGZhbHNlKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuICByZXR1cm4gcmV0dmFsO1xufTtcblxuXG4vKipcbiAqIEZpcmVzIGEgbGlzdGVuZXIgd2l0aCBhIHNldCBvZiBhcmd1bWVudHNcbiAqXG4gKiBAcGFyYW0ge2dvb2cuZXZlbnRzLkxpc3RlbmVyfSBsaXN0ZW5lciBUaGUgbGlzdGVuZXIgb2JqZWN0IHRvIGNhbGwuXG4gKiBAcGFyYW0ge09iamVjdH0gZXZlbnRPYmplY3QgVGhlIGV2ZW50IG9iamVjdCB0byBwYXNzIHRvIHRoZSBsaXN0ZW5lci5cbiAqIEByZXR1cm4geyp9IFJlc3VsdCBvZiBsaXN0ZW5lci5cbiAqL1xuZ29vZy5ldmVudHMuZmlyZUxpc3RlbmVyID0gZnVuY3Rpb24obGlzdGVuZXIsIGV2ZW50T2JqZWN0KSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgdmFyIGxpc3RlbmVyRm4gPSBsaXN0ZW5lci5saXN0ZW5lcjtcbiAgdmFyIGxpc3RlbmVySGFuZGxlciA9IGxpc3RlbmVyLmhhbmRsZXIgfHwgbGlzdGVuZXIuc3JjO1xuXG4gIGlmIChsaXN0ZW5lci5jYWxsT25jZSkge1xuICAgIGdvb2cuZXZlbnRzLnVubGlzdGVuQnlLZXkobGlzdGVuZXIpO1xuICB9XG4gIHJldHVybiBsaXN0ZW5lckZuLmNhbGwobGlzdGVuZXJIYW5kbGVyLCBldmVudE9iamVjdCk7XG59O1xuXG5cbi8qKlxuICogR2V0cyB0aGUgdG90YWwgbnVtYmVyIG9mIGxpc3RlbmVycyBjdXJyZW50bHkgaW4gdGhlIHN5c3RlbS5cbiAqIEByZXR1cm4ge251bWJlcn0gTnVtYmVyIG9mIGxpc3RlbmVycy5cbiAqIEBkZXByZWNhdGVkIFRoaXMgcmV0dXJucyBlc3RpbWF0ZWQgY291bnQsIG5vdyB0aGF0IENsb3N1cmUgbm8gbG9uZ2VyXG4gKiBzdG9yZXMgYSBjZW50cmFsIGxpc3RlbmVyIHJlZ2lzdHJ5LiBXZSBzdGlsbCByZXR1cm4gYW4gZXN0aW1hdGlvblxuICogdG8ga2VlcCBleGlzdGluZyBsaXN0ZW5lci1yZWxhdGVkIHRlc3RzIHBhc3NpbmcuIEluIHRoZSBuZWFyIGZ1dHVyZSxcbiAqIHRoaXMgZnVuY3Rpb24gd2lsbCBiZSByZW1vdmVkLlxuICovXG5nb29nLmV2ZW50cy5nZXRUb3RhbExpc3RlbmVyQ291bnQgPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gZ29vZy5ldmVudHMubGlzdGVuZXJDb3VudEVzdGltYXRlXztcbn07XG5cblxuLyoqXG4gKiBEaXNwYXRjaGVzIGFuIGV2ZW50IChvciBldmVudCBsaWtlIG9iamVjdCkgYW5kIGNhbGxzIGFsbCBsaXN0ZW5lcnNcbiAqIGxpc3RlbmluZyBmb3IgZXZlbnRzIG9mIHRoaXMgdHlwZS4gVGhlIHR5cGUgb2YgdGhlIGV2ZW50IGlzIGRlY2lkZWQgYnkgdGhlXG4gKiB0eXBlIHByb3BlcnR5IG9uIHRoZSBldmVudCBvYmplY3QuXG4gKlxuICogSWYgYW55IG9mIHRoZSBsaXN0ZW5lcnMgcmV0dXJucyBmYWxzZSBPUiBjYWxscyBwcmV2ZW50RGVmYXVsdCB0aGVuIHRoaXNcbiAqIGZ1bmN0aW9uIHdpbGwgcmV0dXJuIGZhbHNlLiAgSWYgb25lIG9mIHRoZSBjYXB0dXJlIGxpc3RlbmVycyBjYWxsc1xuICogc3RvcFByb3BhZ2F0aW9uLCB0aGVuIHRoZSBidWJibGUgbGlzdGVuZXJzIHdvbid0IGZpcmUuXG4gKlxuICogQHBhcmFtIHtnb29nLmV2ZW50cy5MaXN0ZW5hYmxlfSBzcmMgVGhlIGV2ZW50IHRhcmdldC5cbiAqIEBwYXJhbSB7Z29vZy5ldmVudHMuRXZlbnRMaWtlfSBlIEV2ZW50IG9iamVjdC5cbiAqIEByZXR1cm4ge2Jvb2xlYW59IElmIGFueW9uZSBjYWxsZWQgcHJldmVudERlZmF1bHQgb24gdGhlIGV2ZW50IG9iamVjdCAob3JcbiAqICAgICBpZiBhbnkgb2YgdGhlIGhhbmRsZXJzIHJldHVybnMgZmFsc2UpIHRoaXMgd2lsbCBhbHNvIHJldHVybiBmYWxzZS5cbiAqICAgICBJZiB0aGVyZSBhcmUgbm8gaGFuZGxlcnMsIG9yIGlmIGFsbCBoYW5kbGVycyByZXR1cm4gdHJ1ZSwgdGhpcyByZXR1cm5zXG4gKiAgICAgdHJ1ZS5cbiAqL1xuZ29vZy5ldmVudHMuZGlzcGF0Y2hFdmVudCA9IGZ1bmN0aW9uKHNyYywgZSkge1xuICAndXNlIHN0cmljdCc7XG4gIGdvb2cuYXNzZXJ0cy5hc3NlcnQoXG4gICAgICBnb29nLmV2ZW50cy5MaXN0ZW5hYmxlLmlzSW1wbGVtZW50ZWRCeShzcmMpLFxuICAgICAgJ0NhbiBub3QgdXNlIGdvb2cuZXZlbnRzLmRpc3BhdGNoRXZlbnQgd2l0aCAnICtcbiAgICAgICAgICAnbm9uLWdvb2cuZXZlbnRzLkxpc3RlbmFibGUgaW5zdGFuY2UuJyk7XG4gIHJldHVybiBzcmMuZGlzcGF0Y2hFdmVudChlKTtcbn07XG5cblxuLyoqXG4gKiBJbnN0YWxscyBleGNlcHRpb24gcHJvdGVjdGlvbiBmb3IgdGhlIGJyb3dzZXIgZXZlbnQgZW50cnkgcG9pbnQgdXNpbmcgdGhlXG4gKiBnaXZlbiBlcnJvciBoYW5kbGVyLlxuICpcbiAqIEBwYXJhbSB7Z29vZy5kZWJ1Zy5FcnJvckhhbmRsZXJ9IGVycm9ySGFuZGxlciBFcnJvciBoYW5kbGVyIHdpdGggd2hpY2ggdG9cbiAqICAgICBwcm90ZWN0IHRoZSBlbnRyeSBwb2ludC5cbiAqL1xuZ29vZy5ldmVudHMucHJvdGVjdEJyb3dzZXJFdmVudEVudHJ5UG9pbnQgPSBmdW5jdGlvbihlcnJvckhhbmRsZXIpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBnb29nLmV2ZW50cy5oYW5kbGVCcm93c2VyRXZlbnRfID1cbiAgICAgIGVycm9ySGFuZGxlci5wcm90ZWN0RW50cnlQb2ludChnb29nLmV2ZW50cy5oYW5kbGVCcm93c2VyRXZlbnRfKTtcbn07XG5cblxuLyoqXG4gKiBIYW5kbGVzIGFuIGV2ZW50IGFuZCBkaXNwYXRjaGVzIGl0IHRvIHRoZSBjb3JyZWN0IGxpc3RlbmVycy4gVGhpc1xuICogZnVuY3Rpb24gaXMgYSBwcm94eSBmb3IgdGhlIHJlYWwgbGlzdGVuZXIgdGhlIHVzZXIgc3BlY2lmaWVkLlxuICpcbiAqIEBwYXJhbSB7Z29vZy5ldmVudHMuTGlzdGVuZXJ9IGxpc3RlbmVyIFRoZSBsaXN0ZW5lciBvYmplY3QuXG4gKiBAcGFyYW0ge0V2ZW50PX0gb3B0X2V2dCBPcHRpb25hbCBldmVudCBvYmplY3QgdGhhdCBnZXRzIHBhc3NlZCBpbiB2aWEgdGhlXG4gKiAgICAgbmF0aXZlIGV2ZW50IGhhbmRsZXJzLlxuICogQHJldHVybiB7Kn0gUmVzdWx0IG9mIHRoZSBldmVudCBoYW5kbGVyLlxuICogQHRoaXMge0V2ZW50VGFyZ2V0fSBUaGUgb2JqZWN0IG9yIEVsZW1lbnQgdGhhdCBmaXJlZCB0aGUgZXZlbnQuXG4gKiBAcHJpdmF0ZVxuICovXG5nb29nLmV2ZW50cy5oYW5kbGVCcm93c2VyRXZlbnRfID0gZnVuY3Rpb24obGlzdGVuZXIsIG9wdF9ldnQpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBpZiAobGlzdGVuZXIucmVtb3ZlZCkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgLy8gU3ludGhlc2l6ZSBldmVudCBwcm9wYWdhdGlvbiBpZiB0aGUgYnJvd3NlciBkb2VzIG5vdCBzdXBwb3J0IFczQ1xuICAvLyBldmVudCBtb2RlbC5cbiAgaWYgKCFnb29nLmV2ZW50cy5Ccm93c2VyRmVhdHVyZS5IQVNfVzNDX0VWRU5UX1NVUFBPUlQpIHtcbiAgICB2YXIgaWVFdmVudCA9IG9wdF9ldnQgfHxcbiAgICAgICAgLyoqIEB0eXBlIHtFdmVudH0gKi8gKGdvb2cuZ2V0T2JqZWN0QnlOYW1lKCd3aW5kb3cuZXZlbnQnKSk7XG4gICAgdmFyIGV2dCA9IG5ldyBnb29nLmV2ZW50cy5Ccm93c2VyRXZlbnQoaWVFdmVudCwgdGhpcyk7XG4gICAgLyoqIEB0eXBlIHsqfSAqL1xuICAgIHZhciByZXR2YWwgPSB0cnVlO1xuXG4gICAgaWYgKGdvb2cuZXZlbnRzLkNBUFRVUkVfU0lNVUxBVElPTl9NT0RFID09XG4gICAgICAgIGdvb2cuZXZlbnRzLkNhcHR1cmVTaW11bGF0aW9uTW9kZS5PTikge1xuICAgICAgLy8gSWYgd2UgaGF2ZSBub3QgbWFya2VkIHRoaXMgZXZlbnQgeWV0LCB3ZSBzaG91bGQgcGVyZm9ybSBjYXB0dXJlXG4gICAgICAvLyBzaW11bGF0aW9uLlxuICAgICAgaWYgKCFnb29nLmV2ZW50cy5pc01hcmtlZEllRXZlbnRfKGllRXZlbnQpKSB7XG4gICAgICAgIGdvb2cuZXZlbnRzLm1hcmtJZUV2ZW50XyhpZUV2ZW50KTtcblxuICAgICAgICB2YXIgYW5jZXN0b3JzID0gW107XG4gICAgICAgIGZvciAodmFyIHBhcmVudCA9IGV2dC5jdXJyZW50VGFyZ2V0OyBwYXJlbnQ7XG4gICAgICAgICAgICAgcGFyZW50ID0gcGFyZW50LnBhcmVudE5vZGUpIHtcbiAgICAgICAgICBhbmNlc3RvcnMucHVzaChwYXJlbnQpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gRmlyZSBjYXB0dXJlIGxpc3RlbmVycy5cbiAgICAgICAgdmFyIHR5cGUgPSBsaXN0ZW5lci50eXBlO1xuICAgICAgICBmb3IgKHZhciBpID0gYW5jZXN0b3JzLmxlbmd0aCAtIDE7XG4gICAgICAgICAgICAgIWV2dC5oYXNQcm9wYWdhdGlvblN0b3BwZWQoKSAmJiBpID49IDA7IGktLSkge1xuICAgICAgICAgIGV2dC5jdXJyZW50VGFyZ2V0ID0gYW5jZXN0b3JzW2ldO1xuICAgICAgICAgIHZhciByZXN1bHQgPVxuICAgICAgICAgICAgICBnb29nLmV2ZW50cy5maXJlTGlzdGVuZXJzXyhhbmNlc3RvcnNbaV0sIHR5cGUsIHRydWUsIGV2dCk7XG4gICAgICAgICAgcmV0dmFsID0gcmV0dmFsICYmIHJlc3VsdDtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEZpcmUgYnViYmxlIGxpc3RlbmVycy5cbiAgICAgICAgLy9cbiAgICAgICAgLy8gV2UgY2FuIHRlY2huaWNhbGx5IHJlbHkgb24gSUUgdG8gcGVyZm9ybSBidWJibGUgZXZlbnRcbiAgICAgICAgLy8gcHJvcGFnYXRpb24uIEhvd2V2ZXIsIGl0IHR1cm5zIG91dCB0aGF0IElFIGZpcmVzIGV2ZW50cyBpblxuICAgICAgICAvLyBvcHBvc2l0ZSBvcmRlciBvZiBhdHRhY2hFdmVudCByZWdpc3RyYXRpb24sIHdoaWNoIGJyb2tlXG4gICAgICAgIC8vIHNvbWUgY29kZSBhbmQgdGVzdHMgdGhhdCByZWx5IG9uIHRoZSBvcmRlci4gKFdoaWxlIFczQyBET01cbiAgICAgICAgLy8gTGV2ZWwgMiBFdmVudHMgVFIgbGVhdmVzIHRoZSBldmVudCBvcmRlcmluZyB1bnNwZWNpZmllZCxcbiAgICAgICAgLy8gbW9kZXJuIGJyb3dzZXJzIGFuZCBXM0MgRE9NIExldmVsIDMgRXZlbnRzIFdvcmtpbmcgRHJhZnRcbiAgICAgICAgLy8gYWN0dWFsbHkgc3BlY2lmeSB0aGUgb3JkZXIgYXMgdGhlIHJlZ2lzdHJhdGlvbiBvcmRlci4pXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyAhZXZ0Lmhhc1Byb3BhZ2F0aW9uU3RvcHBlZCgpICYmIGkgPCBhbmNlc3RvcnMubGVuZ3RoO1xuICAgICAgICAgICAgIGkrKykge1xuICAgICAgICAgIGV2dC5jdXJyZW50VGFyZ2V0ID0gYW5jZXN0b3JzW2ldO1xuICAgICAgICAgIHZhciByZXN1bHQgPVxuICAgICAgICAgICAgICBnb29nLmV2ZW50cy5maXJlTGlzdGVuZXJzXyhhbmNlc3RvcnNbaV0sIHR5cGUsIGZhbHNlLCBldnQpO1xuICAgICAgICAgIHJldHZhbCA9IHJldHZhbCAmJiByZXN1bHQ7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dmFsID0gZ29vZy5ldmVudHMuZmlyZUxpc3RlbmVyKGxpc3RlbmVyLCBldnQpO1xuICAgIH1cbiAgICByZXR1cm4gcmV0dmFsO1xuICB9XG5cbiAgLy8gT3RoZXJ3aXNlLCBzaW1wbHkgZmlyZSB0aGUgbGlzdGVuZXIuXG4gIHJldHVybiBnb29nLmV2ZW50cy5maXJlTGlzdGVuZXIoXG4gICAgICBsaXN0ZW5lciwgbmV3IGdvb2cuZXZlbnRzLkJyb3dzZXJFdmVudChvcHRfZXZ0LCB0aGlzKSk7XG59O1xuXG5cbi8qKlxuICogVGhpcyBpcyB1c2VkIHRvIG1hcmsgdGhlIElFIGV2ZW50IG9iamVjdCBzbyB3ZSBkbyBub3QgZG8gdGhlIENsb3N1cmUgcGFzc1xuICogdHdpY2UgZm9yIGEgYnViYmxpbmcgZXZlbnQuXG4gKiBAcGFyYW0ge0V2ZW50fSBlIFRoZSBJRSBicm93c2VyIGV2ZW50LlxuICogQHByaXZhdGVcbiAqL1xuZ29vZy5ldmVudHMubWFya0llRXZlbnRfID0gZnVuY3Rpb24oZSkge1xuICAndXNlIHN0cmljdCc7XG4gIC8vIE9ubHkgdGhlIGtleUNvZGUgYW5kIHRoZSByZXR1cm5WYWx1ZSBjYW4gYmUgY2hhbmdlZC4gV2UgdXNlIGtleUNvZGUgZm9yXG4gIC8vIG5vbiBrZXlib2FyZCBldmVudHMuXG4gIC8vIGV2ZW50LnJldHVyblZhbHVlIGlzIGEgYml0IG1vcmUgdHJpY2t5LiBJdCBpcyB1bmRlZmluZWQgYnkgZGVmYXVsdC4gQVxuICAvLyBib29sZWFuIGZhbHNlIHByZXZlbnRzIHRoZSBkZWZhdWx0IGFjdGlvbi4gSW4gYSB3aW5kb3cub25iZWZvcmV1bmxvYWQgYW5kXG4gIC8vIHRoZSByZXR1cm5WYWx1ZSBpcyBub24gdW5kZWZpbmVkIGl0IHdpbGwgYmUgYWxlcnRlZC4gSG93ZXZlciwgd2Ugd2lsbCBvbmx5XG4gIC8vIG1vZGlmeSB0aGUgcmV0dXJuVmFsdWUgZm9yIGtleWJvYXJkIGV2ZW50cy4gV2UgY2FuIGdldCBhIHByb2JsZW0gaWYgbm9uXG4gIC8vIGNsb3N1cmUgZXZlbnRzIHNldHMgdGhlIGtleUNvZGUgb3IgdGhlIHJldHVyblZhbHVlXG5cbiAgdmFyIHVzZVJldHVyblZhbHVlID0gZmFsc2U7XG5cbiAgaWYgKGUua2V5Q29kZSA9PSAwKSB7XG4gICAgLy8gV2UgY2Fubm90IGNoYW5nZSB0aGUga2V5Q29kZSBpbiBjYXNlIHRoYXQgc3JjRWxlbWVudCBpcyBpbnB1dFt0eXBlPWZpbGVdLlxuICAgIC8vIFdlIGNvdWxkIHRlc3QgdGhhdCB0aGF0IGlzIHRoZSBjYXNlIGJ1dCB0aGF0IHdvdWxkIGFsbG9jYXRlIDMgb2JqZWN0cy5cbiAgICAvLyBJZiB3ZSB1c2UgdHJ5L2NhdGNoIHdlIHdpbGwgb25seSBhbGxvY2F0ZSBleHRyYSBvYmplY3RzIGluIHRoZSBjYXNlIG9mIGFcbiAgICAvLyBmYWlsdXJlLlxuXG4gICAgdHJ5IHtcbiAgICAgIGUua2V5Q29kZSA9IC0xO1xuICAgICAgcmV0dXJuO1xuICAgIH0gY2F0Y2ggKGV4KSB7XG4gICAgICB1c2VSZXR1cm5WYWx1ZSA9IHRydWU7XG4gICAgfVxuICB9XG5cbiAgaWYgKHVzZVJldHVyblZhbHVlIHx8XG4gICAgICAvKiogQHR5cGUge2Jvb2xlYW58dW5kZWZpbmVkfSAqLyAoZS5yZXR1cm5WYWx1ZSkgPT0gdW5kZWZpbmVkKSB7XG4gICAgZS5yZXR1cm5WYWx1ZSA9IHRydWU7XG4gIH1cbn07XG5cblxuLyoqXG4gKiBUaGlzIGlzIHVzZWQgdG8gY2hlY2sgaWYgYW4gSUUgZXZlbnQgaGFzIGFscmVhZHkgYmVlbiBoYW5kbGVkIGJ5IHRoZSBDbG9zdXJlXG4gKiBzeXN0ZW0gc28gd2UgZG8gbm90IGRvIHRoZSBDbG9zdXJlIHBhc3MgdHdpY2UgZm9yIGEgYnViYmxpbmcgZXZlbnQuXG4gKiBAcGFyYW0ge0V2ZW50fSBlICBUaGUgSUUgYnJvd3NlciBldmVudC5cbiAqIEByZXR1cm4ge2Jvb2xlYW59IFRydWUgaWYgdGhlIGV2ZW50IG9iamVjdCBoYXMgYmVlbiBtYXJrZWQuXG4gKiBAcHJpdmF0ZVxuICovXG5nb29nLmV2ZW50cy5pc01hcmtlZEllRXZlbnRfID0gZnVuY3Rpb24oZSkge1xuICAndXNlIHN0cmljdCc7XG4gIHJldHVybiBlLmtleUNvZGUgPCAwIHx8IGUucmV0dXJuVmFsdWUgIT0gdW5kZWZpbmVkO1xufTtcblxuXG4vKipcbiAqIENvdW50ZXIgdG8gY3JlYXRlIHVuaXF1ZSBldmVudCBpZHMuXG4gKiBAcHJpdmF0ZSB7bnVtYmVyfVxuICovXG5nb29nLmV2ZW50cy51bmlxdWVJZENvdW50ZXJfID0gMDtcblxuXG4vKipcbiAqIENyZWF0ZXMgYSB1bmlxdWUgZXZlbnQgaWQuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IGlkZW50aWZpZXIgVGhlIGlkZW50aWZpZXIuXG4gKiBAcmV0dXJuIHtzdHJpbmd9IEEgdW5pcXVlIGlkZW50aWZpZXIuXG4gKiBAaWRHZW5lcmF0b3Ige3VuaXF1ZX1cbiAqL1xuZ29vZy5ldmVudHMuZ2V0VW5pcXVlSWQgPSBmdW5jdGlvbihpZGVudGlmaWVyKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmV0dXJuIGlkZW50aWZpZXIgKyAnXycgKyBnb29nLmV2ZW50cy51bmlxdWVJZENvdW50ZXJfKys7XG59O1xuXG5cbi8qKlxuICogQHBhcmFtIHtFdmVudFRhcmdldH0gc3JjIFRoZSBzb3VyY2Ugb2JqZWN0LlxuICogQHJldHVybiB7Z29vZy5ldmVudHMuTGlzdGVuZXJNYXB9IEEgbGlzdGVuZXIgbWFwIGZvciB0aGUgZ2l2ZW5cbiAqICAgICBzb3VyY2Ugb2JqZWN0LCBvciBudWxsIGlmIG5vbmUgZXhpc3RzLlxuICogQHByaXZhdGVcbiAqL1xuZ29vZy5ldmVudHMuZ2V0TGlzdGVuZXJNYXBfID0gZnVuY3Rpb24oc3JjKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgdmFyIGxpc3RlbmVyTWFwID0gc3JjW2dvb2cuZXZlbnRzLkxJU1RFTkVSX01BUF9QUk9QX107XG4gIC8vIElFIHNlcmlhbGl6ZXMgdGhlIHByb3BlcnR5IGFzIHdlbGwgKGUuZy4gd2hlbiBzZXJpYWxpemluZyBvdXRlclxuICAvLyBIVE1MKS4gU28gd2UgbXVzdCBjaGVjayB0aGF0IHRoZSB2YWx1ZSBpcyBvZiB0aGUgY29ycmVjdCB0eXBlLlxuICByZXR1cm4gbGlzdGVuZXJNYXAgaW5zdGFuY2VvZiBnb29nLmV2ZW50cy5MaXN0ZW5lck1hcCA/IGxpc3RlbmVyTWFwIDogbnVsbDtcbn07XG5cblxuLyoqXG4gKiBFeHBhbmRvIHByb3BlcnR5IGZvciBsaXN0ZW5lciBmdW5jdGlvbiB3cmFwcGVyIGZvciBPYmplY3Qgd2l0aFxuICogaGFuZGxlRXZlbnQuXG4gKiBAcHJpdmF0ZSBAY29uc3Qge3N0cmluZ31cbiAqL1xuZ29vZy5ldmVudHMuTElTVEVORVJfV1JBUFBFUl9QUk9QXyA9XG4gICAgJ19fY2xvc3VyZV9ldmVudHNfZm5fJyArICgoTWF0aC5yYW5kb20oKSAqIDFlOSkgPj4+IDApO1xuXG5cbi8qKlxuICogQHBhcmFtIHtPYmplY3R8RnVuY3Rpb259IGxpc3RlbmVyIFRoZSBsaXN0ZW5lciBmdW5jdGlvbiBvciBhblxuICogICAgIG9iamVjdCB0aGF0IGNvbnRhaW5zIGhhbmRsZUV2ZW50IG1ldGhvZC5cbiAqIEByZXR1cm4geyFGdW5jdGlvbn0gRWl0aGVyIHRoZSBvcmlnaW5hbCBmdW5jdGlvbiBvciBhIGZ1bmN0aW9uIHRoYXRcbiAqICAgICBjYWxscyBvYmouaGFuZGxlRXZlbnQuIElmIHRoZSBzYW1lIGxpc3RlbmVyIGlzIHBhc3NlZCB0byB0aGlzXG4gKiAgICAgZnVuY3Rpb24gbW9yZSB0aGFuIG9uY2UsIHRoZSBzYW1lIGZ1bmN0aW9uIGlzIGd1YXJhbnRlZWQgdG8gYmVcbiAqICAgICByZXR1cm5lZC5cbiAqL1xuZ29vZy5ldmVudHMud3JhcExpc3RlbmVyID0gZnVuY3Rpb24obGlzdGVuZXIpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBnb29nLmFzc2VydHMuYXNzZXJ0KGxpc3RlbmVyLCAnTGlzdGVuZXIgY2FuIG5vdCBiZSBudWxsLicpO1xuXG4gIGlmICh0eXBlb2YgbGlzdGVuZXIgPT09ICdmdW5jdGlvbicpIHtcbiAgICByZXR1cm4gbGlzdGVuZXI7XG4gIH1cblxuICBnb29nLmFzc2VydHMuYXNzZXJ0KFxuICAgICAgbGlzdGVuZXIuaGFuZGxlRXZlbnQsICdBbiBvYmplY3QgbGlzdGVuZXIgbXVzdCBoYXZlIGhhbmRsZUV2ZW50IG1ldGhvZC4nKTtcbiAgaWYgKCFsaXN0ZW5lcltnb29nLmV2ZW50cy5MSVNURU5FUl9XUkFQUEVSX1BST1BfXSkge1xuICAgIGxpc3RlbmVyW2dvb2cuZXZlbnRzLkxJU1RFTkVSX1dSQVBQRVJfUFJPUF9dID0gZnVuY3Rpb24oZSkge1xuICAgICAgJ3VzZSBzdHJpY3QnO1xuICAgICAgcmV0dXJuIC8qKiBAdHlwZSB7P30gKi8gKGxpc3RlbmVyKS5oYW5kbGVFdmVudChlKTtcbiAgICB9O1xuICB9XG4gIHJldHVybiBsaXN0ZW5lcltnb29nLmV2ZW50cy5MSVNURU5FUl9XUkFQUEVSX1BST1BfXTtcbn07XG5cblxuLy8gUmVnaXN0ZXIgdGhlIGJyb3dzZXIgZXZlbnQgaGFuZGxlciBhcyBhbiBlbnRyeSBwb2ludCwgc28gdGhhdFxuLy8gaXQgY2FuIGJlIG1vbml0b3JlZCBmb3IgZXhjZXB0aW9uIGhhbmRsaW5nLCBldGMuXG5nb29nLmRlYnVnLmVudHJ5UG9pbnRSZWdpc3RyeS5yZWdpc3RlcihcbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge2Z1bmN0aW9uKCFGdW5jdGlvbik6ICFGdW5jdGlvbn0gdHJhbnNmb3JtZXIgVGhlIHRyYW5zZm9ybWluZ1xuICAgICAqICAgICBmdW5jdGlvbi5cbiAgICAgKi9cbiAgICBmdW5jdGlvbih0cmFuc2Zvcm1lcikge1xuICAgICAgJ3VzZSBzdHJpY3QnO1xuICAgICAgZ29vZy5ldmVudHMuaGFuZGxlQnJvd3NlckV2ZW50XyA9XG4gICAgICAgICAgdHJhbnNmb3JtZXIoZ29vZy5ldmVudHMuaGFuZGxlQnJvd3NlckV2ZW50Xyk7XG4gICAgfSk7XG4iLCAiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IFRoZSBDbG9zdXJlIExpYnJhcnkgQXV0aG9ycy5cbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBAZmlsZW92ZXJ2aWV3IEEgZGlzcG9zYWJsZSBpbXBsZW1lbnRhdGlvbiBvZiBhIGN1c3RvbVxuICogbGlzdGVuYWJsZS9ldmVudCB0YXJnZXQuIFNlZSBhbHNvOiBkb2N1bWVudGF0aW9uIGZvclxuICogYGdvb2cuZXZlbnRzLkxpc3RlbmFibGVgLlxuICpcbiAqIEBzZWUgLi4vZGVtb3MvZXZlbnR0YXJnZXQuaHRtbFxuICogQHNlZSBnb29nLmV2ZW50cy5MaXN0ZW5hYmxlXG4gKi9cblxuZ29vZy5wcm92aWRlKCdnb29nLmV2ZW50cy5FdmVudFRhcmdldCcpO1xuXG5nb29nLnJlcXVpcmUoJ2dvb2cuRGlzcG9zYWJsZScpO1xuZ29vZy5yZXF1aXJlKCdnb29nLmFzc2VydHMnKTtcbmdvb2cucmVxdWlyZSgnZ29vZy5ldmVudHMnKTtcbmdvb2cucmVxdWlyZSgnZ29vZy5ldmVudHMuRXZlbnQnKTtcbmdvb2cucmVxdWlyZSgnZ29vZy5ldmVudHMuTGlzdGVuYWJsZScpO1xuZ29vZy5yZXF1aXJlKCdnb29nLmV2ZW50cy5MaXN0ZW5lck1hcCcpO1xuZ29vZy5yZXF1aXJlKCdnb29nLm9iamVjdCcpO1xuZ29vZy5yZXF1aXJlVHlwZSgnZ29vZy5ldmVudHMuRXZlbnRJZCcpO1xuZ29vZy5yZXF1aXJlVHlwZSgnZ29vZy5ldmVudHMuRXZlbnRMaWtlJyk7XG5nb29nLnJlcXVpcmVUeXBlKCdnb29nLmV2ZW50cy5MaXN0ZW5hYmxlS2V5Jyk7XG5cblxuXG4vKipcbiAqIEFuIGltcGxlbWVudGF0aW9uIG9mIGBnb29nLmV2ZW50cy5MaXN0ZW5hYmxlYCB3aXRoIGZ1bGwgVzNDXG4gKiBFdmVudFRhcmdldC1saWtlIHN1cHBvcnQgKGNhcHR1cmUvYnViYmxlIG1lY2hhbmlzbSwgc3RvcHBpbmcgZXZlbnRcbiAqIHByb3BhZ2F0aW9uLCBwcmV2ZW50aW5nIGRlZmF1bHQgYWN0aW9ucykuXG4gKlxuICogWW91IG1heSBzdWJjbGFzcyB0aGlzIGNsYXNzIHRvIHR1cm4geW91ciBjbGFzcyBpbnRvIGEgTGlzdGVuYWJsZS5cbiAqXG4gKiBVbmxlc3MgcHJvcGFnYXRpb24gaXMgc3RvcHBlZCwgYW4gZXZlbnQgZGlzcGF0Y2hlZCBieSBhblxuICogRXZlbnRUYXJnZXQgd2lsbCBidWJibGUgdG8gdGhlIHBhcmVudCByZXR1cm5lZCBieVxuICogYGdldFBhcmVudEV2ZW50VGFyZ2V0YC4gVG8gc2V0IHRoZSBwYXJlbnQsIGNhbGxcbiAqIGBzZXRQYXJlbnRFdmVudFRhcmdldGAuIFN1YmNsYXNzZXMgdGhhdCBkb24ndCBzdXBwb3J0XG4gKiBjaGFuZ2luZyB0aGUgcGFyZW50IGNhbiBvdmVycmlkZSB0aGUgc2V0dGVyIHRvIHRocm93IGFuIGVycm9yLlxuICpcbiAqIEV4YW1wbGUgdXNhZ2U6XG4gKiA8cHJlPlxuICogICB2YXIgc291cmNlID0gbmV3IGdvb2cuZXZlbnRzLkV2ZW50VGFyZ2V0KCk7XG4gKiAgIGZ1bmN0aW9uIGhhbmRsZUV2ZW50KGUpIHtcbiAqICAgICBhbGVydCgnVHlwZTogJyArIGUudHlwZSArICc7IFRhcmdldDogJyArIGUudGFyZ2V0KTtcbiAqICAgfVxuICogICBzb3VyY2UubGlzdGVuKCdmb28nLCBoYW5kbGVFdmVudCk7XG4gKiAgIC8vIE9yOiBnb29nLmV2ZW50cy5saXN0ZW4oc291cmNlLCAnZm9vJywgaGFuZGxlRXZlbnQpO1xuICogICAuLi5cbiAqICAgc291cmNlLmRpc3BhdGNoRXZlbnQoJ2ZvbycpOyAgLy8gd2lsbCBjYWxsIGhhbmRsZUV2ZW50XG4gKiAgIC4uLlxuICogICBzb3VyY2UudW5saXN0ZW4oJ2ZvbycsIGhhbmRsZUV2ZW50KTtcbiAqICAgLy8gT3I6IGdvb2cuZXZlbnRzLnVubGlzdGVuKHNvdXJjZSwgJ2ZvbycsIGhhbmRsZUV2ZW50KTtcbiAqIDwvcHJlPlxuICpcbiAqIEBjb25zdHJ1Y3RvclxuICogQGV4dGVuZHMge2dvb2cuRGlzcG9zYWJsZX1cbiAqIEBpbXBsZW1lbnRzIHtnb29nLmV2ZW50cy5MaXN0ZW5hYmxlfVxuICovXG5nb29nLmV2ZW50cy5FdmVudFRhcmdldCA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIGdvb2cuRGlzcG9zYWJsZS5jYWxsKHRoaXMpO1xuXG4gIC8qKlxuICAgKiBNYXBzIG9mIGV2ZW50IHR5cGUgdG8gYW4gYXJyYXkgb2YgbGlzdGVuZXJzLlxuICAgKiBAcHJpdmF0ZSB7IWdvb2cuZXZlbnRzLkxpc3RlbmVyTWFwfVxuICAgKi9cbiAgdGhpcy5ldmVudFRhcmdldExpc3RlbmVyc18gPSBuZXcgZ29vZy5ldmVudHMuTGlzdGVuZXJNYXAodGhpcyk7XG5cbiAgLyoqXG4gICAqIFRoZSBvYmplY3QgdG8gdXNlIGZvciBldmVudC50YXJnZXQuIFVzZWZ1bCB3aGVuIG1peGluZyBpbiBhblxuICAgKiBFdmVudFRhcmdldCB0byBhbm90aGVyIG9iamVjdC5cbiAgICogQHByaXZhdGUgeyFPYmplY3R9XG4gICAqL1xuICB0aGlzLmFjdHVhbEV2ZW50VGFyZ2V0XyA9IHRoaXM7XG5cbiAgLyoqXG4gICAqIFBhcmVudCBldmVudCB0YXJnZXQsIHVzZWQgZHVyaW5nIGV2ZW50IGJ1YmJsaW5nLlxuICAgKlxuICAgKiBUT0RPKGNocmlzaGVucnkpOiBDaGFuZ2UgdGhpcyB0byBnb29nLmV2ZW50cy5MaXN0ZW5hYmxlLiBUaGlzXG4gICAqIGN1cnJlbnRseSBicmVha3MgcGVvcGxlIHdobyBleHBlY3QgZ2V0UGFyZW50RXZlbnRUYXJnZXQgdG8gcmV0dXJuXG4gICAqIGdvb2cuZXZlbnRzLkV2ZW50VGFyZ2V0LlxuICAgKlxuICAgKiBAcHJpdmF0ZSB7P2dvb2cuZXZlbnRzLkV2ZW50VGFyZ2V0fVxuICAgKi9cbiAgdGhpcy5wYXJlbnRFdmVudFRhcmdldF8gPSBudWxsO1xufTtcbmdvb2cuaW5oZXJpdHMoZ29vZy5ldmVudHMuRXZlbnRUYXJnZXQsIGdvb2cuRGlzcG9zYWJsZSk7XG5nb29nLmV2ZW50cy5MaXN0ZW5hYmxlLmFkZEltcGxlbWVudGF0aW9uKGdvb2cuZXZlbnRzLkV2ZW50VGFyZ2V0KTtcblxuXG4vKipcbiAqIEFuIGFydGlmaWNpYWwgY2FwIG9uIHRoZSBudW1iZXIgb2YgYW5jZXN0b3JzIHlvdSBjYW4gaGF2ZS4gVGhpcyBpcyBtYWlubHlcbiAqIGZvciBsb29wIGRldGVjdGlvbi5cbiAqIEBjb25zdCB7bnVtYmVyfVxuICogQHByaXZhdGVcbiAqL1xuZ29vZy5ldmVudHMuRXZlbnRUYXJnZXQuTUFYX0FOQ0VTVE9SU18gPSAxMDAwO1xuXG5cbi8qKlxuICogUmV0dXJucyB0aGUgcGFyZW50IG9mIHRoaXMgZXZlbnQgdGFyZ2V0IHRvIHVzZSBmb3IgYnViYmxpbmcuXG4gKlxuICogQHJldHVybiB7Z29vZy5ldmVudHMuRXZlbnRUYXJnZXR9IFRoZSBwYXJlbnQgRXZlbnRUYXJnZXQgb3IgbnVsbCBpZlxuICogICAgIHRoZXJlIGlzIG5vIHBhcmVudC5cbiAqIEBvdmVycmlkZVxuICovXG5nb29nLmV2ZW50cy5FdmVudFRhcmdldC5wcm90b3R5cGUuZ2V0UGFyZW50RXZlbnRUYXJnZXQgPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gdGhpcy5wYXJlbnRFdmVudFRhcmdldF87XG59O1xuXG5cbi8qKlxuICogU2V0cyB0aGUgcGFyZW50IG9mIHRoaXMgZXZlbnQgdGFyZ2V0IHRvIHVzZSBmb3IgY2FwdHVyZS9idWJibGVcbiAqIG1lY2hhbmlzbS5cbiAqIEBwYXJhbSB7Z29vZy5ldmVudHMuRXZlbnRUYXJnZXR9IHBhcmVudCBQYXJlbnQgbGlzdGVuYWJsZSAobnVsbCBpZiBub25lKS5cbiAqL1xuZ29vZy5ldmVudHMuRXZlbnRUYXJnZXQucHJvdG90eXBlLnNldFBhcmVudEV2ZW50VGFyZ2V0ID0gZnVuY3Rpb24ocGFyZW50KSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgdGhpcy5wYXJlbnRFdmVudFRhcmdldF8gPSBwYXJlbnQ7XG59O1xuXG5cbi8qKlxuICogQWRkcyBhbiBldmVudCBsaXN0ZW5lciB0byB0aGUgZXZlbnQgdGFyZ2V0LiBUaGUgc2FtZSBoYW5kbGVyIGNhbiBvbmx5IGJlXG4gKiBhZGRlZCBvbmNlIHBlciB0aGUgdHlwZS4gRXZlbiBpZiB5b3UgYWRkIHRoZSBzYW1lIGhhbmRsZXIgbXVsdGlwbGUgdGltZXNcbiAqIHVzaW5nIHRoZSBzYW1lIHR5cGUgdGhlbiBpdCB3aWxsIG9ubHkgYmUgY2FsbGVkIG9uY2Ugd2hlbiB0aGUgZXZlbnQgaXNcbiAqIGRpc3BhdGNoZWQuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd8IWdvb2cuZXZlbnRzLkV2ZW50SWR9IHR5cGUgVGhlIHR5cGUgb2YgdGhlIGV2ZW50IHRvIGxpc3RlbiBmb3JcbiAqIEBwYXJhbSB7ZnVuY3Rpb24oPyk6P3x7aGFuZGxlRXZlbnQ6ZnVuY3Rpb24oPyk6P318bnVsbH0gaGFuZGxlciBUaGUgZnVuY3Rpb25cbiAqICAgICB0byBoYW5kbGUgdGhlIGV2ZW50LiBUaGUgaGFuZGxlciBjYW4gYWxzbyBiZSBhbiBvYmplY3QgdGhhdCBpbXBsZW1lbnRzXG4gKiAgICAgdGhlIGhhbmRsZUV2ZW50IG1ldGhvZCB3aGljaCB0YWtlcyB0aGUgZXZlbnQgb2JqZWN0IGFzIGFyZ3VtZW50LlxuICogQHBhcmFtIHtib29sZWFuPX0gb3B0X2NhcHR1cmUgSW4gRE9NLWNvbXBsaWFudCBicm93c2VycywgdGhpcyBkZXRlcm1pbmVzXG4gKiAgICAgd2hldGhlciB0aGUgbGlzdGVuZXIgaXMgZmlyZWQgZHVyaW5nIHRoZSBjYXB0dXJlIG9yIGJ1YmJsZSBwaGFzZVxuICogICAgIG9mIHRoZSBldmVudC5cbiAqIEBwYXJhbSB7T2JqZWN0PX0gb3B0X2hhbmRsZXJTY29wZSBPYmplY3QgaW4gd2hvc2Ugc2NvcGUgdG8gY2FsbFxuICogICAgIHRoZSBsaXN0ZW5lci5cbiAqIEBkZXByZWNhdGVkIFVzZSBgI2xpc3RlbmAgaW5zdGVhZCwgd2hlbiBwb3NzaWJsZS4gT3RoZXJ3aXNlLCB1c2VcbiAqICAgICBgZ29vZy5ldmVudHMubGlzdGVuYCBpZiB5b3UgYXJlIHBhc3NpbmcgT2JqZWN0XG4gKiAgICAgKGluc3RlYWQgb2YgRnVuY3Rpb24pIGFzIGhhbmRsZXIuXG4gKi9cbmdvb2cuZXZlbnRzLkV2ZW50VGFyZ2V0LnByb3RvdHlwZS5hZGRFdmVudExpc3RlbmVyID0gZnVuY3Rpb24oXG4gICAgdHlwZSwgaGFuZGxlciwgb3B0X2NhcHR1cmUsIG9wdF9oYW5kbGVyU2NvcGUpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBnb29nLmV2ZW50cy5saXN0ZW4odGhpcywgdHlwZSwgaGFuZGxlciwgb3B0X2NhcHR1cmUsIG9wdF9oYW5kbGVyU2NvcGUpO1xufTtcblxuXG4vKipcbiAqIFJlbW92ZXMgYW4gZXZlbnQgbGlzdGVuZXIgZnJvbSB0aGUgZXZlbnQgdGFyZ2V0LiBUaGUgaGFuZGxlciBtdXN0IGJlIHRoZVxuICogc2FtZSBvYmplY3QgYXMgdGhlIG9uZSBhZGRlZC4gSWYgdGhlIGhhbmRsZXIgaGFzIG5vdCBiZWVuIGFkZGVkIHRoZW5cbiAqIG5vdGhpbmcgaXMgZG9uZS5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ3whZ29vZy5ldmVudHMuRXZlbnRJZH0gdHlwZSBUaGUgdHlwZSBvZiB0aGUgZXZlbnQgdG8gbGlzdGVuIGZvclxuICogQHBhcmFtIHtmdW5jdGlvbig/KTo/fHtoYW5kbGVFdmVudDpmdW5jdGlvbig/KTo/fXxudWxsfSBoYW5kbGVyIFRoZSBmdW5jdGlvblxuICogICAgIHRvIGhhbmRsZSB0aGUgZXZlbnQuIFRoZSBoYW5kbGVyIGNhbiBhbHNvIGJlIGFuIG9iamVjdCB0aGF0IGltcGxlbWVudHNcbiAqICAgICB0aGUgaGFuZGxlRXZlbnQgbWV0aG9kIHdoaWNoIHRha2VzIHRoZSBldmVudCBvYmplY3QgYXMgYXJndW1lbnQuXG4gKiBAcGFyYW0ge2Jvb2xlYW49fSBvcHRfY2FwdHVyZSBJbiBET00tY29tcGxpYW50IGJyb3dzZXJzLCB0aGlzIGRldGVybWluZXNcbiAqICAgICB3aGV0aGVyIHRoZSBsaXN0ZW5lciBpcyBmaXJlZCBkdXJpbmcgdGhlIGNhcHR1cmUgb3IgYnViYmxlIHBoYXNlXG4gKiAgICAgb2YgdGhlIGV2ZW50LlxuICogQHBhcmFtIHtPYmplY3Q9fSBvcHRfaGFuZGxlclNjb3BlIE9iamVjdCBpbiB3aG9zZSBzY29wZSB0byBjYWxsXG4gKiAgICAgdGhlIGxpc3RlbmVyLlxuICogQGRlcHJlY2F0ZWQgVXNlIGAjdW5saXN0ZW5gIGluc3RlYWQsIHdoZW4gcG9zc2libGUuIE90aGVyd2lzZSwgdXNlXG4gKiAgICAgYGdvb2cuZXZlbnRzLnVubGlzdGVuYCBpZiB5b3UgYXJlIHBhc3NpbmcgT2JqZWN0XG4gKiAgICAgKGluc3RlYWQgb2YgRnVuY3Rpb24pIGFzIGhhbmRsZXIuXG4gKi9cbmdvb2cuZXZlbnRzLkV2ZW50VGFyZ2V0LnByb3RvdHlwZS5yZW1vdmVFdmVudExpc3RlbmVyID0gZnVuY3Rpb24oXG4gICAgdHlwZSwgaGFuZGxlciwgb3B0X2NhcHR1cmUsIG9wdF9oYW5kbGVyU2NvcGUpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBnb29nLmV2ZW50cy51bmxpc3Rlbih0aGlzLCB0eXBlLCBoYW5kbGVyLCBvcHRfY2FwdHVyZSwgb3B0X2hhbmRsZXJTY29wZSk7XG59O1xuXG5cbi8qKlxuICogQHBhcmFtIHs/Z29vZy5ldmVudHMuRXZlbnRMaWtlfSBlIEV2ZW50IG9iamVjdC5cbiAqIEByZXR1cm4ge2Jvb2xlYW59IElmIGFueW9uZSBjYWxsZWQgcHJldmVudERlZmF1bHQgb24gdGhlIGV2ZW50IG9iamVjdCAob3JcbiAqICAgICBpZiBhbnkgb2YgdGhlIGxpc3RlbmVycyByZXR1cm5zIGZhbHNlKSB0aGlzIHdpbGwgYWxzbyByZXR1cm4gZmFsc2UuXG4gKiBAb3ZlcnJpZGVcbiAqL1xuZ29vZy5ldmVudHMuRXZlbnRUYXJnZXQucHJvdG90eXBlLmRpc3BhdGNoRXZlbnQgPSBmdW5jdGlvbihlKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgdGhpcy5hc3NlcnRJbml0aWFsaXplZF8oKTtcblxuICB2YXIgYW5jZXN0b3JzVHJlZSwgYW5jZXN0b3IgPSB0aGlzLmdldFBhcmVudEV2ZW50VGFyZ2V0KCk7XG4gIGlmIChhbmNlc3Rvcikge1xuICAgIGFuY2VzdG9yc1RyZWUgPSBbXTtcbiAgICB2YXIgYW5jZXN0b3JDb3VudCA9IDE7XG4gICAgZm9yICg7IGFuY2VzdG9yOyBhbmNlc3RvciA9IGFuY2VzdG9yLmdldFBhcmVudEV2ZW50VGFyZ2V0KCkpIHtcbiAgICAgIGFuY2VzdG9yc1RyZWUucHVzaChhbmNlc3Rvcik7XG4gICAgICBnb29nLmFzc2VydHMuYXNzZXJ0KFxuICAgICAgICAgICgrK2FuY2VzdG9yQ291bnQgPCBnb29nLmV2ZW50cy5FdmVudFRhcmdldC5NQVhfQU5DRVNUT1JTXyksXG4gICAgICAgICAgJ2luZmluaXRlIGxvb3AnKTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gZ29vZy5ldmVudHMuRXZlbnRUYXJnZXQuZGlzcGF0Y2hFdmVudEludGVybmFsXyhcbiAgICAgIHRoaXMuYWN0dWFsRXZlbnRUYXJnZXRfLCBlLCBhbmNlc3RvcnNUcmVlKTtcbn07XG5cblxuLyoqXG4gKiBSZW1vdmVzIGxpc3RlbmVycyBmcm9tIHRoaXMgb2JqZWN0LiAgQ2xhc3NlcyB0aGF0IGV4dGVuZCBFdmVudFRhcmdldCBtYXlcbiAqIG5lZWQgdG8gb3ZlcnJpZGUgdGhpcyBtZXRob2QgaW4gb3JkZXIgdG8gcmVtb3ZlIHJlZmVyZW5jZXMgdG8gRE9NIEVsZW1lbnRzXG4gKiBhbmQgYWRkaXRpb25hbCBsaXN0ZW5lcnMuXG4gKiBAb3ZlcnJpZGVcbiAqIEBwcm90ZWN0ZWRcbiAqL1xuZ29vZy5ldmVudHMuRXZlbnRUYXJnZXQucHJvdG90eXBlLmRpc3Bvc2VJbnRlcm5hbCA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIGdvb2cuZXZlbnRzLkV2ZW50VGFyZ2V0LnN1cGVyQ2xhc3NfLmRpc3Bvc2VJbnRlcm5hbC5jYWxsKHRoaXMpO1xuXG4gIHRoaXMucmVtb3ZlQWxsTGlzdGVuZXJzKCk7XG4gIHRoaXMucGFyZW50RXZlbnRUYXJnZXRfID0gbnVsbDtcbn07XG5cblxuLyoqXG4gKiBAcGFyYW0ge3N0cmluZ3whZ29vZy5ldmVudHMuRXZlbnRJZDxFVkVOVE9CSj59IHR5cGUgVGhlIGV2ZW50IHR5cGUgaWQuXG4gKiBAcGFyYW0ge2Z1bmN0aW9uKHRoaXM6U0NPUEUsIEVWRU5UT0JKKTooYm9vbGVhbnx1bmRlZmluZWQpfSBsaXN0ZW5lciBDYWxsYmFja1xuICogICAgIG1ldGhvZC5cbiAqIEBwYXJhbSB7Ym9vbGVhbj19IG9wdF91c2VDYXB0dXJlIFdoZXRoZXIgdG8gZmlyZSBpbiBjYXB0dXJlIHBoYXNlXG4gKiAgICAgKGRlZmF1bHRzIHRvIGZhbHNlKS5cbiAqIEBwYXJhbSB7U0NPUEU9fSBvcHRfbGlzdGVuZXJTY29wZSBPYmplY3QgaW4gd2hvc2Ugc2NvcGUgdG8gY2FsbCB0aGVcbiAqICAgICBsaXN0ZW5lci5cbiAqIEByZXR1cm4geyFnb29nLmV2ZW50cy5MaXN0ZW5hYmxlS2V5fSBVbmlxdWUga2V5IGZvciB0aGUgbGlzdGVuZXIuXG4gKiBAdGVtcGxhdGUgU0NPUEUsRVZFTlRPQkpcbiAqIEBvdmVycmlkZVxuICovXG5nb29nLmV2ZW50cy5FdmVudFRhcmdldC5wcm90b3R5cGUubGlzdGVuID0gZnVuY3Rpb24oXG4gICAgdHlwZSwgbGlzdGVuZXIsIG9wdF91c2VDYXB0dXJlLCBvcHRfbGlzdGVuZXJTY29wZSkge1xuICAndXNlIHN0cmljdCc7XG4gIHRoaXMuYXNzZXJ0SW5pdGlhbGl6ZWRfKCk7XG4gIHJldHVybiB0aGlzLmV2ZW50VGFyZ2V0TGlzdGVuZXJzXy5hZGQoXG4gICAgICBTdHJpbmcodHlwZSksIGxpc3RlbmVyLCBmYWxzZSAvKiBjYWxsT25jZSAqLywgb3B0X3VzZUNhcHR1cmUsXG4gICAgICBvcHRfbGlzdGVuZXJTY29wZSk7XG59O1xuXG5cbi8qKlxuICogQHBhcmFtIHtzdHJpbmd8IWdvb2cuZXZlbnRzLkV2ZW50SWQ8RVZFTlRPQko+fSB0eXBlIFRoZSBldmVudCB0eXBlIGlkLlxuICogQHBhcmFtIHtmdW5jdGlvbih0aGlzOlNDT1BFLCBFVkVOVE9CSik6KGJvb2xlYW58dW5kZWZpbmVkKX0gbGlzdGVuZXIgQ2FsbGJhY2tcbiAqICAgICBtZXRob2QuXG4gKiBAcGFyYW0ge2Jvb2xlYW49fSBvcHRfdXNlQ2FwdHVyZSBXaGV0aGVyIHRvIGZpcmUgaW4gY2FwdHVyZSBwaGFzZVxuICogICAgIChkZWZhdWx0cyB0byBmYWxzZSkuXG4gKiBAcGFyYW0ge1NDT1BFPX0gb3B0X2xpc3RlbmVyU2NvcGUgT2JqZWN0IGluIHdob3NlIHNjb3BlIHRvIGNhbGwgdGhlXG4gKiAgICAgbGlzdGVuZXIuXG4gKiBAcmV0dXJuIHshZ29vZy5ldmVudHMuTGlzdGVuYWJsZUtleX0gVW5pcXVlIGtleSBmb3IgdGhlIGxpc3RlbmVyLlxuICogQHRlbXBsYXRlIFNDT1BFLEVWRU5UT0JKXG4gKiBAb3ZlcnJpZGVcbiAqL1xuZ29vZy5ldmVudHMuRXZlbnRUYXJnZXQucHJvdG90eXBlLmxpc3Rlbk9uY2UgPSBmdW5jdGlvbihcbiAgICB0eXBlLCBsaXN0ZW5lciwgb3B0X3VzZUNhcHR1cmUsIG9wdF9saXN0ZW5lclNjb3BlKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmV0dXJuIHRoaXMuZXZlbnRUYXJnZXRMaXN0ZW5lcnNfLmFkZChcbiAgICAgIFN0cmluZyh0eXBlKSwgbGlzdGVuZXIsIHRydWUgLyogY2FsbE9uY2UgKi8sIG9wdF91c2VDYXB0dXJlLFxuICAgICAgb3B0X2xpc3RlbmVyU2NvcGUpO1xufTtcblxuXG4vKipcbiAqIEBwYXJhbSB7c3RyaW5nfCFnb29nLmV2ZW50cy5FdmVudElkPEVWRU5UT0JKPn0gdHlwZSBUaGUgZXZlbnQgdHlwZSBpZC5cbiAqIEBwYXJhbSB7ZnVuY3Rpb24odGhpczpTQ09QRSwgRVZFTlRPQkopOihib29sZWFufHVuZGVmaW5lZCl9IGxpc3RlbmVyIENhbGxiYWNrXG4gKiAgICAgbWV0aG9kLlxuICogQHBhcmFtIHtib29sZWFuPX0gb3B0X3VzZUNhcHR1cmUgV2hldGhlciB0byBmaXJlIGluIGNhcHR1cmUgcGhhc2VcbiAqICAgICAoZGVmYXVsdHMgdG8gZmFsc2UpLlxuICogQHBhcmFtIHtTQ09QRT19IG9wdF9saXN0ZW5lclNjb3BlIE9iamVjdCBpbiB3aG9zZSBzY29wZSB0byBjYWxsXG4gKiAgICAgdGhlIGxpc3RlbmVyLlxuICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciBhbnkgbGlzdGVuZXIgd2FzIHJlbW92ZWQuXG4gKiBAdGVtcGxhdGUgU0NPUEUsRVZFTlRPQkpcbiAqIEBvdmVycmlkZVxuICovXG5nb29nLmV2ZW50cy5FdmVudFRhcmdldC5wcm90b3R5cGUudW5saXN0ZW4gPSBmdW5jdGlvbihcbiAgICB0eXBlLCBsaXN0ZW5lciwgb3B0X3VzZUNhcHR1cmUsIG9wdF9saXN0ZW5lclNjb3BlKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmV0dXJuIHRoaXMuZXZlbnRUYXJnZXRMaXN0ZW5lcnNfLnJlbW92ZShcbiAgICAgIFN0cmluZyh0eXBlKSwgbGlzdGVuZXIsIG9wdF91c2VDYXB0dXJlLCBvcHRfbGlzdGVuZXJTY29wZSk7XG59O1xuXG5cbi8qKlxuICogQHBhcmFtIHshZ29vZy5ldmVudHMuTGlzdGVuYWJsZUtleX0ga2V5IFRoZSBrZXkgcmV0dXJuZWQgYnlcbiAqICAgICBsaXN0ZW4oKSBvciBsaXN0ZW5PbmNlKCkuXG4gKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIGFueSBsaXN0ZW5lciB3YXMgcmVtb3ZlZC5cbiAqIEBvdmVycmlkZVxuICovXG5nb29nLmV2ZW50cy5FdmVudFRhcmdldC5wcm90b3R5cGUudW5saXN0ZW5CeUtleSA9IGZ1bmN0aW9uKGtleSkge1xuICAndXNlIHN0cmljdCc7XG4gIHJldHVybiB0aGlzLmV2ZW50VGFyZ2V0TGlzdGVuZXJzXy5yZW1vdmVCeUtleShrZXkpO1xufTtcblxuXG4vKipcbiAqIEBwYXJhbSB7c3RyaW5nfCFnb29nLmV2ZW50cy5FdmVudElkPX0gb3B0X3R5cGUgVHlwZSBvZiBldmVudCB0byByZW1vdmUsXG4gKiAgICAgZGVmYXVsdCBpcyB0byByZW1vdmUgYWxsIHR5cGVzLlxuICogQHJldHVybiB7bnVtYmVyfSBOdW1iZXIgb2YgbGlzdGVuZXJzIHJlbW92ZWQuXG4gKiBAb3ZlcnJpZGVcbiAqL1xuZ29vZy5ldmVudHMuRXZlbnRUYXJnZXQucHJvdG90eXBlLnJlbW92ZUFsbExpc3RlbmVycyA9IGZ1bmN0aW9uKG9wdF90eXBlKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgLy8gVE9ETyhjaHJpc2hlbnJ5KTogUHJldmlvdXNseSwgcmVtb3ZlQWxsTGlzdGVuZXJzIGNhbiBiZSBjYWxsZWQgb25cbiAgLy8gdW5pbml0aWFsaXplZCBFdmVudFRhcmdldCwgc28gd2UgcHJlc2VydmUgdGhhdCBiZWhhdmlvci4gV2VcbiAgLy8gc2hvdWxkIHJlbW92ZSB0aGlzIHdoZW4gdXNhZ2VzIHRoYXQgcmVseSBvbiB0aGF0IGZhY3QgYXJlIHB1cmdlZC5cbiAgaWYgKCF0aGlzLmV2ZW50VGFyZ2V0TGlzdGVuZXJzXykge1xuICAgIHJldHVybiAwO1xuICB9XG4gIHJldHVybiB0aGlzLmV2ZW50VGFyZ2V0TGlzdGVuZXJzXy5yZW1vdmVBbGwob3B0X3R5cGUpO1xufTtcblxuXG4vKipcbiAqIEBwYXJhbSB7c3RyaW5nfCFnb29nLmV2ZW50cy5FdmVudElkPEVWRU5UT0JKPn0gdHlwZSBUaGUgdHlwZSBvZiB0aGVcbiAqICAgICBsaXN0ZW5lcnMgdG8gZmlyZS5cbiAqIEBwYXJhbSB7Ym9vbGVhbn0gY2FwdHVyZSBUaGUgY2FwdHVyZSBtb2RlIG9mIHRoZSBsaXN0ZW5lcnMgdG8gZmlyZS5cbiAqIEBwYXJhbSB7RVZFTlRPQkp9IGV2ZW50T2JqZWN0IFRoZSBldmVudCBvYmplY3QgdG8gZmlyZS5cbiAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgYWxsIGxpc3RlbmVycyBzdWNjZWVkZWQgd2l0aG91dFxuICogICAgIGF0dGVtcHRpbmcgdG8gcHJldmVudCBkZWZhdWx0IGJlaGF2aW9yLiBJZiBhbnkgbGlzdGVuZXIgcmV0dXJuc1xuICogICAgIGZhbHNlIG9yIGNhbGxlZCBnb29nLmV2ZW50cy5FdmVudCNwcmV2ZW50RGVmYXVsdCwgdGhpcyByZXR1cm5zXG4gKiAgICAgZmFsc2UuXG4gKiBAdGVtcGxhdGUgRVZFTlRPQkpcbiAqIEBvdmVycmlkZVxuICovXG5nb29nLmV2ZW50cy5FdmVudFRhcmdldC5wcm90b3R5cGUuZmlyZUxpc3RlbmVycyA9IGZ1bmN0aW9uKFxuICAgIHR5cGUsIGNhcHR1cmUsIGV2ZW50T2JqZWN0KSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgLy8gVE9ETyhjaHJpc2hlbnJ5KTogT3JpZ2luYWwgY29kZSBhdm9pZHMgYXJyYXkgY3JlYXRpb24gd2hlbiB0aGVyZVxuICAvLyBpcyBubyBsaXN0ZW5lciwgc28gd2UgZG8gdGhlIHNhbWUuIElmIHRoaXMgb3B0aW1pemF0aW9uIHR1cm5zXG4gIC8vIG91dCB0byBiZSBub3QgcmVxdWlyZWQsIHdlIGNhbiByZXBsYWNlIHRoaXMgd2l0aFxuICAvLyBnZXRMaXN0ZW5lcnModHlwZSwgY2FwdHVyZSkgaW5zdGVhZCwgd2hpY2ggaXMgc2ltcGxlci5cbiAgdmFyIGxpc3RlbmVyQXJyYXkgPSB0aGlzLmV2ZW50VGFyZ2V0TGlzdGVuZXJzXy5saXN0ZW5lcnNbU3RyaW5nKHR5cGUpXTtcbiAgaWYgKCFsaXN0ZW5lckFycmF5KSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgbGlzdGVuZXJBcnJheSA9IGxpc3RlbmVyQXJyYXkuY29uY2F0KCk7XG5cbiAgdmFyIHJ2ID0gdHJ1ZTtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaXN0ZW5lckFycmF5Lmxlbmd0aDsgKytpKSB7XG4gICAgdmFyIGxpc3RlbmVyID0gbGlzdGVuZXJBcnJheVtpXTtcbiAgICAvLyBXZSBtaWdodCBub3QgaGF2ZSBhIGxpc3RlbmVyIGlmIHRoZSBsaXN0ZW5lciB3YXMgcmVtb3ZlZC5cbiAgICBpZiAobGlzdGVuZXIgJiYgIWxpc3RlbmVyLnJlbW92ZWQgJiYgbGlzdGVuZXIuY2FwdHVyZSA9PSBjYXB0dXJlKSB7XG4gICAgICB2YXIgbGlzdGVuZXJGbiA9IGxpc3RlbmVyLmxpc3RlbmVyO1xuICAgICAgdmFyIGxpc3RlbmVySGFuZGxlciA9IGxpc3RlbmVyLmhhbmRsZXIgfHwgbGlzdGVuZXIuc3JjO1xuXG4gICAgICBpZiAobGlzdGVuZXIuY2FsbE9uY2UpIHtcbiAgICAgICAgdGhpcy51bmxpc3RlbkJ5S2V5KGxpc3RlbmVyKTtcbiAgICAgIH1cbiAgICAgIHJ2ID0gbGlzdGVuZXJGbi5jYWxsKGxpc3RlbmVySGFuZGxlciwgZXZlbnRPYmplY3QpICE9PSBmYWxzZSAmJiBydjtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gcnYgJiYgIWV2ZW50T2JqZWN0LmRlZmF1bHRQcmV2ZW50ZWQ7XG59O1xuXG5cbi8qKlxuICogQHBhcmFtIHtzdHJpbmd8IWdvb2cuZXZlbnRzLkV2ZW50SWR9IHR5cGUgVGhlIHR5cGUgb2YgdGhlIGxpc3RlbmVycyB0byBmaXJlLlxuICogQHBhcmFtIHtib29sZWFufSBjYXB0dXJlIFRoZSBjYXB0dXJlIG1vZGUgb2YgdGhlIGxpc3RlbmVycyB0byBmaXJlLlxuICogQHJldHVybiB7IUFycmF5PCFnb29nLmV2ZW50cy5MaXN0ZW5hYmxlS2V5Pn0gQW4gYXJyYXkgb2YgcmVnaXN0ZXJlZFxuICogICAgIGxpc3RlbmVycy5cbiAqIEB0ZW1wbGF0ZSBFVkVOVE9CSlxuICogQG92ZXJyaWRlXG4gKi9cbmdvb2cuZXZlbnRzLkV2ZW50VGFyZ2V0LnByb3RvdHlwZS5nZXRMaXN0ZW5lcnMgPSBmdW5jdGlvbih0eXBlLCBjYXB0dXJlKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmV0dXJuIHRoaXMuZXZlbnRUYXJnZXRMaXN0ZW5lcnNfLmdldExpc3RlbmVycyhTdHJpbmcodHlwZSksIGNhcHR1cmUpO1xufTtcblxuXG4vKipcbiAqIEBwYXJhbSB7c3RyaW5nfCFnb29nLmV2ZW50cy5FdmVudElkPEVWRU5UT0JKPn0gdHlwZSBUaGUgbmFtZSBvZiB0aGUgZXZlbnRcbiAqICAgICB3aXRob3V0IHRoZSAnb24nIHByZWZpeC5cbiAqIEBwYXJhbSB7ZnVuY3Rpb24odGhpczpTQ09QRSwgRVZFTlRPQkopOihib29sZWFufHVuZGVmaW5lZCl9IGxpc3RlbmVyIFRoZVxuICogICAgIGxpc3RlbmVyIGZ1bmN0aW9uIHRvIGdldC5cbiAqIEBwYXJhbSB7Ym9vbGVhbn0gY2FwdHVyZSBXaGV0aGVyIHRoZSBsaXN0ZW5lciBpcyBhIGNhcHR1cmluZyBsaXN0ZW5lci5cbiAqIEBwYXJhbSB7U0NPUEU9fSBvcHRfbGlzdGVuZXJTY29wZSBPYmplY3QgaW4gd2hvc2Ugc2NvcGUgdG8gY2FsbCB0aGVcbiAqICAgICBsaXN0ZW5lci5cbiAqIEByZXR1cm4gez9nb29nLmV2ZW50cy5MaXN0ZW5hYmxlS2V5fSB0aGUgZm91bmQgbGlzdGVuZXIgb3IgbnVsbCBpZiBub3QgZm91bmQuXG4gKiBAdGVtcGxhdGUgU0NPUEUsRVZFTlRPQkpcbiAqIEBvdmVycmlkZVxuICovXG5nb29nLmV2ZW50cy5FdmVudFRhcmdldC5wcm90b3R5cGUuZ2V0TGlzdGVuZXIgPSBmdW5jdGlvbihcbiAgICB0eXBlLCBsaXN0ZW5lciwgY2FwdHVyZSwgb3B0X2xpc3RlbmVyU2NvcGUpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gdGhpcy5ldmVudFRhcmdldExpc3RlbmVyc18uZ2V0TGlzdGVuZXIoXG4gICAgICBTdHJpbmcodHlwZSksIGxpc3RlbmVyLCBjYXB0dXJlLCBvcHRfbGlzdGVuZXJTY29wZSk7XG59O1xuXG5cbi8qKlxuICogQHBhcmFtIHtzdHJpbmd8IWdvb2cuZXZlbnRzLkV2ZW50SWQ8RVZFTlRPQko+PX0gb3B0X3R5cGUgRXZlbnQgdHlwZS5cbiAqIEBwYXJhbSB7Ym9vbGVhbj19IG9wdF9jYXB0dXJlIFdoZXRoZXIgdG8gY2hlY2sgZm9yIGNhcHR1cmUgb3IgYnViYmxlXG4gKiAgICAgbGlzdGVuZXJzLlxuICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGVyZSBpcyBhbnkgYWN0aXZlIGxpc3RlbmVycyBtYXRjaGluZ1xuICogICAgIHRoZSByZXF1ZXN0ZWQgdHlwZSBhbmQvb3IgY2FwdHVyZSBwaGFzZS5cbiAqIEB0ZW1wbGF0ZSBFVkVOVE9CSlxuICogQG92ZXJyaWRlXG4gKi9cbmdvb2cuZXZlbnRzLkV2ZW50VGFyZ2V0LnByb3RvdHlwZS5oYXNMaXN0ZW5lciA9IGZ1bmN0aW9uKFxuICAgIG9wdF90eXBlLCBvcHRfY2FwdHVyZSkge1xuICAndXNlIHN0cmljdCc7XG4gIHZhciBpZCA9IChvcHRfdHlwZSAhPT0gdW5kZWZpbmVkKSA/IFN0cmluZyhvcHRfdHlwZSkgOiB1bmRlZmluZWQ7XG4gIHJldHVybiB0aGlzLmV2ZW50VGFyZ2V0TGlzdGVuZXJzXy5oYXNMaXN0ZW5lcihpZCwgb3B0X2NhcHR1cmUpO1xufTtcblxuXG4vKipcbiAqIFNldHMgdGhlIHRhcmdldCB0byBiZSB1c2VkIGZvciBgZXZlbnQudGFyZ2V0YCB3aGVuIGZpcmluZ1xuICogZXZlbnQuIE1haW5seSB1c2VkIGZvciB0ZXN0aW5nLiBGb3IgZXhhbXBsZSwgc2VlXG4gKiBgZ29vZy50ZXN0aW5nLmV2ZW50cy5taXhpbkxpc3RlbmFibGVgLlxuICogQHBhcmFtIHshT2JqZWN0fSB0YXJnZXQgVGhlIHRhcmdldC5cbiAqL1xuZ29vZy5ldmVudHMuRXZlbnRUYXJnZXQucHJvdG90eXBlLnNldFRhcmdldEZvclRlc3RpbmcgPSBmdW5jdGlvbih0YXJnZXQpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICB0aGlzLmFjdHVhbEV2ZW50VGFyZ2V0XyA9IHRhcmdldDtcbn07XG5cblxuLyoqXG4gKiBBc3NlcnRzIHRoYXQgdGhlIGV2ZW50IHRhcmdldCBpbnN0YW5jZSBpcyBpbml0aWFsaXplZCBwcm9wZXJseS5cbiAqIEBwcml2YXRlXG4gKi9cbmdvb2cuZXZlbnRzLkV2ZW50VGFyZ2V0LnByb3RvdHlwZS5hc3NlcnRJbml0aWFsaXplZF8gPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBnb29nLmFzc2VydHMuYXNzZXJ0KFxuICAgICAgdGhpcy5ldmVudFRhcmdldExpc3RlbmVyc18sXG4gICAgICAnRXZlbnQgdGFyZ2V0IGlzIG5vdCBpbml0aWFsaXplZC4gRGlkIHlvdSBjYWxsIHRoZSBzdXBlcmNsYXNzICcgK1xuICAgICAgICAgICcoZ29vZy5ldmVudHMuRXZlbnRUYXJnZXQpIGNvbnN0cnVjdG9yPycpO1xufTtcblxuXG4vKipcbiAqIERpc3BhdGNoZXMgdGhlIGdpdmVuIGV2ZW50IG9uIHRoZSBhbmNlc3RvcnNUcmVlLlxuICpcbiAqIEBwYXJhbSB7IU9iamVjdH0gdGFyZ2V0IFRoZSB0YXJnZXQgdG8gZGlzcGF0Y2ggb24uXG4gKiBAcGFyYW0ge2dvb2cuZXZlbnRzLkV2ZW50fE9iamVjdHxzdHJpbmd9IGUgVGhlIGV2ZW50IG9iamVjdC5cbiAqIEBwYXJhbSB7QXJyYXk8Z29vZy5ldmVudHMuTGlzdGVuYWJsZT49fSBvcHRfYW5jZXN0b3JzVHJlZSBUaGUgYW5jZXN0b3JzXG4gKiAgICAgdHJlZSBvZiB0aGUgdGFyZ2V0LCBpbiByZXZlcnNlIG9yZGVyIGZyb20gdGhlIGNsb3Nlc3QgYW5jZXN0b3JcbiAqICAgICB0byB0aGUgcm9vdCBldmVudCB0YXJnZXQuIE1heSBiZSBudWxsIGlmIHRoZSB0YXJnZXQgaGFzIG5vIGFuY2VzdG9yLlxuICogQHJldHVybiB7Ym9vbGVhbn0gSWYgYW55b25lIGNhbGxlZCBwcmV2ZW50RGVmYXVsdCBvbiB0aGUgZXZlbnQgb2JqZWN0IChvclxuICogICAgIGlmIGFueSBvZiB0aGUgbGlzdGVuZXJzIHJldHVybnMgZmFsc2UpIHRoaXMgd2lsbCBhbHNvIHJldHVybiBmYWxzZS5cbiAqIEBwcml2YXRlXG4gKi9cbmdvb2cuZXZlbnRzLkV2ZW50VGFyZ2V0LmRpc3BhdGNoRXZlbnRJbnRlcm5hbF8gPSBmdW5jdGlvbihcbiAgICB0YXJnZXQsIGUsIG9wdF9hbmNlc3RvcnNUcmVlKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgLyoqIEBzdXBwcmVzcyB7bWlzc2luZ1Byb3BlcnRpZXN9ICovXG4gIHZhciB0eXBlID0gZS50eXBlIHx8IC8qKiBAdHlwZSB7c3RyaW5nfSAqLyAoZSk7XG5cbiAgLy8gSWYgYWNjZXB0aW5nIGEgc3RyaW5nIG9yIG9iamVjdCwgY3JlYXRlIGEgY3VzdG9tIGV2ZW50IG9iamVjdCBzbyB0aGF0XG4gIC8vIHByZXZlbnREZWZhdWx0IGFuZCBzdG9wUHJvcGFnYXRpb24gd29yayB3aXRoIHRoZSBldmVudC5cbiAgaWYgKHR5cGVvZiBlID09PSAnc3RyaW5nJykge1xuICAgIGUgPSBuZXcgZ29vZy5ldmVudHMuRXZlbnQoZSwgdGFyZ2V0KTtcbiAgfSBlbHNlIGlmICghKGUgaW5zdGFuY2VvZiBnb29nLmV2ZW50cy5FdmVudCkpIHtcbiAgICB2YXIgb2xkRXZlbnQgPSBlO1xuICAgIGUgPSBuZXcgZ29vZy5ldmVudHMuRXZlbnQodHlwZSwgdGFyZ2V0KTtcbiAgICBnb29nLm9iamVjdC5leHRlbmQoZSwgb2xkRXZlbnQpO1xuICB9IGVsc2Uge1xuICAgIGUudGFyZ2V0ID0gZS50YXJnZXQgfHwgdGFyZ2V0O1xuICB9XG5cbiAgdmFyIHJ2ID0gdHJ1ZSwgY3VycmVudFRhcmdldDtcblxuICAvLyBFeGVjdXRlcyBhbGwgY2FwdHVyZSBsaXN0ZW5lcnMgb24gdGhlIGFuY2VzdG9ycywgaWYgYW55LlxuICBpZiAob3B0X2FuY2VzdG9yc1RyZWUpIHtcbiAgICBmb3IgKHZhciBpID0gb3B0X2FuY2VzdG9yc1RyZWUubGVuZ3RoIC0gMTtcbiAgICAgICAgICFlLmhhc1Byb3BhZ2F0aW9uU3RvcHBlZCgpICYmIGkgPj0gMDsgaS0tKSB7XG4gICAgICBjdXJyZW50VGFyZ2V0ID0gZS5jdXJyZW50VGFyZ2V0ID0gb3B0X2FuY2VzdG9yc1RyZWVbaV07XG4gICAgICBydiA9IGN1cnJlbnRUYXJnZXQuZmlyZUxpc3RlbmVycyh0eXBlLCB0cnVlLCBlKSAmJiBydjtcbiAgICB9XG4gIH1cblxuICAvLyBFeGVjdXRlcyBjYXB0dXJlIGFuZCBidWJibGUgbGlzdGVuZXJzIG9uIHRoZSB0YXJnZXQuXG4gIGlmICghZS5oYXNQcm9wYWdhdGlvblN0b3BwZWQoKSkge1xuICAgIGN1cnJlbnRUYXJnZXQgPSAvKiogQHR5cGUgez99ICovIChlLmN1cnJlbnRUYXJnZXQgPSB0YXJnZXQpO1xuICAgIHJ2ID0gY3VycmVudFRhcmdldC5maXJlTGlzdGVuZXJzKHR5cGUsIHRydWUsIGUpICYmIHJ2O1xuICAgIGlmICghZS5oYXNQcm9wYWdhdGlvblN0b3BwZWQoKSkge1xuICAgICAgcnYgPSBjdXJyZW50VGFyZ2V0LmZpcmVMaXN0ZW5lcnModHlwZSwgZmFsc2UsIGUpICYmIHJ2O1xuICAgIH1cbiAgfVxuXG4gIC8vIEV4ZWN1dGVzIGFsbCBidWJibGUgbGlzdGVuZXJzIG9uIHRoZSBhbmNlc3RvcnMsIGlmIGFueS5cbiAgaWYgKG9wdF9hbmNlc3RvcnNUcmVlKSB7XG4gICAgZm9yIChpID0gMDsgIWUuaGFzUHJvcGFnYXRpb25TdG9wcGVkKCkgJiYgaSA8IG9wdF9hbmNlc3RvcnNUcmVlLmxlbmd0aDtcbiAgICAgICAgIGkrKykge1xuICAgICAgY3VycmVudFRhcmdldCA9IGUuY3VycmVudFRhcmdldCA9IG9wdF9hbmNlc3RvcnNUcmVlW2ldO1xuICAgICAgcnYgPSBjdXJyZW50VGFyZ2V0LmZpcmVMaXN0ZW5lcnModHlwZSwgZmFsc2UsIGUpICYmIHJ2O1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBydjtcbn07XG4iLCAiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IFRoZSBDbG9zdXJlIExpYnJhcnkgQXV0aG9ycy5cbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBAZmlsZW92ZXJ2aWV3IEpTT04gdXRpbGl0eSBmdW5jdGlvbnMuXG4gKi9cblxuXG5nb29nLnByb3ZpZGUoJ2dvb2cuanNvbicpO1xuZ29vZy5wcm92aWRlKCdnb29nLmpzb24uUmVwbGFjZXInKTtcbmdvb2cucHJvdmlkZSgnZ29vZy5qc29uLlJldml2ZXInKTtcbmdvb2cucHJvdmlkZSgnZ29vZy5qc29uLlNlcmlhbGl6ZXInKTtcblxuXG4vKipcbiAqIEBkZWZpbmUge2Jvb2xlYW59IElmIHRydWUsIHVzZSB0aGUgbmF0aXZlIEpTT04gcGFyc2luZyBBUEkuXG4gKiBOT1RFOiBUaGUgZGVmYXVsdCBgZ29vZy5qc29uLnBhcnNlYCBpbXBsZW1lbnRhdGlvbiBpcyBhYmxlIHRvIGhhbmRsZVxuICogaW52YWxpZCBKU09OLiBKU1BCIHVzZWQgdG8gcHJvZHVjZSBpbnZhbGlkIEpTT04gd2hpY2ggaXMgbm90IHRoZSBjYXNlXG4gKiBhbnltb3JlIHNvIHRoaXMgaXMgc2FmZSB0byBlbmFibGUgZm9yIHBhcnNpbmcgSlNQQi4gVXNpbmcgbmF0aXZlIEpTT04gaXNcbiAqIGZhc3RlciBhbmQgc2FmZXIgdGhhbiB0aGUgZGVmYXVsdCBpbXBsZW1lbnRhdGlvbiB1c2luZyBgZXZhbGAuXG4gKi9cbmdvb2cuanNvbi5VU0VfTkFUSVZFX0pTT04gPSBnb29nLmRlZmluZSgnZ29vZy5qc29uLlVTRV9OQVRJVkVfSlNPTicsIGZhbHNlKTtcblxuLyoqXG4gKiBAZGVmaW5lIHtib29sZWFufSBJZiB0cnVlLCB0cnkgdGhlIG5hdGl2ZSBKU09OIHBhcnNpbmcgQVBJIGZpcnN0LiBJZiBpdFxuICogZmFpbHMsIGxvZyBhbiBlcnJvciBhbmQgdXNlIGBldmFsYCBpbnN0ZWFkLiBUaGlzIGlzIHVzZWZ1bCB3aGVuXG4gKiB0cmFuc2l0aW9uaW5nIHRvIGBnb29nLmpzb24uVVNFX05BVElWRV9KU09OYC4gVGhlIGVycm9yIGxvZ2dlciBuZWVkcyB0b1xuICogYmUgc2V0IGJ5IGBnb29nLmpzb24uc2V0RXJyb3JMb2dnZXJgLiBJZiBpdCBpcyBub3Qgc2V0IHRoZW4gdGhlIGVycm9yXG4gKiBpcyBpZ25vcmVkLlxuICovXG5nb29nLmpzb24uVFJZX05BVElWRV9KU09OID0gZ29vZy5kZWZpbmUoJ2dvb2cuanNvbi5UUllfTkFUSVZFX0pTT04nLCB0cnVlKTtcblxuXG4vKipcbiAqIFRlc3RzIGlmIGEgc3RyaW5nIGlzIGFuIGludmFsaWQgSlNPTiBzdHJpbmcuIFRoaXMgb25seSBlbnN1cmVzIHRoYXQgd2UgYXJlXG4gKiBub3QgdXNpbmcgYW55IGludmFsaWQgY2hhcmFjdGVyc1xuICogQHBhcmFtIHtzdHJpbmd9IHMgVGhlIHN0cmluZyB0byB0ZXN0LlxuICogQHJldHVybiB7Ym9vbGVhbn0gVHJ1ZSBpZiB0aGUgaW5wdXQgaXMgYSB2YWxpZCBKU09OIHN0cmluZy5cbiAqL1xuZ29vZy5qc29uLmlzVmFsaWQgPSBmdW5jdGlvbihzKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgLy8gQWxsIGVtcHR5IHdoaXRlc3BhY2UgaXMgbm90IHZhbGlkLlxuICBpZiAoL15cXHMqJC8udGVzdChzKSkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIC8vIFRoaXMgaXMgdGFrZW4gZnJvbSBodHRwOi8vd3d3Lmpzb24ub3JnL2pzb24yLmpzIHdoaWNoIGlzIHJlbGVhc2VkIHRvIHRoZVxuICAvLyBwdWJsaWMgZG9tYWluLlxuICAvLyBDaGFuZ2VzOiBXZSBkaXNzYWxsb3cgXFx1MjAyOCBMaW5lIHNlcGFyYXRvciBhbmQgXFx1MjAyOSBQYXJhZ3JhcGggc2VwYXJhdG9yXG4gIC8vIGluc2lkZSBzdHJpbmdzLiAgV2UgYWxzbyB0cmVhdCBcXHUyMDI4IGFuZCBcXHUyMDI5IGFzIHdoaXRlc3BhY2Ugd2hpY2ggdGhleVxuICAvLyBhcmUgaW4gdGhlIFJGQyBidXQgSUUgYW5kIFNhZmFyaSBkb2VzIG5vdCBtYXRjaCBcXHMgdG8gdGhlc2Ugc28gd2UgbmVlZCB0b1xuICAvLyBpbmNsdWRlIHRoZW0gaW4gdGhlIHJlZyBleHBzIGluIGFsbCBwbGFjZXMgd2hlcmUgd2hpdGVzcGFjZSBpcyBhbGxvd2VkLlxuICAvLyBXZSBhbGxvd2VkIFxceDdmIGluc2lkZSBzdHJpbmdzIGJlY2F1c2Ugc29tZSB0b29scyBkb24ndCBlc2NhcGUgaXQsXG4gIC8vIGUuZy4gaHR0cDovL3d3dy5qc29uLm9yZy9qYXZhL29yZy9qc29uL0pTT05PYmplY3QuamF2YVxuXG4gIC8vIFBhcnNpbmcgaGFwcGVucyBpbiB0aHJlZSBzdGFnZXMuIEluIHRoZSBmaXJzdCBzdGFnZSwgd2UgcnVuIHRoZSB0ZXh0XG4gIC8vIGFnYWluc3QgcmVndWxhciBleHByZXNzaW9ucyB0aGF0IGxvb2sgZm9yIG5vbi1KU09OIHBhdHRlcm5zLiBXZSBhcmVcbiAgLy8gZXNwZWNpYWxseSBjb25jZXJuZWQgd2l0aCAnKCknIGFuZCAnbmV3JyBiZWNhdXNlIHRoZXkgY2FuIGNhdXNlIGludm9jYXRpb24sXG4gIC8vIGFuZCAnPScgYmVjYXVzZSBpdCBjYW4gY2F1c2UgbXV0YXRpb24uIEJ1dCBqdXN0IHRvIGJlIHNhZmUsIHdlIHdhbnQgdG9cbiAgLy8gcmVqZWN0IGFsbCB1bmV4cGVjdGVkIGZvcm1zLlxuXG4gIC8vIFdlIHNwbGl0IHRoZSBmaXJzdCBzdGFnZSBpbnRvIDQgcmVnZXhwIG9wZXJhdGlvbnMgaW4gb3JkZXIgdG8gd29yayBhcm91bmRcbiAgLy8gY3JpcHBsaW5nIGluZWZmaWNpZW5jaWVzIGluIElFJ3MgYW5kIFNhZmFyaSdzIHJlZ2V4cCBlbmdpbmVzLiBGaXJzdCB3ZVxuICAvLyByZXBsYWNlIGFsbCBiYWNrc2xhc2ggcGFpcnMgd2l0aCAnQCcgKGEgbm9uLUpTT04gY2hhcmFjdGVyKS4gU2Vjb25kLCB3ZVxuICAvLyByZXBsYWNlIGFsbCBzaW1wbGUgdmFsdWUgdG9rZW5zIHdpdGggJ10nIGNoYXJhY3RlcnMsIGJ1dCBvbmx5IHdoZW4gZm9sbG93ZWRcbiAgLy8gYnkgYSBjb2xvbiwgY29tbWEsIGNsb3NpbmcgYnJhY2tldCBvciBlbmQgb2Ygc3RyaW5nLiBUaGlyZCwgd2UgZGVsZXRlIGFsbFxuICAvLyBvcGVuIGJyYWNrZXRzIHRoYXQgZm9sbG93IGEgY29sb24gb3IgY29tbWEgb3IgdGhhdCBiZWdpbiB0aGUgdGV4dC4gRmluYWxseSxcbiAgLy8gd2UgbG9vayB0byBzZWUgdGhhdCB0aGUgcmVtYWluaW5nIGNoYXJhY3RlcnMgYXJlIG9ubHkgd2hpdGVzcGFjZSBvciAnXScgb3JcbiAgLy8gJywnIG9yICc6JyBvciAneycgb3IgJ30nLiBJZiB0aGF0IGlzIHNvLCB0aGVuIHRoZSB0ZXh0IGlzIHNhZmUgZm9yIGV2YWwuXG5cbiAgLy8gRG9uJ3QgbWFrZSB0aGVzZSBzdGF0aWMgc2luY2UgdGhleSBoYXZlIHRoZSBnbG9iYWwgZmxhZy5cbiAgY29uc3QgYmFja3NsYXNoZXNSZSA9IC9cXFxcW1wiXFxcXFxcL2JmbnJ0dV0vZztcbiAgY29uc3Qgc2ltcGxlVmFsdWVzUmUgPVxuICAgICAgLyg/OlwiW15cIlxcXFxcXG5cXHJcXHUyMDI4XFx1MjAyOVxceDAwLVxceDA4XFx4MGEtXFx4MWZdKlwifHRydWV8ZmFsc2V8bnVsbHwtP1xcZCsoPzpcXC5cXGQqKT8oPzpbZUVdWytcXC1dP1xcZCspPylbXFxzXFx1MjAyOFxcdTIwMjldKig/PTp8LHxdfH18JCkvZztcbiAgY29uc3Qgb3BlbkJyYWNrZXRzUmUgPSAvKD86Xnw6fCwpKD86W1xcc1xcdTIwMjhcXHUyMDI5XSpcXFspKy9nO1xuICBjb25zdCByZW1haW5kZXJSZSA9IC9eW1xcXSw6e31cXHNcXHUyMDI4XFx1MjAyOV0qJC87XG5cbiAgcmV0dXJuIHJlbWFpbmRlclJlLnRlc3QoXG4gICAgICBzLnJlcGxhY2UoYmFja3NsYXNoZXNSZSwgJ0AnKVxuICAgICAgICAgIC5yZXBsYWNlKHNpbXBsZVZhbHVlc1JlLCAnXScpXG4gICAgICAgICAgLnJlcGxhY2Uob3BlbkJyYWNrZXRzUmUsICcnKSk7XG59O1xuXG4vKipcbiAqIExvZ3MgYSBwYXJzaW5nIGVycm9yIGluIGBKU09OLnBhcnNlYCBzb2x2YWJsZSBieSB1c2luZyBgZXZhbGBcbiAqIGlmIGBnb29nLmpzb24uVFJZX05BVElWRV9KU09OYCBpcyBlbmFibGVkLlxuICogQHByaXZhdGUge2Z1bmN0aW9uKHN0cmluZywgIUVycm9yKX0gVGhlIGZpcnN0IHBhcmFtZXRlciBpcyB0aGUgZXJyb3IgbWVzc2FnZSxcbiAqICAgICB0aGUgc2Vjb25kIGlzIHRoZSBleGNlcHRpb24gdGhyb3duIGJ5IGBKU09OLnBhcnNlYC5cbiAqL1xuZ29vZy5qc29uLmVycm9yTG9nZ2VyXyA9IGdvb2cubnVsbEZ1bmN0aW9uO1xuXG5cbi8qKlxuICogU2V0cyBhbiBlcnJvciBsb2dnZXIgdG8gdXNlIGlmIHRoZXJlJ3MgYSByZWNvdmVyYWJsZSBwYXJzaW5nIGVycm9yIGFuZFxuICogYGdvb2cuanNvbi5UUllfTkFUSVZFX0pTT05gIGlzIGVuYWJsZWQuXG4gKiBAcGFyYW0ge2Z1bmN0aW9uKHN0cmluZywgIUVycm9yKX0gZXJyb3JMb2dnZXIgVGhlIGZpcnN0IHBhcmFtZXRlciBpcyB0aGVcbiAqICAgICBlcnJvciBtZXNzYWdlLCB0aGUgc2Vjb25kIGlzIHRoZSBleGNlcHRpb24gdGhyb3duIGJ5IGBKU09OLnBhcnNlYC5cbiAqL1xuZ29vZy5qc29uLnNldEVycm9yTG9nZ2VyID0gZnVuY3Rpb24oZXJyb3JMb2dnZXIpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBnb29nLmpzb24uZXJyb3JMb2dnZXJfID0gZXJyb3JMb2dnZXI7XG59O1xuXG5cbi8qKlxuICogUGFyc2VzIGEgSlNPTiBzdHJpbmcgYW5kIHJldHVybnMgdGhlIHJlc3VsdC4gVGhpcyB0aHJvd3MgYW4gZXhjZXB0aW9uIGlmXG4gKiB0aGUgc3RyaW5nIGlzIGFuIGludmFsaWQgSlNPTiBzdHJpbmcuXG4gKlxuICogTm90ZSB0aGF0IHRoaXMgaXMgdmVyeSBzbG93IG9uIGxhcmdlIHN0cmluZ3MuIFVzZSBKU09OLnBhcnNlIGlmIHBvc3NpYmxlLlxuICpcbiAqIEBwYXJhbSB7Kn0gcyBUaGUgSlNPTiBzdHJpbmcgdG8gcGFyc2UuXG4gKiBAdGhyb3dzIEVycm9yIGlmIHMgaXMgaW52YWxpZCBKU09OLlxuICogQHJldHVybiB7T2JqZWN0fSBUaGUgb2JqZWN0IGdlbmVyYXRlZCBmcm9tIHRoZSBKU09OIHN0cmluZywgb3IgbnVsbC5cbiAqIEBkZXByZWNhdGVkIFVzZSBKU09OLnBhcnNlLlxuICovXG5nb29nLmpzb24ucGFyc2UgPSBnb29nLmpzb24uVVNFX05BVElWRV9KU09OID9cbiAgICAvKiogQHR5cGUge2Z1bmN0aW9uKCopOk9iamVjdH0gKi8gKGdvb2cuZ2xvYmFsWydKU09OJ11bJ3BhcnNlJ10pIDpcbiAgICBmdW5jdGlvbihzKSB7XG4gICAgICAndXNlIHN0cmljdCc7XG4gICAgICBsZXQgZXJyb3I7XG4gICAgICBpZiAoZ29vZy5qc29uLlRSWV9OQVRJVkVfSlNPTikge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIHJldHVybiBnb29nLmdsb2JhbFsnSlNPTiddWydwYXJzZSddKHMpO1xuICAgICAgICB9IGNhdGNoIChleCkge1xuICAgICAgICAgIGVycm9yID0gZXg7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGNvbnN0IG8gPSBTdHJpbmcocyk7XG4gICAgICBpZiAoZ29vZy5qc29uLmlzVmFsaWQobykpIHtcblxuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IC8qKiBAdHlwZSB7P09iamVjdH0gKi8gKGV2YWwoJygnICsgbyArICcpJykpO1xuICAgICAgICAgIGlmIChlcnJvcikge1xuICAgICAgICAgICAgZ29vZy5qc29uLmVycm9yTG9nZ2VyXygnSW52YWxpZCBKU09OOiAnICsgbywgZXJyb3IpO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9IGNhdGNoIChleCkge1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgSlNPTiBzdHJpbmc6ICcgKyBvKTtcbiAgICB9O1xuXG5cbi8qKlxuICogSlNPTiByZXBsYWNlciwgYXMgZGVmaW5lZCBpbiBTZWN0aW9uIDE1LjEyLjMgb2YgdGhlIEVTNSBzcGVjLlxuICogQHNlZSBodHRwOi8vZWNtYS1pbnRlcm5hdGlvbmFsLm9yZy9lY21hLTI2Mi81LjEvI3NlYy0xNS4xMi4zXG4gKlxuICogVE9ETyhuaWNrc2FudG9zKTogQXJyYXkgc2hvdWxkIGFsc28gYmUgYSB2YWxpZCByZXBsYWNlci5cbiAqXG4gKiBAdHlwZWRlZiB7ZnVuY3Rpb24odGhpczpPYmplY3QsIHN0cmluZywgKik6ICp9XG4gKi9cbmdvb2cuanNvbi5SZXBsYWNlcjtcblxuXG4vKipcbiAqIEpTT04gcmV2aXZlciwgYXMgZGVmaW5lZCBpbiBTZWN0aW9uIDE1LjEyLjIgb2YgdGhlIEVTNSBzcGVjLlxuICogQHNlZSBodHRwOi8vZWNtYS1pbnRlcm5hdGlvbmFsLm9yZy9lY21hLTI2Mi81LjEvI3NlYy0xNS4xMi4zXG4gKlxuICogQHR5cGVkZWYge2Z1bmN0aW9uKHRoaXM6T2JqZWN0LCBzdHJpbmcsICopOiAqfVxuICovXG5nb29nLmpzb24uUmV2aXZlcjtcblxuXG4vKipcbiAqIFNlcmlhbGl6ZXMgYW4gb2JqZWN0IG9yIGEgdmFsdWUgdG8gYSBKU09OIHN0cmluZy5cbiAqXG4gKiBAcGFyYW0geyp9IG9iamVjdCBUaGUgb2JqZWN0IHRvIHNlcmlhbGl6ZS5cbiAqIEBwYXJhbSB7P2dvb2cuanNvbi5SZXBsYWNlcj19IG9wdF9yZXBsYWNlciBBIHJlcGxhY2VyIGZ1bmN0aW9uXG4gKiAgICAgY2FsbGVkIGZvciBlYWNoIChrZXksIHZhbHVlKSBwYWlyIHRoYXQgZGV0ZXJtaW5lcyBob3cgdGhlIHZhbHVlXG4gKiAgICAgc2hvdWxkIGJlIHNlcmlhbGl6ZWQuIEJ5IGRlZnVsdCwgdGhpcyBqdXN0IHJldHVybnMgdGhlIHZhbHVlXG4gKiAgICAgYW5kIGFsbG93cyBkZWZhdWx0IHNlcmlhbGl6YXRpb24gdG8ga2ljayBpbi5cbiAqIEB0aHJvd3MgRXJyb3IgaWYgdGhlcmUgYXJlIGxvb3BzIGluIHRoZSBvYmplY3QgZ3JhcGguXG4gKiBAcmV0dXJuIHtzdHJpbmd9IEEgSlNPTiBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhlIGlucHV0LlxuICovXG5nb29nLmpzb24uc2VyaWFsaXplID0gZ29vZy5qc29uLlVTRV9OQVRJVkVfSlNPTiA/XG4gICAgLyoqIEB0eXBlIHtmdW5jdGlvbigqLCA/Z29vZy5qc29uLlJlcGxhY2VyPSk6c3RyaW5nfSAqL1xuICAgIChnb29nLmdsb2JhbFsnSlNPTiddWydzdHJpbmdpZnknXSkgOlxuICAgIGZ1bmN0aW9uKG9iamVjdCwgb3B0X3JlcGxhY2VyKSB7XG4gICAgICAndXNlIHN0cmljdCc7XG4gICAgICAvLyBOT1RFKG5pY2tzYW50b3MpOiBDdXJyZW50bHksIHdlIG5ldmVyIHVzZSBKU09OLnN0cmluZ2lmeS5cbiAgICAgIC8vXG4gICAgICAvLyBUaGUgbGFzdCB0aW1lIEkgZXZhbHVhdGVkIHRoaXMsIEpTT04uc3RyaW5naWZ5IGhhZCBzdWJ0bGUgYnVncyBhbmRcbiAgICAgIC8vIGJlaGF2aW9yIGRpZmZlcmVuY2VzIG9uIGFsbCBicm93c2VycywgYW5kIHRoZSBwZXJmb3JtYW5jZSB3aW4gd2FzIG5vdFxuICAgICAgLy8gbGFyZ2UgZW5vdWdoIHRvIGp1c3RpZnkgYWxsIHRoZSBpc3N1ZXMuIFRoaXMgbWF5IGNoYW5nZSBpbiB0aGUgZnV0dXJlXG4gICAgICAvLyBhcyBicm93c2VyIGltcGxlbWVudGF0aW9ucyBnZXQgYmV0dGVyLlxuICAgICAgLy9cbiAgICAgIC8vIGFzc2VydFNlcmlhbGl6ZSBpbiBqc29uX3Rlc3QgY29udGFpbnMgaWYgYnJhbmNoZXMgZm9yIHRoZSBjYXNlc1xuICAgICAgLy8gdGhhdCBmYWlsLlxuICAgICAgcmV0dXJuIG5ldyBnb29nLmpzb24uU2VyaWFsaXplcihvcHRfcmVwbGFjZXIpLnNlcmlhbGl6ZShvYmplY3QpO1xuICAgIH07XG5cblxuXG4vKipcbiAqIENsYXNzIHRoYXQgaXMgdXNlZCB0byBzZXJpYWxpemUgSlNPTiBvYmplY3RzIHRvIGEgc3RyaW5nLlxuICogQHBhcmFtIHs/Z29vZy5qc29uLlJlcGxhY2VyPX0gb3B0X3JlcGxhY2VyIFJlcGxhY2VyLlxuICogQGNvbnN0cnVjdG9yXG4gKi9cbmdvb2cuanNvbi5TZXJpYWxpemVyID0gZnVuY3Rpb24ob3B0X3JlcGxhY2VyKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgLyoqXG4gICAqIEB0eXBlIHtnb29nLmpzb24uUmVwbGFjZXJ8bnVsbHx1bmRlZmluZWR9XG4gICAqIEBwcml2YXRlXG4gICAqL1xuICB0aGlzLnJlcGxhY2VyXyA9IG9wdF9yZXBsYWNlcjtcbn07XG5cblxuLyoqXG4gKiBTZXJpYWxpemVzIGFuIG9iamVjdCBvciBhIHZhbHVlIHRvIGEgSlNPTiBzdHJpbmcuXG4gKlxuICogQHBhcmFtIHsqfSBvYmplY3QgVGhlIG9iamVjdCB0byBzZXJpYWxpemUuXG4gKiBAdGhyb3dzIEVycm9yIGlmIHRoZXJlIGFyZSBsb29wcyBpbiB0aGUgb2JqZWN0IGdyYXBoLlxuICogQHJldHVybiB7c3RyaW5nfSBBIEpTT04gc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBpbnB1dC5cbiAqL1xuZ29vZy5qc29uLlNlcmlhbGl6ZXIucHJvdG90eXBlLnNlcmlhbGl6ZSA9IGZ1bmN0aW9uKG9iamVjdCkge1xuICAndXNlIHN0cmljdCc7XG4gIGNvbnN0IHNiID0gW107XG4gIHRoaXMuc2VyaWFsaXplSW50ZXJuYWwob2JqZWN0LCBzYik7XG4gIHJldHVybiBzYi5qb2luKCcnKTtcbn07XG5cblxuLyoqXG4gKiBTZXJpYWxpemVzIGEgZ2VuZXJpYyB2YWx1ZSB0byBhIEpTT04gc3RyaW5nXG4gKiBAcHJvdGVjdGVkXG4gKiBAcGFyYW0geyp9IG9iamVjdCBUaGUgb2JqZWN0IHRvIHNlcmlhbGl6ZS5cbiAqIEBwYXJhbSB7QXJyYXk8c3RyaW5nPn0gc2IgQXJyYXkgdXNlZCBhcyBhIHN0cmluZyBidWlsZGVyLlxuICogQHRocm93cyBFcnJvciBpZiB0aGVyZSBhcmUgbG9vcHMgaW4gdGhlIG9iamVjdCBncmFwaC5cbiAqL1xuZ29vZy5qc29uLlNlcmlhbGl6ZXIucHJvdG90eXBlLnNlcmlhbGl6ZUludGVybmFsID0gZnVuY3Rpb24ob2JqZWN0LCBzYikge1xuICAndXNlIHN0cmljdCc7XG4gIGlmIChvYmplY3QgPT0gbnVsbCkge1xuICAgIC8vIHVuZGVmaW5lZCA9PSBudWxsIHNvIHRoaXMgYnJhbmNoIGNvdmVycyB1bmRlZmluZWQgYXMgd2VsbCBhcyBudWxsXG4gICAgc2IucHVzaCgnbnVsbCcpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGlmICh0eXBlb2Ygb2JqZWN0ID09ICdvYmplY3QnKSB7XG4gICAgaWYgKEFycmF5LmlzQXJyYXkob2JqZWN0KSkge1xuICAgICAgdGhpcy5zZXJpYWxpemVBcnJheShvYmplY3QsIHNiKTtcbiAgICAgIHJldHVybjtcbiAgICB9IGVsc2UgaWYgKFxuICAgICAgICBvYmplY3QgaW5zdGFuY2VvZiBTdHJpbmcgfHwgb2JqZWN0IGluc3RhbmNlb2YgTnVtYmVyIHx8XG4gICAgICAgIG9iamVjdCBpbnN0YW5jZW9mIEJvb2xlYW4pIHtcbiAgICAgIG9iamVjdCA9IG9iamVjdC52YWx1ZU9mKCk7XG4gICAgICAvLyBGYWxsIHRocm91Z2ggdG8gc3dpdGNoIGJlbG93LlxuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnNlcmlhbGl6ZU9iamVjdF8oLyoqIEB0eXBlIHshT2JqZWN0fSAqLyAob2JqZWN0KSwgc2IpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgfVxuXG4gIHN3aXRjaCAodHlwZW9mIG9iamVjdCkge1xuICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICB0aGlzLnNlcmlhbGl6ZVN0cmluZ18ob2JqZWN0LCBzYik7XG4gICAgICBicmVhaztcbiAgICBjYXNlICdudW1iZXInOlxuICAgICAgdGhpcy5zZXJpYWxpemVOdW1iZXJfKG9iamVjdCwgc2IpO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAnYm9vbGVhbic6XG4gICAgICBzYi5wdXNoKFN0cmluZyhvYmplY3QpKTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJ2Z1bmN0aW9uJzpcbiAgICAgIHNiLnB1c2goJ251bGwnKTtcbiAgICAgIGJyZWFrO1xuICAgIGRlZmF1bHQ6XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Vua25vd24gdHlwZTogJyArIHR5cGVvZiBvYmplY3QpO1xuICB9XG59O1xuXG5cbi8qKlxuICogQ2hhcmFjdGVyIG1hcHBpbmdzIHVzZWQgaW50ZXJuYWxseSBmb3IgZ29vZy5zdHJpbmcucXVvdGVcbiAqIEBwcml2YXRlXG4gKiBAdHlwZSB7IU9iamVjdH1cbiAqL1xuZ29vZy5qc29uLlNlcmlhbGl6ZXIuY2hhclRvSnNvbkNoYXJDYWNoZV8gPSB7XG4gICdcXFwiJzogJ1xcXFxcIicsXG4gICdcXFxcJzogJ1xcXFxcXFxcJyxcbiAgJy8nOiAnXFxcXC8nLFxuICAnXFxiJzogJ1xcXFxiJyxcbiAgJ1xcZic6ICdcXFxcZicsXG4gICdcXG4nOiAnXFxcXG4nLFxuICAnXFxyJzogJ1xcXFxyJyxcbiAgJ1xcdCc6ICdcXFxcdCcsXG5cbiAgJ1xceDBCJzogJ1xcXFx1MDAwYicgIC8vICdcXHYnIGlzIG5vdCBzdXBwb3J0ZWQgaW4gSlNjcmlwdFxufTtcblxuXG4vKipcbiAqIFJlZ3VsYXIgZXhwcmVzc2lvbiB1c2VkIHRvIG1hdGNoIGNoYXJhY3RlcnMgdGhhdCBuZWVkIHRvIGJlIHJlcGxhY2VkLlxuICogVGhlIFM2MCBicm93c2VyIGhhcyBhIGJ1ZyB3aGVyZSB1bmljb2RlIGNoYXJhY3RlcnMgYXJlIG5vdCBtYXRjaGVkIGJ5XG4gKiByZWd1bGFyIGV4cHJlc3Npb25zLiBUaGUgY29uZGl0aW9uIGJlbG93IGRldGVjdHMgc3VjaCBiZWhhdmlvdXIgYW5kXG4gKiBhZGp1c3RzIHRoZSByZWd1bGFyIGV4cHJlc3Npb24gYWNjb3JkaW5nbHkuXG4gKiBAcHJpdmF0ZVxuICogQHR5cGUgeyFSZWdFeHB9XG4gKi9cbmdvb2cuanNvbi5TZXJpYWxpemVyLmNoYXJzVG9SZXBsYWNlXyA9IC9cXHVmZmZmLy50ZXN0KCdcXHVmZmZmJykgP1xuICAgIC9bXFxcXFxcXCJcXHgwMC1cXHgxZlxceDdmLVxcdWZmZmZdL2cgOlxuICAgIC9bXFxcXFxcXCJcXHgwMC1cXHgxZlxceDdmLVxceGZmXS9nO1xuXG5cbi8qKlxuICogU2VyaWFsaXplcyBhIHN0cmluZyB0byBhIEpTT04gc3RyaW5nXG4gKiBAcHJpdmF0ZVxuICogQHBhcmFtIHtzdHJpbmd9IHMgVGhlIHN0cmluZyB0byBzZXJpYWxpemUuXG4gKiBAcGFyYW0ge0FycmF5PHN0cmluZz59IHNiIEFycmF5IHVzZWQgYXMgYSBzdHJpbmcgYnVpbGRlci5cbiAqL1xuZ29vZy5qc29uLlNlcmlhbGl6ZXIucHJvdG90eXBlLnNlcmlhbGl6ZVN0cmluZ18gPSBmdW5jdGlvbihzLCBzYikge1xuICAndXNlIHN0cmljdCc7XG4gIC8vIFRoZSBvZmZpY2lhbCBKU09OIGltcGxlbWVudGF0aW9uIGRvZXMgbm90IHdvcmsgd2l0aCBpbnRlcm5hdGlvbmFsXG4gIC8vIGNoYXJhY3RlcnMuXG4gIHNiLnB1c2goJ1wiJywgcy5yZXBsYWNlKGdvb2cuanNvbi5TZXJpYWxpemVyLmNoYXJzVG9SZXBsYWNlXywgZnVuY3Rpb24oYykge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICAvLyBjYWNoaW5nIHRoZSByZXN1bHQgaW1wcm92ZXMgcGVyZm9ybWFuY2UgYnkgYSBmYWN0b3IgMi0zXG4gICAgbGV0IHJ2ID0gZ29vZy5qc29uLlNlcmlhbGl6ZXIuY2hhclRvSnNvbkNoYXJDYWNoZV9bY107XG4gICAgaWYgKCFydikge1xuICAgICAgcnYgPSAnXFxcXHUnICsgKGMuY2hhckNvZGVBdCgwKSB8IDB4MTAwMDApLnRvU3RyaW5nKDE2KS5zdWJzdHIoMSk7XG4gICAgICBnb29nLmpzb24uU2VyaWFsaXplci5jaGFyVG9Kc29uQ2hhckNhY2hlX1tjXSA9IHJ2O1xuICAgIH1cbiAgICByZXR1cm4gcnY7XG4gIH0pLCAnXCInKTtcbn07XG5cblxuLyoqXG4gKiBTZXJpYWxpemVzIGEgbnVtYmVyIHRvIGEgSlNPTiBzdHJpbmdcbiAqIEBwcml2YXRlXG4gKiBAcGFyYW0ge251bWJlcn0gbiBUaGUgbnVtYmVyIHRvIHNlcmlhbGl6ZS5cbiAqIEBwYXJhbSB7QXJyYXk8c3RyaW5nPn0gc2IgQXJyYXkgdXNlZCBhcyBhIHN0cmluZyBidWlsZGVyLlxuICovXG5nb29nLmpzb24uU2VyaWFsaXplci5wcm90b3R5cGUuc2VyaWFsaXplTnVtYmVyXyA9IGZ1bmN0aW9uKG4sIHNiKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgc2IucHVzaChpc0Zpbml0ZShuKSAmJiAhaXNOYU4obikgPyBTdHJpbmcobikgOiAnbnVsbCcpO1xufTtcblxuXG4vKipcbiAqIFNlcmlhbGl6ZXMgYW4gYXJyYXkgdG8gYSBKU09OIHN0cmluZ1xuICogQHBhcmFtIHtBcnJheTxzdHJpbmc+fSBhcnIgVGhlIGFycmF5IHRvIHNlcmlhbGl6ZS5cbiAqIEBwYXJhbSB7QXJyYXk8c3RyaW5nPn0gc2IgQXJyYXkgdXNlZCBhcyBhIHN0cmluZyBidWlsZGVyLlxuICogQHByb3RlY3RlZFxuICovXG5nb29nLmpzb24uU2VyaWFsaXplci5wcm90b3R5cGUuc2VyaWFsaXplQXJyYXkgPSBmdW5jdGlvbihhcnIsIHNiKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgY29uc3QgbCA9IGFyci5sZW5ndGg7XG4gIHNiLnB1c2goJ1snKTtcbiAgbGV0IHNlcCA9ICcnO1xuICBmb3IgKGxldCBpID0gMDsgaSA8IGw7IGkrKykge1xuICAgIHNiLnB1c2goc2VwKTtcblxuICAgIGNvbnN0IHZhbHVlID0gYXJyW2ldO1xuICAgIHRoaXMuc2VyaWFsaXplSW50ZXJuYWwoXG4gICAgICAgIHRoaXMucmVwbGFjZXJfID8gdGhpcy5yZXBsYWNlcl8uY2FsbChhcnIsIFN0cmluZyhpKSwgdmFsdWUpIDogdmFsdWUsXG4gICAgICAgIHNiKTtcblxuICAgIHNlcCA9ICcsJztcbiAgfVxuICBzYi5wdXNoKCddJyk7XG59O1xuXG5cbi8qKlxuICogU2VyaWFsaXplcyBhbiBvYmplY3QgdG8gYSBKU09OIHN0cmluZ1xuICogQHByaXZhdGVcbiAqIEBwYXJhbSB7IU9iamVjdH0gb2JqIFRoZSBvYmplY3QgdG8gc2VyaWFsaXplLlxuICogQHBhcmFtIHtBcnJheTxzdHJpbmc+fSBzYiBBcnJheSB1c2VkIGFzIGEgc3RyaW5nIGJ1aWxkZXIuXG4gKi9cbmdvb2cuanNvbi5TZXJpYWxpemVyLnByb3RvdHlwZS5zZXJpYWxpemVPYmplY3RfID0gZnVuY3Rpb24ob2JqLCBzYikge1xuICAndXNlIHN0cmljdCc7XG4gIHNiLnB1c2goJ3snKTtcbiAgbGV0IHNlcCA9ICcnO1xuICBmb3IgKGNvbnN0IGtleSBpbiBvYmopIHtcbiAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwga2V5KSkge1xuICAgICAgY29uc3QgdmFsdWUgPSBvYmpba2V5XTtcbiAgICAgIC8vIFNraXAgZnVuY3Rpb25zLlxuICAgICAgaWYgKHR5cGVvZiB2YWx1ZSAhPSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIHNiLnB1c2goc2VwKTtcbiAgICAgICAgdGhpcy5zZXJpYWxpemVTdHJpbmdfKGtleSwgc2IpO1xuICAgICAgICBzYi5wdXNoKCc6Jyk7XG5cbiAgICAgICAgdGhpcy5zZXJpYWxpemVJbnRlcm5hbChcbiAgICAgICAgICAgIHRoaXMucmVwbGFjZXJfID8gdGhpcy5yZXBsYWNlcl8uY2FsbChvYmosIGtleSwgdmFsdWUpIDogdmFsdWUsIHNiKTtcblxuICAgICAgICBzZXAgPSAnLCc7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIHNiLnB1c2goJ30nKTtcbn07XG4iLCAiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IFRoZSBDbG9zdXJlIExpYnJhcnkgQXV0aG9ycy5cbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuZ29vZy5tb2R1bGUoJ2dvb2cuYXN5bmMuV29ya1F1ZXVlJyk7XG5nb29nLm1vZHVsZS5kZWNsYXJlTGVnYWN5TmFtZXNwYWNlKCk7XG5cbmNvbnN0IEZyZWVMaXN0ID0gZ29vZy5yZXF1aXJlKCdnb29nLmFzeW5jLkZyZWVMaXN0Jyk7XG5jb25zdCB7YXNzZXJ0fSA9IGdvb2cucmVxdWlyZSgnZ29vZy5hc3NlcnRzJyk7XG5cbi8vIFRPRE8oam9obmxlbnopOiBnZW5lcmFsaXplIHRoZSBXb3JrUXVldWUgaWYgdGhpcyBpcyB1c2VkIGJ5IG1vcmVcbi8vIHRoYW4gZ29vZy5hc3luYy5ydW4uXG5cblxuLyoqXG4gKiBBIGxvdyBHQyB3b3JrcXVldWUuIFRoZSBrZXkgZWxlbWVudHMgb2YgdGhpcyBkZXNpZ246XG4gKiAgIC0gYXZvaWRzIHRoZSBuZWVkIGZvciBnb29nLmJpbmQgb3IgZXF1aXZhbGVudCBieSBjYXJyeWluZyBzY29wZVxuICogICAtIGF2b2lkcyB0aGUgbmVlZCBmb3IgYXJyYXkgcmVhbGxvY2F0aW9uIGJ5IHVzaW5nIGEgbGlua2VkIGxpc3RcbiAqICAgLSBtaW5pbWl6ZXMgd29yayBlbnRyeSBvYmplY3RzIGFsbG9jYXRpb24gYnkgcmVjeWNsaW5nIG9iamVjdHNcbiAqIEBmaW5hbFxuICogQHN0cnVjdFxuICovXG5jbGFzcyBXb3JrUXVldWUge1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLndvcmtIZWFkXyA9IG51bGw7XG4gICAgdGhpcy53b3JrVGFpbF8gPSBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIEBwYXJhbSB7ZnVuY3Rpb24oKX0gZm5cbiAgICogQHBhcmFtIHtPYmplY3R8bnVsbHx1bmRlZmluZWR9IHNjb3BlXG4gICAqL1xuICBhZGQoZm4sIHNjb3BlKSB7XG4gICAgY29uc3QgaXRlbSA9IHRoaXMuZ2V0VW51c2VkSXRlbV8oKTtcbiAgICBpdGVtLnNldChmbiwgc2NvcGUpO1xuXG4gICAgaWYgKHRoaXMud29ya1RhaWxfKSB7XG4gICAgICB0aGlzLndvcmtUYWlsXy5uZXh0ID0gaXRlbTtcbiAgICAgIHRoaXMud29ya1RhaWxfID0gaXRlbTtcbiAgICB9IGVsc2Uge1xuICAgICAgYXNzZXJ0KCF0aGlzLndvcmtIZWFkXyk7XG4gICAgICB0aGlzLndvcmtIZWFkXyA9IGl0ZW07XG4gICAgICB0aGlzLndvcmtUYWlsXyA9IGl0ZW07XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEByZXR1cm4gez9Xb3JrSXRlbX1cbiAgICovXG4gIHJlbW92ZSgpIHtcbiAgICBsZXQgaXRlbSA9IG51bGw7XG5cbiAgICBpZiAodGhpcy53b3JrSGVhZF8pIHtcbiAgICAgIGl0ZW0gPSB0aGlzLndvcmtIZWFkXztcbiAgICAgIHRoaXMud29ya0hlYWRfID0gdGhpcy53b3JrSGVhZF8ubmV4dDtcbiAgICAgIGlmICghdGhpcy53b3JrSGVhZF8pIHtcbiAgICAgICAgdGhpcy53b3JrVGFpbF8gPSBudWxsO1xuICAgICAgfVxuICAgICAgaXRlbS5uZXh0ID0gbnVsbDtcbiAgICB9XG4gICAgcmV0dXJuIGl0ZW07XG4gIH1cblxuICAvKipcbiAgICogQHBhcmFtIHshV29ya0l0ZW19IGl0ZW1cbiAgICovXG4gIHJldHVyblVudXNlZChpdGVtKSB7XG4gICAgV29ya1F1ZXVlLmZyZWVsaXN0Xy5wdXQoaXRlbSk7XG4gIH1cblxuICAvKipcbiAgICogQHJldHVybiB7IVdvcmtJdGVtfVxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgZ2V0VW51c2VkSXRlbV8oKSB7XG4gICAgcmV0dXJuIFdvcmtRdWV1ZS5mcmVlbGlzdF8uZ2V0KCk7XG4gIH1cbn1cblxuLyoqIEBkZWZpbmUge251bWJlcn0gVGhlIG1heGltdW0gbnVtYmVyIG9mIGVudHJpZXMgdG8ga2VlcCBmb3IgcmVjeWNsaW5nLiAqL1xuV29ya1F1ZXVlLkRFRkFVTFRfTUFYX1VOVVNFRCA9XG4gICAgZ29vZy5kZWZpbmUoJ2dvb2cuYXN5bmMuV29ya1F1ZXVlLkRFRkFVTFRfTUFYX1VOVVNFRCcsIDEwMCk7XG5cbi8qKiBAY29uc3QgQHByaXZhdGUgeyFGcmVlTGlzdDwhV29ya0l0ZW0+fSAqL1xuV29ya1F1ZXVlLmZyZWVsaXN0XyA9IG5ldyBGcmVlTGlzdChcbiAgICAoKSA9PiBuZXcgV29ya0l0ZW0oKSwgaXRlbSA9PiBpdGVtLnJlc2V0KCksIFdvcmtRdWV1ZS5ERUZBVUxUX01BWF9VTlVTRUQpO1xuXG4vKipcbiAqIEBmaW5hbFxuICogQHN0cnVjdFxuICovXG5jbGFzcyBXb3JrSXRlbSB7XG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIC8qKiBAdHlwZSB7P2Z1bmN0aW9uKCl9ICovXG4gICAgdGhpcy5mbiA9IG51bGw7XG4gICAgLyoqIEB0eXBlIHs/T2JqZWN0fG51bGx8dW5kZWZpbmVkfSAqL1xuICAgIHRoaXMuc2NvcGUgPSBudWxsO1xuICAgIC8qKiBAdHlwZSB7P1dvcmtJdGVtfSAqL1xuICAgIHRoaXMubmV4dCA9IG51bGw7XG4gIH1cblxuICAvKipcbiAgICogQHBhcmFtIHtmdW5jdGlvbigpfSBmblxuICAgKiBAcGFyYW0ge09iamVjdHxudWxsfHVuZGVmaW5lZH0gc2NvcGVcbiAgICovXG4gIHNldChmbiwgc2NvcGUpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgdGhpcy5mbiA9IGZuO1xuICAgIHRoaXMuc2NvcGUgPSBzY29wZTtcbiAgICB0aGlzLm5leHQgPSBudWxsO1xuICB9XG5cbiAgLyoqIFJlc2V0IHRoZSB3b3JrIGl0ZW0gc28gdGhleSBkb24ndCBwcmV2ZW50IEdDIGJlZm9yZSByZXVzZSAqL1xuICByZXNldCgpIHtcbiAgICB0aGlzLmZuID0gbnVsbDtcbiAgICB0aGlzLnNjb3BlID0gbnVsbDtcbiAgICB0aGlzLm5leHQgPSBudWxsO1xuICB9XG59XG5cbmV4cG9ydHMgPSBXb3JrUXVldWU7XG4iLCAiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IFRoZSBDbG9zdXJlIExpYnJhcnkgQXV0aG9ycy5cbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuZ29vZy5wcm92aWRlKCdnb29nLmFzeW5jLnJ1bicpO1xuXG5nb29nLnJlcXVpcmUoJ2dvb2cuYXN5bmMuV29ya1F1ZXVlJyk7XG5nb29nLnJlcXVpcmUoJ2dvb2cuYXN5bmMubmV4dFRpY2snKTtcbmdvb2cucmVxdWlyZSgnZ29vZy5hc3luYy50aHJvd0V4Y2VwdGlvbicpO1xuXG4vKipcbiAqIEBkZWZpbmUge2Jvb2xlYW59IElmIHRydWUsIHVzZSB0aGUgZ2xvYmFsIFByb21pc2UgdG8gaW1wbGVtZW50IGdvb2cuYXN5bmMucnVuXG4gKiBhc3N1bWluZyBlaXRoZXIgdGhlIG5hdGl2ZSwgb3IgcG9seWZpbGwgdmVyc2lvbiB3aWxsIGJlIHVzZWQuIERvZXMgc3RpbGxcbiAqIHBlcm1pdCB0ZXN0cyB0byB1c2UgZm9yY2VOZXh0VGljay5cbiAqL1xuZ29vZy5BU1NVTUVfTkFUSVZFX1BST01JU0UgPSBnb29nLmRlZmluZSgnZ29vZy5BU1NVTUVfTkFUSVZFX1BST01JU0UnLCBmYWxzZSk7XG5cbi8qKlxuICogRmlyZXMgdGhlIHByb3ZpZGVkIGNhbGxiYWNrIGp1c3QgYmVmb3JlIHRoZSBjdXJyZW50IGNhbGxzdGFjayB1bndpbmRzLCBvciBhc1xuICogc29vbiBhcyBwb3NzaWJsZSBhZnRlciB0aGUgY3VycmVudCBKUyBleGVjdXRpb24gY29udGV4dC5cbiAqIEBwYXJhbSB7ZnVuY3Rpb24odGhpczpUSElTKX0gY2FsbGJhY2tcbiAqIEBwYXJhbSB7VEhJUz19IG9wdF9jb250ZXh0IE9iamVjdCB0byB1c2UgYXMgdGhlIFwidGhpcyB2YWx1ZVwiIHdoZW4gY2FsbGluZ1xuICogICAgIHRoZSBwcm92aWRlZCBmdW5jdGlvbi5cbiAqIEB0ZW1wbGF0ZSBUSElTXG4gKi9cbmdvb2cuYXN5bmMucnVuID0gZnVuY3Rpb24oY2FsbGJhY2ssIG9wdF9jb250ZXh0KSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgaWYgKCFnb29nLmFzeW5jLnJ1bi5zY2hlZHVsZV8pIHtcbiAgICBnb29nLmFzeW5jLnJ1bi5pbml0aWFsaXplUnVubmVyXygpO1xuICB9XG4gIGlmICghZ29vZy5hc3luYy5ydW4ud29ya1F1ZXVlU2NoZWR1bGVkXykge1xuICAgIC8vIE5vdGhpbmcgaXMgY3VycmVudGx5IHNjaGVkdWxlZCwgc2NoZWR1bGUgaXQgbm93LlxuICAgIGdvb2cuYXN5bmMucnVuLnNjaGVkdWxlXygpO1xuICAgIGdvb2cuYXN5bmMucnVuLndvcmtRdWV1ZVNjaGVkdWxlZF8gPSB0cnVlO1xuICB9XG5cbiAgZ29vZy5hc3luYy5ydW4ud29ya1F1ZXVlXy5hZGQoY2FsbGJhY2ssIG9wdF9jb250ZXh0KTtcbn07XG5cblxuLyoqXG4gKiBJbml0aWFsaXplcyB0aGUgZnVuY3Rpb24gdG8gdXNlIHRvIHByb2Nlc3MgdGhlIHdvcmsgcXVldWUuXG4gKiBAcHJpdmF0ZVxuICovXG5nb29nLmFzeW5jLnJ1bi5pbml0aWFsaXplUnVubmVyXyA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIGlmIChnb29nLkFTU1VNRV9OQVRJVkVfUFJPTUlTRSB8fFxuICAgICAgKGdvb2cuZ2xvYmFsLlByb21pc2UgJiYgZ29vZy5nbG9iYWwuUHJvbWlzZS5yZXNvbHZlKSkge1xuICAgIC8vIFVzZSBnb29nLmdsb2JhbC5Qcm9taXNlIGluc3RlYWQgb2YganVzdCBQcm9taXNlIGJlY2F1c2UgdGhlIHJlbGV2YW50XG4gICAgLy8gZXh0ZXJucyBtYXkgYmUgbWlzc2luZywgYW5kIGRvbid0IGFsaWFzIGl0IGJlY2F1c2UgdGhpcyBjb3VsZCBjb25mdXNlIHRoZVxuICAgIC8vIGNvbXBpbGVyIGludG8gdGhpbmtpbmcgdGhlIHBvbHlmaWxsIGlzIHJlcXVpcmVkIHdoZW4gaXQgc2hvdWxkIGJlIHRyZWF0ZWRcbiAgICAvLyBhcyBvcHRpb25hbC5cbiAgICB2YXIgcHJvbWlzZSA9IGdvb2cuZ2xvYmFsLlByb21pc2UucmVzb2x2ZSh1bmRlZmluZWQpO1xuICAgIGdvb2cuYXN5bmMucnVuLnNjaGVkdWxlXyA9IGZ1bmN0aW9uKCkge1xuICAgICAgJ3VzZSBzdHJpY3QnO1xuICAgICAgcHJvbWlzZS50aGVuKGdvb2cuYXN5bmMucnVuLnByb2Nlc3NXb3JrUXVldWUpO1xuICAgIH07XG4gIH0gZWxzZSB7XG4gICAgZ29vZy5hc3luYy5ydW4uc2NoZWR1bGVfID0gZnVuY3Rpb24oKSB7XG4gICAgICAndXNlIHN0cmljdCc7XG4gICAgICBnb29nLmFzeW5jLm5leHRUaWNrKGdvb2cuYXN5bmMucnVuLnByb2Nlc3NXb3JrUXVldWUpO1xuICAgIH07XG4gIH1cbn07XG5cblxuLyoqXG4gKiBGb3JjZXMgZ29vZy5hc3luYy5ydW4gdG8gdXNlIG5leHRUaWNrIGluc3RlYWQgb2YgUHJvbWlzZS5cbiAqXG4gKiBUaGlzIHNob3VsZCBvbmx5IGJlIGRvbmUgaW4gdW5pdCB0ZXN0cy4gSXQncyB1c2VmdWwgYmVjYXVzZSBNb2NrQ2xvY2tcbiAqIHJlcGxhY2VzIG5leHRUaWNrLCBidXQgbm90IHRoZSBicm93c2VyIFByb21pc2UgaW1wbGVtZW50YXRpb24sIHNvIGl0IGFsbG93c1xuICogUHJvbWlzZS1iYXNlZCBjb2RlIHRvIGJlIHRlc3RlZCB3aXRoIE1vY2tDbG9jay5cbiAqXG4gKiBIb3dldmVyLCB3ZSBhbHNvIHdhbnQgdG8gcnVuIHByb21pc2VzIGlmIHRoZSBNb2NrQ2xvY2sgaXMgbm8gbG9uZ2VyIGluXG4gKiBjb250cm9sIHNvIHdlIHNjaGVkdWxlIGEgYmFja3VwIFwic2V0VGltZW91dFwiIHRvIHRoZSB1bm1vY2tlZCB0aW1lb3V0IGlmXG4gKiBwcm92aWRlZC5cbiAqXG4gKiBAcGFyYW0ge2Z1bmN0aW9uKGZ1bmN0aW9uKCkpPX0gb3B0X3JlYWxTZXRUaW1lb3V0XG4gKi9cbmdvb2cuYXN5bmMucnVuLmZvcmNlTmV4dFRpY2sgPSBmdW5jdGlvbihvcHRfcmVhbFNldFRpbWVvdXQpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBnb29nLmFzeW5jLnJ1bi5zY2hlZHVsZV8gPSBmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgZ29vZy5hc3luYy5uZXh0VGljayhnb29nLmFzeW5jLnJ1bi5wcm9jZXNzV29ya1F1ZXVlKTtcbiAgICBpZiAob3B0X3JlYWxTZXRUaW1lb3V0KSB7XG4gICAgICBvcHRfcmVhbFNldFRpbWVvdXQoZ29vZy5hc3luYy5ydW4ucHJvY2Vzc1dvcmtRdWV1ZSk7XG4gICAgfVxuICB9O1xufTtcblxuXG4vKipcbiAqIFRoZSBmdW5jdGlvbiB1c2VkIHRvIHNjaGVkdWxlIHdvcmsgYXN5bmNocm9ub3VzZWx5LlxuICogQHByaXZhdGUge2Z1bmN0aW9uKCl9XG4gKi9cbmdvb2cuYXN5bmMucnVuLnNjaGVkdWxlXztcblxuXG4vKiogQHByaXZhdGUge2Jvb2xlYW59ICovXG5nb29nLmFzeW5jLnJ1bi53b3JrUXVldWVTY2hlZHVsZWRfID0gZmFsc2U7XG5cblxuLyoqIEBwcml2YXRlIHshZ29vZy5hc3luYy5Xb3JrUXVldWV9ICovXG5nb29nLmFzeW5jLnJ1bi53b3JrUXVldWVfID0gbmV3IGdvb2cuYXN5bmMuV29ya1F1ZXVlKCk7XG5cblxuaWYgKGdvb2cuREVCVUcpIHtcbiAgLyoqXG4gICAqIFJlc2V0IHRoZSB3b3JrIHF1ZXVlLiBPbmx5IGF2YWlsYWJsZSBmb3IgdGVzdHMgaW4gZGVidWcgbW9kZS5cbiAgICovXG4gIGdvb2cuYXN5bmMucnVuLnJlc2V0UXVldWUgPSBmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgZ29vZy5hc3luYy5ydW4ud29ya1F1ZXVlU2NoZWR1bGVkXyA9IGZhbHNlO1xuICAgIGdvb2cuYXN5bmMucnVuLndvcmtRdWV1ZV8gPSBuZXcgZ29vZy5hc3luYy5Xb3JrUXVldWUoKTtcbiAgfTtcbn1cblxuXG4vKipcbiAqIFJ1biBhbnkgcGVuZGluZyBnb29nLmFzeW5jLnJ1biB3b3JrIGl0ZW1zLiBUaGlzIGZ1bmN0aW9uIGlzIG5vdCBpbnRlbmRlZFxuICogZm9yIGdlbmVyYWwgdXNlLCBidXQgZm9yIHVzZSBieSBlbnRyeSBwb2ludCBoYW5kbGVycyB0byBydW4gaXRlbXMgYWhlYWQgb2ZcbiAqIGdvb2cuYXN5bmMubmV4dFRpY2suXG4gKi9cbmdvb2cuYXN5bmMucnVuLnByb2Nlc3NXb3JrUXVldWUgPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICAvLyBOT1RFOiBhZGRpdGlvbmFsIHdvcmsgcXVldWUgaXRlbXMgbWF5IGJlIGFkZGVkIHdoaWxlIHByb2Nlc3NpbmcuXG4gIHZhciBpdGVtID0gbnVsbDtcbiAgd2hpbGUgKGl0ZW0gPSBnb29nLmFzeW5jLnJ1bi53b3JrUXVldWVfLnJlbW92ZSgpKSB7XG4gICAgdHJ5IHtcbiAgICAgIGl0ZW0uZm4uY2FsbChpdGVtLnNjb3BlKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBnb29nLmFzeW5jLnRocm93RXhjZXB0aW9uKGUpO1xuICAgIH1cbiAgICBnb29nLmFzeW5jLnJ1bi53b3JrUXVldWVfLnJldHVyblVudXNlZChpdGVtKTtcbiAgfVxuXG4gIC8vIFRoZXJlIGFyZSBubyBtb3JlIHdvcmsgaXRlbXMsIGFsbG93IHByb2Nlc3NpbmcgdG8gYmUgc2NoZWR1bGVkIGFnYWluLlxuICBnb29nLmFzeW5jLnJ1bi53b3JrUXVldWVTY2hlZHVsZWRfID0gZmFsc2U7XG59O1xuIiwgIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCBUaGUgQ2xvc3VyZSBMaWJyYXJ5IEF1dGhvcnMuXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogQGZpbGVvdmVydmlldyBTaW1wbGUgZnJlZWxpc3QuXG4gKlxuICogQW4gYW50ZXJhdGl2ZSB0byBnb29nLnN0cnVjdHMuU2ltcGxlUG9vbCwgaXQgaW1wb3NlcyB0aGUgcmVxdWlyZW1lbnQgdGhhdCB0aGVcbiAqIG9iamVjdHMgaW4gdGhlIGxpc3QgY29udGFpbiBhIFwibmV4dFwiIHByb3BlcnR5IHRoYXQgY2FuIGJlIHVzZWQgdG8gbWFpbnRhaW5cbiAqIHRoZSBwb29sLlxuICovXG5cbmdvb2cucHJvdmlkZSgnZ29vZy5hc3luYy5GcmVlTGlzdCcpO1xuXG5cbi8qKlxuICogQHRlbXBsYXRlIElURU1cbiAqL1xuZ29vZy5hc3luYy5GcmVlTGlzdCA9IGNsYXNzIHtcbiAgLyoqXG4gICAqIEBwYXJhbSB7ZnVuY3Rpb24oKTpJVEVNfSBjcmVhdGVcbiAgICogQHBhcmFtIHtmdW5jdGlvbihJVEVNKTp2b2lkfSByZXNldFxuICAgKiBAcGFyYW0ge251bWJlcn0gbGltaXRcbiAgICovXG4gIGNvbnN0cnVjdG9yKGNyZWF0ZSwgcmVzZXQsIGxpbWl0KSB7XG4gICAgLyoqIEBwcml2YXRlIEBjb25zdCB7bnVtYmVyfSAqL1xuICAgIHRoaXMubGltaXRfID0gbGltaXQ7XG4gICAgLyoqIEBwcml2YXRlIEBjb25zdCB7ZnVuY3Rpb24oKX0gKi9cbiAgICB0aGlzLmNyZWF0ZV8gPSBjcmVhdGU7XG4gICAgLyoqIEBwcml2YXRlIEBjb25zdCB7ZnVuY3Rpb24oSVRFTSk6dm9pZH0gKi9cbiAgICB0aGlzLnJlc2V0XyA9IHJlc2V0O1xuXG4gICAgLyoqIEBwcml2YXRlIHtudW1iZXJ9ICovXG4gICAgdGhpcy5vY2N1cGFudHNfID0gMDtcbiAgICAvKiogQHByaXZhdGUge0lURU19ICovXG4gICAgdGhpcy5oZWFkXyA9IG51bGw7XG4gIH1cblxuICAvKipcbiAgICogQHJldHVybiB7SVRFTX1cbiAgICovXG4gIGdldCgpIHtcbiAgICBsZXQgaXRlbTtcbiAgICBpZiAodGhpcy5vY2N1cGFudHNfID4gMCkge1xuICAgICAgdGhpcy5vY2N1cGFudHNfLS07XG4gICAgICBpdGVtID0gdGhpcy5oZWFkXztcbiAgICAgIHRoaXMuaGVhZF8gPSBpdGVtLm5leHQ7XG4gICAgICBpdGVtLm5leHQgPSBudWxsO1xuICAgIH0gZWxzZSB7XG4gICAgICBpdGVtID0gdGhpcy5jcmVhdGVfKCk7XG4gICAgfVxuICAgIHJldHVybiBpdGVtO1xuICB9XG5cbiAgLyoqXG4gICAqIEBwYXJhbSB7SVRFTX0gaXRlbSBBbiBpdGVtIGF2YWlsYWJsZSBmb3IgcG9zc2libGUgZnV0dXJlIHJldXNlLlxuICAgKi9cbiAgcHV0KGl0ZW0pIHtcbiAgICB0aGlzLnJlc2V0XyhpdGVtKTtcbiAgICBpZiAodGhpcy5vY2N1cGFudHNfIDwgdGhpcy5saW1pdF8pIHtcbiAgICAgIHRoaXMub2NjdXBhbnRzXysrO1xuICAgICAgaXRlbS5uZXh0ID0gdGhpcy5oZWFkXztcbiAgICAgIHRoaXMuaGVhZF8gPSBpdGVtO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBWaXNpYmxlIGZvciB0ZXN0aW5nLlxuICAgKiBAcGFja2FnZVxuICAgKiBAcmV0dXJuIHtudW1iZXJ9XG4gICAqL1xuICBvY2N1cGFudHMoKSB7XG4gICAgcmV0dXJuIHRoaXMub2NjdXBhbnRzXztcbiAgfVxufTtcbiIsICIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgVGhlIENsb3N1cmUgTGlicmFyeSBBdXRob3JzLlxuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIEBmaWxlb3ZlcnZpZXcgUHJvdmlkZXMgYSBmdW5jdGlvbiB0byB0aHJvdyBhbiBlcnJvciB3aXRob3V0IGludGVycnVwdGluZ1xuICogdGhlIGN1cnJlbnQgZXhlY3V0aW9uIGNvbnRleHQuXG4gKi9cblxuZ29vZy5tb2R1bGUoJ2dvb2cuYXN5bmMudGhyb3dFeGNlcHRpb24nKTtcbmdvb2cubW9kdWxlLmRlY2xhcmVMZWdhY3lOYW1lc3BhY2UoKTtcblxuLyoqXG4gKiBUaHJvdyBhbiBpdGVtIHdpdGhvdXQgaW50ZXJydXB0aW5nIHRoZSBjdXJyZW50IGV4ZWN1dGlvbiBjb250ZXh0LiAgRm9yXG4gKiBleGFtcGxlLCBpZiBwcm9jZXNzaW5nIGEgZ3JvdXAgb2YgaXRlbXMgaW4gYSBsb29wLCBzb21ldGltZXMgaXQgaXMgdXNlZnVsXG4gKiB0byByZXBvcnQgYW4gZXJyb3Igd2hpbGUgc3RpbGwgYWxsb3dpbmcgdGhlIHJlc3Qgb2YgdGhlIGJhdGNoIHRvIGJlXG4gKiBwcm9jZXNzZWQuXG4gKiBAcGFyYW0geyp9IGV4Y2VwdGlvblxuICovXG5mdW5jdGlvbiB0aHJvd0V4Y2VwdGlvbihleGNlcHRpb24pIHtcbiAgLy8gRWFjaCB0aHJvdyBuZWVkcyB0byBiZSBpbiBpdHMgb3duIGNvbnRleHQuXG4gIGdvb2cuZ2xvYmFsLnNldFRpbWVvdXQoKCkgPT4ge1xuICAgIHRocm93IGV4Y2VwdGlvbjtcbiAgfSwgMCk7XG59XG5leHBvcnRzID0gdGhyb3dFeGNlcHRpb247XG4iLCAiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IFRoZSBDbG9zdXJlIExpYnJhcnkgQXV0aG9ycy5cbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBAZmlsZW92ZXJ2aWV3IEEgdGltZXIgY2xhc3MgdG8gd2hpY2ggb3RoZXIgY2xhc3NlcyBhbmQgb2JqZWN0cyBjYW4gbGlzdGVuIG9uLlxuICogVGhpcyBpcyBvbmx5IGFuIGFic3RyYWN0aW9uIGFib3ZlIGBzZXRJbnRlcnZhbGAuXG4gKlxuICogQHNlZSAuLi9kZW1vcy90aW1lcnMuaHRtbFxuICovXG5cbmdvb2cucHJvdmlkZSgnZ29vZy5UaW1lcicpO1xuXG5nb29nLnJlcXVpcmUoJ2dvb2cuUHJvbWlzZScpO1xuZ29vZy5yZXF1aXJlKCdnb29nLmV2ZW50cy5FdmVudFRhcmdldCcpO1xuZ29vZy5yZXF1aXJlVHlwZSgnZ29vZy5UaGVuYWJsZScpO1xuXG5cblxuLyoqXG4gKiBDbGFzcyBmb3IgaGFuZGxpbmcgdGltaW5nIGV2ZW50cy5cbiAqXG4gKiBAcGFyYW0ge251bWJlcj19IG9wdF9pbnRlcnZhbCBOdW1iZXIgb2YgbXMgYmV0d2VlbiB0aWNrcyAoZGVmYXVsdDogMW1zKS5cbiAqIEBwYXJhbSB7T2JqZWN0PX0gb3B0X3RpbWVyT2JqZWN0ICBBbiBvYmplY3QgdGhhdCBoYXMgYHNldFRpbWVvdXRgLFxuICogICAgIGBzZXRJbnRlcnZhbGAsIGBjbGVhclRpbWVvdXRgIGFuZCBgY2xlYXJJbnRlcnZhbGBcbiAqICAgICAoZS5nLiwgYHdpbmRvd2ApLlxuICogQGNvbnN0cnVjdG9yXG4gKiBAZXh0ZW5kcyB7Z29vZy5ldmVudHMuRXZlbnRUYXJnZXR9XG4gKi9cbmdvb2cuVGltZXIgPSBmdW5jdGlvbihvcHRfaW50ZXJ2YWwsIG9wdF90aW1lck9iamVjdCkge1xuICAndXNlIHN0cmljdCc7XG4gIGdvb2cuZXZlbnRzLkV2ZW50VGFyZ2V0LmNhbGwodGhpcyk7XG5cbiAgLyoqXG4gICAqIE51bWJlciBvZiBtcyBiZXR3ZWVuIHRpY2tzXG4gICAqIEBwcml2YXRlIHtudW1iZXJ9XG4gICAqL1xuICB0aGlzLmludGVydmFsXyA9IG9wdF9pbnRlcnZhbCB8fCAxO1xuXG4gIC8qKlxuICAgKiBBbiBvYmplY3QgdGhhdCBpbXBsZW1lbnRzIGBzZXRUaW1lb3V0YCwgYHNldEludGVydmFsYCxcbiAgICogYGNsZWFyVGltZW91dGAgYW5kIGBjbGVhckludGVydmFsYC4gV2UgZGVmYXVsdCB0byB0aGUgd2luZG93XG4gICAqIG9iamVjdC4gQ2hhbmdpbmcgdGhpcyBvbiB7QGxpbmsgZ29vZy5UaW1lci5wcm90b3R5cGV9IGNoYW5nZXMgdGhlIG9iamVjdFxuICAgKiBmb3IgYWxsIHRpbWVyIGluc3RhbmNlcyB3aGljaCBjYW4gYmUgdXNlZnVsIGlmIHlvdXIgZW52aXJvbm1lbnQgaGFzIHNvbWVcbiAgICogb3RoZXIgaW1wbGVtZW50YXRpb24gb2YgdGltZXJzIHRoYW4gdGhlIGB3aW5kb3dgIG9iamVjdC5cbiAgICogQHByaXZhdGUge3tzZXRUaW1lb3V0OiFGdW5jdGlvbiwgY2xlYXJUaW1lb3V0OiFGdW5jdGlvbn19XG4gICAqL1xuICB0aGlzLnRpbWVyT2JqZWN0XyA9IC8qKiBAdHlwZSB7e3NldFRpbWVvdXQsIGNsZWFyVGltZW91dH19ICovIChcbiAgICAgIG9wdF90aW1lck9iamVjdCB8fCBnb29nLlRpbWVyLmRlZmF1bHRUaW1lck9iamVjdCk7XG5cbiAgLyoqXG4gICAqIENhY2hlZCBgdGlja19gIGJvdW5kIHRvIHRoZSBvYmplY3QgZm9yIGxhdGVyIHVzZSBpbiB0aGUgdGltZXIuXG4gICAqIEBwcml2YXRlIHtGdW5jdGlvbn1cbiAgICogQGNvbnN0XG4gICAqL1xuICB0aGlzLmJvdW5kVGlja18gPSBnb29nLmJpbmQodGhpcy50aWNrXywgdGhpcyk7XG5cbiAgLyoqXG4gICAqIEZpcmVmb3ggYnJvd3NlciBvZnRlbiBmaXJlcyB0aGUgdGltZXIgZXZlbnQgc29vbmVyIChzb21ldGltZXMgTVVDSCBzb29uZXIpXG4gICAqIHRoYW4gdGhlIHJlcXVlc3RlZCB0aW1lb3V0LiBTbyB3ZSBjb21wYXJlIHRoZSB0aW1lIHRvIHdoZW4gdGhlIGV2ZW50IHdhc1xuICAgKiBsYXN0IGZpcmVkLCBhbmQgcmVzY2hlZHVsZSBpZiBhcHByb3ByaWF0ZS4gU2VlIGFsc29cbiAgICoge0BsaW5rIGdvb2cuVGltZXIuaW50ZXJ2YWxTY2FsZX0uXG4gICAqIEBwcml2YXRlIHtudW1iZXJ9XG4gICAqL1xuICB0aGlzLmxhc3RfID0gZ29vZy5ub3coKTtcbn07XG5nb29nLmluaGVyaXRzKGdvb2cuVGltZXIsIGdvb2cuZXZlbnRzLkV2ZW50VGFyZ2V0KTtcblxuXG4vKipcbiAqIE1heGltdW0gdGltZW91dCB2YWx1ZS5cbiAqXG4gKiBUaW1lb3V0IHZhbHVlcyB0b28gYmlnIHRvIGZpdCBpbnRvIGEgc2lnbmVkIDMyLWJpdCBpbnRlZ2VyIG1heSBjYXVzZSBvdmVyZmxvd1xuICogaW4gRkYsIFNhZmFyaSwgYW5kIENocm9tZSwgcmVzdWx0aW5nIGluIHRoZSB0aW1lb3V0IGJlaW5nIHNjaGVkdWxlZFxuICogaW1tZWRpYXRlbHkuIEl0IG1ha2VzIG1vcmUgc2Vuc2Ugc2ltcGx5IG5vdCB0byBzY2hlZHVsZSB0aGVzZSB0aW1lb3V0cywgc2luY2VcbiAqIDI0LjggZGF5cyBpcyBiZXlvbmQgYSByZWFzb25hYmxlIGV4cGVjdGF0aW9uIGZvciB0aGUgYnJvd3NlciB0byBzdGF5IG9wZW4uXG4gKlxuICogQHByaXZhdGUge251bWJlcn1cbiAqIEBjb25zdFxuICovXG5nb29nLlRpbWVyLk1BWF9USU1FT1VUXyA9IDIxNDc0ODM2NDc7XG5cblxuLyoqXG4gKiBBIHRpbWVyIElEIHRoYXQgY2Fubm90IGJlIHJldHVybmVkIGJ5IGFueSBrbm93biBpbXBsZW1lbnRhdGlvbiBvZlxuICogYHdpbmRvdy5zZXRUaW1lb3V0YC4gUGFzc2luZyB0aGlzIHZhbHVlIHRvIGB3aW5kb3cuY2xlYXJUaW1lb3V0YFxuICogc2hvdWxkIHRoZXJlZm9yZSBiZSBhIG5vLW9wLlxuICpcbiAqIEBwcml2YXRlIHtudW1iZXJ9XG4gKiBAY29uc3RcbiAqL1xuZ29vZy5UaW1lci5JTlZBTElEX1RJTUVPVVRfSURfID0gLTE7XG5cblxuLyoqXG4gKiBXaGV0aGVyIHRoaXMgdGltZXIgaXMgZW5hYmxlZFxuICogQHR5cGUge2Jvb2xlYW59XG4gKi9cbmdvb2cuVGltZXIucHJvdG90eXBlLmVuYWJsZWQgPSBmYWxzZTtcblxuXG4vKipcbiAqIEFuIG9iamVjdCB0aGF0IGltcGxlbWVudHMgYHNldFRpbWVvdXRgLCBgc2V0SW50ZXJ2YWxgLFxuICogYGNsZWFyVGltZW91dGAgYW5kIGBjbGVhckludGVydmFsYC4gV2UgZGVmYXVsdCB0byB0aGUgZ2xvYmFsXG4gKiBvYmplY3QuIENoYW5naW5nIGBnb29nLlRpbWVyLmRlZmF1bHRUaW1lck9iamVjdGAgY2hhbmdlcyB0aGUgb2JqZWN0IGZvclxuICogYWxsIHRpbWVyIGluc3RhbmNlcyB3aGljaCBjYW4gYmUgdXNlZnVsIGlmIHlvdXIgZW52aXJvbm1lbnQgaGFzIHNvbWUgb3RoZXJcbiAqIGltcGxlbWVudGF0aW9uIG9mIHRpbWVycyB5b3UnZCBsaWtlIHRvIHVzZS5cbiAqIEB0eXBlIHt7c2V0VGltZW91dCwgY2xlYXJUaW1lb3V0fX1cbiAqL1xuZ29vZy5UaW1lci5kZWZhdWx0VGltZXJPYmplY3QgPSBnb29nLmdsb2JhbDtcblxuXG4vKipcbiAqIFZhcmlhYmxlIHRoYXQgY29udHJvbHMgdGhlIHRpbWVyIGVycm9yIGNvcnJlY3Rpb24uIElmIHRoZSB0aW1lciBpcyBjYWxsZWRcbiAqIGJlZm9yZSB0aGUgcmVxdWVzdGVkIGludGVydmFsIHRpbWVzIGBpbnRlcnZhbFNjYWxlYCwgd2hpY2ggb2Z0ZW5cbiAqIGhhcHBlbnMgb24gTW96aWxsYSwgdGhlIHRpbWVyIGlzIHJlc2NoZWR1bGVkLlxuICogQHNlZSB7QGxpbmsgI2xhc3RffVxuICogQHR5cGUge251bWJlcn1cbiAqL1xuZ29vZy5UaW1lci5pbnRlcnZhbFNjYWxlID0gMC44O1xuXG5cbi8qKlxuICogVmFyaWFibGUgZm9yIHN0b3JpbmcgdGhlIHJlc3VsdCBvZiBgc2V0SW50ZXJ2YWxgLlxuICogQHByaXZhdGUgez9udW1iZXJ9XG4gKi9cbmdvb2cuVGltZXIucHJvdG90eXBlLnRpbWVyXyA9IG51bGw7XG5cblxuLyoqXG4gKiBHZXRzIHRoZSBpbnRlcnZhbCBvZiB0aGUgdGltZXIuXG4gKiBAcmV0dXJuIHtudW1iZXJ9IGludGVydmFsIE51bWJlciBvZiBtcyBiZXR3ZWVuIHRpY2tzLlxuICovXG5nb29nLlRpbWVyLnByb3RvdHlwZS5nZXRJbnRlcnZhbCA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIHJldHVybiB0aGlzLmludGVydmFsXztcbn07XG5cblxuLyoqXG4gKiBTZXRzIHRoZSBpbnRlcnZhbCBvZiB0aGUgdGltZXIuXG4gKiBAcGFyYW0ge251bWJlcn0gaW50ZXJ2YWwgTnVtYmVyIG9mIG1zIGJldHdlZW4gdGlja3MuXG4gKi9cbmdvb2cuVGltZXIucHJvdG90eXBlLnNldEludGVydmFsID0gZnVuY3Rpb24oaW50ZXJ2YWwpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICB0aGlzLmludGVydmFsXyA9IGludGVydmFsO1xuICBpZiAodGhpcy50aW1lcl8gJiYgdGhpcy5lbmFibGVkKSB7XG4gICAgLy8gU3RvcCBhbmQgdGhlbiBzdGFydCB0aGUgdGltZXIgdG8gcmVzZXQgdGhlIGludGVydmFsLlxuICAgIHRoaXMuc3RvcCgpO1xuICAgIHRoaXMuc3RhcnQoKTtcbiAgfSBlbHNlIGlmICh0aGlzLnRpbWVyXykge1xuICAgIHRoaXMuc3RvcCgpO1xuICB9XG59O1xuXG5cbi8qKlxuICogQ2FsbGJhY2sgZm9yIHRoZSBgc2V0VGltZW91dGAgdXNlZCBieSB0aGUgdGltZXIuXG4gKiBAcHJpdmF0ZVxuICovXG5nb29nLlRpbWVyLnByb3RvdHlwZS50aWNrXyA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIGlmICh0aGlzLmVuYWJsZWQpIHtcbiAgICB2YXIgZWxhcHNlZCA9IGdvb2cubm93KCkgLSB0aGlzLmxhc3RfO1xuICAgIGlmIChlbGFwc2VkID4gMCAmJiBlbGFwc2VkIDwgdGhpcy5pbnRlcnZhbF8gKiBnb29nLlRpbWVyLmludGVydmFsU2NhbGUpIHtcbiAgICAgIHRoaXMudGltZXJfID0gdGhpcy50aW1lck9iamVjdF8uc2V0VGltZW91dChcbiAgICAgICAgICB0aGlzLmJvdW5kVGlja18sIHRoaXMuaW50ZXJ2YWxfIC0gZWxhcHNlZCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gUHJldmVudHMgc2V0SW50ZXJ2YWwgZnJvbSByZWdpc3RlcmluZyBhIGR1cGxpY2F0ZSB0aW1lb3V0IHdoZW4gY2FsbGVkXG4gICAgLy8gaW4gdGhlIHRpbWVyIGV2ZW50IGhhbmRsZXIuXG4gICAgaWYgKHRoaXMudGltZXJfKSB7XG4gICAgICB0aGlzLnRpbWVyT2JqZWN0Xy5jbGVhclRpbWVvdXQodGhpcy50aW1lcl8pO1xuICAgICAgdGhpcy50aW1lcl8gPSBudWxsO1xuICAgIH1cblxuICAgIHRoaXMuZGlzcGF0Y2hUaWNrKCk7XG4gICAgLy8gVGhlIHRpbWVyIGNvdWxkIGJlIHN0b3BwZWQgaW4gdGhlIHRpbWVyIGV2ZW50IGhhbmRsZXIuXG4gICAgaWYgKHRoaXMuZW5hYmxlZCkge1xuICAgICAgLy8gU3RvcCBhbmQgc3RhcnQgdG8gZW5zdXJlIHRoZXJlIGlzIGFsd2F5cyBvbmx5IG9uZSB0aW1lb3V0IGV2ZW4gaWZcbiAgICAgIC8vIHN0YXJ0IGlzIGNhbGxlZCBpbiB0aGUgdGltZXIgZXZlbnQgaGFuZGxlci5cbiAgICAgIHRoaXMuc3RvcCgpO1xuICAgICAgdGhpcy5zdGFydCgpO1xuICAgIH1cbiAgfVxufTtcblxuXG4vKipcbiAqIERpc3BhdGNoZXMgdGhlIFRJQ0sgZXZlbnQuIFRoaXMgaXMgaXRzIG93biBtZXRob2Qgc28gc3ViY2xhc3NlcyBjYW4gb3ZlcnJpZGUuXG4gKi9cbmdvb2cuVGltZXIucHJvdG90eXBlLmRpc3BhdGNoVGljayA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIHRoaXMuZGlzcGF0Y2hFdmVudChnb29nLlRpbWVyLlRJQ0spO1xufTtcblxuXG4vKipcbiAqIFN0YXJ0cyB0aGUgdGltZXIuXG4gKi9cbmdvb2cuVGltZXIucHJvdG90eXBlLnN0YXJ0ID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgdGhpcy5lbmFibGVkID0gdHJ1ZTtcblxuICAvLyBJZiB0aGVyZSBpcyBubyBpbnRlcnZhbCBhbHJlYWR5IHJlZ2lzdGVyZWQsIHN0YXJ0IGl0IG5vd1xuICBpZiAoIXRoaXMudGltZXJfKSB7XG4gICAgLy8gSU1QT1JUQU5UIVxuICAgIC8vIHdpbmRvdy5zZXRJbnRlcnZhbCBpbiBGaXJlRm94IGhhcyBhIGJ1ZyAtIGl0IGZpcmVzIGJhc2VkIG9uXG4gICAgLy8gYWJzb2x1dGUgdGltZSwgcmF0aGVyIHRoYW4gb24gcmVsYXRpdmUgdGltZS4gV2hhdCB0aGlzIG1lYW5zXG4gICAgLy8gaXMgdGhhdCBpZiBhIGNvbXB1dGVyIGlzIHNsZWVwaW5nL2hpYmVybmF0aW5nIGZvciAyNCBob3Vyc1xuICAgIC8vIGFuZCB0aGUgdGltZXIgaW50ZXJ2YWwgd2FzIGNvbmZpZ3VyZWQgdG8gZmlyZSBldmVyeSAxMDAwbXMsXG4gICAgLy8gdGhlbiBhZnRlciB0aGUgUEMgd2FrZXMgdXAgdGhlIHRpbWVyIHdpbGwgZmlyZSwgaW4gcmFwaWRcbiAgICAvLyBzdWNjZXNzaW9uLCAzNjAwKjI0IHRpbWVzLlxuICAgIC8vIFRoaXMgYnVnIGlzIGRlc2NyaWJlZCBoZXJlIGFuZCBpcyBhbHJlYWR5IGZpeGVkLCBidXQgaXQgd2lsbFxuICAgIC8vIHRha2UgdGltZSB0byBwcm9wYWdhdGUsIHNvIGZvciBub3cgSSBhbSBzd2l0Y2hpbmcgdGhpcyBvdmVyXG4gICAgLy8gdG8gc2V0VGltZW91dCBsb2dpYy5cbiAgICAvLyAgICAgaHR0cHM6Ly9idWd6aWxsYS5tb3ppbGxhLm9yZy9zaG93X2J1Zy5jZ2k/aWQ9Mzc2NjQzXG4gICAgLy9cbiAgICB0aGlzLnRpbWVyXyA9IHRoaXMudGltZXJPYmplY3RfLnNldFRpbWVvdXQodGhpcy5ib3VuZFRpY2tfLCB0aGlzLmludGVydmFsXyk7XG4gICAgdGhpcy5sYXN0XyA9IGdvb2cubm93KCk7XG4gIH1cbn07XG5cblxuLyoqXG4gKiBTdG9wcyB0aGUgdGltZXIuXG4gKi9cbmdvb2cuVGltZXIucHJvdG90eXBlLnN0b3AgPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICB0aGlzLmVuYWJsZWQgPSBmYWxzZTtcbiAgaWYgKHRoaXMudGltZXJfKSB7XG4gICAgdGhpcy50aW1lck9iamVjdF8uY2xlYXJUaW1lb3V0KHRoaXMudGltZXJfKTtcbiAgICB0aGlzLnRpbWVyXyA9IG51bGw7XG4gIH1cbn07XG5cblxuLyoqIEBvdmVycmlkZSAqL1xuZ29vZy5UaW1lci5wcm90b3R5cGUuZGlzcG9zZUludGVybmFsID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgZ29vZy5UaW1lci5zdXBlckNsYXNzXy5kaXNwb3NlSW50ZXJuYWwuY2FsbCh0aGlzKTtcbiAgdGhpcy5zdG9wKCk7XG4gIGRlbGV0ZSB0aGlzLnRpbWVyT2JqZWN0Xztcbn07XG5cblxuLyoqXG4gKiBDb25zdGFudCBmb3IgdGhlIHRpbWVyJ3MgZXZlbnQgdHlwZS5cbiAqIEBjb25zdFxuICovXG5nb29nLlRpbWVyLlRJQ0sgPSAndGljayc7XG5cblxuLyoqXG4gKiBDYWxscyB0aGUgZ2l2ZW4gZnVuY3Rpb24gb25jZSwgYWZ0ZXIgdGhlIG9wdGlvbmFsIHBhdXNlLlxuICogPHA+XG4gKiBUaGUgZnVuY3Rpb24gaXMgYWx3YXlzIGNhbGxlZCBhc3luY2hyb25vdXNseSwgZXZlbiBpZiB0aGUgZGVsYXkgaXMgMC4gVGhpc1xuICogaXMgYSBjb21tb24gdHJpY2sgdG8gc2NoZWR1bGUgYSBmdW5jdGlvbiB0byBydW4gYWZ0ZXIgYSBiYXRjaCBvZiBicm93c2VyXG4gKiBldmVudCBwcm9jZXNzaW5nLlxuICpcbiAqIEBwYXJhbSB7ZnVuY3Rpb24odGhpczpTQ09QRSl8e2hhbmRsZUV2ZW50OmZ1bmN0aW9uKCl9fG51bGx9IGxpc3RlbmVyIEZ1bmN0aW9uXG4gKiAgICAgb3Igb2JqZWN0IHRoYXQgaGFzIGEgaGFuZGxlRXZlbnQgbWV0aG9kLlxuICogQHBhcmFtIHtudW1iZXI9fSBvcHRfZGVsYXkgTWlsbGlzZWNvbmRzIHRvIHdhaXQ7IGRlZmF1bHQgaXMgMC5cbiAqIEBwYXJhbSB7U0NPUEU9fSBvcHRfaGFuZGxlciBPYmplY3QgaW4gd2hvc2Ugc2NvcGUgdG8gY2FsbCB0aGUgbGlzdGVuZXIuXG4gKiBAcmV0dXJuIHtudW1iZXJ9IEEgaGFuZGxlIHRvIHRoZSB0aW1lciBJRC5cbiAqIEB0ZW1wbGF0ZSBTQ09QRVxuICovXG5nb29nLlRpbWVyLmNhbGxPbmNlID0gZnVuY3Rpb24obGlzdGVuZXIsIG9wdF9kZWxheSwgb3B0X2hhbmRsZXIpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBpZiAodHlwZW9mIGxpc3RlbmVyID09PSAnZnVuY3Rpb24nKSB7XG4gICAgaWYgKG9wdF9oYW5kbGVyKSB7XG4gICAgICBsaXN0ZW5lciA9IGdvb2cuYmluZChsaXN0ZW5lciwgb3B0X2hhbmRsZXIpO1xuICAgIH1cbiAgfSBlbHNlIGlmIChsaXN0ZW5lciAmJiB0eXBlb2YgbGlzdGVuZXIuaGFuZGxlRXZlbnQgPT0gJ2Z1bmN0aW9uJykge1xuICAgIC8vIHVzaW5nIHR5cGVvZiB0byBwcmV2ZW50IHN0cmljdCBqcyB3YXJuaW5nXG4gICAgbGlzdGVuZXIgPSBnb29nLmJpbmQobGlzdGVuZXIuaGFuZGxlRXZlbnQsIGxpc3RlbmVyKTtcbiAgfSBlbHNlIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgbGlzdGVuZXIgYXJndW1lbnQnKTtcbiAgfVxuXG4gIGlmIChOdW1iZXIob3B0X2RlbGF5KSA+IGdvb2cuVGltZXIuTUFYX1RJTUVPVVRfKSB7XG4gICAgLy8gVGltZW91dHMgZ3JlYXRlciB0aGFuIE1BWF9JTlQgcmV0dXJuIGltbWVkaWF0ZWx5IGR1ZSB0byBpbnRlZ2VyXG4gICAgLy8gb3ZlcmZsb3cgaW4gbWFueSBicm93c2Vycy4gIFNpbmNlIE1BWF9JTlQgaXMgMjQuOCBkYXlzLCBqdXN0IGRvbid0XG4gICAgLy8gc2NoZWR1bGUgYW55dGhpbmcgYXQgYWxsLlxuICAgIHJldHVybiBnb29nLlRpbWVyLklOVkFMSURfVElNRU9VVF9JRF87XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIGdvb2cuVGltZXIuZGVmYXVsdFRpbWVyT2JqZWN0LnNldFRpbWVvdXQobGlzdGVuZXIsIG9wdF9kZWxheSB8fCAwKTtcbiAgfVxufTtcblxuXG4vKipcbiAqIENsZWFycyBhIHRpbWVvdXQgaW5pdGlhdGVkIGJ5IHtAbGluayAjY2FsbE9uY2V9LlxuICogQHBhcmFtIHs/bnVtYmVyfSB0aW1lcklkIEEgdGltZXIgSUQuXG4gKi9cbmdvb2cuVGltZXIuY2xlYXIgPSBmdW5jdGlvbih0aW1lcklkKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgZ29vZy5UaW1lci5kZWZhdWx0VGltZXJPYmplY3QuY2xlYXJUaW1lb3V0KHRpbWVySWQpO1xufTtcblxuXG4vKipcbiAqIEBwYXJhbSB7bnVtYmVyfSBkZWxheSBNaWxsaXNlY29uZHMgdG8gd2FpdC5cbiAqIEBwYXJhbSB7KFJFU1VMVHxnb29nLlRoZW5hYmxlPFJFU1VMVD58VGhlbmFibGUpPX0gb3B0X3Jlc3VsdCBUaGUgdmFsdWVcbiAqICAgICB3aXRoIHdoaWNoIHRoZSBwcm9taXNlIHdpbGwgYmUgcmVzb2x2ZWQuXG4gKiBAcmV0dXJuIHshZ29vZy5Qcm9taXNlPFJFU1VMVD59IEEgcHJvbWlzZSB0aGF0IHdpbGwgYmUgcmVzb2x2ZWQgYWZ0ZXJcbiAqICAgICB0aGUgc3BlY2lmaWVkIGRlbGF5LCB1bmxlc3MgaXQgaXMgY2FuY2VsZWQgZmlyc3QuXG4gKiBAdGVtcGxhdGUgUkVTVUxUXG4gKi9cbmdvb2cuVGltZXIucHJvbWlzZSA9IGZ1bmN0aW9uKGRlbGF5LCBvcHRfcmVzdWx0KSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgdmFyIHRpbWVyS2V5ID0gbnVsbDtcbiAgcmV0dXJuIG5ldyBnb29nXG4gICAgICAuUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgJ3VzZSBzdHJpY3QnO1xuICAgICAgICB0aW1lcktleSA9IGdvb2cuVGltZXIuY2FsbE9uY2UoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgJ3VzZSBzdHJpY3QnO1xuICAgICAgICAgIHJlc29sdmUob3B0X3Jlc3VsdCk7XG4gICAgICAgIH0sIGRlbGF5KTtcbiAgICAgICAgaWYgKHRpbWVyS2V5ID09IGdvb2cuVGltZXIuSU5WQUxJRF9USU1FT1VUX0lEXykge1xuICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IoJ0ZhaWxlZCB0byBzY2hlZHVsZSB0aW1lci4nKSk7XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgICAudGhlbkNhdGNoKGZ1bmN0aW9uKGVycm9yKSB7XG4gICAgICAgICd1c2Ugc3RyaWN0JztcbiAgICAgICAgLy8gQ2xlYXIgdGhlIHRpbWVyLiBUaGUgbW9zdCBsaWtlbHkgcmVhc29uIGlzIFwiY2FuY2VsXCIgc2lnbmFsLlxuICAgICAgICBnb29nLlRpbWVyLmNsZWFyKHRpbWVyS2V5KTtcbiAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICB9KTtcbn07XG4iLCAiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IFRoZSBDbG9zdXJlIExpYnJhcnkgQXV0aG9ycy5cbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBAZmlsZW92ZXJ2aWV3IERlZmluaXRpb24gb2YgdGhlIGdvb2cuYXN5bmMuVGhyb3R0bGUgY2xhc3MuXG4gKlxuICogQHNlZSAuLi9kZW1vcy90aW1lcnMuaHRtbFxuICovXG5cbmdvb2cubW9kdWxlKCdnb29nLmFzeW5jLlRocm90dGxlJyk7XG5nb29nLm1vZHVsZS5kZWNsYXJlTGVnYWN5TmFtZXNwYWNlKCk7XG5cbmNvbnN0IERpc3Bvc2FibGUgPSBnb29nLnJlcXVpcmUoJ2dvb2cuRGlzcG9zYWJsZScpO1xuY29uc3QgVGltZXIgPSBnb29nLnJlcXVpcmUoJ2dvb2cuVGltZXInKTtcblxuXG4vKipcbiAqIFRocm90dGxlIHdpbGwgcGVyZm9ybSBhbiBhY3Rpb24gdGhhdCBpcyBwYXNzZWQgaW4gbm8gbW9yZSB0aGFuIG9uY2VcbiAqIHBlciBpbnRlcnZhbCAoc3BlY2lmaWVkIGluIG1pbGxpc2Vjb25kcykuIElmIGl0IGdldHMgbXVsdGlwbGUgc2lnbmFsc1xuICogdG8gcGVyZm9ybSB0aGUgYWN0aW9uIHdoaWxlIGl0IGlzIHdhaXRpbmcsIGl0IHdpbGwgb25seSBwZXJmb3JtIHRoZSBhY3Rpb25cbiAqIG9uY2UgYXQgdGhlIGVuZCBvZiB0aGUgaW50ZXJ2YWwuXG4gKiBAZmluYWxcbiAqIEB0ZW1wbGF0ZSBUXG4gKi9cbmNsYXNzIFRocm90dGxlIGV4dGVuZHMgRGlzcG9zYWJsZSB7XG4gIC8qKlxuICAgKiBAcGFyYW0ge2Z1bmN0aW9uKHRoaXM6IFQsIC4uLj8pfSBsaXN0ZW5lciBGdW5jdGlvbiB0byBjYWxsYmFjayB3aGVuIHRoZVxuICAgKiAgICAgYWN0aW9uIGlzIHRyaWdnZXJlZC5cbiAgICogQHBhcmFtIHtudW1iZXJ9IGludGVydmFsIEludGVydmFsIG92ZXIgd2hpY2ggdG8gdGhyb3R0bGUuIFRoZSBsaXN0ZW5lciBjYW5cbiAgICogICAgIG9ubHkgYmUgY2FsbGVkIG9uY2UgcGVyIGludGVydmFsLlxuICAgKiBAcGFyYW0ge1Q9fSBoYW5kbGVyIE9iamVjdCBpbiB3aG9zZSBzY29wZSB0byBjYWxsIHRoZSBsaXN0ZW5lci5cbiAgICovXG4gIGNvbnN0cnVjdG9yKGxpc3RlbmVyLCBpbnRlcnZhbCwgaGFuZGxlcikge1xuICAgIHN1cGVyKCk7XG4gICAgLyoqXG4gICAgICogRnVuY3Rpb24gdG8gY2FsbGJhY2tcbiAgICAgKiBAdHlwZSB7ZnVuY3Rpb24odGhpczogVCwgLi4uPyl9XG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICB0aGlzLmxpc3RlbmVyXyA9IGhhbmRsZXIgIT0gbnVsbCA/IGxpc3RlbmVyLmJpbmQoaGFuZGxlcikgOiBsaXN0ZW5lcjtcblxuICAgIC8qKlxuICAgICAqIEludGVydmFsIGZvciB0aGUgdGhyb3R0bGUgdGltZVxuICAgICAqIEB0eXBlIHtudW1iZXJ9XG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICB0aGlzLmludGVydmFsXyA9IGludGVydmFsO1xuXG4gICAgLyoqXG4gICAgICogVGhlIGxhc3QgYXJndW1lbnRzIHBhc3NlZCBpbnRvIGBmaXJlYCwgb3IgbnVsbCBpZiB0aGVyZSBpcyBubyBwZW5kaW5nXG4gICAgICogY2FsbC5cbiAgICAgKiBAcHJpdmF0ZSB7P0lBcnJheUxpa2V9XG4gICAgICovXG4gICAgdGhpcy5hcmdzXyA9IG51bGw7XG5cbiAgICAvKipcbiAgICAgKiBJbmRpY2F0ZXMgdGhhdCB0aGUgYWN0aW9uIGlzIHBlbmRpbmcgYW5kIG5lZWRzIHRvIGJlIGZpcmVkLlxuICAgICAqIEB0eXBlIHtib29sZWFufVxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgdGhpcy5zaG91bGRGaXJlXyA9IGZhbHNlO1xuXG4gICAgLyoqXG4gICAgICogSW5kaWNhdGVzIHRoZSBjb3VudCBvZiBuZXN0ZWQgcGF1c2VzIGN1cnJlbnRseSBpbiBlZmZlY3Qgb24gdGhlIHRocm90dGxlLlxuICAgICAqIFdoZW4gdGhpcyBjb3VudCBpcyBub3QgemVybywgZmlyZWQgYWN0aW9ucyB3aWxsIGJlIHBvc3Rwb25lZCB1bnRpbCB0aGVcbiAgICAgKiB0aHJvdHRsZSBpcyByZXN1bWVkIGVub3VnaCB0aW1lcyB0byBkcm9wIHRoZSBwYXVzZSBjb3VudCB0byB6ZXJvLlxuICAgICAqIEB0eXBlIHtudW1iZXJ9XG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICB0aGlzLnBhdXNlQ291bnRfID0gMDtcblxuICAgIC8qKlxuICAgICAqIFRpbWVyIGZvciBzY2hlZHVsaW5nIHRoZSBuZXh0IGNhbGxiYWNrXG4gICAgICogQHR5cGUgez9udW1iZXJ9XG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICB0aGlzLnRpbWVyXyA9IG51bGw7XG4gIH1cblxuICAvKipcbiAgICogTm90aWZpZXMgdGhlIHRocm90dGxlIHRoYXQgdGhlIGFjdGlvbiBoYXMgaGFwcGVuZWQuIEl0IHdpbGwgdGhyb3R0bGVcbiAgICogdGhlIGNhbGwgc28gdGhhdCB0aGUgY2FsbGJhY2sgaXMgbm90IGNhbGxlZCB0b28gb2Z0ZW4gYWNjb3JkaW5nIHRvIHRoZVxuICAgKiBpbnRlcnZhbCBwYXJhbWV0ZXIgcGFzc2VkIHRvIHRoZSBjb25zdHJ1Y3RvciwgcGFzc2luZyB0aGUgYXJndW1lbnRzXG4gICAqIGZyb20gdGhlIGxhc3QgY2FsbCBvZiB0aGlzIGZ1bmN0aW9uIGludG8gdGhlIHRocm90dGxlZCBmdW5jdGlvbi5cbiAgICogQHBhcmFtIHsuLi4/fSB2YXJfYXJncyBBcmd1bWVudHMgdG8gcGFzcyBvbiB0byB0aGUgdGhyb3R0bGVkIGZ1bmN0aW9uLlxuICAgKi9cbiAgZmlyZSh2YXJfYXJncykge1xuICAgIHRoaXMuYXJnc18gPSBhcmd1bWVudHM7XG4gICAgaWYgKCF0aGlzLnRpbWVyXyAmJiAhdGhpcy5wYXVzZUNvdW50Xykge1xuICAgICAgdGhpcy5kb0FjdGlvbl8oKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5zaG91bGRGaXJlXyA9IHRydWU7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENhbmNlbHMgYW55IHBlbmRpbmcgYWN0aW9uIGNhbGxiYWNrLiBUaGUgdGhyb3R0bGUgY2FuIGJlIHJlc3RhcnRlZCBieVxuICAgKiBjYWxsaW5nIHtAbGluayAjZmlyZX0uXG4gICAqL1xuICBzdG9wKCkge1xuICAgIGlmICh0aGlzLnRpbWVyXykge1xuICAgICAgVGltZXIuY2xlYXIodGhpcy50aW1lcl8pO1xuICAgICAgdGhpcy50aW1lcl8gPSBudWxsO1xuICAgICAgdGhpcy5zaG91bGRGaXJlXyA9IGZhbHNlO1xuICAgICAgdGhpcy5hcmdzXyA9IG51bGw7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFBhdXNlcyB0aGUgdGhyb3R0bGUuICBBbGwgcGVuZGluZyBhbmQgZnV0dXJlIGFjdGlvbiBjYWxsYmFja3Mgd2lsbCBiZVxuICAgKiBkZWxheWVkIHVudGlsIHRoZSB0aHJvdHRsZSBpcyByZXN1bWVkLiAgUGF1c2VzIGNhbiBiZSBuZXN0ZWQuXG4gICAqL1xuICBwYXVzZSgpIHtcbiAgICB0aGlzLnBhdXNlQ291bnRfKys7XG4gIH1cblxuICAvKipcbiAgICogUmVzdW1lcyB0aGUgdGhyb3R0bGUuICBJZiBkb2luZyBzbyBkcm9wcyB0aGUgcGF1c2luZyBjb3VudCB0byB6ZXJvLFxuICAgKiBwZW5kaW5nIGFjdGlvbiBjYWxsYmFja3Mgd2lsbCBiZSBleGVjdXRlZCBhcyBzb29uIGFzIHBvc3NpYmxlLCBidXRcbiAgICogc3RpbGwgbm8gc29vbmVyIHRoYW4gYW4gaW50ZXJ2YWwncyBkZWxheSBhZnRlciB0aGUgcHJldmlvdXMgY2FsbC5cbiAgICogRnV0dXJlIGFjdGlvbiBjYWxsYmFja3Mgd2lsbCBiZSBleGVjdXRlZCBhcyBub3JtYWwuXG4gICAqL1xuICByZXN1bWUoKSB7XG4gICAgdGhpcy5wYXVzZUNvdW50Xy0tO1xuICAgIGlmICghdGhpcy5wYXVzZUNvdW50XyAmJiB0aGlzLnNob3VsZEZpcmVfICYmICF0aGlzLnRpbWVyXykge1xuICAgICAgdGhpcy5zaG91bGRGaXJlXyA9IGZhbHNlO1xuICAgICAgdGhpcy5kb0FjdGlvbl8oKTtcbiAgICB9XG4gIH1cblxuICAvKiogQG92ZXJyaWRlICovXG4gIGRpc3Bvc2VJbnRlcm5hbCgpIHtcbiAgICBzdXBlci5kaXNwb3NlSW50ZXJuYWwoKTtcbiAgICB0aGlzLnN0b3AoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBIYW5kbGVyIGZvciB0aGUgdGltZXIgdG8gZmlyZSB0aGUgdGhyb3R0bGVcbiAgICogQHByaXZhdGVcbiAgICovXG4gIG9uVGltZXJfKCkge1xuICAgIHRoaXMudGltZXJfID0gbnVsbDtcblxuICAgIGlmICh0aGlzLnNob3VsZEZpcmVfICYmICF0aGlzLnBhdXNlQ291bnRfKSB7XG4gICAgICB0aGlzLnNob3VsZEZpcmVfID0gZmFsc2U7XG4gICAgICB0aGlzLmRvQWN0aW9uXygpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDYWxscyB0aGUgY2FsbGJhY2tcbiAgICogQHByaXZhdGVcbiAgICovXG4gIGRvQWN0aW9uXygpIHtcbiAgICB0aGlzLnRpbWVyXyA9IFRpbWVyLmNhbGxPbmNlKCgpID0+IHRoaXMub25UaW1lcl8oKSwgdGhpcy5pbnRlcnZhbF8pO1xuICAgIGNvbnN0IGFyZ3MgPSB0aGlzLmFyZ3NfO1xuICAgIC8vIHJlbGVhc2UgbWVtb3J5IGZpcnN0IHNvIGl0IGFsd2F5cyBoYXBwZW5zIGV2ZW4gaWYgbGlzdGVuZXIgdGhyb3dzXG4gICAgdGhpcy5hcmdzXyA9IG51bGw7XG4gICAgdGhpcy5saXN0ZW5lcl8uYXBwbHkobnVsbCwgYXJncyk7XG4gIH1cbn1cblxuZXhwb3J0cyA9IFRocm90dGxlO1xuIiwgIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCBUaGUgQ2xvc3VyZSBMaWJyYXJ5IEF1dGhvcnMuXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogQGZpbGVvdmVydmlldyBDbGFzcyB0byBjcmVhdGUgb2JqZWN0cyB3aGljaCB3YW50IHRvIGhhbmRsZSBtdWx0aXBsZSBldmVudHNcbiAqIGFuZCBoYXZlIHRoZWlyIGxpc3RlbmVycyBlYXNpbHkgY2xlYW5lZCB1cCB2aWEgYSBkaXNwb3NlIG1ldGhvZC5cbiAqXG4gKiBFeGFtcGxlOlxuICogPHByZT5cbiAqIGZ1bmN0aW9uIFNvbWV0aGluZygpIHtcbiAqICAgU29tZXRoaW5nLmJhc2UodGhpcyk7XG4gKlxuICogICAuLi4gc2V0IHVwIG9iamVjdCAuLi5cbiAqXG4gKiAgIC8vIEFkZCBldmVudCBsaXN0ZW5lcnNcbiAqICAgdGhpcy5saXN0ZW4odGhpcy5zdGFyRWwsIGdvb2cuZXZlbnRzLkV2ZW50VHlwZS5DTElDSywgdGhpcy5oYW5kbGVTdGFyKTtcbiAqICAgdGhpcy5saXN0ZW4odGhpcy5oZWFkZXJFbCwgZ29vZy5ldmVudHMuRXZlbnRUeXBlLkNMSUNLLCB0aGlzLmV4cGFuZCk7XG4gKiAgIHRoaXMubGlzdGVuKHRoaXMuY29sbGFwc2VFbCwgZ29vZy5ldmVudHMuRXZlbnRUeXBlLkNMSUNLLCB0aGlzLmNvbGxhcHNlKTtcbiAqICAgdGhpcy5saXN0ZW4odGhpcy5pbmZvRWwsIGdvb2cuZXZlbnRzLkV2ZW50VHlwZS5NT1VTRU9WRVIsIHRoaXMuc2hvd0hvdmVyKTtcbiAqICAgdGhpcy5saXN0ZW4odGhpcy5pbmZvRWwsIGdvb2cuZXZlbnRzLkV2ZW50VHlwZS5NT1VTRU9VVCwgdGhpcy5oaWRlSG92ZXIpO1xuICogfVxuICogZ29vZy5pbmhlcml0cyhTb21ldGhpbmcsIGdvb2cuZXZlbnRzLkV2ZW50SGFuZGxlcik7XG4gKlxuICogU29tZXRoaW5nLnByb3RvdHlwZS5kaXNwb3NlSW50ZXJuYWwgPSBmdW5jdGlvbigpIHtcbiAqICAgU29tZXRoaW5nLmJhc2UodGhpcywgJ2Rpc3Bvc2VJbnRlcm5hbCcpO1xuICogICBnb29nLmRvbS5yZW1vdmVOb2RlKHRoaXMuY29udGFpbmVyKTtcbiAqIH07XG4gKlxuICpcbiAqIC8vIFRoZW4gZWxzZXdoZXJlOlxuICpcbiAqIHZhciBhY3RpdmVTb21ldGhpbmcgPSBudWxsO1xuICogZnVuY3Rpb24gb3BlblNvbWV0aGluZygpIHtcbiAqICAgYWN0aXZlU29tZXRoaW5nID0gbmV3IFNvbWV0aGluZygpO1xuICogfVxuICpcbiAqIGZ1bmN0aW9uIGNsb3NlU29tZXRoaW5nKCkge1xuICogICBpZiAoYWN0aXZlU29tZXRoaW5nKSB7XG4gKiAgICAgYWN0aXZlU29tZXRoaW5nLmRpc3Bvc2UoKTsgIC8vIFJlbW92ZSBldmVudCBsaXN0ZW5lcnNcbiAqICAgICBhY3RpdmVTb21ldGhpbmcgPSBudWxsO1xuICogICB9XG4gKiB9XG4gKiA8L3ByZT5cbiAqL1xuXG5nb29nLnByb3ZpZGUoJ2dvb2cuZXZlbnRzLkV2ZW50SGFuZGxlcicpO1xuXG5nb29nLnJlcXVpcmUoJ2dvb2cuRGlzcG9zYWJsZScpO1xuZ29vZy5yZXF1aXJlKCdnb29nLmV2ZW50cycpO1xuZ29vZy5yZXF1aXJlKCdnb29nLm9iamVjdCcpO1xuZ29vZy5yZXF1aXJlVHlwZSgnZ29vZy5ldmVudHMuRXZlbnQnKTtcbmdvb2cucmVxdWlyZVR5cGUoJ2dvb2cuZXZlbnRzLkV2ZW50SWQnKTtcbmdvb2cucmVxdWlyZVR5cGUoJ2dvb2cuZXZlbnRzLkV2ZW50VGFyZ2V0Jyk7XG5nb29nLnJlcXVpcmVUeXBlKCdnb29nLmV2ZW50cy5FdmVudFdyYXBwZXInKTtcblxuXG5cbi8qKlxuICogU3VwZXIgY2xhc3MgZm9yIG9iamVjdHMgdGhhdCB3YW50IHRvIGVhc2lseSBtYW5hZ2UgYSBudW1iZXIgb2YgZXZlbnRcbiAqIGxpc3RlbmVycy4gIEl0IGFsbG93cyBhIHNob3J0IGN1dCB0byBsaXN0ZW4gYW5kIGFsc28gcHJvdmlkZXMgYSBxdWljayB3YXlcbiAqIHRvIHJlbW92ZSBhbGwgZXZlbnRzIGxpc3RlbmVycyBiZWxvbmdpbmcgdG8gdGhpcyBvYmplY3QuXG4gKiBAcGFyYW0ge1NDT1BFPX0gb3B0X3Njb3BlIE9iamVjdCBpbiB3aG9zZSBzY29wZSB0byBjYWxsIHRoZSBsaXN0ZW5lcnMuXG4gKiBAY29uc3RydWN0b3JcbiAqIEBleHRlbmRzIHtnb29nLkRpc3Bvc2FibGV9XG4gKiBAdGVtcGxhdGUgU0NPUEVcbiAqL1xuZ29vZy5ldmVudHMuRXZlbnRIYW5kbGVyID0gZnVuY3Rpb24ob3B0X3Njb3BlKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgZ29vZy5EaXNwb3NhYmxlLmNhbGwodGhpcyk7XG4gIC8vIFRPRE8obWtuaWNoZWwpOiBSZW5hbWUgdGhpcyB0byB0aGlzLnNjb3BlXyBhbmQgZml4IHRoZSBjbGFzc2VzIGluIGdvb2dsZTNcbiAgLy8gdGhhdCBhY2Nlc3MgdGhpcyBwcml2YXRlIHZhcmlhYmxlLiA6KFxuICB0aGlzLmhhbmRsZXJfID0gb3B0X3Njb3BlO1xuXG4gIC8qKlxuICAgKiBLZXlzIGZvciBldmVudHMgdGhhdCBhcmUgYmVpbmcgbGlzdGVuZWQgdG8uXG4gICAqIEB0eXBlIHshT2JqZWN0PCFnb29nLmV2ZW50cy5LZXk+fVxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgdGhpcy5rZXlzXyA9IHt9O1xufTtcbmdvb2cuaW5oZXJpdHMoZ29vZy5ldmVudHMuRXZlbnRIYW5kbGVyLCBnb29nLkRpc3Bvc2FibGUpO1xuXG5cbi8qKlxuICogVXRpbGl0eSBhcnJheSB1c2VkIHRvIHVuaWZ5IHRoZSBjYXNlcyBvZiBsaXN0ZW5pbmcgZm9yIGFuIGFycmF5IG9mIHR5cGVzXG4gKiBhbmQgbGlzdGVuaW5nIGZvciBhIHNpbmdsZSBldmVudCwgd2l0aG91dCB1c2luZyByZWN1cnNpb24gb3IgYWxsb2NhdGluZ1xuICogYW4gYXJyYXkgZWFjaCB0aW1lLlxuICogQHR5cGUgeyFBcnJheTxzdHJpbmc+fVxuICogQGNvbnN0XG4gKiBAcHJpdmF0ZVxuICovXG5nb29nLmV2ZW50cy5FdmVudEhhbmRsZXIudHlwZUFycmF5XyA9IFtdO1xuXG5cbi8qKlxuICogTGlzdGVuIHRvIGFuIGV2ZW50IG9uIGEgTGlzdGVuYWJsZS4gIElmIHRoZSBmdW5jdGlvbiBpcyBvbWl0dGVkIHRoZW4gdGhlXG4gKiBFdmVudEhhbmRsZXIncyBoYW5kbGVFdmVudCBtZXRob2Qgd2lsbCBiZSB1c2VkLlxuICogQHBhcmFtIHtnb29nLmV2ZW50cy5MaXN0ZW5hYmxlVHlwZX0gc3JjIEV2ZW50IHNvdXJjZS5cbiAqIEBwYXJhbSB7c3RyaW5nfEFycmF5PHN0cmluZz58XG4gKiAgICAgIWdvb2cuZXZlbnRzLkV2ZW50SWQ8RVZFTlRPQko+fCFBcnJheTwhZ29vZy5ldmVudHMuRXZlbnRJZDxFVkVOVE9CSj4+fVxuICogICAgIHR5cGUgRXZlbnQgdHlwZSB0byBsaXN0ZW4gZm9yIG9yIGFycmF5IG9mIGV2ZW50IHR5cGVzLlxuICogQHBhcmFtIHtmdW5jdGlvbih0aGlzOlNDT1BFLCBFVkVOVE9CSik6P3x7aGFuZGxlRXZlbnQ6ZnVuY3Rpb24oPyk6P318bnVsbD19XG4gKiAgICAgb3B0X2ZuIE9wdGlvbmFsIGNhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIHVzZWQgYXMgdGhlIGxpc3RlbmVyIG9yIGFuIG9iamVjdFxuICogICAgIHdpdGggaGFuZGxlRXZlbnQgZnVuY3Rpb24uXG4gKiBAcGFyYW0geyhib29sZWFufCFBZGRFdmVudExpc3RlbmVyT3B0aW9ucyk9fSBvcHRfb3B0aW9uc1xuICogQHJldHVybiB7VEhJU30gVGhpcyBvYmplY3QsIGFsbG93aW5nIGZvciBjaGFpbmluZyBvZiBjYWxscy5cbiAqIEB0aGlzIHtUSElTfVxuICogQHRlbXBsYXRlIEVWRU5UT0JKLCBUSElTXG4gKi9cbmdvb2cuZXZlbnRzLkV2ZW50SGFuZGxlci5wcm90b3R5cGUubGlzdGVuID0gZnVuY3Rpb24oXG4gICAgc3JjLCB0eXBlLCBvcHRfZm4sIG9wdF9vcHRpb25zKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgdmFyIHNlbGYgPSAvKiogQHR5cGUgeyFnb29nLmV2ZW50cy5FdmVudEhhbmRsZXJ9ICovICh0aGlzKTtcbiAgcmV0dXJuIHNlbGYubGlzdGVuXyhzcmMsIHR5cGUsIG9wdF9mbiwgb3B0X29wdGlvbnMpO1xufTtcblxuXG4vKipcbiAqIExpc3RlbiB0byBhbiBldmVudCBvbiBhIExpc3RlbmFibGUuICBJZiB0aGUgZnVuY3Rpb24gaXMgb21pdHRlZCB0aGVuIHRoZVxuICogRXZlbnRIYW5kbGVyJ3MgaGFuZGxlRXZlbnQgbWV0aG9kIHdpbGwgYmUgdXNlZC5cbiAqIEBwYXJhbSB7Z29vZy5ldmVudHMuTGlzdGVuYWJsZVR5cGV9IHNyYyBFdmVudCBzb3VyY2UuXG4gKiBAcGFyYW0ge3N0cmluZ3xBcnJheTxzdHJpbmc+fFxuICogICAgICFnb29nLmV2ZW50cy5FdmVudElkPEVWRU5UT0JKPnwhQXJyYXk8IWdvb2cuZXZlbnRzLkV2ZW50SWQ8RVZFTlRPQko+Pn1cbiAqICAgICB0eXBlIEV2ZW50IHR5cGUgdG8gbGlzdGVuIGZvciBvciBhcnJheSBvZiBldmVudCB0eXBlcy5cbiAqIEBwYXJhbSB7ZnVuY3Rpb24odGhpczpULCBFVkVOVE9CSik6P3x7aGFuZGxlRXZlbnQ6ZnVuY3Rpb24odGhpczpULCA/KTo/fXxcbiAqICAgICBudWxsfHVuZGVmaW5lZH0gZm4gT3B0aW9uYWwgY2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgdXNlZCBhcyB0aGVcbiAqICAgICBsaXN0ZW5lciBvciBhbiBvYmplY3Qgd2l0aCBoYW5kbGVFdmVudCBmdW5jdGlvbi5cbiAqIEBwYXJhbSB7Ym9vbGVhbnwhQWRkRXZlbnRMaXN0ZW5lck9wdGlvbnN8dW5kZWZpbmVkfSBvcHRpb25zXG4gKiBAcGFyYW0ge1R9IHNjb3BlIE9iamVjdCBpbiB3aG9zZSBzY29wZSB0byBjYWxsIHRoZSBsaXN0ZW5lci5cbiAqIEByZXR1cm4ge1RISVN9IFRoaXMgb2JqZWN0LCBhbGxvd2luZyBmb3IgY2hhaW5pbmcgb2YgY2FsbHMuXG4gKiBAdGhpcyB7VEhJU31cbiAqIEB0ZW1wbGF0ZSBULCBFVkVOVE9CSiwgVEhJU1xuICovXG5nb29nLmV2ZW50cy5FdmVudEhhbmRsZXIucHJvdG90eXBlLmxpc3RlbldpdGhTY29wZSA9IGZ1bmN0aW9uKFxuICAgIHNyYywgdHlwZSwgZm4sIG9wdGlvbnMsIHNjb3BlKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgdmFyIHNlbGYgPSAvKiogQHR5cGUgeyFnb29nLmV2ZW50cy5FdmVudEhhbmRsZXJ9ICovICh0aGlzKTtcbiAgLy8gVE9ETyhta25pY2hlbCk6IERlcHJlY2F0ZSB0aGlzIGZ1bmN0aW9uLlxuICByZXR1cm4gc2VsZi5saXN0ZW5fKHNyYywgdHlwZSwgZm4sIG9wdGlvbnMsIHNjb3BlKTtcbn07XG5cblxuLyoqXG4gKiBMaXN0ZW4gdG8gYW4gZXZlbnQgb24gYSBMaXN0ZW5hYmxlLiAgSWYgdGhlIGZ1bmN0aW9uIGlzIG9taXR0ZWQgdGhlbiB0aGVcbiAqIEV2ZW50SGFuZGxlcidzIGhhbmRsZUV2ZW50IG1ldGhvZCB3aWxsIGJlIHVzZWQuXG4gKiBAcGFyYW0ge2dvb2cuZXZlbnRzLkxpc3RlbmFibGVUeXBlfSBzcmMgRXZlbnQgc291cmNlLlxuICogQHBhcmFtIHtzdHJpbmd8QXJyYXk8c3RyaW5nPnxcbiAqICAgICAhZ29vZy5ldmVudHMuRXZlbnRJZDxFVkVOVE9CSj58IUFycmF5PCFnb29nLmV2ZW50cy5FdmVudElkPEVWRU5UT0JKPj59XG4gKiAgICAgdHlwZSBFdmVudCB0eXBlIHRvIGxpc3RlbiBmb3Igb3IgYXJyYXkgb2YgZXZlbnQgdHlwZXMuXG4gKiBAcGFyYW0ge2Z1bmN0aW9uKEVWRU5UT0JKKTo/fHtoYW5kbGVFdmVudDpmdW5jdGlvbig/KTo/fXxudWxsPX0gb3B0X2ZuXG4gKiAgICAgT3B0aW9uYWwgY2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgdXNlZCBhcyB0aGUgbGlzdGVuZXIgb3IgYW4gb2JqZWN0IHdpdGhcbiAqICAgICBoYW5kbGVFdmVudCBmdW5jdGlvbi5cbiAqIEBwYXJhbSB7KGJvb2xlYW58IUFkZEV2ZW50TGlzdGVuZXJPcHRpb25zKT19IG9wdF9vcHRpb25zXG4gKiBAcGFyYW0ge09iamVjdD19IG9wdF9zY29wZSBPYmplY3QgaW4gd2hvc2Ugc2NvcGUgdG8gY2FsbCB0aGUgbGlzdGVuZXIuXG4gKiBAcmV0dXJuIHtUSElTfSBUaGlzIG9iamVjdCwgYWxsb3dpbmcgZm9yIGNoYWluaW5nIG9mIGNhbGxzLlxuICogQHRoaXMge1RISVN9XG4gKiBAdGVtcGxhdGUgRVZFTlRPQkosIFRISVNcbiAqIEBwcml2YXRlXG4gKi9cbmdvb2cuZXZlbnRzLkV2ZW50SGFuZGxlci5wcm90b3R5cGUubGlzdGVuXyA9IGZ1bmN0aW9uKFxuICAgIHNyYywgdHlwZSwgb3B0X2ZuLCBvcHRfb3B0aW9ucywgb3B0X3Njb3BlKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgdmFyIHNlbGYgPSAvKiogQHR5cGUgeyFnb29nLmV2ZW50cy5FdmVudEhhbmRsZXJ9ICovICh0aGlzKTtcbiAgaWYgKCFBcnJheS5pc0FycmF5KHR5cGUpKSB7XG4gICAgaWYgKHR5cGUpIHtcbiAgICAgIGdvb2cuZXZlbnRzLkV2ZW50SGFuZGxlci50eXBlQXJyYXlfWzBdID0gdHlwZS50b1N0cmluZygpO1xuICAgIH1cbiAgICB0eXBlID0gZ29vZy5ldmVudHMuRXZlbnRIYW5kbGVyLnR5cGVBcnJheV87XG4gIH1cbiAgZm9yICh2YXIgaSA9IDA7IGkgPCB0eXBlLmxlbmd0aDsgaSsrKSB7XG4gICAgdmFyIGxpc3RlbmVyT2JqID0gZ29vZy5ldmVudHMubGlzdGVuKFxuICAgICAgICBzcmMsIHR5cGVbaV0sIG9wdF9mbiB8fCBzZWxmLmhhbmRsZUV2ZW50LCBvcHRfb3B0aW9ucyB8fCBmYWxzZSxcbiAgICAgICAgb3B0X3Njb3BlIHx8IHNlbGYuaGFuZGxlcl8gfHwgc2VsZik7XG5cbiAgICBpZiAoIWxpc3RlbmVyT2JqKSB7XG4gICAgICAvLyBXaGVuIGdvb2cuZXZlbnRzLmxpc3RlbiBydW4gb24gT0ZGX0FORF9GQUlMIG9yIE9GRl9BTkRfU0lMRU5UXG4gICAgICAvLyAoZ29vZy5ldmVudHMuQ2FwdHVyZVNpbXVsYXRpb25Nb2RlKSBpbiBJRTgtLCBpdCB3aWxsIHJldHVybiBudWxsXG4gICAgICAvLyB2YWx1ZS5cbiAgICAgIHJldHVybiBzZWxmO1xuICAgIH1cblxuICAgIHZhciBrZXkgPSBsaXN0ZW5lck9iai5rZXk7XG4gICAgc2VsZi5rZXlzX1trZXldID0gbGlzdGVuZXJPYmo7XG4gIH1cblxuICByZXR1cm4gc2VsZjtcbn07XG5cblxuLyoqXG4gKiBMaXN0ZW4gdG8gYW4gZXZlbnQgb24gYSBMaXN0ZW5hYmxlLiAgSWYgdGhlIGZ1bmN0aW9uIGlzIG9taXR0ZWQsIHRoZW4gdGhlXG4gKiBFdmVudEhhbmRsZXIncyBoYW5kbGVFdmVudCBtZXRob2Qgd2lsbCBiZSB1c2VkLiBBZnRlciB0aGUgZXZlbnQgaGFzIGZpcmVkIHRoZVxuICogZXZlbnQgbGlzdGVuZXIgaXMgcmVtb3ZlZCBmcm9tIHRoZSB0YXJnZXQuIElmIGFuIGFycmF5IG9mIGV2ZW50IHR5cGVzIGlzXG4gKiBwcm92aWRlZCwgZWFjaCBldmVudCB0eXBlIHdpbGwgYmUgbGlzdGVuZWQgdG8gb25jZS5cbiAqIEBwYXJhbSB7Z29vZy5ldmVudHMuTGlzdGVuYWJsZVR5cGV9IHNyYyBFdmVudCBzb3VyY2UuXG4gKiBAcGFyYW0ge3N0cmluZ3xBcnJheTxzdHJpbmc+fFxuICogICAgICFnb29nLmV2ZW50cy5FdmVudElkPEVWRU5UT0JKPnwhQXJyYXk8IWdvb2cuZXZlbnRzLkV2ZW50SWQ8RVZFTlRPQko+Pn1cbiAqICAgICB0eXBlIEV2ZW50IHR5cGUgdG8gbGlzdGVuIGZvciBvciBhcnJheSBvZiBldmVudCB0eXBlcy5cbiAqIEBwYXJhbSB7ZnVuY3Rpb24odGhpczpTQ09QRSwgRVZFTlRPQkopOj98e2hhbmRsZUV2ZW50OmZ1bmN0aW9uKD8pOj99fG51bGw9fVxuICogb3B0X2ZuXG4gKiAgICBPcHRpb25hbCBjYWxsYmFjayBmdW5jdGlvbiB0byBiZSB1c2VkIGFzIHRoZSBsaXN0ZW5lciBvciBhbiBvYmplY3Qgd2l0aFxuICogICAgaGFuZGxlRXZlbnQgZnVuY3Rpb24uXG4gKiBAcGFyYW0geyhib29sZWFufCFBZGRFdmVudExpc3RlbmVyT3B0aW9ucyk9fSBvcHRfb3B0aW9uc1xuICogQHJldHVybiB7VEhJU30gVGhpcyBvYmplY3QsIGFsbG93aW5nIGZvciBjaGFpbmluZyBvZiBjYWxscy5cbiAqIEB0aGlzIHtUSElTfVxuICogQHRlbXBsYXRlIEVWRU5UT0JKLCBUSElTXG4gKi9cbmdvb2cuZXZlbnRzLkV2ZW50SGFuZGxlci5wcm90b3R5cGUubGlzdGVuT25jZSA9IGZ1bmN0aW9uKFxuICAgIHNyYywgdHlwZSwgb3B0X2ZuLCBvcHRfb3B0aW9ucykge1xuICAndXNlIHN0cmljdCc7XG4gIHZhciBzZWxmID0gLyoqIEB0eXBlIHshZ29vZy5ldmVudHMuRXZlbnRIYW5kbGVyfSAqLyAodGhpcyk7XG4gIHJldHVybiBzZWxmLmxpc3Rlbk9uY2VfKHNyYywgdHlwZSwgb3B0X2ZuLCBvcHRfb3B0aW9ucyk7XG59O1xuXG5cbi8qKlxuICogTGlzdGVuIHRvIGFuIGV2ZW50IG9uIGEgTGlzdGVuYWJsZS4gIElmIHRoZSBmdW5jdGlvbiBpcyBvbWl0dGVkLCB0aGVuIHRoZVxuICogRXZlbnRIYW5kbGVyJ3MgaGFuZGxlRXZlbnQgbWV0aG9kIHdpbGwgYmUgdXNlZC4gQWZ0ZXIgdGhlIGV2ZW50IGhhcyBmaXJlZCB0aGVcbiAqIGV2ZW50IGxpc3RlbmVyIGlzIHJlbW92ZWQgZnJvbSB0aGUgdGFyZ2V0LiBJZiBhbiBhcnJheSBvZiBldmVudCB0eXBlcyBpc1xuICogcHJvdmlkZWQsIGVhY2ggZXZlbnQgdHlwZSB3aWxsIGJlIGxpc3RlbmVkIHRvIG9uY2UuXG4gKiBAcGFyYW0ge2dvb2cuZXZlbnRzLkxpc3RlbmFibGVUeXBlfSBzcmMgRXZlbnQgc291cmNlLlxuICogQHBhcmFtIHtzdHJpbmd8QXJyYXk8c3RyaW5nPnxcbiAqICAgICAhZ29vZy5ldmVudHMuRXZlbnRJZDxFVkVOVE9CSj58IUFycmF5PCFnb29nLmV2ZW50cy5FdmVudElkPEVWRU5UT0JKPj59XG4gKiAgICAgdHlwZSBFdmVudCB0eXBlIHRvIGxpc3RlbiBmb3Igb3IgYXJyYXkgb2YgZXZlbnQgdHlwZXMuXG4gKiBAcGFyYW0ge2Z1bmN0aW9uKHRoaXM6VCwgRVZFTlRPQkopOj98e2hhbmRsZUV2ZW50OmZ1bmN0aW9uKHRoaXM6VCwgPyk6P318XG4gKiAgICAgbnVsbHx1bmRlZmluZWR9IGZuIE9wdGlvbmFsIGNhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIHVzZWQgYXMgdGhlXG4gKiAgICAgbGlzdGVuZXIgb3IgYW4gb2JqZWN0IHdpdGggaGFuZGxlRXZlbnQgZnVuY3Rpb24uXG4gKiBAcGFyYW0ge2Jvb2xlYW58dW5kZWZpbmVkfSBjYXB0dXJlIE9wdGlvbmFsIHdoZXRoZXIgdG8gdXNlIGNhcHR1cmUgcGhhc2UuXG4gKiBAcGFyYW0ge1R9IHNjb3BlIE9iamVjdCBpbiB3aG9zZSBzY29wZSB0byBjYWxsIHRoZSBsaXN0ZW5lci5cbiAqIEByZXR1cm4ge1RISVN9IFRoaXMgb2JqZWN0LCBhbGxvd2luZyBmb3IgY2hhaW5pbmcgb2YgY2FsbHMuXG4gKiBAdGhpcyB7VEhJU31cbiAqIEB0ZW1wbGF0ZSBULCBFVkVOVE9CSiwgVEhJU1xuICovXG5nb29nLmV2ZW50cy5FdmVudEhhbmRsZXIucHJvdG90eXBlLmxpc3Rlbk9uY2VXaXRoU2NvcGUgPSBmdW5jdGlvbihcbiAgICBzcmMsIHR5cGUsIGZuLCBjYXB0dXJlLCBzY29wZSkge1xuICAndXNlIHN0cmljdCc7XG4gIHZhciBzZWxmID0gLyoqIEB0eXBlIHshZ29vZy5ldmVudHMuRXZlbnRIYW5kbGVyfSAqLyAodGhpcyk7XG4gIC8vIFRPRE8obWtuaWNoZWwpOiBEZXByZWNhdGUgdGhpcyBmdW5jdGlvbi5cbiAgcmV0dXJuIHNlbGYubGlzdGVuT25jZV8oc3JjLCB0eXBlLCBmbiwgY2FwdHVyZSwgc2NvcGUpO1xufTtcblxuXG4vKipcbiAqIExpc3RlbiB0byBhbiBldmVudCBvbiBhIExpc3RlbmFibGUuICBJZiB0aGUgZnVuY3Rpb24gaXMgb21pdHRlZCwgdGhlbiB0aGVcbiAqIEV2ZW50SGFuZGxlcidzIGhhbmRsZUV2ZW50IG1ldGhvZCB3aWxsIGJlIHVzZWQuIEFmdGVyIHRoZSBldmVudCBoYXMgZmlyZWRcbiAqIHRoZSBldmVudCBsaXN0ZW5lciBpcyByZW1vdmVkIGZyb20gdGhlIHRhcmdldC4gSWYgYW4gYXJyYXkgb2YgZXZlbnQgdHlwZXMgaXNcbiAqIHByb3ZpZGVkLCBlYWNoIGV2ZW50IHR5cGUgd2lsbCBiZSBsaXN0ZW5lZCB0byBvbmNlLlxuICogQHBhcmFtIHtnb29nLmV2ZW50cy5MaXN0ZW5hYmxlVHlwZX0gc3JjIEV2ZW50IHNvdXJjZS5cbiAqIEBwYXJhbSB7c3RyaW5nfEFycmF5PHN0cmluZz58XG4gKiAgICAgIWdvb2cuZXZlbnRzLkV2ZW50SWQ8RVZFTlRPQko+fCFBcnJheTwhZ29vZy5ldmVudHMuRXZlbnRJZDxFVkVOVE9CSj4+fVxuICogICAgIHR5cGUgRXZlbnQgdHlwZSB0byBsaXN0ZW4gZm9yIG9yIGFycmF5IG9mIGV2ZW50IHR5cGVzLlxuICogQHBhcmFtIHtmdW5jdGlvbihFVkVOVE9CSik6P3x7aGFuZGxlRXZlbnQ6ZnVuY3Rpb24oPyk6P318bnVsbD19IG9wdF9mblxuICogICAgT3B0aW9uYWwgY2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgdXNlZCBhcyB0aGUgbGlzdGVuZXIgb3IgYW4gb2JqZWN0IHdpdGhcbiAqICAgIGhhbmRsZUV2ZW50IGZ1bmN0aW9uLlxuICogQHBhcmFtIHsoYm9vbGVhbnwhQWRkRXZlbnRMaXN0ZW5lck9wdGlvbnMpPX0gb3B0X29wdGlvbnNcbiAqIEBwYXJhbSB7T2JqZWN0PX0gb3B0X3Njb3BlIE9iamVjdCBpbiB3aG9zZSBzY29wZSB0byBjYWxsIHRoZSBsaXN0ZW5lci5cbiAqIEByZXR1cm4ge1RISVN9IFRoaXMgb2JqZWN0LCBhbGxvd2luZyBmb3IgY2hhaW5pbmcgb2YgY2FsbHMuXG4gKiBAdGhpcyB7VEhJU31cbiAqIEB0ZW1wbGF0ZSBFVkVOVE9CSiwgVEhJU1xuICogQHByaXZhdGVcbiAqL1xuZ29vZy5ldmVudHMuRXZlbnRIYW5kbGVyLnByb3RvdHlwZS5saXN0ZW5PbmNlXyA9IGZ1bmN0aW9uKFxuICAgIHNyYywgdHlwZSwgb3B0X2ZuLCBvcHRfb3B0aW9ucywgb3B0X3Njb3BlKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgdmFyIHNlbGYgPSAvKiogQHR5cGUgeyFnb29nLmV2ZW50cy5FdmVudEhhbmRsZXJ9ICovICh0aGlzKTtcbiAgaWYgKEFycmF5LmlzQXJyYXkodHlwZSkpIHtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHR5cGUubGVuZ3RoOyBpKyspIHtcbiAgICAgIHNlbGYubGlzdGVuT25jZV8oc3JjLCB0eXBlW2ldLCBvcHRfZm4sIG9wdF9vcHRpb25zLCBvcHRfc2NvcGUpO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICB2YXIgbGlzdGVuZXJPYmogPSBnb29nLmV2ZW50cy5saXN0ZW5PbmNlKFxuICAgICAgICBzcmMsIHR5cGUsIG9wdF9mbiB8fCBzZWxmLmhhbmRsZUV2ZW50LCBvcHRfb3B0aW9ucyxcbiAgICAgICAgb3B0X3Njb3BlIHx8IHNlbGYuaGFuZGxlcl8gfHwgc2VsZik7XG4gICAgaWYgKCFsaXN0ZW5lck9iaikge1xuICAgICAgLy8gV2hlbiBnb29nLmV2ZW50cy5saXN0ZW4gcnVuIG9uIE9GRl9BTkRfRkFJTCBvciBPRkZfQU5EX1NJTEVOVFxuICAgICAgLy8gKGdvb2cuZXZlbnRzLkNhcHR1cmVTaW11bGF0aW9uTW9kZSkgaW4gSUU4LSwgaXQgd2lsbCByZXR1cm4gbnVsbFxuICAgICAgLy8gdmFsdWUuXG4gICAgICByZXR1cm4gc2VsZjtcbiAgICB9XG5cbiAgICB2YXIga2V5ID0gbGlzdGVuZXJPYmoua2V5O1xuICAgIHNlbGYua2V5c19ba2V5XSA9IGxpc3RlbmVyT2JqO1xuICB9XG5cbiAgcmV0dXJuIHNlbGY7XG59O1xuXG5cbi8qKlxuICogQWRkcyBhbiBldmVudCBsaXN0ZW5lciB3aXRoIGEgc3BlY2lmaWMgZXZlbnQgd3JhcHBlciBvbiBhIERPTSBOb2RlIG9yIGFuXG4gKiBvYmplY3QgdGhhdCBoYXMgaW1wbGVtZW50ZWQge0BsaW5rIGdvb2cuZXZlbnRzLkV2ZW50VGFyZ2V0fS4gQSBsaXN0ZW5lciBjYW5cbiAqIG9ubHkgYmUgYWRkZWQgb25jZSB0byBhbiBvYmplY3QuXG4gKlxuICogQHBhcmFtIHtFdmVudFRhcmdldHxnb29nLmV2ZW50cy5FdmVudFRhcmdldH0gc3JjIFRoZSBub2RlIHRvIGxpc3RlbiB0b1xuICogICAgIGV2ZW50cyBvbi5cbiAqIEBwYXJhbSB7Z29vZy5ldmVudHMuRXZlbnRXcmFwcGVyfSB3cmFwcGVyIEV2ZW50IHdyYXBwZXIgdG8gdXNlLlxuICogQHBhcmFtIHtmdW5jdGlvbih0aGlzOlNDT1BFLCA/KTo/fHtoYW5kbGVFdmVudDpmdW5jdGlvbig/KTo/fXxudWxsfSBsaXN0ZW5lclxuICogICAgIENhbGxiYWNrIG1ldGhvZCwgb3IgYW4gb2JqZWN0IHdpdGggYSBoYW5kbGVFdmVudCBmdW5jdGlvbi5cbiAqIEBwYXJhbSB7Ym9vbGVhbj19IG9wdF9jYXB0IFdoZXRoZXIgdG8gZmlyZSBpbiBjYXB0dXJlIHBoYXNlIChkZWZhdWx0cyB0b1xuICogICAgIGZhbHNlKS5cbiAqIEByZXR1cm4ge1RISVN9IFRoaXMgb2JqZWN0LCBhbGxvd2luZyBmb3IgY2hhaW5pbmcgb2YgY2FsbHMuXG4gKiBAdGhpcyB7VEhJU31cbiAqIEB0ZW1wbGF0ZSBUSElTXG4gKi9cbmdvb2cuZXZlbnRzLkV2ZW50SGFuZGxlci5wcm90b3R5cGUubGlzdGVuV2l0aFdyYXBwZXIgPSBmdW5jdGlvbihcbiAgICBzcmMsIHdyYXBwZXIsIGxpc3RlbmVyLCBvcHRfY2FwdCkge1xuICAndXNlIHN0cmljdCc7XG4gIHZhciBzZWxmID0gLyoqIEB0eXBlIHshZ29vZy5ldmVudHMuRXZlbnRIYW5kbGVyfSAqLyAodGhpcyk7XG4gIC8vIFRPRE8obWtuaWNoZWwpOiBSZW1vdmUgdGhlIG9wdF9zY29wZSBmcm9tIHRoaXMgZnVuY3Rpb24gYW5kIHRoZW5cbiAgLy8gdGVtcGxhdGl6ZSBpdC5cbiAgcmV0dXJuIHNlbGYubGlzdGVuV2l0aFdyYXBwZXJfKHNyYywgd3JhcHBlciwgbGlzdGVuZXIsIG9wdF9jYXB0KTtcbn07XG5cblxuLyoqXG4gKiBBZGRzIGFuIGV2ZW50IGxpc3RlbmVyIHdpdGggYSBzcGVjaWZpYyBldmVudCB3cmFwcGVyIG9uIGEgRE9NIE5vZGUgb3IgYW5cbiAqIG9iamVjdCB0aGF0IGhhcyBpbXBsZW1lbnRlZCB7QGxpbmsgZ29vZy5ldmVudHMuRXZlbnRUYXJnZXR9LiBBIGxpc3RlbmVyIGNhblxuICogb25seSBiZSBhZGRlZCBvbmNlIHRvIGFuIG9iamVjdC5cbiAqXG4gKiBAcGFyYW0ge0V2ZW50VGFyZ2V0fGdvb2cuZXZlbnRzLkV2ZW50VGFyZ2V0fSBzcmMgVGhlIG5vZGUgdG8gbGlzdGVuIHRvXG4gKiAgICAgZXZlbnRzIG9uLlxuICogQHBhcmFtIHtnb29nLmV2ZW50cy5FdmVudFdyYXBwZXJ9IHdyYXBwZXIgRXZlbnQgd3JhcHBlciB0byB1c2UuXG4gKiBAcGFyYW0ge2Z1bmN0aW9uKHRoaXM6VCwgPyk6P3x7aGFuZGxlRXZlbnQ6ZnVuY3Rpb24odGhpczpULCA/KTo/fXxudWxsfVxuICogICAgIGxpc3RlbmVyIE9wdGlvbmFsIGNhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIHVzZWQgYXMgdGhlXG4gKiAgICAgbGlzdGVuZXIgb3IgYW4gb2JqZWN0IHdpdGggaGFuZGxlRXZlbnQgZnVuY3Rpb24uXG4gKiBAcGFyYW0ge2Jvb2xlYW58dW5kZWZpbmVkfSBjYXB0dXJlIE9wdGlvbmFsIHdoZXRoZXIgdG8gdXNlIGNhcHR1cmUgcGhhc2UuXG4gKiBAcGFyYW0ge1R9IHNjb3BlIE9iamVjdCBpbiB3aG9zZSBzY29wZSB0byBjYWxsIHRoZSBsaXN0ZW5lci5cbiAqIEByZXR1cm4ge1RISVN9IFRoaXMgb2JqZWN0LCBhbGxvd2luZyBmb3IgY2hhaW5pbmcgb2YgY2FsbHMuXG4gKiBAdGhpcyB7VEhJU31cbiAqIEB0ZW1wbGF0ZSBULCBUSElTXG4gKi9cbmdvb2cuZXZlbnRzLkV2ZW50SGFuZGxlci5wcm90b3R5cGUubGlzdGVuV2l0aFdyYXBwZXJBbmRTY29wZSA9IGZ1bmN0aW9uKFxuICAgIHNyYywgd3JhcHBlciwgbGlzdGVuZXIsIGNhcHR1cmUsIHNjb3BlKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgdmFyIHNlbGYgPSAvKiogQHR5cGUgeyFnb29nLmV2ZW50cy5FdmVudEhhbmRsZXJ9ICovICh0aGlzKTtcbiAgLy8gVE9ETyhta25pY2hlbCk6IERlcHJlY2F0ZSB0aGlzIGZ1bmN0aW9uLlxuICByZXR1cm4gc2VsZi5saXN0ZW5XaXRoV3JhcHBlcl8oc3JjLCB3cmFwcGVyLCBsaXN0ZW5lciwgY2FwdHVyZSwgc2NvcGUpO1xufTtcblxuXG4vKipcbiAqIEFkZHMgYW4gZXZlbnQgbGlzdGVuZXIgd2l0aCBhIHNwZWNpZmljIGV2ZW50IHdyYXBwZXIgb24gYSBET00gTm9kZSBvciBhblxuICogb2JqZWN0IHRoYXQgaGFzIGltcGxlbWVudGVkIHtAbGluayBnb29nLmV2ZW50cy5FdmVudFRhcmdldH0uIEEgbGlzdGVuZXIgY2FuXG4gKiBvbmx5IGJlIGFkZGVkIG9uY2UgdG8gYW4gb2JqZWN0LlxuICpcbiAqIEBwYXJhbSB7RXZlbnRUYXJnZXR8Z29vZy5ldmVudHMuRXZlbnRUYXJnZXR9IHNyYyBUaGUgbm9kZSB0byBsaXN0ZW4gdG9cbiAqICAgICBldmVudHMgb24uXG4gKiBAcGFyYW0ge2dvb2cuZXZlbnRzLkV2ZW50V3JhcHBlcn0gd3JhcHBlciBFdmVudCB3cmFwcGVyIHRvIHVzZS5cbiAqIEBwYXJhbSB7ZnVuY3Rpb24oPyk6P3x7aGFuZGxlRXZlbnQ6ZnVuY3Rpb24oPyk6P318bnVsbH0gbGlzdGVuZXIgQ2FsbGJhY2tcbiAqICAgICBtZXRob2QsIG9yIGFuIG9iamVjdCB3aXRoIGEgaGFuZGxlRXZlbnQgZnVuY3Rpb24uXG4gKiBAcGFyYW0ge2Jvb2xlYW49fSBvcHRfY2FwdCBXaGV0aGVyIHRvIGZpcmUgaW4gY2FwdHVyZSBwaGFzZSAoZGVmYXVsdHMgdG9cbiAqICAgICBmYWxzZSkuXG4gKiBAcGFyYW0ge09iamVjdD19IG9wdF9zY29wZSBFbGVtZW50IGluIHdob3NlIHNjb3BlIHRvIGNhbGwgdGhlIGxpc3RlbmVyLlxuICogQHJldHVybiB7VEhJU30gVGhpcyBvYmplY3QsIGFsbG93aW5nIGZvciBjaGFpbmluZyBvZiBjYWxscy5cbiAqIEB0aGlzIHtUSElTfVxuICogQHRlbXBsYXRlIFRISVNcbiAqIEBwcml2YXRlXG4gKi9cbmdvb2cuZXZlbnRzLkV2ZW50SGFuZGxlci5wcm90b3R5cGUubGlzdGVuV2l0aFdyYXBwZXJfID0gZnVuY3Rpb24oXG4gICAgc3JjLCB3cmFwcGVyLCBsaXN0ZW5lciwgb3B0X2NhcHQsIG9wdF9zY29wZSkge1xuICAndXNlIHN0cmljdCc7XG4gIHZhciBzZWxmID0gLyoqIEB0eXBlIHshZ29vZy5ldmVudHMuRXZlbnRIYW5kbGVyfSAqLyAodGhpcyk7XG4gIHdyYXBwZXIubGlzdGVuKFxuICAgICAgc3JjLCBsaXN0ZW5lciwgb3B0X2NhcHQsIG9wdF9zY29wZSB8fCBzZWxmLmhhbmRsZXJfIHx8IHNlbGYsIHNlbGYpO1xuICByZXR1cm4gc2VsZjtcbn07XG5cblxuLyoqXG4gKiBAcmV0dXJuIHtudW1iZXJ9IE51bWJlciBvZiBsaXN0ZW5lcnMgcmVnaXN0ZXJlZCBieSB0aGlzIGhhbmRsZXIuXG4gKi9cbmdvb2cuZXZlbnRzLkV2ZW50SGFuZGxlci5wcm90b3R5cGUuZ2V0TGlzdGVuZXJDb3VudCA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIHZhciBjb3VudCA9IDA7XG4gIGZvciAodmFyIGtleSBpbiB0aGlzLmtleXNfKSB7XG4gICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbCh0aGlzLmtleXNfLCBrZXkpKSB7XG4gICAgICBjb3VudCsrO1xuICAgIH1cbiAgfVxuICByZXR1cm4gY291bnQ7XG59O1xuXG5cbi8qKlxuICogVW5saXN0ZW5zIG9uIGFuIGV2ZW50LlxuICogQHBhcmFtIHtnb29nLmV2ZW50cy5MaXN0ZW5hYmxlVHlwZX0gc3JjIEV2ZW50IHNvdXJjZS5cbiAqIEBwYXJhbSB7c3RyaW5nfEFycmF5PHN0cmluZz58XG4gKiAgICAgIWdvb2cuZXZlbnRzLkV2ZW50SWQ8RVZFTlRPQko+fCFBcnJheTwhZ29vZy5ldmVudHMuRXZlbnRJZDxFVkVOVE9CSj4+fVxuICogICAgIHR5cGUgRXZlbnQgdHlwZSBvciBhcnJheSBvZiBldmVudCB0eXBlcyB0byB1bmxpc3RlbiB0by5cbiAqIEBwYXJhbSB7ZnVuY3Rpb24odGhpczo/LCBFVkVOVE9CSik6P3x7aGFuZGxlRXZlbnQ6ZnVuY3Rpb24oPyk6P318bnVsbD19XG4gKiAgICAgb3B0X2ZuIE9wdGlvbmFsIGNhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIHVzZWQgYXMgdGhlIGxpc3RlbmVyIG9yIGFuIG9iamVjdFxuICogICAgIHdpdGggaGFuZGxlRXZlbnQgZnVuY3Rpb24uXG4gKiBAcGFyYW0geyhib29sZWFufCFFdmVudExpc3RlbmVyT3B0aW9ucyk9fSBvcHRfb3B0aW9uc1xuICogQHBhcmFtIHtPYmplY3Q9fSBvcHRfc2NvcGUgT2JqZWN0IGluIHdob3NlIHNjb3BlIHRvIGNhbGwgdGhlIGxpc3RlbmVyLlxuICogQHJldHVybiB7VEhJU30gVGhpcyBvYmplY3QsIGFsbG93aW5nIGZvciBjaGFpbmluZyBvZiBjYWxscy5cbiAqIEB0aGlzIHtUSElTfVxuICogQHRlbXBsYXRlIEVWRU5UT0JKLCBUSElTXG4gKi9cbmdvb2cuZXZlbnRzLkV2ZW50SGFuZGxlci5wcm90b3R5cGUudW5saXN0ZW4gPSBmdW5jdGlvbihcbiAgICBzcmMsIHR5cGUsIG9wdF9mbiwgb3B0X29wdGlvbnMsIG9wdF9zY29wZSkge1xuICAndXNlIHN0cmljdCc7XG4gIHZhciBzZWxmID0gLyoqIEB0eXBlIHshZ29vZy5ldmVudHMuRXZlbnRIYW5kbGVyfSAqLyAodGhpcyk7XG4gIGlmIChBcnJheS5pc0FycmF5KHR5cGUpKSB7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0eXBlLmxlbmd0aDsgaSsrKSB7XG4gICAgICBzZWxmLnVubGlzdGVuKHNyYywgdHlwZVtpXSwgb3B0X2ZuLCBvcHRfb3B0aW9ucywgb3B0X3Njb3BlKTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgdmFyIGNhcHR1cmUgPVxuICAgICAgICBnb29nLmlzT2JqZWN0KG9wdF9vcHRpb25zKSA/ICEhb3B0X29wdGlvbnMuY2FwdHVyZSA6ICEhb3B0X29wdGlvbnM7XG4gICAgdmFyIGxpc3RlbmVyID0gZ29vZy5ldmVudHMuZ2V0TGlzdGVuZXIoXG4gICAgICAgIHNyYywgdHlwZSwgb3B0X2ZuIHx8IHNlbGYuaGFuZGxlRXZlbnQsIGNhcHR1cmUsXG4gICAgICAgIG9wdF9zY29wZSB8fCBzZWxmLmhhbmRsZXJfIHx8IHNlbGYpO1xuXG4gICAgaWYgKGxpc3RlbmVyKSB7XG4gICAgICBnb29nLmV2ZW50cy51bmxpc3RlbkJ5S2V5KGxpc3RlbmVyKTtcbiAgICAgIGRlbGV0ZSBzZWxmLmtleXNfW2xpc3RlbmVyLmtleV07XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHNlbGY7XG59O1xuXG5cbi8qKlxuICogUmVtb3ZlcyBhbiBldmVudCBsaXN0ZW5lciB3aGljaCB3YXMgYWRkZWQgd2l0aCBsaXN0ZW5XaXRoV3JhcHBlcigpLlxuICpcbiAqIEBwYXJhbSB7RXZlbnRUYXJnZXR8Z29vZy5ldmVudHMuRXZlbnRUYXJnZXR9IHNyYyBUaGUgdGFyZ2V0IHRvIHN0b3BcbiAqICAgICBsaXN0ZW5pbmcgdG8gZXZlbnRzIG9uLlxuICogQHBhcmFtIHtnb29nLmV2ZW50cy5FdmVudFdyYXBwZXJ9IHdyYXBwZXIgRXZlbnQgd3JhcHBlciB0byB1c2UuXG4gKiBAcGFyYW0ge2Z1bmN0aW9uKD8pOj98e2hhbmRsZUV2ZW50OmZ1bmN0aW9uKD8pOj99fG51bGx9IGxpc3RlbmVyIFRoZVxuICogICAgIGxpc3RlbmVyIGZ1bmN0aW9uIHRvIHJlbW92ZS5cbiAqIEBwYXJhbSB7Ym9vbGVhbj19IG9wdF9jYXB0IEluIERPTS1jb21wbGlhbnQgYnJvd3NlcnMsIHRoaXMgZGV0ZXJtaW5lc1xuICogICAgIHdoZXRoZXIgdGhlIGxpc3RlbmVyIGlzIGZpcmVkIGR1cmluZyB0aGUgY2FwdHVyZSBvciBidWJibGUgcGhhc2Ugb2YgdGhlXG4gKiAgICAgZXZlbnQuXG4gKiBAcGFyYW0ge09iamVjdD19IG9wdF9zY29wZSBFbGVtZW50IGluIHdob3NlIHNjb3BlIHRvIGNhbGwgdGhlIGxpc3RlbmVyLlxuICogQHJldHVybiB7VEhJU30gVGhpcyBvYmplY3QsIGFsbG93aW5nIGZvciBjaGFpbmluZyBvZiBjYWxscy5cbiAqIEB0aGlzIHtUSElTfVxuICogQHRlbXBsYXRlIFRISVNcbiAqL1xuZ29vZy5ldmVudHMuRXZlbnRIYW5kbGVyLnByb3RvdHlwZS51bmxpc3RlbldpdGhXcmFwcGVyID0gZnVuY3Rpb24oXG4gICAgc3JjLCB3cmFwcGVyLCBsaXN0ZW5lciwgb3B0X2NhcHQsIG9wdF9zY29wZSkge1xuICAndXNlIHN0cmljdCc7XG4gIHZhciBzZWxmID0gLyoqIEB0eXBlIHshZ29vZy5ldmVudHMuRXZlbnRIYW5kbGVyfSAqLyAodGhpcyk7XG4gIHdyYXBwZXIudW5saXN0ZW4oXG4gICAgICBzcmMsIGxpc3RlbmVyLCBvcHRfY2FwdCwgb3B0X3Njb3BlIHx8IHNlbGYuaGFuZGxlcl8gfHwgc2VsZiwgc2VsZik7XG4gIHJldHVybiBzZWxmO1xufTtcblxuXG4vKipcbiAqIFVubGlzdGVucyB0byBhbGwgZXZlbnRzLlxuICovXG5nb29nLmV2ZW50cy5FdmVudEhhbmRsZXIucHJvdG90eXBlLnJlbW92ZUFsbCA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIGdvb2cub2JqZWN0LmZvckVhY2godGhpcy5rZXlzXywgZnVuY3Rpb24obGlzdGVuZXJPYmosIGtleSkge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICBpZiAodGhpcy5rZXlzXy5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XG4gICAgICBnb29nLmV2ZW50cy51bmxpc3RlbkJ5S2V5KGxpc3RlbmVyT2JqKTtcbiAgICB9XG4gIH0sIHRoaXMpO1xuXG4gIHRoaXMua2V5c18gPSB7fTtcbn07XG5cblxuLyoqXG4gKiBEaXNwb3NlcyBvZiB0aGlzIEV2ZW50SGFuZGxlciBhbmQgcmVtb3ZlcyBhbGwgbGlzdGVuZXJzIHRoYXQgaXQgcmVnaXN0ZXJlZC5cbiAqIEBvdmVycmlkZVxuICogQHByb3RlY3RlZFxuICovXG5nb29nLmV2ZW50cy5FdmVudEhhbmRsZXIucHJvdG90eXBlLmRpc3Bvc2VJbnRlcm5hbCA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIGdvb2cuZXZlbnRzLkV2ZW50SGFuZGxlci5zdXBlckNsYXNzXy5kaXNwb3NlSW50ZXJuYWwuY2FsbCh0aGlzKTtcbiAgdGhpcy5yZW1vdmVBbGwoKTtcbn07XG5cblxuLyoqXG4gKiBEZWZhdWx0IGV2ZW50IGhhbmRsZXJcbiAqIEBwYXJhbSB7Z29vZy5ldmVudHMuRXZlbnR9IGUgRXZlbnQgb2JqZWN0LlxuICovXG5nb29nLmV2ZW50cy5FdmVudEhhbmRsZXIucHJvdG90eXBlLmhhbmRsZUV2ZW50ID0gZnVuY3Rpb24oZSkge1xuICAndXNlIHN0cmljdCc7XG4gIHRocm93IG5ldyBFcnJvcignRXZlbnRIYW5kbGVyLmhhbmRsZUV2ZW50IG5vdCBpbXBsZW1lbnRlZCcpO1xufTtcbiIsICIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgVGhlIENsb3N1cmUgTGlicmFyeSBBdXRob3JzLlxuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIEBmaWxlb3ZlcnZpZXcgUHJvdmlkZXMgYSB1dGlsaXR5IGZvciB0cmFjaW5nIGFuZCBkZWJ1Z2dpbmcgV2ViQ2hhbm5lbFxuICogICAgIHJlcXVlc3RzLlxuICpcbiAqL1xuXG5cbmdvb2cucHJvdmlkZSgnZ29vZy5sYWJzLm5ldC53ZWJDaGFubmVsLldlYkNoYW5uZWxEZWJ1ZycpO1xuXG5nb29nLnJlcXVpcmUoJ2dvb2cuanNvbicpO1xuZ29vZy5yZXF1aXJlKCdnb29nLmxvZycpO1xuZ29vZy5yZXF1aXJlVHlwZSgnZ29vZy5VcmknKTtcbmdvb2cucmVxdWlyZVR5cGUoJ2dvb2cubmV0LlhtbEh0dHAuUmVhZHlTdGF0ZScpO1xuXG5cblxuLyoqXG4gKiBMb2dzIGFuZCBrZWVwcyBhIGJ1ZmZlciBvZiBkZWJ1Z2dpbmcgaW5mbyBmb3IgdGhlIENoYW5uZWwuXG4gKlxuICogQGNvbnN0cnVjdG9yXG4gKiBAc3RydWN0XG4gKiBAZmluYWxcbiAqL1xuZ29vZy5sYWJzLm5ldC53ZWJDaGFubmVsLldlYkNoYW5uZWxEZWJ1ZyA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIC8qKlxuICAgKiBUaGUgbG9nZ2VyIGluc3RhbmNlLlxuICAgKiBAY29uc3RcbiAgICogQHByaXZhdGUgez9nb29nLmxvZy5Mb2dnZXJ9XG4gICAqL1xuICB0aGlzLmxvZ2dlcl8gPSBnb29nLmxvZy5nZXRMb2dnZXIoJ2dvb2cubGFicy5uZXQud2ViQ2hhbm5lbC5XZWJDaGFubmVsRGVidWcnKTtcblxuICAvKipcbiAgICogV2hldGhlciB0byBlbmFibGUgcmVkYWN0LiBEZWZhdWx0cyB0byB0cnVlLlxuICAgKiBAcHJpdmF0ZSB7Ym9vbGVhbn1cbiAgICovXG4gIHRoaXMucmVkYWN0RW5hYmxlZF8gPSB0cnVlO1xufTtcblxuXG5nb29nLnNjb3BlKGZ1bmN0aW9uKCkge1xuJ3VzZSBzdHJpY3QnO1xudmFyIFdlYkNoYW5uZWxEZWJ1ZyA9IGdvb2cubGFicy5uZXQud2ViQ2hhbm5lbC5XZWJDaGFubmVsRGVidWc7XG5cblxuLyoqXG4gKiBUdXJucyBvZmYgcmVkYWN0LlxuICovXG5XZWJDaGFubmVsRGVidWcucHJvdG90eXBlLmRpc2FibGVSZWRhY3QgPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICB0aGlzLnJlZGFjdEVuYWJsZWRfID0gZmFsc2U7XG59O1xuXG5cbi8qKlxuICogTG9ncyB0aGF0IHRoZSBicm93c2VyIHdlbnQgb2ZmbGluZSBkdXJpbmcgdGhlIGxpZmV0aW1lIG9mIGEgcmVxdWVzdC5cbiAqIEBwYXJhbSB7Z29vZy5Vcml9IHVybCBUaGUgVVJMIGJlaW5nIHJlcXVlc3RlZC5cbiAqL1xuV2ViQ2hhbm5lbERlYnVnLnByb3RvdHlwZS5icm93c2VyT2ZmbGluZVJlc3BvbnNlID0gZnVuY3Rpb24odXJsKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgdGhpcy5pbmZvKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICByZXR1cm4gJ0JST1dTRVJfT0ZGTElORTogJyArIHVybDtcbiAgfSk7XG59O1xuXG5cbi8qKlxuICogTG9ncyBhbiBYbWxIdHRwIHJlcXVlc3QuLlxuICogQHBhcmFtIHtzdHJpbmd9IHZlcmIgVGhlIHJlcXVlc3QgdHlwZSAoR0VUL1BPU1QpLlxuICogQHBhcmFtIHtnb29nLlVyaX0gdXJpIFRoZSByZXF1ZXN0IGRlc3RpbmF0aW9uLlxuICogQHBhcmFtIHtzdHJpbmd8bnVtYmVyfHVuZGVmaW5lZH0gaWQgVGhlIHJlcXVlc3QgaWQuXG4gKiBAcGFyYW0ge251bWJlcn0gYXR0ZW1wdCBXaGljaCBhdHRlbXB0ICMgdGhlIHJlcXVlc3Qgd2FzLlxuICogQHBhcmFtIHs/c3RyaW5nfSBwb3N0RGF0YSBUaGUgZGF0YSBwb3N0ZWQgaW4gdGhlIHJlcXVlc3QuXG4gKi9cbldlYkNoYW5uZWxEZWJ1Zy5wcm90b3R5cGUueG1sSHR0cENoYW5uZWxSZXF1ZXN0ID0gZnVuY3Rpb24oXG4gICAgdmVyYiwgdXJpLCBpZCwgYXR0ZW1wdCwgcG9zdERhdGEpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHRoaXMuaW5mbyhmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgcmV0dXJuICdYTUxIVFRQIFJFUSAoJyArIGlkICsgJykgW2F0dGVtcHQgJyArIGF0dGVtcHQgKyAnXTogJyArIHZlcmIgK1xuICAgICAgICAnXFxuJyArIHVyaSArICdcXG4nICsgc2VsZi5tYXliZVJlZGFjdFBvc3REYXRhXyhwb3N0RGF0YSk7XG4gIH0pO1xufTtcblxuXG4vKipcbiAqIExvZ3MgdGhlIG1ldGEgZGF0YSByZWNlaXZlZCBmcm9tIGFuIFhtbEh0dHAgcmVxdWVzdC5cbiAqIEBwYXJhbSB7c3RyaW5nfSB2ZXJiIFRoZSByZXF1ZXN0IHR5cGUgKEdFVC9QT1NUKS5cbiAqIEBwYXJhbSB7Z29vZy5Vcml9IHVyaSBUaGUgcmVxdWVzdCBkZXN0aW5hdGlvbi5cbiAqIEBwYXJhbSB7c3RyaW5nfG51bWJlcnx1bmRlZmluZWR9IGlkIFRoZSByZXF1ZXN0IGlkLlxuICogQHBhcmFtIHtudW1iZXJ9IGF0dGVtcHQgV2hpY2ggYXR0ZW1wdCAjIHRoZSByZXF1ZXN0IHdhcy5cbiAqIEBwYXJhbSB7Z29vZy5uZXQuWG1sSHR0cC5SZWFkeVN0YXRlfSByZWFkeVN0YXRlIFRoZSByZWFkeSBzdGF0ZS5cbiAqIEBwYXJhbSB7bnVtYmVyfSBzdGF0dXNDb2RlIFRoZSBIVFRQIHN0YXR1cyBjb2RlLlxuICovXG5XZWJDaGFubmVsRGVidWcucHJvdG90eXBlLnhtbEh0dHBDaGFubmVsUmVzcG9uc2VNZXRhRGF0YSA9IGZ1bmN0aW9uKFxuICAgIHZlcmIsIHVyaSwgaWQsIGF0dGVtcHQsIHJlYWR5U3RhdGUsIHN0YXR1c0NvZGUpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICB0aGlzLmluZm8oZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIHJldHVybiAnWE1MSFRUUCBSRVNQICgnICsgaWQgKyAnKSBbIGF0dGVtcHQgJyArIGF0dGVtcHQgKyAnXTogJyArIHZlcmIgK1xuICAgICAgICAnXFxuJyArIHVyaSArICdcXG4nICsgcmVhZHlTdGF0ZSArICcgJyArIHN0YXR1c0NvZGU7XG4gIH0pO1xufTtcblxuXG4vKipcbiAqIExvZ3MgdGhlIHJlc3BvbnNlIGRhdGEgcmVjZWl2ZWQgZnJvbSBhbiBYbWxIdHRwIHJlcXVlc3QuXG4gKiBAcGFyYW0ge3N0cmluZ3xudW1iZXJ8dW5kZWZpbmVkfSBpZCBUaGUgcmVxdWVzdCBpZC5cbiAqIEBwYXJhbSB7P3N0cmluZ30gcmVzcG9uc2VUZXh0IFRoZSByZXNwb25zZSB0ZXh0LlxuICogQHBhcmFtIHs/c3RyaW5nPX0gb3B0X2Rlc2MgT3B0aW9uYWwgcmVxdWVzdCBkZXNjcmlwdGlvbi5cbiAqL1xuV2ViQ2hhbm5lbERlYnVnLnByb3RvdHlwZS54bWxIdHRwQ2hhbm5lbFJlc3BvbnNlVGV4dCA9IGZ1bmN0aW9uKFxuICAgIGlkLCByZXNwb25zZVRleHQsIG9wdF9kZXNjKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB0aGlzLmluZm8oZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIHJldHVybiAnWE1MSFRUUCBURVhUICgnICsgaWQgKyAnKTogJyArIHNlbGYucmVkYWN0UmVzcG9uc2VfKHJlc3BvbnNlVGV4dCkgK1xuICAgICAgICAob3B0X2Rlc2MgPyAnICcgKyBvcHRfZGVzYyA6ICcnKTtcbiAgfSk7XG59O1xuXG5cbi8qKlxuICogTG9ncyBhIHJlcXVlc3QgdGltZW91dC5cbiAqIEBwYXJhbSB7Z29vZy5Vcml9IHVyaSBUaGUgdXJpIHRoYXQgdGltZWQgb3V0LlxuICovXG5XZWJDaGFubmVsRGVidWcucHJvdG90eXBlLnRpbWVvdXRSZXNwb25zZSA9IGZ1bmN0aW9uKHVyaSkge1xuICAndXNlIHN0cmljdCc7XG4gIHRoaXMuaW5mbyhmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgcmV0dXJuICdUSU1FT1VUOiAnICsgdXJpO1xuICB9KTtcbn07XG5cblxuLyoqXG4gKiBMb2dzIGEgZGVidWcgbWVzc2FnZS5cbiAqIEBwYXJhbSB7IWdvb2cubG9nLkxvZ2dhYmxlfSB0ZXh0IFRoZSBtZXNzYWdlLlxuICovXG5XZWJDaGFubmVsRGVidWcucHJvdG90eXBlLmRlYnVnID0gZnVuY3Rpb24odGV4dCkge1xuICAndXNlIHN0cmljdCc7XG4gIGdvb2cubG9nLmZpbmUodGhpcy5sb2dnZXJfLCB0ZXh0KTtcbn07XG5cblxuLyoqXG4gKiBMb2dzIGFuIGV4Y2VwdGlvblxuICogQHBhcmFtIHtFcnJvcn0gZSBUaGUgZXJyb3Igb3IgZXJyb3IgZXZlbnQuXG4gKiBAcGFyYW0ge2dvb2cubG9nLkxvZ2dhYmxlPX0gb3B0X21zZyBUaGUgb3B0aW9uYWwgbWVzc2FnZSxcbiAqICAgICBkZWZhdWx0cyB0byAnRXhjZXB0aW9uJy5cbiAqL1xuV2ViQ2hhbm5lbERlYnVnLnByb3RvdHlwZS5kdW1wRXhjZXB0aW9uID0gZnVuY3Rpb24oZSwgb3B0X21zZykge1xuICAndXNlIHN0cmljdCc7XG4gIGdvb2cubG9nLmVycm9yKHRoaXMubG9nZ2VyXywgb3B0X21zZyB8fCAnRXhjZXB0aW9uJywgZSk7XG59O1xuXG5cbi8qKlxuICogTG9ncyBhbiBpbmZvIG1lc3NhZ2UuXG4gKiBAcGFyYW0geyFnb29nLmxvZy5Mb2dnYWJsZX0gdGV4dCBUaGUgbWVzc2FnZS5cbiAqL1xuV2ViQ2hhbm5lbERlYnVnLnByb3RvdHlwZS5pbmZvID0gZnVuY3Rpb24odGV4dCkge1xuICAndXNlIHN0cmljdCc7XG4gIGdvb2cubG9nLmluZm8odGhpcy5sb2dnZXJfLCB0ZXh0KTtcbn07XG5cblxuLyoqXG4gKiBMb2dzIGEgd2FybmluZyBtZXNzYWdlLlxuICogQHBhcmFtIHshZ29vZy5sb2cuTG9nZ2FibGV9IHRleHQgVGhlIG1lc3NhZ2UuXG4gKi9cbldlYkNoYW5uZWxEZWJ1Zy5wcm90b3R5cGUud2FybmluZyA9IGZ1bmN0aW9uKHRleHQpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBnb29nLmxvZy53YXJuaW5nKHRoaXMubG9nZ2VyXywgdGV4dCk7XG59O1xuXG5cbi8qKlxuICogTG9ncyBhIHNldmVyZSBtZXNzYWdlLlxuICogQHBhcmFtIHshZ29vZy5sb2cuTG9nZ2FibGV9IHRleHQgVGhlIG1lc3NhZ2UuXG4gKi9cbldlYkNoYW5uZWxEZWJ1Zy5wcm90b3R5cGUuc2V2ZXJlID0gZnVuY3Rpb24odGV4dCkge1xuICAndXNlIHN0cmljdCc7XG4gIGdvb2cubG9nLmVycm9yKHRoaXMubG9nZ2VyXywgdGV4dCk7XG59O1xuXG5cbi8qKlxuICogUmVtb3ZlcyBwb3RlbnRpYWxseSBwcml2YXRlIGRhdGEgZnJvbSBhIHJlc3BvbnNlIHNvIHRoYXQgd2UgZG9uJ3RcbiAqIGFjY2lkZW50YWxseSBzYXZlIHByaXZhdGUgYW5kIHBlcnNvbmFsIGRhdGEgdG8gdGhlIHNlcnZlciBsb2dzLlxuICogQHBhcmFtIHs/c3RyaW5nfSByZXNwb25zZVRleHQgQSBKU09OIHJlc3BvbnNlIHRvIGNsZWFuLlxuICogQHJldHVybiB7P3N0cmluZ30gVGhlIGNsZWFuZWQgcmVzcG9uc2UuXG4gKiBAcHJpdmF0ZVxuICovXG5XZWJDaGFubmVsRGVidWcucHJvdG90eXBlLnJlZGFjdFJlc3BvbnNlXyA9IGZ1bmN0aW9uKHJlc3BvbnNlVGV4dCkge1xuICAndXNlIHN0cmljdCc7XG4gIGlmICghdGhpcy5yZWRhY3RFbmFibGVkXykge1xuICAgIHJldHVybiByZXNwb25zZVRleHQ7XG4gIH1cblxuICBpZiAoIXJlc3BvbnNlVGV4dCkge1xuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgdHJ5IHtcbiAgICB2YXIgcmVzcG9uc2VBcnJheSA9IEpTT04ucGFyc2UocmVzcG9uc2VUZXh0KTtcbiAgICBpZiAocmVzcG9uc2VBcnJheSkge1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCByZXNwb25zZUFycmF5Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGlmIChBcnJheS5pc0FycmF5KHJlc3BvbnNlQXJyYXlbaV0pKSB7XG4gICAgICAgICAgdGhpcy5tYXliZVJlZGFjdEFycmF5XyhyZXNwb25zZUFycmF5W2ldKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBnb29nLmpzb24uc2VyaWFsaXplKHJlc3BvbnNlQXJyYXkpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgdGhpcy5kZWJ1ZygnRXhjZXB0aW9uIHBhcnNpbmcgZXhwZWN0ZWQgSlMgYXJyYXkgLSBwcm9iYWJseSB3YXMgbm90IEpTJyk7XG4gICAgcmV0dXJuIHJlc3BvbnNlVGV4dDtcbiAgfVxufTtcblxuXG4vKipcbiAqIFJlbW92ZXMgZGF0YSBmcm9tIGEgcmVzcG9uc2UgYXJyYXkgdGhhdCBtYXkgYmUgc2Vuc2l0aXZlLlxuICogQHBhcmFtIHshQXJyYXk8Pz59IGFycmF5IFRoZSBhcnJheSB0byBjbGVhbi5cbiAqIEBwcml2YXRlXG4gKi9cbldlYkNoYW5uZWxEZWJ1Zy5wcm90b3R5cGUubWF5YmVSZWRhY3RBcnJheV8gPSBmdW5jdGlvbihhcnJheSkge1xuICAndXNlIHN0cmljdCc7XG4gIGlmIChhcnJheS5sZW5ndGggPCAyKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIHZhciBkYXRhUGFydCA9IGFycmF5WzFdO1xuICBpZiAoIUFycmF5LmlzQXJyYXkoZGF0YVBhcnQpKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIGlmIChkYXRhUGFydC5sZW5ndGggPCAxKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIHR5cGUgPSBkYXRhUGFydFswXTtcbiAgaWYgKHR5cGUgIT0gJ25vb3AnICYmIHR5cGUgIT0gJ3N0b3AnICYmIHR5cGUgIT0gJ2Nsb3NlJykge1xuICAgIC8vIHJlZGFjdCBhbGwgZmllbGRzIGluIHRoZSBhcnJheVxuICAgIGZvciAodmFyIGkgPSAxOyBpIDwgZGF0YVBhcnQubGVuZ3RoOyBpKyspIHtcbiAgICAgIGRhdGFQYXJ0W2ldID0gJyc7XG4gICAgfVxuICB9XG59O1xuXG5cbi8qKlxuICogUmVtb3ZlcyBwb3RlbnRpYWxseSBwcml2YXRlIGRhdGEgZnJvbSBhIHJlcXVlc3QgUE9TVCBib2R5IHNvIHRoYXQgd2UgZG9uJ3RcbiAqIGFjY2lkZW50YWxseSBzYXZlIHByaXZhdGUgYW5kIHBlcnNvbmFsIGRhdGEgdG8gdGhlIHNlcnZlciBsb2dzLlxuICogQHBhcmFtIHs/c3RyaW5nfSBkYXRhIFRoZSBkYXRhIHN0cmluZyB0byBjbGVhbi5cbiAqIEByZXR1cm4gez9zdHJpbmd9IFRoZSBkYXRhIHN0cmluZyB3aXRoIHNlbnNpdGl2ZSBkYXRhIHJlcGxhY2VkIGJ5ICdyZWRhY3RlZCcuXG4gKiBAcHJpdmF0ZVxuICovXG5XZWJDaGFubmVsRGVidWcucHJvdG90eXBlLm1heWJlUmVkYWN0UG9zdERhdGFfID0gZnVuY3Rpb24oZGF0YSkge1xuICAndXNlIHN0cmljdCc7XG4gIGlmICghdGhpcy5yZWRhY3RFbmFibGVkXykge1xuICAgIHJldHVybiBkYXRhO1xuICB9XG5cbiAgaWYgKCFkYXRhKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbiAgdmFyIG91dCA9ICcnO1xuICB2YXIgcGFyYW1zID0gZGF0YS5zcGxpdCgnJicpO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IHBhcmFtcy5sZW5ndGg7IGkrKykge1xuICAgIHZhciBwYXJhbSA9IHBhcmFtc1tpXTtcbiAgICB2YXIga2V5VmFsdWUgPSBwYXJhbS5zcGxpdCgnPScpO1xuICAgIGlmIChrZXlWYWx1ZS5sZW5ndGggPiAxKSB7XG4gICAgICB2YXIga2V5ID0ga2V5VmFsdWVbMF07XG4gICAgICB2YXIgdmFsdWUgPSBrZXlWYWx1ZVsxXTtcblxuICAgICAgdmFyIGtleVBhcnRzID0ga2V5LnNwbGl0KCdfJyk7XG4gICAgICBpZiAoa2V5UGFydHMubGVuZ3RoID49IDIgJiYga2V5UGFydHNbMV0gPT0gJ3R5cGUnKSB7XG4gICAgICAgIG91dCArPSBrZXkgKyAnPScgKyB2YWx1ZSArICcmJztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG91dCArPSBrZXkgKyAnPScgK1xuICAgICAgICAgICAgJ3JlZGFjdGVkJyArXG4gICAgICAgICAgICAnJic7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIHJldHVybiBvdXQ7XG59O1xufSk7ICAvLyBnb29nLnNjb3BlXG4iLCAiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IFRoZSBDbG9zdXJlIExpYnJhcnkgQXV0aG9ycy5cbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBAZmlsZW92ZXJ2aWV3IFN0YXRpYyB1dGlsaXRpZXMgZm9yIGNvbGxlY3Rpbmcgc3RhdHMgYXNzb2NpYXRlZCB3aXRoXG4gKiBDaGFubmVsUmVxdWVzdC5cbiAqXG4gKi9cblxuXG5nb29nLnByb3ZpZGUoJ2dvb2cubGFicy5uZXQud2ViQ2hhbm5lbC5yZXF1ZXN0U3RhdHMnKTtcbmdvb2cucHJvdmlkZSgnZ29vZy5sYWJzLm5ldC53ZWJDaGFubmVsLnJlcXVlc3RTdGF0cy5FdmVudCcpO1xuZ29vZy5wcm92aWRlKCdnb29nLmxhYnMubmV0LndlYkNoYW5uZWwucmVxdWVzdFN0YXRzLlNlcnZlclJlYWNoYWJpbGl0eScpO1xuZ29vZy5wcm92aWRlKCdnb29nLmxhYnMubmV0LndlYkNoYW5uZWwucmVxdWVzdFN0YXRzLlNlcnZlclJlYWNoYWJpbGl0eUV2ZW50Jyk7XG5nb29nLnByb3ZpZGUoJ2dvb2cubGFicy5uZXQud2ViQ2hhbm5lbC5yZXF1ZXN0U3RhdHMuU3RhdCcpO1xuZ29vZy5wcm92aWRlKCdnb29nLmxhYnMubmV0LndlYkNoYW5uZWwucmVxdWVzdFN0YXRzLlN0YXRFdmVudCcpO1xuZ29vZy5wcm92aWRlKCdnb29nLmxhYnMubmV0LndlYkNoYW5uZWwucmVxdWVzdFN0YXRzLlRpbWluZ0V2ZW50Jyk7XG5cbmdvb2cucmVxdWlyZSgnZ29vZy5ldmVudHMuRXZlbnQnKTtcbmdvb2cucmVxdWlyZSgnZ29vZy5ldmVudHMuRXZlbnRUYXJnZXQnKTtcblxuXG5nb29nLnNjb3BlKGZ1bmN0aW9uKCkge1xuJ3VzZSBzdHJpY3QnO1xuY29uc3QgcmVxdWVzdFN0YXRzID0gZ29vZy5sYWJzLm5ldC53ZWJDaGFubmVsLnJlcXVlc3RTdGF0cztcblxuXG4vKipcbiAqIEV2ZW50cyBmaXJlZC5cbiAqIEBjb25zdFxuICovXG5yZXF1ZXN0U3RhdHMuRXZlbnQgPSB7fTtcblxuXG4vKipcbiAqIFNpbmdsZXRvbiBldmVudCB0YXJnZXQgZm9yIGZpcmluZyBzdGF0IGV2ZW50c1xuICogQHR5cGUgez9nb29nLmV2ZW50cy5FdmVudFRhcmdldH1cbiAqIEBwcml2YXRlXG4gKi9cbnJlcXVlc3RTdGF0cy5ldmVudFRhcmdldF8gPSBudWxsO1xuXG4vKipcbiAqIFNpbmdsZXRvbiBldmVudCB0YXJnZXQgZm9yIGZpcmluZyBzdGF0IGV2ZW50c1xuICogQHJldHVybiB7IWdvb2cuZXZlbnRzLkV2ZW50VGFyZ2V0fVxuICogQHByaXZhdGVcbiAqL1xucmVxdWVzdFN0YXRzLmdldFN0YXRFdmVudFRhcmdldF8gPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXF1ZXN0U3RhdHMuZXZlbnRUYXJnZXRfID1cbiAgICAgIHJlcXVlc3RTdGF0cy5ldmVudFRhcmdldF8gfHwgbmV3IGdvb2cuZXZlbnRzLkV2ZW50VGFyZ2V0KCk7XG4gIHJldHVybiByZXF1ZXN0U3RhdHMuZXZlbnRUYXJnZXRfO1xufTtcblxuLyoqXG4gKiBUaGUgdHlwZSBvZiBldmVudCB0aGF0IG9jY3VycyBldmVyeSB0aW1lIHNvbWUgaW5mb3JtYXRpb24gYWJvdXQgaG93IHJlYWNoYWJsZVxuICogdGhlIHNlcnZlciBpcyBpcyBkaXNjb3ZlcmVkLlxuICovXG5yZXF1ZXN0U3RhdHMuRXZlbnQuU0VSVkVSX1JFQUNIQUJJTElUWV9FVkVOVCA9ICdzZXJ2ZXJyZWFjaGFiaWxpdHknO1xuXG5cbi8qKlxuICogVHlwZXMgb2YgZXZlbnRzIHdoaWNoIHJldmVhbCBpbmZvcm1hdGlvbiBhYm91dCB0aGUgcmVhY2hhYmlsaXR5IG9mIHRoZVxuICogc2VydmVyLlxuICogQGVudW0ge251bWJlcn1cbiAqL1xucmVxdWVzdFN0YXRzLlNlcnZlclJlYWNoYWJpbGl0eSA9IHtcbiAgUkVRVUVTVF9NQURFOiAxLFxuICBSRVFVRVNUX1NVQ0NFRURFRDogMixcbiAgUkVRVUVTVF9GQUlMRUQ6IDMsXG4gIEJBQ0tfQ0hBTk5FTF9BQ1RJVklUWTogNCAgLy8gYW55IHJlc3BvbnNlIGRhdGEgcmVjZWl2ZWRcbn07XG5cblxuXG4vKipcbiAqIEV2ZW50IGNsYXNzIGZvciBTRVJWRVJfUkVBQ0hBQklMSVRZX0VWRU5ULlxuICpcbiAqIEBwYXJhbSB7Z29vZy5ldmVudHMuRXZlbnRUYXJnZXR9IHRhcmdldCBUaGUgc3RhdCBldmVudCB0YXJnZXQgZm9yXG4gICAgICAgdGhlIGNoYW5uZWwuXG4gKiBAcGFyYW0ge3JlcXVlc3RTdGF0cy5TZXJ2ZXJSZWFjaGFiaWxpdHl9IHJlYWNoYWJpbGl0eVR5cGVcbiAqICAgICBUaGUgcmVhY2hhYmlsaXR5IGV2ZW50IHR5cGUuXG4gKiBAY29uc3RydWN0b3JcbiAqIEBleHRlbmRzIHtnb29nLmV2ZW50cy5FdmVudH1cbiAqL1xucmVxdWVzdFN0YXRzLlNlcnZlclJlYWNoYWJpbGl0eUV2ZW50ID0gZnVuY3Rpb24odGFyZ2V0LCByZWFjaGFiaWxpdHlUeXBlKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgZ29vZy5ldmVudHMuRXZlbnQuY2FsbChcbiAgICAgIHRoaXMsIHJlcXVlc3RTdGF0cy5FdmVudC5TRVJWRVJfUkVBQ0hBQklMSVRZX0VWRU5ULCB0YXJnZXQpO1xuXG4gIC8qKlxuICAgKiBAdHlwZSB7cmVxdWVzdFN0YXRzLlNlcnZlclJlYWNoYWJpbGl0eX1cbiAgICovXG4gIHRoaXMucmVhY2hhYmlsaXR5VHlwZSA9IHJlYWNoYWJpbGl0eVR5cGU7XG59O1xuZ29vZy5pbmhlcml0cyhyZXF1ZXN0U3RhdHMuU2VydmVyUmVhY2hhYmlsaXR5RXZlbnQsIGdvb2cuZXZlbnRzLkV2ZW50KTtcblxuXG4vKipcbiAqIE5vdGlmeSB0aGUgY2hhbm5lbCB0aGF0IGEgcGFydGljdWxhciBmaW5lIGdyYWluZWQgbmV0d29yayBldmVudCBoYXMgb2NjdXJyZWQuXG4gKiBTaG91bGQgYmUgY29uc2lkZXJlZCBwYWNrYWdlLXByaXZhdGUuXG4gKiBAcGFyYW0ge3JlcXVlc3RTdGF0cy5TZXJ2ZXJSZWFjaGFiaWxpdHl9IHJlYWNoYWJpbGl0eVR5cGVcbiAqICAgICBUaGUgcmVhY2hhYmlsaXR5IGV2ZW50IHR5cGUuXG4gKi9cbnJlcXVlc3RTdGF0cy5ub3RpZnlTZXJ2ZXJSZWFjaGFiaWxpdHlFdmVudCA9IGZ1bmN0aW9uKHJlYWNoYWJpbGl0eVR5cGUpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBjb25zdCB0YXJnZXQgPSByZXF1ZXN0U3RhdHMuZ2V0U3RhdEV2ZW50VGFyZ2V0XygpO1xuICB0YXJnZXQuZGlzcGF0Y2hFdmVudChcbiAgICAgIG5ldyByZXF1ZXN0U3RhdHMuU2VydmVyUmVhY2hhYmlsaXR5RXZlbnQodGFyZ2V0LCByZWFjaGFiaWxpdHlUeXBlKSk7XG59O1xuXG5cbi8qKlxuICogU3RhdCBFdmVudCB0aGF0IGZpcmVzIHdoZW4gdGhpbmdzIG9mIGludGVyZXN0IGhhcHBlbiB0aGF0IG1heSBiZSB1c2VmdWwgZm9yXG4gKiBhcHBsaWNhdGlvbnMgdG8ga25vdyBhYm91dCBmb3Igc3RhdHMgb3IgZGVidWdnaW5nIHB1cnBvc2VzLlxuICovXG5yZXF1ZXN0U3RhdHMuRXZlbnQuU1RBVF9FVkVOVCA9ICdzdGF0ZXZlbnQnO1xuXG5cbi8qKlxuICogRW51bSB0aGF0IGlkZW50aWZpZXMgZXZlbnRzIGZvciBzdGF0aXN0aWNzIHRoYXQgYXJlIGludGVyZXN0aW5nIHRvIHRyYWNrLlxuICogQGVudW0ge251bWJlcn1cbiAqL1xucmVxdWVzdFN0YXRzLlN0YXQgPSB7XG4gIC8qKiBFdmVudCBpbmRpY2F0aW5nIGEgbmV3IGNvbm5lY3Rpb24gYXR0ZW1wdC4gKi9cbiAgQ09OTkVDVF9BVFRFTVBUOiAwLFxuXG4gIC8qKiBFdmVudCBpbmRpY2F0aW5nIGEgY29ubmVjdGlvbiBlcnJvciBkdWUgdG8gYSBnZW5lcmFsIG5ldHdvcmsgcHJvYmxlbS4gKi9cbiAgRVJST1JfTkVUV09SSzogMSxcblxuICAvKipcbiAgICogRXZlbnQgaW5kaWNhdGluZyBhIGNvbm5lY3Rpb24gZXJyb3IgdGhhdCBpc24ndCBkdWUgdG8gYSBnZW5lcmFsIG5ldHdvcmtcbiAgICogcHJvYmxlbS5cbiAgICovXG4gIEVSUk9SX09USEVSOiAyLFxuXG4gIC8qKiBFdmVudCBpbmRpY2F0aW5nIHRoZSBzdGFydCBvZiB0ZXN0IHN0YWdlIG9uZS4gKi9cbiAgVEVTVF9TVEFHRV9PTkVfU1RBUlQ6IDMsXG5cbiAgLyoqIEV2ZW50IGluZGljYXRpbmcgdGhlIHN0YXJ0IG9mIHRlc3Qgc3RhZ2UgdHdvLiAqL1xuICBURVNUX1NUQUdFX1RXT19TVEFSVDogNCxcblxuICAvKiogRXZlbnQgaW5kaWNhdGluZyB0aGUgZmlyc3QgcGllY2Ugb2YgdGVzdCBkYXRhIHdhcyByZWNlaXZlZC4gKi9cbiAgVEVTVF9TVEFHRV9UV09fREFUQV9PTkU6IDUsXG5cbiAgLyoqXG4gICAqIEV2ZW50IGluZGljYXRpbmcgdGhhdCB0aGUgc2Vjb25kIHBpZWNlIG9mIHRlc3QgZGF0YSB3YXMgcmVjZWl2ZWQgYW5kIGl0IHdhc1xuICAgKiByZWNlaXZlZCBzZXBhcmF0ZWx5IGZyb20gdGhlIGZpcnN0LlxuICAgKi9cbiAgVEVTVF9TVEFHRV9UV09fREFUQV9UV086IDYsXG5cbiAgLyoqIEV2ZW50IGluZGljYXRpbmcgYm90aCBwaWVjZXMgb2YgdGVzdCBkYXRhIHdlcmUgcmVjZWl2ZWQgc2ltdWx0YW5lb3VzbHkuICovXG4gIFRFU1RfU1RBR0VfVFdPX0RBVEFfQk9USDogNyxcblxuICAvKiogRXZlbnQgaW5kaWNhdGluZyBzdGFnZSBvbmUgb2YgdGhlIHRlc3QgcmVxdWVzdCBmYWlsZWQuICovXG4gIFRFU1RfU1RBR0VfT05FX0ZBSUxFRDogOCxcblxuICAvKiogRXZlbnQgaW5kaWNhdGluZyBzdGFnZSB0d28gb2YgdGhlIHRlc3QgcmVxdWVzdCBmYWlsZWQuICovXG4gIFRFU1RfU1RBR0VfVFdPX0ZBSUxFRDogOSxcblxuICAvKipcbiAgICogRXZlbnQgaW5kaWNhdGluZyB0aGF0IGEgYnVmZmVyaW5nIHByb3h5IGlzIGxpa2VseSBiZXR3ZWVuIHRoZSBjbGllbnQgYW5kXG4gICAqIHRoZSBzZXJ2ZXIuXG4gICAqL1xuICBQUk9YWTogMTAsXG5cbiAgLyoqXG4gICAqIEV2ZW50IGluZGljYXRpbmcgdGhhdCBubyBidWZmZXJpbmcgcHJveHkgaXMgbGlrZWx5IGJldHdlZW4gdGhlIGNsaWVudCBhbmRcbiAgICogdGhlIHNlcnZlci5cbiAgICovXG4gIE5PUFJPWFk6IDExLFxuXG4gIC8qKiBFdmVudCBpbmRpY2F0aW5nIGFuIHVua25vd24gU0lEIGVycm9yLiAqL1xuICBSRVFVRVNUX1VOS05PV05fU0VTU0lPTl9JRDogMTIsXG5cbiAgLyoqIEV2ZW50IGluZGljYXRpbmcgYSBiYWQgc3RhdHVzIGNvZGUgd2FzIHJlY2VpdmVkLiAqL1xuICBSRVFVRVNUX0JBRF9TVEFUVVM6IDEzLFxuXG4gIC8qKiBFdmVudCBpbmRpY2F0aW5nIGluY29tcGxldGUgZGF0YSB3YXMgcmVjZWl2ZWQgKi9cbiAgUkVRVUVTVF9JTkNPTVBMRVRFX0RBVEE6IDE0LFxuXG4gIC8qKiBFdmVudCBpbmRpY2F0aW5nIGJhZCBkYXRhIHdhcyByZWNlaXZlZCAqL1xuICBSRVFVRVNUX0JBRF9EQVRBOiAxNSxcblxuICAvKiogRXZlbnQgaW5kaWNhdGluZyBubyBkYXRhIHdhcyByZWNlaXZlZCB3aGVuIGRhdGEgd2FzIGV4cGVjdGVkLiAqL1xuICBSRVFVRVNUX05PX0RBVEE6IDE2LFxuXG4gIC8qKiBFdmVudCBpbmRpY2F0aW5nIGEgcmVxdWVzdCB0aW1lb3V0LiAqL1xuICBSRVFVRVNUX1RJTUVPVVQ6IDE3LFxuXG4gIC8qKlxuICAgKiBFdmVudCBpbmRpY2F0aW5nIHRoYXQgdGhlIHNlcnZlciBuZXZlciByZWNlaXZlZCBvdXIgaGFuZ2luZyBHRVQgYW5kIHNvIGl0XG4gICAqIGlzIGJlaW5nIHJldHJpZWQuXG4gICAqL1xuICBCQUNLQ0hBTk5FTF9NSVNTSU5HOiAxOCxcblxuICAvKipcbiAgICogRXZlbnQgaW5kaWNhdGluZyB0aGF0IHdlIGhhdmUgZGV0ZXJtaW5lZCB0aGF0IG91ciBoYW5naW5nIEdFVCBpcyBub3RcbiAgICogcmVjZWl2aW5nIGRhdGEgd2hlbiBpdCBzaG91bGQgYmUuIFRodXMgaXQgaXMgZGVhZCBkZWFkIGFuZCB3aWxsIGJlIHJldHJpZWQuXG4gICAqL1xuICBCQUNLQ0hBTk5FTF9ERUFEOiAxOSxcblxuICAvKipcbiAgICogVGhlIGJyb3dzZXIgZGVjbGFyZWQgaXRzZWxmIG9mZmxpbmUgZHVyaW5nIHRoZSBsaWZldGltZSBvZiBhIHJlcXVlc3QsIG9yXG4gICAqIHdhcyBvZmZsaW5lIHdoZW4gYSByZXF1ZXN0IHdhcyBpbml0aWFsbHkgbWFkZS5cbiAgICovXG4gIEJST1dTRVJfT0ZGTElORTogMjBcbn07XG5cblxuXG4vKipcbiAqIEV2ZW50IGNsYXNzIGZvciBTVEFUX0VWRU5ULlxuICpcbiAqIEBwYXJhbSB7Z29vZy5ldmVudHMuRXZlbnRUYXJnZXR9IGV2ZW50VGFyZ2V0IFRoZSBzdGF0IGV2ZW50IHRhcmdldCBmb3JcbiAgICAgICB0aGUgY2hhbm5lbC5cbiAqIEBwYXJhbSB7cmVxdWVzdFN0YXRzLlN0YXR9IHN0YXQgVGhlIHN0YXQuXG4gKiBAY29uc3RydWN0b3JcbiAqIEBleHRlbmRzIHtnb29nLmV2ZW50cy5FdmVudH1cbiAqL1xucmVxdWVzdFN0YXRzLlN0YXRFdmVudCA9IGZ1bmN0aW9uKGV2ZW50VGFyZ2V0LCBzdGF0KSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgZ29vZy5ldmVudHMuRXZlbnQuY2FsbCh0aGlzLCByZXF1ZXN0U3RhdHMuRXZlbnQuU1RBVF9FVkVOVCwgZXZlbnRUYXJnZXQpO1xuXG4gIC8qKlxuICAgKiBUaGUgc3RhdFxuICAgKiBAdHlwZSB7cmVxdWVzdFN0YXRzLlN0YXR9XG4gICAqL1xuICB0aGlzLnN0YXQgPSBzdGF0O1xufTtcbmdvb2cuaW5oZXJpdHMocmVxdWVzdFN0YXRzLlN0YXRFdmVudCwgZ29vZy5ldmVudHMuRXZlbnQpO1xuXG5cbi8qKlxuICogUmV0dXJucyB0aGUgc2luZ2xldG9uIGV2ZW50IHRhcmdldCBmb3Igc3RhdCBldmVudHMuXG4gKiBAcmV0dXJuIHshZ29vZy5ldmVudHMuRXZlbnRUYXJnZXR9IFRoZSBldmVudCB0YXJnZXQgZm9yIHN0YXQgZXZlbnRzLlxuICovXG5yZXF1ZXN0U3RhdHMuZ2V0U3RhdEV2ZW50VGFyZ2V0ID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmV0dXJuIHJlcXVlc3RTdGF0cy5nZXRTdGF0RXZlbnRUYXJnZXRfKCk7XG59O1xuXG5cbi8qKlxuICogSGVscGVyIGZ1bmN0aW9uIHRvIGNhbGwgdGhlIHN0YXQgZXZlbnQgY2FsbGJhY2suXG4gKiBAcGFyYW0ge3JlcXVlc3RTdGF0cy5TdGF0fSBzdGF0IFRoZSBzdGF0LlxuICovXG5yZXF1ZXN0U3RhdHMubm90aWZ5U3RhdEV2ZW50ID0gZnVuY3Rpb24oc3RhdCkge1xuICAndXNlIHN0cmljdCc7XG4gIGNvbnN0IHRhcmdldCA9IHJlcXVlc3RTdGF0cy5nZXRTdGF0RXZlbnRUYXJnZXRfKCk7XG4gIHRhcmdldC5kaXNwYXRjaEV2ZW50KG5ldyByZXF1ZXN0U3RhdHMuU3RhdEV2ZW50KHRhcmdldCwgc3RhdCkpO1xufTtcblxuXG4vKipcbiAqIEFuIGV2ZW50IHRoYXQgZmlyZXMgd2hlbiBQT1NUIHJlcXVlc3RzIGNvbXBsZXRlIHN1Y2Nlc3NmdWxseSwgaW5kaWNhdGluZ1xuICogdGhlIHNpemUgb2YgdGhlIFBPU1QgYW5kIHRoZSByb3VuZCB0cmlwIHRpbWUuXG4gKi9cbnJlcXVlc3RTdGF0cy5FdmVudC5USU1JTkdfRVZFTlQgPSAndGltaW5nZXZlbnQnO1xuXG5cblxuLyoqXG4gKiBFdmVudCBjbGFzcyBmb3IgcmVxdWVzdFN0YXRzLkV2ZW50LlRJTUlOR19FVkVOVFxuICpcbiAqIEBwYXJhbSB7Z29vZy5ldmVudHMuRXZlbnRUYXJnZXR9IHRhcmdldCBUaGUgc3RhdCBldmVudCB0YXJnZXQgZm9yXG4gICAgICAgdGhlIGNoYW5uZWwuXG4gKiBAcGFyYW0ge251bWJlcn0gc2l6ZSBUaGUgbnVtYmVyIG9mIGNoYXJhY3RlcnMgaW4gdGhlIFBPU1QgZGF0YS5cbiAqIEBwYXJhbSB7bnVtYmVyfSBydHQgVGhlIHRvdGFsIHJvdW5kIHRyaXAgdGltZSBmcm9tIFBPU1QgdG8gcmVzcG9uc2UgaW4gTVMuXG4gKiBAcGFyYW0ge251bWJlcn0gcmV0cmllcyBUaGUgbnVtYmVyIG9mIHRpbWVzIHRoZSBQT1NUIGhhZCB0byBiZSByZXRyaWVkLlxuICogQGNvbnN0cnVjdG9yXG4gKiBAZXh0ZW5kcyB7Z29vZy5ldmVudHMuRXZlbnR9XG4gKi9cbnJlcXVlc3RTdGF0cy5UaW1pbmdFdmVudCA9IGZ1bmN0aW9uKHRhcmdldCwgc2l6ZSwgcnR0LCByZXRyaWVzKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgZ29vZy5ldmVudHMuRXZlbnQuY2FsbCh0aGlzLCByZXF1ZXN0U3RhdHMuRXZlbnQuVElNSU5HX0VWRU5ULCB0YXJnZXQpO1xuXG4gIC8qKlxuICAgKiBAdHlwZSB7bnVtYmVyfVxuICAgKi9cbiAgdGhpcy5zaXplID0gc2l6ZTtcblxuICAvKipcbiAgICogQHR5cGUge251bWJlcn1cbiAgICovXG4gIHRoaXMucnR0ID0gcnR0O1xuXG4gIC8qKlxuICAgKiBAdHlwZSB7bnVtYmVyfVxuICAgKi9cbiAgdGhpcy5yZXRyaWVzID0gcmV0cmllcztcbn07XG5nb29nLmluaGVyaXRzKHJlcXVlc3RTdGF0cy5UaW1pbmdFdmVudCwgZ29vZy5ldmVudHMuRXZlbnQpO1xuXG5cbi8qKlxuICogSGVscGVyIGZ1bmN0aW9uIHRvIG5vdGlmeSBsaXN0ZW5lcnMgYWJvdXQgUE9TVCByZXF1ZXN0IHBlcmZvcm1hbmNlLlxuICpcbiAqIEBwYXJhbSB7bnVtYmVyfSBzaXplIE51bWJlciBvZiBjaGFyYWN0ZXJzIGluIHRoZSBQT1NUIGRhdGEuXG4gKiBAcGFyYW0ge251bWJlcn0gcnR0IFRoZSBhbW91bnQgb2YgdGltZSBmcm9tIFBPU1Qgc3RhcnQgdG8gcmVzcG9uc2UuXG4gKiBAcGFyYW0ge251bWJlcn0gcmV0cmllcyBUaGUgbnVtYmVyIG9mIHRpbWVzIHRoZSBQT1NUIGhhZCB0byBiZSByZXRyaWVkLlxuICovXG5yZXF1ZXN0U3RhdHMubm90aWZ5VGltaW5nRXZlbnQgPSBmdW5jdGlvbihzaXplLCBydHQsIHJldHJpZXMpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBjb25zdCB0YXJnZXQgPSByZXF1ZXN0U3RhdHMuZ2V0U3RhdEV2ZW50VGFyZ2V0XygpO1xuICB0YXJnZXQuZGlzcGF0Y2hFdmVudChcbiAgICAgIG5ldyByZXF1ZXN0U3RhdHMuVGltaW5nRXZlbnQodGFyZ2V0LCBzaXplLCBydHQsIHJldHJpZXMpKTtcbn07XG5cblxuLyoqXG4gKiBBbGxvd3MgdGhlIGFwcGxpY2F0aW9uIHRvIHNldCBhbiBleGVjdXRpb24gaG9va3MgZm9yIHdoZW4gYSBjaGFubmVsXG4gKiBzdGFydHMgcHJvY2Vzc2luZyByZXF1ZXN0cy4gVGhpcyBpcyB1c2VmdWwgdG8gdHJhY2sgdGltaW5nIG9yIGxvZ2dpbmdcbiAqIHNwZWNpYWwgaW5mb3JtYXRpb24uIFRoZSBmdW5jdGlvbiB0YWtlcyBubyBwYXJhbWV0ZXJzIGFuZCByZXR1cm4gdm9pZC5cbiAqIEBwYXJhbSB7RnVuY3Rpb259IHN0YXJ0SG9vayAgVGhlIGZ1bmN0aW9uIGZvciB0aGUgc3RhcnQgaG9vay5cbiAqL1xucmVxdWVzdFN0YXRzLnNldFN0YXJ0VGhyZWFkRXhlY3V0aW9uSG9vayA9IGZ1bmN0aW9uKHN0YXJ0SG9vaykge1xuICAndXNlIHN0cmljdCc7XG4gIHJlcXVlc3RTdGF0cy5zdGFydEV4ZWN1dGlvbkhvb2tfID0gc3RhcnRIb29rO1xufTtcblxuXG4vKipcbiAqIEFsbG93cyB0aGUgYXBwbGljYXRpb24gdG8gc2V0IGFuIGV4ZWN1dGlvbiBob29rcyBmb3Igd2hlbiBhIGNoYW5uZWxcbiAqIHN0b3BzIHByb2Nlc3NpbmcgcmVxdWVzdHMuIFRoaXMgaXMgdXNlZnVsIHRvIHRyYWNrIHRpbWluZyBvciBsb2dnaW5nXG4gKiBzcGVjaWFsIGluZm9ybWF0aW9uLiBUaGUgZnVuY3Rpb24gdGFrZXMgbm8gcGFyYW1ldGVycyBhbmQgcmV0dXJuIHZvaWQuXG4gKiBAcGFyYW0ge0Z1bmN0aW9ufSBlbmRIb29rICBUaGUgZnVuY3Rpb24gZm9yIHRoZSBlbmQgaG9vay5cbiAqL1xucmVxdWVzdFN0YXRzLnNldEVuZFRocmVhZEV4ZWN1dGlvbkhvb2sgPSBmdW5jdGlvbihlbmRIb29rKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmVxdWVzdFN0YXRzLmVuZEV4ZWN1dGlvbkhvb2tfID0gZW5kSG9vaztcbn07XG5cblxuLyoqXG4gKiBBcHBsaWNhdGlvbiBwcm92aWRlZCBleGVjdXRpb24gaG9vayBmb3IgdGhlIHN0YXJ0IGhvb2suXG4gKlxuICogQHR5cGUge0Z1bmN0aW9ufVxuICogQHByaXZhdGVcbiAqL1xucmVxdWVzdFN0YXRzLnN0YXJ0RXhlY3V0aW9uSG9va18gPSBmdW5jdGlvbigpIHt9O1xuXG5cbi8qKlxuICogQXBwbGljYXRpb24gcHJvdmlkZWQgZXhlY3V0aW9uIGhvb2sgZm9yIHRoZSBlbmQgaG9vay5cbiAqXG4gKiBAdHlwZSB7RnVuY3Rpb259XG4gKiBAcHJpdmF0ZVxuICovXG5yZXF1ZXN0U3RhdHMuZW5kRXhlY3V0aW9uSG9va18gPSBmdW5jdGlvbigpIHt9O1xuXG5cbi8qKlxuICogSGVscGVyIGZ1bmN0aW9uIHRvIGNhbGwgdGhlIHN0YXJ0IGhvb2tcbiAqL1xucmVxdWVzdFN0YXRzLm9uU3RhcnRFeGVjdXRpb24gPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXF1ZXN0U3RhdHMuc3RhcnRFeGVjdXRpb25Ib29rXygpO1xufTtcblxuXG4vKipcbiAqIEhlbHBlciBmdW5jdGlvbiB0byBjYWxsIHRoZSBlbmQgaG9va1xuICovXG5yZXF1ZXN0U3RhdHMub25FbmRFeGVjdXRpb24gPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXF1ZXN0U3RhdHMuZW5kRXhlY3V0aW9uSG9va18oKTtcbn07XG5cblxuLyoqXG4gKiBXcmFwcGVyIGFyb3VuZCBTYWZlVGltZW91dCB3aGljaCBjYWxscyB0aGUgc3RhcnQgYW5kIGVuZCBleGVjdXRpb24gaG9va3NcbiAqIHdpdGggYSB0cnkuLi5maW5hbGx5IGJsb2NrLlxuICogQHBhcmFtIHtGdW5jdGlvbn0gZm4gVGhlIGNhbGxiYWNrIGZ1bmN0aW9uLlxuICogQHBhcmFtIHtudW1iZXJ9IG1zIFRoZSB0aW1lIGluIE1TIGZvciB0aGUgdGltZXIuXG4gKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBJRCBvZiB0aGUgdGltZXIuXG4gKi9cbnJlcXVlc3RTdGF0cy5zZXRUaW1lb3V0ID0gZnVuY3Rpb24oZm4sIG1zKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgaWYgKHR5cGVvZiBmbiAhPT0gJ2Z1bmN0aW9uJykge1xuICAgIHRocm93IG5ldyBFcnJvcignRm4gbXVzdCBub3QgYmUgbnVsbCBhbmQgbXVzdCBiZSBhIGZ1bmN0aW9uJyk7XG4gIH1cbiAgcmV0dXJuIGdvb2cuZ2xvYmFsLnNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIHJlcXVlc3RTdGF0cy5vblN0YXJ0RXhlY3V0aW9uKCk7XG4gICAgdHJ5IHtcbiAgICAgIGZuKCk7XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIHJlcXVlc3RTdGF0cy5vbkVuZEV4ZWN1dGlvbigpO1xuICAgIH1cbiAgfSwgbXMpO1xufTtcbn0pOyAgLy8gZ29vZy5zY29wZVxuIiwgIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCBUaGUgQ2xvc3VyZSBMaWJyYXJ5IEF1dGhvcnMuXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogQGZpbGVvdmVydmlldyBFcnJvciBjb2RlcyBzaGFyZWQgYmV0d2VlbiBnb29nLm5ldC5JZnJhbWVJbyBhbmRcbiAqIGdvb2cubmV0LlhocklvLlxuICovXG5cbmdvb2cucHJvdmlkZSgnZ29vZy5uZXQuRXJyb3JDb2RlJyk7XG5cblxuLyoqXG4gKiBFcnJvciBjb2Rlc1xuICogQGVudW0ge251bWJlcn1cbiAqL1xuZ29vZy5uZXQuRXJyb3JDb2RlID0ge1xuXG4gIC8qKlxuICAgKiBUaGVyZSBpcyBubyBlcnJvciBjb25kaXRpb24uXG4gICAqL1xuICBOT19FUlJPUjogMCxcblxuICAvKipcbiAgICogVGhlIG1vc3QgY29tbW9uIGVycm9yIGZyb20gaWZyYW1laW8sIHVuZm9ydHVuYXRlbHksIGlzIHRoYXQgdGhlIGJyb3dzZXJcbiAgICogcmVzcG9uZGVkIHdpdGggYW4gZXJyb3IgcGFnZSB0aGF0IGlzIGNsYXNzZWQgYXMgYSBkaWZmZXJlbnQgZG9tYWluLiBUaGVcbiAgICogc2l0dWF0aW9ucywgYXJlIHdoZW4gYSBicm93c2VyIGVycm9yIHBhZ2UgIGlzIHNob3duIC0tIDQwNCwgYWNjZXNzIGRlbmllZCxcbiAgICogRE5TIGZhaWx1cmUsIGNvbm5lY3Rpb24gcmVzZXQgZXRjLilcbiAgICpcbiAgICovXG4gIEFDQ0VTU19ERU5JRUQ6IDEsXG5cbiAgLyoqXG4gICAqIEN1cnJlbnRseSB0aGUgb25seSBjYXNlIHdoZXJlIGZpbGUgbm90IGZvdW5kIHdpbGwgYmUgY2F1c2VkIGlzIHdoZW4gdGhlXG4gICAqIGNvZGUgaXMgcnVubmluZyBvbiB0aGUgbG9jYWwgZmlsZSBzeXN0ZW0gYW5kIGEgbm9uLUlFIGJyb3dzZXIgbWFrZXMgYVxuICAgKiByZXF1ZXN0IHRvIGEgZmlsZSB0aGF0IGRvZXNuJ3QgZXhpc3QuXG4gICAqL1xuICBGSUxFX05PVF9GT1VORDogMixcblxuICAvKipcbiAgICogSWYgRmlyZWZveCBzaG93cyBhIGJyb3dzZXIgZXJyb3IgcGFnZSwgc3VjaCBhcyBhIGNvbm5lY3Rpb24gcmVzZXQgYnlcbiAgICogc2VydmVyIG9yIGFjY2VzcyBkZW5pZWQsIHRoZW4gaXQgd2lsbCBmYWlsIHNpbGVudGx5IHdpdGhvdXQgdGhlIGVycm9yIG9yXG4gICAqIGxvYWQgaGFuZGxlcnMgZmlyaW5nLlxuICAgKi9cbiAgRkZfU0lMRU5UX0VSUk9SOiAzLFxuXG4gIC8qKlxuICAgKiBDdXN0b20gZXJyb3IgcHJvdmlkZWQgYnkgdGhlIGNsaWVudCB0aHJvdWdoIHRoZSBlcnJvciBjaGVjayBob29rLlxuICAgKi9cbiAgQ1VTVE9NX0VSUk9SOiA0LFxuXG4gIC8qKlxuICAgKiBFeGNlcHRpb24gd2FzIHRocm93biB3aGlsZSBwcm9jZXNzaW5nIHRoZSByZXF1ZXN0LlxuICAgKi9cbiAgRVhDRVBUSU9OOiA1LFxuXG4gIC8qKlxuICAgKiBUaGUgSHR0cCByZXNwb25zZSByZXR1cm5lZCBhIG5vbi1zdWNjZXNzZnVsIGh0dHAgc3RhdHVzIGNvZGUuXG4gICAqL1xuICBIVFRQX0VSUk9SOiA2LFxuXG4gIC8qKlxuICAgKiBUaGUgcmVxdWVzdCB3YXMgYWJvcnRlZC5cbiAgICovXG4gIEFCT1JUOiA3LFxuXG4gIC8qKlxuICAgKiBUaGUgcmVxdWVzdCB0aW1lZCBvdXQuXG4gICAqL1xuICBUSU1FT1VUOiA4LFxuXG4gIC8qKlxuICAgKiBUaGUgcmVzb3VyY2UgaXMgbm90IGF2YWlsYWJsZSBvZmZsaW5lLlxuICAgKi9cbiAgT0ZGTElORTogOSxcbn07XG5cblxuLyoqXG4gKiBSZXR1cm5zIGEgZnJpZW5kbHkgZXJyb3IgbWVzc2FnZSBmb3IgYW4gZXJyb3IgY29kZS4gVGhlc2UgbWVzc2FnZXMgYXJlIGZvclxuICogZGVidWdnaW5nIGFuZCBhcmUgbm90IGxvY2FsaXplZC5cbiAqIEBwYXJhbSB7Z29vZy5uZXQuRXJyb3JDb2RlfSBlcnJvckNvZGUgQW4gZXJyb3IgY29kZS5cbiAqIEByZXR1cm4ge3N0cmluZ30gQSBtZXNzYWdlIGZvciBkZWJ1Z2dpbmcuXG4gKi9cbmdvb2cubmV0LkVycm9yQ29kZS5nZXREZWJ1Z01lc3NhZ2UgPSBmdW5jdGlvbihlcnJvckNvZGUpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBzd2l0Y2ggKGVycm9yQ29kZSkge1xuICAgIGNhc2UgZ29vZy5uZXQuRXJyb3JDb2RlLk5PX0VSUk9SOlxuICAgICAgcmV0dXJuICdObyBFcnJvcic7XG5cbiAgICBjYXNlIGdvb2cubmV0LkVycm9yQ29kZS5BQ0NFU1NfREVOSUVEOlxuICAgICAgcmV0dXJuICdBY2Nlc3MgZGVuaWVkIHRvIGNvbnRlbnQgZG9jdW1lbnQnO1xuXG4gICAgY2FzZSBnb29nLm5ldC5FcnJvckNvZGUuRklMRV9OT1RfRk9VTkQ6XG4gICAgICByZXR1cm4gJ0ZpbGUgbm90IGZvdW5kJztcblxuICAgIGNhc2UgZ29vZy5uZXQuRXJyb3JDb2RlLkZGX1NJTEVOVF9FUlJPUjpcbiAgICAgIHJldHVybiAnRmlyZWZveCBzaWxlbnRseSBlcnJvcmVkJztcblxuICAgIGNhc2UgZ29vZy5uZXQuRXJyb3JDb2RlLkNVU1RPTV9FUlJPUjpcbiAgICAgIHJldHVybiAnQXBwbGljYXRpb24gY3VzdG9tIGVycm9yJztcblxuICAgIGNhc2UgZ29vZy5uZXQuRXJyb3JDb2RlLkVYQ0VQVElPTjpcbiAgICAgIHJldHVybiAnQW4gZXhjZXB0aW9uIG9jY3VycmVkJztcblxuICAgIGNhc2UgZ29vZy5uZXQuRXJyb3JDb2RlLkhUVFBfRVJST1I6XG4gICAgICByZXR1cm4gJ0h0dHAgcmVzcG9uc2UgYXQgNDAwIG9yIDUwMCBsZXZlbCc7XG5cbiAgICBjYXNlIGdvb2cubmV0LkVycm9yQ29kZS5BQk9SVDpcbiAgICAgIHJldHVybiAnUmVxdWVzdCB3YXMgYWJvcnRlZCc7XG5cbiAgICBjYXNlIGdvb2cubmV0LkVycm9yQ29kZS5USU1FT1VUOlxuICAgICAgcmV0dXJuICdSZXF1ZXN0IHRpbWVkIG91dCc7XG5cbiAgICBjYXNlIGdvb2cubmV0LkVycm9yQ29kZS5PRkZMSU5FOlxuICAgICAgcmV0dXJuICdUaGUgcmVzb3VyY2UgaXMgbm90IGF2YWlsYWJsZSBvZmZsaW5lJztcblxuICAgIGRlZmF1bHQ6XG4gICAgICByZXR1cm4gJ1VucmVjb2duaXplZCBlcnJvciBjb2RlJztcbiAgfVxufTtcbiIsICIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgVGhlIENsb3N1cmUgTGlicmFyeSBBdXRob3JzLlxuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIEBmaWxlb3ZlcnZpZXcgQ29tbW9uIGV2ZW50cyBmb3IgdGhlIG5ldHdvcmsgY2xhc3Nlcy5cbiAqL1xuXG5cbmdvb2cucHJvdmlkZSgnZ29vZy5uZXQuRXZlbnRUeXBlJyk7XG5cblxuLyoqXG4gKiBFdmVudCBuYW1lcyBmb3IgbmV0d29yayBldmVudHNcbiAqIEBlbnVtIHtzdHJpbmd9XG4gKi9cbmdvb2cubmV0LkV2ZW50VHlwZSA9IHtcbiAgQ09NUExFVEU6ICdjb21wbGV0ZScsXG4gIFNVQ0NFU1M6ICdzdWNjZXNzJyxcbiAgRVJST1I6ICdlcnJvcicsXG4gIEFCT1JUOiAnYWJvcnQnLFxuICBSRUFEWTogJ3JlYWR5JyxcbiAgUkVBRFlfU1RBVEVfQ0hBTkdFOiAncmVhZHlzdGF0ZWNoYW5nZScsXG4gIFRJTUVPVVQ6ICd0aW1lb3V0JyxcbiAgSU5DUkVNRU5UQUxfREFUQTogJ2luY3JlbWVudGFsZGF0YScsXG4gIFBST0dSRVNTOiAncHJvZ3Jlc3MnLFxuICAvLyBET1dOTE9BRF9QUk9HUkVTUyBhbmQgVVBMT0FEX1BST0dSRVNTIGFyZSBzcGVjaWFsIGV2ZW50cyBkaXNwYXRjaGVkIGJ5XG4gIC8vIGdvb2cubmV0LlhocklvIHRvIGFsbG93IGJpbmRpbmcgbGlzdGVuZXJzIHNwZWNpZmljIHRvIGVhY2ggdHlwZSBvZlxuICAvLyBwcm9ncmVzcy5cbiAgRE9XTkxPQURfUFJPR1JFU1M6ICdkb3dubG9hZHByb2dyZXNzJyxcbiAgVVBMT0FEX1BST0dSRVNTOiAndXBsb2FkcHJvZ3Jlc3MnLFxufTtcbiIsICIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgVGhlIENsb3N1cmUgTGlicmFyeSBBdXRob3JzLlxuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIEBmaWxlb3ZlcnZpZXcgSW50ZXJmYWNlIGZvciBhIGZhY3RvcnkgZm9yIGNyZWF0aW5nIFhNTEh0dHBSZXF1ZXN0IG9iamVjdHNcbiAqIGFuZCBtZXRhZGF0YSBhYm91dCB0aGVtLlxuICovXG5cbmdvb2cucHJvdmlkZSgnZ29vZy5uZXQuWG1sSHR0cEZhY3RvcnknKTtcblxuLyoqIEBzdXBwcmVzcyB7ZXh0cmFSZXF1aXJlfSBUeXBlZGVmLiAqL1xuZ29vZy5yZXF1aXJlKCdnb29nLm5ldC5YaHJMaWtlJyk7XG5cblxuXG4vKipcbiAqIEFic3RyYWN0IGJhc2UgY2xhc3MgZm9yIGFuIFhtbEh0dHBSZXF1ZXN0IGZhY3RvcnkuXG4gKiBAY29uc3RydWN0b3JcbiAqL1xuZ29vZy5uZXQuWG1sSHR0cEZhY3RvcnkgPSBmdW5jdGlvbigpIHt9O1xuXG5cbi8qKlxuICogQ2FjaGUgb2Ygb3B0aW9ucyAtIHdlIG9ubHkgYWN0dWFsbHkgY2FsbCBpbnRlcm5hbEdldE9wdGlvbnMgb25jZS5cbiAqIEB0eXBlIHs/T2JqZWN0fVxuICogQHByaXZhdGVcbiAqL1xuZ29vZy5uZXQuWG1sSHR0cEZhY3RvcnkucHJvdG90eXBlLmNhY2hlZE9wdGlvbnNfID0gbnVsbDtcblxuXG4vKipcbiAqIEByZXR1cm4geyFnb29nLm5ldC5YaHJMaWtlLk9yTmF0aXZlfSBBIG5ldyBYaHJMaWtlIGluc3RhbmNlLlxuICovXG5nb29nLm5ldC5YbWxIdHRwRmFjdG9yeS5wcm90b3R5cGUuY3JlYXRlSW5zdGFuY2UgPSBnb29nLmFic3RyYWN0TWV0aG9kO1xuXG5cbi8qKlxuICogQHJldHVybiB7T2JqZWN0fSBPcHRpb25zIGRlc2NyaWJpbmcgaG93IHhociBvYmplY3RzIG9idGFpbmVkIGZyb20gdGhpc1xuICogICAgIGZhY3Rvcnkgc2hvdWxkIGJlIHVzZWQuXG4gKi9cbmdvb2cubmV0LlhtbEh0dHBGYWN0b3J5LnByb3RvdHlwZS5nZXRPcHRpb25zID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmV0dXJuIHRoaXMuY2FjaGVkT3B0aW9uc18gfHxcbiAgICAgICh0aGlzLmNhY2hlZE9wdGlvbnNfID0gdGhpcy5pbnRlcm5hbEdldE9wdGlvbnMoKSk7XG59O1xuXG5cbi8qKlxuICogT3ZlcnJpZGUgdGhpcyBtZXRob2QgaW4gc3ViY2xhc3NlcyB0byBwcmVzZXJ2ZSB0aGUgY2FjaGluZyBvZmZlcmVkIGJ5XG4gKiBnZXRPcHRpb25zKCkuXG4gKiBAcmV0dXJuIHtPYmplY3R9IE9wdGlvbnMgZGVzY3JpYmluZyBob3cgeGhyIG9iamVjdHMgb2J0YWluZWQgZnJvbSB0aGlzXG4gKiAgICAgZmFjdG9yeSBzaG91bGQgYmUgdXNlZC5cbiAqIEBwcm90ZWN0ZWRcbiAqL1xuZ29vZy5uZXQuWG1sSHR0cEZhY3RvcnkucHJvdG90eXBlLmludGVybmFsR2V0T3B0aW9ucyA9IGdvb2cuYWJzdHJhY3RNZXRob2Q7XG4iLCAiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IFRoZSBDbG9zdXJlIExpYnJhcnkgQXV0aG9ycy5cbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBAZmlsZW92ZXJ2aWV3IFRoZSBBUEkgc3BlYyBmb3IgdGhlIFdlYkNoYW5uZWwgbWVzc2FnaW5nIGxpYnJhcnkuXG4gKlxuICogU2ltaWxhciB0byBIVE1MNSBXZWJTb2NrZXQsIFdlYkNoYW5uZWwgb2ZmZXJzIGFuIGFic3RyYWN0aW9uIGZvclxuICogcG9pbnQtdG8tcG9pbnQgc29ja2V0LWxpa2UgY29tbXVuaWNhdGlvbiBiZXR3ZWVuIGEgYnJvd3NlciBjbGllbnQgYW5kXG4gKiBhIHJlbW90ZSBvcmlnaW4uXG4gKlxuICogV2ViQ2hhbm5lbHMgYXJlIGNyZWF0ZWQgdmlhIDxjb2RlPldlYkNoYW5uZWw8L2NvZGU+LiBNdWx0aXBsZSBXZWJDaGFubmVsc1xuICogbWF5IGJlIG11bHRpcGxleGVkIG92ZXIgdGhlIHNhbWUgV2ViQ2hhbm5lbFRyYW5zcG9ydCwgd2hpY2ggcmVwcmVzZW50c1xuICogdGhlIHVuZGVybHlpbmcgcGh5c2ljYWwgY29ubmVjdGl2aXR5IG92ZXIgc3RhbmRhcmQgd2lyZSBwcm90b2NvbHNcbiAqIHN1Y2ggYXMgSFRUUC5cbiAqXG4gKiBBIFdlYkNoYW5uZWwgaW4gdHVybiByZXByZXNlbnRzIGEgbG9naWNhbCBjb21tdW5pY2F0aW9uIGNoYW5uZWwgYmV0d2VlblxuICogdGhlIGNsaWVudCBhbmQgc2VydmVyIGVuZCBwb2ludC4gQSBXZWJDaGFubmVsIHJlbWFpbnMgb3BlbiBmb3IgYXMgbG9uZ1xuICogYXMgdGhlIGNsaWVudCBvciBzZXJ2ZXIgZW5kLXBvaW50IGFsbG93cy5cbiAqXG4gKiBNZXNzYWdlcyBhcmUgZGVsaXZlcmVkIGluLW9yZGVyIGFuZCByZWxpYWJseSBvdmVyIHRoZSBzYW1lIFdlYkNoYW5uZWwsXG4gKiBhbmQgdGhlIGNob2ljZSBvZiB0aGUgdW5kZXJseWluZyB3aXJlIHByb3RvY29scyBpcyBjb21wbGV0ZWx5IHRyYW5zcGFyZW50XG4gKiB0byB0aGUgQVBJIHVzZXJzLlxuICpcbiAqIE5vdGUgdGhhdCB3ZSBoYXZlIG5vIGltbWVkaWF0ZSBwbGFuIHRvIG1vdmUgdGhpcyBBUEkgb3V0IG9mIGxhYnMuIFdoaWxlXG4gKiB0aGUgaW1wbGVtZW50YXRpb24gaXMgcHJvZHVjdGlvbiByZWFkeSwgdGhlIEFQSSBpcyBzdWJqZWN0IHRvIGNoYW5nZS5cbiAqL1xuXG5nb29nLnByb3ZpZGUoJ2dvb2cubmV0LldlYkNoYW5uZWwnKTtcbmdvb2cucHJvdmlkZSgnZ29vZy5uZXQuV2ViQ2hhbm5lbC5PcHRpb25zJyk7XG5cbmdvb2cucmVxdWlyZSgnZ29vZy5ldmVudHMnKTtcbmdvb2cucmVxdWlyZSgnZ29vZy5ldmVudHMuRXZlbnQnKTtcbmdvb2cucmVxdWlyZSgnZ29vZy5ldmVudHMuTGlzdGVuYWJsZScpO1xuZ29vZy5yZXF1aXJlKCdnb29nLm5ldC5YbWxIdHRwRmFjdG9yeScpO1xuXG5cblxuLyoqXG4gKiBBIFdlYkNoYW5uZWwgcmVwcmVzZW50cyBhIGxvZ2ljYWwgYmktZGlyZWN0aW9uYWwgY2hhbm5lbCBvdmVyIHdoaWNoIHRoZVxuICogY2xpZW50IGNvbW11bmljYXRlcyB3aXRoIGEgcmVtb3RlIHNlcnZlciB0aGF0IGhvbGRzIHRoZSBvdGhlciBlbmRwb2ludFxuICogb2YgdGhlIGNoYW5uZWwuIEEgV2ViQ2hhbm5lbCBpcyBhbHdheXMgY3JlYXRlZCBpbiB0aGUgY29udGV4dCBvZiBhIHNoYXJlZFxuICoge0BsaW5rIFdlYkNoYW5uZWxUcmFuc3BvcnR9IGluc3RhbmNlLiBJdCBpcyB1cCB0byB0aGUgdW5kZXJseWluZyBjbGllbnQtc2lkZVxuICogYW5kIHNlcnZlci1zaWRlIGltcGxlbWVudGF0aW9ucyB0byBkZWNpZGUgaG93IG9yIHdoZW4gbXVsdGlwbGV4aW5nIGlzXG4gKiB0byBiZSBlbmFibGVkLlxuICpcbiAqIEBpbnRlcmZhY2VcbiAqIEBleHRlbmRzIHtnb29nLmV2ZW50cy5MaXN0ZW5hYmxlfVxuICovXG5nb29nLm5ldC5XZWJDaGFubmVsID0gZnVuY3Rpb24oKSB7fTtcblxuXG5cbi8qKlxuICogVGhpcyBpbnRlcmZhY2UgZGVmaW5lcyBhIHBsdWdnYWJsZSBBUEkgdG8gYWxsb3cgV2ViQ2hhbm5lbCBydW50aW1lIHRvIHN1cHBvcnRcbiAqIGN1c3RvbWl6ZWQgYWxnb3JpdGhtcyBpbiBvcmRlciB0byByZWNvdmVyIGZyb20gdHJhbnNpZW50IGZhaWx1cmVzIHN1Y2ggYXNcbiAqIHRob3NlIGZhaWx1cmVzIGNhdXNlZCBieSBuZXR3b3JrIG9yIHByb3hpZXMgKGludGVybWVkaWFyaWVzKS5cbiAqXG4gKiBUaGUgYWxnb3JpdGhtIG1heSBhbHNvIGNob29zZSB0byBmYWlsLWZhc3QsIGUuZy4gc3dpdGNoIHRoZSBjbGllbnQgdG8gc29tZVxuICogb2ZmbGluZSBtb2RlLlxuICpcbiAqIEV4dHJhIG1lYXN1cmVtZW50cyBhbmQgbG9nZ2luZyBjb3VsZCBhbHNvIGJlIGltcGxlbWVudGVkIGluIHRoZSBjdXN0b21cbiAqIG1vZHVsZSwgd2hpY2ggaGFzIHRoZSBmdWxsIGtub3dsZWRnZSBvZiBhbGwgdGhlIHN0YXRlIHRyYW5zaXRpb25zXG4gKiAoZHVlIHRvIGZhaWx1cmVzKS5cbiAqXG4gKiBBIGRlZmF1bHQgYWxnb3JpdGhtIHdpbGwgYmUgcHJvdmlkZWQgYnkgdGhlIHdlYmNoYW5uZWwgbGlicmFyeSBpdHNlbGYuIEN1c3RvbVxuICogYWxnb3JpdGhtcyBhcmUgZXhwZWN0ZWQgdG8gYmUgdGFpbG9yZWQgdG8gc3BlY2lmaWMgY2xpZW50IHBsYXRmb3JtcyBvclxuICogbmV0d29ya2luZyBlbnZpcm9ubWVudHMsIGUuZy4gbW9iaWxlLCBjZWxsdWxhciBuZXR3b3JrLlxuICpcbiAqIEBpbnRlcmZhY2VcbiAqL1xuZ29vZy5uZXQuV2ViQ2hhbm5lbC5GYWlsdXJlUmVjb3ZlcnkgPSBmdW5jdGlvbigpIHt9O1xuXG5cbi8qKlxuICogQ29uZmlndXJhdGlvbiBzcGVjIGZvciBuZXdseSBjcmVhdGVkIFdlYkNoYW5uZWwgaW5zdGFuY2VzLlxuICpcbiAqIFdlYkNoYW5uZWxzIGFyZSBjb25maWd1cmVkIGluIHRoZSBjb250ZXh0IG9mIHRoZSBjb250YWluaW5nXG4gKiB7QGxpbmsgV2ViQ2hhbm5lbFRyYW5zcG9ydH0uIFRoZSBjb25maWd1cmF0aW9uIHBhcmFtZXRlcnMgYXJlIHNwZWNpZmllZFxuICogd2hlbiBhIG5ldyBpbnN0YW5jZSBvZiBXZWJDaGFubmVsIGlzIGNyZWF0ZWQgdmlhIHtAbGluayBXZWJDaGFubmVsVHJhbnNwb3J0fS5cbiAqIEByZWNvcmRcbiAqL1xuZ29vZy5uZXQuV2ViQ2hhbm5lbC5PcHRpb25zID0gZnVuY3Rpb24oKSB7fTtcblxuLyoqXG4gKiBDdXN0b20gaGVhZGVycyB0byBiZSBhZGRlZCB0byBldmVyeSBtZXNzYWdlIHNlbnQgdG8gdGhlXG4gKiBzZXJ2ZXIuIFRoaXMgb2JqZWN0IGlzIG11dGFibGUsIGFuZCBjdXN0b20gaGVhZGVycyBtYXkgYmUgY2hhbmdlZCwgcmVtb3ZlZCxcbiAqIG9yIGFkZGVkIGR1cmluZyB0aGUgcnVudGltZSBhZnRlciBhIGNoYW5uZWwgaGFzIGJlZW5cbiAqIG9wZW5lZFxuICogQHR5cGUgeyFPYmplY3Q8c3RyaW5nLCBzdHJpbmc+fHVuZGVmaW5lZH1cbiAqL1xuZ29vZy5uZXQuV2ViQ2hhbm5lbC5PcHRpb25zLnByb3RvdHlwZS5tZXNzYWdlSGVhZGVycztcblxuLyoqXG4gKiBTaW1pbGFyIHRvIG1lc3NhZ2VIZWFkZXJzLCBidXQgYW55IGN1c3RvbSBoZWFkZXJzIHdpbGxcbiAqIGJlIHNlbnQgb25seSBvbmNlIHdoZW4gdGhlIGNoYW5uZWwgaXMgb3BlbmVkLiBUeXBpY2FsIHVzYWdlIGlzIHRvIHNlbmRcbiAqIGFuIGF1dGggaGVhZGVyIHRvIHRoZSBzZXJ2ZXIsIHdoaWNoIG9ubHkgY2hlY2tzIHRoZSBhdXRoIGhlYWRlciBhdCB0aGUgdGltZVxuICogd2hlbiB0aGUgY2hhbm5lbCBpcyBvcGVuZWQuXG4gKiBAdHlwZSB7IU9iamVjdDxzdHJpbmcsIHN0cmluZz58dW5kZWZpbmVkfVxuICovXG5nb29nLm5ldC5XZWJDaGFubmVsLk9wdGlvbnMucHJvdG90eXBlLmluaXRNZXNzYWdlSGVhZGVycztcblxuLyoqXG4gKiBTZW50IGFzIGluaXRNZXNzYWdlSGVhZGVycyB2aWEgWC1XZWJDaGFubmVsLUNvbnRlbnQtVHlwZSxcbiAqIHRvIGluZm9ybSB0aGUgc2VydmVyIHRoZSBNSU1FIHR5cGUgb2YgV2ViQ2hhbm5lbCBtZXNzYWdlcy5cbiAqIEB0eXBlIHtzdHJpbmd8dW5kZWZpbmVkfVxuICovXG5nb29nLm5ldC5XZWJDaGFubmVsLk9wdGlvbnMucHJvdG90eXBlLm1lc3NhZ2VDb250ZW50VHlwZTtcblxuLyoqXG4gKiBDdXN0b20gdXJsIHF1ZXJ5IHBhcmFtZXRlcnMgdG8gYmUgYWRkZWQgdG8gZXZlcnkgbWVzc2FnZVxuICogc2VudCB0byB0aGUgc2VydmVyLiBUaGlzIG9iamVjdCBpcyBtdXRhYmxlLCBhbmQgY3VzdG9tIHBhcmFtZXRlcnMgbWF5IGJlXG4gKiBjaGFuZ2VkLCByZW1vdmVkIG9yIGFkZGVkIGR1cmluZyB0aGUgcnVudGltZSBhZnRlciBhIGNoYW5uZWwgaGFzIGJlZW4gb3BlbmVkLlxuICogQHR5cGUgeyFPYmplY3Q8c3RyaW5nLCBzdHJpbmc+fHVuZGVmaW5lZH1cbiAqL1xuZ29vZy5uZXQuV2ViQ2hhbm5lbC5PcHRpb25zLnByb3RvdHlwZS5tZXNzYWdlVXJsUGFyYW1zO1xuXG4vKipcbiAqIFdoZXRoZXIgYSBzcGVjaWFsIGhlYWRlciBzaG91bGQgYmUgYWRkZWQgdG9cbiAqIGVhY2ggbWVzc2FnZSBzbyB0aGF0IHRoZSBzZXJ2ZXIgY2FuIGRpc3BhdGNoIHdlYmNoYW5uZWwgbWVzc2FnZXMgd2l0aG91dFxuICoga25vd2luZyB0aGUgVVJMIHBhdGggcHJlZml4LiBEZWZhdWx0cyB0byBmYWxzZS5cbiAqIEB0eXBlIHtib29sZWFufHVuZGVmaW5lZH1cbiAqL1xuZ29vZy5uZXQuV2ViQ2hhbm5lbC5PcHRpb25zLnByb3RvdHlwZS5jbGllbnRQcm90b2NvbEhlYWRlclJlcXVpcmVkO1xuXG4vKipcbiAqIFRoZSBtYXhpbXVtIG51bWJlciBvZiBpbi1mbGlnaHQgSFRUUCByZXF1ZXN0cyBhbGxvd2VkXG4gKiB3aGVuIFNQRFkgaXMgZW5hYmxlZC4gQ3VycmVudGx5IHdlIG9ubHkgZGV0ZWN0IFNQRFkgaW4gQ2hyb21lLlxuICogVGhpcyBwYXJhbWV0ZXIgZGVmYXVsdHMgdG8gMTAuIFdoZW4gU1BEWSBpcyBub3QgZW5hYmxlZCwgdGhpcyBwYXJhbWV0ZXJcbiAqIHdpbGwgaGF2ZSBubyBlZmZlY3QuXG4gKiBAdHlwZSB7bnVtYmVyfHVuZGVmaW5lZH1cbiAqL1xuZ29vZy5uZXQuV2ViQ2hhbm5lbC5PcHRpb25zLnByb3RvdHlwZS5jb25jdXJyZW50UmVxdWVzdExpbWl0O1xuXG4vKipcbiAqIFNldHRpbmcgdGhpcyB0byB0cnVlIHRvIGFsbG93IHRoZSB1c2Ugb2Ygc3ViLWRvbWFpbnNcbiAqIChhcyBjb25maWd1cmVkIGJ5IHRoZSBzZXJ2ZXIpIHRvIHNlbmQgWEhScyB3aXRoIHRoZSBDT1JTIHdpdGhDcmVkZW50aWFsc1xuICogYml0IHNldCB0byB0cnVlLlxuICogQHR5cGUge2Jvb2xlYW58dW5kZWZpbmVkfVxuICovXG5nb29nLm5ldC5XZWJDaGFubmVsLk9wdGlvbnMucHJvdG90eXBlLnN1cHBvcnRzQ3Jvc3NEb21haW5YaHI7XG5cbi8qKlxuICogV2hldGhlciB0byBieXBhc3MgdjggZW5jb2Rpbmcgb2YgY2xpZW50LXNlbnQgbWVzc2FnZXMuXG4gKiBUaGlzIGRlZmF1bHRzIHRvIGZhbHNlIG5vdyBkdWUgdG8gbGVnYWN5IHNlcnZlcnMuIE5ldyBhcHBsaWNhdGlvbnMgc2hvdWxkXG4gKiBhbHdheXMgY29uZmlndXJlIHRoaXMgb3B0aW9uIHRvIHRydWUuXG4gKiBAdHlwZSB7Ym9vbGVhbnx1bmRlZmluZWR9XG4gKi9cbmdvb2cubmV0LldlYkNoYW5uZWwuT3B0aW9ucy5wcm90b3R5cGUuc2VuZFJhd0pzb247XG5cbi8qKlxuICogVGhlIFVSTCBwYXJhbWV0ZXIgbmFtZSB0aGF0IGNvbnRhaW5zIHRoZSBzZXNzaW9uIGlkIChmb3Igc3RpY2t5IHJvdXRpbmcgb2ZcbiAqIEhUVFAgcmVxdWVzdHMpLiBXaGVuIHRoaXMgcGFyYW0gaXMgc3BlY2lmaWVkLCBhIHNlcnZlciB0aGF0IHN1cHBvcnRzIHRoaXNcbiAqIG9wdGlvbiB3aWxsIHJlc3BvbmQgd2l0aCBhbiBvcGFxdWUgc2Vzc2lvbiBpZCBhcyBwYXJ0IG9mIHRoZSBpbml0aWFsXG4gKiBoYW5kc2hha2UgKHZpYSB0aGUgWC1IVFRQLVNlc3Npb24tSWQgaGVhZGVyKTsgYW5kIGFsbCB0aGUgc3Vic2VxdWVudCByZXF1ZXN0c1xuICogd2lsbCBjb250YWluIHRoZSBodHRwU2Vzc2lvbklkUGFyYW0uIFRoaXMgb3B0aW9uIHdpbGwgdGFrZSBwcmVjZWRlbmNlIG92ZXJcbiAqIGFueSBkdXBsaWNhdGVkIHBhcmFtZXRlciBzcGVjaWZpZWQgd2l0aCBtZXNzYWdlVXJsUGFyYW1zLCB3aG9zZSB2YWx1ZSB3aWxsIGJlXG4gKiBpZ25vcmVkLlxuICogQHR5cGUge3N0cmluZ3x1bmRlZmluZWR9XG4gKi9cbmdvb2cubmV0LldlYkNoYW5uZWwuT3B0aW9ucy5wcm90b3R5cGUuaHR0cFNlc3Npb25JZFBhcmFtO1xuXG4vKipcbiAqIFRoZSBVUkwgcGFyYW1ldGVyIG5hbWUgdG8gYWxsb3cgY3VzdG9tIEhUVFBcbiAqIGhlYWRlcnMgdG8gYmUgb3ZlcndyaXR0ZW4gYXMgYSBVUkwgcGFyYW0gdG8gYnlwYXNzIENPUlMgcHJlZmxpZ2h0LlxuICogZ29vZy5uZXQucnBjLkh0dHBDb3JzIGlzIHVzZWQgdG8gZW5jb2RlIHRoZSBIVFRQIGhlYWRlcnMuXG4gKiBAdHlwZSB7c3RyaW5nfHVuZGVmaW5lZH1cbiAqL1xuZ29vZy5uZXQuV2ViQ2hhbm5lbC5PcHRpb25zLnByb3RvdHlwZS5odHRwSGVhZGVyc092ZXJ3cml0ZVBhcmFtO1xuXG4vKipcbiAqIEB0eXBlIHtib29sZWFufHVuZGVmaW5lZH1cbiAqL1xuZ29vZy5uZXQuV2ViQ2hhbm5lbC5PcHRpb25zLnByb3RvdHlwZS5iYWNrZ3JvdW5kQ2hhbm5lbFRlc3Q7XG5cbi8qKlxuICogV2hldGhlciB0byBmb3JjZSBsb25nLXBvbGxpbmcgZnJvbSBjbGllbnQgdG8gc2VydmVyLlxuICogVGhpcyBkZWZhdWx0cyB0byBmYWxzZS4gTG9uZy1wb2xsaW5nIG1heSBiZSBuZWNlc3Nhcnkgd2hlbiBhIChNSVRNKSBwcm94eVxuICogaXMgYnVmZmVyaW5nIGRhdGEgc2VudCBieSB0aGUgc2VydmVyLlxuICogQHR5cGUge2Jvb2xlYW58dW5kZWZpbmVkfVxuICovXG5nb29nLm5ldC5XZWJDaGFubmVsLk9wdGlvbnMucHJvdG90eXBlLmZvcmNlTG9uZ1BvbGxpbmc7XG5cbi8qKlxuICogV2hldGhlciB0byBlbmFibGUgYXV0b21hdGljIGRldGVjdGlvbiBvZiBidWZmZXJpbmcgcHJveGllcy4gSW4gdGhlIHByZXNlbmNlXG4gKiBvZiBhbnkgYnVmZmVyaW5nIHByb3h5LCB3ZWJjaGFubmVsIHdpbGwgdXNlIGxvbmctcG9sbGluZyB0byBzZW5kIG1lc3NhZ2VzXG4gKiBmcm9tIHRoZSBzZXJ2ZXIgdG8gdGhlIGNsaWVudC4gVGhpcyBvcHRpb24gZGVmYXVsdHMgdG8gZmFsc2UuXG4gKiBDdXJyZW50bHkgd2hlbiBmYXN0SGFuZHNoYWtlIGlzIGVuYWJsZWQsIHRoaXMgb3B0aW9uIHdpbGwgYmUgaWdub3JlZC5cbiAqIENvbXBhcmVkIHRvIFwiZm9yY2VMb25nUG9sbGluZ1wiLCB0aGlzIG9wdGlvbiBtYXkgaW50cm9kdWNlIHVwIHRvIDItUlRUXG4gKiBleHRyYSBsYXRlbmN5IGZvciBkZWxpdmVyaW5nIG1lc3NhZ2VzIGdlbmVyYXRlZCBpbW1lZGlhdGVseSBhZnRlciB0aGVcbiAqIGhhbmRzaGFrZS5cbiAqIEB0eXBlIHtib29sZWFufHVuZGVmaW5lZH1cbiAqL1xuZ29vZy5uZXQuV2ViQ2hhbm5lbC5PcHRpb25zLnByb3RvdHlwZS5kZXRlY3RCdWZmZXJpbmdQcm94eTtcblxuLyoqXG4gKiBFbmFibGUgdHJ1ZSAwLVJUVCBtZXNzYWdlIGRlbGl2ZXJ5LCBpbmNsdWRpbmdcbiAqIGxldmVyYWdpbmcgUVVJQyAwLVJUVCAod2hpY2ggcmVxdWlyZXMgR0VUIHRvIGJlIHVzZWQpLiBUaGlzIG9wdGlvblxuICogZGVmYXVsdHMgdG8gZmFsc2UuIE5vdGUgaXQgaXMgYWxsb3dlZCB0byBzZW5kIG1lc3NhZ2VzIGJlZm9yZSBPcGVuIGV2ZW50IGlzXG4gKiByZWNlaXZlZCwgYWZ0ZXIgYSBjaGFubmVsIGhhcyBiZWVuIG9wZW5lZC4gSW4gb3JkZXIgdG8gZW5hYmxlIDAtUlRULFxuICogbWVzc2FnZXMgd2lsbCBiZSBlbmNvZGVkIGFzIHBhcnQgb2YgVVJMIGFuZCB0aGVyZWZvcmUgdGhlcmUgbmVlZHMgYmUgYSBzaXplXG4gKiBsaW1pdCBmb3IgdGhvc2UgaW5pdGlhbCBtZXNzYWdlcyB0aGF0IGFyZSBzZW50IGltbWVkaWF0ZWx5IGFzIHBhcnQgb2YgdGhlXG4gKiBHRVQgaGFuZHNoYWtlIHJlcXVlc3QuIFdpdGggc2VuZFJhd0pzb249dHJ1ZSwgdGhpcyBsaW1pdCBpcyBjdXJyZW50bHkgc2V0XG4gKiB0byA0SyBjaGFycyBhbmQgZGF0YSBiZXlvbmQgdGhpcyBsaW1pdCB3aWxsIGJlIGJ1ZmZlcmVkIHRpbGwgdGhlIGhhbmRzaGFrZVxuICogKDEtUlRUKSBmaW5pc2hlcy4gV2l0aCBzZW5kUmF3SnNvbj1mYWxzZSwgaXQncyB1cCB0byB0aGUgYXBwbGljYXRpb25cbiAqIHRvIGxpbWl0IHRoZSBhbW91bnQgb2YgZGF0YSB0aGF0IGlzIHNlbnQgYXMgcGFydCBvZiB0aGUgaGFuZHNoYWtlLlxuICogQHR5cGUge2Jvb2xlYW58dW5kZWZpbmVkfVxuICovXG5nb29nLm5ldC5XZWJDaGFubmVsLk9wdGlvbnMucHJvdG90eXBlLmZhc3RIYW5kc2hha2U7XG5cbi8qKlxuICogRW5hYmxlIHRoZSBibG9ja2luZyBSUEMgc2VtYW50aWNzIGZvciB0aGUgaGFuZHNoYWtlOlxuICogMSkgdGhlIGNvbXBsZXRpb24gb2YgaGFuZHNoYWtlIGlzIGJsb2NrZWQgYnkgdGhlIHNlcnZlci1zaWRlIGFwcGxpY2F0aW9uXG4gKiBsb2dpYyBmb3IgaGFuZGxpbmcgdGhlIGhhbmRzaGFrZSAoSFRUUCkgcmVxdWVzdDsgMikgdGhlIGNsaWVudCBhcHBsaWNhdGlvblxuICogd2lsbCBpbnNwZWN0IHRoZSBoYW5kc2hha2UgKEhUVFApIHJlc3BvbnNlIGhlYWRlcnMgYXMgZ2VuZXJhdGVkXG4gKiBieSB0aGUgc2VydmVyIGFwcGxpY2F0aW9uICh2LnMuIGJ5IG9ubHkgdGhlIHdlYmNoYW5uZWwgcnVudGltZSkuIFRoaXMgb3B0aW9uXG4gKiBkZWZhdWx0cyB0byBmYWxzZS5cbiAqIEB0eXBlIHtib29sZWFufHVuZGVmaW5lZH1cbiAqL1xuZ29vZy5uZXQuV2ViQ2hhbm5lbC5PcHRpb25zLnByb3RvdHlwZS5ibG9ja2luZ0hhbmRzaGFrZTtcblxuLyoqXG4gKiBXaGV0aGVyIHRvIGRpc2FibGUgbG9nZ2luZyByZWRhY3QuIEJ5IGRlZmF1bHQsIHJlZGFjdCBpc1xuICogZW5hYmxlZCB0byByZW1vdmUgYW55IG1lc3NhZ2UgcGF5bG9hZCBvciB1c2VyLXByb3ZpZGVkIGluZm9cbiAqIGZyb20gY2xvc3VyZSBsb2dzLlxuICogQHR5cGUge2Jvb2xlYW58dW5kZWZpbmVkfVxuICovXG5nb29nLm5ldC5XZWJDaGFubmVsLk9wdGlvbnMucHJvdG90eXBlLmRpc2FibGVSZWRhY3Q7XG5cbi8qKlxuICogSW5mb3JtIHRoZSBzZXJ2ZXIgYWJvdXQgdGhlIGNsaWVudCBwcm9maWxlIHRvIGVuYWJsZVxuICogY3VzdG9taXplZCBjb25maWdzIHRoYXQgYXJlIG9wdGltaXplZCBmb3IgY2VydGFpbiBjbGllbnRzIG9yIGVudmlyb25tZW50cy5cbiAqIEN1cnJlbnRseSB0aGlzIGluZm9ybWF0aW9uIGlzIHNlbnQgdmlhIFgtV2ViQ2hhbm5lbC1DbGllbnQtUHJvZmlsZSBoZWFkZXIuXG4gKiBAdHlwZSB7c3RyaW5nfHVuZGVmaW5lZH1cbiAqL1xuZ29vZy5uZXQuV2ViQ2hhbm5lbC5PcHRpb25zLnByb3RvdHlwZS5jbGllbnRQcm9maWxlO1xuXG4vKipcbiAqIFRoZSBpbnRlcm5hbCBjaGFubmVsIHBhcmFtZXRlciBuYW1lIHRvIGFsbG93XG4gKiBleHBlcmltZW50YWwgY2hhbm5lbCBjb25maWd1cmF0aW9ucy4gU3VwcG9ydGVkIG9wdGlvbnMgaW5jbHVkZSBmYXN0ZmFpbCxcbiAqIGJhc2VSZXRyeURlbGF5TXMsIHJldHJ5RGVsYXlTZWVkTXMsIGZvcndhcmRDaGFubmVsTWF4UmV0cmllcyBhbmRcbiAqIGZvcndhcmRDaGFubmVsUmVxdWVzdFRpbWVvdXRNcy4gTm90ZSB0aGF0IHRoZXNlIG9wdGlvbnMgYXJlIHN1YmplY3QgdG9cbiAqIGNoYW5nZS5cbiAqIEB0eXBlIHshT2JqZWN0PHN0cmluZywgYm9vbGVhbnxudW1iZXI+fHVuZGVmaW5lZH1cbiAqL1xuZ29vZy5uZXQuV2ViQ2hhbm5lbC5PcHRpb25zLnByb3RvdHlwZS5pbnRlcm5hbENoYW5uZWxQYXJhbXM7XG5cbi8qKlxuICogQWxsb3dzIHRoZSBjYWxsZXIgdG8gb3ZlcnJpZGUgdGhlIGZhY3RvcnkgdXNlZCB0byBjcmVhdGVcbiAqIFhNTEh0dHBSZXF1ZXN0IG9iamVjdHMuIFRoaXMgaXMgaW50cm9kdWNlZCB0byBkaXNhYmxlIENPUlMgb24gZmlyZWZveCBPUy5cbiAqIEB0eXBlIHshZ29vZy5uZXQuWG1sSHR0cEZhY3Rvcnl8dW5kZWZpbmVkfVxuICovXG5nb29nLm5ldC5XZWJDaGFubmVsLk9wdGlvbnMucHJvdG90eXBlLnhtbEh0dHBGYWN0b3J5O1xuXG4vKipcbiAqIENsaWVudC1zaWRlIHRocmVzaG9sZHMgdGhhdCBkZWNpZGUgd2hlbiB0byByZWZyZXNoXG4gKiBhbiB1bmRlcmx5aW5nIEhUVFAgcmVxdWVzdCwgdG8gbGltaXQgbWVtb3J5IGNvbnN1bXB0aW9uIGR1ZSB0byBYSFIgYnVmZmVyaW5nXG4gKiBvciBjb21wcmVzc2lvbiBjb250ZXh0LiBUaGUgY2xpZW50LXNpZGUgdGhyZXNob2xkcyBzaG91bGQgYmUgc2lnbmlmaWNhbnRseVxuICogc21hbGxlciB0aGFuIHRoZSBzZXJ2ZXItc2lkZSB0aHJlc2hvbGRzLiBUaGlzIGFsbG93cyB0aGUgY2xpZW50IHRvIGVsaW1pbmF0ZVxuICogYW55IGxhdGVuY3kgaW50cm9kdWNlZCBieSByZXF1ZXN0IHJlZnJlc2hpbmcsIGkuZS4gYW4gUlRUIHdpbmRvdyBkdXJpbmcgd2hpY2hcbiAqIG1lc3NhZ2VzIG1heSBiZSBidWZmZXJlZCBvbiB0aGUgc2VydmVyLXNpZGUuIFN1cHBvcnRlZCBwYXJhbXMgaW5jbHVkZVxuICogdG90YWxCeXRlc1JlY2VpdmVkLCB0b3RhbER1cmF0aW9uTXMuXG4gKiBAdHlwZSB7IU9iamVjdDxzdHJpbmcsIG51bWJlcj58dW5kZWZpbmVkfVxuICovXG5nb29nLm5ldC5XZWJDaGFubmVsLk9wdGlvbnMucHJvdG90eXBlLnJlcXVlc3RSZWZyZXNoVGhyZXNob2xkcztcblxuLyoqXG4gKiBUaGlzIGlzIGFuIGV4cGVyaW1lbnRhbCBmZWF0dXJlIHRvIHVzZSBXSEFUV0cgRmV0Y2gvc3RyZWFtcyAod2hlbiBzdXBwb3J0ZWQpXG4gKiBmb3IgdGhlIGJhY2tjaGFubmVsLiBJZiBhIGN1c3RvbSAneG1sSHR0cEZhY3RvcnknIGlzIHNwZWZpY2llZCwgdGhpcyBvcHRpb25cbiAqIHdpbGwgbm90IGJlIGVmZmVjdGl2ZS4gVGhpcyBvcHRpb24gZGVmYXVsdHMgdG8gZmFsc2Ugbm93IGFuZCB3aWxsIGV2ZW50dWFsbHlcbiAqIGJlIHR1cm5lZCBvbiBieSBkZWZhdWx0LlxuICogQHR5cGUge2Jvb2xlYW58dW5kZWZpbmVkfVxuICovXG5nb29nLm5ldC5XZWJDaGFubmVsLk9wdGlvbnMucHJvdG90eXBlLnVzZUZldGNoU3RyZWFtcztcblxuLyoqXG4gKiBPcHQtaW4gdG8gZW5hYmxlIENocm9tZSBvcmlnaW4gdHJpYWxzIGZyb20gdGhlIFdlYkNoYW5uZWwgY2xpZW50LiBTZWVcbiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9Hb29nbGVDaHJvbWUvT3JpZ2luVHJpYWxzXG4gKlxuICogT3JpZ2luIHRyaWFsIGhpc3Rvcnk6XG4gKiAtIGZldGNoIHVwbG9hZCAoMTEvMjAyMCAtIDA3LzIwMjEpXG4gKiBodHRwczovL2RldmVsb3BlcnMuY2hyb21lLmNvbS9vcmlnaW50cmlhbHMvIy92aWV3X3RyaWFsLzM1MjQwNjY3MDg0MTc0MTMxMjFcbiAqXG4gKiBQYXJ0aWNpcGF0aW5nIGluIHRoZSBvcmlnaW4gdHJpYWxzIHdpbGwgaGVscCBDaHJvbWUgdG8gcmVsZWFzZSBuZXcgV2ViXG4gKiBwbGF0Zm9ybSBmZWF0dXJlcyBzb29uZXIsIHdoaWNoIHdpbGwgaW4gdHVybiBoZWxwIGltcHJvdmUgV2ViQ2hhbm5lbFxuICogcGVyZm9ybWFuY2UuXG4gKlxuICogT3JpZ2luIHRyaWFscyBhcmUgbm90IGV4cGVjdGVkIHRvIGludGVyZmVyZSB3aXRoIFdlYkNoYW5uZWwgd2lyZSBtZXNzYWdlc1xuICogYW5kIHNob3VsZCBub3QgaW50cm9kdWNlIGFueSBub3RpY2VhYmxlIG92ZXJoZWFkLlxuICpcbiAqIFRoaXMgaXMgZW5hYmxlZCBieSBkZWZhdWx0IHdpdGggYW55IG9uLWdvaW5nIG9yaWdpbi10cmlhbC5cbiAqXG4gKiBAdHlwZSB7Ym9vbGVhbnx1bmRlZmluZWR9XG4gKi9cbmdvb2cubmV0LldlYkNoYW5uZWwuT3B0aW9ucy5wcm90b3R5cGUuZW5hYmxlT3JpZ2luVHJpYWxzO1xuXG5cbi8qKlxuICogVHlwZXMgdGhhdCBhcmUgYWxsb3dlZCBhcyBtZXNzYWdlIGRhdGEuXG4gKlxuICogTm90ZSB0aGF0IEpTIG9iamVjdHMgKHNlbnQgYnkgdGhlIGNsaWVudCkgY2FuIG9ubHkgaGF2ZSBzdHJpbmcgZW5jb2RlZFxuICogdmFsdWVzIGR1ZSB0byB0aGUgbGltaXRhdGlvbiBvZiB0aGUgY3VycmVudCB3aXJlIHByb3RvY29sLlxuICpcbiAqIFVuaWNvZGUgc3RyaW5ncyAoc2VudCBieSB0aGUgc2VydmVyKSBtYXkgb3IgbWF5IG5vdCBuZWVkIGJlIGVzY2FwZWQsIGFzXG4gKiBkZWNpZGVkIGJ5IHRoZSBzZXJ2ZXIuXG4gKlxuICogQHR5cGVkZWYgeyghQXJyYXlCdWZmZXJ8IUJsb2J8IU9iamVjdDxzdHJpbmcsICFPYmplY3R8c3RyaW5nPnwhQXJyYXl8c3RyaW5nKX1cbiAqL1xuZ29vZy5uZXQuV2ViQ2hhbm5lbC5NZXNzYWdlRGF0YTtcblxuXG4vKipcbiAqIE9wZW4gdGhlIFdlYkNoYW5uZWwgYWdhaW5zdCB0aGUgVVJJIHNwZWNpZmllZCBpbiB0aGUgY29uc3RydWN0b3IuXG4gKi9cbmdvb2cubmV0LldlYkNoYW5uZWwucHJvdG90eXBlLm9wZW4gPSBnb29nLmFic3RyYWN0TWV0aG9kO1xuXG5cbi8qKlxuICogQ2xvc2UgdGhlIFdlYkNoYW5uZWwuXG4gKlxuICogVGhpcyBpcyBhIGZ1bGwgY2xvc2UgKHNodXRkb3duKSB3aXRoIG5vIGd1YXJhbnRlZSBvZiBGSUZPIGRlbGl2ZXJ5IGluIHJlc3BlY3RcbiAqIHRvIGFueSBpbi1mbGlnaHQgbWVzc2FnZXMgc2VudCB0byB0aGUgc2VydmVyLlxuICpcbiAqIElmIHlvdSBuZWVkIHN1Y2ggYSBndWFyYW50ZWUsIHNlZSB0aGUgSGFsZiB0aGUgaGFsZkNsb3NlKCkgbWV0aG9kLlxuICovXG5nb29nLm5ldC5XZWJDaGFubmVsLnByb3RvdHlwZS5jbG9zZSA9IGdvb2cuYWJzdHJhY3RNZXRob2Q7XG5cblxuLyoqXG4gKiBIYWxmLWNsb3NlIHRoZSBXZWJDaGFubmVsLlxuICpcbiAqIEhhbGYtY2xvc2Ugc2VtYW50aWNzOlxuICogMS4gZGVsaXZlcmVkIGFzIGEgcmVndWxhciBtZXNzYWdlIGluIEZJRk8gcHJvZ3JhbW1pbmcgb3JkZXJcbiAqIDIuIHRoZSBzZXJ2ZXIgaXMgZXhwZWN0ZWQgdG8gcmV0dXJuIGEgaGFsZi1jbG9zZSB0b28gKHdpdGggb3Igd2l0aG91dFxuICogICAgYXBwbGljYXRpb24gaW52b2x2ZWQpLCB3aGljaCB3aWxsIHRyaWdnZXIgYSBmdWxsIGNsb3NlIChzaHV0ZG93bilcbiAqICAgIG9uIHRoZSBjbGllbnQgc2lkZVxuICogMy4gZm9yIG5vdywgdGhlIGhhbGYtY2xvc2UgZXZlbnQgZGVmaW5lZCBmb3Igc2VydmVyLWluaXRpYXRlZFxuICogICAgaGFsZi1jbG9zZSBpcyBub3QgZXhwb3NlZCB0byB0aGUgY2xpZW50IGFwcGxpY2F0aW9uXG4gKiA0LiBhIGNsaWVudC1zaWRlIGhhbGYtY2xvc2UgbWF5IGJlIHRyaWdnZXJlZCBpbnRlcm5hbGx5IHdoZW4gdGhlIGNsaWVudFxuICogICAgcmVjZWl2ZXMgYSBoYWxmLWNsb3NlIGZyb20gdGhlIHNlcnZlcjsgYW5kIHRoZSBjbGllbnQgaXMgZXhwZWN0ZWQgdG9cbiAqICAgIGRvIGEgZnVsbCBjbG9zZSBhZnRlciB0aGUgaGFsZi1jbG9zZSBpcyBhY2tlZCBhbmQgZGVsaXZlcmVkXG4gKiAgICBvbiB0aGUgc2VydmVyLXNpZGUuXG4gKiA1LiBGdWxsIGNsb3NlIGlzIGFsd2F5cyBhIGZvcmNlZCBvbmUuIFNlZSB0aGUgY2xvc2UoKSBtZXRob2QuXG4gKlxuICogTmV3IG1lc3NhZ2VzIHNlbnQgYWZ0ZXIgaGFsZkNsb3NlKCkgd2lsbCBiZSBkcm9wcGVkLlxuICpcbiAqIE5PVEU6IFRoaXMgaXMgbm90IHlldCBpbXBsZW1lbnRlZCwgYW5kIHdpbGwgdGhyb3cgYW4gZXhjZXB0aW9uIGlmIGNhbGxlZC5cbiAqL1xuZ29vZy5uZXQuV2ViQ2hhbm5lbC5wcm90b3R5cGUuaGFsZkNsb3NlID0gZ29vZy5hYnN0cmFjdE1ldGhvZDtcblxuXG4vKipcbiAqIFNlbmRzIGEgbWVzc2FnZSB0byB0aGUgc2VydmVyIHRoYXQgbWFpbnRhaW5zIHRoZSBvdGhlciBlbmQgcG9pbnQgb2ZcbiAqIHRoZSBXZWJDaGFubmVsLlxuICpcbiAqIE8tUlRUIGJlaGF2aW9yOlxuICogMS4gbWVzc2FnZXMgc2VudCBiZWZvcmUgb3BlbigpIGlzIGNhbGxlZCB3aWxsIGFsd2F5cyBiZSBkZWxpdmVyZWQgYXNcbiAqICAgIHBhcnQgb2YgdGhlIGhhbmRzaGFrZSwgaS5lLiB3aXRoIDAtUlRUXG4gKiAyLiBtZXNzYWdlcyBzZW50IGFmdGVyIG9wZW4oKSBpcyBjYWxsZWQgYnV0IGJlZm9yZSB0aGUgT1BFTiBldmVudFxuICogICAgaXMgcmVjZWl2ZWQgd2lsbCBiZSBkZWxpdmVyZWQgYXMgcGFydCBvZiB0aGUgaGFuZHNoYWtlIGlmXG4gKiAgICBzZW5kKCkgaXMgY2FsbGVkIGZyb20gdGhlIHNhbWUgZXhlY3V0aW9uIGNvbnRleHQgYXMgb3BlbigpLlxuICogMy4gb3RoZXJ3aXNlLCB0aG9zZSBtZXNzYWdlcyB3aWxsIGJlIGJ1ZmZlcmVkIHRpbGwgdGhlIGhhbmRzaGFrZVxuICogICAgaXMgY29tcGxldGVkICh3aGljaCB3aWxsIGZpcmUgdGhlIE9QRU4gZXZlbnQpLlxuICpcbiAqIEBwYXJhbSB7IWdvb2cubmV0LldlYkNoYW5uZWwuTWVzc2FnZURhdGF9IG1lc3NhZ2UgVGhlIG1lc3NhZ2UgdG8gc2VuZC5cbiAqL1xuZ29vZy5uZXQuV2ViQ2hhbm5lbC5wcm90b3R5cGUuc2VuZCA9IGdvb2cuYWJzdHJhY3RNZXRob2Q7XG5cblxuLyoqXG4gKiBDb21tb24gZXZlbnRzIGZpcmVkIGJ5IFdlYkNoYW5uZWxzLlxuICogQGVudW0ge3N0cmluZ31cbiAqL1xuZ29vZy5uZXQuV2ViQ2hhbm5lbC5FdmVudFR5cGUgPSB7XG4gIC8qKiBEaXNwYXRjaGVkIHdoZW4gdGhlIGNoYW5uZWwgaXMgb3BlbmVkLiAqL1xuICBPUEVOOiBnb29nLmV2ZW50cy5nZXRVbmlxdWVJZCgnb3BlbicpLFxuXG4gIC8qKiBEaXNwYXRjaGVkIHdoZW4gdGhlIGNoYW5uZWwgaXMgY2xvc2VkLiAqL1xuICBDTE9TRTogZ29vZy5ldmVudHMuZ2V0VW5pcXVlSWQoJ2Nsb3NlJyksXG5cbiAgLyoqXG4gICAqIERpc3BhdGNoZWQgd2hlbiB0aGUgY2hhbm5lbCBpcyBhYm9ydGVkIGR1ZSB0byBlcnJvcnMuXG4gICAqXG4gICAqIEZvciBiYWNrd2FyZCBjb21wYXRpYmlsaXR5IHJlYXNvbnMsIGEgQ0xPU0UgZXZlbnQgd2lsbCBhbHNvIGJlXG4gICAqIGRpc3BhdGNoZWQsIGZvbGxvd2luZyB0aGUgRVJST1IgZXZlbnQsIHdoaWNoIGluZGljYXRlcyB0aGF0IHRoZSBjaGFubmVsXG4gICAqIGhhcyBiZWVuIGNvbXBsZXRlbHkgc2h1dGRvd24gLlxuICAgKi9cbiAgRVJST1I6IGdvb2cuZXZlbnRzLmdldFVuaXF1ZUlkKCdlcnJvcicpLFxuXG4gIC8qKiBEaXNwYXRjaGVkIHdoZW4gdGhlIGNoYW5uZWwgaGFzIHJlY2VpdmVkIGEgbmV3IG1lc3NhZ2UuICovXG4gIE1FU1NBR0U6IGdvb2cuZXZlbnRzLmdldFVuaXF1ZUlkKCdtZXNzYWdlJylcbn07XG5cblxuXG4vKipcbiAqIFRoZSBldmVudCBpbnRlcmZhY2UgZm9yIHRoZSBNRVNTQUdFIGV2ZW50LlxuICpcbiAqIEBjb25zdHJ1Y3RvclxuICogQGV4dGVuZHMge2dvb2cuZXZlbnRzLkV2ZW50fVxuICovXG5nb29nLm5ldC5XZWJDaGFubmVsLk1lc3NhZ2VFdmVudCA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIGdvb2cubmV0LldlYkNoYW5uZWwuTWVzc2FnZUV2ZW50LmJhc2UoXG4gICAgICB0aGlzLCAnY29uc3RydWN0b3InLCBnb29nLm5ldC5XZWJDaGFubmVsLkV2ZW50VHlwZS5NRVNTQUdFKTtcbn07XG5nb29nLmluaGVyaXRzKGdvb2cubmV0LldlYkNoYW5uZWwuTWVzc2FnZUV2ZW50LCBnb29nLmV2ZW50cy5FdmVudCk7XG5cblxuLyoqXG4gKiBUaGUgY29udGVudCBvZiB0aGUgbWVzc2FnZSByZWNlaXZlZCBmcm9tIHRoZSBzZXJ2ZXIuXG4gKlxuICogQHR5cGUgeyFnb29nLm5ldC5XZWJDaGFubmVsLk1lc3NhZ2VEYXRhfVxuICovXG5nb29nLm5ldC5XZWJDaGFubmVsLk1lc3NhZ2VFdmVudC5wcm90b3R5cGUuZGF0YTtcblxuXG4vKipcbiAqIFRoZSBtZXRhZGF0YSBrZXkgd2hlbiB0aGUgTUVTU0FHRSBldmVudCByZXByZXNlbnRzIGEgbWV0YWRhdGEgbWVzc2FnZS5cbiAqXG4gKiBAdHlwZSB7c3RyaW5nfHVuZGVmaW5lZH1cbiAqL1xuZ29vZy5uZXQuV2ViQ2hhbm5lbC5NZXNzYWdlRXZlbnQucHJvdG90eXBlLm1ldGFkYXRhS2V5O1xuXG5cbi8qKlxuICogV2ViQ2hhbm5lbCBsZXZlbCBlcnJvciBjb25kaXRpb25zLlxuICpcbiAqIFN1bW1hcnkgb2YgZXJyb3IgZGVidWdnaW5nIGFuZCByZXBvcnRpbmcgaW4gV2ViQ2hhbm5lbDpcbiAqXG4gKiBOZXR3b3JrIEVycm9yXG4gKiAxLiBCeSBkZWZhdWx0IHRoZSB3ZWJjaGFubmVsIGxpYnJhcnkgd2lsbCBzZXQgdGhlIGVycm9yIHN0YXR1cyB0b1xuICogICAgTkVUV09SS19FUlJPUiB3aGVuIGEgY2hhbm5lbCBoYXMgdG8gYmUgYWJvcnRlZCBvciBjbG9zZWQuIE5FVFdPUktfRVJST1JcbiAqICAgIG1heSBiZSByZWNvdmVyZWQgYnkgdGhlIGFwcGxpY2F0aW9uIGJ5IHJldHJ5aW5nIGFuZCBvcGVuaW5nIGEgbmV3IGNoYW5uZWwuXG4gKiAyLiBUaGVyZSBtYXkgYmUgbG9zdCBtZXNzYWdlcyAobm90IGFja2VkIGJ5IHRoZSBzZXJ2ZXIpIHdoZW4gYSBjaGFubmVsIGlzXG4gKiAgICBhYm9ydGVkLiBDdXJyZW50bHkgd2UgZG9uJ3QgaGF2ZSBhIHB1YmxpYyBBUEkgdG8gcmV0cmlldmUgbWVzc2FnZXMgdGhhdFxuICogICAgYXJlIHdhaXRpbmcgdG8gYmUgYWNrZWQgb24gdGhlIGNsaWVudCBzaWRlLiBGaWxlIGEgYnVnIGlmIHlvdSB0aGluayBpdFxuICogICAgaXMgdXNlZnVsIHRvIGV4cG9zZSBzdWNoIGFuIEFQSS5cbiAqIDMuIERldGFpbHMgb2Ygd2h5IGEgY2hhbm5lbCBmYWlscyBhcmUgYXZhaWxhYmxlIHZpYSBjbG9zdXJlIGRlYnVnIGxvZ3MsXG4gKiAgICBhbmQgc3RhdHMgZXZlbnRzIChzZWUgd2ViY2hhbm5lbC9yZXF1ZXN0c3RhdHMuanMpLiBUaG9zZSBhcmUgaW50ZXJuYWxcbiAqICAgIHN0YXRzIGFuZCBhcmUgc3ViamVjdCB0byBjaGFuZ2UuIEZpbGUgYSBidWcgaWYgeW91IHRoaW5rIGl0J3MgdXNlZnVsIHRvXG4gKiAgICB2ZXJzaW9uIGFuZCBleHBvc2Ugc3VjaCBzdGF0cyBhcyBwYXJ0IG9mIHRoZSBXZWJDaGFubmVsIEFQSS5cbiAqXG4gKiBTZXJ2ZXIgRXJyb3JcbiAqIDEuIFNFUlZFUl9FUlJPUiBpcyBpbnRlbmRlZCB0byBpbmRpY2F0ZSBhIG5vbi1yZWNvdmVyYWJsZSBjb25kaXRpb24sIGUuZy5cbiAqICAgIHdoZW4gYXV0aCBmYWlscy5cbiAqIDIuIFdlIGRvbid0IGN1cnJlbnRseSBnZW5lcmF0ZSBhbnkgc3VjaCBlcnJvcnMsIGJlY2F1c2UgbW9zdCBvZiB0aGUgdGltZVxuICogICAgaXQncyB0aGUgcmVzcG9uc2liaWxpdHkgb2YgdXBwZXItbGF5ZXIgZnJhbWV3b3JrcyBvciB0aGUgYXBwbGljYXRpb25cbiAqICAgIGl0c2VsZiB0byBpbmRpY2F0ZSB0byB0aGUgY2xpZW50IHdoeSBhIHdlYmNoYW5uZWwgaGFzIGJlZW4gZmFpbGVkXG4gKiAgICBieSB0aGUgc2VydmVyLlxuICogMy4gV2hlbiBhIGNoYW5uZWwgaXMgZmFpbGVkIGJ5IHRoZSBzZXJ2ZXIgZXhwbGljaXRseSwgd2Ugc3RpbGwgc2lnbmFsXG4gKiAgICBORVRXT1JLX0VSUk9SIHRvIHRoZSBjbGllbnQuIEV4cGxpY2l0IHNlcnZlciBmYWlsdXJlIG1heSBoYXBwZW4gd2hlbiB0aGVcbiAqICAgIHNlcnZlciBkb2VzIGEgZmFpbC1vdmVyLCBvciBiZWNvbWVzIG92ZXJsb2FkZWQsIG9yIGNvbmR1Y3RzIGEgZm9yY2VkXG4gKiAgICBzaHV0ZG93biBldGMuXG4gKiA0LiBXZSB1c2Ugc29tZSBoZXVyaXN0aWMgdG8gZGVjaWRlIGlmIHRoZSBuZXR3b3JrIChha2EgY2xvdWQpIGlzIGRvd25cbiAqICAgIHYucy4gdGhlIGFjdHVhbCBzZXJ2ZXIgaXMgZG93bi5cbiAqXG4gKiAgUnVudGltZVByb3BlcnRpZXMuZ2V0TGFzdFN0YXR1c0NvZGUgaXMgYSB1c2VmdWwgc3RhdGUgdGhhdCB3ZSBleHBvc2UgdG9cbiAqICB0aGUgY2xpZW50IHRvIGluZGljYXRlIHRoZSBIVFRQIHJlc3BvbnNlIHN0YXR1cyBjb2RlIG9mIHRoZSBsYXN0IEhUVFBcbiAqICByZXF1ZXN0IGluaXRpYXRlZCBieSB0aGUgV2ViQ2hhbm5lbCBjbGllbnQgbGlicmFyeSwgZm9yIGRlYnVnZ2luZ1xuICogIHB1cnBvc2VzIG9ubHkuXG4gKlxuICogIFNlZSBXZWJDaGFubmVsLk9wdGlvbnMuYmFja0NoYW5uZWxGYWlsdXJlUmVjb3ZlcnkgYW5kXG4gKiAgV2ViQ2hhbm5lbC5GYWlsdXJlUmVjb3ZlcnkgdG8gaW5zdGFsbCBhIGN1c3RvbSBmYWlsdXJlLXJlY292ZXJ5IGFsZ29yaXRobS5cbiAqXG4gKiBAZW51bSB7bnVtYmVyfVxuICovXG5nb29nLm5ldC5XZWJDaGFubmVsLkVycm9yU3RhdHVzID0ge1xuICAvKiogTm8gZXJyb3IgaGFzIG9jY3VycmVkLiAqL1xuICBPSzogMCxcblxuICAvKiogQ29tbXVuaWNhdGlvbiB0byB0aGUgc2VydmVyIGhhcyBmYWlsZWQuICovXG4gIE5FVFdPUktfRVJST1I6IDEsXG5cbiAgLyoqIFRoZSBzZXJ2ZXIgZmFpbHMgdG8gYWNjZXB0IG9yIHByb2Nlc3MgdGhlIFdlYkNoYW5uZWwuICovXG4gIFNFUlZFUl9FUlJPUjogMlxufTtcblxuXG5cbi8qKlxuICogVGhlIGV2ZW50IGludGVyZmFjZSBmb3IgdGhlIEVSUk9SIGV2ZW50LlxuICpcbiAqIEBjb25zdHJ1Y3RvclxuICogQGV4dGVuZHMge2dvb2cuZXZlbnRzLkV2ZW50fVxuICovXG5nb29nLm5ldC5XZWJDaGFubmVsLkVycm9yRXZlbnQgPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBnb29nLm5ldC5XZWJDaGFubmVsLkVycm9yRXZlbnQuYmFzZShcbiAgICAgIHRoaXMsICdjb25zdHJ1Y3RvcicsIGdvb2cubmV0LldlYkNoYW5uZWwuRXZlbnRUeXBlLkVSUk9SKTtcbn07XG5nb29nLmluaGVyaXRzKGdvb2cubmV0LldlYkNoYW5uZWwuRXJyb3JFdmVudCwgZ29vZy5ldmVudHMuRXZlbnQpO1xuXG5cbi8qKlxuICogVGhlIGVycm9yIHN0YXR1cy5cbiAqXG4gKiBAdHlwZSB7IWdvb2cubmV0LldlYkNoYW5uZWwuRXJyb3JTdGF0dXN9XG4gKi9cbmdvb2cubmV0LldlYkNoYW5uZWwuRXJyb3JFdmVudC5wcm90b3R5cGUuc3RhdHVzO1xuXG5cbi8qKlxuICogQHJldHVybiB7IWdvb2cubmV0LldlYkNoYW5uZWwuUnVudGltZVByb3BlcnRpZXN9IFRoZSBydW50aW1lIHByb3BlcnRpZXNcbiAqIG9mIHRoZSBXZWJDaGFubmVsIGluc3RhbmNlLlxuICovXG5nb29nLm5ldC5XZWJDaGFubmVsLnByb3RvdHlwZS5nZXRSdW50aW1lUHJvcGVydGllcyA9IGdvb2cuYWJzdHJhY3RNZXRob2Q7XG5cblxuXG4vKipcbiAqIFRoZSBydW50aW1lIHByb3BlcnRpZXMgb2YgdGhlIFdlYkNoYW5uZWwgaW5zdGFuY2UuXG4gKlxuICogVGhpcyBjbGFzcyBpcyBkZWZpbmVkIGZvciBkZWJ1Z2dpbmcgYW5kIG1vbml0b3JpbmcgcHVycG9zZXMsIGFzIHdlbGwgYXMgZm9yXG4gKiBydW50aW1lIGZ1bmN0aW9ucyB0aGF0IHRoZSBhcHBsaWNhdGlvbiBtYXkgY2hvb3NlIHRvIG1hbmFnZSBieSBpdHNlbGYuXG4gKlxuICogQGludGVyZmFjZVxuICovXG5nb29nLm5ldC5XZWJDaGFubmVsLlJ1bnRpbWVQcm9wZXJ0aWVzID0gZnVuY3Rpb24oKSB7fTtcblxuXG4vKipcbiAqIEByZXR1cm4ge251bWJlcn0gVGhlIGVmZmVjdGl2ZSBsaW1pdCBmb3IgdGhlIG51bWJlciBvZiBjb25jdXJyZW50IEhUVFBcbiAqIHJlcXVlc3RzIHRoYXQgYXJlIGFsbG93ZWQgdG8gYmUgbWFkZSBmb3Igc2VuZGluZyBtZXNzYWdlcyBmcm9tIHRoZSBjbGllbnRcbiAqIHRvIHRoZSBzZXJ2ZXIuIFdoZW4gU1BEWSBpcyBub3QgZW5hYmxlZCwgdGhpcyBsaW1pdCB3aWxsIGJlIG9uZS5cbiAqL1xuZ29vZy5uZXQuV2ViQ2hhbm5lbC5SdW50aW1lUHJvcGVydGllcy5wcm90b3R5cGUuZ2V0Q29uY3VycmVudFJlcXVlc3RMaW1pdCA9XG4gICAgZ29vZy5hYnN0cmFjdE1ldGhvZDtcblxuXG4vKipcbiAqIEZvciBhcHBsaWNhdGlvbnMgdGhhdCBuZWVkIHN1cHBvcnQgbXVsdGlwbGUgY2hhbm5lbHMgKGUuZy4gZnJvbVxuICogZGlmZmVyZW50IHRhYnMpIHRvIHRoZSBzYW1lIG9yaWdpbiwgdXNlIHRoaXMgbWV0aG9kIHRvIGRlY2lkZSBpZiBTUERZIGlzXG4gKiBlbmFibGVkIGFuZCB0aGVyZWZvcmUgaXQgaXMgc2FmZSB0byBvcGVuIG11bHRpcGxlIGNoYW5uZWxzLlxuICpcbiAqIElmIFNQRFkgaXMgZGlzYWJsZWQsIHRoZSBhcHBsaWNhdGlvbiBtYXkgY2hvb3NlIHRvIGxpbWl0IHRoZSBudW1iZXIgb2YgYWN0aXZlXG4gKiBjaGFubmVscyB0byBvbmUgb3IgdXNlIG90aGVyIG1lYW5zIHN1Y2ggYXMgc3ViLWRvbWFpbnMgdG8gd29yayBhcm91bmRcbiAqIHRoZSBicm93c2VyIGNvbm5lY3Rpb24gbGltaXQuXG4gKlxuICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciBTUERZIGlzIGVuYWJsZWQgZm9yIHRoZSBvcmlnaW4gYWdhaW5zdCB3aGljaFxuICogdGhlIGNoYW5uZWwgaXMgY3JlYXRlZC5cbiAqL1xuZ29vZy5uZXQuV2ViQ2hhbm5lbC5SdW50aW1lUHJvcGVydGllcy5wcm90b3R5cGUuaXNTcGR5RW5hYmxlZCA9XG4gICAgZ29vZy5hYnN0cmFjdE1ldGhvZDtcblxuXG4vKipcbiAqIEByZXR1cm4ge251bWJlcn0gVGhlIG51bWJlciBvZiByZXF1ZXN0cyAoZm9yIHNlbmRpbmcgbWVzc2FnZXMgdG8gdGhlIHNlcnZlcilcbiAqIHRoYXQgYXJlIHBlbmRpbmcuIElmIHRoaXMgbnVtYmVyIGlzIGFwcHJvYWNoaW5nIHRoZSB2YWx1ZSBvZlxuICogZ2V0Q29uY3VycmVudFJlcXVlc3RMaW1pdCgpLCBjbGllbnQtdG8tc2VydmVyIG1lc3NhZ2UgZGVsaXZlcnkgbWF5IGV4cGVyaWVuY2VcbiAqIGEgaGlnaGVyIGxhdGVuY3kuXG4gKi9cbmdvb2cubmV0LldlYkNoYW5uZWwuUnVudGltZVByb3BlcnRpZXMucHJvdG90eXBlLmdldFBlbmRpbmdSZXF1ZXN0Q291bnQgPVxuICAgIGdvb2cuYWJzdHJhY3RNZXRob2Q7XG5cblxuLyoqXG4gKiBGb3IgYXBwbGljYXRpb25zIHRvIHF1ZXJ5IHRoZSBjdXJyZW50IEhUVFAgc2Vzc2lvbiBpZCwgc2VudCBieSB0aGUgc2VydmVyXG4gKiBkdXJpbmcgdGhlIGluaXRpYWwgaGFuZHNoYWtlLlxuICpcbiAqIEByZXR1cm4gez9zdHJpbmd9IHRoZSBIVFRQIHNlc3Npb24gaWQgb3IgbnVsbCBpZiBubyBIVFRQIHNlc3Npb24gaXMgaW4gdXNlLlxuICovXG5nb29nLm5ldC5XZWJDaGFubmVsLlJ1bnRpbWVQcm9wZXJ0aWVzLnByb3RvdHlwZS5nZXRIdHRwU2Vzc2lvbklkID1cbiAgICBnb29nLmFic3RyYWN0TWV0aG9kO1xuXG5cbi8qKlxuICogRXhwZXJpbWVudGFsIEFQSS5cbiAqXG4gKiBUaGlzIG1ldGhvZCBnZW5lcmF0ZXMgYW4gaW4tYmFuZCBjb21taXQgcmVxdWVzdCB0byB0aGUgc2VydmVyLCB3aGljaCB3aWxsXG4gKiBhY2sgdGhlIGNvbW1pdCByZXF1ZXN0IGFzIHNvb24gYXMgYWxsIG1lc3NhZ2VzIHNlbnQgcHJpb3IgdG8gdGhpcyBjb21taXRcbiAqIHJlcXVlc3QgaGF2ZSBiZWVuIGNvbW1pdHRlZCBieSB0aGUgYXBwbGljYXRpb24uXG4gKlxuICogQ29tbWl0dGluZyBhIG1lc3NhZ2UgaGFzIGEgc3Ryb25nZXIgc2VtYW50aWNzIHRoYW4gZGVsaXZlcmluZyBhIG1lc3NhZ2VcbiAqIHRvIHRoZSBhcHBsaWNhdGlvbi4gRGV0YWlsIHNwZWM6XG4gKiBodHRwczovL2dpdGh1Yi5jb20vYmlkaXdlYi93ZWJjaGFubmVsL2Jsb2IvbWFzdGVyL2NvbW1pdC5tZFxuICpcbiAqIFRpbWVvdXQgb3IgY2FuY2VsbGF0aW9uIGlzIG5vdCBzdXBwb3J0ZWQgYW5kIHRoZSBhcHBsaWNhdGlvbiBpcyBleHBlY3RlZCB0b1xuICogYWJvcnQgdGhlIGNoYW5uZWwgaWYgdGhlIGNvbW1pdC1hY2sgZmFpbHMgdG8gYXJyaXZlIGluIHRpbWUuXG4gKlxuICogPT09XG4gKlxuICogVGhpcyBpcyBjdXJyZW50bHkgaW1wbGVtZW50ZWQgb25seSBpbiB0aGUgY2xpZW50IGxheWVyIGFuZCB0aGUgY29tbWl0XG4gKiBjYWxsYmFjayB3aWxsIGJlIGludm9rZWQgYWZ0ZXIgYWxsIHRoZSBwZW5kaW5nIGNsaWVudC1zZW50IG1lc3NhZ2VzIGhhdmUgYmVlblxuICogZGVsaXZlcmVkIGJ5IHRoZSBzZXJ2ZXItc2lkZSB3ZWJjaGFubmVsIGVuZC1wb2ludC4gVGhpcyBzZW1hbnRpY3MgaXNcbiAqIGRpZmZlcmVudCBhbmQgd2Vha2VyIHRoYW4gd2hhdCdzIHJlcXVpcmVkIGZvciBlbmQtdG8tZW5kIGFjayB3aGljaCByZXF1aXJlc1xuICogdGhlIHNlcnZlciBhcHBsaWNhdGlvbiB0byBhY2sgdGhlIGluLW9yZGVyIGRlbGl2ZXJ5IG9mIG1lc3NhZ2VzIHRoYXQgYXJlIHNlbnRcbiAqIGJlZm9yZSB0aGUgY29tbWl0IHJlcXVlc3QgaXMgaXNzdWVkLlxuICpcbiAqIENvbW1pdCBzaG91bGQgb25seSBiZSBjYWxsZWQgYWZ0ZXIgdGhlIGNoYW5uZWwgb3BlbiBldmVudCBpcyByZWNlaXZlZC5cbiAqIER1cGxpY2F0ZWQgY29tbWl0cyBhcmUgYWxsb3dlZCBhbmQgb25seSB0aGUgbGFzdCBjYWxsYmFjayBpcyBndWFyYW50ZWVkLlxuICogQ29tbWl0IGNhbGxlZCBhZnRlciB0aGUgY2hhbm5lbCBoYXMgYmVlbiBjbG9zZWQgd2lsbCBiZSBpZ25vcmVkLlxuICpcbiAqIEBwYXJhbSB7ZnVuY3Rpb24oKX0gY2FsbGJhY2sgVGhlIGNhbGxiYWNrIHdpbGwgYmUgaW52b2tlZCBvbmNlIGFuXG4gKiBhY2sgaGFzIGJlZW4gcmVjZWl2ZWQgZm9yIHRoZSBjdXJyZW50IGNvbW1pdCBvciBhbnkgbmV3bHkgaXNzdWVkIGNvbW1pdC5cbiAqL1xuZ29vZy5uZXQuV2ViQ2hhbm5lbC5SdW50aW1lUHJvcGVydGllcy5wcm90b3R5cGUuY29tbWl0ID0gZ29vZy5hYnN0cmFjdE1ldGhvZDtcblxuXG4vKipcbiAqIFRoaXMgbWV0aG9kIG1heSBiZSB1c2VkIGJ5IHRoZSBhcHBsaWNhdGlvbiB0byByZWNvdmVyIGZyb20gYSBwZWVyIGZhaWx1cmVcbiAqIG9yIHRvIGVuYWJsZSBzZW5kZXItaW5pdGlhdGVkIGZsb3ctY29udHJvbC5cbiAqXG4gKiBEZXRhaWwgc3BlYzogaHR0cHM6Ly9naXRodWIuY29tL2JpZGl3ZWIvd2ViY2hhbm5lbC9ibG9iL21hc3Rlci9jb21taXQubWRcbiAqXG4gKiBUaGlzIGlzIG5vdCB5ZXQgaW1wbGVtZW50ZWQuXG4gKlxuICogQHJldHVybiB7bnVtYmVyfSBUaGUgdG90YWwgbnVtYmVyIG9mIG1lc3NhZ2VzIHRoYXQgaGF2ZSBub3QgcmVjZWl2ZWRcbiAqIGNvbW1pdC1hY2sgZnJvbSB0aGUgc2VydmVyOyBvciBpZiBubyBjb21taXQgaGFzIGJlZW4gaXNzdWVkLCB0aGUgbnVtYmVyXG4gKiBvZiBtZXNzYWdlcyB0aGF0IGhhdmUgbm90IGJlZW4gZGVsaXZlcmVkIHRvIHRoZSBzZXJ2ZXIgYXBwbGljYXRpb24uXG4gKi9cbmdvb2cubmV0LldlYkNoYW5uZWwuUnVudGltZVByb3BlcnRpZXMucHJvdG90eXBlLmdldE5vbkFja2VkTWVzc2FnZUNvdW50ID1cbiAgICBnb29nLmFic3RyYWN0TWV0aG9kO1xuXG5cbi8qKlxuICogQSBsb3cgd2F0ZXItbWFyayBtZXNzYWdlIGNvdW50IHRvIG5vdGlmeSB0aGUgYXBwbGljYXRpb24gd2hlbiB0aGVcbiAqIGZsb3ctY29udHJvbCBjb25kaXRpb24gaXMgY2xlYXJlZCwgdGhhdCBpcywgd2hlbiB0aGUgYXBwbGljYXRpb24gaXNcbiAqIGFibGUgdG8gc2VuZCBtb3JlIG1lc3NhZ2VzLlxuICpcbiAqIFdlIGV4cGVjdCB0aGUgYXBwbGljYXRpb24gdG8gY29uZmlndXJlIGEgaGlnaCB3YXRlci1tYXJrIG1lc3NhZ2UgY291bnQsXG4gKiB3aGljaCBpcyBjaGVja2VkIHZpYSBnZXROb25BY2tlZE1lc3NhZ2VDb3VudCgpLiBXaGVuIHRoZSBoaWdoIHdhdGVyLW1hcmtcbiAqIGlzIGV4Y2VlZGVkLCB0aGUgYXBwbGljYXRpb24gc2hvdWxkIGluc3RhbGwgYSBjYWxsYmFjayB2aWEgdGhpcyBtZXRob2RcbiAqIHRvIGJlIG5vdGlmaWVkIHdoZW4gdG8gc3RhcnQgdG8gc2VuZCBuZXcgbWVzc2FnZXMuXG4gKlxuICogVGhpcyBpcyBub3QgeWV0IGltcGxlbWVudGVkLlxuICpcbiAqIEBwYXJhbSB7bnVtYmVyfSBjb3VudCBUaGUgbG93IHdhdGVyLW1hcmsgY291bnQuIEl0IGlzIGFuIGVycm9yIHRvIHBhc3NcbiAqIGEgbm9uLXBvc2l0aXZlIHZhbHVlLlxuICogQHBhcmFtIHtmdW5jdGlvbigpfSBjYWxsYmFjayBUaGUgY2FsbCBiYWNrIHRvIG5vdGlmeSB0aGUgYXBwbGljYXRpb25cbiAqIHdoZW4gTm9uQWNrZWRNZXNzYWdlQ291bnQgaXMgYmVsb3cgdGhlIHNwZWNpZmllZCBsb3cgd2F0ZXItbWFyayBjb3VudC5cbiAqIEFueSBwcmV2aW91c2x5IHJlZ2lzdGVyZWQgY2FsbGJhY2sgaXMgY2xlYXJlZC4gVGhpcyBuZXcgY2FsbGJhY2sgd2lsbFxuICogYmUgY2xlYXJlZCBvbmNlIGl0IGhhcyBiZWVuIGZpcmVkLCBvciB3aGVuIHRoZSBjaGFubmVsIGlzIGNsb3NlZCBvciBhYm9ydGVkLlxuICovXG5nb29nLm5ldC5XZWJDaGFubmVsLlJ1bnRpbWVQcm9wZXJ0aWVzLnByb3RvdHlwZS5ub3RpZnlOb25BY2tlZE1lc3NhZ2VDb3VudCA9XG4gICAgZ29vZy5hYnN0cmFjdE1ldGhvZDtcblxuXG4vKipcbiAqIEV4cGVyaW1lbnRhbCBBUEkuXG4gKlxuICogVGhpcyBtZXRob2QgcmVnaXN0ZXJzIGEgY2FsbGJhY2sgdG8gaGFuZGxlIHRoZSBjb21taXQgcmVxdWVzdCBzZW50XG4gKiBieSB0aGUgc2VydmVyLiBDb21taXQgcHJvdG9jb2wgc3BlYzpcbiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9iaWRpd2ViL3dlYmNoYW5uZWwvYmxvYi9tYXN0ZXIvY29tbWl0Lm1kXG4gKlxuICogVGhpcyBpcyBub3QgeWV0IGltcGxlbWVudGVkLlxuICpcbiAqIEBwYXJhbSB7ZnVuY3Rpb24oIU9iamVjdCl9IGNhbGxiYWNrIFRoZSBjYWxsYmFjayB3aWxsIHRha2UgYW4gb3BhcXVlXG4gKiBjb21taXRJZCB3aGljaCBuZWVkcyBiZSBwYXNzZWQgYmFjayB0byB0aGUgc2VydmVyIHdoZW4gYW4gYWNrLWNvbW1pdFxuICogcmVzcG9uc2UgaXMgZ2VuZXJhdGVkIGJ5IHRoZSBjbGllbnQgYXBwbGljYXRpb24sIHZpYSBhY2tDb21taXQoKS5cbiAqL1xuZ29vZy5uZXQuV2ViQ2hhbm5lbC5SdW50aW1lUHJvcGVydGllcy5wcm90b3R5cGUub25Db21taXQgPSBnb29nLmFic3RyYWN0TWV0aG9kO1xuXG5cbi8qKlxuICogRXhwZXJpbWVudGFsIEFQSS5cbiAqXG4gKiBUaGlzIG1ldGhvZCBpcyB1c2VkIGJ5IHRoZSBhcHBsaWNhdGlvbiB0byBnZW5lcmF0ZSBhbiBhY2stY29tbWl0IHJlc3BvbnNlXG4gKiBmb3IgdGhlIGdpdmVuIGNvbW1pdElkLiBDb21taXQgcHJvdG9jb2wgc3BlYzpcbiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9iaWRpd2ViL3dlYmNoYW5uZWwvYmxvYi9tYXN0ZXIvY29tbWl0Lm1kXG4gKlxuICogVGhpcyBpcyBub3QgeWV0IGltcGxlbWVudGVkLlxuICpcbiAqIEBwYXJhbSB7IU9iamVjdH0gY29tbWl0SWQgVGhlIGNvbW1pdElkIHdoaWNoIGRlbm90ZXMgdGhlIGNvbW1pdCByZXF1ZXN0XG4gKiBmcm9tIHRoZSBzZXJ2ZXIgdGhhdCBuZWVkcyBiZSBhY2snZWQuXG4gKi9cbmdvb2cubmV0LldlYkNoYW5uZWwuUnVudGltZVByb3BlcnRpZXMucHJvdG90eXBlLmFja0NvbW1pdCA9IGdvb2cuYWJzdHJhY3RNZXRob2Q7XG5cblxuLyoqXG4gKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBsYXN0IEhUVFAgc3RhdHVzIGNvZGUgcmVjZWl2ZWQgYnkgdGhlIGNoYW5uZWwuXG4gKi9cbmdvb2cubmV0LldlYkNoYW5uZWwuUnVudGltZVByb3BlcnRpZXMucHJvdG90eXBlLmdldExhc3RTdGF0dXNDb2RlID1cbiAgICBnb29nLmFic3RyYWN0TWV0aG9kO1xuXG5cbi8qKlxuICogRW51bSB0byBpbmRpY2F0ZSB0aGUgY3VycmVudCByZWNvdmVyeSBzdGF0ZS5cbiAqXG4gKiBAZW51bSB7c3RyaW5nfVxuICovXG5nb29nLm5ldC5XZWJDaGFubmVsLkZhaWx1cmVSZWNvdmVyeS5TdGF0ZSA9IHtcbiAgLyoqIEluaXRpYWwgc3RhdGUuICovXG4gIElOSVQ6ICdpbml0JyxcblxuICAvKiogT25jZSBhIGZhaWx1cmUgaGFzIGJlZW4gZGV0ZWN0ZWQuICovXG4gIEZBSUxFRDogJ2ZhaWxlZCcsXG5cbiAgLyoqXG4gICAqIE9uY2UgYSByZWNvdmVyeSBvcGVyYXRpb24gaGFzIGJlZW4gaXNzdWVkLCBlLmcuIGEgbmV3IHJlcXVlc3QgdG8gcmVzdW1lXG4gICAqIGNvbW11bmljYXRpb24uXG4gICAqL1xuICBSRUNPVkVSSU5HOiAncmVjb3ZlcmluZycsXG5cbiAgLyoqIFRoZSBjaGFubmVsIGhhcyBiZWVuIGNsb3NlZC4gICovXG4gIENMT1NFRDogJ2Nsb3NlZCdcbn07XG5cblxuLyoqXG4gKiBFbnVtIHRvIGluZGljYXRlIGRpZmZlcmVudCBmYWlsdXJlIGNvbmRpdGlvbnMgYXMgZGV0ZWN0ZWQgYnkgdGhlIHdlYmNoYW5uZWxcbiAqIHJ1bnRpbWUuXG4gKlxuICogVGhpcyBlbnVtIGlzIHRvIGJlIHVzZWQgb25seSBiZXR3ZWVuIHRoZSBydW50aW1lIGFuZCBGYWlsdXJlUmVjb3ZlcnkgbW9kdWxlLFxuICogYW5kIG5ldyBzdGF0ZXMgYXJlIGV4cGVjdGVkIHRvIGJlIGludHJvZHVjZWQgaW4gZnV0dXJlLlxuICpcbiAqIEBlbnVtIHtzdHJpbmd9XG4gKi9cbmdvb2cubmV0LldlYkNoYW5uZWwuRmFpbHVyZVJlY292ZXJ5LkZhaWx1cmVDb25kaXRpb24gPSB7XG4gIC8qKlxuICAgKiBUaGUgSFRUUCByZXNwb25zZSByZXR1cm5lZCBhIG5vbi1zdWNjZXNzZnVsIGh0dHAgc3RhdHVzIGNvZGUuXG4gICAqL1xuICBIVFRQX0VSUk9SOiAnaHR0cF9lcnJvcicsXG5cbiAgLyoqXG4gICAqIFRoZSByZXF1ZXN0IHdhcyBhYm9ydGVkLlxuICAgKi9cbiAgQUJPUlQ6ICdhYm9ydCcsXG5cbiAgLyoqXG4gICAqIFRoZSByZXF1ZXN0IHRpbWVkIG91dC5cbiAgICovXG4gIFRJTUVPVVQ6ICd0aW1lb3V0JyxcblxuICAvKipcbiAgICogRXhjZXB0aW9uIHdhcyB0aHJvd24gd2hpbGUgcHJvY2Vzc2luZyB0aGUgcmVxdWVzdC9yZXNwb25zZS5cbiAgICovXG4gIEVYQ0VQVElPTjogJ2V4Y2VwdGlvbidcbn07XG5cblxuLyoqXG4gKiBAcmV0dXJuIHshZ29vZy5uZXQuV2ViQ2hhbm5lbC5GYWlsdXJlUmVjb3ZlcnkuU3RhdGV9IHRoZSBjdXJyZW50IHN0YXRlLFxuICogbWFpbmx5IGZvciBkZWJ1Z2dpbmcgdXNlLlxuICovXG5nb29nLm5ldC5XZWJDaGFubmVsLkZhaWx1cmVSZWNvdmVyeS5wcm90b3R5cGUuZ2V0U3RhdGUgPSBnb29nLmFic3RyYWN0TWV0aG9kO1xuXG5cbi8qKlxuICogVGhpcyBtZXRob2QgaXMgZm9yIFdlYkNoYW5uZWwgcnVudGltZSB0byBzZXQgdGhlIGN1cnJlbnQgZmFpbHVyZSBjb25kaXRpb25cbiAqIGFuZCB0byBwcm92aWRlIGEgY2FsbGJhY2sgZm9yIHRoZSBhbGdvcml0aG0gdG8gc2lnbmFsIHRvIHRoZSBydW50aW1lXG4gKiB3aGVuIGl0IGlzIHRpbWUgdG8gaXNzdWUgYSByZWNvdmVyeSBvcGVyYXRpb24sIGUuZy4gYSBuZXcgcmVxdWVzdCB0byB0aGVcbiAqIHNlcnZlci5cbiAqXG4gKiBTdXBwb3J0ZWQgdHJhbnNpdGlvbnMgaW5jbHVkZTpcbiAqICAgSU5JVC0+RkFJTEVEXG4gKiAgIEZBSUxFRC0+RkFJTEVEIChyZS1lbnRyeSBvaylcbiAqICAgUkVDT1ZFUlktPkZBSUxFRC5cbiAqXG4gKiBJZ25vcmVkIGlmIHN0YXRlID09IENMT1NFRC5cbiAqXG4gKiBBZHZhbmNlZCBpbXBsZW1lbnRhdGlvbnMgYXJlIGV4cGVjdGVkIHRvIHRyYWNrIGFsbCB0aGUgc3RhdGUgdHJhbnNpdGlvbnNcbiAqIGFuZCB0aGVpciB0aW1lc3RhbXBzIGZvciBtb25pdG9yaW5nIHB1cnBvc2VzLlxuICpcbiAqIEBwYXJhbSB7IWdvb2cubmV0LldlYkNoYW5uZWwuRmFpbHVyZVJlY292ZXJ5LkZhaWx1cmVDb25kaXRpb259IGZhaWx1cmUgVGhlXG4gKiBuZXcgZmFpbHVyZSBjb25kaXRpb24gZ2VuZXJhdGVkIGJ5IHRoZSBXZWJDaGFubmVsIHJ1bnRpbWUuXG4gKiBAcGFyYW0geyFGdW5jdGlvbn0gb3BlcmF0aW9uIFRoZSBjYWxsYmFjayBmdW5jdGlvbiB0byB0aGUgV2ViQ2hhbm5lbFxuICogcnVudGltZSB0byBpc3N1ZSBhIHJlY292ZXJ5IG9wZXJhdGlvbiwgZS5nLiBhIG5ldyByZXF1ZXN0LiBFLmcuIHRoZSBkZWZhdWx0XG4gKiByZWNvdmVyeSBhbGdvcml0aG0gd2lsbCBpc3N1ZSB0aW1lb3V0LWJhc2VkIHJlY292ZXJ5IG9wZXJhdGlvbnMuXG4gKiBQb3N0LWNvbmRpdGlvbiBmb3IgdGhlIGNhbGxiYWNrOiBzdGF0ZSB0cmFuc2l0aW9uIHRvIFJFQ09WRVJJTkcuXG4gKlxuICogQHJldHVybiB7IWdvb2cubmV0LldlYkNoYW5uZWwuRmFpbHVyZVJlY292ZXJ5LlN0YXRlfSBUaGUgdXBkYXRlZCBzdGF0ZVxuICogYXMgZGVjaWRlZCBieSB0aGUgZmFpbHVyZSByZWNvdmVyeSBtb2R1bGUuIFVwb24gYSByZWNvdmVyYWJsZSBmYWlsdXJlIGV2ZW50LFxuICogdGhlIHN0YXRlIGlzIHRyYW5zaXRpb25lZCB0byBSRUNPVkVSSU5HOyBvciB0aGUgc3RhdGUgaXMgdHJhbnNpdGlvbmVkIHRvXG4gKiBGQUlMRUQgd2hpY2ggaW5kaWNhdGVzIGEgZmFpbC1mYXN0IGRlY2lzaW9uIGZvciB0aGUgcnVudGltZSB0byBleGVjdXRlLlxuICovXG5nb29nLm5ldC5XZWJDaGFubmVsLkZhaWx1cmVSZWNvdmVyeS5wcm90b3R5cGUuc2V0RmFpbHVyZSA9IGdvb2cuYWJzdHJhY3RNZXRob2Q7XG5cblxuLyoqXG4gKiBUaGUgV2ViY2hhbm5lbCBydW50aW1lIG5lZWRzIGNhbGwgdGhpcyBtZXRob2Qgd2hlbiB3ZWJjaGFubmVsIGlzIGNsb3NlZCBvclxuICogYWJvcnRlZC5cbiAqXG4gKiBPbmNlIHRoZSBpbnN0YW5jZSBpcyBjbG9zZWQsIGFueSBhY2Nlc3MgdG8gdGhlIGluc3RhbmNlIHdpbGwgYmUgYSBuby1vcC5cbiAqL1xuZ29vZy5uZXQuV2ViQ2hhbm5lbC5GYWlsdXJlUmVjb3ZlcnkucHJvdG90eXBlLmNsb3NlID0gZ29vZy5hYnN0cmFjdE1ldGhvZDtcblxuXG4vKipcbiAqIEEgcmVxdWVzdCBoZWFkZXIgdG8gaW5kaWNhdGUgdG8gdGhlIHNlcnZlciB0aGUgbWVzc2FnaW5nIHByb3RvY29sXG4gKiBlYWNoIEhUVFAgbWVzc2FnZSBpcyBzcGVha2luZy5cbiAqXG4gKiBAdHlwZSB7c3RyaW5nfVxuICovXG5nb29nLm5ldC5XZWJDaGFubmVsLlhfQ0xJRU5UX1BST1RPQ09MID0gJ1gtQ2xpZW50LVByb3RvY29sJztcblxuXG4vKipcbiAqIFRoZSB2YWx1ZSBmb3IgeC1jbGllbnQtcHJvdG9jb2wgd2hlbiB0aGUgbWVzc2FnaW5nIHByb3RvY29sIGlzIFdlYkNoYW5uZWwuXG4gKlxuICogQHR5cGUge3N0cmluZ31cbiAqL1xuZ29vZy5uZXQuV2ViQ2hhbm5lbC5YX0NMSUVOVF9QUk9UT0NPTF9XRUJfQ0hBTk5FTCA9ICd3ZWJjaGFubmVsJztcblxuXG4vKipcbiAqIEEgcmVzcG9uc2UgaGVhZGVyIGZvciB0aGUgc2VydmVyIHRvIHNpZ25hbCB0aGUgd2lyZS1wcm90b2NvbCB0aGF0XG4gKiB0aGUgYnJvd3NlciBlc3RhYmxpc2hlcyB3aXRoIHRoZSBzZXJ2ZXIgKG9yIHByb3h5KSwgZS5nLiBcInNwZHlcIiAoYWthIGh0dHAvMilcbiAqIFwicXVpY1wiLiBUaGlzIGluZm9ybWF0aW9uIGF2b2lkcyB0aGUgbmVlZCB0byB1c2UgcHJpdmF0ZSBBUElzIHRvIGRlY2lkZSBpZlxuICogSFRUUCByZXF1ZXN0cyBhcmUgbXVsdGlwbGV4ZWQgZXRjLlxuICpcbiAqIEB0eXBlIHtzdHJpbmd9XG4gKi9cbmdvb2cubmV0LldlYkNoYW5uZWwuWF9DTElFTlRfV0lSRV9QUk9UT0NPTCA9ICdYLUNsaWVudC1XaXJlLVByb3RvY29sJztcblxuXG4vKipcbiAqIEEgcmVzcG9uc2UgaGVhZGVyIGZvciB0aGUgc2VydmVyIHRvIHNlbmQgYmFjayB0aGUgSFRUUCBzZXNzaW9uIGlkIGFzIHBhcnQgb2ZcbiAqIHRoZSBpbml0aWFsIGhhbmRzaGFrZS4gVGhlIHZhbHVlIG9mIHRoZSBIVFRQIHNlc3Npb24gaWQgaXMgb3BhcXVlIHRvIHRoZVxuICogV2ViQ2hhbm5lbCBwcm90b2NvbC5cbiAqXG4gKiBAdHlwZSB7c3RyaW5nfVxuICovXG5nb29nLm5ldC5XZWJDaGFubmVsLlhfSFRUUF9TRVNTSU9OX0lEID0gJ1gtSFRUUC1TZXNzaW9uLUlkJztcblxuXG4vKipcbiAqIEEgcmVzcG9uc2UgaGVhZGVyIGZvciB0aGUgc2VydmVyIHRvIHNlbmQgYmFjayBhbnkgaW5pdGlhbCByZXNwb25zZSBkYXRhIGFzIGFcbiAqIGhlYWRlciB0byBhdm9pZCBhbnkgcG9zc2libGUgYnVmZmVyaW5nIGJ5IGFuIGludGVybWVkaWFyeSwgd2hpY2ggbWF5XG4gKiBiZSB1bmRlc2lyZWQgZHVyaW5nIHRoZSBoYW5kc2hha2UuXG4gKlxuICogQHR5cGUge3N0cmluZ31cbiAqL1xuZ29vZy5uZXQuV2ViQ2hhbm5lbC5YX0hUVFBfSU5JVElBTF9SRVNQT05TRSA9ICdYLUhUVFAtSW5pdGlhbC1SZXNwb25zZSc7XG5cblxuLyoqXG4gKiBBIHJlcXVlc3QgaGVhZGVyIGZvciBzcGVjaWZ5aW5nIHRoZSBjb250ZW50LXR5cGUgb2YgV2ViQ2hhbm5lbCBtZXNzYWdlcyxcbiAqIGUuZy4gYXBwbGljYXRpb24tZGVmaW5lZCBKU09OIGVuY29kaW5nIHN0eWxlcy4gQ3VycmVudGx5IHRoaXMgaGVhZGVyXG4gKiBpcyBzZW50IGJ5IHRoZSBjbGllbnQgdmlhIGluaXRNZXNzYWdlSGVhZGVycyB3aGVuIHRoZSBjaGFubmVsIGlzIG9wZW5lZC5cbiAqXG4gKiBAdHlwZSB7c3RyaW5nfVxuICovXG5nb29nLm5ldC5XZWJDaGFubmVsLlhfV0VCQ0hBTk5FTF9DT05URU5UX1RZUEUgPSAnWC1XZWJDaGFubmVsLUNvbnRlbnQtVHlwZSc7XG5cblxuLyoqXG4gKiBBIHJlcXVlc3QgaGVhZGVyIGZvciBzcGVjaWZ5aW5nIHRoZSBjbGllbnQgcHJvZmlsZSBpbiBvcmRlciB0byBhcHBseVxuICogY3VzdG9taXplZCBjb25maWcgcGFyYW1zIG9uIHRoZSBzZXJ2ZXIgc2lkZSwgZS5nLiB0aW1lb3V0cy5cbiAqXG4gKiBAdHlwZSB7c3RyaW5nfVxuICovXG5nb29nLm5ldC5XZWJDaGFubmVsLlhfV0VCQ0hBTk5FTF9DTElFTlRfUFJPRklMRSA9ICdYLVdlYkNoYW5uZWwtQ2xpZW50LVByb2ZpbGUnO1xuIiwgIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCBUaGUgQ2xvc3VyZSBMaWJyYXJ5IEF1dGhvcnMuXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogQGZpbGVvdmVydmlldyBMb3cgbGV2ZWwgaGFuZGxpbmcgb2YgWE1MSHR0cFJlcXVlc3QuXG4gKi9cblxuZ29vZy5wcm92aWRlKCdnb29nLm5ldC5EZWZhdWx0WG1sSHR0cEZhY3RvcnknKTtcbmdvb2cucHJvdmlkZSgnZ29vZy5uZXQuWG1sSHR0cCcpO1xuZ29vZy5wcm92aWRlKCdnb29nLm5ldC5YbWxIdHRwLk9wdGlvblR5cGUnKTtcbmdvb2cucHJvdmlkZSgnZ29vZy5uZXQuWG1sSHR0cC5SZWFkeVN0YXRlJyk7XG5nb29nLnByb3ZpZGUoJ2dvb2cubmV0LlhtbEh0dHBEZWZpbmVzJyk7XG5cbmdvb2cucmVxdWlyZSgnZ29vZy5hc3NlcnRzJyk7XG5nb29nLnJlcXVpcmUoJ2dvb2cubmV0LldyYXBwZXJYbWxIdHRwRmFjdG9yeScpO1xuZ29vZy5yZXF1aXJlKCdnb29nLm5ldC5YbWxIdHRwRmFjdG9yeScpO1xuZ29vZy5yZXF1aXJlVHlwZSgnZ29vZy5uZXQuWGhyTGlrZScpO1xuXG5cbi8qKlxuICogU3RhdGljIGNsYXNzIGZvciBjcmVhdGluZyBYTUxIdHRwUmVxdWVzdCBvYmplY3RzLlxuICogQHJldHVybiB7IWdvb2cubmV0Llhockxpa2UuT3JOYXRpdmV9IEEgbmV3IFhNTEh0dHBSZXF1ZXN0IG9iamVjdC5cbiAqL1xuZ29vZy5uZXQuWG1sSHR0cCA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIHJldHVybiBnb29nLm5ldC5YbWxIdHRwLmZhY3RvcnlfLmNyZWF0ZUluc3RhbmNlKCk7XG59O1xuXG5cbi8qKlxuICogQGRlZmluZSB7Ym9vbGVhbn0gV2hldGhlciB0byBhc3N1bWUgWE1MSHR0cFJlcXVlc3QgZXhpc3RzLiBTZXR0aW5nIHRoaXMgdG9cbiAqICAgICB0cnVlIGJ5cGFzc2VzIHRoZSBBY3RpdmVYIHByb2JpbmcgY29kZS5cbiAqIE5PVEUocnVpbG9wZXMpOiBEdWUgdG8gdGhlIHdheSBKU0NvbXBpbGVyIHdvcmtzLCB0aGlzIGRlZmluZSAqd2lsbCBub3QqIHN0cmlwXG4gKiBvdXQgdGhlIEFjdGl2ZVggcHJvYmluZyBjb2RlIGZyb20gYmluYXJpZXMuICBUbyBhY2hpZXZlIHRoaXMsIHVzZVxuICogYGdvb2cubmV0LlhtbEh0dHBEZWZpbmVzLkFTU1VNRV9OQVRJVkVfWEhSYCBpbnN0ZWFkLlxuICogVE9ETyhydWlsb3Blcyk6IENvbGxhcHNlIGJvdGggZGVmaW5lcy5cbiAqL1xuZ29vZy5uZXQuWG1sSHR0cC5BU1NVTUVfTkFUSVZFX1hIUiA9XG4gICAgZ29vZy5kZWZpbmUoJ2dvb2cubmV0LlhtbEh0dHAuQVNTVU1FX05BVElWRV9YSFInLCBmYWxzZSk7XG5cblxuLyoqIEBjb25zdCAqL1xuZ29vZy5uZXQuWG1sSHR0cERlZmluZXMgPSB7fTtcblxuXG4vKipcbiAqIEBkZWZpbmUge2Jvb2xlYW59IFdoZXRoZXIgdG8gYXNzdW1lIFhNTEh0dHBSZXF1ZXN0IGV4aXN0cy4gU2V0dGluZyB0aGlzIHRvXG4gKiAgICAgdHJ1ZSBlbGltaW5hdGVzIHRoZSBBY3RpdmVYIHByb2JpbmcgY29kZS5cbiAqL1xuZ29vZy5uZXQuWG1sSHR0cERlZmluZXMuQVNTVU1FX05BVElWRV9YSFIgPVxuICAgIGdvb2cuZGVmaW5lKCdnb29nLm5ldC5YbWxIdHRwRGVmaW5lcy5BU1NVTUVfTkFUSVZFX1hIUicsIGZhbHNlKTtcblxuXG4vKipcbiAqIEdldHMgdGhlIG9wdGlvbnMgdG8gdXNlIHdpdGggdGhlIFhNTEh0dHBSZXF1ZXN0IG9iamVjdHMgb2J0YWluZWQgdXNpbmdcbiAqIHRoZSBzdGF0aWMgbWV0aG9kcy5cbiAqIEByZXR1cm4ge09iamVjdH0gVGhlIG9wdGlvbnMuXG4gKi9cbmdvb2cubmV0LlhtbEh0dHAuZ2V0T3B0aW9ucyA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIHJldHVybiBnb29nLm5ldC5YbWxIdHRwLmZhY3RvcnlfLmdldE9wdGlvbnMoKTtcbn07XG5cblxuLyoqXG4gKiBUeXBlIG9mIG9wdGlvbnMgdGhhdCBhbiBYbWxIdHRwIG9iamVjdCBjYW4gaGF2ZS5cbiAqIEBlbnVtIHtudW1iZXJ9XG4gKi9cbmdvb2cubmV0LlhtbEh0dHAuT3B0aW9uVHlwZSA9IHtcbiAgLyoqXG4gICAqIFdoZXRoZXIgYSBnb29nLm51bGxGdW5jdGlvbiBzaG91bGQgYmUgdXNlZCB0byBjbGVhciB0aGUgb25yZWFkeXN0YXRlY2hhbmdlXG4gICAqIGhhbmRsZXIgaW5zdGVhZCBvZiBudWxsLlxuICAgKi9cbiAgVVNFX05VTExfRlVOQ1RJT046IDAsXG5cbiAgLyoqXG4gICAqIE5PVEUodXNlcik6IEluIElFIGlmIHNlbmQoKSBlcnJvcnMgb24gYSAqbG9jYWwqIHJlcXVlc3QgdGhlIHJlYWR5c3RhdGVcbiAgICogaXMgc3RpbGwgY2hhbmdlZCB0byBDT01QTEVURS4gIFdlIG5lZWQgdG8gaWdub3JlIGl0IGFuZCBhbGxvdyB0aGVcbiAgICogdHJ5L2NhdGNoIGFyb3VuZCBzZW5kKCkgdG8gcGljayB1cCB0aGUgZXJyb3IuXG4gICAqL1xuICBMT0NBTF9SRVFVRVNUX0VSUk9SOiAxLFxufTtcblxuXG4vKipcbiAqIFN0YXR1cyBjb25zdGFudHMgZm9yIFhNTEhUVFAsIG1hdGNoZXM6XG4gKiBodHRwczovL21zZG4ubWljcm9zb2Z0LmNvbS9lbi11cy9saWJyYXJ5L21zNTM0MzYxKHY9dnMuODUpLmFzcHhcbiAqIEBlbnVtIHtudW1iZXJ9XG4gKi9cbmdvb2cubmV0LlhtbEh0dHAuUmVhZHlTdGF0ZSA9IHtcbiAgLyoqXG4gICAqIENvbnN0YW50IGZvciB3aGVuIHhtbGh0dHByZXF1ZXN0LnJlYWR5U3RhdGUgaXMgdW5pbml0aWFsaXplZFxuICAgKi9cbiAgVU5JTklUSUFMSVpFRDogMCxcblxuICAvKipcbiAgICogQ29uc3RhbnQgZm9yIHdoZW4geG1saHR0cHJlcXVlc3QucmVhZHlTdGF0ZSBpcyBsb2FkaW5nLlxuICAgKi9cbiAgTE9BRElORzogMSxcblxuICAvKipcbiAgICogQ29uc3RhbnQgZm9yIHdoZW4geG1saHR0cHJlcXVlc3QucmVhZHlTdGF0ZSBpcyBsb2FkZWQuXG4gICAqL1xuICBMT0FERUQ6IDIsXG5cbiAgLyoqXG4gICAqIENvbnN0YW50IGZvciB3aGVuIHhtbGh0dHByZXF1ZXN0LnJlYWR5U3RhdGUgaXMgaW4gYW4gaW50ZXJhY3RpdmUgc3RhdGUuXG4gICAqL1xuICBJTlRFUkFDVElWRTogMyxcblxuICAvKipcbiAgICogQ29uc3RhbnQgZm9yIHdoZW4geG1saHR0cHJlcXVlc3QucmVhZHlTdGF0ZSBpcyBjb21wbGV0ZWRcbiAgICovXG4gIENPTVBMRVRFOiA0LFxufTtcblxuXG4vKipcbiAqIFRoZSBnbG9iYWwgZmFjdG9yeSBpbnN0YW5jZSBmb3IgY3JlYXRpbmcgWE1MSHR0cFJlcXVlc3Qgb2JqZWN0cy5cbiAqIEB0eXBlIHtnb29nLm5ldC5YbWxIdHRwRmFjdG9yeX1cbiAqIEBwcml2YXRlXG4gKi9cbmdvb2cubmV0LlhtbEh0dHAuZmFjdG9yeV87XG5cblxuLyoqXG4gKiBTZXRzIHRoZSBmYWN0b3JpZXMgZm9yIGNyZWF0aW5nIFhNTEh0dHBSZXF1ZXN0IG9iamVjdHMgYW5kIHRoZWlyIG9wdGlvbnMuXG4gKiBAcGFyYW0ge0Z1bmN0aW9ufSBmYWN0b3J5IFRoZSBmYWN0b3J5IGZvciBYTUxIdHRwUmVxdWVzdCBvYmplY3RzLlxuICogQHBhcmFtIHtGdW5jdGlvbn0gb3B0aW9uc0ZhY3RvcnkgVGhlIGZhY3RvcnkgZm9yIG9wdGlvbnMuXG4gKiBAZGVwcmVjYXRlZCBVc2Ugc2V0R2xvYmFsRmFjdG9yeSBpbnN0ZWFkLlxuICovXG5nb29nLm5ldC5YbWxIdHRwLnNldEZhY3RvcnkgPSBmdW5jdGlvbihmYWN0b3J5LCBvcHRpb25zRmFjdG9yeSkge1xuICAndXNlIHN0cmljdCc7XG4gIGdvb2cubmV0LlhtbEh0dHAuc2V0R2xvYmFsRmFjdG9yeShuZXcgZ29vZy5uZXQuV3JhcHBlclhtbEh0dHBGYWN0b3J5KFxuICAgICAgZ29vZy5hc3NlcnRzLmFzc2VydChmYWN0b3J5KSwgZ29vZy5hc3NlcnRzLmFzc2VydChvcHRpb25zRmFjdG9yeSkpKTtcbn07XG5cblxuLyoqXG4gKiBTZXRzIHRoZSBnbG9iYWwgZmFjdG9yeSBvYmplY3QuXG4gKiBAcGFyYW0geyFnb29nLm5ldC5YbWxIdHRwRmFjdG9yeX0gZmFjdG9yeSBOZXcgZ2xvYmFsIGZhY3Rvcnkgb2JqZWN0LlxuICovXG5nb29nLm5ldC5YbWxIdHRwLnNldEdsb2JhbEZhY3RvcnkgPSBmdW5jdGlvbihmYWN0b3J5KSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgZ29vZy5uZXQuWG1sSHR0cC5mYWN0b3J5XyA9IGZhY3Rvcnk7XG59O1xuXG5cblxuLyoqXG4gKiBEZWZhdWx0IGZhY3RvcnkgdG8gdXNlIHdoZW4gY3JlYXRpbmcgeGhyIG9iamVjdHMuICBZb3UgcHJvYmFibHkgc2hvdWxkbid0IGJlXG4gKiBpbnN0YW50aWF0aW5nIHRoaXMgZGlyZWN0bHksIGJ1dCByYXRoZXIgdXNpbmcgaXQgdmlhIGdvb2cubmV0LlhtbEh0dHAuXG4gKiBAZXh0ZW5kcyB7Z29vZy5uZXQuWG1sSHR0cEZhY3Rvcnl9XG4gKiBAY29uc3RydWN0b3JcbiAqL1xuZ29vZy5uZXQuRGVmYXVsdFhtbEh0dHBGYWN0b3J5ID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgZ29vZy5uZXQuWG1sSHR0cEZhY3RvcnkuY2FsbCh0aGlzKTtcbn07XG5nb29nLmluaGVyaXRzKGdvb2cubmV0LkRlZmF1bHRYbWxIdHRwRmFjdG9yeSwgZ29vZy5uZXQuWG1sSHR0cEZhY3RvcnkpO1xuXG5cbi8qKiBAb3ZlcnJpZGUgKi9cbmdvb2cubmV0LkRlZmF1bHRYbWxIdHRwRmFjdG9yeS5wcm90b3R5cGUuY3JlYXRlSW5zdGFuY2UgPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBjb25zdCBwcm9nSWQgPSB0aGlzLmdldFByb2dJZF8oKTtcbiAgaWYgKHByb2dJZCkge1xuICAgIHJldHVybiBuZXcgQWN0aXZlWE9iamVjdChwcm9nSWQpO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcbiAgfVxufTtcblxuXG4vKiogQG92ZXJyaWRlICovXG5nb29nLm5ldC5EZWZhdWx0WG1sSHR0cEZhY3RvcnkucHJvdG90eXBlLmludGVybmFsR2V0T3B0aW9ucyA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIGNvbnN0IHByb2dJZCA9IHRoaXMuZ2V0UHJvZ0lkXygpO1xuICBjb25zdCBvcHRpb25zID0ge307XG4gIGlmIChwcm9nSWQpIHtcbiAgICBvcHRpb25zW2dvb2cubmV0LlhtbEh0dHAuT3B0aW9uVHlwZS5VU0VfTlVMTF9GVU5DVElPTl0gPSB0cnVlO1xuICAgIG9wdGlvbnNbZ29vZy5uZXQuWG1sSHR0cC5PcHRpb25UeXBlLkxPQ0FMX1JFUVVFU1RfRVJST1JdID0gdHJ1ZTtcbiAgfVxuICByZXR1cm4gb3B0aW9ucztcbn07XG5cblxuLyoqXG4gKiBUaGUgQWN0aXZlWCBQUk9HIElEIHN0cmluZyB0byB1c2UgdG8gY3JlYXRlIHhocidzIGluIElFLiBMYXppbHkgaW5pdGlhbGl6ZWQuXG4gKiBAdHlwZSB7c3RyaW5nfHVuZGVmaW5lZH1cbiAqIEBwcml2YXRlXG4gKi9cbmdvb2cubmV0LkRlZmF1bHRYbWxIdHRwRmFjdG9yeS5wcm90b3R5cGUuaWVQcm9nSWRfO1xuXG5cbi8qKlxuICogSW5pdGlhbGl6ZSB0aGUgcHJpdmF0ZSBzdGF0ZSB1c2VkIGJ5IG90aGVyIGZ1bmN0aW9ucy5cbiAqIEByZXR1cm4ge3N0cmluZ30gVGhlIEFjdGl2ZVggUFJPRyBJRCBzdHJpbmcgdG8gdXNlIHRvIGNyZWF0ZSB4aHIncyBpbiBJRS5cbiAqIEBwcml2YXRlXG4gKi9cbmdvb2cubmV0LkRlZmF1bHRYbWxIdHRwRmFjdG9yeS5wcm90b3R5cGUuZ2V0UHJvZ0lkXyA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIGlmIChnb29nLm5ldC5YbWxIdHRwLkFTU1VNRV9OQVRJVkVfWEhSIHx8XG4gICAgICBnb29nLm5ldC5YbWxIdHRwRGVmaW5lcy5BU1NVTUVfTkFUSVZFX1hIUikge1xuICAgIHJldHVybiAnJztcbiAgfVxuXG4gIC8vIFRoZSBmb2xsb3dpbmcgYmxvZyBwb3N0IGRlc2NyaWJlcyB3aGF0IFBST0cgSURzIHRvIHVzZSB0byBjcmVhdGUgdGhlXG4gIC8vIFhNTEhUVFAgb2JqZWN0IGluIEludGVybmV0IEV4cGxvcmVyOlxuICAvLyBodHRwOi8vYmxvZ3MubXNkbi5jb20veG1sdGVhbS9hcmNoaXZlLzIwMDYvMTAvMjMvdXNpbmctdGhlLXJpZ2h0LXZlcnNpb24tb2YtbXN4bWwtaW4taW50ZXJuZXQtZXhwbG9yZXIuYXNweFxuICAvLyBIb3dldmVyIHdlIGRvIG5vdCAoeWV0KSBmdWxseSB0cnVzdCB0aGF0IHRoaXMgd2lsbCBiZSBPSyBmb3Igb2xkIHZlcnNpb25zXG4gIC8vIG9mIElFIG9uIFdpbjl4IHNvIHdlIHRoZXJlZm9yZSBrZWVwIHRoZSBsYXN0IDIuXG4gIGlmICghdGhpcy5pZVByb2dJZF8gJiYgdHlwZW9mIFhNTEh0dHBSZXF1ZXN0ID09ICd1bmRlZmluZWQnICYmXG4gICAgICB0eXBlb2YgQWN0aXZlWE9iamVjdCAhPSAndW5kZWZpbmVkJykge1xuICAgIC8vIENhbmRpZGF0ZSBBY3RpdmUgWCB0eXBlcy5cbiAgICBjb25zdCBBQ1RJVkVfWF9JREVOVFMgPSBbXG4gICAgICAnTVNYTUwyLlhNTEhUVFAuNi4wJyxcbiAgICAgICdNU1hNTDIuWE1MSFRUUC4zLjAnLFxuICAgICAgJ01TWE1MMi5YTUxIVFRQJyxcbiAgICAgICdNaWNyb3NvZnQuWE1MSFRUUCcsXG4gICAgXTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IEFDVElWRV9YX0lERU5UUy5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3QgY2FuZGlkYXRlID0gQUNUSVZFX1hfSURFTlRTW2ldO1xuXG4gICAgICB0cnkge1xuICAgICAgICBuZXcgQWN0aXZlWE9iamVjdChjYW5kaWRhdGUpO1xuICAgICAgICAvLyBOT1RFKHVzZXIpOiBjYW5ub3QgYXNzaWduIHByb2dpZCBhbmQgcmV0dXJuIGNhbmRpZGF0ZSBpbiBvbmUgbGluZVxuICAgICAgICAvLyBiZWNhdXNlIEpTQ29tcGlsZXIgY29tcGxhaW5nczogQlVHIDY1ODEyNlxuICAgICAgICB0aGlzLmllUHJvZ0lkXyA9IGNhbmRpZGF0ZTtcbiAgICAgICAgcmV0dXJuIGNhbmRpZGF0ZTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgLy8gZG8gbm90aGluZzsgdHJ5IG5leHQgY2hvaWNlXG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gY291bGRuJ3QgZmluZCBhbnkgbWF0Y2hlc1xuICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgJ0NvdWxkIG5vdCBjcmVhdGUgQWN0aXZlWE9iamVjdC4gQWN0aXZlWCBtaWdodCBiZSBkaXNhYmxlZCwnICtcbiAgICAgICAgJyBvciBNU1hNTCBtaWdodCBub3QgYmUgaW5zdGFsbGVkJyk7XG4gIH1cblxuICByZXR1cm4gLyoqIEB0eXBlIHtzdHJpbmd9ICovICh0aGlzLmllUHJvZ0lkXyk7XG59O1xuXG5cbi8vIFNldCB0aGUgZ2xvYmFsIGZhY3RvcnkgdG8gYW4gaW5zdGFuY2Ugb2YgdGhlIGRlZmF1bHQgZmFjdG9yeS5cbmdvb2cubmV0LlhtbEh0dHAuc2V0R2xvYmFsRmFjdG9yeShuZXcgZ29vZy5uZXQuRGVmYXVsdFhtbEh0dHBGYWN0b3J5KCkpO1xuIiwgIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCBUaGUgQ2xvc3VyZSBMaWJyYXJ5IEF1dGhvcnMuXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogQGZpbGVvdmVydmlldyBEZWZpbml0aW9uIG9mIHRoZSBDaGFubmVsUmVxdWVzdCBjbGFzcy4gVGhlIHJlcXVlc3RcbiAqIG9iamVjdCBlbmNhcHN1bGF0ZXMgdGhlIGxvZ2ljIGZvciBtYWtpbmcgYSBzaW5nbGUgcmVxdWVzdCwgZWl0aGVyIGZvciB0aGVcbiAqIGZvcndhcmQgY2hhbm5lbCwgYmFjayBjaGFubmVsLCBvciB0ZXN0IGNoYW5uZWwsIHRvIHRoZSBzZXJ2ZXIuIEl0IGNvbnRhaW5zXG4gKiB0aGUgbG9naWMgZm9yIHRoZSB0d28gdHlwZXMgb2YgdHJhbnNwb3J0cyB3ZSB1c2U6XG4gKiBYTUxIVFRQIGFuZCBJbWFnZSByZXF1ZXN0LiBJdCBwcm92aWRlcyB0aW1lb3V0IGRldGVjdGlvbi4gTW9yZSB0cmFuc3BvcnRzXG4gKiB0byBiZSBhZGRlZCBpbiBmdXR1cmUsIHN1Y2ggYXMgRmV0Y2gsIFdlYlNvY2tldC5cbiAqXG4gKi9cblxuXG5nb29nLnByb3ZpZGUoJ2dvb2cubGFicy5uZXQud2ViQ2hhbm5lbC5DaGFubmVsUmVxdWVzdCcpO1xuXG5nb29nLnJlcXVpcmUoJ2dvb2cuVGltZXInKTtcbmdvb2cucmVxdWlyZSgnZ29vZy5hc3NlcnRzJyk7XG5nb29nLnJlcXVpcmUoJ2dvb2cuYXN5bmMuVGhyb3R0bGUnKTtcbmdvb2cucmVxdWlyZSgnZ29vZy5kaXNwb3NlJyk7XG5nb29nLnJlcXVpcmUoJ2dvb2cuZXZlbnRzLkV2ZW50SGFuZGxlcicpO1xuZ29vZy5yZXF1aXJlKCdnb29nLmxhYnMubmV0LndlYkNoYW5uZWwuQ2hhbm5lbCcpO1xuZ29vZy5yZXF1aXJlKCdnb29nLmxhYnMubmV0LndlYkNoYW5uZWwuV2ViQ2hhbm5lbERlYnVnJyk7XG5nb29nLnJlcXVpcmUoJ2dvb2cubGFicy5uZXQud2ViQ2hhbm5lbC5lbnZpcm9ubWVudCcpO1xuZ29vZy5yZXF1aXJlKCdnb29nLmxhYnMubmV0LndlYkNoYW5uZWwucmVxdWVzdFN0YXRzJyk7XG5nb29nLnJlcXVpcmUoJ2dvb2cubmV0LkVycm9yQ29kZScpO1xuZ29vZy5yZXF1aXJlKCdnb29nLm5ldC5FdmVudFR5cGUnKTtcbmdvb2cucmVxdWlyZSgnZ29vZy5uZXQuV2ViQ2hhbm5lbCcpO1xuZ29vZy5yZXF1aXJlKCdnb29nLm5ldC5YbWxIdHRwJyk7XG5nb29nLnJlcXVpcmUoJ2dvb2cub2JqZWN0Jyk7XG5nb29nLnJlcXVpcmUoJ2dvb2cuc3RyaW5nJyk7XG5nb29nLnJlcXVpcmUoJ2dvb2cudXNlckFnZW50Jyk7XG5nb29nLnJlcXVpcmVUeXBlKCdnb29nLlVyaScpO1xuZ29vZy5yZXF1aXJlVHlwZSgnZ29vZy5ldmVudHMuRXZlbnQnKTtcbmdvb2cucmVxdWlyZVR5cGUoJ2dvb2cubGFicy5uZXQud2ViQ2hhbm5lbC5XaXJlLlF1ZXVlZE1hcCcpO1xuZ29vZy5yZXF1aXJlVHlwZSgnZ29vZy5uZXQuWGhySW8nKTtcblxuXG5cbi8qKlxuICogQSBuZXcgQ2hhbm5lbFJlcXVlc3QgaXMgY3JlYXRlZCBmb3IgZWFjaCByZXF1ZXN0IHRvIHRoZSBzZXJ2ZXIuXG4gKlxuICogQHBhcmFtIHtnb29nLmxhYnMubmV0LndlYkNoYW5uZWwuQ2hhbm5lbH0gY2hhbm5lbFxuICogICAgIFRoZSBjaGFubmVsIHRoYXQgb3ducyB0aGlzIHJlcXVlc3QuXG4gKiBAcGFyYW0ge2dvb2cubGFicy5uZXQud2ViQ2hhbm5lbC5XZWJDaGFubmVsRGVidWd9IGNoYW5uZWxEZWJ1ZyBBXG4gKiAgICAgV2ViQ2hhbm5lbERlYnVnIHRvIHVzZSBmb3IgbG9nZ2luZy5cbiAqIEBwYXJhbSB7c3RyaW5nPX0gb3B0X3Nlc3Npb25JZCBUaGUgc2Vzc2lvbiBpZCBmb3IgdGhlIGNoYW5uZWwuXG4gKiBAcGFyYW0ge3N0cmluZ3xudW1iZXI9fSBvcHRfcmVxdWVzdElkIFRoZSByZXF1ZXN0IGlkIGZvciB0aGlzIHJlcXVlc3QuXG4gKiBAcGFyYW0ge251bWJlcj19IG9wdF9yZXRyeUlkIFRoZSByZXRyeSBpZCBmb3IgdGhpcyByZXF1ZXN0LlxuICogQGNvbnN0cnVjdG9yXG4gKiBAc3RydWN0XG4gKiBAZmluYWxcbiAqL1xuZ29vZy5sYWJzLm5ldC53ZWJDaGFubmVsLkNoYW5uZWxSZXF1ZXN0ID0gZnVuY3Rpb24oXG4gICAgY2hhbm5lbCwgY2hhbm5lbERlYnVnLCBvcHRfc2Vzc2lvbklkLCBvcHRfcmVxdWVzdElkLCBvcHRfcmV0cnlJZCkge1xuICAndXNlIHN0cmljdCc7XG4gIC8qKlxuICAgKiBUaGUgY2hhbm5lbCBvYmplY3QgdGhhdCBvd25zIHRoZSByZXF1ZXN0LlxuICAgKiBAcHJpdmF0ZSB7Z29vZy5sYWJzLm5ldC53ZWJDaGFubmVsLkNoYW5uZWx9XG4gICAqL1xuICB0aGlzLmNoYW5uZWxfID0gY2hhbm5lbDtcblxuICAvKipcbiAgICogVGhlIGNoYW5uZWwgZGVidWcgdG8gdXNlIGZvciBsb2dnaW5nXG4gICAqIEBwcml2YXRlIHtnb29nLmxhYnMubmV0LndlYkNoYW5uZWwuV2ViQ2hhbm5lbERlYnVnfVxuICAgKi9cbiAgdGhpcy5jaGFubmVsRGVidWdfID0gY2hhbm5lbERlYnVnO1xuXG4gIC8qKlxuICAgKiBUaGUgU2Vzc2lvbiBJRCBmb3IgdGhlIGNoYW5uZWwuXG4gICAqIEBwcml2YXRlIHtzdHJpbmd8dW5kZWZpbmVkfVxuICAgKi9cbiAgdGhpcy5zaWRfID0gb3B0X3Nlc3Npb25JZDtcblxuICAvKipcbiAgICogVGhlIFJJRCAocmVxdWVzdCBJRCkgZm9yIHRoZSByZXF1ZXN0LlxuICAgKiBAcHJpdmF0ZSB7c3RyaW5nfG51bWJlcnx1bmRlZmluZWR9XG4gICAqL1xuICB0aGlzLnJpZF8gPSBvcHRfcmVxdWVzdElkO1xuXG4gIC8qKlxuICAgKiBUaGUgYXR0ZW1wdCBudW1iZXIgb2YgdGhlIGN1cnJlbnQgcmVxdWVzdC5cbiAgICogQHByaXZhdGUge251bWJlcn1cbiAgICovXG4gIHRoaXMucmV0cnlJZF8gPSBvcHRfcmV0cnlJZCB8fCAxO1xuXG4gIC8qKlxuICAgKiBBbiBvYmplY3QgdG8ga2VlcCB0cmFjayBvZiB0aGUgY2hhbm5lbCByZXF1ZXN0IGV2ZW50IGxpc3RlbmVycy5cbiAgICogQHByaXZhdGUgeyFnb29nLmV2ZW50cy5FdmVudEhhbmRsZXI8XG4gICAqICAgICAhZ29vZy5sYWJzLm5ldC53ZWJDaGFubmVsLkNoYW5uZWxSZXF1ZXN0Pn1cbiAgICovXG4gIHRoaXMuZXZlbnRIYW5kbGVyXyA9IG5ldyBnb29nLmV2ZW50cy5FdmVudEhhbmRsZXIodGhpcyk7XG5cbiAgLyoqXG4gICAqIFRoZSB0aW1lb3V0IGluIG1zIGJlZm9yZSBmYWlsaW5nIHRoZSByZXF1ZXN0LlxuICAgKiBAcHJpdmF0ZSB7bnVtYmVyfVxuICAgKi9cbiAgdGhpcy50aW1lb3V0XyA9IGdvb2cubGFicy5uZXQud2ViQ2hhbm5lbC5DaGFubmVsUmVxdWVzdC5USU1FT1VUX01TXztcblxuICAvKipcbiAgICogQSB0aW1lciBmb3IgcG9sbGluZyByZXNwb25zZVRleHQgaW4gYnJvd3NlcnMgdGhhdCBkb24ndCBmaXJlXG4gICAqIG9ucmVhZHlzdGF0ZWNoYW5nZSBkdXJpbmcgaW5jcmVtZW50YWwgbG9hZGluZyBvZiByZXNwb25zZVRleHQuXG4gICAqIEBwcml2YXRlIHtnb29nLlRpbWVyfVxuICAgKi9cbiAgdGhpcy5wb2xsaW5nVGltZXJfID1cbiAgICAgIG5ldyBnb29nLlRpbWVyKGdvb2cubGFicy5uZXQud2ViQ2hhbm5lbC5lbnZpcm9ubWVudC5nZXRQb2xsaW5nSW50ZXJ2YWwoKSk7XG5cbiAgLyoqXG4gICAqIEV4dHJhIEhUVFAgaGVhZGVycyB0byBhZGQgdG8gYWxsIHRoZSByZXF1ZXN0cyBzZW50IHRvIHRoZSBzZXJ2ZXIuXG4gICAqIEBwcml2YXRlIHs/T2JqZWN0fVxuICAgKi9cbiAgdGhpcy5leHRyYUhlYWRlcnNfID0gbnVsbDtcblxuXG4gIC8qKlxuICAgKiBXaGV0aGVyIHRoZSByZXF1ZXN0IHdhcyBzdWNjZXNzZnVsLiBUaGlzIGlzIG9ubHkgc2V0IHRvIHRydWUgYWZ0ZXIgdGhlXG4gICAqIHJlcXVlc3Qgc3VjY2Vzc2Z1bGx5IGNvbXBsZXRlcy5cbiAgICogQHByaXZhdGUge2Jvb2xlYW59XG4gICAqL1xuICB0aGlzLnN1Y2Nlc3NmdWxfID0gZmFsc2U7XG5cblxuICAvKipcbiAgICogVGhlIFRpbWVySUQgb2YgdGhlIHRpbWVyIHVzZWQgdG8gZGV0ZWN0IGlmIHRoZSByZXF1ZXN0IGhhcyB0aW1lZC1vdXQuXG4gICAqIEB0eXBlIHs/bnVtYmVyfVxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgdGhpcy53YXRjaERvZ1RpbWVySWRfID0gbnVsbDtcblxuICAvKipcbiAgICogVGhlIHRpbWUgaW4gdGhlIGZ1dHVyZSB3aGVuIHRoZSByZXF1ZXN0IHdpbGwgdGltZW91dC5cbiAgICogQHByaXZhdGUgez9udW1iZXJ9XG4gICAqL1xuICB0aGlzLndhdGNoRG9nVGltZW91dFRpbWVfID0gbnVsbDtcblxuICAvKipcbiAgICogVGhlIHRpbWUgdGhlIHJlcXVlc3Qgc3RhcnRlZC5cbiAgICogQHByaXZhdGUgez9udW1iZXJ9XG4gICAqL1xuICB0aGlzLnJlcXVlc3RTdGFydFRpbWVfID0gbnVsbDtcblxuICAvKipcbiAgICogVGhlIHR5cGUgb2YgcmVxdWVzdCAoWE1MSFRUUCwgSU1HKVxuICAgKiBAcHJpdmF0ZSB7P251bWJlcn1cbiAgICovXG4gIHRoaXMudHlwZV8gPSBudWxsO1xuXG4gIC8qKlxuICAgKiBUaGUgYmFzZSBVcmkgZm9yIHRoZSByZXF1ZXN0LiBUaGUgaW5jbHVkZXMgYWxsIHRoZSBwYXJhbWV0ZXJzIGV4Y2VwdCB0aGVcbiAgICogb25lIHRoYXQgaW5kaWNhdGVzIHRoZSByZXRyeSBudW1iZXIuXG4gICAqIEBwcml2YXRlIHs/Z29vZy5Vcml9XG4gICAqL1xuICB0aGlzLmJhc2VVcmlfID0gbnVsbDtcblxuICAvKipcbiAgICogVGhlIHJlcXVlc3QgVXJpIHRoYXQgd2FzIGFjdHVhbGx5IHVzZWQgZm9yIHRoZSBtb3N0IHJlY2VudCByZXF1ZXN0IGF0dGVtcHQuXG4gICAqIEBwcml2YXRlIHs/Z29vZy5Vcml9XG4gICAqL1xuICB0aGlzLnJlcXVlc3RVcmlfID0gbnVsbDtcblxuICAvKipcbiAgICogVGhlIHBvc3QgZGF0YSwgaWYgdGhlIHJlcXVlc3QgaXMgYSBwb3N0LlxuICAgKiBAcHJpdmF0ZSB7P3N0cmluZ31cbiAgICovXG4gIHRoaXMucG9zdERhdGFfID0gbnVsbDtcblxuICAvKipcbiAgICogQW4gYXJyYXkgb2YgcGVuZGluZyBtZXNzYWdlcyB0aGF0IHdlIGhhdmUgZWl0aGVyIHJlY2VpdmVkIGEgbm9uLXN1Y2Nlc3NmdWxcbiAgICogcmVzcG9uc2UgZm9yLCBvciBubyByZXNwb25zZSBhdCBhbGwsIGFuZCB3aGljaCB0aGVyZWZvcmUgbWF5IG9yIG1heSBub3RcbiAgICogaGF2ZSBiZWVuIHJlY2VpdmVkIGJ5IHRoZSBzZXJ2ZXIuXG4gICAqIEBwcml2YXRlIHshQXJyYXk8Z29vZy5sYWJzLm5ldC53ZWJDaGFubmVsLldpcmUuUXVldWVkTWFwPn1cbiAgICovXG4gIHRoaXMucGVuZGluZ01lc3NhZ2VzXyA9IFtdO1xuXG4gIC8qKlxuICAgKiBUaGUgWGhyTHRlIHJlcXVlc3QgaWYgdGhlIHJlcXVlc3QgaXMgdXNpbmcgWE1MSFRUUFxuICAgKiBAcHJpdmF0ZSB7P2dvb2cubmV0LlhocklvfVxuICAgKi9cbiAgdGhpcy54bWxIdHRwXyA9IG51bGw7XG5cbiAgLyoqXG4gICAqIFRoZSBwb3NpdGlvbiBvZiB3aGVyZSB0aGUgbmV4dCB1bnByb2Nlc3NlZCBjaHVuayBzdGFydHMgaW4gdGhlIHJlc3BvbnNlXG4gICAqIHRleHQuXG4gICAqIEBwcml2YXRlIHtudW1iZXJ9XG4gICAqL1xuICB0aGlzLnhtbEh0dHBDaHVua1N0YXJ0XyA9IDA7XG5cbiAgLyoqXG4gICAqIFRoZSB2ZXJiIChHZXQgb3IgUG9zdCkgZm9yIHRoZSByZXF1ZXN0LlxuICAgKiBAcHJpdmF0ZSB7P3N0cmluZ31cbiAgICovXG4gIHRoaXMudmVyYl8gPSBudWxsO1xuXG4gIC8qKlxuICAgKiBUaGUgbGFzdCBlcnJvciBpZiB0aGUgcmVxdWVzdCBmYWlsZWQuXG4gICAqIEBwcml2YXRlIHs/Z29vZy5sYWJzLm5ldC53ZWJDaGFubmVsLkNoYW5uZWxSZXF1ZXN0LkVycm9yfVxuICAgKi9cbiAgdGhpcy5sYXN0RXJyb3JfID0gbnVsbDtcblxuICAvKipcbiAgICogVGhlIGxhc3Qgc3RhdHVzIGNvZGUgcmVjZWl2ZWQuXG4gICAqIEBwcml2YXRlIHtudW1iZXJ9XG4gICAqL1xuICB0aGlzLmxhc3RTdGF0dXNDb2RlXyA9IC0xO1xuXG4gIC8qKlxuICAgKiBXaGV0aGVyIHRoZSByZXF1ZXN0IGhhcyBiZWVuIGNhbmNlbGxlZCBkdWUgdG8gYSBjYWxsIHRvIGNhbmNlbC5cbiAgICogQHByaXZhdGUge2Jvb2xlYW59XG4gICAqL1xuICB0aGlzLmNhbmNlbGxlZF8gPSBmYWxzZTtcblxuICAvKipcbiAgICogQSB0aHJvdHRsZSB0aW1lIGluIG1zIGZvciByZWFkeXN0YXRlY2hhbmdlIGV2ZW50cyBmb3IgdGhlIGJhY2tjaGFubmVsLlxuICAgKiBVc2VmdWwgZm9yIHRocm90dGxpbmcgd2hlbiByZWFkeSBzdGF0ZSBpcyBJTlRFUkFDVElWRSAocGFydGlhbCBkYXRhKS5cbiAgICogSWYgc2V0IHRvIHplcm8gbm8gdGhyb3R0bGUgaXMgdXNlZC5cbiAgICpcbiAgICogU2VlIFdlYkNoYW5uZWxCYXNlLnByb3RvdHlwZS5yZWFkeVN0YXRlQ2hhbmdlVGhyb3R0bGVNc19cbiAgICpcbiAgICogQHByaXZhdGUge251bWJlcn1cbiAgICovXG4gIHRoaXMucmVhZHlTdGF0ZUNoYW5nZVRocm90dGxlTXNfID0gMDtcblxuICAvKipcbiAgICogVGhlIHRocm90dGxlIGZvciByZWFkeXN0YXRlY2hhbmdlIGV2ZW50cyBmb3IgdGhlIGN1cnJlbnQgcmVxdWVzdCwgb3IgbnVsbFxuICAgKiBpZiB0aGVyZSBpcyBub25lLlxuICAgKiBAcHJpdmF0ZSB7P2dvb2cuYXN5bmMuVGhyb3R0bGV9XG4gICAqL1xuICB0aGlzLnJlYWR5U3RhdGVDaGFuZ2VUaHJvdHRsZV8gPSBudWxsO1xuXG4gIC8qKlxuICAgKiBXaGV0aGVyIHRvIHRoZSByZXN1bHQgaXMgZXhwZWN0ZWQgdG8gYmUgZW5jb2RlZCBmb3IgY2h1bmtpbmcgYW5kIHRodXNcbiAgICogcmVxdWlyZXMgZGVjb2RpbmcuXG4gICAqIEBwcml2YXRlIHtib29sZWFufVxuICAgKi9cbiAgdGhpcy5kZWNvZGVDaHVua3NfID0gZmFsc2U7XG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgdG8gZGVjb2RlIHgtaHR0cC1pbml0aWFsLXJlc3BvbnNlLlxuICAgKiBAcHJpdmF0ZSB7Ym9vbGVhbn1cbiAgICovXG4gIHRoaXMuZGVjb2RlSW5pdGlhbFJlc3BvbnNlXyA9IGZhbHNlO1xuXG4gIC8qKlxuICAgKiBXaGV0aGVyIHgtaHR0cC1pbml0aWFsLXJlc3BvbnNlIGhhcyBiZWVuIGRlY29kZWQgKGRpc3BhdGNoZWQpLlxuICAgKiBAcHJpdmF0ZSB7Ym9vbGVhbn1cbiAgICovXG4gIHRoaXMuaW5pdGlhbFJlc3BvbnNlRGVjb2RlZF8gPSBmYWxzZTtcblxuICAvKipcbiAgICogV2hldGhlciB0aGUgZmlyc3QgYnl0ZSBvZiByZXNwb25zZSBib2R5IGhhcyBhcnJpdmVkLCBmb3IgYSBzdWNjZXNzZnVsXG4gICAqIHJlc3BvbnNlLlxuICAgKiBAcHJpdmF0ZSB7Ym9vbGVhbn1cbiAgICovXG4gIHRoaXMuZmlyc3RCeXRlUmVjZWl2ZWRfID0gZmFsc2U7XG5cbiAgLyoqXG4gICAqIFRoZSBjdXJyZW50IHN0YXRlIG9mIGZldGNoIHJlc3BvbnNlcyBpZiB3ZWJjaGFubmVsIGlzIHVzaW5nIFdIQVRXR1xuICAgKiBmZXRjaC9zdHJlYW1zLlxuICAgKiBAcHJpdmF0ZSB7IWdvb2cubGFicy5uZXQud2ViQ2hhbm5lbC5GZXRjaFJlc3BvbnNlU3RhdGV9XG4gICAqL1xuICB0aGlzLmZldGNoUmVzcG9uc2VTdGF0ZV8gPSBuZXcgZ29vZy5sYWJzLm5ldC53ZWJDaGFubmVsLkZldGNoUmVzcG9uc2VTdGF0ZSgpO1xufTtcblxuLyoqXG4gKiBBIGNvbGxlY3Rpb24gb2YgZmV0Y2gvc3RyZWFtIHByb3BlcnRpZXMuXG4gKiBAc3RydWN0XG4gKiBAY29uc3RydWN0b3JcbiAqL1xuZ29vZy5sYWJzLm5ldC53ZWJDaGFubmVsLkZldGNoUmVzcG9uc2VTdGF0ZSA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIC8qKlxuICAgKiBUaGUgVGV4dERlY29kZXIgZm9yIGRlY29kaW5nIFVpbnQ4QXJyYXkgcmVzcG9uc2VzIGZyb20gZmV0Y2ggcmVxdWVzdC5cbiAgICogQHR5cGUgez9nb29nLmdsb2JhbC5UZXh0RGVjb2Rlcn1cbiAgICovXG4gIHRoaXMudGV4dERlY29kZXIgPSBudWxsO1xuXG4gIC8qKlxuICAgKiBUaGUgdW5jb25zdW1lZCByZXNwb25zZSB0ZXh0IGZyb20gdGhlIGZldGNoIHJlcXVlc3RzLlxuICAgKiBAdHlwZSB7c3RyaW5nfVxuICAgKi9cbiAgdGhpcy5yZXNwb25zZUJ1ZmZlciA9ICcnO1xuXG4gIC8qKlxuICAgKiBXaGV0aGVyIG9yIG5vdCB0aGUgcmVzcG9uc2UgYm9keSBoYXMgYXJyaXZlZC5cbiAgICogQHR5cGUge2Jvb2xlYW59XG4gICAqL1xuICB0aGlzLnJlc3BvbnNlQXJyaXZlZEZvckZldGNoID0gZmFsc2U7XG59O1xuXG5cbmdvb2cuc2NvcGUoZnVuY3Rpb24oKSB7XG4ndXNlIHN0cmljdCc7XG5jb25zdCBXZWJDaGFubmVsID0gZ29vZy5uZXQuV2ViQ2hhbm5lbDtcbmNvbnN0IENoYW5uZWwgPSBnb29nLmxhYnMubmV0LndlYkNoYW5uZWwuQ2hhbm5lbDtcbmNvbnN0IENoYW5uZWxSZXF1ZXN0ID0gZ29vZy5sYWJzLm5ldC53ZWJDaGFubmVsLkNoYW5uZWxSZXF1ZXN0O1xuY29uc3QgRmV0Y2hSZXNwb25zZVN0YXRlID0gZ29vZy5sYWJzLm5ldC53ZWJDaGFubmVsLkZldGNoUmVzcG9uc2VTdGF0ZTtcbmNvbnN0IHJlcXVlc3RTdGF0cyA9IGdvb2cubGFicy5uZXQud2ViQ2hhbm5lbC5yZXF1ZXN0U3RhdHM7XG5jb25zdCBXZWJDaGFubmVsRGVidWcgPSBnb29nLmxhYnMubmV0LndlYkNoYW5uZWwuV2ViQ2hhbm5lbERlYnVnO1xuY29uc3QgZW52aXJvbm1lbnQgPSBnb29nLmxhYnMubmV0LndlYkNoYW5uZWwuZW52aXJvbm1lbnQ7XG5cbi8qKlxuICogRGVmYXVsdCB0aW1lb3V0IGluIE1TIGZvciBhIHJlcXVlc3QuIFRoZSBzZXJ2ZXIgbXVzdCByZXR1cm4gZGF0YSB3aXRoaW4gdGhpc1xuICogdGltZSBsaW1pdCBmb3IgdGhlIHJlcXVlc3QgdG8gbm90IHRpbWVvdXQuXG4gKiBAcHJpdmF0ZSB7bnVtYmVyfVxuICovXG5DaGFubmVsUmVxdWVzdC5USU1FT1VUX01TXyA9IDQ1ICogMTAwMDtcblxuXG4vKipcbiAqIEVudW0gZm9yIGNoYW5uZWwgcmVxdWVzdHMgdHlwZVxuICogQGVudW0ge251bWJlcn1cbiAqIEBwcml2YXRlXG4gKi9cbkNoYW5uZWxSZXF1ZXN0LlR5cGVfID0ge1xuICAvKipcbiAgICogWE1MSFRUUCByZXF1ZXN0cy5cbiAgICovXG4gIFhNTF9IVFRQOiAxLFxuXG4gIC8qKlxuICAgKiBJTUcgcmVxdWVzdHMuXG4gICAqL1xuICBDTE9TRV9SRVFVRVNUOiAyXG59O1xuXG5cbi8qKlxuICogRW51bSB0eXBlIGZvciBpZGVudGlmeWluZyBhbiBlcnJvci5cbiAqIEBlbnVtIHtudW1iZXJ9XG4gKi9cbkNoYW5uZWxSZXF1ZXN0LkVycm9yID0ge1xuICAvKipcbiAgICogRXJyb3JzIGR1ZSB0byBhIG5vbi0yMDAgc3RhdHVzIGNvZGUuXG4gICAqL1xuICBTVEFUVVM6IDAsXG5cbiAgLyoqXG4gICAqIEVycm9ycyBkdWUgdG8gbm8gZGF0YSBiZWluZyByZXR1cm5lZC5cbiAgICovXG4gIE5PX0RBVEE6IDEsXG5cbiAgLyoqXG4gICAqIEVycm9ycyBkdWUgdG8gYSB0aW1lb3V0LlxuICAgKi9cbiAgVElNRU9VVDogMixcblxuICAvKipcbiAgICogRXJyb3JzIGR1ZSB0byB0aGUgc2VydmVyIHJldHVybmluZyBhbiB1bmtub3duLlxuICAgKi9cbiAgVU5LTk9XTl9TRVNTSU9OX0lEOiAzLFxuXG4gIC8qKlxuICAgKiBFcnJvcnMgZHVlIHRvIGJhZCBkYXRhIGJlaW5nIHJlY2VpdmVkLlxuICAgKi9cbiAgQkFEX0RBVEE6IDQsXG5cbiAgLyoqXG4gICAqIEVycm9ycyBkdWUgdG8gdGhlIGhhbmRsZXIgdGhyb3dpbmcgYW4gZXhjZXB0aW9uLlxuICAgKi9cbiAgSEFORExFUl9FWENFUFRJT046IDUsXG5cbiAgLyoqXG4gICAqIFRoZSBicm93c2VyIGRlY2xhcmVkIGl0c2VsZiBvZmZsaW5lIGR1cmluZyB0aGUgcmVxdWVzdC5cbiAgICovXG4gIEJST1dTRVJfT0ZGTElORTogNlxufTtcblxuXG4vKipcbiAqIFJldHVybnMgYSB1c2VmdWwgZXJyb3Igc3RyaW5nIGZvciBkZWJ1Z2dpbmcgYmFzZWQgb24gdGhlIHNwZWNpZmllZCBlcnJvclxuICogY29kZS5cbiAqIEBwYXJhbSB7P0NoYW5uZWxSZXF1ZXN0LkVycm9yfSBlcnJvckNvZGUgVGhlIGVycm9yIGNvZGUuXG4gKiBAcGFyYW0ge251bWJlcn0gc3RhdHVzQ29kZSBUaGUgSFRUUCBzdGF0dXMgY29kZS5cbiAqIEByZXR1cm4ge3N0cmluZ30gVGhlIGVycm9yIHN0cmluZyBmb3IgdGhlIGdpdmVuIGNvZGUgY29tYmluYXRpb24uXG4gKi9cbkNoYW5uZWxSZXF1ZXN0LmVycm9yU3RyaW5nRnJvbUNvZGUgPSBmdW5jdGlvbihlcnJvckNvZGUsIHN0YXR1c0NvZGUpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBzd2l0Y2ggKGVycm9yQ29kZSkge1xuICAgIGNhc2UgQ2hhbm5lbFJlcXVlc3QuRXJyb3IuU1RBVFVTOlxuICAgICAgcmV0dXJuICdOb24tMjAwIHJldHVybiBjb2RlICgnICsgc3RhdHVzQ29kZSArICcpJztcbiAgICBjYXNlIENoYW5uZWxSZXF1ZXN0LkVycm9yLk5PX0RBVEE6XG4gICAgICByZXR1cm4gJ1hNTEhUVFAgZmFpbHVyZSAobm8gZGF0YSknO1xuICAgIGNhc2UgQ2hhbm5lbFJlcXVlc3QuRXJyb3IuVElNRU9VVDpcbiAgICAgIHJldHVybiAnSHR0cENvbm5lY3Rpb24gdGltZW91dCc7XG4gICAgZGVmYXVsdDpcbiAgICAgIHJldHVybiAnVW5rbm93biBlcnJvcic7XG4gIH1cbn07XG5cblxuLyoqXG4gKiBTZW50aW5lbCB2YWx1ZSB1c2VkIHRvIGluZGljYXRlIGFuIGludmFsaWQgY2h1bmsgaW4gYSBtdWx0aS1jaHVuayByZXNwb25zZS5cbiAqIEBwcml2YXRlIHshT2JqZWN0fVxuICovXG5DaGFubmVsUmVxdWVzdC5JTlZBTElEX0NIVU5LXyA9IHt9O1xuXG5cbi8qKlxuICogU2VudGluZWwgdmFsdWUgdXNlZCB0byBpbmRpY2F0ZSBhbiBpbmNvbXBsZXRlIGNodW5rIGluIGEgbXVsdGktY2h1bmtcbiAqIHJlc3BvbnNlLlxuICogQHByaXZhdGUgeyFPYmplY3R9XG4gKi9cbkNoYW5uZWxSZXF1ZXN0LklOQ09NUExFVEVfQ0hVTktfID0ge307XG5cblxuLyoqXG4gKiBSZXR1cm5zIHdoZXRoZXIgWEhSIHN0cmVhbWluZyBpcyBzdXBwb3J0ZWQgb24gdGhpcyBicm93c2VyLlxuICpcbiAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgWEhSIHN0cmVhbWluZyBpcyBzdXBwb3J0ZWQuXG4gKiBAc2VlIGh0dHA6Ly9jb2RlLmdvb2dsZS5jb20vcC9jbG9zdXJlLWxpYnJhcnkvaXNzdWVzL2RldGFpbD9pZD0zNDZcbiAqL1xuQ2hhbm5lbFJlcXVlc3Quc3VwcG9ydHNYaHJTdHJlYW1pbmcgPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gIWdvb2cudXNlckFnZW50LklFIHx8IGdvb2cudXNlckFnZW50LmlzRG9jdW1lbnRNb2RlT3JIaWdoZXIoMTApO1xufTtcblxuXG4vKipcbiAqIFNldHMgZXh0cmEgSFRUUCBoZWFkZXJzIHRvIGFkZCB0byBhbGwgdGhlIHJlcXVlc3RzIHNlbnQgdG8gdGhlIHNlcnZlci5cbiAqXG4gKiBAcGFyYW0ge09iamVjdH0gZXh0cmFIZWFkZXJzIFRoZSBIVFRQIGhlYWRlcnMuXG4gKi9cbkNoYW5uZWxSZXF1ZXN0LnByb3RvdHlwZS5zZXRFeHRyYUhlYWRlcnMgPSBmdW5jdGlvbihleHRyYUhlYWRlcnMpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICB0aGlzLmV4dHJhSGVhZGVyc18gPSBleHRyYUhlYWRlcnM7XG59O1xuXG5cbi8qKlxuICogT3ZlcnJpZGVzIHRoZSBkZWZhdWx0IEhUVFAgbWV0aG9kLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSB2ZXJiIFRoZSBIVFRQIG1ldGhvZFxuICovXG5DaGFubmVsUmVxdWVzdC5wcm90b3R5cGUuc2V0VmVyYiA9IGZ1bmN0aW9uKHZlcmIpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICB0aGlzLnZlcmJfID0gdmVyYjtcbn07XG5cblxuLyoqXG4gKiBTZXRzIHRoZSB0aW1lb3V0IGZvciBhIHJlcXVlc3RcbiAqXG4gKiBAcGFyYW0ge251bWJlcn0gdGltZW91dCAgIFRoZSB0aW1lb3V0IGluIE1TIGZvciB3aGVuIHdlIGZhaWwgdGhlIHJlcXVlc3QuXG4gKi9cbkNoYW5uZWxSZXF1ZXN0LnByb3RvdHlwZS5zZXRUaW1lb3V0ID0gZnVuY3Rpb24odGltZW91dCkge1xuICAndXNlIHN0cmljdCc7XG4gIHRoaXMudGltZW91dF8gPSB0aW1lb3V0O1xufTtcblxuXG4vKipcbiAqIFNldHMgdGhlIHRocm90dGxlIGZvciBoYW5kbGluZyBvbnJlYWR5c3RhdGVjaGFuZ2UgZXZlbnRzIGZvciB0aGUgcmVxdWVzdC5cbiAqXG4gKiBAcGFyYW0ge251bWJlcn0gdGhyb3R0bGUgVGhlIHRocm90dGxlIGluIG1zLiAgQSB2YWx1ZSBvZiB6ZXJvIGluZGljYXRlc1xuICogICAgIG5vIHRocm90dGxlLlxuICovXG5DaGFubmVsUmVxdWVzdC5wcm90b3R5cGUuc2V0UmVhZHlTdGF0ZUNoYW5nZVRocm90dGxlID0gZnVuY3Rpb24odGhyb3R0bGUpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICB0aGlzLnJlYWR5U3RhdGVDaGFuZ2VUaHJvdHRsZU1zXyA9IHRocm90dGxlO1xufTtcblxuXG4vKipcbiAqIFNldHMgdGhlIHBlbmRpbmcgbWVzc2FnZXMgdGhhdCB0aGlzIHJlcXVlc3QgaXMgaGFuZGxpbmcuXG4gKlxuICogQHBhcmFtIHshQXJyYXk8Z29vZy5sYWJzLm5ldC53ZWJDaGFubmVsLldpcmUuUXVldWVkTWFwPn0gcGVuZGluZ01lc3NhZ2VzXG4gKiAgICAgVGhlIHBlbmRpbmcgbWVzc2FnZXMgZm9yIHRoaXMgcmVxdWVzdC5cbiAqL1xuQ2hhbm5lbFJlcXVlc3QucHJvdG90eXBlLnNldFBlbmRpbmdNZXNzYWdlcyA9IGZ1bmN0aW9uKHBlbmRpbmdNZXNzYWdlcykge1xuICAndXNlIHN0cmljdCc7XG4gIHRoaXMucGVuZGluZ01lc3NhZ2VzXyA9IHBlbmRpbmdNZXNzYWdlcztcbn07XG5cblxuLyoqXG4gKiBHZXRzIHRoZSBwZW5kaW5nIG1lc3NhZ2VzIHRoYXQgdGhpcyByZXF1ZXN0IGlzIGhhbmRsaW5nLCBpbiBjYXNlIG9mIGEgcmV0cnkuXG4gKlxuICogQHJldHVybiB7IUFycmF5PGdvb2cubGFicy5uZXQud2ViQ2hhbm5lbC5XaXJlLlF1ZXVlZE1hcD59IFRoZSBwZW5kaW5nXG4gKiAgICAgbWVzc2FnZXMgZm9yIHRoaXMgcmVxdWVzdC5cbiAqL1xuQ2hhbm5lbFJlcXVlc3QucHJvdG90eXBlLmdldFBlbmRpbmdNZXNzYWdlcyA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIHJldHVybiB0aGlzLnBlbmRpbmdNZXNzYWdlc187XG59O1xuXG5cbi8qKlxuICogVXNlcyBYTUxIVFRQIHRvIHNlbmQgYW4gSFRUUCBQT1NUIHRvIHRoZSBzZXJ2ZXIuXG4gKlxuICogQHBhcmFtIHtnb29nLlVyaX0gdXJpICBUaGUgdXJpIG9mIHRoZSByZXF1ZXN0LlxuICogQHBhcmFtIHs/c3RyaW5nfSBwb3N0RGF0YSAgVGhlIGRhdGEgZm9yIHRoZSBwb3N0IGJvZHkuXG4gKiBAcGFyYW0ge2Jvb2xlYW59IGRlY29kZUNodW5rcyAgV2hldGhlciB0byB0aGUgcmVzdWx0IGlzIGV4cGVjdGVkIHRvIGJlXG4gKiAgICAgZW5jb2RlZCBmb3IgY2h1bmtpbmcgYW5kIHRodXMgcmVxdWlyZXMgZGVjb2RpbmcuXG4gKi9cbkNoYW5uZWxSZXF1ZXN0LnByb3RvdHlwZS54bWxIdHRwUG9zdCA9IGZ1bmN0aW9uKHVyaSwgcG9zdERhdGEsIGRlY29kZUNodW5rcykge1xuICAndXNlIHN0cmljdCc7XG4gIHRoaXMudHlwZV8gPSBDaGFubmVsUmVxdWVzdC5UeXBlXy5YTUxfSFRUUDtcbiAgdGhpcy5iYXNlVXJpXyA9IHVyaS5jbG9uZSgpLm1ha2VVbmlxdWUoKTtcbiAgdGhpcy5wb3N0RGF0YV8gPSBwb3N0RGF0YTtcbiAgdGhpcy5kZWNvZGVDaHVua3NfID0gZGVjb2RlQ2h1bmtzO1xuICB0aGlzLnNlbmRYbWxIdHRwXyhudWxsIC8qIGhvc3RQcmVmaXggKi8pO1xufTtcblxuXG4vKipcbiAqIFVzZXMgWE1MSFRUUCB0byBzZW5kIGFuIEhUVFAgR0VUIHRvIHRoZSBzZXJ2ZXIuXG4gKlxuICogQHBhcmFtIHtnb29nLlVyaX0gdXJpICBUaGUgdXJpIG9mIHRoZSByZXF1ZXN0LlxuICogQHBhcmFtIHtib29sZWFufSBkZWNvZGVDaHVua3MgIFdoZXRoZXIgdG8gdGhlIHJlc3VsdCBpcyBleHBlY3RlZCB0byBiZVxuICogICAgIGVuY29kZWQgZm9yIGNodW5raW5nIGFuZCB0aHVzIHJlcXVpcmVzIGRlY29kaW5nLlxuICogQHBhcmFtIHs/c3RyaW5nfSBob3N0UHJlZml4ICBUaGUgaG9zdCBwcmVmaXgsIGlmIHdlIG1pZ2h0IGJlIHVzaW5nIGFcbiAqICAgICBzZWNvbmRhcnkgZG9tYWluLiAgTm90ZSB0aGF0IGl0IHNob3VsZCBhbHNvIGJlIGluIHRoZSBVUkwsIGFkZGluZyB0aGlzXG4gKiAgICAgd29uJ3QgY2F1c2UgaXQgdG8gYmUgYWRkZWQgdG8gdGhlIFVSTC5cbiAqL1xuQ2hhbm5lbFJlcXVlc3QucHJvdG90eXBlLnhtbEh0dHBHZXQgPSBmdW5jdGlvbih1cmksIGRlY29kZUNodW5rcywgaG9zdFByZWZpeCkge1xuICAndXNlIHN0cmljdCc7XG4gIHRoaXMudHlwZV8gPSBDaGFubmVsUmVxdWVzdC5UeXBlXy5YTUxfSFRUUDtcbiAgdGhpcy5iYXNlVXJpXyA9IHVyaS5jbG9uZSgpLm1ha2VVbmlxdWUoKTtcbiAgdGhpcy5wb3N0RGF0YV8gPSBudWxsO1xuICB0aGlzLmRlY29kZUNodW5rc18gPSBkZWNvZGVDaHVua3M7XG5cbiAgdGhpcy5zZW5kWG1sSHR0cF8oaG9zdFByZWZpeCk7XG59O1xuXG5cbi8qKlxuICogU2VuZHMgYSByZXF1ZXN0IHZpYSBYTUxIVFRQIGFjY29yZGluZyB0byB0aGUgY3VycmVudCBzdGF0ZSBvZiB0aGUgcmVxdWVzdFxuICogb2JqZWN0LlxuICpcbiAqIEBwYXJhbSB7P3N0cmluZ30gaG9zdFByZWZpeCBUaGUgaG9zdCBwcmVmaXgsIGlmIHdlIG1pZ2h0IGJlIHVzaW5nIGEgc2Vjb25kYXJ5XG4gKiAgICAgZG9tYWluLlxuICogQHByaXZhdGVcbiAqL1xuQ2hhbm5lbFJlcXVlc3QucHJvdG90eXBlLnNlbmRYbWxIdHRwXyA9IGZ1bmN0aW9uKGhvc3RQcmVmaXgpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICB0aGlzLnJlcXVlc3RTdGFydFRpbWVfID0gRGF0ZS5ub3coKTtcbiAgdGhpcy5lbnN1cmVXYXRjaERvZ1RpbWVyXygpO1xuXG4gIC8vIGNsb25lIHRoZSBiYXNlIFVSSSB0byBjcmVhdGUgdGhlIHJlcXVlc3QgVVJJLiBUaGUgcmVxdWVzdCB1cmkgaGFzIHRoZVxuICAvLyBhdHRlbXB0IG51bWJlciBhcyBhIHBhcmFtZXRlciB3aGljaCBoZWxwcyBpbiBkZWJ1Z2dpbmcuXG4gIHRoaXMucmVxdWVzdFVyaV8gPSB0aGlzLmJhc2VVcmlfLmNsb25lKCk7XG4gIHRoaXMucmVxdWVzdFVyaV8uc2V0UGFyYW1ldGVyVmFsdWVzKCd0JywgdGhpcy5yZXRyeUlkXyk7XG5cbiAgLy8gc2VuZCB0aGUgcmVxdWVzdCBlaXRoZXIgYXMgYSBQT1NUIG9yIEdFVFxuICB0aGlzLnhtbEh0dHBDaHVua1N0YXJ0XyA9IDA7XG4gIGNvbnN0IHVzZVNlY29uZGFyeURvbWFpbnMgPSB0aGlzLmNoYW5uZWxfLnNob3VsZFVzZVNlY29uZGFyeURvbWFpbnMoKTtcbiAgdGhpcy5mZXRjaFJlc3BvbnNlU3RhdGVfID0gbmV3IEZldGNoUmVzcG9uc2VTdGF0ZSgpO1xuICAvLyBJZiB0aGUgcmVxdWVzdCBpcyBhIEdFVCByZXF1ZXN0LCBzdGFydCBhIGJhY2tjaGFubmVsIHRvIHRyYW5zZmVyIHN0cmVhbWluZ1xuICAvLyBkYXRhLiBOb3RlIHRoYXQgV2ViQ2hhbm5lbCBHRVQgcmVxdWVzdCBjYW4gYWxzbyBiZSB1c2VkIGZvciBjbG9zaW5nIHRoZVxuICAvLyBjaGFubmVsIGFzIGluIG1ldGhvZCBDaGFubmVsUmVxdWVzdCNzZW5kQ2xvc2VSZXF1ZXN0LlxuICAvLyBUaGUgc2Vjb25kIHBhcmFtZXRlciBvZiBDaGFubmVsI2NyZWF0ZVhocklvIGlzIEpTIG9ubHkuXG4gIHRoaXMueG1sSHR0cF8gPSB0aGlzLmNoYW5uZWxfLmNyZWF0ZVhocklvKFxuICAgICAgdXNlU2Vjb25kYXJ5RG9tYWlucyA/IGhvc3RQcmVmaXggOiBudWxsLCAhdGhpcy5wb3N0RGF0YV8pO1xuXG4gIGlmICh0aGlzLnJlYWR5U3RhdGVDaGFuZ2VUaHJvdHRsZU1zXyA+IDApIHtcbiAgICB0aGlzLnJlYWR5U3RhdGVDaGFuZ2VUaHJvdHRsZV8gPSBuZXcgZ29vZy5hc3luYy5UaHJvdHRsZShcbiAgICAgICAgZ29vZy5iaW5kKHRoaXMueG1sSHR0cEhhbmRsZXJfLCB0aGlzLCB0aGlzLnhtbEh0dHBfKSxcbiAgICAgICAgdGhpcy5yZWFkeVN0YXRlQ2hhbmdlVGhyb3R0bGVNc18pO1xuICB9XG5cbiAgdGhpcy5ldmVudEhhbmRsZXJfLmxpc3RlbihcbiAgICAgIHRoaXMueG1sSHR0cF8sIGdvb2cubmV0LkV2ZW50VHlwZS5SRUFEWV9TVEFURV9DSEFOR0UsXG4gICAgICB0aGlzLnJlYWR5U3RhdGVDaGFuZ2VIYW5kbGVyXyk7XG5cbiAgY29uc3QgaGVhZGVycyA9XG4gICAgICB0aGlzLmV4dHJhSGVhZGVyc18gPyBnb29nLm9iamVjdC5jbG9uZSh0aGlzLmV4dHJhSGVhZGVyc18pIDoge307XG4gIGlmICh0aGlzLnBvc3REYXRhXykge1xuICAgIGlmICghdGhpcy52ZXJiXykge1xuICAgICAgdGhpcy52ZXJiXyA9ICdQT1NUJztcbiAgICB9XG4gICAgaGVhZGVyc1snQ29udGVudC1UeXBlJ10gPSAnYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkJztcbiAgICB0aGlzLnhtbEh0dHBfLnNlbmQodGhpcy5yZXF1ZXN0VXJpXywgdGhpcy52ZXJiXywgdGhpcy5wb3N0RGF0YV8sIGhlYWRlcnMpO1xuICB9IGVsc2Uge1xuICAgIHRoaXMudmVyYl8gPSAnR0VUJztcbiAgICB0aGlzLnhtbEh0dHBfLnNlbmQodGhpcy5yZXF1ZXN0VXJpXywgdGhpcy52ZXJiXywgbnVsbCwgaGVhZGVycyk7XG4gIH1cbiAgcmVxdWVzdFN0YXRzLm5vdGlmeVNlcnZlclJlYWNoYWJpbGl0eUV2ZW50KFxuICAgICAgcmVxdWVzdFN0YXRzLlNlcnZlclJlYWNoYWJpbGl0eS5SRVFVRVNUX01BREUpO1xuICB0aGlzLmNoYW5uZWxEZWJ1Z18ueG1sSHR0cENoYW5uZWxSZXF1ZXN0KFxuICAgICAgdGhpcy52ZXJiXywgdGhpcy5yZXF1ZXN0VXJpXywgdGhpcy5yaWRfLCB0aGlzLnJldHJ5SWRfLCB0aGlzLnBvc3REYXRhXyk7XG59O1xuXG5cbi8qKlxuICogSGFuZGxlcyBhIHJlYWR5c3RhdGVjaGFuZ2UgZXZlbnQuXG4gKiBAcGFyYW0ge2dvb2cuZXZlbnRzLkV2ZW50fSBldnQgVGhlIGV2ZW50LlxuICogQHByaXZhdGVcbiAqL1xuQ2hhbm5lbFJlcXVlc3QucHJvdG90eXBlLnJlYWR5U3RhdGVDaGFuZ2VIYW5kbGVyXyA9IGZ1bmN0aW9uKGV2dCkge1xuICAndXNlIHN0cmljdCc7XG4gIGNvbnN0IHhociA9IC8qKiBAdHlwZSB7Z29vZy5uZXQuWGhySW99ICovIChldnQudGFyZ2V0KTtcbiAgY29uc3QgdGhyb3R0bGUgPSB0aGlzLnJlYWR5U3RhdGVDaGFuZ2VUaHJvdHRsZV87XG4gIGlmICh0aHJvdHRsZSAmJlxuICAgICAgeGhyLmdldFJlYWR5U3RhdGUoKSA9PSBnb29nLm5ldC5YbWxIdHRwLlJlYWR5U3RhdGUuSU5URVJBQ1RJVkUpIHtcbiAgICAvLyBPbmx5IHRocm90dGxlIGluIHRoZSBwYXJ0aWFsIGRhdGEgY2FzZS5cbiAgICB0aGlzLmNoYW5uZWxEZWJ1Z18uZGVidWcoJ1Rocm90dGxpbmcgcmVhZHlzdGF0ZWNoYW5nZS4nKTtcbiAgICB0aHJvdHRsZS5maXJlKCk7XG4gIH0gZWxzZSB7XG4gICAgLy8gSWYgd2UgaGF2ZW4ndCB0aHJvdHRsZWQsIGp1c3QgaGFuZGxlIHJlc3BvbnNlIGRpcmVjdGx5LlxuICAgIHRoaXMueG1sSHR0cEhhbmRsZXJfKHhocik7XG4gIH1cbn07XG5cblxuLyoqXG4gKiBYbWxIdHRwIGhhbmRsZXJcbiAqIEBwYXJhbSB7Z29vZy5uZXQuWGhySW99IHhtbGh0dHAgVGhlIFhocklvIG9iamVjdCBmb3IgdGhlIGN1cnJlbnQgcmVxdWVzdC5cbiAqIEBwcml2YXRlXG4gKi9cbkNoYW5uZWxSZXF1ZXN0LnByb3RvdHlwZS54bWxIdHRwSGFuZGxlcl8gPSBmdW5jdGlvbih4bWxodHRwKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmVxdWVzdFN0YXRzLm9uU3RhcnRFeGVjdXRpb24oKTtcblxuICB0cnkge1xuICAgIGlmICh4bWxodHRwID09IHRoaXMueG1sSHR0cF8pIHtcbiAgICAgIHRoaXMub25YbWxIdHRwUmVhZHlTdGF0ZUNoYW5nZWRfKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuY2hhbm5lbERlYnVnXy53YXJuaW5nKFxuICAgICAgICAgICdDYWxsZWQgYmFjayB3aXRoIGFuICcgK1xuICAgICAgICAgICd1bmV4cGVjdGVkIHhtbGh0dHAnKTtcbiAgICB9XG4gIH0gY2F0Y2ggKGV4KSB7XG4gICAgdGhpcy5jaGFubmVsRGVidWdfLmRlYnVnKCdGYWlsZWQgY2FsbCB0byBPblhtbEh0dHBSZWFkeVN0YXRlQ2hhbmdlZF8nKTtcbiAgICBpZiAodGhpcy5oYXNSZXNwb25zZUJvZHlfKCkpIHtcbiAgICAgIGNvbnN0IGNoYW5uZWxSZXF1ZXN0ID0gdGhpcztcbiAgICAgIHRoaXMuY2hhbm5lbERlYnVnXy5kdW1wRXhjZXB0aW9uKGV4LCBmdW5jdGlvbigpIHtcbiAgICAgICAgJ3VzZSBzdHJpY3QnO1xuICAgICAgICByZXR1cm4gJ1Jlc3BvbnNlVGV4dDogJyArIGNoYW5uZWxSZXF1ZXN0LnhtbEh0dHBfLmdldFJlc3BvbnNlVGV4dCgpO1xuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuY2hhbm5lbERlYnVnXy5kdW1wRXhjZXB0aW9uKGV4LCAnTm8gcmVzcG9uc2UgdGV4dCcpO1xuICAgIH1cbiAgfSBmaW5hbGx5IHtcbiAgICByZXF1ZXN0U3RhdHMub25FbmRFeGVjdXRpb24oKTtcbiAgfVxufTtcblxuXG4vKipcbiAqIENhbGxlZCBieSB0aGUgcmVhZHlzdGF0ZSBoYW5kbGVyIGZvciBYTUxIVFRQIHJlcXVlc3RzLlxuICpcbiAqIEBwcml2YXRlXG4gKi9cbkNoYW5uZWxSZXF1ZXN0LnByb3RvdHlwZS5vblhtbEh0dHBSZWFkeVN0YXRlQ2hhbmdlZF8gPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBjb25zdCByZWFkeVN0YXRlID0gdGhpcy54bWxIdHRwXy5nZXRSZWFkeVN0YXRlKCk7XG4gIGNvbnN0IGVycm9yQ29kZSA9IHRoaXMueG1sSHR0cF8uZ2V0TGFzdEVycm9yQ29kZSgpO1xuICBjb25zdCBzdGF0dXNDb2RlID0gdGhpcy54bWxIdHRwXy5nZXRTdGF0dXMoKTtcblxuICAvLyB3ZSBnZXQgcGFydGlhbCByZXN1bHRzIGluIGJyb3dzZXJzIHRoYXQgc3VwcG9ydCByZWFkeSBzdGF0ZSBpbnRlcmFjdGl2ZS5cbiAgLy8gV2UgYWxzbyBtYWtlIHN1cmUgdGhhdCBnZXRSZXNwb25zZVRleHQgaXMgbm90IG51bGwgaW4gaW50ZXJhY3RpdmUgbW9kZVxuICAvLyBiZWZvcmUgd2UgY29udGludWUuXG4gIGlmIChyZWFkeVN0YXRlIDwgZ29vZy5uZXQuWG1sSHR0cC5SZWFkeVN0YXRlLklOVEVSQUNUSVZFIHx8XG4gICAgICAocmVhZHlTdGF0ZSA9PSBnb29nLm5ldC5YbWxIdHRwLlJlYWR5U3RhdGUuSU5URVJBQ1RJVkUgJiZcbiAgICAgICAhZW52aXJvbm1lbnQuaXNQb2xsaW5nUmVxdWlyZWQoKSAmJiAgLy8gb3RoZXJ3aXNlLCBnbyBvbiB0byBzdGFydFBvbGxpbmdcbiAgICAgICAhdGhpcy5oYXNSZXNwb25zZUJvZHlfKCkpKSB7XG4gICAgcmV0dXJuOyAgLy8gbm90IHlldCByZWFkeVxuICB9XG5cbiAgLy8gRGlzcGF0Y2ggYW55IGFwcHJvcHJpYXRlIG5ldHdvcmsgZXZlbnRzLlxuICBpZiAoIXRoaXMuY2FuY2VsbGVkXyAmJiByZWFkeVN0YXRlID09IGdvb2cubmV0LlhtbEh0dHAuUmVhZHlTdGF0ZS5DT01QTEVURSAmJlxuICAgICAgZXJyb3JDb2RlICE9IGdvb2cubmV0LkVycm9yQ29kZS5BQk9SVCkge1xuICAgIC8vIFByZXR0eSBjb25zZXJ2YXRpdmUsIHRoZXNlIGFyZSB0aGUgb25seSBrbm93biBzY2VuYXJpb3Mgd2hpY2ggd2UnZFxuICAgIC8vIGNvbnNpZGVyIGluZGljYXRpdmUgb2YgYSB0cnVseSBub24tZnVuY3Rpb25hbCBuZXR3b3JrIGNvbm5lY3Rpb24uXG4gICAgaWYgKGVycm9yQ29kZSA9PSBnb29nLm5ldC5FcnJvckNvZGUuVElNRU9VVCB8fCBzdGF0dXNDb2RlIDw9IDApIHtcbiAgICAgIHJlcXVlc3RTdGF0cy5ub3RpZnlTZXJ2ZXJSZWFjaGFiaWxpdHlFdmVudChcbiAgICAgICAgICByZXF1ZXN0U3RhdHMuU2VydmVyUmVhY2hhYmlsaXR5LlJFUVVFU1RfRkFJTEVEKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmVxdWVzdFN0YXRzLm5vdGlmeVNlcnZlclJlYWNoYWJpbGl0eUV2ZW50KFxuICAgICAgICAgIHJlcXVlc3RTdGF0cy5TZXJ2ZXJSZWFjaGFiaWxpdHkuUkVRVUVTVF9TVUNDRUVERUQpO1xuICAgIH1cbiAgfVxuXG4gIC8vIGdvdCBzb21lIGRhdGEgc28gY2FuY2VsIHRoZSB3YXRjaGRvZyB0aW1lclxuICB0aGlzLmNhbmNlbFdhdGNoRG9nVGltZXJfKCk7XG5cbiAgY29uc3Qgc3RhdHVzID0gdGhpcy54bWxIdHRwXy5nZXRTdGF0dXMoKTtcbiAgdGhpcy5sYXN0U3RhdHVzQ29kZV8gPSBzdGF0dXM7XG4gIGNvbnN0IHJlc3BvbnNlVGV4dCA9IHRoaXMuZGVjb2RlWG1sSHR0cFJlc3BvbnNlXygpO1xuXG4gIGlmICghdGhpcy5oYXNSZXNwb25zZUJvZHlfKCkpIHtcbiAgICBjb25zdCBjaGFubmVsUmVxdWVzdCA9IHRoaXM7XG4gICAgdGhpcy5jaGFubmVsRGVidWdfLmRlYnVnKGZ1bmN0aW9uKCkge1xuICAgICAgJ3VzZSBzdHJpY3QnO1xuICAgICAgcmV0dXJuICdObyByZXNwb25zZSB0ZXh0IGZvciB1cmkgJyArIGNoYW5uZWxSZXF1ZXN0LnJlcXVlc3RVcmlfICtcbiAgICAgICAgICAnIHN0YXR1cyAnICsgc3RhdHVzO1xuICAgIH0pO1xuICB9XG4gIHRoaXMuc3VjY2Vzc2Z1bF8gPSAoc3RhdHVzID09IDIwMCk7XG5cbiAgdGhpcy5jaGFubmVsRGVidWdfLnhtbEh0dHBDaGFubmVsUmVzcG9uc2VNZXRhRGF0YShcbiAgICAgIC8qKiBAdHlwZSB7c3RyaW5nfSAqLyAodGhpcy52ZXJiXyksIHRoaXMucmVxdWVzdFVyaV8sIHRoaXMucmlkXyxcbiAgICAgIHRoaXMucmV0cnlJZF8sIHJlYWR5U3RhdGUsIHN0YXR1cyk7XG5cbiAgaWYgKCF0aGlzLnN1Y2Nlc3NmdWxfKSB7XG4gICAgaWYgKHN0YXR1cyA9PSA0MDAgJiYgcmVzcG9uc2VUZXh0LmluZGV4T2YoJ1Vua25vd24gU0lEJykgPiAwKSB7XG4gICAgICAvLyB0aGUgc2VydmVyIGVycm9yIHN0cmluZyB3aWxsIGluY2x1ZGUgJ1Vua25vd24gU0lEJyB3aGljaCBpbmRpY2F0ZXMgdGhlXG4gICAgICAvLyBzZXJ2ZXIgZG9lc24ndCBrbm93IGFib3V0IHRoZSBzZXNzaW9uIChtYXliZSBpdCBnb3QgcmVzdGFydGVkLCBtYXliZVxuICAgICAgLy8gdGhlIHVzZXIgZ290IG1vdmVkIHRvIGFub3RoZXIgc2VydmVyLCBldGMuLCkuIEhhbmRsZXJzIGNhbiBzcGVjaWFsXG4gICAgICAvLyBjYXNlIHRoaXMgZXJyb3JcbiAgICAgIHRoaXMubGFzdEVycm9yXyA9IENoYW5uZWxSZXF1ZXN0LkVycm9yLlVOS05PV05fU0VTU0lPTl9JRDtcbiAgICAgIHJlcXVlc3RTdGF0cy5ub3RpZnlTdGF0RXZlbnQoXG4gICAgICAgICAgcmVxdWVzdFN0YXRzLlN0YXQuUkVRVUVTVF9VTktOT1dOX1NFU1NJT05fSUQpO1xuICAgICAgdGhpcy5jaGFubmVsRGVidWdfLndhcm5pbmcoJ1hNTEhUVFAgVW5rbm93biBTSUQgKCcgKyB0aGlzLnJpZF8gKyAnKScpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmxhc3RFcnJvcl8gPSBDaGFubmVsUmVxdWVzdC5FcnJvci5TVEFUVVM7XG4gICAgICByZXF1ZXN0U3RhdHMubm90aWZ5U3RhdEV2ZW50KHJlcXVlc3RTdGF0cy5TdGF0LlJFUVVFU1RfQkFEX1NUQVRVUyk7XG4gICAgICB0aGlzLmNoYW5uZWxEZWJ1Z18ud2FybmluZyhcbiAgICAgICAgICAnWE1MSFRUUCBCYWQgc3RhdHVzICcgKyBzdGF0dXMgKyAnICgnICsgdGhpcy5yaWRfICsgJyknKTtcbiAgICB9XG4gICAgdGhpcy5jbGVhbnVwXygpO1xuICAgIHRoaXMuZGlzcGF0Y2hGYWlsdXJlXygpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGlmICh0aGlzLnNob3VsZENoZWNrSW5pdGlhbFJlc3BvbnNlXygpKSB7XG4gICAgY29uc3QgaW5pdGlhbFJlc3BvbnNlID0gdGhpcy5nZXRJbml0aWFsUmVzcG9uc2VfKCk7XG4gICAgaWYgKGluaXRpYWxSZXNwb25zZSkge1xuICAgICAgdGhpcy5jaGFubmVsRGVidWdfLnhtbEh0dHBDaGFubmVsUmVzcG9uc2VUZXh0KFxuICAgICAgICAgIHRoaXMucmlkXywgaW5pdGlhbFJlc3BvbnNlLFxuICAgICAgICAgICdJbml0aWFsIGhhbmRzaGFrZSByZXNwb25zZSB2aWEgJyArXG4gICAgICAgICAgICAgIFdlYkNoYW5uZWwuWF9IVFRQX0lOSVRJQUxfUkVTUE9OU0UpO1xuICAgICAgdGhpcy5pbml0aWFsUmVzcG9uc2VEZWNvZGVkXyA9IHRydWU7XG4gICAgICB0aGlzLnNhZmVPblJlcXVlc3REYXRhXyhpbml0aWFsUmVzcG9uc2UpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnN1Y2Nlc3NmdWxfID0gZmFsc2U7XG4gICAgICB0aGlzLmxhc3RFcnJvcl8gPSBDaGFubmVsUmVxdWVzdC5FcnJvci5VTktOT1dOX1NFU1NJT05fSUQ7ICAvLyBmYWlsLWZhc3RcbiAgICAgIHJlcXVlc3RTdGF0cy5ub3RpZnlTdGF0RXZlbnQoXG4gICAgICAgICAgcmVxdWVzdFN0YXRzLlN0YXQuUkVRVUVTVF9VTktOT1dOX1NFU1NJT05fSUQpO1xuICAgICAgdGhpcy5jaGFubmVsRGVidWdfLndhcm5pbmcoXG4gICAgICAgICAgJ1hNTEhUVFAgTWlzc2luZyBYX0hUVFBfSU5JVElBTF9SRVNQT05TRScgK1xuICAgICAgICAgICcgKCcgKyB0aGlzLnJpZF8gKyAnKScpO1xuICAgICAgdGhpcy5jbGVhbnVwXygpO1xuICAgICAgdGhpcy5kaXNwYXRjaEZhaWx1cmVfKCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICB9XG5cbiAgaWYgKHRoaXMuZGVjb2RlQ2h1bmtzXykge1xuICAgIHRoaXMuZGVjb2RlTmV4dENodW5rc18ocmVhZHlTdGF0ZSwgcmVzcG9uc2VUZXh0KTtcbiAgICBpZiAoZW52aXJvbm1lbnQuaXNQb2xsaW5nUmVxdWlyZWQoKSAmJiB0aGlzLnN1Y2Nlc3NmdWxfICYmXG4gICAgICAgIHJlYWR5U3RhdGUgPT0gZ29vZy5uZXQuWG1sSHR0cC5SZWFkeVN0YXRlLklOVEVSQUNUSVZFKSB7XG4gICAgICB0aGlzLnN0YXJ0UG9sbGluZ18oKTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgdGhpcy5jaGFubmVsRGVidWdfLnhtbEh0dHBDaGFubmVsUmVzcG9uc2VUZXh0KFxuICAgICAgICB0aGlzLnJpZF8sIHJlc3BvbnNlVGV4dCwgbnVsbCk7XG4gICAgdGhpcy5zYWZlT25SZXF1ZXN0RGF0YV8ocmVzcG9uc2VUZXh0KTtcbiAgfVxuXG4gIGlmIChyZWFkeVN0YXRlID09IGdvb2cubmV0LlhtbEh0dHAuUmVhZHlTdGF0ZS5DT01QTEVURSkge1xuICAgIHRoaXMuY2xlYW51cF8oKTtcbiAgfVxuXG4gIGlmICghdGhpcy5zdWNjZXNzZnVsXykge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGlmICghdGhpcy5jYW5jZWxsZWRfKSB7XG4gICAgaWYgKHJlYWR5U3RhdGUgPT0gZ29vZy5uZXQuWG1sSHR0cC5SZWFkeVN0YXRlLkNPTVBMRVRFKSB7XG4gICAgICB0aGlzLmNoYW5uZWxfLm9uUmVxdWVzdENvbXBsZXRlKHRoaXMpO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBUaGUgZGVmYXVsdCBpcyBmYWxzZSwgdGhlIHJlc3VsdCBmcm9tIHRoaXMgY2FsbGJhY2sgc2hvdWxkbid0IGNhcnJ5XG4gICAgICAvLyBvdmVyIHRvIHRoZSBuZXh0IGNhbGxiYWNrLCBvdGhlcndpc2UgdGhlIHJlcXVlc3QgbG9va3Mgc3VjY2Vzc2Z1bCBpZlxuICAgICAgLy8gdGhlIHdhdGNoZG9nIHRpbWVyIGdldHMgY2FsbGVkXG4gICAgICB0aGlzLnN1Y2Nlc3NmdWxfID0gZmFsc2U7XG4gICAgICB0aGlzLmVuc3VyZVdhdGNoRG9nVGltZXJfKCk7XG4gICAgfVxuICB9XG59O1xuXG5cbi8qKlxuICogV2hldGhlciB3ZSBuZWVkIGNoZWNrIHRoZSBpbml0aWFsLXJlc3BvbnNlIGhlYWRlciB0aGF0IGlzIHNlbnQgZHVyaW5nIHRoZVxuICogZmFzdCBoYW5kc2hha2UuXG4gKlxuICogQHJldHVybiB7Ym9vbGVhbn0gdHJ1ZSBpZiB0aGUgaW5pdGlhbC1yZXNwb25zZSBoZWFkZXIgaXMgeWV0IHRvIGJlIHByb2Nlc3NlZC5cbiAqIEBwcml2YXRlXG4gKi9cbkNoYW5uZWxSZXF1ZXN0LnByb3RvdHlwZS5zaG91bGRDaGVja0luaXRpYWxSZXNwb25zZV8gPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gdGhpcy5kZWNvZGVJbml0aWFsUmVzcG9uc2VfICYmICF0aGlzLmluaXRpYWxSZXNwb25zZURlY29kZWRfO1xufTtcblxuXG4vKipcbiAqIFF1ZXJpZXMgdGhlIGluaXRpYWwgcmVzcG9uc2UgaGVhZGVyIHRoYXQgaXMgc2VudCBkdXJpbmcgdGhlIGhhbmRzaGFrZS5cbiAqXG4gKiBAcmV0dXJuIHs/c3RyaW5nfSBUaGUgbm9uLWVtcHR5IGhlYWRlciB2YWx1ZSBvciBudWxsLlxuICogQHByaXZhdGVcbiAqL1xuQ2hhbm5lbFJlcXVlc3QucHJvdG90eXBlLmdldEluaXRpYWxSZXNwb25zZV8gPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBpZiAodGhpcy54bWxIdHRwXykge1xuICAgIGNvbnN0IHZhbHVlID0gdGhpcy54bWxIdHRwXy5nZXRTdHJlYW1pbmdSZXNwb25zZUhlYWRlcihcbiAgICAgICAgV2ViQ2hhbm5lbC5YX0hUVFBfSU5JVElBTF9SRVNQT05TRSk7XG4gICAgaWYgKHZhbHVlICYmICFnb29nLnN0cmluZy5pc0VtcHR5T3JXaGl0ZXNwYWNlKHZhbHVlKSkge1xuICAgICAgcmV0dXJuIHZhbHVlO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBudWxsO1xufTtcblxuXG4vKipcbiAqIENoZWNrIGlmIHRoZSBpbml0aWFsIHJlc3BvbnNlIGhlYWRlciBoYXMgYmVlbiBoYW5kbGVkLlxuICpcbiAqIEByZXR1cm4ge2Jvb2xlYW59IHRydWUgaWYgWF9IVFRQX0lOSVRJQUxfUkVTUE9OU0UgaGFzIGJlZW4gaGFuZGxlZC5cbiAqL1xuQ2hhbm5lbFJlcXVlc3QucHJvdG90eXBlLmlzSW5pdGlhbFJlc3BvbnNlRGVjb2RlZCA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIHJldHVybiB0aGlzLmluaXRpYWxSZXNwb25zZURlY29kZWRfO1xufTtcblxuXG4vKipcbiAqIERlY29kZXMgWF9IVFRQX0lOSVRJQUxfUkVTUE9OU0UgaWYgcHJlc2VudC5cbiAqL1xuQ2hhbm5lbFJlcXVlc3QucHJvdG90eXBlLnNldERlY29kZUluaXRpYWxSZXNwb25zZSA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIHRoaXMuZGVjb2RlSW5pdGlhbFJlc3BvbnNlXyA9IHRydWU7XG59O1xuXG5cblxuLyoqXG4gKiBEZWNvZGVzIHRoZSByZXNwb25zZXMgZnJvbSBYaHJJbyBvYmplY3QuXG4gKiBAcmV0dXJucyB7c3RyaW5nfSByZXNwb25zZVRleHRcbiAqIEBwcml2YXRlXG4gKi9cbkNoYW5uZWxSZXF1ZXN0LnByb3RvdHlwZS5kZWNvZGVYbWxIdHRwUmVzcG9uc2VfID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgaWYgKCF0aGlzLnVzZUZldGNoU3RyZWFtc0ZvclJlc3BvbnNlXygpKSB7XG4gICAgcmV0dXJuIHRoaXMueG1sSHR0cF8uZ2V0UmVzcG9uc2VUZXh0KCk7XG4gIH1cbiAgY29uc3QgcmVzcG9uc2VDaHVua3MgPVxuICAgICAgLyoqIEB0eXBlIHshQXJyYXk8IVVpbnQ4QXJyYXk+fSAqLyAodGhpcy54bWxIdHRwXy5nZXRSZXNwb25zZSgpKTtcbiAgbGV0IHJlc3BvbnNlVGV4dCA9ICcnO1xuICBjb25zdCByZXNwb25zZUxlbmd0aCA9IHJlc3BvbnNlQ2h1bmtzLmxlbmd0aDtcbiAgY29uc3QgcmVxdWVzdENvbXBsZXRlZCA9XG4gICAgICB0aGlzLnhtbEh0dHBfLmdldFJlYWR5U3RhdGUoKSA9PSBnb29nLm5ldC5YbWxIdHRwLlJlYWR5U3RhdGUuQ09NUExFVEU7XG4gIGlmICghdGhpcy5mZXRjaFJlc3BvbnNlU3RhdGVfLnRleHREZWNvZGVyKSB7XG4gICAgaWYgKHR5cGVvZiBUZXh0RGVjb2RlciA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIHRoaXMuY2hhbm5lbERlYnVnXy5zZXZlcmUoXG4gICAgICAgICAgJ1RleHREZWNvZGVyIGlzIG5vdCBzdXBwb3J0ZWQgYnkgdGhpcyBicm93c2VyLicpO1xuICAgICAgdGhpcy5jbGVhbnVwXygpO1xuICAgICAgdGhpcy5kaXNwYXRjaEZhaWx1cmVfKCk7XG4gICAgICByZXR1cm4gJyc7XG4gICAgfVxuICAgIHRoaXMuZmV0Y2hSZXNwb25zZVN0YXRlXy50ZXh0RGVjb2RlciA9IG5ldyBnb29nLmdsb2JhbC5UZXh0RGVjb2RlcigpO1xuICB9XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgcmVzcG9uc2VMZW5ndGg7IGkrKykge1xuICAgIHRoaXMuZmV0Y2hSZXNwb25zZVN0YXRlXy5yZXNwb25zZUFycml2ZWRGb3JGZXRjaCA9IHRydWU7XG4gICAgY29uc3QgaXNMYXN0Q2h1bmsgPSByZXF1ZXN0Q29tcGxldGVkICYmIGkgPT0gcmVzcG9uc2VMZW5ndGggLSAxO1xuICAgIHJlc3BvbnNlVGV4dCArPSB0aGlzLmZldGNoUmVzcG9uc2VTdGF0ZV8udGV4dERlY29kZXIuZGVjb2RlKFxuICAgICAgICByZXNwb25zZUNodW5rc1tpXSwge3N0cmVhbTogaXNMYXN0Q2h1bmt9KTtcbiAgfVxuICByZXNwb25zZUNodW5rcy5zcGxpY2UoMCwgcmVzcG9uc2VMZW5ndGgpO1xuICB0aGlzLmZldGNoUmVzcG9uc2VTdGF0ZV8ucmVzcG9uc2VCdWZmZXIgKz0gcmVzcG9uc2VUZXh0O1xuICB0aGlzLnhtbEh0dHBDaHVua1N0YXJ0XyA9IDA7XG4gIHJldHVybiB0aGlzLmZldGNoUmVzcG9uc2VTdGF0ZV8ucmVzcG9uc2VCdWZmZXI7XG59O1xuXG5cbi8qKlxuICogV2hldGhlciBvciBub3QgdGhlIHJlc3BvbnNlIGhhcyByZXNwb25zZSBib2R5LlxuICogQHByaXZhdGVcbiAqIEByZXR1cm5zIHtib29sZWFufVxuICovXG5DaGFubmVsUmVxdWVzdC5wcm90b3R5cGUuaGFzUmVzcG9uc2VCb2R5XyA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIGlmICghdGhpcy54bWxIdHRwXykge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICBpZiAodGhpcy5mZXRjaFJlc3BvbnNlU3RhdGVfLnJlc3BvbnNlQXJyaXZlZEZvckZldGNoKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgcmV0dXJuICEoIXRoaXMueG1sSHR0cF8uZ2V0UmVzcG9uc2VUZXh0KCkgJiYgIXRoaXMueG1sSHR0cF8uZ2V0UmVzcG9uc2UoKSk7XG59O1xuXG4vKipcbiAqIFdoZXRoZXIgb3Igbm90IHRoZSByZXNwb25zZSBib2R5IGlzIHN0cmVhbWVkLlxuICogQHByaXZhdGVcbiAqIEByZXR1cm5zIHtib29sZWFufVxuICovXG5DaGFubmVsUmVxdWVzdC5wcm90b3R5cGUudXNlRmV0Y2hTdHJlYW1zRm9yUmVzcG9uc2VfID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgaWYgKCF0aGlzLnhtbEh0dHBfKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIHJldHVybiAoXG4gICAgICB0aGlzLnZlcmJfID09ICdHRVQnICYmIHRoaXMudHlwZV8gIT0gQ2hhbm5lbFJlcXVlc3QuVHlwZV8uQ0xPU0VfUkVRVUVTVCAmJlxuICAgICAgdGhpcy5jaGFubmVsXy51c2VzRmV0Y2hTdHJlYW1zKCkpO1xufTtcblxuXG4vKipcbiAqIFJlc2V0cyB0aGUgcmVzcG9uc2UgYnVmZmVyIGlmIHRoZSBzYXZlZCBjaHVuayBoYXMgYmVlbiBwcm9jZXNzZWQuXG4gKiBAcHJpdmF0ZVxuICogQHBhcmFtIHtzdHJpbmd8IU9iamVjdHx1bmRlZmluZWR9IGNodW5rVGV4dFxuICovXG5DaGFubmVsUmVxdWVzdC5wcm90b3R5cGUubWF5YmVSZXNldEJ1ZmZlcl8gPSBmdW5jdGlvbihjaHVua1RleHQpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBpZiAodGhpcy51c2VGZXRjaFN0cmVhbXNGb3JSZXNwb25zZV8oKSAmJlxuICAgICAgY2h1bmtUZXh0ICE9IENoYW5uZWxSZXF1ZXN0LklOQ09NUExFVEVfQ0hVTktfICYmXG4gICAgICBjaHVua1RleHQgIT0gQ2hhbm5lbFJlcXVlc3QuSU5WQUxJRF9DSFVOS18pIHtcbiAgICB0aGlzLmZldGNoUmVzcG9uc2VTdGF0ZV8ucmVzcG9uc2VCdWZmZXIgPSAnJztcbiAgICB0aGlzLnhtbEh0dHBDaHVua1N0YXJ0XyA9IDA7XG4gIH1cbn07XG5cblxuLyoqXG4gKiBEZWNvZGVzIHRoZSBuZXh0IHNldCBvZiBhdmFpbGFibGUgY2h1bmtzIGluIHRoZSByZXNwb25zZS5cbiAqIEBwYXJhbSB7bnVtYmVyfSByZWFkeVN0YXRlIFRoZSB2YWx1ZSBvZiByZWFkeVN0YXRlLlxuICogQHBhcmFtIHtzdHJpbmd9IHJlc3BvbnNlVGV4dCBUaGUgdmFsdWUgb2YgcmVzcG9uc2VUZXh0LlxuICogQHByaXZhdGVcbiAqL1xuQ2hhbm5lbFJlcXVlc3QucHJvdG90eXBlLmRlY29kZU5leHRDaHVua3NfID0gZnVuY3Rpb24oXG4gICAgcmVhZHlTdGF0ZSwgcmVzcG9uc2VUZXh0KSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgbGV0IGRlY29kZU5leHRDaHVua3NTdWNjZXNzZnVsID0gdHJ1ZTtcblxuICBsZXQgY2h1bmtUZXh0O1xuICB3aGlsZSAoIXRoaXMuY2FuY2VsbGVkXyAmJiB0aGlzLnhtbEh0dHBDaHVua1N0YXJ0XyA8IHJlc3BvbnNlVGV4dC5sZW5ndGgpIHtcbiAgICBjaHVua1RleHQgPSB0aGlzLmdldE5leHRDaHVua18ocmVzcG9uc2VUZXh0KTtcbiAgICBpZiAoY2h1bmtUZXh0ID09IENoYW5uZWxSZXF1ZXN0LklOQ09NUExFVEVfQ0hVTktfKSB7XG4gICAgICBpZiAocmVhZHlTdGF0ZSA9PSBnb29nLm5ldC5YbWxIdHRwLlJlYWR5U3RhdGUuQ09NUExFVEUpIHtcbiAgICAgICAgLy8gc2hvdWxkIGhhdmUgY29uc3VtZWQgZW50aXJlIHJlc3BvbnNlIHdoZW4gdGhlIHJlcXVlc3QgaXMgZG9uZVxuICAgICAgICB0aGlzLmxhc3RFcnJvcl8gPSBDaGFubmVsUmVxdWVzdC5FcnJvci5CQURfREFUQTtcbiAgICAgICAgcmVxdWVzdFN0YXRzLm5vdGlmeVN0YXRFdmVudChyZXF1ZXN0U3RhdHMuU3RhdC5SRVFVRVNUX0lOQ09NUExFVEVfREFUQSk7XG4gICAgICAgIGRlY29kZU5leHRDaHVua3NTdWNjZXNzZnVsID0gZmFsc2U7XG4gICAgICB9XG4gICAgICB0aGlzLmNoYW5uZWxEZWJ1Z18ueG1sSHR0cENoYW5uZWxSZXNwb25zZVRleHQoXG4gICAgICAgICAgdGhpcy5yaWRfLCBudWxsLCAnW0luY29tcGxldGUgUmVzcG9uc2VdJyk7XG4gICAgICBicmVhaztcbiAgICB9IGVsc2UgaWYgKGNodW5rVGV4dCA9PSBDaGFubmVsUmVxdWVzdC5JTlZBTElEX0NIVU5LXykge1xuICAgICAgdGhpcy5sYXN0RXJyb3JfID0gQ2hhbm5lbFJlcXVlc3QuRXJyb3IuQkFEX0RBVEE7XG4gICAgICByZXF1ZXN0U3RhdHMubm90aWZ5U3RhdEV2ZW50KHJlcXVlc3RTdGF0cy5TdGF0LlJFUVVFU1RfQkFEX0RBVEEpO1xuICAgICAgdGhpcy5jaGFubmVsRGVidWdfLnhtbEh0dHBDaGFubmVsUmVzcG9uc2VUZXh0KFxuICAgICAgICAgIHRoaXMucmlkXywgcmVzcG9uc2VUZXh0LCAnW0ludmFsaWQgQ2h1bmtdJyk7XG4gICAgICBkZWNvZGVOZXh0Q2h1bmtzU3VjY2Vzc2Z1bCA9IGZhbHNlO1xuICAgICAgYnJlYWs7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuY2hhbm5lbERlYnVnXy54bWxIdHRwQ2hhbm5lbFJlc3BvbnNlVGV4dChcbiAgICAgICAgICB0aGlzLnJpZF8sIC8qKiBAdHlwZSB7c3RyaW5nfSAqLyAoY2h1bmtUZXh0KSwgbnVsbCk7XG4gICAgICB0aGlzLnNhZmVPblJlcXVlc3REYXRhXygvKiogQHR5cGUge3N0cmluZ30gKi8gKGNodW5rVGV4dCkpO1xuICAgIH1cbiAgfVxuXG4gIHRoaXMubWF5YmVSZXNldEJ1ZmZlcl8oY2h1bmtUZXh0KTtcblxuICBpZiAocmVhZHlTdGF0ZSA9PSBnb29nLm5ldC5YbWxIdHRwLlJlYWR5U3RhdGUuQ09NUExFVEUgJiZcbiAgICAgIHJlc3BvbnNlVGV4dC5sZW5ndGggPT0gMCAmJlxuICAgICAgIXRoaXMuZmV0Y2hSZXNwb25zZVN0YXRlXy5yZXNwb25zZUFycml2ZWRGb3JGZXRjaCkge1xuICAgIC8vIGFsc28gYW4gZXJyb3IgaWYgd2UgZGlkbid0IGdldCBhbnkgcmVzcG9uc2VcbiAgICB0aGlzLmxhc3RFcnJvcl8gPSBDaGFubmVsUmVxdWVzdC5FcnJvci5OT19EQVRBO1xuICAgIHJlcXVlc3RTdGF0cy5ub3RpZnlTdGF0RXZlbnQocmVxdWVzdFN0YXRzLlN0YXQuUkVRVUVTVF9OT19EQVRBKTtcbiAgICBkZWNvZGVOZXh0Q2h1bmtzU3VjY2Vzc2Z1bCA9IGZhbHNlO1xuICB9XG5cbiAgdGhpcy5zdWNjZXNzZnVsXyA9IHRoaXMuc3VjY2Vzc2Z1bF8gJiYgZGVjb2RlTmV4dENodW5rc1N1Y2Nlc3NmdWw7XG5cbiAgaWYgKCFkZWNvZGVOZXh0Q2h1bmtzU3VjY2Vzc2Z1bCkge1xuICAgIC8vIG1hbGZvcm1lZCByZXNwb25zZSAtIHdlIG1ha2UgdGhpcyB0cmlnZ2VyIHJldHJ5IGxvZ2ljXG4gICAgdGhpcy5jaGFubmVsRGVidWdfLnhtbEh0dHBDaGFubmVsUmVzcG9uc2VUZXh0KFxuICAgICAgICB0aGlzLnJpZF8sIHJlc3BvbnNlVGV4dCwgJ1tJbnZhbGlkIENodW5rZWQgUmVzcG9uc2VdJyk7XG4gICAgdGhpcy5jbGVhbnVwXygpO1xuICAgIHRoaXMuZGlzcGF0Y2hGYWlsdXJlXygpO1xuICB9IGVsc2Uge1xuICAgIGlmIChyZXNwb25zZVRleHQubGVuZ3RoID4gMCAmJiAhdGhpcy5maXJzdEJ5dGVSZWNlaXZlZF8pIHtcbiAgICAgIHRoaXMuZmlyc3RCeXRlUmVjZWl2ZWRfID0gdHJ1ZTtcbiAgICAgIHRoaXMuY2hhbm5lbF8ub25GaXJzdEJ5dGVSZWNlaXZlZCh0aGlzLCByZXNwb25zZVRleHQpO1xuICAgIH1cbiAgfVxufTtcblxuXG4vKipcbiAqIFBvbGxzIHRoZSByZXNwb25zZSBmb3IgbmV3IGRhdGEuXG4gKiBAcHJpdmF0ZVxuICovXG5DaGFubmVsUmVxdWVzdC5wcm90b3R5cGUucG9sbFJlc3BvbnNlXyA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIGlmICghdGhpcy54bWxIdHRwXykge1xuICAgIHJldHVybjsgIC8vIGFscmVhZHkgY2xvc2VkXG4gIH1cbiAgY29uc3QgcmVhZHlTdGF0ZSA9IHRoaXMueG1sSHR0cF8uZ2V0UmVhZHlTdGF0ZSgpO1xuICBjb25zdCByZXNwb25zZVRleHQgPSB0aGlzLnhtbEh0dHBfLmdldFJlc3BvbnNlVGV4dCgpO1xuICBpZiAodGhpcy54bWxIdHRwQ2h1bmtTdGFydF8gPCByZXNwb25zZVRleHQubGVuZ3RoKSB7XG4gICAgdGhpcy5jYW5jZWxXYXRjaERvZ1RpbWVyXygpO1xuICAgIHRoaXMuZGVjb2RlTmV4dENodW5rc18ocmVhZHlTdGF0ZSwgcmVzcG9uc2VUZXh0KTtcbiAgICBpZiAodGhpcy5zdWNjZXNzZnVsXyAmJlxuICAgICAgICByZWFkeVN0YXRlICE9IGdvb2cubmV0LlhtbEh0dHAuUmVhZHlTdGF0ZS5DT01QTEVURSkge1xuICAgICAgdGhpcy5lbnN1cmVXYXRjaERvZ1RpbWVyXygpO1xuICAgIH1cbiAgfVxufTtcblxuXG4vKipcbiAqIFN0YXJ0cyBhIHBvbGxpbmcgaW50ZXJ2YWwgZm9yIGNoYW5nZXMgdG8gcmVzcG9uc2VUZXh0IG9mIHRoZVxuICogWE1MSHR0cFJlcXVlc3QsIGZvciBicm93c2VycyB0aGF0IGRvbid0IGZpcmUgb25yZWFkeXN0YXRlY2hhbmdlXG4gKiBhcyBkYXRhIGNvbWVzIGluIGluY3JlbWVudGFsbHkuICBUaGlzIHRpbWVyIGlzIGRpc2FibGVkIGluXG4gKiBjbGVhbnVwXygpLlxuICogQHByaXZhdGVcbiAqL1xuQ2hhbm5lbFJlcXVlc3QucHJvdG90eXBlLnN0YXJ0UG9sbGluZ18gPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICB0aGlzLmV2ZW50SGFuZGxlcl8ubGlzdGVuKFxuICAgICAgdGhpcy5wb2xsaW5nVGltZXJfLCBnb29nLlRpbWVyLlRJQ0ssIHRoaXMucG9sbFJlc3BvbnNlXyk7XG4gIHRoaXMucG9sbGluZ1RpbWVyXy5zdGFydCgpO1xufTtcblxuXG4vKipcbiAqIFJldHVybnMgdGhlIG5leHQgY2h1bmsgb2YgYSBjaHVuay1lbmNvZGVkIHJlc3BvbnNlLiBUaGlzIGlzIG5vdCBzdGFuZGFyZFxuICogSFRUUCBjaHVua2VkIGVuY29kaW5nIGJlY2F1c2UgYnJvd3NlcnMgZG9uJ3QgZXhwb3NlIHRoZSBjaHVuayBib3VuZGFyaWVzIHRvXG4gKiB0aGUgYXBwbGljYXRpb24gdGhyb3VnaCBYTUxIVFRQLiBTbyB3ZSBoYXZlIGFuIGFkZGl0aW9uYWwgY2h1bmsgZW5jb2RpbmcgYXRcbiAqIHRoZSBhcHBsaWNhdGlvbiBsZXZlbCB0aGF0IGxldHMgdXMgdGVsbCB3aGVyZSB0aGUgYmVnaW5uaW5nIGFuZCBlbmQgb2ZcbiAqIGluZGl2aWR1YWwgcmVzcG9uc2VzIGFyZSBzbyB0aGF0IHdlIGNhbiBvbmx5IHRyeSB0byBldmFsIGEgY29tcGxldGUgSlMgYXJyYXkuXG4gKlxuICogVGhlIGVuY29kaW5nIGlzIHRoZSBzaXplIG9mIHRoZSBjaHVuayBlbmNvZGVkIGFzIGEgZGVjaW1hbCBzdHJpbmcgZm9sbG93ZWRcbiAqIGJ5IGEgbmV3bGluZSBmb2xsb3dlZCBieSB0aGUgZGF0YS5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gcmVzcG9uc2VUZXh0IFRoZSByZXNwb25zZSB0ZXh0IGZyb20gdGhlIFhNTEhUVFAgcmVzcG9uc2UuXG4gKiBAcmV0dXJuIHtzdHJpbmd8IU9iamVjdH0gVGhlIG5leHQgY2h1bmsgc3RyaW5nIG9yIGEgc2VudGluZWwgb2JqZWN0XG4gKiAgICAgICAgICAgICAgICAgICAgICAgICBpbmRpY2F0aW5nIGEgc3BlY2lhbCBjb25kaXRpb24uXG4gKiBAcHJpdmF0ZVxuICovXG5DaGFubmVsUmVxdWVzdC5wcm90b3R5cGUuZ2V0TmV4dENodW5rXyA9IGZ1bmN0aW9uKHJlc3BvbnNlVGV4dCkge1xuICAndXNlIHN0cmljdCc7XG4gIGNvbnN0IHNpemVTdGFydEluZGV4ID0gdGhpcy54bWxIdHRwQ2h1bmtTdGFydF87XG4gIGNvbnN0IHNpemVFbmRJbmRleCA9IHJlc3BvbnNlVGV4dC5pbmRleE9mKCdcXG4nLCBzaXplU3RhcnRJbmRleCk7XG4gIGlmIChzaXplRW5kSW5kZXggPT0gLTEpIHtcbiAgICByZXR1cm4gQ2hhbm5lbFJlcXVlc3QuSU5DT01QTEVURV9DSFVOS187XG4gIH1cblxuICBjb25zdCBzaXplQXNTdHJpbmcgPSByZXNwb25zZVRleHQuc3Vic3RyaW5nKHNpemVTdGFydEluZGV4LCBzaXplRW5kSW5kZXgpO1xuICBjb25zdCBzaXplID0gTnVtYmVyKHNpemVBc1N0cmluZyk7XG4gIGlmIChpc05hTihzaXplKSkge1xuICAgIHJldHVybiBDaGFubmVsUmVxdWVzdC5JTlZBTElEX0NIVU5LXztcbiAgfVxuXG4gIGNvbnN0IGNodW5rU3RhcnRJbmRleCA9IHNpemVFbmRJbmRleCArIDE7XG4gIGlmIChjaHVua1N0YXJ0SW5kZXggKyBzaXplID4gcmVzcG9uc2VUZXh0Lmxlbmd0aCkge1xuICAgIHJldHVybiBDaGFubmVsUmVxdWVzdC5JTkNPTVBMRVRFX0NIVU5LXztcbiAgfVxuXG4gIGNvbnN0IGNodW5rVGV4dCA9IHJlc3BvbnNlVGV4dC5zdWJzdHIoY2h1bmtTdGFydEluZGV4LCBzaXplKTtcbiAgdGhpcy54bWxIdHRwQ2h1bmtTdGFydF8gPSBjaHVua1N0YXJ0SW5kZXggKyBzaXplO1xuICByZXR1cm4gY2h1bmtUZXh0O1xufTtcblxuXG4vKipcbiAqIFVzZXMgYW4gSU1HIHRhZyBvciBuYXZpZ2F0b3Iuc2VuZEJlYWNvbiB0byBzZW5kIGFuIEhUVFAgZ2V0IHRvIHRoZSBzZXJ2ZXIuXG4gKlxuICogVGhpcyBpcyBvbmx5IGN1cnJlbnRseSB1c2VkIHRvIHRlcm1pbmF0ZSB0aGUgY29ubmVjdGlvbiwgYXMgYW4gSU1HIHRhZyBpc1xuICogdGhlIG1vc3QgcmVsaWFibGUgd2F5IHRvIHNlbmQgc29tZXRoaW5nIHRvIHRoZSBzZXJ2ZXIgd2hpbGUgdGhlIHBhZ2VcbiAqIGlzIGdldHRpbmcgdG9ybiBkb3duLlxuICpcbiAqIE5hdmlnYXRvci5zZW5kQmVhY29uIGlzIGF2YWlsYWJsZSBvbiBDaHJvbWUgYW5kIEZpcmVmb3ggYXMgYSBmb3JtYWxcbiAqIHNvbHV0aW9uIHRvIGVuc3VyZSBkZWxpdmVyeSB3aXRob3V0IGJsb2NraW5nIHdpbmRvdyBjbG9zZS4gU2VlXG4gKiBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9BUEkvTmF2aWdhdG9yL3NlbmRCZWFjb25cbiAqXG4gKiBGb3IgQ2hyb21lIEFwcHMsIHNlbmRCZWFjb24gaXMgYWx3YXlzIG5lY2Vzc2FyeSBkdWUgdG8gQ29udGVudCBTZWN1cml0eVxuICogUG9saWN5IChDU1ApIHZpb2xhdGlvbiBvZiB1c2luZyBhbiBJTUcgdGFnLlxuICpcbiAqIEZvciByZWFjdC1uYXRpdmUsIHdlIHVzZSB4aHIgdG8gc2VuZCB0aGUgYWN0dWFsIGNsb3NlIHJlcXVlc3QsIGFuZCBhc3N1bWVcbiAqIHRoZXJlIGlzIG5vIHBhZ2UtY2xvc2UgaXNzdWUgd2l0aCByZWFjdC1uYXRpdmUuXG4gKlxuICogQHBhcmFtIHtnb29nLlVyaX0gdXJpIFRoZSB1cmkgdG8gc2VuZCBhIHJlcXVlc3QgdG8uXG4gKi9cbkNoYW5uZWxSZXF1ZXN0LnByb3RvdHlwZS5zZW5kQ2xvc2VSZXF1ZXN0ID0gZnVuY3Rpb24odXJpKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgdGhpcy50eXBlXyA9IENoYW5uZWxSZXF1ZXN0LlR5cGVfLkNMT1NFX1JFUVVFU1Q7XG4gIHRoaXMuYmFzZVVyaV8gPSB1cmkuY2xvbmUoKS5tYWtlVW5pcXVlKCk7XG5cbiAgbGV0IHJlcXVlc3RTZW50ID0gZmFsc2U7XG5cbiAgaWYgKGdvb2cuZ2xvYmFsLm5hdmlnYXRvciAmJiBnb29nLmdsb2JhbC5uYXZpZ2F0b3Iuc2VuZEJlYWNvbikge1xuICAgIC8vIGVtcHR5IHN0cmluZyBib2R5IHRvIGF2b2lkIDQxMyBlcnJvciBvbiBjaHJvbWUgPCA0MVxuICAgIHJlcXVlc3RTZW50ID1cbiAgICAgICAgZ29vZy5nbG9iYWwubmF2aWdhdG9yLnNlbmRCZWFjb24odGhpcy5iYXNlVXJpXy50b1N0cmluZygpLCAnJyk7XG4gIH1cblxuICBpZiAoIXJlcXVlc3RTZW50ICYmIGdvb2cuZ2xvYmFsLkltYWdlKSB7XG4gICAgY29uc3QgZWx0SW1nID0gbmV3IEltYWdlKCk7XG4gICAgZWx0SW1nLnNyYyA9IHRoaXMuYmFzZVVyaV87XG4gICAgcmVxdWVzdFNlbnQgPSB0cnVlO1xuICB9XG5cbiAgaWYgKCFyZXF1ZXN0U2VudCkge1xuICAgIC8vIG5vIGhhbmRsZXIgaXMgc2V0IHRvIG1hdGNoIHRoZSBzZW5kQmVhY29uL0ltYWdlIGJlaGF2aW9yXG4gICAgdGhpcy54bWxIdHRwXyA9IHRoaXMuY2hhbm5lbF8uY3JlYXRlWGhySW8obnVsbCk7XG4gICAgdGhpcy54bWxIdHRwXy5zZW5kKHRoaXMuYmFzZVVyaV8pO1xuICB9XG5cbiAgdGhpcy5yZXF1ZXN0U3RhcnRUaW1lXyA9IERhdGUubm93KCk7XG4gIHRoaXMuZW5zdXJlV2F0Y2hEb2dUaW1lcl8oKTtcbn07XG5cblxuLyoqXG4gKiBDYW5jZWxzIHRoZSByZXF1ZXN0IG5vIG1hdHRlciB3aGF0IHRoZSB1bmRlcmx5aW5nIHRyYW5zcG9ydCBpcy5cbiAqL1xuQ2hhbm5lbFJlcXVlc3QucHJvdG90eXBlLmNhbmNlbCA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIHRoaXMuY2FuY2VsbGVkXyA9IHRydWU7XG4gIHRoaXMuY2xlYW51cF8oKTtcbn07XG5cblxuLyoqXG4gKiBSZXNldHMgdGhlIHRpbWVvdXQuXG4gKlxuICogQHBhcmFtIHtudW1iZXI9fSBvcHRfdGltZW91dCBUaGUgbmV3IHRpbWVvdXRcbiAqL1xuQ2hhbm5lbFJlcXVlc3QucHJvdG90eXBlLnJlc2V0VGltZW91dCA9IGZ1bmN0aW9uKG9wdF90aW1lb3V0KSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgaWYgKG9wdF90aW1lb3V0KSB7XG4gICAgdGhpcy5zZXRUaW1lb3V0KG9wdF90aW1lb3V0KTtcbiAgfVxuICAvLyByZXN0YXJ0IG9ubHkgaWYgYSB0aW1lciBpcyBjdXJyZW50bHkgc2V0XG4gIGlmICh0aGlzLndhdGNoRG9nVGltZXJJZF8pIHtcbiAgICB0aGlzLmNhbmNlbFdhdGNoRG9nVGltZXJfKCk7XG4gICAgdGhpcy5lbnN1cmVXYXRjaERvZ1RpbWVyXygpO1xuICB9XG59O1xuXG5cbi8qKlxuICogRW5zdXJlcyB0aGF0IHRoZXJlIGlzIHdhdGNoZG9nIHRpbWVvdXQgd2hpY2ggaXMgdXNlZCB0byBlbnN1cmUgdGhhdFxuICogdGhlIGNvbm5lY3Rpb24gY29tcGxldGVzIGluIHRpbWUuXG4gKlxuICogQHByaXZhdGVcbiAqL1xuQ2hhbm5lbFJlcXVlc3QucHJvdG90eXBlLmVuc3VyZVdhdGNoRG9nVGltZXJfID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgdGhpcy53YXRjaERvZ1RpbWVvdXRUaW1lXyA9IERhdGUubm93KCkgKyB0aGlzLnRpbWVvdXRfO1xuICB0aGlzLnN0YXJ0V2F0Y2hEb2dUaW1lcl8odGhpcy50aW1lb3V0Xyk7XG59O1xuXG5cbi8qKlxuICogU3RhcnRzIHRoZSB3YXRjaGRvZyB0aW1lciB3aGljaCBpcyB1c2VkIHRvIGVuc3VyZSB0aGF0IHRoZSBjb25uZWN0aW9uXG4gKiBjb21wbGV0ZXMgaW4gdGltZS5cbiAqIEBwYXJhbSB7bnVtYmVyfSB0aW1lIFRoZSBudW1iZXIgb2YgbWlsbGlzZWNvbmRzIHRvIHdhaXQuXG4gKiBAcHJpdmF0ZVxuICovXG5DaGFubmVsUmVxdWVzdC5wcm90b3R5cGUuc3RhcnRXYXRjaERvZ1RpbWVyXyA9IGZ1bmN0aW9uKHRpbWUpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBpZiAodGhpcy53YXRjaERvZ1RpbWVySWRfICE9IG51bGwpIHtcbiAgICAvLyBhc3NlcnRpb25cbiAgICB0aHJvdyBuZXcgRXJyb3IoJ1dhdGNoRG9nIHRpbWVyIG5vdCBudWxsJyk7XG4gIH1cbiAgdGhpcy53YXRjaERvZ1RpbWVySWRfID1cbiAgICAgIHJlcXVlc3RTdGF0cy5zZXRUaW1lb3V0KGdvb2cuYmluZCh0aGlzLm9uV2F0Y2hEb2dUaW1lb3V0XywgdGhpcyksIHRpbWUpO1xufTtcblxuXG4vKipcbiAqIENhbmNlbHMgdGhlIHdhdGNoZG9nIHRpbWVyIGlmIGl0IGhhcyBiZWVuIHN0YXJ0ZWQuXG4gKlxuICogQHByaXZhdGVcbiAqL1xuQ2hhbm5lbFJlcXVlc3QucHJvdG90eXBlLmNhbmNlbFdhdGNoRG9nVGltZXJfID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgaWYgKHRoaXMud2F0Y2hEb2dUaW1lcklkXykge1xuICAgIGdvb2cuZ2xvYmFsLmNsZWFyVGltZW91dCh0aGlzLndhdGNoRG9nVGltZXJJZF8pO1xuICAgIHRoaXMud2F0Y2hEb2dUaW1lcklkXyA9IG51bGw7XG4gIH1cbn07XG5cblxuLyoqXG4gKiBDYWxsZWQgd2hlbiB0aGUgd2F0Y2hkb2cgdGltZXIgaXMgdHJpZ2dlcmVkLiBJdCBhbHNvIGhhbmRsZXMgYSBjYXNlIHdoZXJlIGl0XG4gKiBpcyBjYWxsZWQgdG9vIGVhcmx5IHdoaWNoIHdlIHN1c3BlY3QgbWF5IGJlIGhhcHBlbmluZyBzb21ldGltZXNcbiAqIChub3Qgc3VyZSB3aHkpXG4gKlxuICogQHByaXZhdGVcbiAqL1xuQ2hhbm5lbFJlcXVlc3QucHJvdG90eXBlLm9uV2F0Y2hEb2dUaW1lb3V0XyA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIHRoaXMud2F0Y2hEb2dUaW1lcklkXyA9IG51bGw7XG4gIGNvbnN0IG5vdyA9IERhdGUubm93KCk7XG4gIGdvb2cuYXNzZXJ0cy5hc3NlcnQoXG4gICAgICB0aGlzLndhdGNoRG9nVGltZW91dFRpbWVfLCAnV2F0Y2hEb2cgdGltZW91dCB0aW1lIG1pc3Npbmc/Jyk7XG4gIGlmIChub3cgLSB0aGlzLndhdGNoRG9nVGltZW91dFRpbWVfID49IDApIHtcbiAgICB0aGlzLmhhbmRsZVRpbWVvdXRfKCk7XG4gIH0gZWxzZSB7XG4gICAgLy8gZ290IGNhbGxlZCB0b28gZWFybHkgZm9yIHNvbWUgcmVhc29uXG4gICAgdGhpcy5jaGFubmVsRGVidWdfLndhcm5pbmcoJ1dhdGNoRG9nIHRpbWVyIGNhbGxlZCB0b28gZWFybHknKTtcbiAgICB0aGlzLnN0YXJ0V2F0Y2hEb2dUaW1lcl8odGhpcy53YXRjaERvZ1RpbWVvdXRUaW1lXyAtIG5vdyk7XG4gIH1cbn07XG5cblxuLyoqXG4gKiBDYWxsZWQgd2hlbiB0aGUgcmVxdWVzdCBoYXMgYWN0dWFsbHkgdGltZWQgb3V0LiBXaWxsIGNsZWFudXAgYW5kIG5vdGlmeSB0aGVcbiAqIGNoYW5uZWwgb2YgdGhlIGZhaWx1cmUuXG4gKlxuICogQHByaXZhdGVcbiAqL1xuQ2hhbm5lbFJlcXVlc3QucHJvdG90eXBlLmhhbmRsZVRpbWVvdXRfID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgaWYgKHRoaXMuc3VjY2Vzc2Z1bF8pIHtcbiAgICAvLyBTaG91bGQgbmV2ZXIgaGFwcGVuLlxuICAgIHRoaXMuY2hhbm5lbERlYnVnXy5zZXZlcmUoXG4gICAgICAgICdSZWNlaXZlZCB3YXRjaGRvZyB0aW1lb3V0IGV2ZW4gdGhvdWdoIHJlcXVlc3QgbG9hZGVkIHN1Y2Nlc3NmdWxseScpO1xuICB9XG5cbiAgdGhpcy5jaGFubmVsRGVidWdfLnRpbWVvdXRSZXNwb25zZSh0aGlzLnJlcXVlc3RVcmlfKTtcblxuICAvLyBJTUcgb3IgU2VuZEJlYWNvbiByZXF1ZXN0cyBuZXZlciBub3RpY2UgaWYgdGhleSB3ZXJlIHN1Y2Nlc3NmdWwsXG4gIC8vIGFuZCBhbHdheXMgJ3RpbWUgb3V0Jy4gVGhpcyBmYWN0IHNheXMgbm90aGluZyBhYm91dCByZWFjaGFiaWxpdHkuXG4gIGlmICh0aGlzLnR5cGVfICE9IENoYW5uZWxSZXF1ZXN0LlR5cGVfLkNMT1NFX1JFUVVFU1QpIHtcbiAgICByZXF1ZXN0U3RhdHMubm90aWZ5U2VydmVyUmVhY2hhYmlsaXR5RXZlbnQoXG4gICAgICAgIHJlcXVlc3RTdGF0cy5TZXJ2ZXJSZWFjaGFiaWxpdHkuUkVRVUVTVF9GQUlMRUQpO1xuICAgIHJlcXVlc3RTdGF0cy5ub3RpZnlTdGF0RXZlbnQocmVxdWVzdFN0YXRzLlN0YXQuUkVRVUVTVF9USU1FT1VUKTtcbiAgfVxuXG4gIHRoaXMuY2xlYW51cF8oKTtcblxuICAvLyBTZXQgZXJyb3IgYW5kIGRpc3BhdGNoIGZhaWx1cmUuXG4gIC8vIFRoaXMgaXMgY2FsbGVkIGZvciBDTE9TRV9SRVFVRVNUIHRvbyB0byBlbnN1cmUgY2hhbm5lbF8ub25SZXF1ZXN0Q29tcGxldGUuXG4gIHRoaXMubGFzdEVycm9yXyA9IENoYW5uZWxSZXF1ZXN0LkVycm9yLlRJTUVPVVQ7XG4gIHRoaXMuZGlzcGF0Y2hGYWlsdXJlXygpO1xufTtcblxuXG4vKipcbiAqIE5vdGlmaWVzIHRoZSBjaGFubmVsIHRoYXQgdGhpcyByZXF1ZXN0IGZhaWxlZC5cbiAqIEBwcml2YXRlXG4gKi9cbkNoYW5uZWxSZXF1ZXN0LnByb3RvdHlwZS5kaXNwYXRjaEZhaWx1cmVfID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgaWYgKHRoaXMuY2hhbm5lbF8uaXNDbG9zZWQoKSB8fCB0aGlzLmNhbmNlbGxlZF8pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICB0aGlzLmNoYW5uZWxfLm9uUmVxdWVzdENvbXBsZXRlKHRoaXMpO1xufTtcblxuXG4vKipcbiAqIENsZWFucyB1cCB0aGUgb2JqZWN0cyB1c2VkIHRvIG1ha2UgdGhlIHJlcXVlc3QuIFRoaXMgZnVuY3Rpb24gaXNcbiAqIGlkZW1wb3RlbnQuXG4gKlxuICogQHByaXZhdGVcbiAqL1xuQ2hhbm5lbFJlcXVlc3QucHJvdG90eXBlLmNsZWFudXBfID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgdGhpcy5jYW5jZWxXYXRjaERvZ1RpbWVyXygpO1xuXG4gIGdvb2cuZGlzcG9zZSh0aGlzLnJlYWR5U3RhdGVDaGFuZ2VUaHJvdHRsZV8pO1xuICB0aGlzLnJlYWR5U3RhdGVDaGFuZ2VUaHJvdHRsZV8gPSBudWxsO1xuXG4gIC8vIFN0b3AgdGhlIHBvbGxpbmcgdGltZXIsIGlmIG5lY2Vzc2FyeS5cbiAgdGhpcy5wb2xsaW5nVGltZXJfLnN0b3AoKTtcblxuICAvLyBVbmhvb2sgYWxsIGV2ZW50IGhhbmRsZXJzLlxuICB0aGlzLmV2ZW50SGFuZGxlcl8ucmVtb3ZlQWxsKCk7XG5cbiAgaWYgKHRoaXMueG1sSHR0cF8pIHtcbiAgICAvLyBjbGVhciBvdXQgdGhpcy54bWxIdHRwXyBiZWZvcmUgYWJvcnRpbmcgc28gd2UgaGFuZGxlIGdldHRpbmcgcmVlbnRlcmVkXG4gICAgLy8gaW5zaWRlIGFib3J0XG4gICAgY29uc3QgeG1saHR0cCA9IHRoaXMueG1sSHR0cF87XG4gICAgdGhpcy54bWxIdHRwXyA9IG51bGw7XG4gICAgeG1saHR0cC5hYm9ydCgpO1xuICAgIHhtbGh0dHAuZGlzcG9zZSgpO1xuICB9XG59O1xuXG5cbi8qKlxuICogSW5kaWNhdGVzIHdoZXRoZXIgdGhlIHJlcXVlc3Qgd2FzIHN1Y2Nlc3NmdWwuIE9ubHkgdmFsaWQgYWZ0ZXIgdGhlIGhhbmRsZXJcbiAqIGlzIGNhbGxlZCB0byBpbmRpY2F0ZSBjb21wbGV0aW9uIG9mIHRoZSByZXF1ZXN0LlxuICpcbiAqIEByZXR1cm4ge2Jvb2xlYW59IFRydWUgaWYgdGhlIHJlcXVlc3Qgc3VjY2VlZGVkLlxuICovXG5DaGFubmVsUmVxdWVzdC5wcm90b3R5cGUuZ2V0U3VjY2VzcyA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIHJldHVybiB0aGlzLnN1Y2Nlc3NmdWxfO1xufTtcblxuXG4vKipcbiAqIElmIHRoZSByZXF1ZXN0IHdhcyBub3Qgc3VjY2Vzc2Z1bCwgcmV0dXJucyB0aGUgcmVhc29uLlxuICpcbiAqIEByZXR1cm4gez9DaGFubmVsUmVxdWVzdC5FcnJvcn0gIFRoZSBsYXN0IGVycm9yLlxuICovXG5DaGFubmVsUmVxdWVzdC5wcm90b3R5cGUuZ2V0TGFzdEVycm9yID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmV0dXJuIHRoaXMubGFzdEVycm9yXztcbn07XG5cblxuLyoqXG4gKiBSZXR1cm5zIHRoZSBzdGF0dXMgY29kZSBvZiB0aGUgbGFzdCByZXF1ZXN0LlxuICogQHJldHVybiB7bnVtYmVyfSBUaGUgc3RhdHVzIGNvZGUgb2YgdGhlIGxhc3QgcmVxdWVzdC5cbiAqL1xuQ2hhbm5lbFJlcXVlc3QucHJvdG90eXBlLmdldExhc3RTdGF0dXNDb2RlID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmV0dXJuIHRoaXMubGFzdFN0YXR1c0NvZGVfO1xufTtcblxuXG4vKipcbiAqIFJldHVybnMgdGhlIHNlc3Npb24gaWQgZm9yIHRoaXMgY2hhbm5lbC5cbiAqXG4gKiBAcmV0dXJuIHtzdHJpbmd8dW5kZWZpbmVkfSBUaGUgc2Vzc2lvbiBJRC5cbiAqL1xuQ2hhbm5lbFJlcXVlc3QucHJvdG90eXBlLmdldFNlc3Npb25JZCA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIHJldHVybiB0aGlzLnNpZF87XG59O1xuXG5cbi8qKlxuICogUmV0dXJucyB0aGUgcmVxdWVzdCBpZCBmb3IgdGhpcyByZXF1ZXN0LiBFYWNoIHJlcXVlc3QgaGFzIGEgdW5pcXVlIHJlcXVlc3RcbiAqIGlkIGFuZCB0aGUgcmVxdWVzdCBJRHMgYXJlIGEgc2VxdWVudGlhbCBpbmNyZWFzaW5nIGNvdW50LlxuICpcbiAqIEByZXR1cm4ge3N0cmluZ3xudW1iZXJ8dW5kZWZpbmVkfSBUaGUgcmVxdWVzdCBJRC5cbiAqL1xuQ2hhbm5lbFJlcXVlc3QucHJvdG90eXBlLmdldFJlcXVlc3RJZCA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIHJldHVybiB0aGlzLnJpZF87XG59O1xuXG5cbi8qKlxuICogUmV0dXJucyB0aGUgZGF0YSBmb3IgYSBwb3N0LCBpZiB0aGlzIHJlcXVlc3QgaXMgYSBwb3N0LlxuICpcbiAqIEByZXR1cm4gez9zdHJpbmd9IFRoZSBQT1NUIGRhdGEgcHJvdmlkZWQgYnkgdGhlIHJlcXVlc3QgaW5pdGlhdG9yLlxuICovXG5DaGFubmVsUmVxdWVzdC5wcm90b3R5cGUuZ2V0UG9zdERhdGEgPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gdGhpcy5wb3N0RGF0YV87XG59O1xuXG5cbi8qKlxuICogUmV0dXJucyB0aGUgWGhySW8gcmVxdWVzdCBvYmplY3QuXG4gKlxuICogQHJldHVybiB7P2dvb2cubmV0LlhocklvfSBBbnkgWGhySW8gcmVxdWVzdCBjcmVhdGVkIGZvciB0aGlzIG9iamVjdC5cbiAqL1xuQ2hhbm5lbFJlcXVlc3QucHJvdG90eXBlLmdldFhociA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIHJldHVybiB0aGlzLnhtbEh0dHBfO1xufTtcblxuXG4vKipcbiAqIFJldHVybnMgdGhlIHRpbWUgdGhhdCB0aGUgcmVxdWVzdCBzdGFydGVkLCBpZiBpdCBoYXMgc3RhcnRlZC5cbiAqXG4gKiBAcmV0dXJuIHs/bnVtYmVyfSBUaGUgdGltZSB0aGUgcmVxdWVzdCBzdGFydGVkLCBhcyByZXR1cm5lZCBieSBEYXRlLm5vdygpLlxuICovXG5DaGFubmVsUmVxdWVzdC5wcm90b3R5cGUuZ2V0UmVxdWVzdFN0YXJ0VGltZSA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIHJldHVybiB0aGlzLnJlcXVlc3RTdGFydFRpbWVfO1xufTtcblxuXG4vKipcbiAqIEhlbHBlciB0byBjYWxsIHRoZSBjYWxsYmFjaydzIG9uUmVxdWVzdERhdGEsIHdoaWNoIGNhdGNoZXMgYW55XG4gKiBleGNlcHRpb24uXG4gKiBAcGFyYW0ge3N0cmluZ30gZGF0YSBUaGUgcmVxdWVzdCBkYXRhLlxuICogQHByaXZhdGVcbiAqL1xuQ2hhbm5lbFJlcXVlc3QucHJvdG90eXBlLnNhZmVPblJlcXVlc3REYXRhXyA9IGZ1bmN0aW9uKGRhdGEpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICB0cnkge1xuICAgIHRoaXMuY2hhbm5lbF8ub25SZXF1ZXN0RGF0YSh0aGlzLCBkYXRhKTtcbiAgICBjb25zdCBzdGF0cyA9IHJlcXVlc3RTdGF0cy5TZXJ2ZXJSZWFjaGFiaWxpdHk7XG4gICAgcmVxdWVzdFN0YXRzLm5vdGlmeVNlcnZlclJlYWNoYWJpbGl0eUV2ZW50KHN0YXRzLkJBQ0tfQ0hBTk5FTF9BQ1RJVklUWSk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICAvLyBEdW1wIGRlYnVnIGluZm8sIGJ1dCBrZWVwIGdvaW5nIHdpdGhvdXQgY2xvc2luZyB0aGUgY2hhbm5lbC5cbiAgICB0aGlzLmNoYW5uZWxEZWJ1Z18uZHVtcEV4Y2VwdGlvbihlLCAnRXJyb3IgaW4gaHR0cHJlcXVlc3QgY2FsbGJhY2snKTtcbiAgfVxufTtcblxuXG4vKipcbiAqIENvbnZlbmllbmNlIGZhY3RvcnkgbWV0aG9kLlxuICpcbiAqIEBwYXJhbSB7Q2hhbm5lbH0gY2hhbm5lbCBUaGUgY2hhbm5lbCBvYmplY3QgdGhhdCBvd25zIHRoaXMgcmVxdWVzdC5cbiAqIEBwYXJhbSB7V2ViQ2hhbm5lbERlYnVnfSBjaGFubmVsRGVidWcgQSBXZWJDaGFubmVsRGVidWcgdG8gdXNlIGZvciBsb2dnaW5nLlxuICogQHBhcmFtIHtzdHJpbmc9fSBvcHRfc2Vzc2lvbklkICBUaGUgc2Vzc2lvbiBpZCBmb3IgdGhlIGNoYW5uZWwuXG4gKiBAcGFyYW0ge3N0cmluZ3xudW1iZXI9fSBvcHRfcmVxdWVzdElkICBUaGUgcmVxdWVzdCBpZCBmb3IgdGhpcyByZXF1ZXN0LlxuICogQHBhcmFtIHtudW1iZXI9fSBvcHRfcmV0cnlJZCAgVGhlIHJldHJ5IGlkIGZvciB0aGlzIHJlcXVlc3QuXG4gKiBAcmV0dXJuIHshQ2hhbm5lbFJlcXVlc3R9IFRoZSBjcmVhdGVkIGNoYW5uZWwgcmVxdWVzdC5cbiAqL1xuQ2hhbm5lbFJlcXVlc3QuY3JlYXRlQ2hhbm5lbFJlcXVlc3QgPSBmdW5jdGlvbihcbiAgICBjaGFubmVsLCBjaGFubmVsRGVidWcsIG9wdF9zZXNzaW9uSWQsIG9wdF9yZXF1ZXN0SWQsIG9wdF9yZXRyeUlkKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmV0dXJuIG5ldyBDaGFubmVsUmVxdWVzdChcbiAgICAgIGNoYW5uZWwsIGNoYW5uZWxEZWJ1Zywgb3B0X3Nlc3Npb25JZCwgb3B0X3JlcXVlc3RJZCwgb3B0X3JldHJ5SWQpO1xufTtcbn0pOyAgLy8gZ29vZy5zY29wZVxuIiwgIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCBUaGUgQ2xvc3VyZSBMaWJyYXJ5IEF1dGhvcnMuXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogQGZpbGVvdmVydmlldyBBIHNpbmdsZSBtb2R1bGUgdG8gZGVmaW5lIHVzZXItYWdlbnQgc3BlY2lmaWMgZW52aXJvbm1lbnRcbiAqIGRldGFpbHMuXG4gKlxuICovXG5cbmdvb2cubW9kdWxlKCdnb29nLmxhYnMubmV0LndlYkNoYW5uZWwuZW52aXJvbm1lbnQnKTtcblxuZ29vZy5tb2R1bGUuZGVjbGFyZUxlZ2FjeU5hbWVzcGFjZSgpO1xuXG52YXIgdXNlckFnZW50ID0gZ29vZy5yZXF1aXJlKCdnb29nLnVzZXJBZ2VudCcpO1xuXG5cbi8qKlxuICogVGhlIGRlZmF1bHQgcG9sbGluZyBpbnRlcnZhbCBpbiBtaWxsaXMgZm9yIEVkZ2UuXG4gKlxuICogQ3VycmVudGx5IG9uIGVkZ2UsIG5ldy1jaHVuayBldmVudHMgbWF5IGJlIG5vdCBiZSBmaXJlZCAoYXQgYWxsKSBpZiBhIG5ld1xuICogY2h1bmsgYXJyaXZlcyB3aXRoaW4gNTBtcyBmb2xsb3dpbmcgdGhlIHByZXZpb3VzIGNodW5rLiBUaGlzIG1heSBiZSBmaXhlZFxuICogaW4gZnV0dXJlLCB3aGljaCByZXF1aXJlcyBjaGFuZ2VzIHRvIHRoZSB3aGF0d2cgc3BlYyB0b28uXG4gKlxuICogQHByaXZhdGUgQGNvbnN0IHtudW1iZXJ9XG4gKi9cbnZhciBFREdFX1BPTExJTkdfSU5URVJWQUxfID0gMTI1O1xuXG5cbi8qKlxuICogSGlzdG9yeTpcbiAqXG4gKiBJRTExIGlzIHN0aWxsIHVzaW5nIFRyaWRlbnQsIHRoZSB0cmFkaXRpb25hbCBlbmdpbmUgZm9yIElFLlxuICogRWRnZSBpcyB1c2luZyBFZGdlSFRNTCwgYSBmb3JrIG9mIFRyaWRlbnQuIFdlIGFyZSBzZWVpbmcgdGhlIHNhbWUgaXNzdWVcbiAqIG9uIElFLTExIChyZXBvcnRlZCBpbiAyMDE3KSwgc28gdHJlYXQgSUUgdGhlIHNhbWUgYXMgRWRnZSBmb3Igbm93LlxuICpcbiAqIFdlIHVzZWQgdG8gZG8gcG9sbGluZyBmb3IgT3BlcmEgKG9ubHkpIHdpdGggYW4gMjUwbXMgaW50ZXJ2YWwsIGJlY2F1c2UgT3BlcmFcbiAqIG9ubHkgZmlyZXMgcmVhZHlTdGF0ZSA9PSBJTlRFUkFDVElWRSBvbmNlLiBPcGVyYSBzd2l0Y2hlZCB0byBXZWJLaXQgaW4gMjAxMyxcbiAqIGFuZCB0aGVuIHRvIEJsaW5rIChjaHJvbWUpLlxuICpcbiAqIFRPRE8odXNlcik6IGNoZWNrIHRoZSByYXcgVUEgc3RyaW5nIHRvIGtlZXAgcG9sbGluZyBmb3Igb2xkLCBtb2JpbGUgb3BlcmFzXG4gKiB0aGF0IG1heSBzdGlsbCBiZSBhZmZlY3RlZC4gRm9yIG9sZCBPcGVyYSwgZG91YmxlIHRoZSBwb2xsaW5nIGludGVydmFsXG4gKiB0byAyNTBtcy5cbiAqXG4gKiBAcmV0dXJuIHtib29sZWFufSBUcnVlIGlmIHBvbGxpbmcgaXMgcmVxdWlyZWQgd2l0aCBYSFIuXG4gKi9cbmV4cG9ydHMuaXNQb2xsaW5nUmVxdWlyZWQgPSBmdW5jdGlvbigpIHtcbiAgcmV0dXJuIHVzZXJBZ2VudC5FREdFX09SX0lFO1xufTtcblxuXG4vKipcbiAqIEhvdyBvZnRlbiB0byBwb2xsIChpbiBNUykgZm9yIGNoYW5nZXMgdG8gcmVzcG9uc2VUZXh0IGluIGJyb3dzZXJzIHRoYXQgZG9uJ3RcbiAqIGZpcmUgb25yZWFkeXN0YXRlY2hhbmdlIGR1cmluZyBpbmNyZW1lbnRhbCBsb2FkaW5nIG9mIHRoZSByZXNwb25zZSBib2R5LlxuICpcbiAqIEByZXR1cm4ge251bWJlcnx1bmRlZmluZWR9IFRoZSBwb2xsaW5nIGludGVydmFsIChNUykgZm9yIHRoZSBjdXJyZW50IFUtQTtcbiAqIG9yIHVuZGVmaW5lZCBpZiBwb2xsaW5nIGlzIG5vdCBzdXBwb3NlZCB0byBiZSBlbmFibGVkLlxuICovXG5leHBvcnRzLmdldFBvbGxpbmdJbnRlcnZhbCA9IGZ1bmN0aW9uKCkge1xuICBpZiAodXNlckFnZW50LkVER0VfT1JfSUUpIHtcbiAgICByZXR1cm4gRURHRV9QT0xMSU5HX0lOVEVSVkFMXztcbiAgfVxuXG4gIHJldHVybiB1bmRlZmluZWQ7XG59O1xuXG5cbi8qKlxuICogRm9yIEZldGNoL3VwbG9hZCBPVCwgbWFrZSB0aHJlZSByZXF1ZXN0cyBhZ2FpbnN0IHRoZSBzZXJ2ZXIgZW5kcG9pbnQuXG4gKiBQT1NUIHJlcXVlc3RzIGNvbnRhaW4gb25seSBkdW1teSBwYXlsb2FkLlxuICpcbiAqIGh0dHBzOi8vZGV2ZWxvcGVycy5jaHJvbWUuY29tL29yaWdpbnRyaWFscy8jL3ZpZXdfdHJpYWwvMzUyNDA2NjcwODQxNzQxMzEyMVxuICpcbiAqIDEpIGdvb2dsZS5jb20gdG9rZW5cbiAqXG4gKiBBMzI5b3pZaVRqVW1OejBFaDV3ZmZOTGlSamlWdEZCcHRLQnVsUDdVWVh4S1N1TVZWaFAzcFZubEhuYnJCZzJBTEVQZDYzYm9QWkFySFhnMytXbG1hZ2tBQUFCL2V5SnZjbWxuYVc0aU9pSm9kSFJ3Y3pvdkwyZHZiMmRzWlM1amIyMDZORFF6SWl3aVptVmhkSFZ5WlNJNklrWmxkR05vVlhCc2IyRmtVM1J5WldGdGFXNW5JaXdpWlhod2FYSjVJam94TmpBNE9USXpNakE0TENKcGMxTjFZbVJ2YldGcGJpSTZkSEoxWlN3aWFYTlVhR2x5WkZCaGNuUjVJanAwY25WbGZRPT1cbiAqXG4gKiAyKSBnb29nbGVhcGlzLmNvbSB0b2tlblxuICpcbiAqIFRvIGJlIHJlZ2lzdGVyZWQgYWZ0ZXIgMSkgaXMgZGVwbG95ZWQuXG4gKlxuICogaHR0cHM6Ly9kZXZlbG9wZXJzLmNocm9tZS5jb20vb3JpZ2ludHJpYWxzLyMvdHJpYWxzXG4gKlxuICogVGhpcyBmdW5jdGlvbiBpcyBleHBlY3RlZCB0byBiZSBjYWxsZWQgZnJvbSBiYWNrZ3JvdW5kIGR1cmluZyB0aGUgaGFuZHNoYWtlLlxuICogRXhjZXB0aW9ucyB3aWxsIGJlIGxvZ2dlZCBieSB0aGUgY2FsbGVyLlxuICpcbiAqIE5vIHN0YXRzIG9yIGxvZ3MgYXJlIGNvbGxlY3RlZCBvbiB0aGUgY2xpZW50LXNpZGUuIFRvIGJlIGRpc2FibGVkIG9uY2UgdGhlXG4gKiBPVCBpcyBleHBpcmVkLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBwYXRoIFRoZSBiYXNlIFVSTCBwYXRoIGZvciB0aGUgcmVxdWVzdHNcbiAqL1xuZXhwb3J0cy5zdGFydE9yaWdpblRyaWFscyA9IGZ1bmN0aW9uKHBhdGgpIHtcbiAgLy8gTkU6IG1heSBuZWVkIGNoZWNrIGlmIHBhdGggaGFzIGFscmVhZHkgY29udGFpbnMgcXVlcnkgcGFyYW1zP1xuXG4gIC8vIDFzdCByZXE6ICBwYXRoP290PTFcbiAgLy8gbm9uLXN0cmVhbWluZyB1cGxvYWQgcmVxdWVzdFxuXG4gIC8vIDJuZCByZXE6ICBwYXRoP290PTJcbiAgLy8gaDItb25seSBzdHJlYW1pbmcgdXBsb2FkIHJlcXVlc3RcblxuICAvLyAzcmQgcmVxOiAgcGF0aD9vdD0zXG4gIC8vIGgxLWFsbG93ZWQgc3RyZWFtaW5nIHVwbG9hZCByZXF1ZXN0XG5cbiAgLy8gRXhhbXBsZSBjYWxsaW5nIGEgQ2hyb21lIEFQSTpcbiAgLy8gZ29vZy5nbG9iYWwuY2hyb21lLmxvYWRUaW1lcygpLndhc0ZldGNoZWRWaWFTcGR5XG59OyIsICIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgVGhlIENsb3N1cmUgTGlicmFyeSBBdXRob3JzLlxuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIEBmaWxlb3ZlcnZpZXcgQmFzZSBXZWJDaGFubmVsIGltcGxlbWVudGF0aW9uLlxuICovXG5cblxuZ29vZy5wcm92aWRlKCdnb29nLmxhYnMubmV0LndlYkNoYW5uZWwuV2ViQ2hhbm5lbEJhc2UnKTtcblxuZ29vZy5yZXF1aXJlKCdnb29nLlVyaScpO1xuZ29vZy5yZXF1aXJlKCdnb29nLmFycmF5Jyk7XG5nb29nLnJlcXVpcmUoJ2dvb2cuYXNzZXJ0cycpO1xuZ29vZy5yZXF1aXJlKCdnb29nLmFzeW5jLnJ1bicpO1xuZ29vZy5yZXF1aXJlKCdnb29nLmpzb24nKTtcbmdvb2cucmVxdWlyZSgnZ29vZy5sYWJzLm5ldC53ZWJDaGFubmVsLkNoYW5uZWwnKTtcbmdvb2cucmVxdWlyZSgnZ29vZy5sYWJzLm5ldC53ZWJDaGFubmVsLkNoYW5uZWxSZXF1ZXN0Jyk7XG5nb29nLnJlcXVpcmUoJ2dvb2cubGFicy5uZXQud2ViQ2hhbm5lbC5Db25uZWN0aW9uU3RhdGUnKTtcbmdvb2cucmVxdWlyZSgnZ29vZy5sYWJzLm5ldC53ZWJDaGFubmVsLkZvcndhcmRDaGFubmVsUmVxdWVzdFBvb2wnKTtcbmdvb2cucmVxdWlyZSgnZ29vZy5sYWJzLm5ldC53ZWJDaGFubmVsLldlYkNoYW5uZWxEZWJ1ZycpO1xuZ29vZy5yZXF1aXJlKCdnb29nLmxhYnMubmV0LndlYkNoYW5uZWwuV2lyZScpO1xuZ29vZy5yZXF1aXJlKCdnb29nLmxhYnMubmV0LndlYkNoYW5uZWwuV2lyZVY4Jyk7XG5nb29nLnJlcXVpcmUoJ2dvb2cubGFicy5uZXQud2ViQ2hhbm5lbC5lbnZpcm9ubWVudCcpO1xuZ29vZy5yZXF1aXJlKCdnb29nLmxhYnMubmV0LndlYkNoYW5uZWwubmV0VXRpbHMnKTtcbmdvb2cucmVxdWlyZSgnZ29vZy5sYWJzLm5ldC53ZWJDaGFubmVsLnJlcXVlc3RTdGF0cycpO1xuZ29vZy5yZXF1aXJlKCdnb29nLm5ldC5GZXRjaFhtbEh0dHBGYWN0b3J5Jyk7XG5nb29nLnJlcXVpcmUoJ2dvb2cubmV0LldlYkNoYW5uZWwnKTtcbmdvb2cucmVxdWlyZSgnZ29vZy5uZXQuWGhySW8nKTtcbmdvb2cucmVxdWlyZSgnZ29vZy5uZXQuWG1sSHR0cEZhY3RvcnknKTtcbmdvb2cucmVxdWlyZSgnZ29vZy5uZXQucnBjLkh0dHBDb3JzJyk7XG5nb29nLnJlcXVpcmUoJ2dvb2cub2JqZWN0Jyk7XG5nb29nLnJlcXVpcmUoJ2dvb2cuc3RyaW5nJyk7XG5nb29nLnJlcXVpcmUoJ2dvb2cuc3RydWN0cycpO1xuZ29vZy5yZXF1aXJlVHlwZSgnZ29vZy5zdHJ1Y3RzLk1hcCcpO1xuXG5nb29nLnNjb3BlKGZ1bmN0aW9uKCkge1xuJ3VzZSBzdHJpY3QnO1xuY29uc3QgV2ViQ2hhbm5lbCA9IGdvb2cubmV0LldlYkNoYW5uZWw7XG5jb25zdCBDaGFubmVsUmVxdWVzdCA9IGdvb2cubGFicy5uZXQud2ViQ2hhbm5lbC5DaGFubmVsUmVxdWVzdDtcbmNvbnN0IENvbm5lY3Rpb25TdGF0ZSA9IGdvb2cubGFicy5uZXQud2ViQ2hhbm5lbC5Db25uZWN0aW9uU3RhdGU7XG5jb25zdCBGb3J3YXJkQ2hhbm5lbFJlcXVlc3RQb29sID1cbiAgICBnb29nLmxhYnMubmV0LndlYkNoYW5uZWwuRm9yd2FyZENoYW5uZWxSZXF1ZXN0UG9vbDtcbmNvbnN0IFdlYkNoYW5uZWxEZWJ1ZyA9IGdvb2cubGFicy5uZXQud2ViQ2hhbm5lbC5XZWJDaGFubmVsRGVidWc7XG5jb25zdCBXaXJlID0gZ29vZy5sYWJzLm5ldC53ZWJDaGFubmVsLldpcmU7XG5jb25zdCBXaXJlVjggPSBnb29nLmxhYnMubmV0LndlYkNoYW5uZWwuV2lyZVY4O1xuY29uc3QgZW52aXJvbm1lbnQgPSBnb29nLmxhYnMubmV0LndlYkNoYW5uZWwuZW52aXJvbm1lbnQ7XG5jb25zdCBuZXRVdGlscyA9IGdvb2cubGFicy5uZXQud2ViQ2hhbm5lbC5uZXRVdGlscztcbmNvbnN0IHJlcXVlc3RTdGF0cyA9IGdvb2cubGFicy5uZXQud2ViQ2hhbm5lbC5yZXF1ZXN0U3RhdHM7XG5cbmNvbnN0IGh0dHBDb3JzID0gZ29vZy5tb2R1bGUuZ2V0KCdnb29nLm5ldC5ycGMuSHR0cENvcnMnKTtcblxuLyoqXG4gKiBHZXRzIGFuIGludGVybmFsIGNoYW5uZWwgcGFyYW1ldGVyIGluIGEgdHlwZS1zYWZlIHdheS5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gcGFyYW1OYW1lIHRoZSBrZXkgb2YgdGhlIHBhcmFtZXRlciB0byBmZXRjaC5cbiAqIEBwYXJhbSB7IVR9IGRlZmF1bHRWYWx1ZSB0aGUgZGVmYXVsdCB2YWx1ZSB0byByZXR1cm5cbiAqIEBwYXJhbSB7IWdvb2cubmV0LldlYkNoYW5uZWwuT3B0aW9ucz19IG9wdGlvbnMgQ29uZmlndXJhdGlvbiBmb3IgdGhlXG4gKiAgICAgICAgV2ViQ2hhbm5lbCBpbnN0YW5jZS5cbiAqIEByZXR1cm4ge1R9XG4gKiBAdGVtcGxhdGUgVFxuICovXG5mdW5jdGlvbiBnZXRJbnRlcm5hbENoYW5uZWxQYXJhbShwYXJhbU5hbWUsIGRlZmF1bHRWYWx1ZSwgb3B0aW9ucykge1xuICBpZiAoIW9wdGlvbnMgfHwgIW9wdGlvbnMuaW50ZXJuYWxDaGFubmVsUGFyYW1zKSB7XG4gICAgcmV0dXJuIGRlZmF1bHRWYWx1ZTtcbiAgfVxuICByZXR1cm4gLyoqIEB0eXBlIHtUfSAqLyAob3B0aW9ucy5pbnRlcm5hbENoYW5uZWxQYXJhbXNbcGFyYW1OYW1lXSkgfHxcbiAgICAgIGRlZmF1bHRWYWx1ZTtcbn1cblxuLyoqXG4gKiBUaGlzIFdlYkNoYW5uZWwgaW1wbGVtZW50YXRpb24gaXMgYnJhbmNoZWQgb2ZmIGdvb2cubmV0LkJyb3dzZXJDaGFubmVsXG4gKiBmb3Igbm93LiBPbmdvaW5nIGNoYW5nZXMgdG8gZ29vZy5uZXQuQnJvd3NlckNoYW5uZWwgd2lsbCBiZSBiYWNrXG4gKiBwb3J0ZWQgdG8gdGhpcyBpbXBsZW1lbnRhdGlvbiBhcyBuZWVkZWQuXG4gKlxuICogQHBhcmFtIHshZ29vZy5uZXQuV2ViQ2hhbm5lbC5PcHRpb25zPX0gb3B0X29wdGlvbnMgQ29uZmlndXJhdGlvbiBmb3IgdGhlXG4gKiAgICAgICAgV2ViQ2hhbm5lbCBpbnN0YW5jZS5cbiAqIEBwYXJhbSB7bnVtYmVyPX0gb3B0X2NsaWVudFZlcnNpb24gQW4gYXBwbGljYXRpb24tc3BlY2lmaWMgdmVyc2lvbiBudW1iZXJcbiAqICAgICAgICB0aGF0IGlzIHNlbnQgdG8gdGhlIHNlcnZlciB3aGVuIGNvbm5lY3RlZC5cbiAqIEBwYXJhbSB7IUNvbm5lY3Rpb25TdGF0ZT19IG9wdF9jb25uIFByZXZpb3VzbHkgZGV0ZXJtaW5lZCBjb25uZWN0aW9uXG4gKiAgICAgICAgY29uZGl0aW9ucy5cbiAqIEBjb25zdHJ1Y3RvclxuICogQHN0cnVjdFxuICogQGltcGxlbWVudHMge2dvb2cubGFicy5uZXQud2ViQ2hhbm5lbC5DaGFubmVsfVxuICovXG5nb29nLmxhYnMubmV0LndlYkNoYW5uZWwuV2ViQ2hhbm5lbEJhc2UgPSBmdW5jdGlvbihcbiAgICBvcHRfb3B0aW9ucywgb3B0X2NsaWVudFZlcnNpb24sIG9wdF9jb25uKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgLyoqXG4gICAqIFRoZSBjbGllbnQgbGlicmFyeSB2ZXJzaW9uIChjYXBhYmlsaXRpZXMpLlxuICAgKiBAcHJpdmF0ZSB7bnVtYmVyfVxuICAgKi9cbiAgdGhpcy5jbGllbnRWZXJzaW9uXyA9IG9wdF9jbGllbnRWZXJzaW9uIHx8IDA7XG5cbiAgLyoqXG4gICAqIFRoZSBzZXJ2ZXIgbGlicmFyeSB2ZXJzaW9uIChjYXBhYmlsaXRpZXMpLlxuICAgKiBAcHJpdmF0ZSB7bnVtYmVyfVxuICAgKi9cbiAgdGhpcy5zZXJ2ZXJWZXJzaW9uXyA9IDA7XG5cblxuICAvKipcbiAgICogQW4gYXJyYXkgb2YgcXVldWVkIG1hcHMgdGhhdCBuZWVkIHRvIGJlIHNlbnQgdG8gdGhlIHNlcnZlci5cbiAgICogQHByaXZhdGUgeyFBcnJheTxXaXJlLlF1ZXVlZE1hcD59XG4gICAqL1xuICB0aGlzLm91dGdvaW5nTWFwc18gPSBbXTtcblxuICAvKipcbiAgICogVGhlIGNoYW5uZWwgZGVidWcgdXNlZCBmb3IgbG9nZ2luZ1xuICAgKiBAcHJpdmF0ZSB7IVdlYkNoYW5uZWxEZWJ1Z31cbiAgICovXG4gIHRoaXMuY2hhbm5lbERlYnVnXyA9IG5ldyBXZWJDaGFubmVsRGVidWcoKTtcblxuICAvKipcbiAgICogQ29ubmVjdGl2aXR5IHN0YXRlLlxuICAgKiBAcHJpdmF0ZSB7IUNvbm5lY3Rpb25TdGF0ZX1cbiAgICovXG4gIHRoaXMuY29ublN0YXRlXyA9IG9wdF9jb25uIHx8IG5ldyBDb25uZWN0aW9uU3RhdGUoKTtcblxuICAvKipcbiAgICogRXh0cmEgSFRUUCBoZWFkZXJzIHRvIGFkZCB0byBhbGwgdGhlIHJlcXVlc3RzIHNlbnQgdG8gdGhlIHNlcnZlci5cbiAgICogQHByaXZhdGUgez9PYmplY3R9XG4gICAqL1xuICB0aGlzLmV4dHJhSGVhZGVyc18gPSBudWxsO1xuXG4gIC8qKlxuICAgKiBFeHRyYSBIVFRQIGhlYWRlcnMgdG8gYWRkIHRvIHRoZSBpbml0IHJlcXVlc3Qocykgc2VudCB0byB0aGUgc2VydmVyLlxuICAgKiBAcHJpdmF0ZSB7P09iamVjdH1cbiAgICovXG4gIHRoaXMuaW5pdEhlYWRlcnNfID0gbnVsbDtcblxuICAvKipcbiAgICogQHByaXZhdGUgez9zdHJpbmd9IFRoZSBVUkwgcGFyYW0gbmFtZSB0byBvdmVyd3JpdGUgY3VzdG9tIEhUVFAgaGVhZGVyc1xuICAgKiB0byBieXBhc3MgQ09SUyBwcmVmbGlnaHQuXG4gICAqL1xuICB0aGlzLmh0dHBIZWFkZXJzT3ZlcndyaXRlUGFyYW1fID0gbnVsbDtcblxuICAvKipcbiAgICogRXh0cmEgcGFyYW1ldGVycyB0byBhZGQgdG8gYWxsIHRoZSByZXF1ZXN0cyBzZW50IHRvIHRoZSBzZXJ2ZXIuXG4gICAqIEBwcml2YXRlIHs/T2JqZWN0fVxuICAgKi9cbiAgdGhpcy5leHRyYVBhcmFtc18gPSBudWxsO1xuXG4gIC8qKlxuICAgKiBQYXJhbWV0ZXIgbmFtZSBmb3IgdGhlIGh0dHAgc2Vzc2lvbiBpZC5cbiAgICogQHByaXZhdGUgez9zdHJpbmd9XG4gICAqL1xuICB0aGlzLmh0dHBTZXNzaW9uSWRQYXJhbV8gPSBudWxsO1xuXG4gIC8qKlxuICAgKiBUaGUgaHR0cCBzZXNzaW9uIGlkLCB0byBiZSBzZW50IHdpdGggaHR0cFNlc3Npb25JZFBhcmFtXyB3aXRoIGVhY2hcbiAgICogcmVxdWVzdCBhZnRlciB0aGUgaW5pdGlhbCBoYW5kc2hha2UuXG4gICAqIEBwcml2YXRlIHs/c3RyaW5nfVxuICAgKi9cbiAgdGhpcy5odHRwU2Vzc2lvbklkXyA9IG51bGw7XG5cbiAgLyoqXG4gICAqIFRoZSBDaGFubmVsUmVxdWVzdCBvYmplY3QgZm9yIHRoZSBiYWNrY2hhbm5lbC5cbiAgICogQHByaXZhdGUgez9DaGFubmVsUmVxdWVzdH1cbiAgICovXG4gIHRoaXMuYmFja0NoYW5uZWxSZXF1ZXN0XyA9IG51bGw7XG5cbiAgLyoqXG4gICAqIFRoZSByZWxhdGl2ZSBwYXRoIChpbiB0aGUgY29udGV4dCBvZiB0aGUgcGFnZSBob3N0aW5nIHRoZSBicm93c2VyIGNoYW5uZWwpXG4gICAqIGZvciBtYWtpbmcgcmVxdWVzdHMgdG8gdGhlIHNlcnZlci5cbiAgICogQHByaXZhdGUgez9zdHJpbmd9XG4gICAqL1xuICB0aGlzLnBhdGhfID0gbnVsbDtcblxuICAvKipcbiAgICogVGhlIGFic29sdXRlIFVSSSBmb3IgdGhlIGZvcndhcmRjaGFubmVsIHJlcXVlc3QuXG4gICAqIEBwcml2YXRlIHs/Z29vZy5Vcml9XG4gICAqL1xuICB0aGlzLmZvcndhcmRDaGFubmVsVXJpXyA9IG51bGw7XG5cbiAgLyoqXG4gICAqIFRoZSBhYnNvbHV0ZSBVUkkgZm9yIHRoZSBiYWNrY2hhbm5lbCByZXF1ZXN0LlxuICAgKiBAcHJpdmF0ZSB7P2dvb2cuVXJpfVxuICAgKi9cbiAgdGhpcy5iYWNrQ2hhbm5lbFVyaV8gPSBudWxsO1xuXG4gIC8qKlxuICAgKiBBIHN1YmRvbWFpbiBwcmVmaXggZm9yIHVzaW5nIGEgc3ViZG9tYWluIGluIElFIGZvciB0aGUgYmFja2NoYW5uZWxcbiAgICogcmVxdWVzdHMuXG4gICAqIEBwcml2YXRlIHs/c3RyaW5nfVxuICAgKi9cbiAgdGhpcy5ob3N0UHJlZml4XyA9IG51bGw7XG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgd2UgYWxsb3cgdGhlIHVzZSBvZiBhIHN1YmRvbWFpbiBpbiBJRSBmb3IgdGhlIGJhY2tjaGFubmVsIHJlcXVlc3RzLlxuICAgKiBAcHJpdmF0ZSB7Ym9vbGVhbn1cbiAgICovXG4gIHRoaXMuYWxsb3dIb3N0UHJlZml4XyA9IHRydWU7XG5cbiAgLyoqXG4gICAqIFRoZSBuZXh0IGlkIHRvIHVzZSBmb3IgdGhlIFJJRCAocmVxdWVzdCBpZGVudGlmaWVyKSBwYXJhbWV0ZXIuIFRoaXNcbiAgICogaWRlbnRpZmllciB1bmlxdWVseSBpZGVudGlmaWVzIHRoZSBmb3J3YXJkIGNoYW5uZWwgcmVxdWVzdC5cbiAgICogQHByaXZhdGUge251bWJlcn1cbiAgICovXG4gIHRoaXMubmV4dFJpZF8gPSAwO1xuXG4gIC8qKlxuICAgKiBUaGUgaWQgdG8gdXNlIGZvciB0aGUgbmV4dCBvdXRnb2luZyBtYXAuIFRoaXMgaWRlbnRpZmllciB1bmlxdWVseVxuICAgKiBpZGVudGlmaWVzIGEgc2VudCBtYXAuXG4gICAqIEBwcml2YXRlIHtudW1iZXJ9XG4gICAqL1xuICB0aGlzLm5leHRNYXBJZF8gPSAwO1xuXG4gIC8qKlxuICAgKiBXaGV0aGVyIHRvIGZhaWwgZm9yd2FyZC1jaGFubmVsIHJlcXVlc3RzIGFmdGVyIG9uZSB0cnkgb3IgYSBmZXcgdHJpZXMuXG4gICAqIEBwcml2YXRlIHtib29sZWFufVxuICAgKi9cbiAgdGhpcy5mYWlsRmFzdF8gPSBnZXRJbnRlcm5hbENoYW5uZWxQYXJhbSgnZmFpbEZhc3QnLCBmYWxzZSwgb3B0X29wdGlvbnMpO1xuXG4gIC8qKlxuICAgKiBUaGUgaGFuZGxlciB0aGF0IHJlY2VpdmUgY2FsbGJhY2tzIGZvciBzdGF0ZSBjaGFuZ2VzIGFuZCBkYXRhLlxuICAgKiBAcHJpdmF0ZSB7P2dvb2cubGFicy5uZXQud2ViQ2hhbm5lbC5XZWJDaGFubmVsQmFzZS5IYW5kbGVyfVxuICAgKi9cbiAgdGhpcy5oYW5kbGVyXyA9IG51bGw7XG5cbiAgLyoqXG4gICAqIFRpbWVyIGlkZW50aWZpZXIgZm9yIGFzeW5jaHJvbm91c2x5IG1ha2luZyBhIGZvcndhcmQgY2hhbm5lbCByZXF1ZXN0LlxuICAgKiBUaGlzIGlzIHNldCB0byB0cnVlIGlmIHRoZSBmdW5jIGlzIHNjaGVkdWxlZCB3aXRoIGFzeW5jLnJ1biwgd2hpY2hcbiAgICogaXMgZXF1aXZhbGVudCB0byBzZXRUaW1lb3V0KDApLlxuICAgKiBAcHJpdmF0ZSB7P251bWJlcnw/Ym9vbGVhbn1cbiAgICovXG4gIHRoaXMuZm9yd2FyZENoYW5uZWxUaW1lcklkXyA9IG51bGw7XG5cbiAgLyoqXG4gICAqIFRpbWVyIGlkZW50aWZpZXIgZm9yIGFzeW5jaHJvbm91c2x5IG1ha2luZyBhIGJhY2sgY2hhbm5lbCByZXF1ZXN0LlxuICAgKiBAcHJpdmF0ZSB7P251bWJlcn1cbiAgICovXG4gIHRoaXMuYmFja0NoYW5uZWxUaW1lcklkXyA9IG51bGw7XG5cbiAgLyoqXG4gICAqIFRpbWVyIGlkZW50aWZpZXIgZm9yIHRoZSB0aW1lciB0aGF0IHdhaXRzIGZvciB1cyB0byByZXRyeSB0aGUgYmFja2NoYW5uZWxcbiAgICogaW4gdGhlIGNhc2Ugd2hlcmUgaXQgaXMgZGVhZCBhbmQgbm8gbG9uZ2VyIHJlY2VpdmluZyBkYXRhLlxuICAgKiBAcHJpdmF0ZSB7P251bWJlcn1cbiAgICovXG4gIHRoaXMuZGVhZEJhY2tDaGFubmVsVGltZXJJZF8gPSBudWxsO1xuXG4gIC8qKlxuICAgKiBXaGV0aGVyIHRoZSBjbGllbnQncyBuZXR3b3JrIGNvbmRpdGlvbnMgY2FuIHN1cHBvcnQgc3RyZWFtZWQgcmVzcG9uc2VzLlxuICAgKiBAcHJpdmF0ZSB7P2Jvb2xlYW59XG4gICAqL1xuICB0aGlzLmVuYWJsZVN0cmVhbWluZ18gPSBudWxsO1xuXG4gIC8qKlxuICAgKiBXaGV0aGVyIHN0cmVhbWluZyBtb2RlIGlzIGFsbG93ZWQuIEluIGNlcnRhaW4gZGVidWdnaW5nIHNpdHVhdGlvbnMsIGl0J3NcbiAgICogdXNlZnVsIHRvIGRpc2FibGUgdGhpcy5cbiAgICogQHByaXZhdGUge2Jvb2xlYW59XG4gICAqL1xuICB0aGlzLmFsbG93U3RyZWFtaW5nTW9kZV8gPSB0cnVlO1xuXG4gIC8qKlxuICAgKiBUaGUgYXJyYXkgaWRlbnRpZmllciBvZiB0aGUgbGFzdCBhcnJheSByZWNlaXZlZCBmcm9tIHRoZSBzZXJ2ZXIgZm9yIHRoZVxuICAgKiBiYWNrY2hhbm5lbCByZXF1ZXN0LlxuICAgKiBAcHJpdmF0ZSB7bnVtYmVyfVxuICAgKi9cbiAgdGhpcy5sYXN0QXJyYXlJZF8gPSAtMTtcblxuICAvKipcbiAgICogVGhlIGFycmF5IGlkIG9mIHRoZSBsYXN0IGFycmF5IHNlbnQgYnkgdGhlIHNlcnZlciB0aGF0IHdlIGtub3cgYWJvdXQuXG4gICAqIEBwcml2YXRlIHtudW1iZXJ9XG4gICAqL1xuICB0aGlzLmxhc3RQb3N0UmVzcG9uc2VBcnJheUlkXyA9IC0xO1xuXG4gIC8qKlxuICAgKiBUaGUgbGFzdCBzdGF0dXMgY29kZSByZWNlaXZlZC5cbiAgICogQHByaXZhdGUge251bWJlcn1cbiAgICovXG4gIHRoaXMubGFzdFN0YXR1c0NvZGVfID0gLTE7XG5cbiAgLyoqXG4gICAqIE51bWJlciBvZiB0aW1lcyB3ZSBoYXZlIHJldHJpZWQgdGhlIGN1cnJlbnQgZm9yd2FyZCBjaGFubmVsIHJlcXVlc3QuXG4gICAqIEBwcml2YXRlIHtudW1iZXJ9XG4gICAqL1xuICB0aGlzLmZvcndhcmRDaGFubmVsUmV0cnlDb3VudF8gPSAwO1xuXG4gIC8qKlxuICAgKiBOdW1iZXIgb2YgdGltZXMgaW4gYSByb3cgdGhhdCB3ZSBoYXZlIHJldHJpZWQgdGhlIGN1cnJlbnQgYmFjayBjaGFubmVsXG4gICAqIHJlcXVlc3QgYW5kIHJlY2VpdmVkIG5vIGRhdGEuXG4gICAqIEBwcml2YXRlIHtudW1iZXJ9XG4gICAqL1xuICB0aGlzLmJhY2tDaGFubmVsUmV0cnlDb3VudF8gPSAwO1xuXG4gIC8qKlxuICAgKiBUaGUgYXR0ZW1wdCBpZCBmb3IgdGhlIGN1cnJlbnQgYmFjayBjaGFubmVsIHJlcXVlc3QuIFN0YXJ0cyBhdCAxIGFuZFxuICAgKiBpbmNyZW1lbnRzIGZvciBlYWNoIHJlY29ubmVjdC4gVGhlIHNlcnZlciB1c2VzIHRoaXMgdG8gbG9nIGlmIG91clxuICAgKiBjb25uZWN0aW9uIGlzIGZsYWt5IG9yIG5vdC5cbiAgICogQHByaXZhdGUge251bWJlcn1cbiAgICovXG4gIHRoaXMuYmFja0NoYW5uZWxBdHRlbXB0SWRfID0gMDtcblxuICAvKipcbiAgICogVGhlIGJhc2UgcGFydCBvZiB0aGUgdGltZSBiZWZvcmUgZmlyaW5nIG5leHQgcmV0cnkgcmVxdWVzdC4gRGVmYXVsdCBpcyA1XG4gICAqIHNlY29uZHMuIE5vdGUgdGhhdCBhIHJhbmRvbSBkZWxheSBpcyBhZGRlZCAoc2VlIHtAbGluayByZXRyeURlbGF5U2VlZE1zX30pXG4gICAqIGZvciBhbGwgcmV0cmllcywgYW5kIGxpbmVhciBiYWNrb2ZmIGlzIGFwcGxpZWQgdG8gdGhlIHN1bSBmb3Igc3Vic2VxdWVudFxuICAgKiByZXRyaWVzLlxuICAgKiBAcHJpdmF0ZSB7bnVtYmVyfVxuICAgKi9cbiAgdGhpcy5iYXNlUmV0cnlEZWxheU1zXyA9XG4gICAgICBnZXRJbnRlcm5hbENoYW5uZWxQYXJhbSgnYmFzZVJldHJ5RGVsYXlNcycsIDUgKiAxMDAwLCBvcHRfb3B0aW9ucyk7XG5cbiAgLyoqXG4gICAqIEEgcmFuZG9tIHRpbWUgYmV0d2VlbiAwIGFuZCB0aGlzIG51bWJlciBvZiBNUyBpcyBhZGRlZCB0byB0aGVcbiAgICoge0BsaW5rIGJhc2VSZXRyeURlbGF5TXNffS4gRGVmYXVsdCBpcyAxMCBzZWNvbmRzLlxuICAgKiBAcHJpdmF0ZSB7bnVtYmVyfVxuICAgKi9cbiAgdGhpcy5yZXRyeURlbGF5U2VlZE1zXyA9XG4gICAgICBnZXRJbnRlcm5hbENoYW5uZWxQYXJhbSgncmV0cnlEZWxheVNlZWRNcycsIDEwICogMTAwMCwgb3B0X29wdGlvbnMpO1xuXG4gIC8qKlxuICAgKiBNYXhpbXVtIG51bWJlciBvZiBhdHRlbXB0cyB0byBjb25uZWN0IHRvIHRoZSBzZXJ2ZXIgZm9yIGZvcndhcmQgY2hhbm5lbFxuICAgKiByZXF1ZXN0cy4gRGVmYXVsdHMgdG8gMi5cbiAgICogQHByaXZhdGUge251bWJlcn1cbiAgICovXG4gIHRoaXMuZm9yd2FyZENoYW5uZWxNYXhSZXRyaWVzXyA9XG4gICAgICBnZXRJbnRlcm5hbENoYW5uZWxQYXJhbSgnZm9yd2FyZENoYW5uZWxNYXhSZXRyaWVzJywgMiwgb3B0X29wdGlvbnMpO1xuXG4gIC8qKlxuICAgKiBUaGUgdGltZW91dCBpbiBtaWxsaXNlY29uZHMgZm9yIGEgZm9yd2FyZCBjaGFubmVsIHJlcXVlc3QuIERlZmF1bHRzIHRvIDIwXG4gICAqIHNlY29uZHMuIE5vdGUgdGhhdCBwYXJ0IG9mIHRoaXMgdGltZW91dCBjYW4gYmUgcmFuZG9taXplZC5cbiAgICogQHByaXZhdGUge251bWJlcn1cbiAgICovXG4gIHRoaXMuZm9yd2FyZENoYW5uZWxSZXF1ZXN0VGltZW91dE1zXyA9IGdldEludGVybmFsQ2hhbm5lbFBhcmFtKFxuICAgICAgJ2ZvcndhcmRDaGFubmVsUmVxdWVzdFRpbWVvdXRNcycsIDIwICogMTAwMCwgb3B0X29wdGlvbnMpO1xuXG4gIC8qKlxuICAgKiBUaGUgY3VzdG9tIGZhY3RvcnkgdXNlZCB0byBjcmVhdGUgWE1MSHR0cFJlcXVlc3Qgb2JqZWN0cy5cbiAgICogQHByaXZhdGUgeyFnb29nLm5ldC5YbWxIdHRwRmFjdG9yeSB8IHVuZGVmaW5lZH1cbiAgICovXG4gIHRoaXMueG1sSHR0cEZhY3RvcnlfID1cbiAgICAgIChvcHRfb3B0aW9ucyAmJiBvcHRfb3B0aW9ucy54bWxIdHRwRmFjdG9yeSkgfHwgdW5kZWZpbmVkO1xuXG4gIC8qKlxuICAgKiBXaGV0aGVyIG9yIG5vdCB0aGlzIGNoYW5uZWwgdXNlcyBXSEFUV0cgRmV0Y2gvc3RyZWFtcy5cbiAgICogQHByaXZhdGUge2Jvb2xlYW59XG4gICAqL1xuICB0aGlzLnVzZXNGZXRjaFN0cmVhbXNfID1cbiAgICAgIChvcHRfb3B0aW9ucyAmJiBvcHRfb3B0aW9ucy51c2VGZXRjaFN0cmVhbXMpIHx8IGZhbHNlO1xuXG4gIC8qKlxuICAgKiBUaGUgdGltZW91dCBpbiBtaWxsaXNlY29uZHMgZm9yIGEgYmFjayBjaGFubmVsIHJlcXVlc3QuIERlZmF1bHRzIHRvIHVzaW5nXG4gICAqIHRoZSB0aW1lb3V0IGNvbmZpZ3VyZWQgaW4gQ2hhbm5lbFJlcXVlc3QgKDQ1cykuIElmIHNlcnZlci1zaWRlXG4gICAqIGtlZXBhbGl2ZUludGVydmFsIGlzIGtub3duIHRvIHRoZSBjbGllbnQsIHNldCB0aGUgYmFja2NoYW5uZWwgcmVxdWVzdFxuICAgKiB0aW1lb3V0IHRvIDEuNSAqIGtlZXBhbGl2ZUludGVydmFsIChtcykuXG4gICAqXG4gICAqIEBwcml2YXRlIHtudW1iZXJ8dW5kZWZpbmVkfVxuICAgKi9cbiAgdGhpcy5iYWNrQ2hhbm5lbFJlcXVlc3RUaW1lb3V0TXNfID0gdW5kZWZpbmVkO1xuXG4gIC8qKlxuICAgKiBBIHRocm90dGxlIHRpbWUgaW4gbXMgZm9yIHJlYWR5c3RhdGVjaGFuZ2UgZXZlbnRzIGZvciB0aGUgYmFja2NoYW5uZWwuXG4gICAqIFVzZWZ1bCBmb3IgdGhyb3R0bGluZyB3aGVuIHJlYWR5IHN0YXRlIGlzIElOVEVSQUNUSVZFIChwYXJ0aWFsIGRhdGEpLlxuICAgKlxuICAgKiBUaGlzIHRocm90dGxlIGlzIHVzZWZ1bCBpZiB0aGUgc2VydmVyIHNlbmRzIGxhcmdlIGRhdGEgY2h1bmtzIGRvd24gdGhlXG4gICAqIGJhY2tjaGFubmVsLiAgSXQgcHJldmVudHMgZXhhbWluaW5nIFhIUiBwYXJ0aWFsIGRhdGEgb24gZXZlcnkgcmVhZHlzdGF0ZVxuICAgKiBjaGFuZ2UgZXZlbnQuICBUaGlzIGlzIHVzZWZ1bCBiZWNhdXNlIGxhcmdlIGNodW5rcyBjYW4gdHJpZ2dlciBodW5kcmVkc1xuICAgKiBvZiByZWFkeXN0YXRlY2hhbmdlIGV2ZW50cywgZWFjaCBvZiB3aGljaCB0YWtlcyB+NW1zIG9yIHNvIHRvIGhhbmRsZSxcbiAgICogaW4gdHVybiBtYWtpbmcgdGhlIFVJIHVucmVzcG9uc2l2ZSBmb3IgYSBzaWduaWZpY2FudCBwZXJpb2QuXG4gICAqXG4gICAqIElmIHNldCB0byB6ZXJvIG5vIHRocm90dGxlIGlzIHVzZWQuXG4gICAqIEBwcml2YXRlIHtudW1iZXJ9XG4gICAqL1xuICB0aGlzLnJlYWR5U3RhdGVDaGFuZ2VUaHJvdHRsZU1zXyA9IDA7XG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgY3Jvc3Mgb3JpZ2luIHJlcXVlc3RzIGFyZSBzdXBwb3J0ZWQgZm9yIHRoZSBjaGFubmVsLlxuICAgKlxuICAgKiBTZWUge0BsaW5rIGdvb2cubmV0LlhocklvI3NldFdpdGhDcmVkZW50aWFsc30uXG4gICAqIEBwcml2YXRlIHtib29sZWFufVxuICAgKi9cbiAgdGhpcy5zdXBwb3J0c0Nyb3NzRG9tYWluWGhyc18gPVxuICAgICAgKG9wdF9vcHRpb25zICYmIG9wdF9vcHRpb25zLnN1cHBvcnRzQ3Jvc3NEb21haW5YaHIpIHx8IGZhbHNlO1xuXG4gIC8qKlxuICAgKiBUaGUgY3VycmVudCBzZXNzaW9uIGlkLlxuICAgKiBAcHJpdmF0ZSB7c3RyaW5nfVxuICAgKi9cbiAgdGhpcy5zaWRfID0gJyc7XG5cbiAgLyoqXG4gICAqIFRoZSBjdXJyZW50IENoYW5uZWxSZXF1ZXN0IHBvb2wgZm9yIHRoZSBmb3J3YXJkIGNoYW5uZWwuXG4gICAqIEBwcml2YXRlIHshRm9yd2FyZENoYW5uZWxSZXF1ZXN0UG9vbH1cbiAgICovXG4gIHRoaXMuZm9yd2FyZENoYW5uZWxSZXF1ZXN0UG9vbF8gPSBuZXcgRm9yd2FyZENoYW5uZWxSZXF1ZXN0UG9vbChcbiAgICAgIG9wdF9vcHRpb25zICYmIG9wdF9vcHRpb25zLmNvbmN1cnJlbnRSZXF1ZXN0TGltaXQpO1xuXG4gIC8qKlxuICAgKiBUaGUgVjggY29kZWMuXG4gICAqIEBwcml2YXRlIHshV2lyZVY4fVxuICAgKi9cbiAgdGhpcy53aXJlQ29kZWNfID0gbmV3IFdpcmVWOCgpO1xuXG4gIC8qKlxuICAgKiBXaGV0aGVyIHRvIHR1cm4gb24gdGhlIGZhc3QgaGFuZHNoYWtlIGJlaGF2aW9yLlxuICAgKlxuICAgKiBAcHJpdmF0ZSB7Ym9vbGVhbn1cbiAgICovXG4gIHRoaXMuZmFzdEhhbmRzaGFrZV8gPSAob3B0X29wdGlvbnMgJiYgb3B0X29wdGlvbnMuZmFzdEhhbmRzaGFrZSkgfHwgZmFsc2U7XG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgdG8gc2lnbmFsIHRvIHRoZSBzZXJ2ZXIgdG8gZW5hYmxlIGJsb2NraW5nIGhhbmRzaGFrZS5cbiAgICpcbiAgICogQHByaXZhdGUge2Jvb2xlYW59XG4gICAqL1xuICB0aGlzLmJsb2NraW5nSGFuZHNoYWtlXyA9XG4gICAgICAob3B0X29wdGlvbnMgJiYgb3B0X29wdGlvbnMuYmxvY2tpbmdIYW5kc2hha2UpIHx8IGZhbHNlO1xuXG5cbiAgaWYgKG9wdF9vcHRpb25zICYmIG9wdF9vcHRpb25zLmRpc2FibGVSZWRhY3QpIHtcbiAgICB0aGlzLmNoYW5uZWxEZWJ1Z18uZGlzYWJsZVJlZGFjdCgpO1xuICB9XG5cbiAgaWYgKG9wdF9vcHRpb25zICYmIG9wdF9vcHRpb25zLmZvcmNlTG9uZ1BvbGxpbmcpIHtcbiAgICB0aGlzLmFsbG93U3RyZWFtaW5nTW9kZV8gPSBmYWxzZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBXaGV0aGVyIHRvIGRldGVjdCBidWZmZXJpbmcgcHJveGllcy5cbiAgICpcbiAgICogZmFzdEhhbmRzaGFrZSArIGRldGVjdEJ1ZmZlcmluZ1Byb3h5IGFyZSB5ZXQgdG8gYmUgaW1wbGVtZW50ZWQuXG4gICAqXG4gICAqIEBwcml2YXRlIHtib29sZWFufVxuICAgKi9cbiAgdGhpcy5kZXRlY3RCdWZmZXJpbmdQcm94eV8gPVxuICAgICAgKCF0aGlzLmZhc3RIYW5kc2hha2VfICYmIHRoaXMuYWxsb3dTdHJlYW1pbmdNb2RlXyAmJiBvcHRfb3B0aW9ucyAmJlxuICAgICAgIG9wdF9vcHRpb25zLmRldGVjdEJ1ZmZlcmluZ1Byb3h5KSB8fFxuICAgICAgZmFsc2U7XG5cbiAgLyoqXG4gICAqIENhbGxiYWNrIHdoZW4gYWxsIHRoZSBwZW5kaW5nIGNsaWVudC1zZW50IG1lc3NhZ2VzIGhhdmUgYmVlbiBmbHVzaGVkLlxuICAgKlxuICAgKiBAcHJpdmF0ZSB7ZnVuY3Rpb24oKXx1bmRlZmluZWR9XG4gICAqL1xuICB0aGlzLmZvcndhcmRDaGFubmVsRmx1c2hlZENhbGxiYWNrXyA9IHVuZGVmaW5lZDtcblxuICAvKipcbiAgICogVE9ETyh1c2VyKTogbW92ZSBhbGwgYmFja2NoYW5uZWwgc3RhdGVzIHRvIGl0cyBvd24gY2xhc3Mgc2ltaWxhciB0b1xuICAgKiBmb3J3YXJkY2hhbm5lbHJlcXVlc3Rwb29sLmpzIGFuZCBsb2cgbW9yZSBzdGF0cy5cbiAgICpcbiAgICogVGhlIGVzdGltYXRlZCBoYW5kc2hha2UgUlRUIChtcykgYXMgbWVhc3VyZWQgZnJvbSB3aGVuIHRoZSBoYW5kc2hha2VcbiAgICogcmVxdWVzdCBpcyBzZW50IGFuZCB3aGVuIHRoZSBoYW5kc2hha2UgcmVzcG9uc2UgaGVhZGVycyBhcmUgcmVjZWl2ZWQuXG4gICAqIElmIHRoZSB2YWx1ZSBpcyAwLCB0aGUgUlRUIGlzIHVua25vd24uXG4gICAqXG4gICAqIEBwcml2YXRlIHtudW1iZXJ9XG4gICAqL1xuICB0aGlzLmhhbmRzaGFrZVJ0dE1zXyA9IDA7XG5cbiAgLyoqXG4gICAqIElmIEJQIGRldGVjdGlvbiBpcyBkb25lIG9yIHN0aWxsIGluIHByb2dyZXNzLlxuICAgKiBTaG91bGQgb25seSBiZSBjaGVja2VkIHdoZW4gZGV0ZWN0QnVmZmVyaW5nUHJveHkgaXMgdHVybmVkIG9uLlxuICAgKiBAcHJpdmF0ZSB7Ym9vbGVhbn1cbiAgICovXG4gIHRoaXMuYnBEZXRlY3Rpb25Eb25lXyA9IGZhbHNlO1xuXG4gIC8qKlxuICAgKiBUaGUgdGltZXIgZm9yIGRldGVjdGluZyBidWZmZXJpbmcgcHJveHkuIFRoaXMgbmVlZHMgYmUgcmVzZXQgd2l0aCBlYWNoXG4gICAqIGJhY2tjaGFubmVsIHJlcXVlc3QuIElmIHRoaXMgaXMgbm90IG51bGwsIGJwRGV0ZWN0aW9uRG9uZV8gPT0gZmFsc2UuXG4gICAqIEBwcml2YXRlIHs/bnVtYmVyfVxuICAgKi9cbiAgdGhpcy5icERldGVjdGlvblRpbWVySWRfID0gbnVsbDtcblxuICAvKioqXG4gICAqIFdoZXRoZXIgdG8gYXR0ZW1wdCBDaHJvbWUgT3JpZ2luIFRyaWFscyBhcyBwYXJ0IG9mIHRoZSBoYW5kc2hha2UuXG4gICAqIEBwcml2YXRlIHtib29sZWFufVxuICAgKi9cbiAgdGhpcy5lbmFibGVPcmlnaW5UcmlhbHNfID1cbiAgICAgICFvcHRfb3B0aW9ucyB8fCBvcHRfb3B0aW9ucy5lbmFibGVPcmlnaW5UcmlhbHMgIT09IGZhbHNlO1xufTtcblxuY29uc3QgV2ViQ2hhbm5lbEJhc2UgPSBnb29nLmxhYnMubmV0LndlYkNoYW5uZWwuV2ViQ2hhbm5lbEJhc2U7XG5cblxuLyoqXG4gKiBUaGUgY2hhbm5lbCB2ZXJzaW9uIHRoYXQgd2UgbmVnb3RpYXRlZCB3aXRoIHRoZSBzZXJ2ZXIgZm9yIHRoaXMgc2Vzc2lvbi5cbiAqIFN0YXJ0cyBvdXQgYXMgdGhlIHZlcnNpb24gd2UgcmVxdWVzdCwgYW5kIHRoZW4gaXMgY2hhbmdlZCB0byB0aGUgbmVnb3RpYXRlZFxuICogdmVyc2lvbiBhZnRlciB0aGUgaW5pdGlhbCBvcGVuLlxuICogQHByaXZhdGUge251bWJlcn1cbiAqL1xuV2ViQ2hhbm5lbEJhc2UucHJvdG90eXBlLmNoYW5uZWxWZXJzaW9uXyA9IFdpcmUuTEFURVNUX0NIQU5ORUxfVkVSU0lPTjtcblxuXG4vKipcbiAqIEVudW0gdHlwZSBmb3IgdGhlIGNoYW5uZWwgc3RhdGUgbWFjaGluZS5cbiAqIEBlbnVtIHtudW1iZXJ9XG4gKi9cbldlYkNoYW5uZWxCYXNlLlN0YXRlID0ge1xuICAvKiogVGhlIGNoYW5uZWwgaXMgY2xvc2VkLiAqL1xuICBDTE9TRUQ6IDAsXG5cbiAgLyoqIFRoZSBjaGFubmVsIGhhcyBiZWVuIGluaXRpYWxpemVkIGJ1dCBoYXNuJ3QgeWV0IGluaXRpYXRlZCBhIGNvbm5lY3Rpb24uICovXG4gIElOSVQ6IDEsXG5cbiAgLyoqIFRoZSBjaGFubmVsIGlzIGluIHRoZSBwcm9jZXNzIG9mIG9wZW5pbmcgYSBjb25uZWN0aW9uIHRvIHRoZSBzZXJ2ZXIuICovXG4gIE9QRU5JTkc6IDIsXG5cbiAgLyoqIFRoZSBjaGFubmVsIGlzIG9wZW4uICovXG4gIE9QRU5FRDogM1xufTtcblxuXG4vKipcbiAqIFRoZSBjdXJyZW50IHN0YXRlIG9mIHRoZSBXZWJDaGFubmVsLlxuICogQHByaXZhdGUgeyFXZWJDaGFubmVsQmFzZS5TdGF0ZX1cbiAqL1xuV2ViQ2hhbm5lbEJhc2UucHJvdG90eXBlLnN0YXRlXyA9IFdlYkNoYW5uZWxCYXNlLlN0YXRlLklOSVQ7XG5cblxuLyoqXG4gKiBUaGUgdGltZW91dCBpbiBtaWxsaXNlY29uZHMgZm9yIGEgZm9yd2FyZCBjaGFubmVsIHJlcXVlc3QuXG4gKiBAdHlwZSB7bnVtYmVyfVxuICovXG5XZWJDaGFubmVsQmFzZS5GT1JXQVJEX0NIQU5ORUxfUkVUUllfVElNRU9VVCA9IDIwICogMTAwMDtcblxuXG4vKipcbiAqIE1heGltdW0gbnVtYmVyIG9mIGF0dGVtcHRzIHRvIGNvbm5lY3QgdG8gdGhlIHNlcnZlciBmb3IgYmFjayBjaGFubmVsXG4gKiByZXF1ZXN0cy5cbiAqIEB0eXBlIHtudW1iZXJ9XG4gKi9cbldlYkNoYW5uZWxCYXNlLkJBQ0tfQ0hBTk5FTF9NQVhfUkVUUklFUyA9IDM7XG5cblxuLyoqXG4gKiBBIG51bWJlciBpbiBNUyBvZiBob3cgbG9uZyB3ZSBndWVzcyB0aGUgbWF4bWl1bSBhbW91bnQgb2YgdGltZSBhIHJvdW5kIHRyaXBcbiAqIHRvIHRoZSBzZXJ2ZXIgc2hvdWxkIHRha2UuIEluIHRoZSBmdXR1cmUgdGhpcyBjb3VsZCBiZSBzdWJzdGl0dXRlZCB3aXRoIGFcbiAqIHJlYWwgbWVhc3VyZW1lbnQgb2YgdGhlIFJUVC5cbiAqIEB0eXBlIHtudW1iZXJ9XG4gKi9cbldlYkNoYW5uZWxCYXNlLlJUVF9FU1RJTUFURSA9IDMgKiAxMDAwO1xuXG5cbi8qKlxuICogV2hlbiByZXRyeWluZyBmb3IgYW4gaW5hY3RpdmUgY2hhbm5lbCwgd2Ugd2lsbCBtdWx0aXBseSB0aGUgdG90YWwgZGVsYXkgYnlcbiAqIHRoaXMgbnVtYmVyLlxuICogQHR5cGUge251bWJlcn1cbiAqL1xuV2ViQ2hhbm5lbEJhc2UuSU5BQ1RJVkVfQ0hBTk5FTF9SRVRSWV9GQUNUT1IgPSAyO1xuXG5cbi8qKlxuICogRW51bSB0eXBlIGZvciBpZGVudGlmeWluZyBhbiBlcnJvci5cbiAqIEBlbnVtIHtudW1iZXJ9XG4gKi9cbldlYkNoYW5uZWxCYXNlLkVycm9yID0ge1xuICAvKiogVmFsdWUgdGhhdCBpbmRpY2F0ZXMgbm8gZXJyb3IgaGFzIG9jY3VycmVkLiAqL1xuICBPSzogMCxcblxuICAvKiogQW4gZXJyb3IgZHVlIHRvIGEgcmVxdWVzdCBmYWlsaW5nLiAqL1xuICBSRVFVRVNUX0ZBSUxFRDogMixcblxuICAvKiogQW4gZXJyb3IgZHVlIHRvIHRoZSB1c2VyIGJlaW5nIGxvZ2dlZCBvdXQuICovXG4gIExPR0dFRF9PVVQ6IDQsXG5cbiAgLyoqIEFuIGVycm9yIGR1ZSB0byBzZXJ2ZXIgcmVzcG9uc2Ugd2hpY2ggY29udGFpbnMgbm8gZGF0YS4gKi9cbiAgTk9fREFUQTogNSxcblxuICAvKiogQW4gZXJyb3IgZHVlIHRvIGEgc2VydmVyIHJlc3BvbnNlIGluZGljYXRpbmcgYW4gdW5rbm93biBzZXNzaW9uIGlkICovXG4gIFVOS05PV05fU0VTU0lPTl9JRDogNixcblxuICAvKiogQW4gZXJyb3IgZHVlIHRvIGEgc2VydmVyIHJlc3BvbnNlIHJlcXVlc3RpbmcgdG8gc3RvcCB0aGUgY2hhbm5lbC4gKi9cbiAgU1RPUDogNyxcblxuICAvKiogQSBnZW5lcmFsIG5ldHdvcmsgZXJyb3IuICovXG4gIE5FVFdPUks6IDgsXG5cbiAgLyoqIEFuIGVycm9yIGR1ZSB0byBiYWQgZGF0YSBiZWluZyByZXR1cm5lZCBmcm9tIHRoZSBzZXJ2ZXIuICovXG4gIEJBRF9EQVRBOiAxMCxcblxuICAvKiogQW4gZXJyb3IgZHVlIHRvIGEgcmVzcG9uc2UgdGhhdCBpcyBub3QgcGFyc2FibGUuICovXG4gIEJBRF9SRVNQT05TRTogMTFcbn07XG5cblxuLyoqXG4gKiBJbnRlcm5hbCBlbnVtIHR5cGUgZm9yIHRoZSB0d28gY2hhbm5lbCB0eXBlcy5cbiAqIEBlbnVtIHtudW1iZXJ9XG4gKiBAcHJpdmF0ZVxuICovXG5XZWJDaGFubmVsQmFzZS5DaGFubmVsVHlwZV8gPSB7XG4gIEZPUldBUkRfQ0hBTk5FTDogMSxcblxuICBCQUNLX0NIQU5ORUw6IDJcbn07XG5cblxuLyoqXG4gKiBUaGUgbWF4aW11bSBudW1iZXIgb2YgbWFwcyB0aGF0IGNhbiBiZSBzZW50IGluIG9uZSBQT1NULiBTaG91bGQgbWF0Y2hcbiAqIE1BWF9NQVBTX1BFUl9SRVFVRVNUIG9uIHRoZSBzZXJ2ZXIgY29kZS5cbiAqIEB0eXBlIHtudW1iZXJ9XG4gKiBAcHJpdmF0ZVxuICovXG5XZWJDaGFubmVsQmFzZS5NQVhfTUFQU19QRVJfUkVRVUVTVF8gPSAxMDAwO1xuXG5cbi8qKlxuICogVGhlIG1heGltdW0gbnVtYmVyIG9mIHV0Zi04IGNoYXJzIHRoYXQgY2FuIGJlIHNlbnQgaW4gb25lIEdFVCB0byBlbmFibGUgMC1SVFRcbiAqIGhhbmRzaGFrZS5cbiAqXG4gKiAgQGNvbnN0IEBwcml2YXRlIHtudW1iZXJ9XG4gKi9cbldlYkNoYW5uZWxCYXNlLk1BWF9DSEFSU19QRVJfR0VUXyA9IDQgKiAxMDI0O1xuXG5cbi8qKlxuICogQSBndWVzcyBhdCBhIGN1dG9mZiBhdCB3aGljaCB0byBubyBsb25nZXIgYXNzdW1lIHRoZSBiYWNrY2hhbm5lbCBpcyBkZWFkXG4gKiB3aGVuIHdlIGFyZSBzbG93IHRvIHJlY2VpdmUgZGF0YS4gTnVtYmVyIGluIGJ5dGVzLlxuICpcbiAqIEFzc3VtcHRpb246IFRoZSB3b3JzdCBiYW5kd2lkdGggd2Ugd29yayBvbiBpcyA1MCBraWxvYml0cy9zZWNcbiAqIDUwa2JpdHMvc2VjICogKDEgYnl0ZSAvIDggYml0cykgKiA2IHNlYyBkZWFkIGJhY2tjaGFubmVsIHRpbWVvdXRcbiAqIEB0eXBlIHtudW1iZXJ9XG4gKi9cbldlYkNoYW5uZWxCYXNlLk9VVFNUQU5ESU5HX0RBVEFfQkFDS0NIQU5ORUxfUkVUUllfQ1VUT0ZGID0gMzc1MDA7XG5cblxuLyoqXG4gKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBzZXJ2ZXIgdmVyc2lvbiBvciAwIGlmIHVuZGVmaW5lZFxuICovXG5XZWJDaGFubmVsQmFzZS5wcm90b3R5cGUuZ2V0U2VydmVyVmVyc2lvbiA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIHJldHVybiB0aGlzLnNlcnZlclZlcnNpb25fO1xufTtcblxuXG4vKipcbiAqIEByZXR1cm4geyFGb3J3YXJkQ2hhbm5lbFJlcXVlc3RQb29sfSBUaGUgZm9yd2FyZCBjaGFubmVsIHJlcXVlc3QgcG9vbC5cbiAqL1xuV2ViQ2hhbm5lbEJhc2UucHJvdG90eXBlLmdldEZvcndhcmRDaGFubmVsUmVxdWVzdFBvb2wgPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gdGhpcy5mb3J3YXJkQ2hhbm5lbFJlcXVlc3RQb29sXztcbn07XG5cblxuLyoqXG4gKiBAcmV0dXJuIHshT2JqZWN0fSBUaGUgY29kZWMgb2JqZWN0LlxuICovXG5XZWJDaGFubmVsQmFzZS5wcm90b3R5cGUuZ2V0V2lyZUNvZGVjID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmV0dXJuIHRoaXMud2lyZUNvZGVjXztcbn07XG5cblxuLyoqXG4gKiBSZXR1cm5zIHRoZSBsb2dnZXIuXG4gKlxuICogQHJldHVybiB7IVdlYkNoYW5uZWxEZWJ1Z30gVGhlIGNoYW5uZWwgZGVidWcgb2JqZWN0LlxuICovXG5XZWJDaGFubmVsQmFzZS5wcm90b3R5cGUuZ2V0Q2hhbm5lbERlYnVnID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmV0dXJuIHRoaXMuY2hhbm5lbERlYnVnXztcbn07XG5cblxuLyoqXG4gKiBTZXRzIHRoZSBsb2dnZXIuXG4gKlxuICogQHBhcmFtIHshV2ViQ2hhbm5lbERlYnVnfSBjaGFubmVsRGVidWcgVGhlIGNoYW5uZWwgZGVidWcgb2JqZWN0LlxuICovXG5XZWJDaGFubmVsQmFzZS5wcm90b3R5cGUuc2V0Q2hhbm5lbERlYnVnID0gZnVuY3Rpb24oY2hhbm5lbERlYnVnKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgdGhpcy5jaGFubmVsRGVidWdfID0gY2hhbm5lbERlYnVnO1xufTtcblxuXG4vKipcbiAqIFN0YXJ0cyB0aGUgY2hhbm5lbC4gVGhpcyBpbml0aWF0ZXMgY29ubmVjdGlvbnMgdG8gdGhlIHNlcnZlci5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gY2hhbm5lbFBhdGggIFRoZSBwYXRoIGZvciB0aGUgY2hhbm5lbCBjb25uZWN0aW9uLlxuICogQHBhcmFtIHshT2JqZWN0PX0gb3B0X2V4dHJhUGFyYW1zIEV4dHJhIHBhcmFtZXRlciBrZXlzIGFuZCB2YWx1ZXMgdG8gYWRkIHRvXG4gKiAgICAgdGhlIHJlcXVlc3RzLlxuICogQHBhcmFtIHtzdHJpbmc9fSBvcHRfb2xkU2Vzc2lvbklkICBTZXNzaW9uIElEIGZyb20gYSBwcmV2aW91cyBzZXNzaW9uLlxuICogQHBhcmFtIHtudW1iZXI9fSBvcHRfb2xkQXJyYXlJZCAgVGhlIGxhc3QgYXJyYXkgSUQgZnJvbSBhIHByZXZpb3VzIHNlc3Npb24uXG4gKi9cbldlYkNoYW5uZWxCYXNlLnByb3RvdHlwZS5jb25uZWN0ID0gZnVuY3Rpb24oXG4gICAgY2hhbm5lbFBhdGgsIG9wdF9leHRyYVBhcmFtcywgb3B0X29sZFNlc3Npb25JZCwgb3B0X29sZEFycmF5SWQpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICB0aGlzLmNoYW5uZWxEZWJ1Z18uZGVidWcoJ2Nvbm5lY3QoKScpO1xuXG4gIHRoaXMuc3RhcnRPcmlnaW5UcmlhbHNfKGNoYW5uZWxQYXRoKTtcblxuICByZXF1ZXN0U3RhdHMubm90aWZ5U3RhdEV2ZW50KHJlcXVlc3RTdGF0cy5TdGF0LkNPTk5FQ1RfQVRURU1QVCk7XG5cbiAgdGhpcy5wYXRoXyA9IGNoYW5uZWxQYXRoO1xuICB0aGlzLmV4dHJhUGFyYW1zXyA9IG9wdF9leHRyYVBhcmFtcyB8fCB7fTtcblxuICAvLyBBdHRhY2ggcGFyYW1ldGVycyBhYm91dCB0aGUgcHJldmlvdXMgc2Vzc2lvbiBpZiByZWNvbm5lY3RpbmcuXG4gIGlmIChvcHRfb2xkU2Vzc2lvbklkICYmIG9wdF9vbGRBcnJheUlkICE9PSB1bmRlZmluZWQpIHtcbiAgICB0aGlzLmV4dHJhUGFyYW1zX1snT1NJRCddID0gb3B0X29sZFNlc3Npb25JZDtcbiAgICB0aGlzLmV4dHJhUGFyYW1zX1snT0FJRCddID0gb3B0X29sZEFycmF5SWQ7XG4gIH1cblxuICB0aGlzLmVuYWJsZVN0cmVhbWluZ18gPSB0aGlzLmFsbG93U3RyZWFtaW5nTW9kZV87XG4gIHRoaXMuY29ubmVjdENoYW5uZWxfKCk7XG59O1xuXG5cbi8qKlxuICogRGlzY29ubmVjdHMgYW5kIGNsb3NlcyB0aGUgY2hhbm5lbC5cbiAqL1xuV2ViQ2hhbm5lbEJhc2UucHJvdG90eXBlLmRpc2Nvbm5lY3QgPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICB0aGlzLmNoYW5uZWxEZWJ1Z18uZGVidWcoJ2Rpc2Nvbm5lY3QoKScpO1xuXG4gIHRoaXMuY2FuY2VsUmVxdWVzdHNfKCk7XG5cbiAgaWYgKHRoaXMuc3RhdGVfID09IFdlYkNoYW5uZWxCYXNlLlN0YXRlLk9QRU5FRCkge1xuICAgIGNvbnN0IHJpZCA9IHRoaXMubmV4dFJpZF8rKztcbiAgICBjb25zdCB1cmkgPSB0aGlzLmZvcndhcmRDaGFubmVsVXJpXy5jbG9uZSgpO1xuICAgIHVyaS5zZXRQYXJhbWV0ZXJWYWx1ZSgnU0lEJywgdGhpcy5zaWRfKTtcbiAgICB1cmkuc2V0UGFyYW1ldGVyVmFsdWUoJ1JJRCcsIHJpZCk7XG4gICAgdXJpLnNldFBhcmFtZXRlclZhbHVlKCdUWVBFJywgJ3Rlcm1pbmF0ZScpO1xuXG4gICAgLy8gQWRkIHRoZSByZWNvbm5lY3QgcGFyYW1ldGVycy5cbiAgICB0aGlzLmFkZEFkZGl0aW9uYWxQYXJhbXNfKHVyaSk7XG5cbiAgICBjb25zdCByZXF1ZXN0ID0gQ2hhbm5lbFJlcXVlc3QuY3JlYXRlQ2hhbm5lbFJlcXVlc3QoXG4gICAgICAgIHRoaXMsIHRoaXMuY2hhbm5lbERlYnVnXywgdGhpcy5zaWRfLCByaWQpO1xuICAgIHJlcXVlc3Quc2VuZENsb3NlUmVxdWVzdCh1cmkpO1xuICB9XG5cbiAgdGhpcy5vbkNsb3NlXygpO1xufTtcblxuXG4vKipcbiAqIFJldHVybnMgdGhlIHNlc3Npb24gaWQgb2YgdGhlIGNoYW5uZWwuIE9ubHkgYXZhaWxhYmxlIGFmdGVyIHRoZVxuICogY2hhbm5lbCBoYXMgYmVlbiBvcGVuZWQuXG4gKiBAcmV0dXJuIHtzdHJpbmd9IFNlc3Npb24gSUQuXG4gKi9cbldlYkNoYW5uZWxCYXNlLnByb3RvdHlwZS5nZXRTZXNzaW9uSWQgPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gdGhpcy5zaWRfO1xufTtcblxuXG4vKipcbiAqIFN0YXJ0cyB0aGUgY29ubmVjdGlvbi5cbiAqIEBwcml2YXRlXG4gKi9cbldlYkNoYW5uZWxCYXNlLnByb3RvdHlwZS5jb25uZWN0Q2hhbm5lbF8gPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICB0aGlzLmNoYW5uZWxEZWJ1Z18uZGVidWcoJ2Nvbm5lY3RDaGFubmVsXygpJyk7XG4gIHRoaXMuZW5zdXJlSW5TdGF0ZV8oV2ViQ2hhbm5lbEJhc2UuU3RhdGUuSU5JVCwgV2ViQ2hhbm5lbEJhc2UuU3RhdGUuQ0xPU0VEKTtcbiAgdGhpcy5mb3J3YXJkQ2hhbm5lbFVyaV8gPVxuICAgICAgdGhpcy5nZXRGb3J3YXJkQ2hhbm5lbFVyaSgvKiogQHR5cGUge3N0cmluZ30gKi8gKHRoaXMucGF0aF8pKTtcbiAgdGhpcy5lbnN1cmVGb3J3YXJkQ2hhbm5lbF8oKTtcbn07XG5cblxuLyoqXG4gKiBTdGFydHMgdGhlIE9yaWdpbiBUcmlhbHMuXG4gKiBAcGFyYW0ge3N0cmluZ30gY2hhbm5lbFBhdGggIFRoZSBwYXRoIGZvciB0aGUgY2hhbm5lbCBjb25uZWN0aW9uLlxuICogQHByaXZhdGVcbiAqL1xuV2ViQ2hhbm5lbEJhc2UucHJvdG90eXBlLnN0YXJ0T3JpZ2luVHJpYWxzXyA9IGZ1bmN0aW9uKGNoYW5uZWxQYXRoKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICBpZiAoIXRoaXMuZW5hYmxlT3JpZ2luVHJpYWxzXykge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHRoaXMuY2hhbm5lbERlYnVnXy5pbmZvKCdPcmlnaW4gVHJpYWxzIGVuYWJsZWQuJyk7XG4gIGdvb2cuYXN5bmMucnVuKGdvb2cuYmluZCh0aGlzLnJ1bk9yaWdpblRyaWFsc18sIHRoaXMsIGNoYW5uZWxQYXRoKSk7XG59O1xuXG5cbi8qKlxuICogUnVucyB0aGUgT3JpZ2luIFRyaWFscy5cbiAqIEBwYXJhbSB7c3RyaW5nfSBjaGFubmVsUGF0aCAgVGhlIHBhdGggZm9yIHRoZSBjaGFubmVsIGNvbm5lY3Rpb24uXG4gKiBAcHJpdmF0ZVxuICovXG5XZWJDaGFubmVsQmFzZS5wcm90b3R5cGUucnVuT3JpZ2luVHJpYWxzXyA9IGZ1bmN0aW9uKGNoYW5uZWxQYXRoKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICB0cnkge1xuICAgIGVudmlyb25tZW50LnN0YXJ0T3JpZ2luVHJpYWxzKGNoYW5uZWxQYXRoKTtcbiAgICB0aGlzLmNoYW5uZWxEZWJ1Z18uaW5mbygnT3JpZ2luIFRyaWFscyBpbnZva2VkOiAnICsgY2hhbm5lbFBhdGgpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgdGhpcy5jaGFubmVsRGVidWdfLmR1bXBFeGNlcHRpb24oZSwgJ0Vycm9yIGluIHJ1bm5pbmcgb3JpZ2luIHRyaWFscycpO1xuICB9XG59O1xuXG5cbi8qKlxuICogQ2FuY2VscyBiYWNrY2hhbm5lbCByZXF1ZXN0LlxuICogQHByaXZhdGVcbiAqL1xuV2ViQ2hhbm5lbEJhc2UucHJvdG90eXBlLmNhbmNlbEJhY2tDaGFubmVsUmVxdWVzdF8gPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBpZiAodGhpcy5iYWNrQ2hhbm5lbFJlcXVlc3RfKSB7XG4gICAgdGhpcy5jbGVhckJwRGV0ZWN0aW9uVGltZXJfKCk7XG4gICAgdGhpcy5iYWNrQ2hhbm5lbFJlcXVlc3RfLmNhbmNlbCgpO1xuICAgIHRoaXMuYmFja0NoYW5uZWxSZXF1ZXN0XyA9IG51bGw7XG4gIH1cbn07XG5cblxuLyoqXG4gKiBDYW5jZWxzIGFsbCBvdXRzdGFuZGluZyByZXF1ZXN0cy5cbiAqIEBwcml2YXRlXG4gKi9cbldlYkNoYW5uZWxCYXNlLnByb3RvdHlwZS5jYW5jZWxSZXF1ZXN0c18gPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICB0aGlzLmNhbmNlbEJhY2tDaGFubmVsUmVxdWVzdF8oKTtcblxuICBpZiAodGhpcy5iYWNrQ2hhbm5lbFRpbWVySWRfKSB7XG4gICAgZ29vZy5nbG9iYWwuY2xlYXJUaW1lb3V0KHRoaXMuYmFja0NoYW5uZWxUaW1lcklkXyk7XG4gICAgdGhpcy5iYWNrQ2hhbm5lbFRpbWVySWRfID0gbnVsbDtcbiAgfVxuXG4gIHRoaXMuY2xlYXJEZWFkQmFja2NoYW5uZWxUaW1lcl8oKTtcblxuICB0aGlzLmZvcndhcmRDaGFubmVsUmVxdWVzdFBvb2xfLmNhbmNlbCgpO1xuXG4gIGlmICh0aGlzLmZvcndhcmRDaGFubmVsVGltZXJJZF8pIHtcbiAgICB0aGlzLmNsZWFyRm9yd2FyZENoYW5uZWxUaW1lcl8oKTtcbiAgfVxufTtcblxuXG4vKipcbiAqIENsZWFycyB0aGUgZm9yd2FyZCBjaGFubmVsIHRpbWVyLlxuICogQHByaXZhdGVcbiAqL1xuV2ViQ2hhbm5lbEJhc2UucHJvdG90eXBlLmNsZWFyRm9yd2FyZENoYW5uZWxUaW1lcl8gPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBpZiAodHlwZW9mIHRoaXMuZm9yd2FyZENoYW5uZWxUaW1lcklkXyA9PT0gJ251bWJlcicpIHtcbiAgICBnb29nLmdsb2JhbC5jbGVhclRpbWVvdXQodGhpcy5mb3J3YXJkQ2hhbm5lbFRpbWVySWRfKTtcbiAgfVxuXG4gIHRoaXMuZm9yd2FyZENoYW5uZWxUaW1lcklkXyA9IG51bGw7XG59O1xuXG5cbi8qKlxuICogUmV0dXJucyB0aGUgZXh0cmEgSFRUUCBoZWFkZXJzIHRvIGFkZCB0byBhbGwgdGhlIHJlcXVlc3RzIHNlbnQgdG8gdGhlIHNlcnZlci5cbiAqXG4gKiBAcmV0dXJuIHtPYmplY3R9IFRoZSBIVFRQIGhlYWRlcnMsIG9yIG51bGwuXG4gKi9cbldlYkNoYW5uZWxCYXNlLnByb3RvdHlwZS5nZXRFeHRyYUhlYWRlcnMgPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gdGhpcy5leHRyYUhlYWRlcnNfO1xufTtcblxuXG4vKipcbiAqIFNldHMgZXh0cmEgSFRUUCBoZWFkZXJzIHRvIGFkZCB0byBhbGwgdGhlIHJlcXVlc3RzIHNlbnQgdG8gdGhlIHNlcnZlci5cbiAqXG4gKiBAcGFyYW0ge09iamVjdH0gZXh0cmFIZWFkZXJzIFRoZSBIVFRQIGhlYWRlcnMsIG9yIG51bGwuXG4gKi9cbldlYkNoYW5uZWxCYXNlLnByb3RvdHlwZS5zZXRFeHRyYUhlYWRlcnMgPSBmdW5jdGlvbihleHRyYUhlYWRlcnMpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICB0aGlzLmV4dHJhSGVhZGVyc18gPSBleHRyYUhlYWRlcnM7XG59O1xuXG5cbi8qKlxuICogUmV0dXJucyB0aGUgZXh0cmEgSFRUUCBoZWFkZXJzIHRvIGFkZCB0byB0aGUgaW5pdCByZXF1ZXN0c1xuICogc2VudCB0byB0aGUgc2VydmVyLlxuICpcbiAqIEByZXR1cm4ge09iamVjdH0gVGhlIEhUVFAgaGVhZGVycywgb3IgbnVsbC5cbiAqL1xuV2ViQ2hhbm5lbEJhc2UucHJvdG90eXBlLmdldEluaXRIZWFkZXJzID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmV0dXJuIHRoaXMuaW5pdEhlYWRlcnNfO1xufTtcblxuXG4vKipcbiAqIFNldHMgZXh0cmEgSFRUUCBoZWFkZXJzIHRvIGFkZCB0byB0aGUgaW5pdCByZXF1ZXN0cyBzZW50IHRvIHRoZSBzZXJ2ZXIuXG4gKlxuICogQHBhcmFtIHtPYmplY3R9IGluaXRIZWFkZXJzIFRoZSBIVFRQIGhlYWRlcnMsIG9yIG51bGwuXG4gKi9cbldlYkNoYW5uZWxCYXNlLnByb3RvdHlwZS5zZXRJbml0SGVhZGVycyA9IGZ1bmN0aW9uKGluaXRIZWFkZXJzKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgdGhpcy5pbml0SGVhZGVyc18gPSBpbml0SGVhZGVycztcbn07XG5cblxuLyoqXG4gKiBTZXRzIHRoZSBVUkwgcGFyYW0gbmFtZSB0byBvdmVyd3JpdGUgY3VzdG9tIEhUVFAgaGVhZGVycy5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gaHR0cEhlYWRlcnNPdmVyd3JpdGVQYXJhbSBUaGUgVVJMIHBhcmFtIG5hbWUuXG4gKi9cbldlYkNoYW5uZWxCYXNlLnByb3RvdHlwZS5zZXRIdHRwSGVhZGVyc092ZXJ3cml0ZVBhcmFtID0gZnVuY3Rpb24oXG4gICAgaHR0cEhlYWRlcnNPdmVyd3JpdGVQYXJhbSkge1xuICAndXNlIHN0cmljdCc7XG4gIHRoaXMuaHR0cEhlYWRlcnNPdmVyd3JpdGVQYXJhbV8gPSBodHRwSGVhZGVyc092ZXJ3cml0ZVBhcmFtO1xufTtcblxuXG4vKipcbiAqIEBvdmVycmlkZVxuICovXG5XZWJDaGFubmVsQmFzZS5wcm90b3R5cGUuc2V0SHR0cFNlc3Npb25JZFBhcmFtID0gZnVuY3Rpb24oaHR0cFNlc3Npb25JZFBhcmFtKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgdGhpcy5odHRwU2Vzc2lvbklkUGFyYW1fID0gaHR0cFNlc3Npb25JZFBhcmFtO1xufTtcblxuXG4vKipcbiAqIEBvdmVycmlkZVxuICovXG5XZWJDaGFubmVsQmFzZS5wcm90b3R5cGUuZ2V0SHR0cFNlc3Npb25JZFBhcmFtID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmV0dXJuIHRoaXMuaHR0cFNlc3Npb25JZFBhcmFtXztcbn07XG5cblxuLyoqXG4gKiBAb3ZlcnJpZGVcbiAqL1xuV2ViQ2hhbm5lbEJhc2UucHJvdG90eXBlLnNldEh0dHBTZXNzaW9uSWQgPSBmdW5jdGlvbihodHRwU2Vzc2lvbklkKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgdGhpcy5odHRwU2Vzc2lvbklkXyA9IGh0dHBTZXNzaW9uSWQ7XG59O1xuXG5cbi8qKlxuICogQG92ZXJyaWRlXG4gKi9cbldlYkNoYW5uZWxCYXNlLnByb3RvdHlwZS5nZXRIdHRwU2Vzc2lvbklkID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmV0dXJuIHRoaXMuaHR0cFNlc3Npb25JZF87XG59O1xuXG5cbi8qKlxuICogU2V0cyB0aGUgdGhyb3R0bGUgZm9yIGhhbmRsaW5nIG9ucmVhZHlzdGF0ZWNoYW5nZSBldmVudHMgZm9yIHRoZSByZXF1ZXN0LlxuICpcbiAqIEBwYXJhbSB7bnVtYmVyfSB0aHJvdHRsZSBUaGUgdGhyb3R0bGUgaW4gbXMuICBBIHZhbHVlIG9mIHplcm8gaW5kaWNhdGVzXG4gKiAgICAgbm8gdGhyb3R0bGUuXG4gKi9cbldlYkNoYW5uZWxCYXNlLnByb3RvdHlwZS5zZXRSZWFkeVN0YXRlQ2hhbmdlVGhyb3R0bGUgPSBmdW5jdGlvbih0aHJvdHRsZSkge1xuICAndXNlIHN0cmljdCc7XG4gIHRoaXMucmVhZHlTdGF0ZUNoYW5nZVRocm90dGxlTXNfID0gdGhyb3R0bGU7XG59O1xuXG5cbi8qKlxuICogU2V0cyB3aGV0aGVyIGNyb3NzIG9yaWdpbiByZXF1ZXN0cyBhcmUgc3VwcG9ydGVkIGZvciB0aGUgY2hhbm5lbC5cbiAqXG4gKiBTZXR0aW5nIHRoaXMgYWxsb3dzIHRoZSBjcmVhdGlvbiBvZiByZXF1ZXN0cyB0byBzZWNvbmRhcnkgZG9tYWlucyBhbmRcbiAqIHNlbmRzIFhIUnMgd2l0aCB0aGUgQ09SUyB3aXRoQ3JlZGVudGlhbHMgYml0IHNldCB0byB0cnVlLlxuICpcbiAqIEluIG9yZGVyIGZvciBjcm9zcy1vcmlnaW4gcmVxdWVzdHMgdG8gd29yaywgdGhlIHNlcnZlciB3aWxsIGFsc28gbmVlZCB0byBzZXRcbiAqIENPUlMgcmVzcG9uc2UgaGVhZGVycyBhcyBwZXI6XG4gKiBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL0hUVFBfYWNjZXNzX2NvbnRyb2xcbiAqXG4gKiBTZWUge0BsaW5rIGdvb2cubmV0LlhocklvI3NldFdpdGhDcmVkZW50aWFsc30uXG4gKiBAcGFyYW0ge2Jvb2xlYW59IHN1cHBvcnRDcm9zc0RvbWFpbiBXaGV0aGVyIGNyb3NzIGRvbWFpbiBYSFJzIGFyZSBzdXBwb3J0ZWQuXG4gKi9cbldlYkNoYW5uZWxCYXNlLnByb3RvdHlwZS5zZXRTdXBwb3J0c0Nyb3NzRG9tYWluWGhycyA9IGZ1bmN0aW9uKFxuICAgIHN1cHBvcnRDcm9zc0RvbWFpbikge1xuICAndXNlIHN0cmljdCc7XG4gIHRoaXMuc3VwcG9ydHNDcm9zc0RvbWFpblhocnNfID0gc3VwcG9ydENyb3NzRG9tYWluO1xufTtcblxuXG4vKipcbiAqIFJldHVybnMgdGhlIGhhbmRsZXIgdXNlZCBmb3IgY2hhbm5lbCBjYWxsYmFjayBldmVudHMuXG4gKlxuICogQHJldHVybiB7V2ViQ2hhbm5lbEJhc2UuSGFuZGxlcn0gVGhlIGhhbmRsZXIuXG4gKi9cbldlYkNoYW5uZWxCYXNlLnByb3RvdHlwZS5nZXRIYW5kbGVyID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmV0dXJuIHRoaXMuaGFuZGxlcl87XG59O1xuXG5cbi8qKlxuICogU2V0cyB0aGUgaGFuZGxlciB1c2VkIGZvciBjaGFubmVsIGNhbGxiYWNrIGV2ZW50cy5cbiAqIEBwYXJhbSB7V2ViQ2hhbm5lbEJhc2UuSGFuZGxlcn0gaGFuZGxlciBUaGUgaGFuZGxlciB0byBzZXQuXG4gKi9cbldlYkNoYW5uZWxCYXNlLnByb3RvdHlwZS5zZXRIYW5kbGVyID0gZnVuY3Rpb24oaGFuZGxlcikge1xuICAndXNlIHN0cmljdCc7XG4gIHRoaXMuaGFuZGxlcl8gPSBoYW5kbGVyO1xufTtcblxuXG4vKipcbiAqIFJldHVybnMgd2hldGhlciB0aGUgY2hhbm5lbCBhbGxvd3MgdGhlIHVzZSBvZiBhIHN1YmRvbWFpbi4gVGhlcmUgbWF5IGJlXG4gKiBjYXNlcyB3aGVyZSB0aGlzIGlzbid0IGFsbG93ZWQuXG4gKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIGEgaG9zdCBwcmVmaXggaXMgYWxsb3dlZC5cbiAqL1xuV2ViQ2hhbm5lbEJhc2UucHJvdG90eXBlLmdldEFsbG93SG9zdFByZWZpeCA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIHJldHVybiB0aGlzLmFsbG93SG9zdFByZWZpeF87XG59O1xuXG5cbi8qKlxuICogU2V0cyB3aGV0aGVyIHRoZSBjaGFubmVsIGFsbG93cyB0aGUgdXNlIG9mIGEgc3ViZG9tYWluLiBUaGVyZSBtYXkgYmUgY2FzZXNcbiAqIHdoZXJlIHRoaXMgaXNuJ3QgYWxsb3dlZCwgZm9yIGV4YW1wbGUsIGxvZ2dpbmcgaW4gd2l0aCB0cm91dGJvYXJkIHdoZXJlXG4gKiB1c2luZyBhIHN1YmRvbWFpbiBjYXVzZXMgQXBhY2hlIHRvIGZvcmNlIHRoZSB1c2VyIHRvIGF1dGhlbnRpY2F0ZSB0d2ljZS5cbiAqIEBwYXJhbSB7Ym9vbGVhbn0gYWxsb3dIb3N0UHJlZml4IFdoZXRoZXIgYSBob3N0IHByZWZpeCBpcyBhbGxvd2VkLlxuICovXG5XZWJDaGFubmVsQmFzZS5wcm90b3R5cGUuc2V0QWxsb3dIb3N0UHJlZml4ID0gZnVuY3Rpb24oYWxsb3dIb3N0UHJlZml4KSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgdGhpcy5hbGxvd0hvc3RQcmVmaXhfID0gYWxsb3dIb3N0UHJlZml4O1xufTtcblxuXG4vKipcbiAqIFJldHVybnMgd2hldGhlciB0aGUgY2hhbm5lbCBpcyBidWZmZXJlZCBvciBub3QuICBUaGlzIG1heSBiZVxuICogcXVlcmllZCBpbiB0aGUgV2ViQ2hhbm5lbEJhc2Uub2tUb01ha2VSZXF1ZXN0KCkgY2FsbGJhY2suXG4gKlxuICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGUgY2hhbm5lbCBpcyBidWZmZXJlZC5cbiAqL1xuV2ViQ2hhbm5lbEJhc2UucHJvdG90eXBlLmlzQnVmZmVyZWQgPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gIXRoaXMuZW5hYmxlU3RyZWFtaW5nXztcbn07XG5cblxuLyoqXG4gKiBSZXR1cm5zIHdoZXRoZXIgc3RyZWFtaW5nIG1vZGUgaXMgYWxsb3dlZC4gSW4gY2VydGFpbiBkZWJ1Z2dpbmcgc2l0dWF0aW9ucyxcbiAqIGl0J3MgdXNlZnVsIGZvciB0aGUgYXBwbGljYXRpb24gdG8gaGF2ZSBhIHdheSB0byBkaXNhYmxlIHN0cmVhbWluZyBtb2RlIGZvciBhXG4gKiB1c2VyLlxuXG4gKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHN0cmVhbWluZyBtb2RlIGlzIGFsbG93ZWQuXG4gKi9cbldlYkNoYW5uZWxCYXNlLnByb3RvdHlwZS5nZXRBbGxvd1N0cmVhbWluZ01vZGUgPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gdGhpcy5hbGxvd1N0cmVhbWluZ01vZGVfO1xufTtcblxuXG4vKipcbiAqIFNldHMgd2hldGhlciBzdHJlYW1pbmcgbW9kZSBpcyBhbGxvd2VkLiBJbiBjZXJ0YWluIGRlYnVnZ2luZyBzaXR1YXRpb25zLCBpdCdzXG4gKiB1c2VmdWwgZm9yIHRoZSBhcHBsaWNhdGlvbiB0byBoYXZlIGEgd2F5IHRvIGRpc2FibGUgc3RyZWFtaW5nIG1vZGUgZm9yIGFcbiAqIHVzZXIuXG4gKiBAcGFyYW0ge2Jvb2xlYW59IGFsbG93U3RyZWFtaW5nTW9kZSAgV2hldGhlciBzdHJlYW1pbmcgbW9kZSBpcyBhbGxvd2VkLlxuICovXG5XZWJDaGFubmVsQmFzZS5wcm90b3R5cGUuc2V0QWxsb3dTdHJlYW1pbmdNb2RlID0gZnVuY3Rpb24oYWxsb3dTdHJlYW1pbmdNb2RlKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgdGhpcy5hbGxvd1N0cmVhbWluZ01vZGVfID0gYWxsb3dTdHJlYW1pbmdNb2RlO1xufTtcblxuXG4vKipcbiAqIFNlbmRzIGEgcmVxdWVzdCB0byB0aGUgc2VydmVyLiBUaGUgZm9ybWF0IG9mIHRoZSByZXF1ZXN0IGlzIGEgTWFwIGRhdGFcbiAqIHN0cnVjdHVyZSBvZiBrZXkvdmFsdWUgcGFpcnMuIFRoZXNlIG1hcHMgYXJlIHRoZW4gZW5jb2RlZCBpbiBhIGZvcm1hdFxuICogc3VpdGFibGUgZm9yIHRoZSB3aXJlIGFuZCB0aGVuIHJlY29uc3RpdHV0ZWQgYXMgYSBNYXAgZGF0YSBzdHJ1Y3R1cmUgdGhhdFxuICogdGhlIHNlcnZlciBjYW4gcHJvY2Vzcy5cbiAqIEBwYXJhbSB7IU9iamVjdHwhZ29vZy5zdHJ1Y3RzLk1hcH0gbWFwIFRoZSBtYXAgdG8gc2VuZC5cbiAqIEBwYXJhbSB7IU9iamVjdD19IG9wdF9jb250ZXh0IFRoZSBjb250ZXh0IGFzc29jaWF0ZWQgd2l0aCB0aGUgbWFwLlxuICovXG5XZWJDaGFubmVsQmFzZS5wcm90b3R5cGUuc2VuZE1hcCA9IGZ1bmN0aW9uKG1hcCwgb3B0X2NvbnRleHQpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBnb29nLmFzc2VydHMuYXNzZXJ0KFxuICAgICAgdGhpcy5zdGF0ZV8gIT0gV2ViQ2hhbm5lbEJhc2UuU3RhdGUuQ0xPU0VELFxuICAgICAgJ0ludmFsaWQgb3BlcmF0aW9uOiBzZW5kaW5nIG1hcCB3aGVuIHN0YXRlIGlzIGNsb3NlZCcpO1xuXG4gIC8vIFdlIGNhbiBvbmx5IHNlbmQgMTAwMCBtYXBzIHBlciBQT1NULCBidXQgdHlwaWNhbGx5IHdlIHNob3VsZCBuZXZlciBoYXZlXG4gIC8vIHRoYXQgbXVjaCB0byBzZW5kLCBzbyB3YXJuIGlmIHdlIGV4Y2VlZCB0aGF0ICh3ZSBzdGlsbCBzZW5kIGFsbCB0aGUgbWFwcykuXG4gIGlmICh0aGlzLm91dGdvaW5nTWFwc18ubGVuZ3RoID09IFdlYkNoYW5uZWxCYXNlLk1BWF9NQVBTX1BFUl9SRVFVRVNUXykge1xuICAgIC8vIHNldmVyZSgpIGlzIHRlbXBvcmFyeSBzbyB0aGF0IHdlIGdldCB0aGVzZSB1cGxvYWRlZCBhbmQgY2FuIGZpZ3VyZSBvdXRcbiAgICAvLyB3aGF0J3MgY2F1c2luZyB0aGVtLiBBZnRlcndhcmRzIGNhbiBjaGFuZ2UgdG8gd2FybmluZygpLlxuICAgIHRoaXMuY2hhbm5lbERlYnVnXy5zZXZlcmUoZnVuY3Rpb24oKSB7XG4gICAgICAndXNlIHN0cmljdCc7XG4gICAgICByZXR1cm4gJ0FscmVhZHkgaGF2ZSAnICsgV2ViQ2hhbm5lbEJhc2UuTUFYX01BUFNfUEVSX1JFUVVFU1RfICtcbiAgICAgICAgICAnIHF1ZXVlZCBtYXBzIHVwb24gcXVldWVpbmcgJyArIGdvb2cuanNvbi5zZXJpYWxpemUobWFwKTtcbiAgICB9KTtcbiAgfVxuXG4gIHRoaXMub3V0Z29pbmdNYXBzXy5wdXNoKFxuICAgICAgbmV3IFdpcmUuUXVldWVkTWFwKHRoaXMubmV4dE1hcElkXysrLCBtYXAsIG9wdF9jb250ZXh0KSk7XG5cbiAgLy8gTWVzc2FnZXMgbmVlZCBiZSBidWZmZXJlZCBkdXJpbmcgT1BFTklORyB0byBhdm9pZCBzZXJ2ZXItc2lkZSByYWNlXG4gIGlmICh0aGlzLnN0YXRlXyA9PSBXZWJDaGFubmVsQmFzZS5TdGF0ZS5PUEVORUQpIHtcbiAgICB0aGlzLmVuc3VyZUZvcndhcmRDaGFubmVsXygpO1xuICB9XG59O1xuXG5cbi8qKlxuICogV2hlbiBzZXQgdG8gdHJ1ZSwgdGhpcyBjaGFuZ2VzIHRoZSBiZWhhdmlvciBvZiB0aGUgZm9yd2FyZCBjaGFubmVsIHNvIGl0XG4gKiB3aWxsIG5vdCByZXRyeSByZXF1ZXN0czsgaXQgd2lsbCBmYWlsIGFmdGVyIG9uZSBuZXR3b3JrIGZhaWx1cmUsIGFuZCBpZlxuICogdGhlcmUgd2FzIGFscmVhZHkgb25lIG5ldHdvcmsgZmFpbHVyZSwgdGhlIHJlcXVlc3Qgd2lsbCBmYWlsIGltbWVkaWF0ZWx5LlxuICogQHBhcmFtIHtib29sZWFufSBmYWlsRmFzdCAgV2hldGhlciBvciBub3QgdG8gZmFpbCBmYXN0LlxuICovXG5XZWJDaGFubmVsQmFzZS5wcm90b3R5cGUuc2V0RmFpbEZhc3QgPSBmdW5jdGlvbihmYWlsRmFzdCkge1xuICAndXNlIHN0cmljdCc7XG4gIHRoaXMuZmFpbEZhc3RfID0gZmFpbEZhc3Q7XG4gIHRoaXMuY2hhbm5lbERlYnVnXy5pbmZvKCdzZXRGYWlsRmFzdDogJyArIGZhaWxGYXN0KTtcbiAgaWYgKCh0aGlzLmZvcndhcmRDaGFubmVsUmVxdWVzdFBvb2xfLmhhc1BlbmRpbmdSZXF1ZXN0KCkgfHxcbiAgICAgICB0aGlzLmZvcndhcmRDaGFubmVsVGltZXJJZF8pICYmXG4gICAgICB0aGlzLmZvcndhcmRDaGFubmVsUmV0cnlDb3VudF8gPiB0aGlzLmdldEZvcndhcmRDaGFubmVsTWF4UmV0cmllcygpKSB7XG4gICAgY29uc3Qgc2VsZiA9IHRoaXM7XG4gICAgdGhpcy5jaGFubmVsRGVidWdfLmluZm8oZnVuY3Rpb24oKSB7XG4gICAgICAndXNlIHN0cmljdCc7XG4gICAgICByZXR1cm4gJ1JldHJ5IGNvdW50ICcgKyBzZWxmLmZvcndhcmRDaGFubmVsUmV0cnlDb3VudF8gK1xuICAgICAgICAgICcgPiBuZXcgbWF4UmV0cmllcyAnICsgc2VsZi5nZXRGb3J3YXJkQ2hhbm5lbE1heFJldHJpZXMoKSArXG4gICAgICAgICAgJy4gRmFpbCBpbW1lZGlhdGVseSEnO1xuICAgIH0pO1xuXG4gICAgaWYgKCF0aGlzLmZvcndhcmRDaGFubmVsUmVxdWVzdFBvb2xfLmZvcmNlQ29tcGxldGUoXG4gICAgICAgICAgICBnb29nLmJpbmQodGhpcy5vblJlcXVlc3RDb21wbGV0ZSwgdGhpcykpKSB7XG4gICAgICAvLyBpLmUuLCB0aGlzLmZvcndhcmRDaGFubmVsVGltZXJJZF9cbiAgICAgIHRoaXMuY2xlYXJGb3J3YXJkQ2hhbm5lbFRpbWVyXygpO1xuICAgICAgLy8gVGhlIGVycm9yIGNvZGUgZnJvbSB0aGUgbGFzdCBmYWlsZWQgcmVxdWVzdCBpcyBnb25lLCBzbyBqdXN0IHVzZSBhXG4gICAgICAvLyBnZW5lcmljIG9uZS5cbiAgICAgIHRoaXMuc2lnbmFsRXJyb3JfKFdlYkNoYW5uZWxCYXNlLkVycm9yLlJFUVVFU1RfRkFJTEVEKTtcbiAgICB9XG4gIH1cbn07XG5cblxuLyoqXG4gKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBtYXggbnVtYmVyIG9mIGZvcndhcmQtY2hhbm5lbCByZXRyaWVzLCB3aGljaCB3aWxsIGJlIDBcbiAqIGluIGZhaWwtZmFzdCBtb2RlLlxuICovXG5XZWJDaGFubmVsQmFzZS5wcm90b3R5cGUuZ2V0Rm9yd2FyZENoYW5uZWxNYXhSZXRyaWVzID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmV0dXJuIHRoaXMuZmFpbEZhc3RfID8gMCA6IHRoaXMuZm9yd2FyZENoYW5uZWxNYXhSZXRyaWVzXztcbn07XG5cblxuLyoqXG4gKiBTZXRzIHRoZSBtYXhpbXVtIG51bWJlciBvZiBhdHRlbXB0cyB0byBjb25uZWN0IHRvIHRoZSBzZXJ2ZXIgZm9yIGZvcndhcmRcbiAqIGNoYW5uZWwgcmVxdWVzdHMuXG4gKiBAcGFyYW0ge251bWJlcn0gcmV0cmllcyBUaGUgbWF4aW11bSBudW1iZXIgb2YgYXR0ZW1wdHMuXG4gKi9cbldlYkNoYW5uZWxCYXNlLnByb3RvdHlwZS5zZXRGb3J3YXJkQ2hhbm5lbE1heFJldHJpZXMgPSBmdW5jdGlvbihyZXRyaWVzKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgdGhpcy5mb3J3YXJkQ2hhbm5lbE1heFJldHJpZXNfID0gcmV0cmllcztcbn07XG5cblxuLyoqXG4gKiBTZXRzIHRoZSB0aW1lb3V0IGZvciBhIGZvcndhcmQgY2hhbm5lbCByZXF1ZXN0LlxuICogQHBhcmFtIHtudW1iZXJ9IHRpbWVvdXRNcyBUaGUgdGltZW91dCBpbiBtaWxsaXNlY29uZHMuXG4gKi9cbldlYkNoYW5uZWxCYXNlLnByb3RvdHlwZS5zZXRGb3J3YXJkQ2hhbm5lbFJlcXVlc3RUaW1lb3V0ID0gZnVuY3Rpb24odGltZW91dE1zKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgdGhpcy5mb3J3YXJkQ2hhbm5lbFJlcXVlc3RUaW1lb3V0TXNfID0gdGltZW91dE1zO1xufTtcblxuXG4vKipcbiAqIEByZXR1cm4ge251bWJlcn0gVGhlIG1heCBudW1iZXIgb2YgYmFjay1jaGFubmVsIHJldHJpZXMsIHdoaWNoIGlzIGEgY29uc3RhbnQuXG4gKi9cbldlYkNoYW5uZWxCYXNlLnByb3RvdHlwZS5nZXRCYWNrQ2hhbm5lbE1heFJldHJpZXMgPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICAvLyBCYWNrLWNoYW5uZWwgcmV0cmllcyBpcyBhIGNvbnN0YW50LlxuICByZXR1cm4gV2ViQ2hhbm5lbEJhc2UuQkFDS19DSEFOTkVMX01BWF9SRVRSSUVTO1xufTtcblxuXG4vKipcbiAqIEBvdmVycmlkZVxuICovXG5XZWJDaGFubmVsQmFzZS5wcm90b3R5cGUuaXNDbG9zZWQgPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gdGhpcy5zdGF0ZV8gPT0gV2ViQ2hhbm5lbEJhc2UuU3RhdGUuQ0xPU0VEO1xufTtcblxuXG4vKipcbiAqIFJldHVybnMgdGhlIGNoYW5uZWwgc3RhdGUuXG4gKiBAcmV0dXJuIHtXZWJDaGFubmVsQmFzZS5TdGF0ZX0gVGhlIGN1cnJlbnQgc3RhdGUgb2YgdGhlIGNoYW5uZWwuXG4gKi9cbldlYkNoYW5uZWxCYXNlLnByb3RvdHlwZS5nZXRTdGF0ZSA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIHJldHVybiB0aGlzLnN0YXRlXztcbn07XG5cblxuLyoqXG4gKiBSZXR1cm4gdGhlIGxhc3Qgc3RhdHVzIGNvZGUgcmVjZWl2ZWQgZm9yIGEgcmVxdWVzdC5cbiAqIEByZXR1cm4ge251bWJlcn0gVGhlIGxhc3Qgc3RhdHVzIGNvZGUgcmVjZWl2ZWQgZm9yIGEgcmVxdWVzdC5cbiAqL1xuV2ViQ2hhbm5lbEJhc2UucHJvdG90eXBlLmdldExhc3RTdGF0dXNDb2RlID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmV0dXJuIHRoaXMubGFzdFN0YXR1c0NvZGVfO1xufTtcblxuXG4vKipcbiAqIEByZXR1cm4ge251bWJlcn0gVGhlIGxhc3QgYXJyYXkgaWQgcmVjZWl2ZWQuXG4gKi9cbldlYkNoYW5uZWxCYXNlLnByb3RvdHlwZS5nZXRMYXN0QXJyYXlJZCA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIHJldHVybiB0aGlzLmxhc3RBcnJheUlkXztcbn07XG5cblxuLyoqXG4gKiBSZXR1cm5zIHdoZXRoZXIgdGhlcmUgYXJlIG91dHN0YW5kaW5nIHJlcXVlc3RzIHNlcnZpY2luZyB0aGUgY2hhbm5lbC5cbiAqIEByZXR1cm4ge2Jvb2xlYW59IHRydWUgaWYgdGhlcmUgYXJlIG91dHN0YW5kaW5nIHJlcXVlc3RzLlxuICovXG5XZWJDaGFubmVsQmFzZS5wcm90b3R5cGUuaGFzT3V0c3RhbmRpbmdSZXF1ZXN0cyA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIHJldHVybiB0aGlzLmdldE91dHN0YW5kaW5nUmVxdWVzdHNfKCkgIT0gMDtcbn07XG5cblxuLyoqXG4gKiBSZXR1cm5zIHRoZSBudW1iZXIgb2Ygb3V0c3RhbmRpbmcgcmVxdWVzdHMuXG4gKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBudW1iZXIgb2Ygb3V0c3RhbmRpbmcgcmVxdWVzdHMgdG8gdGhlIHNlcnZlci5cbiAqIEBwcml2YXRlXG4gKi9cbldlYkNoYW5uZWxCYXNlLnByb3RvdHlwZS5nZXRPdXRzdGFuZGluZ1JlcXVlc3RzXyA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIGxldCBjb3VudCA9IDA7XG4gIGlmICh0aGlzLmJhY2tDaGFubmVsUmVxdWVzdF8pIHtcbiAgICBjb3VudCsrO1xuICB9XG4gIGNvdW50ICs9IHRoaXMuZm9yd2FyZENoYW5uZWxSZXF1ZXN0UG9vbF8uZ2V0UmVxdWVzdENvdW50KCk7XG4gIHJldHVybiBjb3VudDtcbn07XG5cblxuLyoqXG4gKiBFbnN1cmVzIHRoYXQgYSBmb3J3YXJkIGNoYW5uZWwgcmVxdWVzdCBpcyBzY2hlZHVsZWQuXG4gKiBAcHJpdmF0ZVxuICovXG5XZWJDaGFubmVsQmFzZS5wcm90b3R5cGUuZW5zdXJlRm9yd2FyZENoYW5uZWxfID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgaWYgKHRoaXMuZm9yd2FyZENoYW5uZWxSZXF1ZXN0UG9vbF8uaXNGdWxsKCkpIHtcbiAgICAvLyBlbm91Z2ggY29ubmVjdGlvbiBpbiBwcm9jZXNzIC0gbm8gbmVlZCB0byBzdGFydCBhIG5ldyByZXF1ZXN0XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgaWYgKHRoaXMuZm9yd2FyZENoYW5uZWxUaW1lcklkXykge1xuICAgIC8vIG5vIG5lZWQgdG8gc3RhcnQgYSBuZXcgcmVxdWVzdCAtIG9uZSBpcyBhbHJlYWR5IHNjaGVkdWxlZFxuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIFVzZSBhc3luYy5ydW4gaW5zdGVhZCBvZiBzZXRUaW1lb3V0KDApIHRvIGF2b2lkIHRoZSAxcyBtZXNzYWdlIGRlbGF5XG4gIC8vIGZyb20gY2hyb21lL2ZpcmVmb3ggYmFja2dyb3VuZCB0YWJzXG4gIHRoaXMuZm9yd2FyZENoYW5uZWxUaW1lcklkXyA9IHRydWU7XG4gIGdvb2cuYXN5bmMucnVuKHRoaXMub25TdGFydEZvcndhcmRDaGFubmVsVGltZXJfLCB0aGlzKTtcblxuICB0aGlzLmZvcndhcmRDaGFubmVsUmV0cnlDb3VudF8gPSAwO1xufTtcblxuXG4vKipcbiAqIFNjaGVkdWxlcyBhIGZvcndhcmQtY2hhbm5lbCByZXRyeSBmb3IgdGhlIHNwZWNpZmllZCByZXF1ZXN0LCB1bmxlc3MgdGhlIG1heFxuICogcmV0cmllcyBoYXMgYmVlbiByZWFjaGVkLlxuICogQHBhcmFtIHshQ2hhbm5lbFJlcXVlc3R9IHJlcXVlc3QgVGhlIGZhaWxlZCByZXF1ZXN0IHRvIHJldHJ5LlxuICogQHJldHVybiB7Ym9vbGVhbn0gdHJ1ZSBpZmYgYSByZXRyeSB3YXMgc2NoZWR1bGVkLlxuICogQHByaXZhdGVcbiAqL1xuV2ViQ2hhbm5lbEJhc2UucHJvdG90eXBlLm1heWJlUmV0cnlGb3J3YXJkQ2hhbm5lbF8gPSBmdW5jdGlvbihyZXF1ZXN0KSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgaWYgKHRoaXMuZm9yd2FyZENoYW5uZWxSZXF1ZXN0UG9vbF8uZ2V0UmVxdWVzdENvdW50KCkgPj1cbiAgICAgIHRoaXMuZm9yd2FyZENoYW5uZWxSZXF1ZXN0UG9vbF8uZ2V0TWF4U2l6ZSgpIC1cbiAgICAgICAgICAodGhpcy5mb3J3YXJkQ2hhbm5lbFRpbWVySWRfID8gMSA6IDApKSB7XG4gICAgLy8gU2hvdWxkIGJlIGltcG9zc2libGUgdG8gYmUgY2FsbGVkIGluIHRoaXMgc3RhdGUuXG4gICAgdGhpcy5jaGFubmVsRGVidWdfLnNldmVyZSgnVW5leHBlY3RlZCByZXRyeSByZXF1ZXN0IGlzIHNjaGVkdWxlZC4nKTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBpZiAodGhpcy5mb3J3YXJkQ2hhbm5lbFRpbWVySWRfKSB7XG4gICAgdGhpcy5jaGFubmVsRGVidWdfLmRlYnVnKFxuICAgICAgICAnVXNlIHRoZSByZXRyeSByZXF1ZXN0IHRoYXQgaXMgYWxyZWFkeSBzY2hlZHVsZWQuJyk7XG4gICAgdGhpcy5vdXRnb2luZ01hcHNfID1cbiAgICAgICAgcmVxdWVzdC5nZXRQZW5kaW5nTWVzc2FnZXMoKS5jb25jYXQodGhpcy5vdXRnb2luZ01hcHNfKTtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIC8vIE5vIHJldHJ5IGZvciBvcGVuXygpIGFuZCBmYWlsLWZhc3RcbiAgaWYgKHRoaXMuc3RhdGVfID09IFdlYkNoYW5uZWxCYXNlLlN0YXRlLklOSVQgfHxcbiAgICAgIHRoaXMuc3RhdGVfID09IFdlYkNoYW5uZWxCYXNlLlN0YXRlLk9QRU5JTkcgfHxcbiAgICAgICh0aGlzLmZvcndhcmRDaGFubmVsUmV0cnlDb3VudF8gPj0gdGhpcy5nZXRGb3J3YXJkQ2hhbm5lbE1heFJldHJpZXMoKSkpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICB0aGlzLmNoYW5uZWxEZWJ1Z18uZGVidWcoJ0dvaW5nIHRvIHJldHJ5IFBPU1QnKTtcblxuICB0aGlzLmZvcndhcmRDaGFubmVsVGltZXJJZF8gPSByZXF1ZXN0U3RhdHMuc2V0VGltZW91dChcbiAgICAgIGdvb2cuYmluZCh0aGlzLm9uU3RhcnRGb3J3YXJkQ2hhbm5lbFRpbWVyXywgdGhpcywgcmVxdWVzdCksXG4gICAgICB0aGlzLmdldFJldHJ5VGltZV8odGhpcy5mb3J3YXJkQ2hhbm5lbFJldHJ5Q291bnRfKSk7XG4gIHRoaXMuZm9yd2FyZENoYW5uZWxSZXRyeUNvdW50XysrO1xuICByZXR1cm4gdHJ1ZTtcbn07XG5cblxuLyoqXG4gKiBUaW1lciBjYWxsYmFjayBmb3IgZW5zdXJlRm9yd2FyZENoYW5uZWxcbiAqIEBwYXJhbSB7Q2hhbm5lbFJlcXVlc3Q9fSBvcHRfcmV0cnlSZXF1ZXN0IEEgZmFpbGVkIHJlcXVlc3RcbiAqIHRvIHJldHJ5LlxuICogQHByaXZhdGVcbiAqL1xuV2ViQ2hhbm5lbEJhc2UucHJvdG90eXBlLm9uU3RhcnRGb3J3YXJkQ2hhbm5lbFRpbWVyXyA9IGZ1bmN0aW9uKFxuICAgIG9wdF9yZXRyeVJlcXVlc3QpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICAvLyBudWxsIGlzIHBvc3NpYmxlIGlmIHNjaGVkdWxlZCB3aXRoIGFzeW5jLnJ1blxuICBpZiAodGhpcy5mb3J3YXJkQ2hhbm5lbFRpbWVySWRfKSB7XG4gICAgdGhpcy5mb3J3YXJkQ2hhbm5lbFRpbWVySWRfID0gbnVsbDtcbiAgICB0aGlzLnN0YXJ0Rm9yd2FyZENoYW5uZWxfKG9wdF9yZXRyeVJlcXVlc3QpO1xuICB9XG59O1xuXG5cbi8qKlxuICogQmVnaW5zIGEgbmV3IGZvcndhcmQgY2hhbm5lbCBvcGVyYXRpb24gdG8gdGhlIHNlcnZlci5cbiAqIEBwYXJhbSB7Q2hhbm5lbFJlcXVlc3Q9fSBvcHRfcmV0cnlSZXF1ZXN0IEEgZmFpbGVkIHJlcXVlc3QgdG8gcmV0cnkuXG4gKiBAcHJpdmF0ZVxuICovXG5XZWJDaGFubmVsQmFzZS5wcm90b3R5cGUuc3RhcnRGb3J3YXJkQ2hhbm5lbF8gPSBmdW5jdGlvbihvcHRfcmV0cnlSZXF1ZXN0KSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgdGhpcy5jaGFubmVsRGVidWdfLmRlYnVnKCdzdGFydEZvcndhcmRDaGFubmVsXycpO1xuICBpZiAoIXRoaXMub2tUb01ha2VSZXF1ZXN0XygpKSB7XG4gICAgcmV0dXJuOyAgLy8gY2hhbm5lbCBpcyBjYW5jZWxsZWRcbiAgfSBlbHNlIGlmICh0aGlzLnN0YXRlXyA9PSBXZWJDaGFubmVsQmFzZS5TdGF0ZS5JTklUKSB7XG4gICAgaWYgKG9wdF9yZXRyeVJlcXVlc3QpIHtcbiAgICAgIHRoaXMuY2hhbm5lbERlYnVnXy5zZXZlcmUoJ05vdCBzdXBwb3NlZCB0byByZXRyeSB0aGUgb3BlbicpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLm9wZW5fKCk7XG4gICAgdGhpcy5zdGF0ZV8gPSBXZWJDaGFubmVsQmFzZS5TdGF0ZS5PUEVOSU5HO1xuICB9IGVsc2UgaWYgKHRoaXMuc3RhdGVfID09IFdlYkNoYW5uZWxCYXNlLlN0YXRlLk9QRU5FRCkge1xuICAgIGlmIChvcHRfcmV0cnlSZXF1ZXN0KSB7XG4gICAgICB0aGlzLm1ha2VGb3J3YXJkQ2hhbm5lbFJlcXVlc3RfKG9wdF9yZXRyeVJlcXVlc3QpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmICh0aGlzLm91dGdvaW5nTWFwc18ubGVuZ3RoID09IDApIHtcbiAgICAgIHRoaXMuY2hhbm5lbERlYnVnXy5kZWJ1ZyhcbiAgICAgICAgICAnc3RhcnRGb3J3YXJkQ2hhbm5lbF8gcmV0dXJuZWQ6ICcgK1xuICAgICAgICAgICdub3RoaW5nIHRvIHNlbmQnKTtcbiAgICAgIC8vIG5vIG5lZWQgdG8gc3RhcnQgYSBuZXcgZm9yd2FyZCBjaGFubmVsIHJlcXVlc3RcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5mb3J3YXJkQ2hhbm5lbFJlcXVlc3RQb29sXy5pc0Z1bGwoKSkge1xuICAgICAgLy8gU2hvdWxkIGJlIGltcG9zc2libGUgdG8gYmUgY2FsbGVkIGluIHRoaXMgc3RhdGUuXG4gICAgICB0aGlzLmNoYW5uZWxEZWJ1Z18uc2V2ZXJlKFxuICAgICAgICAgICdzdGFydEZvcndhcmRDaGFubmVsXyByZXR1cm5lZDogJyArXG4gICAgICAgICAgJ2Nvbm5lY3Rpb24gYWxyZWFkeSBpbiBwcm9ncmVzcycpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMubWFrZUZvcndhcmRDaGFubmVsUmVxdWVzdF8oKTtcbiAgICB0aGlzLmNoYW5uZWxEZWJ1Z18uZGVidWcoJ3N0YXJ0Rm9yd2FyZENoYW5uZWxfIGZpbmlzaGVkLCBzZW50IHJlcXVlc3QnKTtcbiAgfVxufTtcblxuXG4vKipcbiAqIEVzdGFibGlzaGVzIGEgbmV3IGNoYW5uZWwgc2Vzc2lvbiB3aXRoIHRoZSBzZXJ2ZXIuXG4gKiBAcHJpdmF0ZVxuICovXG5XZWJDaGFubmVsQmFzZS5wcm90b3R5cGUub3Blbl8gPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICB0aGlzLmNoYW5uZWxEZWJ1Z18uZGVidWcoJ29wZW5fKCknKTtcbiAgdGhpcy5uZXh0UmlkXyA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwMDAwMCk7XG5cbiAgY29uc3QgcmlkID0gdGhpcy5uZXh0UmlkXysrO1xuICBjb25zdCByZXF1ZXN0ID1cbiAgICAgIENoYW5uZWxSZXF1ZXN0LmNyZWF0ZUNoYW5uZWxSZXF1ZXN0KHRoaXMsIHRoaXMuY2hhbm5lbERlYnVnXywgJycsIHJpZCk7XG5cbiAgLy8gbWl4IHRoZSBpbml0IGhlYWRlcnNcbiAgbGV0IGV4dHJhSGVhZGVycyA9IHRoaXMuZXh0cmFIZWFkZXJzXztcbiAgaWYgKHRoaXMuaW5pdEhlYWRlcnNfKSB7XG4gICAgaWYgKGV4dHJhSGVhZGVycykge1xuICAgICAgZXh0cmFIZWFkZXJzID0gZ29vZy5vYmplY3QuY2xvbmUoZXh0cmFIZWFkZXJzKTtcbiAgICAgIGdvb2cub2JqZWN0LmV4dGVuZChleHRyYUhlYWRlcnMsIHRoaXMuaW5pdEhlYWRlcnNfKTtcbiAgICB9IGVsc2Uge1xuICAgICAgZXh0cmFIZWFkZXJzID0gdGhpcy5pbml0SGVhZGVyc187XG4gICAgfVxuICB9XG5cbiAgaWYgKHRoaXMuaHR0cEhlYWRlcnNPdmVyd3JpdGVQYXJhbV8gPT09IG51bGwpIHtcbiAgICByZXF1ZXN0LnNldEV4dHJhSGVhZGVycyhleHRyYUhlYWRlcnMpO1xuICB9XG5cbiAgY29uc3QgcmVxdWVzdFRleHQgPSB0aGlzLmRlcXVldWVPdXRnb2luZ01hcHNfKFxuICAgICAgcmVxdWVzdCxcbiAgICAgIHRoaXMuZmFzdEhhbmRzaGFrZV8gPyB0aGlzLmdldE1heE51bU1lc3NhZ2VzRm9yRmFzdEhhbmRzaGFrZV8oKSA6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgV2ViQ2hhbm5lbEJhc2UuTUFYX01BUFNfUEVSX1JFUVVFU1RfKTtcblxuICBjb25zdCB1cmkgPSB0aGlzLmZvcndhcmRDaGFubmVsVXJpXy5jbG9uZSgpO1xuICB1cmkuc2V0UGFyYW1ldGVyVmFsdWUoJ1JJRCcsIHJpZCk7XG5cbiAgaWYgKHRoaXMuY2xpZW50VmVyc2lvbl8gPiAwKSB7XG4gICAgdXJpLnNldFBhcmFtZXRlclZhbHVlKCdDVkVSJywgdGhpcy5jbGllbnRWZXJzaW9uXyk7XG4gIH1cblxuICAvLyBodHRwLXNlc3Npb24taWQgdG8gYmUgZ2VuZXJhdGVkIGFzIHRoZSByZXNwb25zZVxuICBpZiAodGhpcy5nZXRIdHRwU2Vzc2lvbklkUGFyYW0oKSkge1xuICAgIHVyaS5zZXRQYXJhbWV0ZXJWYWx1ZShcbiAgICAgICAgV2ViQ2hhbm5lbC5YX0hUVFBfU0VTU0lPTl9JRCwgdGhpcy5nZXRIdHRwU2Vzc2lvbklkUGFyYW0oKSk7XG4gIH1cblxuICAvLyBBZGQgdGhlIHJlY29ubmVjdCBwYXJhbWV0ZXJzLlxuICB0aGlzLmFkZEFkZGl0aW9uYWxQYXJhbXNfKHVyaSk7XG5cbiAgaWYgKHRoaXMuaHR0cEhlYWRlcnNPdmVyd3JpdGVQYXJhbV8gJiYgZXh0cmFIZWFkZXJzKSB7XG4gICAgaHR0cENvcnMuc2V0SHR0cEhlYWRlcnNXaXRoT3ZlcndyaXRlUGFyYW0oXG4gICAgICAgIHVyaSwgdGhpcy5odHRwSGVhZGVyc092ZXJ3cml0ZVBhcmFtXywgZXh0cmFIZWFkZXJzKTtcbiAgfVxuXG4gIHRoaXMuZm9yd2FyZENoYW5uZWxSZXF1ZXN0UG9vbF8uYWRkUmVxdWVzdChyZXF1ZXN0KTtcblxuICBpZiAodGhpcy5ibG9ja2luZ0hhbmRzaGFrZV8pIHtcbiAgICB1cmkuc2V0UGFyYW1ldGVyVmFsdWUoJ1RZUEUnLCAnaW5pdCcpOyAgLy8gZGVmYXVsdCB0byBibG9ja2luZyBpbiBmdXR1cmVcbiAgfVxuXG4gIC8vIENoZWNrIHRoZSBvcHRpb24gYW5kIHVzZSBHRVQgdG8gZW5hYmxlIFFVSUMgMC1SVFRcbiAgaWYgKHRoaXMuZmFzdEhhbmRzaGFrZV8pIHtcbiAgICB1cmkuc2V0UGFyYW1ldGVyVmFsdWUoJyRyZXEnLCByZXF1ZXN0VGV4dCk7XG5cbiAgICAvLyBlbmFibGUgaGFuZHNoYWtlIHVwZ3JhZGVcbiAgICB1cmkuc2V0UGFyYW1ldGVyVmFsdWUoJ1NJRCcsICdudWxsJyk7XG4gICAgcmVxdWVzdC5zZXREZWNvZGVJbml0aWFsUmVzcG9uc2UoKTtcblxuICAgIHJlcXVlc3QueG1sSHR0cFBvc3QodXJpLCBudWxsLCB0cnVlKTsgIC8vIFNlbmQgYXMgYSBHRVRcbiAgfSBlbHNlIHtcbiAgICByZXF1ZXN0LnhtbEh0dHBQb3N0KHVyaSwgcmVxdWVzdFRleHQsIHRydWUpO1xuICB9XG59O1xuXG5cbi8qKlxuICogQHJldHVybiB7bnVtYmVyfSBUaGUgbnVtYmVyIG9mIHJhdyBKU09OIG1lc3NhZ2VzIHRvIGJlIGVuY29kZWRcbiAqIHdpdGggdGhlIGZhc3QtaGFuZHNoYWtlIChHRVQpIHJlcXVlc3QsIGluY2x1ZGluZyB6ZXJvLiBJZiBtZXNzYWdlcyBhcmUgbm90XG4gKiBlbmNvZGVkIGFzIHJhdyBKU09OIGRhdGEsIHJldHVybiBXZWJDaGFubmVsQmFzZS5NQVhfTUFQU19QRVJfUkVRVUVTVF9cbiAqIEBwcml2YXRlXG4gKi9cbldlYkNoYW5uZWxCYXNlLnByb3RvdHlwZS5nZXRNYXhOdW1NZXNzYWdlc0ZvckZhc3RIYW5kc2hha2VfID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgbGV0IHRvdGFsID0gMDtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLm91dGdvaW5nTWFwc18ubGVuZ3RoOyBpKyspIHtcbiAgICBjb25zdCBtYXAgPSB0aGlzLm91dGdvaW5nTWFwc19baV07XG4gICAgY29uc3Qgc2l6ZSA9IG1hcC5nZXRSYXdEYXRhU2l6ZSgpO1xuICAgIGlmIChzaXplID09PSB1bmRlZmluZWQpIHtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgICB0b3RhbCArPSBzaXplO1xuXG4gICAgaWYgKHRvdGFsID4gV2ViQ2hhbm5lbEJhc2UuTUFYX0NIQVJTX1BFUl9HRVRfKSB7XG4gICAgICByZXR1cm4gaTtcbiAgICB9XG5cbiAgICBpZiAodG90YWwgPT09IFdlYkNoYW5uZWxCYXNlLk1BWF9DSEFSU19QRVJfR0VUXyB8fFxuICAgICAgICBpID09PSB0aGlzLm91dGdvaW5nTWFwc18ubGVuZ3RoIC0gMSkge1xuICAgICAgcmV0dXJuIGkgKyAxO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBXZWJDaGFubmVsQmFzZS5NQVhfTUFQU19QRVJfUkVRVUVTVF87XG59O1xuXG5cblxuLyoqXG4gKiBNYWtlcyBhIGZvcndhcmQgY2hhbm5lbCByZXF1ZXN0IHVzaW5nIFhNTEhUVFAuXG4gKiBAcGFyYW0geyFDaGFubmVsUmVxdWVzdD19IG9wdF9yZXRyeVJlcXVlc3QgQSBmYWlsZWQgcmVxdWVzdCB0byByZXRyeS5cbiAqIEBwcml2YXRlXG4gKi9cbldlYkNoYW5uZWxCYXNlLnByb3RvdHlwZS5tYWtlRm9yd2FyZENoYW5uZWxSZXF1ZXN0XyA9IGZ1bmN0aW9uKFxuICAgIG9wdF9yZXRyeVJlcXVlc3QpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBsZXQgcmlkO1xuICBpZiAob3B0X3JldHJ5UmVxdWVzdCkge1xuICAgIHJpZCA9IG9wdF9yZXRyeVJlcXVlc3QuZ2V0UmVxdWVzdElkKCk7ICAvLyBSZXVzZSB0aGUgc2FtZSBSSUQgZm9yIGEgcmV0cnlcbiAgfSBlbHNlIHtcbiAgICByaWQgPSB0aGlzLm5leHRSaWRfKys7XG4gIH1cblxuICBjb25zdCB1cmkgPSB0aGlzLmZvcndhcmRDaGFubmVsVXJpXy5jbG9uZSgpO1xuICB1cmkuc2V0UGFyYW1ldGVyVmFsdWUoJ1NJRCcsIHRoaXMuc2lkXyk7XG4gIHVyaS5zZXRQYXJhbWV0ZXJWYWx1ZSgnUklEJywgcmlkKTtcbiAgdXJpLnNldFBhcmFtZXRlclZhbHVlKCdBSUQnLCB0aGlzLmxhc3RBcnJheUlkXyk7XG4gIC8vIEFkZCB0aGUgYWRkaXRpb25hbCByZWNvbm5lY3QgcGFyYW1ldGVycy5cbiAgdGhpcy5hZGRBZGRpdGlvbmFsUGFyYW1zXyh1cmkpO1xuXG4gIGlmICh0aGlzLmh0dHBIZWFkZXJzT3ZlcndyaXRlUGFyYW1fICYmIHRoaXMuZXh0cmFIZWFkZXJzXykge1xuICAgIGh0dHBDb3JzLnNldEh0dHBIZWFkZXJzV2l0aE92ZXJ3cml0ZVBhcmFtKFxuICAgICAgICB1cmksIHRoaXMuaHR0cEhlYWRlcnNPdmVyd3JpdGVQYXJhbV8sIHRoaXMuZXh0cmFIZWFkZXJzXyk7XG4gIH1cblxuICBjb25zdCByZXF1ZXN0ID0gQ2hhbm5lbFJlcXVlc3QuY3JlYXRlQ2hhbm5lbFJlcXVlc3QoXG4gICAgICB0aGlzLCB0aGlzLmNoYW5uZWxEZWJ1Z18sIHRoaXMuc2lkXywgcmlkLFxuICAgICAgdGhpcy5mb3J3YXJkQ2hhbm5lbFJldHJ5Q291bnRfICsgMSk7XG5cbiAgaWYgKHRoaXMuaHR0cEhlYWRlcnNPdmVyd3JpdGVQYXJhbV8gPT09IG51bGwpIHtcbiAgICByZXF1ZXN0LnNldEV4dHJhSGVhZGVycyh0aGlzLmV4dHJhSGVhZGVyc18pO1xuICB9XG5cbiAgbGV0IHJlcXVlc3RUZXh0O1xuICBpZiAob3B0X3JldHJ5UmVxdWVzdCkge1xuICAgIHRoaXMucmVxdWV1ZVBlbmRpbmdNYXBzXyhvcHRfcmV0cnlSZXF1ZXN0KTtcbiAgfVxuICByZXF1ZXN0VGV4dCA9XG4gICAgICB0aGlzLmRlcXVldWVPdXRnb2luZ01hcHNfKHJlcXVlc3QsIFdlYkNoYW5uZWxCYXNlLk1BWF9NQVBTX1BFUl9SRVFVRVNUXyk7XG5cbiAgLy8gUmFuZG9taXplIGZyb20gNTAlLTEwMCUgb2YgdGhlIGZvcndhcmQgY2hhbm5lbCB0aW1lb3V0IHRvIGF2b2lkXG4gIC8vIGEgYmlnIGhpdCBpZiBzZXJ2ZXJzIGhhcHBlbiB0byBkaWUgYXQgb25jZS5cbiAgcmVxdWVzdC5zZXRUaW1lb3V0KFxuICAgICAgTWF0aC5yb3VuZCh0aGlzLmZvcndhcmRDaGFubmVsUmVxdWVzdFRpbWVvdXRNc18gKiAwLjUwKSArXG4gICAgICBNYXRoLnJvdW5kKHRoaXMuZm9yd2FyZENoYW5uZWxSZXF1ZXN0VGltZW91dE1zXyAqIDAuNTAgKiBNYXRoLnJhbmRvbSgpKSk7XG4gIHRoaXMuZm9yd2FyZENoYW5uZWxSZXF1ZXN0UG9vbF8uYWRkUmVxdWVzdChyZXF1ZXN0KTtcbiAgcmVxdWVzdC54bWxIdHRwUG9zdCh1cmksIHJlcXVlc3RUZXh0LCB0cnVlKTtcbn07XG5cblxuLyoqXG4gKiBBZGRzIHRoZSBhZGRpdGlvbmFsIHBhcmFtZXRlcnMgZnJvbSB0aGUgaGFuZGxlciB0byB0aGUgZ2l2ZW4gVVJJLlxuICogQHBhcmFtIHshZ29vZy5Vcml9IHVyaSBUaGUgVVJJIHRvIGFkZCB0aGUgcGFyYW1ldGVycyB0by5cbiAqIEBwcml2YXRlXG4gKi9cbldlYkNoYW5uZWxCYXNlLnByb3RvdHlwZS5hZGRBZGRpdGlvbmFsUGFyYW1zXyA9IGZ1bmN0aW9uKHVyaSkge1xuICAndXNlIHN0cmljdCc7XG4gIC8vIEFkZCB0aGUgYWRkaXRpb25hbCByZWNvbm5lY3QgcGFyYW1ldGVycyBhcyBuZWVkZWQuXG4gIGlmICh0aGlzLmhhbmRsZXJfKSB7XG4gICAgY29uc3QgcGFyYW1zID0gdGhpcy5oYW5kbGVyXy5nZXRBZGRpdGlvbmFsUGFyYW1zKHRoaXMpO1xuICAgIGlmIChwYXJhbXMpIHtcbiAgICAgIGdvb2cuc3RydWN0cy5mb3JFYWNoKHBhcmFtcywgZnVuY3Rpb24odmFsdWUsIGtleSwgY29sbCkge1xuICAgICAgICAndXNlIHN0cmljdCc7XG4gICAgICAgIHVyaS5zZXRQYXJhbWV0ZXJWYWx1ZShrZXksIHZhbHVlKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxufTtcblxuXG4vKipcbiAqIFJldHVybnMgdGhlIHJlcXVlc3QgdGV4dCBmcm9tIHRoZSBvdXRnb2luZyBtYXBzIGFuZCByZXNldHMgaXQuXG4gKiBAcGFyYW0geyFDaGFubmVsUmVxdWVzdH0gcmVxdWVzdCBUaGUgbmV3IHJlcXVlc3QgZm9yIHNlbmRpbmcgdGhlIG1lc3NhZ2VzLlxuICogQHBhcmFtIHtudW1iZXJ9IG1heE51bSBUaGUgbWF4aW11bSBudW1iZXIgb2YgbWVzc2FnZXMgdG8gYmUgZW5jb2RlZFxuICogQHJldHVybiB7c3RyaW5nfSBUaGUgZW5jb2RlZCByZXF1ZXN0IHRleHQgY3JlYXRlZCBmcm9tIGFsbCB0aGUgY3VycmVudGx5XG4gKiAgICAgICAgICAgICAgICAgIHF1ZXVlZCBvdXRnb2luZyBtYXBzLlxuICogQHByaXZhdGVcbiAqL1xuV2ViQ2hhbm5lbEJhc2UucHJvdG90eXBlLmRlcXVldWVPdXRnb2luZ01hcHNfID0gZnVuY3Rpb24ocmVxdWVzdCwgbWF4TnVtKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgY29uc3QgY291bnQgPSBNYXRoLm1pbih0aGlzLm91dGdvaW5nTWFwc18ubGVuZ3RoLCBtYXhOdW0pO1xuXG4gIGNvbnN0IGJhZE1hcEhhbmRsZXIgPSB0aGlzLmhhbmRsZXJfID9cbiAgICAgIGdvb2cuYmluZCh0aGlzLmhhbmRsZXJfLmJhZE1hcEVycm9yLCB0aGlzLmhhbmRsZXJfLCB0aGlzKSA6XG4gICAgICBudWxsO1xuICBjb25zdCByZXN1bHQgPSB0aGlzLndpcmVDb2RlY18uZW5jb2RlTWVzc2FnZVF1ZXVlKFxuICAgICAgdGhpcy5vdXRnb2luZ01hcHNfLCBjb3VudCwgYmFkTWFwSGFuZGxlcik7XG5cbiAgcmVxdWVzdC5zZXRQZW5kaW5nTWVzc2FnZXModGhpcy5vdXRnb2luZ01hcHNfLnNwbGljZSgwLCBjb3VudCkpO1xuXG4gIHJldHVybiByZXN1bHQ7XG59O1xuXG5cbi8qKlxuICogUmVxdWV1ZXMgdW5hY2tub3dsZWRnZWQgc2VudCBhcnJheXMgZm9yIHJldHJhbnNtaXNzaW9uIGluIHRoZSBuZXh0IGZvcndhcmRcbiAqIGNoYW5uZWwgcmVxdWVzdC5cbiAqIEBwYXJhbSB7IUNoYW5uZWxSZXF1ZXN0fSByZXRyeVJlcXVlc3QgQSBmYWlsZWQgcmVxdWVzdCB0byByZXRyeS5cbiAqIEBwcml2YXRlXG4gKi9cbldlYkNoYW5uZWxCYXNlLnByb3RvdHlwZS5yZXF1ZXVlUGVuZGluZ01hcHNfID0gZnVuY3Rpb24ocmV0cnlSZXF1ZXN0KSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgdGhpcy5vdXRnb2luZ01hcHNfID1cbiAgICAgIHJldHJ5UmVxdWVzdC5nZXRQZW5kaW5nTWVzc2FnZXMoKS5jb25jYXQodGhpcy5vdXRnb2luZ01hcHNfKTtcbn07XG5cblxuLyoqXG4gKiBFbnN1cmVzIHRoZXJlIGlzIGEgYmFja2NoYW5uZWwgcmVxdWVzdCBmb3IgcmVjZWl2aW5nIGRhdGEgZnJvbSB0aGUgc2VydmVyLlxuICogQHByaXZhdGVcbiAqL1xuV2ViQ2hhbm5lbEJhc2UucHJvdG90eXBlLmVuc3VyZUJhY2tDaGFubmVsXyA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIGlmICh0aGlzLmJhY2tDaGFubmVsUmVxdWVzdF8pIHtcbiAgICAvLyBhbHJlYWR5IGhhdmUgb25lXG4gICAgcmV0dXJuO1xuICB9XG5cbiAgaWYgKHRoaXMuYmFja0NoYW5uZWxUaW1lcklkXykge1xuICAgIC8vIG5vIG5lZWQgdG8gc3RhcnQgYSBuZXcgcmVxdWVzdCAtIG9uZSBpcyBhbHJlYWR5IHNjaGVkdWxlZFxuICAgIHJldHVybjtcbiAgfVxuXG4gIHRoaXMuYmFja0NoYW5uZWxBdHRlbXB0SWRfID0gMTtcblxuICAvLyBVc2UgYXN5bmMucnVuIGluc3RlYWQgb2Ygc2V0VGltZW91dCgwKSB0byBhdm9pZCB0aGUgMXMgbWVzc2FnZSBkZWxheVxuICAvLyBmcm9tIGNocm9tZS9maXJlZm94IGJhY2tncm91bmQgdGFic1xuICAvLyBiYWNrQ2hhbm5lbFRpbWVySWRfIHN0YXlzIHVuc2V0LCBhcyB3aXRoIHNldFRpbWVvdXQoMClcbiAgZ29vZy5hc3luYy5ydW4odGhpcy5vblN0YXJ0QmFja0NoYW5uZWxUaW1lcl8sIHRoaXMpO1xuXG4gIHRoaXMuYmFja0NoYW5uZWxSZXRyeUNvdW50XyA9IDA7XG59O1xuXG5cbi8qKlxuICogU2NoZWR1bGVzIGEgYmFjay1jaGFubmVsIHJldHJ5LCB1bmxlc3MgdGhlIG1heCByZXRyaWVzIGhhcyBiZWVuIHJlYWNoZWQuXG4gKiBAcmV0dXJuIHtib29sZWFufSB0cnVlIGlmZiBhIHJldHJ5IHdhcyBzY2hlZHVsZWQuXG4gKiBAcHJpdmF0ZVxuICovXG5XZWJDaGFubmVsQmFzZS5wcm90b3R5cGUubWF5YmVSZXRyeUJhY2tDaGFubmVsXyA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIGlmICh0aGlzLmJhY2tDaGFubmVsUmVxdWVzdF8gfHwgdGhpcy5iYWNrQ2hhbm5lbFRpbWVySWRfKSB7XG4gICAgLy8gU2hvdWxkIGJlIGltcG9zc2libGUgdG8gYmUgY2FsbGVkIGluIHRoaXMgc3RhdGUuXG4gICAgdGhpcy5jaGFubmVsRGVidWdfLnNldmVyZSgnUmVxdWVzdCBhbHJlYWR5IGluIHByb2dyZXNzJyk7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgaWYgKHRoaXMuYmFja0NoYW5uZWxSZXRyeUNvdW50XyA+PSB0aGlzLmdldEJhY2tDaGFubmVsTWF4UmV0cmllcygpKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgdGhpcy5jaGFubmVsRGVidWdfLmRlYnVnKCdHb2luZyB0byByZXRyeSBHRVQnKTtcblxuICB0aGlzLmJhY2tDaGFubmVsQXR0ZW1wdElkXysrO1xuICB0aGlzLmJhY2tDaGFubmVsVGltZXJJZF8gPSByZXF1ZXN0U3RhdHMuc2V0VGltZW91dChcbiAgICAgIGdvb2cuYmluZCh0aGlzLm9uU3RhcnRCYWNrQ2hhbm5lbFRpbWVyXywgdGhpcyksXG4gICAgICB0aGlzLmdldFJldHJ5VGltZV8odGhpcy5iYWNrQ2hhbm5lbFJldHJ5Q291bnRfKSk7XG4gIHRoaXMuYmFja0NoYW5uZWxSZXRyeUNvdW50XysrO1xuICByZXR1cm4gdHJ1ZTtcbn07XG5cblxuLyoqXG4gKiBUaW1lciBjYWxsYmFjayBmb3IgZW5zdXJlQmFja0NoYW5uZWxfLlxuICogQHByaXZhdGVcbiAqL1xuV2ViQ2hhbm5lbEJhc2UucHJvdG90eXBlLm9uU3RhcnRCYWNrQ2hhbm5lbFRpbWVyXyA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIHRoaXMuYmFja0NoYW5uZWxUaW1lcklkXyA9IG51bGw7XG4gIHRoaXMuc3RhcnRCYWNrQ2hhbm5lbF8oKTtcblxuICBpZiAoIXRoaXMuZGV0ZWN0QnVmZmVyaW5nUHJveHlfKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgaWYgKHRoaXMuYnBEZXRlY3Rpb25Eb25lXykge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGlmICh0aGlzLmJhY2tDaGFubmVsUmVxdWVzdF8gPT0gbnVsbCB8fCB0aGlzLmhhbmRzaGFrZVJ0dE1zXyA8PSAwKSB7XG4gICAgdGhpcy5jaGFubmVsRGVidWdfLndhcm5pbmcoXG4gICAgICAgICdTa2lwIGJwRGV0ZWN0aW9uVGltZXJJZF8gJyArIHRoaXMuYmFja0NoYW5uZWxSZXF1ZXN0XyArICcgJyArXG4gICAgICAgIHRoaXMuaGFuZHNoYWtlUnR0TXNfKTtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBUaGlzIGdvZXMgd2l0aCBlYWNoIG5ldyByZXF1ZXN0IHVudGlsIGJwRGV0ZWN0aW9uRG9uZV9cbiAgY29uc3QgYnBEZXRlY3Rpb25UaW1lb3V0ID0gMiAqIHRoaXMuaGFuZHNoYWtlUnR0TXNfO1xuICB0aGlzLmNoYW5uZWxEZWJ1Z18uaW5mbygnQlAgZGV0ZWN0aW9uIHRpbWVyIGVuYWJsZWQ6ICcgKyBicERldGVjdGlvblRpbWVvdXQpO1xuXG4gIHRoaXMuYnBEZXRlY3Rpb25UaW1lcklkXyA9IHJlcXVlc3RTdGF0cy5zZXRUaW1lb3V0KFxuICAgICAgZ29vZy5iaW5kKHRoaXMub25CcERldGVjdGlvblRpbWVyXywgdGhpcyksIGJwRGV0ZWN0aW9uVGltZW91dCk7XG59O1xuXG5cbi8qKlxuICogVGltZXIgY2FsbGJhY2sgZm9yIGJwRGV0ZWN0aW9uLlxuICogQHByaXZhdGVcbiAqL1xuV2ViQ2hhbm5lbEJhc2UucHJvdG90eXBlLm9uQnBEZXRlY3Rpb25UaW1lcl8gPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBpZiAoIXRoaXMuYnBEZXRlY3Rpb25UaW1lcklkXykge1xuICAgIHRoaXMuY2hhbm5lbERlYnVnXy53YXJuaW5nKCdJbnZhbGlkIG9wZXJhdGlvbi4nKTtcbiAgICByZXR1cm47XG4gIH1cblxuICB0aGlzLmJwRGV0ZWN0aW9uVGltZXJJZF8gPSBudWxsO1xuICB0aGlzLmNoYW5uZWxEZWJ1Z18uaW5mbygnQlAgZGV0ZWN0aW9uIHRpbWVvdXQgcmVhY2hlZC4nKTtcblxuICBnb29nLmFzc2VydHMuYXNzZXJ0KFxuICAgICAgdGhpcy5iYWNrQ2hhbm5lbFJlcXVlc3RfICE9IG51bGwsXG4gICAgICAnSW52YWxpZCBzdGF0ZTogbm8gYmFja2NoYW5uZWwgcmVxdWVzdCcpO1xuXG4gIC8vIFdlIHdhaXQgZm9yIGV4dHJhIHJlc3BvbnNlIHBheWxvYWQgaW4gYWRkaXRpb24gdG8ganVzdCBoZWFkZXJzIHRvXG4gIC8vIGNhbmNlbCB0aGUgdGltZXIuXG4gIGlmICh0aGlzLmJhY2tDaGFubmVsUmVxdWVzdF8uZ2V0WGhyKCkgIT0gbnVsbCkge1xuICAgIGNvbnN0IHJlc3BvbnNlRGF0YSA9IHRoaXMuYmFja0NoYW5uZWxSZXF1ZXN0Xy5nZXRYaHIoKS5nZXRSZXNwb25zZVRleHQoKTtcbiAgICBpZiAocmVzcG9uc2VEYXRhKSB7XG4gICAgICB0aGlzLmNoYW5uZWxEZWJ1Z18ud2FybmluZyhcbiAgICAgICAgICAnVGltZXIgc2hvdWxkIGhhdmUgYmVlbiBjYW5jZWxsZWQgOiAnICsgcmVzcG9uc2VEYXRhKTtcbiAgICB9XG4gIH1cblxuICAvLyBFbmFibGUgbG9uZy1wb2xsaW5nXG4gIHRoaXMuY2hhbm5lbERlYnVnXy5pbmZvKFxuICAgICAgJ0J1ZmZlcmluZyBwcm94eSBkZXRlY3RlZCBhbmQgc3dpdGNoIHRvIGxvbmctcG9sbGluZyEnKTtcbiAgdGhpcy5lbmFibGVTdHJlYW1pbmdfID0gZmFsc2U7XG5cbiAgdGhpcy5icERldGVjdGlvbkRvbmVfID0gdHJ1ZTtcbiAgcmVxdWVzdFN0YXRzLm5vdGlmeVN0YXRFdmVudChyZXF1ZXN0U3RhdHMuU3RhdC5QUk9YWSk7XG5cbiAgLy8gQ2FuY2VsIHRoZSByZXF1ZXN0IGFuZCBzdGFydCBhIG5ldyBvbmUgaW1tZWRpYXRlbHlcbiAgdGhpcy5jYW5jZWxCYWNrQ2hhbm5lbFJlcXVlc3RfKCk7XG4gIHRoaXMuc3RhcnRCYWNrQ2hhbm5lbF8oKTtcbn07XG5cblxuLyoqXG4gKiBDbGVhcnMgdGhlIHRpbWVyIGZvciBCUCBkZXRlY3Rpb24uXG4gKiBAcHJpdmF0ZVxuICovXG5XZWJDaGFubmVsQmFzZS5wcm90b3R5cGUuY2xlYXJCcERldGVjdGlvblRpbWVyXyA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIGlmICh0aGlzLmJwRGV0ZWN0aW9uVGltZXJJZF8gIT0gbnVsbCkge1xuICAgIHRoaXMuY2hhbm5lbERlYnVnXy5kZWJ1ZygnQ2FuY2VsIHRoZSBCUCBkZXRlY3Rpb24gdGltZXIuJyk7XG4gICAgZ29vZy5nbG9iYWwuY2xlYXJUaW1lb3V0KHRoaXMuYnBEZXRlY3Rpb25UaW1lcklkXyk7XG4gICAgdGhpcy5icERldGVjdGlvblRpbWVySWRfID0gbnVsbDtcbiAgfVxufTtcblxuXG4vKipcbiAqIEJlZ2lucyBhIG5ldyBiYWNrIGNoYW5uZWwgb3BlcmF0aW9uIHRvIHRoZSBzZXJ2ZXIuXG4gKiBAcHJpdmF0ZVxuICovXG5XZWJDaGFubmVsQmFzZS5wcm90b3R5cGUuc3RhcnRCYWNrQ2hhbm5lbF8gPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBpZiAoIXRoaXMub2tUb01ha2VSZXF1ZXN0XygpKSB7XG4gICAgLy8gY2hhbm5lbCBpcyBjYW5jZWxsZWRcbiAgICByZXR1cm47XG4gIH1cblxuICB0aGlzLmNoYW5uZWxEZWJ1Z18uZGVidWcoJ0NyZWF0aW5nIG5ldyBIdHRwUmVxdWVzdCcpO1xuICB0aGlzLmJhY2tDaGFubmVsUmVxdWVzdF8gPSBDaGFubmVsUmVxdWVzdC5jcmVhdGVDaGFubmVsUmVxdWVzdChcbiAgICAgIHRoaXMsIHRoaXMuY2hhbm5lbERlYnVnXywgdGhpcy5zaWRfLCAncnBjJywgdGhpcy5iYWNrQ2hhbm5lbEF0dGVtcHRJZF8pO1xuXG4gIGlmICh0aGlzLmh0dHBIZWFkZXJzT3ZlcndyaXRlUGFyYW1fID09PSBudWxsKSB7XG4gICAgdGhpcy5iYWNrQ2hhbm5lbFJlcXVlc3RfLnNldEV4dHJhSGVhZGVycyh0aGlzLmV4dHJhSGVhZGVyc18pO1xuICB9XG5cbiAgdGhpcy5iYWNrQ2hhbm5lbFJlcXVlc3RfLnNldFJlYWR5U3RhdGVDaGFuZ2VUaHJvdHRsZShcbiAgICAgIHRoaXMucmVhZHlTdGF0ZUNoYW5nZVRocm90dGxlTXNfKTtcbiAgY29uc3QgdXJpID0gdGhpcy5iYWNrQ2hhbm5lbFVyaV8uY2xvbmUoKTtcbiAgdXJpLnNldFBhcmFtZXRlclZhbHVlKCdSSUQnLCAncnBjJyk7XG4gIHVyaS5zZXRQYXJhbWV0ZXJWYWx1ZSgnU0lEJywgdGhpcy5zaWRfKTtcbiAgdXJpLnNldFBhcmFtZXRlclZhbHVlKCdDSScsIHRoaXMuZW5hYmxlU3RyZWFtaW5nXyA/ICcwJyA6ICcxJyk7XG4gIHVyaS5zZXRQYXJhbWV0ZXJWYWx1ZSgnQUlEJywgdGhpcy5sYXN0QXJyYXlJZF8pO1xuXG4gIC8vIEFkZCB0aGUgcmVjb25uZWN0IHBhcmFtZXRlcnMuXG4gIHRoaXMuYWRkQWRkaXRpb25hbFBhcmFtc18odXJpKTtcblxuICB1cmkuc2V0UGFyYW1ldGVyVmFsdWUoJ1RZUEUnLCAneG1saHR0cCcpO1xuXG4gIGlmICh0aGlzLmh0dHBIZWFkZXJzT3ZlcndyaXRlUGFyYW1fICYmIHRoaXMuZXh0cmFIZWFkZXJzXykge1xuICAgIGh0dHBDb3JzLnNldEh0dHBIZWFkZXJzV2l0aE92ZXJ3cml0ZVBhcmFtKFxuICAgICAgICB1cmksIHRoaXMuaHR0cEhlYWRlcnNPdmVyd3JpdGVQYXJhbV8sIHRoaXMuZXh0cmFIZWFkZXJzXyk7XG4gIH1cblxuICBpZiAodGhpcy5iYWNrQ2hhbm5lbFJlcXVlc3RUaW1lb3V0TXNfKSB7XG4gICAgdGhpcy5iYWNrQ2hhbm5lbFJlcXVlc3RfLnNldFRpbWVvdXQodGhpcy5iYWNrQ2hhbm5lbFJlcXVlc3RUaW1lb3V0TXNfKTtcbiAgfVxuXG4gIHRoaXMuYmFja0NoYW5uZWxSZXF1ZXN0Xy54bWxIdHRwR2V0KFxuICAgICAgdXJpLCB0cnVlIC8qIGRlY29kZUNodW5rcyAqLywgdGhpcy5ob3N0UHJlZml4Xyk7XG5cbiAgdGhpcy5jaGFubmVsRGVidWdfLmRlYnVnKCdOZXcgUmVxdWVzdCBjcmVhdGVkJyk7XG59O1xuXG5cbi8qKlxuICogR2l2ZXMgdGhlIGhhbmRsZXIgYSBjaGFuY2UgdG8gcmV0dXJuIGFuIGVycm9yIGNvZGUgYW5kIHN0b3AgY2hhbm5lbFxuICogZXhlY3V0aW9uLiBBIGhhbmRsZXIgbWlnaHQgd2FudCB0byBkbyB0aGlzIHRvIGNoZWNrIHRoYXQgdGhlIHVzZXIgaXMgc3RpbGxcbiAqIGxvZ2dlZCBpbiwgZm9yIGV4YW1wbGUuXG4gKiBAcHJpdmF0ZVxuICogQHJldHVybiB7Ym9vbGVhbn0gSWYgaXQncyBPSyB0byBtYWtlIGEgcmVxdWVzdC5cbiAqL1xuV2ViQ2hhbm5lbEJhc2UucHJvdG90eXBlLm9rVG9NYWtlUmVxdWVzdF8gPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBpZiAodGhpcy5oYW5kbGVyXykge1xuICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMuaGFuZGxlcl8ub2tUb01ha2VSZXF1ZXN0KHRoaXMpO1xuICAgIGlmIChyZXN1bHQgIT0gV2ViQ2hhbm5lbEJhc2UuRXJyb3IuT0spIHtcbiAgICAgIHRoaXMuY2hhbm5lbERlYnVnXy5kZWJ1ZyhcbiAgICAgICAgICAnSGFuZGxlciByZXR1cm5lZCBlcnJvciBjb2RlIGZyb20gb2tUb01ha2VSZXF1ZXN0Jyk7XG4gICAgICB0aGlzLnNpZ25hbEVycm9yXyhyZXN1bHQpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuICByZXR1cm4gdHJ1ZTtcbn07XG5cblxuLyoqXG4gKiBAb3ZlcnJpZGVcbiAqL1xuV2ViQ2hhbm5lbEJhc2UucHJvdG90eXBlLm9uRmlyc3RCeXRlUmVjZWl2ZWQgPSBmdW5jdGlvbihyZXF1ZXN0LCByZXNwb25zZVRleHQpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBpZiAodGhpcy5iYWNrQ2hhbm5lbFJlcXVlc3RfID09IHJlcXVlc3QgJiYgdGhpcy5kZXRlY3RCdWZmZXJpbmdQcm94eV8pIHtcbiAgICBpZiAoIXRoaXMuYnBEZXRlY3Rpb25Eb25lXykge1xuICAgICAgdGhpcy5jaGFubmVsRGVidWdfLmluZm8oXG4gICAgICAgICAgJ0dyZWF0LCBubyBidWZmZXJpbmcgcHJveHkgZGV0ZWN0ZWQuIEJ5dGVzIHJlY2VpdmVkOiAnICtcbiAgICAgICAgICByZXNwb25zZVRleHQubGVuZ3RoKTtcbiAgICAgIGdvb2cuYXNzZXJ0cy5hc3NlcnQoXG4gICAgICAgICAgdGhpcy5icERldGVjdGlvblRpbWVySWRfLCAnVGltZXIgc2hvdWxkIG5vdCBoYXZlIGJlZW4gY2FuY2VsbGVkLicpO1xuICAgICAgdGhpcy5jbGVhckJwRGV0ZWN0aW9uVGltZXJfKCk7XG4gICAgICB0aGlzLmJwRGV0ZWN0aW9uRG9uZV8gPSB0cnVlO1xuICAgICAgcmVxdWVzdFN0YXRzLm5vdGlmeVN0YXRFdmVudChyZXF1ZXN0U3RhdHMuU3RhdC5OT1BST1hZKTtcbiAgICB9XG4gIH1cbn07XG5cblxuLyoqXG4gKiBAb3ZlcnJpZGVcbiAqL1xuV2ViQ2hhbm5lbEJhc2UucHJvdG90eXBlLm9uUmVxdWVzdERhdGEgPSBmdW5jdGlvbihyZXF1ZXN0LCByZXNwb25zZVRleHQpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBpZiAodGhpcy5zdGF0ZV8gPT0gV2ViQ2hhbm5lbEJhc2UuU3RhdGUuQ0xPU0VEIHx8XG4gICAgICAodGhpcy5iYWNrQ2hhbm5lbFJlcXVlc3RfICE9IHJlcXVlc3QgJiZcbiAgICAgICAhdGhpcy5mb3J3YXJkQ2hhbm5lbFJlcXVlc3RQb29sXy5oYXNSZXF1ZXN0KHJlcXVlc3QpKSkge1xuICAgIC8vIGVpdGhlciBDTE9TRUQgb3IgYSByZXF1ZXN0IHdlIGRvbid0IGtub3cgYWJvdXQgKHBlcmhhcHMgYW4gb2xkIHJlcXVlc3QpXG4gICAgcmV0dXJuO1xuICB9XG4gIHRoaXMubGFzdFN0YXR1c0NvZGVfID0gcmVxdWVzdC5nZXRMYXN0U3RhdHVzQ29kZSgpO1xuXG4gIC8vIGZpcnN0IHRvIGNoZWNrIGlmIHJlcXVlc3QgaGFzIGJlZW4gdXBncmFkZWQgdG8gYmFja2NoYW5uZWxcbiAgaWYgKCFyZXF1ZXN0LmlzSW5pdGlhbFJlc3BvbnNlRGVjb2RlZCgpICYmXG4gICAgICB0aGlzLmZvcndhcmRDaGFubmVsUmVxdWVzdFBvb2xfLmhhc1JlcXVlc3QocmVxdWVzdCkgJiZcbiAgICAgIHRoaXMuc3RhdGVfID09IFdlYkNoYW5uZWxCYXNlLlN0YXRlLk9QRU5FRCkge1xuICAgIGxldCByZXNwb25zZTtcbiAgICB0cnkge1xuICAgICAgcmVzcG9uc2UgPSB0aGlzLndpcmVDb2RlY18uZGVjb2RlTWVzc2FnZShyZXNwb25zZVRleHQpO1xuICAgIH0gY2F0Y2ggKGV4KSB7XG4gICAgICByZXNwb25zZSA9IG51bGw7XG4gICAgfVxuICAgIGlmIChBcnJheS5pc0FycmF5KHJlc3BvbnNlKSAmJiByZXNwb25zZS5sZW5ndGggPT0gMykge1xuICAgICAgdGhpcy5oYW5kbGVQb3N0UmVzcG9uc2VfKC8qKiBAdHlwZSB7IUFycmF5PD8+fSAqLyAocmVzcG9uc2UpLCByZXF1ZXN0KTtcbiAgICAgIHRoaXMub25Gb3J3YXJkQ2hhbm5lbEZsdXNoZWRfKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuY2hhbm5lbERlYnVnXy5kZWJ1ZygnQmFkIFBPU1QgcmVzcG9uc2UgZGF0YSByZXR1cm5lZCcpO1xuICAgICAgdGhpcy5zaWduYWxFcnJvcl8oV2ViQ2hhbm5lbEJhc2UuRXJyb3IuQkFEX1JFU1BPTlNFKTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgaWYgKHJlcXVlc3QuaXNJbml0aWFsUmVzcG9uc2VEZWNvZGVkKCkgfHxcbiAgICAgICAgdGhpcy5iYWNrQ2hhbm5lbFJlcXVlc3RfID09IHJlcXVlc3QpIHtcbiAgICAgIHRoaXMuY2xlYXJEZWFkQmFja2NoYW5uZWxUaW1lcl8oKTtcbiAgICB9XG5cbiAgICBpZiAoIWdvb2cuc3RyaW5nLmlzRW1wdHlPcldoaXRlc3BhY2UocmVzcG9uc2VUZXh0KSkge1xuICAgICAgbGV0IHJlc3BvbnNlID0gdGhpcy53aXJlQ29kZWNfLmRlY29kZU1lc3NhZ2UocmVzcG9uc2VUZXh0KTtcbiAgICAgIHRoaXMub25JbnB1dF8oLyoqIEB0eXBlIHshQXJyYXk8Pz59ICovIChyZXNwb25zZSksIHJlcXVlc3QpO1xuICAgIH1cbiAgfVxufTtcblxuXG4vKipcbiAqIENoZWNrcyBpZiB3ZSBuZWVkIGNhbGwgdGhlIGZsdXNoIGNhbGxiYWNrLlxuICpcbiAqIEBwcml2YXRlXG4gKi9cbldlYkNoYW5uZWxCYXNlLnByb3RvdHlwZS5vbkZvcndhcmRDaGFubmVsRmx1c2hlZF8gPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBpZiAodGhpcy5mb3J3YXJkQ2hhbm5lbFJlcXVlc3RQb29sXy5nZXRSZXF1ZXN0Q291bnQoKSA8PSAxKSB7XG4gICAgaWYgKHRoaXMuZm9yd2FyZENoYW5uZWxGbHVzaGVkQ2FsbGJhY2tfKSB7XG4gICAgICB0cnkge1xuICAgICAgICB0aGlzLmZvcndhcmRDaGFubmVsRmx1c2hlZENhbGxiYWNrXygpO1xuICAgICAgfSBjYXRjaCAoZXgpIHtcbiAgICAgICAgdGhpcy5jaGFubmVsRGVidWdfLmR1bXBFeGNlcHRpb24oXG4gICAgICAgICAgICBleCwgJ0V4Y2VwdGlvbiBmcm9tIGZvcndhcmRDaGFubmVsRmx1c2hlZENhbGxiYWNrXyAnKTtcbiAgICAgIH1cbiAgICAgIC8vIHJlc2V0XG4gICAgICB0aGlzLmZvcndhcmRDaGFubmVsRmx1c2hlZENhbGxiYWNrXyA9IHVuZGVmaW5lZDtcbiAgICB9XG4gIH1cbn07XG5cblxuLyoqXG4gKiBIYW5kbGVzIGEgUE9TVCByZXNwb25zZSBmcm9tIHRoZSBzZXJ2ZXIuXG4gKiBAcGFyYW0ge0FycmF5PG51bWJlcj59IHJlc3BvbnNlVmFsdWVzIFRoZSBrZXkgdmFsdWUgcGFpcnMgaW5cbiAqICAgICB0aGUgUE9TVCByZXNwb25zZS5cbiAqIEBwYXJhbSB7IUNoYW5uZWxSZXF1ZXN0fSBmb3J3YXJkUmVxIFRoZSBmb3J3YXJkIGNoYW5uZWwgcmVxdWVzdCB0aGF0XG4gKiB0cmlnZ2VycyB0aGlzIGZ1bmN0aW9uIGNhbGwuXG4gKiBAcHJpdmF0ZVxuICovXG5XZWJDaGFubmVsQmFzZS5wcm90b3R5cGUuaGFuZGxlUG9zdFJlc3BvbnNlXyA9IGZ1bmN0aW9uKFxuICAgIHJlc3BvbnNlVmFsdWVzLCBmb3J3YXJkUmVxKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgLy8gVGhlIGZpcnN0IHJlc3BvbnNlIHZhbHVlIGlzIHNldCB0byAwIGlmIHNlcnZlciBpcyBtaXNzaW5nIGJhY2tjaGFubmVsLlxuICBpZiAocmVzcG9uc2VWYWx1ZXNbMF0gPT0gMCkge1xuICAgIHRoaXMuaGFuZGxlQmFja2NoYW5uZWxNaXNzaW5nXyhmb3J3YXJkUmVxKTtcbiAgICByZXR1cm47XG4gIH1cbiAgdGhpcy5sYXN0UG9zdFJlc3BvbnNlQXJyYXlJZF8gPSByZXNwb25zZVZhbHVlc1sxXTtcbiAgY29uc3Qgb3V0c3RhbmRpbmdBcnJheXMgPSB0aGlzLmxhc3RQb3N0UmVzcG9uc2VBcnJheUlkXyAtIHRoaXMubGFzdEFycmF5SWRfO1xuICBpZiAoMCA8IG91dHN0YW5kaW5nQXJyYXlzKSB7XG4gICAgY29uc3QgbnVtT3V0c3RhbmRpbmdCYWNrY2hhbm5lbEJ5dGVzID0gcmVzcG9uc2VWYWx1ZXNbMl07XG4gICAgdGhpcy5jaGFubmVsRGVidWdfLmRlYnVnKFxuICAgICAgICBudW1PdXRzdGFuZGluZ0JhY2tjaGFubmVsQnl0ZXMgKyAnIGJ5dGVzIChpbiAnICsgb3V0c3RhbmRpbmdBcnJheXMgK1xuICAgICAgICAnIGFycmF5cykgYXJlIG91dHN0YW5kaW5nIG9uIHRoZSBCYWNrQ2hhbm5lbCcpO1xuICAgIGlmICghdGhpcy5zaG91bGRSZXRyeUJhY2tDaGFubmVsXyhudW1PdXRzdGFuZGluZ0JhY2tjaGFubmVsQnl0ZXMpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmICghdGhpcy5kZWFkQmFja0NoYW5uZWxUaW1lcklkXykge1xuICAgICAgLy8gV2UgZXhwZWN0IHRvIHJlY2VpdmUgZGF0YSB3aXRoaW4gMiBSVFRzIG9yIHdlIHJldHJ5IHRoZSBiYWNrY2hhbm5lbC5cbiAgICAgIHRoaXMuZGVhZEJhY2tDaGFubmVsVGltZXJJZF8gPSByZXF1ZXN0U3RhdHMuc2V0VGltZW91dChcbiAgICAgICAgICBnb29nLmJpbmQodGhpcy5vbkJhY2tDaGFubmVsRGVhZF8sIHRoaXMpLFxuICAgICAgICAgIDIgKiBXZWJDaGFubmVsQmFzZS5SVFRfRVNUSU1BVEUpO1xuICAgIH1cbiAgfVxufTtcblxuXG4vKipcbiAqIEhhbmRsZXMgYSBQT1NUIHJlc3BvbnNlIGZyb20gdGhlIHNlcnZlciB0ZWxsaW5nIHVzIHRoYXQgaXQgaGFzIGRldGVjdGVkIHRoYXRcbiAqIHdlIGhhdmUgbm8gaGFuZ2luZyBHRVQgY29ubmVjdGlvbi5cbiAqIEBwYXJhbSB7IUNoYW5uZWxSZXF1ZXN0fSBmb3J3YXJkUmVxIFRoZSBmb3J3YXJkIGNoYW5uZWwgcmVxdWVzdCB0aGF0XG4gKiB0cmlnZ2VycyB0aGlzIGZ1bmN0aW9uIGNhbGwuXG4gKiBAcHJpdmF0ZVxuICovXG5XZWJDaGFubmVsQmFzZS5wcm90b3R5cGUuaGFuZGxlQmFja2NoYW5uZWxNaXNzaW5nXyA9IGZ1bmN0aW9uKGZvcndhcmRSZXEpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICAvLyBBcyBsb25nIGFzIHRoZSBiYWNrIGNoYW5uZWwgd2FzIHN0YXJ0ZWQgYmVmb3JlIHRoZSBQT1NUIHdhcyBzZW50LFxuICAvLyB3ZSBzaG91bGQgcmV0cnkgdGhlIGJhY2tjaGFubmVsLiBXZSBnaXZlIGEgc2xpZ2h0IGJ1ZmZlciBvZiBSVFRfRVNUSU1BVEVcbiAgLy8gc28gYXMgbm90IHRvIGV4Y2Vzc2l2ZWx5IHJldHJ5IHRoZSBiYWNrY2hhbm5lbFxuICB0aGlzLmNoYW5uZWxEZWJ1Z18uZGVidWcoJ1NlcnZlciBjbGFpbXMgb3VyIGJhY2tjaGFubmVsIGlzIG1pc3NpbmcuJyk7XG4gIGlmICh0aGlzLmJhY2tDaGFubmVsVGltZXJJZF8pIHtcbiAgICB0aGlzLmNoYW5uZWxEZWJ1Z18uZGVidWcoJ0J1dCB3ZSBhcmUgY3VycmVudGx5IHN0YXJ0aW5nIHRoZSByZXF1ZXN0LicpO1xuICAgIHJldHVybjtcbiAgfSBlbHNlIGlmICghdGhpcy5iYWNrQ2hhbm5lbFJlcXVlc3RfKSB7XG4gICAgdGhpcy5jaGFubmVsRGVidWdfLndhcm5pbmcoJ1dlIGRvIG5vdCBoYXZlIGEgQmFja0NoYW5uZWwgZXN0YWJsaXNoZWQnKTtcbiAgfSBlbHNlIGlmIChcbiAgICAgIHRoaXMuYmFja0NoYW5uZWxSZXF1ZXN0Xy5nZXRSZXF1ZXN0U3RhcnRUaW1lKCkgK1xuICAgICAgICAgIFdlYkNoYW5uZWxCYXNlLlJUVF9FU1RJTUFURSA8XG4gICAgICBmb3J3YXJkUmVxLmdldFJlcXVlc3RTdGFydFRpbWUoKSkge1xuICAgIHRoaXMuY2xlYXJEZWFkQmFja2NoYW5uZWxUaW1lcl8oKTtcbiAgICB0aGlzLmNhbmNlbEJhY2tDaGFubmVsUmVxdWVzdF8oKTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm47XG4gIH1cbiAgdGhpcy5tYXliZVJldHJ5QmFja0NoYW5uZWxfKCk7XG4gIHJlcXVlc3RTdGF0cy5ub3RpZnlTdGF0RXZlbnQocmVxdWVzdFN0YXRzLlN0YXQuQkFDS0NIQU5ORUxfTUlTU0lORyk7XG59O1xuXG5cbi8qKlxuICogRGV0ZXJtaW5lcyB3aGV0aGVyIHdlIHNob3VsZCBzdGFydCB0aGUgcHJvY2VzcyBvZiByZXRyeWluZyBhIHBvc3NpYmx5XG4gKiBkZWFkIGJhY2tjaGFubmVsLlxuICogQHBhcmFtIHtudW1iZXJ9IG91dHN0YW5kaW5nQnl0ZXMgVGhlIG51bWJlciBvZiBieXRlcyBmb3Igd2hpY2ggdGhlIHNlcnZlciBoYXNcbiAqICAgICBub3QgeWV0IHJlY2VpdmVkIGFja25vd2xlZGdlbWVudC5cbiAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgdG8gc3RhcnQgdGhlIGJhY2tjaGFubmVsIHJldHJ5IHRpbWVyLlxuICogQHByaXZhdGVcbiAqL1xuV2ViQ2hhbm5lbEJhc2UucHJvdG90eXBlLnNob3VsZFJldHJ5QmFja0NoYW5uZWxfID0gZnVuY3Rpb24ob3V0c3RhbmRpbmdCeXRlcykge1xuICAndXNlIHN0cmljdCc7XG4gIC8vIE5vdCB0b28gbWFueSBvdXRzdGFuZGluZyBieXRlcywgbm90IGJ1ZmZlcmVkIGFuZCBub3QgYWZ0ZXIgYSByZXRyeS5cbiAgcmV0dXJuIG91dHN0YW5kaW5nQnl0ZXMgPFxuICAgICAgV2ViQ2hhbm5lbEJhc2UuT1VUU1RBTkRJTkdfREFUQV9CQUNLQ0hBTk5FTF9SRVRSWV9DVVRPRkYgJiZcbiAgICAgICF0aGlzLmlzQnVmZmVyZWQoKSAmJiB0aGlzLmJhY2tDaGFubmVsUmV0cnlDb3VudF8gPT0gMDtcbn07XG5cblxuLyoqXG4gKiBEZWNpZGVzIHdoaWNoIGhvc3QgcHJlZml4IHNob3VsZCBiZSB1c2VkLCBpZiBhbnkuICBJZiB0aGVyZSBpcyBhIGhhbmRsZXIsXG4gKiBhbGxvd3MgdGhlIGhhbmRsZXIgdG8gdmFsaWRhdGUgYSBob3N0IHByZWZpeCBwcm92aWRlZCBieSB0aGUgc2VydmVyLCBhbmRcbiAqIG9wdGlvbmFsbHkgb3ZlcnJpZGUgaXQuXG4gKiBAcGFyYW0gez9zdHJpbmd9IHNlcnZlckhvc3RQcmVmaXggVGhlIGhvc3QgcHJlZml4IHByb3ZpZGVkIGJ5IHRoZSBzZXJ2ZXIuXG4gKiBAcmV0dXJuIHs/c3RyaW5nfSBUaGUgaG9zdCBwcmVmaXggdG8gYWN0dWFsbHkgdXNlLCBpZiBhbnkuIFdpbGwgcmV0dXJuIG51bGxcbiAqICAgICBpZiB0aGUgdXNlIG9mIGhvc3QgcHJlZml4ZXMgd2FzIGRpc2FibGVkIHZpYSBzZXRBbGxvd0hvc3RQcmVmaXgoKS5cbiAqIEBvdmVycmlkZVxuICovXG5XZWJDaGFubmVsQmFzZS5wcm90b3R5cGUuY29ycmVjdEhvc3RQcmVmaXggPSBmdW5jdGlvbihzZXJ2ZXJIb3N0UHJlZml4KSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgaWYgKHRoaXMuYWxsb3dIb3N0UHJlZml4Xykge1xuICAgIGlmICh0aGlzLmhhbmRsZXJfKSB7XG4gICAgICByZXR1cm4gdGhpcy5oYW5kbGVyXy5jb3JyZWN0SG9zdFByZWZpeChzZXJ2ZXJIb3N0UHJlZml4KTtcbiAgICB9XG4gICAgcmV0dXJuIHNlcnZlckhvc3RQcmVmaXg7XG4gIH1cbiAgcmV0dXJuIG51bGw7XG59O1xuXG5cbi8qKlxuICogSGFuZGxlcyB0aGUgdGltZXIgdGhhdCBpbmRpY2F0ZXMgdGhhdCBvdXIgYmFja2NoYW5uZWwgaXMgbm8gbG9uZ2VyIGFibGUgdG9cbiAqIHN1Y2Nlc3NmdWxseSByZWNlaXZlIGRhdGEgZnJvbSB0aGUgc2VydmVyLlxuICogQHByaXZhdGVcbiAqL1xuV2ViQ2hhbm5lbEJhc2UucHJvdG90eXBlLm9uQmFja0NoYW5uZWxEZWFkXyA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIGlmICh0aGlzLmRlYWRCYWNrQ2hhbm5lbFRpbWVySWRfICE9IG51bGwpIHtcbiAgICB0aGlzLmRlYWRCYWNrQ2hhbm5lbFRpbWVySWRfID0gbnVsbDtcbiAgICB0aGlzLmNhbmNlbEJhY2tDaGFubmVsUmVxdWVzdF8oKTtcbiAgICB0aGlzLm1heWJlUmV0cnlCYWNrQ2hhbm5lbF8oKTtcbiAgICByZXF1ZXN0U3RhdHMubm90aWZ5U3RhdEV2ZW50KHJlcXVlc3RTdGF0cy5TdGF0LkJBQ0tDSEFOTkVMX0RFQUQpO1xuICB9XG59O1xuXG5cbi8qKlxuICogQ2xlYXJzIHRoZSB0aW1lciB0aGF0IGluZGljYXRlcyB0aGF0IG91ciBiYWNrY2hhbm5lbCBpcyBubyBsb25nZXIgYWJsZSB0b1xuICogc3VjY2Vzc2Z1bGx5IHJlY2VpdmUgZGF0YSBmcm9tIHRoZSBzZXJ2ZXIuXG4gKiBAcHJpdmF0ZVxuICovXG5XZWJDaGFubmVsQmFzZS5wcm90b3R5cGUuY2xlYXJEZWFkQmFja2NoYW5uZWxUaW1lcl8gPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBpZiAodGhpcy5kZWFkQmFja0NoYW5uZWxUaW1lcklkXyAhPSBudWxsKSB7XG4gICAgZ29vZy5nbG9iYWwuY2xlYXJUaW1lb3V0KHRoaXMuZGVhZEJhY2tDaGFubmVsVGltZXJJZF8pO1xuICAgIHRoaXMuZGVhZEJhY2tDaGFubmVsVGltZXJJZF8gPSBudWxsO1xuICB9XG59O1xuXG5cbi8qKlxuICogUmV0dXJucyB3aGV0aGVyIG9yIG5vdCB0aGUgZ2l2ZW4gZXJyb3Ivc3RhdHVzIGNvbWJpbmF0aW9uIGlzIGZhdGFsIG9yIG5vdC5cbiAqIE9uIGZhdGFsIGVycm9ycyB3ZSBpbW1lZGlhdGVseSBjbG9zZSB0aGUgc2Vzc2lvbiByYXRoZXIgdGhhbiByZXRyeWluZyB0aGVcbiAqIGZhaWxlZCByZXF1ZXN0LlxuICogQHBhcmFtIHs/Q2hhbm5lbFJlcXVlc3QuRXJyb3J9IGVycm9yIFRoZSBlcnJvciBjb2RlIGZvciB0aGVcbiAqIGZhaWxlZCByZXF1ZXN0LlxuICogQHBhcmFtIHtudW1iZXJ9IHN0YXR1c0NvZGUgVGhlIGxhc3QgSFRUUCBzdGF0dXMgY29kZS5cbiAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgb3Igbm90IHRoZSBlcnJvciBpcyBmYXRhbC5cbiAqIEBwcml2YXRlXG4gKi9cbldlYkNoYW5uZWxCYXNlLmlzRmF0YWxFcnJvcl8gPSBmdW5jdGlvbihlcnJvciwgc3RhdHVzQ29kZSkge1xuICAndXNlIHN0cmljdCc7XG4gIHJldHVybiBlcnJvciA9PSBDaGFubmVsUmVxdWVzdC5FcnJvci5VTktOT1dOX1NFU1NJT05fSUQgfHxcbiAgICAgIChlcnJvciA9PSBDaGFubmVsUmVxdWVzdC5FcnJvci5TVEFUVVMgJiYgc3RhdHVzQ29kZSA+IDApO1xufTtcblxuXG4vKipcbiAqIEBvdmVycmlkZVxuICovXG5XZWJDaGFubmVsQmFzZS5wcm90b3R5cGUub25SZXF1ZXN0Q29tcGxldGUgPSBmdW5jdGlvbihyZXF1ZXN0KSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgdGhpcy5jaGFubmVsRGVidWdfLmRlYnVnKCdSZXF1ZXN0IGNvbXBsZXRlJyk7XG4gIGxldCB0eXBlO1xuICBsZXQgcGVuZGluZ01lc3NhZ2VzID0gbnVsbDtcbiAgaWYgKHRoaXMuYmFja0NoYW5uZWxSZXF1ZXN0XyA9PSByZXF1ZXN0KSB7XG4gICAgdGhpcy5jbGVhckRlYWRCYWNrY2hhbm5lbFRpbWVyXygpO1xuICAgIHRoaXMuY2xlYXJCcERldGVjdGlvblRpbWVyXygpO1xuICAgIHRoaXMuYmFja0NoYW5uZWxSZXF1ZXN0XyA9IG51bGw7XG4gICAgdHlwZSA9IFdlYkNoYW5uZWxCYXNlLkNoYW5uZWxUeXBlXy5CQUNLX0NIQU5ORUw7XG4gIH0gZWxzZSBpZiAodGhpcy5mb3J3YXJkQ2hhbm5lbFJlcXVlc3RQb29sXy5oYXNSZXF1ZXN0KHJlcXVlc3QpKSB7XG4gICAgcGVuZGluZ01lc3NhZ2VzID0gcmVxdWVzdC5nZXRQZW5kaW5nTWVzc2FnZXMoKTtcbiAgICB0aGlzLmZvcndhcmRDaGFubmVsUmVxdWVzdFBvb2xfLnJlbW92ZVJlcXVlc3QocmVxdWVzdCk7XG4gICAgdHlwZSA9IFdlYkNoYW5uZWxCYXNlLkNoYW5uZWxUeXBlXy5GT1JXQVJEX0NIQU5ORUw7XG4gIH0gZWxzZSB7XG4gICAgLy8gcmV0dXJuIGlmIGl0IHdhcyBhbiBvbGQgcmVxdWVzdCBmcm9tIGEgcHJldmlvdXMgc2Vzc2lvblxuICAgIHJldHVybjtcbiAgfVxuXG4gIHRoaXMubGFzdFN0YXR1c0NvZGVfID0gcmVxdWVzdC5nZXRMYXN0U3RhdHVzQ29kZSgpO1xuXG4gIGlmICh0aGlzLnN0YXRlXyA9PSBXZWJDaGFubmVsQmFzZS5TdGF0ZS5DTE9TRUQpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBpZiAocmVxdWVzdC5nZXRTdWNjZXNzKCkpIHtcbiAgICBpZiAodHlwZSA9PSBXZWJDaGFubmVsQmFzZS5DaGFubmVsVHlwZV8uRk9SV0FSRF9DSEFOTkVMKSB7XG4gICAgICBjb25zdCBzaXplID0gcmVxdWVzdC5nZXRQb3N0RGF0YSgpID8gcmVxdWVzdC5nZXRQb3N0RGF0YSgpLmxlbmd0aCA6IDA7XG4gICAgICByZXF1ZXN0U3RhdHMubm90aWZ5VGltaW5nRXZlbnQoXG4gICAgICAgICAgc2l6ZSwgRGF0ZS5ub3coKSAtIHJlcXVlc3QuZ2V0UmVxdWVzdFN0YXJ0VGltZSgpLFxuICAgICAgICAgIHRoaXMuZm9yd2FyZENoYW5uZWxSZXRyeUNvdW50Xyk7XG4gICAgICB0aGlzLmVuc3VyZUZvcndhcmRDaGFubmVsXygpO1xuICAgICAgdGhpcy5vblN1Y2Nlc3NfKHJlcXVlc3QpO1xuICAgIH0gZWxzZSB7ICAvLyBpLmUuLCBiYWNrLWNoYW5uZWxcbiAgICAgIHRoaXMuZW5zdXJlQmFja0NoYW5uZWxfKCk7XG4gICAgfVxuICAgIHJldHVybjtcbiAgfVxuICAvLyBFbHNlIHVuc3VjY2Vzc2Z1bC4gRmFsbCB0aHJvdWdoLlxuXG4gIGNvbnN0IGxhc3RFcnJvciA9IHJlcXVlc3QuZ2V0TGFzdEVycm9yKCk7XG4gIGlmICghV2ViQ2hhbm5lbEJhc2UuaXNGYXRhbEVycm9yXyhsYXN0RXJyb3IsIHRoaXMubGFzdFN0YXR1c0NvZGVfKSkge1xuICAgIC8vIE1heWJlIHJldHJ5LlxuICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuICAgIHRoaXMuY2hhbm5lbERlYnVnXy5kZWJ1ZyhmdW5jdGlvbigpIHtcbiAgICAgICd1c2Ugc3RyaWN0JztcbiAgICAgIHJldHVybiAnTWF5YmUgcmV0cnlpbmcsIGxhc3QgZXJyb3I6ICcgK1xuICAgICAgICAgIENoYW5uZWxSZXF1ZXN0LmVycm9yU3RyaW5nRnJvbUNvZGUobGFzdEVycm9yLCBzZWxmLmxhc3RTdGF0dXNDb2RlXyk7XG4gICAgfSk7XG4gICAgaWYgKHR5cGUgPT0gV2ViQ2hhbm5lbEJhc2UuQ2hhbm5lbFR5cGVfLkZPUldBUkRfQ0hBTk5FTCkge1xuICAgICAgaWYgKHRoaXMubWF5YmVSZXRyeUZvcndhcmRDaGFubmVsXyhyZXF1ZXN0KSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgfVxuICAgIGlmICh0eXBlID09IFdlYkNoYW5uZWxCYXNlLkNoYW5uZWxUeXBlXy5CQUNLX0NIQU5ORUwpIHtcbiAgICAgIGlmICh0aGlzLm1heWJlUmV0cnlCYWNrQ2hhbm5lbF8oKSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgfVxuICAgIC8vIEVsc2UgZXhjZWVkZWQgbWF4IHJldHJpZXMuIEZhbGwgdGhyb3VnaC5cbiAgICB0aGlzLmNoYW5uZWxEZWJ1Z18uZGVidWcoJ0V4Y2VlZGVkIG1heCBudW1iZXIgb2YgcmV0cmllcycpO1xuICB9IGVsc2Uge1xuICAgIC8vIEVsc2UgZmF0YWwgZXJyb3IuIEZhbGwgdGhyb3VnaCBhbmQgbWFyayB0aGUgcGVuZGluZyBtYXBzIGFzIGZhaWxlZC5cbiAgICB0aGlzLmNoYW5uZWxEZWJ1Z18uZGVidWcoJ05vdCByZXRyeWluZyBkdWUgdG8gZXJyb3IgdHlwZScpO1xuICB9XG5cblxuICAvLyBBYm9ydCB0aGUgY2hhbm5lbCBub3dcblxuICAvLyBSZWNvcmQgcGVuZGluZyBtZXNzYWdlcyBmcm9tIHRoZSBmYWlsZWQgcmVxdWVzdFxuICBpZiAocGVuZGluZ01lc3NhZ2VzICYmIHBlbmRpbmdNZXNzYWdlcy5sZW5ndGggPiAwKSB7XG4gICAgdGhpcy5mb3J3YXJkQ2hhbm5lbFJlcXVlc3RQb29sXy5hZGRQZW5kaW5nTWVzc2FnZXMocGVuZGluZ01lc3NhZ2VzKTtcbiAgfVxuXG4gIHRoaXMuY2hhbm5lbERlYnVnXy5kZWJ1ZygnRXJyb3I6IEhUVFAgcmVxdWVzdCBmYWlsZWQnKTtcbiAgc3dpdGNoIChsYXN0RXJyb3IpIHtcbiAgICBjYXNlIENoYW5uZWxSZXF1ZXN0LkVycm9yLk5PX0RBVEE6XG4gICAgICB0aGlzLnNpZ25hbEVycm9yXyhXZWJDaGFubmVsQmFzZS5FcnJvci5OT19EQVRBKTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgQ2hhbm5lbFJlcXVlc3QuRXJyb3IuQkFEX0RBVEE6XG4gICAgICB0aGlzLnNpZ25hbEVycm9yXyhXZWJDaGFubmVsQmFzZS5FcnJvci5CQURfREFUQSk7XG4gICAgICBicmVhaztcbiAgICBjYXNlIENoYW5uZWxSZXF1ZXN0LkVycm9yLlVOS05PV05fU0VTU0lPTl9JRDpcbiAgICAgIHRoaXMuc2lnbmFsRXJyb3JfKFdlYkNoYW5uZWxCYXNlLkVycm9yLlVOS05PV05fU0VTU0lPTl9JRCk7XG4gICAgICBicmVhaztcbiAgICBkZWZhdWx0OlxuICAgICAgdGhpcy5zaWduYWxFcnJvcl8oV2ViQ2hhbm5lbEJhc2UuRXJyb3IuUkVRVUVTVF9GQUlMRUQpO1xuICAgICAgYnJlYWs7XG4gIH1cbn07XG5cblxuLyoqXG4gKiBAcGFyYW0ge251bWJlcn0gcmV0cnlDb3VudCBOdW1iZXIgb2YgcmV0cmllcyBzbyBmYXIuXG4gKiBAcmV0dXJuIHtudW1iZXJ9IFRpbWUgaW4gbXMgYmVmb3JlIGZpcmluZyBuZXh0IHJldHJ5IHJlcXVlc3QuXG4gKiBAcHJpdmF0ZVxuICovXG5XZWJDaGFubmVsQmFzZS5wcm90b3R5cGUuZ2V0UmV0cnlUaW1lXyA9IGZ1bmN0aW9uKHJldHJ5Q291bnQpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBsZXQgcmV0cnlUaW1lID0gdGhpcy5iYXNlUmV0cnlEZWxheU1zXyArXG4gICAgICBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiB0aGlzLnJldHJ5RGVsYXlTZWVkTXNfKTtcbiAgaWYgKCF0aGlzLmlzQWN0aXZlKCkpIHtcbiAgICB0aGlzLmNoYW5uZWxEZWJ1Z18uZGVidWcoJ0luYWN0aXZlIGNoYW5uZWwnKTtcbiAgICByZXRyeVRpbWUgPSByZXRyeVRpbWUgKiBXZWJDaGFubmVsQmFzZS5JTkFDVElWRV9DSEFOTkVMX1JFVFJZX0ZBQ1RPUjtcbiAgfVxuICAvLyBCYWNrb2ZmIGZvciBzdWJzZXF1ZW50IHJldHJpZXNcbiAgcmV0cnlUaW1lICo9IHJldHJ5Q291bnQ7XG4gIHJldHVybiByZXRyeVRpbWU7XG59O1xuXG5cbi8qKlxuICogQHBhcmFtIHtudW1iZXJ9IGJhc2VEZWxheU1zIFRoZSBiYXNlIHBhcnQgb2YgdGhlIHJldHJ5IGRlbGF5LCBpbiBtcy5cbiAqIEBwYXJhbSB7bnVtYmVyfSBkZWxheVNlZWRNcyBBIHJhbmRvbSBkZWxheSBiZXR3ZWVuIDAgYW5kIHRoaXMgaXMgYWRkZWQgdG9cbiAqICAgICB0aGUgYmFzZSBwYXJ0LlxuICovXG5XZWJDaGFubmVsQmFzZS5wcm90b3R5cGUuc2V0UmV0cnlEZWxheSA9IGZ1bmN0aW9uKGJhc2VEZWxheU1zLCBkZWxheVNlZWRNcykge1xuICAndXNlIHN0cmljdCc7XG4gIHRoaXMuYmFzZVJldHJ5RGVsYXlNc18gPSBiYXNlRGVsYXlNcztcbiAgdGhpcy5yZXRyeURlbGF5U2VlZE1zXyA9IGRlbGF5U2VlZE1zO1xufTtcblxuXG4vKipcbiAqIEFwcGx5IGFueSBoYW5kc2hha2UgY29udHJvbCBoZWFkZXJzLlxuICogQHBhcmFtIHshQ2hhbm5lbFJlcXVlc3R9IHJlcXVlc3QgVGhlIHVuZGVybHlpbmcgcmVxdWVzdCBvYmplY3RcbiAqIEBwcml2YXRlXG4gKi9cbldlYkNoYW5uZWxCYXNlLnByb3RvdHlwZS5hcHBseUNvbnRyb2xIZWFkZXJzXyA9IGZ1bmN0aW9uKHJlcXVlc3QpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBjb25zdCB4aHIgPSByZXF1ZXN0LmdldFhocigpO1xuICBpZiAoeGhyKSB7XG4gICAgY29uc3QgY2xpZW50UHJvdG9jb2wgPVxuICAgICAgICB4aHIuZ2V0U3RyZWFtaW5nUmVzcG9uc2VIZWFkZXIoV2ViQ2hhbm5lbC5YX0NMSUVOVF9XSVJFX1BST1RPQ09MKTtcbiAgICBpZiAoY2xpZW50UHJvdG9jb2wpIHtcbiAgICAgIHRoaXMuZm9yd2FyZENoYW5uZWxSZXF1ZXN0UG9vbF8uYXBwbHlDbGllbnRQcm90b2NvbChjbGllbnRQcm90b2NvbCk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuZ2V0SHR0cFNlc3Npb25JZFBhcmFtKCkpIHtcbiAgICAgIGNvbnN0IGh0dHBTZXNzaW9uSWRIZWFkZXIgPVxuICAgICAgICAgIHhoci5nZXRTdHJlYW1pbmdSZXNwb25zZUhlYWRlcihXZWJDaGFubmVsLlhfSFRUUF9TRVNTSU9OX0lEKTtcbiAgICAgIGlmIChodHRwU2Vzc2lvbklkSGVhZGVyKSB7XG4gICAgICAgIHRoaXMuc2V0SHR0cFNlc3Npb25JZChodHRwU2Vzc2lvbklkSGVhZGVyKTtcbiAgICAgICAgLy8gdXBkYXRlIHRoZSBjYWNoZWQgdXJpXG4gICAgICAgIGNvbnN0IGh0dHBTZXNzaW9uSWRQYXJhbSA9IHRoaXMuZ2V0SHR0cFNlc3Npb25JZFBhcmFtKCk7XG5cbiAgICAgICAgdGhpcy5mb3J3YXJkQ2hhbm5lbFVyaV8uc2V0UGFyYW1ldGVyVmFsdWUoXG4gICAgICAgICAgICAvKiogQHR5cGUge3N0cmluZ30gKi8gKGh0dHBTZXNzaW9uSWRQYXJhbSksICAvLyBuZXZlciBudWxsXG4gICAgICAgICAgICBodHRwU2Vzc2lvbklkSGVhZGVyKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuY2hhbm5lbERlYnVnXy53YXJuaW5nKFxuICAgICAgICAgICAgJ01pc3NpbmcgWF9IVFRQX1NFU1NJT05fSUQgaW4gdGhlIGhhbmRzaGFrZSByZXNwb25zZScpO1xuICAgICAgfVxuICAgIH1cbiAgfVxufTtcblxuXG4vKipcbiAqIFByb2Nlc3NlcyB0aGUgZGF0YSByZXR1cm5lZCBieSB0aGUgc2VydmVyLlxuICogQHBhcmFtIHshQXJyYXk8IUFycmF5PD8+Pn0gcmVzcEFycmF5IFRoZSByZXNwb25zZSBhcnJheSByZXR1cm5lZFxuICogICAgIGJ5IHRoZSBzZXJ2ZXIuXG4gKiBAcGFyYW0geyFDaGFubmVsUmVxdWVzdH0gcmVxdWVzdCBUaGUgdW5kZXJseWluZyByZXF1ZXN0IG9iamVjdFxuICogQHByaXZhdGVcbiAqL1xuV2ViQ2hhbm5lbEJhc2UucHJvdG90eXBlLm9uSW5wdXRfID0gZnVuY3Rpb24ocmVzcEFycmF5LCByZXF1ZXN0KSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgY29uc3QgYmF0Y2ggPVxuICAgICAgdGhpcy5oYW5kbGVyXyAmJiB0aGlzLmhhbmRsZXJfLmNoYW5uZWxIYW5kbGVNdWx0aXBsZUFycmF5cyA/IFtdIDogbnVsbDtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCByZXNwQXJyYXkubGVuZ3RoOyBpKyspIHtcbiAgICBsZXQgbmV4dEFycmF5ID0gcmVzcEFycmF5W2ldO1xuICAgIHRoaXMubGFzdEFycmF5SWRfID0gbmV4dEFycmF5WzBdO1xuICAgIG5leHRBcnJheSA9IG5leHRBcnJheVsxXTtcbiAgICBpZiAodGhpcy5zdGF0ZV8gPT0gV2ViQ2hhbm5lbEJhc2UuU3RhdGUuT1BFTklORykge1xuICAgICAgaWYgKG5leHRBcnJheVswXSA9PSAnYycpIHtcbiAgICAgICAgdGhpcy5zaWRfID0gbmV4dEFycmF5WzFdO1xuICAgICAgICB0aGlzLmhvc3RQcmVmaXhfID0gdGhpcy5jb3JyZWN0SG9zdFByZWZpeChuZXh0QXJyYXlbMl0pO1xuXG4gICAgICAgIGNvbnN0IG5lZ290aWF0ZWRWZXJzaW9uID0gbmV4dEFycmF5WzNdO1xuICAgICAgICBpZiAobmVnb3RpYXRlZFZlcnNpb24gIT0gbnVsbCkge1xuICAgICAgICAgIHRoaXMuY2hhbm5lbFZlcnNpb25fID0gbmVnb3RpYXRlZFZlcnNpb247XG4gICAgICAgICAgdGhpcy5jaGFubmVsRGVidWdfLmluZm8oJ1ZFUj0nICsgdGhpcy5jaGFubmVsVmVyc2lvbl8pO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgbmVnb3RpYXRlZFNlcnZlclZlcnNpb24gPSBuZXh0QXJyYXlbNF07XG4gICAgICAgIGlmIChuZWdvdGlhdGVkU2VydmVyVmVyc2lvbiAhPSBudWxsKSB7XG4gICAgICAgICAgdGhpcy5zZXJ2ZXJWZXJzaW9uXyA9IG5lZ290aWF0ZWRTZXJ2ZXJWZXJzaW9uO1xuICAgICAgICAgIHRoaXMuY2hhbm5lbERlYnVnXy5pbmZvKCdTVkVSPScgKyB0aGlzLnNlcnZlclZlcnNpb25fKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIENWRVI9MjJcbiAgICAgICAgY29uc3Qgc2VydmVyS2VlcGFsaXZlTXMgPSBuZXh0QXJyYXlbNV07XG4gICAgICAgIGlmIChzZXJ2ZXJLZWVwYWxpdmVNcyAhPSBudWxsICYmXG4gICAgICAgICAgICB0eXBlb2Ygc2VydmVyS2VlcGFsaXZlTXMgPT09ICdudW1iZXInICYmIHNlcnZlcktlZXBhbGl2ZU1zID4gMCkge1xuICAgICAgICAgIGNvbnN0IHRpbWVvdXQgPSAxLjUgKiBzZXJ2ZXJLZWVwYWxpdmVNcztcbiAgICAgICAgICB0aGlzLmJhY2tDaGFubmVsUmVxdWVzdFRpbWVvdXRNc18gPSB0aW1lb3V0O1xuICAgICAgICAgIHRoaXMuY2hhbm5lbERlYnVnXy5pbmZvKCdiYWNrQ2hhbm5lbFJlcXVlc3RUaW1lb3V0TXNfPScgKyB0aW1lb3V0KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuYXBwbHlDb250cm9sSGVhZGVyc18ocmVxdWVzdCk7XG5cbiAgICAgICAgdGhpcy5zdGF0ZV8gPSBXZWJDaGFubmVsQmFzZS5TdGF0ZS5PUEVORUQ7XG4gICAgICAgIGlmICh0aGlzLmhhbmRsZXJfKSB7XG4gICAgICAgICAgdGhpcy5oYW5kbGVyXy5jaGFubmVsT3BlbmVkKHRoaXMpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuZGV0ZWN0QnVmZmVyaW5nUHJveHlfKSB7XG4gICAgICAgICAgdGhpcy5oYW5kc2hha2VSdHRNc18gPSBEYXRlLm5vdygpIC0gcmVxdWVzdC5nZXRSZXF1ZXN0U3RhcnRUaW1lKCk7XG4gICAgICAgICAgdGhpcy5jaGFubmVsRGVidWdfLmluZm8oXG4gICAgICAgICAgICAgICdIYW5kc2hha2UgUlRUOiAnICsgdGhpcy5oYW5kc2hha2VSdHRNc18gKyAnbXMnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuc3RhcnRCYWNrY2hhbm5lbEFmdGVySGFuZHNoYWtlXyhyZXF1ZXN0KTtcblxuICAgICAgICBpZiAodGhpcy5vdXRnb2luZ01hcHNfLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICB0aGlzLmVuc3VyZUZvcndhcmRDaGFubmVsXygpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKG5leHRBcnJheVswXSA9PSAnc3RvcCcgfHwgbmV4dEFycmF5WzBdID09ICdjbG9zZScpIHtcbiAgICAgICAgLy8gdHJlYXQgY2xvc2UgYWxzbyBhcyBhbiBhYm9ydFxuICAgICAgICB0aGlzLnNpZ25hbEVycm9yXyhXZWJDaGFubmVsQmFzZS5FcnJvci5TVE9QKTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKHRoaXMuc3RhdGVfID09IFdlYkNoYW5uZWxCYXNlLlN0YXRlLk9QRU5FRCkge1xuICAgICAgaWYgKG5leHRBcnJheVswXSA9PSAnc3RvcCcgfHwgbmV4dEFycmF5WzBdID09ICdjbG9zZScpIHtcbiAgICAgICAgaWYgKGJhdGNoICYmICFnb29nLmFycmF5LmlzRW1wdHkoYmF0Y2gpKSB7XG4gICAgICAgICAgdGhpcy5oYW5kbGVyXy5jaGFubmVsSGFuZGxlTXVsdGlwbGVBcnJheXModGhpcywgYmF0Y2gpO1xuICAgICAgICAgIGJhdGNoLmxlbmd0aCA9IDA7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG5leHRBcnJheVswXSA9PSAnc3RvcCcpIHtcbiAgICAgICAgICB0aGlzLnNpZ25hbEVycm9yXyhXZWJDaGFubmVsQmFzZS5FcnJvci5TVE9QKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLmRpc2Nvbm5lY3QoKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmIChuZXh0QXJyYXlbMF0gPT0gJ25vb3AnKSB7XG4gICAgICAgIC8vIGlnbm9yZSAtIG5vb3AgdG8ga2VlcCBjb25uZWN0aW9uIGhhcHB5XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoYmF0Y2gpIHtcbiAgICAgICAgICBiYXRjaC5wdXNoKG5leHRBcnJheSk7XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5oYW5kbGVyXykge1xuICAgICAgICAgIHRoaXMuaGFuZGxlcl8uY2hhbm5lbEhhbmRsZUFycmF5KHRoaXMsIG5leHRBcnJheSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIC8vIFdlIGhhdmUgcmVjZWl2ZWQgdXNlZnVsIGRhdGEgb24gdGhlIGJhY2stY2hhbm5lbCwgc28gY2xlYXIgaXRzIHJldHJ5XG4gICAgICAvLyBjb3VudC4gV2UgZG8gdGhpcyBiZWNhdXNlIGJhY2stY2hhbm5lbHMgYnkgZGVzaWduIGRvIG5vdCBjb21wbGV0ZVxuICAgICAgLy8gcXVpY2tseSwgc28gb24gYSBmbGFreSBjb25uZWN0aW9uIHdlIGNvdWxkIGhhdmUgbWFueSBmYWlsIHRvIGNvbXBsZXRlXG4gICAgICAvLyBmdWxseSBidXQgc3RpbGwgZGVsaXZlciBhIGxvdCBvZiBkYXRhIGJlZm9yZSB0aGV5IGZhaWwuIFdlIGRvbid0IHdhbnRcbiAgICAgIC8vIHRvIGNvdW50IHN1Y2ggZmFpbHVyZXMgdG93YXJkcyB0aGUgcmV0cnkgbGltaXQsIGJlY2F1c2Ugd2UgZG9uJ3Qgd2FudFxuICAgICAgLy8gdG8gZ2l2ZSB1cCBvbiBhIHNlc3Npb24gaWYgd2UgY2FuIHN0aWxsIHJlY2VpdmUgZGF0YS5cbiAgICAgIHRoaXMuYmFja0NoYW5uZWxSZXRyeUNvdW50XyA9IDA7XG4gICAgfVxuICB9XG4gIGlmIChiYXRjaCAmJiAhZ29vZy5hcnJheS5pc0VtcHR5KGJhdGNoKSkge1xuICAgIHRoaXMuaGFuZGxlcl8uY2hhbm5lbEhhbmRsZU11bHRpcGxlQXJyYXlzKHRoaXMsIGJhdGNoKTtcbiAgfVxufTtcblxuXG4vKipcbiAqIFN0YXJ0cyB0aGUgYmFja2NoYW5uZWwgYWZ0ZXIgdGhlIGhhbmRzaGFrZS5cbiAqXG4gKiBAcGFyYW0geyFDaGFubmVsUmVxdWVzdH0gcmVxdWVzdCBUaGUgdW5kZXJseWluZyByZXF1ZXN0IG9iamVjdFxuICogQHByaXZhdGVcbiAqL1xuV2ViQ2hhbm5lbEJhc2UucHJvdG90eXBlLnN0YXJ0QmFja2NoYW5uZWxBZnRlckhhbmRzaGFrZV8gPSBmdW5jdGlvbihyZXF1ZXN0KSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgdGhpcy5iYWNrQ2hhbm5lbFVyaV8gPSB0aGlzLmdldEJhY2tDaGFubmVsVXJpKFxuICAgICAgdGhpcy5ob3N0UHJlZml4XywgLyoqIEB0eXBlIHtzdHJpbmd9ICovICh0aGlzLnBhdGhfKSk7XG5cbiAgaWYgKHJlcXVlc3QuaXNJbml0aWFsUmVzcG9uc2VEZWNvZGVkKCkpIHtcbiAgICB0aGlzLmNoYW5uZWxEZWJ1Z18uZGVidWcoJ1VwZ3JhZGUgdGhlIGhhbmRzaGFrZSByZXF1ZXN0IHRvIGEgYmFja2NoYW5uZWwuJyk7XG4gICAgdGhpcy5mb3J3YXJkQ2hhbm5lbFJlcXVlc3RQb29sXy5yZW1vdmVSZXF1ZXN0KHJlcXVlc3QpO1xuICAgIHJlcXVlc3QucmVzZXRUaW1lb3V0KHRoaXMuYmFja0NoYW5uZWxSZXF1ZXN0VGltZW91dE1zXyk7XG4gICAgdGhpcy5iYWNrQ2hhbm5lbFJlcXVlc3RfID0gcmVxdWVzdDtcbiAgfSBlbHNlIHtcbiAgICB0aGlzLmVuc3VyZUJhY2tDaGFubmVsXygpO1xuICB9XG59O1xuXG5cbi8qKlxuICogSGVscGVyIHRvIGVuc3VyZSB0aGUgY2hhbm5lbCBpcyBpbiB0aGUgZXhwZWN0ZWQgc3RhdGUuXG4gKiBAcGFyYW0gey4uLm51bWJlcn0gdmFyX2FyZ3MgVGhlIGNoYW5uZWwgbXVzdCBiZSBpbiBvbmUgb2YgdGhlIGluZGljYXRlZFxuICogICAgIHN0YXRlcy5cbiAqIEBwcml2YXRlXG4gKi9cbldlYkNoYW5uZWxCYXNlLnByb3RvdHlwZS5lbnN1cmVJblN0YXRlXyA9IGZ1bmN0aW9uKHZhcl9hcmdzKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgZ29vZy5hc3NlcnRzLmFzc2VydChcbiAgICAgIGdvb2cuYXJyYXkuY29udGFpbnMoYXJndW1lbnRzLCB0aGlzLnN0YXRlXyksXG4gICAgICAnVW5leHBlY3RlZCBjaGFubmVsIHN0YXRlOiAlcycsIHRoaXMuc3RhdGVfKTtcbn07XG5cblxuLyoqXG4gKiBTaWduYWxzIGFuIGVycm9yIGhhcyBvY2N1cnJlZC5cbiAqIEBwYXJhbSB7V2ViQ2hhbm5lbEJhc2UuRXJyb3J9IGVycm9yIFRoZSBlcnJvciBjb2RlIGZvciB0aGUgZmFpbHVyZS5cbiAqIEBwcml2YXRlXG4gKi9cbldlYkNoYW5uZWxCYXNlLnByb3RvdHlwZS5zaWduYWxFcnJvcl8gPSBmdW5jdGlvbihlcnJvcikge1xuICAndXNlIHN0cmljdCc7XG4gIHRoaXMuY2hhbm5lbERlYnVnXy5pbmZvKCdFcnJvciBjb2RlICcgKyBlcnJvcik7XG4gIGlmIChlcnJvciA9PSBXZWJDaGFubmVsQmFzZS5FcnJvci5SRVFVRVNUX0ZBSUxFRCkge1xuICAgIC8vIENyZWF0ZSBhIHNlcGFyYXRlIEludGVybmV0IGNvbm5lY3Rpb24gdG8gY2hlY2tcbiAgICAvLyBpZiBpdCdzIGEgc2VydmVyIGVycm9yIG9yIHVzZXIncyBuZXR3b3JrIGVycm9yLlxuICAgIGxldCBpbWFnZVVyaSA9IG51bGw7XG4gICAgaWYgKHRoaXMuaGFuZGxlcl8pIHtcbiAgICAgIGltYWdlVXJpID0gdGhpcy5oYW5kbGVyXy5nZXROZXR3b3JrVGVzdEltYWdlVXJpKHRoaXMpO1xuICAgIH1cbiAgICBuZXRVdGlscy50ZXN0TmV0d29yayhnb29nLmJpbmQodGhpcy50ZXN0TmV0d29ya0NhbGxiYWNrXywgdGhpcyksIGltYWdlVXJpKTtcbiAgfSBlbHNlIHtcbiAgICByZXF1ZXN0U3RhdHMubm90aWZ5U3RhdEV2ZW50KHJlcXVlc3RTdGF0cy5TdGF0LkVSUk9SX09USEVSKTtcbiAgfVxuICB0aGlzLm9uRXJyb3JfKGVycm9yKTtcbn07XG5cblxuLyoqXG4gKiBDYWxsYmFjayBmb3IgbmV0VXRpbHMudGVzdE5ldHdvcmsgZHVyaW5nIGVycm9yIGhhbmRsaW5nLlxuICogQHBhcmFtIHtib29sZWFufSBuZXR3b3JrVXAgV2hldGhlciB0aGUgbmV0d29yayBpcyB1cC5cbiAqIEBwcml2YXRlXG4gKi9cbldlYkNoYW5uZWxCYXNlLnByb3RvdHlwZS50ZXN0TmV0d29ya0NhbGxiYWNrXyA9IGZ1bmN0aW9uKG5ldHdvcmtVcCkge1xuICAndXNlIHN0cmljdCc7XG4gIGlmIChuZXR3b3JrVXApIHtcbiAgICB0aGlzLmNoYW5uZWxEZWJ1Z18uaW5mbygnU3VjY2Vzc2Z1bGx5IHBpbmdlZCBnb29nbGUuY29tJyk7XG4gICAgcmVxdWVzdFN0YXRzLm5vdGlmeVN0YXRFdmVudChyZXF1ZXN0U3RhdHMuU3RhdC5FUlJPUl9PVEhFUik7XG4gIH0gZWxzZSB7XG4gICAgdGhpcy5jaGFubmVsRGVidWdfLmluZm8oJ0ZhaWxlZCB0byBwaW5nIGdvb2dsZS5jb20nKTtcbiAgICByZXF1ZXN0U3RhdHMubm90aWZ5U3RhdEV2ZW50KHJlcXVlc3RTdGF0cy5TdGF0LkVSUk9SX05FVFdPUkspO1xuICAgIC8vIERvIG5vdCBjYWxsIG9uRXJyb3JfIGFnYWluIHRvIGVsaW1pbmF0ZSBkdXBsaWNhdGVkIEVycm9yIGV2ZW50cy5cbiAgfVxufTtcblxuXG4vKipcbiAqIENhbGxlZCB3aGVuIG1lc3NhZ2VzIGhhdmUgYmVlbiBzdWNjZXNzZnVsbHkgc2VudCBmcm9tIHRoZSBxdWV1ZS5cbiAqIEBwYXJhbSB7IUNoYW5uZWxSZXF1ZXN0fSByZXF1ZXN0IFRoZSByZXF1ZXN0IG9iamVjdFxuICogQHByaXZhdGVcbiAqL1xuV2ViQ2hhbm5lbEJhc2UucHJvdG90eXBlLm9uU3VjY2Vzc18gPSBmdW5jdGlvbihyZXF1ZXN0KSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgaWYgKHRoaXMuaGFuZGxlcl8pIHtcbiAgICB0aGlzLmhhbmRsZXJfLmNoYW5uZWxTdWNjZXNzKHRoaXMsIHJlcXVlc3QpO1xuICB9XG59O1xuXG5cbi8qKlxuICogQ2FsbGVkIHdoZW4gd2UndmUgZGV0ZXJtaW5lZCB0aGUgZmluYWwgZXJyb3IgZm9yIGEgY2hhbm5lbC4gSXQgY2xvc2VzIHRoZVxuICogbm90aWZpZXJzIHRoZSBoYW5kbGVyIG9mIHRoZSBlcnJvciBhbmQgY2xvc2VzIHRoZSBjaGFubmVsLlxuICogQHBhcmFtIHtXZWJDaGFubmVsQmFzZS5FcnJvcn0gZXJyb3IgIFRoZSBlcnJvciBjb2RlIGZvciB0aGUgZmFpbHVyZS5cbiAqIEBwcml2YXRlXG4gKi9cbldlYkNoYW5uZWxCYXNlLnByb3RvdHlwZS5vbkVycm9yXyA9IGZ1bmN0aW9uKGVycm9yKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgdGhpcy5jaGFubmVsRGVidWdfLmRlYnVnKCdIdHRwQ2hhbm5lbDogZXJyb3IgLSAnICsgZXJyb3IpO1xuICB0aGlzLnN0YXRlXyA9IFdlYkNoYW5uZWxCYXNlLlN0YXRlLkNMT1NFRDtcbiAgaWYgKHRoaXMuaGFuZGxlcl8pIHtcbiAgICB0aGlzLmhhbmRsZXJfLmNoYW5uZWxFcnJvcih0aGlzLCBlcnJvcik7XG4gIH1cbiAgdGhpcy5vbkNsb3NlXygpO1xuICB0aGlzLmNhbmNlbFJlcXVlc3RzXygpO1xufTtcblxuXG4vKipcbiAqIENhbGxlZCB3aGVuIHRoZSBjaGFubmVsIGhhcyBiZWVuIGNsb3NlZC4gSXQgbm90aWZpZXJzIHRoZSBoYW5kbGVyIG9mIHRoZVxuICogZXZlbnQsIGFuZCByZXBvcnRzIGFueSBwZW5kaW5nIG9yIHVuZGVsaXZlcmVkIG1hcHMuXG4gKiBAcHJpdmF0ZVxuICovXG5XZWJDaGFubmVsQmFzZS5wcm90b3R5cGUub25DbG9zZV8gPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICB0aGlzLnN0YXRlXyA9IFdlYkNoYW5uZWxCYXNlLlN0YXRlLkNMT1NFRDtcbiAgdGhpcy5sYXN0U3RhdHVzQ29kZV8gPSAtMTtcbiAgaWYgKHRoaXMuaGFuZGxlcl8pIHtcbiAgICBjb25zdCBwZW5kaW5nTWVzc2FnZXMgPVxuICAgICAgICB0aGlzLmZvcndhcmRDaGFubmVsUmVxdWVzdFBvb2xfLmdldFBlbmRpbmdNZXNzYWdlcygpO1xuXG4gICAgaWYgKHBlbmRpbmdNZXNzYWdlcy5sZW5ndGggPT0gMCAmJiB0aGlzLm91dGdvaW5nTWFwc18ubGVuZ3RoID09IDApIHtcbiAgICAgIHRoaXMuaGFuZGxlcl8uY2hhbm5lbENsb3NlZCh0aGlzKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XG4gICAgICB0aGlzLmNoYW5uZWxEZWJ1Z18uZGVidWcoZnVuY3Rpb24oKSB7XG4gICAgICAgICd1c2Ugc3RyaWN0JztcbiAgICAgICAgcmV0dXJuICdOdW1iZXIgb2YgdW5kZWxpdmVyZWQgbWFwcycgK1xuICAgICAgICAgICAgJywgcGVuZGluZzogJyArIHBlbmRpbmdNZXNzYWdlcy5sZW5ndGggK1xuICAgICAgICAgICAgJywgb3V0Z29pbmc6ICcgKyBzZWxmLm91dGdvaW5nTWFwc18ubGVuZ3RoO1xuICAgICAgfSk7XG5cbiAgICAgIHRoaXMuZm9yd2FyZENoYW5uZWxSZXF1ZXN0UG9vbF8uY2xlYXJQZW5kaW5nTWVzc2FnZXMoKTtcblxuICAgICAgY29uc3QgY29weU9mVW5kZWxpdmVyZWRNYXBzID0gZ29vZy5hcnJheS5jbG9uZSh0aGlzLm91dGdvaW5nTWFwc18pO1xuICAgICAgdGhpcy5vdXRnb2luZ01hcHNfLmxlbmd0aCA9IDA7XG5cbiAgICAgIHRoaXMuaGFuZGxlcl8uY2hhbm5lbENsb3NlZCh0aGlzLCBwZW5kaW5nTWVzc2FnZXMsIGNvcHlPZlVuZGVsaXZlcmVkTWFwcyk7XG4gICAgfVxuICB9XG59O1xuXG5cbi8qKlxuICogQG92ZXJyaWRlXG4gKi9cbldlYkNoYW5uZWxCYXNlLnByb3RvdHlwZS5nZXRGb3J3YXJkQ2hhbm5lbFVyaSA9IGZ1bmN0aW9uKHBhdGgpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBjb25zdCB1cmkgPSB0aGlzLmNyZWF0ZURhdGFVcmkobnVsbCwgcGF0aCk7XG4gIHRoaXMuY2hhbm5lbERlYnVnXy5kZWJ1ZygnR2V0Rm9yd2FyZENoYW5uZWxVcmk6ICcgKyB1cmkpO1xuICByZXR1cm4gdXJpO1xufTtcblxuXG4vKipcbiAqIEBvdmVycmlkZVxuICovXG5XZWJDaGFubmVsQmFzZS5wcm90b3R5cGUuZ2V0Q29ubmVjdGlvblN0YXRlID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmV0dXJuIHRoaXMuY29ublN0YXRlXztcbn07XG5cblxuLyoqXG4gKiBAb3ZlcnJpZGVcbiAqL1xuV2ViQ2hhbm5lbEJhc2UucHJvdG90eXBlLmdldEJhY2tDaGFubmVsVXJpID0gZnVuY3Rpb24oaG9zdFByZWZpeCwgcGF0aCkge1xuICAndXNlIHN0cmljdCc7XG4gIGNvbnN0IHVyaSA9IHRoaXMuY3JlYXRlRGF0YVVyaShcbiAgICAgIHRoaXMuc2hvdWxkVXNlU2Vjb25kYXJ5RG9tYWlucygpID8gaG9zdFByZWZpeCA6IG51bGwsIHBhdGgpO1xuICB0aGlzLmNoYW5uZWxEZWJ1Z18uZGVidWcoJ0dldEJhY2tDaGFubmVsVXJpOiAnICsgdXJpKTtcbiAgcmV0dXJuIHVyaTtcbn07XG5cblxuLyoqXG4gKiBAb3ZlcnJpZGVcbiAqL1xuV2ViQ2hhbm5lbEJhc2UucHJvdG90eXBlLmNyZWF0ZURhdGFVcmkgPSBmdW5jdGlvbihcbiAgICBob3N0UHJlZml4LCBwYXRoLCBvcHRfb3ZlcnJpZGVQb3J0KSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgbGV0IHVyaSA9IGdvb2cuVXJpLnBhcnNlKHBhdGgpO1xuICBjb25zdCB1cmlBYnNvbHV0ZSA9ICh1cmkuZ2V0RG9tYWluKCkgIT0gJycpO1xuICBpZiAodXJpQWJzb2x1dGUpIHtcbiAgICBpZiAoaG9zdFByZWZpeCkge1xuICAgICAgdXJpLnNldERvbWFpbihob3N0UHJlZml4ICsgJy4nICsgdXJpLmdldERvbWFpbigpKTtcbiAgICB9XG5cbiAgICB1cmkuc2V0UG9ydChvcHRfb3ZlcnJpZGVQb3J0IHx8IHVyaS5nZXRQb3J0KCkpO1xuICB9IGVsc2Uge1xuICAgIGNvbnN0IGxvY2F0aW9uUGFnZSA9IGdvb2cuZ2xvYmFsLmxvY2F0aW9uO1xuICAgIGxldCBob3N0TmFtZTtcbiAgICBpZiAoaG9zdFByZWZpeCkge1xuICAgICAgaG9zdE5hbWUgPSBob3N0UHJlZml4ICsgJy4nICsgbG9jYXRpb25QYWdlLmhvc3RuYW1lO1xuICAgIH0gZWxzZSB7XG4gICAgICBob3N0TmFtZSA9IGxvY2F0aW9uUGFnZS5ob3N0bmFtZTtcbiAgICB9XG5cbiAgICBjb25zdCBwb3J0ID0gb3B0X292ZXJyaWRlUG9ydCB8fCArbG9jYXRpb25QYWdlLnBvcnQ7XG5cbiAgICB1cmkgPSBnb29nLlVyaS5jcmVhdGUobG9jYXRpb25QYWdlLnByb3RvY29sLCBudWxsLCBob3N0TmFtZSwgcG9ydCwgcGF0aCk7XG4gIH1cblxuICBpZiAodGhpcy5leHRyYVBhcmFtc18pIHtcbiAgICBnb29nLm9iamVjdC5mb3JFYWNoKHRoaXMuZXh0cmFQYXJhbXNfLCBmdW5jdGlvbih2YWx1ZSwga2V5KSB7XG4gICAgICAndXNlIHN0cmljdCc7XG4gICAgICB1cmkuc2V0UGFyYW1ldGVyVmFsdWUoa2V5LCB2YWx1ZSk7XG4gICAgfSk7XG4gIH1cblxuICBjb25zdCBwYXJhbSA9IHRoaXMuZ2V0SHR0cFNlc3Npb25JZFBhcmFtKCk7XG4gIGNvbnN0IHZhbHVlID0gdGhpcy5nZXRIdHRwU2Vzc2lvbklkKCk7XG4gIGlmIChwYXJhbSAmJiB2YWx1ZSkge1xuICAgIHVyaS5zZXRQYXJhbWV0ZXJWYWx1ZShwYXJhbSwgdmFsdWUpO1xuICB9XG5cbiAgLy8gQWRkIHRoZSBwcm90b2NvbCB2ZXJzaW9uIHRvIHRoZSBVUkkuXG4gIHVyaS5zZXRQYXJhbWV0ZXJWYWx1ZSgnVkVSJywgdGhpcy5jaGFubmVsVmVyc2lvbl8pO1xuXG4gIC8vIEFkZCB0aGUgcmVjb25uZWN0IHBhcmFtZXRlcnMuXG4gIHRoaXMuYWRkQWRkaXRpb25hbFBhcmFtc18odXJpKTtcblxuICByZXR1cm4gdXJpO1xufTtcblxuLyoqXG4gKiBAb3ZlcnJpZGVcbiAqIEBwYXJhbSB7P3N0cmluZ30gaG9zdFByZWZpeCBUaGUgaG9zdCBwcmVmaXgsIGlmIHdlIG5lZWQgYW4gWGhySW8gb2JqZWN0XG4gKiAgICAgY2FwYWJsZSBvZiBjYWxsaW5nIGEgc2Vjb25kYXJ5IGRvbWFpbi5cbiAqIEBwYXJhbSB7Ym9vbGVhbj19IGlzU3RyZWFtaW5nIFdoZXRoZXIgb3Igbm90IGZldGNoL3N0cmVhbXMgYXJlIGVuYWJsZWQgZm9yXG4gKiAgICAgdGhlIHVuZGVybHlpbmcgSFRUUCByZXF1ZXN0LlxuICogQHJldHVybiB7IWdvb2cubmV0LlhocklvfSBBIG5ldyBYaHJJbyBvYmplY3QuXG4gKi9cbldlYkNoYW5uZWxCYXNlLnByb3RvdHlwZS5jcmVhdGVYaHJJbyA9IGZ1bmN0aW9uKGhvc3RQcmVmaXgsIGlzU3RyZWFtaW5nKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgaWYgKGhvc3RQcmVmaXggJiYgIXRoaXMuc3VwcG9ydHNDcm9zc0RvbWFpblhocnNfKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdDYW5cXCd0IGNyZWF0ZSBzZWNvbmRhcnkgZG9tYWluIGNhcGFibGUgWGhySW8gb2JqZWN0LicpO1xuICB9XG4gIGxldCB4aHI7XG4gIGlmIChpc1N0cmVhbWluZyAmJiB0aGlzLnVzZXNGZXRjaFN0cmVhbXNfICYmICF0aGlzLnhtbEh0dHBGYWN0b3J5Xykge1xuICAgIHhociA9IG5ldyBnb29nLm5ldC5YaHJJbyhcbiAgICAgICAgbmV3IGdvb2cubmV0LkZldGNoWG1sSHR0cEZhY3Rvcnkoe3N0cmVhbUJpbmFyeUNodW5rczogdHJ1ZX0pKTtcbiAgfSBlbHNlIHtcbiAgICB4aHIgPSBuZXcgZ29vZy5uZXQuWGhySW8odGhpcy54bWxIdHRwRmFjdG9yeV8pO1xuICB9XG4gIHhoci5zZXRXaXRoQ3JlZGVudGlhbHModGhpcy5zdXBwb3J0c0Nyb3NzRG9tYWluWGhyc18pO1xuICByZXR1cm4geGhyO1xufTtcblxuXG4vKipcbiAqIEBvdmVycmlkZVxuICovXG5XZWJDaGFubmVsQmFzZS5wcm90b3R5cGUuaXNBY3RpdmUgPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gISF0aGlzLmhhbmRsZXJfICYmIHRoaXMuaGFuZGxlcl8uaXNBY3RpdmUodGhpcyk7XG59O1xuXG5cbi8qKlxuICogQG92ZXJyaWRlXG4gKi9cbldlYkNoYW5uZWxCYXNlLnByb3RvdHlwZS5zaG91bGRVc2VTZWNvbmRhcnlEb21haW5zID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmV0dXJuIHRoaXMuc3VwcG9ydHNDcm9zc0RvbWFpblhocnNfO1xufTtcblxuXG4vKipcbiAqIFNldHMgKG92ZXJ3cml0ZXMpIHRoZSBmb3J3YXJkIGNoYW5uZWwgZmx1c2ggY2FsbGJhY2suXG4gKlxuICogQHBhcmFtIHtmdW5jdGlvbigpfSBjYWxsYmFjayBUaGUgY2FsbGJhY2sgdG8gYmUgaW52b2tlZC5cbiAqL1xuV2ViQ2hhbm5lbEJhc2UucHJvdG90eXBlLnNldEZvcndhcmRDaGFubmVsRmx1c2hDYWxsYmFjayA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgdGhpcy5mb3J3YXJkQ2hhbm5lbEZsdXNoZWRDYWxsYmFja18gPSBjYWxsYmFjaztcbn07XG5cblxuLyoqXG4gKiBBYnN0cmFjdCBiYXNlIGNsYXNzIGZvciB0aGUgY2hhbm5lbCBoYW5kbGVyXG4gKiBAY29uc3RydWN0b3JcbiAqIEBzdHJ1Y3RcbiAqL1xuV2ViQ2hhbm5lbEJhc2UuSGFuZGxlciA9IGZ1bmN0aW9uKCkge307XG5cblxuLyoqXG4gKiBDYWxsYmFjayBoYW5kbGVyIGZvciB3aGVuIGEgYmF0Y2ggb2YgcmVzcG9uc2UgYXJyYXlzIGlzIHJlY2VpdmVkIGZyb20gdGhlXG4gKiBzZXJ2ZXIuIFdoZW4gbnVsbCwgYmF0Y2hlZCBkaXNwYXRjaGluZyBpcyBkaXNhYmxlZC5cbiAqIEB0eXBlIHs/ZnVuY3Rpb24oIVdlYkNoYW5uZWxCYXNlLCAhQXJyYXk8IUFycmF5PD8+Pil9XG4gKi9cbldlYkNoYW5uZWxCYXNlLkhhbmRsZXIucHJvdG90eXBlLmNoYW5uZWxIYW5kbGVNdWx0aXBsZUFycmF5cyA9IG51bGw7XG5cblxuLyoqXG4gKiBXaGV0aGVyIGl0J3Mgb2theSB0byBtYWtlIGEgcmVxdWVzdCB0byB0aGUgc2VydmVyLiBBIGhhbmRsZXIgY2FuIHJldHVyblxuICogZmFsc2UgaWYgdGhlIGNoYW5uZWwgc2hvdWxkIGZhaWwuIEZvciBleGFtcGxlLCBpZiB0aGUgdXNlciBoYXMgbG9nZ2VkIG91dCxcbiAqIHRoZSBoYW5kbGVyIG1heSB3YW50IGFsbCByZXF1ZXN0cyB0byBmYWlsIGltbWVkaWF0ZWx5LlxuICogQHBhcmFtIHtXZWJDaGFubmVsQmFzZX0gY2hhbm5lbCBUaGUgY2hhbm5lbC5cbiAqIEByZXR1cm4ge1dlYkNoYW5uZWxCYXNlLkVycm9yfSBBbiBlcnJvciBjb2RlLiBUaGUgY29kZSBzaG91bGRcbiAqIHJldHVybiBXZWJDaGFubmVsQmFzZS5FcnJvci5PSyB0byBpbmRpY2F0ZSBpdCdzIG9rYXkuIEFueSBvdGhlclxuICogZXJyb3IgY29kZSB3aWxsIGNhdXNlIGEgZmFpbHVyZS5cbiAqL1xuV2ViQ2hhbm5lbEJhc2UuSGFuZGxlci5wcm90b3R5cGUub2tUb01ha2VSZXF1ZXN0ID0gZnVuY3Rpb24oY2hhbm5lbCkge1xuICAndXNlIHN0cmljdCc7XG4gIHJldHVybiBXZWJDaGFubmVsQmFzZS5FcnJvci5PSztcbn07XG5cblxuLyoqXG4gKiBJbmRpY2F0ZXMgdGhlIFdlYkNoYW5uZWwgaGFzIHN1Y2Nlc3NmdWxseSBuZWdvdGlhdGVkIHdpdGggdGhlIHNlcnZlclxuICogYW5kIGNhbiBub3cgc2VuZCBhbmQgcmVjZWl2ZSBkYXRhLlxuICogQHBhcmFtIHtXZWJDaGFubmVsQmFzZX0gY2hhbm5lbCBUaGUgY2hhbm5lbC5cbiAqL1xuV2ViQ2hhbm5lbEJhc2UuSGFuZGxlci5wcm90b3R5cGUuY2hhbm5lbE9wZW5lZCA9IGZ1bmN0aW9uKGNoYW5uZWwpIHt9O1xuXG5cbi8qKlxuICogTmV3IGlucHV0IGlzIGF2YWlsYWJsZSBmb3IgdGhlIGFwcGxpY2F0aW9uIHRvIHByb2Nlc3MuXG4gKlxuICogQHBhcmFtIHtXZWJDaGFubmVsQmFzZX0gY2hhbm5lbCBUaGUgY2hhbm5lbC5cbiAqIEBwYXJhbSB7QXJyYXk8Pz59IGFycmF5IFRoZSBkYXRhIGFycmF5LlxuICovXG5XZWJDaGFubmVsQmFzZS5IYW5kbGVyLnByb3RvdHlwZS5jaGFubmVsSGFuZGxlQXJyYXkgPSBmdW5jdGlvbihcbiAgICBjaGFubmVsLCBhcnJheSkge307XG5cblxuLyoqXG4gKiBJbmRpY2F0ZXMgbWVzc2FnZXMgdGhhdCBoYXZlIGJlZW4gc3VjY2Vzc2Z1bGx5IHNlbnQgb24gdGhlIGNoYW5uZWwuXG4gKlxuICogQHBhcmFtIHtXZWJDaGFubmVsQmFzZX0gY2hhbm5lbCBUaGUgY2hhbm5lbC5cbiAqIEBwYXJhbSB7IUNoYW5uZWxSZXF1ZXN0fSByZXF1ZXN0IFRoZSByZXF1ZXN0IG9iamVjdCB0aGF0IGNvbnRhaW5zXG4gKiAgICAgdGhlIHBlbmRpbmcgbWVzc2FnZXMgdGhhdCBoYXZlIGJlZW4gc3VjY2Vzc2Z1bGx5IGRlbGl2ZXJlZCB0byB0aGUgc2VydmVyLlxuICovXG5XZWJDaGFubmVsQmFzZS5IYW5kbGVyLnByb3RvdHlwZS5jaGFubmVsU3VjY2VzcyA9IGZ1bmN0aW9uKGNoYW5uZWwsIHJlcXVlc3QpIHt9O1xuXG5cbi8qKlxuICogSW5kaWNhdGVzIGFuIGVycm9yIG9jY3VycmVkIG9uIHRoZSBXZWJDaGFubmVsLlxuICpcbiAqIEBwYXJhbSB7V2ViQ2hhbm5lbEJhc2V9IGNoYW5uZWwgVGhlIGNoYW5uZWwuXG4gKiBAcGFyYW0ge1dlYkNoYW5uZWxCYXNlLkVycm9yfSBlcnJvciBUaGUgZXJyb3IgY29kZS5cbiAqL1xuV2ViQ2hhbm5lbEJhc2UuSGFuZGxlci5wcm90b3R5cGUuY2hhbm5lbEVycm9yID0gZnVuY3Rpb24oY2hhbm5lbCwgZXJyb3IpIHt9O1xuXG5cbi8qKlxuICogSW5kaWNhdGVzIHRoZSBXZWJDaGFubmVsIGlzIGNsb3NlZC4gQWxzbyBub3RpZmllcyBhYm91dCB3aGljaCBtYXBzLFxuICogaWYgYW55LCB0aGF0IG1heSBub3QgaGF2ZSBiZWVuIGRlbGl2ZXJlZCB0byB0aGUgc2VydmVyLlxuICogQHBhcmFtIHtXZWJDaGFubmVsQmFzZX0gY2hhbm5lbCBUaGUgY2hhbm5lbC5cbiAqIEBwYXJhbSB7QXJyYXk8V2lyZS5RdWV1ZWRNYXA+PX0gb3B0X3BlbmRpbmdNYXBzIFRoZVxuICogICAgIGFycmF5IG9mIHBlbmRpbmcgbWFwcywgd2hpY2ggbWF5IG9yIG1heSBub3QgaGF2ZSBiZWVuIGRlbGl2ZXJlZCB0byB0aGVcbiAqICAgICBzZXJ2ZXIuXG4gKiBAcGFyYW0ge0FycmF5PFdpcmUuUXVldWVkTWFwPj19IG9wdF91bmRlbGl2ZXJlZE1hcHNcbiAqICAgICBUaGUgYXJyYXkgb2YgdW5kZWxpdmVyZWQgbWFwcywgd2hpY2ggaGF2ZSBkZWZpbml0ZWx5IG5vdCBiZWVuIGRlbGl2ZXJlZFxuICogICAgIHRvIHRoZSBzZXJ2ZXIuXG4gKi9cbldlYkNoYW5uZWxCYXNlLkhhbmRsZXIucHJvdG90eXBlLmNoYW5uZWxDbG9zZWQgPSBmdW5jdGlvbihcbiAgICBjaGFubmVsLCBvcHRfcGVuZGluZ01hcHMsIG9wdF91bmRlbGl2ZXJlZE1hcHMpIHt9O1xuXG5cbi8qKlxuICogR2V0cyBhbnkgcGFyYW1ldGVycyB0aGF0IHNob3VsZCBiZSBhZGRlZCBhdCB0aGUgdGltZSBhbm90aGVyIGNvbm5lY3Rpb24gaXNcbiAqIG1hZGUgdG8gdGhlIHNlcnZlci5cbiAqIEBwYXJhbSB7V2ViQ2hhbm5lbEJhc2V9IGNoYW5uZWwgVGhlIGNoYW5uZWwuXG4gKiBAcmV0dXJuIHshT2JqZWN0fSBFeHRyYSBwYXJhbWV0ZXIga2V5cyBhbmQgdmFsdWVzIHRvIGFkZCB0byB0aGUgcmVxdWVzdHMuXG4gKi9cbldlYkNoYW5uZWxCYXNlLkhhbmRsZXIucHJvdG90eXBlLmdldEFkZGl0aW9uYWxQYXJhbXMgPSBmdW5jdGlvbihjaGFubmVsKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmV0dXJuIHt9O1xufTtcblxuXG4vKipcbiAqIEdldHMgdGhlIFVSSSBvZiBhbiBpbWFnZSB0aGF0IGNhbiBiZSB1c2VkIHRvIHRlc3QgbmV0d29yayBjb25uZWN0aXZpdHkuXG4gKiBAcGFyYW0ge1dlYkNoYW5uZWxCYXNlfSBjaGFubmVsIFRoZSBjaGFubmVsLlxuICogQHJldHVybiB7Z29vZy5Vcmk/fSBBIGN1c3RvbSBVUkkgdG8gbG9hZCBmb3IgdGhlIG5ldHdvcmsgdGVzdC5cbiAqL1xuV2ViQ2hhbm5lbEJhc2UuSGFuZGxlci5wcm90b3R5cGUuZ2V0TmV0d29ya1Rlc3RJbWFnZVVyaSA9IGZ1bmN0aW9uKGNoYW5uZWwpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gbnVsbDtcbn07XG5cblxuLyoqXG4gKiBHZXRzIHdoZXRoZXIgdGhpcyBjaGFubmVsIGlzIGN1cnJlbnRseSBhY3RpdmUuIFRoaXMgaXMgdXNlZCB0byBkZXRlcm1pbmUgdGhlXG4gKiBsZW5ndGggb2YgdGltZSB0byB3YWl0IGJlZm9yZSByZXRyeWluZy5cbiAqIEBwYXJhbSB7V2ViQ2hhbm5lbEJhc2V9IGNoYW5uZWwgVGhlIGNoYW5uZWwuXG4gKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoZSBjaGFubmVsIGlzIGN1cnJlbnRseSBhY3RpdmUuXG4gKi9cbldlYkNoYW5uZWxCYXNlLkhhbmRsZXIucHJvdG90eXBlLmlzQWN0aXZlID0gZnVuY3Rpb24oY2hhbm5lbCkge1xuICAndXNlIHN0cmljdCc7XG4gIHJldHVybiB0cnVlO1xufTtcblxuLyoqXG4gKiBXaGV0aGVyIG9yIG5vdCB0aGlzIGNoYW5uZWwgdXNlcyBXSEFUV0cgRmV0Y2gvc3RyZWFtcy5cbiAqIEBvdmVycmlkZVxuICogQHJldHVybiB7Ym9vbGVhbn1cbiAqL1xuV2ViQ2hhbm5lbEJhc2UucHJvdG90eXBlLnVzZXNGZXRjaFN0cmVhbXMgPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gdGhpcy51c2VzRmV0Y2hTdHJlYW1zXztcbn07XG5cblxuLyoqXG4gKiBDYWxsZWQgYnkgdGhlIGNoYW5uZWwgaWYgZW51bWVyYXRpb24gb2YgdGhlIG1hcCB0aHJvd3MgYW4gZXhjZXB0aW9uLlxuICogQHBhcmFtIHtXZWJDaGFubmVsQmFzZX0gY2hhbm5lbCBUaGUgY2hhbm5lbC5cbiAqIEBwYXJhbSB7T2JqZWN0fSBtYXAgVGhlIG1hcCB0aGF0IGNhbid0IGJlIGVudW1lcmF0ZWQuXG4gKi9cbldlYkNoYW5uZWxCYXNlLkhhbmRsZXIucHJvdG90eXBlLmJhZE1hcEVycm9yID0gZnVuY3Rpb24oY2hhbm5lbCwgbWFwKSB7fTtcblxuXG4vKipcbiAqIEFsbG93cyB0aGUgaGFuZGxlciB0byBvdmVycmlkZSBhIGhvc3QgcHJlZml4IHByb3ZpZGVkIGJ5IHRoZSBzZXJ2ZXIuIFdpbGxcbiAqIGJlIGNhbGxlZCB3aGVuZXZlciB0aGUgY2hhbm5lbCBoYXMgcmVjZWl2ZWQgc3VjaCBhIHByZWZpeCBhbmQgaXMgY29uc2lkZXJpbmdcbiAqIGl0cyB1c2UuXG4gKiBAcGFyYW0gez9zdHJpbmd9IHNlcnZlckhvc3RQcmVmaXggVGhlIGhvc3QgcHJlZml4IHByb3ZpZGVkIGJ5IHRoZSBzZXJ2ZXIuXG4gKiBAcmV0dXJuIHs/c3RyaW5nfSBUaGUgaG9zdCBwcmVmaXggdGhlIGNsaWVudCBzaG91bGQgdXNlLlxuICovXG5XZWJDaGFubmVsQmFzZS5IYW5kbGVyLnByb3RvdHlwZS5jb3JyZWN0SG9zdFByZWZpeCA9IGZ1bmN0aW9uKFxuICAgIHNlcnZlckhvc3RQcmVmaXgpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gc2VydmVySG9zdFByZWZpeDtcbn07XG59KTsgIC8vIGdvb2cuc2NvcGVcbiIsICIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgVGhlIENsb3N1cmUgTGlicmFyeSBBdXRob3JzLlxuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIEBmaWxlb3ZlcnZpZXcgQ2xhc3MgZm9yIHBhcnNpbmcgYW5kIGZvcm1hdHRpbmcgVVJJcy5cbiAqXG4gKiBUaGlzIHBhY2thZ2UgaXMgZGVwcmVjYXRlZCBpbiBmYXZvdXIgb2YgdGhlIENsb3N1cmUgVVJMIHBhY2thZ2UgKGdvb2cudXJsKVxuICogd2hlbiBtYW5pcHVsYXRpbmcgVVJJcyBmb3IgdXNlIGJ5IGEgYnJvd3Nlci4gVGhpcyBwYWNrYWdlIHVzZXMgcmVndWxhclxuICogZXhwcmVzc2lvbnMgdG8gcGFyc2UgYSBwb3RlbnRpYWwgVVJJIHdoaWNoIGNhbiBmYWxsIG91dCBvZiBzeW5jIHdpdGggaG93IGFcbiAqIGJyb3dzZXIgd2lsbCBhY3R1YWxseSBpbnRlcnByZXQgdGhlIFVSSS4gU2VlXG4gKiBgZ29vZy51cmkudXRpbHMuc2V0VXJsUGFja2FnZVN1cHBvcnRMb2dnaW5nSGFuZGxlcmAgZm9yIG9uZSB3YXkgdG8gaWRlbnRpZnlcbiAqIFVSSXMgdGhhdCBzaG91bGQgaW5zdGVhZCBiZSBwYXJzZWQgdXNpbmcgdGhlIFVSTCBwYWNrYWdlLlxuICpcbiAqIFVzZSBnb29nLlVyaShzdHJpbmcpIHRvIHBhcnNlIGEgVVJJIHN0cmluZy4gIFVzZSBnb29nLlVyaS5jcmVhdGUoLi4uKSB0b1xuICogY3JlYXRlIGEgbmV3IGluc3RhbmNlIG9mIHRoZSBnb29nLlVyaSBvYmplY3QgZnJvbSBVcmkgcGFydHMuXG4gKlxuICogZS5nOiA8Y29kZT52YXIgbXlVcmkgPSBuZXcgZ29vZy5Vcmkod2luZG93LmxvY2F0aW9uKTs8L2NvZGU+XG4gKlxuICogSW1wbGVtZW50cyBSRkMgMzk4NiBmb3IgcGFyc2luZy9mb3JtYXR0aW5nIFVSSXMuXG4gKiBodHRwOi8vd3d3LmlldGYub3JnL3JmYy9yZmMzOTg2LnR4dFxuICpcbiAqIFNvbWUgY2hhbmdlcyBoYXZlIGJlZW4gbWFkZSB0byB0aGUgaW50ZXJmYWNlIChtb3JlIGxpa2UgLk5FVHMpLCB0aG91Z2ggdGhlXG4gKiBpbnRlcm5hbCByZXByZXNlbnRhdGlvbiBpcyBub3cgb2YgdW4tZW5jb2RlZCBwYXJ0cywgdGhpcyB3aWxsIGNoYW5nZSB0aGVcbiAqIGJlaGF2aW9yIHNsaWdodGx5LlxuICovXG5cbmdvb2cucHJvdmlkZSgnZ29vZy5VcmknKTtcbmdvb2cucHJvdmlkZSgnZ29vZy5VcmkuUXVlcnlEYXRhJyk7XG5cbmdvb2cucmVxdWlyZSgnZ29vZy5hcnJheScpO1xuZ29vZy5yZXF1aXJlKCdnb29nLmFzc2VydHMnKTtcbmdvb2cucmVxdWlyZSgnZ29vZy5zdHJpbmcnKTtcbmdvb2cucmVxdWlyZSgnZ29vZy5zdHJ1Y3RzJyk7XG5nb29nLnJlcXVpcmUoJ2dvb2cuc3RydWN0cy5NYXAnKTtcbmdvb2cucmVxdWlyZSgnZ29vZy51cmkudXRpbHMnKTtcbmdvb2cucmVxdWlyZSgnZ29vZy51cmkudXRpbHMuQ29tcG9uZW50SW5kZXgnKTtcbmdvb2cucmVxdWlyZSgnZ29vZy51cmkudXRpbHMuU3RhbmRhcmRRdWVyeVBhcmFtJyk7XG5cblxuXG4vKipcbiAqIFRoaXMgY2xhc3MgY29udGFpbnMgc2V0dGVycyBhbmQgZ2V0dGVycyBmb3IgdGhlIHBhcnRzIG9mIHRoZSBVUkkuXG4gKiBUaGUgPGNvZGU+Z2V0WHl6PC9jb2RlPi88Y29kZT5zZXRYeXo8L2NvZGU+IG1ldGhvZHMgcmV0dXJuIHRoZSBkZWNvZGVkIHBhcnRcbiAqIC0tIHNvPGNvZGU+Z29vZy5VcmkucGFyc2UoJy9mb28lMjBiYXInKS5nZXRQYXRoKCk8L2NvZGU+IHdpbGwgcmV0dXJuIHRoZVxuICogZGVjb2RlZCBwYXRoLCA8Y29kZT4vZm9vIGJhcjwvY29kZT4uXG4gKlxuICogUmVzZXJ2ZWQgY2hhcmFjdGVycyAoc2VlIFJGQyAzOTg2IHNlY3Rpb24gMi4yKSBjYW4gYmUgcHJlc2VudCBpblxuICogdGhlaXIgcGVyY2VudC1lbmNvZGVkIGZvcm0gaW4gc2NoZW1lLCBkb21haW4sIGFuZCBwYXRoIFVSSSBjb21wb25lbnRzIGFuZFxuICogd2lsbCBub3QgYmUgYXV0by1kZWNvZGVkLiBGb3IgZXhhbXBsZTpcbiAqIDxjb2RlPmdvb2cuVXJpLnBhcnNlKCdyZWwlNjF0aXZlL3BhdGglMmZ0by9yZXNvdXJjZScpLmdldFBhdGgoKTwvY29kZT4gd2lsbFxuICogcmV0dXJuIDxjb2RlPnJlbGF0aXZlL3BhdGglMmZ0by9yZXNvdXJjZTwvY29kZT4uXG4gKlxuICogVGhlIGNvbnN0cnVjdG9yIGFjY2VwdHMgYW4gb3B0aW9uYWwgdW5wYXJzZWQsIHJhdyBVUkkgc3RyaW5nLiAgVGhlIHBhcnNlclxuICogaXMgcmVsYXhlZCwgc28gc3BlY2lhbCBjaGFyYWN0ZXJzIHRoYXQgYXJlbid0IGVzY2FwZWQgYnV0IGRvbid0IGNhdXNlXG4gKiBhbWJpZ3VpdGllcyB3aWxsIG5vdCBjYXVzZSBwYXJzZSBmYWlsdXJlcy5cbiAqXG4gKiBBbGwgc2V0dGVycyByZXR1cm4gPGNvZGU+dGhpczwvY29kZT4gYW5kIHNvIG1heSBiZSBjaGFpbmVkLCBhIGxhXG4gKiA8Y29kZT5nb29nLlVyaS5wYXJzZSgnL2ZvbycpLnNldEZyYWdtZW50KCdwYXJ0JykudG9TdHJpbmcoKTwvY29kZT4uXG4gKlxuICogQHBhcmFtIHsqPX0gb3B0X3VyaSBPcHRpb25hbCBzdHJpbmcgVVJJIHRvIHBhcnNlXG4gKiAgICAgICAgKHVzZSBnb29nLlVyaS5jcmVhdGUoKSB0byBjcmVhdGUgYSBVUkkgZnJvbSBwYXJ0cyksIG9yIGlmXG4gKiAgICAgICAgYSBnb29nLlVyaSBpcyBwYXNzZWQsIGEgY2xvbmUgaXMgY3JlYXRlZC5cbiAqIEBwYXJhbSB7Ym9vbGVhbj19IG9wdF9pZ25vcmVDYXNlIElmIHRydWUsICNnZXRQYXJhbWV0ZXJWYWx1ZSB3aWxsIGlnbm9yZVxuICogdGhlIGNhc2Ugb2YgdGhlIHBhcmFtZXRlciBuYW1lLlxuICpcbiAqIEB0aHJvd3MgVVJJRXJyb3IgSWYgb3B0X3VyaSBpcyBwcm92aWRlZCBhbmQgVVJJIGlzIG1hbGZvcm1lZCAodGhhdCBpcyxcbiAqICAgICBpZiBkZWNvZGVVUklDb21wb25lbnQgZmFpbHMgb24gYW55IG9mIHRoZSBVUkkgY29tcG9uZW50cykuXG4gKiBAY29uc3RydWN0b3JcbiAqIEBzdHJ1Y3RcbiAqL1xuZ29vZy5VcmkgPSBmdW5jdGlvbihvcHRfdXJpLCBvcHRfaWdub3JlQ2FzZSkge1xuICAndXNlIHN0cmljdCc7XG4gIC8qKlxuICAgKiBTY2hlbWUgc3VjaCBhcyBcImh0dHBcIi5cbiAgICogQHByaXZhdGUge3N0cmluZ31cbiAgICovXG4gIHRoaXMuc2NoZW1lXyA9ICcnO1xuXG4gIC8qKlxuICAgKiBVc2VyIGNyZWRlbnRpYWxzIGluIHRoZSBmb3JtIFwidXNlcm5hbWU6cGFzc3dvcmRcIi5cbiAgICogQHByaXZhdGUge3N0cmluZ31cbiAgICovXG4gIHRoaXMudXNlckluZm9fID0gJyc7XG5cbiAgLyoqXG4gICAqIERvbWFpbiBwYXJ0LCBlLmcuIFwid3d3Lmdvb2dsZS5jb21cIi5cbiAgICogQHByaXZhdGUge3N0cmluZ31cbiAgICovXG4gIHRoaXMuZG9tYWluXyA9ICcnO1xuXG4gIC8qKlxuICAgKiBQb3J0LCBlLmcuIDgwODAuXG4gICAqIEBwcml2YXRlIHs/bnVtYmVyfVxuICAgKi9cbiAgdGhpcy5wb3J0XyA9IG51bGw7XG5cbiAgLyoqXG4gICAqIFBhdGgsIGUuZy4gXCIvdGVzdHMvaW1nLnBuZ1wiLlxuICAgKiBAcHJpdmF0ZSB7c3RyaW5nfVxuICAgKi9cbiAgdGhpcy5wYXRoXyA9ICcnO1xuXG4gIC8qKlxuICAgKiBUaGUgZnJhZ21lbnQgd2l0aG91dCB0aGUgIy5cbiAgICogQHByaXZhdGUge3N0cmluZ31cbiAgICovXG4gIHRoaXMuZnJhZ21lbnRfID0gJyc7XG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgb3Igbm90IHRoaXMgVXJpIHNob3VsZCBiZSB0cmVhdGVkIGFzIFJlYWQgT25seS5cbiAgICogQHByaXZhdGUge2Jvb2xlYW59XG4gICAqL1xuICB0aGlzLmlzUmVhZE9ubHlfID0gZmFsc2U7XG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgb3Igbm90IHRvIGlnbm9yZSBjYXNlIHdoZW4gY29tcGFyaW5nIHF1ZXJ5IHBhcmFtcy5cbiAgICogQHByaXZhdGUge2Jvb2xlYW59XG4gICAqL1xuICB0aGlzLmlnbm9yZUNhc2VfID0gZmFsc2U7XG5cbiAgLyoqXG4gICAqIE9iamVjdCByZXByZXNlbnRpbmcgcXVlcnkgZGF0YS5cbiAgICogQHByaXZhdGUgeyFnb29nLlVyaS5RdWVyeURhdGF9XG4gICAqL1xuICB0aGlzLnF1ZXJ5RGF0YV87XG5cbiAgLy8gUGFyc2UgaW4gdGhlIHVyaSBzdHJpbmdcbiAgdmFyIG07XG4gIGlmIChvcHRfdXJpIGluc3RhbmNlb2YgZ29vZy5VcmkpIHtcbiAgICB0aGlzLmlnbm9yZUNhc2VfID0gKG9wdF9pZ25vcmVDYXNlICE9PSB1bmRlZmluZWQpID8gb3B0X2lnbm9yZUNhc2UgOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRfdXJpLmdldElnbm9yZUNhc2UoKTtcbiAgICB0aGlzLnNldFNjaGVtZShvcHRfdXJpLmdldFNjaGVtZSgpKTtcbiAgICB0aGlzLnNldFVzZXJJbmZvKG9wdF91cmkuZ2V0VXNlckluZm8oKSk7XG4gICAgdGhpcy5zZXREb21haW4ob3B0X3VyaS5nZXREb21haW4oKSk7XG4gICAgdGhpcy5zZXRQb3J0KG9wdF91cmkuZ2V0UG9ydCgpKTtcbiAgICB0aGlzLnNldFBhdGgob3B0X3VyaS5nZXRQYXRoKCkpO1xuICAgIHRoaXMuc2V0UXVlcnlEYXRhKG9wdF91cmkuZ2V0UXVlcnlEYXRhKCkuY2xvbmUoKSk7XG4gICAgdGhpcy5zZXRGcmFnbWVudChvcHRfdXJpLmdldEZyYWdtZW50KCkpO1xuICB9IGVsc2UgaWYgKG9wdF91cmkgJiYgKG0gPSBnb29nLnVyaS51dGlscy5zcGxpdChTdHJpbmcob3B0X3VyaSkpKSkge1xuICAgIHRoaXMuaWdub3JlQ2FzZV8gPSAhIW9wdF9pZ25vcmVDYXNlO1xuXG4gICAgLy8gU2V0IHRoZSBwYXJ0cyAtLSBkZWNvZGluZyBhcyB3ZSBkbyBzby5cbiAgICAvLyBDT01QQVRJQklMSVRZIE5PVEUgLSBJbiBJRSwgdW5tYXRjaGVkIGZpZWxkcyBtYXkgYmUgZW1wdHkgc3RyaW5ncyxcbiAgICAvLyB3aGVyZWFzIGluIG90aGVyIGJyb3dzZXJzIHRoZXkgd2lsbCBiZSB1bmRlZmluZWQuXG4gICAgdGhpcy5zZXRTY2hlbWUobVtnb29nLnVyaS51dGlscy5Db21wb25lbnRJbmRleC5TQ0hFTUVdIHx8ICcnLCB0cnVlKTtcbiAgICB0aGlzLnNldFVzZXJJbmZvKG1bZ29vZy51cmkudXRpbHMuQ29tcG9uZW50SW5kZXguVVNFUl9JTkZPXSB8fCAnJywgdHJ1ZSk7XG4gICAgdGhpcy5zZXREb21haW4obVtnb29nLnVyaS51dGlscy5Db21wb25lbnRJbmRleC5ET01BSU5dIHx8ICcnLCB0cnVlKTtcbiAgICB0aGlzLnNldFBvcnQobVtnb29nLnVyaS51dGlscy5Db21wb25lbnRJbmRleC5QT1JUXSk7XG4gICAgdGhpcy5zZXRQYXRoKG1bZ29vZy51cmkudXRpbHMuQ29tcG9uZW50SW5kZXguUEFUSF0gfHwgJycsIHRydWUpO1xuICAgIHRoaXMuc2V0UXVlcnlEYXRhKG1bZ29vZy51cmkudXRpbHMuQ29tcG9uZW50SW5kZXguUVVFUllfREFUQV0gfHwgJycsIHRydWUpO1xuICAgIHRoaXMuc2V0RnJhZ21lbnQobVtnb29nLnVyaS51dGlscy5Db21wb25lbnRJbmRleC5GUkFHTUVOVF0gfHwgJycsIHRydWUpO1xuXG4gIH0gZWxzZSB7XG4gICAgdGhpcy5pZ25vcmVDYXNlXyA9ICEhb3B0X2lnbm9yZUNhc2U7XG4gICAgdGhpcy5xdWVyeURhdGFfID0gbmV3IGdvb2cuVXJpLlF1ZXJ5RGF0YShudWxsLCB0aGlzLmlnbm9yZUNhc2VfKTtcbiAgfVxufTtcblxuXG4vKipcbiAqIFBhcmFtZXRlciBuYW1lIGFkZGVkIHRvIHN0b3AgY2FjaGluZy5cbiAqIEB0eXBlIHtzdHJpbmd9XG4gKi9cbmdvb2cuVXJpLlJBTkRPTV9QQVJBTSA9IGdvb2cudXJpLnV0aWxzLlN0YW5kYXJkUXVlcnlQYXJhbS5SQU5ET007XG5cblxuLyoqXG4gKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSBzdHJpbmcgZm9ybSBvZiB0aGUgdXJsLlxuICogQG92ZXJyaWRlXG4gKi9cbmdvb2cuVXJpLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIHZhciBvdXQgPSBbXTtcblxuICB2YXIgc2NoZW1lID0gdGhpcy5nZXRTY2hlbWUoKTtcbiAgaWYgKHNjaGVtZSkge1xuICAgIG91dC5wdXNoKFxuICAgICAgICBnb29nLlVyaS5lbmNvZGVTcGVjaWFsQ2hhcnNfKFxuICAgICAgICAgICAgc2NoZW1lLCBnb29nLlVyaS5yZURpc2FsbG93ZWRJblNjaGVtZU9yVXNlckluZm9fLCB0cnVlKSxcbiAgICAgICAgJzonKTtcbiAgfVxuXG4gIHZhciBkb21haW4gPSB0aGlzLmdldERvbWFpbigpO1xuICBpZiAoZG9tYWluIHx8IHNjaGVtZSA9PSAnZmlsZScpIHtcbiAgICBvdXQucHVzaCgnLy8nKTtcblxuICAgIHZhciB1c2VySW5mbyA9IHRoaXMuZ2V0VXNlckluZm8oKTtcbiAgICBpZiAodXNlckluZm8pIHtcbiAgICAgIG91dC5wdXNoKFxuICAgICAgICAgIGdvb2cuVXJpLmVuY29kZVNwZWNpYWxDaGFyc18oXG4gICAgICAgICAgICAgIHVzZXJJbmZvLCBnb29nLlVyaS5yZURpc2FsbG93ZWRJblNjaGVtZU9yVXNlckluZm9fLCB0cnVlKSxcbiAgICAgICAgICAnQCcpO1xuICAgIH1cblxuICAgIG91dC5wdXNoKGdvb2cuVXJpLnJlbW92ZURvdWJsZUVuY29kaW5nXyhnb29nLnN0cmluZy51cmxFbmNvZGUoZG9tYWluKSkpO1xuXG4gICAgdmFyIHBvcnQgPSB0aGlzLmdldFBvcnQoKTtcbiAgICBpZiAocG9ydCAhPSBudWxsKSB7XG4gICAgICBvdXQucHVzaCgnOicsIFN0cmluZyhwb3J0KSk7XG4gICAgfVxuICB9XG5cbiAgdmFyIHBhdGggPSB0aGlzLmdldFBhdGgoKTtcbiAgaWYgKHBhdGgpIHtcbiAgICBpZiAodGhpcy5oYXNEb21haW4oKSAmJiBwYXRoLmNoYXJBdCgwKSAhPSAnLycpIHtcbiAgICAgIG91dC5wdXNoKCcvJyk7XG4gICAgfVxuICAgIG91dC5wdXNoKGdvb2cuVXJpLmVuY29kZVNwZWNpYWxDaGFyc18oXG4gICAgICAgIHBhdGgsXG4gICAgICAgIHBhdGguY2hhckF0KDApID09ICcvJyA/IGdvb2cuVXJpLnJlRGlzYWxsb3dlZEluQWJzb2x1dGVQYXRoXyA6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdvb2cuVXJpLnJlRGlzYWxsb3dlZEluUmVsYXRpdmVQYXRoXyxcbiAgICAgICAgdHJ1ZSkpO1xuICB9XG5cbiAgdmFyIHF1ZXJ5ID0gdGhpcy5nZXRFbmNvZGVkUXVlcnkoKTtcbiAgaWYgKHF1ZXJ5KSB7XG4gICAgb3V0LnB1c2goJz8nLCBxdWVyeSk7XG4gIH1cblxuICB2YXIgZnJhZ21lbnQgPSB0aGlzLmdldEZyYWdtZW50KCk7XG4gIGlmIChmcmFnbWVudCkge1xuICAgIG91dC5wdXNoKFxuICAgICAgICAnIycsXG4gICAgICAgIGdvb2cuVXJpLmVuY29kZVNwZWNpYWxDaGFyc18oXG4gICAgICAgICAgICBmcmFnbWVudCwgZ29vZy5VcmkucmVEaXNhbGxvd2VkSW5GcmFnbWVudF8pKTtcbiAgfVxuICByZXR1cm4gb3V0LmpvaW4oJycpO1xufTtcblxuXG4vKipcbiAqIFJlc29sdmVzIHRoZSBnaXZlbiByZWxhdGl2ZSBVUkkgKGEgZ29vZy5Vcmkgb2JqZWN0KSwgdXNpbmcgdGhlIFVSSVxuICogcmVwcmVzZW50ZWQgYnkgdGhpcyBpbnN0YW5jZSBhcyB0aGUgYmFzZSBVUkkuXG4gKlxuICogVGhlcmUgYXJlIHNldmVyYWwga2luZHMgb2YgcmVsYXRpdmUgVVJJczo8YnI+XG4gKiAxLiBmb28gLSByZXBsYWNlcyB0aGUgbGFzdCBwYXJ0IG9mIHRoZSBwYXRoLCB0aGUgd2hvbGUgcXVlcnkgYW5kIGZyYWdtZW50PGJyPlxuICogMi4gL2ZvbyAtIHJlcGxhY2VzIHRoZSBwYXRoLCB0aGUgcXVlcnkgYW5kIGZyYWdtZW50PGJyPlxuICogMy4gLy9mb28gLSByZXBsYWNlcyBldmVyeXRoaW5nIGZyb20gdGhlIGRvbWFpbiBvbi4gIGZvbyBpcyBhIGRvbWFpbiBuYW1lPGJyPlxuICogNC4gP2ZvbyAtIHJlcGxhY2UgdGhlIHF1ZXJ5IGFuZCBmcmFnbWVudDxicj5cbiAqIDUuICNmb28gLSByZXBsYWNlIHRoZSBmcmFnbWVudCBvbmx5XG4gKlxuICogQWRkaXRpb25hbGx5LCBpZiByZWxhdGl2ZSBVUkkgaGFzIGEgbm9uLWVtcHR5IHBhdGgsIGFsbCBcIi4uXCIgYW5kIFwiLlwiXG4gKiBzZWdtZW50cyB3aWxsIGJlIHJlc29sdmVkLCBhcyBkZXNjcmliZWQgaW4gUkZDIDM5ODYuXG4gKlxuICogQHBhcmFtIHshZ29vZy5Vcml9IHJlbGF0aXZlVXJpIFRoZSByZWxhdGl2ZSBVUkkgdG8gcmVzb2x2ZS5cbiAqIEByZXR1cm4geyFnb29nLlVyaX0gVGhlIHJlc29sdmVkIFVSSS5cbiAqL1xuZ29vZy5VcmkucHJvdG90eXBlLnJlc29sdmUgPSBmdW5jdGlvbihyZWxhdGl2ZVVyaSkge1xuICAndXNlIHN0cmljdCc7XG4gIHZhciBhYnNvbHV0ZVVyaSA9IHRoaXMuY2xvbmUoKTtcblxuICAvLyB3ZSBzYXRpc2Z5IHRoZXNlIGNvbmRpdGlvbnMgYnkgbG9va2luZyBmb3IgdGhlIGZpcnN0IHBhcnQgb2YgcmVsYXRpdmVVcmlcbiAgLy8gdGhhdCBpcyBub3QgYmxhbmsgYW5kIGFwcGx5aW5nIGRlZmF1bHRzIHRvIHRoZSByZXN0XG5cbiAgdmFyIG92ZXJyaWRkZW4gPSByZWxhdGl2ZVVyaS5oYXNTY2hlbWUoKTtcblxuICBpZiAob3ZlcnJpZGRlbikge1xuICAgIGFic29sdXRlVXJpLnNldFNjaGVtZShyZWxhdGl2ZVVyaS5nZXRTY2hlbWUoKSk7XG4gIH0gZWxzZSB7XG4gICAgb3ZlcnJpZGRlbiA9IHJlbGF0aXZlVXJpLmhhc1VzZXJJbmZvKCk7XG4gIH1cblxuICBpZiAob3ZlcnJpZGRlbikge1xuICAgIGFic29sdXRlVXJpLnNldFVzZXJJbmZvKHJlbGF0aXZlVXJpLmdldFVzZXJJbmZvKCkpO1xuICB9IGVsc2Uge1xuICAgIG92ZXJyaWRkZW4gPSByZWxhdGl2ZVVyaS5oYXNEb21haW4oKTtcbiAgfVxuXG4gIGlmIChvdmVycmlkZGVuKSB7XG4gICAgYWJzb2x1dGVVcmkuc2V0RG9tYWluKHJlbGF0aXZlVXJpLmdldERvbWFpbigpKTtcbiAgfSBlbHNlIHtcbiAgICBvdmVycmlkZGVuID0gcmVsYXRpdmVVcmkuaGFzUG9ydCgpO1xuICB9XG5cbiAgdmFyIHBhdGggPSByZWxhdGl2ZVVyaS5nZXRQYXRoKCk7XG4gIGlmIChvdmVycmlkZGVuKSB7XG4gICAgYWJzb2x1dGVVcmkuc2V0UG9ydChyZWxhdGl2ZVVyaS5nZXRQb3J0KCkpO1xuICB9IGVsc2Uge1xuICAgIG92ZXJyaWRkZW4gPSByZWxhdGl2ZVVyaS5oYXNQYXRoKCk7XG4gICAgaWYgKG92ZXJyaWRkZW4pIHtcbiAgICAgIC8vIHJlc29sdmUgcGF0aCBwcm9wZXJseVxuICAgICAgaWYgKHBhdGguY2hhckF0KDApICE9ICcvJykge1xuICAgICAgICAvLyBwYXRoIGlzIHJlbGF0aXZlXG4gICAgICAgIGlmICh0aGlzLmhhc0RvbWFpbigpICYmICF0aGlzLmhhc1BhdGgoKSkge1xuICAgICAgICAgIC8vIFJGQyAzOTg2LCBzZWN0aW9uIDUuMi4zLCBjYXNlIDFcbiAgICAgICAgICBwYXRoID0gJy8nICsgcGF0aDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBSRkMgMzk4Niwgc2VjdGlvbiA1LjIuMywgY2FzZSAyXG4gICAgICAgICAgdmFyIGxhc3RTbGFzaEluZGV4ID0gYWJzb2x1dGVVcmkuZ2V0UGF0aCgpLmxhc3RJbmRleE9mKCcvJyk7XG4gICAgICAgICAgaWYgKGxhc3RTbGFzaEluZGV4ICE9IC0xKSB7XG4gICAgICAgICAgICBwYXRoID0gYWJzb2x1dGVVcmkuZ2V0UGF0aCgpLnN1YnN0cigwLCBsYXN0U2xhc2hJbmRleCArIDEpICsgcGF0aDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHBhdGggPSBnb29nLlVyaS5yZW1vdmVEb3RTZWdtZW50cyhwYXRoKTtcbiAgICB9XG4gIH1cblxuICBpZiAob3ZlcnJpZGRlbikge1xuICAgIGFic29sdXRlVXJpLnNldFBhdGgocGF0aCk7XG4gIH0gZWxzZSB7XG4gICAgb3ZlcnJpZGRlbiA9IHJlbGF0aXZlVXJpLmhhc1F1ZXJ5KCk7XG4gIH1cblxuICBpZiAob3ZlcnJpZGRlbikge1xuICAgIGFic29sdXRlVXJpLnNldFF1ZXJ5RGF0YShyZWxhdGl2ZVVyaS5nZXRRdWVyeURhdGEoKS5jbG9uZSgpKTtcbiAgfSBlbHNlIHtcbiAgICBvdmVycmlkZGVuID0gcmVsYXRpdmVVcmkuaGFzRnJhZ21lbnQoKTtcbiAgfVxuXG4gIGlmIChvdmVycmlkZGVuKSB7XG4gICAgYWJzb2x1dGVVcmkuc2V0RnJhZ21lbnQocmVsYXRpdmVVcmkuZ2V0RnJhZ21lbnQoKSk7XG4gIH1cblxuICByZXR1cm4gYWJzb2x1dGVVcmk7XG59O1xuXG5cbi8qKlxuICogQ2xvbmVzIHRoZSBVUkkgaW5zdGFuY2UuXG4gKiBAcmV0dXJuIHshZ29vZy5Vcml9IE5ldyBpbnN0YW5jZSBvZiB0aGUgVVJJIG9iamVjdC5cbiAqL1xuZ29vZy5VcmkucHJvdG90eXBlLmNsb25lID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmV0dXJuIG5ldyBnb29nLlVyaSh0aGlzKTtcbn07XG5cblxuLyoqXG4gKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSBlbmNvZGVkIHNjaGVtZS9wcm90b2NvbCBmb3IgdGhlIFVSSS5cbiAqL1xuZ29vZy5VcmkucHJvdG90eXBlLmdldFNjaGVtZSA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIHJldHVybiB0aGlzLnNjaGVtZV87XG59O1xuXG5cbi8qKlxuICogU2V0cyB0aGUgc2NoZW1lL3Byb3RvY29sLlxuICogQHRocm93cyBVUklFcnJvciBJZiBvcHRfZGVjb2RlIGlzIHRydWUgYW5kIG5ld1NjaGVtZSBpcyBtYWxmb3JtZWQgKHRoYXQgaXMsXG4gKiAgICAgaWYgZGVjb2RlVVJJQ29tcG9uZW50IGZhaWxzKS5cbiAqIEBwYXJhbSB7c3RyaW5nfSBuZXdTY2hlbWUgTmV3IHNjaGVtZSB2YWx1ZS5cbiAqIEBwYXJhbSB7Ym9vbGVhbj19IG9wdF9kZWNvZGUgT3B0aW9uYWwgcGFyYW0gZm9yIHdoZXRoZXIgdG8gZGVjb2RlIG5ldyB2YWx1ZS5cbiAqIEByZXR1cm4geyFnb29nLlVyaX0gUmVmZXJlbmNlIHRvIHRoaXMgVVJJIG9iamVjdC5cbiAqL1xuZ29vZy5VcmkucHJvdG90eXBlLnNldFNjaGVtZSA9IGZ1bmN0aW9uKG5ld1NjaGVtZSwgb3B0X2RlY29kZSkge1xuICAndXNlIHN0cmljdCc7XG4gIHRoaXMuZW5mb3JjZVJlYWRPbmx5KCk7XG4gIHRoaXMuc2NoZW1lXyA9XG4gICAgICBvcHRfZGVjb2RlID8gZ29vZy5VcmkuZGVjb2RlT3JFbXB0eV8obmV3U2NoZW1lLCB0cnVlKSA6IG5ld1NjaGVtZTtcblxuICAvLyByZW1vdmUgYW4gOiBhdCB0aGUgZW5kIG9mIHRoZSBzY2hlbWUgc28gc29tZWJvZHkgY2FuIHBhc3MgaW5cbiAgLy8gd2luZG93LmxvY2F0aW9uLnByb3RvY29sXG4gIGlmICh0aGlzLnNjaGVtZV8pIHtcbiAgICB0aGlzLnNjaGVtZV8gPSB0aGlzLnNjaGVtZV8ucmVwbGFjZSgvOiQvLCAnJyk7XG4gIH1cbiAgcmV0dXJuIHRoaXM7XG59O1xuXG5cbi8qKlxuICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGUgc2NoZW1lIGhhcyBiZWVuIHNldC5cbiAqL1xuZ29vZy5VcmkucHJvdG90eXBlLmhhc1NjaGVtZSA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIHJldHVybiAhIXRoaXMuc2NoZW1lXztcbn07XG5cblxuLyoqXG4gKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSBkZWNvZGVkIHVzZXIgaW5mby5cbiAqL1xuZ29vZy5VcmkucHJvdG90eXBlLmdldFVzZXJJbmZvID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmV0dXJuIHRoaXMudXNlckluZm9fO1xufTtcblxuXG4vKipcbiAqIFNldHMgdGhlIHVzZXJJbmZvLlxuICogQHRocm93cyBVUklFcnJvciBJZiBvcHRfZGVjb2RlIGlzIHRydWUgYW5kIG5ld1VzZXJJbmZvIGlzIG1hbGZvcm1lZCAodGhhdCBpcyxcbiAqICAgICBpZiBkZWNvZGVVUklDb21wb25lbnQgZmFpbHMpLlxuICogQHBhcmFtIHtzdHJpbmd9IG5ld1VzZXJJbmZvIE5ldyB1c2VySW5mbyB2YWx1ZS5cbiAqIEBwYXJhbSB7Ym9vbGVhbj19IG9wdF9kZWNvZGUgT3B0aW9uYWwgcGFyYW0gZm9yIHdoZXRoZXIgdG8gZGVjb2RlIG5ldyB2YWx1ZS5cbiAqIEByZXR1cm4geyFnb29nLlVyaX0gUmVmZXJlbmNlIHRvIHRoaXMgVVJJIG9iamVjdC5cbiAqL1xuZ29vZy5VcmkucHJvdG90eXBlLnNldFVzZXJJbmZvID0gZnVuY3Rpb24obmV3VXNlckluZm8sIG9wdF9kZWNvZGUpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICB0aGlzLmVuZm9yY2VSZWFkT25seSgpO1xuICB0aGlzLnVzZXJJbmZvXyA9XG4gICAgICBvcHRfZGVjb2RlID8gZ29vZy5VcmkuZGVjb2RlT3JFbXB0eV8obmV3VXNlckluZm8pIDogbmV3VXNlckluZm87XG4gIHJldHVybiB0aGlzO1xufTtcblxuXG4vKipcbiAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgdGhlIHVzZXIgaW5mbyBoYXMgYmVlbiBzZXQuXG4gKi9cbmdvb2cuVXJpLnByb3RvdHlwZS5oYXNVc2VySW5mbyA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIHJldHVybiAhIXRoaXMudXNlckluZm9fO1xufTtcblxuXG4vKipcbiAqIEByZXR1cm4ge3N0cmluZ30gVGhlIGRlY29kZWQgZG9tYWluLlxuICovXG5nb29nLlVyaS5wcm90b3R5cGUuZ2V0RG9tYWluID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmV0dXJuIHRoaXMuZG9tYWluXztcbn07XG5cblxuLyoqXG4gKiBTZXRzIHRoZSBkb21haW4uXG4gKiBAdGhyb3dzIFVSSUVycm9yIElmIG9wdF9kZWNvZGUgaXMgdHJ1ZSBhbmQgbmV3RG9tYWluIGlzIG1hbGZvcm1lZCAodGhhdCBpcyxcbiAqICAgICBpZiBkZWNvZGVVUklDb21wb25lbnQgZmFpbHMpLlxuICogQHBhcmFtIHtzdHJpbmd9IG5ld0RvbWFpbiBOZXcgZG9tYWluIHZhbHVlLlxuICogQHBhcmFtIHtib29sZWFuPX0gb3B0X2RlY29kZSBPcHRpb25hbCBwYXJhbSBmb3Igd2hldGhlciB0byBkZWNvZGUgbmV3IHZhbHVlLlxuICogQHJldHVybiB7IWdvb2cuVXJpfSBSZWZlcmVuY2UgdG8gdGhpcyBVUkkgb2JqZWN0LlxuICovXG5nb29nLlVyaS5wcm90b3R5cGUuc2V0RG9tYWluID0gZnVuY3Rpb24obmV3RG9tYWluLCBvcHRfZGVjb2RlKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgdGhpcy5lbmZvcmNlUmVhZE9ubHkoKTtcbiAgdGhpcy5kb21haW5fID1cbiAgICAgIG9wdF9kZWNvZGUgPyBnb29nLlVyaS5kZWNvZGVPckVtcHR5XyhuZXdEb21haW4sIHRydWUpIDogbmV3RG9tYWluO1xuICByZXR1cm4gdGhpcztcbn07XG5cblxuLyoqXG4gKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoZSBkb21haW4gaGFzIGJlZW4gc2V0LlxuICovXG5nb29nLlVyaS5wcm90b3R5cGUuaGFzRG9tYWluID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmV0dXJuICEhdGhpcy5kb21haW5fO1xufTtcblxuXG4vKipcbiAqIEByZXR1cm4gez9udW1iZXJ9IFRoZSBwb3J0IG51bWJlci5cbiAqL1xuZ29vZy5VcmkucHJvdG90eXBlLmdldFBvcnQgPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gdGhpcy5wb3J0Xztcbn07XG5cblxuLyoqXG4gKiBTZXRzIHRoZSBwb3J0IG51bWJlci5cbiAqIEBwYXJhbSB7Kn0gbmV3UG9ydCBQb3J0IG51bWJlci4gV2lsbCBiZSBleHBsaWNpdGx5IGNhc3RlZCB0byBhIG51bWJlci5cbiAqIEByZXR1cm4geyFnb29nLlVyaX0gUmVmZXJlbmNlIHRvIHRoaXMgVVJJIG9iamVjdC5cbiAqL1xuZ29vZy5VcmkucHJvdG90eXBlLnNldFBvcnQgPSBmdW5jdGlvbihuZXdQb3J0KSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgdGhpcy5lbmZvcmNlUmVhZE9ubHkoKTtcblxuICBpZiAobmV3UG9ydCkge1xuICAgIG5ld1BvcnQgPSBOdW1iZXIobmV3UG9ydCk7XG4gICAgaWYgKGlzTmFOKG5ld1BvcnQpIHx8IG5ld1BvcnQgPCAwKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0JhZCBwb3J0IG51bWJlciAnICsgbmV3UG9ydCk7XG4gICAgfVxuICAgIHRoaXMucG9ydF8gPSBuZXdQb3J0O1xuICB9IGVsc2Uge1xuICAgIHRoaXMucG9ydF8gPSBudWxsO1xuICB9XG5cbiAgcmV0dXJuIHRoaXM7XG59O1xuXG5cbi8qKlxuICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGUgcG9ydCBoYXMgYmVlbiBzZXQuXG4gKi9cbmdvb2cuVXJpLnByb3RvdHlwZS5oYXNQb3J0ID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmV0dXJuIHRoaXMucG9ydF8gIT0gbnVsbDtcbn07XG5cblxuLyoqXG4gKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSBkZWNvZGVkIHBhdGguXG4gKi9cbmdvb2cuVXJpLnByb3RvdHlwZS5nZXRQYXRoID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmV0dXJuIHRoaXMucGF0aF87XG59O1xuXG5cbi8qKlxuICogU2V0cyB0aGUgcGF0aC5cbiAqIEB0aHJvd3MgVVJJRXJyb3IgSWYgb3B0X2RlY29kZSBpcyB0cnVlIGFuZCBuZXdQYXRoIGlzIG1hbGZvcm1lZCAodGhhdCBpcyxcbiAqICAgICBpZiBkZWNvZGVVUklDb21wb25lbnQgZmFpbHMpLlxuICogQHBhcmFtIHtzdHJpbmd9IG5ld1BhdGggTmV3IHBhdGggdmFsdWUuXG4gKiBAcGFyYW0ge2Jvb2xlYW49fSBvcHRfZGVjb2RlIE9wdGlvbmFsIHBhcmFtIGZvciB3aGV0aGVyIHRvIGRlY29kZSBuZXcgdmFsdWUuXG4gKiBAcmV0dXJuIHshZ29vZy5Vcml9IFJlZmVyZW5jZSB0byB0aGlzIFVSSSBvYmplY3QuXG4gKi9cbmdvb2cuVXJpLnByb3RvdHlwZS5zZXRQYXRoID0gZnVuY3Rpb24obmV3UGF0aCwgb3B0X2RlY29kZSkge1xuICAndXNlIHN0cmljdCc7XG4gIHRoaXMuZW5mb3JjZVJlYWRPbmx5KCk7XG4gIHRoaXMucGF0aF8gPSBvcHRfZGVjb2RlID8gZ29vZy5VcmkuZGVjb2RlT3JFbXB0eV8obmV3UGF0aCwgdHJ1ZSkgOiBuZXdQYXRoO1xuICByZXR1cm4gdGhpcztcbn07XG5cblxuLyoqXG4gKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoZSBwYXRoIGhhcyBiZWVuIHNldC5cbiAqL1xuZ29vZy5VcmkucHJvdG90eXBlLmhhc1BhdGggPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gISF0aGlzLnBhdGhfO1xufTtcblxuXG4vKipcbiAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgdGhlIHF1ZXJ5IHN0cmluZyBoYXMgYmVlbiBzZXQuXG4gKi9cbmdvb2cuVXJpLnByb3RvdHlwZS5oYXNRdWVyeSA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIHJldHVybiB0aGlzLnF1ZXJ5RGF0YV8udG9TdHJpbmcoKSAhPT0gJyc7XG59O1xuXG5cbi8qKlxuICogU2V0cyB0aGUgcXVlcnkgZGF0YS5cbiAqIEBwYXJhbSB7Z29vZy5VcmkuUXVlcnlEYXRhfHN0cmluZ3x1bmRlZmluZWR9IHF1ZXJ5RGF0YSBRdWVyeURhdGEgb2JqZWN0LlxuICogQHBhcmFtIHtib29sZWFuPX0gb3B0X2RlY29kZSBPcHRpb25hbCBwYXJhbSBmb3Igd2hldGhlciB0byBkZWNvZGUgbmV3IHZhbHVlLlxuICogICAgIEFwcGxpZXMgb25seSBpZiBxdWVyeURhdGEgaXMgYSBzdHJpbmcuXG4gKiBAcmV0dXJuIHshZ29vZy5Vcml9IFJlZmVyZW5jZSB0byB0aGlzIFVSSSBvYmplY3QuXG4gKi9cbmdvb2cuVXJpLnByb3RvdHlwZS5zZXRRdWVyeURhdGEgPSBmdW5jdGlvbihxdWVyeURhdGEsIG9wdF9kZWNvZGUpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICB0aGlzLmVuZm9yY2VSZWFkT25seSgpO1xuXG4gIGlmIChxdWVyeURhdGEgaW5zdGFuY2VvZiBnb29nLlVyaS5RdWVyeURhdGEpIHtcbiAgICB0aGlzLnF1ZXJ5RGF0YV8gPSBxdWVyeURhdGE7XG4gICAgdGhpcy5xdWVyeURhdGFfLnNldElnbm9yZUNhc2UodGhpcy5pZ25vcmVDYXNlXyk7XG4gIH0gZWxzZSB7XG4gICAgaWYgKCFvcHRfZGVjb2RlKSB7XG4gICAgICAvLyBRdWVyeURhdGEgYWNjZXB0cyBlbmNvZGVkIHF1ZXJ5IHN0cmluZywgc28gZW5jb2RlIGl0IGlmXG4gICAgICAvLyBvcHRfZGVjb2RlIGZsYWcgaXMgbm90IHRydWUuXG4gICAgICBxdWVyeURhdGEgPSBnb29nLlVyaS5lbmNvZGVTcGVjaWFsQ2hhcnNfKFxuICAgICAgICAgIHF1ZXJ5RGF0YSwgZ29vZy5VcmkucmVEaXNhbGxvd2VkSW5RdWVyeV8pO1xuICAgIH1cbiAgICB0aGlzLnF1ZXJ5RGF0YV8gPSBuZXcgZ29vZy5VcmkuUXVlcnlEYXRhKHF1ZXJ5RGF0YSwgdGhpcy5pZ25vcmVDYXNlXyk7XG4gIH1cblxuICByZXR1cm4gdGhpcztcbn07XG5cblxuLyoqXG4gKiBTZXRzIHRoZSBVUkkgcXVlcnkuXG4gKiBAcGFyYW0ge3N0cmluZ30gbmV3UXVlcnkgTmV3IHF1ZXJ5IHZhbHVlLlxuICogQHBhcmFtIHtib29sZWFuPX0gb3B0X2RlY29kZSBPcHRpb25hbCBwYXJhbSBmb3Igd2hldGhlciB0byBkZWNvZGUgbmV3IHZhbHVlLlxuICogQHJldHVybiB7IWdvb2cuVXJpfSBSZWZlcmVuY2UgdG8gdGhpcyBVUkkgb2JqZWN0LlxuICovXG5nb29nLlVyaS5wcm90b3R5cGUuc2V0UXVlcnkgPSBmdW5jdGlvbihuZXdRdWVyeSwgb3B0X2RlY29kZSkge1xuICAndXNlIHN0cmljdCc7XG4gIHJldHVybiB0aGlzLnNldFF1ZXJ5RGF0YShuZXdRdWVyeSwgb3B0X2RlY29kZSk7XG59O1xuXG5cbi8qKlxuICogQHJldHVybiB7c3RyaW5nfSBUaGUgZW5jb2RlZCBVUkkgcXVlcnksIG5vdCBpbmNsdWRpbmcgdGhlID8uXG4gKi9cbmdvb2cuVXJpLnByb3RvdHlwZS5nZXRFbmNvZGVkUXVlcnkgPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gdGhpcy5xdWVyeURhdGFfLnRvU3RyaW5nKCk7XG59O1xuXG5cbi8qKlxuICogQHJldHVybiB7c3RyaW5nfSBUaGUgZGVjb2RlZCBVUkkgcXVlcnksIG5vdCBpbmNsdWRpbmcgdGhlID8uXG4gKi9cbmdvb2cuVXJpLnByb3RvdHlwZS5nZXREZWNvZGVkUXVlcnkgPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gdGhpcy5xdWVyeURhdGFfLnRvRGVjb2RlZFN0cmluZygpO1xufTtcblxuXG4vKipcbiAqIFJldHVybnMgdGhlIHF1ZXJ5IGRhdGEuXG4gKiBAcmV0dXJuIHshZ29vZy5VcmkuUXVlcnlEYXRhfSBRdWVyeURhdGEgb2JqZWN0LlxuICovXG5nb29nLlVyaS5wcm90b3R5cGUuZ2V0UXVlcnlEYXRhID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmV0dXJuIHRoaXMucXVlcnlEYXRhXztcbn07XG5cblxuLyoqXG4gKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSBlbmNvZGVkIFVSSSBxdWVyeSwgbm90IGluY2x1ZGluZyB0aGUgPy5cbiAqXG4gKiBXYXJuaW5nOiBUaGlzIG1ldGhvZCwgdW5saWtlIG90aGVyIGdldHRlciBtZXRob2RzLCByZXR1cm5zIGVuY29kZWRcbiAqIHZhbHVlLCBpbnN0ZWFkIG9mIGRlY29kZWQgb25lLlxuICovXG5nb29nLlVyaS5wcm90b3R5cGUuZ2V0UXVlcnkgPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gdGhpcy5nZXRFbmNvZGVkUXVlcnkoKTtcbn07XG5cblxuLyoqXG4gKiBTZXRzIHRoZSB2YWx1ZSBvZiB0aGUgbmFtZWQgcXVlcnkgcGFyYW1ldGVycywgY2xlYXJpbmcgcHJldmlvdXMgdmFsdWVzIGZvclxuICogdGhhdCBrZXkuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IGtleSBUaGUgcGFyYW1ldGVyIHRvIHNldC5cbiAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIG5ldyB2YWx1ZS4gVmFsdWUgZG9lcyBub3QgbmVlZCB0byBiZSBlbmNvZGVkLlxuICogQHJldHVybiB7IWdvb2cuVXJpfSBSZWZlcmVuY2UgdG8gdGhpcyBVUkkgb2JqZWN0LlxuICovXG5nb29nLlVyaS5wcm90b3R5cGUuc2V0UGFyYW1ldGVyVmFsdWUgPSBmdW5jdGlvbihrZXksIHZhbHVlKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgdGhpcy5lbmZvcmNlUmVhZE9ubHkoKTtcbiAgdGhpcy5xdWVyeURhdGFfLnNldChrZXksIHZhbHVlKTtcbiAgcmV0dXJuIHRoaXM7XG59O1xuXG5cbi8qKlxuICogU2V0cyB0aGUgdmFsdWVzIG9mIHRoZSBuYW1lZCBxdWVyeSBwYXJhbWV0ZXJzLCBjbGVhcmluZyBwcmV2aW91cyB2YWx1ZXMgZm9yXG4gKiB0aGF0IGtleS4gIE5vdCBuZXcgdmFsdWVzIHdpbGwgY3VycmVudGx5IGJlIG1vdmVkIHRvIHRoZSBlbmQgb2YgdGhlIHF1ZXJ5XG4gKiBzdHJpbmcuXG4gKlxuICogU28sIDxjb2RlPmdvb2cuVXJpLnBhcnNlKCdmb28/YT1iJmM9ZCZlPWYnKS5zZXRQYXJhbWV0ZXJWYWx1ZXMoJ2MnLCBbJ25ldyddKVxuICogPC9jb2RlPiB5aWVsZHMgPHR0PmZvbz9hPWImZT1mJmM9bmV3PC90dD4uPC9wPlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIHBhcmFtZXRlciB0byBzZXQuXG4gKiBAcGFyYW0geyp9IHZhbHVlcyBUaGUgbmV3IHZhbHVlcy4gSWYgdmFsdWVzIGlzIGEgc2luZ2xlXG4gKiAgICAgc3RyaW5nIHRoZW4gaXQgd2lsbCBiZSB0cmVhdGVkIGFzIHRoZSBzb2xlIHZhbHVlLiBWYWx1ZXMgZG8gbm90IG5lZWQgdG9cbiAqICAgICBiZSBlbmNvZGVkLlxuICogQHJldHVybiB7IWdvb2cuVXJpfSBSZWZlcmVuY2UgdG8gdGhpcyBVUkkgb2JqZWN0LlxuICovXG5nb29nLlVyaS5wcm90b3R5cGUuc2V0UGFyYW1ldGVyVmFsdWVzID0gZnVuY3Rpb24oa2V5LCB2YWx1ZXMpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICB0aGlzLmVuZm9yY2VSZWFkT25seSgpO1xuXG4gIGlmICghQXJyYXkuaXNBcnJheSh2YWx1ZXMpKSB7XG4gICAgdmFsdWVzID0gW1N0cmluZyh2YWx1ZXMpXTtcbiAgfVxuXG4gIHRoaXMucXVlcnlEYXRhXy5zZXRWYWx1ZXMoa2V5LCB2YWx1ZXMpO1xuXG4gIHJldHVybiB0aGlzO1xufTtcblxuXG4vKipcbiAqIFJldHVybnMgdGhlIHZhbHVlPGI+czwvYj4gZm9yIGEgZ2l2ZW4gY2dpIHBhcmFtZXRlciBhcyBhIGxpc3Qgb2YgZGVjb2RlZFxuICogcXVlcnkgcGFyYW1ldGVyIHZhbHVlcy5cbiAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIFRoZSBwYXJhbWV0ZXIgdG8gZ2V0IHZhbHVlcyBmb3IuXG4gKiBAcmV0dXJuIHshQXJyYXk8Pz59IFRoZSB2YWx1ZXMgZm9yIGEgZ2l2ZW4gY2dpIHBhcmFtZXRlciBhcyBhIGxpc3Qgb2ZcbiAqICAgICBkZWNvZGVkIHF1ZXJ5IHBhcmFtZXRlciB2YWx1ZXMuXG4gKi9cbmdvb2cuVXJpLnByb3RvdHlwZS5nZXRQYXJhbWV0ZXJWYWx1ZXMgPSBmdW5jdGlvbihuYW1lKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmV0dXJuIHRoaXMucXVlcnlEYXRhXy5nZXRWYWx1ZXMobmFtZSk7XG59O1xuXG5cbi8qKlxuICogUmV0dXJucyB0aGUgZmlyc3QgdmFsdWUgZm9yIGEgZ2l2ZW4gY2dpIHBhcmFtZXRlciBvciB1bmRlZmluZWQgaWYgdGhlIGdpdmVuXG4gKiBwYXJhbWV0ZXIgbmFtZSBkb2VzIG5vdCBhcHBlYXIgaW4gdGhlIHF1ZXJ5IHN0cmluZy5cbiAqIEBwYXJhbSB7c3RyaW5nfSBwYXJhbU5hbWUgVW5lc2NhcGVkIHBhcmFtZXRlciBuYW1lLlxuICogQHJldHVybiB7c3RyaW5nfHVuZGVmaW5lZH0gVGhlIGZpcnN0IHZhbHVlIGZvciBhIGdpdmVuIGNnaSBwYXJhbWV0ZXIgb3JcbiAqICAgICB1bmRlZmluZWQgaWYgdGhlIGdpdmVuIHBhcmFtZXRlciBuYW1lIGRvZXMgbm90IGFwcGVhciBpbiB0aGUgcXVlcnlcbiAqICAgICBzdHJpbmcuXG4gKi9cbmdvb2cuVXJpLnByb3RvdHlwZS5nZXRQYXJhbWV0ZXJWYWx1ZSA9IGZ1bmN0aW9uKHBhcmFtTmFtZSkge1xuICAndXNlIHN0cmljdCc7XG4gIHJldHVybiAvKiogQHR5cGUge3N0cmluZ3x1bmRlZmluZWR9ICovICh0aGlzLnF1ZXJ5RGF0YV8uZ2V0KHBhcmFtTmFtZSkpO1xufTtcblxuXG4vKipcbiAqIEByZXR1cm4ge3N0cmluZ30gVGhlIFVSSSBmcmFnbWVudCwgbm90IGluY2x1ZGluZyB0aGUgIy5cbiAqL1xuZ29vZy5VcmkucHJvdG90eXBlLmdldEZyYWdtZW50ID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmV0dXJuIHRoaXMuZnJhZ21lbnRfO1xufTtcblxuXG4vKipcbiAqIFNldHMgdGhlIFVSSSBmcmFnbWVudC5cbiAqIEB0aHJvd3MgVVJJRXJyb3IgSWYgb3B0X2RlY29kZSBpcyB0cnVlIGFuZCBuZXdGcmFnbWVudCBpcyBtYWxmb3JtZWQgKHRoYXQgaXMsXG4gKiAgICAgaWYgZGVjb2RlVVJJQ29tcG9uZW50IGZhaWxzKS5cbiAqIEBwYXJhbSB7c3RyaW5nfSBuZXdGcmFnbWVudCBOZXcgZnJhZ21lbnQgdmFsdWUuXG4gKiBAcGFyYW0ge2Jvb2xlYW49fSBvcHRfZGVjb2RlIE9wdGlvbmFsIHBhcmFtIGZvciB3aGV0aGVyIHRvIGRlY29kZSBuZXcgdmFsdWUuXG4gKiBAcmV0dXJuIHshZ29vZy5Vcml9IFJlZmVyZW5jZSB0byB0aGlzIFVSSSBvYmplY3QuXG4gKi9cbmdvb2cuVXJpLnByb3RvdHlwZS5zZXRGcmFnbWVudCA9IGZ1bmN0aW9uKG5ld0ZyYWdtZW50LCBvcHRfZGVjb2RlKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgdGhpcy5lbmZvcmNlUmVhZE9ubHkoKTtcbiAgdGhpcy5mcmFnbWVudF8gPVxuICAgICAgb3B0X2RlY29kZSA/IGdvb2cuVXJpLmRlY29kZU9yRW1wdHlfKG5ld0ZyYWdtZW50KSA6IG5ld0ZyYWdtZW50O1xuICByZXR1cm4gdGhpcztcbn07XG5cblxuLyoqXG4gKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoZSBVUkkgaGFzIGEgZnJhZ21lbnQgc2V0LlxuICovXG5nb29nLlVyaS5wcm90b3R5cGUuaGFzRnJhZ21lbnQgPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gISF0aGlzLmZyYWdtZW50Xztcbn07XG5cblxuLyoqXG4gKiBSZXR1cm5zIHRydWUgaWYgdGhpcyBoYXMgdGhlIHNhbWUgZG9tYWluIGFzIHRoYXQgb2YgdXJpMi5cbiAqIEBwYXJhbSB7IWdvb2cuVXJpfSB1cmkyIFRoZSBVUkkgb2JqZWN0IHRvIGNvbXBhcmUgdG8uXG4gKiBAcmV0dXJuIHtib29sZWFufSB0cnVlIGlmIHNhbWUgZG9tYWluOyBmYWxzZSBvdGhlcndpc2UuXG4gKi9cbmdvb2cuVXJpLnByb3RvdHlwZS5oYXNTYW1lRG9tYWluQXMgPSBmdW5jdGlvbih1cmkyKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmV0dXJuICgoIXRoaXMuaGFzRG9tYWluKCkgJiYgIXVyaTIuaGFzRG9tYWluKCkpIHx8XG4gICAgICAgICAgdGhpcy5nZXREb21haW4oKSA9PSB1cmkyLmdldERvbWFpbigpKSAmJlxuICAgICAgKCghdGhpcy5oYXNQb3J0KCkgJiYgIXVyaTIuaGFzUG9ydCgpKSB8fFxuICAgICAgIHRoaXMuZ2V0UG9ydCgpID09IHVyaTIuZ2V0UG9ydCgpKTtcbn07XG5cblxuLyoqXG4gKiBBZGRzIGEgcmFuZG9tIHBhcmFtZXRlciB0byB0aGUgVXJpLlxuICogQHJldHVybiB7IWdvb2cuVXJpfSBSZWZlcmVuY2UgdG8gdGhpcyBVcmkgb2JqZWN0LlxuICovXG5nb29nLlVyaS5wcm90b3R5cGUubWFrZVVuaXF1ZSA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIHRoaXMuZW5mb3JjZVJlYWRPbmx5KCk7XG4gIHRoaXMuc2V0UGFyYW1ldGVyVmFsdWUoZ29vZy5VcmkuUkFORE9NX1BBUkFNLCBnb29nLnN0cmluZy5nZXRSYW5kb21TdHJpbmcoKSk7XG5cbiAgcmV0dXJuIHRoaXM7XG59O1xuXG5cbi8qKlxuICogUmVtb3ZlcyB0aGUgbmFtZWQgcXVlcnkgcGFyYW1ldGVyLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIHBhcmFtZXRlciB0byByZW1vdmUuXG4gKiBAcmV0dXJuIHshZ29vZy5Vcml9IFJlZmVyZW5jZSB0byB0aGlzIFVSSSBvYmplY3QuXG4gKi9cbmdvb2cuVXJpLnByb3RvdHlwZS5yZW1vdmVQYXJhbWV0ZXIgPSBmdW5jdGlvbihrZXkpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICB0aGlzLmVuZm9yY2VSZWFkT25seSgpO1xuICB0aGlzLnF1ZXJ5RGF0YV8ucmVtb3ZlKGtleSk7XG4gIHJldHVybiB0aGlzO1xufTtcblxuXG4vKipcbiAqIFNldHMgd2hldGhlciBVcmkgaXMgcmVhZCBvbmx5LiBJZiB0aGlzIGdvb2cuVXJpIGlzIHJlYWQtb25seSxcbiAqIGVuZm9yY2VSZWFkT25seV8gd2lsbCBiZSBjYWxsZWQgYXQgdGhlIHN0YXJ0IG9mIGFueSBmdW5jdGlvbiB0aGF0IG1heSBtb2RpZnlcbiAqIHRoaXMgVXJpLlxuICogQHBhcmFtIHtib29sZWFufSBpc1JlYWRPbmx5IHdoZXRoZXIgdGhpcyBnb29nLlVyaSBzaG91bGQgYmUgcmVhZCBvbmx5LlxuICogQHJldHVybiB7IWdvb2cuVXJpfSBSZWZlcmVuY2UgdG8gdGhpcyBVcmkgb2JqZWN0LlxuICovXG5nb29nLlVyaS5wcm90b3R5cGUuc2V0UmVhZE9ubHkgPSBmdW5jdGlvbihpc1JlYWRPbmx5KSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgdGhpcy5pc1JlYWRPbmx5XyA9IGlzUmVhZE9ubHk7XG4gIHJldHVybiB0aGlzO1xufTtcblxuXG4vKipcbiAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgdGhlIFVSSSBpcyByZWFkIG9ubHkuXG4gKi9cbmdvb2cuVXJpLnByb3RvdHlwZS5pc1JlYWRPbmx5ID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmV0dXJuIHRoaXMuaXNSZWFkT25seV87XG59O1xuXG5cbi8qKlxuICogQ2hlY2tzIGlmIHRoaXMgVXJpIGhhcyBiZWVuIG1hcmtlZCBhcyByZWFkIG9ubHksIGFuZCBpZiBzbywgdGhyb3dzIGFuIGVycm9yLlxuICogVGhpcyBzaG91bGQgYmUgY2FsbGVkIHdoZW5ldmVyIGFueSBtb2RpZnlpbmcgZnVuY3Rpb24gaXMgY2FsbGVkLlxuICovXG5nb29nLlVyaS5wcm90b3R5cGUuZW5mb3JjZVJlYWRPbmx5ID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgaWYgKHRoaXMuaXNSZWFkT25seV8pIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ1RyaWVkIHRvIG1vZGlmeSBhIHJlYWQtb25seSBVcmknKTtcbiAgfVxufTtcblxuXG4vKipcbiAqIFNldHMgd2hldGhlciB0byBpZ25vcmUgY2FzZS5cbiAqIE5PVEU6IElmIHRoZXJlIGFyZSBhbHJlYWR5IGtleS92YWx1ZSBwYWlycyBpbiB0aGUgUXVlcnlEYXRhLCBhbmRcbiAqIGlnbm9yZUNhc2VfIGlzIHNldCB0byBmYWxzZSwgdGhlIGtleXMgd2lsbCBhbGwgYmUgbG93ZXItY2FzZWQuXG4gKiBAcGFyYW0ge2Jvb2xlYW59IGlnbm9yZUNhc2Ugd2hldGhlciB0aGlzIGdvb2cuVXJpIHNob3VsZCBpZ25vcmUgY2FzZS5cbiAqIEByZXR1cm4geyFnb29nLlVyaX0gUmVmZXJlbmNlIHRvIHRoaXMgVXJpIG9iamVjdC5cbiAqL1xuZ29vZy5VcmkucHJvdG90eXBlLnNldElnbm9yZUNhc2UgPSBmdW5jdGlvbihpZ25vcmVDYXNlKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgdGhpcy5pZ25vcmVDYXNlXyA9IGlnbm9yZUNhc2U7XG4gIGlmICh0aGlzLnF1ZXJ5RGF0YV8pIHtcbiAgICB0aGlzLnF1ZXJ5RGF0YV8uc2V0SWdub3JlQ2FzZShpZ25vcmVDYXNlKTtcbiAgfVxuICByZXR1cm4gdGhpcztcbn07XG5cblxuLyoqXG4gKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRvIGlnbm9yZSBjYXNlLlxuICovXG5nb29nLlVyaS5wcm90b3R5cGUuZ2V0SWdub3JlQ2FzZSA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIHJldHVybiB0aGlzLmlnbm9yZUNhc2VfO1xufTtcblxuXG4vLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gU3RhdGljIG1lbWJlcnNcbi8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cblxuLyoqXG4gKiBDcmVhdGVzIGEgdXJpIGZyb20gdGhlIHN0cmluZyBmb3JtLiAgQmFzaWNhbGx5IGFuIGFsaWFzIG9mIG5ldyBnb29nLlVyaSgpLlxuICogSWYgYSBVcmkgb2JqZWN0IGlzIHBhc3NlZCB0byBwYXJzZSB0aGVuIGl0IHdpbGwgcmV0dXJuIGEgY2xvbmUgb2YgdGhlIG9iamVjdC5cbiAqXG4gKiBAdGhyb3dzIFVSSUVycm9yIElmIHBhcnNpbmcgdGhlIFVSSSBpcyBtYWxmb3JtZWQuIFRoZSBwYXNzZWQgVVJJIGNvbXBvbmVudHNcbiAqICAgICBzaG91bGQgYWxsIGJlIHBhcnNlYWJsZSBieSBkZWNvZGVVUklDb21wb25lbnQuXG4gKiBAcGFyYW0geyp9IHVyaSBSYXcgVVJJIHN0cmluZyBvciBpbnN0YW5jZSBvZiBVcmlcbiAqICAgICBvYmplY3QuXG4gKiBAcGFyYW0ge2Jvb2xlYW49fSBvcHRfaWdub3JlQ2FzZSBXaGV0aGVyIHRvIGlnbm9yZSB0aGUgY2FzZSBvZiBwYXJhbWV0ZXJcbiAqIG5hbWVzIGluICNnZXRQYXJhbWV0ZXJWYWx1ZS5cbiAqIEByZXR1cm4geyFnb29nLlVyaX0gVGhlIG5ldyBVUkkgb2JqZWN0LlxuICovXG5nb29nLlVyaS5wYXJzZSA9IGZ1bmN0aW9uKHVyaSwgb3B0X2lnbm9yZUNhc2UpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gdXJpIGluc3RhbmNlb2YgZ29vZy5VcmkgPyB1cmkuY2xvbmUoKSA6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBnb29nLlVyaSh1cmksIG9wdF9pZ25vcmVDYXNlKTtcbn07XG5cblxuLyoqXG4gKiBDcmVhdGVzIGEgbmV3IGdvb2cuVXJpIG9iamVjdCBmcm9tIHVuZW5jb2RlZCBwYXJ0cy5cbiAqXG4gKiBAcGFyYW0gez9zdHJpbmc9fSBvcHRfc2NoZW1lIFNjaGVtZS9wcm90b2NvbCBvciBmdWxsIFVSSSB0byBwYXJzZS5cbiAqIEBwYXJhbSB7P3N0cmluZz19IG9wdF91c2VySW5mbyB1c2VybmFtZTpwYXNzd29yZC5cbiAqIEBwYXJhbSB7P3N0cmluZz19IG9wdF9kb21haW4gd3d3Lmdvb2dsZS5jb20uXG4gKiBAcGFyYW0gez9udW1iZXI9fSBvcHRfcG9ydCA5ODMwLlxuICogQHBhcmFtIHs/c3RyaW5nPX0gb3B0X3BhdGggL3NvbWUvcGF0aC90by9hL2ZpbGUuaHRtbC5cbiAqIEBwYXJhbSB7c3RyaW5nfGdvb2cuVXJpLlF1ZXJ5RGF0YT19IG9wdF9xdWVyeSBhPTEmYj0yLlxuICogQHBhcmFtIHs/c3RyaW5nPX0gb3B0X2ZyYWdtZW50IFRoZSBmcmFnbWVudCB3aXRob3V0IHRoZSAjLlxuICogQHBhcmFtIHtib29sZWFuPX0gb3B0X2lnbm9yZUNhc2UgV2hldGhlciB0byBpZ25vcmUgcGFyYW1ldGVyIG5hbWUgY2FzZSBpblxuICogICAgICNnZXRQYXJhbWV0ZXJWYWx1ZS5cbiAqXG4gKiBAcmV0dXJuIHshZ29vZy5Vcml9IFRoZSBuZXcgVVJJIG9iamVjdC5cbiAqL1xuZ29vZy5VcmkuY3JlYXRlID0gZnVuY3Rpb24oXG4gICAgb3B0X3NjaGVtZSwgb3B0X3VzZXJJbmZvLCBvcHRfZG9tYWluLCBvcHRfcG9ydCwgb3B0X3BhdGgsIG9wdF9xdWVyeSxcbiAgICBvcHRfZnJhZ21lbnQsIG9wdF9pZ25vcmVDYXNlKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgdmFyIHVyaSA9IG5ldyBnb29nLlVyaShudWxsLCBvcHRfaWdub3JlQ2FzZSk7XG5cbiAgLy8gT25seSBzZXQgdGhlIHBhcnRzIGlmIHRoZXkgYXJlIGRlZmluZWQgYW5kIG5vdCBlbXB0eSBzdHJpbmdzLlxuICBvcHRfc2NoZW1lICYmIHVyaS5zZXRTY2hlbWUob3B0X3NjaGVtZSk7XG4gIG9wdF91c2VySW5mbyAmJiB1cmkuc2V0VXNlckluZm8ob3B0X3VzZXJJbmZvKTtcbiAgb3B0X2RvbWFpbiAmJiB1cmkuc2V0RG9tYWluKG9wdF9kb21haW4pO1xuICBvcHRfcG9ydCAmJiB1cmkuc2V0UG9ydChvcHRfcG9ydCk7XG4gIG9wdF9wYXRoICYmIHVyaS5zZXRQYXRoKG9wdF9wYXRoKTtcbiAgb3B0X3F1ZXJ5ICYmIHVyaS5zZXRRdWVyeURhdGEob3B0X3F1ZXJ5KTtcbiAgb3B0X2ZyYWdtZW50ICYmIHVyaS5zZXRGcmFnbWVudChvcHRfZnJhZ21lbnQpO1xuXG4gIHJldHVybiB1cmk7XG59O1xuXG5cbi8qKlxuICogUmVzb2x2ZXMgYSByZWxhdGl2ZSBVcmkgYWdhaW5zdCBhIGJhc2UgVXJpLCBhY2NlcHRpbmcgYm90aCBzdHJpbmdzIGFuZFxuICogVXJpIG9iamVjdHMuXG4gKlxuICogQHBhcmFtIHsqfSBiYXNlIEJhc2UgVXJpLlxuICogQHBhcmFtIHsqfSByZWwgUmVsYXRpdmUgVXJpLlxuICogQHJldHVybiB7IWdvb2cuVXJpfSBSZXNvbHZlZCB1cmkuXG4gKi9cbmdvb2cuVXJpLnJlc29sdmUgPSBmdW5jdGlvbihiYXNlLCByZWwpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBpZiAoIShiYXNlIGluc3RhbmNlb2YgZ29vZy5VcmkpKSB7XG4gICAgYmFzZSA9IGdvb2cuVXJpLnBhcnNlKGJhc2UpO1xuICB9XG5cbiAgaWYgKCEocmVsIGluc3RhbmNlb2YgZ29vZy5VcmkpKSB7XG4gICAgcmVsID0gZ29vZy5VcmkucGFyc2UocmVsKTtcbiAgfVxuXG4gIHJldHVybiBiYXNlLnJlc29sdmUocmVsKTtcbn07XG5cblxuLyoqXG4gKiBSZW1vdmVzIGRvdCBzZWdtZW50cyBpbiBnaXZlbiBwYXRoIGNvbXBvbmVudCwgYXMgZGVzY3JpYmVkIGluXG4gKiBSRkMgMzk4Niwgc2VjdGlvbiA1LjIuNC5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gcGF0aCBBIG5vbi1lbXB0eSBwYXRoIGNvbXBvbmVudC5cbiAqIEByZXR1cm4ge3N0cmluZ30gUGF0aCBjb21wb25lbnQgd2l0aCByZW1vdmVkIGRvdCBzZWdtZW50cy5cbiAqL1xuZ29vZy5VcmkucmVtb3ZlRG90U2VnbWVudHMgPSBmdW5jdGlvbihwYXRoKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgaWYgKHBhdGggPT0gJy4uJyB8fCBwYXRoID09ICcuJykge1xuICAgIHJldHVybiAnJztcblxuICB9IGVsc2UgaWYgKFxuICAgICAgIWdvb2cuc3RyaW5nLmNvbnRhaW5zKHBhdGgsICcuLycpICYmICFnb29nLnN0cmluZy5jb250YWlucyhwYXRoLCAnLy4nKSkge1xuICAgIC8vIFRoaXMgb3B0aW1pemF0aW9uIGRldGVjdHMgdXJpcyB3aGljaCBkbyBub3QgY29udGFpbiBkb3Qtc2VnbWVudHMsXG4gICAgLy8gYW5kIGFzIGEgY29uc2VxdWVuY2UgZG8gbm90IHJlcXVpcmUgYW55IHByb2Nlc3NpbmcuXG4gICAgcmV0dXJuIHBhdGg7XG5cbiAgfSBlbHNlIHtcbiAgICB2YXIgbGVhZGluZ1NsYXNoID0gZ29vZy5zdHJpbmcuc3RhcnRzV2l0aChwYXRoLCAnLycpO1xuICAgIHZhciBzZWdtZW50cyA9IHBhdGguc3BsaXQoJy8nKTtcbiAgICB2YXIgb3V0ID0gW107XG5cbiAgICBmb3IgKHZhciBwb3MgPSAwOyBwb3MgPCBzZWdtZW50cy5sZW5ndGg7KSB7XG4gICAgICB2YXIgc2VnbWVudCA9IHNlZ21lbnRzW3BvcysrXTtcblxuICAgICAgaWYgKHNlZ21lbnQgPT0gJy4nKSB7XG4gICAgICAgIGlmIChsZWFkaW5nU2xhc2ggJiYgcG9zID09IHNlZ21lbnRzLmxlbmd0aCkge1xuICAgICAgICAgIG91dC5wdXNoKCcnKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmIChzZWdtZW50ID09ICcuLicpIHtcbiAgICAgICAgaWYgKG91dC5sZW5ndGggPiAxIHx8IG91dC5sZW5ndGggPT0gMSAmJiBvdXRbMF0gIT0gJycpIHtcbiAgICAgICAgICBvdXQucG9wKCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGxlYWRpbmdTbGFzaCAmJiBwb3MgPT0gc2VnbWVudHMubGVuZ3RoKSB7XG4gICAgICAgICAgb3V0LnB1c2goJycpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBvdXQucHVzaChzZWdtZW50KTtcbiAgICAgICAgbGVhZGluZ1NsYXNoID0gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gb3V0LmpvaW4oJy8nKTtcbiAgfVxufTtcblxuXG4vKipcbiAqIERlY29kZXMgYSB2YWx1ZSBvciByZXR1cm5zIHRoZSBlbXB0eSBzdHJpbmcgaWYgaXQgaXNuJ3QgZGVmaW5lZCBvciBlbXB0eS5cbiAqIEB0aHJvd3MgVVJJRXJyb3IgSWYgZGVjb2RlVVJJQ29tcG9uZW50IGZhaWxzIHRvIGRlY29kZSB2YWwuXG4gKiBAcGFyYW0ge3N0cmluZ3x1bmRlZmluZWR9IHZhbCBWYWx1ZSB0byBkZWNvZGUuXG4gKiBAcGFyYW0ge2Jvb2xlYW49fSBvcHRfcHJlc2VydmVSZXNlcnZlZCBJZiB0cnVlLCByZXN0cmljdGVkIGNoYXJhY3RlcnMgd2lsbFxuICogICAgIG5vdCBiZSBkZWNvZGVkLlxuICogQHJldHVybiB7c3RyaW5nfSBEZWNvZGVkIHZhbHVlLlxuICogQHByaXZhdGVcbiAqL1xuZ29vZy5VcmkuZGVjb2RlT3JFbXB0eV8gPSBmdW5jdGlvbih2YWwsIG9wdF9wcmVzZXJ2ZVJlc2VydmVkKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgLy8gRG9uJ3QgdXNlIFVybERlY29kZSgpIGhlcmUgYmVjYXVzZSB2YWwgaXMgbm90IGEgcXVlcnkgcGFyYW1ldGVyLlxuICBpZiAoIXZhbCkge1xuICAgIHJldHVybiAnJztcbiAgfVxuXG4gIC8vIGRlY29kZVVSSSBoYXMgdGhlIHNhbWUgb3V0cHV0IGZvciAnJTJmJyBhbmQgJyUyNTJmJy4gV2UgZG91YmxlIGVuY29kZSAlMjVcbiAgLy8gc28gdGhhdCB3ZSBjYW4gZGlzdGluZ3Vpc2ggYmV0d2VlbiB0aGUgMiBpbnB1dHMuIFRoaXMgaXMgbGF0ZXIgdW5kb25lIGJ5XG4gIC8vIHJlbW92ZURvdWJsZUVuY29kaW5nXy5cbiAgcmV0dXJuIG9wdF9wcmVzZXJ2ZVJlc2VydmVkID8gZGVjb2RlVVJJKHZhbC5yZXBsYWNlKC8lMjUvZywgJyUyNTI1JykpIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVjb2RlVVJJQ29tcG9uZW50KHZhbCk7XG59O1xuXG5cbi8qKlxuICogSWYgdW5lc2NhcGVkUGFydCBpcyBub24gbnVsbCwgdGhlbiBlc2NhcGVzIGFueSBjaGFyYWN0ZXJzIGluIGl0IHRoYXQgYXJlbid0XG4gKiB2YWxpZCBjaGFyYWN0ZXJzIGluIGEgdXJsIGFuZCBhbHNvIGVzY2FwZXMgYW55IHNwZWNpYWwgY2hhcmFjdGVycyB0aGF0XG4gKiBhcHBlYXIgaW4gZXh0cmEuXG4gKlxuICogQHBhcmFtIHsqfSB1bmVzY2FwZWRQYXJ0IFRoZSBzdHJpbmcgdG8gZW5jb2RlLlxuICogQHBhcmFtIHtSZWdFeHB9IGV4dHJhIEEgY2hhcmFjdGVyIHNldCBvZiBjaGFyYWN0ZXJzIGluIFtcXDAxLVxcMTc3XS5cbiAqIEBwYXJhbSB7Ym9vbGVhbj19IG9wdF9yZW1vdmVEb3VibGVFbmNvZGluZyBJZiB0cnVlLCByZW1vdmUgZG91YmxlIHBlcmNlbnRcbiAqICAgICBlbmNvZGluZy5cbiAqIEByZXR1cm4gez9zdHJpbmd9IG51bGwgaWZmIHVuZXNjYXBlZFBhcnQgPT0gbnVsbC5cbiAqIEBwcml2YXRlXG4gKi9cbmdvb2cuVXJpLmVuY29kZVNwZWNpYWxDaGFyc18gPSBmdW5jdGlvbihcbiAgICB1bmVzY2FwZWRQYXJ0LCBleHRyYSwgb3B0X3JlbW92ZURvdWJsZUVuY29kaW5nKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgaWYgKHR5cGVvZiB1bmVzY2FwZWRQYXJ0ID09PSAnc3RyaW5nJykge1xuICAgIHZhciBlbmNvZGVkID0gZW5jb2RlVVJJKHVuZXNjYXBlZFBhcnQpLnJlcGxhY2UoZXh0cmEsIGdvb2cuVXJpLmVuY29kZUNoYXJfKTtcbiAgICBpZiAob3B0X3JlbW92ZURvdWJsZUVuY29kaW5nKSB7XG4gICAgICAvLyBlbmNvZGVVUkkgZG91YmxlLWVzY2FwZXMgJVhYIHNlcXVlbmNlcyB1c2VkIHRvIHJlcHJlc2VudCByZXN0cmljdGVkXG4gICAgICAvLyBjaGFyYWN0ZXJzIGluIHNvbWUgVVJJIGNvbXBvbmVudHMsIHJlbW92ZSB0aGUgZG91YmxlIGVzY2FwaW5nIGhlcmUuXG4gICAgICBlbmNvZGVkID0gZ29vZy5VcmkucmVtb3ZlRG91YmxlRW5jb2RpbmdfKGVuY29kZWQpO1xuICAgIH1cbiAgICByZXR1cm4gZW5jb2RlZDtcbiAgfVxuICByZXR1cm4gbnVsbDtcbn07XG5cblxuLyoqXG4gKiBDb252ZXJ0cyBhIGNoYXJhY3RlciBpbiBbXFwwMS1cXDE3N10gdG8gaXRzIHVuaWNvZGUgY2hhcmFjdGVyIGVxdWl2YWxlbnQuXG4gKiBAcGFyYW0ge3N0cmluZ30gY2ggT25lIGNoYXJhY3RlciBzdHJpbmcuXG4gKiBAcmV0dXJuIHtzdHJpbmd9IEVuY29kZWQgc3RyaW5nLlxuICogQHByaXZhdGVcbiAqL1xuZ29vZy5VcmkuZW5jb2RlQ2hhcl8gPSBmdW5jdGlvbihjaCkge1xuICAndXNlIHN0cmljdCc7XG4gIHZhciBuID0gY2guY2hhckNvZGVBdCgwKTtcbiAgcmV0dXJuICclJyArICgobiA+PiA0KSAmIDB4ZikudG9TdHJpbmcoMTYpICsgKG4gJiAweGYpLnRvU3RyaW5nKDE2KTtcbn07XG5cblxuLyoqXG4gKiBSZW1vdmVzIGRvdWJsZSBwZXJjZW50LWVuY29kaW5nIGZyb20gYSBzdHJpbmcuXG4gKiBAcGFyYW0gIHtzdHJpbmd9IGRvdWJsZUVuY29kZWRTdHJpbmcgU3RyaW5nXG4gKiBAcmV0dXJuIHtzdHJpbmd9IFN0cmluZyB3aXRoIGRvdWJsZSBlbmNvZGluZyByZW1vdmVkLlxuICogQHByaXZhdGVcbiAqL1xuZ29vZy5VcmkucmVtb3ZlRG91YmxlRW5jb2RpbmdfID0gZnVuY3Rpb24oZG91YmxlRW5jb2RlZFN0cmluZykge1xuICAndXNlIHN0cmljdCc7XG4gIHJldHVybiBkb3VibGVFbmNvZGVkU3RyaW5nLnJlcGxhY2UoLyUyNShbMC05YS1mQS1GXXsyfSkvZywgJyUkMScpO1xufTtcblxuXG4vKipcbiAqIFJlZ3VsYXIgZXhwcmVzc2lvbiBmb3IgY2hhcmFjdGVycyB0aGF0IGFyZSBkaXNhbGxvd2VkIGluIHRoZSBzY2hlbWUgb3JcbiAqIHVzZXJJbmZvIHBhcnQgb2YgdGhlIFVSSS5cbiAqIEB0eXBlIHtSZWdFeHB9XG4gKiBAcHJpdmF0ZVxuICovXG5nb29nLlVyaS5yZURpc2FsbG93ZWRJblNjaGVtZU9yVXNlckluZm9fID0gL1sjXFwvXFw/QF0vZztcblxuXG4vKipcbiAqIFJlZ3VsYXIgZXhwcmVzc2lvbiBmb3IgY2hhcmFjdGVycyB0aGF0IGFyZSBkaXNhbGxvd2VkIGluIGEgcmVsYXRpdmUgcGF0aC5cbiAqIENvbG9uIGlzIGluY2x1ZGVkIGR1ZSB0byBSRkMgMzk4NiAzLjMuXG4gKiBAdHlwZSB7UmVnRXhwfVxuICogQHByaXZhdGVcbiAqL1xuZ29vZy5VcmkucmVEaXNhbGxvd2VkSW5SZWxhdGl2ZVBhdGhfID0gL1tcXCNcXD86XS9nO1xuXG5cbi8qKlxuICogUmVndWxhciBleHByZXNzaW9uIGZvciBjaGFyYWN0ZXJzIHRoYXQgYXJlIGRpc2FsbG93ZWQgaW4gYW4gYWJzb2x1dGUgcGF0aC5cbiAqIEB0eXBlIHtSZWdFeHB9XG4gKiBAcHJpdmF0ZVxuICovXG5nb29nLlVyaS5yZURpc2FsbG93ZWRJbkFic29sdXRlUGF0aF8gPSAvW1xcI1xcP10vZztcblxuXG4vKipcbiAqIFJlZ3VsYXIgZXhwcmVzc2lvbiBmb3IgY2hhcmFjdGVycyB0aGF0IGFyZSBkaXNhbGxvd2VkIGluIHRoZSBxdWVyeS5cbiAqIEB0eXBlIHtSZWdFeHB9XG4gKiBAcHJpdmF0ZVxuICovXG5nb29nLlVyaS5yZURpc2FsbG93ZWRJblF1ZXJ5XyA9IC9bXFwjXFw/QF0vZztcblxuXG4vKipcbiAqIFJlZ3VsYXIgZXhwcmVzc2lvbiBmb3IgY2hhcmFjdGVycyB0aGF0IGFyZSBkaXNhbGxvd2VkIGluIHRoZSBmcmFnbWVudC5cbiAqIEB0eXBlIHtSZWdFeHB9XG4gKiBAcHJpdmF0ZVxuICovXG5nb29nLlVyaS5yZURpc2FsbG93ZWRJbkZyYWdtZW50XyA9IC8jL2c7XG5cblxuLyoqXG4gKiBDaGVja3Mgd2hldGhlciB0d28gVVJJcyBoYXZlIHRoZSBzYW1lIGRvbWFpbi5cbiAqIEBwYXJhbSB7c3RyaW5nfSB1cmkxU3RyaW5nIEZpcnN0IFVSSSBzdHJpbmcuXG4gKiBAcGFyYW0ge3N0cmluZ30gdXJpMlN0cmluZyBTZWNvbmQgVVJJIHN0cmluZy5cbiAqIEByZXR1cm4ge2Jvb2xlYW59IHRydWUgaWYgdGhlIHR3byBVUklzIGhhdmUgdGhlIHNhbWUgZG9tYWluOyBmYWxzZSBvdGhlcndpc2UuXG4gKi9cbmdvb2cuVXJpLmhhdmVTYW1lRG9tYWluID0gZnVuY3Rpb24odXJpMVN0cmluZywgdXJpMlN0cmluZykge1xuICAndXNlIHN0cmljdCc7XG4gIC8vIERpZmZlcnMgZnJvbSBnb29nLnVyaS51dGlscy5oYXZlU2FtZURvbWFpbiwgc2luY2UgdGhpcyBpZ25vcmVzIHNjaGVtZS5cbiAgLy8gVE9ETyhnYm95ZXIpOiBIYXZlIHRoaXMganVzdCBjYWxsIGdvb2cudXJpLnV0aWwuaGF2ZVNhbWVEb21haW4uXG4gIHZhciBwaWVjZXMxID0gZ29vZy51cmkudXRpbHMuc3BsaXQodXJpMVN0cmluZyk7XG4gIHZhciBwaWVjZXMyID0gZ29vZy51cmkudXRpbHMuc3BsaXQodXJpMlN0cmluZyk7XG4gIHJldHVybiBwaWVjZXMxW2dvb2cudXJpLnV0aWxzLkNvbXBvbmVudEluZGV4LkRPTUFJTl0gPT1cbiAgICAgIHBpZWNlczJbZ29vZy51cmkudXRpbHMuQ29tcG9uZW50SW5kZXguRE9NQUlOXSAmJlxuICAgICAgcGllY2VzMVtnb29nLnVyaS51dGlscy5Db21wb25lbnRJbmRleC5QT1JUXSA9PVxuICAgICAgcGllY2VzMltnb29nLnVyaS51dGlscy5Db21wb25lbnRJbmRleC5QT1JUXTtcbn07XG5cblxuXG4vKipcbiAqIENsYXNzIHVzZWQgdG8gcmVwcmVzZW50IFVSSSBxdWVyeSBwYXJhbWV0ZXJzLiAgSXQgaXMgZXNzZW50aWFsbHkgYSBoYXNoIG9mXG4gKiBuYW1lLXZhbHVlIHBhaXJzLCB0aG91Z2ggYSBuYW1lIGNhbiBiZSBwcmVzZW50IG1vcmUgdGhhbiBvbmNlLlxuICpcbiAqIEhhcyB0aGUgc2FtZSBpbnRlcmZhY2UgYXMgdGhlIGNvbGxlY3Rpb25zIGluIGdvb2cuc3RydWN0cy5cbiAqXG4gKiBAcGFyYW0gez9zdHJpbmc9fSBvcHRfcXVlcnkgT3B0aW9uYWwgZW5jb2RlZCBxdWVyeSBzdHJpbmcgdG8gcGFyc2UgaW50b1xuICogICAgIHRoZSBvYmplY3QuXG4gKiBAcGFyYW0ge2Jvb2xlYW49fSBvcHRfaWdub3JlQ2FzZSBJZiB0cnVlLCBpZ25vcmUgdGhlIGNhc2Ugb2YgdGhlIHBhcmFtZXRlclxuICogICAgIG5hbWUgaW4gI2dldC5cbiAqIEBjb25zdHJ1Y3RvclxuICogQHN0cnVjdFxuICogQGZpbmFsXG4gKi9cbmdvb2cuVXJpLlF1ZXJ5RGF0YSA9IGZ1bmN0aW9uKG9wdF9xdWVyeSwgb3B0X2lnbm9yZUNhc2UpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICAvKipcbiAgICogVGhlIG1hcCBjb250YWluaW5nIG5hbWUvdmFsdWUgb3IgbmFtZS9hcnJheS1vZi12YWx1ZXMgcGFpcnMuXG4gICAqIE1heSBiZSBudWxsIGlmIGl0IHJlcXVpcmVzIHBhcnNpbmcgZnJvbSB0aGUgcXVlcnkgc3RyaW5nLlxuICAgKlxuICAgKiBXZSBuZWVkIHRvIHVzZSBhIE1hcCBiZWNhdXNlIHdlIGNhbm5vdCBndWFyYW50ZWUgdGhhdCB0aGUga2V5IG5hbWVzIHdpbGxcbiAgICogbm90IGJlIHByb2JsZW1hdGljIGZvciBJRS5cbiAgICpcbiAgICogQHByaXZhdGUgez9nb29nLnN0cnVjdHMuTWFwPHN0cmluZywgIUFycmF5PCo+Pn1cbiAgICovXG4gIHRoaXMua2V5TWFwXyA9IG51bGw7XG5cbiAgLyoqXG4gICAqIFRoZSBudW1iZXIgb2YgcGFyYW1zLCBvciBudWxsIGlmIGl0IHJlcXVpcmVzIGNvbXB1dGluZy5cbiAgICogQHByaXZhdGUgez9udW1iZXJ9XG4gICAqL1xuICB0aGlzLmNvdW50XyA9IG51bGw7XG5cbiAgLyoqXG4gICAqIEVuY29kZWQgcXVlcnkgc3RyaW5nLCBvciBudWxsIGlmIGl0IHJlcXVpcmVzIGNvbXB1dGluZyBmcm9tIHRoZSBrZXkgbWFwLlxuICAgKiBAcHJpdmF0ZSB7P3N0cmluZ31cbiAgICovXG4gIHRoaXMuZW5jb2RlZFF1ZXJ5XyA9IG9wdF9xdWVyeSB8fCBudWxsO1xuXG4gIC8qKlxuICAgKiBJZiB0cnVlLCBpZ25vcmUgdGhlIGNhc2Ugb2YgdGhlIHBhcmFtZXRlciBuYW1lIGluICNnZXQuXG4gICAqIEBwcml2YXRlIHtib29sZWFufVxuICAgKi9cbiAgdGhpcy5pZ25vcmVDYXNlXyA9ICEhb3B0X2lnbm9yZUNhc2U7XG59O1xuXG5cbi8qKlxuICogSWYgdGhlIHVuZGVybHlpbmcga2V5IG1hcCBpcyBub3QgeWV0IGluaXRpYWxpemVkLCBpdCBwYXJzZXMgdGhlXG4gKiBxdWVyeSBzdHJpbmcgYW5kIGZpbGxzIHRoZSBtYXAgd2l0aCBwYXJzZWQgZGF0YS5cbiAqIEBwcml2YXRlXG4gKi9cbmdvb2cuVXJpLlF1ZXJ5RGF0YS5wcm90b3R5cGUuZW5zdXJlS2V5TWFwSW5pdGlhbGl6ZWRfID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgaWYgKCF0aGlzLmtleU1hcF8pIHtcbiAgICB0aGlzLmtleU1hcF8gPSBuZXcgZ29vZy5zdHJ1Y3RzLk1hcCgpO1xuICAgIHRoaXMuY291bnRfID0gMDtcbiAgICBpZiAodGhpcy5lbmNvZGVkUXVlcnlfKSB7XG4gICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICBnb29nLnVyaS51dGlscy5wYXJzZVF1ZXJ5RGF0YSh0aGlzLmVuY29kZWRRdWVyeV8sIGZ1bmN0aW9uKG5hbWUsIHZhbHVlKSB7XG4gICAgICAgICd1c2Ugc3RyaWN0JztcbiAgICAgICAgc2VsZi5hZGQoZ29vZy5zdHJpbmcudXJsRGVjb2RlKG5hbWUpLCB2YWx1ZSk7XG4gICAgICB9KTtcbiAgICB9XG4gIH1cbn07XG5cblxuLyoqXG4gKiBDcmVhdGVzIGEgbmV3IHF1ZXJ5IGRhdGEgaW5zdGFuY2UgZnJvbSBhIG1hcCBvZiBuYW1lcyBhbmQgdmFsdWVzLlxuICpcbiAqIEBwYXJhbSB7IWdvb2cuc3RydWN0cy5NYXA8c3RyaW5nLCA/PnwhT2JqZWN0fSBtYXAgTWFwIG9mIHN0cmluZyBwYXJhbWV0ZXJcbiAqICAgICBuYW1lcyB0byBwYXJhbWV0ZXIgdmFsdWUuIElmIHBhcmFtZXRlciB2YWx1ZSBpcyBhbiBhcnJheSwgaXQgaXNcbiAqICAgICB0cmVhdGVkIGFzIGlmIHRoZSBrZXkgbWFwcyB0byBlYWNoIGluZGl2aWR1YWwgdmFsdWUgaW4gdGhlXG4gKiAgICAgYXJyYXkuXG4gKiBAcGFyYW0ge2Jvb2xlYW49fSBvcHRfaWdub3JlQ2FzZSBJZiB0cnVlLCBpZ25vcmUgdGhlIGNhc2Ugb2YgdGhlIHBhcmFtZXRlclxuICogICAgIG5hbWUgaW4gI2dldC5cbiAqIEByZXR1cm4geyFnb29nLlVyaS5RdWVyeURhdGF9IFRoZSBwb3B1bGF0ZWQgcXVlcnkgZGF0YSBpbnN0YW5jZS5cbiAqL1xuZ29vZy5VcmkuUXVlcnlEYXRhLmNyZWF0ZUZyb21NYXAgPSBmdW5jdGlvbihtYXAsIG9wdF9pZ25vcmVDYXNlKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgdmFyIGtleXMgPSBnb29nLnN0cnVjdHMuZ2V0S2V5cyhtYXApO1xuICBpZiAodHlwZW9mIGtleXMgPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0tleXMgYXJlIHVuZGVmaW5lZCcpO1xuICB9XG5cbiAgdmFyIHF1ZXJ5RGF0YSA9IG5ldyBnb29nLlVyaS5RdWVyeURhdGEobnVsbCwgb3B0X2lnbm9yZUNhc2UpO1xuICB2YXIgdmFsdWVzID0gZ29vZy5zdHJ1Y3RzLmdldFZhbHVlcyhtYXApO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyBpKyspIHtcbiAgICB2YXIga2V5ID0ga2V5c1tpXTtcbiAgICB2YXIgdmFsdWUgPSB2YWx1ZXNbaV07XG4gICAgaWYgKCFBcnJheS5pc0FycmF5KHZhbHVlKSkge1xuICAgICAgcXVlcnlEYXRhLmFkZChrZXksIHZhbHVlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcXVlcnlEYXRhLnNldFZhbHVlcyhrZXksIHZhbHVlKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHF1ZXJ5RGF0YTtcbn07XG5cblxuLyoqXG4gKiBDcmVhdGVzIGEgbmV3IHF1ZXJ5IGRhdGEgaW5zdGFuY2UgZnJvbSBwYXJhbGxlbCBhcnJheXMgb2YgcGFyYW1ldGVyIG5hbWVzXG4gKiBhbmQgdmFsdWVzLiBBbGxvd3MgZm9yIGR1cGxpY2F0ZSBwYXJhbWV0ZXIgbmFtZXMuIFRocm93cyBhbiBlcnJvciBpZiB0aGVcbiAqIGxlbmd0aHMgb2YgdGhlIGFycmF5cyBkaWZmZXIuXG4gKlxuICogQHBhcmFtIHshQXJyYXk8c3RyaW5nPn0ga2V5cyBQYXJhbWV0ZXIgbmFtZXMuXG4gKiBAcGFyYW0geyFBcnJheTw/Pn0gdmFsdWVzIFBhcmFtZXRlciB2YWx1ZXMuXG4gKiBAcGFyYW0ge2Jvb2xlYW49fSBvcHRfaWdub3JlQ2FzZSBJZiB0cnVlLCBpZ25vcmUgdGhlIGNhc2Ugb2YgdGhlIHBhcmFtZXRlclxuICogICAgIG5hbWUgaW4gI2dldC5cbiAqIEByZXR1cm4geyFnb29nLlVyaS5RdWVyeURhdGF9IFRoZSBwb3B1bGF0ZWQgcXVlcnkgZGF0YSBpbnN0YW5jZS5cbiAqL1xuZ29vZy5VcmkuUXVlcnlEYXRhLmNyZWF0ZUZyb21LZXlzVmFsdWVzID0gZnVuY3Rpb24oXG4gICAga2V5cywgdmFsdWVzLCBvcHRfaWdub3JlQ2FzZSkge1xuICAndXNlIHN0cmljdCc7XG4gIGlmIChrZXlzLmxlbmd0aCAhPSB2YWx1ZXMubGVuZ3RoKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdNaXNtYXRjaGVkIGxlbmd0aHMgZm9yIGtleXMvdmFsdWVzJyk7XG4gIH1cbiAgdmFyIHF1ZXJ5RGF0YSA9IG5ldyBnb29nLlVyaS5RdWVyeURhdGEobnVsbCwgb3B0X2lnbm9yZUNhc2UpO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyBpKyspIHtcbiAgICBxdWVyeURhdGEuYWRkKGtleXNbaV0sIHZhbHVlc1tpXSk7XG4gIH1cbiAgcmV0dXJuIHF1ZXJ5RGF0YTtcbn07XG5cblxuLyoqXG4gKiBAcmV0dXJuIHs/bnVtYmVyfSBUaGUgbnVtYmVyIG9mIHBhcmFtZXRlcnMuXG4gKi9cbmdvb2cuVXJpLlF1ZXJ5RGF0YS5wcm90b3R5cGUuZ2V0Q291bnQgPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICB0aGlzLmVuc3VyZUtleU1hcEluaXRpYWxpemVkXygpO1xuICByZXR1cm4gdGhpcy5jb3VudF87XG59O1xuXG5cbi8qKlxuICogQWRkcyBhIGtleSB2YWx1ZSBwYWlyLlxuICogQHBhcmFtIHtzdHJpbmd9IGtleSBOYW1lLlxuICogQHBhcmFtIHsqfSB2YWx1ZSBWYWx1ZS5cbiAqIEByZXR1cm4geyFnb29nLlVyaS5RdWVyeURhdGF9IEluc3RhbmNlIG9mIHRoaXMgb2JqZWN0LlxuICovXG5nb29nLlVyaS5RdWVyeURhdGEucHJvdG90eXBlLmFkZCA9IGZ1bmN0aW9uKGtleSwgdmFsdWUpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICB0aGlzLmVuc3VyZUtleU1hcEluaXRpYWxpemVkXygpO1xuICB0aGlzLmludmFsaWRhdGVDYWNoZV8oKTtcblxuICBrZXkgPSB0aGlzLmdldEtleU5hbWVfKGtleSk7XG4gIHZhciB2YWx1ZXMgPSB0aGlzLmtleU1hcF8uZ2V0KGtleSk7XG4gIGlmICghdmFsdWVzKSB7XG4gICAgdGhpcy5rZXlNYXBfLnNldChrZXksICh2YWx1ZXMgPSBbXSkpO1xuICB9XG4gIHZhbHVlcy5wdXNoKHZhbHVlKTtcbiAgdGhpcy5jb3VudF8gPSBnb29nLmFzc2VydHMuYXNzZXJ0TnVtYmVyKHRoaXMuY291bnRfKSArIDE7XG4gIHJldHVybiB0aGlzO1xufTtcblxuXG4vKipcbiAqIFJlbW92ZXMgYWxsIHRoZSBwYXJhbXMgd2l0aCB0aGUgZ2l2ZW4ga2V5LlxuICogQHBhcmFtIHtzdHJpbmd9IGtleSBOYW1lLlxuICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciBhbnkgcGFyYW1ldGVyIHdhcyByZW1vdmVkLlxuICovXG5nb29nLlVyaS5RdWVyeURhdGEucHJvdG90eXBlLnJlbW92ZSA9IGZ1bmN0aW9uKGtleSkge1xuICAndXNlIHN0cmljdCc7XG4gIHRoaXMuZW5zdXJlS2V5TWFwSW5pdGlhbGl6ZWRfKCk7XG5cbiAga2V5ID0gdGhpcy5nZXRLZXlOYW1lXyhrZXkpO1xuICBpZiAodGhpcy5rZXlNYXBfLmNvbnRhaW5zS2V5KGtleSkpIHtcbiAgICB0aGlzLmludmFsaWRhdGVDYWNoZV8oKTtcblxuICAgIC8vIERlY3JlbWVudCBwYXJhbWV0ZXIgY291bnQuXG4gICAgdGhpcy5jb3VudF8gPVxuICAgICAgICBnb29nLmFzc2VydHMuYXNzZXJ0TnVtYmVyKHRoaXMuY291bnRfKSAtIHRoaXMua2V5TWFwXy5nZXQoa2V5KS5sZW5ndGg7XG4gICAgcmV0dXJuIHRoaXMua2V5TWFwXy5yZW1vdmUoa2V5KTtcbiAgfVxuICByZXR1cm4gZmFsc2U7XG59O1xuXG5cbi8qKlxuICogQ2xlYXJzIHRoZSBwYXJhbWV0ZXJzLlxuICovXG5nb29nLlVyaS5RdWVyeURhdGEucHJvdG90eXBlLmNsZWFyID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgdGhpcy5pbnZhbGlkYXRlQ2FjaGVfKCk7XG4gIHRoaXMua2V5TWFwXyA9IG51bGw7XG4gIHRoaXMuY291bnRfID0gMDtcbn07XG5cblxuLyoqXG4gKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHdlIGhhdmUgYW55IHBhcmFtZXRlcnMuXG4gKi9cbmdvb2cuVXJpLlF1ZXJ5RGF0YS5wcm90b3R5cGUuaXNFbXB0eSA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIHRoaXMuZW5zdXJlS2V5TWFwSW5pdGlhbGl6ZWRfKCk7XG4gIHJldHVybiB0aGlzLmNvdW50XyA9PSAwO1xufTtcblxuXG4vKipcbiAqIFdoZXRoZXIgdGhlcmUgaXMgYSBwYXJhbWV0ZXIgd2l0aCB0aGUgZ2l2ZW4gbmFtZVxuICogQHBhcmFtIHtzdHJpbmd9IGtleSBUaGUgcGFyYW1ldGVyIG5hbWUgdG8gY2hlY2sgZm9yLlxuICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGVyZSBpcyBhIHBhcmFtZXRlciB3aXRoIHRoZSBnaXZlbiBuYW1lLlxuICovXG5nb29nLlVyaS5RdWVyeURhdGEucHJvdG90eXBlLmNvbnRhaW5zS2V5ID0gZnVuY3Rpb24oa2V5KSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgdGhpcy5lbnN1cmVLZXlNYXBJbml0aWFsaXplZF8oKTtcbiAga2V5ID0gdGhpcy5nZXRLZXlOYW1lXyhrZXkpO1xuICByZXR1cm4gdGhpcy5rZXlNYXBfLmNvbnRhaW5zS2V5KGtleSk7XG59O1xuXG5cbi8qKlxuICogV2hldGhlciB0aGVyZSBpcyBhIHBhcmFtZXRlciB3aXRoIHRoZSBnaXZlbiB2YWx1ZS5cbiAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrIGZvci5cbiAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgdGhlcmUgaXMgYSBwYXJhbWV0ZXIgd2l0aCB0aGUgZ2l2ZW4gdmFsdWUuXG4gKi9cbmdvb2cuVXJpLlF1ZXJ5RGF0YS5wcm90b3R5cGUuY29udGFpbnNWYWx1ZSA9IGZ1bmN0aW9uKHZhbHVlKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgLy8gTk9URShhcnYpOiBUaGlzIHNvbHV0aW9uIGdvZXMgdGhyb3VnaCBhbGwgdGhlIHBhcmFtcyBldmVuIGlmIGl0IHdhcyB0aGVcbiAgLy8gZmlyc3QgcGFyYW0uIFdlIGNhbiBnZXQgYXJvdW5kIHRoaXMgYnkgbm90IHJldXNpbmcgY29kZSBvciBieSBzd2l0Y2hpbmcgdG9cbiAgLy8gaXRlcmF0b3JzLlxuICB2YXIgdmFscyA9IHRoaXMuZ2V0VmFsdWVzKCk7XG4gIHJldHVybiBnb29nLmFycmF5LmNvbnRhaW5zKHZhbHMsIHZhbHVlKTtcbn07XG5cblxuLyoqXG4gKiBSdW5zIGEgY2FsbGJhY2sgb24gZXZlcnkga2V5LXZhbHVlIHBhaXIgaW4gdGhlIG1hcCwgaW5jbHVkaW5nIGR1cGxpY2F0ZSBrZXlzLlxuICogVGhpcyB3b24ndCBtYWludGFpbiBvcmlnaW5hbCBvcmRlciB3aGVuIGR1cGxpY2F0ZSBrZXlzIGFyZSBpbnRlcnNwZXJzZWQgKGxpa2VcbiAqIGdldEtleXMoKSAvIGdldFZhbHVlcygpKS5cbiAqIEBwYXJhbSB7ZnVuY3Rpb24odGhpczpTQ09QRSwgPywgc3RyaW5nLCAhZ29vZy5VcmkuUXVlcnlEYXRhKX0gZlxuICogQHBhcmFtIHtTQ09QRT19IG9wdF9zY29wZSBUaGUgdmFsdWUgb2YgXCJ0aGlzXCIgaW5zaWRlIGYuXG4gKiBAdGVtcGxhdGUgU0NPUEVcbiAqL1xuZ29vZy5VcmkuUXVlcnlEYXRhLnByb3RvdHlwZS5mb3JFYWNoID0gZnVuY3Rpb24oZiwgb3B0X3Njb3BlKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgdGhpcy5lbnN1cmVLZXlNYXBJbml0aWFsaXplZF8oKTtcbiAgdGhpcy5rZXlNYXBfLmZvckVhY2goZnVuY3Rpb24odmFsdWVzLCBrZXkpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgZ29vZy5hcnJheS5mb3JFYWNoKHZhbHVlcywgZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgICd1c2Ugc3RyaWN0JztcbiAgICAgIGYuY2FsbChvcHRfc2NvcGUsIHZhbHVlLCBrZXksIHRoaXMpO1xuICAgIH0sIHRoaXMpO1xuICB9LCB0aGlzKTtcbn07XG5cblxuLyoqXG4gKiBSZXR1cm5zIGFsbCB0aGUga2V5cyBvZiB0aGUgcGFyYW1ldGVycy4gSWYgYSBrZXkgaXMgdXNlZCBtdWx0aXBsZSB0aW1lc1xuICogaXQgd2lsbCBiZSBpbmNsdWRlZCBtdWx0aXBsZSB0aW1lcyBpbiB0aGUgcmV0dXJuZWQgYXJyYXlcbiAqIEByZXR1cm4geyFBcnJheTxzdHJpbmc+fSBBbGwgdGhlIGtleXMgb2YgdGhlIHBhcmFtZXRlcnMuXG4gKi9cbmdvb2cuVXJpLlF1ZXJ5RGF0YS5wcm90b3R5cGUuZ2V0S2V5cyA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIHRoaXMuZW5zdXJlS2V5TWFwSW5pdGlhbGl6ZWRfKCk7XG4gIC8vIFdlIG5lZWQgdG8gZ2V0IHRoZSB2YWx1ZXMgdG8ga25vdyBob3cgbWFueSBrZXlzIHRvIGFkZC5cbiAgdmFyIHZhbHMgPSB0aGlzLmtleU1hcF8uZ2V0VmFsdWVzKCk7XG4gIHZhciBrZXlzID0gdGhpcy5rZXlNYXBfLmdldEtleXMoKTtcbiAgdmFyIHJ2ID0gW107XG4gIGZvciAodmFyIGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7IGkrKykge1xuICAgIHZhciB2YWwgPSB2YWxzW2ldO1xuICAgIGZvciAodmFyIGogPSAwOyBqIDwgdmFsLmxlbmd0aDsgaisrKSB7XG4gICAgICBydi5wdXNoKGtleXNbaV0pO1xuICAgIH1cbiAgfVxuICByZXR1cm4gcnY7XG59O1xuXG5cbi8qKlxuICogUmV0dXJucyBhbGwgdGhlIHZhbHVlcyBvZiB0aGUgcGFyYW1ldGVycyB3aXRoIHRoZSBnaXZlbiBuYW1lLiBJZiB0aGUgcXVlcnlcbiAqIGRhdGEgaGFzIG5vIHN1Y2gga2V5IHRoaXMgd2lsbCByZXR1cm4gYW4gZW1wdHkgYXJyYXkuIElmIG5vIGtleSBpcyBnaXZlblxuICogYWxsIHZhbHVlcyB3aWwgYmUgcmV0dXJuZWQuXG4gKiBAcGFyYW0ge3N0cmluZz19IG9wdF9rZXkgVGhlIG5hbWUgb2YgdGhlIHBhcmFtZXRlciB0byBnZXQgdGhlIHZhbHVlcyBmb3IuXG4gKiBAcmV0dXJuIHshQXJyYXk8Pz59IEFsbCB0aGUgdmFsdWVzIG9mIHRoZSBwYXJhbWV0ZXJzIHdpdGggdGhlIGdpdmVuIG5hbWUuXG4gKi9cbmdvb2cuVXJpLlF1ZXJ5RGF0YS5wcm90b3R5cGUuZ2V0VmFsdWVzID0gZnVuY3Rpb24ob3B0X2tleSkge1xuICAndXNlIHN0cmljdCc7XG4gIHRoaXMuZW5zdXJlS2V5TWFwSW5pdGlhbGl6ZWRfKCk7XG4gIHZhciBydiA9IFtdO1xuICBpZiAodHlwZW9mIG9wdF9rZXkgPT09ICdzdHJpbmcnKSB7XG4gICAgaWYgKHRoaXMuY29udGFpbnNLZXkob3B0X2tleSkpIHtcbiAgICAgIHJ2ID0gZ29vZy5hcnJheS5jb25jYXQocnYsIHRoaXMua2V5TWFwXy5nZXQodGhpcy5nZXRLZXlOYW1lXyhvcHRfa2V5KSkpO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICAvLyBSZXR1cm4gYWxsIHZhbHVlcy5cbiAgICB2YXIgdmFsdWVzID0gdGhpcy5rZXlNYXBfLmdldFZhbHVlcygpO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdmFsdWVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBydiA9IGdvb2cuYXJyYXkuY29uY2F0KHJ2LCB2YWx1ZXNbaV0pO1xuICAgIH1cbiAgfVxuICByZXR1cm4gcnY7XG59O1xuXG5cbi8qKlxuICogU2V0cyBhIGtleSB2YWx1ZSBwYWlyIGFuZCByZW1vdmVzIGFsbCBvdGhlciBrZXlzIHdpdGggdGhlIHNhbWUgdmFsdWUuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IGtleSBOYW1lLlxuICogQHBhcmFtIHsqfSB2YWx1ZSBWYWx1ZS5cbiAqIEByZXR1cm4geyFnb29nLlVyaS5RdWVyeURhdGF9IEluc3RhbmNlIG9mIHRoaXMgb2JqZWN0LlxuICovXG5nb29nLlVyaS5RdWVyeURhdGEucHJvdG90eXBlLnNldCA9IGZ1bmN0aW9uKGtleSwgdmFsdWUpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICB0aGlzLmVuc3VyZUtleU1hcEluaXRpYWxpemVkXygpO1xuICB0aGlzLmludmFsaWRhdGVDYWNoZV8oKTtcblxuICAvLyBUT0RPKGNocmlzaGVucnkpOiBUaGlzIGNvdWxkIGJlIGJldHRlciB3cml0dGVuIGFzXG4gIC8vIHRoaXMucmVtb3ZlKGtleSksIHRoaXMuYWRkKGtleSwgdmFsdWUpLCBidXQgdGhhdCB3b3VsZCByZW9yZGVyXG4gIC8vIHRoZSBrZXkgKHNpbmNlIHRoZSBrZXkgaXMgZmlyc3QgcmVtb3ZlZCBhbmQgdGhlbiBhZGRlZCBhdCB0aGVcbiAgLy8gZW5kKSBhbmQgd2Ugd291bGQgaGF2ZSB0byBmaXggdW5pdCB0ZXN0cyB0aGF0IGRlcGVuZCBvbiBrZXlcbiAgLy8gb3JkZXJpbmcuXG4gIGtleSA9IHRoaXMuZ2V0S2V5TmFtZV8oa2V5KTtcbiAgaWYgKHRoaXMuY29udGFpbnNLZXkoa2V5KSkge1xuICAgIHRoaXMuY291bnRfID1cbiAgICAgICAgZ29vZy5hc3NlcnRzLmFzc2VydE51bWJlcih0aGlzLmNvdW50XykgLSB0aGlzLmtleU1hcF8uZ2V0KGtleSkubGVuZ3RoO1xuICB9XG4gIHRoaXMua2V5TWFwXy5zZXQoa2V5LCBbdmFsdWVdKTtcbiAgdGhpcy5jb3VudF8gPSBnb29nLmFzc2VydHMuYXNzZXJ0TnVtYmVyKHRoaXMuY291bnRfKSArIDE7XG4gIHJldHVybiB0aGlzO1xufTtcblxuXG4vKipcbiAqIFJldHVybnMgdGhlIGZpcnN0IHZhbHVlIGFzc29jaWF0ZWQgd2l0aCB0aGUga2V5LiBJZiB0aGUgcXVlcnkgZGF0YSBoYXMgbm9cbiAqIHN1Y2gga2V5IHRoaXMgd2lsbCByZXR1cm4gdW5kZWZpbmVkIG9yIHRoZSBvcHRpb25hbCBkZWZhdWx0LlxuICogQHBhcmFtIHtzdHJpbmd9IGtleSBUaGUgbmFtZSBvZiB0aGUgcGFyYW1ldGVyIHRvIGdldCB0aGUgdmFsdWUgZm9yLlxuICogQHBhcmFtIHsqPX0gb3B0X2RlZmF1bHQgVGhlIGRlZmF1bHQgdmFsdWUgdG8gcmV0dXJuIGlmIHRoZSBxdWVyeSBkYXRhXG4gKiAgICAgaGFzIG5vIHN1Y2gga2V5LlxuICogQHJldHVybiB7Kn0gVGhlIGZpcnN0IHN0cmluZyB2YWx1ZSBhc3NvY2lhdGVkIHdpdGggdGhlIGtleSwgb3Igb3B0X2RlZmF1bHRcbiAqICAgICBpZiB0aGVyZSdzIG5vIHZhbHVlLlxuICovXG5nb29nLlVyaS5RdWVyeURhdGEucHJvdG90eXBlLmdldCA9IGZ1bmN0aW9uKGtleSwgb3B0X2RlZmF1bHQpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBpZiAoIWtleSkge1xuICAgIHJldHVybiBvcHRfZGVmYXVsdDtcbiAgfVxuICB2YXIgdmFsdWVzID0gdGhpcy5nZXRWYWx1ZXMoa2V5KTtcbiAgcmV0dXJuIHZhbHVlcy5sZW5ndGggPiAwID8gU3RyaW5nKHZhbHVlc1swXSkgOiBvcHRfZGVmYXVsdDtcbn07XG5cblxuLyoqXG4gKiBTZXRzIHRoZSB2YWx1ZXMgZm9yIGEga2V5LiBJZiB0aGUga2V5IGFscmVhZHkgZXhpc3RzLCB0aGlzIHdpbGxcbiAqIG92ZXJyaWRlIGFsbCBvZiB0aGUgZXhpc3RpbmcgdmFsdWVzIHRoYXQgY29ycmVzcG9uZCB0byB0aGUga2V5LlxuICogQHBhcmFtIHtzdHJpbmd9IGtleSBUaGUga2V5IHRvIHNldCB2YWx1ZXMgZm9yLlxuICogQHBhcmFtIHshQXJyYXk8Pz59IHZhbHVlcyBUaGUgdmFsdWVzIHRvIHNldC5cbiAqL1xuZ29vZy5VcmkuUXVlcnlEYXRhLnByb3RvdHlwZS5zZXRWYWx1ZXMgPSBmdW5jdGlvbihrZXksIHZhbHVlcykge1xuICAndXNlIHN0cmljdCc7XG4gIHRoaXMucmVtb3ZlKGtleSk7XG5cbiAgaWYgKHZhbHVlcy5sZW5ndGggPiAwKSB7XG4gICAgdGhpcy5pbnZhbGlkYXRlQ2FjaGVfKCk7XG4gICAgdGhpcy5rZXlNYXBfLnNldCh0aGlzLmdldEtleU5hbWVfKGtleSksIGdvb2cuYXJyYXkuY2xvbmUodmFsdWVzKSk7XG4gICAgdGhpcy5jb3VudF8gPSBnb29nLmFzc2VydHMuYXNzZXJ0TnVtYmVyKHRoaXMuY291bnRfKSArIHZhbHVlcy5sZW5ndGg7XG4gIH1cbn07XG5cblxuLyoqXG4gKiBAcmV0dXJuIHtzdHJpbmd9IEVuY29kZWQgcXVlcnkgc3RyaW5nLlxuICogQG92ZXJyaWRlXG4gKi9cbmdvb2cuVXJpLlF1ZXJ5RGF0YS5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBpZiAodGhpcy5lbmNvZGVkUXVlcnlfKSB7XG4gICAgcmV0dXJuIHRoaXMuZW5jb2RlZFF1ZXJ5XztcbiAgfVxuXG4gIGlmICghdGhpcy5rZXlNYXBfKSB7XG4gICAgcmV0dXJuICcnO1xuICB9XG5cbiAgdmFyIHNiID0gW107XG5cbiAgLy8gSW4gdGhlIHBhc3QsIHdlIHVzZSB0aGlzLmdldEtleXMoKSBhbmQgdGhpcy5nZXRWYWxzKCksIGJ1dCB0aGF0XG4gIC8vIGdlbmVyYXRlcyBhIGxvdCBvZiBhbGxvY2F0aW9ucyBhcyBjb21wYXJlZCB0byBzaW1wbHkgaXRlcmF0aW5nXG4gIC8vIG92ZXIgdGhlIGtleXMuXG4gIHZhciBrZXlzID0gdGhpcy5rZXlNYXBfLmdldEtleXMoKTtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBrZXlzLmxlbmd0aDsgaSsrKSB7XG4gICAgdmFyIGtleSA9IGtleXNbaV07XG4gICAgdmFyIGVuY29kZWRLZXkgPSBnb29nLnN0cmluZy51cmxFbmNvZGUoa2V5KTtcbiAgICB2YXIgdmFsID0gdGhpcy5nZXRWYWx1ZXMoa2V5KTtcbiAgICBmb3IgKHZhciBqID0gMDsgaiA8IHZhbC5sZW5ndGg7IGorKykge1xuICAgICAgdmFyIHBhcmFtID0gZW5jb2RlZEtleTtcbiAgICAgIC8vIEVuc3VyZSB0aGF0IG51bGwgYW5kIHVuZGVmaW5lZCBhcmUgZW5jb2RlZCBpbnRvIHRoZSB1cmwgYXNcbiAgICAgIC8vIGxpdGVyYWwgc3RyaW5ncy5cbiAgICAgIGlmICh2YWxbal0gIT09ICcnKSB7XG4gICAgICAgIHBhcmFtICs9ICc9JyArIGdvb2cuc3RyaW5nLnVybEVuY29kZSh2YWxbal0pO1xuICAgICAgfVxuICAgICAgc2IucHVzaChwYXJhbSk7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHRoaXMuZW5jb2RlZFF1ZXJ5XyA9IHNiLmpvaW4oJyYnKTtcbn07XG5cblxuLyoqXG4gKiBAdGhyb3dzIFVSSUVycm9yIElmIFVSSSBpcyBtYWxmb3JtZWQgKHRoYXQgaXMsIGlmIGRlY29kZVVSSUNvbXBvbmVudCBmYWlscyBvblxuICogICAgIGFueSBvZiB0aGUgVVJJIGNvbXBvbmVudHMpLlxuICogQHJldHVybiB7c3RyaW5nfSBEZWNvZGVkIHF1ZXJ5IHN0cmluZy5cbiAqL1xuZ29vZy5VcmkuUXVlcnlEYXRhLnByb3RvdHlwZS50b0RlY29kZWRTdHJpbmcgPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gZ29vZy5VcmkuZGVjb2RlT3JFbXB0eV8odGhpcy50b1N0cmluZygpKTtcbn07XG5cblxuLyoqXG4gKiBJbnZhbGlkYXRlIHRoZSBjYWNoZS5cbiAqIEBwcml2YXRlXG4gKi9cbmdvb2cuVXJpLlF1ZXJ5RGF0YS5wcm90b3R5cGUuaW52YWxpZGF0ZUNhY2hlXyA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIHRoaXMuZW5jb2RlZFF1ZXJ5XyA9IG51bGw7XG59O1xuXG5cbi8qKlxuICogUmVtb3ZlcyBhbGwga2V5cyB0aGF0IGFyZSBub3QgaW4gdGhlIHByb3ZpZGVkIGxpc3QuIChNb2RpZmllcyB0aGlzIG9iamVjdC4pXG4gKiBAcGFyYW0ge0FycmF5PHN0cmluZz59IGtleXMgVGhlIGRlc2lyZWQga2V5cy5cbiAqIEByZXR1cm4geyFnb29nLlVyaS5RdWVyeURhdGF9IGEgcmVmZXJlbmNlIHRvIHRoaXMgb2JqZWN0LlxuICovXG5nb29nLlVyaS5RdWVyeURhdGEucHJvdG90eXBlLmZpbHRlcktleXMgPSBmdW5jdGlvbihrZXlzKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgdGhpcy5lbnN1cmVLZXlNYXBJbml0aWFsaXplZF8oKTtcbiAgdGhpcy5rZXlNYXBfLmZvckVhY2goZnVuY3Rpb24odmFsdWUsIGtleSkge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICBpZiAoIWdvb2cuYXJyYXkuY29udGFpbnMoa2V5cywga2V5KSkge1xuICAgICAgdGhpcy5yZW1vdmUoa2V5KTtcbiAgICB9XG4gIH0sIHRoaXMpO1xuICByZXR1cm4gdGhpcztcbn07XG5cblxuLyoqXG4gKiBDbG9uZSB0aGUgcXVlcnkgZGF0YSBpbnN0YW5jZS5cbiAqIEByZXR1cm4geyFnb29nLlVyaS5RdWVyeURhdGF9IE5ldyBpbnN0YW5jZSBvZiB0aGUgUXVlcnlEYXRhIG9iamVjdC5cbiAqL1xuZ29vZy5VcmkuUXVlcnlEYXRhLnByb3RvdHlwZS5jbG9uZSA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIHZhciBydiA9IG5ldyBnb29nLlVyaS5RdWVyeURhdGEoKTtcbiAgcnYuZW5jb2RlZFF1ZXJ5XyA9IHRoaXMuZW5jb2RlZFF1ZXJ5XztcbiAgaWYgKHRoaXMua2V5TWFwXykge1xuICAgIHJ2LmtleU1hcF8gPSB0aGlzLmtleU1hcF8uY2xvbmUoKTtcbiAgICBydi5jb3VudF8gPSB0aGlzLmNvdW50XztcbiAgfVxuICByZXR1cm4gcnY7XG59O1xuXG5cbi8qKlxuICogSGVscGVyIGZ1bmN0aW9uIHRvIGdldCB0aGUga2V5IG5hbWUgZnJvbSBhIEphdmFTY3JpcHQgb2JqZWN0LiBDb252ZXJ0c1xuICogdGhlIG9iamVjdCB0byBhIHN0cmluZywgYW5kIHRvIGxvd2VyIGNhc2UgaWYgbmVjZXNzYXJ5LlxuICogQHByaXZhdGVcbiAqIEBwYXJhbSB7Kn0gYXJnIFRoZSBvYmplY3QgdG8gZ2V0IGEga2V5IG5hbWUgZnJvbS5cbiAqIEByZXR1cm4ge3N0cmluZ30gdmFsaWQga2V5IG5hbWUgd2hpY2ggY2FuIGJlIGxvb2tlZCB1cCBpbiAja2V5TWFwXy5cbiAqL1xuZ29vZy5VcmkuUXVlcnlEYXRhLnByb3RvdHlwZS5nZXRLZXlOYW1lXyA9IGZ1bmN0aW9uKGFyZykge1xuICAndXNlIHN0cmljdCc7XG4gIHZhciBrZXlOYW1lID0gU3RyaW5nKGFyZyk7XG4gIGlmICh0aGlzLmlnbm9yZUNhc2VfKSB7XG4gICAga2V5TmFtZSA9IGtleU5hbWUudG9Mb3dlckNhc2UoKTtcbiAgfVxuICByZXR1cm4ga2V5TmFtZTtcbn07XG5cblxuLyoqXG4gKiBJZ25vcmUgY2FzZSBpbiBwYXJhbWV0ZXIgbmFtZXMuXG4gKiBOT1RFOiBJZiB0aGVyZSBhcmUgYWxyZWFkeSBrZXkvdmFsdWUgcGFpcnMgaW4gdGhlIFF1ZXJ5RGF0YSwgYW5kXG4gKiBpZ25vcmVDYXNlXyBpcyBzZXQgdG8gZmFsc2UsIHRoZSBrZXlzIHdpbGwgYWxsIGJlIGxvd2VyLWNhc2VkLlxuICogQHBhcmFtIHtib29sZWFufSBpZ25vcmVDYXNlIHdoZXRoZXIgdGhpcyBnb29nLlVyaSBzaG91bGQgaWdub3JlIGNhc2UuXG4gKi9cbmdvb2cuVXJpLlF1ZXJ5RGF0YS5wcm90b3R5cGUuc2V0SWdub3JlQ2FzZSA9IGZ1bmN0aW9uKGlnbm9yZUNhc2UpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICB2YXIgcmVzZXRLZXlzID0gaWdub3JlQ2FzZSAmJiAhdGhpcy5pZ25vcmVDYXNlXztcbiAgaWYgKHJlc2V0S2V5cykge1xuICAgIHRoaXMuZW5zdXJlS2V5TWFwSW5pdGlhbGl6ZWRfKCk7XG4gICAgdGhpcy5pbnZhbGlkYXRlQ2FjaGVfKCk7XG4gICAgdGhpcy5rZXlNYXBfLmZvckVhY2goZnVuY3Rpb24odmFsdWUsIGtleSkge1xuICAgICAgJ3VzZSBzdHJpY3QnO1xuICAgICAgdmFyIGxvd2VyQ2FzZSA9IGtleS50b0xvd2VyQ2FzZSgpO1xuICAgICAgaWYgKGtleSAhPSBsb3dlckNhc2UpIHtcbiAgICAgICAgdGhpcy5yZW1vdmUoa2V5KTtcbiAgICAgICAgdGhpcy5zZXRWYWx1ZXMobG93ZXJDYXNlLCB2YWx1ZSk7XG4gICAgICB9XG4gICAgfSwgdGhpcyk7XG4gIH1cbiAgdGhpcy5pZ25vcmVDYXNlXyA9IGlnbm9yZUNhc2U7XG59O1xuXG5cbi8qKlxuICogRXh0ZW5kcyBhIHF1ZXJ5IGRhdGEgb2JqZWN0IHdpdGggYW5vdGhlciBxdWVyeSBkYXRhIG9yIG1hcCBsaWtlIG9iamVjdC4gVGhpc1xuICogb3BlcmF0ZXMgJ2luLXBsYWNlJywgaXQgZG9lcyBub3QgY3JlYXRlIGEgbmV3IFF1ZXJ5RGF0YSBvYmplY3QuXG4gKlxuICogQHBhcmFtIHsuLi4oP2dvb2cuVXJpLlF1ZXJ5RGF0YXw/Z29vZy5zdHJ1Y3RzLk1hcDw/LCA/Pnw/T2JqZWN0KX0gdmFyX2FyZ3NcbiAqICAgICBUaGUgb2JqZWN0IGZyb20gd2hpY2gga2V5IHZhbHVlIHBhaXJzIHdpbGwgYmUgY29waWVkLiBOb3RlOiBkb2VzIG5vdFxuICogICAgIGFjY2VwdCBudWxsLlxuICogQHN1cHByZXNzIHtkZXByZWNhdGVkfSBVc2UgZGVwcmVjYXRlZCBnb29nLnN0cnVjdHMuZm9yRWFjaCB0byBhbGxvdyBkaWZmZXJlbnRcbiAqIHR5cGVzIG9mIHBhcmFtZXRlcnMuXG4gKi9cbmdvb2cuVXJpLlF1ZXJ5RGF0YS5wcm90b3R5cGUuZXh0ZW5kID0gZnVuY3Rpb24odmFyX2FyZ3MpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykge1xuICAgIHZhciBkYXRhID0gYXJndW1lbnRzW2ldO1xuICAgIGdvb2cuc3RydWN0cy5mb3JFYWNoKGRhdGEsIGZ1bmN0aW9uKHZhbHVlLCBrZXkpIHtcbiAgICAgICd1c2Ugc3RyaWN0JztcbiAgICAgIHRoaXMuYWRkKGtleSwgdmFsdWUpO1xuICAgIH0sIHRoaXMpO1xuICB9XG59O1xuIiwgIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCBUaGUgQ2xvc3VyZSBMaWJyYXJ5IEF1dGhvcnMuXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogQGZpbGVvdmVydmlldyBVdGlsaXRpZXMgZm9yIHN0cmluZyBtYW5pcHVsYXRpb24uXG4gKi9cblxuXG4vKipcbiAqIE5hbWVzcGFjZSBmb3Igc3RyaW5nIHV0aWxpdGllc1xuICovXG5nb29nLnByb3ZpZGUoJ2dvb2cuc3RyaW5nJyk7XG5nb29nLnByb3ZpZGUoJ2dvb2cuc3RyaW5nLlVuaWNvZGUnKTtcblxuZ29vZy5yZXF1aXJlKCdnb29nLmRvbS5zYWZlJyk7XG5nb29nLnJlcXVpcmUoJ2dvb2cuaHRtbC51bmNoZWNrZWRjb252ZXJzaW9ucycpO1xuZ29vZy5yZXF1aXJlKCdnb29nLnN0cmluZy5Db25zdCcpO1xuZ29vZy5yZXF1aXJlKCdnb29nLnN0cmluZy5pbnRlcm5hbCcpO1xuXG5cbi8qKlxuICogQGRlZmluZSB7Ym9vbGVhbn0gRW5hYmxlcyBIVE1MIGVzY2FwaW5nIG9mIGxvd2VyY2FzZSBsZXR0ZXIgXCJlXCIgd2hpY2ggaGVscHNcbiAqIHdpdGggZGV0ZWN0aW9uIG9mIGRvdWJsZS1lc2NhcGluZyBhcyB0aGlzIGxldHRlciBpcyBmcmVxdWVudGx5IHVzZWQuXG4gKi9cbmdvb2cuc3RyaW5nLkRFVEVDVF9ET1VCTEVfRVNDQVBJTkcgPVxuICAgIGdvb2cuZGVmaW5lKCdnb29nLnN0cmluZy5ERVRFQ1RfRE9VQkxFX0VTQ0FQSU5HJywgZmFsc2UpO1xuXG5cbi8qKlxuICogQGRlZmluZSB7Ym9vbGVhbn0gV2hldGhlciB0byBmb3JjZSBub24tZG9tIGh0bWwgdW5lc2NhcGluZy5cbiAqL1xuZ29vZy5zdHJpbmcuRk9SQ0VfTk9OX0RPTV9IVE1MX1VORVNDQVBJTkcgPVxuICAgIGdvb2cuZGVmaW5lKCdnb29nLnN0cmluZy5GT1JDRV9OT05fRE9NX0hUTUxfVU5FU0NBUElORycsIGZhbHNlKTtcblxuXG4vKipcbiAqIENvbW1vbiBVbmljb2RlIHN0cmluZyBjaGFyYWN0ZXJzLlxuICogQGVudW0ge3N0cmluZ31cbiAqL1xuZ29vZy5zdHJpbmcuVW5pY29kZSA9IHtcbiAgTkJTUDogJ1xceGEwJ1xufTtcblxuXG4vKipcbiAqIEZhc3QgcHJlZml4LWNoZWNrZXIuXG4gKiBAcGFyYW0ge3N0cmluZ30gc3RyIFRoZSBzdHJpbmcgdG8gY2hlY2suXG4gKiBAcGFyYW0ge3N0cmluZ30gcHJlZml4IEEgc3RyaW5nIHRvIGxvb2sgZm9yIGF0IHRoZSBzdGFydCBvZiBgc3RyYC5cbiAqIEByZXR1cm4ge2Jvb2xlYW59IFRydWUgaWYgYHN0cmAgYmVnaW5zIHdpdGggYHByZWZpeGAuXG4gKi9cbmdvb2cuc3RyaW5nLnN0YXJ0c1dpdGggPSBnb29nLnN0cmluZy5pbnRlcm5hbC5zdGFydHNXaXRoO1xuXG5cbi8qKlxuICogRmFzdCBzdWZmaXgtY2hlY2tlci5cbiAqIEBwYXJhbSB7c3RyaW5nfSBzdHIgVGhlIHN0cmluZyB0byBjaGVjay5cbiAqIEBwYXJhbSB7c3RyaW5nfSBzdWZmaXggQSBzdHJpbmcgdG8gbG9vayBmb3IgYXQgdGhlIGVuZCBvZiBgc3RyYC5cbiAqIEByZXR1cm4ge2Jvb2xlYW59IFRydWUgaWYgYHN0cmAgZW5kcyB3aXRoIGBzdWZmaXhgLlxuICovXG5nb29nLnN0cmluZy5lbmRzV2l0aCA9IGdvb2cuc3RyaW5nLmludGVybmFsLmVuZHNXaXRoO1xuXG5cbi8qKlxuICogQ2FzZS1pbnNlbnNpdGl2ZSBwcmVmaXgtY2hlY2tlci5cbiAqIEBwYXJhbSB7c3RyaW5nfSBzdHIgVGhlIHN0cmluZyB0byBjaGVjay5cbiAqIEBwYXJhbSB7c3RyaW5nfSBwcmVmaXggIEEgc3RyaW5nIHRvIGxvb2sgZm9yIGF0IHRoZSBlbmQgb2YgYHN0cmAuXG4gKiBAcmV0dXJuIHtib29sZWFufSBUcnVlIGlmIGBzdHJgIGJlZ2lucyB3aXRoIGBwcmVmaXhgIChpZ25vcmluZ1xuICogICAgIGNhc2UpLlxuICovXG5nb29nLnN0cmluZy5jYXNlSW5zZW5zaXRpdmVTdGFydHNXaXRoID1cbiAgICBnb29nLnN0cmluZy5pbnRlcm5hbC5jYXNlSW5zZW5zaXRpdmVTdGFydHNXaXRoO1xuXG5cbi8qKlxuICogQ2FzZS1pbnNlbnNpdGl2ZSBzdWZmaXgtY2hlY2tlci5cbiAqIEBwYXJhbSB7c3RyaW5nfSBzdHIgVGhlIHN0cmluZyB0byBjaGVjay5cbiAqIEBwYXJhbSB7c3RyaW5nfSBzdWZmaXggQSBzdHJpbmcgdG8gbG9vayBmb3IgYXQgdGhlIGVuZCBvZiBgc3RyYC5cbiAqIEByZXR1cm4ge2Jvb2xlYW59IFRydWUgaWYgYHN0cmAgZW5kcyB3aXRoIGBzdWZmaXhgIChpZ25vcmluZ1xuICogICAgIGNhc2UpLlxuICovXG5nb29nLnN0cmluZy5jYXNlSW5zZW5zaXRpdmVFbmRzV2l0aCA9XG4gICAgZ29vZy5zdHJpbmcuaW50ZXJuYWwuY2FzZUluc2Vuc2l0aXZlRW5kc1dpdGg7XG5cblxuLyoqXG4gKiBDYXNlLWluc2Vuc2l0aXZlIGVxdWFsaXR5IGNoZWNrZXIuXG4gKiBAcGFyYW0ge3N0cmluZ30gc3RyMSBGaXJzdCBzdHJpbmcgdG8gY2hlY2suXG4gKiBAcGFyYW0ge3N0cmluZ30gc3RyMiBTZWNvbmQgc3RyaW5nIHRvIGNoZWNrLlxuICogQHJldHVybiB7Ym9vbGVhbn0gVHJ1ZSBpZiBgc3RyMWAgYW5kIGBzdHIyYCBhcmUgdGhlIHNhbWUgc3RyaW5nLFxuICogICAgIGlnbm9yaW5nIGNhc2UuXG4gKi9cbmdvb2cuc3RyaW5nLmNhc2VJbnNlbnNpdGl2ZUVxdWFscyA9IGdvb2cuc3RyaW5nLmludGVybmFsLmNhc2VJbnNlbnNpdGl2ZUVxdWFscztcblxuXG4vKipcbiAqIERvZXMgc2ltcGxlIHB5dGhvbi1zdHlsZSBzdHJpbmcgc3Vic3RpdHV0aW9uLlxuICogc3VicyhcImZvbyVzIGhvdCVzXCIsIFwiYmFyXCIsIFwiZG9nXCIpIGJlY29tZXMgXCJmb29iYXIgaG90ZG9nXCIuXG4gKiBAcGFyYW0ge3N0cmluZ30gc3RyIFRoZSBzdHJpbmcgY29udGFpbmluZyB0aGUgcGF0dGVybi5cbiAqIEBwYXJhbSB7Li4uKn0gdmFyX2FyZ3MgVGhlIGl0ZW1zIHRvIHN1YnN0aXR1dGUgaW50byB0aGUgcGF0dGVybi5cbiAqIEByZXR1cm4ge3N0cmluZ30gQSBjb3B5IG9mIGBzdHJgIGluIHdoaWNoIGVhY2ggb2NjdXJyZW5jZSBvZlxuICogICAgIHtAY29kZSAlc30gaGFzIGJlZW4gcmVwbGFjZWQgYW4gYXJndW1lbnQgZnJvbSBgdmFyX2FyZ3NgLlxuICovXG5nb29nLnN0cmluZy5zdWJzID0gZnVuY3Rpb24oc3RyLCB2YXJfYXJncykge1xuICAndXNlIHN0cmljdCc7XG4gIGNvbnN0IHNwbGl0UGFydHMgPSBzdHIuc3BsaXQoJyVzJyk7XG4gIGxldCByZXR1cm5TdHJpbmcgPSAnJztcblxuICBjb25zdCBzdWJzQXJndW1lbnRzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTtcbiAgd2hpbGUgKHN1YnNBcmd1bWVudHMubGVuZ3RoICYmXG4gICAgICAgICAvLyBSZXBsYWNlIHVwIHRvIHRoZSBsYXN0IHNwbGl0IHBhcnQuIFdlIGFyZSBpbnNlcnRpbmcgaW4gdGhlXG4gICAgICAgICAvLyBwb3NpdGlvbnMgYmV0d2VlbiBzcGxpdCBwYXJ0cy5cbiAgICAgICAgIHNwbGl0UGFydHMubGVuZ3RoID4gMSkge1xuICAgIHJldHVyblN0cmluZyArPSBzcGxpdFBhcnRzLnNoaWZ0KCkgKyBzdWJzQXJndW1lbnRzLnNoaWZ0KCk7XG4gIH1cblxuICByZXR1cm4gcmV0dXJuU3RyaW5nICsgc3BsaXRQYXJ0cy5qb2luKCclcycpOyAgLy8gSm9pbiB1bnVzZWQgJyVzJ1xufTtcblxuXG4vKipcbiAqIENvbnZlcnRzIG11bHRpcGxlIHdoaXRlc3BhY2UgY2hhcnMgKHNwYWNlcywgbm9uLWJyZWFraW5nLXNwYWNlcywgbmV3IGxpbmVzXG4gKiBhbmQgdGFicykgdG8gYSBzaW5nbGUgc3BhY2UsIGFuZCBzdHJpcHMgbGVhZGluZyBhbmQgdHJhaWxpbmcgd2hpdGVzcGFjZS5cbiAqIEBwYXJhbSB7c3RyaW5nfSBzdHIgSW5wdXQgc3RyaW5nLlxuICogQHJldHVybiB7c3RyaW5nfSBBIGNvcHkgb2YgYHN0cmAgd2l0aCBjb2xsYXBzZWQgd2hpdGVzcGFjZS5cbiAqL1xuZ29vZy5zdHJpbmcuY29sbGFwc2VXaGl0ZXNwYWNlID0gZnVuY3Rpb24oc3RyKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgLy8gU2luY2UgSUUgZG9lc24ndCBpbmNsdWRlIG5vbi1icmVha2luZy1zcGFjZSAoMHhhMCkgaW4gdGhlaXIgXFxzIGNoYXJhY3RlclxuICAvLyBjbGFzcyAoYXMgcmVxdWlyZWQgYnkgc2VjdGlvbiA3LjIgb2YgdGhlIEVDTUFTY3JpcHQgc3BlYyksIHdlIGV4cGxpY2l0bHlcbiAgLy8gaW5jbHVkZSBpdCBpbiB0aGUgcmVnZXhwIHRvIGVuZm9yY2UgY29uc2lzdGVudCBjcm9zcy1icm93c2VyIGJlaGF2aW9yLlxuICByZXR1cm4gc3RyLnJlcGxhY2UoL1tcXHNcXHhhMF0rL2csICcgJykucmVwbGFjZSgvXlxccyt8XFxzKyQvZywgJycpO1xufTtcblxuXG4vKipcbiAqIENoZWNrcyBpZiBhIHN0cmluZyBpcyBlbXB0eSBvciBjb250YWlucyBvbmx5IHdoaXRlc3BhY2VzLlxuICogQHBhcmFtIHtzdHJpbmd9IHN0ciBUaGUgc3RyaW5nIHRvIGNoZWNrLlxuICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciBgc3RyYCBpcyBlbXB0eSBvciB3aGl0ZXNwYWNlIG9ubHkuXG4gKi9cbmdvb2cuc3RyaW5nLmlzRW1wdHlPcldoaXRlc3BhY2UgPSBnb29nLnN0cmluZy5pbnRlcm5hbC5pc0VtcHR5T3JXaGl0ZXNwYWNlO1xuXG5cbi8qKlxuICogQ2hlY2tzIGlmIGEgc3RyaW5nIGlzIGVtcHR5LlxuICogQHBhcmFtIHtzdHJpbmd9IHN0ciBUaGUgc3RyaW5nIHRvIGNoZWNrLlxuICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciBgc3RyYCBpcyBlbXB0eS5cbiAqL1xuZ29vZy5zdHJpbmcuaXNFbXB0eVN0cmluZyA9IGZ1bmN0aW9uKHN0cikge1xuICAndXNlIHN0cmljdCc7XG4gIHJldHVybiBzdHIubGVuZ3RoID09IDA7XG59O1xuXG5cbi8qKlxuICogQ2hlY2tzIGlmIGEgc3RyaW5nIGlzIGVtcHR5IG9yIGNvbnRhaW5zIG9ubHkgd2hpdGVzcGFjZXMuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHN0ciBUaGUgc3RyaW5nIHRvIGNoZWNrLlxuICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciBgc3RyYCBpcyBlbXB0eSBvciB3aGl0ZXNwYWNlIG9ubHkuXG4gKiBAZGVwcmVjYXRlZCBVc2UgZ29vZy5zdHJpbmcuaXNFbXB0eU9yV2hpdGVzcGFjZSBpbnN0ZWFkLlxuICovXG5nb29nLnN0cmluZy5pc0VtcHR5ID0gZ29vZy5zdHJpbmcuaXNFbXB0eU9yV2hpdGVzcGFjZTtcblxuXG4vKipcbiAqIENoZWNrcyBpZiBhIHN0cmluZyBpcyBudWxsLCB1bmRlZmluZWQsIGVtcHR5IG9yIGNvbnRhaW5zIG9ubHkgd2hpdGVzcGFjZXMuXG4gKiBAcGFyYW0geyp9IHN0ciBUaGUgc3RyaW5nIHRvIGNoZWNrLlxuICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciBgc3RyYCBpcyBudWxsLCB1bmRlZmluZWQsIGVtcHR5LCBvclxuICogICAgIHdoaXRlc3BhY2Ugb25seS5cbiAqIEBkZXByZWNhdGVkIFVzZSBnb29nLnN0cmluZy5pc0VtcHR5T3JXaGl0ZXNwYWNlKGdvb2cuc3RyaW5nLm1ha2VTYWZlKHN0cikpXG4gKiAgICAgaW5zdGVhZC5cbiAqL1xuZ29vZy5zdHJpbmcuaXNFbXB0eU9yV2hpdGVzcGFjZVNhZmUgPSBmdW5jdGlvbihzdHIpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gZ29vZy5zdHJpbmcuaXNFbXB0eU9yV2hpdGVzcGFjZShnb29nLnN0cmluZy5tYWtlU2FmZShzdHIpKTtcbn07XG5cblxuLyoqXG4gKiBDaGVja3MgaWYgYSBzdHJpbmcgaXMgbnVsbCwgdW5kZWZpbmVkLCBlbXB0eSBvciBjb250YWlucyBvbmx5IHdoaXRlc3BhY2VzLlxuICpcbiAqIEBwYXJhbSB7Kn0gc3RyIFRoZSBzdHJpbmcgdG8gY2hlY2suXG4gKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIGBzdHJgIGlzIG51bGwsIHVuZGVmaW5lZCwgZW1wdHksIG9yXG4gKiAgICAgd2hpdGVzcGFjZSBvbmx5LlxuICogQGRlcHJlY2F0ZWQgVXNlIGdvb2cuc3RyaW5nLmlzRW1wdHlPcldoaXRlc3BhY2UgaW5zdGVhZC5cbiAqL1xuZ29vZy5zdHJpbmcuaXNFbXB0eVNhZmUgPSBnb29nLnN0cmluZy5pc0VtcHR5T3JXaGl0ZXNwYWNlU2FmZTtcblxuXG4vKipcbiAqIENoZWNrcyBpZiBhIHN0cmluZyBpcyBhbGwgYnJlYWtpbmcgd2hpdGVzcGFjZS5cbiAqIEBwYXJhbSB7c3RyaW5nfSBzdHIgVGhlIHN0cmluZyB0byBjaGVjay5cbiAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgdGhlIHN0cmluZyBpcyBhbGwgYnJlYWtpbmcgd2hpdGVzcGFjZS5cbiAqL1xuZ29vZy5zdHJpbmcuaXNCcmVha2luZ1doaXRlc3BhY2UgPSBmdW5jdGlvbihzdHIpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gIS9bXlxcdFxcblxcciBdLy50ZXN0KHN0cik7XG59O1xuXG5cbi8qKlxuICogQ2hlY2tzIGlmIGEgc3RyaW5nIGNvbnRhaW5zIGFsbCBsZXR0ZXJzLlxuICogQHBhcmFtIHtzdHJpbmd9IHN0ciBzdHJpbmcgdG8gY2hlY2suXG4gKiBAcmV0dXJuIHtib29sZWFufSBUcnVlIGlmIGBzdHJgIGNvbnNpc3RzIGVudGlyZWx5IG9mIGxldHRlcnMuXG4gKi9cbmdvb2cuc3RyaW5nLmlzQWxwaGEgPSBmdW5jdGlvbihzdHIpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gIS9bXmEtekEtWl0vLnRlc3Qoc3RyKTtcbn07XG5cblxuLyoqXG4gKiBDaGVja3MgaWYgYSBzdHJpbmcgY29udGFpbnMgb25seSBudW1iZXJzLlxuICogQHBhcmFtIHsqfSBzdHIgc3RyaW5nIHRvIGNoZWNrLiBJZiBub3QgYSBzdHJpbmcsIGl0IHdpbGwgYmVcbiAqICAgICBjYXN0ZWQgdG8gb25lLlxuICogQHJldHVybiB7Ym9vbGVhbn0gVHJ1ZSBpZiBgc3RyYCBpcyBudW1lcmljLlxuICovXG5nb29nLnN0cmluZy5pc051bWVyaWMgPSBmdW5jdGlvbihzdHIpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gIS9bXjAtOV0vLnRlc3Qoc3RyKTtcbn07XG5cblxuLyoqXG4gKiBDaGVja3MgaWYgYSBzdHJpbmcgY29udGFpbnMgb25seSBudW1iZXJzIG9yIGxldHRlcnMuXG4gKiBAcGFyYW0ge3N0cmluZ30gc3RyIHN0cmluZyB0byBjaGVjay5cbiAqIEByZXR1cm4ge2Jvb2xlYW59IFRydWUgaWYgYHN0cmAgaXMgYWxwaGFudW1lcmljLlxuICovXG5nb29nLnN0cmluZy5pc0FscGhhTnVtZXJpYyA9IGZ1bmN0aW9uKHN0cikge1xuICAndXNlIHN0cmljdCc7XG4gIHJldHVybiAhL1teYS16QS1aMC05XS8udGVzdChzdHIpO1xufTtcblxuXG4vKipcbiAqIENoZWNrcyBpZiBhIGNoYXJhY3RlciBpcyBhIHNwYWNlIGNoYXJhY3Rlci5cbiAqIEBwYXJhbSB7c3RyaW5nfSBjaCBDaGFyYWN0ZXIgdG8gY2hlY2suXG4gKiBAcmV0dXJuIHtib29sZWFufSBUcnVlIGlmIGBjaGAgaXMgYSBzcGFjZS5cbiAqL1xuZ29vZy5zdHJpbmcuaXNTcGFjZSA9IGZ1bmN0aW9uKGNoKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmV0dXJuIGNoID09ICcgJztcbn07XG5cblxuLyoqXG4gKiBDaGVja3MgaWYgYSBjaGFyYWN0ZXIgaXMgYSB2YWxpZCB1bmljb2RlIGNoYXJhY3Rlci5cbiAqIEBwYXJhbSB7c3RyaW5nfSBjaCBDaGFyYWN0ZXIgdG8gY2hlY2suXG4gKiBAcmV0dXJuIHtib29sZWFufSBUcnVlIGlmIGBjaGAgaXMgYSB2YWxpZCB1bmljb2RlIGNoYXJhY3Rlci5cbiAqL1xuZ29vZy5zdHJpbmcuaXNVbmljb2RlQ2hhciA9IGZ1bmN0aW9uKGNoKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmV0dXJuIGNoLmxlbmd0aCA9PSAxICYmIGNoID49ICcgJyAmJiBjaCA8PSAnficgfHxcbiAgICAgIGNoID49ICdcXHUwMDgwJyAmJiBjaCA8PSAnXFx1RkZGRCc7XG59O1xuXG5cbi8qKlxuICogVGFrZXMgYSBzdHJpbmcgYW5kIHJlcGxhY2VzIG5ld2xpbmVzIHdpdGggYSBzcGFjZS4gTXVsdGlwbGUgbGluZXMgYXJlXG4gKiByZXBsYWNlZCB3aXRoIGEgc2luZ2xlIHNwYWNlLlxuICogQHBhcmFtIHtzdHJpbmd9IHN0ciBUaGUgc3RyaW5nIGZyb20gd2hpY2ggdG8gc3RyaXAgbmV3bGluZXMuXG4gKiBAcmV0dXJuIHtzdHJpbmd9IEEgY29weSBvZiBgc3RyYCBzdHJpcHBlZCBvZiBuZXdsaW5lcy5cbiAqL1xuZ29vZy5zdHJpbmcuc3RyaXBOZXdsaW5lcyA9IGZ1bmN0aW9uKHN0cikge1xuICAndXNlIHN0cmljdCc7XG4gIHJldHVybiBzdHIucmVwbGFjZSgvKFxcclxcbnxcXHJ8XFxuKSsvZywgJyAnKTtcbn07XG5cblxuLyoqXG4gKiBSZXBsYWNlcyBXaW5kb3dzIGFuZCBNYWMgbmV3IGxpbmVzIHdpdGggdW5peCBzdHlsZTogXFxyIG9yIFxcclxcbiB3aXRoIFxcbi5cbiAqIEBwYXJhbSB7c3RyaW5nfSBzdHIgVGhlIHN0cmluZyB0byBpbiB3aGljaCB0byBjYW5vbmljYWxpemUgbmV3bGluZXMuXG4gKiBAcmV0dXJuIHtzdHJpbmd9IGBzdHJgIEEgY29weSBvZiB7QGNvZGV9IHdpdGggY2Fub25pY2FsaXplZCBuZXdsaW5lcy5cbiAqL1xuZ29vZy5zdHJpbmcuY2Fub25pY2FsaXplTmV3bGluZXMgPSBmdW5jdGlvbihzdHIpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gc3RyLnJlcGxhY2UoLyhcXHJcXG58XFxyfFxcbikvZywgJ1xcbicpO1xufTtcblxuXG4vKipcbiAqIE5vcm1hbGl6ZXMgd2hpdGVzcGFjZSBpbiBhIHN0cmluZywgcmVwbGFjaW5nIGFsbCB3aGl0ZXNwYWNlIGNoYXJzIHdpdGhcbiAqIGEgc3BhY2UuXG4gKiBAcGFyYW0ge3N0cmluZ30gc3RyIFRoZSBzdHJpbmcgaW4gd2hpY2ggdG8gbm9ybWFsaXplIHdoaXRlc3BhY2UuXG4gKiBAcmV0dXJuIHtzdHJpbmd9IEEgY29weSBvZiBgc3RyYCB3aXRoIGFsbCB3aGl0ZXNwYWNlIG5vcm1hbGl6ZWQuXG4gKi9cbmdvb2cuc3RyaW5nLm5vcm1hbGl6ZVdoaXRlc3BhY2UgPSBmdW5jdGlvbihzdHIpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gc3RyLnJlcGxhY2UoL1xceGEwfFxccy9nLCAnICcpO1xufTtcblxuXG4vKipcbiAqIE5vcm1hbGl6ZXMgc3BhY2VzIGluIGEgc3RyaW5nLCByZXBsYWNpbmcgYWxsIGNvbnNlY3V0aXZlIHNwYWNlcyBhbmQgdGFic1xuICogd2l0aCBhIHNpbmdsZSBzcGFjZS4gUmVwbGFjZXMgbm9uLWJyZWFraW5nIHNwYWNlIHdpdGggYSBzcGFjZS5cbiAqIEBwYXJhbSB7c3RyaW5nfSBzdHIgVGhlIHN0cmluZyBpbiB3aGljaCB0byBub3JtYWxpemUgc3BhY2VzLlxuICogQHJldHVybiB7c3RyaW5nfSBBIGNvcHkgb2YgYHN0cmAgd2l0aCBhbGwgY29uc2VjdXRpdmUgc3BhY2VzIGFuZCB0YWJzXG4gKiAgICByZXBsYWNlZCB3aXRoIGEgc2luZ2xlIHNwYWNlLlxuICovXG5nb29nLnN0cmluZy5ub3JtYWxpemVTcGFjZXMgPSBmdW5jdGlvbihzdHIpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gc3RyLnJlcGxhY2UoL1xceGEwfFsgXFx0XSsvZywgJyAnKTtcbn07XG5cblxuLyoqXG4gKiBSZW1vdmVzIHRoZSBicmVha2luZyBzcGFjZXMgZnJvbSB0aGUgbGVmdCBhbmQgcmlnaHQgb2YgdGhlIHN0cmluZyBhbmRcbiAqIGNvbGxhcHNlcyB0aGUgc2VxdWVuY2VzIG9mIGJyZWFraW5nIHNwYWNlcyBpbiB0aGUgbWlkZGxlIGludG8gc2luZ2xlIHNwYWNlcy5cbiAqIFRoZSBvcmlnaW5hbCBhbmQgdGhlIHJlc3VsdCBzdHJpbmdzIHJlbmRlciB0aGUgc2FtZSB3YXkgaW4gSFRNTC5cbiAqIEBwYXJhbSB7c3RyaW5nfSBzdHIgQSBzdHJpbmcgaW4gd2hpY2ggdG8gY29sbGFwc2Ugc3BhY2VzLlxuICogQHJldHVybiB7c3RyaW5nfSBDb3B5IG9mIHRoZSBzdHJpbmcgd2l0aCBub3JtYWxpemVkIGJyZWFraW5nIHNwYWNlcy5cbiAqL1xuZ29vZy5zdHJpbmcuY29sbGFwc2VCcmVha2luZ1NwYWNlcyA9IGZ1bmN0aW9uKHN0cikge1xuICAndXNlIHN0cmljdCc7XG4gIHJldHVybiBzdHIucmVwbGFjZSgvW1xcdFxcclxcbiBdKy9nLCAnICcpXG4gICAgICAucmVwbGFjZSgvXltcXHRcXHJcXG4gXSt8W1xcdFxcclxcbiBdKyQvZywgJycpO1xufTtcblxuXG4vKipcbiAqIFRyaW1zIHdoaXRlIHNwYWNlcyB0byB0aGUgbGVmdCBhbmQgcmlnaHQgb2YgYSBzdHJpbmcuXG4gKiBAcGFyYW0ge3N0cmluZ30gc3RyIFRoZSBzdHJpbmcgdG8gdHJpbS5cbiAqIEByZXR1cm4ge3N0cmluZ30gQSB0cmltbWVkIGNvcHkgb2YgYHN0cmAuXG4gKi9cbmdvb2cuc3RyaW5nLnRyaW0gPSBnb29nLnN0cmluZy5pbnRlcm5hbC50cmltO1xuXG5cbi8qKlxuICogVHJpbXMgd2hpdGVzcGFjZXMgYXQgdGhlIGxlZnQgZW5kIG9mIGEgc3RyaW5nLlxuICogQHBhcmFtIHtzdHJpbmd9IHN0ciBUaGUgc3RyaW5nIHRvIGxlZnQgdHJpbS5cbiAqIEByZXR1cm4ge3N0cmluZ30gQSB0cmltbWVkIGNvcHkgb2YgYHN0cmAuXG4gKi9cbmdvb2cuc3RyaW5nLnRyaW1MZWZ0ID0gZnVuY3Rpb24oc3RyKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgLy8gU2luY2UgSUUgZG9lc24ndCBpbmNsdWRlIG5vbi1icmVha2luZy1zcGFjZSAoMHhhMCkgaW4gdGhlaXIgXFxzIGNoYXJhY3RlclxuICAvLyBjbGFzcyAoYXMgcmVxdWlyZWQgYnkgc2VjdGlvbiA3LjIgb2YgdGhlIEVDTUFTY3JpcHQgc3BlYyksIHdlIGV4cGxpY2l0bHlcbiAgLy8gaW5jbHVkZSBpdCBpbiB0aGUgcmVnZXhwIHRvIGVuZm9yY2UgY29uc2lzdGVudCBjcm9zcy1icm93c2VyIGJlaGF2aW9yLlxuICByZXR1cm4gc3RyLnJlcGxhY2UoL15bXFxzXFx4YTBdKy8sICcnKTtcbn07XG5cblxuLyoqXG4gKiBUcmltcyB3aGl0ZXNwYWNlcyBhdCB0aGUgcmlnaHQgZW5kIG9mIGEgc3RyaW5nLlxuICogQHBhcmFtIHtzdHJpbmd9IHN0ciBUaGUgc3RyaW5nIHRvIHJpZ2h0IHRyaW0uXG4gKiBAcmV0dXJuIHtzdHJpbmd9IEEgdHJpbW1lZCBjb3B5IG9mIGBzdHJgLlxuICovXG5nb29nLnN0cmluZy50cmltUmlnaHQgPSBmdW5jdGlvbihzdHIpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICAvLyBTaW5jZSBJRSBkb2Vzbid0IGluY2x1ZGUgbm9uLWJyZWFraW5nLXNwYWNlICgweGEwKSBpbiB0aGVpciBcXHMgY2hhcmFjdGVyXG4gIC8vIGNsYXNzIChhcyByZXF1aXJlZCBieSBzZWN0aW9uIDcuMiBvZiB0aGUgRUNNQVNjcmlwdCBzcGVjKSwgd2UgZXhwbGljaXRseVxuICAvLyBpbmNsdWRlIGl0IGluIHRoZSByZWdleHAgdG8gZW5mb3JjZSBjb25zaXN0ZW50IGNyb3NzLWJyb3dzZXIgYmVoYXZpb3IuXG4gIHJldHVybiBzdHIucmVwbGFjZSgvW1xcc1xceGEwXSskLywgJycpO1xufTtcblxuXG4vKipcbiAqIEEgc3RyaW5nIGNvbXBhcmF0b3IgdGhhdCBpZ25vcmVzIGNhc2UuXG4gKiAtMSA9IHN0cjEgbGVzcyB0aGFuIHN0cjJcbiAqICAwID0gc3RyMSBlcXVhbHMgc3RyMlxuICogIDEgPSBzdHIxIGdyZWF0ZXIgdGhhbiBzdHIyXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHN0cjEgVGhlIHN0cmluZyB0byBjb21wYXJlLlxuICogQHBhcmFtIHtzdHJpbmd9IHN0cjIgVGhlIHN0cmluZyB0byBjb21wYXJlIGBzdHIxYCB0by5cbiAqIEByZXR1cm4ge251bWJlcn0gVGhlIGNvbXBhcmF0b3IgcmVzdWx0LCBhcyBkZXNjcmliZWQgYWJvdmUuXG4gKi9cbmdvb2cuc3RyaW5nLmNhc2VJbnNlbnNpdGl2ZUNvbXBhcmUgPVxuICAgIGdvb2cuc3RyaW5nLmludGVybmFsLmNhc2VJbnNlbnNpdGl2ZUNvbXBhcmU7XG5cblxuLyoqXG4gKiBDb21wYXJlcyB0d28gc3RyaW5ncyBpbnRlcnByZXRpbmcgdGhlaXIgbnVtZXJpYyBzdWJzdHJpbmdzIGFzIG51bWJlcnMuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHN0cjEgRmlyc3Qgc3RyaW5nLlxuICogQHBhcmFtIHtzdHJpbmd9IHN0cjIgU2Vjb25kIHN0cmluZy5cbiAqIEBwYXJhbSB7IVJlZ0V4cH0gdG9rZW5pemVyUmVnRXhwIFNwbGl0cyBhIHN0cmluZyBpbnRvIHN1YnN0cmluZ3Mgb2ZcbiAqICAgICBub24tbmVnYXRpdmUgaW50ZWdlcnMsIG5vbi1udW1lcmljIGNoYXJhY3RlcnMgYW5kIG9wdGlvbmFsbHkgZnJhY3Rpb25hbFxuICogICAgIG51bWJlcnMgc3RhcnRpbmcgd2l0aCBhIGRlY2ltYWwgcG9pbnQuXG4gKiBAcmV0dXJuIHtudW1iZXJ9IE5lZ2F0aXZlIGlmIHN0cjEgPCBzdHIyLCAwIGlzIHN0cjEgPT0gc3RyMiwgcG9zaXRpdmUgaWZcbiAqICAgICBzdHIxID4gc3RyMi5cbiAqIEBwcml2YXRlXG4gKi9cbmdvb2cuc3RyaW5nLm51bWJlckF3YXJlQ29tcGFyZV8gPSBmdW5jdGlvbihzdHIxLCBzdHIyLCB0b2tlbml6ZXJSZWdFeHApIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBpZiAoc3RyMSA9PSBzdHIyKSB7XG4gICAgcmV0dXJuIDA7XG4gIH1cbiAgaWYgKCFzdHIxKSB7XG4gICAgcmV0dXJuIC0xO1xuICB9XG4gIGlmICghc3RyMikge1xuICAgIHJldHVybiAxO1xuICB9XG5cbiAgLy8gVXNpbmcgbWF0Y2ggdG8gc3BsaXQgdGhlIGVudGlyZSBzdHJpbmcgYWhlYWQgb2YgdGltZSB0dXJucyBvdXQgdG8gYmUgZmFzdGVyXG4gIC8vIGZvciBtb3N0IGlucHV0cyB0aGFuIHVzaW5nIFJlZ0V4cC5leGVjIG9yIGl0ZXJhdGluZyBvdmVyIGVhY2ggY2hhcmFjdGVyLlxuICBjb25zdCB0b2tlbnMxID0gc3RyMS50b0xvd2VyQ2FzZSgpLm1hdGNoKHRva2VuaXplclJlZ0V4cCk7XG4gIGNvbnN0IHRva2VuczIgPSBzdHIyLnRvTG93ZXJDYXNlKCkubWF0Y2godG9rZW5pemVyUmVnRXhwKTtcblxuICBjb25zdCBjb3VudCA9IE1hdGgubWluKHRva2VuczEubGVuZ3RoLCB0b2tlbnMyLmxlbmd0aCk7XG5cbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7XG4gICAgY29uc3QgYSA9IHRva2VuczFbaV07XG4gICAgY29uc3QgYiA9IHRva2VuczJbaV07XG5cbiAgICAvLyBDb21wYXJlIHBhaXJzIG9mIHRva2VucywgcmV0dXJuaW5nIGlmIG9uZSB0b2tlbiBzb3J0cyBiZWZvcmUgdGhlIG90aGVyLlxuICAgIGlmIChhICE9IGIpIHtcbiAgICAgIC8vIE9ubHkgaWYgYm90aCB0b2tlbnMgYXJlIGludGVnZXJzIGlzIGEgc3BlY2lhbCBjb21wYXJpc29uIHJlcXVpcmVkLlxuICAgICAgLy8gRGVjaW1hbCBudW1iZXJzIGFyZSBzb3J0ZWQgYXMgc3RyaW5ncyAoZS5nLiwgJy4wOScgPCAnLjEnKS5cbiAgICAgIGNvbnN0IG51bTEgPSBwYXJzZUludChhLCAxMCk7XG4gICAgICBpZiAoIWlzTmFOKG51bTEpKSB7XG4gICAgICAgIGNvbnN0IG51bTIgPSBwYXJzZUludChiLCAxMCk7XG4gICAgICAgIGlmICghaXNOYU4obnVtMikgJiYgbnVtMSAtIG51bTIpIHtcbiAgICAgICAgICByZXR1cm4gbnVtMSAtIG51bTI7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBhIDwgYiA/IC0xIDogMTtcbiAgICB9XG4gIH1cblxuICAvLyBJZiBvbmUgc3RyaW5nIGlzIGEgc3Vic3RyaW5nIG9mIHRoZSBvdGhlciwgdGhlIHNob3J0ZXIgc3RyaW5nIHNvcnRzIGZpcnN0LlxuICBpZiAodG9rZW5zMS5sZW5ndGggIT0gdG9rZW5zMi5sZW5ndGgpIHtcbiAgICByZXR1cm4gdG9rZW5zMS5sZW5ndGggLSB0b2tlbnMyLmxlbmd0aDtcbiAgfVxuXG4gIC8vIFRoZSB0d28gc3RyaW5ncyBtdXN0IGJlIGVxdWl2YWxlbnQgZXhjZXB0IGZvciBjYXNlIChwZXJmZWN0IGVxdWFsaXR5IGlzXG4gIC8vIHRlc3RlZCBhdCB0aGUgaGVhZCBvZiB0aGUgZnVuY3Rpb24uKSBSZXZlcnQgdG8gZGVmYXVsdCBBU0NJSSBzdHJpbmdcbiAgLy8gY29tcGFyaXNvbiB0byBzdGFiaWxpemUgdGhlIHNvcnQuXG4gIHJldHVybiBzdHIxIDwgc3RyMiA/IC0xIDogMTtcbn07XG5cblxuLyoqXG4gKiBTdHJpbmcgY29tcGFyaXNvbiBmdW5jdGlvbiB0aGF0IGhhbmRsZXMgbm9uLW5lZ2F0aXZlIGludGVnZXIgbnVtYmVycyBpbiBhXG4gKiB3YXkgaHVtYW5zIG1pZ2h0IGV4cGVjdC4gVXNpbmcgdGhpcyBmdW5jdGlvbiwgdGhlIHN0cmluZyAnRmlsZSAyLmpwZycgc29ydHNcbiAqIGJlZm9yZSAnRmlsZSAxMC5qcGcnLCBhbmQgJ1ZlcnNpb24gMS45JyBiZWZvcmUgJ1ZlcnNpb24gMS4xMCcuIFRoZSBjb21wYXJpc29uXG4gKiBpcyBtb3N0bHkgY2FzZS1pbnNlbnNpdGl2ZSwgdGhvdWdoIHN0cmluZ3MgdGhhdCBhcmUgaWRlbnRpY2FsIGV4Y2VwdCBmb3IgY2FzZVxuICogYXJlIHNvcnRlZCB3aXRoIHRoZSB1cHBlci1jYXNlIHN0cmluZ3MgYmVmb3JlIGxvd2VyLWNhc2UuXG4gKlxuICogVGhpcyBjb21wYXJpc29uIGZ1bmN0aW9uIGlzIHVwIHRvIDUweCBzbG93ZXIgdGhhbiBlaXRoZXIgdGhlIGRlZmF1bHQgb3IgdGhlXG4gKiBjYXNlLWluc2Vuc2l0aXZlIGNvbXBhcmUuIEl0IHNob3VsZCBub3QgYmUgdXNlZCBpbiB0aW1lLWNyaXRpY2FsIGNvZGUsIGJ1dFxuICogc2hvdWxkIGJlIGZhc3QgZW5vdWdoIHRvIHNvcnQgc2V2ZXJhbCBodW5kcmVkIHNob3J0IHN0cmluZ3MgKGxpa2UgZmlsZW5hbWVzKVxuICogd2l0aCBhIHJlYXNvbmFibGUgZGVsYXkuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHN0cjEgVGhlIHN0cmluZyB0byBjb21wYXJlIGluIGEgbnVtZXJpY2FsbHkgc2Vuc2l0aXZlIHdheS5cbiAqIEBwYXJhbSB7c3RyaW5nfSBzdHIyIFRoZSBzdHJpbmcgdG8gY29tcGFyZSBgc3RyMWAgdG8uXG4gKiBAcmV0dXJuIHtudW1iZXJ9IGxlc3MgdGhhbiAwIGlmIHN0cjEgPCBzdHIyLCAwIGlmIHN0cjEgPT0gc3RyMiwgZ3JlYXRlciB0aGFuXG4gKiAgICAgMCBpZiBzdHIxID4gc3RyMi5cbiAqL1xuZ29vZy5zdHJpbmcuaW50QXdhcmVDb21wYXJlID0gZnVuY3Rpb24oc3RyMSwgc3RyMikge1xuICAndXNlIHN0cmljdCc7XG4gIHJldHVybiBnb29nLnN0cmluZy5udW1iZXJBd2FyZUNvbXBhcmVfKHN0cjEsIHN0cjIsIC9cXGQrfFxcRCsvZyk7XG59O1xuXG5cbi8qKlxuICogU3RyaW5nIGNvbXBhcmlzb24gZnVuY3Rpb24gdGhhdCBoYW5kbGVzIG5vbi1uZWdhdGl2ZSBpbnRlZ2VyIGFuZCBmcmFjdGlvbmFsXG4gKiBudW1iZXJzIGluIGEgd2F5IGh1bWFucyBtaWdodCBleHBlY3QuIFVzaW5nIHRoaXMgZnVuY3Rpb24sIHRoZSBzdHJpbmdcbiAqICdGaWxlIDIuanBnJyBzb3J0cyBiZWZvcmUgJ0ZpbGUgMTAuanBnJywgYW5kICczLjE0JyBiZWZvcmUgJzMuMicuIEVxdWl2YWxlbnRcbiAqIHRvIHtAbGluayBnb29nLnN0cmluZy5pbnRBd2FyZUNvbXBhcmV9IGFwYXJ0IGZyb20gdGhlIHdheSBob3cgaXQgaW50ZXJwcmV0c1xuICogZG90cy5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gc3RyMSBUaGUgc3RyaW5nIHRvIGNvbXBhcmUgaW4gYSBudW1lcmljYWxseSBzZW5zaXRpdmUgd2F5LlxuICogQHBhcmFtIHtzdHJpbmd9IHN0cjIgVGhlIHN0cmluZyB0byBjb21wYXJlIGBzdHIxYCB0by5cbiAqIEByZXR1cm4ge251bWJlcn0gbGVzcyB0aGFuIDAgaWYgc3RyMSA8IHN0cjIsIDAgaWYgc3RyMSA9PSBzdHIyLCBncmVhdGVyIHRoYW5cbiAqICAgICAwIGlmIHN0cjEgPiBzdHIyLlxuICovXG5nb29nLnN0cmluZy5mbG9hdEF3YXJlQ29tcGFyZSA9IGZ1bmN0aW9uKHN0cjEsIHN0cjIpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gZ29vZy5zdHJpbmcubnVtYmVyQXdhcmVDb21wYXJlXyhzdHIxLCBzdHIyLCAvXFxkK3xcXC5cXGQrfFxcRCsvZyk7XG59O1xuXG5cbi8qKlxuICogQWxpYXMgZm9yIHtAbGluayBnb29nLnN0cmluZy5mbG9hdEF3YXJlQ29tcGFyZX0uXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHN0cjFcbiAqIEBwYXJhbSB7c3RyaW5nfSBzdHIyXG4gKiBAcmV0dXJuIHtudW1iZXJ9XG4gKi9cbmdvb2cuc3RyaW5nLm51bWVyYXRlQ29tcGFyZSA9IGdvb2cuc3RyaW5nLmZsb2F0QXdhcmVDb21wYXJlO1xuXG5cbi8qKlxuICogVVJMLWVuY29kZXMgYSBzdHJpbmdcbiAqIEBwYXJhbSB7Kn0gc3RyIFRoZSBzdHJpbmcgdG8gdXJsLWVuY29kZS5cbiAqIEByZXR1cm4ge3N0cmluZ30gQW4gZW5jb2RlZCBjb3B5IG9mIGBzdHJgIHRoYXQgaXMgc2FmZSBmb3IgdXJscy5cbiAqICAgICBOb3RlIHRoYXQgJyMnLCAnOicsIGFuZCBvdGhlciBjaGFyYWN0ZXJzIHVzZWQgdG8gZGVsaW1pdCBwb3J0aW9uc1xuICogICAgIG9mIFVSTHMgKndpbGwqIGJlIGVuY29kZWQuXG4gKi9cbmdvb2cuc3RyaW5nLnVybEVuY29kZSA9IGZ1bmN0aW9uKHN0cikge1xuICAndXNlIHN0cmljdCc7XG4gIHJldHVybiBlbmNvZGVVUklDb21wb25lbnQoU3RyaW5nKHN0cikpO1xufTtcblxuXG4vKipcbiAqIFVSTC1kZWNvZGVzIHRoZSBzdHJpbmcuIFdlIG5lZWQgdG8gc3BlY2lhbGx5IGhhbmRsZSAnKydzIGJlY2F1c2VcbiAqIHRoZSBqYXZhc2NyaXB0IGxpYnJhcnkgZG9lc24ndCBjb252ZXJ0IHRoZW0gdG8gc3BhY2VzLlxuICogQHBhcmFtIHtzdHJpbmd9IHN0ciBUaGUgc3RyaW5nIHRvIHVybCBkZWNvZGUuXG4gKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSBkZWNvZGVkIGBzdHJgLlxuICovXG5nb29nLnN0cmluZy51cmxEZWNvZGUgPSBmdW5jdGlvbihzdHIpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KHN0ci5yZXBsYWNlKC9cXCsvZywgJyAnKSk7XG59O1xuXG5cbi8qKlxuICogQ29udmVydHMgXFxuIHRvIDxicj5zIG9yIDxiciAvPnMuXG4gKiBAcGFyYW0ge3N0cmluZ30gc3RyIFRoZSBzdHJpbmcgaW4gd2hpY2ggdG8gY29udmVydCBuZXdsaW5lcy5cbiAqIEBwYXJhbSB7Ym9vbGVhbj19IG9wdF94bWwgV2hldGhlciB0byB1c2UgWE1MIGNvbXBhdGlibGUgdGFncy5cbiAqIEByZXR1cm4ge3N0cmluZ30gQSBjb3B5IG9mIGBzdHJgIHdpdGggY29udmVydGVkIG5ld2xpbmVzLlxuICovXG5nb29nLnN0cmluZy5uZXdMaW5lVG9CciA9IGdvb2cuc3RyaW5nLmludGVybmFsLm5ld0xpbmVUb0JyO1xuXG5cbi8qKlxuICogRXNjYXBlcyBkb3VibGUgcXVvdGUgJ1wiJyBhbmQgc2luZ2xlIHF1b3RlICdcXCcnIGNoYXJhY3RlcnMgaW4gYWRkaXRpb24gdG9cbiAqICcmJywgJzwnLCBhbmQgJz4nIHNvIHRoYXQgYSBzdHJpbmcgY2FuIGJlIGluY2x1ZGVkIGluIGFuIEhUTUwgdGFnIGF0dHJpYnV0ZVxuICogdmFsdWUgd2l0aGluIGRvdWJsZSBvciBzaW5nbGUgcXVvdGVzLlxuICpcbiAqIEl0IHNob3VsZCBiZSBub3RlZCB0aGF0ID4gZG9lc24ndCBuZWVkIHRvIGJlIGVzY2FwZWQgZm9yIHRoZSBIVE1MIG9yIFhNTCB0b1xuICogYmUgdmFsaWQsIGJ1dCBpdCBoYXMgYmVlbiBkZWNpZGVkIHRvIGVzY2FwZSBpdCBmb3IgY29uc2lzdGVuY3kgd2l0aCBvdGhlclxuICogaW1wbGVtZW50YXRpb25zLlxuICpcbiAqIFdpdGggZ29vZy5zdHJpbmcuREVURUNUX0RPVUJMRV9FU0NBUElORywgdGhpcyBmdW5jdGlvbiBlc2NhcGVzIGFsc28gdGhlXG4gKiBsb3dlcmNhc2UgbGV0dGVyIFwiZVwiLlxuICpcbiAqIE5PVEUodXNlcik6XG4gKiBIdG1sRXNjYXBlIGlzIG9mdGVuIGNhbGxlZCBkdXJpbmcgdGhlIGdlbmVyYXRpb24gb2YgbGFyZ2UgYmxvY2tzIG9mIEhUTUwuXG4gKiBVc2luZyBzdGF0aWNzIGZvciB0aGUgcmVndWxhciBleHByZXNzaW9ucyBhbmQgc3RyaW5ncyBpcyBhbiBvcHRpbWl6YXRpb25cbiAqIHRoYXQgY2FuIG1vcmUgdGhhbiBoYWxmIHRoZSBhbW91bnQgb2YgdGltZSBJRSBzcGVuZHMgaW4gdGhpcyBmdW5jdGlvbiBmb3JcbiAqIGxhcmdlIGFwcHMsIHNpbmNlIHN0cmluZ3MgYW5kIHJlZ2V4ZXMgYm90aCBjb250cmlidXRlIHRvIEdDIGFsbG9jYXRpb25zLlxuICpcbiAqIFRlc3RpbmcgZm9yIHRoZSBwcmVzZW5jZSBvZiBhIGNoYXJhY3RlciBiZWZvcmUgZXNjYXBpbmcgaW5jcmVhc2VzIHRoZSBudW1iZXJcbiAqIG9mIGZ1bmN0aW9uIGNhbGxzLCBidXQgYWN0dWFsbHkgcHJvdmlkZXMgYSBzcGVlZCBpbmNyZWFzZSBmb3IgdGhlIGF2ZXJhZ2VcbiAqIGNhc2UgLS0gc2luY2UgdGhlIGF2ZXJhZ2UgY2FzZSBvZnRlbiBkb2Vzbid0IHJlcXVpcmUgdGhlIGVzY2FwaW5nIG9mIGFsbCA0XG4gKiBjaGFyYWN0ZXJzIGFuZCBpbmRleE9mKCkgaXMgbXVjaCBjaGVhcGVyIHRoYW4gcmVwbGFjZSgpLlxuICogVGhlIHdvcnN0IGNhc2UgZG9lcyBzdWZmZXIgc2xpZ2h0bHkgZnJvbSB0aGUgYWRkaXRpb25hbCBjYWxscywgdGhlcmVmb3JlIHRoZVxuICogb3B0X2lzTGlrZWx5VG9Db250YWluSHRtbENoYXJzIG9wdGlvbiBoYXMgYmVlbiBpbmNsdWRlZCBmb3Igc2l0dWF0aW9uc1xuICogd2hlcmUgYWxsIDQgSFRNTCBlbnRpdGllcyBhcmUgdmVyeSBsaWtlbHkgdG8gYmUgcHJlc2VudCBhbmQgbmVlZCBlc2NhcGluZy5cbiAqXG4gKiBTb21lIGJlbmNobWFya3MgKHRpbWVzIHRlbmRlZCB0byBmbHVjdHVhdGUgKy0wLjA1bXMpOlxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRmlyZUZveCAgICAgICAgICAgICAgICAgICAgIElFNlxuICogKG5vIGNoYXJzIC8gYXZlcmFnZSAobWl4IG9mIGNhc2VzKSAvIGFsbCA0IGNoYXJzKVxuICogbm8gY2hlY2tzICAgICAgICAgICAgICAgICAgICAgMC4xMyAvIDAuMjIgLyAwLjIyICAgICAgICAgMC4yMyAvIDAuNTMgLyAwLjgwXG4gKiBpbmRleE9mICAgICAgICAgICAgICAgICAgICAgICAwLjA4IC8gMC4xNyAvIDAuMjYgICAgICAgICAwLjIyIC8gMC41NCAvIDAuODRcbiAqIGluZGV4T2YgKyByZSB0ZXN0ICAgICAgICAgICAgIDAuMDcgLyAwLjE3IC8gMC4yOCAgICAgICAgIDAuMTkgLyAwLjUwIC8gMC44NVxuICpcbiAqIEFuIGFkZGl0aW9uYWwgYWR2YW50YWdlIG9mIGNoZWNraW5nIGlmIHJlcGxhY2UgYWN0dWFsbHkgbmVlZHMgdG8gYmUgY2FsbGVkXG4gKiBpcyBhIHJlZHVjdGlvbiBpbiB0aGUgbnVtYmVyIG9mIG9iamVjdCBhbGxvY2F0aW9ucywgc28gYXMgdGhlIHNpemUgb2YgdGhlXG4gKiBhcHBsaWNhdGlvbiBncm93cyB0aGUgZGlmZmVyZW5jZSBiZXR3ZWVuIHRoZSB2YXJpb3VzIG1ldGhvZHMgd291bGQgaW5jcmVhc2UuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHN0ciBzdHJpbmcgdG8gYmUgZXNjYXBlZC5cbiAqIEBwYXJhbSB7Ym9vbGVhbj19IG9wdF9pc0xpa2VseVRvQ29udGFpbkh0bWxDaGFycyBEb24ndCBwZXJmb3JtIGEgY2hlY2sgdG8gc2VlXG4gKiAgICAgaWYgdGhlIGNoYXJhY3RlciBuZWVkcyByZXBsYWNpbmcgLSB1c2UgdGhpcyBvcHRpb24gaWYgeW91IGV4cGVjdCBlYWNoIG9mXG4gKiAgICAgdGhlIGNoYXJhY3RlcnMgdG8gYXBwZWFyIG9mdGVuLiBMZWF2ZSBmYWxzZSBpZiB5b3UgZXhwZWN0IGZldyBodG1sXG4gKiAgICAgY2hhcmFjdGVycyB0byBvY2N1ciBpbiB5b3VyIHN0cmluZ3MsIHN1Y2ggYXMgaWYgeW91IGFyZSBlc2NhcGluZyBIVE1MLlxuICogQHJldHVybiB7c3RyaW5nfSBBbiBlc2NhcGVkIGNvcHkgb2YgYHN0cmAuXG4gKi9cbmdvb2cuc3RyaW5nLmh0bWxFc2NhcGUgPSBmdW5jdGlvbihzdHIsIG9wdF9pc0xpa2VseVRvQ29udGFpbkh0bWxDaGFycykge1xuICAndXNlIHN0cmljdCc7XG4gIHN0ciA9IGdvb2cuc3RyaW5nLmludGVybmFsLmh0bWxFc2NhcGUoc3RyLCBvcHRfaXNMaWtlbHlUb0NvbnRhaW5IdG1sQ2hhcnMpO1xuICBpZiAoZ29vZy5zdHJpbmcuREVURUNUX0RPVUJMRV9FU0NBUElORykge1xuICAgIHN0ciA9IHN0ci5yZXBsYWNlKGdvb2cuc3RyaW5nLkVfUkVfLCAnJiMxMDE7Jyk7XG4gIH1cbiAgcmV0dXJuIHN0cjtcbn07XG5cblxuLyoqXG4gKiBSZWd1bGFyIGV4cHJlc3Npb24gdGhhdCBtYXRjaGVzIGEgbG93ZXJjYXNlIGxldHRlciBcImVcIiwgZm9yIHVzZSBpbiBlc2NhcGluZy5cbiAqIEBjb25zdCB7IVJlZ0V4cH1cbiAqIEBwcml2YXRlXG4gKi9cbmdvb2cuc3RyaW5nLkVfUkVfID0gL2UvZztcblxuXG4vKipcbiAqIFVuZXNjYXBlcyBhbiBIVE1MIHN0cmluZy5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gc3RyIFRoZSBzdHJpbmcgdG8gdW5lc2NhcGUuXG4gKiBAcmV0dXJuIHtzdHJpbmd9IEFuIHVuZXNjYXBlZCBjb3B5IG9mIGBzdHJgLlxuICovXG5nb29nLnN0cmluZy51bmVzY2FwZUVudGl0aWVzID0gZnVuY3Rpb24oc3RyKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgaWYgKGdvb2cuc3RyaW5nLmNvbnRhaW5zKHN0ciwgJyYnKSkge1xuICAgIC8vIFdlIGFyZSBjYXJlZnVsIG5vdCB0byB1c2UgYSBET00gaWYgd2UgZG8gbm90IGhhdmUgb25lIG9yIHdlIGV4cGxpY2l0bHlcbiAgICAvLyByZXF1ZXN0ZWQgbm9uLURPTSBodG1sIHVuZXNjYXBpbmcuXG4gICAgaWYgKCFnb29nLnN0cmluZy5GT1JDRV9OT05fRE9NX0hUTUxfVU5FU0NBUElORyAmJlxuICAgICAgICAnZG9jdW1lbnQnIGluIGdvb2cuZ2xvYmFsKSB7XG4gICAgICByZXR1cm4gZ29vZy5zdHJpbmcudW5lc2NhcGVFbnRpdGllc1VzaW5nRG9tXyhzdHIpO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBGYWxsIGJhY2sgb24gcHVyZSBYTUwgZW50aXRpZXNcbiAgICAgIHJldHVybiBnb29nLnN0cmluZy51bmVzY2FwZVB1cmVYbWxFbnRpdGllc18oc3RyKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHN0cjtcbn07XG5cblxuLyoqXG4gKiBVbmVzY2FwZXMgYSBIVE1MIHN0cmluZyB1c2luZyB0aGUgcHJvdmlkZWQgZG9jdW1lbnQuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHN0ciBUaGUgc3RyaW5nIHRvIHVuZXNjYXBlLlxuICogQHBhcmFtIHshRG9jdW1lbnR9IGRvY3VtZW50IEEgZG9jdW1lbnQgdG8gdXNlIGluIGVzY2FwaW5nIHRoZSBzdHJpbmcuXG4gKiBAcmV0dXJuIHtzdHJpbmd9IEFuIHVuZXNjYXBlZCBjb3B5IG9mIGBzdHJgLlxuICovXG5nb29nLnN0cmluZy51bmVzY2FwZUVudGl0aWVzV2l0aERvY3VtZW50ID0gZnVuY3Rpb24oc3RyLCBkb2N1bWVudCkge1xuICAndXNlIHN0cmljdCc7XG4gIGlmIChnb29nLnN0cmluZy5jb250YWlucyhzdHIsICcmJykpIHtcbiAgICByZXR1cm4gZ29vZy5zdHJpbmcudW5lc2NhcGVFbnRpdGllc1VzaW5nRG9tXyhzdHIsIGRvY3VtZW50KTtcbiAgfVxuICByZXR1cm4gc3RyO1xufTtcblxuXG4vKipcbiAqIFVuZXNjYXBlcyBhbiBIVE1MIHN0cmluZyB1c2luZyBhIERPTSB0byByZXNvbHZlIG5vbi1YTUwsIG5vbi1udW1lcmljXG4gKiBlbnRpdGllcy4gVGhpcyBmdW5jdGlvbiBpcyBYU1Mtc2FmZSBhbmQgd2hpdGVzcGFjZS1wcmVzZXJ2aW5nLlxuICogQHByaXZhdGVcbiAqIEBwYXJhbSB7c3RyaW5nfSBzdHIgVGhlIHN0cmluZyB0byB1bmVzY2FwZS5cbiAqIEBwYXJhbSB7RG9jdW1lbnQ9fSBvcHRfZG9jdW1lbnQgQW4gb3B0aW9uYWwgZG9jdW1lbnQgdG8gdXNlIGZvciBjcmVhdGluZ1xuICogICAgIGVsZW1lbnRzLiBJZiB0aGlzIGlzIG5vdCBzcGVjaWZpZWQgdGhlbiB0aGUgZGVmYXVsdCB3aW5kb3cuZG9jdW1lbnRcbiAqICAgICB3aWxsIGJlIHVzZWQuXG4gKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSB1bmVzY2FwZWQgYHN0cmAgc3RyaW5nLlxuICovXG5nb29nLnN0cmluZy51bmVzY2FwZUVudGl0aWVzVXNpbmdEb21fID0gZnVuY3Rpb24oc3RyLCBvcHRfZG9jdW1lbnQpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICAvKiogQHR5cGUgeyFPYmplY3Q8c3RyaW5nLCBzdHJpbmc+fSAqL1xuICBjb25zdCBzZWVuID0geycmYW1wOyc6ICcmJywgJyZsdDsnOiAnPCcsICcmZ3Q7JzogJz4nLCAnJnF1b3Q7JzogJ1wiJ307XG4gIC8qKiBAdHlwZSB7IUVsZW1lbnR9ICovXG4gIGxldCBkaXY7XG4gIGlmIChvcHRfZG9jdW1lbnQpIHtcbiAgICBkaXYgPSBvcHRfZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gIH0gZWxzZSB7XG4gICAgZGl2ID0gZ29vZy5nbG9iYWwuZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gIH1cbiAgLy8gTWF0Y2ggYXMgbWFueSB2YWxpZCBlbnRpdHkgY2hhcmFjdGVycyBhcyBwb3NzaWJsZS4gSWYgdGhlIGFjdHVhbCBlbnRpdHlcbiAgLy8gaGFwcGVucyB0byBiZSBzaG9ydGVyLCBpdCB3aWxsIHN0aWxsIHdvcmsgYXMgaW5uZXJIVE1MIHdpbGwgcmV0dXJuIHRoZVxuICAvLyB0cmFpbGluZyBjaGFyYWN0ZXJzIHVuY2hhbmdlZC4gU2luY2UgdGhlIGVudGl0eSBjaGFyYWN0ZXJzIGRvIG5vdCBpbmNsdWRlXG4gIC8vIG9wZW4gYW5nbGUgYnJhY2tldCwgdGhlcmUgaXMgbm8gY2hhbmNlIG9mIFhTUyBmcm9tIHRoZSBpbm5lckhUTUwgdXNlLlxuICAvLyBTaW5jZSBubyB3aGl0ZXNwYWNlIGlzIHBhc3NlZCB0byBpbm5lckhUTUwsIHdoaXRlc3BhY2UgaXMgcHJlc2VydmVkLlxuICByZXR1cm4gc3RyLnJlcGxhY2UoZ29vZy5zdHJpbmcuSFRNTF9FTlRJVFlfUEFUVEVSTl8sIGZ1bmN0aW9uKHMsIGVudGl0eSkge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICAvLyBDaGVjayBmb3IgY2FjaGVkIGVudGl0eS5cbiAgICBsZXQgdmFsdWUgPSBzZWVuW3NdO1xuICAgIGlmICh2YWx1ZSkge1xuICAgICAgcmV0dXJuIHZhbHVlO1xuICAgIH1cbiAgICAvLyBDaGVjayBmb3IgbnVtZXJpYyBlbnRpdHkuXG4gICAgaWYgKGVudGl0eS5jaGFyQXQoMCkgPT0gJyMnKSB7XG4gICAgICAvLyBQcmVmaXggd2l0aCAwIHNvIHRoYXQgaGV4IGVudGl0aWVzIChlLmcuICYjeDEwKSBwYXJzZSBhcyBoZXggbnVtYmVycy5cbiAgICAgIGNvbnN0IG4gPSBOdW1iZXIoJzAnICsgZW50aXR5LnN1YnN0cigxKSk7XG4gICAgICBpZiAoIWlzTmFOKG4pKSB7XG4gICAgICAgIHZhbHVlID0gU3RyaW5nLmZyb21DaGFyQ29kZShuKTtcbiAgICAgIH1cbiAgICB9XG4gICAgLy8gRmFsbCBiYWNrIHRvIGlubmVySFRNTCBvdGhlcndpc2UuXG4gICAgaWYgKCF2YWx1ZSkge1xuICAgICAgLy8gQXBwZW5kIGEgbm9uLWVudGl0eSBjaGFyYWN0ZXIgdG8gYXZvaWQgYSBidWcgaW4gV2Via2l0IHRoYXQgcGFyc2VzXG4gICAgICAvLyBhbiBpbnZhbGlkIGVudGl0eSBhdCB0aGUgZW5kIG9mIGlubmVySFRNTCB0ZXh0IGFzIHRoZSBlbXB0eSBzdHJpbmcuXG4gICAgICBnb29nLmRvbS5zYWZlLnNldElubmVySHRtbChcbiAgICAgICAgICBkaXYsXG4gICAgICAgICAgZ29vZy5odG1sLnVuY2hlY2tlZGNvbnZlcnNpb25zXG4gICAgICAgICAgICAgIC5zYWZlSHRtbEZyb21TdHJpbmdLbm93blRvU2F0aXNmeVR5cGVDb250cmFjdChcbiAgICAgICAgICAgICAgICAgIGdvb2cuc3RyaW5nLkNvbnN0LmZyb20oJ1NpbmdsZSBIVE1MIGVudGl0eS4nKSwgcyArICcgJykpO1xuICAgICAgLy8gVGhlbiByZW1vdmUgdGhlIHRyYWlsaW5nIGNoYXJhY3RlciBmcm9tIHRoZSByZXN1bHQuXG4gICAgICB2YWx1ZSA9IGRpdi5maXJzdENoaWxkLm5vZGVWYWx1ZS5zbGljZSgwLCAtMSk7XG4gICAgfVxuICAgIC8vIENhY2hlIGFuZCByZXR1cm4uXG4gICAgcmV0dXJuIHNlZW5bc10gPSB2YWx1ZTtcbiAgfSk7XG59O1xuXG5cbi8qKlxuICogVW5lc2NhcGVzIFhNTCBlbnRpdGllcy5cbiAqIEBwcml2YXRlXG4gKiBAcGFyYW0ge3N0cmluZ30gc3RyIFRoZSBzdHJpbmcgdG8gdW5lc2NhcGUuXG4gKiBAcmV0dXJuIHtzdHJpbmd9IEFuIHVuZXNjYXBlZCBjb3B5IG9mIGBzdHJgLlxuICovXG5nb29nLnN0cmluZy51bmVzY2FwZVB1cmVYbWxFbnRpdGllc18gPSBmdW5jdGlvbihzdHIpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gc3RyLnJlcGxhY2UoLyYoW147XSspOy9nLCBmdW5jdGlvbihzLCBlbnRpdHkpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgc3dpdGNoIChlbnRpdHkpIHtcbiAgICAgIGNhc2UgJ2FtcCc6XG4gICAgICAgIHJldHVybiAnJic7XG4gICAgICBjYXNlICdsdCc6XG4gICAgICAgIHJldHVybiAnPCc7XG4gICAgICBjYXNlICdndCc6XG4gICAgICAgIHJldHVybiAnPic7XG4gICAgICBjYXNlICdxdW90JzpcbiAgICAgICAgcmV0dXJuICdcIic7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBpZiAoZW50aXR5LmNoYXJBdCgwKSA9PSAnIycpIHtcbiAgICAgICAgICAvLyBQcmVmaXggd2l0aCAwIHNvIHRoYXQgaGV4IGVudGl0aWVzIChlLmcuICYjeDEwKSBwYXJzZSBhcyBoZXguXG4gICAgICAgICAgY29uc3QgbiA9IE51bWJlcignMCcgKyBlbnRpdHkuc3Vic3RyKDEpKTtcbiAgICAgICAgICBpZiAoIWlzTmFOKG4pKSB7XG4gICAgICAgICAgICByZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZShuKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLy8gRm9yIGludmFsaWQgZW50aXRpZXMgd2UganVzdCByZXR1cm4gdGhlIGVudGl0eVxuICAgICAgICByZXR1cm4gcztcbiAgICB9XG4gIH0pO1xufTtcblxuXG4vKipcbiAqIFJlZ3VsYXIgZXhwcmVzc2lvbiB0aGF0IG1hdGNoZXMgYW4gSFRNTCBlbnRpdHkuXG4gKiBTZWUgYWxzbyBIVE1MNTogVG9rZW5pemF0aW9uIC8gVG9rZW5pemluZyBjaGFyYWN0ZXIgcmVmZXJlbmNlcy5cbiAqIEBwcml2YXRlXG4gKiBAdHlwZSB7IVJlZ0V4cH1cbiAqL1xuZ29vZy5zdHJpbmcuSFRNTF9FTlRJVFlfUEFUVEVSTl8gPSAvJihbXjtcXHM8Jl0rKTs/L2c7XG5cblxuLyoqXG4gKiBEbyBlc2NhcGluZyBvZiB3aGl0ZXNwYWNlIHRvIHByZXNlcnZlIHNwYXRpYWwgZm9ybWF0dGluZy4gV2UgdXNlIGNoYXJhY3RlclxuICogZW50aXR5ICMxNjAgdG8gbWFrZSBpdCBzYWZlciBmb3IgeG1sLlxuICogQHBhcmFtIHtzdHJpbmd9IHN0ciBUaGUgc3RyaW5nIGluIHdoaWNoIHRvIGVzY2FwZSB3aGl0ZXNwYWNlLlxuICogQHBhcmFtIHtib29sZWFuPX0gb3B0X3htbCBXaGV0aGVyIHRvIHVzZSBYTUwgY29tcGF0aWJsZSB0YWdzLlxuICogQHJldHVybiB7c3RyaW5nfSBBbiBlc2NhcGVkIGNvcHkgb2YgYHN0cmAuXG4gKi9cbmdvb2cuc3RyaW5nLndoaXRlc3BhY2VFc2NhcGUgPSBmdW5jdGlvbihzdHIsIG9wdF94bWwpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICAvLyBUaGlzIGRvZXNuJ3QgdXNlIGdvb2cuc3RyaW5nLnByZXNlcnZlU3BhY2VzIGZvciBiYWNrd2FyZHMgY29tcGF0aWJpbGl0eS5cbiAgcmV0dXJuIGdvb2cuc3RyaW5nLm5ld0xpbmVUb0JyKHN0ci5yZXBsYWNlKC8gIC9nLCAnICYjMTYwOycpLCBvcHRfeG1sKTtcbn07XG5cblxuLyoqXG4gKiBQcmVzZXJ2ZSBzcGFjZXMgdGhhdCB3b3VsZCBiZSBvdGhlcndpc2UgY29sbGFwc2VkIGluIEhUTUwgYnkgcmVwbGFjaW5nIHRoZW1cbiAqIHdpdGggbm9uLWJyZWFraW5nIHNwYWNlIFVuaWNvZGUgY2hhcmFjdGVycy5cbiAqIEBwYXJhbSB7c3RyaW5nfSBzdHIgVGhlIHN0cmluZyBpbiB3aGljaCB0byBwcmVzZXJ2ZSB3aGl0ZXNwYWNlLlxuICogQHJldHVybiB7c3RyaW5nfSBBIGNvcHkgb2YgYHN0cmAgd2l0aCBwcmVzZXJ2ZWQgd2hpdGVzcGFjZS5cbiAqL1xuZ29vZy5zdHJpbmcucHJlc2VydmVTcGFjZXMgPSBmdW5jdGlvbihzdHIpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gc3RyLnJlcGxhY2UoLyhefFtcXG4gXSkgL2csICckMScgKyBnb29nLnN0cmluZy5Vbmljb2RlLk5CU1ApO1xufTtcblxuXG4vKipcbiAqIFN0cmlwIHF1b3RlIGNoYXJhY3RlcnMgYXJvdW5kIGEgc3RyaW5nLiAgVGhlIHNlY29uZCBhcmd1bWVudCBpcyBhIHN0cmluZyBvZlxuICogY2hhcmFjdGVycyB0byB0cmVhdCBhcyBxdW90ZXMuICBUaGlzIGNhbiBiZSBhIHNpbmdsZSBjaGFyYWN0ZXIgb3IgYSBzdHJpbmcgb2ZcbiAqIG11bHRpcGxlIGNoYXJhY3RlciBhbmQgaW4gdGhhdCBjYXNlIGVhY2ggb2YgdGhvc2UgYXJlIHRyZWF0ZWQgYXMgcG9zc2libGVcbiAqIHF1b3RlIGNoYXJhY3RlcnMuIEZvciBleGFtcGxlOlxuICpcbiAqIDxwcmU+XG4gKiBnb29nLnN0cmluZy5zdHJpcFF1b3RlcygnXCJhYmNcIicsICdcImAnKSAtLT4gJ2FiYydcbiAqIGdvb2cuc3RyaW5nLnN0cmlwUXVvdGVzKCdgYWJjYCcsICdcImAnKSAtLT4gJ2FiYydcbiAqIDwvcHJlPlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBzdHIgVGhlIHN0cmluZyB0byBzdHJpcC5cbiAqIEBwYXJhbSB7c3RyaW5nfSBxdW90ZUNoYXJzIFRoZSBxdW90ZSBjaGFyYWN0ZXJzIHRvIHN0cmlwLlxuICogQHJldHVybiB7c3RyaW5nfSBBIGNvcHkgb2YgYHN0cmAgd2l0aG91dCB0aGUgcXVvdGVzLlxuICovXG5nb29nLnN0cmluZy5zdHJpcFF1b3RlcyA9IGZ1bmN0aW9uKHN0ciwgcXVvdGVDaGFycykge1xuICAndXNlIHN0cmljdCc7XG4gIGNvbnN0IGxlbmd0aCA9IHF1b3RlQ2hhcnMubGVuZ3RoO1xuICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgY29uc3QgcXVvdGVDaGFyID0gbGVuZ3RoID09IDEgPyBxdW90ZUNoYXJzIDogcXVvdGVDaGFycy5jaGFyQXQoaSk7XG4gICAgaWYgKHN0ci5jaGFyQXQoMCkgPT0gcXVvdGVDaGFyICYmIHN0ci5jaGFyQXQoc3RyLmxlbmd0aCAtIDEpID09IHF1b3RlQ2hhcikge1xuICAgICAgcmV0dXJuIHN0ci5zdWJzdHJpbmcoMSwgc3RyLmxlbmd0aCAtIDEpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gc3RyO1xufTtcblxuXG4vKipcbiAqIFRydW5jYXRlcyBhIHN0cmluZyB0byBhIGNlcnRhaW4gbGVuZ3RoIGFuZCBhZGRzICcuLi4nIGlmIG5lY2Vzc2FyeS4gIFRoZVxuICogbGVuZ3RoIGFsc28gYWNjb3VudHMgZm9yIHRoZSBlbGxpcHNpcywgc28gYSBtYXhpbXVtIGxlbmd0aCBvZiAxMCBhbmQgYSBzdHJpbmdcbiAqICdIZWxsbyBXb3JsZCEnIHByb2R1Y2VzICdIZWxsbyBXLi4uJy5cbiAqIEBwYXJhbSB7c3RyaW5nfSBzdHIgVGhlIHN0cmluZyB0byB0cnVuY2F0ZS5cbiAqIEBwYXJhbSB7bnVtYmVyfSBjaGFycyBNYXggbnVtYmVyIG9mIGNoYXJhY3RlcnMuXG4gKiBAcGFyYW0ge2Jvb2xlYW49fSBvcHRfcHJvdGVjdEVzY2FwZWRDaGFyYWN0ZXJzIFdoZXRoZXIgdG8gcHJvdGVjdCBlc2NhcGVkXG4gKiAgICAgY2hhcmFjdGVycyBmcm9tIGJlaW5nIGN1dCBvZmYgaW4gdGhlIG1pZGRsZS5cbiAqIEByZXR1cm4ge3N0cmluZ30gVGhlIHRydW5jYXRlZCBgc3RyYCBzdHJpbmcuXG4gKi9cbmdvb2cuc3RyaW5nLnRydW5jYXRlID0gZnVuY3Rpb24oc3RyLCBjaGFycywgb3B0X3Byb3RlY3RFc2NhcGVkQ2hhcmFjdGVycykge1xuICAndXNlIHN0cmljdCc7XG4gIGlmIChvcHRfcHJvdGVjdEVzY2FwZWRDaGFyYWN0ZXJzKSB7XG4gICAgc3RyID0gZ29vZy5zdHJpbmcudW5lc2NhcGVFbnRpdGllcyhzdHIpO1xuICB9XG5cbiAgaWYgKHN0ci5sZW5ndGggPiBjaGFycykge1xuICAgIHN0ciA9IHN0ci5zdWJzdHJpbmcoMCwgY2hhcnMgLSAzKSArICcuLi4nO1xuICB9XG5cbiAgaWYgKG9wdF9wcm90ZWN0RXNjYXBlZENoYXJhY3RlcnMpIHtcbiAgICBzdHIgPSBnb29nLnN0cmluZy5odG1sRXNjYXBlKHN0cik7XG4gIH1cblxuICByZXR1cm4gc3RyO1xufTtcblxuXG4vKipcbiAqIFRydW5jYXRlIGEgc3RyaW5nIGluIHRoZSBtaWRkbGUsIGFkZGluZyBcIi4uLlwiIGlmIG5lY2Vzc2FyeSxcbiAqIGFuZCBmYXZvcmluZyB0aGUgYmVnaW5uaW5nIG9mIHRoZSBzdHJpbmcuXG4gKiBAcGFyYW0ge3N0cmluZ30gc3RyIFRoZSBzdHJpbmcgdG8gdHJ1bmNhdGUgdGhlIG1pZGRsZSBvZi5cbiAqIEBwYXJhbSB7bnVtYmVyfSBjaGFycyBNYXggbnVtYmVyIG9mIGNoYXJhY3RlcnMuXG4gKiBAcGFyYW0ge2Jvb2xlYW49fSBvcHRfcHJvdGVjdEVzY2FwZWRDaGFyYWN0ZXJzIFdoZXRoZXIgdG8gcHJvdGVjdCBlc2NhcGVkXG4gKiAgICAgY2hhcmFjdGVycyBmcm9tIGJlaW5nIGN1dG9mZiBpbiB0aGUgbWlkZGxlLlxuICogQHBhcmFtIHtudW1iZXI9fSBvcHRfdHJhaWxpbmdDaGFycyBPcHRpb25hbCBudW1iZXIgb2YgdHJhaWxpbmcgY2hhcmFjdGVycyB0b1xuICogICAgIGxlYXZlIGF0IHRoZSBlbmQgb2YgdGhlIHN0cmluZywgaW5zdGVhZCBvZiB0cnVuY2F0aW5nIGFzIGNsb3NlIHRvIHRoZVxuICogICAgIG1pZGRsZSBhcyBwb3NzaWJsZS5cbiAqIEByZXR1cm4ge3N0cmluZ30gQSB0cnVuY2F0ZWQgY29weSBvZiBgc3RyYC5cbiAqL1xuZ29vZy5zdHJpbmcudHJ1bmNhdGVNaWRkbGUgPSBmdW5jdGlvbihcbiAgICBzdHIsIGNoYXJzLCBvcHRfcHJvdGVjdEVzY2FwZWRDaGFyYWN0ZXJzLCBvcHRfdHJhaWxpbmdDaGFycykge1xuICAndXNlIHN0cmljdCc7XG4gIGlmIChvcHRfcHJvdGVjdEVzY2FwZWRDaGFyYWN0ZXJzKSB7XG4gICAgc3RyID0gZ29vZy5zdHJpbmcudW5lc2NhcGVFbnRpdGllcyhzdHIpO1xuICB9XG5cbiAgaWYgKG9wdF90cmFpbGluZ0NoYXJzICYmIHN0ci5sZW5ndGggPiBjaGFycykge1xuICAgIGlmIChvcHRfdHJhaWxpbmdDaGFycyA+IGNoYXJzKSB7XG4gICAgICBvcHRfdHJhaWxpbmdDaGFycyA9IGNoYXJzO1xuICAgIH1cbiAgICBjb25zdCBlbmRQb2ludCA9IHN0ci5sZW5ndGggLSBvcHRfdHJhaWxpbmdDaGFycztcbiAgICBjb25zdCBzdGFydFBvaW50ID0gY2hhcnMgLSBvcHRfdHJhaWxpbmdDaGFycztcbiAgICBzdHIgPSBzdHIuc3Vic3RyaW5nKDAsIHN0YXJ0UG9pbnQpICsgJy4uLicgKyBzdHIuc3Vic3RyaW5nKGVuZFBvaW50KTtcbiAgfSBlbHNlIGlmIChzdHIubGVuZ3RoID4gY2hhcnMpIHtcbiAgICAvLyBGYXZvciB0aGUgYmVnaW5uaW5nIG9mIHRoZSBzdHJpbmc6XG4gICAgbGV0IGhhbGYgPSBNYXRoLmZsb29yKGNoYXJzIC8gMik7XG4gICAgY29uc3QgZW5kUG9zID0gc3RyLmxlbmd0aCAtIGhhbGY7XG4gICAgaGFsZiArPSBjaGFycyAlIDI7XG4gICAgc3RyID0gc3RyLnN1YnN0cmluZygwLCBoYWxmKSArICcuLi4nICsgc3RyLnN1YnN0cmluZyhlbmRQb3MpO1xuICB9XG5cbiAgaWYgKG9wdF9wcm90ZWN0RXNjYXBlZENoYXJhY3RlcnMpIHtcbiAgICBzdHIgPSBnb29nLnN0cmluZy5odG1sRXNjYXBlKHN0cik7XG4gIH1cblxuICByZXR1cm4gc3RyO1xufTtcblxuXG4vKipcbiAqIFNwZWNpYWwgY2hhcnMgdGhhdCBuZWVkIHRvIGJlIGVzY2FwZWQgZm9yIGdvb2cuc3RyaW5nLnF1b3RlLlxuICogQHByaXZhdGUgeyFPYmplY3Q8c3RyaW5nLCBzdHJpbmc+fVxuICovXG5nb29nLnN0cmluZy5zcGVjaWFsRXNjYXBlQ2hhcnNfID0ge1xuICAnXFwwJzogJ1xcXFwwJyxcbiAgJ1xcYic6ICdcXFxcYicsXG4gICdcXGYnOiAnXFxcXGYnLFxuICAnXFxuJzogJ1xcXFxuJyxcbiAgJ1xccic6ICdcXFxccicsXG4gICdcXHQnOiAnXFxcXHQnLFxuICAnXFx4MEInOiAnXFxcXHgwQicsICAvLyAnXFx2JyBpcyBub3Qgc3VwcG9ydGVkIGluIEpTY3JpcHRcbiAgJ1wiJzogJ1xcXFxcIicsXG4gICdcXFxcJzogJ1xcXFxcXFxcJyxcbiAgLy8gVG8gc3VwcG9ydCB0aGUgdXNlIGNhc2Ugb2YgZW1iZWRkaW5nIHF1b3RlZCBzdHJpbmdzIGluc2lkZSBvZiBzY3JpcHRcbiAgLy8gdGFncywgd2UgaGF2ZSB0byBtYWtlIHN1cmUgSFRNTCBjb21tZW50cyBhbmQgb3BlbmluZy9jbG9zaW5nIHNjcmlwdCB0YWdzIGRvXG4gIC8vIG5vdCBhcHBlYXIgaW4gdGhlIHJlc3VsdGluZyBzdHJpbmcuIFRoZSBzcGVjaWZpYyBzdHJpbmdzIHRoYXQgbXVzdCBiZVxuICAvLyBlc2NhcGVkIGFyZSBkb2N1bWVudGVkIGF0OlxuICAvLyBodHRwczovL2h0bWwuc3BlYy53aGF0d2cub3JnL211bHRpcGFnZS9zY3JpcHRpbmcuaHRtbCNyZXN0cmljdGlvbnMtZm9yLWNvbnRlbnRzLW9mLXNjcmlwdC1lbGVtZW50c1xuICAnPCc6ICdcXFxcdTAwM0MnICAvLyBOT1RFOiBKU09OLnBhcnNlIGNyYXNoZXMgb24gJ1xcXFx4M2MnLlxufTtcblxuXG4vKipcbiAqIENoYXJhY3RlciBtYXBwaW5ncyB1c2VkIGludGVybmFsbHkgZm9yIGdvb2cuc3RyaW5nLmVzY2FwZUNoYXIuXG4gKiBAcHJpdmF0ZSB7IU9iamVjdDxzdHJpbmcsIHN0cmluZz59XG4gKi9cbmdvb2cuc3RyaW5nLmpzRXNjYXBlQ2FjaGVfID0ge1xuICAnXFwnJzogJ1xcXFxcXCcnXG59O1xuXG5cbi8qKlxuICogRW5jbG9zZXMgYSBzdHJpbmcgaW4gZG91YmxlIHF1b3RlcyBhbmQgZXNjYXBlcyBjaGFyYWN0ZXJzIHNvIHRoYXQgdGhlXG4gKiBzdHJpbmcgaXMgYSB2YWxpZCBKUyBzdHJpbmcuIFRoZSByZXN1bHRpbmcgc3RyaW5nIGlzIHNhZmUgdG8gZW1iZWQgaW5cbiAqIGA8c2NyaXB0PmAgdGFncyBhcyBcIjxcIiBpcyBlc2NhcGVkLlxuICogQHBhcmFtIHtzdHJpbmd9IHMgVGhlIHN0cmluZyB0byBxdW90ZS5cbiAqIEByZXR1cm4ge3N0cmluZ30gQSBjb3B5IG9mIGBzYCBzdXJyb3VuZGVkIGJ5IGRvdWJsZSBxdW90ZXMuXG4gKi9cbmdvb2cuc3RyaW5nLnF1b3RlID0gZnVuY3Rpb24ocykge1xuICAndXNlIHN0cmljdCc7XG4gIHMgPSBTdHJpbmcocyk7XG4gIGNvbnN0IHNiID0gWydcIiddO1xuICBmb3IgKGxldCBpID0gMDsgaSA8IHMubGVuZ3RoOyBpKyspIHtcbiAgICBjb25zdCBjaCA9IHMuY2hhckF0KGkpO1xuICAgIGNvbnN0IGNjID0gY2guY2hhckNvZGVBdCgwKTtcbiAgICBzYltpICsgMV0gPSBnb29nLnN0cmluZy5zcGVjaWFsRXNjYXBlQ2hhcnNfW2NoXSB8fFxuICAgICAgICAoKGNjID4gMzEgJiYgY2MgPCAxMjcpID8gY2ggOiBnb29nLnN0cmluZy5lc2NhcGVDaGFyKGNoKSk7XG4gIH1cbiAgc2IucHVzaCgnXCInKTtcbiAgcmV0dXJuIHNiLmpvaW4oJycpO1xufTtcblxuXG4vKipcbiAqIFRha2VzIGEgc3RyaW5nIGFuZCByZXR1cm5zIHRoZSBlc2NhcGVkIHN0cmluZyBmb3IgdGhhdCBpbnB1dCBzdHJpbmcuXG4gKiBAcGFyYW0ge3N0cmluZ30gc3RyIFRoZSBzdHJpbmcgdG8gZXNjYXBlLlxuICogQHJldHVybiB7c3RyaW5nfSBBbiBlc2NhcGVkIHN0cmluZyByZXByZXNlbnRpbmcgYHN0cmAuXG4gKi9cbmdvb2cuc3RyaW5nLmVzY2FwZVN0cmluZyA9IGZ1bmN0aW9uKHN0cikge1xuICAndXNlIHN0cmljdCc7XG4gIGNvbnN0IHNiID0gW107XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgc3RyLmxlbmd0aDsgaSsrKSB7XG4gICAgc2JbaV0gPSBnb29nLnN0cmluZy5lc2NhcGVDaGFyKHN0ci5jaGFyQXQoaSkpO1xuICB9XG4gIHJldHVybiBzYi5qb2luKCcnKTtcbn07XG5cblxuLyoqXG4gKiBUYWtlcyBhIGNoYXJhY3RlciBhbmQgcmV0dXJucyB0aGUgZXNjYXBlZCBzdHJpbmcgZm9yIHRoYXQgY2hhcmFjdGVyLiBGb3JcbiAqIGV4YW1wbGUgZXNjYXBlQ2hhcihTdHJpbmcuZnJvbUNoYXJDb2RlKDE1KSkgLT4gXCJcXFxceDBFXCIuXG4gKiBAcGFyYW0ge3N0cmluZ30gYyBUaGUgY2hhcmFjdGVyIHRvIGVzY2FwZS5cbiAqIEByZXR1cm4ge3N0cmluZ30gQW4gZXNjYXBlZCBzdHJpbmcgcmVwcmVzZW50aW5nIGBjYC5cbiAqL1xuZ29vZy5zdHJpbmcuZXNjYXBlQ2hhciA9IGZ1bmN0aW9uKGMpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBpZiAoYyBpbiBnb29nLnN0cmluZy5qc0VzY2FwZUNhY2hlXykge1xuICAgIHJldHVybiBnb29nLnN0cmluZy5qc0VzY2FwZUNhY2hlX1tjXTtcbiAgfVxuXG4gIGlmIChjIGluIGdvb2cuc3RyaW5nLnNwZWNpYWxFc2NhcGVDaGFyc18pIHtcbiAgICByZXR1cm4gZ29vZy5zdHJpbmcuanNFc2NhcGVDYWNoZV9bY10gPSBnb29nLnN0cmluZy5zcGVjaWFsRXNjYXBlQ2hhcnNfW2NdO1xuICB9XG5cbiAgbGV0IHJ2ID0gYztcbiAgY29uc3QgY2MgPSBjLmNoYXJDb2RlQXQoMCk7XG4gIGlmIChjYyA+IDMxICYmIGNjIDwgMTI3KSB7XG4gICAgcnYgPSBjO1xuICB9IGVsc2Uge1xuICAgIC8vIHRhYiBpcyA5IGJ1dCBoYW5kbGVkIGFib3ZlXG4gICAgaWYgKGNjIDwgMjU2KSB7XG4gICAgICBydiA9ICdcXFxceCc7XG4gICAgICBpZiAoY2MgPCAxNiB8fCBjYyA+IDI1Nikge1xuICAgICAgICBydiArPSAnMCc7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHJ2ID0gJ1xcXFx1JztcbiAgICAgIGlmIChjYyA8IDQwOTYpIHsgIC8vIFxcdTEwMDBcbiAgICAgICAgcnYgKz0gJzAnO1xuICAgICAgfVxuICAgIH1cbiAgICBydiArPSBjYy50b1N0cmluZygxNikudG9VcHBlckNhc2UoKTtcbiAgfVxuXG4gIHJldHVybiBnb29nLnN0cmluZy5qc0VzY2FwZUNhY2hlX1tjXSA9IHJ2O1xufTtcblxuXG4vKipcbiAqIERldGVybWluZXMgd2hldGhlciBhIHN0cmluZyBjb250YWlucyBhIHN1YnN0cmluZy5cbiAqIEBwYXJhbSB7c3RyaW5nfSBzdHIgVGhlIHN0cmluZyB0byBzZWFyY2guXG4gKiBAcGFyYW0ge3N0cmluZ30gc3ViU3RyaW5nIFRoZSBzdWJzdHJpbmcgdG8gc2VhcmNoIGZvci5cbiAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgYHN0cmAgY29udGFpbnMgYHN1YlN0cmluZ2AuXG4gKi9cbmdvb2cuc3RyaW5nLmNvbnRhaW5zID0gZ29vZy5zdHJpbmcuaW50ZXJuYWwuY29udGFpbnM7XG5cblxuLyoqXG4gKiBEZXRlcm1pbmVzIHdoZXRoZXIgYSBzdHJpbmcgY29udGFpbnMgYSBzdWJzdHJpbmcsIGlnbm9yaW5nIGNhc2UuXG4gKiBAcGFyYW0ge3N0cmluZ30gc3RyIFRoZSBzdHJpbmcgdG8gc2VhcmNoLlxuICogQHBhcmFtIHtzdHJpbmd9IHN1YlN0cmluZyBUaGUgc3Vic3RyaW5nIHRvIHNlYXJjaCBmb3IuXG4gKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIGBzdHJgIGNvbnRhaW5zIGBzdWJTdHJpbmdgLlxuICovXG5nb29nLnN0cmluZy5jYXNlSW5zZW5zaXRpdmVDb250YWlucyA9XG4gICAgZ29vZy5zdHJpbmcuaW50ZXJuYWwuY2FzZUluc2Vuc2l0aXZlQ29udGFpbnM7XG5cblxuLyoqXG4gKiBSZXR1cm5zIHRoZSBub24tb3ZlcmxhcHBpbmcgb2NjdXJyZW5jZXMgb2Ygc3MgaW4gcy5cbiAqIElmIGVpdGhlciBzIG9yIHNzIGV2YWx1dGVzIHRvIGZhbHNlLCB0aGVuIHJldHVybnMgemVyby5cbiAqIEBwYXJhbSB7c3RyaW5nfSBzIFRoZSBzdHJpbmcgdG8gbG9vayBpbi5cbiAqIEBwYXJhbSB7c3RyaW5nfSBzcyBUaGUgc3RyaW5nIHRvIGxvb2sgZm9yLlxuICogQHJldHVybiB7bnVtYmVyfSBOdW1iZXIgb2Ygb2NjdXJyZW5jZXMgb2Ygc3MgaW4gcy5cbiAqL1xuZ29vZy5zdHJpbmcuY291bnRPZiA9IGZ1bmN0aW9uKHMsIHNzKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmV0dXJuIHMgJiYgc3MgPyBzLnNwbGl0KHNzKS5sZW5ndGggLSAxIDogMDtcbn07XG5cblxuLyoqXG4gKiBSZW1vdmVzIGEgc3Vic3RyaW5nIG9mIGEgc3BlY2lmaWVkIGxlbmd0aCBhdCBhIHNwZWNpZmljXG4gKiBpbmRleCBpbiBhIHN0cmluZy5cbiAqIEBwYXJhbSB7c3RyaW5nfSBzIFRoZSBiYXNlIHN0cmluZyBmcm9tIHdoaWNoIHRvIHJlbW92ZS5cbiAqIEBwYXJhbSB7bnVtYmVyfSBpbmRleCBUaGUgaW5kZXggYXQgd2hpY2ggdG8gcmVtb3ZlIHRoZSBzdWJzdHJpbmcuXG4gKiBAcGFyYW0ge251bWJlcn0gc3RyaW5nTGVuZ3RoIFRoZSBsZW5ndGggb2YgdGhlIHN1YnN0cmluZyB0byByZW1vdmUuXG4gKiBAcmV0dXJuIHtzdHJpbmd9IEEgY29weSBvZiBgc2Agd2l0aCB0aGUgc3Vic3RyaW5nIHJlbW92ZWQgb3IgdGhlIGZ1bGxcbiAqICAgICBzdHJpbmcgaWYgbm90aGluZyBpcyByZW1vdmVkIG9yIHRoZSBpbnB1dCBpcyBpbnZhbGlkLlxuICovXG5nb29nLnN0cmluZy5yZW1vdmVBdCA9IGZ1bmN0aW9uKHMsIGluZGV4LCBzdHJpbmdMZW5ndGgpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBsZXQgcmVzdWx0U3RyID0gcztcbiAgLy8gSWYgdGhlIGluZGV4IGlzIGdyZWF0ZXIgb3IgZXF1YWwgdG8gMCB0aGVuIHJlbW92ZSBzdWJzdHJpbmdcbiAgaWYgKGluZGV4ID49IDAgJiYgaW5kZXggPCBzLmxlbmd0aCAmJiBzdHJpbmdMZW5ndGggPiAwKSB7XG4gICAgcmVzdWx0U3RyID0gcy5zdWJzdHIoMCwgaW5kZXgpICtcbiAgICAgICAgcy5zdWJzdHIoaW5kZXggKyBzdHJpbmdMZW5ndGgsIHMubGVuZ3RoIC0gaW5kZXggLSBzdHJpbmdMZW5ndGgpO1xuICB9XG4gIHJldHVybiByZXN1bHRTdHI7XG59O1xuXG5cbi8qKlxuICogUmVtb3ZlcyB0aGUgZmlyc3Qgb2NjdXJyZW5jZSBvZiBhIHN1YnN0cmluZyBmcm9tIGEgc3RyaW5nLlxuICogQHBhcmFtIHtzdHJpbmd9IHN0ciBUaGUgYmFzZSBzdHJpbmcgZnJvbSB3aGljaCB0byByZW1vdmUuXG4gKiBAcGFyYW0ge3N0cmluZ30gc3Vic3RyIFRoZSBzdHJpbmcgdG8gcmVtb3ZlLlxuICogQHJldHVybiB7c3RyaW5nfSBBIGNvcHkgb2YgYHN0cmAgd2l0aCBgc3Vic3RyYCByZW1vdmVkIG9yIHRoZVxuICogICAgIGZ1bGwgc3RyaW5nIGlmIG5vdGhpbmcgaXMgcmVtb3ZlZC5cbiAqL1xuZ29vZy5zdHJpbmcucmVtb3ZlID0gZnVuY3Rpb24oc3RyLCBzdWJzdHIpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gc3RyLnJlcGxhY2Uoc3Vic3RyLCAnJyk7XG59O1xuXG5cbi8qKlxuICogIFJlbW92ZXMgYWxsIG9jY3VycmVuY2VzIG9mIGEgc3Vic3RyaW5nIGZyb20gYSBzdHJpbmcuXG4gKiAgQHBhcmFtIHtzdHJpbmd9IHMgVGhlIGJhc2Ugc3RyaW5nIGZyb20gd2hpY2ggdG8gcmVtb3ZlLlxuICogIEBwYXJhbSB7c3RyaW5nfSBzcyBUaGUgc3RyaW5nIHRvIHJlbW92ZS5cbiAqICBAcmV0dXJuIHtzdHJpbmd9IEEgY29weSBvZiBgc2Agd2l0aCBgc3NgIHJlbW92ZWQgb3IgdGhlIGZ1bGxcbiAqICAgICAgc3RyaW5nIGlmIG5vdGhpbmcgaXMgcmVtb3ZlZC5cbiAqL1xuZ29vZy5zdHJpbmcucmVtb3ZlQWxsID0gZnVuY3Rpb24ocywgc3MpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBjb25zdCByZSA9IG5ldyBSZWdFeHAoZ29vZy5zdHJpbmcucmVnRXhwRXNjYXBlKHNzKSwgJ2cnKTtcbiAgcmV0dXJuIHMucmVwbGFjZShyZSwgJycpO1xufTtcblxuXG4vKipcbiAqICBSZXBsYWNlcyBhbGwgb2NjdXJyZW5jZXMgb2YgYSBzdWJzdHJpbmcgb2YgYSBzdHJpbmcgd2l0aCBhIG5ldyBzdWJzdHJpbmcuXG4gKiAgQHBhcmFtIHtzdHJpbmd9IHMgVGhlIGJhc2Ugc3RyaW5nIGZyb20gd2hpY2ggdG8gcmVtb3ZlLlxuICogIEBwYXJhbSB7c3RyaW5nfSBzcyBUaGUgc3RyaW5nIHRvIHJlcGxhY2UuXG4gKiAgQHBhcmFtIHtzdHJpbmd9IHJlcGxhY2VtZW50IFRoZSByZXBsYWNlbWVudCBzdHJpbmcuXG4gKiAgQHJldHVybiB7c3RyaW5nfSBBIGNvcHkgb2YgYHNgIHdpdGggYHNzYCByZXBsYWNlZCBieVxuICogICAgICBgcmVwbGFjZW1lbnRgIG9yIHRoZSBvcmlnaW5hbCBzdHJpbmcgaWYgbm90aGluZyBpcyByZXBsYWNlZC5cbiAqL1xuZ29vZy5zdHJpbmcucmVwbGFjZUFsbCA9IGZ1bmN0aW9uKHMsIHNzLCByZXBsYWNlbWVudCkge1xuICAndXNlIHN0cmljdCc7XG4gIGNvbnN0IHJlID0gbmV3IFJlZ0V4cChnb29nLnN0cmluZy5yZWdFeHBFc2NhcGUoc3MpLCAnZycpO1xuICByZXR1cm4gcy5yZXBsYWNlKHJlLCByZXBsYWNlbWVudC5yZXBsYWNlKC9cXCQvZywgJyQkJCQnKSk7XG59O1xuXG5cbi8qKlxuICogRXNjYXBlcyBjaGFyYWN0ZXJzIGluIHRoZSBzdHJpbmcgdGhhdCBhcmUgbm90IHNhZmUgdG8gdXNlIGluIGEgUmVnRXhwLlxuICogQHBhcmFtIHsqfSBzIFRoZSBzdHJpbmcgdG8gZXNjYXBlLiBJZiBub3QgYSBzdHJpbmcsIGl0IHdpbGwgYmUgY2FzdGVkXG4gKiAgICAgdG8gb25lLlxuICogQHJldHVybiB7c3RyaW5nfSBBIFJlZ0V4cCBzYWZlLCBlc2NhcGVkIGNvcHkgb2YgYHNgLlxuICovXG5nb29nLnN0cmluZy5yZWdFeHBFc2NhcGUgPSBmdW5jdGlvbihzKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmV0dXJuIFN0cmluZyhzKVxuICAgICAgLnJlcGxhY2UoLyhbLSgpXFxbXFxde30rPyouJFxcXnwsOiM8IVxcXFxdKS9nLCAnXFxcXCQxJylcbiAgICAgIC5yZXBsYWNlKC9cXHgwOC9nLCAnXFxcXHgwOCcpO1xufTtcblxuXG4vKipcbiAqIFJlcGVhdHMgYSBzdHJpbmcgbiB0aW1lcy5cbiAqIEBwYXJhbSB7c3RyaW5nfSBzdHJpbmcgVGhlIHN0cmluZyB0byByZXBlYXQuXG4gKiBAcGFyYW0ge251bWJlcn0gbGVuZ3RoIFRoZSBudW1iZXIgb2YgdGltZXMgdG8gcmVwZWF0LlxuICogQHJldHVybiB7c3RyaW5nfSBBIHN0cmluZyBjb250YWluaW5nIGBsZW5ndGhgIHJlcGV0aXRpb25zIG9mXG4gKiAgICAgYHN0cmluZ2AuXG4gKi9cbmdvb2cuc3RyaW5nLnJlcGVhdCA9IChTdHJpbmcucHJvdG90eXBlLnJlcGVhdCkgPyBmdW5jdGlvbihzdHJpbmcsIGxlbmd0aCkge1xuICAndXNlIHN0cmljdCc7XG4gIC8vIFRoZSBuYXRpdmUgbWV0aG9kIGlzIG92ZXIgMTAwIHRpbWVzIGZhc3RlciB0aGFuIHRoZSBhbHRlcm5hdGl2ZS5cbiAgcmV0dXJuIHN0cmluZy5yZXBlYXQobGVuZ3RoKTtcbn0gOiBmdW5jdGlvbihzdHJpbmcsIGxlbmd0aCkge1xuICAndXNlIHN0cmljdCc7XG4gIHJldHVybiBuZXcgQXJyYXkobGVuZ3RoICsgMSkuam9pbihzdHJpbmcpO1xufTtcblxuXG4vKipcbiAqIFBhZHMgbnVtYmVyIHRvIGdpdmVuIGxlbmd0aCBhbmQgb3B0aW9uYWxseSByb3VuZHMgaXQgdG8gYSBnaXZlbiBwcmVjaXNpb24uXG4gKiBGb3IgZXhhbXBsZTpcbiAqIDxwcmU+cGFkTnVtYmVyKDEuMjUsIDIsIDMpIC0+ICcwMS4yNTAnXG4gKiBwYWROdW1iZXIoMS4yNSwgMikgLT4gJzAxLjI1J1xuICogcGFkTnVtYmVyKDEuMjUsIDIsIDEpIC0+ICcwMS4zJ1xuICogcGFkTnVtYmVyKDEuMjUsIDApIC0+ICcxLjI1JzwvcHJlPlxuICpcbiAqIEBwYXJhbSB7bnVtYmVyfSBudW0gVGhlIG51bWJlciB0byBwYWQuXG4gKiBAcGFyYW0ge251bWJlcn0gbGVuZ3RoIFRoZSBkZXNpcmVkIGxlbmd0aC5cbiAqIEBwYXJhbSB7bnVtYmVyPX0gb3B0X3ByZWNpc2lvbiBUaGUgZGVzaXJlZCBwcmVjaXNpb24uXG4gKiBAcmV0dXJuIHtzdHJpbmd9IGBudW1gIGFzIGEgc3RyaW5nIHdpdGggdGhlIGdpdmVuIG9wdGlvbnMuXG4gKi9cbmdvb2cuc3RyaW5nLnBhZE51bWJlciA9IGZ1bmN0aW9uKG51bSwgbGVuZ3RoLCBvcHRfcHJlY2lzaW9uKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgY29uc3QgcyA9XG4gICAgICAob3B0X3ByZWNpc2lvbiAhPT0gdW5kZWZpbmVkKSA/IG51bS50b0ZpeGVkKG9wdF9wcmVjaXNpb24pIDogU3RyaW5nKG51bSk7XG4gIGxldCBpbmRleCA9IHMuaW5kZXhPZignLicpO1xuICBpZiAoaW5kZXggPT0gLTEpIHtcbiAgICBpbmRleCA9IHMubGVuZ3RoO1xuICB9XG4gIHJldHVybiBnb29nLnN0cmluZy5yZXBlYXQoJzAnLCBNYXRoLm1heCgwLCBsZW5ndGggLSBpbmRleCkpICsgcztcbn07XG5cblxuLyoqXG4gKiBSZXR1cm5zIGEgc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBnaXZlbiBvYmplY3QsIHdpdGhcbiAqIG51bGwgYW5kIHVuZGVmaW5lZCBiZWluZyByZXR1cm5lZCBhcyB0aGUgZW1wdHkgc3RyaW5nLlxuICpcbiAqIEBwYXJhbSB7Kn0gb2JqIFRoZSBvYmplY3QgdG8gY29udmVydC5cbiAqIEByZXR1cm4ge3N0cmluZ30gQSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhlIGBvYmpgLlxuICovXG5nb29nLnN0cmluZy5tYWtlU2FmZSA9IGZ1bmN0aW9uKG9iaikge1xuICAndXNlIHN0cmljdCc7XG4gIHJldHVybiBvYmogPT0gbnVsbCA/ICcnIDogU3RyaW5nKG9iaik7XG59O1xuXG5cbi8qKlxuICogQ29uY2F0ZW5hdGVzIHN0cmluZyBleHByZXNzaW9ucy4gVGhpcyBpcyB1c2VmdWxcbiAqIHNpbmNlIHNvbWUgYnJvd3NlcnMgYXJlIHZlcnkgaW5lZmZpY2llbnQgd2hlbiBpdCBjb21lcyB0byB1c2luZyBwbHVzIHRvXG4gKiBjb25jYXQgc3RyaW5ncy4gQmUgY2FyZWZ1bCB3aGVuIHVzaW5nIG51bGwgYW5kIHVuZGVmaW5lZCBoZXJlIHNpbmNlXG4gKiB0aGVzZSB3aWxsIG5vdCBiZSBpbmNsdWRlZCBpbiB0aGUgcmVzdWx0LiBJZiB5b3UgbmVlZCB0byByZXByZXNlbnQgdGhlc2VcbiAqIGJlIHN1cmUgdG8gY2FzdCB0aGUgYXJndW1lbnQgdG8gYSBTdHJpbmcgZmlyc3QuXG4gKiBGb3IgZXhhbXBsZTpcbiAqIDxwcmU+YnVpbGRTdHJpbmcoJ2EnLCAnYicsICdjJywgJ2QnKSAtPiAnYWJjZCdcbiAqIGJ1aWxkU3RyaW5nKG51bGwsIHVuZGVmaW5lZCkgLT4gJydcbiAqIDwvcHJlPlxuICogQHBhcmFtIHsuLi4qfSB2YXJfYXJncyBBIGxpc3Qgb2Ygc3RyaW5ncyB0byBjb25jYXRlbmF0ZS4gSWYgbm90IGEgc3RyaW5nLFxuICogICAgIGl0IHdpbGwgYmUgY2FzdGVkIHRvIG9uZS5cbiAqIEByZXR1cm4ge3N0cmluZ30gVGhlIGNvbmNhdGVuYXRpb24gb2YgYHZhcl9hcmdzYC5cbiAqL1xuZ29vZy5zdHJpbmcuYnVpbGRTdHJpbmcgPSBmdW5jdGlvbih2YXJfYXJncykge1xuICAndXNlIHN0cmljdCc7XG4gIHJldHVybiBBcnJheS5wcm90b3R5cGUuam9pbi5jYWxsKGFyZ3VtZW50cywgJycpO1xufTtcblxuXG4vKipcbiAqIFJldHVybnMgYSBzdHJpbmcgd2l0aCBhdCBsZWFzdCA2NC1iaXRzIG9mIHJhbmRvbW5lc3MuXG4gKlxuICogRG9lc24ndCB0cnVzdCBKYXZhU2NyaXB0J3MgcmFuZG9tIGZ1bmN0aW9uIGVudGlyZWx5LiBVc2VzIGEgY29tYmluYXRpb24gb2ZcbiAqIHJhbmRvbSBhbmQgY3VycmVudCB0aW1lc3RhbXAsIGFuZCB0aGVuIGVuY29kZXMgdGhlIHN0cmluZyBpbiBiYXNlLTM2IHRvXG4gKiBtYWtlIGl0IHNob3J0ZXIuXG4gKlxuICogQHJldHVybiB7c3RyaW5nfSBBIHJhbmRvbSBzdHJpbmcsIGUuZy4gc24xczd2YjRnY2ljLlxuICovXG5nb29nLnN0cmluZy5nZXRSYW5kb21TdHJpbmcgPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBjb25zdCB4ID0gMjE0NzQ4MzY0ODtcbiAgcmV0dXJuIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIHgpLnRvU3RyaW5nKDM2KSArXG4gICAgICBNYXRoLmFicyhNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiB4KSBeIGdvb2cubm93KCkpLnRvU3RyaW5nKDM2KTtcbn07XG5cblxuLyoqXG4gKiBDb21wYXJlcyB0d28gdmVyc2lvbiBudW1iZXJzLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfG51bWJlcn0gdmVyc2lvbjEgVmVyc2lvbiBvZiBmaXJzdCBpdGVtLlxuICogQHBhcmFtIHtzdHJpbmd8bnVtYmVyfSB2ZXJzaW9uMiBWZXJzaW9uIG9mIHNlY29uZCBpdGVtLlxuICpcbiAqIEByZXR1cm4ge251bWJlcn0gIDEgaWYgYHZlcnNpb24xYCBpcyBoaWdoZXIuXG4gKiAgICAgICAgICAgICAgICAgICAwIGlmIGFyZ3VtZW50cyBhcmUgZXF1YWwuXG4gKiAgICAgICAgICAgICAgICAgIC0xIGlmIGB2ZXJzaW9uMmAgaXMgaGlnaGVyLlxuICovXG5nb29nLnN0cmluZy5jb21wYXJlVmVyc2lvbnMgPSBnb29nLnN0cmluZy5pbnRlcm5hbC5jb21wYXJlVmVyc2lvbnM7XG5cblxuLyoqXG4gKiBTdHJpbmcgaGFzaCBmdW5jdGlvbiBzaW1pbGFyIHRvIGphdmEubGFuZy5TdHJpbmcuaGFzaENvZGUoKS5cbiAqIFRoZSBoYXNoIGNvZGUgZm9yIGEgc3RyaW5nIGlzIGNvbXB1dGVkIGFzXG4gKiBzWzBdICogMzEgXiAobiAtIDEpICsgc1sxXSAqIDMxIF4gKG4gLSAyKSArIC4uLiArIHNbbiAtIDFdLFxuICogd2hlcmUgc1tpXSBpcyB0aGUgaXRoIGNoYXJhY3RlciBvZiB0aGUgc3RyaW5nIGFuZCBuIGlzIHRoZSBsZW5ndGggb2ZcbiAqIHRoZSBzdHJpbmcuIFdlIG1vZCB0aGUgcmVzdWx0IHRvIG1ha2UgaXQgYmV0d2VlbiAwIChpbmNsdXNpdmUpIGFuZCAyXjMyXG4gKiAoZXhjbHVzaXZlKS5cbiAqIEBwYXJhbSB7c3RyaW5nfSBzdHIgQSBzdHJpbmcuXG4gKiBAcmV0dXJuIHtudW1iZXJ9IEhhc2ggdmFsdWUgZm9yIGBzdHJgLCBiZXR3ZWVuIDAgKGluY2x1c2l2ZSkgYW5kIDJeMzJcbiAqICAoZXhjbHVzaXZlKS4gVGhlIGVtcHR5IHN0cmluZyByZXR1cm5zIDAuXG4gKi9cbmdvb2cuc3RyaW5nLmhhc2hDb2RlID0gZnVuY3Rpb24oc3RyKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgbGV0IHJlc3VsdCA9IDA7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgc3RyLmxlbmd0aDsgKytpKSB7XG4gICAgLy8gTm9ybWFsaXplIHRvIDQgYnl0ZSByYW5nZSwgMCAuLi4gMl4zMi5cbiAgICByZXN1bHQgPSAoMzEgKiByZXN1bHQgKyBzdHIuY2hhckNvZGVBdChpKSkgPj4+IDA7XG4gIH1cbiAgcmV0dXJuIHJlc3VsdDtcbn07XG5cblxuLyoqXG4gKiBUaGUgbW9zdCByZWNlbnQgdW5pcXVlIElELiB8MCBpcyBlcXVpdmFsZW50IHRvIE1hdGguZmxvb3IgaW4gdGhpcyBjYXNlLlxuICogQHR5cGUge251bWJlcn1cbiAqIEBwcml2YXRlXG4gKi9cbmdvb2cuc3RyaW5nLnVuaXF1ZVN0cmluZ0NvdW50ZXJfID0gTWF0aC5yYW5kb20oKSAqIDB4ODAwMDAwMDAgfCAwO1xuXG5cbi8qKlxuICogR2VuZXJhdGVzIGFuZCByZXR1cm5zIGEgc3RyaW5nIHdoaWNoIGlzIHVuaXF1ZSBpbiB0aGUgY3VycmVudCBkb2N1bWVudC5cbiAqIFRoaXMgaXMgdXNlZnVsLCBmb3IgZXhhbXBsZSwgdG8gY3JlYXRlIHVuaXF1ZSBJRHMgZm9yIERPTSBlbGVtZW50cy5cbiAqIEByZXR1cm4ge3N0cmluZ30gQSB1bmlxdWUgaWQuXG4gKi9cbmdvb2cuc3RyaW5nLmNyZWF0ZVVuaXF1ZVN0cmluZyA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIHJldHVybiAnZ29vZ18nICsgZ29vZy5zdHJpbmcudW5pcXVlU3RyaW5nQ291bnRlcl8rKztcbn07XG5cblxuLyoqXG4gKiBDb252ZXJ0cyB0aGUgc3VwcGxpZWQgc3RyaW5nIHRvIGEgbnVtYmVyLCB3aGljaCBtYXkgYmUgSW5maW5pdHkgb3IgTmFOLlxuICogVGhpcyBmdW5jdGlvbiBzdHJpcHMgd2hpdGVzcGFjZTogKHRvTnVtYmVyKCcgMTIzJykgPT09IDEyMylcbiAqIFRoaXMgZnVuY3Rpb24gYWNjZXB0cyBzY2llbnRpZmljIG5vdGF0aW9uOiAodG9OdW1iZXIoJzFlMScpID09PSAxMClcbiAqXG4gKiBUaGlzIGlzIGJldHRlciB0aGFuIEphdmFTY3JpcHQncyBidWlsdC1pbiBjb252ZXJzaW9ucyBiZWNhdXNlLCBzYWRseTpcbiAqICAgICAoTnVtYmVyKCcgJykgPT09IDApIGFuZCAocGFyc2VGbG9hdCgnMTIzYScpID09PSAxMjMpXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHN0ciBUaGUgc3RyaW5nIHRvIGNvbnZlcnQuXG4gKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBudW1iZXIgdGhlIHN1cHBsaWVkIHN0cmluZyByZXByZXNlbnRzLCBvciBOYU4uXG4gKi9cbmdvb2cuc3RyaW5nLnRvTnVtYmVyID0gZnVuY3Rpb24oc3RyKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgY29uc3QgbnVtID0gTnVtYmVyKHN0cik7XG4gIGlmIChudW0gPT0gMCAmJiBnb29nLnN0cmluZy5pc0VtcHR5T3JXaGl0ZXNwYWNlKHN0cikpIHtcbiAgICByZXR1cm4gTmFOO1xuICB9XG4gIHJldHVybiBudW07XG59O1xuXG5cbi8qKlxuICogUmV0dXJucyB3aGV0aGVyIHRoZSBnaXZlbiBzdHJpbmcgaXMgbG93ZXIgY2FtZWwgY2FzZSAoZS5nLiBcImlzRm9vQmFyXCIpLlxuICpcbiAqIE5vdGUgdGhhdCB0aGlzIGFzc3VtZXMgdGhlIHN0cmluZyBpcyBlbnRpcmVseSBsZXR0ZXJzLlxuICogQHNlZSBodHRwOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0NhbWVsQ2FzZSNWYXJpYXRpb25zX2FuZF9zeW5vbnltc1xuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBzdHIgU3RyaW5nIHRvIHRlc3QuXG4gKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoZSBzdHJpbmcgaXMgbG93ZXIgY2FtZWwgY2FzZS5cbiAqL1xuZ29vZy5zdHJpbmcuaXNMb3dlckNhbWVsQ2FzZSA9IGZ1bmN0aW9uKHN0cikge1xuICAndXNlIHN0cmljdCc7XG4gIHJldHVybiAvXlthLXpdKyhbQS1aXVthLXpdKikqJC8udGVzdChzdHIpO1xufTtcblxuXG4vKipcbiAqIFJldHVybnMgd2hldGhlciB0aGUgZ2l2ZW4gc3RyaW5nIGlzIHVwcGVyIGNhbWVsIGNhc2UgKGUuZy4gXCJGb29CYXJCYXpcIikuXG4gKlxuICogTm90ZSB0aGF0IHRoaXMgYXNzdW1lcyB0aGUgc3RyaW5nIGlzIGVudGlyZWx5IGxldHRlcnMuXG4gKiBAc2VlIGh0dHA6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvQ2FtZWxDYXNlI1ZhcmlhdGlvbnNfYW5kX3N5bm9ueW1zXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHN0ciBTdHJpbmcgdG8gdGVzdC5cbiAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgdGhlIHN0cmluZyBpcyB1cHBlciBjYW1lbCBjYXNlLlxuICovXG5nb29nLnN0cmluZy5pc1VwcGVyQ2FtZWxDYXNlID0gZnVuY3Rpb24oc3RyKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmV0dXJuIC9eKFtBLVpdW2Etel0qKSskLy50ZXN0KHN0cik7XG59O1xuXG5cbi8qKlxuICogQ29udmVydHMgYSBzdHJpbmcgZnJvbSBzZWxlY3Rvci1jYXNlIHRvIGNhbWVsQ2FzZSAoZS5nLiBmcm9tXG4gKiBcIm11bHRpLXBhcnQtc3RyaW5nXCIgdG8gXCJtdWx0aVBhcnRTdHJpbmdcIiksIHVzZWZ1bCBmb3IgY29udmVydGluZ1xuICogQ1NTIHNlbGVjdG9ycyBhbmQgSFRNTCBkYXRhc2V0IGtleXMgdG8gdGhlaXIgZXF1aXZhbGVudCBKUyBwcm9wZXJ0aWVzLlxuICogQHBhcmFtIHtzdHJpbmd9IHN0ciBUaGUgc3RyaW5nIGluIHNlbGVjdG9yLWNhc2UgZm9ybS5cbiAqIEByZXR1cm4ge3N0cmluZ30gVGhlIHN0cmluZyBpbiBjYW1lbENhc2UgZm9ybS5cbiAqL1xuZ29vZy5zdHJpbmcudG9DYW1lbENhc2UgPSBmdW5jdGlvbihzdHIpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gU3RyaW5nKHN0cikucmVwbGFjZSgvXFwtKFthLXpdKS9nLCBmdW5jdGlvbihhbGwsIG1hdGNoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIHJldHVybiBtYXRjaC50b1VwcGVyQ2FzZSgpO1xuICB9KTtcbn07XG5cblxuLyoqXG4gKiBDb252ZXJ0cyBhIHN0cmluZyBmcm9tIGNhbWVsQ2FzZSB0byBzZWxlY3Rvci1jYXNlIChlLmcuIGZyb21cbiAqIFwibXVsdGlQYXJ0U3RyaW5nXCIgdG8gXCJtdWx0aS1wYXJ0LXN0cmluZ1wiKSwgdXNlZnVsIGZvciBjb252ZXJ0aW5nIEpTXG4gKiBzdHlsZSBhbmQgZGF0YXNldCBwcm9wZXJ0aWVzIHRvIGVxdWl2YWxlbnQgQ1NTIHNlbGVjdG9ycyBhbmQgSFRNTCBrZXlzLlxuICogQHBhcmFtIHtzdHJpbmd9IHN0ciBUaGUgc3RyaW5nIGluIGNhbWVsQ2FzZSBmb3JtLlxuICogQHJldHVybiB7c3RyaW5nfSBUaGUgc3RyaW5nIGluIHNlbGVjdG9yLWNhc2UgZm9ybS5cbiAqL1xuZ29vZy5zdHJpbmcudG9TZWxlY3RvckNhc2UgPSBmdW5jdGlvbihzdHIpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gU3RyaW5nKHN0cikucmVwbGFjZSgvKFtBLVpdKS9nLCAnLSQxJykudG9Mb3dlckNhc2UoKTtcbn07XG5cblxuLyoqXG4gKiBDb252ZXJ0cyBhIHN0cmluZyBpbnRvIFRpdGxlQ2FzZS4gRmlyc3QgY2hhcmFjdGVyIG9mIHRoZSBzdHJpbmcgaXMgYWx3YXlzXG4gKiBjYXBpdGFsaXplZCBpbiBhZGRpdGlvbiB0byB0aGUgZmlyc3QgbGV0dGVyIG9mIGV2ZXJ5IHN1YnNlcXVlbnQgd29yZC5cbiAqIFdvcmRzIGFyZSBkZWxpbWl0ZWQgYnkgb25lIG9yIG1vcmUgd2hpdGVzcGFjZXMgYnkgZGVmYXVsdC4gQ3VzdG9tIGRlbGltaXRlcnNcbiAqIGNhbiBvcHRpb25hbGx5IGJlIHNwZWNpZmllZCB0byByZXBsYWNlIHRoZSBkZWZhdWx0LCB3aGljaCBkb2Vzbid0IHByZXNlcnZlXG4gKiB3aGl0ZXNwYWNlIGRlbGltaXRlcnMgYW5kIGluc3RlYWQgbXVzdCBiZSBleHBsaWNpdGx5IGluY2x1ZGVkIGlmIG5lZWRlZC5cbiAqXG4gKiBEZWZhdWx0IGRlbGltaXRlciA9PiBcIiBcIjpcbiAqICAgIGdvb2cuc3RyaW5nLnRvVGl0bGVDYXNlKCdvbmVUd29UaHJlZScpICAgID0+ICdPbmVUd29UaHJlZSdcbiAqICAgIGdvb2cuc3RyaW5nLnRvVGl0bGVDYXNlKCdvbmUgdHdvIHRocmVlJykgID0+ICdPbmUgVHdvIFRocmVlJ1xuICogICAgZ29vZy5zdHJpbmcudG9UaXRsZUNhc2UoJyAgb25lICAgdHdvICAgJykgPT4gJyAgT25lICAgVHdvICAgJ1xuICogICAgZ29vZy5zdHJpbmcudG9UaXRsZUNhc2UoJ29uZV90d29fdGhyZWUnKSAgPT4gJ09uZV90d29fdGhyZWUnXG4gKiAgICBnb29nLnN0cmluZy50b1RpdGxlQ2FzZSgnb25lLXR3by10aHJlZScpICA9PiAnT25lLXR3by10aHJlZSdcbiAqXG4gKiBDdXN0b20gZGVsaW1pdGVyID0+IFwiXy0uXCI6XG4gKiAgICBnb29nLnN0cmluZy50b1RpdGxlQ2FzZSgnb25lVHdvVGhyZWUnLCAnXy0uJykgICAgICAgPT4gJ09uZVR3b1RocmVlJ1xuICogICAgZ29vZy5zdHJpbmcudG9UaXRsZUNhc2UoJ29uZSB0d28gdGhyZWUnLCAnXy0uJykgICAgID0+ICdPbmUgdHdvIHRocmVlJ1xuICogICAgZ29vZy5zdHJpbmcudG9UaXRsZUNhc2UoJyAgb25lICAgdHdvICAgJywgJ18tLicpICAgID0+ICcgIG9uZSAgIHR3byAgICdcbiAqICAgIGdvb2cuc3RyaW5nLnRvVGl0bGVDYXNlKCdvbmVfdHdvX3RocmVlJywgJ18tLicpICAgICA9PiAnT25lX1R3b19UaHJlZSdcbiAqICAgIGdvb2cuc3RyaW5nLnRvVGl0bGVDYXNlKCdvbmUtdHdvLXRocmVlJywgJ18tLicpICAgICA9PiAnT25lLVR3by1UaHJlZSdcbiAqICAgIGdvb2cuc3RyaW5nLnRvVGl0bGVDYXNlKCdvbmUuLi50d28uLi50aHJlZScsICdfLS4nKSA9PiAnT25lLi4uVHdvLi4uVGhyZWUnXG4gKiAgICBnb29nLnN0cmluZy50b1RpdGxlQ2FzZSgnb25lLiB0d28uIHRocmVlJywgJ18tLicpICAgPT4gJ09uZS4gdHdvLiB0aHJlZSdcbiAqICAgIGdvb2cuc3RyaW5nLnRvVGl0bGVDYXNlKCdvbmUtdHdvLnRocmVlJywgJ18tLicpICAgICA9PiAnT25lLVR3by5UaHJlZSdcbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gc3RyIFN0cmluZyB2YWx1ZSBpbiBjYW1lbENhc2UgZm9ybS5cbiAqIEBwYXJhbSB7c3RyaW5nPX0gb3B0X2RlbGltaXRlcnMgQ3VzdG9tIGRlbGltaXRlciBjaGFyYWN0ZXIgc2V0IHVzZWQgdG9cbiAqICAgICAgZGlzdGluZ3Vpc2ggd29yZHMgaW4gdGhlIHN0cmluZyB2YWx1ZS4gRWFjaCBjaGFyYWN0ZXIgcmVwcmVzZW50cyBhXG4gKiAgICAgIHNpbmdsZSBkZWxpbWl0ZXIuIFdoZW4gcHJvdmlkZWQsIGRlZmF1bHQgd2hpdGVzcGFjZSBkZWxpbWl0ZXIgaXNcbiAqICAgICAgb3ZlcnJpZGRlbiBhbmQgbXVzdCBiZSBleHBsaWNpdGx5IGluY2x1ZGVkIGlmIG5lZWRlZC5cbiAqIEByZXR1cm4ge3N0cmluZ30gU3RyaW5nIHZhbHVlIGluIFRpdGxlQ2FzZSBmb3JtLlxuICovXG5nb29nLnN0cmluZy50b1RpdGxlQ2FzZSA9IGZ1bmN0aW9uKHN0ciwgb3B0X2RlbGltaXRlcnMpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBsZXQgZGVsaW1pdGVycyA9ICh0eXBlb2Ygb3B0X2RlbGltaXRlcnMgPT09ICdzdHJpbmcnKSA/XG4gICAgICBnb29nLnN0cmluZy5yZWdFeHBFc2NhcGUob3B0X2RlbGltaXRlcnMpIDpcbiAgICAgICdcXFxccyc7XG5cbiAgLy8gRm9yIElFOCwgd2UgbmVlZCB0byBwcmV2ZW50IHVzaW5nIGFuIGVtcHR5IGNoYXJhY3RlciBzZXQuIE90aGVyd2lzZSxcbiAgLy8gaW5jb3JyZWN0IG1hdGNoaW5nIHdpbGwgb2NjdXIuXG4gIGRlbGltaXRlcnMgPSBkZWxpbWl0ZXJzID8gJ3xbJyArIGRlbGltaXRlcnMgKyAnXSsnIDogJyc7XG5cbiAgY29uc3QgcmVnZXhwID0gbmV3IFJlZ0V4cCgnKF4nICsgZGVsaW1pdGVycyArICcpKFthLXpdKScsICdnJyk7XG4gIHJldHVybiBzdHIucmVwbGFjZShyZWdleHAsIGZ1bmN0aW9uKGFsbCwgcDEsIHAyKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIHJldHVybiBwMSArIHAyLnRvVXBwZXJDYXNlKCk7XG4gIH0pO1xufTtcblxuXG4vKipcbiAqIENhcGl0YWxpemVzIGEgc3RyaW5nLCBpLmUuIGNvbnZlcnRzIHRoZSBmaXJzdCBsZXR0ZXIgdG8gdXBwZXJjYXNlXG4gKiBhbmQgYWxsIG90aGVyIGxldHRlcnMgdG8gbG93ZXJjYXNlLCBlLmcuOlxuICpcbiAqIGdvb2cuc3RyaW5nLmNhcGl0YWxpemUoJ29uZScpICAgICA9PiAnT25lJ1xuICogZ29vZy5zdHJpbmcuY2FwaXRhbGl6ZSgnT05FJykgICAgID0+ICdPbmUnXG4gKiBnb29nLnN0cmluZy5jYXBpdGFsaXplKCdvbmUgdHdvJykgPT4gJ09uZSB0d28nXG4gKlxuICogTm90ZSB0aGF0IHRoaXMgZnVuY3Rpb24gZG9lcyBub3QgdHJpbSBpbml0aWFsIHdoaXRlc3BhY2UuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHN0ciBTdHJpbmcgdmFsdWUgdG8gY2FwaXRhbGl6ZS5cbiAqIEByZXR1cm4ge3N0cmluZ30gU3RyaW5nIHZhbHVlIHdpdGggZmlyc3QgbGV0dGVyIGluIHVwcGVyY2FzZS5cbiAqL1xuZ29vZy5zdHJpbmcuY2FwaXRhbGl6ZSA9IGZ1bmN0aW9uKHN0cikge1xuICAndXNlIHN0cmljdCc7XG4gIHJldHVybiBTdHJpbmcoc3RyLmNoYXJBdCgwKSkudG9VcHBlckNhc2UoKSArXG4gICAgICBTdHJpbmcoc3RyLnN1YnN0cigxKSkudG9Mb3dlckNhc2UoKTtcbn07XG5cblxuLyoqXG4gKiBQYXJzZSBhIHN0cmluZyBpbiBkZWNpbWFsIG9yIGhleGlkZWNpbWFsICgnMHhGRkZGJykgZm9ybS5cbiAqXG4gKiBUbyBwYXJzZSBhIHBhcnRpY3VsYXIgcmFkaXgsIHBsZWFzZSB1c2UgcGFyc2VJbnQoc3RyaW5nLCByYWRpeCkgZGlyZWN0bHkuIFNlZVxuICogaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4vSmF2YVNjcmlwdC9SZWZlcmVuY2UvR2xvYmFsX09iamVjdHMvcGFyc2VJbnRcbiAqXG4gKiBUaGlzIGlzIGEgd3JhcHBlciBmb3IgdGhlIGJ1aWx0LWluIHBhcnNlSW50IGZ1bmN0aW9uIHRoYXQgd2lsbCBvbmx5IHBhcnNlXG4gKiBudW1iZXJzIGFzIGJhc2UgMTAgb3IgYmFzZSAxNi4gIFNvbWUgSlMgaW1wbGVtZW50YXRpb25zIGFzc3VtZSBzdHJpbmdzXG4gKiBzdGFydGluZyB3aXRoIFwiMFwiIGFyZSBpbnRlbmRlZCB0byBiZSBvY3RhbC4gRVMzIGFsbG93ZWQgYnV0IGRpc2NvdXJhZ2VkXG4gKiB0aGlzIGJlaGF2aW9yLiBFUzUgZm9yYmlkcyBpdC4gIFRoaXMgZnVuY3Rpb24gZW11bGF0ZXMgdGhlIEVTNSBiZWhhdmlvci5cbiAqXG4gKiBGb3IgbW9yZSBpbmZvcm1hdGlvbiwgc2VlIE1vemlsbGEgSlMgUmVmZXJlbmNlOiBodHRwOi8vZ29vLmdsLzhSaUZqXG4gKlxuICogQHBhcmFtIHtzdHJpbmd8bnVtYmVyfG51bGx8dW5kZWZpbmVkfSB2YWx1ZSBUaGUgdmFsdWUgdG8gYmUgcGFyc2VkLlxuICogQHJldHVybiB7bnVtYmVyfSBUaGUgbnVtYmVyLCBwYXJzZWQuIElmIHRoZSBzdHJpbmcgZmFpbGVkIHRvIHBhcnNlLCB0aGlzXG4gKiAgICAgd2lsbCBiZSBOYU4uXG4gKi9cbmdvb2cuc3RyaW5nLnBhcnNlSW50ID0gZnVuY3Rpb24odmFsdWUpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICAvLyBGb3JjZSBmaW5pdGUgbnVtYmVycyB0byBzdHJpbmdzLlxuICBpZiAoaXNGaW5pdGUodmFsdWUpKSB7XG4gICAgdmFsdWUgPSBTdHJpbmcodmFsdWUpO1xuICB9XG5cbiAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAvLyBJZiB0aGUgc3RyaW5nIHN0YXJ0cyB3aXRoICcweCcgb3IgJy0weCcsIHBhcnNlIGFzIGhleC5cbiAgICByZXR1cm4gL15cXHMqLT8weC9pLnRlc3QodmFsdWUpID8gcGFyc2VJbnQodmFsdWUsIDE2KSA6IHBhcnNlSW50KHZhbHVlLCAxMCk7XG4gIH1cblxuICByZXR1cm4gTmFOO1xufTtcblxuXG4vKipcbiAqIFNwbGl0cyBhIHN0cmluZyBvbiBhIHNlcGFyYXRvciBhIGxpbWl0ZWQgbnVtYmVyIG9mIHRpbWVzLlxuICpcbiAqIFRoaXMgaW1wbGVtZW50YXRpb24gaXMgbW9yZSBzaW1pbGFyIHRvIFB5dGhvbiBvciBKYXZhLCB3aGVyZSB0aGUgbGltaXRcbiAqIHBhcmFtZXRlciBzcGVjaWZpZXMgdGhlIG1heGltdW0gbnVtYmVyIG9mIHNwbGl0cyByYXRoZXIgdGhhbiB0cnVuY2F0aW5nXG4gKiB0aGUgbnVtYmVyIG9mIHJlc3VsdHMuXG4gKlxuICogU2VlIGh0dHA6Ly9kb2NzLnB5dGhvbi5vcmcvMi9saWJyYXJ5L3N0ZHR5cGVzLmh0bWwjc3RyLnNwbGl0XG4gKiBTZWUgSmF2YURvYzogaHR0cDovL2dvby5nbC9GMkFzWVxuICogU2VlIE1vemlsbGEgcmVmZXJlbmNlOiBodHRwOi8vZ29vLmdsL2RaZFpzXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHN0ciBTdHJpbmcgdG8gc3BsaXQuXG4gKiBAcGFyYW0ge3N0cmluZ30gc2VwYXJhdG9yIFRoZSBzZXBhcmF0b3IuXG4gKiBAcGFyYW0ge251bWJlcn0gbGltaXQgVGhlIGxpbWl0IHRvIHRoZSBudW1iZXIgb2Ygc3BsaXRzLiBUaGUgcmVzdWx0aW5nIGFycmF5XG4gKiAgICAgd2lsbCBoYXZlIGEgbWF4aW11bSBsZW5ndGggb2YgbGltaXQrMS4gIE5lZ2F0aXZlIG51bWJlcnMgYXJlIHRoZSBzYW1lXG4gKiAgICAgYXMgemVyby5cbiAqIEByZXR1cm4geyFBcnJheTxzdHJpbmc+fSBUaGUgc3RyaW5nLCBzcGxpdC5cbiAqL1xuZ29vZy5zdHJpbmcuc3BsaXRMaW1pdCA9IGZ1bmN0aW9uKHN0ciwgc2VwYXJhdG9yLCBsaW1pdCkge1xuICAndXNlIHN0cmljdCc7XG4gIGNvbnN0IHBhcnRzID0gc3RyLnNwbGl0KHNlcGFyYXRvcik7XG4gIGNvbnN0IHJldHVyblZhbCA9IFtdO1xuXG4gIC8vIE9ubHkgY29udGludWUgZG9pbmcgdGhpcyB3aGlsZSB3ZSBoYXZlbid0IGhpdCB0aGUgbGltaXQgYW5kIHdlIGhhdmVcbiAgLy8gcGFydHMgbGVmdC5cbiAgd2hpbGUgKGxpbWl0ID4gMCAmJiBwYXJ0cy5sZW5ndGgpIHtcbiAgICByZXR1cm5WYWwucHVzaChwYXJ0cy5zaGlmdCgpKTtcbiAgICBsaW1pdC0tO1xuICB9XG5cbiAgLy8gSWYgdGhlcmUgYXJlIHJlbWFpbmluZyBwYXJ0cywgYXBwZW5kIHRoZW0gdG8gdGhlIGVuZC5cbiAgaWYgKHBhcnRzLmxlbmd0aCkge1xuICAgIHJldHVyblZhbC5wdXNoKHBhcnRzLmpvaW4oc2VwYXJhdG9yKSk7XG4gIH1cblxuICByZXR1cm4gcmV0dXJuVmFsO1xufTtcblxuXG4vKipcbiAqIEZpbmRzIHRoZSBjaGFyYWN0ZXJzIHRvIHRoZSByaWdodCBvZiB0aGUgbGFzdCBpbnN0YW5jZSBvZiBhbnkgc2VwYXJhdG9yXG4gKlxuICogVGhpcyBmdW5jdGlvbiBpcyBzaW1pbGFyIHRvIGdvb2cuc3RyaW5nLnBhdGguYmFzZU5hbWUsIGV4Y2VwdCBpdCBjYW4gdGFrZSBhXG4gKiBsaXN0IG9mIGNoYXJhY3RlcnMgdG8gc3BsaXQgdGhlIHN0cmluZyBvbi4gSXQgd2lsbCByZXR1cm4gdGhlIHJpZ2h0bW9zdFxuICogZ3JvdXBpbmcgb2YgY2hhcmFjdGVycyB0byB0aGUgcmlnaHQgb2YgYW55IHNlcGFyYXRvciBhcyBhIGxlZnQtdG8tcmlnaHRcbiAqIG9yaWVudGVkIHN0cmluZy5cbiAqXG4gKiBAc2VlIGdvb2cuc3RyaW5nLnBhdGguYmFzZU5hbWVcbiAqIEBwYXJhbSB7c3RyaW5nfSBzdHIgVGhlIHN0cmluZ1xuICogQHBhcmFtIHtzdHJpbmd8IUFycmF5PHN0cmluZz59IHNlcGFyYXRvcnMgQSBsaXN0IG9mIHNlcGFyYXRvciBjaGFyYWN0ZXJzXG4gKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSBsYXN0IHBhcnQgb2YgdGhlIHN0cmluZyB3aXRoIHJlc3BlY3QgdG8gdGhlIHNlcGFyYXRvcnNcbiAqL1xuZ29vZy5zdHJpbmcubGFzdENvbXBvbmVudCA9IGZ1bmN0aW9uKHN0ciwgc2VwYXJhdG9ycykge1xuICAndXNlIHN0cmljdCc7XG4gIGlmICghc2VwYXJhdG9ycykge1xuICAgIHJldHVybiBzdHI7XG4gIH0gZWxzZSBpZiAodHlwZW9mIHNlcGFyYXRvcnMgPT0gJ3N0cmluZycpIHtcbiAgICBzZXBhcmF0b3JzID0gW3NlcGFyYXRvcnNdO1xuICB9XG5cbiAgbGV0IGxhc3RTZXBhcmF0b3JJbmRleCA9IC0xO1xuICBmb3IgKGxldCBpID0gMDsgaSA8IHNlcGFyYXRvcnMubGVuZ3RoOyBpKyspIHtcbiAgICBpZiAoc2VwYXJhdG9yc1tpXSA9PSAnJykge1xuICAgICAgY29udGludWU7XG4gICAgfVxuICAgIGNvbnN0IGN1cnJlbnRTZXBhcmF0b3JJbmRleCA9IHN0ci5sYXN0SW5kZXhPZihzZXBhcmF0b3JzW2ldKTtcbiAgICBpZiAoY3VycmVudFNlcGFyYXRvckluZGV4ID4gbGFzdFNlcGFyYXRvckluZGV4KSB7XG4gICAgICBsYXN0U2VwYXJhdG9ySW5kZXggPSBjdXJyZW50U2VwYXJhdG9ySW5kZXg7XG4gICAgfVxuICB9XG4gIGlmIChsYXN0U2VwYXJhdG9ySW5kZXggPT0gLTEpIHtcbiAgICByZXR1cm4gc3RyO1xuICB9XG4gIHJldHVybiBzdHIuc2xpY2UobGFzdFNlcGFyYXRvckluZGV4ICsgMSk7XG59O1xuXG5cbi8qKlxuICogQ29tcHV0ZXMgdGhlIExldmVuc2h0ZWluIGVkaXQgZGlzdGFuY2UgYmV0d2VlbiB0d28gc3RyaW5ncy5cbiAqIEBwYXJhbSB7c3RyaW5nfSBhXG4gKiBAcGFyYW0ge3N0cmluZ30gYlxuICogQHJldHVybiB7bnVtYmVyfSBUaGUgZWRpdCBkaXN0YW5jZSBiZXR3ZWVuIHRoZSB0d28gc3RyaW5ncy5cbiAqL1xuZ29vZy5zdHJpbmcuZWRpdERpc3RhbmNlID0gZnVuY3Rpb24oYSwgYikge1xuICAndXNlIHN0cmljdCc7XG4gIGNvbnN0IHYwID0gW107XG4gIGNvbnN0IHYxID0gW107XG5cbiAgaWYgKGEgPT0gYikge1xuICAgIHJldHVybiAwO1xuICB9XG5cbiAgaWYgKCFhLmxlbmd0aCB8fCAhYi5sZW5ndGgpIHtcbiAgICByZXR1cm4gTWF0aC5tYXgoYS5sZW5ndGgsIGIubGVuZ3RoKTtcbiAgfVxuXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgYi5sZW5ndGggKyAxOyBpKyspIHtcbiAgICB2MFtpXSA9IGk7XG4gIH1cblxuICBmb3IgKGxldCBpID0gMDsgaSA8IGEubGVuZ3RoOyBpKyspIHtcbiAgICB2MVswXSA9IGkgKyAxO1xuXG4gICAgZm9yIChsZXQgaiA9IDA7IGogPCBiLmxlbmd0aDsgaisrKSB7XG4gICAgICBjb25zdCBjb3N0ID0gTnVtYmVyKGFbaV0gIT0gYltqXSk7XG4gICAgICAvLyBDb3N0IGZvciB0aGUgc3Vic3RyaW5nIGlzIHRoZSBtaW5pbXVtIG9mIGFkZGluZyBvbmUgY2hhcmFjdGVyLCByZW1vdmluZ1xuICAgICAgLy8gb25lIGNoYXJhY3Rlciwgb3IgYSBzd2FwLlxuICAgICAgdjFbaiArIDFdID0gTWF0aC5taW4odjFbal0gKyAxLCB2MFtqICsgMV0gKyAxLCB2MFtqXSArIGNvc3QpO1xuICAgIH1cblxuICAgIGZvciAobGV0IGogPSAwOyBqIDwgdjAubGVuZ3RoOyBqKyspIHtcbiAgICAgIHYwW2pdID0gdjFbal07XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHYxW2IubGVuZ3RoXTtcbn07XG4iLCAiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IFRoZSBDbG9zdXJlIExpYnJhcnkgQXV0aG9ycy5cbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBAZmlsZW92ZXJ2aWV3IFRoZSBkaXNwb3NlIG1ldGhvZCBpcyB1c2VkIHRvIGNsZWFuIHVwIHJlZmVyZW5jZXMgYW5kXG4gKiByZXNvdXJjZXMuXG4gKi9cblxuZ29vZy5tb2R1bGUoJ2dvb2cuZGlzcG9zZScpO1xuZ29vZy5tb2R1bGUuZGVjbGFyZUxlZ2FjeU5hbWVzcGFjZSgpO1xuXG4vKipcbiAqIENhbGxzIGBkaXNwb3NlYCBvbiB0aGUgYXJndW1lbnQgaWYgaXQgc3VwcG9ydHMgaXQuIElmIG9iaiBpcyBub3QgYW5cbiAqICAgICBvYmplY3Qgd2l0aCBhIGRpc3Bvc2UoKSBtZXRob2QsIHRoaXMgaXMgYSBuby1vcC5cbiAqIEBwYXJhbSB7Kn0gb2JqIFRoZSBvYmplY3QgdG8gZGlzcG9zZSBvZi5cbiAqL1xuZnVuY3Rpb24gZGlzcG9zZShvYmopIHtcbiAgaWYgKG9iaiAmJiB0eXBlb2Ygb2JqLmRpc3Bvc2UgPT0gJ2Z1bmN0aW9uJykge1xuICAgIG9iai5kaXNwb3NlKCk7XG4gIH1cbn1cbmV4cG9ydHMgPSBkaXNwb3NlO1xuIiwgIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCBUaGUgQ2xvc3VyZSBMaWJyYXJ5IEF1dGhvcnMuXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogQGZpbGVvdmVydmlldyBDb2RlYyBmdW5jdGlvbnMgb2YgdGhlIHY4IHdpcmUgcHJvdG9jb2wuIEV2ZW50dWFsbHkgd2UnZCB3YW50XG4gKiB0byBzdXBwb3J0IHBsdWdnYWJsZSB3aXJlLWZvcm1hdCB0byBpbXByb3ZlIHdpcmUgZWZmaWNpZW5jeSBhbmQgdG8gZW5hYmxlXG4gKiBiaW5hcnkgZW5jb2RpbmcuIFN1Y2ggc3VwcG9ydCB3aWxsIHJlcXVpcmUgYW4gaW50ZXJmYWNlIGNsYXNzLCB3aGljaFxuICogd2lsbCBiZSBhZGRlZCBsYXRlci5cbiAqXG4gKi9cblxuXG5nb29nLnByb3ZpZGUoJ2dvb2cubGFicy5uZXQud2ViQ2hhbm5lbC5XaXJlVjgnKTtcblxuZ29vZy5yZXF1aXJlKCdnb29nLmFzc2VydHMnKTtcbmdvb2cucmVxdWlyZSgnZ29vZy5qc29uJyk7XG5nb29nLnJlcXVpcmUoJ2dvb2cuanNvbi5OYXRpdmVKc29uUHJvY2Vzc29yJyk7XG5nb29nLnJlcXVpcmUoJ2dvb2cubGFicy5uZXQud2ViQ2hhbm5lbC5XaXJlJyk7XG5nb29nLnJlcXVpcmUoJ2dvb2cuc3RydWN0cycpO1xuZ29vZy5yZXF1aXJlVHlwZSgnZ29vZy5zdHJpbmcuUGFyc2VyJyk7XG5nb29nLnJlcXVpcmVUeXBlKCdnb29nLnN0cnVjdHMuTWFwJyk7XG5cblxuXG4vKipcbiAqIFRoZSB2OCBjb2RlYyBjbGFzcy5cbiAqXG4gKiBAY29uc3RydWN0b3JcbiAqIEBzdHJ1Y3RcbiAqL1xuZ29vZy5sYWJzLm5ldC53ZWJDaGFubmVsLldpcmVWOCA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIC8qKlxuICAgKiBQYXJzZXIgZm9yIGEgcmVzcG9uc2UgcGF5bG9hZC4gVGhlIHBhcnNlciBzaG91bGQgcmV0dXJuIGFuIGFycmF5LlxuICAgKiBAcHJpdmF0ZSB7IWdvb2cuc3RyaW5nLlBhcnNlcn1cbiAgICovXG4gIHRoaXMucGFyc2VyXyA9IG5ldyBnb29nLmpzb24uTmF0aXZlSnNvblByb2Nlc3NvcigpO1xufTtcblxuXG5nb29nLnNjb3BlKGZ1bmN0aW9uKCkge1xuJ3VzZSBzdHJpY3QnO1xuY29uc3QgV2lyZVY4ID0gZ29vZy5sYWJzLm5ldC53ZWJDaGFubmVsLldpcmVWODtcbmNvbnN0IFdpcmUgPSBnb29nLmxhYnMubmV0LndlYkNoYW5uZWwuV2lyZTtcblxuXG4vKipcbiAqIEVuY29kZXMgYSBzdGFuZGFsb25lIG1lc3NhZ2UgaW50byB0aGUgd2lyZSBmb3JtYXQuXG4gKlxuICogTWF5IHRocm93IGV4Y2VwdGlvbiBpZiB0aGUgbWVzc2FnZSBvYmplY3QgY29udGFpbnMgYW55IGludmFsaWQgZWxlbWVudHMuXG4gKlxuICogQHBhcmFtIHshT2JqZWN0fCFnb29nLnN0cnVjdHMuTWFwfSBtZXNzYWdlIFRoZSBtZXNzYWdlIGRhdGEuXG4gKiAgICAgVjggb25seSBzdXBwb3J0IEpTIG9iamVjdHMgKG9yIE1hcCkuXG4gKiBAcGFyYW0geyFBcnJheTxzdHJpbmc+fSBidWZmZXIgVGhlIHRleHQgYnVmZmVyIHRvIHdyaXRlIHRoZSBtZXNzYWdlIHRvLlxuICogQHBhcmFtIHtzdHJpbmc9fSBvcHRfcHJlZml4IFRoZSBwcmVmaXggZm9yIGVhY2ggZmllbGQgb2YgdGhlIG9iamVjdC5cbiAqL1xuV2lyZVY4LnByb3RvdHlwZS5lbmNvZGVNZXNzYWdlID0gZnVuY3Rpb24obWVzc2FnZSwgYnVmZmVyLCBvcHRfcHJlZml4KSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgY29uc3QgcHJlZml4ID0gb3B0X3ByZWZpeCB8fCAnJztcbiAgdHJ5IHtcbiAgICBnb29nLnN0cnVjdHMuZm9yRWFjaChtZXNzYWdlLCBmdW5jdGlvbih2YWx1ZSwga2V5KSB7XG4gICAgICAndXNlIHN0cmljdCc7XG4gICAgICBsZXQgZW5jb2RlZFZhbHVlID0gdmFsdWU7XG4gICAgICBpZiAoZ29vZy5pc09iamVjdCh2YWx1ZSkpIHtcbiAgICAgICAgZW5jb2RlZFZhbHVlID0gZ29vZy5qc29uLnNlcmlhbGl6ZSh2YWx1ZSk7XG4gICAgICB9ICAvLyBrZWVwIHRoZSBmYXN0LXBhdGggZm9yIHByaW1pdGl2ZSB0eXBlc1xuICAgICAgYnVmZmVyLnB1c2gocHJlZml4ICsga2V5ICsgJz0nICsgZW5jb2RlVVJJQ29tcG9uZW50KGVuY29kZWRWYWx1ZSkpO1xuICAgIH0pO1xuICB9IGNhdGNoIChleCkge1xuICAgIC8vIFdlIHNlbmQgYSBtYXAgaGVyZSBiZWNhdXNlIGxvdHMgb2YgdGhlIHJldHJ5IGxvZ2ljIHJlbGllcyBvbiBtYXAgSURzLFxuICAgIC8vIHNvIHdlIGhhdmUgdG8gc2VuZCBzb21ldGhpbmcgKHBvc3NpYmx5IHJlZHVuZGFudCkuXG4gICAgYnVmZmVyLnB1c2goXG4gICAgICAgIHByZWZpeCArICd0eXBlJyArXG4gICAgICAgICc9JyArIGVuY29kZVVSSUNvbXBvbmVudCgnX2JhZG1hcCcpKTtcbiAgICB0aHJvdyBleDtcbiAgfVxufTtcblxuXG4vKipcbiAqIEVuY29kZXMgYWxsIHRoZSBidWZmZXJlZCBtZXNzYWdlcyBvZiB0aGUgZm9yd2FyZCBjaGFubmVsLlxuICpcbiAqIEBwYXJhbSB7IUFycmF5PFdpcmUuUXVldWVkTWFwPn0gbWVzc2FnZVF1ZXVlIFRoZSBtZXNzYWdlIGRhdGEuXG4gKiAgICAgVjggb25seSBzdXBwb3J0IEpTIG9iamVjdHMuXG4gKiBAcGFyYW0ge251bWJlcn0gY291bnQgVGhlIG51bWJlciBvZiBtZXNzYWdlcyB0byBiZSBlbmNvZGVkLlxuICogQHBhcmFtIHs/ZnVuY3Rpb24oIU9iamVjdCl9IGJhZE1hcEhhbmRsZXIgQ2FsbGJhY2sgZm9yIGJhZCBtZXNzYWdlcy5cbiAqIEByZXR1cm4ge3N0cmluZ30gdGhlIGVuY29kZWQgbWVzc2FnZXNcbiAqL1xuV2lyZVY4LnByb3RvdHlwZS5lbmNvZGVNZXNzYWdlUXVldWUgPSBmdW5jdGlvbihcbiAgICBtZXNzYWdlUXVldWUsIGNvdW50LCBiYWRNYXBIYW5kbGVyKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgbGV0IG9mZnNldCA9IC0xO1xuICB3aGlsZSAodHJ1ZSkge1xuICAgIGNvbnN0IHNiID0gWydjb3VudD0nICsgY291bnRdO1xuICAgIC8vIFRvIHNhdmUgYSBiaXQgb2YgYmFuZHdpZHRoLCBzcGVjaWZ5IHRoZSBiYXNlIG1hcElkIGFuZCB0aGUgcmVzdCBhc1xuICAgIC8vIG9mZnNldHMgZnJvbSBpdC5cbiAgICBpZiAob2Zmc2V0ID09IC0xKSB7XG4gICAgICBpZiAoY291bnQgPiAwKSB7XG4gICAgICAgIG9mZnNldCA9IG1lc3NhZ2VRdWV1ZVswXS5tYXBJZDtcbiAgICAgICAgc2IucHVzaCgnb2ZzPScgKyBvZmZzZXQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgb2Zmc2V0ID0gMDtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgc2IucHVzaCgnb2ZzPScgKyBvZmZzZXQpO1xuICAgIH1cbiAgICBsZXQgZG9uZSA9IHRydWU7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7XG4gICAgICBsZXQgbWFwSWQgPSBtZXNzYWdlUXVldWVbaV0ubWFwSWQ7XG4gICAgICBjb25zdCBtYXAgPSBtZXNzYWdlUXVldWVbaV0ubWFwO1xuICAgICAgbWFwSWQgLT0gb2Zmc2V0O1xuICAgICAgaWYgKG1hcElkIDwgMCkge1xuICAgICAgICAvLyByZWRvIHRoZSBlbmNvZGluZyBpbiBjYXNlIG9mIHJldHJ5L3Jlb3JkZXJpbmcsIHBsdXMgZXh0cmEgc3BhY2VcbiAgICAgICAgb2Zmc2V0ID0gTWF0aC5tYXgoMCwgbWVzc2FnZVF1ZXVlW2ldLm1hcElkIC0gMTAwKTtcbiAgICAgICAgZG9uZSA9IGZhbHNlO1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICAgIHRyeSB7XG4gICAgICAgIHRoaXMuZW5jb2RlTWVzc2FnZShtYXAsIHNiLCAncmVxJyArIG1hcElkICsgJ18nKTtcbiAgICAgIH0gY2F0Y2ggKGV4KSB7XG4gICAgICAgIGlmIChiYWRNYXBIYW5kbGVyKSB7XG4gICAgICAgICAgYmFkTWFwSGFuZGxlcihtYXApO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChkb25lKSB7XG4gICAgICByZXR1cm4gc2Iuam9pbignJicpO1xuICAgIH1cbiAgfVxufTtcblxuXG4vKipcbiAqIERlY29kZXMgYSBzdGFuZGFsb25lIG1lc3NhZ2UgcmVjZWl2ZWQgZnJvbSB0aGUgd2lyZS4gTWF5IHRocm93IGV4Y2VwdGlvblxuICogaWYgdGV4dCBpcyBpbGwtZm9ybWF0dGVkLlxuICpcbiAqIE11c3QgYmUgdmFsaWQgSlNPTiBhcyBpdCBpcyBpbnNlY3VyZSB0byB1c2UgZXZhbCgpIHRvIGRlY29kZSBKUyBsaXRlcmFscztcbiAqIGFuZCBldmFsKCkgaXMgZGlzYWxsb3dlZCBpbiBDaHJvbWUgYXBwcyB0b28uXG4gKlxuICogSW52YWxpZCBKUyBsaXRlcmFscyBpbmNsdWRlIG51bGwgYXJyYXkgZWxlbWVudHMsIHF1b3RhcyBldGMuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IG1lc3NhZ2VUZXh0IFRoZSBzdHJpbmcgY29udGVudCBhcyByZWNlaXZlZCBmcm9tIHRoZSB3aXJlLlxuICogQHJldHVybiB7Kn0gVGhlIGRlY29kZWQgbWVzc2FnZSBvYmplY3QuXG4gKi9cbldpcmVWOC5wcm90b3R5cGUuZGVjb2RlTWVzc2FnZSA9IGZ1bmN0aW9uKG1lc3NhZ2VUZXh0KSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgY29uc3QgcmVzcG9uc2UgPSB0aGlzLnBhcnNlcl8ucGFyc2UobWVzc2FnZVRleHQpO1xuICBnb29nLmFzc2VydHMuYXNzZXJ0KEFycmF5LmlzQXJyYXkocmVzcG9uc2UpKTsgIC8vIHRocm93IGV4Y2VwdGlvblxuICByZXR1cm4gcmVzcG9uc2U7XG59O1xufSk7ICAvLyBnb29nLnNjb3BlXG4iLCAiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IFRoZSBDbG9zdXJlIExpYnJhcnkgQXV0aG9ycy5cbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBAZmlsZW92ZXJ2aWV3IEEgcG9vbCBvZiBmb3J3YXJkIGNoYW5uZWwgcmVxdWVzdHMgdG8gZW5hYmxlIHJlYWwtdGltZVxuICogbWVzc2FnaW5nIGZyb20gdGhlIGNsaWVudCB0byBzZXJ2ZXIuXG4gKlxuICovXG5cbmdvb2cubW9kdWxlKCdnb29nLmxhYnMubmV0LndlYkNoYW5uZWwuRm9yd2FyZENoYW5uZWxSZXF1ZXN0UG9vbCcpO1xuXG5nb29nLm1vZHVsZS5kZWNsYXJlTGVnYWN5TmFtZXNwYWNlKCk7XG5cbmNvbnN0IENoYW5uZWxSZXF1ZXN0ID0gZ29vZy5yZXF1aXJlKCdnb29nLmxhYnMubmV0LndlYkNoYW5uZWwuQ2hhbm5lbFJlcXVlc3QnKTtcbmNvbnN0IFdpcmUgPSBnb29nLnJlcXVpcmUoJ2dvb2cubGFicy5uZXQud2ViQ2hhbm5lbC5XaXJlJyk7XG5jb25zdCBhcnJheSA9IGdvb2cucmVxdWlyZSgnZ29vZy5hcnJheScpO1xuY29uc3QgZ29vZ1N0cmluZyA9IGdvb2cucmVxdWlyZSgnZ29vZy5zdHJpbmcnKTtcblxuXG4vKipcbiAqIFRoaXMgY2xhc3MgcmVwcmVzZW50cyB0aGUgc3RhdGUgb2YgYWxsIGZvcndhcmQgY2hhbm5lbCByZXF1ZXN0cy5cbiAqXG4gKiBAcGFyYW0ge251bWJlcj19IG9wdF9tYXhQb29sU2l6ZSBUaGUgbWF4aW11bSBwb29sIHNpemUuXG4gKlxuICogQHN0cnVjdCBAY29uc3RydWN0b3IgQGZpbmFsXG4gKi9cbmNvbnN0IEZvcndhcmRDaGFubmVsUmVxdWVzdFBvb2wgPSBmdW5jdGlvbihvcHRfbWF4UG9vbFNpemUpIHtcbiAgLyoqXG4gICAqIFRoZSBtYXggcG9vbCBzaXplIGFzIGNvbmZpZ3VyZWQuXG4gICAqXG4gICAqIEBwcml2YXRlIHtudW1iZXJ9XG4gICAqL1xuICB0aGlzLm1heFBvb2xTaXplQ29uZmlndXJlZF8gPVxuICAgICAgb3B0X21heFBvb2xTaXplIHx8IEZvcndhcmRDaGFubmVsUmVxdWVzdFBvb2wuTUFYX1BPT0xfU0laRV87XG5cbiAgLyoqXG4gICAqIFRoZSBjdXJyZW50IHNpemUgbGltaXQgb2YgdGhlIHJlcXVlc3QgcG9vbC4gVGhpcyBsaW1pdCBpcyBtZWFudCB0byBiZVxuICAgKiByZWFkLW9ubHkgYWZ0ZXIgdGhlIGNoYW5uZWwgaXMgZnVsbHkgb3BlbmVkLlxuICAgKlxuICAgKiBJZiBTUERZIG9yIEhUVFAyIGlzIGVuYWJsZWQsIHNldCBpdCB0byB0aGUgbWF4IHBvb2wgc2l6ZSwgd2hpY2ggaXMgYWxzb1xuICAgKiBjb25maWd1cmFibGUuXG4gICAqXG4gICAqIEBwcml2YXRlIHtudW1iZXJ9XG4gICAqL1xuICB0aGlzLm1heFNpemVfID0gRm9yd2FyZENoYW5uZWxSZXF1ZXN0UG9vbC5pc1NwZHlPckh0dHAyRW5hYmxlZF8oKSA/XG4gICAgICB0aGlzLm1heFBvb2xTaXplQ29uZmlndXJlZF8gOlxuICAgICAgMTtcblxuICAvKipcbiAgICogVGhlIGNvbnRhaW5lciBmb3IgYWxsIHRoZSBwZW5kaW5nIHJlcXVlc3Qgb2JqZWN0cy5cbiAgICpcbiAgICogQHByaXZhdGUgez9TZXQ8P0NoYW5uZWxSZXF1ZXN0Pn1cbiAgICovXG4gIHRoaXMucmVxdWVzdFBvb2xfID0gbnVsbDtcblxuICBpZiAodGhpcy5tYXhTaXplXyA+IDEpIHtcbiAgICB0aGlzLnJlcXVlc3RQb29sXyA9IG5ldyBTZXQoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUaGUgc2luZ2xlIHJlcXVlc3Qgb2JqZWN0IHdoZW4gdGhlIHBvb2wgc2l6ZSBpcyBsaW1pdGVkIHRvIG9uZS5cbiAgICpcbiAgICogQHByaXZhdGUgez9DaGFubmVsUmVxdWVzdH1cbiAgICovXG4gIHRoaXMucmVxdWVzdF8gPSBudWxsO1xuXG4gIC8qKlxuICAgKiBTYXZlZCBwZW5kaW5nIG1lc3NhZ2VzIHdoZW4gdGhlIHBvb2wgaXMgY2FuY2VsbGVkLlxuICAgKlxuICAgKiBAcHJpdmF0ZSB7IUFycmF5PFdpcmUuUXVldWVkTWFwPn1cbiAgICovXG4gIHRoaXMucGVuZGluZ01lc3NhZ2VzXyA9IFtdO1xufTtcblxuXG4vKipcbiAqIFRoZSBkZWZhdWx0IHNpemUgbGltaXQgb2YgdGhlIHJlcXVlc3QgcG9vbC5cbiAqXG4gKiBAcHJpdmF0ZSB7bnVtYmVyfVxuICovXG5Gb3J3YXJkQ2hhbm5lbFJlcXVlc3RQb29sLk1BWF9QT09MX1NJWkVfID0gMTA7XG5cblxuLyoqXG4gKiBAcmV0dXJuIHtib29sZWFufSBUcnVlIGlmIFNQRFkgb3IgSFRUUDIgaXMgZW5hYmxlZC4gVXNlcyBjaHJvbWUtc3BlY2lmaWMgQVBJc1xuICogICAgIGFzIGEgZmFsbGJhY2sgYW5kIHdpbGwgYWx3YXlzIHJldHVybiBmYWxzZSBmb3Igb3RoZXIgYnJvd3NlcnMgd2hlcmVcbiAqICAgICBQZXJmb3JtYW5jZU5hdmlnYXRpb25UaW1pbmcgaXMgbm90IGF2YWlsYWJsZS5cbiAqIEBwcml2YXRlXG4gKi9cbkZvcndhcmRDaGFubmVsUmVxdWVzdFBvb2wuaXNTcGR5T3JIdHRwMkVuYWJsZWRfID0gZnVuY3Rpb24oKSB7XG4gIGlmIChnb29nLmdsb2JhbC5QZXJmb3JtYW5jZU5hdmlnYXRpb25UaW1pbmcpIHtcbiAgICBjb25zdCBlbnRyeXMgPSAvKiogQHR5cGUgeyFBcnJheTwhUGVyZm9ybWFuY2VOYXZpZ2F0aW9uVGltaW5nPn0gKi8gKFxuICAgICAgICBnb29nLmdsb2JhbC5wZXJmb3JtYW5jZS5nZXRFbnRyaWVzQnlUeXBlKCduYXZpZ2F0aW9uJykpO1xuICAgIHJldHVybiBlbnRyeXMubGVuZ3RoID4gMCAmJlxuICAgICAgICAoZW50cnlzWzBdLm5leHRIb3BQcm90b2NvbCA9PSAnaHEnIHx8XG4gICAgICAgICBlbnRyeXNbMF0ubmV4dEhvcFByb3RvY29sID09ICdoMicpO1xuICB9XG4gIHJldHVybiAhIShcbiAgICAgIGdvb2cuZ2xvYmFsLmNocm9tZSAmJiBnb29nLmdsb2JhbC5jaHJvbWUubG9hZFRpbWVzICYmXG4gICAgICBnb29nLmdsb2JhbC5jaHJvbWUubG9hZFRpbWVzKCkgJiZcbiAgICAgIGdvb2cuZ2xvYmFsLmNocm9tZS5sb2FkVGltZXMoKS53YXNGZXRjaGVkVmlhU3BkeSk7XG59O1xuXG5cbi8qKlxuICogT25jZSB3ZSBrbm93IHRoZSBjbGllbnQgcHJvdG9jb2wgKGZyb20gdGhlIGhhbmRzaGFrZSksIGNoZWNrIGlmIHdlIG5lZWRcbiAqIGVuYWJsZSB0aGUgcmVxdWVzdCBwb29sIGFjY29yZGluZ2x5LiBUaGlzIGlzIG1vcmUgcm9idXN0IHRoYW4gdXNpbmdcbiAqIGJyb3dzZXItaW50ZXJuYWwgQVBJcyAoc3BlY2lmaWMgdG8gQ2hyb21lKS5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gY2xpZW50UHJvdG9jb2wgVGhlIGNsaWVudCBwcm90b2NvbFxuICovXG5Gb3J3YXJkQ2hhbm5lbFJlcXVlc3RQb29sLnByb3RvdHlwZS5hcHBseUNsaWVudFByb3RvY29sID0gZnVuY3Rpb24oXG4gICAgY2xpZW50UHJvdG9jb2wpIHtcbiAgaWYgKHRoaXMucmVxdWVzdFBvb2xfKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgaWYgKGdvb2dTdHJpbmcuY29udGFpbnMoY2xpZW50UHJvdG9jb2wsICdzcGR5JykgfHxcbiAgICAgIGdvb2dTdHJpbmcuY29udGFpbnMoY2xpZW50UHJvdG9jb2wsICdxdWljJykgfHxcbiAgICAgIGdvb2dTdHJpbmcuY29udGFpbnMoY2xpZW50UHJvdG9jb2wsICdoMicpKSB7XG4gICAgdGhpcy5tYXhTaXplXyA9IHRoaXMubWF4UG9vbFNpemVDb25maWd1cmVkXztcbiAgICB0aGlzLnJlcXVlc3RQb29sXyA9IG5ldyBTZXQoKTtcbiAgICBpZiAodGhpcy5yZXF1ZXN0Xykge1xuICAgICAgdGhpcy5hZGRSZXF1ZXN0KHRoaXMucmVxdWVzdF8pO1xuICAgICAgdGhpcy5yZXF1ZXN0XyA9IG51bGw7XG4gICAgfVxuICB9XG59O1xuXG5cbi8qKlxuICogQHJldHVybiB7Ym9vbGVhbn0gVHJ1ZSBpZiB0aGUgcG9vbCBpcyBmdWxsLlxuICovXG5Gb3J3YXJkQ2hhbm5lbFJlcXVlc3RQb29sLnByb3RvdHlwZS5pc0Z1bGwgPSBmdW5jdGlvbigpIHtcbiAgaWYgKHRoaXMucmVxdWVzdF8pIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIGlmICh0aGlzLnJlcXVlc3RQb29sXykge1xuICAgIHJldHVybiB0aGlzLnJlcXVlc3RQb29sXy5zaXplID49IHRoaXMubWF4U2l6ZV87XG4gIH1cblxuICByZXR1cm4gZmFsc2U7XG59O1xuXG5cbi8qKlxuICogQHJldHVybiB7bnVtYmVyfSBUaGUgY3VycmVudCBzaXplIGxpbWl0LlxuICovXG5Gb3J3YXJkQ2hhbm5lbFJlcXVlc3RQb29sLnByb3RvdHlwZS5nZXRNYXhTaXplID0gZnVuY3Rpb24oKSB7XG4gIHJldHVybiB0aGlzLm1heFNpemVfO1xufTtcblxuXG4vKipcbiAqIEByZXR1cm4ge251bWJlcn0gVGhlIG51bWJlciBvZiBwZW5kaW5nIHJlcXVlc3RzIGluIHRoZSBwb29sLlxuICovXG5Gb3J3YXJkQ2hhbm5lbFJlcXVlc3RQb29sLnByb3RvdHlwZS5nZXRSZXF1ZXN0Q291bnQgPSBmdW5jdGlvbigpIHtcbiAgaWYgKHRoaXMucmVxdWVzdF8pIHtcbiAgICByZXR1cm4gMTtcbiAgfVxuXG4gIGlmICh0aGlzLnJlcXVlc3RQb29sXykge1xuICAgIHJldHVybiB0aGlzLnJlcXVlc3RQb29sXy5zaXplO1xuICB9XG5cbiAgcmV0dXJuIDA7XG59O1xuXG5cbi8qKlxuICogQHBhcmFtIHtDaGFubmVsUmVxdWVzdH0gcmVxIFRoZSBjaGFubmVsIHJlcXVlc3QuXG4gKiBAcmV0dXJuIHtib29sZWFufSBUcnVlIGlmIHRoZSByZXF1ZXN0IGlzIGEgaW5jbHVkZWQgaW5zaWRlIHRoZSBwb29sLlxuICovXG5Gb3J3YXJkQ2hhbm5lbFJlcXVlc3RQb29sLnByb3RvdHlwZS5oYXNSZXF1ZXN0ID0gZnVuY3Rpb24ocmVxKSB7XG4gIGlmICh0aGlzLnJlcXVlc3RfKSB7XG4gICAgcmV0dXJuIHRoaXMucmVxdWVzdF8gPT0gcmVxO1xuICB9XG5cbiAgaWYgKHRoaXMucmVxdWVzdFBvb2xfKSB7XG4gICAgcmV0dXJuIHRoaXMucmVxdWVzdFBvb2xfLmhhcyhyZXEpO1xuICB9XG5cbiAgcmV0dXJuIGZhbHNlO1xufTtcblxuXG4vKipcbiAqIEFkZHMgYSBuZXcgcmVxdWVzdCB0byB0aGUgcG9vbC5cbiAqXG4gKiBAcGFyYW0geyFDaGFubmVsUmVxdWVzdH0gcmVxIFRoZSBuZXcgY2hhbm5lbCByZXF1ZXN0LlxuICovXG5Gb3J3YXJkQ2hhbm5lbFJlcXVlc3RQb29sLnByb3RvdHlwZS5hZGRSZXF1ZXN0ID0gZnVuY3Rpb24ocmVxKSB7XG4gIGlmICh0aGlzLnJlcXVlc3RQb29sXykge1xuICAgIHRoaXMucmVxdWVzdFBvb2xfLmFkZChyZXEpO1xuICB9IGVsc2Uge1xuICAgIHRoaXMucmVxdWVzdF8gPSByZXE7XG4gIH1cbn07XG5cblxuLyoqXG4gKiBSZW1vdmVzIHRoZSBnaXZlbiByZXF1ZXN0IGZyb20gdGhlIHBvb2wuXG4gKlxuICogQHBhcmFtIHtDaGFubmVsUmVxdWVzdH0gcmVxIFRoZSBjaGFubmVsIHJlcXVlc3QuXG4gKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoZSByZXF1ZXN0IGhhcyBiZWVuIHJlbW92ZWQgZnJvbSB0aGUgcG9vbC5cbiAqL1xuRm9yd2FyZENoYW5uZWxSZXF1ZXN0UG9vbC5wcm90b3R5cGUucmVtb3ZlUmVxdWVzdCA9IGZ1bmN0aW9uKHJlcSkge1xuICBpZiAodGhpcy5yZXF1ZXN0XyAmJiB0aGlzLnJlcXVlc3RfID09IHJlcSkge1xuICAgIHRoaXMucmVxdWVzdF8gPSBudWxsO1xuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgaWYgKHRoaXMucmVxdWVzdFBvb2xfICYmIHRoaXMucmVxdWVzdFBvb2xfLmhhcyhyZXEpKSB7XG4gICAgdGhpcy5yZXF1ZXN0UG9vbF8uZGVsZXRlKHJlcSk7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICByZXR1cm4gZmFsc2U7XG59O1xuXG5cbi8qKlxuICogQ2xlYXJzIHRoZSBwb29sIGFuZCBjYW5jZWwgYWxsIHRoZSBwZW5kaW5nIHJlcXVlc3RzLlxuICovXG5Gb3J3YXJkQ2hhbm5lbFJlcXVlc3RQb29sLnByb3RvdHlwZS5jYW5jZWwgPSBmdW5jdGlvbigpIHtcbiAgLy8gc2F2ZSBhbnkgcGVuZGluZyBtZXNzYWdlc1xuICB0aGlzLnBlbmRpbmdNZXNzYWdlc18gPSB0aGlzLmdldFBlbmRpbmdNZXNzYWdlcygpO1xuXG4gIGlmICh0aGlzLnJlcXVlc3RfKSB7XG4gICAgdGhpcy5yZXF1ZXN0Xy5jYW5jZWwoKTtcbiAgICB0aGlzLnJlcXVlc3RfID0gbnVsbDtcbiAgICByZXR1cm47XG4gIH1cblxuICBpZiAodGhpcy5yZXF1ZXN0UG9vbF8gJiYgdGhpcy5yZXF1ZXN0UG9vbF8uc2l6ZSAhPT0gMCkge1xuICAgIGZvciAoY29uc3QgdmFsIG9mIHRoaXMucmVxdWVzdFBvb2xfLnZhbHVlcygpKSB7XG4gICAgICB2YWwuY2FuY2VsKCk7XG4gICAgfVxuICAgIHRoaXMucmVxdWVzdFBvb2xfLmNsZWFyKCk7XG4gIH1cbn07XG5cblxuLyoqXG4gKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoZXJlIGFyZSBhbnkgcGVuZGluZyByZXF1ZXN0cy5cbiAqL1xuRm9yd2FyZENoYW5uZWxSZXF1ZXN0UG9vbC5wcm90b3R5cGUuaGFzUGVuZGluZ1JlcXVlc3QgPSBmdW5jdGlvbigpIHtcbiAgcmV0dXJuICh0aGlzLnJlcXVlc3RfICE9IG51bGwpIHx8XG4gICAgICAodGhpcy5yZXF1ZXN0UG9vbF8gIT0gbnVsbCAmJiB0aGlzLnJlcXVlc3RQb29sXy5zaXplICE9PSAwKTtcbn07XG5cblxuLyoqXG4gKiBAcmV0dXJuIHshQXJyYXk8V2lyZS5RdWV1ZWRNYXA+fSBBbGwgdGhlIHBlbmRpbmcgbWVzc2FnZXMgZnJvbSB0aGUgcG9vbCxcbiAqICAgICBhcyBhIG5ldyBhcnJheS5cbiAqL1xuRm9yd2FyZENoYW5uZWxSZXF1ZXN0UG9vbC5wcm90b3R5cGUuZ2V0UGVuZGluZ01lc3NhZ2VzID0gZnVuY3Rpb24oKSB7XG4gIGlmICh0aGlzLnJlcXVlc3RfICE9IG51bGwpIHtcbiAgICByZXR1cm4gdGhpcy5wZW5kaW5nTWVzc2FnZXNfLmNvbmNhdCh0aGlzLnJlcXVlc3RfLmdldFBlbmRpbmdNZXNzYWdlcygpKTtcbiAgfVxuXG4gIGlmICh0aGlzLnJlcXVlc3RQb29sXyAhPSBudWxsICYmIHRoaXMucmVxdWVzdFBvb2xfLnNpemUgIT09IDApIHtcbiAgICBsZXQgcmVzdWx0ID0gdGhpcy5wZW5kaW5nTWVzc2FnZXNfO1xuICAgIGZvciAoY29uc3QgdmFsIG9mIHRoaXMucmVxdWVzdFBvb2xfLnZhbHVlcygpKSB7XG4gICAgICByZXN1bHQgPSByZXN1bHQuY29uY2F0KHZhbC5nZXRQZW5kaW5nTWVzc2FnZXMoKSk7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICByZXR1cm4gYXJyYXkuY2xvbmUodGhpcy5wZW5kaW5nTWVzc2FnZXNfKTtcbn07XG5cblxuLyoqXG4gKiBSZWNvcmRzIHBlbmRpbmcgbWVzc2FnZXMsIGUuZy4gd2hlbiBhIHJlcXVlc3QgcmVjZWl2ZXMgYSBmYWlsZWQgcmVzcG9uc2UuXG4gKlxuICogQHBhcmFtIHshQXJyYXk8V2lyZS5RdWV1ZWRNYXA+fSBtZXNzYWdlcyBQZW5kaW5nIG1lc3NhZ2VzLlxuICovXG5Gb3J3YXJkQ2hhbm5lbFJlcXVlc3RQb29sLnByb3RvdHlwZS5hZGRQZW5kaW5nTWVzc2FnZXMgPSBmdW5jdGlvbihtZXNzYWdlcykge1xuICB0aGlzLnBlbmRpbmdNZXNzYWdlc18gPSB0aGlzLnBlbmRpbmdNZXNzYWdlc18uY29uY2F0KG1lc3NhZ2VzKTtcbn07XG5cblxuLyoqXG4gKiBDbGVhcnMgYW55IHJlY29yZGVkIHBlbmRpbmcgbWVzc2FnZXMuXG4gKi9cbkZvcndhcmRDaGFubmVsUmVxdWVzdFBvb2wucHJvdG90eXBlLmNsZWFyUGVuZGluZ01lc3NhZ2VzID0gZnVuY3Rpb24oKSB7XG4gIHRoaXMucGVuZGluZ01lc3NhZ2VzXy5sZW5ndGggPSAwO1xufTtcblxuXG4vKipcbiAqIENhbmNlbHMgYWxsIHBlbmRpbmcgcmVxdWVzdHMgYW5kIGZvcmNlIHRoZSBjb21wbGV0aW9uIG9mIGNoYW5uZWwgcmVxdWVzdHMuXG4gKlxuICogTmVlZCBnbyB0aHJvdWdoIHRoZSBzdGFuZGFyZCBvblJlcXVlc3RDb21wbGV0ZSBsb2dpYyB0byBleHBvc2UgdGhlIG1heC1yZXRyeVxuICogZmFpbHVyZSBpbiB0aGUgc3RhbmRhcmQgd2F5LlxuICpcbiAqIEBwYXJhbSB7ZnVuY3Rpb24oIUNoYW5uZWxSZXF1ZXN0KX0gb25Db21wbGV0ZSBUaGUgY29tcGxldGlvbiBjYWxsYmFjay5cbiAqIEByZXR1cm4ge2Jvb2xlYW59IHRydWUgaWYgYW55IHJlcXVlc3QgaGFzIGJlZW4gZm9yY2VkIHRvIGNvbXBsZXRlLlxuICovXG5Gb3J3YXJkQ2hhbm5lbFJlcXVlc3RQb29sLnByb3RvdHlwZS5mb3JjZUNvbXBsZXRlID0gZnVuY3Rpb24ob25Db21wbGV0ZSkge1xuICBpZiAodGhpcy5yZXF1ZXN0XyAhPSBudWxsKSB7XG4gICAgdGhpcy5yZXF1ZXN0Xy5jYW5jZWwoKTtcbiAgICBvbkNvbXBsZXRlKHRoaXMucmVxdWVzdF8pO1xuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgaWYgKHRoaXMucmVxdWVzdFBvb2xfICYmIHRoaXMucmVxdWVzdFBvb2xfLnNpemUgIT09IDApIHtcbiAgICBmb3IgKGNvbnN0IHZhbCBvZiB0aGlzLnJlcXVlc3RQb29sXy52YWx1ZXMoKSkge1xuICAgICAgdmFsLmNhbmNlbCgpO1xuICAgICAgb25Db21wbGV0ZSh2YWwpO1xuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIHJldHVybiBmYWxzZTtcbn07XG5cbmV4cG9ydHMgPSBGb3J3YXJkQ2hhbm5lbFJlcXVlc3RQb29sO1xuIiwgIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCBUaGUgQ2xvc3VyZSBMaWJyYXJ5IEF1dGhvcnMuXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogQGZpbGVvdmVydmlldyBHZW5lcmljcyBtZXRob2QgZm9yIGNvbGxlY3Rpb24tbGlrZSBjbGFzc2VzIGFuZCBvYmplY3RzLlxuICpcbiAqXG4gKiBUaGlzIGZpbGUgY29udGFpbnMgZnVuY3Rpb25zIHRvIHdvcmsgd2l0aCBjb2xsZWN0aW9ucy4gSXQgc3VwcG9ydHMgdXNpbmdcbiAqIE1hcCwgU2V0LCBBcnJheSBhbmQgT2JqZWN0IGFuZCBvdGhlciBjbGFzc2VzIHRoYXQgaW1wbGVtZW50IGNvbGxlY3Rpb24tbGlrZVxuICogbWV0aG9kcy5cbiAqIEBzdXBwcmVzcyB7c3RyaWN0TWlzc2luZ1Byb3BlcnRpZXN9XG4gKi9cblxuXG5nb29nLnByb3ZpZGUoJ2dvb2cuc3RydWN0cycpO1xuXG5nb29nLnJlcXVpcmUoJ2dvb2cuYXJyYXknKTtcbmdvb2cucmVxdWlyZSgnZ29vZy5vYmplY3QnKTtcblxuXG4vLyBXZSB0cmVhdCBhbiBvYmplY3QgYXMgYSBkaWN0aW9uYXJ5IGlmIGl0IGhhcyBnZXRLZXlzIG9yIGl0IGlzIGFuIG9iamVjdCB0aGF0XG4vLyBpc24ndCBhcnJheUxpa2UuXG5cblxuLyoqXG4gKiBSZXR1cm5zIHRoZSBudW1iZXIgb2YgdmFsdWVzIGluIHRoZSBjb2xsZWN0aW9uLWxpa2Ugb2JqZWN0LlxuICogQHBhcmFtIHtPYmplY3R9IGNvbCBUaGUgY29sbGVjdGlvbi1saWtlIG9iamVjdC5cbiAqIEByZXR1cm4ge251bWJlcn0gVGhlIG51bWJlciBvZiB2YWx1ZXMgaW4gdGhlIGNvbGxlY3Rpb24tbGlrZSBvYmplY3QuXG4gKi9cbmdvb2cuc3RydWN0cy5nZXRDb3VudCA9IGZ1bmN0aW9uKGNvbCkge1xuICAndXNlIHN0cmljdCc7XG4gIGlmIChjb2wuZ2V0Q291bnQgJiYgdHlwZW9mIGNvbC5nZXRDb3VudCA9PSAnZnVuY3Rpb24nKSB7XG4gICAgcmV0dXJuIGNvbC5nZXRDb3VudCgpO1xuICB9XG4gIGlmIChnb29nLmlzQXJyYXlMaWtlKGNvbCkgfHwgdHlwZW9mIGNvbCA9PT0gJ3N0cmluZycpIHtcbiAgICByZXR1cm4gY29sLmxlbmd0aDtcbiAgfVxuICByZXR1cm4gZ29vZy5vYmplY3QuZ2V0Q291bnQoY29sKTtcbn07XG5cblxuLyoqXG4gKiBSZXR1cm5zIHRoZSB2YWx1ZXMgb2YgdGhlIGNvbGxlY3Rpb24tbGlrZSBvYmplY3QuXG4gKiBAcGFyYW0ge09iamVjdH0gY29sIFRoZSBjb2xsZWN0aW9uLWxpa2Ugb2JqZWN0LlxuICogQHJldHVybiB7IUFycmF5PD8+fSBUaGUgdmFsdWVzIGluIHRoZSBjb2xsZWN0aW9uLWxpa2Ugb2JqZWN0LlxuICovXG5nb29nLnN0cnVjdHMuZ2V0VmFsdWVzID0gZnVuY3Rpb24oY29sKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgaWYgKGNvbC5nZXRWYWx1ZXMgJiYgdHlwZW9mIGNvbC5nZXRWYWx1ZXMgPT0gJ2Z1bmN0aW9uJykge1xuICAgIHJldHVybiBjb2wuZ2V0VmFsdWVzKCk7XG4gIH1cbiAgaWYgKHR5cGVvZiBjb2wgPT09ICdzdHJpbmcnKSB7XG4gICAgcmV0dXJuIGNvbC5zcGxpdCgnJyk7XG4gIH1cbiAgaWYgKGdvb2cuaXNBcnJheUxpa2UoY29sKSkge1xuICAgIHZhciBydiA9IFtdO1xuICAgIHZhciBsID0gY29sLmxlbmd0aDtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGw7IGkrKykge1xuICAgICAgcnYucHVzaChjb2xbaV0pO1xuICAgIH1cbiAgICByZXR1cm4gcnY7XG4gIH1cbiAgcmV0dXJuIGdvb2cub2JqZWN0LmdldFZhbHVlcyhjb2wpO1xufTtcblxuXG4vKipcbiAqIFJldHVybnMgdGhlIGtleXMgb2YgdGhlIGNvbGxlY3Rpb24uIFNvbWUgY29sbGVjdGlvbnMgaGF2ZSBubyBub3Rpb24gb2ZcbiAqIGtleXMvaW5kZXhlcyBhbmQgdGhpcyBmdW5jdGlvbiB3aWxsIHJldHVybiB1bmRlZmluZWQgaW4gdGhvc2UgY2FzZXMuXG4gKiBAcGFyYW0ge09iamVjdH0gY29sIFRoZSBjb2xsZWN0aW9uLWxpa2Ugb2JqZWN0LlxuICogQHJldHVybiB7IUFycmF5fHVuZGVmaW5lZH0gVGhlIGtleXMgaW4gdGhlIGNvbGxlY3Rpb24uXG4gKi9cbmdvb2cuc3RydWN0cy5nZXRLZXlzID0gZnVuY3Rpb24oY29sKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgaWYgKGNvbC5nZXRLZXlzICYmIHR5cGVvZiBjb2wuZ2V0S2V5cyA9PSAnZnVuY3Rpb24nKSB7XG4gICAgcmV0dXJuIGNvbC5nZXRLZXlzKCk7XG4gIH1cbiAgLy8gaWYgd2UgaGF2ZSBnZXRWYWx1ZXMgYnV0IG5vIGdldEtleXMgd2Uga25vdyB0aGlzIGlzIGEga2V5LWxlc3MgY29sbGVjdGlvblxuICBpZiAoY29sLmdldFZhbHVlcyAmJiB0eXBlb2YgY29sLmdldFZhbHVlcyA9PSAnZnVuY3Rpb24nKSB7XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfVxuICBpZiAoZ29vZy5pc0FycmF5TGlrZShjb2wpIHx8IHR5cGVvZiBjb2wgPT09ICdzdHJpbmcnKSB7XG4gICAgdmFyIHJ2ID0gW107XG4gICAgdmFyIGwgPSBjb2wubGVuZ3RoO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbDsgaSsrKSB7XG4gICAgICBydi5wdXNoKGkpO1xuICAgIH1cbiAgICByZXR1cm4gcnY7XG4gIH1cblxuICByZXR1cm4gZ29vZy5vYmplY3QuZ2V0S2V5cyhjb2wpO1xufTtcblxuXG4vKipcbiAqIFdoZXRoZXIgdGhlIGNvbGxlY3Rpb24gY29udGFpbnMgdGhlIGdpdmVuIHZhbHVlLiBUaGlzIGlzIE8obikgYW5kIHVzZXNcbiAqIGVxdWFscyAoPT0pIHRvIHRlc3QgdGhlIGV4aXN0ZW5jZS5cbiAqIEBwYXJhbSB7T2JqZWN0fSBjb2wgVGhlIGNvbGxlY3Rpb24tbGlrZSBvYmplY3QuXG4gKiBAcGFyYW0geyp9IHZhbCBUaGUgdmFsdWUgdG8gY2hlY2sgZm9yLlxuICogQHJldHVybiB7Ym9vbGVhbn0gVHJ1ZSBpZiB0aGUgbWFwIGNvbnRhaW5zIHRoZSB2YWx1ZS5cbiAqL1xuZ29vZy5zdHJ1Y3RzLmNvbnRhaW5zID0gZnVuY3Rpb24oY29sLCB2YWwpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBpZiAoY29sLmNvbnRhaW5zICYmIHR5cGVvZiBjb2wuY29udGFpbnMgPT0gJ2Z1bmN0aW9uJykge1xuICAgIHJldHVybiBjb2wuY29udGFpbnModmFsKTtcbiAgfVxuICBpZiAoY29sLmNvbnRhaW5zVmFsdWUgJiYgdHlwZW9mIGNvbC5jb250YWluc1ZhbHVlID09ICdmdW5jdGlvbicpIHtcbiAgICByZXR1cm4gY29sLmNvbnRhaW5zVmFsdWUodmFsKTtcbiAgfVxuICBpZiAoZ29vZy5pc0FycmF5TGlrZShjb2wpIHx8IHR5cGVvZiBjb2wgPT09ICdzdHJpbmcnKSB7XG4gICAgcmV0dXJuIGdvb2cuYXJyYXkuY29udGFpbnMoLyoqIEB0eXBlIHshQXJyYXk8Pz59ICovIChjb2wpLCB2YWwpO1xuICB9XG4gIHJldHVybiBnb29nLm9iamVjdC5jb250YWluc1ZhbHVlKGNvbCwgdmFsKTtcbn07XG5cblxuLyoqXG4gKiBXaGV0aGVyIHRoZSBjb2xsZWN0aW9uIGlzIGVtcHR5LlxuICogQHBhcmFtIHtPYmplY3R9IGNvbCBUaGUgY29sbGVjdGlvbi1saWtlIG9iamVjdC5cbiAqIEByZXR1cm4ge2Jvb2xlYW59IFRydWUgaWYgZW1wdHkuXG4gKi9cbmdvb2cuc3RydWN0cy5pc0VtcHR5ID0gZnVuY3Rpb24oY29sKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgaWYgKGNvbC5pc0VtcHR5ICYmIHR5cGVvZiBjb2wuaXNFbXB0eSA9PSAnZnVuY3Rpb24nKSB7XG4gICAgcmV0dXJuIGNvbC5pc0VtcHR5KCk7XG4gIH1cblxuICAvLyBXZSBkbyBub3QgdXNlIGdvb2cuc3RyaW5nLmlzRW1wdHlPcldoaXRlc3BhY2UgYmVjYXVzZSBoZXJlIHdlIHRyZWF0IHRoZVxuICAvLyBzdHJpbmcgYXNcbiAgLy8gY29sbGVjdGlvbiBhbmQgYXMgc3VjaCBldmVuIHdoaXRlc3BhY2UgbWF0dGVyc1xuXG4gIGlmIChnb29nLmlzQXJyYXlMaWtlKGNvbCkgfHwgdHlwZW9mIGNvbCA9PT0gJ3N0cmluZycpIHtcbiAgICByZXR1cm4gZ29vZy5hcnJheS5pc0VtcHR5KC8qKiBAdHlwZSB7IUFycmF5PD8+fSAqLyAoY29sKSk7XG4gIH1cbiAgcmV0dXJuIGdvb2cub2JqZWN0LmlzRW1wdHkoY29sKTtcbn07XG5cblxuLyoqXG4gKiBSZW1vdmVzIGFsbCB0aGUgZWxlbWVudHMgZnJvbSB0aGUgY29sbGVjdGlvbi5cbiAqIEBwYXJhbSB7T2JqZWN0fSBjb2wgVGhlIGNvbGxlY3Rpb24tbGlrZSBvYmplY3QuXG4gKiBAcmV0dXJuIHt2b2lkfVxuICovXG5nb29nLnN0cnVjdHMuY2xlYXIgPSBmdW5jdGlvbihjb2wpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICAvLyBOT1RFKGFydik6IFRoaXMgc2hvdWxkIG5vdCBjb250YWluIHN0cmluZ3MgYmVjYXVzZSBzdHJpbmdzIGFyZSBpbW11dGFibGVcbiAgaWYgKGNvbC5jbGVhciAmJiB0eXBlb2YgY29sLmNsZWFyID09ICdmdW5jdGlvbicpIHtcbiAgICBjb2wuY2xlYXIoKTtcbiAgfSBlbHNlIGlmIChnb29nLmlzQXJyYXlMaWtlKGNvbCkpIHtcbiAgICBnb29nLmFycmF5LmNsZWFyKC8qKiBAdHlwZSB7SUFycmF5TGlrZTw/Pn0gKi8gKGNvbCkpO1xuICB9IGVsc2Uge1xuICAgIGdvb2cub2JqZWN0LmNsZWFyKGNvbCk7XG4gIH1cbn07XG5cblxuLyoqXG4gKiBDYWxscyBhIGZ1bmN0aW9uIGZvciBlYWNoIHZhbHVlIGluIGEgY29sbGVjdGlvbi4gVGhlIGZ1bmN0aW9uIHRha2VzXG4gKiB0aHJlZSBhcmd1bWVudHM7IHRoZSB2YWx1ZSwgdGhlIGtleSBhbmQgdGhlIGNvbGxlY3Rpb24uXG4gKlxuICogQHBhcmFtIHtTfSBjb2wgVGhlIGNvbGxlY3Rpb24tbGlrZSBvYmplY3QuXG4gKiBAcGFyYW0ge2Z1bmN0aW9uKHRoaXM6VCw/LD8sUyk6P30gZiBUaGUgZnVuY3Rpb24gdG8gY2FsbCBmb3IgZXZlcnkgdmFsdWUuXG4gKiAgICAgVGhpcyBmdW5jdGlvbiB0YWtlc1xuICogICAgIDMgYXJndW1lbnRzICh0aGUgdmFsdWUsIHRoZSBrZXkgb3IgdW5kZWZpbmVkIGlmIHRoZSBjb2xsZWN0aW9uIGhhcyBub1xuICogICAgIG5vdGlvbiBvZiBrZXlzLCBhbmQgdGhlIGNvbGxlY3Rpb24pIGFuZCB0aGUgcmV0dXJuIHZhbHVlIGlzIGlycmVsZXZhbnQuXG4gKiBAcGFyYW0ge1Q9fSBvcHRfb2JqIFRoZSBvYmplY3QgdG8gYmUgdXNlZCBhcyB0aGUgdmFsdWUgb2YgJ3RoaXMnXG4gKiAgICAgd2l0aGluIGBmYC5cbiAqIEByZXR1cm4ge3ZvaWR9XG4gKiBAdGVtcGxhdGUgVCxTXG4gKiBAZGVwcmVjYXRlZCBVc2UgYSBtb3JlIHNwZWNpZmljIG1ldGhvZCwgZS5nLiBnb29nLmFycmF5LmZvckVhY2gsXG4gKiAgICAgZ29vZy5vYmplY3QuZm9yRWFjaCwgb3IgZm9yLW9mLlxuICovXG5nb29nLnN0cnVjdHMuZm9yRWFjaCA9IGZ1bmN0aW9uKGNvbCwgZiwgb3B0X29iaikge1xuICAndXNlIHN0cmljdCc7XG4gIGlmIChjb2wuZm9yRWFjaCAmJiB0eXBlb2YgY29sLmZvckVhY2ggPT0gJ2Z1bmN0aW9uJykge1xuICAgIGNvbC5mb3JFYWNoKGYsIG9wdF9vYmopO1xuICB9IGVsc2UgaWYgKGdvb2cuaXNBcnJheUxpa2UoY29sKSB8fCB0eXBlb2YgY29sID09PSAnc3RyaW5nJykge1xuICAgIGdvb2cuYXJyYXkuZm9yRWFjaCgvKiogQHR5cGUgeyFBcnJheTw/Pn0gKi8gKGNvbCksIGYsIG9wdF9vYmopO1xuICB9IGVsc2Uge1xuICAgIHZhciBrZXlzID0gZ29vZy5zdHJ1Y3RzLmdldEtleXMoY29sKTtcbiAgICB2YXIgdmFsdWVzID0gZ29vZy5zdHJ1Y3RzLmdldFZhbHVlcyhjb2wpO1xuICAgIHZhciBsID0gdmFsdWVzLmxlbmd0aDtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGw7IGkrKykge1xuICAgICAgZi5jYWxsKC8qKiBAdHlwZSB7P30gKi8gKG9wdF9vYmopLCB2YWx1ZXNbaV0sIGtleXMgJiYga2V5c1tpXSwgY29sKTtcbiAgICB9XG4gIH1cbn07XG5cblxuLyoqXG4gKiBDYWxscyBhIGZ1bmN0aW9uIGZvciBldmVyeSB2YWx1ZSBpbiB0aGUgY29sbGVjdGlvbi4gV2hlbiBhIGNhbGwgcmV0dXJucyB0cnVlLFxuICogYWRkcyB0aGUgdmFsdWUgdG8gYSBuZXcgY29sbGVjdGlvbiAoQXJyYXkgaXMgcmV0dXJuZWQgYnkgZGVmYXVsdCkuXG4gKlxuICogQHBhcmFtIHtTfSBjb2wgVGhlIGNvbGxlY3Rpb24tbGlrZSBvYmplY3QuXG4gKiBAcGFyYW0ge2Z1bmN0aW9uKHRoaXM6VCw/LD8sUyk6Ym9vbGVhbn0gZiBUaGUgZnVuY3Rpb24gdG8gY2FsbCBmb3IgZXZlcnlcbiAqICAgICB2YWx1ZS4gVGhpcyBmdW5jdGlvbiB0YWtlc1xuICogICAgIDMgYXJndW1lbnRzICh0aGUgdmFsdWUsIHRoZSBrZXkgb3IgdW5kZWZpbmVkIGlmIHRoZSBjb2xsZWN0aW9uIGhhcyBub1xuICogICAgIG5vdGlvbiBvZiBrZXlzLCBhbmQgdGhlIGNvbGxlY3Rpb24pIGFuZCBzaG91bGQgcmV0dXJuIGEgQm9vbGVhbi4gSWYgdGhlXG4gKiAgICAgcmV0dXJuIHZhbHVlIGlzIHRydWUgdGhlIHZhbHVlIGlzIGFkZGVkIHRvIHRoZSByZXN1bHQgY29sbGVjdGlvbi4gSWYgaXRcbiAqICAgICBpcyBmYWxzZSB0aGUgdmFsdWUgaXMgbm90IGluY2x1ZGVkLlxuICogQHBhcmFtIHtUPX0gb3B0X29iaiBUaGUgb2JqZWN0IHRvIGJlIHVzZWQgYXMgdGhlIHZhbHVlIG9mICd0aGlzJ1xuICogICAgIHdpdGhpbiBgZmAuXG4gKiBAcmV0dXJuIHshT2JqZWN0fCFBcnJheTw/Pn0gQSBuZXcgY29sbGVjdGlvbiB3aGVyZSB0aGUgcGFzc2VkIHZhbHVlcyBhcmVcbiAqICAgICBwcmVzZW50LiBJZiBjb2wgaXMgYSBrZXktbGVzcyBjb2xsZWN0aW9uIGFuIGFycmF5IGlzIHJldHVybmVkLiAgSWYgY29sXG4gKiAgICAgaGFzIGtleXMgYW5kIHZhbHVlcyBhIHBsYWluIG9sZCBKUyBvYmplY3QgaXMgcmV0dXJuZWQuXG4gKiBAdGVtcGxhdGUgVCxTXG4gKi9cbmdvb2cuc3RydWN0cy5maWx0ZXIgPSBmdW5jdGlvbihjb2wsIGYsIG9wdF9vYmopIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBpZiAodHlwZW9mIGNvbC5maWx0ZXIgPT0gJ2Z1bmN0aW9uJykge1xuICAgIHJldHVybiBjb2wuZmlsdGVyKGYsIG9wdF9vYmopO1xuICB9XG4gIGlmIChnb29nLmlzQXJyYXlMaWtlKGNvbCkgfHwgdHlwZW9mIGNvbCA9PT0gJ3N0cmluZycpIHtcbiAgICByZXR1cm4gZ29vZy5hcnJheS5maWx0ZXIoLyoqIEB0eXBlIHshQXJyYXk8Pz59ICovIChjb2wpLCBmLCBvcHRfb2JqKTtcbiAgfVxuXG4gIHZhciBydjtcbiAgdmFyIGtleXMgPSBnb29nLnN0cnVjdHMuZ2V0S2V5cyhjb2wpO1xuICB2YXIgdmFsdWVzID0gZ29vZy5zdHJ1Y3RzLmdldFZhbHVlcyhjb2wpO1xuICB2YXIgbCA9IHZhbHVlcy5sZW5ndGg7XG4gIGlmIChrZXlzKSB7XG4gICAgcnYgPSB7fTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGw7IGkrKykge1xuICAgICAgaWYgKGYuY2FsbCgvKiogQHR5cGUgez99ICovIChvcHRfb2JqKSwgdmFsdWVzW2ldLCBrZXlzW2ldLCBjb2wpKSB7XG4gICAgICAgIHJ2W2tleXNbaV1dID0gdmFsdWVzW2ldO1xuICAgICAgfVxuICAgIH1cbiAgfSBlbHNlIHtcbiAgICAvLyBXZSBzaG91bGQgbm90IHVzZSBnb29nLmFycmF5LmZpbHRlciBoZXJlIHNpbmNlIHdlIHdhbnQgdG8gbWFrZSBzdXJlIHRoYXRcbiAgICAvLyB0aGUgaW5kZXggaXMgdW5kZWZpbmVkIGFzIHdlbGwgYXMgbWFrZSBzdXJlIHRoYXQgY29sIGlzIHBhc3NlZCB0byB0aGVcbiAgICAvLyBmdW5jdGlvbi5cbiAgICBydiA9IFtdO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbDsgaSsrKSB7XG4gICAgICBpZiAoZi5jYWxsKG9wdF9vYmosIHZhbHVlc1tpXSwgdW5kZWZpbmVkLCBjb2wpKSB7XG4gICAgICAgIHJ2LnB1c2godmFsdWVzW2ldKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIHJ2O1xufTtcblxuXG4vKipcbiAqIENhbGxzIGEgZnVuY3Rpb24gZm9yIGV2ZXJ5IHZhbHVlIGluIHRoZSBjb2xsZWN0aW9uIGFuZCBhZGRzIHRoZSByZXN1bHQgaW50byBhXG4gKiBuZXcgY29sbGVjdGlvbiAoZGVmYXVsdHMgdG8gY3JlYXRpbmcgYSBuZXcgQXJyYXkpLlxuICpcbiAqIEBwYXJhbSB7U30gY29sIFRoZSBjb2xsZWN0aW9uLWxpa2Ugb2JqZWN0LlxuICogQHBhcmFtIHtmdW5jdGlvbih0aGlzOlQsPyw/LFMpOlZ9IGYgVGhlIGZ1bmN0aW9uIHRvIGNhbGwgZm9yIGV2ZXJ5IHZhbHVlLlxuICogICAgIFRoaXMgZnVuY3Rpb24gdGFrZXMgMyBhcmd1bWVudHMgKHRoZSB2YWx1ZSwgdGhlIGtleSBvciB1bmRlZmluZWQgaWYgdGhlXG4gKiAgICAgY29sbGVjdGlvbiBoYXMgbm8gbm90aW9uIG9mIGtleXMsIGFuZCB0aGUgY29sbGVjdGlvbikgYW5kIHNob3VsZCByZXR1cm5cbiAqICAgICBzb21ldGhpbmcuIFRoZSByZXN1bHQgd2lsbCBiZSB1c2VkIGFzIHRoZSB2YWx1ZSBpbiB0aGUgbmV3IGNvbGxlY3Rpb24uXG4gKiBAcGFyYW0ge1Q9fSBvcHRfb2JqICBUaGUgb2JqZWN0IHRvIGJlIHVzZWQgYXMgdGhlIHZhbHVlIG9mICd0aGlzJ1xuICogICAgIHdpdGhpbiBgZmAuXG4gKiBAcmV0dXJuIHshT2JqZWN0PFY+fCFBcnJheTxWPn0gQSBuZXcgY29sbGVjdGlvbiB3aXRoIHRoZSBuZXcgdmFsdWVzLiAgSWZcbiAqICAgICBjb2wgaXMgYSBrZXktbGVzcyBjb2xsZWN0aW9uIGFuIGFycmF5IGlzIHJldHVybmVkLiAgSWYgY29sIGhhcyBrZXlzIGFuZFxuICogICAgIHZhbHVlcyBhIHBsYWluIG9sZCBKUyBvYmplY3QgaXMgcmV0dXJuZWQuXG4gKiBAdGVtcGxhdGUgVCxTLFZcbiAqL1xuZ29vZy5zdHJ1Y3RzLm1hcCA9IGZ1bmN0aW9uKGNvbCwgZiwgb3B0X29iaikge1xuICAndXNlIHN0cmljdCc7XG4gIGlmICh0eXBlb2YgY29sLm1hcCA9PSAnZnVuY3Rpb24nKSB7XG4gICAgcmV0dXJuIGNvbC5tYXAoZiwgb3B0X29iaik7XG4gIH1cbiAgaWYgKGdvb2cuaXNBcnJheUxpa2UoY29sKSB8fCB0eXBlb2YgY29sID09PSAnc3RyaW5nJykge1xuICAgIHJldHVybiBnb29nLmFycmF5Lm1hcCgvKiogQHR5cGUgeyFBcnJheTw/Pn0gKi8gKGNvbCksIGYsIG9wdF9vYmopO1xuICB9XG5cbiAgdmFyIHJ2O1xuICB2YXIga2V5cyA9IGdvb2cuc3RydWN0cy5nZXRLZXlzKGNvbCk7XG4gIHZhciB2YWx1ZXMgPSBnb29nLnN0cnVjdHMuZ2V0VmFsdWVzKGNvbCk7XG4gIHZhciBsID0gdmFsdWVzLmxlbmd0aDtcbiAgaWYgKGtleXMpIHtcbiAgICBydiA9IHt9O1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbDsgaSsrKSB7XG4gICAgICBydltrZXlzW2ldXSA9IGYuY2FsbCgvKiogQHR5cGUgez99ICovIChvcHRfb2JqKSwgdmFsdWVzW2ldLCBrZXlzW2ldLCBjb2wpO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICAvLyBXZSBzaG91bGQgbm90IHVzZSBnb29nLmFycmF5Lm1hcCBoZXJlIHNpbmNlIHdlIHdhbnQgdG8gbWFrZSBzdXJlIHRoYXRcbiAgICAvLyB0aGUgaW5kZXggaXMgdW5kZWZpbmVkIGFzIHdlbGwgYXMgbWFrZSBzdXJlIHRoYXQgY29sIGlzIHBhc3NlZCB0byB0aGVcbiAgICAvLyBmdW5jdGlvbi5cbiAgICBydiA9IFtdO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbDsgaSsrKSB7XG4gICAgICBydltpXSA9IGYuY2FsbCgvKiogQHR5cGUgez99ICovIChvcHRfb2JqKSwgdmFsdWVzW2ldLCB1bmRlZmluZWQsIGNvbCk7XG4gICAgfVxuICB9XG4gIHJldHVybiBydjtcbn07XG5cblxuLyoqXG4gKiBDYWxscyBmIGZvciBlYWNoIHZhbHVlIGluIGEgY29sbGVjdGlvbi4gSWYgYW55IGNhbGwgcmV0dXJucyB0cnVlIHRoaXMgcmV0dXJuc1xuICogdHJ1ZSAod2l0aG91dCBjaGVja2luZyB0aGUgcmVzdCkuIElmIGFsbCByZXR1cm5zIGZhbHNlIHRoaXMgcmV0dXJucyBmYWxzZS5cbiAqXG4gKiBAcGFyYW0ge1N9IGNvbCBUaGUgY29sbGVjdGlvbi1saWtlIG9iamVjdC5cbiAqIEBwYXJhbSB7ZnVuY3Rpb24odGhpczpULD8sPyxTKTpib29sZWFufSBmIFRoZSBmdW5jdGlvbiB0byBjYWxsIGZvciBldmVyeVxuICogICAgIHZhbHVlLiBUaGlzIGZ1bmN0aW9uIHRha2VzIDMgYXJndW1lbnRzICh0aGUgdmFsdWUsIHRoZSBrZXkgb3IgdW5kZWZpbmVkXG4gKiAgICAgaWYgdGhlIGNvbGxlY3Rpb24gaGFzIG5vIG5vdGlvbiBvZiBrZXlzLCBhbmQgdGhlIGNvbGxlY3Rpb24pIGFuZCBzaG91bGRcbiAqICAgICByZXR1cm4gYSBib29sZWFuLlxuICogQHBhcmFtIHtUPX0gb3B0X29iaiAgVGhlIG9iamVjdCB0byBiZSB1c2VkIGFzIHRoZSB2YWx1ZSBvZiAndGhpcydcbiAqICAgICB3aXRoaW4gYGZgLlxuICogQHJldHVybiB7Ym9vbGVhbn0gVHJ1ZSBpZiBhbnkgdmFsdWUgcGFzc2VzIHRoZSB0ZXN0LlxuICogQHRlbXBsYXRlIFQsU1xuICovXG5nb29nLnN0cnVjdHMuc29tZSA9IGZ1bmN0aW9uKGNvbCwgZiwgb3B0X29iaikge1xuICAndXNlIHN0cmljdCc7XG4gIGlmICh0eXBlb2YgY29sLnNvbWUgPT0gJ2Z1bmN0aW9uJykge1xuICAgIHJldHVybiBjb2wuc29tZShmLCBvcHRfb2JqKTtcbiAgfVxuICBpZiAoZ29vZy5pc0FycmF5TGlrZShjb2wpIHx8IHR5cGVvZiBjb2wgPT09ICdzdHJpbmcnKSB7XG4gICAgcmV0dXJuIGdvb2cuYXJyYXkuc29tZSgvKiogQHR5cGUgeyFBcnJheTw/Pn0gKi8gKGNvbCksIGYsIG9wdF9vYmopO1xuICB9XG4gIHZhciBrZXlzID0gZ29vZy5zdHJ1Y3RzLmdldEtleXMoY29sKTtcbiAgdmFyIHZhbHVlcyA9IGdvb2cuc3RydWN0cy5nZXRWYWx1ZXMoY29sKTtcbiAgdmFyIGwgPSB2YWx1ZXMubGVuZ3RoO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IGw7IGkrKykge1xuICAgIGlmIChmLmNhbGwoLyoqIEB0eXBlIHs/fSAqLyAob3B0X29iaiksIHZhbHVlc1tpXSwga2V5cyAmJiBrZXlzW2ldLCBjb2wpKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGZhbHNlO1xufTtcblxuXG4vKipcbiAqIENhbGxzIGYgZm9yIGVhY2ggdmFsdWUgaW4gYSBjb2xsZWN0aW9uLiBJZiBhbGwgY2FsbHMgcmV0dXJuIHRydWUgdGhpcyByZXR1cm5cbiAqIHRydWUgdGhpcyByZXR1cm5zIHRydWUuIElmIGFueSByZXR1cm5zIGZhbHNlIHRoaXMgcmV0dXJucyBmYWxzZSBhdCB0aGlzIHBvaW50XG4gKiAgYW5kIGRvZXMgbm90IGNvbnRpbnVlIHRvIGNoZWNrIHRoZSByZW1haW5pbmcgdmFsdWVzLlxuICpcbiAqIEBwYXJhbSB7U30gY29sIFRoZSBjb2xsZWN0aW9uLWxpa2Ugb2JqZWN0LlxuICogQHBhcmFtIHtmdW5jdGlvbih0aGlzOlQsPyw/LFMpOmJvb2xlYW59IGYgVGhlIGZ1bmN0aW9uIHRvIGNhbGwgZm9yIGV2ZXJ5XG4gKiAgICAgdmFsdWUuIFRoaXMgZnVuY3Rpb24gdGFrZXMgMyBhcmd1bWVudHMgKHRoZSB2YWx1ZSwgdGhlIGtleSBvclxuICogICAgIHVuZGVmaW5lZCBpZiB0aGUgY29sbGVjdGlvbiBoYXMgbm8gbm90aW9uIG9mIGtleXMsIGFuZCB0aGUgY29sbGVjdGlvbilcbiAqICAgICBhbmQgc2hvdWxkIHJldHVybiBhIGJvb2xlYW4uXG4gKiBAcGFyYW0ge1Q9fSBvcHRfb2JqICBUaGUgb2JqZWN0IHRvIGJlIHVzZWQgYXMgdGhlIHZhbHVlIG9mICd0aGlzJ1xuICogICAgIHdpdGhpbiBgZmAuXG4gKiBAcmV0dXJuIHtib29sZWFufSBUcnVlIGlmIGFsbCBrZXktdmFsdWUgcGFpcnMgcGFzcyB0aGUgdGVzdC5cbiAqIEB0ZW1wbGF0ZSBULFNcbiAqL1xuZ29vZy5zdHJ1Y3RzLmV2ZXJ5ID0gZnVuY3Rpb24oY29sLCBmLCBvcHRfb2JqKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgaWYgKHR5cGVvZiBjb2wuZXZlcnkgPT0gJ2Z1bmN0aW9uJykge1xuICAgIHJldHVybiBjb2wuZXZlcnkoZiwgb3B0X29iaik7XG4gIH1cbiAgaWYgKGdvb2cuaXNBcnJheUxpa2UoY29sKSB8fCB0eXBlb2YgY29sID09PSAnc3RyaW5nJykge1xuICAgIHJldHVybiBnb29nLmFycmF5LmV2ZXJ5KC8qKiBAdHlwZSB7IUFycmF5PD8+fSAqLyAoY29sKSwgZiwgb3B0X29iaik7XG4gIH1cbiAgdmFyIGtleXMgPSBnb29nLnN0cnVjdHMuZ2V0S2V5cyhjb2wpO1xuICB2YXIgdmFsdWVzID0gZ29vZy5zdHJ1Y3RzLmdldFZhbHVlcyhjb2wpO1xuICB2YXIgbCA9IHZhbHVlcy5sZW5ndGg7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgbDsgaSsrKSB7XG4gICAgaWYgKCFmLmNhbGwoLyoqIEB0eXBlIHs/fSAqLyAob3B0X29iaiksIHZhbHVlc1tpXSwga2V5cyAmJiBrZXlzW2ldLCBjb2wpKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG4gIHJldHVybiB0cnVlO1xufTtcbiIsICIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgVGhlIENsb3N1cmUgTGlicmFyeSBBdXRob3JzLlxuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIEBmaWxlb3ZlcnZpZXcgRGF0YXN0cnVjdHVyZTogSGFzaCBNYXAuXG4gKlxuICpcbiAqIFRoaXMgZmlsZSBjb250YWlucyBhbiBpbXBsZW1lbnRhdGlvbiBvZiBhIE1hcCBzdHJ1Y3R1cmUuIEl0IGltcGxlbWVudHMgYSBsb3RcbiAqIG9mIHRoZSBtZXRob2RzIHVzZWQgaW4gZ29vZy5zdHJ1Y3RzIHNvIHRob3NlIGZ1bmN0aW9ucyB3b3JrIG9uIGhhc2hlcy4gVGhpc1xuICogaXMgYmVzdCBzdWl0ZWQgZm9yIGNvbXBsZXgga2V5IHR5cGVzLiBGb3Igc2ltcGxlIGtleXMgc3VjaCBhcyBudW1iZXJzIGFuZFxuICogc3RyaW5ncyBjb25zaWRlciB1c2luZyB0aGUgbGlnaHRlci13ZWlnaHQgdXRpbGl0aWVzIGluIGdvb2cub2JqZWN0LlxuICovXG5cblxuZ29vZy5wcm92aWRlKCdnb29nLnN0cnVjdHMuTWFwJyk7XG5cbmdvb2cucmVxdWlyZSgnZ29vZy5pdGVyLkl0ZXJhdG9yJyk7XG5nb29nLnJlcXVpcmUoJ2dvb2cuaXRlci5TdG9wSXRlcmF0aW9uJyk7XG5cblxuXG4vKipcbiAqIENsYXNzIGZvciBIYXNoIE1hcCBkYXRhc3RydWN0dXJlLlxuICogQHBhcmFtIHsqPX0gb3B0X21hcCBNYXAgb3IgT2JqZWN0IHRvIGluaXRpYWxpemUgdGhlIG1hcCB3aXRoLlxuICogQHBhcmFtIHsuLi4qfSB2YXJfYXJncyBJZiAyIG9yIG1vcmUgYXJndW1lbnRzIGFyZSBwcmVzZW50IHRoZW4gdGhleVxuICogICAgIHdpbGwgYmUgdXNlZCBhcyBrZXktdmFsdWUgcGFpcnMuXG4gKiBAY29uc3RydWN0b3JcbiAqIEB0ZW1wbGF0ZSBLLCBWXG4gKiBAZGVwcmVjYXRlZCBUaGlzIHR5cGUgaXMgbWlzbGVhZGluZzogdXNlIEVTNiBNYXAgaW5zdGVhZC5cbiAqL1xuZ29vZy5zdHJ1Y3RzLk1hcCA9IGZ1bmN0aW9uKG9wdF9tYXAsIHZhcl9hcmdzKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgLyoqXG4gICAqIFVuZGVybHlpbmcgSlMgb2JqZWN0IHVzZWQgdG8gaW1wbGVtZW50IHRoZSBtYXAuXG4gICAqIEBwcml2YXRlIHshT2JqZWN0fVxuICAgKi9cbiAgdGhpcy5tYXBfID0ge307XG5cbiAgLyoqXG4gICAqIEFuIGFycmF5IG9mIGtleXMuIFRoaXMgaXMgbmVjZXNzYXJ5IGZvciB0d28gcmVhc29uczpcbiAgICogICAxLiBJdGVyYXRpbmcgdGhlIGtleXMgdXNpbmcgZm9yICh2YXIga2V5IGluIHRoaXMubWFwXykgYWxsb2NhdGVzIGFuXG4gICAqICAgICAgb2JqZWN0IGZvciBldmVyeSBrZXkgaW4gSUUgd2hpY2ggaXMgcmVhbGx5IGJhZCBmb3IgSUU2IEdDIHBlcmYuXG4gICAqICAgMi4gV2l0aG91dCBhIHNpZGUgZGF0YSBzdHJ1Y3R1cmUsIHdlIHdvdWxkIG5lZWQgdG8gZXNjYXBlIGFsbCB0aGUga2V5c1xuICAgKiAgICAgIGFzIHRoYXQgd291bGQgYmUgdGhlIG9ubHkgd2F5IHdlIGNvdWxkIHRlbGwgZHVyaW5nIGl0ZXJhdGlvbiBpZiB0aGVcbiAgICogICAgICBrZXkgd2FzIGFuIGludGVybmFsIGtleSBvciBhIHByb3BlcnR5IG9mIHRoZSBvYmplY3QuXG4gICAqXG4gICAqIFRoaXMgYXJyYXkgY2FuIGNvbnRhaW4gZGVsZXRlZCBrZXlzIHNvIGl0J3MgbmVjZXNzYXJ5IHRvIGNoZWNrIHRoZSBtYXBcbiAgICogYXMgd2VsbCB0byBzZWUgaWYgdGhlIGtleSBpcyBzdGlsbCBpbiB0aGUgbWFwICh0aGlzIGRvZXNuJ3QgcmVxdWlyZSBhXG4gICAqIG1lbW9yeSBhbGxvY2F0aW9uIGluIElFKS5cbiAgICogQHByaXZhdGUgeyFBcnJheTxzdHJpbmc+fVxuICAgKi9cbiAgdGhpcy5rZXlzXyA9IFtdO1xuXG4gIC8qKlxuICAgKiBUaGUgbnVtYmVyIG9mIGtleSB2YWx1ZSBwYWlycyBpbiB0aGUgbWFwLlxuICAgKiBAcHJpdmF0ZSB7bnVtYmVyfVxuICAgKi9cbiAgdGhpcy5jb3VudF8gPSAwO1xuXG4gIC8qKlxuICAgKiBWZXJzaW9uIHVzZWQgdG8gZGV0ZWN0IGNoYW5nZXMgd2hpbGUgaXRlcmF0aW5nLlxuICAgKiBAcHJpdmF0ZSB7bnVtYmVyfVxuICAgKi9cbiAgdGhpcy52ZXJzaW9uXyA9IDA7XG5cbiAgdmFyIGFyZ0xlbmd0aCA9IGFyZ3VtZW50cy5sZW5ndGg7XG5cbiAgaWYgKGFyZ0xlbmd0aCA+IDEpIHtcbiAgICBpZiAoYXJnTGVuZ3RoICUgMikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdVbmV2ZW4gbnVtYmVyIG9mIGFyZ3VtZW50cycpO1xuICAgIH1cbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFyZ0xlbmd0aDsgaSArPSAyKSB7XG4gICAgICB0aGlzLnNldChhcmd1bWVudHNbaV0sIGFyZ3VtZW50c1tpICsgMV0pO1xuICAgIH1cbiAgfSBlbHNlIGlmIChvcHRfbWFwKSB7XG4gICAgdGhpcy5hZGRBbGwoLyoqIEB0eXBlIHshT2JqZWN0fSAqLyAob3B0X21hcCkpO1xuICB9XG59O1xuXG5cbi8qKlxuICogQHJldHVybiB7bnVtYmVyfSBUaGUgbnVtYmVyIG9mIGtleS12YWx1ZSBwYWlycyBpbiB0aGUgbWFwLlxuICovXG5nb29nLnN0cnVjdHMuTWFwLnByb3RvdHlwZS5nZXRDb3VudCA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIHJldHVybiB0aGlzLmNvdW50Xztcbn07XG5cblxuLyoqXG4gKiBSZXR1cm5zIHRoZSB2YWx1ZXMgb2YgdGhlIG1hcC5cbiAqIEByZXR1cm4geyFBcnJheTxWPn0gVGhlIHZhbHVlcyBpbiB0aGUgbWFwLlxuICovXG5nb29nLnN0cnVjdHMuTWFwLnByb3RvdHlwZS5nZXRWYWx1ZXMgPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICB0aGlzLmNsZWFudXBLZXlzQXJyYXlfKCk7XG5cbiAgdmFyIHJ2ID0gW107XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5rZXlzXy5sZW5ndGg7IGkrKykge1xuICAgIHZhciBrZXkgPSB0aGlzLmtleXNfW2ldO1xuICAgIHJ2LnB1c2godGhpcy5tYXBfW2tleV0pO1xuICB9XG4gIHJldHVybiBydjtcbn07XG5cblxuLyoqXG4gKiBSZXR1cm5zIHRoZSBrZXlzIG9mIHRoZSBtYXAuXG4gKiBAcmV0dXJuIHshQXJyYXk8c3RyaW5nPn0gQXJyYXkgb2Ygc3RyaW5nIHZhbHVlcy5cbiAqL1xuZ29vZy5zdHJ1Y3RzLk1hcC5wcm90b3R5cGUuZ2V0S2V5cyA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIHRoaXMuY2xlYW51cEtleXNBcnJheV8oKTtcbiAgcmV0dXJuIC8qKiBAdHlwZSB7IUFycmF5PHN0cmluZz59ICovICh0aGlzLmtleXNfLmNvbmNhdCgpKTtcbn07XG5cblxuLyoqXG4gKiBXaGV0aGVyIHRoZSBtYXAgY29udGFpbnMgdGhlIGdpdmVuIGtleS5cbiAqIEBwYXJhbSB7Kn0ga2V5IFRoZSBrZXkgdG8gY2hlY2sgZm9yLlxuICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGUgbWFwIGNvbnRhaW5zIHRoZSBrZXkuXG4gKi9cbmdvb2cuc3RydWN0cy5NYXAucHJvdG90eXBlLmNvbnRhaW5zS2V5ID0gZnVuY3Rpb24oa2V5KSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmV0dXJuIGdvb2cuc3RydWN0cy5NYXAuaGFzS2V5Xyh0aGlzLm1hcF8sIGtleSk7XG59O1xuXG5cbi8qKlxuICogV2hldGhlciB0aGUgbWFwIGNvbnRhaW5zIHRoZSBnaXZlbiB2YWx1ZS4gVGhpcyBpcyBPKG4pLlxuICogQHBhcmFtIHtWfSB2YWwgVGhlIHZhbHVlIHRvIGNoZWNrIGZvci5cbiAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgdGhlIG1hcCBjb250YWlucyB0aGUgdmFsdWUuXG4gKi9cbmdvb2cuc3RydWN0cy5NYXAucHJvdG90eXBlLmNvbnRhaW5zVmFsdWUgPSBmdW5jdGlvbih2YWwpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMua2V5c18ubGVuZ3RoOyBpKyspIHtcbiAgICB2YXIga2V5ID0gdGhpcy5rZXlzX1tpXTtcbiAgICBpZiAoZ29vZy5zdHJ1Y3RzLk1hcC5oYXNLZXlfKHRoaXMubWFwXywga2V5KSAmJiB0aGlzLm1hcF9ba2V5XSA9PSB2YWwpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgfVxuICByZXR1cm4gZmFsc2U7XG59O1xuXG5cbi8qKlxuICogV2hldGhlciB0aGlzIG1hcCBpcyBlcXVhbCB0byB0aGUgYXJndW1lbnQgbWFwLlxuICogQHBhcmFtIHtnb29nLnN0cnVjdHMuTWFwfSBvdGhlck1hcCBUaGUgbWFwIGFnYWluc3Qgd2hpY2ggdG8gdGVzdCBlcXVhbGl0eS5cbiAqIEBwYXJhbSB7ZnVuY3Rpb24oViwgVik6IGJvb2xlYW49fSBvcHRfZXF1YWxpdHlGbiBPcHRpb25hbCBlcXVhbGl0eSBmdW5jdGlvblxuICogICAgIHRvIHRlc3QgZXF1YWxpdHkgb2YgdmFsdWVzLiBJZiBub3Qgc3BlY2lmaWVkLCB0aGlzIHdpbGwgdGVzdCB3aGV0aGVyXG4gKiAgICAgdGhlIHZhbHVlcyBjb250YWluZWQgaW4gZWFjaCBtYXAgYXJlIGlkZW50aWNhbCBvYmplY3RzLlxuICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGUgbWFwcyBhcmUgZXF1YWwuXG4gKi9cbmdvb2cuc3RydWN0cy5NYXAucHJvdG90eXBlLmVxdWFscyA9IGZ1bmN0aW9uKG90aGVyTWFwLCBvcHRfZXF1YWxpdHlGbikge1xuICAndXNlIHN0cmljdCc7XG4gIGlmICh0aGlzID09PSBvdGhlck1hcCkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgaWYgKHRoaXMuY291bnRfICE9IG90aGVyTWFwLmdldENvdW50KCkpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICB2YXIgZXF1YWxpdHlGbiA9IG9wdF9lcXVhbGl0eUZuIHx8IGdvb2cuc3RydWN0cy5NYXAuZGVmYXVsdEVxdWFscztcblxuICB0aGlzLmNsZWFudXBLZXlzQXJyYXlfKCk7XG4gIGZvciAodmFyIGtleSwgaSA9IDA7IGtleSA9IHRoaXMua2V5c19baV07IGkrKykge1xuICAgIGlmICghZXF1YWxpdHlGbih0aGlzLmdldChrZXkpLCBvdGhlck1hcC5nZXQoa2V5KSkpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gdHJ1ZTtcbn07XG5cblxuLyoqXG4gKiBEZWZhdWx0IGVxdWFsaXR5IHRlc3QgZm9yIHZhbHVlcy5cbiAqIEBwYXJhbSB7Kn0gYSBUaGUgZmlyc3QgdmFsdWUuXG4gKiBAcGFyYW0geyp9IGIgVGhlIHNlY29uZCB2YWx1ZS5cbiAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgYSBhbmQgYiByZWZlcmVuY2UgdGhlIHNhbWUgb2JqZWN0LlxuICovXG5nb29nLnN0cnVjdHMuTWFwLmRlZmF1bHRFcXVhbHMgPSBmdW5jdGlvbihhLCBiKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmV0dXJuIGEgPT09IGI7XG59O1xuXG5cbi8qKlxuICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGUgbWFwIGlzIGVtcHR5LlxuICovXG5nb29nLnN0cnVjdHMuTWFwLnByb3RvdHlwZS5pc0VtcHR5ID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmV0dXJuIHRoaXMuY291bnRfID09IDA7XG59O1xuXG5cbi8qKlxuICogUmVtb3ZlcyBhbGwga2V5LXZhbHVlIHBhaXJzIGZyb20gdGhlIG1hcC5cbiAqL1xuZ29vZy5zdHJ1Y3RzLk1hcC5wcm90b3R5cGUuY2xlYXIgPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICB0aGlzLm1hcF8gPSB7fTtcbiAgdGhpcy5rZXlzXy5sZW5ndGggPSAwO1xuICB0aGlzLmNvdW50XyA9IDA7XG4gIHRoaXMudmVyc2lvbl8gPSAwO1xufTtcblxuXG4vKipcbiAqIFJlbW92ZXMgYSBrZXktdmFsdWUgcGFpciBiYXNlZCBvbiB0aGUga2V5LiBUaGlzIGlzIE8obG9nTikgYW1vcnRpemVkIGR1ZSB0b1xuICogdXBkYXRpbmcgdGhlIGtleXMgYXJyYXkgd2hlbmV2ZXIgdGhlIGNvdW50IGJlY29tZXMgaGFsZiB0aGUgc2l6ZSBvZiB0aGUga2V5c1xuICogaW4gdGhlIGtleXMgYXJyYXkuXG4gKiBAcGFyYW0geyp9IGtleSAgVGhlIGtleSB0byByZW1vdmUuXG4gKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIG9iamVjdCB3YXMgcmVtb3ZlZC5cbiAqL1xuZ29vZy5zdHJ1Y3RzLk1hcC5wcm90b3R5cGUucmVtb3ZlID0gZnVuY3Rpb24oa2V5KSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgaWYgKGdvb2cuc3RydWN0cy5NYXAuaGFzS2V5Xyh0aGlzLm1hcF8sIGtleSkpIHtcbiAgICBkZWxldGUgdGhpcy5tYXBfW2tleV07XG4gICAgdGhpcy5jb3VudF8tLTtcbiAgICB0aGlzLnZlcnNpb25fKys7XG5cbiAgICAvLyBjbGVhbiB1cCB0aGUga2V5cyBhcnJheSBpZiB0aGUgdGhyZXNob2xkIGlzIGhpdFxuICAgIGlmICh0aGlzLmtleXNfLmxlbmd0aCA+IDIgKiB0aGlzLmNvdW50Xykge1xuICAgICAgdGhpcy5jbGVhbnVwS2V5c0FycmF5XygpO1xuICAgIH1cblxuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIHJldHVybiBmYWxzZTtcbn07XG5cblxuLyoqXG4gKiBDbGVhbnMgdXAgdGhlIHRlbXAga2V5cyBhcnJheSBieSByZW1vdmluZyBlbnRyaWVzIHRoYXQgYXJlIG5vIGxvbmdlciBpbiB0aGVcbiAqIG1hcC5cbiAqIEBwcml2YXRlXG4gKi9cbmdvb2cuc3RydWN0cy5NYXAucHJvdG90eXBlLmNsZWFudXBLZXlzQXJyYXlfID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgaWYgKHRoaXMuY291bnRfICE9IHRoaXMua2V5c18ubGVuZ3RoKSB7XG4gICAgLy8gRmlyc3QgcmVtb3ZlIGtleXMgdGhhdCBhcmUgbm8gbG9uZ2VyIGluIHRoZSBtYXAuXG4gICAgdmFyIHNyY0luZGV4ID0gMDtcbiAgICB2YXIgZGVzdEluZGV4ID0gMDtcbiAgICB3aGlsZSAoc3JjSW5kZXggPCB0aGlzLmtleXNfLmxlbmd0aCkge1xuICAgICAgdmFyIGtleSA9IHRoaXMua2V5c19bc3JjSW5kZXhdO1xuICAgICAgaWYgKGdvb2cuc3RydWN0cy5NYXAuaGFzS2V5Xyh0aGlzLm1hcF8sIGtleSkpIHtcbiAgICAgICAgdGhpcy5rZXlzX1tkZXN0SW5kZXgrK10gPSBrZXk7XG4gICAgICB9XG4gICAgICBzcmNJbmRleCsrO1xuICAgIH1cbiAgICB0aGlzLmtleXNfLmxlbmd0aCA9IGRlc3RJbmRleDtcbiAgfVxuXG4gIGlmICh0aGlzLmNvdW50XyAhPSB0aGlzLmtleXNfLmxlbmd0aCkge1xuICAgIC8vIElmIHRoZSBjb3VudCBzdGlsbCBpc24ndCBjb3JyZWN0LCB0aGF0IG1lYW5zIHdlIGhhdmUgZHVwbGljYXRlcy4gVGhpcyBjYW5cbiAgICAvLyBoYXBwZW4gd2hlbiB0aGUgc2FtZSBrZXkgaXMgYWRkZWQgYW5kIHJlbW92ZWQgbXVsdGlwbGUgdGltZXMuIE5vdyB3ZSBoYXZlXG4gICAgLy8gdG8gYWxsb2NhdGUgb25lIGV4dHJhIE9iamVjdCB0byByZW1vdmUgdGhlIGR1cGxpY2F0ZXMuIFRoaXMgY291bGQgaGF2ZVxuICAgIC8vIGJlZW4gZG9uZSBpbiB0aGUgZmlyc3QgcGFzcywgYnV0IGluIHRoZSBjb21tb24gY2FzZSwgd2UgY2FuIGF2b2lkXG4gICAgLy8gYWxsb2NhdGluZyBhbiBleHRyYSBvYmplY3QgYnkgb25seSBkb2luZyB0aGlzIHdoZW4gbmVjZXNzYXJ5LlxuICAgIHZhciBzZWVuID0ge307XG4gICAgdmFyIHNyY0luZGV4ID0gMDtcbiAgICB2YXIgZGVzdEluZGV4ID0gMDtcbiAgICB3aGlsZSAoc3JjSW5kZXggPCB0aGlzLmtleXNfLmxlbmd0aCkge1xuICAgICAgdmFyIGtleSA9IHRoaXMua2V5c19bc3JjSW5kZXhdO1xuICAgICAgaWYgKCEoZ29vZy5zdHJ1Y3RzLk1hcC5oYXNLZXlfKHNlZW4sIGtleSkpKSB7XG4gICAgICAgIHRoaXMua2V5c19bZGVzdEluZGV4KytdID0ga2V5O1xuICAgICAgICBzZWVuW2tleV0gPSAxO1xuICAgICAgfVxuICAgICAgc3JjSW5kZXgrKztcbiAgICB9XG4gICAgdGhpcy5rZXlzXy5sZW5ndGggPSBkZXN0SW5kZXg7XG4gIH1cbn07XG5cblxuLyoqXG4gKiBSZXR1cm5zIHRoZSB2YWx1ZSBmb3IgdGhlIGdpdmVuIGtleS4gIElmIHRoZSBrZXkgaXMgbm90IGZvdW5kIGFuZCB0aGUgZGVmYXVsdFxuICogdmFsdWUgaXMgbm90IGdpdmVuIHRoaXMgd2lsbCByZXR1cm4gYHVuZGVmaW5lZGAuXG4gKiBAcGFyYW0geyp9IGtleSBUaGUga2V5IHRvIGdldCB0aGUgdmFsdWUgZm9yLlxuICogQHBhcmFtIHtERUZBVUxUPX0gb3B0X3ZhbCBUaGUgdmFsdWUgdG8gcmV0dXJuIGlmIG5vIGl0ZW0gaXMgZm91bmQgZm9yIHRoZVxuICogICAgIGdpdmVuIGtleSwgZGVmYXVsdHMgdG8gdW5kZWZpbmVkLlxuICogQHJldHVybiB7VnxERUZBVUxUfSBUaGUgdmFsdWUgZm9yIHRoZSBnaXZlbiBrZXkuXG4gKiBAdGVtcGxhdGUgREVGQVVMVFxuICovXG5nb29nLnN0cnVjdHMuTWFwLnByb3RvdHlwZS5nZXQgPSBmdW5jdGlvbihrZXksIG9wdF92YWwpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBpZiAoZ29vZy5zdHJ1Y3RzLk1hcC5oYXNLZXlfKHRoaXMubWFwXywga2V5KSkge1xuICAgIHJldHVybiB0aGlzLm1hcF9ba2V5XTtcbiAgfVxuICByZXR1cm4gb3B0X3ZhbDtcbn07XG5cblxuLyoqXG4gKiBBZGRzIGEga2V5LXZhbHVlIHBhaXIgdG8gdGhlIG1hcC5cbiAqIEBwYXJhbSB7Kn0ga2V5IFRoZSBrZXkuXG4gKiBAcGFyYW0ge1Z9IHZhbHVlIFRoZSB2YWx1ZSB0byBhZGQuXG4gKiBAcmV0dXJuIHsqfSBTb21lIHN1YmNsYXNzZXMgcmV0dXJuIGEgdmFsdWUuXG4gKi9cbmdvb2cuc3RydWN0cy5NYXAucHJvdG90eXBlLnNldCA9IGZ1bmN0aW9uKGtleSwgdmFsdWUpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBpZiAoIShnb29nLnN0cnVjdHMuTWFwLmhhc0tleV8odGhpcy5tYXBfLCBrZXkpKSkge1xuICAgIHRoaXMuY291bnRfKys7XG4gICAgLy8gVE9ETyhqb2hubGVueik6IFRoaXMgY2xhc3MgbGllcywgaXQgY2xhaW1zIHRvIHJldHVybiBhbiBhcnJheSBvZiBzdHJpbmdcbiAgICAvLyBrZXlzLCBidXQgaW5zdGVhZCByZXR1cm5zIHRoZSBvcmlnaW5hbCBvYmplY3QgdXNlZC5cbiAgICB0aGlzLmtleXNfLnB1c2goLyoqIEB0eXBlIHs/fSAqLyAoa2V5KSk7XG4gICAgLy8gT25seSBjaGFuZ2UgdGhlIHZlcnNpb24gaWYgd2UgYWRkIGEgbmV3IGtleS5cbiAgICB0aGlzLnZlcnNpb25fKys7XG4gIH1cbiAgdGhpcy5tYXBfW2tleV0gPSB2YWx1ZTtcbn07XG5cblxuLyoqXG4gKiBBZGRzIG11bHRpcGxlIGtleS12YWx1ZSBwYWlycyBmcm9tIGFub3RoZXIgZ29vZy5zdHJ1Y3RzLk1hcCBvciBPYmplY3QuXG4gKiBAcGFyYW0gez9PYmplY3R9IG1hcCBPYmplY3QgY29udGFpbmluZyB0aGUgZGF0YSB0byBhZGQuXG4gKi9cbmdvb2cuc3RydWN0cy5NYXAucHJvdG90eXBlLmFkZEFsbCA9IGZ1bmN0aW9uKG1hcCkge1xuICAndXNlIHN0cmljdCc7XG4gIGlmIChtYXAgaW5zdGFuY2VvZiBnb29nLnN0cnVjdHMuTWFwKSB7XG4gICAgdmFyIGtleXMgPSBtYXAuZ2V0S2V5cygpO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7IGkrKykge1xuICAgICAgdGhpcy5zZXQoa2V5c1tpXSwgbWFwLmdldChrZXlzW2ldKSk7XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIGZvciAodmFyIGtleSBpbiBtYXApIHtcbiAgICAgIHRoaXMuc2V0KGtleSwgbWFwW2tleV0pO1xuICAgIH1cbiAgfVxufTtcblxuXG4vKipcbiAqIENhbGxzIHRoZSBnaXZlbiBmdW5jdGlvbiBvbiBlYWNoIGVudHJ5IGluIHRoZSBtYXAuXG4gKiBAcGFyYW0ge2Z1bmN0aW9uKHRoaXM6VCwgViwgSywgZ29vZy5zdHJ1Y3RzLk1hcDxLLFY+KX0gZlxuICogQHBhcmFtIHtUPX0gb3B0X29iaiBUaGUgdmFsdWUgb2YgXCJ0aGlzXCIgaW5zaWRlIGYuXG4gKiBAdGVtcGxhdGUgVFxuICovXG5nb29nLnN0cnVjdHMuTWFwLnByb3RvdHlwZS5mb3JFYWNoID0gZnVuY3Rpb24oZiwgb3B0X29iaikge1xuICAndXNlIHN0cmljdCc7XG4gIHZhciBrZXlzID0gdGhpcy5nZXRLZXlzKCk7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7IGkrKykge1xuICAgIHZhciBrZXkgPSBrZXlzW2ldO1xuICAgIHZhciB2YWx1ZSA9IHRoaXMuZ2V0KGtleSk7XG4gICAgZi5jYWxsKG9wdF9vYmosIHZhbHVlLCBrZXksIHRoaXMpO1xuICB9XG59O1xuXG5cbi8qKlxuICogQ2xvbmVzIGEgbWFwIGFuZCByZXR1cm5zIGEgbmV3IG1hcC5cbiAqIEByZXR1cm4geyFnb29nLnN0cnVjdHMuTWFwfSBBIG5ldyBtYXAgd2l0aCB0aGUgc2FtZSBrZXktdmFsdWUgcGFpcnMuXG4gKi9cbmdvb2cuc3RydWN0cy5NYXAucHJvdG90eXBlLmNsb25lID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmV0dXJuIG5ldyBnb29nLnN0cnVjdHMuTWFwKHRoaXMpO1xufTtcblxuXG4vKipcbiAqIFJldHVybnMgYSBuZXcgbWFwIGluIHdoaWNoIGFsbCB0aGUga2V5cyBhbmQgdmFsdWVzIGFyZSBpbnRlcmNoYW5nZWRcbiAqIChrZXlzIGJlY29tZSB2YWx1ZXMgYW5kIHZhbHVlcyBiZWNvbWUga2V5cykuIElmIG11bHRpcGxlIGtleXMgbWFwIHRvIHRoZVxuICogc2FtZSB2YWx1ZSwgdGhlIGNob3NlbiB0cmFuc3Bvc2VkIHZhbHVlIGlzIGltcGxlbWVudGF0aW9uLWRlcGVuZGVudC5cbiAqXG4gKiBJdCBhY3RzIHZlcnkgc2ltaWxhcmx5IHRvIHtnb29nLm9iamVjdC50cmFuc3Bvc2UoT2JqZWN0KX0uXG4gKlxuICogQHJldHVybiB7IWdvb2cuc3RydWN0cy5NYXB9IFRoZSB0cmFuc3Bvc2VkIG1hcC5cbiAqL1xuZ29vZy5zdHJ1Y3RzLk1hcC5wcm90b3R5cGUudHJhbnNwb3NlID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgdmFyIHRyYW5zcG9zZWQgPSBuZXcgZ29vZy5zdHJ1Y3RzLk1hcCgpO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMua2V5c18ubGVuZ3RoOyBpKyspIHtcbiAgICB2YXIga2V5ID0gdGhpcy5rZXlzX1tpXTtcbiAgICB2YXIgdmFsdWUgPSB0aGlzLm1hcF9ba2V5XTtcbiAgICB0cmFuc3Bvc2VkLnNldCh2YWx1ZSwga2V5KTtcbiAgfVxuXG4gIHJldHVybiB0cmFuc3Bvc2VkO1xufTtcblxuXG4vKipcbiAqIEByZXR1cm4geyFPYmplY3R9IE9iamVjdCByZXByZXNlbnRhdGlvbiBvZiB0aGUgbWFwLlxuICovXG5nb29nLnN0cnVjdHMuTWFwLnByb3RvdHlwZS50b09iamVjdCA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIHRoaXMuY2xlYW51cEtleXNBcnJheV8oKTtcbiAgdmFyIG9iaiA9IHt9O1xuICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMua2V5c18ubGVuZ3RoOyBpKyspIHtcbiAgICB2YXIga2V5ID0gdGhpcy5rZXlzX1tpXTtcbiAgICBvYmpba2V5XSA9IHRoaXMubWFwX1trZXldO1xuICB9XG4gIHJldHVybiBvYmo7XG59O1xuXG5cbi8qKlxuICogUmV0dXJucyBhbiBpdGVyYXRvciB0aGF0IGl0ZXJhdGVzIG92ZXIgdGhlIGtleXMgaW4gdGhlIG1hcC4gIFJlbW92YWwgb2Yga2V5c1xuICogd2hpbGUgaXRlcmF0aW5nIG1pZ2h0IGhhdmUgdW5kZXNpcmVkIHNpZGUgZWZmZWN0cy5cbiAqIEByZXR1cm4geyFnb29nLml0ZXIuSXRlcmF0b3J9IEFuIGl0ZXJhdG9yIG92ZXIgdGhlIGtleXMgaW4gdGhlIG1hcC5cbiAqL1xuZ29vZy5zdHJ1Y3RzLk1hcC5wcm90b3R5cGUuZ2V0S2V5SXRlcmF0b3IgPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gdGhpcy5fX2l0ZXJhdG9yX18odHJ1ZSk7XG59O1xuXG5cbi8qKlxuICogUmV0dXJucyBhbiBpdGVyYXRvciB0aGF0IGl0ZXJhdGVzIG92ZXIgdGhlIHZhbHVlcyBpbiB0aGUgbWFwLiAgUmVtb3ZhbCBvZlxuICoga2V5cyB3aGlsZSBpdGVyYXRpbmcgbWlnaHQgaGF2ZSB1bmRlc2lyZWQgc2lkZSBlZmZlY3RzLlxuICogQHJldHVybiB7IWdvb2cuaXRlci5JdGVyYXRvcn0gQW4gaXRlcmF0b3Igb3ZlciB0aGUgdmFsdWVzIGluIHRoZSBtYXAuXG4gKi9cbmdvb2cuc3RydWN0cy5NYXAucHJvdG90eXBlLmdldFZhbHVlSXRlcmF0b3IgPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gdGhpcy5fX2l0ZXJhdG9yX18oZmFsc2UpO1xufTtcblxuXG4vKipcbiAqIFJldHVybnMgYW4gaXRlcmF0b3IgdGhhdCBpdGVyYXRlcyBvdmVyIHRoZSB2YWx1ZXMgb3IgdGhlIGtleXMgaW4gdGhlIG1hcC5cbiAqIFRoaXMgdGhyb3dzIGFuIGV4Y2VwdGlvbiBpZiB0aGUgbWFwIHdhcyBtdXRhdGVkIHNpbmNlIHRoZSBpdGVyYXRvciB3YXNcbiAqIGNyZWF0ZWQuXG4gKiBAcGFyYW0ge2Jvb2xlYW49fSBvcHRfa2V5cyBUcnVlIHRvIGl0ZXJhdGUgb3ZlciB0aGUga2V5cy4gRmFsc2UgdG8gaXRlcmF0ZVxuICogICAgIG92ZXIgdGhlIHZhbHVlcy4gIFRoZSBkZWZhdWx0IHZhbHVlIGlzIGZhbHNlLlxuICogQHJldHVybiB7IWdvb2cuaXRlci5JdGVyYXRvcn0gQW4gaXRlcmF0b3Igb3ZlciB0aGUgdmFsdWVzIG9yIGtleXMgaW4gdGhlIG1hcC5cbiAqL1xuZ29vZy5zdHJ1Y3RzLk1hcC5wcm90b3R5cGUuX19pdGVyYXRvcl9fID0gZnVuY3Rpb24ob3B0X2tleXMpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICAvLyBDbGVhbiB1cCBrZXlzIHRvIG1pbmltaXplIHRoZSByaXNrIG9mIGl0ZXJhdGluZyBvdmVyIGRlYWQga2V5cy5cbiAgdGhpcy5jbGVhbnVwS2V5c0FycmF5XygpO1xuXG4gIHZhciBpID0gMDtcbiAgdmFyIHZlcnNpb24gPSB0aGlzLnZlcnNpb25fO1xuICB2YXIgc2VsZk9iaiA9IHRoaXM7XG5cbiAgdmFyIG5ld0l0ZXIgPSBuZXcgZ29vZy5pdGVyLkl0ZXJhdG9yO1xuICBuZXdJdGVyLm5leHQgPSBmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgaWYgKHZlcnNpb24gIT0gc2VsZk9iai52ZXJzaW9uXykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGUgbWFwIGhhcyBjaGFuZ2VkIHNpbmNlIHRoZSBpdGVyYXRvciB3YXMgY3JlYXRlZCcpO1xuICAgIH1cbiAgICBpZiAoaSA+PSBzZWxmT2JqLmtleXNfLmxlbmd0aCkge1xuICAgICAgdGhyb3cgZ29vZy5pdGVyLlN0b3BJdGVyYXRpb247XG4gICAgfVxuICAgIHZhciBrZXkgPSBzZWxmT2JqLmtleXNfW2krK107XG4gICAgcmV0dXJuIG9wdF9rZXlzID8ga2V5IDogc2VsZk9iai5tYXBfW2tleV07XG4gIH07XG4gIHJldHVybiBuZXdJdGVyO1xufTtcblxuXG4vKipcbiAqIFNhZmUgd2F5IHRvIHRlc3QgZm9yIGhhc093blByb3BlcnR5LiAgSXQgZXZlbiBhbGxvd3MgdGVzdGluZyBmb3JcbiAqICdoYXNPd25Qcm9wZXJ0eScuXG4gKiBAcGFyYW0geyFPYmplY3R9IG9iaiBUaGUgb2JqZWN0IHRvIHRlc3QgZm9yIHByZXNlbmNlIG9mIHRoZSBnaXZlbiBrZXkuXG4gKiBAcGFyYW0geyp9IGtleSBUaGUga2V5IHRvIGNoZWNrIGZvci5cbiAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgdGhlIG9iamVjdCBoYXMgdGhlIGtleS5cbiAqIEBwcml2YXRlXG4gKi9cbmdvb2cuc3RydWN0cy5NYXAuaGFzS2V5XyA9IGZ1bmN0aW9uKG9iaiwga2V5KSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGtleSk7XG59O1xuIiwgIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCBUaGUgQ2xvc3VyZSBMaWJyYXJ5IEF1dGhvcnMuXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogQGZpbGVvdmVydmlldyBTaW1wbGUgdXRpbGl0aWVzIGZvciBkZWFsaW5nIHdpdGggVVJJIHN0cmluZ3MuXG4gKlxuICogVGhpcyBwYWNrYWdlIGlzIGRlcHJlY2F0ZWQgaW4gZmF2b3VyIG9mIHRoZSBDbG9zdXJlIFVSTCBwYWNrYWdlIChnb29nLnVybClcbiAqIHdoZW4gbWFuaXB1bGF0aW5nIFVSSXMgZm9yIHVzZSBieSBhIGJyb3dzZXIuIFRoaXMgcGFja2FnZSB1c2VzIHJlZ3VsYXJcbiAqIGV4cHJlc3Npb25zIHRvIHBhcnNlIGEgcG90ZW50aWFsIFVSSSB3aGljaCBjYW4gZmFsbCBvdXQgb2Ygc3luYyB3aXRoIGhvdyBhXG4gKiBicm93c2VyIHdpbGwgYWN0dWFsbHkgaW50ZXJwcmV0IHRoZSBVUkkuIFNlZVxuICogYGdvb2cudXJpLnV0aWxzLnNldFVybFBhY2thZ2VTdXBwb3J0TG9nZ2luZ0hhbmRsZXJgIGZvciBvbmUgd2F5IHRvIGlkZW50aWZ5XG4gKiBVUklzIHRoYXQgc2hvdWxkIGluc3RlYWQgYmUgcGFyc2VkIHVzaW5nIHRoZSBVUkwgcGFja2FnZS5cbiAqXG4gKiBUaGlzIGlzIGludGVuZGVkIHRvIGJlIGEgbGlnaHR3ZWlnaHQgYWx0ZXJuYXRpdmUgdG8gY29uc3RydWN0aW5nIGdvb2cuVXJpXG4gKiBvYmplY3RzLiAgV2hlcmVhcyBnb29nLlVyaSBhZGRzIHNldmVyYWwga2lsb2J5dGVzIHRvIHRoZSBiaW5hcnkgcmVnYXJkbGVzc1xuICogb2YgaG93IG11Y2ggb2YgaXRzIGZ1bmN0aW9uYWxpdHkgeW91IHVzZSwgdGhpcyBpcyBkZXNpZ25lZCB0byBiZSBhIHNldCBvZlxuICogbW9zdGx5LWluZGVwZW5kZW50IHV0aWxpdGllcyBzbyB0aGF0IHRoZSBjb21waWxlciBpbmNsdWRlcyBvbmx5IHdoYXQgaXNcbiAqIG5lY2Vzc2FyeSBmb3IgdGhlIHRhc2suICBFc3RpbWF0ZWQgc2F2aW5ncyBvZiBwb3J0aW5nIGlzIDVrIHByZS1nemlwIGFuZFxuICogMS41ayBwb3N0LWd6aXAuICBUbyBlbnN1cmUgdGhlIHNhdmluZ3MgcmVtYWluLCBmdXR1cmUgZGV2ZWxvcGVycyBzaG91bGRcbiAqIGF2b2lkIGFkZGluZyBuZXcgZnVuY3Rpb25hbGl0eSB0byBleGlzdGluZyBmdW5jdGlvbnMsIGJ1dCBpbnN0ZWFkIGNyZWF0ZVxuICogbmV3IG9uZXMgYW5kIGZhY3RvciBvdXQgc2hhcmVkIGNvZGUuXG4gKlxuICogTWFueSBvZiB0aGVzZSB1dGlsaXRpZXMgaGF2ZSBsaW1pdGVkIGZ1bmN0aW9uYWxpdHksIHRhaWxvcmVkIHRvIGNvbW1vblxuICogY2FzZXMuICBUaGUgcXVlcnkgcGFyYW1ldGVyIHV0aWxpdGllcyBhc3N1bWUgdGhhdCB0aGUgcGFyYW1ldGVyIGtleXMgYXJlXG4gKiBhbHJlYWR5IGVuY29kZWQsIHNpbmNlIG1vc3Qga2V5cyBhcmUgY29tcGlsZS10aW1lIGFscGhhbnVtZXJpYyBzdHJpbmdzLiAgVGhlXG4gKiBxdWVyeSBwYXJhbWV0ZXIgbXV0YXRpb24gdXRpbGl0aWVzIGFsc28gZG8gbm90IHRvbGVyYXRlIGZyYWdtZW50IGlkZW50aWZpZXJzLlxuICpcbiAqIEJ5IGRlc2lnbiwgdGhlc2UgZnVuY3Rpb25zIGNhbiBiZSBzbG93ZXIgdGhhbiBnb29nLlVyaSBlcXVpdmFsZW50cy5cbiAqIFJlcGVhdGVkIGNhbGxzIHRvIHNvbWUgb2YgZnVuY3Rpb25zIG1heSBiZSBxdWFkcmF0aWMgaW4gYmVoYXZpb3IgZm9yIElFLFxuICogYWx0aG91Z2ggdGhlIGVmZmVjdCBpcyBzb21ld2hhdCBsaW1pdGVkIGdpdmVuIHRoZSAya2IgbGltaXQuXG4gKlxuICogT25lIGFkdmFudGFnZSBvZiB0aGUgbGltaXRlZCBmdW5jdGlvbmFsaXR5IGhlcmUgaXMgdGhhdCB0aGlzIGFwcHJvYWNoIGlzXG4gKiBsZXNzIHNlbnNpdGl2ZSB0byBkaWZmZXJlbmNlcyBpbiBVUkkgZW5jb2RpbmdzIHRoYW4gZ29vZy5VcmksIHNpbmNlIHRoZXNlXG4gKiBmdW5jdGlvbnMgb3BlcmF0ZSBvbiBzdHJpbmdzIGRpcmVjdGx5LCByYXRoZXIgdGhhbiBkZWNvZGluZyB0aGVtIGFuZFxuICogdGhlbiByZS1lbmNvZGluZy5cbiAqXG4gKiBVc2VzIGZlYXR1cmVzIG9mIFJGQyAzOTg2IGZvciBwYXJzaW5nL2Zvcm1hdHRpbmcgVVJJczpcbiAqICAgaHR0cDovL3d3dy5pZXRmLm9yZy9yZmMvcmZjMzk4Ni50eHRcbiAqL1xuXG5nb29nLnByb3ZpZGUoJ2dvb2cudXJpLnV0aWxzJyk7XG5nb29nLnByb3ZpZGUoJ2dvb2cudXJpLnV0aWxzLkNvbXBvbmVudEluZGV4Jyk7XG5nb29nLnByb3ZpZGUoJ2dvb2cudXJpLnV0aWxzLlF1ZXJ5QXJyYXknKTtcbmdvb2cucHJvdmlkZSgnZ29vZy51cmkudXRpbHMuUXVlcnlWYWx1ZScpO1xuZ29vZy5wcm92aWRlKCdnb29nLnVyaS51dGlscy5TdGFuZGFyZFF1ZXJ5UGFyYW0nKTtcblxuZ29vZy5yZXF1aXJlKCdnb29nLmFzc2VydHMnKTtcbmdvb2cucmVxdWlyZSgnZ29vZy5zdHJpbmcnKTtcblxuXG4vKipcbiAqIENoYXJhY3RlciBjb2RlcyBpbmxpbmVkIHRvIGF2b2lkIG9iamVjdCBhbGxvY2F0aW9ucyBkdWUgdG8gY2hhckNvZGUuXG4gKiBAZW51bSB7bnVtYmVyfVxuICogQHByaXZhdGVcbiAqL1xuZ29vZy51cmkudXRpbHMuQ2hhckNvZGVfID0ge1xuICBBTVBFUlNBTkQ6IDM4LFxuICBFUVVBTDogNjEsXG4gIEhBU0g6IDM1LFxuICBRVUVTVElPTjogNjNcbn07XG5cblxuLyoqXG4gKiBCdWlsZHMgYSBVUkkgc3RyaW5nIGZyb20gYWxyZWFkeS1lbmNvZGVkIHBhcnRzLlxuICpcbiAqIE5vIGVuY29kaW5nIGlzIHBlcmZvcm1lZC4gIEFueSBjb21wb25lbnQgbWF5IGJlIG9taXR0ZWQgYXMgZWl0aGVyIG51bGwgb3JcbiAqIHVuZGVmaW5lZC5cbiAqXG4gKiBAcGFyYW0gez9zdHJpbmc9fSBvcHRfc2NoZW1lIFRoZSBzY2hlbWUgc3VjaCBhcyAnaHR0cCcuXG4gKiBAcGFyYW0gez9zdHJpbmc9fSBvcHRfdXNlckluZm8gVGhlIHVzZXIgbmFtZSBiZWZvcmUgdGhlICdAJy5cbiAqIEBwYXJhbSB7P3N0cmluZz19IG9wdF9kb21haW4gVGhlIGRvbWFpbiBzdWNoIGFzICd3d3cuZ29vZ2xlLmNvbScsIGFscmVhZHlcbiAqICAgICBVUkktZW5jb2RlZC5cbiAqIEBwYXJhbSB7KHN0cmluZ3xudW1iZXJ8bnVsbCk9fSBvcHRfcG9ydCBUaGUgcG9ydCBudW1iZXIuXG4gKiBAcGFyYW0gez9zdHJpbmc9fSBvcHRfcGF0aCBUaGUgcGF0aCwgYWxyZWFkeSBVUkktZW5jb2RlZC4gIElmIGl0IGlzIG5vdFxuICogICAgIGVtcHR5LCBpdCBtdXN0IGJlZ2luIHdpdGggYSBzbGFzaC5cbiAqIEBwYXJhbSB7P3N0cmluZz19IG9wdF9xdWVyeURhdGEgVGhlIFVSSS1lbmNvZGVkIHF1ZXJ5IGRhdGEuXG4gKiBAcGFyYW0gez9zdHJpbmc9fSBvcHRfZnJhZ21lbnQgVGhlIFVSSS1lbmNvZGVkIGZyYWdtZW50IGlkZW50aWZpZXIuXG4gKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSBmdWxseSBjb21iaW5lZCBVUkkuXG4gKi9cbmdvb2cudXJpLnV0aWxzLmJ1aWxkRnJvbUVuY29kZWRQYXJ0cyA9IGZ1bmN0aW9uKFxuICAgIG9wdF9zY2hlbWUsIG9wdF91c2VySW5mbywgb3B0X2RvbWFpbiwgb3B0X3BvcnQsIG9wdF9wYXRoLCBvcHRfcXVlcnlEYXRhLFxuICAgIG9wdF9mcmFnbWVudCkge1xuICAndXNlIHN0cmljdCc7XG4gIHZhciBvdXQgPSAnJztcblxuICBpZiAob3B0X3NjaGVtZSkge1xuICAgIG91dCArPSBvcHRfc2NoZW1lICsgJzonO1xuICB9XG5cbiAgaWYgKG9wdF9kb21haW4pIHtcbiAgICBvdXQgKz0gJy8vJztcblxuICAgIGlmIChvcHRfdXNlckluZm8pIHtcbiAgICAgIG91dCArPSBvcHRfdXNlckluZm8gKyAnQCc7XG4gICAgfVxuXG4gICAgb3V0ICs9IG9wdF9kb21haW47XG5cbiAgICBpZiAob3B0X3BvcnQpIHtcbiAgICAgIG91dCArPSAnOicgKyBvcHRfcG9ydDtcbiAgICB9XG4gIH1cblxuICBpZiAob3B0X3BhdGgpIHtcbiAgICBvdXQgKz0gb3B0X3BhdGg7XG4gIH1cblxuICBpZiAob3B0X3F1ZXJ5RGF0YSkge1xuICAgIG91dCArPSAnPycgKyBvcHRfcXVlcnlEYXRhO1xuICB9XG5cbiAgaWYgKG9wdF9mcmFnbWVudCkge1xuICAgIG91dCArPSAnIycgKyBvcHRfZnJhZ21lbnQ7XG4gIH1cblxuICByZXR1cm4gb3V0O1xufTtcblxuXG4vKipcbiAqIEEgcmVndWxhciBleHByZXNzaW9uIGZvciBicmVha2luZyBhIFVSSSBpbnRvIGl0cyBjb21wb25lbnQgcGFydHMuXG4gKlxuICoge0BsaW5rIGh0dHA6Ly93d3cuaWV0Zi5vcmcvcmZjL3JmYzM5ODYudHh0fSBzYXlzIGluIEFwcGVuZGl4IEJcbiAqIEFzIHRoZSBcImZpcnN0LW1hdGNoLXdpbnNcIiBhbGdvcml0aG0gaXMgaWRlbnRpY2FsIHRvIHRoZSBcImdyZWVkeVwiXG4gKiBkaXNhbWJpZ3VhdGlvbiBtZXRob2QgdXNlZCBieSBQT1NJWCByZWd1bGFyIGV4cHJlc3Npb25zLCBpdCBpcyBuYXR1cmFsIGFuZFxuICogY29tbW9ucGxhY2UgdG8gdXNlIGEgcmVndWxhciBleHByZXNzaW9uIGZvciBwYXJzaW5nIHRoZSBwb3RlbnRpYWwgZml2ZVxuICogY29tcG9uZW50cyBvZiBhIFVSSSByZWZlcmVuY2UuXG4gKlxuICogVGhlIGZvbGxvd2luZyBsaW5lIGlzIHRoZSByZWd1bGFyIGV4cHJlc3Npb24gZm9yIGJyZWFraW5nLWRvd24gYVxuICogd2VsbC1mb3JtZWQgVVJJIHJlZmVyZW5jZSBpbnRvIGl0cyBjb21wb25lbnRzLlxuICpcbiAqIDxwcmU+XG4gKiBeKChbXjovPyNdKyk6KT8oLy8oW14vPyNdKikpPyhbXj8jXSopKFxcPyhbXiNdKikpPygjKC4qKSk/XG4gKiAgMTIgICAgICAgICAgICAzICA0ICAgICAgICAgIDUgICAgICAgNiAgNyAgICAgICAgOCA5XG4gKiA8L3ByZT5cbiAqXG4gKiBUaGUgbnVtYmVycyBpbiB0aGUgc2Vjb25kIGxpbmUgYWJvdmUgYXJlIG9ubHkgdG8gYXNzaXN0IHJlYWRhYmlsaXR5OyB0aGV5XG4gKiBpbmRpY2F0ZSB0aGUgcmVmZXJlbmNlIHBvaW50cyBmb3IgZWFjaCBzdWJleHByZXNzaW9uIChpLmUuLCBlYWNoIHBhaXJlZFxuICogcGFyZW50aGVzaXMpLiBXZSByZWZlciB0byB0aGUgdmFsdWUgbWF0Y2hlZCBmb3Igc3ViZXhwcmVzc2lvbiA8bj4gYXMgJDxuPi5cbiAqIEZvciBleGFtcGxlLCBtYXRjaGluZyB0aGUgYWJvdmUgZXhwcmVzc2lvbiB0b1xuICogPHByZT5cbiAqICAgICBodHRwOi8vd3d3Lmljcy51Y2kuZWR1L3B1Yi9pZXRmL3VyaS8jUmVsYXRlZFxuICogPC9wcmU+XG4gKiByZXN1bHRzIGluIHRoZSBmb2xsb3dpbmcgc3ViZXhwcmVzc2lvbiBtYXRjaGVzOlxuICogPHByZT5cbiAqICAgICQxID0gaHR0cDpcbiAqICAgICQyID0gaHR0cFxuICogICAgJDMgPSAvL3d3dy5pY3MudWNpLmVkdVxuICogICAgJDQgPSB3d3cuaWNzLnVjaS5lZHVcbiAqICAgICQ1ID0gL3B1Yi9pZXRmL3VyaS9cbiAqICAgICQ2ID0gPHVuZGVmaW5lZD5cbiAqICAgICQ3ID0gPHVuZGVmaW5lZD5cbiAqICAgICQ4ID0gI1JlbGF0ZWRcbiAqICAgICQ5ID0gUmVsYXRlZFxuICogPC9wcmU+XG4gKiB3aGVyZSA8dW5kZWZpbmVkPiBpbmRpY2F0ZXMgdGhhdCB0aGUgY29tcG9uZW50IGlzIG5vdCBwcmVzZW50LCBhcyBpcyB0aGVcbiAqIGNhc2UgZm9yIHRoZSBxdWVyeSBjb21wb25lbnQgaW4gdGhlIGFib3ZlIGV4YW1wbGUuIFRoZXJlZm9yZSwgd2UgY2FuXG4gKiBkZXRlcm1pbmUgdGhlIHZhbHVlIG9mIHRoZSBmaXZlIGNvbXBvbmVudHMgYXNcbiAqIDxwcmU+XG4gKiAgICBzY2hlbWUgICAgPSAkMlxuICogICAgYXV0aG9yaXR5ID0gJDRcbiAqICAgIHBhdGggICAgICA9ICQ1XG4gKiAgICBxdWVyeSAgICAgPSAkN1xuICogICAgZnJhZ21lbnQgID0gJDlcbiAqIDwvcHJlPlxuICpcbiAqIFRoZSByZWd1bGFyIGV4cHJlc3Npb24gaGFzIGJlZW4gbW9kaWZpZWQgc2xpZ2h0bHkgdG8gZXhwb3NlIHRoZVxuICogdXNlckluZm8sIGRvbWFpbiwgYW5kIHBvcnQgc2VwYXJhdGVseSBmcm9tIHRoZSBhdXRob3JpdHkuXG4gKiBUaGUgbW9kaWZpZWQgdmVyc2lvbiB5aWVsZHNcbiAqIDxwcmU+XG4gKiAgICAkMSA9IGh0dHAgICAgICAgICAgICAgIHNjaGVtZVxuICogICAgJDIgPSA8dW5kZWZpbmVkPiAgICAgICB1c2VySW5mbyAtXFxcbiAqICAgICQzID0gd3d3Lmljcy51Y2kuZWR1ICAgZG9tYWluICAgICB8IGF1dGhvcml0eVxuICogICAgJDQgPSA8dW5kZWZpbmVkPiAgICAgICBwb3J0ICAgICAtL1xuICogICAgJDUgPSAvcHViL2lldGYvdXJpLyAgICBwYXRoXG4gKiAgICAkNiA9IDx1bmRlZmluZWQ+ICAgICAgIHF1ZXJ5IHdpdGhvdXQgP1xuICogICAgJDcgPSBSZWxhdGVkICAgICAgICAgICBmcmFnbWVudCB3aXRob3V0ICNcbiAqIDwvcHJlPlxuICpcbiAqIFRPRE8odXNlcik6IHNlcGFyYXRlIG91dCB0aGUgYXV0aG9yaXR5IHRlcm1pbmF0aW5nIGNoYXJhY3RlcnMgb25jZSB0aGlzXG4gKiBmaWxlIGlzIG1vdmVkIHRvIEVTNi5cbiAqIEB0eXBlIHshUmVnRXhwfVxuICogQHByaXZhdGVcbiAqL1xuZ29vZy51cmkudXRpbHMuc3BsaXRSZV8gPSBuZXcgUmVnRXhwKFxuICAgICdeJyArICAvLyBBbmNob3IgYWdhaW5zdCB0aGUgZW50aXJlIHN0cmluZy5cbiAgICAnKD86JyArXG4gICAgJyhbXjovPyMuXSspJyArICAvLyBzY2hlbWUgLSBpZ25vcmUgc3BlY2lhbCBjaGFyYWN0ZXJzXG4gICAgICAgICAgICAgICAgICAgICAvLyB1c2VkIGJ5IG90aGVyIFVSTCBwYXJ0cyBzdWNoIGFzIDosXG4gICAgICAgICAgICAgICAgICAgICAvLyA/LCAvLCAjLCBhbmQgLlxuICAgICc6KT8nICtcbiAgICAnKD86Ly8nICtcbiAgICAnKD86KFteXFxcXFxcXFwvPyNdKilAKT8nICsgIC8vIHVzZXJJbmZvXG4gICAgJyhbXlxcXFxcXFxcLz8jXSo/KScgKyAgICAgICAvLyBkb21haW5cbiAgICAnKD86OihbMC05XSspKT8nICsgICAgICAgLy8gcG9ydFxuICAgICcoPz1bXFxcXFxcXFwvPyNdfCQpJyArICAgICAgLy8gYXV0aG9yaXR5LXRlcm1pbmF0aW5nIGNoYXJhY3Rlci5cbiAgICAnKT8nICtcbiAgICAnKFtePyNdKyk/JyArICAgICAgICAgIC8vIHBhdGhcbiAgICAnKD86XFxcXD8oW14jXSopKT8nICsgICAgLy8gcXVlcnlcbiAgICAnKD86IyhbXFxcXHNcXFxcU10qKSk/JyArICAvLyBmcmFnbWVudC4gQ2FuJ3QgdXNlICcuKicgd2l0aCAncycgZmxhZyBhcyBGaXJlZm94XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBkb2Vzbid0IHN1cHBvcnQgdGhlIGZsYWcsIGFuZCBjYW4ndCB1c2UgYW5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFwiZXZlcnl0aGluZyBzZXRcIiAoW15dKSBhcyBJRTEwIGRvZXNuJ3QgbWF0Y2ggYW55XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBjaGFyYWN0ZXJzIHdpdGggaXQuXG4gICAgJyQnKTtcblxuXG4vKipcbiAqIFRoZSBpbmRleCBvZiBlYWNoIFVSSSBjb21wb25lbnQgaW4gdGhlIHJldHVybiB2YWx1ZSBvZiBnb29nLnVyaS51dGlscy5zcGxpdC5cbiAqIEBlbnVtIHtudW1iZXJ9XG4gKi9cbmdvb2cudXJpLnV0aWxzLkNvbXBvbmVudEluZGV4ID0ge1xuICBTQ0hFTUU6IDEsXG4gIFVTRVJfSU5GTzogMixcbiAgRE9NQUlOOiAzLFxuICBQT1JUOiA0LFxuICBQQVRIOiA1LFxuICBRVUVSWV9EQVRBOiA2LFxuICBGUkFHTUVOVDogN1xufTtcblxuLyoqXG4gKiBAdHlwZSB7P2Z1bmN0aW9uKHN0cmluZyl9XG4gKiBAcHJpdmF0ZVxuICovXG5nb29nLnVyaS51dGlscy51cmxQYWNrYWdlU3VwcG9ydExvZ2dpbmdIYW5kbGVyXyA9IG51bGw7XG5cbi8qKlxuICogQHBhcmFtIHs/ZnVuY3Rpb24oc3RyaW5nKX0gaGFuZGxlciBUaGUgaGFuZGxlciBmdW5jdGlvbiB0byBjYWxsIHdoZW4gYSBVUklcbiAqICAgICB3aXRoIGEgcHJvdG9jb2wgdGhhdCBpcyBiZXR0ZXIgc3VwcG9ydGVkIGJ5IHRoZSBDbG9zdXJlIFVSTCBwYWNrYWdlIGlzXG4gKiAgICAgZGV0ZWN0ZWQuXG4gKi9cbmdvb2cudXJpLnV0aWxzLnNldFVybFBhY2thZ2VTdXBwb3J0TG9nZ2luZ0hhbmRsZXIgPSBmdW5jdGlvbihoYW5kbGVyKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgZ29vZy51cmkudXRpbHMudXJsUGFja2FnZVN1cHBvcnRMb2dnaW5nSGFuZGxlcl8gPSBoYW5kbGVyO1xufTtcblxuLyoqXG4gKiBTcGxpdHMgYSBVUkkgaW50byBpdHMgY29tcG9uZW50IHBhcnRzLlxuICpcbiAqIEVhY2ggY29tcG9uZW50IGNhbiBiZSBhY2Nlc3NlZCB2aWEgdGhlIGNvbXBvbmVudCBpbmRpY2VzOyBmb3IgZXhhbXBsZTpcbiAqIDxwcmU+XG4gKiBnb29nLnVyaS51dGlscy5zcGxpdChzb21lU3RyKVtnb29nLnVyaS51dGlscy5Db21wb25lbnRJbmRleC5RVUVSWV9EQVRBXTtcbiAqIDwvcHJlPlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSB1cmkgVGhlIFVSSSBzdHJpbmcgdG8gZXhhbWluZS5cbiAqIEByZXR1cm4geyFBcnJheTxzdHJpbmd8dW5kZWZpbmVkPn0gRWFjaCBjb21wb25lbnQgc3RpbGwgVVJJLWVuY29kZWQuXG4gKiAgICAgRWFjaCBjb21wb25lbnQgdGhhdCBpcyBwcmVzZW50IHdpbGwgY29udGFpbiB0aGUgZW5jb2RlZCB2YWx1ZSwgd2hlcmVhc1xuICogICAgIGNvbXBvbmVudHMgdGhhdCBhcmUgbm90IHByZXNlbnQgd2lsbCBiZSB1bmRlZmluZWQgb3IgZW1wdHksIGRlcGVuZGluZ1xuICogICAgIG9uIHRoZSBicm93c2VyJ3MgcmVndWxhciBleHByZXNzaW9uIGltcGxlbWVudGF0aW9uLiAgTmV2ZXIgbnVsbCwgc2luY2VcbiAqICAgICBhcmJpdHJhcnkgc3RyaW5ncyBtYXkgc3RpbGwgbG9vayBsaWtlIHBhdGggbmFtZXMuXG4gKi9cbmdvb2cudXJpLnV0aWxzLnNwbGl0ID0gZnVuY3Rpb24odXJpKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgLy8gU2VlIEByZXR1cm4gY29tbWVudCAtLSBuZXZlciBudWxsLlxuICB2YXIgcmVzdWx0ID0gLyoqIEB0eXBlIHshQXJyYXk8c3RyaW5nfHVuZGVmaW5lZD59ICovIChcbiAgICAgIHVyaS5tYXRjaChnb29nLnVyaS51dGlscy5zcGxpdFJlXykpO1xuICBpZiAoZ29vZy51cmkudXRpbHMudXJsUGFja2FnZVN1cHBvcnRMb2dnaW5nSGFuZGxlcl8gJiZcbiAgICAgIFsnaHR0cCcsICdodHRwcycsICd3cycsICd3c3MnLFxuICAgICAgICdmdHAnXS5pbmRleE9mKHJlc3VsdFtnb29nLnVyaS51dGlscy5Db21wb25lbnRJbmRleC5TQ0hFTUVdKSA+PSAwKSB7XG4gICAgZ29vZy51cmkudXRpbHMudXJsUGFja2FnZVN1cHBvcnRMb2dnaW5nSGFuZGxlcl8odXJpKTtcbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufTtcblxuXG4vKipcbiAqIEBwYXJhbSB7P3N0cmluZ30gdXJpIEEgcG9zc2libHkgbnVsbCBzdHJpbmcuXG4gKiBAcGFyYW0ge2Jvb2xlYW49fSBvcHRfcHJlc2VydmVSZXNlcnZlZCBJZiB0cnVlLCBwZXJjZW50LWVuY29kaW5nIG9mIFJGQy0zOTg2XG4gKiAgICAgcmVzZXJ2ZWQgY2hhcmFjdGVycyB3aWxsIG5vdCBiZSByZW1vdmVkLlxuICogQHJldHVybiB7P3N0cmluZ30gVGhlIHN0cmluZyBVUkktZGVjb2RlZCwgb3IgbnVsbCBpZiB1cmkgaXMgbnVsbC5cbiAqIEBwcml2YXRlXG4gKi9cbmdvb2cudXJpLnV0aWxzLmRlY29kZUlmUG9zc2libGVfID0gZnVuY3Rpb24odXJpLCBvcHRfcHJlc2VydmVSZXNlcnZlZCkge1xuICAndXNlIHN0cmljdCc7XG4gIGlmICghdXJpKSB7XG4gICAgcmV0dXJuIHVyaTtcbiAgfVxuXG4gIHJldHVybiBvcHRfcHJlc2VydmVSZXNlcnZlZCA/IGRlY29kZVVSSSh1cmkpIDogZGVjb2RlVVJJQ29tcG9uZW50KHVyaSk7XG59O1xuXG5cbi8qKlxuICogR2V0cyBhIFVSSSBjb21wb25lbnQgYnkgaW5kZXguXG4gKlxuICogSXQgaXMgcHJlZmVycmVkIHRvIHVzZSB0aGUgZ2V0UGF0aEVuY29kZWQoKSB2YXJpZXR5IG9mIGZ1bmN0aW9ucyBhaGVhZCxcbiAqIHNpbmNlIHRoZXkgYXJlIG1vcmUgcmVhZGFibGUuXG4gKlxuICogQHBhcmFtIHtnb29nLnVyaS51dGlscy5Db21wb25lbnRJbmRleH0gY29tcG9uZW50SW5kZXggVGhlIGNvbXBvbmVudCBpbmRleC5cbiAqIEBwYXJhbSB7c3RyaW5nfSB1cmkgVGhlIFVSSSB0byBleGFtaW5lLlxuICogQHJldHVybiB7P3N0cmluZ30gVGhlIHN0aWxsLWVuY29kZWQgY29tcG9uZW50LCBvciBudWxsIGlmIHRoZSBjb21wb25lbnRcbiAqICAgICBpcyBub3QgcHJlc2VudC5cbiAqIEBwcml2YXRlXG4gKi9cbmdvb2cudXJpLnV0aWxzLmdldENvbXBvbmVudEJ5SW5kZXhfID0gZnVuY3Rpb24oY29tcG9uZW50SW5kZXgsIHVyaSkge1xuICAndXNlIHN0cmljdCc7XG4gIC8vIENvbnZlcnQgdW5kZWZpbmVkLCBudWxsLCBhbmQgZW1wdHkgc3RyaW5nIGludG8gbnVsbC5cbiAgcmV0dXJuIGdvb2cudXJpLnV0aWxzLnNwbGl0KHVyaSlbY29tcG9uZW50SW5kZXhdIHx8IG51bGw7XG59O1xuXG5cbi8qKlxuICogQHBhcmFtIHtzdHJpbmd9IHVyaSBUaGUgVVJJIHRvIGV4YW1pbmUuXG4gKiBAcmV0dXJuIHs/c3RyaW5nfSBUaGUgcHJvdG9jb2wgb3Igc2NoZW1lLCBvciBudWxsIGlmIG5vbmUuICBEb2VzIG5vdFxuICogICAgIGluY2x1ZGUgdHJhaWxpbmcgY29sb25zIG9yIHNsYXNoZXMuXG4gKi9cbmdvb2cudXJpLnV0aWxzLmdldFNjaGVtZSA9IGZ1bmN0aW9uKHVyaSkge1xuICAndXNlIHN0cmljdCc7XG4gIHJldHVybiBnb29nLnVyaS51dGlscy5nZXRDb21wb25lbnRCeUluZGV4XyhcbiAgICAgIGdvb2cudXJpLnV0aWxzLkNvbXBvbmVudEluZGV4LlNDSEVNRSwgdXJpKTtcbn07XG5cblxuLyoqXG4gKiBHZXRzIHRoZSBlZmZlY3RpdmUgc2NoZW1lIGZvciB0aGUgVVJMLiAgSWYgdGhlIFVSTCBpcyByZWxhdGl2ZSB0aGVuIHRoZVxuICogc2NoZW1lIGlzIGRlcml2ZWQgZnJvbSB0aGUgcGFnZSdzIGxvY2F0aW9uLlxuICogQHBhcmFtIHtzdHJpbmd9IHVyaSBUaGUgVVJJIHRvIGV4YW1pbmUuXG4gKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSBwcm90b2NvbCBvciBzY2hlbWUsIGFsd2F5cyBsb3dlciBjYXNlLlxuICovXG5nb29nLnVyaS51dGlscy5nZXRFZmZlY3RpdmVTY2hlbWUgPSBmdW5jdGlvbih1cmkpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICB2YXIgc2NoZW1lID0gZ29vZy51cmkudXRpbHMuZ2V0U2NoZW1lKHVyaSk7XG4gIGlmICghc2NoZW1lICYmIGdvb2cuZ2xvYmFsLnNlbGYgJiYgZ29vZy5nbG9iYWwuc2VsZi5sb2NhdGlvbikge1xuICAgIHZhciBwcm90b2NvbCA9IGdvb2cuZ2xvYmFsLnNlbGYubG9jYXRpb24ucHJvdG9jb2w7XG4gICAgc2NoZW1lID0gcHJvdG9jb2wuc3Vic3RyKDAsIHByb3RvY29sLmxlbmd0aCAtIDEpO1xuICB9XG4gIC8vIE5PVEU6IFdoZW4gY2FsbGVkIGZyb20gYSB3ZWIgd29ya2VyIGluIEZpcmVmb3ggMy41LCBsb2NhdGlvbiBtYXkgYmUgbnVsbC5cbiAgLy8gQWxsIG90aGVyIGJyb3dzZXJzIHdpdGggd2ViIHdvcmtlcnMgc3VwcG9ydCBzZWxmLmxvY2F0aW9uIGZyb20gdGhlIHdvcmtlci5cbiAgcmV0dXJuIHNjaGVtZSA/IHNjaGVtZS50b0xvd2VyQ2FzZSgpIDogJyc7XG59O1xuXG5cbi8qKlxuICogQHBhcmFtIHtzdHJpbmd9IHVyaSBUaGUgVVJJIHRvIGV4YW1pbmUuXG4gKiBAcmV0dXJuIHs/c3RyaW5nfSBUaGUgdXNlciBuYW1lIHN0aWxsIGVuY29kZWQsIG9yIG51bGwgaWYgbm9uZS5cbiAqL1xuZ29vZy51cmkudXRpbHMuZ2V0VXNlckluZm9FbmNvZGVkID0gZnVuY3Rpb24odXJpKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmV0dXJuIGdvb2cudXJpLnV0aWxzLmdldENvbXBvbmVudEJ5SW5kZXhfKFxuICAgICAgZ29vZy51cmkudXRpbHMuQ29tcG9uZW50SW5kZXguVVNFUl9JTkZPLCB1cmkpO1xufTtcblxuXG4vKipcbiAqIEBwYXJhbSB7c3RyaW5nfSB1cmkgVGhlIFVSSSB0byBleGFtaW5lLlxuICogQHJldHVybiB7P3N0cmluZ30gVGhlIGRlY29kZWQgdXNlciBpbmZvLCBvciBudWxsIGlmIG5vbmUuXG4gKi9cbmdvb2cudXJpLnV0aWxzLmdldFVzZXJJbmZvID0gZnVuY3Rpb24odXJpKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmV0dXJuIGdvb2cudXJpLnV0aWxzLmRlY29kZUlmUG9zc2libGVfKFxuICAgICAgZ29vZy51cmkudXRpbHMuZ2V0VXNlckluZm9FbmNvZGVkKHVyaSkpO1xufTtcblxuXG4vKipcbiAqIEBwYXJhbSB7c3RyaW5nfSB1cmkgVGhlIFVSSSB0byBleGFtaW5lLlxuICogQHJldHVybiB7P3N0cmluZ30gVGhlIGRvbWFpbiBuYW1lIHN0aWxsIGVuY29kZWQsIG9yIG51bGwgaWYgbm9uZS5cbiAqL1xuZ29vZy51cmkudXRpbHMuZ2V0RG9tYWluRW5jb2RlZCA9IGZ1bmN0aW9uKHVyaSkge1xuICAndXNlIHN0cmljdCc7XG4gIHJldHVybiBnb29nLnVyaS51dGlscy5nZXRDb21wb25lbnRCeUluZGV4XyhcbiAgICAgIGdvb2cudXJpLnV0aWxzLkNvbXBvbmVudEluZGV4LkRPTUFJTiwgdXJpKTtcbn07XG5cblxuLyoqXG4gKiBAcGFyYW0ge3N0cmluZ30gdXJpIFRoZSBVUkkgdG8gZXhhbWluZS5cbiAqIEByZXR1cm4gez9zdHJpbmd9IFRoZSBkZWNvZGVkIGRvbWFpbiwgb3IgbnVsbCBpZiBub25lLlxuICovXG5nb29nLnVyaS51dGlscy5nZXREb21haW4gPSBmdW5jdGlvbih1cmkpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gZ29vZy51cmkudXRpbHMuZGVjb2RlSWZQb3NzaWJsZV8oXG4gICAgICBnb29nLnVyaS51dGlscy5nZXREb21haW5FbmNvZGVkKHVyaSksIHRydWUgLyogb3B0X3ByZXNlcnZlUmVzZXJ2ZWQgKi8pO1xufTtcblxuXG4vKipcbiAqIEBwYXJhbSB7c3RyaW5nfSB1cmkgVGhlIFVSSSB0byBleGFtaW5lLlxuICogQHJldHVybiB7P251bWJlcn0gVGhlIHBvcnQgbnVtYmVyLCBvciBudWxsIGlmIG5vbmUuXG4gKi9cbmdvb2cudXJpLnV0aWxzLmdldFBvcnQgPSBmdW5jdGlvbih1cmkpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICAvLyBDb2VyY2UgdG8gYSBudW1iZXIuICBJZiB0aGUgcmVzdWx0IG9mIGdldENvbXBvbmVudEJ5SW5kZXhfIGlzIG51bGwgb3JcbiAgLy8gbm9uLW51bWVyaWMsIHRoZSBudW1iZXIgY29lcnNpb24geWllbGRzIE5hTi4gIFRoaXMgd2lsbCB0aGVuIHJldHVyblxuICAvLyBudWxsIGZvciBhbGwgbm9uLW51bWVyaWMgY2FzZXMgKHRob3VnaCBhbHNvIHplcm8sIHdoaWNoIGlzbid0IGEgcmVsZXZhbnRcbiAgLy8gcG9ydCBudW1iZXIpLlxuICByZXR1cm4gTnVtYmVyKFxuICAgICAgICAgICAgIGdvb2cudXJpLnV0aWxzLmdldENvbXBvbmVudEJ5SW5kZXhfKFxuICAgICAgICAgICAgICAgICBnb29nLnVyaS51dGlscy5Db21wb25lbnRJbmRleC5QT1JULCB1cmkpKSB8fFxuICAgICAgbnVsbDtcbn07XG5cblxuLyoqXG4gKiBAcGFyYW0ge3N0cmluZ30gdXJpIFRoZSBVUkkgdG8gZXhhbWluZS5cbiAqIEByZXR1cm4gez9zdHJpbmd9IFRoZSBwYXRoIHN0aWxsIGVuY29kZWQsIG9yIG51bGwgaWYgbm9uZS4gSW5jbHVkZXMgdGhlXG4gKiAgICAgbGVhZGluZyBzbGFzaCwgaWYgYW55LlxuICovXG5nb29nLnVyaS51dGlscy5nZXRQYXRoRW5jb2RlZCA9IGZ1bmN0aW9uKHVyaSkge1xuICAndXNlIHN0cmljdCc7XG4gIHJldHVybiBnb29nLnVyaS51dGlscy5nZXRDb21wb25lbnRCeUluZGV4XyhcbiAgICAgIGdvb2cudXJpLnV0aWxzLkNvbXBvbmVudEluZGV4LlBBVEgsIHVyaSk7XG59O1xuXG5cbi8qKlxuICogQHBhcmFtIHtzdHJpbmd9IHVyaSBUaGUgVVJJIHRvIGV4YW1pbmUuXG4gKiBAcmV0dXJuIHs/c3RyaW5nfSBUaGUgZGVjb2RlZCBwYXRoLCBvciBudWxsIGlmIG5vbmUuICBJbmNsdWRlcyB0aGUgbGVhZGluZ1xuICogICAgIHNsYXNoLCBpZiBhbnkuXG4gKi9cbmdvb2cudXJpLnV0aWxzLmdldFBhdGggPSBmdW5jdGlvbih1cmkpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gZ29vZy51cmkudXRpbHMuZGVjb2RlSWZQb3NzaWJsZV8oXG4gICAgICBnb29nLnVyaS51dGlscy5nZXRQYXRoRW5jb2RlZCh1cmkpLCB0cnVlIC8qIG9wdF9wcmVzZXJ2ZVJlc2VydmVkICovKTtcbn07XG5cblxuLyoqXG4gKiBAcGFyYW0ge3N0cmluZ30gdXJpIFRoZSBVUkkgdG8gZXhhbWluZS5cbiAqIEByZXR1cm4gez9zdHJpbmd9IFRoZSBxdWVyeSBkYXRhIHN0aWxsIGVuY29kZWQsIG9yIG51bGwgaWYgbm9uZS4gIERvZXMgbm90XG4gKiAgICAgaW5jbHVkZSB0aGUgcXVlc3Rpb24gbWFyayBpdHNlbGYuXG4gKi9cbmdvb2cudXJpLnV0aWxzLmdldFF1ZXJ5RGF0YSA9IGZ1bmN0aW9uKHVyaSkge1xuICAndXNlIHN0cmljdCc7XG4gIHJldHVybiBnb29nLnVyaS51dGlscy5nZXRDb21wb25lbnRCeUluZGV4XyhcbiAgICAgIGdvb2cudXJpLnV0aWxzLkNvbXBvbmVudEluZGV4LlFVRVJZX0RBVEEsIHVyaSk7XG59O1xuXG5cbi8qKlxuICogQHBhcmFtIHtzdHJpbmd9IHVyaSBUaGUgVVJJIHRvIGV4YW1pbmUuXG4gKiBAcmV0dXJuIHs/c3RyaW5nfSBUaGUgZnJhZ21lbnQgaWRlbnRpZmllciwgb3IgbnVsbCBpZiBub25lLiAgRG9lcyBub3RcbiAqICAgICBpbmNsdWRlIHRoZSBoYXNoIG1hcmsgaXRzZWxmLlxuICovXG5nb29nLnVyaS51dGlscy5nZXRGcmFnbWVudEVuY29kZWQgPSBmdW5jdGlvbih1cmkpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICAvLyBUaGUgaGFzaCBtYXJrIG1heSBub3QgYXBwZWFyIGluIGFueSBvdGhlciBwYXJ0IG9mIHRoZSBVUkwuXG4gIHZhciBoYXNoSW5kZXggPSB1cmkuaW5kZXhPZignIycpO1xuICByZXR1cm4gaGFzaEluZGV4IDwgMCA/IG51bGwgOiB1cmkuc3Vic3RyKGhhc2hJbmRleCArIDEpO1xufTtcblxuXG4vKipcbiAqIEBwYXJhbSB7c3RyaW5nfSB1cmkgVGhlIFVSSSB0byBleGFtaW5lLlxuICogQHBhcmFtIHs/c3RyaW5nfSBmcmFnbWVudCBUaGUgZW5jb2RlZCBmcmFnbWVudCBpZGVudGlmaWVyLCBvciBudWxsIGlmIG5vbmUuXG4gKiAgICAgRG9lcyBub3QgaW5jbHVkZSB0aGUgaGFzaCBtYXJrIGl0c2VsZi5cbiAqIEByZXR1cm4ge3N0cmluZ30gVGhlIFVSSSB3aXRoIHRoZSBmcmFnbWVudCBzZXQuXG4gKi9cbmdvb2cudXJpLnV0aWxzLnNldEZyYWdtZW50RW5jb2RlZCA9IGZ1bmN0aW9uKHVyaSwgZnJhZ21lbnQpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gZ29vZy51cmkudXRpbHMucmVtb3ZlRnJhZ21lbnQodXJpKSArIChmcmFnbWVudCA/ICcjJyArIGZyYWdtZW50IDogJycpO1xufTtcblxuXG4vKipcbiAqIEBwYXJhbSB7c3RyaW5nfSB1cmkgVGhlIFVSSSB0byBleGFtaW5lLlxuICogQHJldHVybiB7P3N0cmluZ30gVGhlIGRlY29kZWQgZnJhZ21lbnQgaWRlbnRpZmllciwgb3IgbnVsbCBpZiBub25lLiAgRG9lc1xuICogICAgIG5vdCBpbmNsdWRlIHRoZSBoYXNoIG1hcmsuXG4gKi9cbmdvb2cudXJpLnV0aWxzLmdldEZyYWdtZW50ID0gZnVuY3Rpb24odXJpKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmV0dXJuIGdvb2cudXJpLnV0aWxzLmRlY29kZUlmUG9zc2libGVfKFxuICAgICAgZ29vZy51cmkudXRpbHMuZ2V0RnJhZ21lbnRFbmNvZGVkKHVyaSkpO1xufTtcblxuXG4vKipcbiAqIEV4dHJhY3RzIGV2ZXJ5dGhpbmcgdXAgdG8gdGhlIHBvcnQgb2YgdGhlIFVSSS5cbiAqIEBwYXJhbSB7c3RyaW5nfSB1cmkgVGhlIFVSSSBzdHJpbmcuXG4gKiBAcmV0dXJuIHtzdHJpbmd9IEV2ZXJ5dGhpbmcgdXAgdG8gYW5kIGluY2x1ZGluZyB0aGUgcG9ydC5cbiAqL1xuZ29vZy51cmkudXRpbHMuZ2V0SG9zdCA9IGZ1bmN0aW9uKHVyaSkge1xuICAndXNlIHN0cmljdCc7XG4gIHZhciBwaWVjZXMgPSBnb29nLnVyaS51dGlscy5zcGxpdCh1cmkpO1xuICByZXR1cm4gZ29vZy51cmkudXRpbHMuYnVpbGRGcm9tRW5jb2RlZFBhcnRzKFxuICAgICAgcGllY2VzW2dvb2cudXJpLnV0aWxzLkNvbXBvbmVudEluZGV4LlNDSEVNRV0sXG4gICAgICBwaWVjZXNbZ29vZy51cmkudXRpbHMuQ29tcG9uZW50SW5kZXguVVNFUl9JTkZPXSxcbiAgICAgIHBpZWNlc1tnb29nLnVyaS51dGlscy5Db21wb25lbnRJbmRleC5ET01BSU5dLFxuICAgICAgcGllY2VzW2dvb2cudXJpLnV0aWxzLkNvbXBvbmVudEluZGV4LlBPUlRdKTtcbn07XG5cblxuLyoqXG4gKiBSZXR1cm5zIHRoZSBvcmlnaW4gZm9yIGEgZ2l2ZW4gVVJMLlxuICogQHBhcmFtIHtzdHJpbmd9IHVyaSBUaGUgVVJJIHN0cmluZy5cbiAqIEByZXR1cm4ge3N0cmluZ30gRXZlcnl0aGluZyB1cCB0byBhbmQgaW5jbHVkaW5nIHRoZSBwb3J0LlxuICovXG5nb29nLnVyaS51dGlscy5nZXRPcmlnaW4gPSBmdW5jdGlvbih1cmkpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICB2YXIgcGllY2VzID0gZ29vZy51cmkudXRpbHMuc3BsaXQodXJpKTtcbiAgcmV0dXJuIGdvb2cudXJpLnV0aWxzLmJ1aWxkRnJvbUVuY29kZWRQYXJ0cyhcbiAgICAgIHBpZWNlc1tnb29nLnVyaS51dGlscy5Db21wb25lbnRJbmRleC5TQ0hFTUVdLCBudWxsIC8qIG9wdF91c2VySW5mbyAqLyxcbiAgICAgIHBpZWNlc1tnb29nLnVyaS51dGlscy5Db21wb25lbnRJbmRleC5ET01BSU5dLFxuICAgICAgcGllY2VzW2dvb2cudXJpLnV0aWxzLkNvbXBvbmVudEluZGV4LlBPUlRdKTtcbn07XG5cblxuLyoqXG4gKiBFeHRyYWN0cyB0aGUgcGF0aCBvZiB0aGUgVVJMIGFuZCBldmVyeXRoaW5nIGFmdGVyLlxuICogQHBhcmFtIHtzdHJpbmd9IHVyaSBUaGUgVVJJIHN0cmluZy5cbiAqIEByZXR1cm4ge3N0cmluZ30gVGhlIFVSSSwgc3RhcnRpbmcgYXQgdGhlIHBhdGggYW5kIGluY2x1ZGluZyB0aGUgcXVlcnlcbiAqICAgICBwYXJhbWV0ZXJzIGFuZCBmcmFnbWVudCBpZGVudGlmaWVyLlxuICovXG5nb29nLnVyaS51dGlscy5nZXRQYXRoQW5kQWZ0ZXIgPSBmdW5jdGlvbih1cmkpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICB2YXIgcGllY2VzID0gZ29vZy51cmkudXRpbHMuc3BsaXQodXJpKTtcbiAgcmV0dXJuIGdvb2cudXJpLnV0aWxzLmJ1aWxkRnJvbUVuY29kZWRQYXJ0cyhcbiAgICAgIG51bGwsIG51bGwsIG51bGwsIG51bGwsIHBpZWNlc1tnb29nLnVyaS51dGlscy5Db21wb25lbnRJbmRleC5QQVRIXSxcbiAgICAgIHBpZWNlc1tnb29nLnVyaS51dGlscy5Db21wb25lbnRJbmRleC5RVUVSWV9EQVRBXSxcbiAgICAgIHBpZWNlc1tnb29nLnVyaS51dGlscy5Db21wb25lbnRJbmRleC5GUkFHTUVOVF0pO1xufTtcblxuXG4vKipcbiAqIEdldHMgdGhlIFVSSSB3aXRoIHRoZSBmcmFnbWVudCBpZGVudGlmaWVyIHJlbW92ZWQuXG4gKiBAcGFyYW0ge3N0cmluZ30gdXJpIFRoZSBVUkkgdG8gZXhhbWluZS5cbiAqIEByZXR1cm4ge3N0cmluZ30gRXZlcnl0aGluZyBwcmVjZWRpbmcgdGhlIGhhc2ggbWFyay5cbiAqL1xuZ29vZy51cmkudXRpbHMucmVtb3ZlRnJhZ21lbnQgPSBmdW5jdGlvbih1cmkpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICAvLyBUaGUgaGFzaCBtYXJrIG1heSBub3QgYXBwZWFyIGluIGFueSBvdGhlciBwYXJ0IG9mIHRoZSBVUkwuXG4gIHZhciBoYXNoSW5kZXggPSB1cmkuaW5kZXhPZignIycpO1xuICByZXR1cm4gaGFzaEluZGV4IDwgMCA/IHVyaSA6IHVyaS5zdWJzdHIoMCwgaGFzaEluZGV4KTtcbn07XG5cblxuLyoqXG4gKiBFbnN1cmVzIHRoYXQgdHdvIFVSSSdzIGhhdmUgdGhlIGV4YWN0IHNhbWUgZG9tYWluLCBzY2hlbWUsIGFuZCBwb3J0LlxuICpcbiAqIFVubGlrZSB0aGUgdmVyc2lvbiBpbiBnb29nLlVyaSwgdGhpcyBjaGVja3MgcHJvdG9jb2wsIGFuZCB0aGVyZWZvcmUgaXNcbiAqIHN1aXRhYmxlIGZvciBjaGVja2luZyBhZ2FpbnN0IHRoZSBicm93c2VyJ3Mgc2FtZS1vcmlnaW4gcG9saWN5LlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSB1cmkxIFRoZSBmaXJzdCBVUkkuXG4gKiBAcGFyYW0ge3N0cmluZ30gdXJpMiBUaGUgc2Vjb25kIFVSSS5cbiAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgdGhleSBoYXZlIHRoZSBzYW1lIHNjaGVtZSwgZG9tYWluIGFuZCBwb3J0LlxuICovXG5nb29nLnVyaS51dGlscy5oYXZlU2FtZURvbWFpbiA9IGZ1bmN0aW9uKHVyaTEsIHVyaTIpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICB2YXIgcGllY2VzMSA9IGdvb2cudXJpLnV0aWxzLnNwbGl0KHVyaTEpO1xuICB2YXIgcGllY2VzMiA9IGdvb2cudXJpLnV0aWxzLnNwbGl0KHVyaTIpO1xuICByZXR1cm4gcGllY2VzMVtnb29nLnVyaS51dGlscy5Db21wb25lbnRJbmRleC5ET01BSU5dID09XG4gICAgICBwaWVjZXMyW2dvb2cudXJpLnV0aWxzLkNvbXBvbmVudEluZGV4LkRPTUFJTl0gJiZcbiAgICAgIHBpZWNlczFbZ29vZy51cmkudXRpbHMuQ29tcG9uZW50SW5kZXguU0NIRU1FXSA9PVxuICAgICAgcGllY2VzMltnb29nLnVyaS51dGlscy5Db21wb25lbnRJbmRleC5TQ0hFTUVdICYmXG4gICAgICBwaWVjZXMxW2dvb2cudXJpLnV0aWxzLkNvbXBvbmVudEluZGV4LlBPUlRdID09XG4gICAgICBwaWVjZXMyW2dvb2cudXJpLnV0aWxzLkNvbXBvbmVudEluZGV4LlBPUlRdO1xufTtcblxuXG4vKipcbiAqIEFzc2VydHMgdGhhdCB0aGVyZSBhcmUgbm8gZnJhZ21lbnQgb3IgcXVlcnkgaWRlbnRpZmllcnMsIG9ubHkgaW4gdW5jb21waWxlZFxuICogbW9kZS5cbiAqIEBwYXJhbSB7c3RyaW5nfSB1cmkgVGhlIFVSSSB0byBleGFtaW5lLlxuICogQHByaXZhdGVcbiAqL1xuZ29vZy51cmkudXRpbHMuYXNzZXJ0Tm9GcmFnbWVudHNPclF1ZXJpZXNfID0gZnVuY3Rpb24odXJpKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgZ29vZy5hc3NlcnRzLmFzc2VydChcbiAgICAgIHVyaS5pbmRleE9mKCcjJykgPCAwICYmIHVyaS5pbmRleE9mKCc/JykgPCAwLFxuICAgICAgJ2dvb2cudXJpLnV0aWxzOiBGcmFnbWVudCBvciBxdWVyeSBpZGVudGlmaWVycyBhcmUgbm90IHN1cHBvcnRlZDogWyVzXScsXG4gICAgICB1cmkpO1xufTtcblxuXG4vKipcbiAqIFN1cHBvcnRlZCBxdWVyeSBwYXJhbWV0ZXIgdmFsdWVzIGJ5IHRoZSBwYXJhbWV0ZXIgc2VyaWFsaXppbmcgdXRpbGl0aWVzLlxuICpcbiAqIElmIGEgdmFsdWUgaXMgbnVsbCBvciB1bmRlZmluZWQsIHRoZSBrZXktdmFsdWUgcGFpciBpcyBza2lwcGVkLCBhcyBhbiBlYXN5XG4gKiB3YXkgdG8gb21pdCBwYXJhbWV0ZXJzIGNvbmRpdGlvbmFsbHkuICBOb24tYXJyYXkgcGFyYW1ldGVycyBhcmUgY29udmVydGVkXG4gKiB0byBhIHN0cmluZyBhbmQgVVJJIGVuY29kZWQuICBBcnJheSB2YWx1ZXMgYXJlIGV4cGFuZGVkIGludG8gbXVsdGlwbGVcbiAqICZrZXk9dmFsdWUgcGFpcnMsIHdpdGggZWFjaCBlbGVtZW50IHN0cmluZ2l6ZWQgYW5kIFVSSS1lbmNvZGVkLlxuICpcbiAqIEB0eXBlZGVmIHsqfVxuICovXG5nb29nLnVyaS51dGlscy5RdWVyeVZhbHVlO1xuXG5cbi8qKlxuICogQW4gYXJyYXkgcmVwcmVzZW50aW5nIGEgc2V0IG9mIHF1ZXJ5IHBhcmFtZXRlcnMgd2l0aCBhbHRlcm5hdGluZyBrZXlzXG4gKiBhbmQgdmFsdWVzLlxuICpcbiAqIEtleXMgYXJlIGFzc3VtZWQgdG8gYmUgVVJJIGVuY29kZWQgYWxyZWFkeSBhbmQgbGl2ZSBhdCBldmVuIGluZGljZXMuICBTZWVcbiAqIGdvb2cudXJpLnV0aWxzLlF1ZXJ5VmFsdWUgZm9yIGRldGFpbHMgb24gaG93IHBhcmFtZXRlciB2YWx1ZXMgYXJlIGVuY29kZWQuXG4gKlxuICogRXhhbXBsZTpcbiAqIDxwcmU+XG4gKiB2YXIgZGF0YSA9IFtcbiAqICAgLy8gU2ltcGxlIHBhcmFtOiA/bmFtZT1Cb2JCYXJrZXJcbiAqICAgJ25hbWUnLCAnQm9iQmFya2VyJyxcbiAqICAgLy8gQ29uZGl0aW9uYWwgcGFyYW0gLS0gbWF5IGJlIG9taXR0ZWQgZW50aXJlbHkuXG4gKiAgICdzcGVjaWFsRGlldGFyeU5lZWRzJywgaGFzRGlldGFyeU5lZWRzKCkgPyBnZXREaWV0YXJ5TmVlZHMoKSA6IG51bGwsXG4gKiAgIC8vIE11bHRpLXZhbHVlZCBwYXJhbTogJmhvdXNlPUxvc0FuZ2VsZXMmaG91c2U9TmV3WW9yayZob3VzZT1udWxsXG4gKiAgICdob3VzZScsIFsnTG9zQW5nZWxlcycsICdOZXdZb3JrJywgbnVsbF1cbiAqIF07XG4gKiA8L3ByZT5cbiAqXG4gKiBAdHlwZWRlZiB7IUFycmF5PHN0cmluZ3xnb29nLnVyaS51dGlscy5RdWVyeVZhbHVlPn1cbiAqL1xuZ29vZy51cmkudXRpbHMuUXVlcnlBcnJheTtcblxuXG4vKipcbiAqIFBhcnNlcyBlbmNvZGVkIHF1ZXJ5IHBhcmFtZXRlcnMgYW5kIGNhbGxzIGNhbGxiYWNrIGZ1bmN0aW9uIGZvciBldmVyeVxuICogcGFyYW1ldGVyIGZvdW5kIGluIHRoZSBzdHJpbmcuXG4gKlxuICogTWlzc2luZyB2YWx1ZSBvZiBwYXJhbWV0ZXIgKGUuZy4gXHUyMDFDXHUyMDI2JmtleSZcdTIwMjZcdTIwMUQpIGlzIHRyZWF0ZWQgYXMgaWYgdGhlIHZhbHVlIHdhcyBhblxuICogZW1wdHkgc3RyaW5nLiAgS2V5cyBtYXkgYmUgZW1wdHkgc3RyaW5ncyAoZS5nLiBcdTIwMUNcdTIwMjYmPXZhbHVlJlx1MjAyNlx1MjAxRCkgd2hpY2ggYWxzbyBtZWFuc1xuICogdGhhdCBcdTIwMUNcdTIwMjYmPSZcdTIwMjZcdTIwMUQgYW5kIFx1MjAxQ1x1MjAyNiYmXHUyMDI2XHUyMDFEIHdpbGwgcmVzdWx0IGluIGFuIGVtcHR5IGtleSBhbmQgdmFsdWUuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IGVuY29kZWRRdWVyeSBFbmNvZGVkIHF1ZXJ5IHN0cmluZyBleGNsdWRpbmcgcXVlc3Rpb24gbWFyayBhdFxuICogICAgIHRoZSBiZWdpbm5pbmcuXG4gKiBAcGFyYW0ge2Z1bmN0aW9uKHN0cmluZywgc3RyaW5nKX0gY2FsbGJhY2sgRnVuY3Rpb24gY2FsbGVkIGZvciBldmVyeVxuICogICAgIHBhcmFtZXRlciBmb3VuZCBpbiBxdWVyeSBzdHJpbmcuICBUaGUgZmlyc3QgYXJndW1lbnQgKG5hbWUpIHdpbGwgbm90IGJlXG4gKiAgICAgdXJsZGVjb2RlZCAoc28gdGhlIGZ1bmN0aW9uIGlzIGNvbnNpc3RlbnQgd2l0aCBidWlsZFF1ZXJ5RGF0YSksIGJ1dCB0aGVcbiAqICAgICBzZWNvbmQgd2lsbC4gIElmIHRoZSBwYXJhbWV0ZXIgaGFzIG5vIHZhbHVlIChpLmUuIFx1MjAxQz1cdTIwMUQgd2FzIG5vdCBwcmVzZW50KVxuICogICAgIHRoZSBzZWNvbmQgYXJndW1lbnQgKHZhbHVlKSB3aWxsIGJlIGFuIGVtcHR5IHN0cmluZy5cbiAqL1xuZ29vZy51cmkudXRpbHMucGFyc2VRdWVyeURhdGEgPSBmdW5jdGlvbihlbmNvZGVkUXVlcnksIGNhbGxiYWNrKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgaWYgKCFlbmNvZGVkUXVlcnkpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgdmFyIHBhaXJzID0gZW5jb2RlZFF1ZXJ5LnNwbGl0KCcmJyk7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgcGFpcnMubGVuZ3RoOyBpKyspIHtcbiAgICB2YXIgaW5kZXhPZkVxdWFscyA9IHBhaXJzW2ldLmluZGV4T2YoJz0nKTtcbiAgICB2YXIgbmFtZSA9IG51bGw7XG4gICAgdmFyIHZhbHVlID0gbnVsbDtcbiAgICBpZiAoaW5kZXhPZkVxdWFscyA+PSAwKSB7XG4gICAgICBuYW1lID0gcGFpcnNbaV0uc3Vic3RyaW5nKDAsIGluZGV4T2ZFcXVhbHMpO1xuICAgICAgdmFsdWUgPSBwYWlyc1tpXS5zdWJzdHJpbmcoaW5kZXhPZkVxdWFscyArIDEpO1xuICAgIH0gZWxzZSB7XG4gICAgICBuYW1lID0gcGFpcnNbaV07XG4gICAgfVxuICAgIGNhbGxiYWNrKG5hbWUsIHZhbHVlID8gZ29vZy5zdHJpbmcudXJsRGVjb2RlKHZhbHVlKSA6ICcnKTtcbiAgfVxufTtcblxuXG4vKipcbiAqIFNwbGl0IHRoZSBVUkkgaW50byAzIHBhcnRzIHdoZXJlIHRoZSBbMV0gaXMgdGhlIHF1ZXJ5RGF0YSB3aXRob3V0IGEgbGVhZGluZ1xuICogJz8nLiBGb3IgZXhhbXBsZSwgdGhlIFVSSSBodHRwOi8vZm9vLmNvbS9iYXI/YT1iI2FiYyByZXR1cm5zXG4gKiBbJ2h0dHA6Ly9mb28uY29tL2JhcicsJ2E9YicsJyNhYmMnXS5cbiAqIEBwYXJhbSB7c3RyaW5nfSB1cmkgVGhlIFVSSSB0byBwYXJzZS5cbiAqIEByZXR1cm4geyFBcnJheTxzdHJpbmc+fSBBbiBhcnJheSByZXByZXNlbnRhdGlvbiBvZiB1cmkgb2YgbGVuZ3RoIDMgd2hlcmUgdGhlXG4gKiAgICAgbWlkZGxlIHZhbHVlIGlzIHRoZSBxdWVyeURhdGEgd2l0aG91dCBhIGxlYWRpbmcgJz8nLlxuICogQHByaXZhdGVcbiAqL1xuZ29vZy51cmkudXRpbHMuc3BsaXRRdWVyeURhdGFfID0gZnVuY3Rpb24odXJpKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgLy8gRmluZCB0aGUgcXVlcnkgZGF0YSBhbmQgaGFzaC5cbiAgdmFyIGhhc2hJbmRleCA9IHVyaS5pbmRleE9mKCcjJyk7XG4gIGlmIChoYXNoSW5kZXggPCAwKSB7XG4gICAgaGFzaEluZGV4ID0gdXJpLmxlbmd0aDtcbiAgfVxuICB2YXIgcXVlc3Rpb25JbmRleCA9IHVyaS5pbmRleE9mKCc/Jyk7XG4gIHZhciBxdWVyeURhdGE7XG4gIGlmIChxdWVzdGlvbkluZGV4IDwgMCB8fCBxdWVzdGlvbkluZGV4ID4gaGFzaEluZGV4KSB7XG4gICAgcXVlc3Rpb25JbmRleCA9IGhhc2hJbmRleDtcbiAgICBxdWVyeURhdGEgPSAnJztcbiAgfSBlbHNlIHtcbiAgICBxdWVyeURhdGEgPSB1cmkuc3Vic3RyaW5nKHF1ZXN0aW9uSW5kZXggKyAxLCBoYXNoSW5kZXgpO1xuICB9XG4gIHJldHVybiBbdXJpLnN1YnN0cigwLCBxdWVzdGlvbkluZGV4KSwgcXVlcnlEYXRhLCB1cmkuc3Vic3RyKGhhc2hJbmRleCldO1xufTtcblxuXG4vKipcbiAqIEpvaW4gYW4gYXJyYXkgY3JlYXRlZCBieSBzcGxpdFF1ZXJ5RGF0YV8gYmFjayBpbnRvIGEgVVJJLlxuICogQHBhcmFtIHshQXJyYXk8c3RyaW5nPn0gcGFydHMgQSBVUkkgaW4gdGhlIGZvcm0gZ2VuZXJhdGVkIGJ5IHNwbGl0UXVlcnlEYXRhXy5cbiAqIEByZXR1cm4ge3N0cmluZ30gVGhlIGpvaW5lZCBVUkkuXG4gKiBAcHJpdmF0ZVxuICovXG5nb29nLnVyaS51dGlscy5qb2luUXVlcnlEYXRhXyA9IGZ1bmN0aW9uKHBhcnRzKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmV0dXJuIHBhcnRzWzBdICsgKHBhcnRzWzFdID8gJz8nICsgcGFydHNbMV0gOiAnJykgKyBwYXJ0c1syXTtcbn07XG5cblxuLyoqXG4gKiBAcGFyYW0ge3N0cmluZ30gcXVlcnlEYXRhXG4gKiBAcGFyYW0ge3N0cmluZ30gbmV3RGF0YVxuICogQHJldHVybiB7c3RyaW5nfVxuICogQHByaXZhdGVcbiAqL1xuZ29vZy51cmkudXRpbHMuYXBwZW5kUXVlcnlEYXRhXyA9IGZ1bmN0aW9uKHF1ZXJ5RGF0YSwgbmV3RGF0YSkge1xuICAndXNlIHN0cmljdCc7XG4gIGlmICghbmV3RGF0YSkge1xuICAgIHJldHVybiBxdWVyeURhdGE7XG4gIH1cbiAgcmV0dXJuIHF1ZXJ5RGF0YSA/IHF1ZXJ5RGF0YSArICcmJyArIG5ld0RhdGEgOiBuZXdEYXRhO1xufTtcblxuXG4vKipcbiAqIEBwYXJhbSB7c3RyaW5nfSB1cmlcbiAqIEBwYXJhbSB7c3RyaW5nfSBxdWVyeURhdGFcbiAqIEByZXR1cm4ge3N0cmluZ31cbiAqIEBwcml2YXRlXG4gKi9cbmdvb2cudXJpLnV0aWxzLmFwcGVuZFF1ZXJ5RGF0YVRvVXJpXyA9IGZ1bmN0aW9uKHVyaSwgcXVlcnlEYXRhKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgaWYgKCFxdWVyeURhdGEpIHtcbiAgICByZXR1cm4gdXJpO1xuICB9XG4gIHZhciBwYXJ0cyA9IGdvb2cudXJpLnV0aWxzLnNwbGl0UXVlcnlEYXRhXyh1cmkpO1xuICBwYXJ0c1sxXSA9IGdvb2cudXJpLnV0aWxzLmFwcGVuZFF1ZXJ5RGF0YV8ocGFydHNbMV0sIHF1ZXJ5RGF0YSk7XG4gIHJldHVybiBnb29nLnVyaS51dGlscy5qb2luUXVlcnlEYXRhXyhwYXJ0cyk7XG59O1xuXG5cbi8qKlxuICogQXBwZW5kcyBrZXk9dmFsdWUgcGFpcnMgdG8gYW4gYXJyYXksIHN1cHBvcnRpbmcgbXVsdGktdmFsdWVkIG9iamVjdHMuXG4gKiBAcGFyYW0geyp9IGtleSBUaGUga2V5IHByZWZpeC5cbiAqIEBwYXJhbSB7Z29vZy51cmkudXRpbHMuUXVlcnlWYWx1ZX0gdmFsdWUgVGhlIHZhbHVlIHRvIHNlcmlhbGl6ZS5cbiAqIEBwYXJhbSB7IUFycmF5PHN0cmluZz59IHBhaXJzIFRoZSBhcnJheSB0byB3aGljaCB0aGUgJ2tleT12YWx1ZScgc3RyaW5nc1xuICogICAgIHNob3VsZCBiZSBhcHBlbmRlZC5cbiAqIEBwcml2YXRlXG4gKi9cbmdvb2cudXJpLnV0aWxzLmFwcGVuZEtleVZhbHVlUGFpcnNfID0gZnVuY3Rpb24oa2V5LCB2YWx1ZSwgcGFpcnMpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBnb29nLmFzc2VydHMuYXNzZXJ0U3RyaW5nKGtleSk7XG4gIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSkge1xuICAgIC8vIENvbnZpbmNlIHRoZSBjb21waWxlciBpdCdzIGFuIGFycmF5LlxuICAgIGdvb2cuYXNzZXJ0cy5hc3NlcnRBcnJheSh2YWx1ZSk7XG4gICAgZm9yICh2YXIgaiA9IDA7IGogPCB2YWx1ZS5sZW5ndGg7IGorKykge1xuICAgICAgLy8gQ29udmVydCB0byBzdHJpbmcgZXhwbGljaXRseSwgdG8gc2hvcnQgY2lyY3VpdCB0aGUgbnVsbCBhbmQgYXJyYXlcbiAgICAgIC8vIGxvZ2ljIGluIHRoaXMgZnVuY3Rpb24gLS0gdGhpcyBlbnN1cmVzIHRoYXQgbnVsbCBhbmQgdW5kZWZpbmVkIGdldFxuICAgICAgLy8gd3JpdHRlbiBhcyBsaXRlcmFsICdudWxsJyBhbmQgJ3VuZGVmaW5lZCcsIGFuZCBhcnJheXMgZG9uJ3QgZ2V0XG4gICAgICAvLyBleHBhbmRlZCBvdXQgYnV0IGluc3RlYWQgZW5jb2RlZCBpbiB0aGUgZGVmYXVsdCB3YXkuXG4gICAgICBnb29nLnVyaS51dGlscy5hcHBlbmRLZXlWYWx1ZVBhaXJzXyhrZXksIFN0cmluZyh2YWx1ZVtqXSksIHBhaXJzKTtcbiAgICB9XG4gIH0gZWxzZSBpZiAodmFsdWUgIT0gbnVsbCkge1xuICAgIC8vIFNraXAgYSB0b3AtbGV2ZWwgbnVsbCBvciB1bmRlZmluZWQgZW50aXJlbHkuXG4gICAgcGFpcnMucHVzaChcbiAgICAgICAga2V5ICtcbiAgICAgICAgLy8gQ2hlY2sgZm9yIGVtcHR5IHN0cmluZy4gWmVybyBnZXRzIGVuY29kZWQgaW50byB0aGUgdXJsIGFzIGxpdGVyYWxcbiAgICAgICAgLy8gc3RyaW5ncy4gIEZvciBlbXB0eSBzdHJpbmcsIHNraXAgdGhlIGVxdWFsIHNpZ24sIHRvIGJlIGNvbnNpc3RlbnRcbiAgICAgICAgLy8gd2l0aCBVcmlCdWlsZGVyLmphdmEuXG4gICAgICAgICh2YWx1ZSA9PT0gJycgPyAnJyA6ICc9JyArIGdvb2cuc3RyaW5nLnVybEVuY29kZSh2YWx1ZSkpKTtcbiAgfVxufTtcblxuXG4vKipcbiAqIEJ1aWxkcyBhIHF1ZXJ5IGRhdGEgc3RyaW5nIGZyb20gYSBzZXF1ZW5jZSBvZiBhbHRlcm5hdGluZyBrZXlzIGFuZCB2YWx1ZXMuXG4gKiBDdXJyZW50bHkgZ2VuZXJhdGVzIFwiJmtleSZcIiBmb3IgZW1wdHkgYXJncy5cbiAqXG4gKiBAcGFyYW0geyFJQXJyYXlMaWtlPHN0cmluZ3xnb29nLnVyaS51dGlscy5RdWVyeVZhbHVlPn0ga2V5c0FuZFZhbHVlc1xuICogICAgIEFsdGVybmF0aW5nIGtleXMgYW5kIHZhbHVlcy4gU2VlIHRoZSBRdWVyeUFycmF5IHR5cGVkZWYuXG4gKiBAcGFyYW0ge251bWJlcj19IG9wdF9zdGFydEluZGV4IEEgc3RhcnQgb2Zmc2V0IGludG8gdGhlIGFyYXJ5LCBkZWZhdWx0cyB0byAwLlxuICogQHJldHVybiB7c3RyaW5nfSBUaGUgZW5jb2RlZCBxdWVyeSBzdHJpbmcsIGluIHRoZSBmb3JtICdhPTEmYj0yJy5cbiAqL1xuZ29vZy51cmkudXRpbHMuYnVpbGRRdWVyeURhdGEgPSBmdW5jdGlvbihrZXlzQW5kVmFsdWVzLCBvcHRfc3RhcnRJbmRleCkge1xuICAndXNlIHN0cmljdCc7XG4gIGdvb2cuYXNzZXJ0cy5hc3NlcnQoXG4gICAgICBNYXRoLm1heChrZXlzQW5kVmFsdWVzLmxlbmd0aCAtIChvcHRfc3RhcnRJbmRleCB8fCAwKSwgMCkgJSAyID09IDAsXG4gICAgICAnZ29vZy51cmkudXRpbHM6IEtleS92YWx1ZSBsaXN0cyBtdXN0IGJlIGV2ZW4gaW4gbGVuZ3RoLicpO1xuXG4gIHZhciBwYXJhbXMgPSBbXTtcbiAgZm9yICh2YXIgaSA9IG9wdF9zdGFydEluZGV4IHx8IDA7IGkgPCBrZXlzQW5kVmFsdWVzLmxlbmd0aDsgaSArPSAyKSB7XG4gICAgdmFyIGtleSA9IC8qKiBAdHlwZSB7c3RyaW5nfSAqLyAoa2V5c0FuZFZhbHVlc1tpXSk7XG4gICAgZ29vZy51cmkudXRpbHMuYXBwZW5kS2V5VmFsdWVQYWlyc18oa2V5LCBrZXlzQW5kVmFsdWVzW2kgKyAxXSwgcGFyYW1zKTtcbiAgfVxuICByZXR1cm4gcGFyYW1zLmpvaW4oJyYnKTtcbn07XG5cblxuLyoqXG4gKiBCdWlsZHMgYSBxdWVyeSBkYXRhIHN0cmluZyBmcm9tIGEgbWFwLlxuICogQ3VycmVudGx5IGdlbmVyYXRlcyBcIiZrZXkmXCIgZm9yIGVtcHR5IGFyZ3MuXG4gKlxuICogQHBhcmFtIHshT2JqZWN0PHN0cmluZywgZ29vZy51cmkudXRpbHMuUXVlcnlWYWx1ZT59IG1hcCBBbiBvYmplY3Qgd2hlcmUga2V5c1xuICogICAgIGFyZSBVUkktZW5jb2RlZCBwYXJhbWV0ZXIga2V5cywgYW5kIHRoZSB2YWx1ZXMgYXJlIGFyYml0cmFyeSB0eXBlc1xuICogICAgIG9yIGFycmF5cy4gS2V5cyB3aXRoIGEgbnVsbCB2YWx1ZSBhcmUgZHJvcHBlZC5cbiAqIEByZXR1cm4ge3N0cmluZ30gVGhlIGVuY29kZWQgcXVlcnkgc3RyaW5nLCBpbiB0aGUgZm9ybSAnYT0xJmI9MicuXG4gKi9cbmdvb2cudXJpLnV0aWxzLmJ1aWxkUXVlcnlEYXRhRnJvbU1hcCA9IGZ1bmN0aW9uKG1hcCkge1xuICAndXNlIHN0cmljdCc7XG4gIHZhciBwYXJhbXMgPSBbXTtcbiAgZm9yICh2YXIga2V5IGluIG1hcCkge1xuICAgIGdvb2cudXJpLnV0aWxzLmFwcGVuZEtleVZhbHVlUGFpcnNfKGtleSwgbWFwW2tleV0sIHBhcmFtcyk7XG4gIH1cbiAgcmV0dXJuIHBhcmFtcy5qb2luKCcmJyk7XG59O1xuXG5cbi8qKlxuICogQXBwZW5kcyBVUkkgcGFyYW1ldGVycyB0byBhbiBleGlzdGluZyBVUkkuXG4gKlxuICogVGhlIHZhcmlhYmxlIGFyZ3VtZW50cyBtYXkgY29udGFpbiBhbHRlcm5hdGluZyBrZXlzIGFuZCB2YWx1ZXMuICBLZXlzIGFyZVxuICogYXNzdW1lZCB0byBiZSBhbHJlYWR5IFVSSSBlbmNvZGVkLiAgVGhlIHZhbHVlcyBzaG91bGQgbm90IGJlIFVSSS1lbmNvZGVkLFxuICogYW5kIHdpbGwgaW5zdGVhZCBiZSBlbmNvZGVkIGJ5IHRoaXMgZnVuY3Rpb24uXG4gKiA8cHJlPlxuICogYXBwZW5kUGFyYW1zKCdodHRwOi8vd3d3LmZvby5jb20/ZXhpc3Rpbmc9dHJ1ZScsXG4gKiAgICAgJ2tleTEnLCAndmFsdWUxJyxcbiAqICAgICAna2V5MicsICd2YWx1ZT93aWxsQmVFbmNvZGVkJyxcbiAqICAgICAna2V5MycsIFsndmFsdWVBJywgJ3ZhbHVlQicsICd2YWx1ZUMnXSxcbiAqICAgICAna2V5NCcsIG51bGwpO1xuICogcmVzdWx0OiAnaHR0cDovL3d3dy5mb28uY29tP2V4aXN0aW5nPXRydWUmJyArXG4gKiAgICAgJ2tleTE9dmFsdWUxJicgK1xuICogICAgICdrZXkyPXZhbHVlJTNGd2lsbEJlRW5jb2RlZCYnICtcbiAqICAgICAna2V5Mz12YWx1ZUEma2V5Mz12YWx1ZUIma2V5Mz12YWx1ZUMnXG4gKiA8L3ByZT5cbiAqXG4gKiBBIHNpbmdsZSBjYWxsIHRvIHRoaXMgZnVuY3Rpb24gd2lsbCBub3QgZXhoaWJpdCBxdWFkcmF0aWMgYmVoYXZpb3IgaW4gSUUsXG4gKiB3aGVyZWFzIG11bHRpcGxlIHJlcGVhdGVkIGNhbGxzIG1heSwgYWx0aG91Z2ggdGhlIGVmZmVjdCBpcyBsaW1pdGVkIGJ5XG4gKiBmYWN0IHRoYXQgVVJMJ3MgZ2VuZXJhbGx5IGNhbid0IGV4Y2VlZCAya2IuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHVyaSBUaGUgb3JpZ2luYWwgVVJJLCB3aGljaCBtYXkgYWxyZWFkeSBoYXZlIHF1ZXJ5IGRhdGEuXG4gKiBAcGFyYW0gey4uLihnb29nLnVyaS51dGlscy5RdWVyeUFycmF5fGdvb2cudXJpLnV0aWxzLlF1ZXJ5VmFsdWUpfVxuICogdmFyX2FyZ3NcbiAqICAgICBBbiBhcnJheSBvciBhcmd1bWVudCBsaXN0IGNvbmZvcm1pbmcgdG8gZ29vZy51cmkudXRpbHMuUXVlcnlBcnJheS5cbiAqIEByZXR1cm4ge3N0cmluZ30gVGhlIFVSSSB3aXRoIGFsbCBxdWVyeSBwYXJhbWV0ZXJzIGFkZGVkLlxuICovXG5nb29nLnVyaS51dGlscy5hcHBlbmRQYXJhbXMgPSBmdW5jdGlvbih1cmksIHZhcl9hcmdzKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgdmFyIHF1ZXJ5RGF0YSA9IGFyZ3VtZW50cy5sZW5ndGggPT0gMiA/XG4gICAgICBnb29nLnVyaS51dGlscy5idWlsZFF1ZXJ5RGF0YShhcmd1bWVudHNbMV0sIDApIDpcbiAgICAgIGdvb2cudXJpLnV0aWxzLmJ1aWxkUXVlcnlEYXRhKGFyZ3VtZW50cywgMSk7XG4gIHJldHVybiBnb29nLnVyaS51dGlscy5hcHBlbmRRdWVyeURhdGFUb1VyaV8odXJpLCBxdWVyeURhdGEpO1xufTtcblxuXG4vKipcbiAqIEFwcGVuZHMgcXVlcnkgcGFyYW1ldGVycyBmcm9tIGEgbWFwLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSB1cmkgVGhlIG9yaWdpbmFsIFVSSSwgd2hpY2ggbWF5IGFscmVhZHkgaGF2ZSBxdWVyeSBkYXRhLlxuICogQHBhcmFtIHshT2JqZWN0PGdvb2cudXJpLnV0aWxzLlF1ZXJ5VmFsdWU+fSBtYXAgQW4gb2JqZWN0IHdoZXJlIGtleXMgYXJlXG4gKiAgICAgVVJJLWVuY29kZWQgcGFyYW1ldGVyIGtleXMsIGFuZCB0aGUgdmFsdWVzIGFyZSBhcmJpdHJhcnkgdHlwZXMgb3IgYXJyYXlzLlxuICogICAgIEtleXMgd2l0aCBhIG51bGwgdmFsdWUgYXJlIGRyb3BwZWQuXG4gKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSBuZXcgcGFyYW1ldGVycy5cbiAqL1xuZ29vZy51cmkudXRpbHMuYXBwZW5kUGFyYW1zRnJvbU1hcCA9IGZ1bmN0aW9uKHVyaSwgbWFwKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgdmFyIHF1ZXJ5RGF0YSA9IGdvb2cudXJpLnV0aWxzLmJ1aWxkUXVlcnlEYXRhRnJvbU1hcChtYXApO1xuICByZXR1cm4gZ29vZy51cmkudXRpbHMuYXBwZW5kUXVlcnlEYXRhVG9VcmlfKHVyaSwgcXVlcnlEYXRhKTtcbn07XG5cblxuLyoqXG4gKiBBcHBlbmRzIGEgc2luZ2xlIFVSSSBwYXJhbWV0ZXIuXG4gKlxuICogUmVwZWF0ZWQgY2FsbHMgdG8gdGhpcyBjYW4gZXhoaWJpdCBxdWFkcmF0aWMgYmVoYXZpb3IgaW4gSUU2IGR1ZSB0byB0aGVcbiAqIHdheSBzdHJpbmcgYXBwZW5kIHdvcmtzLCB0aG91Z2ggaXQgc2hvdWxkIGJlIGxpbWl0ZWQgZ2l2ZW4gdGhlIDJrYiBsaW1pdC5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gdXJpIFRoZSBvcmlnaW5hbCBVUkksIHdoaWNoIG1heSBhbHJlYWR5IGhhdmUgcXVlcnkgZGF0YS5cbiAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIGtleSwgd2hpY2ggbXVzdCBhbHJlYWR5IGJlIFVSSSBlbmNvZGVkLlxuICogQHBhcmFtIHsqPX0gb3B0X3ZhbHVlIFRoZSB2YWx1ZSwgd2hpY2ggd2lsbCBiZSBzdHJpbmdpemVkIGFuZCBlbmNvZGVkXG4gKiAgICAgKGFzc3VtZWQgbm90IGFscmVhZHkgdG8gYmUgZW5jb2RlZCkuICBJZiBvbWl0dGVkLCB1bmRlZmluZWQsIG9yIG51bGwsIHRoZVxuICogICAgIGtleSB3aWxsIGJlIGFkZGVkIGFzIGEgdmFsdWVsZXNzIHBhcmFtZXRlci5cbiAqIEByZXR1cm4ge3N0cmluZ30gVGhlIFVSSSB3aXRoIHRoZSBxdWVyeSBwYXJhbWV0ZXIgYWRkZWQuXG4gKi9cbmdvb2cudXJpLnV0aWxzLmFwcGVuZFBhcmFtID0gZnVuY3Rpb24odXJpLCBrZXksIG9wdF92YWx1ZSkge1xuICAndXNlIHN0cmljdCc7XG4gIHZhciB2YWx1ZSA9IChvcHRfdmFsdWUgIT0gbnVsbCkgPyAnPScgKyBnb29nLnN0cmluZy51cmxFbmNvZGUob3B0X3ZhbHVlKSA6ICcnO1xuICByZXR1cm4gZ29vZy51cmkudXRpbHMuYXBwZW5kUXVlcnlEYXRhVG9VcmlfKHVyaSwga2V5ICsgdmFsdWUpO1xufTtcblxuXG4vKipcbiAqIEZpbmRzIHRoZSBuZXh0IGluc3RhbmNlIG9mIGEgcXVlcnkgcGFyYW1ldGVyIHdpdGggdGhlIHNwZWNpZmllZCBuYW1lLlxuICpcbiAqIERvZXMgbm90IGluc3RhbnRpYXRlIGFueSBvYmplY3RzLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSB1cmkgVGhlIFVSSSB0byBzZWFyY2guICBNYXkgY29udGFpbiBhIGZyYWdtZW50IGlkZW50aWZpZXJcbiAqICAgICBpZiBvcHRfaGFzaEluZGV4IGlzIHNwZWNpZmllZC5cbiAqIEBwYXJhbSB7bnVtYmVyfSBzdGFydEluZGV4IFRoZSBpbmRleCB0byBiZWdpbiBzZWFyY2hpbmcgZm9yIHRoZSBrZXkgYXQuICBBXG4gKiAgICAgbWF0Y2ggbWF5IGJlIGZvdW5kIGV2ZW4gaWYgdGhpcyBpcyBvbmUgY2hhcmFjdGVyIGFmdGVyIHRoZSBhbXBlcnNhbmQuXG4gKiBAcGFyYW0ge3N0cmluZ30ga2V5RW5jb2RlZCBUaGUgVVJJLWVuY29kZWQga2V5LlxuICogQHBhcmFtIHtudW1iZXJ9IGhhc2hPckVuZEluZGV4IEluZGV4IHRvIHN0b3AgbG9va2luZyBhdC4gIElmIGEgaGFzaFxuICogICAgIG1hcmsgaXMgcHJlc2VudCwgaXQgc2hvdWxkIGJlIGl0cyBpbmRleCwgb3RoZXJ3aXNlIGl0IHNob3VsZCBiZSB0aGVcbiAqICAgICBsZW5ndGggb2YgdGhlIHN0cmluZy5cbiAqIEByZXR1cm4ge251bWJlcn0gVGhlIHBvc2l0aW9uIG9mIHRoZSBmaXJzdCBjaGFyYWN0ZXIgaW4gdGhlIGtleSdzIG5hbWUsXG4gKiAgICAgaW1tZWRpYXRlbHkgYWZ0ZXIgZWl0aGVyIGEgcXVlc3Rpb24gbWFyayBvciBhIGRvdC5cbiAqIEBwcml2YXRlXG4gKi9cbmdvb2cudXJpLnV0aWxzLmZpbmRQYXJhbV8gPSBmdW5jdGlvbihcbiAgICB1cmksIHN0YXJ0SW5kZXgsIGtleUVuY29kZWQsIGhhc2hPckVuZEluZGV4KSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgdmFyIGluZGV4ID0gc3RhcnRJbmRleDtcbiAgdmFyIGtleUxlbmd0aCA9IGtleUVuY29kZWQubGVuZ3RoO1xuXG4gIC8vIFNlYXJjaCBmb3IgdGhlIGtleSBpdHNlbGYgYW5kIHBvc3QtZmlsdGVyIGZvciBzdXJyb251ZGluZyBwdW5jdHVhdGlvbixcbiAgLy8gcmF0aGVyIHRoYW4gZXhwZW5zaXZlbHkgYnVpbGRpbmcgYSByZWdleHAuXG4gIHdoaWxlICgoaW5kZXggPSB1cmkuaW5kZXhPZihrZXlFbmNvZGVkLCBpbmRleCkpID49IDAgJiZcbiAgICAgICAgIGluZGV4IDwgaGFzaE9yRW5kSW5kZXgpIHtcbiAgICB2YXIgcHJlY2VkaW5nQ2hhciA9IHVyaS5jaGFyQ29kZUF0KGluZGV4IC0gMSk7XG4gICAgLy8gRW5zdXJlIHRoYXQgdGhlIHByZWNlZGluZyBjaGFyYWN0ZXIgaXMgJyYnIG9yICc/Jy5cbiAgICBpZiAocHJlY2VkaW5nQ2hhciA9PSBnb29nLnVyaS51dGlscy5DaGFyQ29kZV8uQU1QRVJTQU5EIHx8XG4gICAgICAgIHByZWNlZGluZ0NoYXIgPT0gZ29vZy51cmkudXRpbHMuQ2hhckNvZGVfLlFVRVNUSU9OKSB7XG4gICAgICAvLyBFbnN1cmUgdGhlIGZvbGxvd2luZyBjaGFyYWN0ZXIgaXMgJyYnLCAnPScsICcjJywgb3IgTmFOXG4gICAgICAvLyAoZW5kIG9mIHN0cmluZykuXG4gICAgICB2YXIgZm9sbG93aW5nQ2hhciA9IHVyaS5jaGFyQ29kZUF0KGluZGV4ICsga2V5TGVuZ3RoKTtcbiAgICAgIGlmICghZm9sbG93aW5nQ2hhciB8fCBmb2xsb3dpbmdDaGFyID09IGdvb2cudXJpLnV0aWxzLkNoYXJDb2RlXy5FUVVBTCB8fFxuICAgICAgICAgIGZvbGxvd2luZ0NoYXIgPT0gZ29vZy51cmkudXRpbHMuQ2hhckNvZGVfLkFNUEVSU0FORCB8fFxuICAgICAgICAgIGZvbGxvd2luZ0NoYXIgPT0gZ29vZy51cmkudXRpbHMuQ2hhckNvZGVfLkhBU0gpIHtcbiAgICAgICAgcmV0dXJuIGluZGV4O1xuICAgICAgfVxuICAgIH1cbiAgICBpbmRleCArPSBrZXlMZW5ndGggKyAxO1xuICB9XG5cbiAgcmV0dXJuIC0xO1xufTtcblxuXG4vKipcbiAqIFJlZ3VsYXIgZXhwcmVzc2lvbiBmb3IgZmluZGluZyBhIGhhc2ggbWFyayBvciBlbmQgb2Ygc3RyaW5nLlxuICogQHR5cGUge1JlZ0V4cH1cbiAqIEBwcml2YXRlXG4gKi9cbmdvb2cudXJpLnV0aWxzLmhhc2hPckVuZFJlXyA9IC8jfCQvO1xuXG5cbi8qKlxuICogRGV0ZXJtaW5lcyBpZiB0aGUgVVJJIGNvbnRhaW5zIGEgc3BlY2lmaWMga2V5LlxuICpcbiAqIFBlcmZvcm1zIG5vIG9iamVjdCBpbnN0YW50aWF0aW9ucy5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gdXJpIFRoZSBVUkkgdG8gcHJvY2Vzcy4gIE1heSBjb250YWluIGEgZnJhZ21lbnRcbiAqICAgICBpZGVudGlmaWVyLlxuICogQHBhcmFtIHtzdHJpbmd9IGtleUVuY29kZWQgVGhlIFVSSS1lbmNvZGVkIGtleS4gIENhc2Utc2Vuc2l0aXZlLlxuICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGUga2V5IGlzIHByZXNlbnQuXG4gKi9cbmdvb2cudXJpLnV0aWxzLmhhc1BhcmFtID0gZnVuY3Rpb24odXJpLCBrZXlFbmNvZGVkKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmV0dXJuIGdvb2cudXJpLnV0aWxzLmZpbmRQYXJhbV8oXG4gICAgICAgICAgICAgdXJpLCAwLCBrZXlFbmNvZGVkLCB1cmkuc2VhcmNoKGdvb2cudXJpLnV0aWxzLmhhc2hPckVuZFJlXykpID49IDA7XG59O1xuXG5cbi8qKlxuICogR2V0cyB0aGUgZmlyc3QgdmFsdWUgb2YgYSBxdWVyeSBwYXJhbWV0ZXIuXG4gKiBAcGFyYW0ge3N0cmluZ30gdXJpIFRoZSBVUkkgdG8gcHJvY2Vzcy4gIE1heSBjb250YWluIGEgZnJhZ21lbnQuXG4gKiBAcGFyYW0ge3N0cmluZ30ga2V5RW5jb2RlZCBUaGUgVVJJLWVuY29kZWQga2V5LiAgQ2FzZS1zZW5zaXRpdmUuXG4gKiBAcmV0dXJuIHs/c3RyaW5nfSBUaGUgZmlyc3QgdmFsdWUgb2YgdGhlIHBhcmFtZXRlciAoVVJJLWRlY29kZWQpLCBvciBudWxsXG4gKiAgICAgaWYgdGhlIHBhcmFtZXRlciBpcyBub3QgZm91bmQuXG4gKi9cbmdvb2cudXJpLnV0aWxzLmdldFBhcmFtVmFsdWUgPSBmdW5jdGlvbih1cmksIGtleUVuY29kZWQpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICB2YXIgaGFzaE9yRW5kSW5kZXggPSB1cmkuc2VhcmNoKGdvb2cudXJpLnV0aWxzLmhhc2hPckVuZFJlXyk7XG4gIHZhciBmb3VuZEluZGV4ID1cbiAgICAgIGdvb2cudXJpLnV0aWxzLmZpbmRQYXJhbV8odXJpLCAwLCBrZXlFbmNvZGVkLCBoYXNoT3JFbmRJbmRleCk7XG5cbiAgaWYgKGZvdW5kSW5kZXggPCAwKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH0gZWxzZSB7XG4gICAgdmFyIGVuZFBvc2l0aW9uID0gdXJpLmluZGV4T2YoJyYnLCBmb3VuZEluZGV4KTtcbiAgICBpZiAoZW5kUG9zaXRpb24gPCAwIHx8IGVuZFBvc2l0aW9uID4gaGFzaE9yRW5kSW5kZXgpIHtcbiAgICAgIGVuZFBvc2l0aW9uID0gaGFzaE9yRW5kSW5kZXg7XG4gICAgfVxuICAgIC8vIFByb2dyZXNzIGZvcnRoIHRvIHRoZSBlbmQgb2YgdGhlIFwia2V5PVwiIG9yIFwia2V5JlwiIHN1YnN0cmluZy5cbiAgICBmb3VuZEluZGV4ICs9IGtleUVuY29kZWQubGVuZ3RoICsgMTtcbiAgICAvLyBVc2Ugc3Vic3RyLCBiZWNhdXNlIGl0ICh1bmxpa2Ugc3Vic3RyaW5nKSB3aWxsIHJldHVybiBlbXB0eSBzdHJpbmdcbiAgICAvLyBpZiBmb3VuZEluZGV4ID4gZW5kUG9zaXRpb24uXG4gICAgcmV0dXJuIGdvb2cuc3RyaW5nLnVybERlY29kZShcbiAgICAgICAgdXJpLnN1YnN0cihmb3VuZEluZGV4LCBlbmRQb3NpdGlvbiAtIGZvdW5kSW5kZXgpKTtcbiAgfVxufTtcblxuXG4vKipcbiAqIEdldHMgYWxsIHZhbHVlcyBvZiBhIHF1ZXJ5IHBhcmFtZXRlci5cbiAqIEBwYXJhbSB7c3RyaW5nfSB1cmkgVGhlIFVSSSB0byBwcm9jZXNzLiAgTWF5IGNvbnRhaW4gYSBmcmFnbWVudC5cbiAqIEBwYXJhbSB7c3RyaW5nfSBrZXlFbmNvZGVkIFRoZSBVUkktZW5jb2RlZCBrZXkuICBDYXNlLXNlbnNpdGl2ZS5cbiAqIEByZXR1cm4geyFBcnJheTxzdHJpbmc+fSBBbGwgVVJJLWRlY29kZWQgdmFsdWVzIHdpdGggdGhlIGdpdmVuIGtleS5cbiAqICAgICBJZiB0aGUga2V5IGlzIG5vdCBmb3VuZCwgdGhpcyB3aWxsIGhhdmUgbGVuZ3RoIDAsIGJ1dCBuZXZlciBiZSBudWxsLlxuICovXG5nb29nLnVyaS51dGlscy5nZXRQYXJhbVZhbHVlcyA9IGZ1bmN0aW9uKHVyaSwga2V5RW5jb2RlZCkge1xuICAndXNlIHN0cmljdCc7XG4gIHZhciBoYXNoT3JFbmRJbmRleCA9IHVyaS5zZWFyY2goZ29vZy51cmkudXRpbHMuaGFzaE9yRW5kUmVfKTtcbiAgdmFyIHBvc2l0aW9uID0gMDtcbiAgdmFyIGZvdW5kSW5kZXg7XG4gIHZhciByZXN1bHQgPSBbXTtcblxuICB3aGlsZSAoKGZvdW5kSW5kZXggPSBnb29nLnVyaS51dGlscy5maW5kUGFyYW1fKFxuICAgICAgICAgICAgICB1cmksIHBvc2l0aW9uLCBrZXlFbmNvZGVkLCBoYXNoT3JFbmRJbmRleCkpID49IDApIHtcbiAgICAvLyBGaW5kIHdoZXJlIHRoaXMgcGFyYW1ldGVyIGVuZHMsIGVpdGhlciB0aGUgJyYnIG9yIHRoZSBlbmQgb2YgdGhlXG4gICAgLy8gcXVlcnkgcGFyYW1ldGVycy5cbiAgICBwb3NpdGlvbiA9IHVyaS5pbmRleE9mKCcmJywgZm91bmRJbmRleCk7XG4gICAgaWYgKHBvc2l0aW9uIDwgMCB8fCBwb3NpdGlvbiA+IGhhc2hPckVuZEluZGV4KSB7XG4gICAgICBwb3NpdGlvbiA9IGhhc2hPckVuZEluZGV4O1xuICAgIH1cblxuICAgIC8vIFByb2dyZXNzIGZvcnRoIHRvIHRoZSBlbmQgb2YgdGhlIFwia2V5PVwiIG9yIFwia2V5JlwiIHN1YnN0cmluZy5cbiAgICBmb3VuZEluZGV4ICs9IGtleUVuY29kZWQubGVuZ3RoICsgMTtcbiAgICAvLyBVc2Ugc3Vic3RyLCBiZWNhdXNlIGl0ICh1bmxpa2Ugc3Vic3RyaW5nKSB3aWxsIHJldHVybiBlbXB0eSBzdHJpbmdcbiAgICAvLyBpZiBmb3VuZEluZGV4ID4gcG9zaXRpb24uXG4gICAgcmVzdWx0LnB1c2goXG4gICAgICAgIGdvb2cuc3RyaW5nLnVybERlY29kZSh1cmkuc3Vic3RyKGZvdW5kSW5kZXgsIHBvc2l0aW9uIC0gZm91bmRJbmRleCkpKTtcbiAgfVxuXG4gIHJldHVybiByZXN1bHQ7XG59O1xuXG5cbi8qKlxuICogUmVnZXhwIHRvIGZpbmQgdHJhaWxpbmcgcXVlc3Rpb24gbWFya3MgYW5kIGFtcGVyc2FuZHMuXG4gKiBAdHlwZSB7UmVnRXhwfVxuICogQHByaXZhdGVcbiAqL1xuZ29vZy51cmkudXRpbHMudHJhaWxpbmdRdWVyeVB1bmN0dWF0aW9uUmVfID0gL1s/Jl0oJHwjKS87XG5cblxuLyoqXG4gKiBSZW1vdmVzIGFsbCBpbnN0YW5jZXMgb2YgYSBxdWVyeSBwYXJhbWV0ZXIuXG4gKiBAcGFyYW0ge3N0cmluZ30gdXJpIFRoZSBVUkkgdG8gcHJvY2Vzcy4gIE11c3Qgbm90IGNvbnRhaW4gYSBmcmFnbWVudC5cbiAqIEBwYXJhbSB7c3RyaW5nfSBrZXlFbmNvZGVkIFRoZSBVUkktZW5jb2RlZCBrZXkuXG4gKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSBVUkkgd2l0aCBhbGwgaW5zdGFuY2VzIG9mIHRoZSBwYXJhbWV0ZXIgcmVtb3ZlZC5cbiAqL1xuZ29vZy51cmkudXRpbHMucmVtb3ZlUGFyYW0gPSBmdW5jdGlvbih1cmksIGtleUVuY29kZWQpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICB2YXIgaGFzaE9yRW5kSW5kZXggPSB1cmkuc2VhcmNoKGdvb2cudXJpLnV0aWxzLmhhc2hPckVuZFJlXyk7XG4gIHZhciBwb3NpdGlvbiA9IDA7XG4gIHZhciBmb3VuZEluZGV4O1xuICB2YXIgYnVmZmVyID0gW107XG5cbiAgLy8gTG9vayBmb3IgYSBxdWVyeSBwYXJhbWV0ZXIuXG4gIHdoaWxlICgoZm91bmRJbmRleCA9IGdvb2cudXJpLnV0aWxzLmZpbmRQYXJhbV8oXG4gICAgICAgICAgICAgIHVyaSwgcG9zaXRpb24sIGtleUVuY29kZWQsIGhhc2hPckVuZEluZGV4KSkgPj0gMCkge1xuICAgIC8vIEdldCB0aGUgcG9ydGlvbiBvZiB0aGUgcXVlcnkgc3RyaW5nIHVwIHRvLCBidXQgbm90IGluY2x1ZGluZywgdGhlID9cbiAgICAvLyBvciAmIHN0YXJ0aW5nIHRoZSBwYXJhbWV0ZXIuXG4gICAgYnVmZmVyLnB1c2godXJpLnN1YnN0cmluZyhwb3NpdGlvbiwgZm91bmRJbmRleCkpO1xuICAgIC8vIFByb2dyZXNzIHRvIGltbWVkaWF0ZWx5IGFmdGVyIHRoZSAnJicuICBJZiBub3QgZm91bmQsIGdvIHRvIHRoZSBlbmQuXG4gICAgLy8gQXZvaWQgaW5jbHVkaW5nIHRoZSBoYXNoIG1hcmsuXG4gICAgcG9zaXRpb24gPSBNYXRoLm1pbihcbiAgICAgICAgKHVyaS5pbmRleE9mKCcmJywgZm91bmRJbmRleCkgKyAxKSB8fCBoYXNoT3JFbmRJbmRleCwgaGFzaE9yRW5kSW5kZXgpO1xuICB9XG5cbiAgLy8gQXBwZW5kIGV2ZXJ5dGhpbmcgdGhhdCBpcyByZW1haW5pbmcuXG4gIGJ1ZmZlci5wdXNoKHVyaS5zdWJzdHIocG9zaXRpb24pKTtcblxuICAvLyBKb2luIHRoZSBidWZmZXIsIGFuZCByZW1vdmUgdHJhaWxpbmcgcHVuY3R1YXRpb24gdGhhdCByZW1haW5zLlxuICByZXR1cm4gYnVmZmVyLmpvaW4oJycpLnJlcGxhY2UoXG4gICAgICBnb29nLnVyaS51dGlscy50cmFpbGluZ1F1ZXJ5UHVuY3R1YXRpb25SZV8sICckMScpO1xufTtcblxuXG4vKipcbiAqIFJlcGxhY2VzIGFsbCBleGlzdGluZyBkZWZpbml0aW9ucyBvZiBhIHBhcmFtZXRlciB3aXRoIGEgc2luZ2xlIGRlZmluaXRpb24uXG4gKlxuICogUmVwZWF0ZWQgY2FsbHMgdG8gdGhpcyBjYW4gZXhoaWJpdCBxdWFkcmF0aWMgYmVoYXZpb3IgZHVlIHRvIHRoZSBuZWVkIHRvXG4gKiBmaW5kIGV4aXN0aW5nIGluc3RhbmNlcyBhbmQgcmVjb25zdHJ1Y3QgdGhlIHN0cmluZywgdGhvdWdoIGl0IHNob3VsZCBiZVxuICogbGltaXRlZCBnaXZlbiB0aGUgMmtiIGxpbWl0LiAgQ29uc2lkZXIgdXNpbmcgYXBwZW5kUGFyYW1zIG9yIHNldFBhcmFtc0Zyb21NYXBcbiAqIHRvIHVwZGF0ZSBtdWx0aXBsZSBwYXJhbWV0ZXJzIGluIGJ1bGsuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHVyaSBUaGUgb3JpZ2luYWwgVVJJLCB3aGljaCBtYXkgYWxyZWFkeSBoYXZlIHF1ZXJ5IGRhdGEuXG4gKiBAcGFyYW0ge3N0cmluZ30ga2V5RW5jb2RlZCBUaGUga2V5LCB3aGljaCBtdXN0IGFscmVhZHkgYmUgVVJJIGVuY29kZWQuXG4gKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSwgd2hpY2ggd2lsbCBiZSBzdHJpbmdpemVkIGFuZCBlbmNvZGVkIChhc3N1bWVkXG4gKiAgICAgbm90IGFscmVhZHkgdG8gYmUgZW5jb2RlZCkuXG4gKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSBVUkkgd2l0aCB0aGUgcXVlcnkgcGFyYW1ldGVyIGFkZGVkLlxuICovXG5nb29nLnVyaS51dGlscy5zZXRQYXJhbSA9IGZ1bmN0aW9uKHVyaSwga2V5RW5jb2RlZCwgdmFsdWUpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gZ29vZy51cmkudXRpbHMuYXBwZW5kUGFyYW0oXG4gICAgICBnb29nLnVyaS51dGlscy5yZW1vdmVQYXJhbSh1cmksIGtleUVuY29kZWQpLCBrZXlFbmNvZGVkLCB2YWx1ZSk7XG59O1xuXG5cbi8qKlxuICogRWZmZWNpZW50bHkgc2V0IG9yIHJlbW92ZSBtdWx0aXBsZSBxdWVyeSBwYXJhbWV0ZXJzIGluIGEgVVJJLiBPcmRlciBvZlxuICogdW5jaGFuZ2VkIHBhcmFtZXRlcnMgd2lsbCBub3QgYmUgbW9kaWZpZWQsIGFsbCB1cGRhdGVkIHBhcmFtZXRlcnMgd2lsbCBiZVxuICogYXBwZW5kZWQgdG8gdGhlIGVuZCBvZiB0aGUgcXVlcnkuIFBhcmFtcyB3aXRoIHZhbHVlcyBvZiBudWxsIG9yIHVuZGVmaW5lZCBhcmVcbiAqIHJlbW92ZWQuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHVyaSBUaGUgVVJJIHRvIHByb2Nlc3MuXG4gKiBAcGFyYW0geyFPYmplY3Q8c3RyaW5nLCBnb29nLnVyaS51dGlscy5RdWVyeVZhbHVlPn0gcGFyYW1zIEEgbGlzdCBvZlxuICogICAgIHBhcmFtZXRlcnMgdG8gdXBkYXRlLiBJZiBudWxsIG9yIHVuZGVmaW5lZCwgdGhlIHBhcmFtIHdpbGwgYmUgcmVtb3ZlZC5cbiAqIEByZXR1cm4ge3N0cmluZ30gQW4gdXBkYXRlZCBVUkkgd2hlcmUgdGhlIHF1ZXJ5IGRhdGEgaGFzIGJlZW4gdXBkYXRlZCB3aXRoXG4gKiAgICAgdGhlIHBhcmFtcy5cbiAqL1xuZ29vZy51cmkudXRpbHMuc2V0UGFyYW1zRnJvbU1hcCA9IGZ1bmN0aW9uKHVyaSwgcGFyYW1zKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgdmFyIHBhcnRzID0gZ29vZy51cmkudXRpbHMuc3BsaXRRdWVyeURhdGFfKHVyaSk7XG4gIHZhciBxdWVyeURhdGEgPSBwYXJ0c1sxXTtcbiAgdmFyIGJ1ZmZlciA9IFtdO1xuICBpZiAocXVlcnlEYXRhKSB7XG4gICAgcXVlcnlEYXRhLnNwbGl0KCcmJykuZm9yRWFjaChmdW5jdGlvbihwYWlyKSB7XG4gICAgICAndXNlIHN0cmljdCc7XG4gICAgICB2YXIgaW5kZXhPZkVxdWFscyA9IHBhaXIuaW5kZXhPZignPScpO1xuICAgICAgdmFyIG5hbWUgPSBpbmRleE9mRXF1YWxzID49IDAgPyBwYWlyLnN1YnN0cigwLCBpbmRleE9mRXF1YWxzKSA6IHBhaXI7XG4gICAgICBpZiAoIXBhcmFtcy5oYXNPd25Qcm9wZXJ0eShuYW1lKSkge1xuICAgICAgICBidWZmZXIucHVzaChwYWlyKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuICBwYXJ0c1sxXSA9IGdvb2cudXJpLnV0aWxzLmFwcGVuZFF1ZXJ5RGF0YV8oXG4gICAgICBidWZmZXIuam9pbignJicpLCBnb29nLnVyaS51dGlscy5idWlsZFF1ZXJ5RGF0YUZyb21NYXAocGFyYW1zKSk7XG4gIHJldHVybiBnb29nLnVyaS51dGlscy5qb2luUXVlcnlEYXRhXyhwYXJ0cyk7XG59O1xuXG5cbi8qKlxuICogR2VuZXJhdGVzIGEgVVJJIHBhdGggdXNpbmcgYSBnaXZlbiBVUkkgYW5kIGEgcGF0aCB3aXRoIGNoZWNrcyB0b1xuICogcHJldmVudCBjb25zZWN1dGl2ZSBcIi8vXCIuIFRoZSBiYXNlVXJpIHBhc3NlZCBpbiBtdXN0IG5vdCBjb250YWluXG4gKiBxdWVyeSBvciBmcmFnbWVudCBpZGVudGlmaWVycy4gVGhlIHBhdGggdG8gYXBwZW5kIG1heSBub3QgY29udGFpbiBxdWVyeSBvclxuICogZnJhZ21lbnQgaWRlbnRpZmllcnMuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IGJhc2VVcmkgVVJJIHRvIHVzZSBhcyB0aGUgYmFzZS5cbiAqIEBwYXJhbSB7c3RyaW5nfSBwYXRoIFBhdGggdG8gYXBwZW5kLlxuICogQHJldHVybiB7c3RyaW5nfSBVcGRhdGVkIFVSSS5cbiAqL1xuZ29vZy51cmkudXRpbHMuYXBwZW5kUGF0aCA9IGZ1bmN0aW9uKGJhc2VVcmksIHBhdGgpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBnb29nLnVyaS51dGlscy5hc3NlcnROb0ZyYWdtZW50c09yUXVlcmllc18oYmFzZVVyaSk7XG5cbiAgLy8gUmVtb3ZlIGFueSB0cmFpbGluZyAnLydcbiAgaWYgKGdvb2cuc3RyaW5nLmVuZHNXaXRoKGJhc2VVcmksICcvJykpIHtcbiAgICBiYXNlVXJpID0gYmFzZVVyaS5zdWJzdHIoMCwgYmFzZVVyaS5sZW5ndGggLSAxKTtcbiAgfVxuICAvLyBSZW1vdmUgYW55IGxlYWRpbmcgJy8nXG4gIGlmIChnb29nLnN0cmluZy5zdGFydHNXaXRoKHBhdGgsICcvJykpIHtcbiAgICBwYXRoID0gcGF0aC5zdWJzdHIoMSk7XG4gIH1cbiAgcmV0dXJuICcnICsgYmFzZVVyaSArICcvJyArIHBhdGg7XG59O1xuXG5cbi8qKlxuICogUmVwbGFjZXMgdGhlIHBhdGguXG4gKiBAcGFyYW0ge3N0cmluZ30gdXJpIFVSSSB0byB1c2UgYXMgdGhlIGJhc2UuXG4gKiBAcGFyYW0ge3N0cmluZ30gcGF0aCBOZXcgcGF0aC5cbiAqIEByZXR1cm4ge3N0cmluZ30gVXBkYXRlZCBVUkkuXG4gKi9cbmdvb2cudXJpLnV0aWxzLnNldFBhdGggPSBmdW5jdGlvbih1cmksIHBhdGgpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICAvLyBBZGQgYW55IG1pc3NpbmcgJy8nLlxuICBpZiAoIWdvb2cuc3RyaW5nLnN0YXJ0c1dpdGgocGF0aCwgJy8nKSkge1xuICAgIHBhdGggPSAnLycgKyBwYXRoO1xuICB9XG4gIHZhciBwYXJ0cyA9IGdvb2cudXJpLnV0aWxzLnNwbGl0KHVyaSk7XG4gIHJldHVybiBnb29nLnVyaS51dGlscy5idWlsZEZyb21FbmNvZGVkUGFydHMoXG4gICAgICBwYXJ0c1tnb29nLnVyaS51dGlscy5Db21wb25lbnRJbmRleC5TQ0hFTUVdLFxuICAgICAgcGFydHNbZ29vZy51cmkudXRpbHMuQ29tcG9uZW50SW5kZXguVVNFUl9JTkZPXSxcbiAgICAgIHBhcnRzW2dvb2cudXJpLnV0aWxzLkNvbXBvbmVudEluZGV4LkRPTUFJTl0sXG4gICAgICBwYXJ0c1tnb29nLnVyaS51dGlscy5Db21wb25lbnRJbmRleC5QT1JUXSwgcGF0aCxcbiAgICAgIHBhcnRzW2dvb2cudXJpLnV0aWxzLkNvbXBvbmVudEluZGV4LlFVRVJZX0RBVEFdLFxuICAgICAgcGFydHNbZ29vZy51cmkudXRpbHMuQ29tcG9uZW50SW5kZXguRlJBR01FTlRdKTtcbn07XG5cblxuLyoqXG4gKiBTdGFuZGFyZCBzdXBwb3J0ZWQgcXVlcnkgcGFyYW1ldGVycy5cbiAqIEBlbnVtIHtzdHJpbmd9XG4gKi9cbmdvb2cudXJpLnV0aWxzLlN0YW5kYXJkUXVlcnlQYXJhbSA9IHtcblxuICAvKiogVW51c2VkIHBhcmFtZXRlciBmb3IgdW5pcXVlLWlmeWluZy4gKi9cbiAgUkFORE9NOiAnengnXG59O1xuXG5cbi8qKlxuICogU2V0cyB0aGUgenggcGFyYW1ldGVyIG9mIGEgVVJJIHRvIGEgcmFuZG9tIHZhbHVlLlxuICogQHBhcmFtIHtzdHJpbmd9IHVyaSBBbnkgVVJJLlxuICogQHJldHVybiB7c3RyaW5nfSBUaGF0IFVSSSB3aXRoIHRoZSBcInp4XCIgcGFyYW1ldGVyIGFkZGVkIG9yIHJlcGxhY2VkIHRvXG4gKiAgICAgY29udGFpbiBhIHJhbmRvbSBzdHJpbmcuXG4gKi9cbmdvb2cudXJpLnV0aWxzLm1ha2VVbmlxdWUgPSBmdW5jdGlvbih1cmkpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gZ29vZy51cmkudXRpbHMuc2V0UGFyYW0oXG4gICAgICB1cmksIGdvb2cudXJpLnV0aWxzLlN0YW5kYXJkUXVlcnlQYXJhbS5SQU5ET00sXG4gICAgICBnb29nLnN0cmluZy5nZXRSYW5kb21TdHJpbmcoKSk7XG59O1xuIiwgIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCBUaGUgQ2xvc3VyZSBMaWJyYXJ5IEF1dGhvcnMuXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogQGZpbGVvdmVydmlldyBJbnRlcmZhY2UgYW5kIHNoYXJlZCBkYXRhIHN0cnVjdHVyZXMgZm9yIGltcGxlbWVudGluZ1xuICogZGlmZmVyZW50IHdpcmUgcHJvdG9jb2wgdmVyc2lvbnMuXG4gKi9cbmdvb2cucHJvdmlkZSgnZ29vZy5sYWJzLm5ldC53ZWJDaGFubmVsLldpcmUnKTtcbmdvb2cucHJvdmlkZSgnZ29vZy5sYWJzLm5ldC53ZWJDaGFubmVsLldpcmUuUXVldWVkTWFwJyk7XG5cbmdvb2cucmVxdWlyZVR5cGUoJ2dvb2cuc3RydWN0cy5NYXAnKTtcblxuXG5cbi8qKlxuICogVGhlIGludGVyZmFjZSBjbGFzcy5cbiAqIEBpbnRlcmZhY2VcbiAqL1xuZ29vZy5sYWJzLm5ldC53ZWJDaGFubmVsLldpcmUgPSBjbGFzcyB7XG4gIGNvbnN0cnVjdG9yKCkge31cbn07XG5cblxuLyoqXG4gKiBUaGUgbGF0ZXN0IHByb3RvY29sIHZlcnNpb24gdGhhdCB0aGlzIGNsYXNzIHN1cHBvcnRzLiBXZSByZXF1ZXN0IHRoaXMgdmVyc2lvblxuICogZnJvbSB0aGUgc2VydmVyIHdoZW4gb3BlbmluZyB0aGUgY29ubmVjdGlvbi4gU2hvdWxkIG1hdGNoXG4gKiBMQVRFU1RfQ0hBTk5FTF9WRVJTSU9OIG9uIHRoZSBzZXJ2ZXIgY29kZS5cbiAqIEB0eXBlIHtudW1iZXJ9XG4gKi9cbmdvb2cubGFicy5uZXQud2ViQ2hhbm5lbC5XaXJlLkxBVEVTVF9DSEFOTkVMX1ZFUlNJT04gPSA4O1xuXG5cbi8qKlxuICogVGhlIEpTT04gZmllbGQga2V5IGZvciB0aGUgcmF3IGRhdGEgd3JhcHBlciBvYmplY3QuXG4gKiBAdHlwZSB7c3RyaW5nfVxuICovXG5nb29nLmxhYnMubmV0LndlYkNoYW5uZWwuV2lyZS5SQVdfREFUQV9LRVkgPSAnX19kYXRhX18nO1xuXG5cblxuLyoqXG4gKiBTaW1wbGUgY29udGFpbmVyIGNsYXNzIGZvciBhIChtYXBJZCwgbWFwKSBwYWlyLlxuICovXG5nb29nLmxhYnMubmV0LndlYkNoYW5uZWwuV2lyZS5RdWV1ZWRNYXAgPSBjbGFzcyB7XG4gIC8qKlxuICAgKiBAcGFyYW0ge251bWJlcn0gbWFwSWQgVGhlIGlkIGZvciB0aGlzIG1hcC5cbiAgICogQHBhcmFtIHshT2JqZWN0fCFnb29nLnN0cnVjdHMuTWFwfSBtYXAgVGhlIG1hcCBpdHNlbGYuXG4gICAqIEBwYXJhbSB7IU9iamVjdD19IG9wdF9jb250ZXh0IFRoZSBjb250ZXh0IGFzc29jaWF0ZWQgd2l0aCB0aGUgbWFwLlxuICAgKi9cbiAgY29uc3RydWN0b3IobWFwSWQsIG1hcCwgb3B0X2NvbnRleHQpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgLyoqXG4gICAgICogVGhlIGlkIGZvciB0aGlzIG1hcC5cbiAgICAgKiBAdHlwZSB7bnVtYmVyfVxuICAgICAqL1xuICAgIHRoaXMubWFwSWQgPSBtYXBJZDtcblxuICAgIC8qKlxuICAgICAqIFRoZSBtYXAgaXRzZWxmLlxuICAgICAqIEB0eXBlIHshT2JqZWN0fCFnb29nLnN0cnVjdHMuTWFwfVxuICAgICAqL1xuICAgIHRoaXMubWFwID0gbWFwO1xuXG4gICAgLyoqXG4gICAgICogVGhlIGNvbnRleHQgZm9yIHRoZSBtYXAuXG4gICAgICogQHR5cGUge09iamVjdH1cbiAgICAgKi9cbiAgICB0aGlzLmNvbnRleHQgPSBvcHRfY29udGV4dCB8fCBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIEByZXR1cm4ge251bWJlcnx1bmRlZmluZWR9IHRoZSBzaXplIG9mIHRoZSByYXcgSlNPTiBtZXNzYWdlIG9yXG4gICAqIHVuZGVmaW5lZCBpZiB0aGUgbWVzc2FnZSBpcyBub3QgZW5jb2RlZCBhcyBhIHJhdyBKU09OIG1lc3NhZ2VcbiAgICovXG4gIGdldFJhd0RhdGFTaXplKCkge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICBpZiAoZ29vZy5sYWJzLm5ldC53ZWJDaGFubmVsLldpcmUuUkFXX0RBVEFfS0VZIGluIHRoaXMubWFwKSB7XG4gICAgICBjb25zdCBkYXRhID0gdGhpcy5tYXBbZ29vZy5sYWJzLm5ldC53ZWJDaGFubmVsLldpcmUuUkFXX0RBVEFfS0VZXTtcbiAgICAgIGlmICh0eXBlb2YgZGF0YSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgcmV0dXJuIGRhdGEubGVuZ3RoO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cbn07XG4iLCAiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IFRoZSBDbG9zdXJlIExpYnJhcnkgQXV0aG9ycy5cbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuXG4vKipcbiAqIEBmaWxlb3ZlcnZpZXcgRGVmaW5lcyBhIGNsYXNzIGZvciBwYXJzaW5nIEpTT04gdXNpbmcgdGhlIGJyb3dzZXIncyBidWlsdCBpblxuICogSlNPTiBsaWJyYXJ5LlxuICogQHN1cHByZXNzIHttaXNzaW5nUmVxdWlyZX0gVE9ETyh1c2VyKTogdGhpcyBzaG91bGRuJ3QgYmUgbmVlZGVkXG4gKi9cblxuZ29vZy5wcm92aWRlKCdnb29nLmpzb24uTmF0aXZlSnNvblByb2Nlc3NvcicpO1xuXG5nb29nLnJlcXVpcmUoJ2dvb2cuYXNzZXJ0cycpO1xuZ29vZy5yZXF1aXJlKCdnb29nLmpzb24uUHJvY2Vzc29yJyk7XG5cblxuXG4vKipcbiAqIEEgY2xhc3MgdGhhdCBwYXJzZXMgYW5kIHN0cmluZ2lmaWVzIEpTT04gdXNpbmcgdGhlIGJyb3dzZXIncyBidWlsdC1pbiBKU09OXG4gKiBsaWJyYXJ5LCBpZiBpdCBpcyBhdmFpbGFibGUuXG4gKlxuICogTm90ZSB0aGF0IHRoZSBuYXRpdmUgSlNPTiBhcGkgaGFzIHN1YnRsZSBkaWZmZXJlbmNlcyBhY3Jvc3MgYnJvd3NlcnMsIHNvXG4gKiB1c2UgdGhpcyBpbXBsZW1lbnRhdGlvbiB3aXRoIGNhcmUuICBTZWUganNvbl90ZXN0I2Fzc2VydFNlcmlhbGl6ZVxuICogZm9yIGRldGFpbHMgb24gdGhlIGRpZmZlcmVuY2VzIGZyb20gZ29vZy5qc29uLlxuICpcbiAqIFRoaXMgaW1wbGVtZW50YXRpb24gaXMgc2lnbmZpY2FudGx5IGZhc3RlciB0aGFuIGdvb2cuanNvbiwgYXQgbGVhc3Qgb25cbiAqIENocm9tZS4gIFNlZSBqc29uX3BlcmYuaHRtbCBmb3IgYSBwZXJmIHRlc3Qgc2hvd2luZyB0aGUgZGlmZmVyZW5jZS5cbiAqXG4gKiBAcGFyYW0gez9nb29nLmpzb24uUmVwbGFjZXI9fSBvcHRfcmVwbGFjZXIgQW4gb3B0aW9uYWwgcmVwbGFjZXIgdG8gdXNlIGR1cmluZ1xuICogICAgIHNlcmlhbGl6YXRpb24uXG4gKiBAcGFyYW0gez9nb29nLmpzb24uUmV2aXZlcj19IG9wdF9yZXZpdmVyIEFuIG9wdGlvbmFsIHJldml2ZXIgdG8gdXNlIGR1cmluZ1xuICogICAgIHBhcnNpbmcuXG4gKiBAY29uc3RydWN0b3JcbiAqIEBpbXBsZW1lbnRzIHtnb29nLmpzb24uUHJvY2Vzc29yfVxuICogQGZpbmFsXG4gKi9cbmdvb2cuanNvbi5OYXRpdmVKc29uUHJvY2Vzc29yID0gZnVuY3Rpb24ob3B0X3JlcGxhY2VyLCBvcHRfcmV2aXZlcikge1xuICAndXNlIHN0cmljdCc7XG4gIGdvb2cuYXNzZXJ0cy5hc3NlcnQoZ29vZy5nbG9iYWxbJ0pTT04nXSAhPT0gdW5kZWZpbmVkLCAnSlNPTiBub3QgZGVmaW5lZCcpO1xuXG4gIC8qKlxuICAgKiBAdHlwZSB7Z29vZy5qc29uLlJlcGxhY2VyfG51bGx8dW5kZWZpbmVkfVxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgdGhpcy5yZXBsYWNlcl8gPSBvcHRfcmVwbGFjZXI7XG5cbiAgLyoqXG4gICAqIEB0eXBlIHtnb29nLmpzb24uUmV2aXZlcnxudWxsfHVuZGVmaW5lZH1cbiAgICogQHByaXZhdGVcbiAgICovXG4gIHRoaXMucmV2aXZlcl8gPSBvcHRfcmV2aXZlcjtcbn07XG5cblxuLyoqIEBvdmVycmlkZSAqL1xuZ29vZy5qc29uLk5hdGl2ZUpzb25Qcm9jZXNzb3IucHJvdG90eXBlLnN0cmluZ2lmeSA9IGZ1bmN0aW9uKG9iamVjdCkge1xuICAndXNlIHN0cmljdCc7XG4gIHJldHVybiBnb29nLmdsb2JhbFsnSlNPTiddLnN0cmluZ2lmeShvYmplY3QsIHRoaXMucmVwbGFjZXJfKTtcbn07XG5cblxuLyoqIEBvdmVycmlkZSAqL1xuZ29vZy5qc29uLk5hdGl2ZUpzb25Qcm9jZXNzb3IucHJvdG90eXBlLnBhcnNlID0gZnVuY3Rpb24ocykge1xuICAndXNlIHN0cmljdCc7XG4gIHJldHVybiBnb29nLmdsb2JhbFsnSlNPTiddLnBhcnNlKHMsIHRoaXMucmV2aXZlcl8pO1xufTtcbiIsICIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgVGhlIENsb3N1cmUgTGlicmFyeSBBdXRob3JzLlxuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIEBmaWxlb3ZlcnZpZXcgVXRpbGl0eSBmdW5jdGlvbnMgZm9yIG1hbmFnaW5nIG5ldHdvcmtpbmcsIHN1Y2ggYXNcbiAqIHRlc3RpbmcgbmV0d29yayBjb25uZWN0aXZpdHkuXG4gKlxuICovXG5cblxuZ29vZy5wcm92aWRlKCdnb29nLmxhYnMubmV0LndlYkNoYW5uZWwubmV0VXRpbHMnKTtcblxuZ29vZy5yZXF1aXJlKCdnb29nLlVyaScpO1xuZ29vZy5yZXF1aXJlKCdnb29nLmxhYnMubmV0LndlYkNoYW5uZWwuV2ViQ2hhbm5lbERlYnVnJyk7XG5cbmdvb2cuc2NvcGUoZnVuY3Rpb24oKSB7XG4ndXNlIHN0cmljdCc7XG5jb25zdCBuZXRVdGlscyA9IGdvb2cubGFicy5uZXQud2ViQ2hhbm5lbC5uZXRVdGlscztcbmNvbnN0IFdlYkNoYW5uZWxEZWJ1ZyA9IGdvb2cubGFicy5uZXQud2ViQ2hhbm5lbC5XZWJDaGFubmVsRGVidWc7XG5cblxuLyoqXG4gKiBEZWZhdWx0IHRpbWVvdXQgdG8gYWxsb3cgZm9yIFVSSSBwaW5ncy5cbiAqIEB0eXBlIHtudW1iZXJ9XG4gKi9cbm5ldFV0aWxzLk5FVFdPUktfVElNRU9VVCA9IDEwMDAwO1xuXG5cbi8qKlxuICogUGluZ3MgdGhlIG5ldHdvcmsgd2l0aCBhbiBpbWFnZSBVUkkgdG8gY2hlY2sgaWYgYW4gZXJyb3IgaXMgYSBzZXJ2ZXIgZXJyb3JcbiAqIG9yIHVzZXIncyBuZXR3b3JrIGVycm9yLlxuICpcbiAqIFRoZSBjYWxsZXIgbmVlZHMgdG8gYWRkIGEgJ3JhbmQnIHBhcmFtZXRlciB0byBtYWtlIHN1cmUgdGhlIHJlc3BvbnNlIGlzXG4gKiBub3QgZnVsZmlsbGVkIGJ5IGJyb3dzZXIgY2FjaGUuXG4gKlxuICogQHBhcmFtIHtmdW5jdGlvbihib29sZWFuKX0gY2FsbGJhY2sgVGhlIGZ1bmN0aW9uIHRvIGNhbGwgYmFjayB3aXRoIHJlc3VsdHMuXG4gKiBAcGFyYW0ge2dvb2cuVXJpPX0gb3B0X2ltYWdlVXJpIFRoZSBVUkkgKG9mIGFuIGltYWdlKSB0byB1c2UgZm9yIHRoZSBuZXR3b3JrXG4gKiAgICAgdGVzdC5cbiAqL1xubmV0VXRpbHMudGVzdE5ldHdvcmsgPSBmdW5jdGlvbihjYWxsYmFjaywgb3B0X2ltYWdlVXJpKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgbGV0IHVyaSA9IG9wdF9pbWFnZVVyaTtcbiAgaWYgKCF1cmkpIHtcbiAgICAvLyBkZWZhdWx0IGdvb2dsZS5jb20gaW1hZ2VcbiAgICB1cmkgPSBuZXcgZ29vZy5VcmkoJy8vd3d3Lmdvb2dsZS5jb20vaW1hZ2VzL2NsZWFyZG90LmdpZicpO1xuXG4gICAgaWYgKCEoZ29vZy5nbG9iYWwubG9jYXRpb24gJiYgZ29vZy5nbG9iYWwubG9jYXRpb24ucHJvdG9jb2wgPT0gJ2h0dHAnKSkge1xuICAgICAgdXJpLnNldFNjaGVtZSgnaHR0cHMnKTsgIC8vIGUuZy4gY2hyb21lLWV4dGVuc2lvblxuICAgIH1cbiAgICB1cmkubWFrZVVuaXF1ZSgpO1xuICB9XG5cbiAgbmV0VXRpbHMudGVzdExvYWRJbWFnZSh1cmkudG9TdHJpbmcoKSwgbmV0VXRpbHMuTkVUV09SS19USU1FT1VULCBjYWxsYmFjayk7XG59O1xuXG5cbi8qKlxuICogVGVzdCBsb2FkaW5nIHRoZSBnaXZlbiBpbWFnZSwgcmV0cnlpbmcgaWYgbmVjZXNzYXJ5LlxuICogQHBhcmFtIHtzdHJpbmd9IHVybCBVUkwgdG8gdGhlIGltYWdlLlxuICogQHBhcmFtIHtudW1iZXJ9IHRpbWVvdXQgTWlsbGlzZWNvbmRzIGJlZm9yZSBnaXZpbmcgdXAuXG4gKiBAcGFyYW0ge2Z1bmN0aW9uKGJvb2xlYW4pfSBjYWxsYmFjayBGdW5jdGlvbiB0byBjYWxsIHdpdGggcmVzdWx0cy5cbiAqIEBwYXJhbSB7bnVtYmVyfSByZXRyaWVzIFRoZSBudW1iZXIgb2YgdGltZXMgdG8gcmV0cnkuXG4gKiBAcGFyYW0geyFXZWJDaGFubmVsRGVidWd9IGNoYW5uZWxEZWJ1ZyBUaGUgZGVidWcgb2JqZWN0XG4gKiBAcGFyYW0ge251bWJlcj19IG9wdF9wYXVzZUJldHdlZW5SZXRyaWVzTVMgT3B0aW9uYWwgbnVtYmVyIG9mIG1pbGxpc2Vjb25kc1xuICogICAgIGJldHdlZW4gcmV0cmllcyAtIGRlZmF1bHRzIHRvIDAuXG4gKi9cbm5ldFV0aWxzLnRlc3RMb2FkSW1hZ2VXaXRoUmV0cmllcyA9IGZ1bmN0aW9uKFxuICAgIHVybCwgdGltZW91dCwgY2FsbGJhY2ssIHJldHJpZXMsIGNoYW5uZWxEZWJ1Zywgb3B0X3BhdXNlQmV0d2VlblJldHJpZXNNUykge1xuICAndXNlIHN0cmljdCc7XG4gIGNoYW5uZWxEZWJ1Zy5kZWJ1ZygnVGVzdExvYWRJbWFnZVdpdGhSZXRyaWVzOiAnICsgb3B0X3BhdXNlQmV0d2VlblJldHJpZXNNUyk7XG4gIGlmIChyZXRyaWVzID09IDApIHtcbiAgICAvLyBubyBtb3JlIHJldHJpZXMsIGdpdmUgdXBcbiAgICBjYWxsYmFjayhmYWxzZSk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgcGF1c2VCZXR3ZWVuUmV0cmllcyA9IG9wdF9wYXVzZUJldHdlZW5SZXRyaWVzTVMgfHwgMDtcbiAgcmV0cmllcy0tO1xuICBuZXRVdGlscy50ZXN0TG9hZEltYWdlKHVybCwgdGltZW91dCwgZnVuY3Rpb24oc3VjY2VlZGVkKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIGlmIChzdWNjZWVkZWQpIHtcbiAgICAgIGNhbGxiYWNrKHRydWUpO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyB0cnkgYWdhaW5cbiAgICAgIGdvb2cuZ2xvYmFsLnNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICd1c2Ugc3RyaWN0JztcbiAgICAgICAgbmV0VXRpbHMudGVzdExvYWRJbWFnZVdpdGhSZXRyaWVzKFxuICAgICAgICAgICAgdXJsLCB0aW1lb3V0LCBjYWxsYmFjaywgcmV0cmllcywgY2hhbm5lbERlYnVnLCBwYXVzZUJldHdlZW5SZXRyaWVzKTtcbiAgICAgIH0sIHBhdXNlQmV0d2VlblJldHJpZXMpO1xuICAgIH1cbiAgfSk7XG59O1xuXG5cbi8qKlxuICogVGVzdCBsb2FkaW5nIHRoZSBnaXZlbiBpbWFnZS5cbiAqIEBwYXJhbSB7c3RyaW5nfSB1cmwgVVJMIHRvIHRoZSBpbWFnZS5cbiAqIEBwYXJhbSB7bnVtYmVyfSB0aW1lb3V0IE1pbGxpc2Vjb25kcyBiZWZvcmUgZ2l2aW5nIHVwLlxuICogQHBhcmFtIHtmdW5jdGlvbihib29sZWFuKX0gY2FsbGJhY2sgRnVuY3Rpb24gdG8gY2FsbCB3aXRoIHJlc3VsdHMuXG4gKiBAc3VwcHJlc3Mge3N0cmljdE1pc3NpbmdQcm9wZXJ0aWVzfSBQYXJ0IG9mIHRoZSBnby9zdHJpY3Rfd2FybmluZ3NfbWlncmF0aW9uXG4gKi9cbm5ldFV0aWxzLnRlc3RMb2FkSW1hZ2UgPSBmdW5jdGlvbih1cmwsIHRpbWVvdXQsIGNhbGxiYWNrKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgY29uc3QgY2hhbm5lbERlYnVnID0gbmV3IFdlYkNoYW5uZWxEZWJ1ZygpO1xuICBjaGFubmVsRGVidWcuZGVidWcoJ1Rlc3RMb2FkSW1hZ2U6IGxvYWRpbmcgJyArIHVybCk7XG4gIGlmIChnb29nLmdsb2JhbC5JbWFnZSkge1xuICAgIGNvbnN0IGltZyA9IG5ldyBJbWFnZSgpO1xuICAgIGltZy5vbmxvYWQgPSBnb29nLnBhcnRpYWwoXG4gICAgICAgIG5ldFV0aWxzLmltYWdlQ2FsbGJhY2tfLCBjaGFubmVsRGVidWcsIGltZywgJ1Rlc3RMb2FkSW1hZ2U6IGxvYWRlZCcsXG4gICAgICAgIHRydWUsIGNhbGxiYWNrKTtcbiAgICBpbWcub25lcnJvciA9IGdvb2cucGFydGlhbChcbiAgICAgICAgbmV0VXRpbHMuaW1hZ2VDYWxsYmFja18sIGNoYW5uZWxEZWJ1ZywgaW1nLCAnVGVzdExvYWRJbWFnZTogZXJyb3InLFxuICAgICAgICBmYWxzZSwgY2FsbGJhY2spO1xuICAgIGltZy5vbmFib3J0ID0gZ29vZy5wYXJ0aWFsKFxuICAgICAgICBuZXRVdGlscy5pbWFnZUNhbGxiYWNrXywgY2hhbm5lbERlYnVnLCBpbWcsICdUZXN0TG9hZEltYWdlOiBhYm9ydCcsXG4gICAgICAgIGZhbHNlLCBjYWxsYmFjayk7XG4gICAgaW1nLm9udGltZW91dCA9IGdvb2cucGFydGlhbChcbiAgICAgICAgbmV0VXRpbHMuaW1hZ2VDYWxsYmFja18sIGNoYW5uZWxEZWJ1ZywgaW1nLCAnVGVzdExvYWRJbWFnZTogdGltZW91dCcsXG4gICAgICAgIGZhbHNlLCBjYWxsYmFjayk7XG5cbiAgICBnb29nLmdsb2JhbC5zZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgJ3VzZSBzdHJpY3QnO1xuICAgICAgaWYgKGltZy5vbnRpbWVvdXQpIHtcbiAgICAgICAgaW1nLm9udGltZW91dCgpO1xuICAgICAgfVxuICAgIH0sIHRpbWVvdXQpO1xuICAgIGltZy5zcmMgPSB1cmw7XG4gIH0gZWxzZSB7XG4gICAgLy8gbG9nIEVSUk9SX09USEVSIGZyb20gZW52aXJvbmVtZW50cyB3aGVyZSBJbWFnZSBpcyBub3Qgc3VwcG9ydGVkXG4gICAgY2FsbGJhY2soZmFsc2UpO1xuICB9XG59O1xuXG5cbi8qKlxuICogV3JhcCB0aGUgaW1hZ2UgY2FsbGJhY2sgd2l0aCBkZWJ1ZyBhbmQgY2xlYW51cCBsb2dpYy5cbiAqIEBwYXJhbSB7IVdlYkNoYW5uZWxEZWJ1Z30gY2hhbm5lbERlYnVnIFRoZSBXZWJDaGFubmVsRGVidWcgb2JqZWN0LlxuICogQHBhcmFtIHshSW1hZ2V9IGltZyBUaGUgaW1hZ2UgZWxlbWVudC5cbiAqIEBwYXJhbSB7c3RyaW5nfSBkZWJ1Z1RleHQgVGhlIGRlYnVnIHRleHQuXG4gKiBAcGFyYW0ge2Jvb2xlYW59IHJlc3VsdCBUaGUgcmVzdWx0IG9mIGltYWdlIGxvYWRpbmcuXG4gKiBAcGFyYW0ge2Z1bmN0aW9uKGJvb2xlYW4pfSBjYWxsYmFjayBUaGUgaW1hZ2UgY2FsbGJhY2suXG4gKiBAcHJpdmF0ZVxuICovXG5uZXRVdGlscy5pbWFnZUNhbGxiYWNrXyA9IGZ1bmN0aW9uKFxuICAgIGNoYW5uZWxEZWJ1ZywgaW1nLCBkZWJ1Z1RleHQsIHJlc3VsdCwgY2FsbGJhY2spIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICB0cnkge1xuICAgIGNoYW5uZWxEZWJ1Zy5kZWJ1ZyhkZWJ1Z1RleHQpO1xuICAgIG5ldFV0aWxzLmNsZWFySW1hZ2VDYWxsYmFja3NfKGltZyk7XG4gICAgY2FsbGJhY2socmVzdWx0KTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIGNoYW5uZWxEZWJ1Zy5kdW1wRXhjZXB0aW9uKGUpO1xuICB9XG59O1xuXG5cbi8qKlxuICogQ2xlYXJzIGhhbmRsZXJzIHRvIGF2b2lkIG1lbW9yeSBsZWFrcy5cbiAqIEBwYXJhbSB7SW1hZ2V9IGltZyBUaGUgaW1hZ2UgdG8gY2xlYXIgaGFuZGxlcnMgZnJvbS5cbiAqIEBwcml2YXRlXG4gKiBAc3VwcHJlc3Mge3N0cmljdE1pc3NpbmdQcm9wZXJ0aWVzfSBQYXJ0IG9mIHRoZSBnby9zdHJpY3Rfd2FybmluZ3NfbWlncmF0aW9uXG4gKi9cbm5ldFV0aWxzLmNsZWFySW1hZ2VDYWxsYmFja3NfID0gZnVuY3Rpb24oaW1nKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgaW1nLm9ubG9hZCA9IG51bGw7XG4gIGltZy5vbmVycm9yID0gbnVsbDtcbiAgaW1nLm9uYWJvcnQgPSBudWxsO1xuICBpbWcub250aW1lb3V0ID0gbnVsbDtcbn07XG59KTsgIC8vIGdvb2cuc2NvcGVcbiIsICIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgVGhlIENsb3N1cmUgTGlicmFyeSBBdXRob3JzLlxuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG5nb29nLnByb3ZpZGUoJ2dvb2cubmV0LkZldGNoWG1sSHR0cCcpO1xuZ29vZy5wcm92aWRlKCdnb29nLm5ldC5GZXRjaFhtbEh0dHBGYWN0b3J5Jyk7XG5cbmdvb2cucmVxdWlyZSgnZ29vZy5hc3NlcnRzJyk7XG5nb29nLnJlcXVpcmUoJ2dvb2cuZXZlbnRzLkV2ZW50VGFyZ2V0Jyk7XG5nb29nLnJlcXVpcmUoJ2dvb2cuZnVuY3Rpb25zJyk7XG5nb29nLnJlcXVpcmUoJ2dvb2cubG9nJyk7XG5nb29nLnJlcXVpcmUoJ2dvb2cubmV0Llhockxpa2UnKTtcbmdvb2cucmVxdWlyZSgnZ29vZy5uZXQuWG1sSHR0cEZhY3RvcnknKTtcblxuXG5cbi8qKlxuICogQHJlY29yZFxuICovXG5nb29nLm5ldC5GZXRjaFhtbEh0dHBGYWN0b3J5T3B0aW9ucyA9IGZ1bmN0aW9uKCkge1xuICAvKipcbiAgICogQHR5cGUgeyFXb3JrZXJHbG9iYWxTY29wZXx1bmRlZmluZWR9IFRoZSBTZXJ2aWNlIFdvcmtlciBnbG9iYWwgc2NvcGUuXG4gICAqL1xuICB0aGlzLndvcmtlcjtcblxuICAvKipcbiAgICogQHR5cGUge2Jvb2xlYW58dW5kZWZpbmVkfSBXaGV0aGVyIHRvIHN0b3JlIHRoZSBGZXRjaFhtbEh0dHAgcmVzcG9uc2UgYXMgYW5cbiAgICogYXJyYXkgb2YgVWludDhBcnJheXMuICBJZiB0aGlzIGlzIHRydWUgdGhlbiB0aGUgJ3Jlc3BvbnNlVHlwZScgYXR0cmlidXRlXG4gICAqIG11c3QgYmUgZW1wdHkuXG4gICAqL1xuICB0aGlzLnN0cmVhbUJpbmFyeUNodW5rcztcbn07XG5cblxuXG4vKipcbiAqIEZhY3RvcnkgZm9yIGNyZWF0aW5nIFhociBvYmplY3RzIHRoYXQgdXNlcyB0aGUgbmF0aXZlIGZldGNoKCkgbWV0aG9kLlxuICogaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL0ZldGNoX0FQSVxuICogQHBhcmFtIHshZ29vZy5uZXQuRmV0Y2hYbWxIdHRwRmFjdG9yeU9wdGlvbnN9IG9wdHNcbiAqIEBleHRlbmRzIHtnb29nLm5ldC5YbWxIdHRwRmFjdG9yeX1cbiAqIEBzdHJ1Y3RcbiAqIEBjb25zdHJ1Y3RvclxuICovXG5nb29nLm5ldC5GZXRjaFhtbEh0dHBGYWN0b3J5ID0gZnVuY3Rpb24ob3B0cykge1xuICAndXNlIHN0cmljdCc7XG4gIGdvb2cubmV0LkZldGNoWG1sSHR0cEZhY3RvcnkuYmFzZSh0aGlzLCAnY29uc3RydWN0b3InKTtcblxuICAvKiogQHByaXZhdGUgQGZpbmFsIHs/V29ya2VyR2xvYmFsU2NvcGV9ICovXG4gIHRoaXMud29ya2VyXyA9IG9wdHMud29ya2VyIHx8IG51bGw7XG5cbiAgLyoqIEBwcml2YXRlIEBmaW5hbCB7Ym9vbGVhbn0gKi9cbiAgdGhpcy5zdHJlYW1CaW5hcnlDaHVua3NfID0gb3B0cy5zdHJlYW1CaW5hcnlDaHVua3MgfHwgZmFsc2U7XG5cbiAgLyoqIEBwcml2YXRlIHshUmVxdWVzdENyZWRlbnRpYWxzfHVuZGVmaW5lZH0gKi9cbiAgdGhpcy5jcmVkZW50aWFsc01vZGVfID0gdW5kZWZpbmVkO1xuXG4gIC8qKiBAcHJpdmF0ZSB7IVJlcXVlc3RDYWNoZXx1bmRlZmluZWR9ICovXG4gIHRoaXMuY2FjaGVNb2RlXyA9IHVuZGVmaW5lZDtcbn07XG5nb29nLmluaGVyaXRzKGdvb2cubmV0LkZldGNoWG1sSHR0cEZhY3RvcnksIGdvb2cubmV0LlhtbEh0dHBGYWN0b3J5KTtcblxuXG4vKiogQG92ZXJyaWRlICovXG5nb29nLm5ldC5GZXRjaFhtbEh0dHBGYWN0b3J5LnByb3RvdHlwZS5jcmVhdGVJbnN0YW5jZSA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIGNvbnN0IGluc3RhbmNlID1cbiAgICAgIG5ldyBnb29nLm5ldC5GZXRjaFhtbEh0dHAodGhpcy53b3JrZXJfLCB0aGlzLnN0cmVhbUJpbmFyeUNodW5rc18pO1xuICBpZiAodGhpcy5jcmVkZW50aWFsc01vZGVfKSB7XG4gICAgaW5zdGFuY2Uuc2V0Q3JlZGVudGlhbHNNb2RlKHRoaXMuY3JlZGVudGlhbHNNb2RlXyk7XG4gIH1cbiAgaWYgKHRoaXMuY2FjaGVNb2RlXykge1xuICAgIGluc3RhbmNlLnNldENhY2hlTW9kZSh0aGlzLmNhY2hlTW9kZV8pO1xuICB9XG4gIHJldHVybiBpbnN0YW5jZTtcbn07XG5cblxuLyoqIEBvdmVycmlkZSAqL1xuZ29vZy5uZXQuRmV0Y2hYbWxIdHRwRmFjdG9yeS5wcm90b3R5cGUuaW50ZXJuYWxHZXRPcHRpb25zID1cbiAgICBnb29nLmZ1bmN0aW9ucy5jb25zdGFudCh7fSk7XG5cblxuLyoqXG4gKiBAcGFyYW0geyFSZXF1ZXN0Q3JlZGVudGlhbHN9IGNyZWRlbnRpYWxzTW9kZSBUaGUgY3JlZGVudGlhbHMgbW9kZSBvZiB0aGVcbiAqICAgICBTZXJ2aWNlIFdvcmtlciBmZXRjaC5cbiAqL1xuZ29vZy5uZXQuRmV0Y2hYbWxIdHRwRmFjdG9yeS5wcm90b3R5cGUuc2V0Q3JlZGVudGlhbHNNb2RlID0gZnVuY3Rpb24oXG4gICAgY3JlZGVudGlhbHNNb2RlKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgdGhpcy5jcmVkZW50aWFsc01vZGVfID0gY3JlZGVudGlhbHNNb2RlO1xufTtcblxuXG4vKipcbiAqIEBwYXJhbSB7IVJlcXVlc3RDYWNoZX0gY2FjaGVNb2RlIFRoZSBjYWNoZSBtb2RlIG9mIHRoZSBTZXJ2aWNlIFdvcmtlciBmZXRjaC5cbiAqL1xuZ29vZy5uZXQuRmV0Y2hYbWxIdHRwRmFjdG9yeS5wcm90b3R5cGUuc2V0Q2FjaGVNb2RlID0gZnVuY3Rpb24oY2FjaGVNb2RlKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgdGhpcy5jYWNoZU1vZGVfID0gY2FjaGVNb2RlO1xufTtcblxuXG5cbi8qKlxuICogRmV0Y2hYbWxIdHRwIG9iamVjdCBjb25zdHJ1Y3Rvci5cbiAqIEBwYXJhbSB7P1dvcmtlckdsb2JhbFNjb3BlfSB3b3JrZXJcbiAqIEBwYXJhbSB7Ym9vbGVhbn0gc3RyZWFtQmluYXJ5Q2h1bmtzXG4gKiBAZXh0ZW5kcyB7Z29vZy5ldmVudHMuRXZlbnRUYXJnZXR9XG4gKiBAaW1wbGVtZW50cyB7Z29vZy5uZXQuWGhyTGlrZX1cbiAqIEBjb25zdHJ1Y3RvclxuICogQHN0cnVjdFxuICovXG5nb29nLm5ldC5GZXRjaFhtbEh0dHAgPSBmdW5jdGlvbih3b3JrZXIsIHN0cmVhbUJpbmFyeUNodW5rcykge1xuICAndXNlIHN0cmljdCc7XG4gIGdvb2cubmV0LkZldGNoWG1sSHR0cC5iYXNlKHRoaXMsICdjb25zdHJ1Y3RvcicpO1xuXG4gIC8qKiBAcHJpdmF0ZSBAZmluYWwgez9Xb3JrZXJHbG9iYWxTY29wZX0gKi9cbiAgdGhpcy53b3JrZXJfID0gd29ya2VyO1xuXG4gIC8qKiBAcHJpdmF0ZSBAZmluYWwge2Jvb2xlYW59ICovXG4gIHRoaXMuc3RyZWFtQmluYXJ5Q2h1bmtzXyA9IHN0cmVhbUJpbmFyeUNodW5rcztcblxuICAvKiogQHByaXZhdGUge1JlcXVlc3RDcmVkZW50aWFsc3x1bmRlZmluZWR9ICovXG4gIHRoaXMuY3JlZGVudGlhbHNNb2RlXyA9IHVuZGVmaW5lZDtcblxuICAvKiogQHByaXZhdGUge1JlcXVlc3RDYWNoZXx1bmRlZmluZWR9ICovXG4gIHRoaXMuY2FjaGVNb2RlXyA9IHVuZGVmaW5lZDtcblxuICAvKipcbiAgICogUmVxdWVzdCBzdGF0ZS5cbiAgICogQHR5cGUge2dvb2cubmV0LkZldGNoWG1sSHR0cC5SZXF1ZXN0U3RhdGV9XG4gICAqL1xuICB0aGlzLnJlYWR5U3RhdGUgPSBnb29nLm5ldC5GZXRjaFhtbEh0dHAuUmVxdWVzdFN0YXRlLlVOU0VOVDtcblxuICAvKipcbiAgICogSFRUUCBzdGF0dXMuXG4gICAqIEB0eXBlIHtudW1iZXJ9XG4gICAqL1xuICB0aGlzLnN0YXR1cyA9IDA7XG5cbiAgLyoqXG4gICAqIEhUVFAgc3RhdHVzIHN0cmluZy5cbiAgICogQHR5cGUge3N0cmluZ31cbiAgICovXG4gIHRoaXMuc3RhdHVzVGV4dCA9ICcnO1xuXG4gIC8qKlxuICAgKiBDb250ZW50IG9mIHRoZSByZXNwb25zZS5cbiAgICogQHR5cGUge3N0cmluZ3whQXJyYXlCdWZmZXJ8IUFycmF5PCFVaW50OEFycmF5Pn1cbiAgICovXG4gIHRoaXMucmVzcG9uc2UgPSAnJztcblxuICAvKipcbiAgICogQ29udGVudCBvZiB0aGUgcmVzcG9uc2UuXG4gICAqIEB0eXBlIHtzdHJpbmd9XG4gICAqL1xuICB0aGlzLnJlc3BvbnNlVGV4dCA9ICcnO1xuXG4gIC8qKlxuICAgKiBUaGUgdHlwZSBvZiB0aGUgcmVzcG9uc2UuICBJZiB0aGlzIGlzIHNldCB0byAnYXJyYXlidWZmZXInIHRoZSByZXF1ZXN0IHdpbGxcbiAgICogYmUgZGlzY3JldGUsIHN0cmVhbWluZyBpcyBvbmx5IHN1cHBvcnRlZCBmb3IgdGV4dCBlbmNvZGVkIHJlcXVlc3RzLlxuICAgKiBAdHlwZSB7c3RyaW5nfVxuICAgKi9cbiAgdGhpcy5yZXNwb25zZVR5cGUgPSAnJztcblxuICAvKipcbiAgICogRG9jdW1lbnQgcmVzcG9uc2UgZW50aXR5IGJvZHkuXG4gICAqIE5PVEU6IFRoaXMgaXMgYWx3YXlzIG51bGwgYW5kIG5vdCBzdXBwb3J0ZWQgYnkgdGhpcyBjbGFzcy5cbiAgICogQGZpbmFsIHtudWxsfVxuICAgKi9cbiAgdGhpcy5yZXNwb25zZVhNTCA9IG51bGw7XG5cbiAgLyoqXG4gICAqIE1ldGhvZCB0byBjYWxsIHdoZW4gdGhlIHN0YXRlIGNoYW5nZXMuXG4gICAqIEB0eXBlIHs/ZnVuY3Rpb24oKX1cbiAgICovXG4gIHRoaXMub25yZWFkeXN0YXRlY2hhbmdlID0gbnVsbDtcblxuICAvKiogQHByaXZhdGUgeyFIZWFkZXJzfSAqL1xuICB0aGlzLnJlcXVlc3RIZWFkZXJzXyA9IG5ldyBIZWFkZXJzKCk7XG5cbiAgLyoqIEBwcml2YXRlIHs/SGVhZGVyc30gKi9cbiAgdGhpcy5yZXNwb25zZUhlYWRlcnNfID0gbnVsbDtcblxuICAvKipcbiAgICogUmVxdWVzdCBtZXRob2QgKEdFVCBvciBQT1NUKS5cbiAgICogQHByaXZhdGUge3N0cmluZ31cbiAgICovXG4gIHRoaXMubWV0aG9kXyA9ICdHRVQnO1xuXG4gIC8qKlxuICAgKiBSZXF1ZXN0IFVSTC5cbiAgICogQHByaXZhdGUge3N0cmluZ31cbiAgICovXG4gIHRoaXMudXJsXyA9ICcnO1xuXG4gIC8qKlxuICAgKiBXaGV0aGVyIHRoZSByZXF1ZXN0IGlzIGluIHByb2dyZXNzLlxuICAgKiBAcHJpdmF0ZSB7Ym9vbGVhbn1cbiAgICovXG4gIHRoaXMuaW5Qcm9ncmVzc18gPSBmYWxzZTtcblxuICAvKiogQHByaXZhdGUgQGZpbmFsIHs/Z29vZy5sb2cuTG9nZ2VyfSAqL1xuICB0aGlzLmxvZ2dlcl8gPSBnb29nLmxvZy5nZXRMb2dnZXIoJ2dvb2cubmV0LkZldGNoWG1sSHR0cCcpO1xuXG4gIC8qKiBAcHJpdmF0ZSB7P1Jlc3BvbnNlfSAqL1xuICB0aGlzLmZldGNoUmVzcG9uc2VfID0gbnVsbDtcblxuICAvKiogQHByaXZhdGUgeyFSZWFkYWJsZVN0cmVhbURlZmF1bHRSZWFkZXJ8bnVsbH0gKi9cbiAgdGhpcy5jdXJyZW50UmVhZGVyXyA9IG51bGw7XG5cbiAgLyoqIEBwcml2YXRlIHs/VGV4dERlY29kZXJ9ICovXG4gIHRoaXMudGV4dERlY29kZXJfID0gbnVsbDtcbn07XG5nb29nLmluaGVyaXRzKGdvb2cubmV0LkZldGNoWG1sSHR0cCwgZ29vZy5ldmVudHMuRXZlbnRUYXJnZXQpO1xuXG5cbi8qKlxuICogU3RhdGUgb2YgdGhlIHJlcXVlc3RzLlxuICogQGVudW0ge251bWJlcn1cbiAqL1xuZ29vZy5uZXQuRmV0Y2hYbWxIdHRwLlJlcXVlc3RTdGF0ZSA9IHtcbiAgVU5TRU5UOiAwLFxuICBPUEVORUQ6IDEsXG4gIEhFQURFUl9SRUNFSVZFRDogMixcbiAgTE9BRElORzogMyxcbiAgRE9ORTogNCxcbn07XG5cblxuLyoqIEBvdmVycmlkZSAqL1xuZ29vZy5uZXQuRmV0Y2hYbWxIdHRwLnByb3RvdHlwZS5vcGVuID0gZnVuY3Rpb24obWV0aG9kLCB1cmwsIG9wdF9hc3luYykge1xuICAndXNlIHN0cmljdCc7XG4gIGdvb2cuYXNzZXJ0cy5hc3NlcnQoISFvcHRfYXN5bmMsICdPbmx5IGFzeW5jIHJlcXVlc3RzIGFyZSBzdXBwb3J0ZWQuJyk7XG4gIGlmICh0aGlzLnJlYWR5U3RhdGUgIT0gZ29vZy5uZXQuRmV0Y2hYbWxIdHRwLlJlcXVlc3RTdGF0ZS5VTlNFTlQpIHtcbiAgICB0aGlzLmFib3J0KCk7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdFcnJvciByZW9wZW5pbmcgYSBjb25uZWN0aW9uJyk7XG4gIH1cblxuICB0aGlzLm1ldGhvZF8gPSBtZXRob2Q7XG4gIHRoaXMudXJsXyA9IHVybDtcblxuICB0aGlzLnJlYWR5U3RhdGUgPSBnb29nLm5ldC5GZXRjaFhtbEh0dHAuUmVxdWVzdFN0YXRlLk9QRU5FRDtcbiAgdGhpcy5kaXNwYXRjaENhbGxiYWNrXygpO1xufTtcblxuXG4vKiogQG92ZXJyaWRlICovXG5nb29nLm5ldC5GZXRjaFhtbEh0dHAucHJvdG90eXBlLnNlbmQgPSBmdW5jdGlvbihvcHRfZGF0YSkge1xuICAndXNlIHN0cmljdCc7XG4gIGlmICh0aGlzLnJlYWR5U3RhdGUgIT0gZ29vZy5uZXQuRmV0Y2hYbWxIdHRwLlJlcXVlc3RTdGF0ZS5PUEVORUQpIHtcbiAgICB0aGlzLmFib3J0KCk7XG4gICAgdGhyb3cgbmV3IEVycm9yKCduZWVkIHRvIGNhbGwgb3BlbigpIGZpcnN0LiAnKTtcbiAgfVxuXG4gIHRoaXMuaW5Qcm9ncmVzc18gPSB0cnVlO1xuICBjb25zdCByZXF1ZXN0SW5pdCA9IHtcbiAgICBoZWFkZXJzOiB0aGlzLnJlcXVlc3RIZWFkZXJzXyxcbiAgICBtZXRob2Q6IHRoaXMubWV0aG9kXyxcbiAgICBjcmVkZW50aWFsczogdGhpcy5jcmVkZW50aWFsc01vZGVfLFxuICAgIGNhY2hlOiB0aGlzLmNhY2hlTW9kZV8sXG4gIH07XG4gIGlmIChvcHRfZGF0YSkge1xuICAgIHJlcXVlc3RJbml0Wydib2R5J10gPSBvcHRfZGF0YTtcbiAgfVxuXG4gICh0aGlzLndvcmtlcl8gfHwgZ29vZy5nbG9iYWwpXG4gICAgICAuZmV0Y2gobmV3IFJlcXVlc3QodGhpcy51cmxfLCAvKiogQHR5cGUgeyFSZXF1ZXN0SW5pdH0gKi8gKHJlcXVlc3RJbml0KSkpXG4gICAgICAudGhlbihcbiAgICAgICAgICB0aGlzLmhhbmRsZVJlc3BvbnNlXy5iaW5kKHRoaXMpLCB0aGlzLmhhbmRsZVNlbmRGYWlsdXJlXy5iaW5kKHRoaXMpKTtcbn07XG5cblxuLyoqIEBvdmVycmlkZSAqL1xuZ29vZy5uZXQuRmV0Y2hYbWxIdHRwLnByb3RvdHlwZS5hYm9ydCA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIHRoaXMucmVzcG9uc2UgPSB0aGlzLnJlc3BvbnNlVGV4dCA9ICcnO1xuICB0aGlzLnJlcXVlc3RIZWFkZXJzXyA9IG5ldyBIZWFkZXJzKCk7XG4gIHRoaXMuc3RhdHVzID0gMDtcblxuICBpZiAoISF0aGlzLmN1cnJlbnRSZWFkZXJfKSB7XG4gICAgdGhpcy5jdXJyZW50UmVhZGVyXy5jYW5jZWwoJ1JlcXVlc3Qgd2FzIGFib3J0ZWQuJyk7XG4gIH1cblxuICBpZiAoKCh0aGlzLnJlYWR5U3RhdGUgPj0gZ29vZy5uZXQuRmV0Y2hYbWxIdHRwLlJlcXVlc3RTdGF0ZS5PUEVORUQpICYmXG4gICAgICAgdGhpcy5pblByb2dyZXNzXykgJiZcbiAgICAgICh0aGlzLnJlYWR5U3RhdGUgIT0gZ29vZy5uZXQuRmV0Y2hYbWxIdHRwLlJlcXVlc3RTdGF0ZS5ET05FKSkge1xuICAgIHRoaXMuaW5Qcm9ncmVzc18gPSBmYWxzZTtcbiAgICB0aGlzLnJlcXVlc3REb25lXygpO1xuICB9XG5cbiAgdGhpcy5yZWFkeVN0YXRlID0gZ29vZy5uZXQuRmV0Y2hYbWxIdHRwLlJlcXVlc3RTdGF0ZS5VTlNFTlQ7XG59O1xuXG5cbi8qKlxuICogSGFuZGxlcyB0aGUgZmV0Y2ggcmVzcG9uc2UuXG4gKiBAcGFyYW0geyFSZXNwb25zZX0gcmVzcG9uc2VcbiAqIEBwcml2YXRlXG4gKi9cbmdvb2cubmV0LkZldGNoWG1sSHR0cC5wcm90b3R5cGUuaGFuZGxlUmVzcG9uc2VfID0gZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBpZiAoIXRoaXMuaW5Qcm9ncmVzc18pIHtcbiAgICAvLyBUaGUgcmVxdWVzdCB3YXMgYWJvcnRlZCwgaWdub3JlLlxuICAgIHJldHVybjtcbiAgfVxuXG4gIHRoaXMuZmV0Y2hSZXNwb25zZV8gPSByZXNwb25zZTtcblxuICBpZiAoIXRoaXMucmVzcG9uc2VIZWFkZXJzXykge1xuICAgIHRoaXMuc3RhdHVzID0gdGhpcy5mZXRjaFJlc3BvbnNlXy5zdGF0dXM7XG4gICAgdGhpcy5zdGF0dXNUZXh0ID0gdGhpcy5mZXRjaFJlc3BvbnNlXy5zdGF0dXNUZXh0O1xuICAgIHRoaXMucmVzcG9uc2VIZWFkZXJzXyA9IHJlc3BvbnNlLmhlYWRlcnM7XG4gICAgdGhpcy5yZWFkeVN0YXRlID0gZ29vZy5uZXQuRmV0Y2hYbWxIdHRwLlJlcXVlc3RTdGF0ZS5IRUFERVJfUkVDRUlWRUQ7XG4gICAgdGhpcy5kaXNwYXRjaENhbGxiYWNrXygpO1xuICB9XG4gIC8vIEEgY2FsbGJhY2sgbWF5IGFib3J0IHRoZSByZXF1ZXN0LlxuICBpZiAoIXRoaXMuaW5Qcm9ncmVzc18pIHtcbiAgICAvLyBUaGUgcmVxdWVzdCB3YXMgYWJvcnRlZCwgaWdub3JlLlxuICAgIHJldHVybjtcbiAgfVxuXG4gIHRoaXMucmVhZHlTdGF0ZSA9IGdvb2cubmV0LkZldGNoWG1sSHR0cC5SZXF1ZXN0U3RhdGUuTE9BRElORztcbiAgdGhpcy5kaXNwYXRjaENhbGxiYWNrXygpO1xuICAvLyBBIGNhbGxiYWNrIG1heSBhYm9ydCB0aGUgcmVxdWVzdC5cbiAgaWYgKCF0aGlzLmluUHJvZ3Jlc3NfKSB7XG4gICAgLy8gVGhlIHJlcXVlc3Qgd2FzIGFib3J0ZWQsIGlnbm9yZS5cbiAgICByZXR1cm47XG4gIH1cblxuICBpZiAodGhpcy5yZXNwb25zZVR5cGUgPT09ICdhcnJheWJ1ZmZlcicpIHtcbiAgICByZXNwb25zZS5hcnJheUJ1ZmZlcigpLnRoZW4oXG4gICAgICAgIHRoaXMuaGFuZGxlUmVzcG9uc2VBcnJheUJ1ZmZlcl8uYmluZCh0aGlzKSxcbiAgICAgICAgdGhpcy5oYW5kbGVTZW5kRmFpbHVyZV8uYmluZCh0aGlzKSk7XG4gIH0gZWxzZSBpZiAoXG4gICAgICB0eXBlb2YgKGdvb2cuZ2xvYmFsLlJlYWRhYmxlU3RyZWFtKSAhPT0gJ3VuZGVmaW5lZCcgJiZcbiAgICAgICdib2R5JyBpbiByZXNwb25zZSkge1xuICAgIHRoaXMuY3VycmVudFJlYWRlcl8gPVxuICAgICAgICAvKiogQHR5cGUgeyFSZWFkYWJsZVN0cmVhbURlZmF1bHRSZWFkZXJ9ICovIChyZXNwb25zZS5ib2R5LmdldFJlYWRlcigpKTtcbiAgICBpZiAodGhpcy5zdHJlYW1CaW5hcnlDaHVua3NfKSB7XG4gICAgICBpZiAodGhpcy5yZXNwb25zZVR5cGUpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICAgJ3Jlc3BvbnNlVHlwZSBtdXN0IGJlIGVtcHR5IGZvciBcInN0cmVhbUJpbmFyeUNodW5rc1wiIG1vZGUgcmVzcG9uc2VzLicpO1xuICAgICAgfVxuICAgICAgdGhpcy5yZXNwb25zZSA9IFtdO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnJlc3BvbnNlID0gdGhpcy5yZXNwb25zZVRleHQgPSAnJztcbiAgICAgIHRoaXMudGV4dERlY29kZXJfID0gbmV3IFRleHREZWNvZGVyKCk7XG4gICAgfVxuICAgIHRoaXMucmVhZElucHV0RnJvbUZldGNoXygpO1xuICB9IGVsc2Uge1xuICAgIHJlc3BvbnNlLnRleHQoKS50aGVuKFxuICAgICAgICB0aGlzLmhhbmRsZVJlc3BvbnNlVGV4dF8uYmluZCh0aGlzKSxcbiAgICAgICAgdGhpcy5oYW5kbGVTZW5kRmFpbHVyZV8uYmluZCh0aGlzKSk7XG4gIH1cbn07XG5cblxuLyoqXG4gKiBSZWFkcyB0aGUgbmV4dCBjaHVuayBvZiBkYXRhIGZyb20gdGhlIGZldGNoIHJlc3BvbnNlLlxuICogQHByaXZhdGVcbiAqL1xuZ29vZy5uZXQuRmV0Y2hYbWxIdHRwLnByb3RvdHlwZS5yZWFkSW5wdXRGcm9tRmV0Y2hfID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgdGhpcy5jdXJyZW50UmVhZGVyXy5yZWFkKClcbiAgICAgIC50aGVuKHRoaXMuaGFuZGxlRGF0YUZyb21TdHJlYW1fLmJpbmQodGhpcykpXG4gICAgICAuY2F0Y2godGhpcy5oYW5kbGVTZW5kRmFpbHVyZV8uYmluZCh0aGlzKSk7XG59O1xuXG5cbi8qKlxuICogSGFuZGxlcyBhIGNodW5rIG9mIGRhdGEgZnJvbSB0aGUgZmV0Y2ggcmVzcG9uc2Ugc3RyZWFtIHJlYWRlci5cbiAqIEBwYXJhbSB7IUlJdGVyYWJsZVJlc3VsdH0gcmVzdWx0XG4gKiBAcHJpdmF0ZVxuICovXG5nb29nLm5ldC5GZXRjaFhtbEh0dHAucHJvdG90eXBlLmhhbmRsZURhdGFGcm9tU3RyZWFtXyA9IGZ1bmN0aW9uKHJlc3VsdCkge1xuICAndXNlIHN0cmljdCc7XG4gIGlmICghdGhpcy5pblByb2dyZXNzXykge1xuICAgIC8vIFRoZSByZXF1ZXN0IHdhcyBhYm9ydGVkLCBpZ25vcmUuXG4gICAgcmV0dXJuO1xuICB9XG5cbiAgaWYgKHRoaXMuc3RyZWFtQmluYXJ5Q2h1bmtzXyAmJiByZXN1bHQudmFsdWUpIHtcbiAgICB0aGlzLnJlc3BvbnNlLnB1c2goLyoqIEB0eXBlIHshVWludDhBcnJheX0gKi8gKHJlc3VsdC52YWx1ZSkpO1xuICB9IGVsc2UgaWYgKCF0aGlzLnN0cmVhbUJpbmFyeUNodW5rc18pIHtcbiAgICBjb25zdCBkYXRhUGFja2V0ID0gcmVzdWx0LnZhbHVlID9cbiAgICAgICAgLyoqIEB0eXBlIHshVWludDhBcnJheX0gKi8gKHJlc3VsdC52YWx1ZSkgOlxuICAgICAgICBuZXcgVWludDhBcnJheSgwKTtcbiAgICBjb25zdCBuZXdUZXh0ID1cbiAgICAgICAgdGhpcy50ZXh0RGVjb2Rlcl8uZGVjb2RlKGRhdGFQYWNrZXQsIHtzdHJlYW06ICFyZXN1bHQuZG9uZX0pO1xuICAgIGlmIChuZXdUZXh0KSB7XG4gICAgICB0aGlzLnJlc3BvbnNlVGV4dCArPSBuZXdUZXh0O1xuICAgICAgdGhpcy5yZXNwb25zZSA9IHRoaXMucmVzcG9uc2VUZXh0O1xuICAgIH1cbiAgfVxuICBpZiAocmVzdWx0LmRvbmUpIHtcbiAgICB0aGlzLnJlcXVlc3REb25lXygpO1xuICB9IGVsc2Uge1xuICAgIHRoaXMuZGlzcGF0Y2hDYWxsYmFja18oKTtcbiAgfVxuXG4gIGlmICh0aGlzLnJlYWR5U3RhdGUgPT0gZ29vZy5uZXQuRmV0Y2hYbWxIdHRwLlJlcXVlc3RTdGF0ZS5MT0FESU5HKSB7XG4gICAgdGhpcy5yZWFkSW5wdXRGcm9tRmV0Y2hfKCk7XG4gIH1cbn07XG5cbi8qKlxuICogSGFuZGxlcyB0aGUgcmVzcG9uc2UgdGV4dC5cbiAqIEBwYXJhbSB7c3RyaW5nfSByZXNwb25zZVRleHRcbiAqIEBwcml2YXRlXG4gKi9cbmdvb2cubmV0LkZldGNoWG1sSHR0cC5wcm90b3R5cGUuaGFuZGxlUmVzcG9uc2VUZXh0XyA9IGZ1bmN0aW9uKHJlc3BvbnNlVGV4dCkge1xuICAndXNlIHN0cmljdCc7XG4gIGlmICghdGhpcy5pblByb2dyZXNzXykge1xuICAgIC8vIFRoZSByZXF1ZXN0IHdhcyBhYm9ydGVkLCBpZ25vcmUuXG4gICAgcmV0dXJuO1xuICB9XG4gIHRoaXMucmVzcG9uc2UgPSB0aGlzLnJlc3BvbnNlVGV4dCA9IHJlc3BvbnNlVGV4dDtcbiAgdGhpcy5yZXF1ZXN0RG9uZV8oKTtcbn07XG5cblxuLyoqXG4gKiBIYW5kbGVzIHRoZSByZXNwb25zZSB0ZXh0LlxuICogQHBhcmFtIHshQXJyYXlCdWZmZXJ9IHJlc3BvbnNlQXJyYXlCdWZmZXJcbiAqIEBwcml2YXRlXG4gKi9cbmdvb2cubmV0LkZldGNoWG1sSHR0cC5wcm90b3R5cGUuaGFuZGxlUmVzcG9uc2VBcnJheUJ1ZmZlcl8gPSBmdW5jdGlvbihcbiAgICByZXNwb25zZUFycmF5QnVmZmVyKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgaWYgKCF0aGlzLmluUHJvZ3Jlc3NfKSB7XG4gICAgLy8gVGhlIHJlcXVlc3Qgd2FzIGFib3J0ZWQsIGlnbm9yZS5cbiAgICByZXR1cm47XG4gIH1cbiAgdGhpcy5yZXNwb25zZSA9IHJlc3BvbnNlQXJyYXlCdWZmZXI7XG4gIHRoaXMucmVxdWVzdERvbmVfKCk7XG59O1xuXG5cbi8qKlxuICogSGFuZGxlcyB0aGUgc2VuZCBmYWlsdXJlLlxuICogQHBhcmFtIHsqfSBlcnJvclxuICogQHByaXZhdGVcbiAqL1xuZ29vZy5uZXQuRmV0Y2hYbWxIdHRwLnByb3RvdHlwZS5oYW5kbGVTZW5kRmFpbHVyZV8gPSBmdW5jdGlvbihlcnJvcikge1xuICAndXNlIHN0cmljdCc7XG4gIGNvbnN0IGUgPSBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IgOiBFcnJvcihlcnJvcik7XG4gIGdvb2cubG9nLndhcm5pbmcodGhpcy5sb2dnZXJfLCAnRmFpbGVkIHRvIGZldGNoIHVybCAnICsgdGhpcy51cmxfLCBlKTtcbiAgaWYgKCF0aGlzLmluUHJvZ3Jlc3NfKSB7XG4gICAgLy8gVGhlIHJlcXVlc3Qgd2FzIGFib3J0ZWQsIGlnbm9yZS5cbiAgICByZXR1cm47XG4gIH1cbiAgdGhpcy5yZXF1ZXN0RG9uZV8oKTtcbn07XG5cblxuLyoqXG4gKiBTZXRzIHRoZSByZXF1ZXN0IHN0YXRlIHRvIERPTkUgYW5kIHBlcmZvcm1zIGNsZWFudXAuXG4gKiBAcHJpdmF0ZVxuICovXG5nb29nLm5ldC5GZXRjaFhtbEh0dHAucHJvdG90eXBlLnJlcXVlc3REb25lXyA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIHRoaXMucmVhZHlTdGF0ZSA9IGdvb2cubmV0LkZldGNoWG1sSHR0cC5SZXF1ZXN0U3RhdGUuRE9ORTtcblxuICB0aGlzLmZldGNoUmVzcG9uc2VfID0gbnVsbDtcbiAgdGhpcy5jdXJyZW50UmVhZGVyXyA9IG51bGw7XG4gIHRoaXMudGV4dERlY29kZXJfID0gbnVsbDtcblxuICB0aGlzLmRpc3BhdGNoQ2FsbGJhY2tfKCk7XG59O1xuXG5cbi8qKiBAb3ZlcnJpZGUgKi9cbmdvb2cubmV0LkZldGNoWG1sSHR0cC5wcm90b3R5cGUuc2V0UmVxdWVzdEhlYWRlciA9IGZ1bmN0aW9uKGhlYWRlciwgdmFsdWUpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICB0aGlzLnJlcXVlc3RIZWFkZXJzXy5hcHBlbmQoaGVhZGVyLCB2YWx1ZSk7XG59O1xuXG5cbi8qKiBAb3ZlcnJpZGUgKi9cbmdvb2cubmV0LkZldGNoWG1sSHR0cC5wcm90b3R5cGUuZ2V0UmVzcG9uc2VIZWFkZXIgPSBmdW5jdGlvbihoZWFkZXIpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICAvLyBUT0RPKHVzZXIpOiBUaGlzIG1ldGhvZCBzaG91bGQgcmV0dXJuIG51bGwgd2hlbiB0aGUgaGVhZGVycyBhcmUgbm90XG4gIC8vIHByZXNlbnQgb3IgdGhlIHNwZWNpZmllZCBoZWFkZXIgaXMgbWlzc2luZy4gVGhlIGV4dGVybnMgbmVlZCB0byBiZSBmaXhlZC5cbiAgaWYgKCF0aGlzLnJlc3BvbnNlSGVhZGVyc18pIHtcbiAgICBnb29nLmxvZy53YXJuaW5nKFxuICAgICAgICB0aGlzLmxvZ2dlcl8sXG4gICAgICAgICdBdHRlbXB0aW5nIHRvIGdldCByZXNwb25zZSBoZWFkZXIgYnV0IG5vIGhlYWRlcnMgaGF2ZSBiZWVuIHJlY2VpdmVkICcgK1xuICAgICAgICAgICAgJ2ZvciB1cmw6ICcgKyB0aGlzLnVybF8pO1xuICAgIHJldHVybiAnJztcbiAgfVxuICByZXR1cm4gdGhpcy5yZXNwb25zZUhlYWRlcnNfLmdldChoZWFkZXIudG9Mb3dlckNhc2UoKSkgfHwgJyc7XG59O1xuXG5cbi8qKiBAb3ZlcnJpZGUgKi9cbmdvb2cubmV0LkZldGNoWG1sSHR0cC5wcm90b3R5cGUuZ2V0QWxsUmVzcG9uc2VIZWFkZXJzID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgaWYgKCF0aGlzLnJlc3BvbnNlSGVhZGVyc18pIHtcbiAgICBnb29nLmxvZy53YXJuaW5nKFxuICAgICAgICB0aGlzLmxvZ2dlcl8sXG4gICAgICAgICdBdHRlbXB0aW5nIHRvIGdldCBhbGwgcmVzcG9uc2UgaGVhZGVycyBidXQgbm8gaGVhZGVycyBoYXZlIGJlZW4gJyArXG4gICAgICAgICAgICAncmVjZWl2ZWQgZm9yIHVybDogJyArIHRoaXMudXJsXyk7XG4gICAgcmV0dXJuICcnO1xuICB9XG4gIGNvbnN0IGxpbmVzID0gW107XG4gIGNvbnN0IGl0ZXIgPSB0aGlzLnJlc3BvbnNlSGVhZGVyc18uZW50cmllcygpO1xuICBsZXQgZW50cnkgPSBpdGVyLm5leHQoKTtcbiAgd2hpbGUgKCFlbnRyeS5kb25lKSB7XG4gICAgY29uc3QgcGFpciA9IGVudHJ5LnZhbHVlO1xuICAgIGxpbmVzLnB1c2gocGFpclswXSArICc6ICcgKyBwYWlyWzFdKTtcbiAgICBlbnRyeSA9IGl0ZXIubmV4dCgpO1xuICB9XG4gIHJldHVybiBsaW5lcy5qb2luKCdcXHJcXG4nKTtcbn07XG5cblxuLyoqXG4gKiBAcGFyYW0geyFSZXF1ZXN0Q3JlZGVudGlhbHN9IGNyZWRlbnRpYWxzTW9kZSBUaGUgY3JlZGVudGlhbHMgbW9kZSBvZiB0aGVcbiAqICAgICBTZXJ2aWNlIFdvcmtlciBmZXRjaC5cbiAqL1xuZ29vZy5uZXQuRmV0Y2hYbWxIdHRwLnByb3RvdHlwZS5zZXRDcmVkZW50aWFsc01vZGUgPSBmdW5jdGlvbihjcmVkZW50aWFsc01vZGUpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICB0aGlzLmNyZWRlbnRpYWxzTW9kZV8gPSBjcmVkZW50aWFsc01vZGU7XG59O1xuXG4vKipcbiAqIEByZXR1cm4geyFSZXF1ZXN0Q3JlZGVudGlhbHN8dW5kZWZpbmVkfSBUaGUgY3JlZGVudGlhbHMgbW9kZSBvZiB0aGVcbiAqICAgICBTZXJ2aWNlIFdvcmtlciBmZXRjaC5cbiAqL1xuZ29vZy5uZXQuRmV0Y2hYbWxIdHRwLnByb3RvdHlwZS5nZXRDcmVkZW50aWFsc01vZGUgPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gdGhpcy5jcmVkZW50aWFsc01vZGVfO1xufTtcblxuLyoqXG4gKiBAcGFyYW0geyFSZXF1ZXN0Q2FjaGV9IGNhY2hlTW9kZSBUaGUgY2FjaGUgbW9kZSBvZiB0aGUgU2VydmljZSBXb3JrZXIgZmV0Y2guXG4gKi9cbmdvb2cubmV0LkZldGNoWG1sSHR0cC5wcm90b3R5cGUuc2V0Q2FjaGVNb2RlID0gZnVuY3Rpb24oY2FjaGVNb2RlKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgdGhpcy5jYWNoZU1vZGVfID0gY2FjaGVNb2RlO1xufTtcblxuXG4vKipcbiAqIERpc3BhdGNoZXMgdGhlIGNhbGxiYWNrLCBpZiB0aGUgY2FsbGJhY2sgYXR0cmlidXRlIGlzIGRlZmluZWQuXG4gKiBAcHJpdmF0ZVxuICovXG5nb29nLm5ldC5GZXRjaFhtbEh0dHAucHJvdG90eXBlLmRpc3BhdGNoQ2FsbGJhY2tfID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgaWYgKHRoaXMub25yZWFkeXN0YXRlY2hhbmdlKSB7XG4gICAgdGhpcy5vbnJlYWR5c3RhdGVjaGFuZ2UuY2FsbCh0aGlzKTtcbiAgfVxufTtcblxuLy8gUG9seWZpbGwgWG1sSHR0cFJlcXVlc3QncyB3aXRoQ3JlZGVudGlhbHMgcHJvcGVydHkgZm9yIHNwZWNpZnlpbmcgd2hldGhlciB0b1xuLy8gaW5jbHVkZSBjcmVkZW50aWFscyBvbiBjcm9zcyBkb21haW4gcmVxdWVzdHMuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZ29vZy5uZXQuRmV0Y2hYbWxIdHRwLnByb3RvdHlwZSwgJ3dpdGhDcmVkZW50aWFscycsIHtcbiAgZ2V0OlxuICAgICAgLyoqXG4gICAgICAgKiBAdGhpcyB7Z29vZy5uZXQuRmV0Y2hYbWxIdHRwfVxuICAgICAgICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0byBpbmNsdWRlIGNyZWRlbnRpYWxzIGluIGNyb3NzIGRvbWFpblxuICAgICAgICogICAgIHJlcXVlc3RzLlxuICAgICAgICovXG4gICAgICBmdW5jdGlvbigpIHtcbiAgICAgICAgJ3VzZSBzdHJpY3QnO1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRDcmVkZW50aWFsc01vZGUoKSA9PT0gJ2luY2x1ZGUnO1xuICAgICAgfSxcblxuICBzZXQ6XG4gICAgICAvKipcbiAgICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gdmFsdWUgV2hldGhlciB0byBpbmNsdWRlIGNyZWRlbnRpYWxzIGluIGNyb3NzIGRvbWFpblxuICAgICAgICogICAgIHJlcXVlc3RzLlxuICAgICAgICogQHRoaXMge2dvb2cubmV0LkZldGNoWG1sSHR0cH1cbiAgICAgICAqKi9cbiAgICAgIGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICAgICd1c2Ugc3RyaWN0JztcbiAgICAgICAgdGhpcy5zZXRDcmVkZW50aWFsc01vZGUodmFsdWUgPyAnaW5jbHVkZScgOiAnc2FtZS1vcmlnaW4nKTtcbiAgICAgIH1cbn0pO1xuIiwgIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCBUaGUgQ2xvc3VyZSBMaWJyYXJ5IEF1dGhvcnMuXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogQGZpbGVvdmVydmlldyBVdGlsaXRpZXMgZm9yIGNyZWF0aW5nIGZ1bmN0aW9ucy4gTG9vc2VseSBpbnNwaXJlZCBieSB0aGVzZVxuICogamF2YSBjbGFzc2VzIGZyb20gdGhlIEd1YXZhIGxpYnJhcnk6XG4gKiBjb20uZ29vZ2xlLmNvbW1vbi5iYXNlLkZ1bmN0aW9uc1xuICogaHR0cHM6Ly9nb29nbGUuZ2l0aHViLmlvL2d1YXZhL3JlbGVhc2VzL3NuYXBzaG90LWpyZS9hcGkvZG9jcy9pbmRleC5odG1sP2NvbS9nb29nbGUvY29tbW9uL2Jhc2UvRnVuY3Rpb25zLmh0bWxcbiAqXG4gKiBjb20uZ29vZ2xlLmNvbW1vbi5iYXNlLlByZWRpY2F0ZXNcbiAqIGh0dHBzOi8vZ29vZ2xlLmdpdGh1Yi5pby9ndWF2YS9yZWxlYXNlcy9zbmFwc2hvdC1qcmUvYXBpL2RvY3MvaW5kZXguaHRtbD9jb20vZ29vZ2xlL2NvbW1vbi9iYXNlL1ByZWRpY2F0ZXMuaHRtbFxuICpcbiAqIE1vcmUgYWJvdXQgdGhlc2UgY2FuIGJlIGZvdW5kIGF0XG4gKiBodHRwczovL2dpdGh1Yi5jb20vZ29vZ2xlL2d1YXZhL3dpa2kvRnVuY3Rpb25hbEV4cGxhaW5lZFxuICovXG5cblxuZ29vZy5wcm92aWRlKCdnb29nLmZ1bmN0aW9ucycpO1xuXG5cbi8qKlxuICogQ3JlYXRlcyBhIGZ1bmN0aW9uIHRoYXQgYWx3YXlzIHJldHVybnMgdGhlIHNhbWUgdmFsdWUuXG4gKiBAcGFyYW0ge1R9IHJldFZhbHVlIFRoZSB2YWx1ZSB0byByZXR1cm4uXG4gKiBAcmV0dXJuIHtmdW5jdGlvbigpOlR9IFRoZSBuZXcgZnVuY3Rpb24uXG4gKiBAdGVtcGxhdGUgVFxuICovXG5nb29nLmZ1bmN0aW9ucy5jb25zdGFudCA9IGZ1bmN0aW9uKHJldFZhbHVlKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICByZXR1cm4gcmV0VmFsdWU7XG4gIH07XG59O1xuXG5cbi8qKlxuICogQWx3YXlzIHJldHVybnMgZmFsc2UuXG4gKiBAdHlwZSB7ZnVuY3Rpb24oLi4uKTogYm9vbGVhbn1cbiAqL1xuZ29vZy5mdW5jdGlvbnMuRkFMU0UgPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gZmFsc2U7XG59O1xuXG5cbi8qKlxuICogQWx3YXlzIHJldHVybnMgdHJ1ZS5cbiAqIEB0eXBlIHtmdW5jdGlvbiguLi4pOiBib29sZWFufVxuICovXG5nb29nLmZ1bmN0aW9ucy5UUlVFID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmV0dXJuIHRydWU7XG59O1xuXG5cbi8qKlxuICogQWx3YXlzIHJldHVybnMgYG51bGxgLlxuICogQHR5cGUge2Z1bmN0aW9uKC4uLik6IG51bGx9XG4gKi9cbmdvb2cuZnVuY3Rpb25zLk5VTEwgPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gbnVsbDtcbn07XG5cblxuLyoqXG4gKiBBbHdheXMgcmV0dXJucyBgdW5kZWZpbmVkYC5cbiAqIEB0eXBlIHtmdW5jdGlvbiguLi4pOiB1bmRlZmluZWR9XG4gKi9cbmdvb2cuZnVuY3Rpb25zLlVOREVGSU5FRCA9IGZ1bmN0aW9uKCkge1xuICByZXR1cm4gdW5kZWZpbmVkO1xufTtcblxuLyoqXG4gKiBBbHdheXMgcmV0dXJucyBgdW5kZWZpbmVkYCAobG9vc2VseS10eXBlZCB2ZXJzaW9uKS5cbiAqIEB0eXBlIHshRnVuY3Rpb259XG4gKi9cbmdvb2cuZnVuY3Rpb25zLkVNUFRZID0gLyoqIEB0eXBlIHs/fSAqLyAoZ29vZy5mdW5jdGlvbnMuVU5ERUZJTkVEKTtcblxuXG4vKipcbiAqIEEgc2ltcGxlIGZ1bmN0aW9uIHRoYXQgcmV0dXJucyB0aGUgZmlyc3QgYXJndW1lbnQgb2Ygd2hhdGV2ZXIgaXMgcGFzc2VkXG4gKiBpbnRvIGl0LlxuICogQHBhcmFtIHtUPX0gb3B0X3JldHVyblZhbHVlIFRoZSBzaW5nbGUgdmFsdWUgdGhhdCB3aWxsIGJlIHJldHVybmVkLlxuICogQHBhcmFtIHsuLi4qfSB2YXJfYXJncyBPcHRpb25hbCB0cmFpbGluZyBhcmd1bWVudHMuIFRoZXNlIGFyZSBpZ25vcmVkLlxuICogQHJldHVybiB7VH0gVGhlIGZpcnN0IGFyZ3VtZW50IHBhc3NlZCBpbiwgb3IgdW5kZWZpbmVkIGlmIG5vdGhpbmcgd2FzIHBhc3NlZC5cbiAqIEB0ZW1wbGF0ZSBUXG4gKi9cbmdvb2cuZnVuY3Rpb25zLmlkZW50aXR5ID0gZnVuY3Rpb24ob3B0X3JldHVyblZhbHVlLCB2YXJfYXJncykge1xuICAndXNlIHN0cmljdCc7XG4gIHJldHVybiBvcHRfcmV0dXJuVmFsdWU7XG59O1xuXG5cbi8qKlxuICogQ3JlYXRlcyBhIGZ1bmN0aW9uIHRoYXQgYWx3YXlzIHRocm93cyBhbiBlcnJvciB3aXRoIHRoZSBnaXZlbiBtZXNzYWdlLlxuICogQHBhcmFtIHtzdHJpbmd9IG1lc3NhZ2UgVGhlIGVycm9yIG1lc3NhZ2UuXG4gKiBAcmV0dXJuIHshRnVuY3Rpb259IFRoZSBlcnJvci10aHJvd2luZyBmdW5jdGlvbi5cbiAqL1xuZ29vZy5mdW5jdGlvbnMuZXJyb3IgPSBmdW5jdGlvbihtZXNzYWdlKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICB0aHJvdyBuZXcgRXJyb3IobWVzc2FnZSk7XG4gIH07XG59O1xuXG5cbi8qKlxuICogQ3JlYXRlcyBhIGZ1bmN0aW9uIHRoYXQgdGhyb3dzIHRoZSBnaXZlbiBvYmplY3QuXG4gKiBAcGFyYW0geyp9IGVyciBBbiBvYmplY3QgdG8gYmUgdGhyb3duLlxuICogQHJldHVybiB7IUZ1bmN0aW9ufSBUaGUgZXJyb3ItdGhyb3dpbmcgZnVuY3Rpb24uXG4gKi9cbmdvb2cuZnVuY3Rpb25zLmZhaWwgPSBmdW5jdGlvbihlcnIpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIHRocm93IGVycjtcbiAgfTtcbn07XG5cblxuLyoqXG4gKiBHaXZlbiBhIGZ1bmN0aW9uLCBjcmVhdGUgYSBmdW5jdGlvbiB0aGF0IGtlZXBzIG9wdF9udW1BcmdzIGFyZ3VtZW50cyBhbmRcbiAqIHNpbGVudGx5IGRpc2NhcmRzIGFsbCBhZGRpdGlvbmFsIGFyZ3VtZW50cy5cbiAqIEBwYXJhbSB7RnVuY3Rpb259IGYgVGhlIG9yaWdpbmFsIGZ1bmN0aW9uLlxuICogQHBhcmFtIHtudW1iZXI9fSBvcHRfbnVtQXJncyBUaGUgbnVtYmVyIG9mIGFyZ3VtZW50cyB0byBrZWVwLiBEZWZhdWx0cyB0byAwLlxuICogQHJldHVybiB7IUZ1bmN0aW9ufSBBIHZlcnNpb24gb2YgZiB0aGF0IG9ubHkga2VlcHMgdGhlIGZpcnN0IG9wdF9udW1BcmdzXG4gKiAgICAgYXJndW1lbnRzLlxuICovXG5nb29nLmZ1bmN0aW9ucy5sb2NrID0gZnVuY3Rpb24oZiwgb3B0X251bUFyZ3MpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBvcHRfbnVtQXJncyA9IG9wdF9udW1BcmdzIHx8IDA7XG4gIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgY29uc3Qgc2VsZiA9IC8qKiBAdHlwZSB7Kn0gKi8gKHRoaXMpO1xuICAgIHJldHVybiBmLmFwcGx5KHNlbGYsIEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMCwgb3B0X251bUFyZ3MpKTtcbiAgfTtcbn07XG5cblxuLyoqXG4gKiBDcmVhdGVzIGEgZnVuY3Rpb24gdGhhdCByZXR1cm5zIGl0cyBudGggYXJndW1lbnQuXG4gKiBAcGFyYW0ge251bWJlcn0gbiBUaGUgcG9zaXRpb24gb2YgdGhlIHJldHVybiBhcmd1bWVudC5cbiAqIEByZXR1cm4geyFGdW5jdGlvbn0gQSBuZXcgZnVuY3Rpb24uXG4gKi9cbmdvb2cuZnVuY3Rpb25zLm50aCA9IGZ1bmN0aW9uKG4pIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIHJldHVybiBhcmd1bWVudHNbbl07XG4gIH07XG59O1xuXG5cbi8qKlxuICogTGlrZSBnb29nLnBhcnRpYWwoKSwgZXhjZXB0IHRoYXQgYXJndW1lbnRzIGFyZSBhZGRlZCBhZnRlciBhcmd1bWVudHMgdG8gdGhlXG4gKiByZXR1cm5lZCBmdW5jdGlvbi5cbiAqXG4gKiBVc2FnZTpcbiAqIGZ1bmN0aW9uIGYoYXJnMSwgYXJnMiwgYXJnMywgYXJnNCkgeyAuLi4gfVxuICogdmFyIGcgPSBnb29nLmZ1bmN0aW9ucy5wYXJ0aWFsUmlnaHQoZiwgYXJnMywgYXJnNCk7XG4gKiBnKGFyZzEsIGFyZzIpO1xuICpcbiAqIEBwYXJhbSB7IUZ1bmN0aW9ufSBmbiBBIGZ1bmN0aW9uIHRvIHBhcnRpYWxseSBhcHBseS5cbiAqIEBwYXJhbSB7Li4uKn0gdmFyX2FyZ3MgQWRkaXRpb25hbCBhcmd1bWVudHMgdGhhdCBhcmUgcGFydGlhbGx5IGFwcGxpZWQgdG8gZm5cbiAqICAgICBhdCB0aGUgZW5kLlxuICogQHJldHVybiB7IUZ1bmN0aW9ufSBBIHBhcnRpYWxseS1hcHBsaWVkIGZvcm0gb2YgdGhlIGZ1bmN0aW9uIGdvb2cucGFydGlhbCgpXG4gKiAgICAgd2FzIGludm9rZWQgYXMgYSBtZXRob2Qgb2YuXG4gKi9cbmdvb2cuZnVuY3Rpb25zLnBhcnRpYWxSaWdodCA9IGZ1bmN0aW9uKGZuLCB2YXJfYXJncykge1xuICAndXNlIHN0cmljdCc7XG4gIGNvbnN0IHJpZ2h0QXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSk7XG4gIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgLy8gRXZlbiBpbiBzdHJpY3QgbW9kZSwgSUUxMC8xMSBhbmQgRWRnZSAobm9uLUNocm9taXVtKSB1c2UgZ2xvYmFsIGNvbnRleHRcbiAgICAvLyB3aGVuIGZyZWUtY2FsbGluZyBmdW5jdGlvbnMuIFRvIGNhdGNoIGNhc2VzIHdoZXJlIHBlb3BsZSB3ZXJlIHVzaW5nIHRoaXNcbiAgICAvLyBlcnJvbmVvdXNseSwgd2UgZXhwbGljaXRseSBjaGFuZ2UgdGhlIGNvbnRleHQgdG8gdW5kZWZpbmVkIHRvIG1hdGNoXG4gICAgLy8gc3RyaWN0IG1vZGUgc3BlY2lmaWNhdGlvbnMuXG4gICAgbGV0IHNlbGYgPSAvKiogQHR5cGUgeyp9ICovICh0aGlzKTtcbiAgICBpZiAoc2VsZiA9PT0gZ29vZy5nbG9iYWwpIHtcbiAgICAgIHNlbGYgPSB1bmRlZmluZWQ7XG4gICAgfVxuICAgIGNvbnN0IG5ld0FyZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMpO1xuICAgIG5ld0FyZ3MucHVzaC5hcHBseShuZXdBcmdzLCByaWdodEFyZ3MpO1xuICAgIHJldHVybiBmbi5hcHBseShzZWxmLCBuZXdBcmdzKTtcbiAgfTtcbn07XG5cblxuLyoqXG4gKiBHaXZlbiBhIGZ1bmN0aW9uLCBjcmVhdGUgYSBuZXcgZnVuY3Rpb24gdGhhdCBzd2FsbG93cyBpdHMgcmV0dXJuIHZhbHVlXG4gKiBhbmQgcmVwbGFjZXMgaXQgd2l0aCBhIG5ldyBvbmUuXG4gKiBAcGFyYW0ge0Z1bmN0aW9ufSBmIEEgZnVuY3Rpb24uXG4gKiBAcGFyYW0ge1R9IHJldFZhbHVlIEEgbmV3IHJldHVybiB2YWx1ZS5cbiAqIEByZXR1cm4ge2Z1bmN0aW9uKC4uLj8pOlR9IEEgbmV3IGZ1bmN0aW9uLlxuICogQHRlbXBsYXRlIFRcbiAqL1xuZ29vZy5mdW5jdGlvbnMud2l0aFJldHVyblZhbHVlID0gZnVuY3Rpb24oZiwgcmV0VmFsdWUpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gZ29vZy5mdW5jdGlvbnMuc2VxdWVuY2UoZiwgZ29vZy5mdW5jdGlvbnMuY29uc3RhbnQocmV0VmFsdWUpKTtcbn07XG5cblxuLyoqXG4gKiBDcmVhdGVzIGEgZnVuY3Rpb24gdGhhdCByZXR1cm5zIHdoZXRoZXIgaXRzIGFyZ3VtZW50IGVxdWFscyB0aGUgZ2l2ZW4gdmFsdWUuXG4gKlxuICogRXhhbXBsZTpcbiAqIHZhciBrZXkgPSBnb29nLm9iamVjdC5maW5kS2V5KG9iaiwgZ29vZy5mdW5jdGlvbnMuZXF1YWxUbygnbmVlZGxlJykpO1xuICpcbiAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNvbXBhcmUgdG8uXG4gKiBAcGFyYW0ge2Jvb2xlYW49fSBvcHRfdXNlTG9vc2VDb21wYXJpc29uIFdoZXRoZXIgdG8gdXNlIGEgbG9vc2UgKD09KVxuICogICAgIGNvbXBhcmlzb24gcmF0aGVyIHRoYW4gYSBzdHJpY3QgKD09PSkgb25lLiBEZWZhdWx0cyB0byBmYWxzZS5cbiAqIEByZXR1cm4ge2Z1bmN0aW9uKCopOmJvb2xlYW59IFRoZSBuZXcgZnVuY3Rpb24uXG4gKi9cbmdvb2cuZnVuY3Rpb25zLmVxdWFsVG8gPSBmdW5jdGlvbih2YWx1ZSwgb3B0X3VzZUxvb3NlQ29tcGFyaXNvbikge1xuICAndXNlIHN0cmljdCc7XG4gIHJldHVybiBmdW5jdGlvbihvdGhlcikge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICByZXR1cm4gb3B0X3VzZUxvb3NlQ29tcGFyaXNvbiA/ICh2YWx1ZSA9PSBvdGhlcikgOiAodmFsdWUgPT09IG90aGVyKTtcbiAgfTtcbn07XG5cblxuLyoqXG4gKiBDcmVhdGVzIHRoZSBjb21wb3NpdGlvbiBvZiB0aGUgZnVuY3Rpb25zIHBhc3NlZCBpbi5cbiAqIEZvciBleGFtcGxlLCAoZ29vZy5mdW5jdGlvbnMuY29tcG9zZShmLCBnKSkoYSkgaXMgZXF1aXZhbGVudCB0byBmKGcoYSkpLlxuICogQHBhcmFtIHtmdW5jdGlvbiguLi4/KTpUfSBmbiBUaGUgZmluYWwgZnVuY3Rpb24uXG4gKiBAcGFyYW0gey4uLkZ1bmN0aW9ufSB2YXJfYXJncyBBIGxpc3Qgb2YgZnVuY3Rpb25zLlxuICogQHJldHVybiB7ZnVuY3Rpb24oLi4uPyk6VH0gVGhlIGNvbXBvc2l0aW9uIG9mIGFsbCBpbnB1dHMuXG4gKiBAdGVtcGxhdGUgVFxuICovXG5nb29nLmZ1bmN0aW9ucy5jb21wb3NlID0gZnVuY3Rpb24oZm4sIHZhcl9hcmdzKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgY29uc3QgZnVuY3Rpb25zID0gYXJndW1lbnRzO1xuICBjb25zdCBsZW5ndGggPSBmdW5jdGlvbnMubGVuZ3RoO1xuICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIGNvbnN0IHNlbGYgPSAvKiogQHR5cGUgeyp9ICovICh0aGlzKTtcbiAgICBsZXQgcmVzdWx0O1xuICAgIGlmIChsZW5ndGgpIHtcbiAgICAgIHJlc3VsdCA9IGZ1bmN0aW9uc1tsZW5ndGggLSAxXS5hcHBseShzZWxmLCBhcmd1bWVudHMpO1xuICAgIH1cblxuICAgIGZvciAobGV0IGkgPSBsZW5ndGggLSAyOyBpID49IDA7IGktLSkge1xuICAgICAgcmVzdWx0ID0gZnVuY3Rpb25zW2ldLmNhbGwoc2VsZiwgcmVzdWx0KTtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfTtcbn07XG5cblxuLyoqXG4gKiBDcmVhdGVzIGEgZnVuY3Rpb24gdGhhdCBjYWxscyB0aGUgZnVuY3Rpb25zIHBhc3NlZCBpbiBpbiBzZXF1ZW5jZSwgYW5kXG4gKiByZXR1cm5zIHRoZSB2YWx1ZSBvZiB0aGUgbGFzdCBmdW5jdGlvbi4gRm9yIGV4YW1wbGUsXG4gKiAoZ29vZy5mdW5jdGlvbnMuc2VxdWVuY2UoZiwgZykpKHgpIGlzIGVxdWl2YWxlbnQgdG8gZih4KSxnKHgpLlxuICogQHBhcmFtIHsuLi5GdW5jdGlvbn0gdmFyX2FyZ3MgQSBsaXN0IG9mIGZ1bmN0aW9ucy5cbiAqIEByZXR1cm4geyFGdW5jdGlvbn0gQSBmdW5jdGlvbiB0aGF0IGNhbGxzIGFsbCBpbnB1dHMgaW4gc2VxdWVuY2UuXG4gKi9cbmdvb2cuZnVuY3Rpb25zLnNlcXVlbmNlID0gZnVuY3Rpb24odmFyX2FyZ3MpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBjb25zdCBmdW5jdGlvbnMgPSBhcmd1bWVudHM7XG4gIGNvbnN0IGxlbmd0aCA9IGZ1bmN0aW9ucy5sZW5ndGg7XG4gIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgY29uc3Qgc2VsZiA9IC8qKiBAdHlwZSB7Kn0gKi8gKHRoaXMpO1xuICAgIGxldCByZXN1bHQ7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgcmVzdWx0ID0gZnVuY3Rpb25zW2ldLmFwcGx5KHNlbGYsIGFyZ3VtZW50cyk7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG4gIH07XG59O1xuXG5cbi8qKlxuICogQ3JlYXRlcyBhIGZ1bmN0aW9uIHRoYXQgcmV0dXJucyB0cnVlIGlmIGVhY2ggb2YgaXRzIGNvbXBvbmVudHMgZXZhbHVhdGVzXG4gKiB0byB0cnVlLiBUaGUgY29tcG9uZW50cyBhcmUgZXZhbHVhdGVkIGluIG9yZGVyLCBhbmQgdGhlIGV2YWx1YXRpb24gd2lsbCBiZVxuICogc2hvcnQtY2lyY3VpdGVkIGFzIHNvb24gYXMgYSBmdW5jdGlvbiByZXR1cm5zIGZhbHNlLlxuICogRm9yIGV4YW1wbGUsIChnb29nLmZ1bmN0aW9ucy5hbmQoZiwgZykpKHgpIGlzIGVxdWl2YWxlbnQgdG8gZih4KSAmJiBnKHgpLlxuICogQHBhcmFtIHsuLi5GdW5jdGlvbn0gdmFyX2FyZ3MgQSBsaXN0IG9mIGZ1bmN0aW9ucy5cbiAqIEByZXR1cm4ge2Z1bmN0aW9uKC4uLj8pOmJvb2xlYW59IEEgZnVuY3Rpb24gdGhhdCBBTkRzIGl0cyBjb21wb25lbnRcbiAqICAgICAgZnVuY3Rpb25zLlxuICovXG5nb29nLmZ1bmN0aW9ucy5hbmQgPSBmdW5jdGlvbih2YXJfYXJncykge1xuICAndXNlIHN0cmljdCc7XG4gIGNvbnN0IGZ1bmN0aW9ucyA9IGFyZ3VtZW50cztcbiAgY29uc3QgbGVuZ3RoID0gZnVuY3Rpb25zLmxlbmd0aDtcbiAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICBjb25zdCBzZWxmID0gLyoqIEB0eXBlIHsqfSAqLyAodGhpcyk7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgaWYgKCFmdW5jdGlvbnNbaV0uYXBwbHkoc2VsZiwgYXJndW1lbnRzKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xuICB9O1xufTtcblxuXG4vKipcbiAqIENyZWF0ZXMgYSBmdW5jdGlvbiB0aGF0IHJldHVybnMgdHJ1ZSBpZiBhbnkgb2YgaXRzIGNvbXBvbmVudHMgZXZhbHVhdGVzXG4gKiB0byB0cnVlLiBUaGUgY29tcG9uZW50cyBhcmUgZXZhbHVhdGVkIGluIG9yZGVyLCBhbmQgdGhlIGV2YWx1YXRpb24gd2lsbCBiZVxuICogc2hvcnQtY2lyY3VpdGVkIGFzIHNvb24gYXMgYSBmdW5jdGlvbiByZXR1cm5zIHRydWUuXG4gKiBGb3IgZXhhbXBsZSwgKGdvb2cuZnVuY3Rpb25zLm9yKGYsIGcpKSh4KSBpcyBlcXVpdmFsZW50IHRvIGYoeCkgfHwgZyh4KS5cbiAqIEBwYXJhbSB7Li4uRnVuY3Rpb259IHZhcl9hcmdzIEEgbGlzdCBvZiBmdW5jdGlvbnMuXG4gKiBAcmV0dXJuIHtmdW5jdGlvbiguLi4/KTpib29sZWFufSBBIGZ1bmN0aW9uIHRoYXQgT1JzIGl0cyBjb21wb25lbnRcbiAqICAgIGZ1bmN0aW9ucy5cbiAqL1xuZ29vZy5mdW5jdGlvbnMub3IgPSBmdW5jdGlvbih2YXJfYXJncykge1xuICAndXNlIHN0cmljdCc7XG4gIGNvbnN0IGZ1bmN0aW9ucyA9IGFyZ3VtZW50cztcbiAgY29uc3QgbGVuZ3RoID0gZnVuY3Rpb25zLmxlbmd0aDtcbiAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICBjb25zdCBzZWxmID0gLyoqIEB0eXBlIHsqfSAqLyAodGhpcyk7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgaWYgKGZ1bmN0aW9uc1tpXS5hcHBseShzZWxmLCBhcmd1bWVudHMpKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH07XG59O1xuXG5cbi8qKlxuICogQ3JlYXRlcyBhIGZ1bmN0aW9uIHRoYXQgcmV0dXJucyB0aGUgQm9vbGVhbiBvcHBvc2l0ZSBvZiBhIHByb3ZpZGVkIGZ1bmN0aW9uLlxuICogRm9yIGV4YW1wbGUsIChnb29nLmZ1bmN0aW9ucy5ub3QoZikpKHgpIGlzIGVxdWl2YWxlbnQgdG8gIWYoeCkuXG4gKiBAcGFyYW0geyFGdW5jdGlvbn0gZiBUaGUgb3JpZ2luYWwgZnVuY3Rpb24uXG4gKiBAcmV0dXJuIHtmdW5jdGlvbiguLi4/KTpib29sZWFufSBBIGZ1bmN0aW9uIHRoYXQgZGVsZWdhdGVzIHRvIGYgYW5kIHJldHVybnNcbiAqIG9wcG9zaXRlLlxuICovXG5nb29nLmZ1bmN0aW9ucy5ub3QgPSBmdW5jdGlvbihmKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICBjb25zdCBzZWxmID0gLyoqIEB0eXBlIHsqfSAqLyAodGhpcyk7XG4gICAgcmV0dXJuICFmLmFwcGx5KHNlbGYsIGFyZ3VtZW50cyk7XG4gIH07XG59O1xuXG5cbi8qKlxuICogR2VuZXJpYyBmYWN0b3J5IGZ1bmN0aW9uIHRvIGNvbnN0cnVjdCBhbiBvYmplY3QgZ2l2ZW4gdGhlIGNvbnN0cnVjdG9yXG4gKiBhbmQgdGhlIGFyZ3VtZW50cy4gSW50ZW5kZWQgdG8gYmUgYm91bmQgdG8gY3JlYXRlIG9iamVjdCBmYWN0b3JpZXMuXG4gKlxuICogRXhhbXBsZTpcbiAqXG4gKiB2YXIgZmFjdG9yeSA9IGdvb2cucGFydGlhbChnb29nLmZ1bmN0aW9ucy5jcmVhdGUsIENsYXNzKTtcbiAqXG4gKiBAcGFyYW0ge2Z1bmN0aW9uKG5ldzpULCAuLi4pfSBjb25zdHJ1Y3RvciBUaGUgY29uc3RydWN0b3IgZm9yIHRoZSBPYmplY3QuXG4gKiBAcGFyYW0gey4uLip9IHZhcl9hcmdzIFRoZSBhcmd1bWVudHMgdG8gYmUgcGFzc2VkIHRvIHRoZSBjb25zdHJ1Y3Rvci5cbiAqIEByZXR1cm4ge1R9IEEgbmV3IGluc3RhbmNlIG9mIHRoZSBjbGFzcyBnaXZlbiBpbiBgY29uc3RydWN0b3JgLlxuICogQHRlbXBsYXRlIFRcbiAqIEBkZXByZWNhdGVkIFRoaXMgZnVuY3Rpb24gZG9lcyBub3Qgd29yayB3aXRoIEVTNiBjbGFzcyBjb25zdHJ1Y3RvcnMuIFVzZVxuICogICAgIGFycm93IGZ1bmN0aW9ucyArIHNwcmVhZCBhcmdzIGluc3RlYWQuXG4gKi9cbmdvb2cuZnVuY3Rpb25zLmNyZWF0ZSA9IGZ1bmN0aW9uKGNvbnN0cnVjdG9yLCB2YXJfYXJncykge1xuICAndXNlIHN0cmljdCc7XG4gIC8qKlxuICAgKiBAY29uc3RydWN0b3JcbiAgICogQGZpbmFsXG4gICAqL1xuICBjb25zdCB0ZW1wID0gZnVuY3Rpb24oKSB7fTtcbiAgdGVtcC5wcm90b3R5cGUgPSBjb25zdHJ1Y3Rvci5wcm90b3R5cGU7XG5cbiAgLy8gb2JqIHdpbGwgaGF2ZSBjb25zdHJ1Y3RvcidzIHByb3RvdHlwZSBpbiBpdHMgY2hhaW4gYW5kXG4gIC8vICdvYmogaW5zdGFuY2VvZiBjb25zdHJ1Y3Rvcicgd2lsbCBiZSB0cnVlLlxuICBjb25zdCBvYmogPSBuZXcgdGVtcCgpO1xuXG4gIC8vIG9iaiBpcyBpbml0aWFsaXplZCBieSBjb25zdHJ1Y3Rvci5cbiAgLy8gYXJndW1lbnRzIGlzIG9ubHkgYXJyYXktbGlrZSBzbyBsYWNrcyBzaGlmdCgpLCBidXQgY2FuIGJlIHVzZWQgd2l0aFxuICAvLyB0aGUgQXJyYXkgcHJvdG90eXBlIGZ1bmN0aW9uLlxuICBjb25zdHJ1Y3Rvci5hcHBseShvYmosIEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSkpO1xuICByZXR1cm4gb2JqO1xufTtcblxuXG4vKipcbiAqIEBkZWZpbmUge2Jvb2xlYW59IFdoZXRoZXIgdGhlIHJldHVybiB2YWx1ZSBjYWNoZSBzaG91bGQgYmUgdXNlZC5cbiAqICAgIFRoaXMgc2hvdWxkIG9ubHkgYmUgdXNlZCB0byBkaXNhYmxlIGNhY2hlcyB3aGVuIHRlc3RpbmcuXG4gKi9cbmdvb2cuZnVuY3Rpb25zLkNBQ0hFX1JFVFVSTl9WQUxVRSA9XG4gICAgZ29vZy5kZWZpbmUoJ2dvb2cuZnVuY3Rpb25zLkNBQ0hFX1JFVFVSTl9WQUxVRScsIHRydWUpO1xuXG5cbi8qKlxuICogR2l2ZXMgYSB3cmFwcGVyIGZ1bmN0aW9uIHRoYXQgY2FjaGVzIHRoZSByZXR1cm4gdmFsdWUgb2YgYSBwYXJhbWV0ZXJsZXNzXG4gKiBmdW5jdGlvbiB3aGVuIGZpcnN0IGNhbGxlZC5cbiAqXG4gKiBXaGVuIGNhbGxlZCBmb3IgdGhlIGZpcnN0IHRpbWUsIHRoZSBnaXZlbiBmdW5jdGlvbiBpcyBjYWxsZWQgYW5kIGl0c1xuICogcmV0dXJuIHZhbHVlIGlzIGNhY2hlZCAodGh1cyB0aGlzIGlzIG9ubHkgYXBwcm9wcmlhdGUgZm9yIGlkZW1wb3RlbnRcbiAqIGZ1bmN0aW9ucykuICBTdWJzZXF1ZW50IGNhbGxzIHdpbGwgcmV0dXJuIHRoZSBjYWNoZWQgcmV0dXJuIHZhbHVlLiBUaGlzXG4gKiBhbGxvd3MgdGhlIGV2YWx1YXRpb24gb2YgZXhwZW5zaXZlIGZ1bmN0aW9ucyB0byBiZSBkZWxheWVkIHVudGlsIGZpcnN0IHVzZWQuXG4gKlxuICogVG8gY2FjaGUgdGhlIHJldHVybiB2YWx1ZXMgb2YgZnVuY3Rpb25zIHdpdGggcGFyYW1ldGVycywgc2VlIGdvb2cubWVtb2l6ZS5cbiAqXG4gKiBAcGFyYW0ge2Z1bmN0aW9uKCk6VH0gZm4gQSBmdW5jdGlvbiB0byBsYXppbHkgZXZhbHVhdGUuXG4gKiBAcmV0dXJuIHtmdW5jdGlvbigpOlR9IEEgd3JhcHBlZCB2ZXJzaW9uIHRoZSBmdW5jdGlvbi5cbiAqIEB0ZW1wbGF0ZSBUXG4gKi9cbmdvb2cuZnVuY3Rpb25zLmNhY2hlUmV0dXJuVmFsdWUgPSBmdW5jdGlvbihmbikge1xuICAndXNlIHN0cmljdCc7XG4gIGxldCBjYWxsZWQgPSBmYWxzZTtcbiAgbGV0IHZhbHVlO1xuXG4gIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgaWYgKCFnb29nLmZ1bmN0aW9ucy5DQUNIRV9SRVRVUk5fVkFMVUUpIHtcbiAgICAgIHJldHVybiBmbigpO1xuICAgIH1cblxuICAgIGlmICghY2FsbGVkKSB7XG4gICAgICB2YWx1ZSA9IGZuKCk7XG4gICAgICBjYWxsZWQgPSB0cnVlO1xuICAgIH1cblxuICAgIHJldHVybiB2YWx1ZTtcbiAgfTtcbn07XG5cblxuLyoqXG4gKiBXcmFwcyBhIGZ1bmN0aW9uIHRvIGFsbG93IGl0IHRvIGJlIGNhbGxlZCwgYXQgbW9zdCwgb25jZS4gQWxsXG4gKiBhZGRpdGlvbmFsIGNhbGxzIGFyZSBuby1vcHMuXG4gKlxuICogVGhpcyBpcyBwYXJ0aWN1bGFybHkgdXNlZnVsIGZvciBpbml0aWFsaXphdGlvbiBmdW5jdGlvbnNcbiAqIHRoYXQgc2hvdWxkIGJlIGNhbGxlZCwgYXQgbW9zdCwgb25jZS5cbiAqXG4gKiBAcGFyYW0ge2Z1bmN0aW9uKCk6Kn0gZiBGdW5jdGlvbiB0byBjYWxsLlxuICogQHJldHVybiB7ZnVuY3Rpb24oKTp1bmRlZmluZWR9IFdyYXBwZWQgZnVuY3Rpb24uXG4gKi9cbmdvb2cuZnVuY3Rpb25zLm9uY2UgPSBmdW5jdGlvbihmKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgLy8gS2VlcCBhIHJlZmVyZW5jZSB0byB0aGUgZnVuY3Rpb24gdGhhdCB3ZSBudWxsIG91dCB3aGVuIHdlJ3JlIGRvbmUgd2l0aFxuICAvLyBpdCAtLSB0aGF0IHdheSwgdGhlIGZ1bmN0aW9uIGNhbiBiZSBHQydkIHdoZW4gd2UncmUgZG9uZSB3aXRoIGl0LlxuICBsZXQgaW5uZXIgPSBmO1xuICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIGlmIChpbm5lcikge1xuICAgICAgY29uc3QgdG1wID0gaW5uZXI7XG4gICAgICBpbm5lciA9IG51bGw7XG4gICAgICB0bXAoKTtcbiAgICB9XG4gIH07XG59O1xuXG5cbi8qKlxuICogV3JhcHMgYSBmdW5jdGlvbiB0byBhbGxvdyBpdCB0byBiZSBjYWxsZWQsIGF0IG1vc3QsIG9uY2UgcGVyIGludGVydmFsXG4gKiAoc3BlY2lmaWVkIGluIG1pbGxpc2Vjb25kcykuIElmIHRoZSB3cmFwcGVyIGZ1bmN0aW9uIGlzIGNhbGxlZCBOIHRpbWVzIHdpdGhpblxuICogdGhhdCBpbnRlcnZhbCwgb25seSB0aGUgTnRoIGNhbGwgd2lsbCBnbyB0aHJvdWdoLlxuICpcbiAqIFRoaXMgaXMgcGFydGljdWxhcmx5IHVzZWZ1bCBmb3IgYmF0Y2hpbmcgdXAgcmVwZWF0ZWQgYWN0aW9ucyB3aGVyZSB0aGVcbiAqIGxhc3QgYWN0aW9uIHNob3VsZCB3aW4uIFRoaXMgY2FuIGJlIHVzZWQsIGZvciBleGFtcGxlLCBmb3IgcmVmcmVzaGluZyBhblxuICogYXV0b2NvbXBsZXRlIHBvcC11cCBldmVyeSBzbyBvZnRlbiByYXRoZXIgdGhhbiB1cGRhdGluZyB3aXRoIGV2ZXJ5IGtleXN0cm9rZSxcbiAqIHNpbmNlIHRoZSBmaW5hbCB0ZXh0IHR5cGVkIGJ5IHRoZSB1c2VyIGlzIHRoZSBvbmUgdGhhdCBzaG91bGQgcHJvZHVjZSB0aGVcbiAqIGZpbmFsIGF1dG9jb21wbGV0ZSByZXN1bHRzLiBGb3IgbW9yZSBzdGF0ZWZ1bCBkZWJvdW5jaW5nIHdpdGggc3VwcG9ydCBmb3JcbiAqIHBhdXNpbmcsIHJlc3VtaW5nLCBhbmQgY2FuY2VsaW5nIGRlYm91bmNlZCBhY3Rpb25zLCB1c2VcbiAqIGBnb29nLmFzeW5jLkRlYm91bmNlcmAuXG4gKlxuICogQHBhcmFtIHtmdW5jdGlvbih0aGlzOlNDT1BFLCAuLi4/KX0gZiBGdW5jdGlvbiB0byBjYWxsLlxuICogQHBhcmFtIHtudW1iZXJ9IGludGVydmFsIEludGVydmFsIG92ZXIgd2hpY2ggdG8gZGVib3VuY2UuIFRoZSBmdW5jdGlvbiB3aWxsXG4gKiAgICAgb25seSBiZSBjYWxsZWQgYWZ0ZXIgdGhlIGZ1bGwgaW50ZXJ2YWwgaGFzIGVsYXBzZWQgc2luY2UgdGhlIGxhc3QgY2FsbC5cbiAqIEBwYXJhbSB7U0NPUEU9fSBvcHRfc2NvcGUgT2JqZWN0IGluIHdob3NlIHNjb3BlIHRvIGNhbGwgdGhlIGZ1bmN0aW9uLlxuICogQHJldHVybiB7ZnVuY3Rpb24oLi4uPyk6IHVuZGVmaW5lZH0gV3JhcHBlZCBmdW5jdGlvbi5cbiAqIEB0ZW1wbGF0ZSBTQ09QRVxuICovXG5nb29nLmZ1bmN0aW9ucy5kZWJvdW5jZSA9IGZ1bmN0aW9uKGYsIGludGVydmFsLCBvcHRfc2NvcGUpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBsZXQgdGltZW91dCA9IDA7XG4gIHJldHVybiAvKiogQHR5cGUge2Z1bmN0aW9uKC4uLj8pfSAqLyAoZnVuY3Rpb24odmFyX2FyZ3MpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgZ29vZy5nbG9iYWwuY2xlYXJUaW1lb3V0KHRpbWVvdXQpO1xuICAgIGNvbnN0IGFyZ3MgPSBhcmd1bWVudHM7XG4gICAgdGltZW91dCA9IGdvb2cuZ2xvYmFsLnNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAndXNlIHN0cmljdCc7XG4gICAgICBmLmFwcGx5KG9wdF9zY29wZSwgYXJncyk7XG4gICAgfSwgaW50ZXJ2YWwpO1xuICB9KTtcbn07XG5cblxuLyoqXG4gKiBXcmFwcyBhIGZ1bmN0aW9uIHRvIGFsbG93IGl0IHRvIGJlIGNhbGxlZCwgYXQgbW9zdCwgb25jZSBwZXIgaW50ZXJ2YWxcbiAqIChzcGVjaWZpZWQgaW4gbWlsbGlzZWNvbmRzKS4gSWYgdGhlIHdyYXBwZXIgZnVuY3Rpb24gaXMgY2FsbGVkIE4gdGltZXMgaW5cbiAqIHRoYXQgaW50ZXJ2YWwsIGJvdGggdGhlIDFzdCBhbmQgdGhlIE50aCBjYWxscyB3aWxsIGdvIHRocm91Z2guXG4gKlxuICogVGhpcyBpcyBwYXJ0aWN1bGFybHkgdXNlZnVsIGZvciBsaW1pdGluZyByZXBlYXRlZCB1c2VyIHJlcXVlc3RzIHdoZXJlIHRoZVxuICogdGhlIGxhc3QgYWN0aW9uIHNob3VsZCB3aW4sIGJ1dCB5b3UgYWxzbyBkb24ndCB3YW50IHRvIHdhaXQgdW50aWwgdGhlIGVuZCBvZlxuICogdGhlIGludGVydmFsIGJlZm9yZSBzZW5kaW5nIGEgcmVxdWVzdCBvdXQsIGFzIGl0IGxlYWRzIHRvIGEgcGVyY2VwdGlvbiBvZlxuICogc2xvd25lc3MgZm9yIHRoZSB1c2VyLlxuICpcbiAqIEBwYXJhbSB7ZnVuY3Rpb24odGhpczpTQ09QRSwgLi4uPyl9IGYgRnVuY3Rpb24gdG8gY2FsbC5cbiAqIEBwYXJhbSB7bnVtYmVyfSBpbnRlcnZhbCBJbnRlcnZhbCBvdmVyIHdoaWNoIHRvIHRocm90dGxlLiBUaGUgZnVuY3Rpb24gY2FuXG4gKiAgICAgb25seSBiZSBjYWxsZWQgb25jZSBwZXIgaW50ZXJ2YWwuXG4gKiBAcGFyYW0ge1NDT1BFPX0gb3B0X3Njb3BlIE9iamVjdCBpbiB3aG9zZSBzY29wZSB0byBjYWxsIHRoZSBmdW5jdGlvbi5cbiAqIEByZXR1cm4ge2Z1bmN0aW9uKC4uLj8pOiB1bmRlZmluZWR9IFdyYXBwZWQgZnVuY3Rpb24uXG4gKiBAdGVtcGxhdGUgU0NPUEVcbiAqL1xuZ29vZy5mdW5jdGlvbnMudGhyb3R0bGUgPSBmdW5jdGlvbihmLCBpbnRlcnZhbCwgb3B0X3Njb3BlKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgbGV0IHRpbWVvdXQgPSAwO1xuICBsZXQgc2hvdWxkRmlyZSA9IGZhbHNlO1xuICBsZXQgc3RvcmVkQXJncyA9IFtdO1xuXG4gIGNvbnN0IGhhbmRsZVRpbWVvdXQgPSBmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgdGltZW91dCA9IDA7XG4gICAgaWYgKHNob3VsZEZpcmUpIHtcbiAgICAgIHNob3VsZEZpcmUgPSBmYWxzZTtcbiAgICAgIGZpcmUoKTtcbiAgICB9XG4gIH07XG5cbiAgY29uc3QgZmlyZSA9IGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICB0aW1lb3V0ID0gZ29vZy5nbG9iYWwuc2V0VGltZW91dChoYW5kbGVUaW1lb3V0LCBpbnRlcnZhbCk7XG4gICAgbGV0IGFyZ3MgPSBzdG9yZWRBcmdzO1xuICAgIHN0b3JlZEFyZ3MgPSBbXTsgIC8vIEF2b2lkIGEgc3BhY2UgbGVhayBieSBjbGVhcmluZyBzdG9yZWQgYXJndW1lbnRzLlxuICAgIGYuYXBwbHkob3B0X3Njb3BlLCBhcmdzKTtcbiAgfTtcblxuICByZXR1cm4gLyoqIEB0eXBlIHtmdW5jdGlvbiguLi4/KX0gKi8gKGZ1bmN0aW9uKHZhcl9hcmdzKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIHN0b3JlZEFyZ3MgPSBhcmd1bWVudHM7XG4gICAgaWYgKCF0aW1lb3V0KSB7XG4gICAgICBmaXJlKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHNob3VsZEZpcmUgPSB0cnVlO1xuICAgIH1cbiAgfSk7XG59O1xuXG5cbi8qKlxuICogV3JhcHMgYSBmdW5jdGlvbiB0byBhbGxvdyBpdCB0byBiZSBjYWxsZWQsIGF0IG1vc3QsIG9uY2UgcGVyIGludGVydmFsXG4gKiAoc3BlY2lmaWVkIGluIG1pbGxpc2Vjb25kcykuIElmIHRoZSB3cmFwcGVyIGZ1bmN0aW9uIGlzIGNhbGxlZCBOIHRpbWVzIHdpdGhpblxuICogdGhhdCBpbnRlcnZhbCwgb25seSB0aGUgMXN0IGNhbGwgd2lsbCBnbyB0aHJvdWdoLlxuICpcbiAqIFRoaXMgaXMgcGFydGljdWxhcmx5IHVzZWZ1bCBmb3IgbGltaXRpbmcgcmVwZWF0ZWQgdXNlciByZXF1ZXN0cyB3aGVyZSB0aGVcbiAqIGZpcnN0IHJlcXVlc3QgaXMgZ3VhcmFudGVlZCB0byBoYXZlIGFsbCB0aGUgZGF0YSByZXF1aXJlZCB0byBwZXJmb3JtIHRoZVxuICogZmluYWwgYWN0aW9uLCBzbyB0aGVyZSdzIG5vIG5lZWQgdG8gd2FpdCB1bnRpbCB0aGUgZW5kIG9mIHRoZSBpbnRlcnZhbCBiZWZvcmVcbiAqIHNlbmRpbmcgdGhlIHJlcXVlc3Qgb3V0LlxuICpcbiAqIEBwYXJhbSB7ZnVuY3Rpb24odGhpczpTQ09QRSwgLi4uPyl9IGYgRnVuY3Rpb24gdG8gY2FsbC5cbiAqIEBwYXJhbSB7bnVtYmVyfSBpbnRlcnZhbCBJbnRlcnZhbCBvdmVyIHdoaWNoIHRvIHJhdGUtbGltaXQuIFRoZSBmdW5jdGlvbiB3aWxsXG4gKiAgICAgb25seSBiZSBjYWxsZWQgb25jZSBwZXIgaW50ZXJ2YWwsIGFuZCBpZ25vcmVkIGZvciB0aGUgcmVtYWluZXIgb2YgdGhlXG4gKiAgICAgaW50ZXJ2YWwuXG4gKiBAcGFyYW0ge1NDT1BFPX0gb3B0X3Njb3BlIE9iamVjdCBpbiB3aG9zZSBzY29wZSB0byBjYWxsIHRoZSBmdW5jdGlvbi5cbiAqIEByZXR1cm4ge2Z1bmN0aW9uKC4uLj8pOiB1bmRlZmluZWR9IFdyYXBwZWQgZnVuY3Rpb24uXG4gKiBAdGVtcGxhdGUgU0NPUEVcbiAqL1xuZ29vZy5mdW5jdGlvbnMucmF0ZUxpbWl0ID0gZnVuY3Rpb24oZiwgaW50ZXJ2YWwsIG9wdF9zY29wZSkge1xuICAndXNlIHN0cmljdCc7XG4gIGxldCB0aW1lb3V0ID0gMDtcblxuICBjb25zdCBoYW5kbGVUaW1lb3V0ID0gZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIHRpbWVvdXQgPSAwO1xuICB9O1xuXG4gIHJldHVybiAvKiogQHR5cGUge2Z1bmN0aW9uKC4uLj8pfSAqLyAoZnVuY3Rpb24odmFyX2FyZ3MpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgaWYgKCF0aW1lb3V0KSB7XG4gICAgICB0aW1lb3V0ID0gZ29vZy5nbG9iYWwuc2V0VGltZW91dChoYW5kbGVUaW1lb3V0LCBpbnRlcnZhbCk7XG4gICAgICBmLmFwcGx5KG9wdF9zY29wZSwgYXJndW1lbnRzKTtcbiAgICB9XG4gIH0pO1xufTtcblxuLyoqXG4gKiBSZXR1cm5zIHRydWUgaWYgdGhlIHNwZWNpZmllZCB2YWx1ZSBpcyBhIGZ1bmN0aW9uLlxuICogQHBhcmFtIHsqfSB2YWwgVmFyaWFibGUgdG8gdGVzdC5cbiAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgdmFyaWFibGUgaXMgYSBmdW5jdGlvbi5cbiAqL1xuZ29vZy5mdW5jdGlvbnMuaXNGdW5jdGlvbiA9ICh2YWwpID0+IHtcbiAgcmV0dXJuIHR5cGVvZiB2YWwgPT09ICdmdW5jdGlvbic7XG59O1xuIiwgIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCBUaGUgQ2xvc3VyZSBMaWJyYXJ5IEF1dGhvcnMuXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cblxuLyoqXG4gKiBAZmlsZW92ZXJ2aWV3IFV0aWxpdHkgdG8gYXR0ZW1wdCBuYXRpdmUgSlNPTiBwcm9jZXNzaW5nLCBmYWxsaW5nIGJhY2sgdG9cbiAqICAgICBnb29nLmpzb24gaWYgbm90IGF2YWlsYWJsZS5cbiAqXG4gKiAgICAgVGhpcyBpcyBpbnRlbmRlZCBhcyBhIGRyb3AtaW4gZm9yIGN1cnJlbnQgdXNlcnMgb2YgZ29vZy5qc29uIHdobyB3YW50XG4gKiAgICAgdG8gdGFrZSBhZHZhbnRhZ2Ugb2YgbmF0aXZlIEpTT04gaWYgcHJlc2VudC5cbiAqL1xuXG5nb29nLnByb3ZpZGUoJ2dvb2cuanNvbi5oeWJyaWQnKTtcblxuZ29vZy5yZXF1aXJlKCdnb29nLmFzc2VydHMnKTtcbmdvb2cucmVxdWlyZSgnZ29vZy5qc29uJyk7XG5cblxuLyoqXG4gKiBBdHRlbXB0cyB0byBzZXJpYWxpemUgdGhlIEpTT04gc3RyaW5nIG5hdGl2ZWx5LCBmYWxsaW5nIGJhY2sgdG9cbiAqIGBnb29nLmpzb24uc2VyaWFsaXplYCBpZiB1bnN1Y2Nlc3NmdWwuXG4gKiBAcGFyYW0geyFPYmplY3R9IG9iaiBKYXZhU2NyaXB0IG9iamVjdCB0byBzZXJpYWxpemUgdG8gSlNPTi5cbiAqIEByZXR1cm4ge3N0cmluZ30gUmVzdWx0aW5nIEpTT04gc3RyaW5nLlxuICovXG5nb29nLmpzb24uaHlicmlkLnN0cmluZ2lmeSA9IGdvb2cuanNvbi5VU0VfTkFUSVZFX0pTT04gP1xuICAgIGdvb2cuZ2xvYmFsWydKU09OJ11bJ3N0cmluZ2lmeSddIDpcbiAgICBmdW5jdGlvbihvYmopIHtcbiAgICAgICd1c2Ugc3RyaWN0JztcbiAgICAgIGlmIChnb29nLmdsb2JhbC5KU09OKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgcmV0dXJuIGdvb2cuZ2xvYmFsLkpTT04uc3RyaW5naWZ5KG9iaik7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAvLyBOYXRpdmUgc2VyaWFsaXphdGlvbiBmYWlsZWQuICBGYWxsIHRocm91Z2ggdG8gcmV0cnkgd2l0aFxuICAgICAgICAgIC8vIGdvb2cuanNvbi5zZXJpYWxpemUuXG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGdvb2cuanNvbi5zZXJpYWxpemUob2JqKTtcbiAgICB9O1xuXG5cbi8qKlxuICogQXR0ZW1wdHMgdG8gcGFyc2UgdGhlIEpTT04gc3RyaW5nIG5hdGl2ZWx5LCBmYWxsaW5nIGJhY2sgdG9cbiAqIHRoZSBzdXBwbGllZCBgZmFsbGJhY2tQYXJzZXJgIGlmIHVuc3VjY2Vzc2Z1bC5cbiAqIEBwYXJhbSB7c3RyaW5nfSBqc29uU3RyaW5nIEpTT04gc3RyaW5nIHRvIHBhcnNlLlxuICogQHBhcmFtIHtmdW5jdGlvbihzdHJpbmcpOk9iamVjdH0gZmFsbGJhY2tQYXJzZXIgRmFsbGJhY2sgSlNPTiBwYXJzZXIgdXNlZFxuICogICAgIGlmIG5hdGl2ZVxuICogQHJldHVybiB7P09iamVjdH0gUmVzdWx0aW5nIEpTT04gb2JqZWN0LlxuICogQHByaXZhdGVcbiAqL1xuZ29vZy5qc29uLmh5YnJpZC5wYXJzZV8gPSBmdW5jdGlvbihqc29uU3RyaW5nLCBmYWxsYmFja1BhcnNlcikge1xuICAndXNlIHN0cmljdCc7XG4gIGlmIChnb29nLmdsb2JhbC5KU09OKSB7XG4gICAgdHJ5IHtcbiAgICAgIHZhciBvYmogPSBnb29nLmdsb2JhbC5KU09OLnBhcnNlKGpzb25TdHJpbmcpO1xuICAgICAgZ29vZy5hc3NlcnRzLmFzc2VydCh0eXBlb2Ygb2JqID09ICdvYmplY3QnKTtcbiAgICAgIHJldHVybiAvKiogQHR5cGUgez9PYmplY3R9ICovIChvYmopO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIC8vIE5hdGl2ZSBwYXJzZSBmYWlsZWQuICBGYWxsIHRocm91Z2ggdG8gcmV0cnkgd2l0aCBnb29nLmpzb24ucGFyc2UuXG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIGZhbGxiYWNrUGFyc2VyKGpzb25TdHJpbmcpO1xufTtcblxuXG4vKipcbiAqIEF0dGVtcHRzIHRvIHBhcnNlIHRoZSBKU09OIHN0cmluZyBuYXRpdmVseSwgZmFsbGluZyBiYWNrIHRvXG4gKiBgZ29vZy5qc29uLnBhcnNlYCBpZiB1bnN1Y2Nlc3NmdWwuXG4gKiBAcGFyYW0ge3N0cmluZ30ganNvblN0cmluZyBKU09OIHN0cmluZyB0byBwYXJzZS5cbiAqIEByZXR1cm4gez9PYmplY3R9IFJlc3VsdGluZyBKU09OIG9iamVjdC5cbiAqL1xuZ29vZy5qc29uLmh5YnJpZC5wYXJzZSA9IGdvb2cuanNvbi5VU0VfTkFUSVZFX0pTT04gP1xuICAgIGdvb2cuZ2xvYmFsWydKU09OJ11bJ3BhcnNlJ10gOlxuICAgIGZ1bmN0aW9uKGpzb25TdHJpbmcpIHtcbiAgICAgICd1c2Ugc3RyaWN0JztcbiAgICAgIHJldHVybiBnb29nLmpzb24uaHlicmlkLnBhcnNlXyhqc29uU3RyaW5nLCBnb29nLmpzb24ucGFyc2UpO1xuICAgIH07XG4iLCAiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IFRoZSBDbG9zdXJlIExpYnJhcnkgQXV0aG9ycy5cbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBAZmlsZW92ZXJ2aWV3IENvbnN0YW50cyBmb3IgSFRUUCBzdGF0dXMgY29kZXMuXG4gKi9cblxuZ29vZy5wcm92aWRlKCdnb29nLm5ldC5IdHRwU3RhdHVzJyk7XG5cblxuLyoqXG4gKiBIVFRQIFN0YXR1cyBDb2RlcyBkZWZpbmVkIGluIFJGQyAyNjE2LCBSRkMgNjU4NSwgUkZDIDQ5MTggYW5kIFJGQyA3NTM4LlxuICogQHNlZSBodHRwOi8vd3d3LnczLm9yZy9Qcm90b2NvbHMvcmZjMjYxNi9yZmMyNjE2LXNlYzEwLmh0bWxcbiAqIEBzZWUgaHR0cDovL3Rvb2xzLmlldGYub3JnL2h0bWwvcmZjNjU4NVxuICogQHNlZSBodHRwczovL3Rvb2xzLmlldGYub3JnL2h0bWwvcmZjNDkxOFxuICogQHNlZSBodHRwczovL3Rvb2xzLmlldGYub3JnL2h0bWwvcmZjNzUzOFxuICogQGVudW0ge251bWJlcn1cbiAqL1xuZ29vZy5uZXQuSHR0cFN0YXR1cyA9IHtcbiAgLy8gSW5mb3JtYXRpb25hbCAxeHhcbiAgQ09OVElOVUU6IDEwMCxcbiAgU1dJVENISU5HX1BST1RPQ09MUzogMTAxLFxuXG4gIC8vIFN1Y2Nlc3NmdWwgMnh4XG4gIE9LOiAyMDAsXG4gIENSRUFURUQ6IDIwMSxcbiAgQUNDRVBURUQ6IDIwMixcbiAgTk9OX0FVVEhPUklUQVRJVkVfSU5GT1JNQVRJT046IDIwMyxcbiAgTk9fQ09OVEVOVDogMjA0LFxuICBSRVNFVF9DT05URU5UOiAyMDUsXG4gIFBBUlRJQUxfQ09OVEVOVDogMjA2LFxuICBNVUxUSV9TVEFUVVM6IDIwNyxcblxuICAvLyBSZWRpcmVjdGlvbiAzeHhcbiAgTVVMVElQTEVfQ0hPSUNFUzogMzAwLFxuICBNT1ZFRF9QRVJNQU5FTlRMWTogMzAxLFxuICBGT1VORDogMzAyLFxuICBTRUVfT1RIRVI6IDMwMyxcbiAgTk9UX01PRElGSUVEOiAzMDQsXG4gIFVTRV9QUk9YWTogMzA1LFxuICBURU1QT1JBUllfUkVESVJFQ1Q6IDMwNyxcbiAgUEVSTUFORU5UX1JFRElSRUNUOiAzMDgsXG5cbiAgLy8gQ2xpZW50IEVycm9yIDR4eFxuICBCQURfUkVRVUVTVDogNDAwLFxuICBVTkFVVEhPUklaRUQ6IDQwMSxcbiAgUEFZTUVOVF9SRVFVSVJFRDogNDAyLFxuICBGT1JCSURERU46IDQwMyxcbiAgTk9UX0ZPVU5EOiA0MDQsXG4gIE1FVEhPRF9OT1RfQUxMT1dFRDogNDA1LFxuICBOT1RfQUNDRVBUQUJMRTogNDA2LFxuICBQUk9YWV9BVVRIRU5USUNBVElPTl9SRVFVSVJFRDogNDA3LFxuICBSRVFVRVNUX1RJTUVPVVQ6IDQwOCxcbiAgQ09ORkxJQ1Q6IDQwOSxcbiAgR09ORTogNDEwLFxuICBMRU5HVEhfUkVRVUlSRUQ6IDQxMSxcbiAgUFJFQ09ORElUSU9OX0ZBSUxFRDogNDEyLFxuICBSRVFVRVNUX0VOVElUWV9UT09fTEFSR0U6IDQxMyxcbiAgUkVRVUVTVF9VUklfVE9PX0xPTkc6IDQxNCxcbiAgVU5TVVBQT1JURURfTUVESUFfVFlQRTogNDE1LFxuICBSRVFVRVNUX1JBTkdFX05PVF9TQVRJU0ZJQUJMRTogNDE2LFxuICBFWFBFQ1RBVElPTl9GQUlMRUQ6IDQxNyxcbiAgVU5QUk9DRVNTQUJMRV9FTlRJVFk6IDQyMixcbiAgTE9DS0VEOiA0MjMsXG4gIEZBSUxFRF9ERVBFTkRFTkNZOiA0MjQsXG4gIFBSRUNPTkRJVElPTl9SRVFVSVJFRDogNDI4LFxuICBUT09fTUFOWV9SRVFVRVNUUzogNDI5LFxuICBSRVFVRVNUX0hFQURFUl9GSUVMRFNfVE9PX0xBUkdFOiA0MzEsXG5cbiAgLy8gU2VydmVyIEVycm9yIDV4eFxuICBJTlRFUk5BTF9TRVJWRVJfRVJST1I6IDUwMCxcbiAgTk9UX0lNUExFTUVOVEVEOiA1MDEsXG4gIEJBRF9HQVRFV0FZOiA1MDIsXG4gIFNFUlZJQ0VfVU5BVkFJTEFCTEU6IDUwMyxcbiAgR0FURVdBWV9USU1FT1VUOiA1MDQsXG4gIEhUVFBfVkVSU0lPTl9OT1RfU1VQUE9SVEVEOiA1MDUsXG4gIElOU1VGRklDSUVOVF9TVE9SQUdFOiA1MDcsXG4gIE5FVFdPUktfQVVUSEVOVElDQVRJT05fUkVRVUlSRUQ6IDUxMSxcblxuICAvKlxuICAgKiBJRSByZXR1cm5zIHRoaXMgY29kZSBmb3IgMjA0IGR1ZSB0byBpdHMgdXNlIG9mIFVSTE1vbiwgd2hpY2ggcmV0dXJucyB0aGlzXG4gICAqIGNvZGUgZm9yICdPcGVyYXRpb24gQWJvcnRlZCcuIFRoZSBzdGF0dXMgdGV4dCBpcyAnVW5rbm93bicsIHRoZSByZXNwb25zZVxuICAgKiBoZWFkZXJzIGFyZSAnJy4gS25vd24gdG8gb2NjdXIgb24gSUUgNiBvbiBYUCB0aHJvdWdoIElFOSBvbiBXaW43LlxuICAgKi9cbiAgUVVJUktfSUVfTk9fQ09OVEVOVDogMTIyMyxcbn07XG5cblxuLyoqXG4gKiBSZXR1cm5zIHdoZXRoZXIgdGhlIGdpdmVuIHN0YXR1cyBzaG91bGQgYmUgY29uc2lkZXJlZCBzdWNjZXNzZnVsLlxuICpcbiAqIFN1Y2Nlc3NmdWwgY29kZXMgYXJlIE9LICgyMDApLCBDUkVBVEVEICgyMDEpLCBBQ0NFUFRFRCAoMjAyKSxcbiAqIE5PIENPTlRFTlQgKDIwNCksIFBBUlRJQUwgQ09OVEVOVCAoMjA2KSwgTk9UIE1PRElGSUVEICgzMDQpLFxuICogYW5kIElFJ3Mgbm8gY29udGVudCBjb2RlICgxMjIzKS5cbiAqXG4gKiBAcGFyYW0ge251bWJlcn0gc3RhdHVzIFRoZSBzdGF0dXMgY29kZSB0byB0ZXN0LlxuICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGUgc3RhdHVzIGNvZGUgc2hvdWxkIGJlIGNvbnNpZGVyZWQgc3VjY2Vzc2Z1bC5cbiAqL1xuZ29vZy5uZXQuSHR0cFN0YXR1cy5pc1N1Y2Nlc3MgPSBmdW5jdGlvbihzdGF0dXMpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBzd2l0Y2ggKHN0YXR1cykge1xuICAgIGNhc2UgZ29vZy5uZXQuSHR0cFN0YXR1cy5PSzpcbiAgICBjYXNlIGdvb2cubmV0Lkh0dHBTdGF0dXMuQ1JFQVRFRDpcbiAgICBjYXNlIGdvb2cubmV0Lkh0dHBTdGF0dXMuQUNDRVBURUQ6XG4gICAgY2FzZSBnb29nLm5ldC5IdHRwU3RhdHVzLk5PX0NPTlRFTlQ6XG4gICAgY2FzZSBnb29nLm5ldC5IdHRwU3RhdHVzLlBBUlRJQUxfQ09OVEVOVDpcbiAgICBjYXNlIGdvb2cubmV0Lkh0dHBTdGF0dXMuTk9UX01PRElGSUVEOlxuICAgIGNhc2UgZ29vZy5uZXQuSHR0cFN0YXR1cy5RVUlSS19JRV9OT19DT05URU5UOlxuICAgICAgcmV0dXJuIHRydWU7XG5cbiAgICBkZWZhdWx0OlxuICAgICAgcmV0dXJuIGZhbHNlO1xuICB9XG59O1xuIiwgIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCBUaGUgQ2xvc3VyZSBMaWJyYXJ5IEF1dGhvcnMuXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogQGZpbGVvdmVydmlldyBQcm92aWRlcyBDT1JTIHN1cHBvcnQgZm9yIEhUVFAgYmFzZWQgUlBDIHJlcXVlc3RzLlxuICpcbiAqIEFzIHBhcnQgb2YgbmV0LnJwYyBwYWNrYWdlLCBDT1JTIGZlYXR1cmVzIHByb3ZpZGVkIGJ5IHRoaXMgY2xhc3NcbiAqIGRlcGVuZCBvbiB0aGUgc2VydmVyIHN1cHBvcnQuIFBsZWFzZSBjaGVjayByZWxhdGVkIHNwZWNzIHRvIGRlY2lkZSBob3dcbiAqIHRvIGVuYWJsZSBhbnkgb2YgdGhlIGZlYXR1cmVzIHByb3ZpZGVkIGJ5IHRoaXMgY2xhc3MuXG4gKi9cblxuZ29vZy5tb2R1bGUoJ2dvb2cubmV0LnJwYy5IdHRwQ29ycycpO1xuXG5jb25zdCBHb29nVXJpID0gZ29vZy5yZXF1aXJlKCdnb29nLlVyaScpO1xuY29uc3QgZ29vZ09iamVjdCA9IGdvb2cucmVxdWlyZSgnZ29vZy5vYmplY3QnKTtcbmNvbnN0IGdvb2dTdHJpbmcgPSBnb29nLnJlcXVpcmUoJ2dvb2cuc3RyaW5nJyk7XG5jb25zdCBnb29nVXJpVXRpbHMgPSBnb29nLnJlcXVpcmUoJ2dvb2cudXJpLnV0aWxzJyk7XG5cblxuLyoqXG4gKiBUaGUgZGVmYXVsdCBVUkwgcGFyYW1ldGVyIG5hbWUgdG8gb3ZlcndyaXRlIGh0dHAgaGVhZGVycyB3aXRoIGEgVVJMIHBhcmFtXG4gKiB0byBhdm9pZCBDT1JTIHByZWZsaWdodC5cbiAqXG4gKiBTZWUgaHR0cHM6Ly9naXRodWIuY29tL3doYXR3Zy9mZXRjaC9pc3N1ZXMvMjEwI2lzc3VlLTEyOTUzMTc0MyBmb3IgdGhlIHNwZWMuXG4gKlxuICogQHR5cGUge3N0cmluZ31cbiAqL1xuZXhwb3J0cy5IVFRQX0hFQURFUlNfUEFSQU1fTkFNRSA9ICckaHR0cEhlYWRlcnMnO1xuXG5cbi8qKlxuICogVGhlIGRlZmF1bHQgVVJMIHBhcmFtZXRlciBuYW1lIHRvIG92ZXJ3cml0ZSBodHRwIG1ldGhvZCB3aXRoIGEgVVJMIHBhcmFtXG4gKiB0byBhdm9pZCBDT1JTIHByZWZsaWdodC5cbiAqXG4gKiBTZWUgaHR0cHM6Ly9naXRodWIuY29tL3doYXR3Zy9mZXRjaC9pc3N1ZXMvMjEwI2lzc3VlLTEyOTUzMTc0MyBmb3IgdGhlIHNwZWMuXG4gKlxuICogQHR5cGUge3N0cmluZ31cbiAqL1xuZXhwb3J0cy5IVFRQX01FVEhPRF9QQVJBTV9OQU1FID0gJyRodHRwTWV0aG9kJztcblxuXG4vKipcbiAqIEdlbmVyYXRlcyB0aGUgVVJMIHBhcmFtZXRlciB2YWx1ZSB3aXRoIGN1c3RvbSBoZWFkZXJzIGVuY29kZWQgYXNcbiAqIEhUVFAvMS4xIGhlYWRlcnMgYmxvY2suXG4gKlxuICogQHBhcmFtIHshT2JqZWN0PHN0cmluZywgc3RyaW5nPn0gaGVhZGVycyBUaGUgY3VzdG9tIGhlYWRlcnMuXG4gKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSBVUkwgcGFyYW0gdG8gb3ZlcndyaXRlIGN1c3RvbSBIVFRQIGhlYWRlcnMuXG4gKi9cbmV4cG9ydHMuZ2VuZXJhdGVIdHRwSGVhZGVyc092ZXJ3cml0ZVBhcmFtID0gZnVuY3Rpb24oaGVhZGVycykge1xuICBsZXQgcmVzdWx0ID0gJyc7XG4gIGdvb2dPYmplY3QuZm9yRWFjaChoZWFkZXJzLCBmdW5jdGlvbih2YWx1ZSwga2V5KSB7XG4gICAgcmVzdWx0ICs9IGtleTtcbiAgICByZXN1bHQgKz0gJzonO1xuICAgIHJlc3VsdCArPSB2YWx1ZTtcbiAgICByZXN1bHQgKz0gJ1xcclxcbic7XG4gIH0pO1xuICByZXR1cm4gcmVzdWx0O1xufTtcblxuXG4vKipcbiAqIEdlbmVyYXRlcyB0aGUgVVJMLWVuY29kZWQgVVJMIHBhcmFtZXRlciB2YWx1ZSB3aXRoIGN1c3RvbSBoZWFkZXJzIGVuY29kZWQgYXNcbiAqIEhUVFAvMS4xIGhlYWRlcnMgYmxvY2suXG4gKlxuICogQHBhcmFtIHshT2JqZWN0PHN0cmluZywgc3RyaW5nPn0gaGVhZGVycyBUaGUgY3VzdG9tIGhlYWRlcnMuXG4gKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSBVUkwgcGFyYW0gdG8gb3ZlcndyaXRlIGN1c3RvbSBIVFRQIGhlYWRlcnMuXG4gKi9cbmV4cG9ydHMuZ2VuZXJhdGVFbmNvZGVkSHR0cEhlYWRlcnNPdmVyd3JpdGVQYXJhbSA9IGZ1bmN0aW9uKGhlYWRlcnMpIHtcbiAgcmV0dXJuIGdvb2dTdHJpbmcudXJsRW5jb2RlKFxuICAgICAgZXhwb3J0cy5nZW5lcmF0ZUh0dHBIZWFkZXJzT3ZlcndyaXRlUGFyYW0oaGVhZGVycykpO1xufTtcblxuXG4vKipcbiAqIFNldHMgY3VzdG9tIEhUVFAgaGVhZGVycyB2aWEgYW4gb3ZlcndyaXRlIFVSTCBwYXJhbS5cbiAqXG4gKiBAcGFyYW0geyFHb29nVXJpfHN0cmluZ30gdXJsIFRoZSBVUkkgb2JqZWN0IG9yIGEgc3RyaW5nIHBhdGguXG4gKiBAcGFyYW0ge3N0cmluZ30gdXJsUGFyYW0gVGhlIFVSTCBwYXJhbSBuYW1lLlxuICogQHBhcmFtIHshT2JqZWN0PHN0cmluZywgc3RyaW5nPn0gZXh0cmFIZWFkZXJzIFRoZSBIVFRQIGhlYWRlcnMuXG4gKiBAcmV0dXJuIHshR29vZ1VyaXxzdHJpbmd9IFRoZSBVUkkgb2JqZWN0IG9yIGEgc3RyaW5nIHBhdGggd2l0aCBoZWFkZXJzXG4gKiBlbmNvZGVkIGFzIGEgdXJsIHBhcmFtLlxuICovXG5leHBvcnRzLnNldEh0dHBIZWFkZXJzV2l0aE92ZXJ3cml0ZVBhcmFtID0gZnVuY3Rpb24oXG4gICAgdXJsLCB1cmxQYXJhbSwgZXh0cmFIZWFkZXJzKSB7XG4gIGlmIChnb29nT2JqZWN0LmlzRW1wdHkoZXh0cmFIZWFkZXJzKSkge1xuICAgIHJldHVybiB1cmw7XG4gIH1cbiAgY29uc3QgaHR0cEhlYWRlcnMgPSBleHBvcnRzLmdlbmVyYXRlSHR0cEhlYWRlcnNPdmVyd3JpdGVQYXJhbShleHRyYUhlYWRlcnMpO1xuICBpZiAodHlwZW9mIHVybCA9PT0gJ3N0cmluZycpIHtcbiAgICByZXR1cm4gZ29vZ1VyaVV0aWxzLmFwcGVuZFBhcmFtKFxuICAgICAgICB1cmwsIGdvb2dTdHJpbmcudXJsRW5jb2RlKHVybFBhcmFtKSwgaHR0cEhlYWRlcnMpO1xuICB9IGVsc2Uge1xuICAgIHVybC5zZXRQYXJhbWV0ZXJWYWx1ZSh1cmxQYXJhbSwgaHR0cEhlYWRlcnMpOyAgLy8gZHVwbGljYXRlIHJlbW92ZWQhXG4gICAgcmV0dXJuIHVybDtcbiAgfVxufTtcbiIsICIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgVGhlIENsb3N1cmUgTGlicmFyeSBBdXRob3JzLlxuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIEBmaWxlb3ZlcnZpZXcgVHJhbnNwb3J0IHN1cHBvcnQgZm9yIFdlYkNoYW5uZWwuXG4gKlxuICogVGhlIDxjb2RlPldlYkNoYW5uZWxUcmFuc3BvcnQ8L2NvZGU+IGltcGxlbWVudGF0aW9uIHNlcnZlcyBhcyB0aGUgZmFjdG9yeVxuICogZm9yIDxjb2RlPldlYkNoYW5uZWw8L2NvZGU+LCB3aGljaCBvZmZlcnMgYW4gYWJzdHJhY3Rpb24gZm9yXG4gKiBwb2ludC10by1wb2ludCBzb2NrZXQtbGlrZSBjb21tdW5pY2F0aW9uIHNpbWlsYXIgdG8gd2hhdCBCcm93c2VyQ2hhbm5lbFxuICogb3IgSFRNTDUgV2ViU29ja2V0IG9mZmVycy5cbiAqL1xuXG5nb29nLnByb3ZpZGUoJ2dvb2cubmV0LldlYkNoYW5uZWxUcmFuc3BvcnQnKTtcblxuZ29vZy5yZXF1aXJlVHlwZSgnZ29vZy5uZXQuV2ViQ2hhbm5lbCcpO1xuZ29vZy5yZXF1aXJlVHlwZSgnZ29vZy5uZXQuV2ViQ2hhbm5lbC5PcHRpb25zJyk7XG5cblxuXG4vKipcbiAqIEEgV2ViQ2hhbm5lbFRyYW5zcG9ydCBpbnN0YW5jZSByZXByZXNlbnRzIGEgc2hhcmVkIGNvbnRleHQgb2YgbG9naWNhbFxuICogY29ubmVjdGl2aXR5IGJldHdlZW4gYSBicm93c2VyIGNsaWVudCBhbmQgYSByZW1vdGUgb3JpZ2luLlxuICpcbiAqIE92ZXIgYSBzaW5nbGUgV2ViQ2hhbm5lbFRyYW5zcG9ydCBpbnN0YW5jZSwgbXVsdGlwbGUgV2ViQ2hhbm5lbHMgbWF5IGJlXG4gKiBjcmVhdGVkIGFnYWluc3QgZGlmZmVyZW50IFVSTHMsIHdoaWNoIG1heSBhbGwgc2hhcmUgdGhlIHNhbWVcbiAqIHVuZGVybHlpbmcgY29ubmVjdGl2aXR5IChpLmUuIFRDUCBjb25uZWN0aW9uKSB3aGVuZXZlciBwb3NzaWJsZS5cbiAqXG4gKiBXaGVuIG11bHRpLWRvbWFpbnMgYXJlIHN1cHBvcnRlZCwgc3VjaCBhcyBDT1JTLCBtdWx0aXBsZSBvcmlnaW5zIG1heSBiZVxuICogc3VwcG9ydGVkIG92ZXIgYSBzaW5nbGUgV2ViQ2hhbm5lbFRyYW5zcG9ydCBpbnN0YW5jZSBhdCB0aGUgc2FtZSB0aW1lLlxuICpcbiAqIFNoYXJpbmcgYmV0d2VlbiBkaWZmZXJlbnQgd2luZG93IGNvbnRleHRzIHN1Y2ggYXMgdGFicyBpcyBub3QgYWRkcmVzc2VkXG4gKiBieSBXZWJDaGFubmVsVHJhbnNwb3J0LiBBcHBsaWNhdGlvbnMgbWF5IGNob29zZSBIVE1MNSBzaGFyZWQgd29ya2Vyc1xuICogb3Igb3RoZXIgdGVjaG5pcXVlcyB0byBhY2Nlc3MgdGhlIHNhbWUgdHJhbnNwb3J0IGluc3RhbmNlXG4gKiBhY3Jvc3MgZGlmZmVyZW50IHdpbmRvdyBjb250ZXh0cy5cbiAqXG4gKiBAaW50ZXJmYWNlXG4gKi9cbmdvb2cubmV0LldlYkNoYW5uZWxUcmFuc3BvcnQgPSBmdW5jdGlvbigpIHt9O1xuXG5cbi8qKlxuICogVGhlIGNsaWVudCB2ZXJzaW9uLiBUaGlzIGludGVnZXIgdmFsdWUgd2lsbCBiZSBwYXNzZWQgdG8gdGhlIHNlcnZlclxuICogd2hlbiBhIGNoYW5uZWwgaXMgb3BlbmVkIHRvIGluZm9ybSB0aGUgc2VydmVyIHRoZSBjbGllbnQgXCJjYXBhYmlsaXRpZXNcIi5cbiAqXG4gKiBXaXJlIHByb3RvY29sIHZlcnNpb24gaXMgYSBkaWZmZXJlbnQgY29uY2VwdCBhbmQgaXMgaW50ZXJuYWwgdG8gdGhlXG4gKiB0cmFuc3BvcnQgaW1wbGVtZW50YXRpb24uXG4gKlxuICogQGNvbnN0XG4gKiBAdHlwZSB7bnVtYmVyfVxuICovXG5nb29nLm5ldC5XZWJDaGFubmVsVHJhbnNwb3J0LkNMSUVOVF9WRVJTSU9OID0gMjI7XG5cblxuLyoqXG4gKiBDcmVhdGUgYSBuZXcgV2ViQ2hhbm5lbCBpbnN0YW5jZS5cbiAqXG4gKiBUaGUgbmV3IFdlYkNoYW5uZWwgaXMgdG8gYmUgb3BlbmVkIGFnYWluc3QgdGhlIHNlcnZlci1zaWRlIHJlc291cmNlXG4gKiBhcyBzcGVjaWZpZWQgYnkgdGhlIGdpdmVuIFVSTC4gU2VlIHtAbGluayBnb29nLm5ldC5XZWJDaGFubmVsfSBmb3IgZGV0YWlsZWRcbiAqIHNlbWFudGljcy5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gdXJsIFRoZSBVUkwgcGF0aCBmb3IgdGhlIG5ldyBXZWJDaGFubmVsIGluc3RhbmNlLlxuICogQHBhcmFtIHshZ29vZy5uZXQuV2ViQ2hhbm5lbC5PcHRpb25zPX0gb3B0X29wdGlvbnMgQ29uZmlndXJhdGlvbiBmb3IgdGhlXG4gKiAgICAgbmV3IFdlYkNoYW5uZWwgaW5zdGFuY2UuIFRoZSBjb25maWd1cmF0aW9uIG9iamVjdCBpcyByZXVzYWJsZSBhZnRlclxuICogICAgIHRoZSBuZXcgY2hhbm5lbCBpbnN0YW5jZSBpcyBjcmVhdGVkLlxuICogQHJldHVybiB7IWdvb2cubmV0LldlYkNoYW5uZWx9IHRoZSBuZXdseSBjcmVhdGVkIFdlYkNoYW5uZWwgaW5zdGFuY2UuXG4gKi9cbmdvb2cubmV0LldlYkNoYW5uZWxUcmFuc3BvcnQucHJvdG90eXBlLmNyZWF0ZVdlYkNoYW5uZWwgPSBnb29nLmFic3RyYWN0TWV0aG9kO1xuIiwgIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCBUaGUgQ2xvc3VyZSBMaWJyYXJ5IEF1dGhvcnMuXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbi8qKlxuICogQGZpbGVvdmVydmlldyBJbXBsZW1lbnRhdGlvbiBvZiBhIFdlYkNoYW5uZWwgdHJhbnNwb3J0IHVzaW5nIFdlYkNoYW5uZWxCYXNlLlxuICpcbiAqIFdoZW4gV2ViQ2hhbm5lbEJhc2UgaXMgdXNlZCBhcyB0aGUgdW5kZXJseWluZyB0cmFuc3BvcnQsIHRoZSBjYXBhYmlsaXRpZXNcbiAqIG9mIHRoZSBXZWJDaGFubmVsIGFyZSBsaW1pdGVkIHRvIHdoYXQncyBzdXBwb3J0ZWQgYnkgdGhlIGltcGxlbWVudGF0aW9uLlxuICogUGFydGljdWxhcmx5LCBtdWx0aXBsZXhpbmcgaXMgbm90IHBvc3NpYmxlLCBhbmQgb25seSBzdHJpbmdzIGFyZVxuICogc3VwcG9ydGVkIGFzIG1lc3NhZ2UgdHlwZXMuXG4gKi9cblxuZ29vZy5wcm92aWRlKCdnb29nLmxhYnMubmV0LndlYkNoYW5uZWwuV2ViQ2hhbm5lbEJhc2VUcmFuc3BvcnQnKTtcblxuZ29vZy5yZXF1aXJlKCdnb29nLmFzc2VydHMnKTtcbmdvb2cucmVxdWlyZSgnZ29vZy5ldmVudHMuRXZlbnRUYXJnZXQnKTtcbmdvb2cucmVxdWlyZSgnZ29vZy5qc29uJyk7XG5nb29nLnJlcXVpcmUoJ2dvb2cubGFicy5uZXQud2ViQ2hhbm5lbC5DaGFubmVsUmVxdWVzdCcpO1xuZ29vZy5yZXF1aXJlKCdnb29nLmxhYnMubmV0LndlYkNoYW5uZWwuV2ViQ2hhbm5lbEJhc2UnKTtcbmdvb2cucmVxdWlyZSgnZ29vZy5sYWJzLm5ldC53ZWJDaGFubmVsLldpcmUnKTtcbmdvb2cucmVxdWlyZSgnZ29vZy5sb2cnKTtcbmdvb2cucmVxdWlyZSgnZ29vZy5uZXQuV2ViQ2hhbm5lbCcpO1xuZ29vZy5yZXF1aXJlKCdnb29nLm5ldC5XZWJDaGFubmVsVHJhbnNwb3J0Jyk7XG5nb29nLnJlcXVpcmUoJ2dvb2cub2JqZWN0Jyk7XG5nb29nLnJlcXVpcmUoJ2dvb2cuc3RyaW5nJyk7XG5cblxuXG4vKipcbiAqIEltcGxlbWVudGF0aW9uIG9mIHtAbGluayBnb29nLm5ldC5XZWJDaGFubmVsVHJhbnNwb3J0fSB3aXRoXG4gKiB7QGxpbmsgZ29vZy5sYWJzLm5ldC53ZWJDaGFubmVsLldlYkNoYW5uZWxCYXNlfSBhcyB0aGUgdW5kZXJseWluZyBjaGFubmVsXG4gKiBpbXBsZW1lbnRhdGlvbi5cbiAqXG4gKiBAY29uc3RydWN0b3JcbiAqIEBzdHJ1Y3RcbiAqIEBpbXBsZW1lbnRzIHtnb29nLm5ldC5XZWJDaGFubmVsVHJhbnNwb3J0fVxuICogQGZpbmFsXG4gKi9cbmdvb2cubGFicy5uZXQud2ViQ2hhbm5lbC5XZWJDaGFubmVsQmFzZVRyYW5zcG9ydCA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIGlmICghZ29vZy5sYWJzLm5ldC53ZWJDaGFubmVsLkNoYW5uZWxSZXF1ZXN0LnN1cHBvcnRzWGhyU3RyZWFtaW5nKCkpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0Vudmlyb25tZW50YWwgZXJyb3I6IG5vIGF2YWlsYWJsZSB0cmFuc3BvcnQuJyk7XG4gIH1cbn07XG5cblxuZ29vZy5zY29wZShmdW5jdGlvbigpIHtcbid1c2Ugc3RyaWN0JztcbmNvbnN0IFdlYkNoYW5uZWxCYXNlVHJhbnNwb3J0ID1cbiAgICBnb29nLmxhYnMubmV0LndlYkNoYW5uZWwuV2ViQ2hhbm5lbEJhc2VUcmFuc3BvcnQ7XG5jb25zdCBXZWJDaGFubmVsQmFzZSA9IGdvb2cubGFicy5uZXQud2ViQ2hhbm5lbC5XZWJDaGFubmVsQmFzZTtcbmNvbnN0IFdpcmUgPSBnb29nLmxhYnMubmV0LndlYkNoYW5uZWwuV2lyZTtcblxuXG4vKipcbiAqIEBvdmVycmlkZVxuICovXG5XZWJDaGFubmVsQmFzZVRyYW5zcG9ydC5wcm90b3R5cGUuY3JlYXRlV2ViQ2hhbm5lbCA9IGZ1bmN0aW9uKFxuICAgIHVybCwgb3B0X29wdGlvbnMpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gbmV3IFdlYkNoYW5uZWxCYXNlVHJhbnNwb3J0LkNoYW5uZWwodXJsLCBvcHRfb3B0aW9ucyk7XG59O1xuXG5cblxuLyoqXG4gKiBJbXBsZW1lbnRhdGlvbiBvZiB0aGUge0BsaW5rIGdvb2cubmV0LldlYkNoYW5uZWx9IGludGVyZmFjZS5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gdXJsIFRoZSBVUkwgcGF0aCBmb3IgdGhlIG5ldyBXZWJDaGFubmVsIGluc3RhbmNlLlxuICogQHBhcmFtIHshZ29vZy5uZXQuV2ViQ2hhbm5lbC5PcHRpb25zPX0gb3B0X29wdGlvbnMgQ29uZmlndXJhdGlvbiBmb3IgdGhlXG4gKiAgICAgbmV3IFdlYkNoYW5uZWwgaW5zdGFuY2UuXG4gKlxuICogQGNvbnN0cnVjdG9yXG4gKiBAaW1wbGVtZW50cyB7Z29vZy5uZXQuV2ViQ2hhbm5lbH1cbiAqIEBleHRlbmRzIHtnb29nLmV2ZW50cy5FdmVudFRhcmdldH1cbiAqIEBmaW5hbFxuICovXG5XZWJDaGFubmVsQmFzZVRyYW5zcG9ydC5DaGFubmVsID0gZnVuY3Rpb24odXJsLCBvcHRfb3B0aW9ucykge1xuICAndXNlIHN0cmljdCc7XG4gIFdlYkNoYW5uZWxCYXNlVHJhbnNwb3J0LkNoYW5uZWwuYmFzZSh0aGlzLCAnY29uc3RydWN0b3InKTtcblxuICAvKipcbiAgICogQHByaXZhdGUgeyFXZWJDaGFubmVsQmFzZX0gVGhlIHVuZGVybHlpbmcgY2hhbm5lbCBvYmplY3QuXG4gICAqL1xuICB0aGlzLmNoYW5uZWxfID0gbmV3IFdlYkNoYW5uZWxCYXNlKFxuICAgICAgb3B0X29wdGlvbnMsIGdvb2cubmV0LldlYkNoYW5uZWxUcmFuc3BvcnQuQ0xJRU5UX1ZFUlNJT04pO1xuXG4gIC8qKlxuICAgKiBAcHJpdmF0ZSB7c3RyaW5nfSBUaGUgVVJMIG9mIHRoZSB0YXJnZXQgc2VydmVyIGVuZC1wb2ludC5cbiAgICovXG4gIHRoaXMudXJsXyA9IHVybDtcblxuICAvKipcbiAgICogQHByaXZhdGUge2dvb2cubG9nLkxvZ2dlcn0gVGhlIGxvZ2dlciBmb3IgdGhpcyBjbGFzcy5cbiAgICovXG4gIHRoaXMubG9nZ2VyXyA9XG4gICAgICBnb29nLmxvZy5nZXRMb2dnZXIoJ2dvb2cubGFicy5uZXQud2ViQ2hhbm5lbC5XZWJDaGFubmVsQmFzZVRyYW5zcG9ydCcpO1xuXG4gIC8qKlxuICAgKiBAcHJpdmF0ZSB7T2JqZWN0PHN0cmluZywgc3RyaW5nPn0gRXh0cmEgVVJMIHBhcmFtZXRlcnNcbiAgICogdG8gYmUgYWRkZWQgdG8gZWFjaCBIVFRQIHJlcXVlc3QuXG4gICAqL1xuICB0aGlzLm1lc3NhZ2VVcmxQYXJhbXNfID1cbiAgICAgIChvcHRfb3B0aW9ucyAmJiBvcHRfb3B0aW9ucy5tZXNzYWdlVXJsUGFyYW1zKSB8fCBudWxsO1xuXG4gIGxldCBtZXNzYWdlSGVhZGVycyA9IChvcHRfb3B0aW9ucyAmJiBvcHRfb3B0aW9ucy5tZXNzYWdlSGVhZGVycykgfHwgbnVsbDtcblxuICAvLyBkZWZhdWx0IGlzIGZhbHNlXG4gIGlmIChvcHRfb3B0aW9ucyAmJiBvcHRfb3B0aW9ucy5jbGllbnRQcm90b2NvbEhlYWRlclJlcXVpcmVkKSB7XG4gICAgaWYgKG1lc3NhZ2VIZWFkZXJzKSB7XG4gICAgICBnb29nLm9iamVjdC5zZXQoXG4gICAgICAgICAgbWVzc2FnZUhlYWRlcnMsIGdvb2cubmV0LldlYkNoYW5uZWwuWF9DTElFTlRfUFJPVE9DT0wsXG4gICAgICAgICAgZ29vZy5uZXQuV2ViQ2hhbm5lbC5YX0NMSUVOVF9QUk9UT0NPTF9XRUJfQ0hBTk5FTCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIG1lc3NhZ2VIZWFkZXJzID0gZ29vZy5vYmplY3QuY3JlYXRlKFxuICAgICAgICAgIGdvb2cubmV0LldlYkNoYW5uZWwuWF9DTElFTlRfUFJPVE9DT0wsXG4gICAgICAgICAgZ29vZy5uZXQuV2ViQ2hhbm5lbC5YX0NMSUVOVF9QUk9UT0NPTF9XRUJfQ0hBTk5FTCk7XG4gICAgfVxuICB9XG5cbiAgdGhpcy5jaGFubmVsXy5zZXRFeHRyYUhlYWRlcnMobWVzc2FnZUhlYWRlcnMpO1xuXG4gIGxldCBpbml0SGVhZGVycyA9IChvcHRfb3B0aW9ucyAmJiBvcHRfb3B0aW9ucy5pbml0TWVzc2FnZUhlYWRlcnMpIHx8IG51bGw7XG5cbiAgaWYgKG9wdF9vcHRpb25zICYmIG9wdF9vcHRpb25zLm1lc3NhZ2VDb250ZW50VHlwZSkge1xuICAgIGlmIChpbml0SGVhZGVycykge1xuICAgICAgZ29vZy5vYmplY3Quc2V0KFxuICAgICAgICAgIGluaXRIZWFkZXJzLCBnb29nLm5ldC5XZWJDaGFubmVsLlhfV0VCQ0hBTk5FTF9DT05URU5UX1RZUEUsXG4gICAgICAgICAgb3B0X29wdGlvbnMubWVzc2FnZUNvbnRlbnRUeXBlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaW5pdEhlYWRlcnMgPSBnb29nLm9iamVjdC5jcmVhdGUoXG4gICAgICAgICAgZ29vZy5uZXQuV2ViQ2hhbm5lbC5YX1dFQkNIQU5ORUxfQ09OVEVOVF9UWVBFLFxuICAgICAgICAgIG9wdF9vcHRpb25zLm1lc3NhZ2VDb250ZW50VHlwZSk7XG4gICAgfVxuICB9XG5cbiAgaWYgKG9wdF9vcHRpb25zICYmIG9wdF9vcHRpb25zLmNsaWVudFByb2ZpbGUpIHtcbiAgICBpZiAoaW5pdEhlYWRlcnMpIHtcbiAgICAgIGdvb2cub2JqZWN0LnNldChcbiAgICAgICAgICBpbml0SGVhZGVycywgZ29vZy5uZXQuV2ViQ2hhbm5lbC5YX1dFQkNIQU5ORUxfQ0xJRU5UX1BST0ZJTEUsXG4gICAgICAgICAgb3B0X29wdGlvbnMuY2xpZW50UHJvZmlsZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGluaXRIZWFkZXJzID0gZ29vZy5vYmplY3QuY3JlYXRlKFxuICAgICAgICAgIGdvb2cubmV0LldlYkNoYW5uZWwuWF9XRUJDSEFOTkVMX0NMSUVOVF9QUk9GSUxFLFxuICAgICAgICAgIG9wdF9vcHRpb25zLmNsaWVudFByb2ZpbGUpO1xuICAgIH1cbiAgfVxuXG4gIHRoaXMuY2hhbm5lbF8uc2V0SW5pdEhlYWRlcnMoaW5pdEhlYWRlcnMpO1xuXG4gIGNvbnN0IGh0dHBIZWFkZXJzT3ZlcndyaXRlUGFyYW0gPVxuICAgICAgb3B0X29wdGlvbnMgJiYgb3B0X29wdGlvbnMuaHR0cEhlYWRlcnNPdmVyd3JpdGVQYXJhbTtcbiAgaWYgKGh0dHBIZWFkZXJzT3ZlcndyaXRlUGFyYW0gJiZcbiAgICAgICFnb29nLnN0cmluZy5pc0VtcHR5T3JXaGl0ZXNwYWNlKGh0dHBIZWFkZXJzT3ZlcndyaXRlUGFyYW0pKSB7XG4gICAgdGhpcy5jaGFubmVsXy5zZXRIdHRwSGVhZGVyc092ZXJ3cml0ZVBhcmFtKGh0dHBIZWFkZXJzT3ZlcndyaXRlUGFyYW0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEBwcml2YXRlIHtib29sZWFufSBXaGV0aGVyIHRvIGVuYWJsZSBDT1JTLlxuICAgKi9cbiAgdGhpcy5zdXBwb3J0c0Nyb3NzRG9tYWluWGhyXyA9XG4gICAgICAob3B0X29wdGlvbnMgJiYgb3B0X29wdGlvbnMuc3VwcG9ydHNDcm9zc0RvbWFpblhocikgfHwgZmFsc2U7XG5cbiAgLyoqXG4gICAqIEBwcml2YXRlIHtib29sZWFufSBXaGV0aGVyIHRvIHNlbmQgcmF3IEpzb24gYW5kIGJ5cGFzcyB2OCB3aXJlIGZvcm1hdC5cbiAgICovXG4gIHRoaXMuc2VuZFJhd0pzb25fID0gKG9wdF9vcHRpb25zICYmIG9wdF9vcHRpb25zLnNlbmRSYXdKc29uKSB8fCBmYWxzZTtcblxuICAvLyBOb3RlIHRoYXQgaHR0cFNlc3Npb25JZFBhcmFtIHdpbGwgYmUgaWdub3JlZCBpZiB0aGUgc2FtZSBwYXJhbWV0ZXIgbmFtZVxuICAvLyBoYXMgYWxyZWFkeSBiZWVuIHNwZWNpZmllZCB3aXRoIG1lc3NhZ2VVcmxQYXJhbXNcbiAgY29uc3QgaHR0cFNlc3Npb25JZFBhcmFtID0gb3B0X29wdGlvbnMgJiYgb3B0X29wdGlvbnMuaHR0cFNlc3Npb25JZFBhcmFtO1xuICBpZiAoaHR0cFNlc3Npb25JZFBhcmFtICYmXG4gICAgICAhZ29vZy5zdHJpbmcuaXNFbXB0eU9yV2hpdGVzcGFjZShodHRwU2Vzc2lvbklkUGFyYW0pKSB7XG4gICAgdGhpcy5jaGFubmVsXy5zZXRIdHRwU2Vzc2lvbklkUGFyYW0oaHR0cFNlc3Npb25JZFBhcmFtKTtcbiAgICBpZiAoZ29vZy5vYmplY3QuY29udGFpbnNLZXkodGhpcy5tZXNzYWdlVXJsUGFyYW1zXywgaHR0cFNlc3Npb25JZFBhcmFtKSkge1xuICAgICAgZ29vZy5vYmplY3QucmVtb3ZlKHRoaXMubWVzc2FnZVVybFBhcmFtc18sIGh0dHBTZXNzaW9uSWRQYXJhbSk7XG4gICAgICBnb29nLmxvZy53YXJuaW5nKHRoaXMubG9nZ2VyXyxcbiAgICAgICAgICAnSWdub3JlIGh0dHBTZXNzaW9uSWRQYXJhbSBhbHNvIHNwZWNpZmllZCB3aXRoIG1lc3NhZ2VVcmxQYXJhbXM6ICdcbiAgICAgICAgICArIGh0dHBTZXNzaW9uSWRQYXJhbSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFRoZSBjaGFubmVsIGhhbmRsZXIuXG4gICAqXG4gICAqIEBwcml2YXRlIHshV2ViQ2hhbm5lbEJhc2VUcmFuc3BvcnQuQ2hhbm5lbC5IYW5kbGVyX31cbiAgICovXG4gIHRoaXMuY2hhbm5lbEhhbmRsZXJfID0gbmV3IFdlYkNoYW5uZWxCYXNlVHJhbnNwb3J0LkNoYW5uZWwuSGFuZGxlcl8odGhpcyk7XG59O1xuZ29vZy5pbmhlcml0cyhXZWJDaGFubmVsQmFzZVRyYW5zcG9ydC5DaGFubmVsLCBnb29nLmV2ZW50cy5FdmVudFRhcmdldCk7XG5cblxuLyoqXG4gKiBAb3ZlcnJpZGVcbiAqL1xuV2ViQ2hhbm5lbEJhc2VUcmFuc3BvcnQuQ2hhbm5lbC5wcm90b3R5cGUub3BlbiA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIHRoaXMuY2hhbm5lbF8uc2V0SGFuZGxlcih0aGlzLmNoYW5uZWxIYW5kbGVyXyk7XG4gIGlmICh0aGlzLnN1cHBvcnRzQ3Jvc3NEb21haW5YaHJfKSB7XG4gICAgdGhpcy5jaGFubmVsXy5zZXRTdXBwb3J0c0Nyb3NzRG9tYWluWGhycyh0cnVlKTtcbiAgfVxuICB0aGlzLmNoYW5uZWxfLmNvbm5lY3QodGhpcy51cmxfLCAodGhpcy5tZXNzYWdlVXJsUGFyYW1zXyB8fCB1bmRlZmluZWQpKTtcbn07XG5cblxuLyoqXG4gKiBAb3ZlcnJpZGVcbiAqL1xuV2ViQ2hhbm5lbEJhc2VUcmFuc3BvcnQuQ2hhbm5lbC5wcm90b3R5cGUuY2xvc2UgPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICB0aGlzLmNoYW5uZWxfLmRpc2Nvbm5lY3QoKTtcbn07XG5cblxuLyoqXG4gKiBAb3ZlcnJpZGVcbiAqL1xuV2ViQ2hhbm5lbEJhc2VUcmFuc3BvcnQuQ2hhbm5lbC5wcm90b3R5cGUuaGFsZkNsb3NlID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgLy8gdG8gYmUgaW1wbGVtZW50ZWRcbiAgdGhyb3cgbmV3IEVycm9yKCdOb3QgaW1wbGVtZW50ZWQnKTtcbn07XG5cblxuLyoqXG4gKiBUaGUgV2ViQ2hhbm5lbEJhc2Ugb25seSBzdXBwb3J0cyBvYmplY3QgdHlwZXMuXG4gKlxuICogQHBhcmFtIHshZ29vZy5uZXQuV2ViQ2hhbm5lbC5NZXNzYWdlRGF0YX0gbWVzc2FnZSBUaGUgbWVzc2FnZSB0byBzZW5kLlxuICpcbiAqIEBvdmVycmlkZVxuICovXG5XZWJDaGFubmVsQmFzZVRyYW5zcG9ydC5DaGFubmVsLnByb3RvdHlwZS5zZW5kID0gZnVuY3Rpb24obWVzc2FnZSkge1xuICAndXNlIHN0cmljdCc7XG4gIGdvb2cuYXNzZXJ0cy5hc3NlcnQoXG4gICAgICBnb29nLmlzT2JqZWN0KG1lc3NhZ2UpIHx8IHR5cGVvZiBtZXNzYWdlID09PSAnc3RyaW5nJyxcbiAgICAgICdvbmx5IG9iamVjdCB0eXBlIG9yIHJhdyBzdHJpbmcgaXMgc3VwcG9ydGVkJyk7XG5cbiAgaWYgKHR5cGVvZiBtZXNzYWdlID09PSAnc3RyaW5nJykge1xuICAgIGNvbnN0IHJhd0pzb24gPSB7fTtcbiAgICByYXdKc29uW1dpcmUuUkFXX0RBVEFfS0VZXSA9IG1lc3NhZ2U7XG4gICAgdGhpcy5jaGFubmVsXy5zZW5kTWFwKHJhd0pzb24pO1xuICB9IGVsc2UgaWYgKHRoaXMuc2VuZFJhd0pzb25fKSB7XG4gICAgY29uc3QgcmF3SnNvbiA9IHt9O1xuICAgIHJhd0pzb25bV2lyZS5SQVdfREFUQV9LRVldID0gZ29vZy5qc29uLnNlcmlhbGl6ZShtZXNzYWdlKTtcbiAgICB0aGlzLmNoYW5uZWxfLnNlbmRNYXAocmF3SnNvbik7XG4gIH0gZWxzZSB7XG4gICAgdGhpcy5jaGFubmVsXy5zZW5kTWFwKG1lc3NhZ2UpO1xuICB9XG59O1xuXG5cbi8qKlxuICogQG92ZXJyaWRlXG4gKi9cbldlYkNoYW5uZWxCYXNlVHJhbnNwb3J0LkNoYW5uZWwucHJvdG90eXBlLmRpc3Bvc2VJbnRlcm5hbCA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIHRoaXMuY2hhbm5lbF8uc2V0SGFuZGxlcihudWxsKTtcbiAgZGVsZXRlIHRoaXMuY2hhbm5lbEhhbmRsZXJfO1xuICB0aGlzLmNoYW5uZWxfLmRpc2Nvbm5lY3QoKTtcbiAgZGVsZXRlIHRoaXMuY2hhbm5lbF87XG5cbiAgV2ViQ2hhbm5lbEJhc2VUcmFuc3BvcnQuQ2hhbm5lbC5iYXNlKHRoaXMsICdkaXNwb3NlSW50ZXJuYWwnKTtcbn07XG5cblxuXG4vKipcbiAqIFRoZSBtZXNzYWdlIGV2ZW50LlxuICpcbiAqIEBwYXJhbSB7IUFycmF5PD8+fCFPYmplY3R9IGFycmF5IFRoZSBkYXRhIGFycmF5IGZyb20gdGhlIHVuZGVybHlpbmcgY2hhbm5lbC5cbiAqIEBjb25zdHJ1Y3RvclxuICogQGV4dGVuZHMge2dvb2cubmV0LldlYkNoYW5uZWwuTWVzc2FnZUV2ZW50fVxuICogQGZpbmFsXG4gKi9cbldlYkNoYW5uZWxCYXNlVHJhbnNwb3J0LkNoYW5uZWwuTWVzc2FnZUV2ZW50ID0gZnVuY3Rpb24oYXJyYXkpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBXZWJDaGFubmVsQmFzZVRyYW5zcG9ydC5DaGFubmVsLk1lc3NhZ2VFdmVudC5iYXNlKHRoaXMsICdjb25zdHJ1Y3RvcicpO1xuXG4gIC8vIHNpbmdsZS1tZXRhZGF0YSBvbmx5XG4gIGNvbnN0IG1ldGFkYXRhID0gYXJyYXlbJ19fc21fXyddO1xuICBpZiAobWV0YWRhdGEpIHtcbiAgICB0aGlzLm1ldGFkYXRhS2V5ID0gZ29vZy5vYmplY3QuZ2V0QW55S2V5KG1ldGFkYXRhKTtcbiAgICBpZiAodGhpcy5tZXRhZGF0YUtleSkge1xuICAgICAgdGhpcy5kYXRhID0gZ29vZy5vYmplY3QuZ2V0KG1ldGFkYXRhLCB0aGlzLm1ldGFkYXRhS2V5KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5kYXRhID0gbWV0YWRhdGE7ICAvLyBlbXB0eVxuICAgIH1cbiAgfSBlbHNlIHtcbiAgICB0aGlzLmRhdGEgPSBhcnJheTtcbiAgfVxufTtcbmdvb2cuaW5oZXJpdHMoXG4gICAgV2ViQ2hhbm5lbEJhc2VUcmFuc3BvcnQuQ2hhbm5lbC5NZXNzYWdlRXZlbnQsXG4gICAgZ29vZy5uZXQuV2ViQ2hhbm5lbC5NZXNzYWdlRXZlbnQpO1xuXG5cblxuLyoqXG4gKiBUaGUgZXJyb3IgZXZlbnQuXG4gKlxuICogQHBhcmFtIHtXZWJDaGFubmVsQmFzZS5FcnJvcn0gZXJyb3IgVGhlIGVycm9yIGNvZGUuXG4gKiBAY29uc3RydWN0b3JcbiAqIEBleHRlbmRzIHtnb29nLm5ldC5XZWJDaGFubmVsLkVycm9yRXZlbnR9XG4gKiBAZmluYWxcbiAqL1xuV2ViQ2hhbm5lbEJhc2VUcmFuc3BvcnQuQ2hhbm5lbC5FcnJvckV2ZW50ID0gZnVuY3Rpb24oZXJyb3IpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBXZWJDaGFubmVsQmFzZVRyYW5zcG9ydC5DaGFubmVsLkVycm9yRXZlbnQuYmFzZSh0aGlzLCAnY29uc3RydWN0b3InKTtcblxuICAvKipcbiAgICogSGlnaC1sZXZlbCBzdGF0dXMgY29kZS5cbiAgICovXG4gIHRoaXMuc3RhdHVzID0gZ29vZy5uZXQuV2ViQ2hhbm5lbC5FcnJvclN0YXR1cy5ORVRXT1JLX0VSUk9SO1xuXG4gIC8qKlxuICAgKiBAY29uc3Qge1dlYkNoYW5uZWxCYXNlLkVycm9yfSBJbnRlcm5hbCBlcnJvciBjb2RlLCBmb3IgZGVidWdnaW5nIHVzZSBvbmx5LlxuICAgKi9cbiAgdGhpcy5lcnJvckNvZGUgPSBlcnJvcjtcbn07XG5nb29nLmluaGVyaXRzKFxuICAgIFdlYkNoYW5uZWxCYXNlVHJhbnNwb3J0LkNoYW5uZWwuRXJyb3JFdmVudCwgZ29vZy5uZXQuV2ViQ2hhbm5lbC5FcnJvckV2ZW50KTtcblxuXG5cbi8qKlxuICogSW1wbGVtZW50YXRpb24gb2Yge0BsaW5rIFdlYkNoYW5uZWxCYXNlLkhhbmRsZXJ9IGludGVyZmFjZS5cbiAqXG4gKiBAcGFyYW0geyFXZWJDaGFubmVsQmFzZVRyYW5zcG9ydC5DaGFubmVsfSBjaGFubmVsIFRoZSBlbmNsb3NpbmcgV2ViQ2hhbm5lbC5cbiAqXG4gKiBAY29uc3RydWN0b3JcbiAqIEBleHRlbmRzIHtXZWJDaGFubmVsQmFzZS5IYW5kbGVyfVxuICogQHByaXZhdGVcbiAqL1xuV2ViQ2hhbm5lbEJhc2VUcmFuc3BvcnQuQ2hhbm5lbC5IYW5kbGVyXyA9IGZ1bmN0aW9uKGNoYW5uZWwpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBXZWJDaGFubmVsQmFzZVRyYW5zcG9ydC5DaGFubmVsLkhhbmRsZXJfLmJhc2UodGhpcywgJ2NvbnN0cnVjdG9yJyk7XG5cbiAgLyoqXG4gICAqIEB0eXBlIHshV2ViQ2hhbm5lbEJhc2VUcmFuc3BvcnQuQ2hhbm5lbH1cbiAgICogQHByaXZhdGVcbiAgICovXG4gIHRoaXMuY2hhbm5lbF8gPSBjaGFubmVsO1xufTtcbmdvb2cuaW5oZXJpdHMoV2ViQ2hhbm5lbEJhc2VUcmFuc3BvcnQuQ2hhbm5lbC5IYW5kbGVyXywgV2ViQ2hhbm5lbEJhc2UuSGFuZGxlcik7XG5cblxuLyoqXG4gKiBAb3ZlcnJpZGVcbiAqL1xuV2ViQ2hhbm5lbEJhc2VUcmFuc3BvcnQuQ2hhbm5lbC5IYW5kbGVyXy5wcm90b3R5cGUuY2hhbm5lbE9wZW5lZCA9IGZ1bmN0aW9uKFxuICAgIGNoYW5uZWwpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBnb29nLmxvZy5pbmZvKFxuICAgICAgdGhpcy5jaGFubmVsXy5sb2dnZXJfLCAnV2ViQ2hhbm5lbCBvcGVuZWQgb24gJyArIHRoaXMuY2hhbm5lbF8udXJsXyk7XG4gIHRoaXMuY2hhbm5lbF8uZGlzcGF0Y2hFdmVudChnb29nLm5ldC5XZWJDaGFubmVsLkV2ZW50VHlwZS5PUEVOKTtcbn07XG5cblxuLyoqXG4gKiBAb3ZlcnJpZGVcbiAqL1xuV2ViQ2hhbm5lbEJhc2VUcmFuc3BvcnQuQ2hhbm5lbC5IYW5kbGVyXy5wcm90b3R5cGUuY2hhbm5lbEhhbmRsZUFycmF5ID1cbiAgICBmdW5jdGlvbihjaGFubmVsLCBhcnJheSkge1xuICAndXNlIHN0cmljdCc7XG4gIGdvb2cuYXNzZXJ0cy5hc3NlcnQoYXJyYXksICdhcnJheSBleHBlY3RlZCB0byBiZSBkZWZpbmVkJyk7XG4gIHRoaXMuY2hhbm5lbF8uZGlzcGF0Y2hFdmVudChcbiAgICAgIG5ldyBXZWJDaGFubmVsQmFzZVRyYW5zcG9ydC5DaGFubmVsLk1lc3NhZ2VFdmVudChhcnJheSkpO1xufTtcblxuXG4vKipcbiAqIEBvdmVycmlkZVxuICovXG5XZWJDaGFubmVsQmFzZVRyYW5zcG9ydC5DaGFubmVsLkhhbmRsZXJfLnByb3RvdHlwZS5jaGFubmVsRXJyb3IgPSBmdW5jdGlvbihcbiAgICBjaGFubmVsLCBlcnJvcikge1xuICAndXNlIHN0cmljdCc7XG4gIGdvb2cubG9nLmluZm8oXG4gICAgICB0aGlzLmNoYW5uZWxfLmxvZ2dlcl8sXG4gICAgICAnV2ViQ2hhbm5lbCBhYm9ydGVkIG9uICcgKyB0aGlzLmNoYW5uZWxfLnVybF8gK1xuICAgICAgICAgICcgZHVlIHRvIGNoYW5uZWwgZXJyb3I6ICcgKyBlcnJvcik7XG4gIHRoaXMuY2hhbm5lbF8uZGlzcGF0Y2hFdmVudChcbiAgICAgIG5ldyBXZWJDaGFubmVsQmFzZVRyYW5zcG9ydC5DaGFubmVsLkVycm9yRXZlbnQoZXJyb3IpKTtcbn07XG5cblxuLyoqXG4gKiBAb3ZlcnJpZGVcbiAqL1xuV2ViQ2hhbm5lbEJhc2VUcmFuc3BvcnQuQ2hhbm5lbC5IYW5kbGVyXy5wcm90b3R5cGUuY2hhbm5lbENsb3NlZCA9IGZ1bmN0aW9uKFxuICAgIGNoYW5uZWwsIG9wdF9wZW5kaW5nTWFwcywgb3B0X3VuZGVsaXZlcmVkTWFwcykge1xuICAndXNlIHN0cmljdCc7XG4gIGdvb2cubG9nLmluZm8oXG4gICAgICB0aGlzLmNoYW5uZWxfLmxvZ2dlcl8sICdXZWJDaGFubmVsIGNsb3NlZCBvbiAnICsgdGhpcy5jaGFubmVsXy51cmxfKTtcbiAgdGhpcy5jaGFubmVsXy5kaXNwYXRjaEV2ZW50KGdvb2cubmV0LldlYkNoYW5uZWwuRXZlbnRUeXBlLkNMT1NFKTtcbn07XG5cblxuLyoqXG4gKiBAb3ZlcnJpZGVcbiAqL1xuV2ViQ2hhbm5lbEJhc2VUcmFuc3BvcnQuQ2hhbm5lbC5wcm90b3R5cGUuZ2V0UnVudGltZVByb3BlcnRpZXMgPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gbmV3IFdlYkNoYW5uZWxCYXNlVHJhbnNwb3J0LkNoYW5uZWxQcm9wZXJ0aWVzKHRoaXMuY2hhbm5lbF8pO1xufTtcblxuXG5cbi8qKlxuICogSW1wbGVtZW50YXRpb24gb2YgdGhlIHtAbGluayBnb29nLm5ldC5XZWJDaGFubmVsLlJ1bnRpbWVQcm9wZXJ0aWVzfS5cbiAqXG4gKiBAcGFyYW0geyFXZWJDaGFubmVsQmFzZX0gY2hhbm5lbCBUaGUgdW5kZXJseWluZyBjaGFubmVsIG9iamVjdC5cbiAqXG4gKiBAY29uc3RydWN0b3JcbiAqIEBpbXBsZW1lbnRzIHtnb29nLm5ldC5XZWJDaGFubmVsLlJ1bnRpbWVQcm9wZXJ0aWVzfVxuICogQGZpbmFsXG4gKi9cbldlYkNoYW5uZWxCYXNlVHJhbnNwb3J0LkNoYW5uZWxQcm9wZXJ0aWVzID0gZnVuY3Rpb24oY2hhbm5lbCkge1xuICAndXNlIHN0cmljdCc7XG4gIC8qKlxuICAgKiBUaGUgdW5kZXJseWluZyBjaGFubmVsIG9iamVjdC5cbiAgICpcbiAgICogQHByaXZhdGUgeyFXZWJDaGFubmVsQmFzZX1cbiAgICovXG4gIHRoaXMuY2hhbm5lbF8gPSBjaGFubmVsO1xufTtcblxuXG4vKipcbiAqIEBvdmVycmlkZVxuICovXG5XZWJDaGFubmVsQmFzZVRyYW5zcG9ydC5DaGFubmVsUHJvcGVydGllcy5wcm90b3R5cGUuZ2V0Q29uY3VycmVudFJlcXVlc3RMaW1pdCA9XG4gICAgZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmV0dXJuIHRoaXMuY2hhbm5lbF8uZ2V0Rm9yd2FyZENoYW5uZWxSZXF1ZXN0UG9vbCgpLmdldE1heFNpemUoKTtcbn07XG5cblxuLyoqXG4gKiBAb3ZlcnJpZGVcbiAqL1xuV2ViQ2hhbm5lbEJhc2VUcmFuc3BvcnQuQ2hhbm5lbFByb3BlcnRpZXMucHJvdG90eXBlLmlzU3BkeUVuYWJsZWQgPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gdGhpcy5nZXRDb25jdXJyZW50UmVxdWVzdExpbWl0KCkgPiAxO1xufTtcblxuXG4vKipcbiAqIEBvdmVycmlkZVxuICovXG5XZWJDaGFubmVsQmFzZVRyYW5zcG9ydC5DaGFubmVsUHJvcGVydGllcy5wcm90b3R5cGUuZ2V0UGVuZGluZ1JlcXVlc3RDb3VudCA9XG4gICAgZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmV0dXJuIHRoaXMuY2hhbm5lbF8uZ2V0Rm9yd2FyZENoYW5uZWxSZXF1ZXN0UG9vbCgpLmdldFJlcXVlc3RDb3VudCgpO1xufTtcblxuXG4vKipcbiAqIEBvdmVycmlkZVxuICovXG5XZWJDaGFubmVsQmFzZVRyYW5zcG9ydC5DaGFubmVsUHJvcGVydGllcy5wcm90b3R5cGUuZ2V0SHR0cFNlc3Npb25JZCA9XG4gICAgZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmV0dXJuIHRoaXMuY2hhbm5lbF8uZ2V0SHR0cFNlc3Npb25JZCgpO1xufTtcblxuXG4vKipcbiAqIEBvdmVycmlkZVxuICovXG5XZWJDaGFubmVsQmFzZVRyYW5zcG9ydC5DaGFubmVsUHJvcGVydGllcy5wcm90b3R5cGUuY29tbWl0ID0gZnVuY3Rpb24oXG4gICAgY2FsbGJhY2spIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICB0aGlzLmNoYW5uZWxfLnNldEZvcndhcmRDaGFubmVsRmx1c2hDYWxsYmFjayhjYWxsYmFjayk7XG59O1xuXG5cbi8qKlxuICogQG92ZXJyaWRlXG4gKi9cbldlYkNoYW5uZWxCYXNlVHJhbnNwb3J0LkNoYW5uZWxQcm9wZXJ0aWVzLnByb3RvdHlwZS5nZXROb25BY2tlZE1lc3NhZ2VDb3VudCA9XG4gICAgZ29vZy5hYnN0cmFjdE1ldGhvZDtcblxuXG4vKipcbiAqIEBvdmVycmlkZVxuICovXG5XZWJDaGFubmVsQmFzZVRyYW5zcG9ydC5DaGFubmVsUHJvcGVydGllcy5wcm90b3R5cGUubm90aWZ5Tm9uQWNrZWRNZXNzYWdlQ291bnQgPVxuICAgIGdvb2cuYWJzdHJhY3RNZXRob2Q7XG5cblxuLyoqXG4gKiBAb3ZlcnJpZGVcbiAqL1xuV2ViQ2hhbm5lbEJhc2VUcmFuc3BvcnQuQ2hhbm5lbFByb3BlcnRpZXMucHJvdG90eXBlLm9uQ29tbWl0ID1cbiAgICBnb29nLmFic3RyYWN0TWV0aG9kO1xuXG5cbi8qKlxuICogQG92ZXJyaWRlXG4gKi9cbldlYkNoYW5uZWxCYXNlVHJhbnNwb3J0LkNoYW5uZWxQcm9wZXJ0aWVzLnByb3RvdHlwZS5hY2tDb21taXQgPVxuICAgIGdvb2cuYWJzdHJhY3RNZXRob2Q7XG5cblxuLyoqIEBvdmVycmlkZSAqL1xuV2ViQ2hhbm5lbEJhc2VUcmFuc3BvcnQuQ2hhbm5lbFByb3BlcnRpZXMucHJvdG90eXBlLmdldExhc3RTdGF0dXNDb2RlID1cbiAgICBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICByZXR1cm4gdGhpcy5jaGFubmVsXy5nZXRMYXN0U3RhdHVzQ29kZSgpO1xufTtcbn0pOyAgLy8gZ29vZy5zY29wZVxuIiwgIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbi8qKlxuICogQnJpbmcgaW4gY2xvc3VyZS1saWJyYXJ5IGRlcGVuZGVuY2llc1xuICovXG5cbmdvb2cucHJvdmlkZSgnZmlyZWJhc2Uud2ViY2hhbm5lbC53cmFwcGVyJyk7XG5cbi8vIGdvb2cubmV0LldlYkNoYW5uZWxUcmFuc3BvcnRcbmdvb2cucmVxdWlyZSgnZ29vZy5uZXQuY3JlYXRlV2ViQ2hhbm5lbFRyYW5zcG9ydCcpO1xuZ29vZy5yZXF1aXJlKCdnb29nLm5ldC5GZXRjaFhtbEh0dHBGYWN0b3J5Jyk7XG5nb29nLnJlcXVpcmUoJ2dvb2cubGFicy5uZXQud2ViQ2hhbm5lbC5yZXF1ZXN0U3RhdHMnKTtcbmdvb2cucmVxdWlyZSgnZ29vZy5sYWJzLm5ldC53ZWJDaGFubmVsLldlYkNoYW5uZWxCYXNlVHJhbnNwb3J0Jyk7XG5cbi8qKlxuICogTk9URTogVGhlIGBjcmVhdGVXZWJDaGFubmVsYCBmdW5jdGlvbiB0YWtlcyBhbiBvcHRpb25zIG9iamVjdCBhcyBhIHNlY29uZCBwYXJhbVxuICogd2hvc2UgcHJvcGVydGllcyBhcmUgdHlwaWNhbGx5IG1hbmdsZWQuIFdlIG92ZXJyaWRlIHRoZXNlIGluIGV4dGVybnMvb3ZlcnJpZGVzLmpzXG4gKiBXaXRob3V0IHRob3NlIGV4dGVybnMsIHRoaXMgZG9lcyBub3QgZnVuY3Rpb24gcHJvcGVybHkuXG4gKi9cbmdvb2cubGFicy5uZXQud2ViQ2hhbm5lbC5XZWJDaGFubmVsQmFzZVRyYW5zcG9ydC5wcm90b3R5cGVbJ2NyZWF0ZVdlYkNoYW5uZWwnXSA9XG4gIGdvb2cubGFicy5uZXQud2ViQ2hhbm5lbC5XZWJDaGFubmVsQmFzZVRyYW5zcG9ydC5wcm90b3R5cGUuY3JlYXRlV2ViQ2hhbm5lbDtcbmdvb2cubGFicy5uZXQud2ViQ2hhbm5lbC5XZWJDaGFubmVsQmFzZVRyYW5zcG9ydC5DaGFubmVsLnByb3RvdHlwZVsnc2VuZCddID1cbiAgZ29vZy5sYWJzLm5ldC53ZWJDaGFubmVsLldlYkNoYW5uZWxCYXNlVHJhbnNwb3J0LkNoYW5uZWwucHJvdG90eXBlLnNlbmQ7XG5nb29nLmxhYnMubmV0LndlYkNoYW5uZWwuV2ViQ2hhbm5lbEJhc2VUcmFuc3BvcnQuQ2hhbm5lbC5wcm90b3R5cGVbJ29wZW4nXSA9XG4gIGdvb2cubGFicy5uZXQud2ViQ2hhbm5lbC5XZWJDaGFubmVsQmFzZVRyYW5zcG9ydC5DaGFubmVsLnByb3RvdHlwZS5vcGVuO1xuZ29vZy5sYWJzLm5ldC53ZWJDaGFubmVsLldlYkNoYW5uZWxCYXNlVHJhbnNwb3J0LkNoYW5uZWwucHJvdG90eXBlWydjbG9zZSddID1cbiAgZ29vZy5sYWJzLm5ldC53ZWJDaGFubmVsLldlYkNoYW5uZWxCYXNlVHJhbnNwb3J0LkNoYW5uZWwucHJvdG90eXBlLmNsb3NlO1xuXG4vLyBnb29nLm5ldC5FcnJvckNvZGVcbmdvb2cucmVxdWlyZSgnZ29vZy5uZXQuRXJyb3JDb2RlJyk7XG5nb29nLm5ldC5FcnJvckNvZGVbJ05PX0VSUk9SJ10gPSBnb29nLm5ldC5FcnJvckNvZGUuTk9fRVJST1I7XG5nb29nLm5ldC5FcnJvckNvZGVbJ1RJTUVPVVQnXSA9IGdvb2cubmV0LkVycm9yQ29kZS5USU1FT1VUO1xuZ29vZy5uZXQuRXJyb3JDb2RlWydIVFRQX0VSUk9SJ10gPSBnb29nLm5ldC5FcnJvckNvZGUuSFRUUF9FUlJPUjtcblxuLy8gZ29vZy5uZXQuRXJyb3JUeXBlXG5nb29nLnJlcXVpcmUoJ2dvb2cubmV0LkV2ZW50VHlwZScpO1xuZ29vZy5uZXQuRXZlbnRUeXBlWydDT01QTEVURSddID0gZ29vZy5uZXQuRXZlbnRUeXBlLkNPTVBMRVRFO1xuXG4vLyBnb29nLm5ldC5XZWJDaGFubmVsXG5nb29nLnJlcXVpcmUoJ2dvb2cubmV0LldlYkNoYW5uZWwnKTtcbmdvb2cucmVxdWlyZSgnZ29vZy5ldmVudHMuRXZlbnRUYXJnZXQnKTtcbmdvb2cubmV0LldlYkNoYW5uZWxbJ0V2ZW50VHlwZSddID0gZ29vZy5uZXQuV2ViQ2hhbm5lbC5FdmVudFR5cGU7XG5nb29nLm5ldC5XZWJDaGFubmVsLkV2ZW50VHlwZVsnT1BFTiddID0gZ29vZy5uZXQuV2ViQ2hhbm5lbC5FdmVudFR5cGUuT1BFTjtcbmdvb2cubmV0LldlYkNoYW5uZWwuRXZlbnRUeXBlWydDTE9TRSddID0gZ29vZy5uZXQuV2ViQ2hhbm5lbC5FdmVudFR5cGUuQ0xPU0U7XG5nb29nLm5ldC5XZWJDaGFubmVsLkV2ZW50VHlwZVsnRVJST1InXSA9IGdvb2cubmV0LldlYkNoYW5uZWwuRXZlbnRUeXBlLkVSUk9SO1xuZ29vZy5uZXQuV2ViQ2hhbm5lbC5FdmVudFR5cGVbJ01FU1NBR0UnXSA9XG4gIGdvb2cubmV0LldlYkNoYW5uZWwuRXZlbnRUeXBlLk1FU1NBR0U7XG5nb29nLmV2ZW50cy5FdmVudFRhcmdldC5wcm90b3R5cGVbJ2xpc3RlbiddID1cbiAgZ29vZy5ldmVudHMuRXZlbnRUYXJnZXQucHJvdG90eXBlLmxpc3RlbjtcblxuZ29vZy5yZXF1aXJlKCdnb29nLm5ldC5YaHJJbycpO1xuZ29vZy5uZXQuWGhySW8ucHJvdG90eXBlWydsaXN0ZW5PbmNlJ10gPSBnb29nLm5ldC5YaHJJby5wcm90b3R5cGUubGlzdGVuT25jZTtcbmdvb2cubmV0LlhocklvLnByb3RvdHlwZVsnZ2V0TGFzdEVycm9yJ10gPVxuICBnb29nLm5ldC5YaHJJby5wcm90b3R5cGUuZ2V0TGFzdEVycm9yO1xuZ29vZy5uZXQuWGhySW8ucHJvdG90eXBlWydnZXRMYXN0RXJyb3JDb2RlJ10gPVxuICBnb29nLm5ldC5YaHJJby5wcm90b3R5cGUuZ2V0TGFzdEVycm9yQ29kZTtcbmdvb2cubmV0LlhocklvLnByb3RvdHlwZVsnZ2V0U3RhdHVzJ10gPSBnb29nLm5ldC5YaHJJby5wcm90b3R5cGUuZ2V0U3RhdHVzO1xuZ29vZy5uZXQuWGhySW8ucHJvdG90eXBlWydnZXRSZXNwb25zZUpzb24nXSA9XG4gIGdvb2cubmV0LlhocklvLnByb3RvdHlwZS5nZXRSZXNwb25zZUpzb247XG5nb29nLm5ldC5YaHJJby5wcm90b3R5cGVbJ2dldFJlc3BvbnNlVGV4dCddID1cbiAgZ29vZy5uZXQuWGhySW8ucHJvdG90eXBlLmdldFJlc3BvbnNlVGV4dDtcbmdvb2cubmV0LlhocklvLnByb3RvdHlwZVsnc2VuZCddID0gZ29vZy5uZXQuWGhySW8ucHJvdG90eXBlLnNlbmQ7XG5cbm1vZHVsZVsnZXhwb3J0cyddWydjcmVhdGVXZWJDaGFubmVsVHJhbnNwb3J0J10gPVxuICBnb29nLm5ldC5jcmVhdGVXZWJDaGFubmVsVHJhbnNwb3J0O1xubW9kdWxlWydleHBvcnRzJ11bJ2dldFN0YXRFdmVudFRhcmdldCddID1cbiAgZ29vZy5sYWJzLm5ldC53ZWJDaGFubmVsLnJlcXVlc3RTdGF0cy5nZXRTdGF0RXZlbnRUYXJnZXQ7XG5tb2R1bGVbJ2V4cG9ydHMnXVsnRXJyb3JDb2RlJ10gPSBnb29nLm5ldC5FcnJvckNvZGU7XG5tb2R1bGVbJ2V4cG9ydHMnXVsnRXZlbnRUeXBlJ10gPSBnb29nLm5ldC5FdmVudFR5cGU7XG5tb2R1bGVbJ2V4cG9ydHMnXVsnRXZlbnQnXSA9IGdvb2cubGFicy5uZXQud2ViQ2hhbm5lbC5yZXF1ZXN0U3RhdHMuRXZlbnQ7XG5tb2R1bGVbJ2V4cG9ydHMnXVsnU3RhdCddID0gZ29vZy5sYWJzLm5ldC53ZWJDaGFubmVsLnJlcXVlc3RTdGF0cy5TdGF0O1xubW9kdWxlWydleHBvcnRzJ11bJ0ZldGNoWG1sSHR0cEZhY3RvcnknXSA9IGdvb2cubmV0LkZldGNoWG1sSHR0cEZhY3Rvcnk7XG5tb2R1bGVbJ2V4cG9ydHMnXVsnV2ViQ2hhbm5lbCddID0gZ29vZy5uZXQuV2ViQ2hhbm5lbDtcbm1vZHVsZVsnZXhwb3J0cyddWydYaHJJbyddID0gZ29vZy5uZXQuWGhySW87XG4iLCAiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IFRoZSBDbG9zdXJlIExpYnJhcnkgQXV0aG9ycy5cbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuLyoqXG4gKiBAZmlsZW92ZXJ2aWV3IERlZmF1bHQgZmFjdG9yeSBmb3IgPGNvZGU+V2ViQ2hhbm5lbFRyYW5zcG9ydDwvY29kZT4gdG9cbiAqIGF2b2lkIGV4cG9zaW5nIGNvbmNyZXRlIGNsYXNzZXMgdG8gY2xpZW50cy5cbiAqL1xuXG5nb29nLnByb3ZpZGUoJ2dvb2cubmV0LmNyZWF0ZVdlYkNoYW5uZWxUcmFuc3BvcnQnKTtcblxuZ29vZy5yZXF1aXJlKCdnb29nLmxhYnMubmV0LndlYkNoYW5uZWwuV2ViQ2hhbm5lbEJhc2VUcmFuc3BvcnQnKTtcbmdvb2cucmVxdWlyZVR5cGUoJ2dvb2cubmV0LldlYkNoYW5uZWxUcmFuc3BvcnQnKTtcblxuXG4vKipcbiAqIENyZWF0ZSBhIG5ldyBXZWJDaGFubmVsVHJhbnNwb3J0IGluc3RhbmNlIHVzaW5nIHRoZSBkZWZhdWx0IGltcGxlbWVudGF0aW9uLlxuICogVGhyb3dzIGFuIGVycm9yIG1lc3NhZ2UgaWYgbm8gZGVmYXVsdCB0cmFuc3BvcnQgYXZhaWxhYmxlIGluIHRoZSBjdXJyZW50XG4gKiBlbnZpcm9ubWVudC5cbiAqXG4gKiBAcmV0dXJuIHshZ29vZy5uZXQuV2ViQ2hhbm5lbFRyYW5zcG9ydH0gdGhlIG5ld2x5IGNyZWF0ZWQgdHJhbnNwb3J0IGluc3RhbmNlLlxuICovXG5nb29nLm5ldC5jcmVhdGVXZWJDaGFubmVsVHJhbnNwb3J0ID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgcmV0dXJuIG5ldyBnb29nLmxhYnMubmV0LndlYkNoYW5uZWwuV2ViQ2hhbm5lbEJhc2VUcmFuc3BvcnQoKTtcbn07XG4iLCAiaW1wb3J0IHsgX2dldFByb3ZpZGVyLCBnZXRBcHAgYXMgdCwgX3JlbW92ZVNlcnZpY2VJbnN0YW5jZSBhcyBlLCBfcmVnaXN0ZXJDb21wb25lbnQgYXMgbiwgcmVnaXN0ZXJWZXJzaW9uIGFzIHMsIFNES19WRVJTSU9OIGFzIGkgfSBmcm9tIFwiQGZpcmViYXNlL2FwcFwiO1xuXG5pbXBvcnQgeyBDb21wb25lbnQgYXMgciB9IGZyb20gXCJAZmlyZWJhc2UvY29tcG9uZW50XCI7XG5cbmltcG9ydCB7IExvZ2dlciBhcyBvLCBMb2dMZXZlbCBhcyB1IH0gZnJvbSBcIkBmaXJlYmFzZS9sb2dnZXJcIjtcblxuaW1wb3J0IHsgRmlyZWJhc2VFcnJvciBhcyBhLCBnZXRVQSBhcyBjLCBpc0luZGV4ZWREQkF2YWlsYWJsZSBhcyBoLCBpc1NhZmFyaSBhcyBsLCBpc01vYmlsZUNvcmRvdmEgYXMgZiwgaXNSZWFjdE5hdGl2ZSBhcyBkLCBpc0VsZWN0cm9uIGFzIF8sIGlzSUUgYXMgdywgaXNVV1AgYXMgbSwgaXNCcm93c2VyRXh0ZW5zaW9uIGFzIGcsIGNyZWF0ZU1vY2tVc2VyVG9rZW4gYXMgeSwgZ2V0TW9kdWxhckluc3RhbmNlIGFzIHAsIGRlZXBFcXVhbCBhcyBJIH0gZnJvbSBcIkBmaXJlYmFzZS91dGlsXCI7XG5cbmltcG9ydCB7IFhocklvIGFzIFQsIEV2ZW50VHlwZSBhcyBFLCBFcnJvckNvZGUgYXMgQSwgY3JlYXRlV2ViQ2hhbm5lbFRyYW5zcG9ydCBhcyBSLCBnZXRTdGF0RXZlbnRUYXJnZXQgYXMgYiwgRmV0Y2hYbWxIdHRwRmFjdG9yeSBhcyBQLCBXZWJDaGFubmVsIGFzIFYsIEV2ZW50IGFzIHYsIFN0YXQgYXMgUyB9IGZyb20gXCJAZmlyZWJhc2Uvd2ViY2hhbm5lbC13cmFwcGVyXCI7XG5cbmNvbnN0IEQgPSBcIkBmaXJlYmFzZS9maXJlc3RvcmVcIjtcblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogU2ltcGxlIHdyYXBwZXIgYXJvdW5kIGEgbnVsbGFibGUgVUlELiBNb3N0bHkgZXhpc3RzIHRvIG1ha2UgY29kZSBtb3JlXG4gKiByZWFkYWJsZS5cbiAqL1xuY2xhc3MgQyB7XG4gICAgY29uc3RydWN0b3IodCkge1xuICAgICAgICB0aGlzLnVpZCA9IHQ7XG4gICAgfVxuICAgIGlzQXV0aGVudGljYXRlZCgpIHtcbiAgICAgICAgcmV0dXJuIG51bGwgIT0gdGhpcy51aWQ7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgYSBrZXkgcmVwcmVzZW50aW5nIHRoaXMgdXNlciwgc3VpdGFibGUgZm9yIGluY2x1c2lvbiBpbiBhXG4gICAgICogZGljdGlvbmFyeS5cbiAgICAgKi8gICAgdG9LZXkoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmlzQXV0aGVudGljYXRlZCgpID8gXCJ1aWQ6XCIgKyB0aGlzLnVpZCA6IFwiYW5vbnltb3VzLXVzZXJcIjtcbiAgICB9XG4gICAgaXNFcXVhbCh0KSB7XG4gICAgICAgIHJldHVybiB0LnVpZCA9PT0gdGhpcy51aWQ7XG4gICAgfVxufVxuXG4vKiogQSB1c2VyIHdpdGggYSBudWxsIFVJRC4gKi8gQy5VTkFVVEhFTlRJQ0FURUQgPSBuZXcgQyhudWxsKSwgXG4vLyBUT0RPKG1pa2VsZWhlbik6IExvb2sgaW50byBnZXR0aW5nIGEgcHJvcGVyIHVpZC1lcXVpdmFsZW50IGZvclxuLy8gbm9uLUZpcmViYXNlQXV0aCBwcm92aWRlcnMuXG5DLkdPT0dMRV9DUkVERU5USUFMUyA9IG5ldyBDKFwiZ29vZ2xlLWNyZWRlbnRpYWxzLXVpZFwiKSwgQy5GSVJTVF9QQVJUWSA9IG5ldyBDKFwiZmlyc3QtcGFydHktdWlkXCIpLCBcbkMuTU9DS19VU0VSID0gbmV3IEMoXCJtb2NrLXVzZXJcIik7XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5sZXQgeCA9IFwiOS44LjBcIjtcblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmNvbnN0IE4gPSBuZXcgbyhcIkBmaXJlYmFzZS9maXJlc3RvcmVcIik7XG5cbi8vIEhlbHBlciBtZXRob2RzIGFyZSBuZWVkZWQgYmVjYXVzZSB2YXJpYWJsZXMgY2FuJ3QgYmUgZXhwb3J0ZWQgYXMgcmVhZC93cml0ZVxuZnVuY3Rpb24gaygpIHtcbiAgICByZXR1cm4gTi5sb2dMZXZlbDtcbn1cblxuLyoqXG4gKiBTZXRzIHRoZSB2ZXJib3NpdHkgb2YgQ2xvdWQgRmlyZXN0b3JlIGxvZ3MgKGRlYnVnLCBlcnJvciwgb3Igc2lsZW50KS5cbiAqXG4gKiBAcGFyYW0gbG9nTGV2ZWwgLSBUaGUgdmVyYm9zaXR5IHlvdSBzZXQgZm9yIGFjdGl2aXR5IGFuZCBlcnJvciBsb2dnaW5nLiBDYW5cbiAqICAgYmUgYW55IG9mIHRoZSBmb2xsb3dpbmcgdmFsdWVzOlxuICpcbiAqICAgPHVsPlxuICogICAgIDxsaT5gZGVidWdgIGZvciB0aGUgbW9zdCB2ZXJib3NlIGxvZ2dpbmcgbGV2ZWwsIHByaW1hcmlseSBmb3JcbiAqICAgICBkZWJ1Z2dpbmcuPC9saT5cbiAqICAgICA8bGk+YGVycm9yYCB0byBsb2cgZXJyb3JzIG9ubHkuPC9saT5cbiAqICAgICA8bGk+PGNvZGU+YHNpbGVudGAgdG8gdHVybiBvZmYgbG9nZ2luZy48L2xpPlxuICogICA8L3VsPlxuICovIGZ1bmN0aW9uIE0odCkge1xuICAgIE4uc2V0TG9nTGV2ZWwodCk7XG59XG5cbmZ1bmN0aW9uIE8odCwgLi4uZSkge1xuICAgIGlmIChOLmxvZ0xldmVsIDw9IHUuREVCVUcpIHtcbiAgICAgICAgY29uc3QgbiA9IGUubWFwKEIpO1xuICAgICAgICBOLmRlYnVnKGBGaXJlc3RvcmUgKCR7eH0pOiAke3R9YCwgLi4ubik7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBGKHQsIC4uLmUpIHtcbiAgICBpZiAoTi5sb2dMZXZlbCA8PSB1LkVSUk9SKSB7XG4gICAgICAgIGNvbnN0IG4gPSBlLm1hcChCKTtcbiAgICAgICAgTi5lcnJvcihgRmlyZXN0b3JlICgke3h9KTogJHt0fWAsIC4uLm4pO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAaW50ZXJuYWxcbiAqLyBmdW5jdGlvbiAkKHQsIC4uLmUpIHtcbiAgICBpZiAoTi5sb2dMZXZlbCA8PSB1LldBUk4pIHtcbiAgICAgICAgY29uc3QgbiA9IGUubWFwKEIpO1xuICAgICAgICBOLndhcm4oYEZpcmVzdG9yZSAoJHt4fSk6ICR7dH1gLCAuLi5uKTtcbiAgICB9XG59XG5cbi8qKlxuICogQ29udmVydHMgYW4gYWRkaXRpb25hbCBsb2cgcGFyYW1ldGVyIHRvIGEgc3RyaW5nIHJlcHJlc2VudGF0aW9uLlxuICovIGZ1bmN0aW9uIEIodCkge1xuICAgIGlmIChcInN0cmluZ1wiID09IHR5cGVvZiB0KSByZXR1cm4gdDtcbiAgICB0cnkge1xuICAgICAgICByZXR1cm4gZSA9IHQsIEpTT04uc3RyaW5naWZ5KGUpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgLy8gQ29udmVydGluZyB0byBKU09OIGZhaWxlZCwganVzdCBsb2cgdGhlIG9iamVjdCBkaXJlY3RseVxuICAgICAgICByZXR1cm4gdDtcbiAgICB9XG4gICAgLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbiAgICAvKiogRm9ybWF0cyBhbiBvYmplY3QgYXMgYSBKU09OIHN0cmluZywgc3VpdGFibGUgZm9yIGxvZ2dpbmcuICovXG4gICAgdmFyIGU7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIFVuY29uZGl0aW9uYWxseSBmYWlscywgdGhyb3dpbmcgYW4gRXJyb3Igd2l0aCB0aGUgZ2l2ZW4gbWVzc2FnZS5cbiAqIE1lc3NhZ2VzIGFyZSBzdHJpcHBlZCBpbiBwcm9kdWN0aW9uIGJ1aWxkcy5cbiAqXG4gKiBSZXR1cm5zIGBuZXZlcmAgYW5kIGNhbiBiZSB1c2VkIGluIGV4cHJlc3Npb25zOlxuICogQGV4YW1wbGVcbiAqIGxldCBmdXR1cmVWYXIgPSBmYWlsKCdub3QgaW1wbGVtZW50ZWQgeWV0Jyk7XG4gKi8gZnVuY3Rpb24gTCh0ID0gXCJVbmV4cGVjdGVkIHN0YXRlXCIpIHtcbiAgICAvLyBMb2cgdGhlIGZhaWx1cmUgaW4gYWRkaXRpb24gdG8gdGhyb3cgYW4gZXhjZXB0aW9uLCBqdXN0IGluIGNhc2UgdGhlXG4gICAgLy8gZXhjZXB0aW9uIGlzIHN3YWxsb3dlZC5cbiAgICBjb25zdCBlID0gYEZJUkVTVE9SRSAoJHt4fSkgSU5URVJOQUwgQVNTRVJUSU9OIEZBSUxFRDogYCArIHQ7XG4gICAgLy8gTk9URTogV2UgZG9uJ3QgdXNlIEZpcmVzdG9yZUVycm9yIGhlcmUgYmVjYXVzZSB0aGVzZSBhcmUgaW50ZXJuYWwgZmFpbHVyZXNcbiAgICAvLyB0aGF0IGNhbm5vdCBiZSBoYW5kbGVkIGJ5IHRoZSB1c2VyLiAoQWxzbyBpdCB3b3VsZCBjcmVhdGUgYSBjaXJjdWxhclxuICAgIC8vIGRlcGVuZGVuY3kgYmV0d2VlbiB0aGUgZXJyb3IgYW5kIGFzc2VydCBtb2R1bGVzIHdoaWNoIGRvZXNuJ3Qgd29yay4pXG4gICAgdGhyb3cgRihlKSwgbmV3IEVycm9yKGUpO1xufVxuXG4vKipcbiAqIEZhaWxzIGlmIHRoZSBnaXZlbiBhc3NlcnRpb24gY29uZGl0aW9uIGlzIGZhbHNlLCB0aHJvd2luZyBhbiBFcnJvciB3aXRoIHRoZVxuICogZ2l2ZW4gbWVzc2FnZSBpZiBpdCBkaWQuXG4gKlxuICogTWVzc2FnZXMgYXJlIHN0cmlwcGVkIGluIHByb2R1Y3Rpb24gYnVpbGRzLlxuICovIGZ1bmN0aW9uIFUodCwgZSkge1xuICAgIHQgfHwgTCgpO1xufVxuXG4vKipcbiAqIEZhaWxzIGlmIHRoZSBnaXZlbiBhc3NlcnRpb24gY29uZGl0aW9uIGlzIGZhbHNlLCB0aHJvd2luZyBhbiBFcnJvciB3aXRoIHRoZVxuICogZ2l2ZW4gbWVzc2FnZSBpZiBpdCBkaWQuXG4gKlxuICogVGhlIGNvZGUgb2YgY2FsbHNpdGVzIGludm9raW5nIHRoaXMgZnVuY3Rpb24gYXJlIHN0cmlwcGVkIG91dCBpbiBwcm9kdWN0aW9uXG4gKiBidWlsZHMuIEFueSBzaWRlLWVmZmVjdHMgb2YgY29kZSB3aXRoaW4gdGhlIGRlYnVnQXNzZXJ0KCkgaW52b2NhdGlvbiB3aWxsIG5vdFxuICogaGFwcGVuIGluIHRoaXMgY2FzZS5cbiAqXG4gKiBAaW50ZXJuYWxcbiAqLyBmdW5jdGlvbiBxKHQsIGUpIHtcbiAgICB0IHx8IEwoKTtcbn1cblxuLyoqXG4gKiBDYXN0cyBgb2JqYCB0byBgVGAuIEluIG5vbi1wcm9kdWN0aW9uIGJ1aWxkcywgdmVyaWZpZXMgdGhhdCBgb2JqYCBpcyBhblxuICogaW5zdGFuY2Ugb2YgYFRgIGJlZm9yZSBjYXN0aW5nLlxuICovIGZ1bmN0aW9uIEsodCwgXG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuZSkge1xuICAgIHJldHVybiB0O1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqLyBjb25zdCBHID0ge1xuICAgIC8vIENhdXNlcyBhcmUgY29waWVkIGZyb206XG4gICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL2dycGMvZ3JwYy9ibG9iL2JjZWVjOTRlYTRmYzVmMDA4NWQ4MTIzNWQ4ZTFjMDY3OThkYzM0MWEvaW5jbHVkZS9ncnBjJTJCJTJCL2ltcGwvY29kZWdlbi9zdGF0dXNfY29kZV9lbnVtLmhcbiAgICAvKiogTm90IGFuIGVycm9yOyByZXR1cm5lZCBvbiBzdWNjZXNzLiAqL1xuICAgIE9LOiBcIm9rXCIsXG4gICAgLyoqIFRoZSBvcGVyYXRpb24gd2FzIGNhbmNlbGxlZCAodHlwaWNhbGx5IGJ5IHRoZSBjYWxsZXIpLiAqL1xuICAgIENBTkNFTExFRDogXCJjYW5jZWxsZWRcIixcbiAgICAvKiogVW5rbm93biBlcnJvciBvciBhbiBlcnJvciBmcm9tIGEgZGlmZmVyZW50IGVycm9yIGRvbWFpbi4gKi9cbiAgICBVTktOT1dOOiBcInVua25vd25cIixcbiAgICAvKipcbiAgICAgKiBDbGllbnQgc3BlY2lmaWVkIGFuIGludmFsaWQgYXJndW1lbnQuIE5vdGUgdGhhdCB0aGlzIGRpZmZlcnMgZnJvbVxuICAgICAqIEZBSUxFRF9QUkVDT05ESVRJT04uIElOVkFMSURfQVJHVU1FTlQgaW5kaWNhdGVzIGFyZ3VtZW50cyB0aGF0IGFyZVxuICAgICAqIHByb2JsZW1hdGljIHJlZ2FyZGxlc3Mgb2YgdGhlIHN0YXRlIG9mIHRoZSBzeXN0ZW0gKGUuZy4sIGEgbWFsZm9ybWVkIGZpbGVcbiAgICAgKiBuYW1lKS5cbiAgICAgKi9cbiAgICBJTlZBTElEX0FSR1VNRU5UOiBcImludmFsaWQtYXJndW1lbnRcIixcbiAgICAvKipcbiAgICAgKiBEZWFkbGluZSBleHBpcmVkIGJlZm9yZSBvcGVyYXRpb24gY291bGQgY29tcGxldGUuIEZvciBvcGVyYXRpb25zIHRoYXRcbiAgICAgKiBjaGFuZ2UgdGhlIHN0YXRlIG9mIHRoZSBzeXN0ZW0sIHRoaXMgZXJyb3IgbWF5IGJlIHJldHVybmVkIGV2ZW4gaWYgdGhlXG4gICAgICogb3BlcmF0aW9uIGhhcyBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5LiBGb3IgZXhhbXBsZSwgYSBzdWNjZXNzZnVsIHJlc3BvbnNlXG4gICAgICogZnJvbSBhIHNlcnZlciBjb3VsZCBoYXZlIGJlZW4gZGVsYXllZCBsb25nIGVub3VnaCBmb3IgdGhlIGRlYWRsaW5lIHRvXG4gICAgICogZXhwaXJlLlxuICAgICAqL1xuICAgIERFQURMSU5FX0VYQ0VFREVEOiBcImRlYWRsaW5lLWV4Y2VlZGVkXCIsXG4gICAgLyoqIFNvbWUgcmVxdWVzdGVkIGVudGl0eSAoZS5nLiwgZmlsZSBvciBkaXJlY3RvcnkpIHdhcyBub3QgZm91bmQuICovXG4gICAgTk9UX0ZPVU5EOiBcIm5vdC1mb3VuZFwiLFxuICAgIC8qKlxuICAgICAqIFNvbWUgZW50aXR5IHRoYXQgd2UgYXR0ZW1wdGVkIHRvIGNyZWF0ZSAoZS5nLiwgZmlsZSBvciBkaXJlY3RvcnkpIGFscmVhZHlcbiAgICAgKiBleGlzdHMuXG4gICAgICovXG4gICAgQUxSRUFEWV9FWElTVFM6IFwiYWxyZWFkeS1leGlzdHNcIixcbiAgICAvKipcbiAgICAgKiBUaGUgY2FsbGVyIGRvZXMgbm90IGhhdmUgcGVybWlzc2lvbiB0byBleGVjdXRlIHRoZSBzcGVjaWZpZWQgb3BlcmF0aW9uLlxuICAgICAqIFBFUk1JU1NJT05fREVOSUVEIG11c3Qgbm90IGJlIHVzZWQgZm9yIHJlamVjdGlvbnMgY2F1c2VkIGJ5IGV4aGF1c3RpbmdcbiAgICAgKiBzb21lIHJlc291cmNlICh1c2UgUkVTT1VSQ0VfRVhIQVVTVEVEIGluc3RlYWQgZm9yIHRob3NlIGVycm9ycykuXG4gICAgICogUEVSTUlTU0lPTl9ERU5JRUQgbXVzdCBub3QgYmUgdXNlZCBpZiB0aGUgY2FsbGVyIGNhbiBub3QgYmUgaWRlbnRpZmllZFxuICAgICAqICh1c2UgVU5BVVRIRU5USUNBVEVEIGluc3RlYWQgZm9yIHRob3NlIGVycm9ycykuXG4gICAgICovXG4gICAgUEVSTUlTU0lPTl9ERU5JRUQ6IFwicGVybWlzc2lvbi1kZW5pZWRcIixcbiAgICAvKipcbiAgICAgKiBUaGUgcmVxdWVzdCBkb2VzIG5vdCBoYXZlIHZhbGlkIGF1dGhlbnRpY2F0aW9uIGNyZWRlbnRpYWxzIGZvciB0aGVcbiAgICAgKiBvcGVyYXRpb24uXG4gICAgICovXG4gICAgVU5BVVRIRU5USUNBVEVEOiBcInVuYXV0aGVudGljYXRlZFwiLFxuICAgIC8qKlxuICAgICAqIFNvbWUgcmVzb3VyY2UgaGFzIGJlZW4gZXhoYXVzdGVkLCBwZXJoYXBzIGEgcGVyLXVzZXIgcXVvdGEsIG9yIHBlcmhhcHMgdGhlXG4gICAgICogZW50aXJlIGZpbGUgc3lzdGVtIGlzIG91dCBvZiBzcGFjZS5cbiAgICAgKi9cbiAgICBSRVNPVVJDRV9FWEhBVVNURUQ6IFwicmVzb3VyY2UtZXhoYXVzdGVkXCIsXG4gICAgLyoqXG4gICAgICogT3BlcmF0aW9uIHdhcyByZWplY3RlZCBiZWNhdXNlIHRoZSBzeXN0ZW0gaXMgbm90IGluIGEgc3RhdGUgcmVxdWlyZWQgZm9yXG4gICAgICogdGhlIG9wZXJhdGlvbidzIGV4ZWN1dGlvbi4gRm9yIGV4YW1wbGUsIGRpcmVjdG9yeSB0byBiZSBkZWxldGVkIG1heSBiZVxuICAgICAqIG5vbi1lbXB0eSwgYW4gcm1kaXIgb3BlcmF0aW9uIGlzIGFwcGxpZWQgdG8gYSBub24tZGlyZWN0b3J5LCBldGMuXG4gICAgICpcbiAgICAgKiBBIGxpdG11cyB0ZXN0IHRoYXQgbWF5IGhlbHAgYSBzZXJ2aWNlIGltcGxlbWVudG9yIGluIGRlY2lkaW5nXG4gICAgICogYmV0d2VlbiBGQUlMRURfUFJFQ09ORElUSU9OLCBBQk9SVEVELCBhbmQgVU5BVkFJTEFCTEU6XG4gICAgICogIChhKSBVc2UgVU5BVkFJTEFCTEUgaWYgdGhlIGNsaWVudCBjYW4gcmV0cnkganVzdCB0aGUgZmFpbGluZyBjYWxsLlxuICAgICAqICAoYikgVXNlIEFCT1JURUQgaWYgdGhlIGNsaWVudCBzaG91bGQgcmV0cnkgYXQgYSBoaWdoZXItbGV2ZWxcbiAgICAgKiAgICAgIChlLmcuLCByZXN0YXJ0aW5nIGEgcmVhZC1tb2RpZnktd3JpdGUgc2VxdWVuY2UpLlxuICAgICAqICAoYykgVXNlIEZBSUxFRF9QUkVDT05ESVRJT04gaWYgdGhlIGNsaWVudCBzaG91bGQgbm90IHJldHJ5IHVudGlsXG4gICAgICogICAgICB0aGUgc3lzdGVtIHN0YXRlIGhhcyBiZWVuIGV4cGxpY2l0bHkgZml4ZWQuIEUuZy4sIGlmIGFuIFwicm1kaXJcIlxuICAgICAqICAgICAgZmFpbHMgYmVjYXVzZSB0aGUgZGlyZWN0b3J5IGlzIG5vbi1lbXB0eSwgRkFJTEVEX1BSRUNPTkRJVElPTlxuICAgICAqICAgICAgc2hvdWxkIGJlIHJldHVybmVkIHNpbmNlIHRoZSBjbGllbnQgc2hvdWxkIG5vdCByZXRyeSB1bmxlc3NcbiAgICAgKiAgICAgIHRoZXkgaGF2ZSBmaXJzdCBmaXhlZCB1cCB0aGUgZGlyZWN0b3J5IGJ5IGRlbGV0aW5nIGZpbGVzIGZyb20gaXQuXG4gICAgICogIChkKSBVc2UgRkFJTEVEX1BSRUNPTkRJVElPTiBpZiB0aGUgY2xpZW50IHBlcmZvcm1zIGNvbmRpdGlvbmFsXG4gICAgICogICAgICBSRVNUIEdldC9VcGRhdGUvRGVsZXRlIG9uIGEgcmVzb3VyY2UgYW5kIHRoZSByZXNvdXJjZSBvbiB0aGVcbiAgICAgKiAgICAgIHNlcnZlciBkb2VzIG5vdCBtYXRjaCB0aGUgY29uZGl0aW9uLiBFLmcuLCBjb25mbGljdGluZ1xuICAgICAqICAgICAgcmVhZC1tb2RpZnktd3JpdGUgb24gdGhlIHNhbWUgcmVzb3VyY2UuXG4gICAgICovXG4gICAgRkFJTEVEX1BSRUNPTkRJVElPTjogXCJmYWlsZWQtcHJlY29uZGl0aW9uXCIsXG4gICAgLyoqXG4gICAgICogVGhlIG9wZXJhdGlvbiB3YXMgYWJvcnRlZCwgdHlwaWNhbGx5IGR1ZSB0byBhIGNvbmN1cnJlbmN5IGlzc3VlIGxpa2VcbiAgICAgKiBzZXF1ZW5jZXIgY2hlY2sgZmFpbHVyZXMsIHRyYW5zYWN0aW9uIGFib3J0cywgZXRjLlxuICAgICAqXG4gICAgICogU2VlIGxpdG11cyB0ZXN0IGFib3ZlIGZvciBkZWNpZGluZyBiZXR3ZWVuIEZBSUxFRF9QUkVDT05ESVRJT04sIEFCT1JURUQsXG4gICAgICogYW5kIFVOQVZBSUxBQkxFLlxuICAgICAqL1xuICAgIEFCT1JURUQ6IFwiYWJvcnRlZFwiLFxuICAgIC8qKlxuICAgICAqIE9wZXJhdGlvbiB3YXMgYXR0ZW1wdGVkIHBhc3QgdGhlIHZhbGlkIHJhbmdlLiBFLmcuLCBzZWVraW5nIG9yIHJlYWRpbmdcbiAgICAgKiBwYXN0IGVuZCBvZiBmaWxlLlxuICAgICAqXG4gICAgICogVW5saWtlIElOVkFMSURfQVJHVU1FTlQsIHRoaXMgZXJyb3IgaW5kaWNhdGVzIGEgcHJvYmxlbSB0aGF0IG1heSBiZSBmaXhlZFxuICAgICAqIGlmIHRoZSBzeXN0ZW0gc3RhdGUgY2hhbmdlcy4gRm9yIGV4YW1wbGUsIGEgMzItYml0IGZpbGUgc3lzdGVtIHdpbGxcbiAgICAgKiBnZW5lcmF0ZSBJTlZBTElEX0FSR1VNRU5UIGlmIGFza2VkIHRvIHJlYWQgYXQgYW4gb2Zmc2V0IHRoYXQgaXMgbm90IGluIHRoZVxuICAgICAqIHJhbmdlIFswLDJeMzItMV0sIGJ1dCBpdCB3aWxsIGdlbmVyYXRlIE9VVF9PRl9SQU5HRSBpZiBhc2tlZCB0byByZWFkIGZyb21cbiAgICAgKiBhbiBvZmZzZXQgcGFzdCB0aGUgY3VycmVudCBmaWxlIHNpemUuXG4gICAgICpcbiAgICAgKiBUaGVyZSBpcyBhIGZhaXIgYml0IG9mIG92ZXJsYXAgYmV0d2VlbiBGQUlMRURfUFJFQ09ORElUSU9OIGFuZFxuICAgICAqIE9VVF9PRl9SQU5HRS4gV2UgcmVjb21tZW5kIHVzaW5nIE9VVF9PRl9SQU5HRSAodGhlIG1vcmUgc3BlY2lmaWMgZXJyb3IpXG4gICAgICogd2hlbiBpdCBhcHBsaWVzIHNvIHRoYXQgY2FsbGVycyB3aG8gYXJlIGl0ZXJhdGluZyB0aHJvdWdoIGEgc3BhY2UgY2FuXG4gICAgICogZWFzaWx5IGxvb2sgZm9yIGFuIE9VVF9PRl9SQU5HRSBlcnJvciB0byBkZXRlY3Qgd2hlbiB0aGV5IGFyZSBkb25lLlxuICAgICAqL1xuICAgIE9VVF9PRl9SQU5HRTogXCJvdXQtb2YtcmFuZ2VcIixcbiAgICAvKiogT3BlcmF0aW9uIGlzIG5vdCBpbXBsZW1lbnRlZCBvciBub3Qgc3VwcG9ydGVkL2VuYWJsZWQgaW4gdGhpcyBzZXJ2aWNlLiAqL1xuICAgIFVOSU1QTEVNRU5URUQ6IFwidW5pbXBsZW1lbnRlZFwiLFxuICAgIC8qKlxuICAgICAqIEludGVybmFsIGVycm9ycy4gTWVhbnMgc29tZSBpbnZhcmlhbnRzIGV4cGVjdGVkIGJ5IHVuZGVybHlpbmcgU3lzdGVtIGhhc1xuICAgICAqIGJlZW4gYnJva2VuLiBJZiB5b3Ugc2VlIG9uZSBvZiB0aGVzZSBlcnJvcnMsIFNvbWV0aGluZyBpcyB2ZXJ5IGJyb2tlbi5cbiAgICAgKi9cbiAgICBJTlRFUk5BTDogXCJpbnRlcm5hbFwiLFxuICAgIC8qKlxuICAgICAqIFRoZSBzZXJ2aWNlIGlzIGN1cnJlbnRseSB1bmF2YWlsYWJsZS4gVGhpcyBpcyBhIG1vc3QgbGlrZWx5IGEgdHJhbnNpZW50XG4gICAgICogY29uZGl0aW9uIGFuZCBtYXkgYmUgY29ycmVjdGVkIGJ5IHJldHJ5aW5nIHdpdGggYSBiYWNrb2ZmLlxuICAgICAqXG4gICAgICogU2VlIGxpdG11cyB0ZXN0IGFib3ZlIGZvciBkZWNpZGluZyBiZXR3ZWVuIEZBSUxFRF9QUkVDT05ESVRJT04sIEFCT1JURUQsXG4gICAgICogYW5kIFVOQVZBSUxBQkxFLlxuICAgICAqL1xuICAgIFVOQVZBSUxBQkxFOiBcInVuYXZhaWxhYmxlXCIsXG4gICAgLyoqIFVucmVjb3ZlcmFibGUgZGF0YSBsb3NzIG9yIGNvcnJ1cHRpb24uICovXG4gICAgREFUQV9MT1NTOiBcImRhdGEtbG9zc1wiXG59O1xuXG4vKiogQW4gZXJyb3IgcmV0dXJuZWQgYnkgYSBGaXJlc3RvcmUgb3BlcmF0aW9uLiAqLyBjbGFzcyBRIGV4dGVuZHMgYSB7XG4gICAgLyoqIEBoaWRlY29uc3RydWN0b3IgKi9cbiAgICBjb25zdHJ1Y3RvcihcbiAgICAvKipcbiAgICAgKiBUaGUgYmFja2VuZCBlcnJvciBjb2RlIGFzc29jaWF0ZWQgd2l0aCB0aGlzIGVycm9yLlxuICAgICAqL1xuICAgIHQsIFxuICAgIC8qKlxuICAgICAqIEEgY3VzdG9tIGVycm9yIGRlc2NyaXB0aW9uLlxuICAgICAqL1xuICAgIGUpIHtcbiAgICAgICAgc3VwZXIodCwgZSksIHRoaXMuY29kZSA9IHQsIHRoaXMubWVzc2FnZSA9IGUsIFxuICAgICAgICAvLyBIQUNLOiBXZSB3cml0ZSBhIHRvU3RyaW5nIHByb3BlcnR5IGRpcmVjdGx5IGJlY2F1c2UgRXJyb3IgaXMgbm90IGEgcmVhbFxuICAgICAgICAvLyBjbGFzcyBhbmQgc28gaW5oZXJpdGFuY2UgZG9lcyBub3Qgd29yayBjb3JyZWN0bHkuIFdlIGNvdWxkIGFsdGVybmF0aXZlbHlcbiAgICAgICAgLy8gZG8gdGhlIHNhbWUgXCJiYWNrLWRvb3IgaW5oZXJpdGFuY2VcIiB0cmljayB0aGF0IEZpcmViYXNlRXJyb3IgZG9lcy5cbiAgICAgICAgdGhpcy50b1N0cmluZyA9ICgpID0+IGAke3RoaXMubmFtZX06IFtjb2RlPSR7dGhpcy5jb2RlfV06ICR7dGhpcy5tZXNzYWdlfWA7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqLyBjbGFzcyBqIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5wcm9taXNlID0gbmV3IFByb21pc2UoKCh0LCBlKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnJlc29sdmUgPSB0LCB0aGlzLnJlamVjdCA9IGU7XG4gICAgICAgIH0pKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovIGNsYXNzIFcge1xuICAgIGNvbnN0cnVjdG9yKHQsIGUpIHtcbiAgICAgICAgdGhpcy51c2VyID0gZSwgdGhpcy50eXBlID0gXCJPQXV0aFwiLCB0aGlzLmhlYWRlcnMgPSBuZXcgTWFwLCB0aGlzLmhlYWRlcnMuc2V0KFwiQXV0aG9yaXphdGlvblwiLCBgQmVhcmVyICR7dH1gKTtcbiAgICB9XG59XG5cbi8qKlxuICogQSBDcmVkZW50aWFsc1Byb3ZpZGVyIHRoYXQgYWx3YXlzIHlpZWxkcyBhbiBlbXB0eSB0b2tlbi5cbiAqIEBpbnRlcm5hbFxuICovIGNsYXNzIHoge1xuICAgIGdldFRva2VuKCkge1xuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKG51bGwpO1xuICAgIH1cbiAgICBpbnZhbGlkYXRlVG9rZW4oKSB7fVxuICAgIHN0YXJ0KHQsIGUpIHtcbiAgICAgICAgLy8gRmlyZSB3aXRoIGluaXRpYWwgdXNlci5cbiAgICAgICAgdC5lbnF1ZXVlUmV0cnlhYmxlKCgoKSA9PiBlKEMuVU5BVVRIRU5USUNBVEVEKSkpO1xuICAgIH1cbiAgICBzaHV0ZG93bigpIHt9XG59XG5cbi8qKlxuICogQSBDcmVkZW50aWFsc1Byb3ZpZGVyIHRoYXQgYWx3YXlzIHJldHVybnMgYSBjb25zdGFudCB0b2tlbi4gVXNlZCBmb3JcbiAqIGVtdWxhdG9yIHRva2VuIG1vY2tpbmcuXG4gKi8gY2xhc3MgSCB7XG4gICAgY29uc3RydWN0b3IodCkge1xuICAgICAgICB0aGlzLnRva2VuID0gdCwgXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTdG9yZXMgdGhlIGxpc3RlbmVyIHJlZ2lzdGVyZWQgd2l0aCBzZXRDaGFuZ2VMaXN0ZW5lcigpXG4gICAgICAgICAqIFRoaXMgaXNuJ3QgYWN0dWFsbHkgbmVjZXNzYXJ5IHNpbmNlIHRoZSBVSUQgbmV2ZXIgY2hhbmdlcywgYnV0IHdlIHVzZSB0aGlzXG4gICAgICAgICAqIHRvIHZlcmlmeSB0aGUgbGlzdGVuIGNvbnRyYWN0IGlzIGFkaGVyZWQgdG8gaW4gdGVzdHMuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmNoYW5nZUxpc3RlbmVyID0gbnVsbDtcbiAgICB9XG4gICAgZ2V0VG9rZW4oKSB7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUodGhpcy50b2tlbik7XG4gICAgfVxuICAgIGludmFsaWRhdGVUb2tlbigpIHt9XG4gICAgc3RhcnQodCwgZSkge1xuICAgICAgICB0aGlzLmNoYW5nZUxpc3RlbmVyID0gZSwgXG4gICAgICAgIC8vIEZpcmUgd2l0aCBpbml0aWFsIHVzZXIuXG4gICAgICAgIHQuZW5xdWV1ZVJldHJ5YWJsZSgoKCkgPT4gZSh0aGlzLnRva2VuLnVzZXIpKSk7XG4gICAgfVxuICAgIHNodXRkb3duKCkge1xuICAgICAgICB0aGlzLmNoYW5nZUxpc3RlbmVyID0gbnVsbDtcbiAgICB9XG59XG5cbmNsYXNzIEoge1xuICAgIGNvbnN0cnVjdG9yKHQpIHtcbiAgICAgICAgdGhpcy50ID0gdCwgXG4gICAgICAgIC8qKiBUcmFja3MgdGhlIGN1cnJlbnQgVXNlci4gKi9cbiAgICAgICAgdGhpcy5jdXJyZW50VXNlciA9IEMuVU5BVVRIRU5USUNBVEVELCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIENvdW50ZXIgdXNlZCB0byBkZXRlY3QgaWYgdGhlIHRva2VuIGNoYW5nZWQgd2hpbGUgYSBnZXRUb2tlbiByZXF1ZXN0IHdhc1xuICAgICAgICAgKiBvdXRzdGFuZGluZy5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuaSA9IDAsIHRoaXMuZm9yY2VSZWZyZXNoID0gITEsIHRoaXMuYXV0aCA9IG51bGw7XG4gICAgfVxuICAgIHN0YXJ0KHQsIGUpIHtcbiAgICAgICAgbGV0IG4gPSB0aGlzLmk7XG4gICAgICAgIC8vIEEgY2hhbmdlIGxpc3RlbmVyIHRoYXQgcHJldmVudHMgZG91YmxlLWZpcmluZyBmb3IgdGhlIHNhbWUgdG9rZW4gY2hhbmdlLlxuICAgICAgICAgICAgICAgIGNvbnN0IHMgPSB0ID0+IHRoaXMuaSAhPT0gbiA/IChuID0gdGhpcy5pLCBlKHQpKSA6IFByb21pc2UucmVzb2x2ZSgpO1xuICAgICAgICAvLyBBIHByb21pc2UgdGhhdCBjYW4gYmUgd2FpdGVkIG9uIHRvIGJsb2NrIG9uIHRoZSBuZXh0IHRva2VuIGNoYW5nZS5cbiAgICAgICAgLy8gVGhpcyBwcm9taXNlIGlzIHJlLWNyZWF0ZWQgYWZ0ZXIgZWFjaCBjaGFuZ2UuXG4gICAgICAgICAgICAgICAgbGV0IGkgPSBuZXcgajtcbiAgICAgICAgdGhpcy5vID0gKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5pKyssIHRoaXMuY3VycmVudFVzZXIgPSB0aGlzLnUoKSwgaS5yZXNvbHZlKCksIGkgPSBuZXcgaiwgdC5lbnF1ZXVlUmV0cnlhYmxlKCgoKSA9PiBzKHRoaXMuY3VycmVudFVzZXIpKSk7XG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IHIgPSAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBlID0gaTtcbiAgICAgICAgICAgIHQuZW5xdWV1ZVJldHJ5YWJsZSgoYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICAgIGF3YWl0IGUucHJvbWlzZSwgYXdhaXQgcyh0aGlzLmN1cnJlbnRVc2VyKTtcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgfSwgbyA9IHQgPT4ge1xuICAgICAgICAgICAgTyhcIkZpcmViYXNlQXV0aENyZWRlbnRpYWxzUHJvdmlkZXJcIiwgXCJBdXRoIGRldGVjdGVkXCIpLCB0aGlzLmF1dGggPSB0LCB0aGlzLmF1dGguYWRkQXV0aFRva2VuTGlzdGVuZXIodGhpcy5vKSwgXG4gICAgICAgICAgICByKCk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMudC5vbkluaXQoKHQgPT4gbyh0KSkpLCBcbiAgICAgICAgLy8gT3VyIHVzZXJzIGNhbiBpbml0aWFsaXplIEF1dGggcmlnaHQgYWZ0ZXIgRmlyZXN0b3JlLCBzbyB3ZSBnaXZlIGl0XG4gICAgICAgIC8vIGEgY2hhbmNlIHRvIHJlZ2lzdGVyIGl0c2VsZiB3aXRoIHRoZSBjb21wb25lbnQgZnJhbWV3b3JrIGJlZm9yZSB3ZVxuICAgICAgICAvLyBkZXRlcm1pbmUgd2hldGhlciB0byBzdGFydCB1cCBpbiB1bmF1dGhlbnRpY2F0ZWQgbW9kZS5cbiAgICAgICAgc2V0VGltZW91dCgoKCkgPT4ge1xuICAgICAgICAgICAgaWYgKCF0aGlzLmF1dGgpIHtcbiAgICAgICAgICAgICAgICBjb25zdCB0ID0gdGhpcy50LmdldEltbWVkaWF0ZSh7XG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbmFsOiAhMFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHQgPyBvKHQpIDogKFxuICAgICAgICAgICAgICAgIC8vIElmIGF1dGggaXMgc3RpbGwgbm90IGF2YWlsYWJsZSwgcHJvY2VlZCB3aXRoIGBudWxsYCB1c2VyXG4gICAgICAgICAgICAgICAgTyhcIkZpcmViYXNlQXV0aENyZWRlbnRpYWxzUHJvdmlkZXJcIiwgXCJBdXRoIG5vdCB5ZXQgZGV0ZWN0ZWRcIiksIGkucmVzb2x2ZSgpLCBpID0gbmV3IGopO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KSwgMCksIHIoKTtcbiAgICB9XG4gICAgZ2V0VG9rZW4oKSB7XG4gICAgICAgIC8vIFRha2Ugbm90ZSBvZiB0aGUgY3VycmVudCB2YWx1ZSBvZiB0aGUgdG9rZW5Db3VudGVyIHNvIHRoYXQgdGhpcyBtZXRob2RcbiAgICAgICAgLy8gY2FuIGZhaWwgKHdpdGggYW4gQUJPUlRFRCBlcnJvcikgaWYgdGhlcmUgaXMgYSB0b2tlbiBjaGFuZ2Ugd2hpbGUgdGhlXG4gICAgICAgIC8vIHJlcXVlc3QgaXMgb3V0c3RhbmRpbmcuXG4gICAgICAgIGNvbnN0IHQgPSB0aGlzLmksIGUgPSB0aGlzLmZvcmNlUmVmcmVzaDtcbiAgICAgICAgcmV0dXJuIHRoaXMuZm9yY2VSZWZyZXNoID0gITEsIHRoaXMuYXV0aCA/IHRoaXMuYXV0aC5nZXRUb2tlbihlKS50aGVuKChlID0+IFxuICAgICAgICAvLyBDYW5jZWwgdGhlIHJlcXVlc3Qgc2luY2UgdGhlIHRva2VuIGNoYW5nZWQgd2hpbGUgdGhlIHJlcXVlc3Qgd2FzXG4gICAgICAgIC8vIG91dHN0YW5kaW5nIHNvIHRoZSByZXNwb25zZSBpcyBwb3RlbnRpYWxseSBmb3IgYSBwcmV2aW91cyB1c2VyICh3aGljaFxuICAgICAgICAvLyB1c2VyLCB3ZSBjYW4ndCBiZSBzdXJlKS5cbiAgICAgICAgdGhpcy5pICE9PSB0ID8gKE8oXCJGaXJlYmFzZUF1dGhDcmVkZW50aWFsc1Byb3ZpZGVyXCIsIFwiZ2V0VG9rZW4gYWJvcnRlZCBkdWUgdG8gdG9rZW4gY2hhbmdlLlwiKSwgXG4gICAgICAgIHRoaXMuZ2V0VG9rZW4oKSkgOiBlID8gKFUoXCJzdHJpbmdcIiA9PSB0eXBlb2YgZS5hY2Nlc3NUb2tlbiksIG5ldyBXKGUuYWNjZXNzVG9rZW4sIHRoaXMuY3VycmVudFVzZXIpKSA6IG51bGwpKSA6IFByb21pc2UucmVzb2x2ZShudWxsKTtcbiAgICB9XG4gICAgaW52YWxpZGF0ZVRva2VuKCkge1xuICAgICAgICB0aGlzLmZvcmNlUmVmcmVzaCA9ICEwO1xuICAgIH1cbiAgICBzaHV0ZG93bigpIHtcbiAgICAgICAgdGhpcy5hdXRoICYmIHRoaXMuYXV0aC5yZW1vdmVBdXRoVG9rZW5MaXN0ZW5lcih0aGlzLm8pO1xuICAgIH1cbiAgICAvLyBBdXRoLmdldFVpZCgpIGNhbiByZXR1cm4gbnVsbCBldmVuIHdpdGggYSB1c2VyIGxvZ2dlZCBpbi4gSXQgaXMgYmVjYXVzZVxuICAgIC8vIGdldFVpZCgpIGlzIHN5bmNocm9ub3VzLCBidXQgdGhlIGF1dGggY29kZSBwb3B1bGF0aW5nIFVpZCBpcyBhc3luY2hyb25vdXMuXG4gICAgLy8gVGhpcyBtZXRob2Qgc2hvdWxkIG9ubHkgYmUgY2FsbGVkIGluIHRoZSBBdXRoVG9rZW5MaXN0ZW5lciBjYWxsYmFja1xuICAgIC8vIHRvIGd1YXJhbnRlZSB0byBnZXQgdGhlIGFjdHVhbCB1c2VyLlxuICAgIHUoKSB7XG4gICAgICAgIGNvbnN0IHQgPSB0aGlzLmF1dGggJiYgdGhpcy5hdXRoLmdldFVpZCgpO1xuICAgICAgICByZXR1cm4gVShudWxsID09PSB0IHx8IFwic3RyaW5nXCIgPT0gdHlwZW9mIHQpLCBuZXcgQyh0KTtcbiAgICB9XG59XG5cbi8qXG4gKiBGaXJzdFBhcnR5VG9rZW4gcHJvdmlkZXMgYSBmcmVzaCB0b2tlbiBlYWNoIHRpbWUgaXRzIHZhbHVlXG4gKiBpcyByZXF1ZXN0ZWQsIGJlY2F1c2UgaWYgdGhlIHRva2VuIGlzIHRvbyBvbGQsIHJlcXVlc3RzIHdpbGwgYmUgcmVqZWN0ZWQuXG4gKiBUZWNobmljYWxseSB0aGlzIG1heSBubyBsb25nZXIgYmUgbmVjZXNzYXJ5IHNpbmNlIHRoZSBTREsgc2hvdWxkIGdyYWNlZnVsbHlcbiAqIHJlY292ZXIgZnJvbSB1bmF1dGhlbnRpY2F0ZWQgZXJyb3JzIChzZWUgYi8zMzE0NzgxOCBmb3IgY29udGV4dCksIGJ1dCBpdCdzXG4gKiBzYWZlciB0byBrZWVwIHRoZSBpbXBsZW1lbnRhdGlvbiBhcy1pcy5cbiAqLyBjbGFzcyBZIHtcbiAgICBjb25zdHJ1Y3Rvcih0LCBlLCBuKSB7XG4gICAgICAgIHRoaXMudHlwZSA9IFwiRmlyc3RQYXJ0eVwiLCB0aGlzLnVzZXIgPSBDLkZJUlNUX1BBUlRZLCB0aGlzLmhlYWRlcnMgPSBuZXcgTWFwLCB0aGlzLmhlYWRlcnMuc2V0KFwiWC1Hb29nLUF1dGhVc2VyXCIsIGUpO1xuICAgICAgICBjb25zdCBzID0gdC5hdXRoLmdldEF1dGhIZWFkZXJWYWx1ZUZvckZpcnN0UGFydHkoW10pO1xuICAgICAgICBzICYmIHRoaXMuaGVhZGVycy5zZXQoXCJBdXRob3JpemF0aW9uXCIsIHMpLCBuICYmIHRoaXMuaGVhZGVycy5zZXQoXCJYLUdvb2ctSWFtLUF1dGhvcml6YXRpb24tVG9rZW5cIiwgbik7XG4gICAgfVxufVxuXG4vKlxuICogUHJvdmlkZXMgdXNlciBjcmVkZW50aWFscyByZXF1aXJlZCBmb3IgdGhlIEZpcmVzdG9yZSBKYXZhU2NyaXB0IFNES1xuICogdG8gYXV0aGVudGljYXRlIHRoZSB1c2VyLCB1c2luZyB0ZWNobmlxdWUgdGhhdCBpcyBvbmx5IGF2YWlsYWJsZVxuICogdG8gYXBwbGljYXRpb25zIGhvc3RlZCBieSBHb29nbGUuXG4gKi8gY2xhc3MgWCB7XG4gICAgY29uc3RydWN0b3IodCwgZSwgbikge1xuICAgICAgICB0aGlzLmggPSB0LCB0aGlzLmwgPSBlLCB0aGlzLm0gPSBuO1xuICAgIH1cbiAgICBnZXRUb2tlbigpIHtcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShuZXcgWSh0aGlzLmgsIHRoaXMubCwgdGhpcy5tKSk7XG4gICAgfVxuICAgIHN0YXJ0KHQsIGUpIHtcbiAgICAgICAgLy8gRmlyZSB3aXRoIGluaXRpYWwgdWlkLlxuICAgICAgICB0LmVucXVldWVSZXRyeWFibGUoKCgpID0+IGUoQy5GSVJTVF9QQVJUWSkpKTtcbiAgICB9XG4gICAgc2h1dGRvd24oKSB7fVxuICAgIGludmFsaWRhdGVUb2tlbigpIHt9XG59XG5cbmNsYXNzIFoge1xuICAgIGNvbnN0cnVjdG9yKHQpIHtcbiAgICAgICAgdGhpcy52YWx1ZSA9IHQsIHRoaXMudHlwZSA9IFwiQXBwQ2hlY2tcIiwgdGhpcy5oZWFkZXJzID0gbmV3IE1hcCwgdCAmJiB0Lmxlbmd0aCA+IDAgJiYgdGhpcy5oZWFkZXJzLnNldChcIngtZmlyZWJhc2UtYXBwY2hlY2tcIiwgdGhpcy52YWx1ZSk7XG4gICAgfVxufVxuXG5jbGFzcyB0dCB7XG4gICAgY29uc3RydWN0b3IodCkge1xuICAgICAgICB0aGlzLmcgPSB0LCB0aGlzLmZvcmNlUmVmcmVzaCA9ICExLCB0aGlzLmFwcENoZWNrID0gbnVsbCwgdGhpcy5wID0gbnVsbDtcbiAgICB9XG4gICAgc3RhcnQodCwgZSkge1xuICAgICAgICBjb25zdCBuID0gdCA9PiB7XG4gICAgICAgICAgICBudWxsICE9IHQuZXJyb3IgJiYgTyhcIkZpcmViYXNlQXBwQ2hlY2tUb2tlblByb3ZpZGVyXCIsIGBFcnJvciBnZXR0aW5nIEFwcCBDaGVjayB0b2tlbjsgdXNpbmcgcGxhY2Vob2xkZXIgdG9rZW4gaW5zdGVhZC4gRXJyb3I6ICR7dC5lcnJvci5tZXNzYWdlfWApO1xuICAgICAgICAgICAgY29uc3QgbiA9IHQudG9rZW4gIT09IHRoaXMucDtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnAgPSB0LnRva2VuLCBPKFwiRmlyZWJhc2VBcHBDaGVja1Rva2VuUHJvdmlkZXJcIiwgYFJlY2VpdmVkICR7biA/IFwibmV3XCIgOiBcImV4aXN0aW5nXCJ9IHRva2VuLmApLCBcbiAgICAgICAgICAgIG4gPyBlKHQudG9rZW4pIDogUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMubyA9IGUgPT4ge1xuICAgICAgICAgICAgdC5lbnF1ZXVlUmV0cnlhYmxlKCgoKSA9PiBuKGUpKSk7XG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IHMgPSB0ID0+IHtcbiAgICAgICAgICAgIE8oXCJGaXJlYmFzZUFwcENoZWNrVG9rZW5Qcm92aWRlclwiLCBcIkFwcENoZWNrIGRldGVjdGVkXCIpLCB0aGlzLmFwcENoZWNrID0gdCwgdGhpcy5hcHBDaGVjay5hZGRUb2tlbkxpc3RlbmVyKHRoaXMubyk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuZy5vbkluaXQoKHQgPT4gcyh0KSkpLCBcbiAgICAgICAgLy8gT3VyIHVzZXJzIGNhbiBpbml0aWFsaXplIEFwcENoZWNrIGFmdGVyIEZpcmVzdG9yZSwgc28gd2UgZ2l2ZSBpdFxuICAgICAgICAvLyBhIGNoYW5jZSB0byByZWdpc3RlciBpdHNlbGYgd2l0aCB0aGUgY29tcG9uZW50IGZyYW1ld29yay5cbiAgICAgICAgc2V0VGltZW91dCgoKCkgPT4ge1xuICAgICAgICAgICAgaWYgKCF0aGlzLmFwcENoZWNrKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdCA9IHRoaXMuZy5nZXRJbW1lZGlhdGUoe1xuICAgICAgICAgICAgICAgICAgICBvcHRpb25hbDogITBcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB0ID8gcyh0KSA6IFxuICAgICAgICAgICAgICAgIC8vIElmIEFwcENoZWNrIGlzIHN0aWxsIG5vdCBhdmFpbGFibGUsIHByb2NlZWQgd2l0aG91dCBpdC5cbiAgICAgICAgICAgICAgICBPKFwiRmlyZWJhc2VBcHBDaGVja1Rva2VuUHJvdmlkZXJcIiwgXCJBcHBDaGVjayBub3QgeWV0IGRldGVjdGVkXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KSwgMCk7XG4gICAgfVxuICAgIGdldFRva2VuKCkge1xuICAgICAgICBjb25zdCB0ID0gdGhpcy5mb3JjZVJlZnJlc2g7XG4gICAgICAgIHJldHVybiB0aGlzLmZvcmNlUmVmcmVzaCA9ICExLCB0aGlzLmFwcENoZWNrID8gdGhpcy5hcHBDaGVjay5nZXRUb2tlbih0KS50aGVuKCh0ID0+IHQgPyAoVShcInN0cmluZ1wiID09IHR5cGVvZiB0LnRva2VuKSwgXG4gICAgICAgIHRoaXMucCA9IHQudG9rZW4sIG5ldyBaKHQudG9rZW4pKSA6IG51bGwpKSA6IFByb21pc2UucmVzb2x2ZShudWxsKTtcbiAgICB9XG4gICAgaW52YWxpZGF0ZVRva2VuKCkge1xuICAgICAgICB0aGlzLmZvcmNlUmVmcmVzaCA9ICEwO1xuICAgIH1cbiAgICBzaHV0ZG93bigpIHtcbiAgICAgICAgdGhpcy5hcHBDaGVjayAmJiB0aGlzLmFwcENoZWNrLnJlbW92ZVRva2VuTGlzdGVuZXIodGhpcy5vKTtcbiAgICB9XG59XG5cbi8qKlxuICogQW4gQXBwQ2hlY2sgdG9rZW4gcHJvdmlkZXIgdGhhdCBhbHdheXMgeWllbGRzIGFuIGVtcHR5IHRva2VuLlxuICogQGludGVybmFsXG4gKi8gY2xhc3MgZXQge1xuICAgIGdldFRva2VuKCkge1xuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKG5ldyBaKFwiXCIpKTtcbiAgICB9XG4gICAgaW52YWxpZGF0ZVRva2VuKCkge31cbiAgICBzdGFydCh0LCBlKSB7fVxuICAgIHNodXRkb3duKCkge31cbn1cblxuLyoqXG4gKiBCdWlsZHMgYSBDcmVkZW50aWFsc1Byb3ZpZGVyIGRlcGVuZGluZyBvbiB0aGUgdHlwZSBvZlxuICogdGhlIGNyZWRlbnRpYWxzIHBhc3NlZCBpbi5cbiAqL1xuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTggR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogYExpc3RlblNlcXVlbmNlYCBpcyBhIG1vbm90b25pYyBzZXF1ZW5jZS4gSXQgaXMgaW5pdGlhbGl6ZWQgd2l0aCBhIG1pbmltdW0gdmFsdWUgdG9cbiAqIGV4Y2VlZC4gQWxsIHN1YnNlcXVlbnQgY2FsbHMgdG8gbmV4dCB3aWxsIHJldHVybiBpbmNyZWFzaW5nIHZhbHVlcy4gSWYgcHJvdmlkZWQgd2l0aCBhXG4gKiBgU2VxdWVuY2VOdW1iZXJTeW5jZXJgLCBpdCB3aWxsIGFkZGl0aW9uYWxseSBidW1wIGl0cyBuZXh0IHZhbHVlIHdoZW4gdG9sZCBvZiBhIG5ldyB2YWx1ZSwgYXNcbiAqIHdlbGwgYXMgd3JpdGUgb3V0IHNlcXVlbmNlIG51bWJlcnMgdGhhdCBpdCBwcm9kdWNlcyB2aWEgYG5leHQoKWAuXG4gKi9cbmNsYXNzIG50IHtcbiAgICBjb25zdHJ1Y3Rvcih0LCBlKSB7XG4gICAgICAgIHRoaXMucHJldmlvdXNWYWx1ZSA9IHQsIGUgJiYgKGUuc2VxdWVuY2VOdW1iZXJIYW5kbGVyID0gdCA9PiB0aGlzLkkodCksIHRoaXMuVCA9IHQgPT4gZS53cml0ZVNlcXVlbmNlTnVtYmVyKHQpKTtcbiAgICB9XG4gICAgSSh0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLnByZXZpb3VzVmFsdWUgPSBNYXRoLm1heCh0LCB0aGlzLnByZXZpb3VzVmFsdWUpLCB0aGlzLnByZXZpb3VzVmFsdWU7XG4gICAgfVxuICAgIG5leHQoKSB7XG4gICAgICAgIGNvbnN0IHQgPSArK3RoaXMucHJldmlvdXNWYWx1ZTtcbiAgICAgICAgcmV0dXJuIHRoaXMuVCAmJiB0aGlzLlQodCksIHQ7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBHZW5lcmF0ZXMgYG5CeXRlc2Agb2YgcmFuZG9tIGJ5dGVzLlxuICpcbiAqIElmIGBuQnl0ZXMgPCAwYCAsIGFuIGVycm9yIHdpbGwgYmUgdGhyb3duLlxuICovXG5mdW5jdGlvbiBzdCh0KSB7XG4gICAgLy8gUG9seWZpbGxzIGZvciBJRSBhbmQgV2ViV29ya2VyIGJ5IHVzaW5nIGBzZWxmYCBhbmQgYG1zQ3J5cHRvYCB3aGVuIGBjcnlwdG9gIGlzIG5vdCBhdmFpbGFibGUuXG4gICAgY29uc3QgZSA9IFxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG4gICAgXCJ1bmRlZmluZWRcIiAhPSB0eXBlb2Ygc2VsZiAmJiAoc2VsZi5jcnlwdG8gfHwgc2VsZi5tc0NyeXB0byksIG4gPSBuZXcgVWludDhBcnJheSh0KTtcbiAgICBpZiAoZSAmJiBcImZ1bmN0aW9uXCIgPT0gdHlwZW9mIGUuZ2V0UmFuZG9tVmFsdWVzKSBlLmdldFJhbmRvbVZhbHVlcyhuKTsgZWxzZSBcbiAgICAvLyBGYWxscyBiYWNrIHRvIE1hdGgucmFuZG9tXG4gICAgZm9yIChsZXQgZSA9IDA7IGUgPCB0OyBlKyspIG5bZV0gPSBNYXRoLmZsb29yKDI1NiAqIE1hdGgucmFuZG9tKCkpO1xuICAgIHJldHVybiBuO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqLyBudC5BID0gLTE7XG5cbmNsYXNzIGl0IHtcbiAgICBzdGF0aWMgUigpIHtcbiAgICAgICAgLy8gQWxwaGFudW1lcmljIGNoYXJhY3RlcnNcbiAgICAgICAgY29uc3QgdCA9IFwiQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODlcIiwgZSA9IE1hdGguZmxvb3IoMjU2IC8gdC5sZW5ndGgpICogdC5sZW5ndGg7XG4gICAgICAgIC8vIFRoZSBsYXJnZXN0IGJ5dGUgdmFsdWUgdGhhdCBpcyBhIG11bHRpcGxlIG9mIGBjaGFyLmxlbmd0aGAuXG4gICAgICAgICAgICAgICAgbGV0IG4gPSBcIlwiO1xuICAgICAgICBmb3IgKDtuLmxlbmd0aCA8IDIwOyApIHtcbiAgICAgICAgICAgIGNvbnN0IHMgPSBzdCg0MCk7XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHMubGVuZ3RoOyArK2kpIFxuICAgICAgICAgICAgLy8gT25seSBhY2NlcHQgdmFsdWVzIHRoYXQgYXJlIFswLCBtYXhNdWx0aXBsZSksIHRoaXMgZW5zdXJlcyB0aGV5IGNhblxuICAgICAgICAgICAgLy8gYmUgZXZlbmx5IG1hcHBlZCB0byBpbmRpY2VzIG9mIGBjaGFyc2AgdmlhIGEgbW9kdWxvIG9wZXJhdGlvbi5cbiAgICAgICAgICAgIG4ubGVuZ3RoIDwgMjAgJiYgc1tpXSA8IGUgJiYgKG4gKz0gdC5jaGFyQXQoc1tpXSAlIHQubGVuZ3RoKSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG47XG4gICAgfVxufVxuXG5mdW5jdGlvbiBydCh0LCBlKSB7XG4gICAgcmV0dXJuIHQgPCBlID8gLTEgOiB0ID4gZSA/IDEgOiAwO1xufVxuXG4vKiogSGVscGVyIHRvIGNvbXBhcmUgYXJyYXlzIHVzaW5nIGlzRXF1YWwoKS4gKi8gZnVuY3Rpb24gb3QodCwgZSwgbikge1xuICAgIHJldHVybiB0Lmxlbmd0aCA9PT0gZS5sZW5ndGggJiYgdC5ldmVyeSgoKHQsIHMpID0+IG4odCwgZVtzXSkpKTtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIHRoZSBpbW1lZGlhdGUgbGV4aWNvZ3JhcGhpY2FsbHktZm9sbG93aW5nIHN0cmluZy4gVGhpcyBpcyB1c2VmdWwgdG9cbiAqIGNvbnN0cnVjdCBhbiBpbmNsdXNpdmUgcmFuZ2UgZm9yIGluZGV4ZWRkYiBpdGVyYXRvcnMuXG4gKi8gZnVuY3Rpb24gdXQodCkge1xuICAgIC8vIFJldHVybiB0aGUgaW5wdXQgc3RyaW5nLCB3aXRoIGFuIGFkZGl0aW9uYWwgTlVMIGJ5dGUgYXBwZW5kZWQuXG4gICAgcmV0dXJuIHQgKyBcIlxcMFwiO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLy8gVGhlIGVhcmxpZXN0IGRhdGUgc3VwcG9ydGVkIGJ5IEZpcmVzdG9yZSB0aW1lc3RhbXBzICgwMDAxLTAxLTAxVDAwOjAwOjAwWikuXG4vKipcbiAqIEEgYFRpbWVzdGFtcGAgcmVwcmVzZW50cyBhIHBvaW50IGluIHRpbWUgaW5kZXBlbmRlbnQgb2YgYW55IHRpbWUgem9uZSBvclxuICogY2FsZW5kYXIsIHJlcHJlc2VudGVkIGFzIHNlY29uZHMgYW5kIGZyYWN0aW9ucyBvZiBzZWNvbmRzIGF0IG5hbm9zZWNvbmRcbiAqIHJlc29sdXRpb24gaW4gVVRDIEVwb2NoIHRpbWUuXG4gKlxuICogSXQgaXMgZW5jb2RlZCB1c2luZyB0aGUgUHJvbGVwdGljIEdyZWdvcmlhbiBDYWxlbmRhciB3aGljaCBleHRlbmRzIHRoZVxuICogR3JlZ29yaWFuIGNhbGVuZGFyIGJhY2t3YXJkcyB0byB5ZWFyIG9uZS4gSXQgaXMgZW5jb2RlZCBhc3N1bWluZyBhbGwgbWludXRlc1xuICogYXJlIDYwIHNlY29uZHMgbG9uZywgaS5lLiBsZWFwIHNlY29uZHMgYXJlIFwic21lYXJlZFwiIHNvIHRoYXQgbm8gbGVhcCBzZWNvbmRcbiAqIHRhYmxlIGlzIG5lZWRlZCBmb3IgaW50ZXJwcmV0YXRpb24uIFJhbmdlIGlzIGZyb20gMDAwMS0wMS0wMVQwMDowMDowMFogdG9cbiAqIDk5OTktMTItMzFUMjM6NTk6NTkuOTk5OTk5OTk5Wi5cbiAqXG4gKiBGb3IgZXhhbXBsZXMgYW5kIGZ1cnRoZXIgc3BlY2lmaWNhdGlvbnMsIHJlZmVyIHRvIHRoZVxuICoge0BsaW5rIGh0dHBzOi8vZ2l0aHViLmNvbS9nb29nbGUvcHJvdG9idWYvYmxvYi9tYXN0ZXIvc3JjL2dvb2dsZS9wcm90b2J1Zi90aW1lc3RhbXAucHJvdG8gfCBUaW1lc3RhbXAgZGVmaW5pdGlvbn0uXG4gKi9cbmNsYXNzIGF0IHtcbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgbmV3IHRpbWVzdGFtcC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBzZWNvbmRzIC0gVGhlIG51bWJlciBvZiBzZWNvbmRzIG9mIFVUQyB0aW1lIHNpbmNlIFVuaXggZXBvY2hcbiAgICAgKiAgICAgMTk3MC0wMS0wMVQwMDowMDowMFouIE11c3QgYmUgZnJvbSAwMDAxLTAxLTAxVDAwOjAwOjAwWiB0b1xuICAgICAqICAgICA5OTk5LTEyLTMxVDIzOjU5OjU5WiBpbmNsdXNpdmUuXG4gICAgICogQHBhcmFtIG5hbm9zZWNvbmRzIC0gVGhlIG5vbi1uZWdhdGl2ZSBmcmFjdGlvbnMgb2YgYSBzZWNvbmQgYXQgbmFub3NlY29uZFxuICAgICAqICAgICByZXNvbHV0aW9uLiBOZWdhdGl2ZSBzZWNvbmQgdmFsdWVzIHdpdGggZnJhY3Rpb25zIG11c3Qgc3RpbGwgaGF2ZVxuICAgICAqICAgICBub24tbmVnYXRpdmUgbmFub3NlY29uZHMgdmFsdWVzIHRoYXQgY291bnQgZm9yd2FyZCBpbiB0aW1lLiBNdXN0IGJlXG4gICAgICogICAgIGZyb20gMCB0byA5OTksOTk5LDk5OSBpbmNsdXNpdmUuXG4gICAgICovXG4gICAgY29uc3RydWN0b3IoXG4gICAgLyoqXG4gICAgICogVGhlIG51bWJlciBvZiBzZWNvbmRzIG9mIFVUQyB0aW1lIHNpbmNlIFVuaXggZXBvY2ggMTk3MC0wMS0wMVQwMDowMDowMFouXG4gICAgICovXG4gICAgdCwgXG4gICAgLyoqXG4gICAgICogVGhlIGZyYWN0aW9ucyBvZiBhIHNlY29uZCBhdCBuYW5vc2Vjb25kIHJlc29sdXRpb24uKlxuICAgICAqL1xuICAgIGUpIHtcbiAgICAgICAgaWYgKHRoaXMuc2Vjb25kcyA9IHQsIHRoaXMubmFub3NlY29uZHMgPSBlLCBlIDwgMCkgdGhyb3cgbmV3IFEoRy5JTlZBTElEX0FSR1VNRU5ULCBcIlRpbWVzdGFtcCBuYW5vc2Vjb25kcyBvdXQgb2YgcmFuZ2U6IFwiICsgZSk7XG4gICAgICAgIGlmIChlID49IDFlOSkgdGhyb3cgbmV3IFEoRy5JTlZBTElEX0FSR1VNRU5ULCBcIlRpbWVzdGFtcCBuYW5vc2Vjb25kcyBvdXQgb2YgcmFuZ2U6IFwiICsgZSk7XG4gICAgICAgIGlmICh0IDwgLTYyMTM1NTk2ODAwKSB0aHJvdyBuZXcgUShHLklOVkFMSURfQVJHVU1FTlQsIFwiVGltZXN0YW1wIHNlY29uZHMgb3V0IG9mIHJhbmdlOiBcIiArIHQpO1xuICAgICAgICAvLyBUaGlzIHdpbGwgYnJlYWsgaW4gdGhlIHllYXIgMTAsMDAwLlxuICAgICAgICAgICAgICAgIGlmICh0ID49IDI1MzQwMjMwMDgwMCkgdGhyb3cgbmV3IFEoRy5JTlZBTElEX0FSR1VNRU5ULCBcIlRpbWVzdGFtcCBzZWNvbmRzIG91dCBvZiByYW5nZTogXCIgKyB0KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIG5ldyB0aW1lc3RhbXAgd2l0aCB0aGUgY3VycmVudCBkYXRlLCB3aXRoIG1pbGxpc2Vjb25kIHByZWNpc2lvbi5cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIGEgbmV3IHRpbWVzdGFtcCByZXByZXNlbnRpbmcgdGhlIGN1cnJlbnQgZGF0ZS5cbiAgICAgKi8gICAgc3RhdGljIG5vdygpIHtcbiAgICAgICAgcmV0dXJuIGF0LmZyb21NaWxsaXMoRGF0ZS5ub3coKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBuZXcgdGltZXN0YW1wIGZyb20gdGhlIGdpdmVuIGRhdGUuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gZGF0ZSAtIFRoZSBkYXRlIHRvIGluaXRpYWxpemUgdGhlIGBUaW1lc3RhbXBgIGZyb20uXG4gICAgICogQHJldHVybnMgQSBuZXcgYFRpbWVzdGFtcGAgcmVwcmVzZW50aW5nIHRoZSBzYW1lIHBvaW50IGluIHRpbWUgYXMgdGhlIGdpdmVuXG4gICAgICogICAgIGRhdGUuXG4gICAgICovICAgIHN0YXRpYyBmcm9tRGF0ZSh0KSB7XG4gICAgICAgIHJldHVybiBhdC5mcm9tTWlsbGlzKHQuZ2V0VGltZSgpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIG5ldyB0aW1lc3RhbXAgZnJvbSB0aGUgZ2l2ZW4gbnVtYmVyIG9mIG1pbGxpc2Vjb25kcy5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBtaWxsaXNlY29uZHMgLSBOdW1iZXIgb2YgbWlsbGlzZWNvbmRzIHNpbmNlIFVuaXggZXBvY2hcbiAgICAgKiAgICAgMTk3MC0wMS0wMVQwMDowMDowMFouXG4gICAgICogQHJldHVybnMgQSBuZXcgYFRpbWVzdGFtcGAgcmVwcmVzZW50aW5nIHRoZSBzYW1lIHBvaW50IGluIHRpbWUgYXMgdGhlIGdpdmVuXG4gICAgICogICAgIG51bWJlciBvZiBtaWxsaXNlY29uZHMuXG4gICAgICovICAgIHN0YXRpYyBmcm9tTWlsbGlzKHQpIHtcbiAgICAgICAgY29uc3QgZSA9IE1hdGguZmxvb3IodCAvIDFlMyksIG4gPSBNYXRoLmZsb29yKDFlNiAqICh0IC0gMWUzICogZSkpO1xuICAgICAgICByZXR1cm4gbmV3IGF0KGUsIG4pO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDb252ZXJ0cyBhIGBUaW1lc3RhbXBgIHRvIGEgSmF2YVNjcmlwdCBgRGF0ZWAgb2JqZWN0LiBUaGlzIGNvbnZlcnNpb25cbiAgICAgKiBjYXVzZXMgYSBsb3NzIG9mIHByZWNpc2lvbiBzaW5jZSBgRGF0ZWAgb2JqZWN0cyBvbmx5IHN1cHBvcnQgbWlsbGlzZWNvbmRcbiAgICAgKiBwcmVjaXNpb24uXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyBKYXZhU2NyaXB0IGBEYXRlYCBvYmplY3QgcmVwcmVzZW50aW5nIHRoZSBzYW1lIHBvaW50IGluIHRpbWUgYXNcbiAgICAgKiAgICAgdGhpcyBgVGltZXN0YW1wYCwgd2l0aCBtaWxsaXNlY29uZCBwcmVjaXNpb24uXG4gICAgICovICAgIHRvRGF0ZSgpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEYXRlKHRoaXMudG9NaWxsaXMoKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENvbnZlcnRzIGEgYFRpbWVzdGFtcGAgdG8gYSBudW1lcmljIHRpbWVzdGFtcCAoaW4gbWlsbGlzZWNvbmRzIHNpbmNlXG4gICAgICogZXBvY2gpLiBUaGlzIG9wZXJhdGlvbiBjYXVzZXMgYSBsb3NzIG9mIHByZWNpc2lvbi5cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIFRoZSBwb2ludCBpbiB0aW1lIGNvcnJlc3BvbmRpbmcgdG8gdGhpcyB0aW1lc3RhbXAsIHJlcHJlc2VudGVkIGFzXG4gICAgICogICAgIHRoZSBudW1iZXIgb2YgbWlsbGlzZWNvbmRzIHNpbmNlIFVuaXggZXBvY2ggMTk3MC0wMS0wMVQwMDowMDowMFouXG4gICAgICovICAgIHRvTWlsbGlzKCkge1xuICAgICAgICByZXR1cm4gMWUzICogdGhpcy5zZWNvbmRzICsgdGhpcy5uYW5vc2Vjb25kcyAvIDFlNjtcbiAgICB9XG4gICAgX2NvbXBhcmVUbyh0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNlY29uZHMgPT09IHQuc2Vjb25kcyA/IHJ0KHRoaXMubmFub3NlY29uZHMsIHQubmFub3NlY29uZHMpIDogcnQodGhpcy5zZWNvbmRzLCB0LnNlY29uZHMpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRydWUgaWYgdGhpcyBgVGltZXN0YW1wYCBpcyBlcXVhbCB0byB0aGUgcHJvdmlkZWQgb25lLlxuICAgICAqXG4gICAgICogQHBhcmFtIG90aGVyIC0gVGhlIGBUaW1lc3RhbXBgIHRvIGNvbXBhcmUgYWdhaW5zdC5cbiAgICAgKiBAcmV0dXJucyB0cnVlIGlmIHRoaXMgYFRpbWVzdGFtcGAgaXMgZXF1YWwgdG8gdGhlIHByb3ZpZGVkIG9uZS5cbiAgICAgKi8gICAgaXNFcXVhbCh0KSB7XG4gICAgICAgIHJldHVybiB0LnNlY29uZHMgPT09IHRoaXMuc2Vjb25kcyAmJiB0Lm5hbm9zZWNvbmRzID09PSB0aGlzLm5hbm9zZWNvbmRzO1xuICAgIH1cbiAgICAvKiogUmV0dXJucyBhIHRleHR1YWwgcmVwcmVzZW50YXRpb24gb2YgdGhpcyBgVGltZXN0YW1wYC4gKi8gICAgdG9TdHJpbmcoKSB7XG4gICAgICAgIHJldHVybiBcIlRpbWVzdGFtcChzZWNvbmRzPVwiICsgdGhpcy5zZWNvbmRzICsgXCIsIG5hbm9zZWNvbmRzPVwiICsgdGhpcy5uYW5vc2Vjb25kcyArIFwiKVwiO1xuICAgIH1cbiAgICAvKiogUmV0dXJucyBhIEpTT04tc2VyaWFsaXphYmxlIHJlcHJlc2VudGF0aW9uIG9mIHRoaXMgYFRpbWVzdGFtcGAuICovICAgIHRvSlNPTigpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHNlY29uZHM6IHRoaXMuc2Vjb25kcyxcbiAgICAgICAgICAgIG5hbm9zZWNvbmRzOiB0aGlzLm5hbm9zZWNvbmRzXG4gICAgICAgIH07XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENvbnZlcnRzIHRoaXMgb2JqZWN0IHRvIGEgcHJpbWl0aXZlIHN0cmluZywgd2hpY2ggYWxsb3dzIGBUaW1lc3RhbXBgIG9iamVjdHNcbiAgICAgKiB0byBiZSBjb21wYXJlZCB1c2luZyB0aGUgYD5gLCBgPD1gLCBgPj1gIGFuZCBgPmAgb3BlcmF0b3JzLlxuICAgICAqLyAgICB2YWx1ZU9mKCkge1xuICAgICAgICAvLyBUaGlzIG1ldGhvZCByZXR1cm5zIGEgc3RyaW5nIG9mIHRoZSBmb3JtIDxzZWNvbmRzPi48bmFub3NlY29uZHM+IHdoZXJlXG4gICAgICAgIC8vIDxzZWNvbmRzPiBpcyB0cmFuc2xhdGVkIHRvIGhhdmUgYSBub24tbmVnYXRpdmUgdmFsdWUgYW5kIGJvdGggPHNlY29uZHM+XG4gICAgICAgIC8vIGFuZCA8bmFub3NlY29uZHM+IGFyZSBsZWZ0LXBhZGRlZCB3aXRoIHplcm9lcyB0byBiZSBhIGNvbnNpc3RlbnQgbGVuZ3RoLlxuICAgICAgICAvLyBTdHJpbmdzIHdpdGggdGhpcyBmb3JtYXQgdGhlbiBoYXZlIGEgbGV4aW9ncmFwaGljYWwgb3JkZXJpbmcgdGhhdCBtYXRjaGVzXG4gICAgICAgIC8vIHRoZSBleHBlY3RlZCBvcmRlcmluZy4gVGhlIDxzZWNvbmRzPiB0cmFuc2xhdGlvbiBpcyBkb25lIHRvIGF2b2lkIGhhdmluZ1xuICAgICAgICAvLyBhIGxlYWRpbmcgbmVnYXRpdmUgc2lnbiAoaS5lLiBhIGxlYWRpbmcgJy0nIGNoYXJhY3RlcikgaW4gaXRzIHN0cmluZ1xuICAgICAgICAvLyByZXByZXNlbnRhdGlvbiwgd2hpY2ggd291bGQgYWZmZWN0IGl0cyBsZXhpb2dyYXBoaWNhbCBvcmRlcmluZy5cbiAgICAgICAgY29uc3QgdCA9IHRoaXMuc2Vjb25kcyAtIC02MjEzNTU5NjgwMDtcbiAgICAgICAgLy8gTm90ZTogVXAgdG8gMTIgZGVjaW1hbCBkaWdpdHMgYXJlIHJlcXVpcmVkIHRvIHJlcHJlc2VudCBhbGwgdmFsaWRcbiAgICAgICAgLy8gJ3NlY29uZHMnIHZhbHVlcy5cbiAgICAgICAgICAgICAgICByZXR1cm4gU3RyaW5nKHQpLnBhZFN0YXJ0KDEyLCBcIjBcIikgKyBcIi5cIiArIFN0cmluZyh0aGlzLm5hbm9zZWNvbmRzKS5wYWRTdGFydCg5LCBcIjBcIik7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBBIHZlcnNpb24gb2YgYSBkb2N1bWVudCBpbiBGaXJlc3RvcmUuIFRoaXMgY29ycmVzcG9uZHMgdG8gdGhlIHZlcnNpb25cbiAqIHRpbWVzdGFtcCwgc3VjaCBhcyB1cGRhdGVfdGltZSBvciByZWFkX3RpbWUuXG4gKi8gY2xhc3MgY3Qge1xuICAgIGNvbnN0cnVjdG9yKHQpIHtcbiAgICAgICAgdGhpcy50aW1lc3RhbXAgPSB0O1xuICAgIH1cbiAgICBzdGF0aWMgZnJvbVRpbWVzdGFtcCh0KSB7XG4gICAgICAgIHJldHVybiBuZXcgY3QodCk7XG4gICAgfVxuICAgIHN0YXRpYyBtaW4oKSB7XG4gICAgICAgIHJldHVybiBuZXcgY3QobmV3IGF0KDAsIDApKTtcbiAgICB9XG4gICAgc3RhdGljIG1heCgpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBjdChuZXcgYXQoMjUzNDAyMzAwNzk5LCA5OTk5OTk5OTkpKTtcbiAgICB9XG4gICAgY29tcGFyZVRvKHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudGltZXN0YW1wLl9jb21wYXJlVG8odC50aW1lc3RhbXApO1xuICAgIH1cbiAgICBpc0VxdWFsKHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudGltZXN0YW1wLmlzRXF1YWwodC50aW1lc3RhbXApO1xuICAgIH1cbiAgICAvKiogUmV0dXJucyBhIG51bWJlciByZXByZXNlbnRhdGlvbiBvZiB0aGUgdmVyc2lvbiBmb3IgdXNlIGluIHNwZWMgdGVzdHMuICovICAgIHRvTWljcm9zZWNvbmRzKCkge1xuICAgICAgICAvLyBDb252ZXJ0IHRvIG1pY3Jvc2Vjb25kcy5cbiAgICAgICAgcmV0dXJuIDFlNiAqIHRoaXMudGltZXN0YW1wLnNlY29uZHMgKyB0aGlzLnRpbWVzdGFtcC5uYW5vc2Vjb25kcyAvIDFlMztcbiAgICB9XG4gICAgdG9TdHJpbmcoKSB7XG4gICAgICAgIHJldHVybiBcIlNuYXBzaG90VmVyc2lvbihcIiArIHRoaXMudGltZXN0YW1wLnRvU3RyaW5nKCkgKyBcIilcIjtcbiAgICB9XG4gICAgdG9UaW1lc3RhbXAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnRpbWVzdGFtcDtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovIGZ1bmN0aW9uIGh0KHQpIHtcbiAgICBsZXQgZSA9IDA7XG4gICAgZm9yIChjb25zdCBuIGluIHQpIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbCh0LCBuKSAmJiBlKys7XG4gICAgcmV0dXJuIGU7XG59XG5cbmZ1bmN0aW9uIGx0KHQsIGUpIHtcbiAgICBmb3IgKGNvbnN0IG4gaW4gdCkgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHQsIG4pICYmIGUobiwgdFtuXSk7XG59XG5cbmZ1bmN0aW9uIGZ0KHQpIHtcbiAgICBmb3IgKGNvbnN0IGUgaW4gdCkgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbCh0LCBlKSkgcmV0dXJuICExO1xuICAgIHJldHVybiAhMDtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogUGF0aCByZXByZXNlbnRzIGFuIG9yZGVyZWQgc2VxdWVuY2Ugb2Ygc3RyaW5nIHNlZ21lbnRzLlxuICovXG5jbGFzcyBkdCB7XG4gICAgY29uc3RydWN0b3IodCwgZSwgbikge1xuICAgICAgICB2b2lkIDAgPT09IGUgPyBlID0gMCA6IGUgPiB0Lmxlbmd0aCAmJiBMKCksIHZvaWQgMCA9PT0gbiA/IG4gPSB0Lmxlbmd0aCAtIGUgOiBuID4gdC5sZW5ndGggLSBlICYmIEwoKSwgXG4gICAgICAgIHRoaXMuc2VnbWVudHMgPSB0LCB0aGlzLm9mZnNldCA9IGUsIHRoaXMubGVuID0gbjtcbiAgICB9XG4gICAgZ2V0IGxlbmd0aCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubGVuO1xuICAgIH1cbiAgICBpc0VxdWFsKHQpIHtcbiAgICAgICAgcmV0dXJuIDAgPT09IGR0LmNvbXBhcmF0b3IodGhpcywgdCk7XG4gICAgfVxuICAgIGNoaWxkKHQpIHtcbiAgICAgICAgY29uc3QgZSA9IHRoaXMuc2VnbWVudHMuc2xpY2UodGhpcy5vZmZzZXQsIHRoaXMubGltaXQoKSk7XG4gICAgICAgIHJldHVybiB0IGluc3RhbmNlb2YgZHQgPyB0LmZvckVhY2goKHQgPT4ge1xuICAgICAgICAgICAgZS5wdXNoKHQpO1xuICAgICAgICB9KSkgOiBlLnB1c2godCksIHRoaXMuY29uc3RydWN0KGUpO1xuICAgIH1cbiAgICAvKiogVGhlIGluZGV4IG9mIG9uZSBwYXN0IHRoZSBsYXN0IHNlZ21lbnQgb2YgdGhlIHBhdGguICovICAgIGxpbWl0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5vZmZzZXQgKyB0aGlzLmxlbmd0aDtcbiAgICB9XG4gICAgcG9wRmlyc3QodCkge1xuICAgICAgICByZXR1cm4gdCA9IHZvaWQgMCA9PT0gdCA/IDEgOiB0LCB0aGlzLmNvbnN0cnVjdCh0aGlzLnNlZ21lbnRzLCB0aGlzLm9mZnNldCArIHQsIHRoaXMubGVuZ3RoIC0gdCk7XG4gICAgfVxuICAgIHBvcExhc3QoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNvbnN0cnVjdCh0aGlzLnNlZ21lbnRzLCB0aGlzLm9mZnNldCwgdGhpcy5sZW5ndGggLSAxKTtcbiAgICB9XG4gICAgZmlyc3RTZWdtZW50KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zZWdtZW50c1t0aGlzLm9mZnNldF07XG4gICAgfVxuICAgIGxhc3RTZWdtZW50KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXQodGhpcy5sZW5ndGggLSAxKTtcbiAgICB9XG4gICAgZ2V0KHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2VnbWVudHNbdGhpcy5vZmZzZXQgKyB0XTtcbiAgICB9XG4gICAgaXNFbXB0eSgpIHtcbiAgICAgICAgcmV0dXJuIDAgPT09IHRoaXMubGVuZ3RoO1xuICAgIH1cbiAgICBpc1ByZWZpeE9mKHQpIHtcbiAgICAgICAgaWYgKHQubGVuZ3RoIDwgdGhpcy5sZW5ndGgpIHJldHVybiAhMTtcbiAgICAgICAgZm9yIChsZXQgZSA9IDA7IGUgPCB0aGlzLmxlbmd0aDsgZSsrKSBpZiAodGhpcy5nZXQoZSkgIT09IHQuZ2V0KGUpKSByZXR1cm4gITE7XG4gICAgICAgIHJldHVybiAhMDtcbiAgICB9XG4gICAgaXNJbW1lZGlhdGVQYXJlbnRPZih0KSB7XG4gICAgICAgIGlmICh0aGlzLmxlbmd0aCArIDEgIT09IHQubGVuZ3RoKSByZXR1cm4gITE7XG4gICAgICAgIGZvciAobGV0IGUgPSAwOyBlIDwgdGhpcy5sZW5ndGg7IGUrKykgaWYgKHRoaXMuZ2V0KGUpICE9PSB0LmdldChlKSkgcmV0dXJuICExO1xuICAgICAgICByZXR1cm4gITA7XG4gICAgfVxuICAgIGZvckVhY2godCkge1xuICAgICAgICBmb3IgKGxldCBlID0gdGhpcy5vZmZzZXQsIG4gPSB0aGlzLmxpbWl0KCk7IGUgPCBuOyBlKyspIHQodGhpcy5zZWdtZW50c1tlXSk7XG4gICAgfVxuICAgIHRvQXJyYXkoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNlZ21lbnRzLnNsaWNlKHRoaXMub2Zmc2V0LCB0aGlzLmxpbWl0KCkpO1xuICAgIH1cbiAgICBzdGF0aWMgY29tcGFyYXRvcih0LCBlKSB7XG4gICAgICAgIGNvbnN0IG4gPSBNYXRoLm1pbih0Lmxlbmd0aCwgZS5sZW5ndGgpO1xuICAgICAgICBmb3IgKGxldCBzID0gMDsgcyA8IG47IHMrKykge1xuICAgICAgICAgICAgY29uc3QgbiA9IHQuZ2V0KHMpLCBpID0gZS5nZXQocyk7XG4gICAgICAgICAgICBpZiAobiA8IGkpIHJldHVybiAtMTtcbiAgICAgICAgICAgIGlmIChuID4gaSkgcmV0dXJuIDE7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHQubGVuZ3RoIDwgZS5sZW5ndGggPyAtMSA6IHQubGVuZ3RoID4gZS5sZW5ndGggPyAxIDogMDtcbiAgICB9XG59XG5cbi8qKlxuICogQSBzbGFzaC1zZXBhcmF0ZWQgcGF0aCBmb3IgbmF2aWdhdGluZyByZXNvdXJjZXMgKGRvY3VtZW50cyBhbmQgY29sbGVjdGlvbnMpXG4gKiB3aXRoaW4gRmlyZXN0b3JlLlxuICpcbiAqIEBpbnRlcm5hbFxuICovIGNsYXNzIF90IGV4dGVuZHMgZHQge1xuICAgIGNvbnN0cnVjdCh0LCBlLCBuKSB7XG4gICAgICAgIHJldHVybiBuZXcgX3QodCwgZSwgbik7XG4gICAgfVxuICAgIGNhbm9uaWNhbFN0cmluZygpIHtcbiAgICAgICAgLy8gTk9URTogVGhlIGNsaWVudCBpcyBpZ25vcmFudCBvZiBhbnkgcGF0aCBzZWdtZW50cyBjb250YWluaW5nIGVzY2FwZVxuICAgICAgICAvLyBzZXF1ZW5jZXMgKGUuZy4gX19pZDEyM19fKSBhbmQganVzdCBwYXNzZXMgdGhlbSB0aHJvdWdoIHJhdyAodGhleSBleGlzdFxuICAgICAgICAvLyBmb3IgbGVnYWN5IHJlYXNvbnMgYW5kIHNob3VsZCBub3QgYmUgdXNlZCBmcmVxdWVudGx5KS5cbiAgICAgICAgcmV0dXJuIHRoaXMudG9BcnJheSgpLmpvaW4oXCIvXCIpO1xuICAgIH1cbiAgICB0b1N0cmluZygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2Fub25pY2FsU3RyaW5nKCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSByZXNvdXJjZSBwYXRoIGZyb20gdGhlIGdpdmVuIHNsYXNoLWRlbGltaXRlZCBzdHJpbmcuIElmIG11bHRpcGxlXG4gICAgICogYXJndW1lbnRzIGFyZSBwcm92aWRlZCwgYWxsIGNvbXBvbmVudHMgYXJlIGNvbWJpbmVkLiBMZWFkaW5nIGFuZCB0cmFpbGluZ1xuICAgICAqIHNsYXNoZXMgZnJvbSBhbGwgY29tcG9uZW50cyBhcmUgaWdub3JlZC5cbiAgICAgKi8gICAgc3RhdGljIGZyb21TdHJpbmcoLi4udCkge1xuICAgICAgICAvLyBOT1RFOiBUaGUgY2xpZW50IGlzIGlnbm9yYW50IG9mIGFueSBwYXRoIHNlZ21lbnRzIGNvbnRhaW5pbmcgZXNjYXBlXG4gICAgICAgIC8vIHNlcXVlbmNlcyAoZS5nLiBfX2lkMTIzX18pIGFuZCBqdXN0IHBhc3NlcyB0aGVtIHRocm91Z2ggcmF3ICh0aGV5IGV4aXN0XG4gICAgICAgIC8vIGZvciBsZWdhY3kgcmVhc29ucyBhbmQgc2hvdWxkIG5vdCBiZSB1c2VkIGZyZXF1ZW50bHkpLlxuICAgICAgICBjb25zdCBlID0gW107XG4gICAgICAgIGZvciAoY29uc3QgbiBvZiB0KSB7XG4gICAgICAgICAgICBpZiAobi5pbmRleE9mKFwiLy9cIikgPj0gMCkgdGhyb3cgbmV3IFEoRy5JTlZBTElEX0FSR1VNRU5ULCBgSW52YWxpZCBzZWdtZW50ICgke259KS4gUGF0aHMgbXVzdCBub3QgY29udGFpbiAvLyBpbiB0aGVtLmApO1xuICAgICAgICAgICAgLy8gU3RyaXAgbGVhZGluZyBhbmQgdHJhbGluZyBzbGFzaGVkLlxuICAgICAgICAgICAgICAgICAgICAgICAgZS5wdXNoKC4uLm4uc3BsaXQoXCIvXCIpLmZpbHRlcigodCA9PiB0Lmxlbmd0aCA+IDApKSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5ldyBfdChlKTtcbiAgICB9XG4gICAgc3RhdGljIGVtcHR5UGF0aCgpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBfdChbXSk7XG4gICAgfVxufVxuXG5jb25zdCB3dCA9IC9eW19hLXpBLVpdW19hLXpBLVowLTldKiQvO1xuXG4vKipcbiAqIEEgZG90LXNlcGFyYXRlZCBwYXRoIGZvciBuYXZpZ2F0aW5nIHN1Yi1vYmplY3RzIHdpdGhpbiBhIGRvY3VtZW50LlxuICogQGludGVybmFsXG4gKi8gY2xhc3MgbXQgZXh0ZW5kcyBkdCB7XG4gICAgY29uc3RydWN0KHQsIGUsIG4pIHtcbiAgICAgICAgcmV0dXJuIG5ldyBtdCh0LCBlLCBuKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0cnVlIGlmIHRoZSBzdHJpbmcgY291bGQgYmUgdXNlZCBhcyBhIHNlZ21lbnQgaW4gYSBmaWVsZCBwYXRoXG4gICAgICogd2l0aG91dCBlc2NhcGluZy5cbiAgICAgKi8gICAgc3RhdGljIGlzVmFsaWRJZGVudGlmaWVyKHQpIHtcbiAgICAgICAgcmV0dXJuIHd0LnRlc3QodCk7XG4gICAgfVxuICAgIGNhbm9uaWNhbFN0cmluZygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudG9BcnJheSgpLm1hcCgodCA9PiAodCA9IHQucmVwbGFjZSgvXFxcXC9nLCBcIlxcXFxcXFxcXCIpLnJlcGxhY2UoL2AvZywgXCJcXFxcYFwiKSwgXG4gICAgICAgIG10LmlzVmFsaWRJZGVudGlmaWVyKHQpIHx8ICh0ID0gXCJgXCIgKyB0ICsgXCJgXCIpLCB0KSkpLmpvaW4oXCIuXCIpO1xuICAgIH1cbiAgICB0b1N0cmluZygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2Fub25pY2FsU3RyaW5nKCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdHJ1ZSBpZiB0aGlzIGZpZWxkIHJlZmVyZW5jZXMgdGhlIGtleSBvZiBhIGRvY3VtZW50LlxuICAgICAqLyAgICBpc0tleUZpZWxkKCkge1xuICAgICAgICByZXR1cm4gMSA9PT0gdGhpcy5sZW5ndGggJiYgXCJfX25hbWVfX1wiID09PSB0aGlzLmdldCgwKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVGhlIGZpZWxkIGRlc2lnbmF0aW5nIHRoZSBrZXkgb2YgYSBkb2N1bWVudC5cbiAgICAgKi8gICAgc3RhdGljIGtleUZpZWxkKCkge1xuICAgICAgICByZXR1cm4gbmV3IG10KFsgXCJfX25hbWVfX1wiIF0pO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBQYXJzZXMgYSBmaWVsZCBzdHJpbmcgZnJvbSB0aGUgZ2l2ZW4gc2VydmVyLWZvcm1hdHRlZCBzdHJpbmcuXG4gICAgICpcbiAgICAgKiAtIFNwbGl0dGluZyB0aGUgZW1wdHkgc3RyaW5nIGlzIG5vdCBhbGxvd2VkIChmb3Igbm93IGF0IGxlYXN0KS5cbiAgICAgKiAtIEVtcHR5IHNlZ21lbnRzIHdpdGhpbiB0aGUgc3RyaW5nIChlLmcuIGlmIHRoZXJlIGFyZSB0d28gY29uc2VjdXRpdmVcbiAgICAgKiAgIHNlcGFyYXRvcnMpIGFyZSBub3QgYWxsb3dlZC5cbiAgICAgKlxuICAgICAqIFRPRE8oYi8zNzI0NDE1Nyk6IHdlIHNob3VsZCBtYWtlIHRoaXMgbW9yZSBzdHJpY3QuIFJpZ2h0IG5vdywgaXQgYWxsb3dzXG4gICAgICogbm9uLWlkZW50aWZpZXIgcGF0aCBjb21wb25lbnRzLCBldmVuIGlmIHRoZXkgYXJlbid0IGVzY2FwZWQuXG4gICAgICovICAgIHN0YXRpYyBmcm9tU2VydmVyRm9ybWF0KHQpIHtcbiAgICAgICAgY29uc3QgZSA9IFtdO1xuICAgICAgICBsZXQgbiA9IFwiXCIsIHMgPSAwO1xuICAgICAgICBjb25zdCBpID0gKCkgPT4ge1xuICAgICAgICAgICAgaWYgKDAgPT09IG4ubGVuZ3RoKSB0aHJvdyBuZXcgUShHLklOVkFMSURfQVJHVU1FTlQsIGBJbnZhbGlkIGZpZWxkIHBhdGggKCR7dH0pLiBQYXRocyBtdXN0IG5vdCBiZSBlbXB0eSwgYmVnaW4gd2l0aCAnLicsIGVuZCB3aXRoICcuJywgb3IgY29udGFpbiAnLi4nYCk7XG4gICAgICAgICAgICBlLnB1c2gobiksIG4gPSBcIlwiO1xuICAgICAgICB9O1xuICAgICAgICBsZXQgciA9ICExO1xuICAgICAgICBmb3IgKDtzIDwgdC5sZW5ndGg7ICkge1xuICAgICAgICAgICAgY29uc3QgZSA9IHRbc107XG4gICAgICAgICAgICBpZiAoXCJcXFxcXCIgPT09IGUpIHtcbiAgICAgICAgICAgICAgICBpZiAocyArIDEgPT09IHQubGVuZ3RoKSB0aHJvdyBuZXcgUShHLklOVkFMSURfQVJHVU1FTlQsIFwiUGF0aCBoYXMgdHJhaWxpbmcgZXNjYXBlIGNoYXJhY3RlcjogXCIgKyB0KTtcbiAgICAgICAgICAgICAgICBjb25zdCBlID0gdFtzICsgMV07XG4gICAgICAgICAgICAgICAgaWYgKFwiXFxcXFwiICE9PSBlICYmIFwiLlwiICE9PSBlICYmIFwiYFwiICE9PSBlKSB0aHJvdyBuZXcgUShHLklOVkFMSURfQVJHVU1FTlQsIFwiUGF0aCBoYXMgaW52YWxpZCBlc2NhcGUgc2VxdWVuY2U6IFwiICsgdCk7XG4gICAgICAgICAgICAgICAgbiArPSBlLCBzICs9IDI7XG4gICAgICAgICAgICB9IGVsc2UgXCJgXCIgPT09IGUgPyAociA9ICFyLCBzKyspIDogXCIuXCIgIT09IGUgfHwgciA/IChuICs9IGUsIHMrKykgOiAoaSgpLCBzKyspO1xuICAgICAgICB9XG4gICAgICAgIGlmIChpKCksIHIpIHRocm93IG5ldyBRKEcuSU5WQUxJRF9BUkdVTUVOVCwgXCJVbnRlcm1pbmF0ZWQgYCBpbiBwYXRoOiBcIiArIHQpO1xuICAgICAgICByZXR1cm4gbmV3IG10KGUpO1xuICAgIH1cbiAgICBzdGF0aWMgZW1wdHlQYXRoKCkge1xuICAgICAgICByZXR1cm4gbmV3IG10KFtdKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIFByb3ZpZGVzIGEgc2V0IG9mIGZpZWxkcyB0aGF0IGNhbiBiZSB1c2VkIHRvIHBhcnRpYWxseSBwYXRjaCBhIGRvY3VtZW50LlxuICogRmllbGRNYXNrIGlzIHVzZWQgaW4gY29uanVuY3Rpb24gd2l0aCBPYmplY3RWYWx1ZS5cbiAqIEV4YW1wbGVzOlxuICogICBmb28gLSBPdmVyd3JpdGVzIGZvbyBlbnRpcmVseSB3aXRoIHRoZSBwcm92aWRlZCB2YWx1ZS4gSWYgZm9vIGlzIG5vdFxuICogICAgICAgICBwcmVzZW50IGluIHRoZSBjb21wYW5pb24gT2JqZWN0VmFsdWUsIHRoZSBmaWVsZCBpcyBkZWxldGVkLlxuICogICBmb28uYmFyIC0gT3ZlcndyaXRlcyBvbmx5IHRoZSBmaWVsZCBiYXIgb2YgdGhlIG9iamVjdCBmb28uXG4gKiAgICAgICAgICAgICBJZiBmb28gaXMgbm90IGFuIG9iamVjdCwgZm9vIGlzIHJlcGxhY2VkIHdpdGggYW4gb2JqZWN0XG4gKiAgICAgICAgICAgICBjb250YWluaW5nIGZvb1xuICovIGNsYXNzIGd0IHtcbiAgICBjb25zdHJ1Y3Rvcih0KSB7XG4gICAgICAgIHRoaXMuZmllbGRzID0gdCwgXG4gICAgICAgIC8vIFRPRE8oZGltb25kKTogdmFsaWRhdGlvbiBvZiBGaWVsZE1hc2tcbiAgICAgICAgLy8gU29ydCB0aGUgZmllbGQgbWFzayB0byBzdXBwb3J0IGBGaWVsZE1hc2suaXNFcXVhbCgpYCBhbmQgYXNzZXJ0IGJlbG93LlxuICAgICAgICB0LnNvcnQobXQuY29tcGFyYXRvcik7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFZlcmlmaWVzIHRoYXQgYGZpZWxkUGF0aGAgaXMgaW5jbHVkZWQgYnkgYXQgbGVhc3Qgb25lIGZpZWxkIGluIHRoaXMgZmllbGRcbiAgICAgKiBtYXNrLlxuICAgICAqXG4gICAgICogVGhpcyBpcyBhbiBPKG4pIG9wZXJhdGlvbiwgd2hlcmUgYG5gIGlzIHRoZSBzaXplIG9mIHRoZSBmaWVsZCBtYXNrLlxuICAgICAqLyAgICBjb3ZlcnModCkge1xuICAgICAgICBmb3IgKGNvbnN0IGUgb2YgdGhpcy5maWVsZHMpIGlmIChlLmlzUHJlZml4T2YodCkpIHJldHVybiAhMDtcbiAgICAgICAgcmV0dXJuICExO1xuICAgIH1cbiAgICBpc0VxdWFsKHQpIHtcbiAgICAgICAgcmV0dXJuIG90KHRoaXMuZmllbGRzLCB0LmZpZWxkcywgKCh0LCBlKSA9PiB0LmlzRXF1YWwoZSkpKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKiogQ29udmVydHMgYSBCYXNlNjQgZW5jb2RlZCBzdHJpbmcgdG8gYSBiaW5hcnkgc3RyaW5nLiAqL1xuLyoqIFRydWUgaWYgYW5kIG9ubHkgaWYgdGhlIEJhc2U2NCBjb252ZXJzaW9uIGZ1bmN0aW9ucyBhcmUgYXZhaWxhYmxlLiAqL1xuZnVuY3Rpb24geXQoKSB7XG4gICAgcmV0dXJuIFwidW5kZWZpbmVkXCIgIT0gdHlwZW9mIGF0b2I7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEltbXV0YWJsZSBjbGFzcyB0aGF0IHJlcHJlc2VudHMgYSBcInByb3RvXCIgYnl0ZSBzdHJpbmcuXG4gKlxuICogUHJvdG8gYnl0ZSBzdHJpbmdzIGNhbiBlaXRoZXIgYmUgQmFzZTY0LWVuY29kZWQgc3RyaW5ncyBvciBVaW50OEFycmF5cyB3aGVuXG4gKiBzZW50IG9uIHRoZSB3aXJlLiBUaGlzIGNsYXNzIGFic3RyYWN0cyBhd2F5IHRoaXMgZGlmZmVyZW50aWF0aW9uIGJ5IGhvbGRpbmdcbiAqIHRoZSBwcm90byBieXRlIHN0cmluZyBpbiBhIGNvbW1vbiBjbGFzcyB0aGF0IG11c3QgYmUgY29udmVydGVkIGludG8gYSBzdHJpbmdcbiAqIGJlZm9yZSBiZWluZyBzZW50IGFzIGEgcHJvdG8uXG4gKiBAaW50ZXJuYWxcbiAqLyBjbGFzcyBwdCB7XG4gICAgY29uc3RydWN0b3IodCkge1xuICAgICAgICB0aGlzLmJpbmFyeVN0cmluZyA9IHQ7XG4gICAgfVxuICAgIHN0YXRpYyBmcm9tQmFzZTY0U3RyaW5nKHQpIHtcbiAgICAgICAgY29uc3QgZSA9IGF0b2IodCk7XG4gICAgICAgIHJldHVybiBuZXcgcHQoZSk7XG4gICAgfVxuICAgIHN0YXRpYyBmcm9tVWludDhBcnJheSh0KSB7XG4gICAgICAgIC8vIFRPRE8oaW5kZXhpbmcpOyBSZW1vdmUgdGhlIGNvcHkgb2YgdGhlIGJ5dGUgc3RyaW5nIGhlcmUgYXMgdGhpcyBtZXRob2RcbiAgICAgICAgLy8gaXMgZnJlcXVlbnRseSBjYWxsZWQgZHVyaW5nIGluZGV4aW5nLlxuICAgICAgICBjb25zdCBlID0gXG4gICAgICAgIC8qKlxuICogSGVscGVyIGZ1bmN0aW9uIHRvIGNvbnZlcnQgYW4gVWludDhhcnJheSB0byBhIGJpbmFyeSBzdHJpbmcuXG4gKi9cbiAgICAgICAgZnVuY3Rpb24odCkge1xuICAgICAgICAgICAgbGV0IGUgPSBcIlwiO1xuICAgICAgICAgICAgZm9yIChsZXQgbiA9IDA7IG4gPCB0Lmxlbmd0aDsgKytuKSBlICs9IFN0cmluZy5mcm9tQ2hhckNvZGUodFtuXSk7XG4gICAgICAgICAgICByZXR1cm4gZTtcbiAgICAgICAgfVxuICAgICAgICAvKipcbiAqIEhlbHBlciBmdW5jdGlvbiB0byBjb252ZXJ0IGEgYmluYXJ5IHN0cmluZyB0byBhbiBVaW50OEFycmF5LlxuICovICh0KTtcbiAgICAgICAgcmV0dXJuIG5ldyBwdChlKTtcbiAgICB9XG4gICAgW1N5bWJvbC5pdGVyYXRvcl0oKSB7XG4gICAgICAgIGxldCB0ID0gMDtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIG5leHQ6ICgpID0+IHQgPCB0aGlzLmJpbmFyeVN0cmluZy5sZW5ndGggPyB7XG4gICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuYmluYXJ5U3RyaW5nLmNoYXJDb2RlQXQodCsrKSxcbiAgICAgICAgICAgICAgICBkb25lOiAhMVxuICAgICAgICAgICAgfSA6IHtcbiAgICAgICAgICAgICAgICB2YWx1ZTogdm9pZCAwLFxuICAgICAgICAgICAgICAgIGRvbmU6ICEwXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfVxuICAgIHRvQmFzZTY0KCkge1xuICAgICAgICByZXR1cm4gdCA9IHRoaXMuYmluYXJ5U3RyaW5nLCBidG9hKHQpO1xuICAgICAgICAvKiogQ29udmVydHMgYSBiaW5hcnkgc3RyaW5nIHRvIGEgQmFzZTY0IGVuY29kZWQgc3RyaW5nLiAqL1xuICAgICAgICB2YXIgdDtcbiAgICB9XG4gICAgdG9VaW50OEFycmF5KCkge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24odCkge1xuICAgICAgICAgICAgY29uc3QgZSA9IG5ldyBVaW50OEFycmF5KHQubGVuZ3RoKTtcbiAgICAgICAgICAgIGZvciAobGV0IG4gPSAwOyBuIDwgdC5sZW5ndGg7IG4rKykgZVtuXSA9IHQuY2hhckNvZGVBdChuKTtcbiAgICAgICAgICAgIHJldHVybiBlO1xuICAgICAgICB9XG4gICAgICAgIC8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4gICAgICAgIC8vIEEgUmVnRXhwIG1hdGNoaW5nIElTTyA4NjAxIFVUQyB0aW1lc3RhbXBzIHdpdGggb3B0aW9uYWwgZnJhY3Rpb24uXG4gICAgICAgICh0aGlzLmJpbmFyeVN0cmluZyk7XG4gICAgfVxuICAgIGFwcHJveGltYXRlQnl0ZVNpemUoKSB7XG4gICAgICAgIHJldHVybiAyICogdGhpcy5iaW5hcnlTdHJpbmcubGVuZ3RoO1xuICAgIH1cbiAgICBjb21wYXJlVG8odCkge1xuICAgICAgICByZXR1cm4gcnQodGhpcy5iaW5hcnlTdHJpbmcsIHQuYmluYXJ5U3RyaW5nKTtcbiAgICB9XG4gICAgaXNFcXVhbCh0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLmJpbmFyeVN0cmluZyA9PT0gdC5iaW5hcnlTdHJpbmc7XG4gICAgfVxufVxuXG5wdC5FTVBUWV9CWVRFX1NUUklORyA9IG5ldyBwdChcIlwiKTtcblxuY29uc3QgSXQgPSBuZXcgUmVnRXhwKC9eXFxkezR9LVxcZFxcZC1cXGRcXGRUXFxkXFxkOlxcZFxcZDpcXGRcXGQoPzpcXC4oXFxkKykpP1okLyk7XG5cbi8qKlxuICogQ29udmVydHMgdGhlIHBvc3NpYmxlIFByb3RvIHZhbHVlcyBmb3IgYSB0aW1lc3RhbXAgdmFsdWUgaW50byBhIFwic2Vjb25kcyBhbmRcbiAqIG5hbm9zXCIgcmVwcmVzZW50YXRpb24uXG4gKi8gZnVuY3Rpb24gVHQodCkge1xuICAgIC8vIFRoZSBqc29uIGludGVyZmFjZSAoZm9yIHRoZSBicm93c2VyKSB3aWxsIHJldHVybiBhbiBpc28gdGltZXN0YW1wIHN0cmluZyxcbiAgICAvLyB3aGlsZSB0aGUgcHJvdG8ganMgbGlicmFyeSAoZm9yIG5vZGUpIHdpbGwgcmV0dXJuIGFcbiAgICAvLyBnb29nbGUucHJvdG9idWYuVGltZXN0YW1wIGluc3RhbmNlLlxuICAgIGlmIChVKCEhdCksIFwic3RyaW5nXCIgPT0gdHlwZW9mIHQpIHtcbiAgICAgICAgLy8gVGhlIGRhdGUgc3RyaW5nIGNhbiBoYXZlIGhpZ2hlciBwcmVjaXNpb24gKG5hbm9zKSB0aGFuIHRoZSBEYXRlIGNsYXNzXG4gICAgICAgIC8vIChtaWxsaXMpLCBzbyB3ZSBkbyBzb21lIGN1c3RvbSBwYXJzaW5nIGhlcmUuXG4gICAgICAgIC8vIFBhcnNlIHRoZSBuYW5vcyByaWdodCBvdXQgb2YgdGhlIHN0cmluZy5cbiAgICAgICAgbGV0IGUgPSAwO1xuICAgICAgICBjb25zdCBuID0gSXQuZXhlYyh0KTtcbiAgICAgICAgaWYgKFUoISFuKSwgblsxXSkge1xuICAgICAgICAgICAgLy8gUGFkIHRoZSBmcmFjdGlvbiBvdXQgdG8gOSBkaWdpdHMgKG5hbm9zKS5cbiAgICAgICAgICAgIGxldCB0ID0gblsxXTtcbiAgICAgICAgICAgIHQgPSAodCArIFwiMDAwMDAwMDAwXCIpLnN1YnN0cigwLCA5KSwgZSA9IE51bWJlcih0KTtcbiAgICAgICAgfVxuICAgICAgICAvLyBQYXJzZSB0aGUgZGF0ZSB0byBnZXQgdGhlIHNlY29uZHMuXG4gICAgICAgICAgICAgICAgY29uc3QgcyA9IG5ldyBEYXRlKHQpO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgc2Vjb25kczogTWF0aC5mbG9vcihzLmdldFRpbWUoKSAvIDFlMyksXG4gICAgICAgICAgICBuYW5vczogZVxuICAgICAgICB9O1xuICAgIH1cbiAgICByZXR1cm4ge1xuICAgICAgICBzZWNvbmRzOiBFdCh0LnNlY29uZHMpLFxuICAgICAgICBuYW5vczogRXQodC5uYW5vcylcbiAgICB9O1xufVxuXG4vKipcbiAqIENvbnZlcnRzIHRoZSBwb3NzaWJsZSBQcm90byB0eXBlcyBmb3IgbnVtYmVycyBpbnRvIGEgSmF2YVNjcmlwdCBudW1iZXIuXG4gKiBSZXR1cm5zIDAgaWYgdGhlIHZhbHVlIGlzIG5vdCBudW1lcmljLlxuICovIGZ1bmN0aW9uIEV0KHQpIHtcbiAgICAvLyBUT0RPKGJqb3JuaWNrKTogSGFuZGxlIGludDY0IGdyZWF0ZXIgdGhhbiA1MyBiaXRzLlxuICAgIHJldHVybiBcIm51bWJlclwiID09IHR5cGVvZiB0ID8gdCA6IFwic3RyaW5nXCIgPT0gdHlwZW9mIHQgPyBOdW1iZXIodCkgOiAwO1xufVxuXG4vKiogQ29udmVydHMgdGhlIHBvc3NpYmxlIFByb3RvIHR5cGVzIGZvciBCbG9icyBpbnRvIGEgQnl0ZVN0cmluZy4gKi8gZnVuY3Rpb24gQXQodCkge1xuICAgIHJldHVybiBcInN0cmluZ1wiID09IHR5cGVvZiB0ID8gcHQuZnJvbUJhc2U2NFN0cmluZyh0KSA6IHB0LmZyb21VaW50OEFycmF5KHQpO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBSZXByZXNlbnRzIGEgbG9jYWxseS1hcHBsaWVkIFNlcnZlclRpbWVzdGFtcC5cbiAqXG4gKiBTZXJ2ZXIgVGltZXN0YW1wcyBhcmUgYmFja2VkIGJ5IE1hcFZhbHVlcyB0aGF0IGNvbnRhaW4gYW4gaW50ZXJuYWwgZmllbGRcbiAqIGBfX3R5cGVfX2Agd2l0aCBhIHZhbHVlIG9mIGBzZXJ2ZXJfdGltZXN0YW1wYC4gVGhlIHByZXZpb3VzIHZhbHVlIGFuZCBsb2NhbFxuICogd3JpdGUgdGltZSBhcmUgc3RvcmVkIGluIGl0cyBgX19wcmV2aW91c192YWx1ZV9fYCBhbmQgYF9fbG9jYWxfd3JpdGVfdGltZV9fYFxuICogZmllbGRzIHJlc3BlY3RpdmVseS5cbiAqXG4gKiBOb3RlczpcbiAqIC0gU2VydmVyVGltZXN0YW1wVmFsdWUgaW5zdGFuY2VzIGFyZSBjcmVhdGVkIGFzIHRoZSByZXN1bHQgb2YgYXBwbHlpbmcgYVxuICogICB0cmFuc2Zvcm0uIFRoZXkgY2FuIG9ubHkgZXhpc3QgaW4gdGhlIGxvY2FsIHZpZXcgb2YgYSBkb2N1bWVudC4gVGhlcmVmb3JlXG4gKiAgIHRoZXkgZG8gbm90IG5lZWQgdG8gYmUgcGFyc2VkIG9yIHNlcmlhbGl6ZWQuXG4gKiAtIFdoZW4gZXZhbHVhdGVkIGxvY2FsbHkgKGUuZy4gZm9yIHNuYXBzaG90LmRhdGEoKSksIHRoZXkgYnkgZGVmYXVsdFxuICogICBldmFsdWF0ZSB0byBgbnVsbGAuIFRoaXMgYmVoYXZpb3IgY2FuIGJlIGNvbmZpZ3VyZWQgYnkgcGFzc2luZyBjdXN0b21cbiAqICAgRmllbGRWYWx1ZU9wdGlvbnMgdG8gdmFsdWUoKS5cbiAqIC0gV2l0aCByZXNwZWN0IHRvIG90aGVyIFNlcnZlclRpbWVzdGFtcFZhbHVlcywgdGhleSBzb3J0IGJ5IHRoZWlyXG4gKiAgIGxvY2FsV3JpdGVUaW1lLlxuICovIGZ1bmN0aW9uIFJ0KHQpIHtcbiAgICB2YXIgZSwgbjtcbiAgICByZXR1cm4gXCJzZXJ2ZXJfdGltZXN0YW1wXCIgPT09IChudWxsID09PSAobiA9ICgobnVsbCA9PT0gKGUgPSBudWxsID09IHQgPyB2b2lkIDAgOiB0Lm1hcFZhbHVlKSB8fCB2b2lkIDAgPT09IGUgPyB2b2lkIDAgOiBlLmZpZWxkcykgfHwge30pLl9fdHlwZV9fKSB8fCB2b2lkIDAgPT09IG4gPyB2b2lkIDAgOiBuLnN0cmluZ1ZhbHVlKTtcbn1cblxuLyoqXG4gKiBDcmVhdGVzIGEgbmV3IFNlcnZlclRpbWVzdGFtcCBwcm90byB2YWx1ZSAodXNpbmcgdGhlIGludGVybmFsIGZvcm1hdCkuXG4gKi9cbi8qKlxuICogUmV0dXJucyB0aGUgdmFsdWUgb2YgdGhlIGZpZWxkIGJlZm9yZSB0aGlzIFNlcnZlclRpbWVzdGFtcCB3YXMgc2V0LlxuICpcbiAqIFByZXNlcnZpbmcgdGhlIHByZXZpb3VzIHZhbHVlcyBhbGxvd3MgdGhlIHVzZXIgdG8gZGlzcGxheSB0aGUgbGFzdCByZXNvbGVkXG4gKiB2YWx1ZSB1bnRpbCB0aGUgYmFja2VuZCByZXNwb25kcyB3aXRoIHRoZSB0aW1lc3RhbXAuXG4gKi9cbmZ1bmN0aW9uIGJ0KHQpIHtcbiAgICBjb25zdCBlID0gdC5tYXBWYWx1ZS5maWVsZHMuX19wcmV2aW91c192YWx1ZV9fO1xuICAgIHJldHVybiBSdChlKSA/IGJ0KGUpIDogZTtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIHRoZSBsb2NhbCB0aW1lIGF0IHdoaWNoIHRoaXMgdGltZXN0YW1wIHdhcyBmaXJzdCBzZXQuXG4gKi8gZnVuY3Rpb24gUHQodCkge1xuICAgIGNvbnN0IGUgPSBUdCh0Lm1hcFZhbHVlLmZpZWxkcy5fX2xvY2FsX3dyaXRlX3RpbWVfXy50aW1lc3RhbXBWYWx1ZSk7XG4gICAgcmV0dXJuIG5ldyBhdChlLnNlY29uZHMsIGUubmFub3MpO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqLyBjbGFzcyBWdCB7XG4gICAgLyoqXG4gICAgICogQ29uc3RydWN0cyBhIERhdGFiYXNlSW5mbyB1c2luZyB0aGUgcHJvdmlkZWQgaG9zdCwgZGF0YWJhc2VJZCBhbmRcbiAgICAgKiBwZXJzaXN0ZW5jZUtleS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBkYXRhYmFzZUlkIC0gVGhlIGRhdGFiYXNlIHRvIHVzZS5cbiAgICAgKiBAcGFyYW0gYXBwSWQgLSBUaGUgRmlyZWJhc2UgQXBwIElkLlxuICAgICAqIEBwYXJhbSBwZXJzaXN0ZW5jZUtleSAtIEEgdW5pcXVlIGlkZW50aWZpZXIgZm9yIHRoaXMgRmlyZXN0b3JlJ3MgbG9jYWxcbiAgICAgKiBzdG9yYWdlICh1c2VkIGluIGNvbmp1bmN0aW9uIHdpdGggdGhlIGRhdGFiYXNlSWQpLlxuICAgICAqIEBwYXJhbSBob3N0IC0gVGhlIEZpcmVzdG9yZSBiYWNrZW5kIGhvc3QgdG8gY29ubmVjdCB0by5cbiAgICAgKiBAcGFyYW0gc3NsIC0gV2hldGhlciB0byB1c2UgU1NMIHdoZW4gY29ubmVjdGluZy5cbiAgICAgKiBAcGFyYW0gZm9yY2VMb25nUG9sbGluZyAtIFdoZXRoZXIgdG8gdXNlIHRoZSBmb3JjZUxvbmdQb2xsaW5nIG9wdGlvblxuICAgICAqIHdoZW4gdXNpbmcgV2ViQ2hhbm5lbCBhcyB0aGUgbmV0d29yayB0cmFuc3BvcnQuXG4gICAgICogQHBhcmFtIGF1dG9EZXRlY3RMb25nUG9sbGluZyAtIFdoZXRoZXIgdG8gdXNlIHRoZSBkZXRlY3RCdWZmZXJpbmdQcm94eVxuICAgICAqIG9wdGlvbiB3aGVuIHVzaW5nIFdlYkNoYW5uZWwgYXMgdGhlIG5ldHdvcmsgdHJhbnNwb3J0LlxuICAgICAqIEBwYXJhbSB1c2VGZXRjaFN0cmVhbXMgV2hldGhlciB0byB1c2UgdGhlIEZldGNoIEFQSSBpbnN0ZWFkIG9mXG4gICAgICogWE1MSFRUUFJlcXVlc3RcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3Rvcih0LCBlLCBuLCBzLCBpLCByLCBvLCB1KSB7XG4gICAgICAgIHRoaXMuZGF0YWJhc2VJZCA9IHQsIHRoaXMuYXBwSWQgPSBlLCB0aGlzLnBlcnNpc3RlbmNlS2V5ID0gbiwgdGhpcy5ob3N0ID0gcywgdGhpcy5zc2wgPSBpLCBcbiAgICAgICAgdGhpcy5mb3JjZUxvbmdQb2xsaW5nID0gciwgdGhpcy5hdXRvRGV0ZWN0TG9uZ1BvbGxpbmcgPSBvLCB0aGlzLnVzZUZldGNoU3RyZWFtcyA9IHU7XG4gICAgfVxufVxuXG4vKiogVGhlIGRlZmF1bHQgZGF0YWJhc2UgbmFtZSBmb3IgYSBwcm9qZWN0LiAqL1xuLyoqXG4gKiBSZXByZXNlbnRzIHRoZSBkYXRhYmFzZSBJRCBhIEZpcmVzdG9yZSBjbGllbnQgaXMgYXNzb2NpYXRlZCB3aXRoLlxuICogQGludGVybmFsXG4gKi9cbmNsYXNzIHZ0IHtcbiAgICBjb25zdHJ1Y3Rvcih0LCBlKSB7XG4gICAgICAgIHRoaXMucHJvamVjdElkID0gdCwgdGhpcy5kYXRhYmFzZSA9IGUgfHwgXCIoZGVmYXVsdClcIjtcbiAgICB9XG4gICAgc3RhdGljIGVtcHR5KCkge1xuICAgICAgICByZXR1cm4gbmV3IHZ0KFwiXCIsIFwiXCIpO1xuICAgIH1cbiAgICBnZXQgaXNEZWZhdWx0RGF0YWJhc2UoKSB7XG4gICAgICAgIHJldHVybiBcIihkZWZhdWx0KVwiID09PSB0aGlzLmRhdGFiYXNlO1xuICAgIH1cbiAgICBpc0VxdWFsKHQpIHtcbiAgICAgICAgcmV0dXJuIHQgaW5zdGFuY2VvZiB2dCAmJiB0LnByb2plY3RJZCA9PT0gdGhpcy5wcm9qZWN0SWQgJiYgdC5kYXRhYmFzZSA9PT0gdGhpcy5kYXRhYmFzZTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKiogU2VudGluZWwgdmFsdWUgdGhhdCBzb3J0cyBiZWZvcmUgYW55IE11dGF0aW9uIEJhdGNoIElELiAqL1xuLyoqXG4gKiBSZXR1cm5zIHdoZXRoZXIgYSB2YXJpYWJsZSBpcyBlaXRoZXIgdW5kZWZpbmVkIG9yIG51bGwuXG4gKi9cbmZ1bmN0aW9uIFN0KHQpIHtcbiAgICByZXR1cm4gbnVsbCA9PSB0O1xufVxuXG4vKiogUmV0dXJucyB3aGV0aGVyIHRoZSB2YWx1ZSByZXByZXNlbnRzIC0wLiAqLyBmdW5jdGlvbiBEdCh0KSB7XG4gICAgLy8gRGV0ZWN0IGlmIHRoZSB2YWx1ZSBpcyAtMC4wLiBCYXNlZCBvbiBwb2x5ZmlsbCBmcm9tXG4gICAgLy8gaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvR2xvYmFsX09iamVjdHMvT2JqZWN0L2lzXG4gICAgcmV0dXJuIDAgPT09IHQgJiYgMSAvIHQgPT0gLTEgLyAwO1xufVxuXG4vKipcbiAqIFJldHVybnMgd2hldGhlciBhIHZhbHVlIGlzIGFuIGludGVnZXIgYW5kIGluIHRoZSBzYWZlIGludGVnZXIgcmFuZ2VcbiAqIEBwYXJhbSB2YWx1ZSAtIFRoZSB2YWx1ZSB0byB0ZXN0IGZvciBiZWluZyBhbiBpbnRlZ2VyIGFuZCBpbiB0aGUgc2FmZSByYW5nZVxuICovIGZ1bmN0aW9uIEN0KHQpIHtcbiAgICByZXR1cm4gXCJudW1iZXJcIiA9PSB0eXBlb2YgdCAmJiBOdW1iZXIuaXNJbnRlZ2VyKHQpICYmICFEdCh0KSAmJiB0IDw9IE51bWJlci5NQVhfU0FGRV9JTlRFR0VSICYmIHQgPj0gTnVtYmVyLk1JTl9TQUZFX0lOVEVHRVI7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEBpbnRlcm5hbFxuICovIGNsYXNzIHh0IHtcbiAgICBjb25zdHJ1Y3Rvcih0KSB7XG4gICAgICAgIHRoaXMucGF0aCA9IHQ7XG4gICAgfVxuICAgIHN0YXRpYyBmcm9tUGF0aCh0KSB7XG4gICAgICAgIHJldHVybiBuZXcgeHQoX3QuZnJvbVN0cmluZyh0KSk7XG4gICAgfVxuICAgIHN0YXRpYyBmcm9tTmFtZSh0KSB7XG4gICAgICAgIHJldHVybiBuZXcgeHQoX3QuZnJvbVN0cmluZyh0KS5wb3BGaXJzdCg1KSk7XG4gICAgfVxuICAgIHN0YXRpYyBlbXB0eSgpIHtcbiAgICAgICAgcmV0dXJuIG5ldyB4dChfdC5lbXB0eVBhdGgoKSk7XG4gICAgfVxuICAgIGdldCBjb2xsZWN0aW9uR3JvdXAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnBhdGgucG9wTGFzdCgpLmxhc3RTZWdtZW50KCk7XG4gICAgfVxuICAgIC8qKiBSZXR1cm5zIHRydWUgaWYgdGhlIGRvY3VtZW50IGlzIGluIHRoZSBzcGVjaWZpZWQgY29sbGVjdGlvbklkLiAqLyAgICBoYXNDb2xsZWN0aW9uSWQodCkge1xuICAgICAgICByZXR1cm4gdGhpcy5wYXRoLmxlbmd0aCA+PSAyICYmIHRoaXMucGF0aC5nZXQodGhpcy5wYXRoLmxlbmd0aCAtIDIpID09PSB0O1xuICAgIH1cbiAgICAvKiogUmV0dXJucyB0aGUgY29sbGVjdGlvbiBncm91cCAoaS5lLiB0aGUgbmFtZSBvZiB0aGUgcGFyZW50IGNvbGxlY3Rpb24pIGZvciB0aGlzIGtleS4gKi8gICAgZ2V0Q29sbGVjdGlvbkdyb3VwKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5wYXRoLmdldCh0aGlzLnBhdGgubGVuZ3RoIC0gMik7XG4gICAgfVxuICAgIC8qKiBSZXR1cm5zIHRoZSBmdWxseSBxdWFsaWZpZWQgcGF0aCB0byB0aGUgcGFyZW50IGNvbGxlY3Rpb24uICovICAgIGdldENvbGxlY3Rpb25QYXRoKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5wYXRoLnBvcExhc3QoKTtcbiAgICB9XG4gICAgaXNFcXVhbCh0KSB7XG4gICAgICAgIHJldHVybiBudWxsICE9PSB0ICYmIDAgPT09IF90LmNvbXBhcmF0b3IodGhpcy5wYXRoLCB0LnBhdGgpO1xuICAgIH1cbiAgICB0b1N0cmluZygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucGF0aC50b1N0cmluZygpO1xuICAgIH1cbiAgICBzdGF0aWMgY29tcGFyYXRvcih0LCBlKSB7XG4gICAgICAgIHJldHVybiBfdC5jb21wYXJhdG9yKHQucGF0aCwgZS5wYXRoKTtcbiAgICB9XG4gICAgc3RhdGljIGlzRG9jdW1lbnRLZXkodCkge1xuICAgICAgICByZXR1cm4gdC5sZW5ndGggJSAyID09IDA7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYW5kIHJldHVybnMgYSBuZXcgZG9jdW1lbnQga2V5IHdpdGggdGhlIGdpdmVuIHNlZ21lbnRzLlxuICAgICAqXG4gICAgICogQHBhcmFtIHNlZ21lbnRzIC0gVGhlIHNlZ21lbnRzIG9mIHRoZSBwYXRoIHRvIHRoZSBkb2N1bWVudFxuICAgICAqIEByZXR1cm5zIEEgbmV3IGluc3RhbmNlIG9mIERvY3VtZW50S2V5XG4gICAgICovICAgIHN0YXRpYyBmcm9tU2VnbWVudHModCkge1xuICAgICAgICByZXR1cm4gbmV3IHh0KG5ldyBfdCh0LnNsaWNlKCkpKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovIGNvbnN0IE50ID0ge1xuICAgIG1hcFZhbHVlOiB7XG4gICAgICAgIGZpZWxkczoge1xuICAgICAgICAgICAgX190eXBlX186IHtcbiAgICAgICAgICAgICAgICBzdHJpbmdWYWx1ZTogXCJfX21heF9fXCJcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn0sIGt0ID0ge1xuICAgIG51bGxWYWx1ZTogXCJOVUxMX1ZBTFVFXCJcbn07XG5cbi8qKiBFeHRyYWN0cyB0aGUgYmFja2VuZCdzIHR5cGUgb3JkZXIgZm9yIHRoZSBwcm92aWRlZCB2YWx1ZS4gKi9cbmZ1bmN0aW9uIE10KHQpIHtcbiAgICByZXR1cm4gXCJudWxsVmFsdWVcIiBpbiB0ID8gMCAvKiBOdWxsVmFsdWUgKi8gOiBcImJvb2xlYW5WYWx1ZVwiIGluIHQgPyAxIC8qIEJvb2xlYW5WYWx1ZSAqLyA6IFwiaW50ZWdlclZhbHVlXCIgaW4gdCB8fCBcImRvdWJsZVZhbHVlXCIgaW4gdCA/IDIgLyogTnVtYmVyVmFsdWUgKi8gOiBcInRpbWVzdGFtcFZhbHVlXCIgaW4gdCA/IDMgLyogVGltZXN0YW1wVmFsdWUgKi8gOiBcInN0cmluZ1ZhbHVlXCIgaW4gdCA/IDUgLyogU3RyaW5nVmFsdWUgKi8gOiBcImJ5dGVzVmFsdWVcIiBpbiB0ID8gNiAvKiBCbG9iVmFsdWUgKi8gOiBcInJlZmVyZW5jZVZhbHVlXCIgaW4gdCA/IDcgLyogUmVmVmFsdWUgKi8gOiBcImdlb1BvaW50VmFsdWVcIiBpbiB0ID8gOCAvKiBHZW9Qb2ludFZhbHVlICovIDogXCJhcnJheVZhbHVlXCIgaW4gdCA/IDkgLyogQXJyYXlWYWx1ZSAqLyA6IFwibWFwVmFsdWVcIiBpbiB0ID8gUnQodCkgPyA0IC8qIFNlcnZlclRpbWVzdGFtcFZhbHVlICovIDogSHQodCkgPyA5MDA3MTk5MjU0NzQwOTkxIC8qIE1heFZhbHVlICovIDogMTAgLyogT2JqZWN0VmFsdWUgKi8gOiBMKCk7XG59XG5cbi8qKiBUZXN0cyBgbGVmdGAgYW5kIGByaWdodGAgZm9yIGVxdWFsaXR5IGJhc2VkIG9uIHRoZSBiYWNrZW5kIHNlbWFudGljcy4gKi8gZnVuY3Rpb24gT3QodCwgZSkge1xuICAgIGlmICh0ID09PSBlKSByZXR1cm4gITA7XG4gICAgY29uc3QgbiA9IE10KHQpO1xuICAgIGlmIChuICE9PSBNdChlKSkgcmV0dXJuICExO1xuICAgIHN3aXRjaCAobikge1xuICAgICAgY2FzZSAwIC8qIE51bGxWYWx1ZSAqLyA6XG4gICAgICBjYXNlIDkwMDcxOTkyNTQ3NDA5OTEgLyogTWF4VmFsdWUgKi8gOlxuICAgICAgICByZXR1cm4gITA7XG5cbiAgICAgIGNhc2UgMSAvKiBCb29sZWFuVmFsdWUgKi8gOlxuICAgICAgICByZXR1cm4gdC5ib29sZWFuVmFsdWUgPT09IGUuYm9vbGVhblZhbHVlO1xuXG4gICAgICBjYXNlIDQgLyogU2VydmVyVGltZXN0YW1wVmFsdWUgKi8gOlxuICAgICAgICByZXR1cm4gUHQodCkuaXNFcXVhbChQdChlKSk7XG5cbiAgICAgIGNhc2UgMyAvKiBUaW1lc3RhbXBWYWx1ZSAqLyA6XG4gICAgICAgIHJldHVybiBmdW5jdGlvbih0LCBlKSB7XG4gICAgICAgICAgICBpZiAoXCJzdHJpbmdcIiA9PSB0eXBlb2YgdC50aW1lc3RhbXBWYWx1ZSAmJiBcInN0cmluZ1wiID09IHR5cGVvZiBlLnRpbWVzdGFtcFZhbHVlICYmIHQudGltZXN0YW1wVmFsdWUubGVuZ3RoID09PSBlLnRpbWVzdGFtcFZhbHVlLmxlbmd0aCkgXG4gICAgICAgICAgICAvLyBVc2Ugc3RyaW5nIGVxdWFsaXR5IGZvciBJU08gODYwMSB0aW1lc3RhbXBzXG4gICAgICAgICAgICByZXR1cm4gdC50aW1lc3RhbXBWYWx1ZSA9PT0gZS50aW1lc3RhbXBWYWx1ZTtcbiAgICAgICAgICAgIGNvbnN0IG4gPSBUdCh0LnRpbWVzdGFtcFZhbHVlKSwgcyA9IFR0KGUudGltZXN0YW1wVmFsdWUpO1xuICAgICAgICAgICAgcmV0dXJuIG4uc2Vjb25kcyA9PT0gcy5zZWNvbmRzICYmIG4ubmFub3MgPT09IHMubmFub3M7XG4gICAgICAgIH0odCwgZSk7XG5cbiAgICAgIGNhc2UgNSAvKiBTdHJpbmdWYWx1ZSAqLyA6XG4gICAgICAgIHJldHVybiB0LnN0cmluZ1ZhbHVlID09PSBlLnN0cmluZ1ZhbHVlO1xuXG4gICAgICBjYXNlIDYgLyogQmxvYlZhbHVlICovIDpcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHQsIGUpIHtcbiAgICAgICAgICAgIHJldHVybiBBdCh0LmJ5dGVzVmFsdWUpLmlzRXF1YWwoQXQoZS5ieXRlc1ZhbHVlKSk7XG4gICAgICAgIH0odCwgZSk7XG5cbiAgICAgIGNhc2UgNyAvKiBSZWZWYWx1ZSAqLyA6XG4gICAgICAgIHJldHVybiB0LnJlZmVyZW5jZVZhbHVlID09PSBlLnJlZmVyZW5jZVZhbHVlO1xuXG4gICAgICBjYXNlIDggLyogR2VvUG9pbnRWYWx1ZSAqLyA6XG4gICAgICAgIHJldHVybiBmdW5jdGlvbih0LCBlKSB7XG4gICAgICAgICAgICByZXR1cm4gRXQodC5nZW9Qb2ludFZhbHVlLmxhdGl0dWRlKSA9PT0gRXQoZS5nZW9Qb2ludFZhbHVlLmxhdGl0dWRlKSAmJiBFdCh0Lmdlb1BvaW50VmFsdWUubG9uZ2l0dWRlKSA9PT0gRXQoZS5nZW9Qb2ludFZhbHVlLmxvbmdpdHVkZSk7XG4gICAgICAgIH0odCwgZSk7XG5cbiAgICAgIGNhc2UgMiAvKiBOdW1iZXJWYWx1ZSAqLyA6XG4gICAgICAgIHJldHVybiBmdW5jdGlvbih0LCBlKSB7XG4gICAgICAgICAgICBpZiAoXCJpbnRlZ2VyVmFsdWVcIiBpbiB0ICYmIFwiaW50ZWdlclZhbHVlXCIgaW4gZSkgcmV0dXJuIEV0KHQuaW50ZWdlclZhbHVlKSA9PT0gRXQoZS5pbnRlZ2VyVmFsdWUpO1xuICAgICAgICAgICAgaWYgKFwiZG91YmxlVmFsdWVcIiBpbiB0ICYmIFwiZG91YmxlVmFsdWVcIiBpbiBlKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgbiA9IEV0KHQuZG91YmxlVmFsdWUpLCBzID0gRXQoZS5kb3VibGVWYWx1ZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG4gPT09IHMgPyBEdChuKSA9PT0gRHQocykgOiBpc05hTihuKSAmJiBpc05hTihzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiAhMTtcbiAgICAgICAgfSh0LCBlKTtcblxuICAgICAgY2FzZSA5IC8qIEFycmF5VmFsdWUgKi8gOlxuICAgICAgICByZXR1cm4gb3QodC5hcnJheVZhbHVlLnZhbHVlcyB8fCBbXSwgZS5hcnJheVZhbHVlLnZhbHVlcyB8fCBbXSwgT3QpO1xuXG4gICAgICBjYXNlIDEwIC8qIE9iamVjdFZhbHVlICovIDpcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHQsIGUpIHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSB0Lm1hcFZhbHVlLmZpZWxkcyB8fCB7fSwgcyA9IGUubWFwVmFsdWUuZmllbGRzIHx8IHt9O1xuICAgICAgICAgICAgaWYgKGh0KG4pICE9PSBodChzKSkgcmV0dXJuICExO1xuICAgICAgICAgICAgZm9yIChjb25zdCB0IGluIG4pIGlmIChuLmhhc093blByb3BlcnR5KHQpICYmICh2b2lkIDAgPT09IHNbdF0gfHwgIU90KG5bdF0sIHNbdF0pKSkgcmV0dXJuICExO1xuICAgICAgICAgICAgcmV0dXJuICEwO1xuICAgICAgICB9XG4gICAgICAgIC8qKiBSZXR1cm5zIHRydWUgaWYgdGhlIEFycmF5VmFsdWUgY29udGFpbnMgdGhlIHNwZWNpZmllZCBlbGVtZW50LiAqLyAodCwgZSk7XG5cbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJldHVybiBMKCk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBGdCh0LCBlKSB7XG4gICAgcmV0dXJuIHZvaWQgMCAhPT0gKHQudmFsdWVzIHx8IFtdKS5maW5kKCh0ID0+IE90KHQsIGUpKSk7XG59XG5cbmZ1bmN0aW9uICR0KHQsIGUpIHtcbiAgICBpZiAodCA9PT0gZSkgcmV0dXJuIDA7XG4gICAgY29uc3QgbiA9IE10KHQpLCBzID0gTXQoZSk7XG4gICAgaWYgKG4gIT09IHMpIHJldHVybiBydChuLCBzKTtcbiAgICBzd2l0Y2ggKG4pIHtcbiAgICAgIGNhc2UgMCAvKiBOdWxsVmFsdWUgKi8gOlxuICAgICAgY2FzZSA5MDA3MTk5MjU0NzQwOTkxIC8qIE1heFZhbHVlICovIDpcbiAgICAgICAgcmV0dXJuIDA7XG5cbiAgICAgIGNhc2UgMSAvKiBCb29sZWFuVmFsdWUgKi8gOlxuICAgICAgICByZXR1cm4gcnQodC5ib29sZWFuVmFsdWUsIGUuYm9vbGVhblZhbHVlKTtcblxuICAgICAgY2FzZSAyIC8qIE51bWJlclZhbHVlICovIDpcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHQsIGUpIHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSBFdCh0LmludGVnZXJWYWx1ZSB8fCB0LmRvdWJsZVZhbHVlKSwgcyA9IEV0KGUuaW50ZWdlclZhbHVlIHx8IGUuZG91YmxlVmFsdWUpO1xuICAgICAgICAgICAgcmV0dXJuIG4gPCBzID8gLTEgOiBuID4gcyA/IDEgOiBuID09PSBzID8gMCA6IFxuICAgICAgICAgICAgLy8gb25lIG9yIGJvdGggYXJlIE5hTi5cbiAgICAgICAgICAgIGlzTmFOKG4pID8gaXNOYU4ocykgPyAwIDogLTEgOiAxO1xuICAgICAgICB9KHQsIGUpO1xuXG4gICAgICBjYXNlIDMgLyogVGltZXN0YW1wVmFsdWUgKi8gOlxuICAgICAgICByZXR1cm4gQnQodC50aW1lc3RhbXBWYWx1ZSwgZS50aW1lc3RhbXBWYWx1ZSk7XG5cbiAgICAgIGNhc2UgNCAvKiBTZXJ2ZXJUaW1lc3RhbXBWYWx1ZSAqLyA6XG4gICAgICAgIHJldHVybiBCdChQdCh0KSwgUHQoZSkpO1xuXG4gICAgICBjYXNlIDUgLyogU3RyaW5nVmFsdWUgKi8gOlxuICAgICAgICByZXR1cm4gcnQodC5zdHJpbmdWYWx1ZSwgZS5zdHJpbmdWYWx1ZSk7XG5cbiAgICAgIGNhc2UgNiAvKiBCbG9iVmFsdWUgKi8gOlxuICAgICAgICByZXR1cm4gZnVuY3Rpb24odCwgZSkge1xuICAgICAgICAgICAgY29uc3QgbiA9IEF0KHQpLCBzID0gQXQoZSk7XG4gICAgICAgICAgICByZXR1cm4gbi5jb21wYXJlVG8ocyk7XG4gICAgICAgIH0odC5ieXRlc1ZhbHVlLCBlLmJ5dGVzVmFsdWUpO1xuXG4gICAgICBjYXNlIDcgLyogUmVmVmFsdWUgKi8gOlxuICAgICAgICByZXR1cm4gZnVuY3Rpb24odCwgZSkge1xuICAgICAgICAgICAgY29uc3QgbiA9IHQuc3BsaXQoXCIvXCIpLCBzID0gZS5zcGxpdChcIi9cIik7XG4gICAgICAgICAgICBmb3IgKGxldCB0ID0gMDsgdCA8IG4ubGVuZ3RoICYmIHQgPCBzLmxlbmd0aDsgdCsrKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZSA9IHJ0KG5bdF0sIHNbdF0pO1xuICAgICAgICAgICAgICAgIGlmICgwICE9PSBlKSByZXR1cm4gZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBydChuLmxlbmd0aCwgcy5sZW5ndGgpO1xuICAgICAgICB9KHQucmVmZXJlbmNlVmFsdWUsIGUucmVmZXJlbmNlVmFsdWUpO1xuXG4gICAgICBjYXNlIDggLyogR2VvUG9pbnRWYWx1ZSAqLyA6XG4gICAgICAgIHJldHVybiBmdW5jdGlvbih0LCBlKSB7XG4gICAgICAgICAgICBjb25zdCBuID0gcnQoRXQodC5sYXRpdHVkZSksIEV0KGUubGF0aXR1ZGUpKTtcbiAgICAgICAgICAgIGlmICgwICE9PSBuKSByZXR1cm4gbjtcbiAgICAgICAgICAgIHJldHVybiBydChFdCh0LmxvbmdpdHVkZSksIEV0KGUubG9uZ2l0dWRlKSk7XG4gICAgICAgIH0odC5nZW9Qb2ludFZhbHVlLCBlLmdlb1BvaW50VmFsdWUpO1xuXG4gICAgICBjYXNlIDkgLyogQXJyYXlWYWx1ZSAqLyA6XG4gICAgICAgIHJldHVybiBmdW5jdGlvbih0LCBlKSB7XG4gICAgICAgICAgICBjb25zdCBuID0gdC52YWx1ZXMgfHwgW10sIHMgPSBlLnZhbHVlcyB8fCBbXTtcbiAgICAgICAgICAgIGZvciAobGV0IHQgPSAwOyB0IDwgbi5sZW5ndGggJiYgdCA8IHMubGVuZ3RoOyArK3QpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBlID0gJHQoblt0XSwgc1t0XSk7XG4gICAgICAgICAgICAgICAgaWYgKGUpIHJldHVybiBlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHJ0KG4ubGVuZ3RoLCBzLmxlbmd0aCk7XG4gICAgICAgIH0odC5hcnJheVZhbHVlLCBlLmFycmF5VmFsdWUpO1xuXG4gICAgICBjYXNlIDEwIC8qIE9iamVjdFZhbHVlICovIDpcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHQsIGUpIHtcbiAgICAgICAgICAgIGlmICh0ID09PSBOdC5tYXBWYWx1ZSAmJiBlID09PSBOdC5tYXBWYWx1ZSkgcmV0dXJuIDA7XG4gICAgICAgICAgICBpZiAodCA9PT0gTnQubWFwVmFsdWUpIHJldHVybiAxO1xuICAgICAgICAgICAgaWYgKGUgPT09IE50Lm1hcFZhbHVlKSByZXR1cm4gLTE7XG4gICAgICAgICAgICBjb25zdCBuID0gdC5maWVsZHMgfHwge30sIHMgPSBPYmplY3Qua2V5cyhuKSwgaSA9IGUuZmllbGRzIHx8IHt9LCByID0gT2JqZWN0LmtleXMoaSk7XG4gICAgICAgICAgICAvLyBFdmVuIHRob3VnaCBNYXBWYWx1ZXMgYXJlIGxpa2VseSBzb3J0ZWQgY29ycmVjdGx5IGJhc2VkIG9uIHRoZWlyIGluc2VydGlvblxuICAgICAgICAgICAgLy8gb3JkZXIgKGUuZy4gd2hlbiByZWNlaXZlZCBmcm9tIHRoZSBiYWNrZW5kKSwgbG9jYWwgbW9kaWZpY2F0aW9ucyBjYW4gYnJpbmdcbiAgICAgICAgICAgIC8vIGVsZW1lbnRzIG91dCBvZiBvcmRlci4gV2UgbmVlZCB0byByZS1zb3J0IHRoZSBlbGVtZW50cyB0byBlbnN1cmUgdGhhdFxuICAgICAgICAgICAgLy8gY2Fub25pY2FsIElEcyBhcmUgaW5kZXBlbmRlbnQgb2YgaW5zZXJ0aW9uIG9yZGVyLlxuICAgICAgICAgICAgcy5zb3J0KCksIHIuc29ydCgpO1xuICAgICAgICAgICAgZm9yIChsZXQgdCA9IDA7IHQgPCBzLmxlbmd0aCAmJiB0IDwgci5sZW5ndGg7ICsrdCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGUgPSBydChzW3RdLCByW3RdKTtcbiAgICAgICAgICAgICAgICBpZiAoMCAhPT0gZSkgcmV0dXJuIGU7XG4gICAgICAgICAgICAgICAgY29uc3QgbyA9ICR0KG5bc1t0XV0sIGlbclt0XV0pO1xuICAgICAgICAgICAgICAgIGlmICgwICE9PSBvKSByZXR1cm4gbztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBydChzLmxlbmd0aCwgci5sZW5ndGgpO1xuICAgICAgICB9XG4gICAgICAgIC8qKlxuICogR2VuZXJhdGVzIHRoZSBjYW5vbmljYWwgSUQgZm9yIHRoZSBwcm92aWRlZCBmaWVsZCB2YWx1ZSAoYXMgdXNlZCBpbiBUYXJnZXRcbiAqIHNlcmlhbGl6YXRpb24pLlxuICovICh0Lm1hcFZhbHVlLCBlLm1hcFZhbHVlKTtcblxuICAgICAgZGVmYXVsdDpcbiAgICAgICAgdGhyb3cgTCgpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gQnQodCwgZSkge1xuICAgIGlmIChcInN0cmluZ1wiID09IHR5cGVvZiB0ICYmIFwic3RyaW5nXCIgPT0gdHlwZW9mIGUgJiYgdC5sZW5ndGggPT09IGUubGVuZ3RoKSByZXR1cm4gcnQodCwgZSk7XG4gICAgY29uc3QgbiA9IFR0KHQpLCBzID0gVHQoZSksIGkgPSBydChuLnNlY29uZHMsIHMuc2Vjb25kcyk7XG4gICAgcmV0dXJuIDAgIT09IGkgPyBpIDogcnQobi5uYW5vcywgcy5uYW5vcyk7XG59XG5cbmZ1bmN0aW9uIEx0KHQpIHtcbiAgICByZXR1cm4gVXQodCk7XG59XG5cbmZ1bmN0aW9uIFV0KHQpIHtcbiAgICByZXR1cm4gXCJudWxsVmFsdWVcIiBpbiB0ID8gXCJudWxsXCIgOiBcImJvb2xlYW5WYWx1ZVwiIGluIHQgPyBcIlwiICsgdC5ib29sZWFuVmFsdWUgOiBcImludGVnZXJWYWx1ZVwiIGluIHQgPyBcIlwiICsgdC5pbnRlZ2VyVmFsdWUgOiBcImRvdWJsZVZhbHVlXCIgaW4gdCA/IFwiXCIgKyB0LmRvdWJsZVZhbHVlIDogXCJ0aW1lc3RhbXBWYWx1ZVwiIGluIHQgPyBmdW5jdGlvbih0KSB7XG4gICAgICAgIGNvbnN0IGUgPSBUdCh0KTtcbiAgICAgICAgcmV0dXJuIGB0aW1lKCR7ZS5zZWNvbmRzfSwke2UubmFub3N9KWA7XG4gICAgfSh0LnRpbWVzdGFtcFZhbHVlKSA6IFwic3RyaW5nVmFsdWVcIiBpbiB0ID8gdC5zdHJpbmdWYWx1ZSA6IFwiYnl0ZXNWYWx1ZVwiIGluIHQgPyBBdCh0LmJ5dGVzVmFsdWUpLnRvQmFzZTY0KCkgOiBcInJlZmVyZW5jZVZhbHVlXCIgaW4gdCA/IChuID0gdC5yZWZlcmVuY2VWYWx1ZSwgXG4gICAgeHQuZnJvbU5hbWUobikudG9TdHJpbmcoKSkgOiBcImdlb1BvaW50VmFsdWVcIiBpbiB0ID8gYGdlbygkeyhlID0gdC5nZW9Qb2ludFZhbHVlKS5sYXRpdHVkZX0sJHtlLmxvbmdpdHVkZX0pYCA6IFwiYXJyYXlWYWx1ZVwiIGluIHQgPyBmdW5jdGlvbih0KSB7XG4gICAgICAgIGxldCBlID0gXCJbXCIsIG4gPSAhMDtcbiAgICAgICAgZm9yIChjb25zdCBzIG9mIHQudmFsdWVzIHx8IFtdKSBuID8gbiA9ICExIDogZSArPSBcIixcIiwgZSArPSBVdChzKTtcbiAgICAgICAgcmV0dXJuIGUgKyBcIl1cIjtcbiAgICB9XG4gICAgLyoqIFJldHVybnMgYSByZWZlcmVuY2UgdmFsdWUgZm9yIHRoZSBwcm92aWRlZCBkYXRhYmFzZSBhbmQga2V5LiAqLyAodC5hcnJheVZhbHVlKSA6IFwibWFwVmFsdWVcIiBpbiB0ID8gZnVuY3Rpb24odCkge1xuICAgICAgICAvLyBJdGVyYXRpb24gb3JkZXIgaW4gSmF2YVNjcmlwdCBpcyBub3QgZ3VhcmFudGVlZC4gVG8gZW5zdXJlIHRoYXQgd2UgZ2VuZXJhdGVcbiAgICAgICAgLy8gbWF0Y2hpbmcgY2Fub25pY2FsIElEcyBmb3IgaWRlbnRpY2FsIG1hcHMsIHdlIG5lZWQgdG8gc29ydCB0aGUga2V5cy5cbiAgICAgICAgY29uc3QgZSA9IE9iamVjdC5rZXlzKHQuZmllbGRzIHx8IHt9KS5zb3J0KCk7XG4gICAgICAgIGxldCBuID0gXCJ7XCIsIHMgPSAhMDtcbiAgICAgICAgZm9yIChjb25zdCBpIG9mIGUpIHMgPyBzID0gITEgOiBuICs9IFwiLFwiLCBuICs9IGAke2l9OiR7VXQodC5maWVsZHNbaV0pfWA7XG4gICAgICAgIHJldHVybiBuICsgXCJ9XCI7XG4gICAgfSh0Lm1hcFZhbHVlKSA6IEwoKTtcbiAgICB2YXIgZSwgbjtcbn1cblxuZnVuY3Rpb24gcXQodCwgZSkge1xuICAgIHJldHVybiB7XG4gICAgICAgIHJlZmVyZW5jZVZhbHVlOiBgcHJvamVjdHMvJHt0LnByb2plY3RJZH0vZGF0YWJhc2VzLyR7dC5kYXRhYmFzZX0vZG9jdW1lbnRzLyR7ZS5wYXRoLmNhbm9uaWNhbFN0cmluZygpfWBcbiAgICB9O1xufVxuXG4vKiogUmV0dXJucyB0cnVlIGlmIGB2YWx1ZWAgaXMgYW4gSW50ZWdlclZhbHVlIC4gKi8gZnVuY3Rpb24gS3QodCkge1xuICAgIHJldHVybiAhIXQgJiYgXCJpbnRlZ2VyVmFsdWVcIiBpbiB0O1xufVxuXG4vKiogUmV0dXJucyB0cnVlIGlmIGB2YWx1ZWAgaXMgYSBEb3VibGVWYWx1ZS4gKi9cbi8qKiBSZXR1cm5zIHRydWUgaWYgYHZhbHVlYCBpcyBhbiBBcnJheVZhbHVlLiAqL1xuZnVuY3Rpb24gR3QodCkge1xuICAgIHJldHVybiAhIXQgJiYgXCJhcnJheVZhbHVlXCIgaW4gdDtcbn1cblxuLyoqIFJldHVybnMgdHJ1ZSBpZiBgdmFsdWVgIGlzIGEgTnVsbFZhbHVlLiAqLyBmdW5jdGlvbiBRdCh0KSB7XG4gICAgcmV0dXJuICEhdCAmJiBcIm51bGxWYWx1ZVwiIGluIHQ7XG59XG5cbi8qKiBSZXR1cm5zIHRydWUgaWYgYHZhbHVlYCBpcyBOYU4uICovIGZ1bmN0aW9uIGp0KHQpIHtcbiAgICByZXR1cm4gISF0ICYmIFwiZG91YmxlVmFsdWVcIiBpbiB0ICYmIGlzTmFOKE51bWJlcih0LmRvdWJsZVZhbHVlKSk7XG59XG5cbi8qKiBSZXR1cm5zIHRydWUgaWYgYHZhbHVlYCBpcyBhIE1hcFZhbHVlLiAqLyBmdW5jdGlvbiBXdCh0KSB7XG4gICAgcmV0dXJuICEhdCAmJiBcIm1hcFZhbHVlXCIgaW4gdDtcbn1cblxuLyoqIENyZWF0ZXMgYSBkZWVwIGNvcHkgb2YgYHNvdXJjZWAuICovIGZ1bmN0aW9uIHp0KHQpIHtcbiAgICBpZiAodC5nZW9Qb2ludFZhbHVlKSByZXR1cm4ge1xuICAgICAgICBnZW9Qb2ludFZhbHVlOiBPYmplY3QuYXNzaWduKHt9LCB0Lmdlb1BvaW50VmFsdWUpXG4gICAgfTtcbiAgICBpZiAodC50aW1lc3RhbXBWYWx1ZSAmJiBcIm9iamVjdFwiID09IHR5cGVvZiB0LnRpbWVzdGFtcFZhbHVlKSByZXR1cm4ge1xuICAgICAgICB0aW1lc3RhbXBWYWx1ZTogT2JqZWN0LmFzc2lnbih7fSwgdC50aW1lc3RhbXBWYWx1ZSlcbiAgICB9O1xuICAgIGlmICh0Lm1hcFZhbHVlKSB7XG4gICAgICAgIGNvbnN0IGUgPSB7XG4gICAgICAgICAgICBtYXBWYWx1ZToge1xuICAgICAgICAgICAgICAgIGZpZWxkczoge31cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIGx0KHQubWFwVmFsdWUuZmllbGRzLCAoKHQsIG4pID0+IGUubWFwVmFsdWUuZmllbGRzW3RdID0genQobikpKSwgZTtcbiAgICB9XG4gICAgaWYgKHQuYXJyYXlWYWx1ZSkge1xuICAgICAgICBjb25zdCBlID0ge1xuICAgICAgICAgICAgYXJyYXlWYWx1ZToge1xuICAgICAgICAgICAgICAgIHZhbHVlczogW11cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgZm9yIChsZXQgbiA9IDA7IG4gPCAodC5hcnJheVZhbHVlLnZhbHVlcyB8fCBbXSkubGVuZ3RoOyArK24pIGUuYXJyYXlWYWx1ZS52YWx1ZXNbbl0gPSB6dCh0LmFycmF5VmFsdWUudmFsdWVzW25dKTtcbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfVxuICAgIHJldHVybiBPYmplY3QuYXNzaWduKHt9LCB0KTtcbn1cblxuLyoqIFJldHVybnMgdHJ1ZSBpZiB0aGUgVmFsdWUgcmVwcmVzZW50cyB0aGUgY2Fub25pY2FsIHtAbGluayAjTUFYX1ZBTFVFfSAuICovIGZ1bmN0aW9uIEh0KHQpIHtcbiAgICByZXR1cm4gXCJfX21heF9fXCIgPT09ICgoKHQubWFwVmFsdWUgfHwge30pLmZpZWxkcyB8fCB7fSkuX190eXBlX18gfHwge30pLnN0cmluZ1ZhbHVlO1xufVxuXG4vKiogUmV0dXJucyB0aGUgbG93ZXN0IHZhbHVlIGZvciB0aGUgZ2l2ZW4gdmFsdWUgdHlwZSAoaW5jbHVzaXZlKS4gKi8gZnVuY3Rpb24gSnQodCkge1xuICAgIHJldHVybiBcIm51bGxWYWx1ZVwiIGluIHQgPyBrdCA6IFwiYm9vbGVhblZhbHVlXCIgaW4gdCA/IHtcbiAgICAgICAgYm9vbGVhblZhbHVlOiAhMVxuICAgIH0gOiBcImludGVnZXJWYWx1ZVwiIGluIHQgfHwgXCJkb3VibGVWYWx1ZVwiIGluIHQgPyB7XG4gICAgICAgIGRvdWJsZVZhbHVlOiBOYU5cbiAgICB9IDogXCJ0aW1lc3RhbXBWYWx1ZVwiIGluIHQgPyB7XG4gICAgICAgIHRpbWVzdGFtcFZhbHVlOiB7XG4gICAgICAgICAgICBzZWNvbmRzOiBOdW1iZXIuTUlOX1NBRkVfSU5URUdFUlxuICAgICAgICB9XG4gICAgfSA6IFwic3RyaW5nVmFsdWVcIiBpbiB0ID8ge1xuICAgICAgICBzdHJpbmdWYWx1ZTogXCJcIlxuICAgIH0gOiBcImJ5dGVzVmFsdWVcIiBpbiB0ID8ge1xuICAgICAgICBieXRlc1ZhbHVlOiBcIlwiXG4gICAgfSA6IFwicmVmZXJlbmNlVmFsdWVcIiBpbiB0ID8gcXQodnQuZW1wdHkoKSwgeHQuZW1wdHkoKSkgOiBcImdlb1BvaW50VmFsdWVcIiBpbiB0ID8ge1xuICAgICAgICBnZW9Qb2ludFZhbHVlOiB7XG4gICAgICAgICAgICBsYXRpdHVkZTogLTkwLFxuICAgICAgICAgICAgbG9uZ2l0dWRlOiAtMTgwXG4gICAgICAgIH1cbiAgICB9IDogXCJhcnJheVZhbHVlXCIgaW4gdCA/IHtcbiAgICAgICAgYXJyYXlWYWx1ZToge31cbiAgICB9IDogXCJtYXBWYWx1ZVwiIGluIHQgPyB7XG4gICAgICAgIG1hcFZhbHVlOiB7fVxuICAgIH0gOiBMKCk7XG59XG5cbi8qKiBSZXR1cm5zIHRoZSBsYXJnZXN0IHZhbHVlIGZvciB0aGUgZ2l2ZW4gdmFsdWUgdHlwZSAoZXhjbHVzaXZlKS4gKi8gZnVuY3Rpb24gWXQodCkge1xuICAgIHJldHVybiBcIm51bGxWYWx1ZVwiIGluIHQgPyB7XG4gICAgICAgIGJvb2xlYW5WYWx1ZTogITFcbiAgICB9IDogXCJib29sZWFuVmFsdWVcIiBpbiB0ID8ge1xuICAgICAgICBkb3VibGVWYWx1ZTogTmFOXG4gICAgfSA6IFwiaW50ZWdlclZhbHVlXCIgaW4gdCB8fCBcImRvdWJsZVZhbHVlXCIgaW4gdCA/IHtcbiAgICAgICAgdGltZXN0YW1wVmFsdWU6IHtcbiAgICAgICAgICAgIHNlY29uZHM6IE51bWJlci5NSU5fU0FGRV9JTlRFR0VSXG4gICAgICAgIH1cbiAgICB9IDogXCJ0aW1lc3RhbXBWYWx1ZVwiIGluIHQgPyB7XG4gICAgICAgIHN0cmluZ1ZhbHVlOiBcIlwiXG4gICAgfSA6IFwic3RyaW5nVmFsdWVcIiBpbiB0ID8ge1xuICAgICAgICBieXRlc1ZhbHVlOiBcIlwiXG4gICAgfSA6IFwiYnl0ZXNWYWx1ZVwiIGluIHQgPyBxdCh2dC5lbXB0eSgpLCB4dC5lbXB0eSgpKSA6IFwicmVmZXJlbmNlVmFsdWVcIiBpbiB0ID8ge1xuICAgICAgICBnZW9Qb2ludFZhbHVlOiB7XG4gICAgICAgICAgICBsYXRpdHVkZTogLTkwLFxuICAgICAgICAgICAgbG9uZ2l0dWRlOiAtMTgwXG4gICAgICAgIH1cbiAgICB9IDogXCJnZW9Qb2ludFZhbHVlXCIgaW4gdCA/IHtcbiAgICAgICAgYXJyYXlWYWx1ZToge31cbiAgICB9IDogXCJhcnJheVZhbHVlXCIgaW4gdCA/IHtcbiAgICAgICAgbWFwVmFsdWU6IHt9XG4gICAgfSA6IFwibWFwVmFsdWVcIiBpbiB0ID8gTnQgOiBMKCk7XG59XG5cbmZ1bmN0aW9uIFh0KHQsIGUpIHtcbiAgICBjb25zdCBuID0gJHQodC52YWx1ZSwgZS52YWx1ZSk7XG4gICAgcmV0dXJuIDAgIT09IG4gPyBuIDogdC5pbmNsdXNpdmUgJiYgIWUuaW5jbHVzaXZlID8gLTEgOiAhdC5pbmNsdXNpdmUgJiYgZS5pbmNsdXNpdmUgPyAxIDogMDtcbn1cblxuZnVuY3Rpb24gWnQodCwgZSkge1xuICAgIGNvbnN0IG4gPSAkdCh0LnZhbHVlLCBlLnZhbHVlKTtcbiAgICByZXR1cm4gMCAhPT0gbiA/IG4gOiB0LmluY2x1c2l2ZSAmJiAhZS5pbmNsdXNpdmUgPyAxIDogIXQuaW5jbHVzaXZlICYmIGUuaW5jbHVzaXZlID8gLTEgOiAwO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBBbiBPYmplY3RWYWx1ZSByZXByZXNlbnRzIGEgTWFwVmFsdWUgaW4gdGhlIEZpcmVzdG9yZSBQcm90byBhbmQgb2ZmZXJzIHRoZVxuICogYWJpbGl0eSB0byBhZGQgYW5kIHJlbW92ZSBmaWVsZHMgKHZpYSB0aGUgT2JqZWN0VmFsdWVCdWlsZGVyKS5cbiAqLyBjbGFzcyB0ZSB7XG4gICAgY29uc3RydWN0b3IodCkge1xuICAgICAgICB0aGlzLnZhbHVlID0gdDtcbiAgICB9XG4gICAgc3RhdGljIGVtcHR5KCkge1xuICAgICAgICByZXR1cm4gbmV3IHRlKHtcbiAgICAgICAgICAgIG1hcFZhbHVlOiB7fVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0aGUgdmFsdWUgYXQgdGhlIGdpdmVuIHBhdGggb3IgbnVsbC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBwYXRoIC0gdGhlIHBhdGggdG8gc2VhcmNoXG4gICAgICogQHJldHVybnMgVGhlIHZhbHVlIGF0IHRoZSBwYXRoIG9yIG51bGwgaWYgdGhlIHBhdGggaXMgbm90IHNldC5cbiAgICAgKi8gICAgZmllbGQodCkge1xuICAgICAgICBpZiAodC5pc0VtcHR5KCkpIHJldHVybiB0aGlzLnZhbHVlO1xuICAgICAgICB7XG4gICAgICAgICAgICBsZXQgZSA9IHRoaXMudmFsdWU7XG4gICAgICAgICAgICBmb3IgKGxldCBuID0gMDsgbiA8IHQubGVuZ3RoIC0gMTsgKytuKSBpZiAoZSA9IChlLm1hcFZhbHVlLmZpZWxkcyB8fCB7fSlbdC5nZXQobildLCBcbiAgICAgICAgICAgICFXdChlKSkgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICByZXR1cm4gZSA9IChlLm1hcFZhbHVlLmZpZWxkcyB8fCB7fSlbdC5sYXN0U2VnbWVudCgpXSwgZSB8fCBudWxsO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFNldHMgdGhlIGZpZWxkIHRvIHRoZSBwcm92aWRlZCB2YWx1ZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBwYXRoIC0gVGhlIGZpZWxkIHBhdGggdG8gc2V0LlxuICAgICAqIEBwYXJhbSB2YWx1ZSAtIFRoZSB2YWx1ZSB0byBzZXQuXG4gICAgICovICAgIHNldCh0LCBlKSB7XG4gICAgICAgIHRoaXMuZ2V0RmllbGRzTWFwKHQucG9wTGFzdCgpKVt0Lmxhc3RTZWdtZW50KCldID0genQoZSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFNldHMgdGhlIHByb3ZpZGVkIGZpZWxkcyB0byB0aGUgcHJvdmlkZWQgdmFsdWVzLlxuICAgICAqXG4gICAgICogQHBhcmFtIGRhdGEgLSBBIG1hcCBvZiBmaWVsZHMgdG8gdmFsdWVzIChvciBudWxsIGZvciBkZWxldGVzKS5cbiAgICAgKi8gICAgc2V0QWxsKHQpIHtcbiAgICAgICAgbGV0IGUgPSBtdC5lbXB0eVBhdGgoKSwgbiA9IHt9LCBzID0gW107XG4gICAgICAgIHQuZm9yRWFjaCgoKHQsIGkpID0+IHtcbiAgICAgICAgICAgIGlmICghZS5pc0ltbWVkaWF0ZVBhcmVudE9mKGkpKSB7XG4gICAgICAgICAgICAgICAgLy8gSW5zZXJ0IHRoZSBhY2N1bXVsYXRlZCBjaGFuZ2VzIGF0IHRoaXMgcGFyZW50IGxvY2F0aW9uXG4gICAgICAgICAgICAgICAgY29uc3QgdCA9IHRoaXMuZ2V0RmllbGRzTWFwKGUpO1xuICAgICAgICAgICAgICAgIHRoaXMuYXBwbHlDaGFuZ2VzKHQsIG4sIHMpLCBuID0ge30sIHMgPSBbXSwgZSA9IGkucG9wTGFzdCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdCA/IG5baS5sYXN0U2VnbWVudCgpXSA9IHp0KHQpIDogcy5wdXNoKGkubGFzdFNlZ21lbnQoKSk7XG4gICAgICAgIH0pKTtcbiAgICAgICAgY29uc3QgaSA9IHRoaXMuZ2V0RmllbGRzTWFwKGUpO1xuICAgICAgICB0aGlzLmFwcGx5Q2hhbmdlcyhpLCBuLCBzKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmVtb3ZlcyB0aGUgZmllbGQgYXQgdGhlIHNwZWNpZmllZCBwYXRoLiBJZiB0aGVyZSBpcyBubyBmaWVsZCBhdCB0aGVcbiAgICAgKiBzcGVjaWZpZWQgcGF0aCwgbm90aGluZyBpcyBjaGFuZ2VkLlxuICAgICAqXG4gICAgICogQHBhcmFtIHBhdGggLSBUaGUgZmllbGQgcGF0aCB0byByZW1vdmUuXG4gICAgICovICAgIGRlbGV0ZSh0KSB7XG4gICAgICAgIGNvbnN0IGUgPSB0aGlzLmZpZWxkKHQucG9wTGFzdCgpKTtcbiAgICAgICAgV3QoZSkgJiYgZS5tYXBWYWx1ZS5maWVsZHMgJiYgZGVsZXRlIGUubWFwVmFsdWUuZmllbGRzW3QubGFzdFNlZ21lbnQoKV07XG4gICAgfVxuICAgIGlzRXF1YWwodCkge1xuICAgICAgICByZXR1cm4gT3QodGhpcy52YWx1ZSwgdC52YWx1ZSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdGhlIG1hcCB0aGF0IGNvbnRhaW5zIHRoZSBsZWFmIGVsZW1lbnQgb2YgYHBhdGhgLiBJZiB0aGUgcGFyZW50XG4gICAgICogZW50cnkgZG9lcyBub3QgeWV0IGV4aXN0LCBvciBpZiBpdCBpcyBub3QgYSBtYXAsIGEgbmV3IG1hcCB3aWxsIGJlIGNyZWF0ZWQuXG4gICAgICovICAgIGdldEZpZWxkc01hcCh0KSB7XG4gICAgICAgIGxldCBlID0gdGhpcy52YWx1ZTtcbiAgICAgICAgZS5tYXBWYWx1ZS5maWVsZHMgfHwgKGUubWFwVmFsdWUgPSB7XG4gICAgICAgICAgICBmaWVsZHM6IHt9XG4gICAgICAgIH0pO1xuICAgICAgICBmb3IgKGxldCBuID0gMDsgbiA8IHQubGVuZ3RoOyArK24pIHtcbiAgICAgICAgICAgIGxldCBzID0gZS5tYXBWYWx1ZS5maWVsZHNbdC5nZXQobildO1xuICAgICAgICAgICAgV3QocykgJiYgcy5tYXBWYWx1ZS5maWVsZHMgfHwgKHMgPSB7XG4gICAgICAgICAgICAgICAgbWFwVmFsdWU6IHtcbiAgICAgICAgICAgICAgICAgICAgZmllbGRzOiB7fVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIGUubWFwVmFsdWUuZmllbGRzW3QuZ2V0KG4pXSA9IHMpLCBlID0gcztcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZS5tYXBWYWx1ZS5maWVsZHM7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIE1vZGlmaWVzIGBmaWVsZHNNYXBgIGJ5IGFkZGluZywgcmVwbGFjaW5nIG9yIGRlbGV0aW5nIHRoZSBzcGVjaWZpZWRcbiAgICAgKiBlbnRyaWVzLlxuICAgICAqLyAgICBhcHBseUNoYW5nZXModCwgZSwgbikge1xuICAgICAgICBsdChlLCAoKGUsIG4pID0+IHRbZV0gPSBuKSk7XG4gICAgICAgIGZvciAoY29uc3QgZSBvZiBuKSBkZWxldGUgdFtlXTtcbiAgICB9XG4gICAgY2xvbmUoKSB7XG4gICAgICAgIHJldHVybiBuZXcgdGUoenQodGhpcy52YWx1ZSkpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBSZXR1cm5zIGEgRmllbGRNYXNrIGJ1aWx0IGZyb20gYWxsIGZpZWxkcyBpbiBhIE1hcFZhbHVlLlxuICovIGZ1bmN0aW9uIGVlKHQpIHtcbiAgICBjb25zdCBlID0gW107XG4gICAgcmV0dXJuIGx0KHQuZmllbGRzLCAoKHQsIG4pID0+IHtcbiAgICAgICAgY29uc3QgcyA9IG5ldyBtdChbIHQgXSk7XG4gICAgICAgIGlmIChXdChuKSkge1xuICAgICAgICAgICAgY29uc3QgdCA9IGVlKG4ubWFwVmFsdWUpLmZpZWxkcztcbiAgICAgICAgICAgIGlmICgwID09PSB0Lmxlbmd0aCkgXG4gICAgICAgICAgICAvLyBQcmVzZXJ2ZSB0aGUgZW1wdHkgbWFwIGJ5IGFkZGluZyBpdCB0byB0aGUgRmllbGRNYXNrLlxuICAgICAgICAgICAgZS5wdXNoKHMpOyBlbHNlIFxuICAgICAgICAgICAgLy8gRm9yIG5lc3RlZCBhbmQgbm9uLWVtcHR5IE9iamVjdFZhbHVlcywgYWRkIHRoZSBGaWVsZFBhdGggb2YgdGhlXG4gICAgICAgICAgICAvLyBsZWFmIG5vZGVzLlxuICAgICAgICAgICAgZm9yIChjb25zdCBuIG9mIHQpIGUucHVzaChzLmNoaWxkKG4pKTtcbiAgICAgICAgfSBlbHNlIFxuICAgICAgICAvLyBGb3IgbmVzdGVkIGFuZCBub24tZW1wdHkgT2JqZWN0VmFsdWVzLCBhZGQgdGhlIEZpZWxkUGF0aCBvZiB0aGUgbGVhZlxuICAgICAgICAvLyBub2Rlcy5cbiAgICAgICAgZS5wdXNoKHMpO1xuICAgIH0pKSwgbmV3IGd0KGUpO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBSZXByZXNlbnRzIGEgZG9jdW1lbnQgaW4gRmlyZXN0b3JlIHdpdGggYSBrZXksIHZlcnNpb24sIGRhdGEgYW5kIHdoZXRoZXIgaXRcbiAqIGhhcyBsb2NhbCBtdXRhdGlvbnMgYXBwbGllZCB0byBpdC5cbiAqXG4gKiBEb2N1bWVudHMgY2FuIHRyYW5zaXRpb24gYmV0d2VlbiBzdGF0ZXMgdmlhIGBjb252ZXJ0VG9Gb3VuZERvY3VtZW50KClgLFxuICogYGNvbnZlcnRUb05vRG9jdW1lbnQoKWAgYW5kIGBjb252ZXJ0VG9Vbmtub3duRG9jdW1lbnQoKWAuIElmIGEgZG9jdW1lbnQgZG9lc1xuICogbm90IHRyYW5zaXRpb24gdG8gb25lIG9mIHRoZXNlIHN0YXRlcyBldmVuIGFmdGVyIGFsbCBtdXRhdGlvbnMgaGF2ZSBiZWVuXG4gKiBhcHBsaWVkLCBgaXNWYWxpZERvY3VtZW50KClgIHJldHVybnMgZmFsc2UgYW5kIHRoZSBkb2N1bWVudCBzaG91bGQgYmUgcmVtb3ZlZFxuICogZnJvbSBhbGwgdmlld3MuXG4gKi8gY2xhc3MgbmUge1xuICAgIGNvbnN0cnVjdG9yKHQsIGUsIG4sIHMsIGksIHIpIHtcbiAgICAgICAgdGhpcy5rZXkgPSB0LCB0aGlzLmRvY3VtZW50VHlwZSA9IGUsIHRoaXMudmVyc2lvbiA9IG4sIHRoaXMucmVhZFRpbWUgPSBzLCB0aGlzLmRhdGEgPSBpLCBcbiAgICAgICAgdGhpcy5kb2N1bWVudFN0YXRlID0gcjtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIGRvY3VtZW50IHdpdGggbm8ga25vd24gdmVyc2lvbiBvciBkYXRhLCBidXQgd2hpY2ggY2FuIHNlcnZlIGFzXG4gICAgICogYmFzZSBkb2N1bWVudCBmb3IgbXV0YXRpb25zLlxuICAgICAqLyAgICBzdGF0aWMgbmV3SW52YWxpZERvY3VtZW50KHQpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBuZSh0LCAwIC8qIElOVkFMSUQgKi8gLCBjdC5taW4oKSwgY3QubWluKCksIHRlLmVtcHR5KCksIDAgLyogU1lOQ0VEICovKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIG5ldyBkb2N1bWVudCB0aGF0IGlzIGtub3duIHRvIGV4aXN0IHdpdGggdGhlIGdpdmVuIGRhdGEgYXQgdGhlXG4gICAgICogZ2l2ZW4gdmVyc2lvbi5cbiAgICAgKi8gICAgc3RhdGljIG5ld0ZvdW5kRG9jdW1lbnQodCwgZSwgbikge1xuICAgICAgICByZXR1cm4gbmV3IG5lKHQsIDEgLyogRk9VTkRfRE9DVU1FTlQgKi8gLCBlLCBjdC5taW4oKSwgbiwgMCAvKiBTWU5DRUQgKi8pO1xuICAgIH1cbiAgICAvKiogQ3JlYXRlcyBhIG5ldyBkb2N1bWVudCB0aGF0IGlzIGtub3duIHRvIG5vdCBleGlzdCBhdCB0aGUgZ2l2ZW4gdmVyc2lvbi4gKi8gICAgc3RhdGljIG5ld05vRG9jdW1lbnQodCwgZSkge1xuICAgICAgICByZXR1cm4gbmV3IG5lKHQsIDIgLyogTk9fRE9DVU1FTlQgKi8gLCBlLCBjdC5taW4oKSwgdGUuZW1wdHkoKSwgMCAvKiBTWU5DRUQgKi8pO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgbmV3IGRvY3VtZW50IHRoYXQgaXMga25vd24gdG8gZXhpc3QgYXQgdGhlIGdpdmVuIHZlcnNpb24gYnV0XG4gICAgICogd2hvc2UgZGF0YSBpcyBub3Qga25vd24gKGUuZy4gYSBkb2N1bWVudCB0aGF0IHdhcyB1cGRhdGVkIHdpdGhvdXQgYSBrbm93blxuICAgICAqIGJhc2UgZG9jdW1lbnQpLlxuICAgICAqLyAgICBzdGF0aWMgbmV3VW5rbm93bkRvY3VtZW50KHQsIGUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBuZSh0LCAzIC8qIFVOS05PV05fRE9DVU1FTlQgKi8gLCBlLCBjdC5taW4oKSwgdGUuZW1wdHkoKSwgMiAvKiBIQVNfQ09NTUlUVEVEX01VVEFUSU9OUyAqLyk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENoYW5nZXMgdGhlIGRvY3VtZW50IHR5cGUgdG8gaW5kaWNhdGUgdGhhdCBpdCBleGlzdHMgYW5kIHRoYXQgaXRzIHZlcnNpb25cbiAgICAgKiBhbmQgZGF0YSBhcmUga25vd24uXG4gICAgICovICAgIGNvbnZlcnRUb0ZvdW5kRG9jdW1lbnQodCwgZSkge1xuICAgICAgICByZXR1cm4gdGhpcy52ZXJzaW9uID0gdCwgdGhpcy5kb2N1bWVudFR5cGUgPSAxIC8qIEZPVU5EX0RPQ1VNRU5UICovICwgdGhpcy5kYXRhID0gZSwgXG4gICAgICAgIHRoaXMuZG9jdW1lbnRTdGF0ZSA9IDAgLyogU1lOQ0VEICovICwgdGhpcztcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ2hhbmdlcyB0aGUgZG9jdW1lbnQgdHlwZSB0byBpbmRpY2F0ZSB0aGF0IGl0IGRvZXNuJ3QgZXhpc3QgYXQgdGhlIGdpdmVuXG4gICAgICogdmVyc2lvbi5cbiAgICAgKi8gICAgY29udmVydFRvTm9Eb2N1bWVudCh0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLnZlcnNpb24gPSB0LCB0aGlzLmRvY3VtZW50VHlwZSA9IDIgLyogTk9fRE9DVU1FTlQgKi8gLCB0aGlzLmRhdGEgPSB0ZS5lbXB0eSgpLCBcbiAgICAgICAgdGhpcy5kb2N1bWVudFN0YXRlID0gMCAvKiBTWU5DRUQgKi8gLCB0aGlzO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDaGFuZ2VzIHRoZSBkb2N1bWVudCB0eXBlIHRvIGluZGljYXRlIHRoYXQgaXQgZXhpc3RzIGF0IGEgZ2l2ZW4gdmVyc2lvbiBidXRcbiAgICAgKiB0aGF0IGl0cyBkYXRhIGlzIG5vdCBrbm93biAoZS5nLiBhIGRvY3VtZW50IHRoYXQgd2FzIHVwZGF0ZWQgd2l0aG91dCBhIGtub3duXG4gICAgICogYmFzZSBkb2N1bWVudCkuXG4gICAgICovICAgIGNvbnZlcnRUb1Vua25vd25Eb2N1bWVudCh0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLnZlcnNpb24gPSB0LCB0aGlzLmRvY3VtZW50VHlwZSA9IDMgLyogVU5LTk9XTl9ET0NVTUVOVCAqLyAsIHRoaXMuZGF0YSA9IHRlLmVtcHR5KCksIFxuICAgICAgICB0aGlzLmRvY3VtZW50U3RhdGUgPSAyIC8qIEhBU19DT01NSVRURURfTVVUQVRJT05TICovICwgdGhpcztcbiAgICB9XG4gICAgc2V0SGFzQ29tbWl0dGVkTXV0YXRpb25zKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5kb2N1bWVudFN0YXRlID0gMiAvKiBIQVNfQ09NTUlUVEVEX01VVEFUSU9OUyAqLyAsIHRoaXM7XG4gICAgfVxuICAgIHNldEhhc0xvY2FsTXV0YXRpb25zKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5kb2N1bWVudFN0YXRlID0gMSAvKiBIQVNfTE9DQUxfTVVUQVRJT05TICovICwgdGhpcztcbiAgICB9XG4gICAgc2V0UmVhZFRpbWUodCkge1xuICAgICAgICByZXR1cm4gdGhpcy5yZWFkVGltZSA9IHQsIHRoaXM7XG4gICAgfVxuICAgIGdldCBoYXNMb2NhbE11dGF0aW9ucygpIHtcbiAgICAgICAgcmV0dXJuIDEgLyogSEFTX0xPQ0FMX01VVEFUSU9OUyAqLyA9PT0gdGhpcy5kb2N1bWVudFN0YXRlO1xuICAgIH1cbiAgICBnZXQgaGFzQ29tbWl0dGVkTXV0YXRpb25zKCkge1xuICAgICAgICByZXR1cm4gMiAvKiBIQVNfQ09NTUlUVEVEX01VVEFUSU9OUyAqLyA9PT0gdGhpcy5kb2N1bWVudFN0YXRlO1xuICAgIH1cbiAgICBnZXQgaGFzUGVuZGluZ1dyaXRlcygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaGFzTG9jYWxNdXRhdGlvbnMgfHwgdGhpcy5oYXNDb21taXR0ZWRNdXRhdGlvbnM7XG4gICAgfVxuICAgIGlzVmFsaWREb2N1bWVudCgpIHtcbiAgICAgICAgcmV0dXJuIDAgLyogSU5WQUxJRCAqLyAhPT0gdGhpcy5kb2N1bWVudFR5cGU7XG4gICAgfVxuICAgIGlzRm91bmREb2N1bWVudCgpIHtcbiAgICAgICAgcmV0dXJuIDEgLyogRk9VTkRfRE9DVU1FTlQgKi8gPT09IHRoaXMuZG9jdW1lbnRUeXBlO1xuICAgIH1cbiAgICBpc05vRG9jdW1lbnQoKSB7XG4gICAgICAgIHJldHVybiAyIC8qIE5PX0RPQ1VNRU5UICovID09PSB0aGlzLmRvY3VtZW50VHlwZTtcbiAgICB9XG4gICAgaXNVbmtub3duRG9jdW1lbnQoKSB7XG4gICAgICAgIHJldHVybiAzIC8qIFVOS05PV05fRE9DVU1FTlQgKi8gPT09IHRoaXMuZG9jdW1lbnRUeXBlO1xuICAgIH1cbiAgICBpc0VxdWFsKHQpIHtcbiAgICAgICAgcmV0dXJuIHQgaW5zdGFuY2VvZiBuZSAmJiB0aGlzLmtleS5pc0VxdWFsKHQua2V5KSAmJiB0aGlzLnZlcnNpb24uaXNFcXVhbCh0LnZlcnNpb24pICYmIHRoaXMuZG9jdW1lbnRUeXBlID09PSB0LmRvY3VtZW50VHlwZSAmJiB0aGlzLmRvY3VtZW50U3RhdGUgPT09IHQuZG9jdW1lbnRTdGF0ZSAmJiB0aGlzLmRhdGEuaXNFcXVhbCh0LmRhdGEpO1xuICAgIH1cbiAgICBtdXRhYmxlQ29weSgpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBuZSh0aGlzLmtleSwgdGhpcy5kb2N1bWVudFR5cGUsIHRoaXMudmVyc2lvbiwgdGhpcy5yZWFkVGltZSwgdGhpcy5kYXRhLmNsb25lKCksIHRoaXMuZG9jdW1lbnRTdGF0ZSk7XG4gICAgfVxuICAgIHRvU3RyaW5nKCkge1xuICAgICAgICByZXR1cm4gYERvY3VtZW50KCR7dGhpcy5rZXl9LCAke3RoaXMudmVyc2lvbn0sICR7SlNPTi5zdHJpbmdpZnkodGhpcy5kYXRhLnZhbHVlKX0sIHtkb2N1bWVudFR5cGU6ICR7dGhpcy5kb2N1bWVudFR5cGV9fSksIHtkb2N1bWVudFN0YXRlOiAke3RoaXMuZG9jdW1lbnRTdGF0ZX19KWA7XG4gICAgfVxufVxuXG4vKipcbiAqIENvbXBhcmVzIHRoZSB2YWx1ZSBmb3IgZmllbGQgYGZpZWxkYCBpbiB0aGUgcHJvdmlkZWQgZG9jdW1lbnRzLiBUaHJvd3MgaWZcbiAqIHRoZSBmaWVsZCBkb2VzIG5vdCBleGlzdCBpbiBib3RoIGRvY3VtZW50cy5cbiAqL1xuLyoqXG4gKiBBbiBpbmRleCBkZWZpbml0aW9uIGZvciBmaWVsZCBpbmRleGVzIGluIEZpcmVzdG9yZS5cbiAqXG4gKiBFdmVyeSBpbmRleCBpcyBhc3NvY2lhdGVkIHdpdGggYSBjb2xsZWN0aW9uLiBUaGUgZGVmaW5pdGlvbiBjb250YWlucyBhIGxpc3RcbiAqIG9mIGZpZWxkcyBhbmQgdGhlaXIgaW5kZXgga2luZCAod2hpY2ggY2FuIGJlIGBBU0NFTkRJTkdgLCBgREVTQ0VORElOR2Agb3JcbiAqIGBDT05UQUlOU2AgZm9yIEFycmF5Q29udGFpbnMvQXJyYXlDb250YWluc0FueSBxdWVyaWVzKS5cbiAqXG4gKiBVbmxpa2UgdGhlIGJhY2tlbmQsIHRoZSBTREsgZG9lcyBub3QgZGlmZmVyZW50aWF0ZSBiZXR3ZWVuIGNvbGxlY3Rpb24gb3JcbiAqIGNvbGxlY3Rpb24gZ3JvdXAtc2NvcGVkIGluZGljZXMuIEV2ZXJ5IGluZGV4IGNhbiBiZSB1c2VkIGZvciBib3RoIHNpbmdsZVxuICogY29sbGVjdGlvbiBhbmQgY29sbGVjdGlvbiBncm91cCBxdWVyaWVzLlxuICovXG5jbGFzcyBzZSB7XG4gICAgY29uc3RydWN0b3IoXG4gICAgLyoqXG4gICAgICogVGhlIGluZGV4IElELiBSZXR1cm5zIC0xIGlmIHRoZSBpbmRleCBJRCBpcyBub3QgYXZhaWxhYmxlIChlLmcuIHRoZSBpbmRleFxuICAgICAqIGhhcyBub3QgeWV0IGJlZW4gcGVyc2lzdGVkKS5cbiAgICAgKi9cbiAgICB0LCBcbiAgICAvKiogVGhlIGNvbGxlY3Rpb24gSUQgdGhpcyBpbmRleCBhcHBsaWVzIHRvLiAqL1xuICAgIGUsIFxuICAgIC8qKiBUaGUgZmllbGQgc2VnbWVudHMgZm9yIHRoaXMgaW5kZXguICovXG4gICAgbiwgXG4gICAgLyoqIFNob3dzIGhvdyB1cC10by1kYXRlIHRoZSBpbmRleCBpcyBmb3IgdGhlIGN1cnJlbnQgdXNlci4gKi9cbiAgICBzKSB7XG4gICAgICAgIHRoaXMuaW5kZXhJZCA9IHQsIHRoaXMuY29sbGVjdGlvbkdyb3VwID0gZSwgdGhpcy5maWVsZHMgPSBuLCB0aGlzLmluZGV4U3RhdGUgPSBzO1xuICAgIH1cbn1cblxuLyoqIEFuIElEIGZvciBhbiBpbmRleCB0aGF0IGhhcyBub3QgeWV0IGJlZW4gYWRkZWQgdG8gcGVyc2lzdGVuY2UuICAqL1xuLyoqIFJldHVybnMgdGhlIEFycmF5Q29udGFpbnMvQXJyYXlDb250YWluc0FueSBzZWdtZW50IGZvciB0aGlzIGluZGV4LiAqL1xuZnVuY3Rpb24gaWUodCkge1xuICAgIHJldHVybiB0LmZpZWxkcy5maW5kKCh0ID0+IDIgLyogQ09OVEFJTlMgKi8gPT09IHQua2luZCkpO1xufVxuXG4vKiogUmV0dXJucyBhbGwgZGlyZWN0aW9uYWwgKGFzY2VuZGluZy9kZXNjZW5kaW5nKSBzZWdtZW50cyBmb3IgdGhpcyBpbmRleC4gKi8gZnVuY3Rpb24gcmUodCkge1xuICAgIHJldHVybiB0LmZpZWxkcy5maWx0ZXIoKHQgPT4gMiAvKiBDT05UQUlOUyAqLyAhPT0gdC5raW5kKSk7XG59XG5cbi8qKlxuICogUmV0dXJucyB0aGUgb3JkZXIgb2YgdGhlIGRvY3VtZW50IGtleSBjb21wb25lbnQgZm9yIHRoZSBnaXZlbiBpbmRleC5cbiAqXG4gKiBQT1JUSU5HIE5PVEU6IFRoaXMgaXMgb25seSB1c2VkIGluIHRoZSBXZWIgSW5kZXhlZERiIGltcGxlbWVudGF0aW9uLlxuICovIHNlLlVOS05PV05fSUQgPSAtMTtcblxuLyoqIEFuIGluZGV4IGNvbXBvbmVudCBjb25zaXN0aW5nIG9mIGZpZWxkIHBhdGggYW5kIGluZGV4IHR5cGUuICAqL1xuY2xhc3Mgb2Uge1xuICAgIGNvbnN0cnVjdG9yKFxuICAgIC8qKiBUaGUgZmllbGQgcGF0aCBvZiB0aGUgY29tcG9uZW50LiAqL1xuICAgIHQsIFxuICAgIC8qKiBUaGUgZmllbGRzIHNvcnRpbmcgb3JkZXIuICovXG4gICAgZSkge1xuICAgICAgICB0aGlzLmZpZWxkUGF0aCA9IHQsIHRoaXMua2luZCA9IGU7XG4gICAgfVxufVxuXG4vKipcbiAqIFN0b3JlcyB0aGUgXCJoaWdoIHdhdGVyIG1hcmtcIiB0aGF0IGluZGljYXRlcyBob3cgdXBkYXRlZCB0aGUgSW5kZXggaXMgZm9yIHRoZVxuICogY3VycmVudCB1c2VyLlxuICovIGNsYXNzIHVlIHtcbiAgICBjb25zdHJ1Y3RvcihcbiAgICAvKipcbiAgICAgKiBJbmRpY2F0ZXMgd2hlbiB0aGUgaW5kZXggd2FzIGxhc3QgdXBkYXRlZCAocmVsYXRpdmUgdG8gb3RoZXIgaW5kZXhlcykuXG4gICAgICovXG4gICAgdCwgXG4gICAgLyoqIFRoZSB0aGUgbGF0ZXN0IGluZGV4ZWQgcmVhZCB0aW1lLCBkb2N1bWVudCBhbmQgYmF0Y2ggaWQuICovXG4gICAgZSkge1xuICAgICAgICB0aGlzLnNlcXVlbmNlTnVtYmVyID0gdCwgdGhpcy5vZmZzZXQgPSBlO1xuICAgIH1cbiAgICAvKiogVGhlIHN0YXRlIG9mIGFuIGluZGV4IHRoYXQgaGFzIG5vdCB5ZXQgYmVlbiBiYWNrZmlsbGVkLiAqLyAgICBzdGF0aWMgZW1wdHkoKSB7XG4gICAgICAgIHJldHVybiBuZXcgdWUoMCwgaGUubWluKCkpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBDcmVhdGVzIGFuIG9mZnNldCB0aGF0IG1hdGNoZXMgYWxsIGRvY3VtZW50cyB3aXRoIGEgcmVhZCB0aW1lIGhpZ2hlciB0aGFuXG4gKiBgcmVhZFRpbWVgLlxuICovIGZ1bmN0aW9uIGFlKHQsIGUpIHtcbiAgICAvLyBXZSB3YW50IHRvIGNyZWF0ZSBhbiBvZmZzZXQgdGhhdCBtYXRjaGVzIGFsbCBkb2N1bWVudHMgd2l0aCBhIHJlYWQgdGltZVxuICAgIC8vIGdyZWF0ZXIgdGhhbiB0aGUgcHJvdmlkZWQgcmVhZCB0aW1lLiBUbyBkbyBzbywgd2UgdGVjaG5pY2FsbHkgbmVlZCB0b1xuICAgIC8vIGNyZWF0ZSBhbiBvZmZzZXQgZm9yIGAocmVhZFRpbWUsIE1BWF9ET0NVTUVOVF9LRVkpYC4gV2hpbGUgd2UgY291bGQgdXNlXG4gICAgLy8gVW5pY29kZSBjb2RlcG9pbnRzIHRvIGdlbmVyYXRlIE1BWF9ET0NVTUVOVF9LRVksIGl0IGlzIG11Y2ggZWFzaWVyIHRvIHVzZVxuICAgIC8vIGAocmVhZFRpbWUgKyAxLCBEb2N1bWVudEtleS5lbXB0eSgpKWAgc2luY2UgYD4gRG9jdW1lbnRLZXkuZW1wdHkoKWAgbWF0Y2hlc1xuICAgIC8vIGFsbCB2YWxpZCBkb2N1bWVudCBJRHMuXG4gICAgY29uc3QgbiA9IHQudG9UaW1lc3RhbXAoKS5zZWNvbmRzLCBzID0gdC50b1RpbWVzdGFtcCgpLm5hbm9zZWNvbmRzICsgMSwgaSA9IGN0LmZyb21UaW1lc3RhbXAoMWU5ID09PSBzID8gbmV3IGF0KG4gKyAxLCAwKSA6IG5ldyBhdChuLCBzKSk7XG4gICAgcmV0dXJuIG5ldyBoZShpLCB4dC5lbXB0eSgpLCBlKTtcbn1cblxuLyoqIENyZWF0ZXMgYSBuZXcgb2Zmc2V0IGJhc2VkIG9uIHRoZSBwcm92aWRlZCBkb2N1bWVudC4gKi8gZnVuY3Rpb24gY2UodCkge1xuICAgIHJldHVybiBuZXcgaGUodC5yZWFkVGltZSwgdC5rZXksIC0xKTtcbn1cblxuLyoqXG4gKiBTdG9yZXMgdGhlIGxhdGVzdCByZWFkIHRpbWUsIGRvY3VtZW50IGFuZCBiYXRjaCBJRCB0aGF0IHdlcmUgcHJvY2Vzc2VkIGZvciBhblxuICogaW5kZXguXG4gKi8gY2xhc3MgaGUge1xuICAgIGNvbnN0cnVjdG9yKFxuICAgIC8qKlxuICAgICAqIFRoZSBsYXRlc3QgcmVhZCB0aW1lIHZlcnNpb24gdGhhdCBoYXMgYmVlbiBpbmRleGVkIGJ5IEZpcmVzdG9yZSBmb3IgdGhpc1xuICAgICAqIGZpZWxkIGluZGV4LlxuICAgICAqL1xuICAgIHQsIFxuICAgIC8qKlxuICAgICAqIFRoZSBrZXkgb2YgdGhlIGxhc3QgZG9jdW1lbnQgdGhhdCB3YXMgaW5kZXhlZCBmb3IgdGhpcyBxdWVyeS4gVXNlXG4gICAgICogYERvY3VtZW50S2V5LmVtcHR5KClgIGlmIG5vIGRvY3VtZW50IGhhcyBiZWVuIGluZGV4ZWQuXG4gICAgICovXG4gICAgZSwgXG4gICAgLypcbiAgICAgKiBUaGUgbGFyZ2VzdCBtdXRhdGlvbiBiYXRjaCBpZCB0aGF0J3MgYmVlbiBwcm9jZXNzZWQgYnkgRmlyZXN0b3JlLlxuICAgICAqL1xuICAgIG4pIHtcbiAgICAgICAgdGhpcy5yZWFkVGltZSA9IHQsIHRoaXMuZG9jdW1lbnRLZXkgPSBlLCB0aGlzLmxhcmdlc3RCYXRjaElkID0gbjtcbiAgICB9XG4gICAgLyoqIFJldHVybnMgYW4gb2Zmc2V0IHRoYXQgc29ydHMgYmVmb3JlIGFsbCByZWd1bGFyIG9mZnNldHMuICovICAgIHN0YXRpYyBtaW4oKSB7XG4gICAgICAgIHJldHVybiBuZXcgaGUoY3QubWluKCksIHh0LmVtcHR5KCksIC0xKTtcbiAgICB9XG4gICAgLyoqIFJldHVybnMgYW4gb2Zmc2V0IHRoYXQgc29ydHMgYWZ0ZXIgYWxsIHJlZ3VsYXIgb2Zmc2V0cy4gKi8gICAgc3RhdGljIG1heCgpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBoZShjdC5tYXgoKSwgeHQuZW1wdHkoKSwgLTEpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gbGUodCwgZSkge1xuICAgIGxldCBuID0gdC5yZWFkVGltZS5jb21wYXJlVG8oZS5yZWFkVGltZSk7XG4gICAgcmV0dXJuIDAgIT09IG4gPyBuIDogKG4gPSB4dC5jb21wYXJhdG9yKHQuZG9jdW1lbnRLZXksIGUuZG9jdW1lbnRLZXkpLCAwICE9PSBuID8gbiA6IHJ0KHQubGFyZ2VzdEJhdGNoSWQsIGUubGFyZ2VzdEJhdGNoSWQpKTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8vIEFuIGltbXV0YWJsZSBzb3J0ZWQgbWFwIGltcGxlbWVudGF0aW9uLCBiYXNlZCBvbiBhIExlZnQtbGVhbmluZyBSZWQtQmxhY2tcbi8vIHRyZWUuXG5jbGFzcyBmZSB7XG4gICAgY29uc3RydWN0b3IodCwgZSkge1xuICAgICAgICB0aGlzLmNvbXBhcmF0b3IgPSB0LCB0aGlzLnJvb3QgPSBlIHx8IF9lLkVNUFRZO1xuICAgIH1cbiAgICAvLyBSZXR1cm5zIGEgY29weSBvZiB0aGUgbWFwLCB3aXRoIHRoZSBzcGVjaWZpZWQga2V5L3ZhbHVlIGFkZGVkIG9yIHJlcGxhY2VkLlxuICAgIGluc2VydCh0LCBlKSB7XG4gICAgICAgIHJldHVybiBuZXcgZmUodGhpcy5jb21wYXJhdG9yLCB0aGlzLnJvb3QuaW5zZXJ0KHQsIGUsIHRoaXMuY29tcGFyYXRvcikuY29weShudWxsLCBudWxsLCBfZS5CTEFDSywgbnVsbCwgbnVsbCkpO1xuICAgIH1cbiAgICAvLyBSZXR1cm5zIGEgY29weSBvZiB0aGUgbWFwLCB3aXRoIHRoZSBzcGVjaWZpZWQga2V5IHJlbW92ZWQuXG4gICAgcmVtb3ZlKHQpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBmZSh0aGlzLmNvbXBhcmF0b3IsIHRoaXMucm9vdC5yZW1vdmUodCwgdGhpcy5jb21wYXJhdG9yKS5jb3B5KG51bGwsIG51bGwsIF9lLkJMQUNLLCBudWxsLCBudWxsKSk7XG4gICAgfVxuICAgIC8vIFJldHVybnMgdGhlIHZhbHVlIG9mIHRoZSBub2RlIHdpdGggdGhlIGdpdmVuIGtleSwgb3IgbnVsbC5cbiAgICBnZXQodCkge1xuICAgICAgICBsZXQgZSA9IHRoaXMucm9vdDtcbiAgICAgICAgZm9yICg7IWUuaXNFbXB0eSgpOyApIHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSB0aGlzLmNvbXBhcmF0b3IodCwgZS5rZXkpO1xuICAgICAgICAgICAgaWYgKDAgPT09IG4pIHJldHVybiBlLnZhbHVlO1xuICAgICAgICAgICAgbiA8IDAgPyBlID0gZS5sZWZ0IDogbiA+IDAgJiYgKGUgPSBlLnJpZ2h0KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgLy8gUmV0dXJucyB0aGUgaW5kZXggb2YgdGhlIGVsZW1lbnQgaW4gdGhpcyBzb3J0ZWQgbWFwLCBvciAtMSBpZiBpdCBkb2Vzbid0XG4gICAgLy8gZXhpc3QuXG4gICAgaW5kZXhPZih0KSB7XG4gICAgICAgIC8vIE51bWJlciBvZiBub2RlcyB0aGF0IHdlcmUgcHJ1bmVkIHdoZW4gZGVzY2VuZGluZyByaWdodFxuICAgICAgICBsZXQgZSA9IDAsIG4gPSB0aGlzLnJvb3Q7XG4gICAgICAgIGZvciAoOyFuLmlzRW1wdHkoKTsgKSB7XG4gICAgICAgICAgICBjb25zdCBzID0gdGhpcy5jb21wYXJhdG9yKHQsIG4ua2V5KTtcbiAgICAgICAgICAgIGlmICgwID09PSBzKSByZXR1cm4gZSArIG4ubGVmdC5zaXplO1xuICAgICAgICAgICAgcyA8IDAgPyBuID0gbi5sZWZ0IDogKFxuICAgICAgICAgICAgLy8gQ291bnQgYWxsIG5vZGVzIGxlZnQgb2YgdGhlIG5vZGUgcGx1cyB0aGUgbm9kZSBpdHNlbGZcbiAgICAgICAgICAgIGUgKz0gbi5sZWZ0LnNpemUgKyAxLCBuID0gbi5yaWdodCk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gTm9kZSBub3QgZm91bmRcbiAgICAgICAgICAgICAgICByZXR1cm4gLTE7XG4gICAgfVxuICAgIGlzRW1wdHkoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJvb3QuaXNFbXB0eSgpO1xuICAgIH1cbiAgICAvLyBSZXR1cm5zIHRoZSB0b3RhbCBudW1iZXIgb2Ygbm9kZXMgaW4gdGhlIG1hcC5cbiAgICBnZXQgc2l6ZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucm9vdC5zaXplO1xuICAgIH1cbiAgICAvLyBSZXR1cm5zIHRoZSBtaW5pbXVtIGtleSBpbiB0aGUgbWFwLlxuICAgIG1pbktleSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucm9vdC5taW5LZXkoKTtcbiAgICB9XG4gICAgLy8gUmV0dXJucyB0aGUgbWF4aW11bSBrZXkgaW4gdGhlIG1hcC5cbiAgICBtYXhLZXkoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJvb3QubWF4S2V5KCk7XG4gICAgfVxuICAgIC8vIFRyYXZlcnNlcyB0aGUgbWFwIGluIGtleSBvcmRlciBhbmQgY2FsbHMgdGhlIHNwZWNpZmllZCBhY3Rpb24gZnVuY3Rpb25cbiAgICAvLyBmb3IgZWFjaCBrZXkvdmFsdWUgcGFpci4gSWYgYWN0aW9uIHJldHVybnMgdHJ1ZSwgdHJhdmVyc2FsIGlzIGFib3J0ZWQuXG4gICAgLy8gUmV0dXJucyB0aGUgZmlyc3QgdHJ1dGh5IHZhbHVlIHJldHVybmVkIGJ5IGFjdGlvbiwgb3IgdGhlIGxhc3QgZmFsc2V5XG4gICAgLy8gdmFsdWUgcmV0dXJuZWQgYnkgYWN0aW9uLlxuICAgIGlub3JkZXJUcmF2ZXJzYWwodCkge1xuICAgICAgICByZXR1cm4gdGhpcy5yb290Lmlub3JkZXJUcmF2ZXJzYWwodCk7XG4gICAgfVxuICAgIGZvckVhY2godCkge1xuICAgICAgICB0aGlzLmlub3JkZXJUcmF2ZXJzYWwoKChlLCBuKSA9PiAodChlLCBuKSwgITEpKSk7XG4gICAgfVxuICAgIHRvU3RyaW5nKCkge1xuICAgICAgICBjb25zdCB0ID0gW107XG4gICAgICAgIHJldHVybiB0aGlzLmlub3JkZXJUcmF2ZXJzYWwoKChlLCBuKSA9PiAodC5wdXNoKGAke2V9OiR7bn1gKSwgITEpKSksIGB7JHt0LmpvaW4oXCIsIFwiKX19YDtcbiAgICB9XG4gICAgLy8gVHJhdmVyc2VzIHRoZSBtYXAgaW4gcmV2ZXJzZSBrZXkgb3JkZXIgYW5kIGNhbGxzIHRoZSBzcGVjaWZpZWQgYWN0aW9uXG4gICAgLy8gZnVuY3Rpb24gZm9yIGVhY2gga2V5L3ZhbHVlIHBhaXIuIElmIGFjdGlvbiByZXR1cm5zIHRydWUsIHRyYXZlcnNhbCBpc1xuICAgIC8vIGFib3J0ZWQuXG4gICAgLy8gUmV0dXJucyB0aGUgZmlyc3QgdHJ1dGh5IHZhbHVlIHJldHVybmVkIGJ5IGFjdGlvbiwgb3IgdGhlIGxhc3QgZmFsc2V5XG4gICAgLy8gdmFsdWUgcmV0dXJuZWQgYnkgYWN0aW9uLlxuICAgIHJldmVyc2VUcmF2ZXJzYWwodCkge1xuICAgICAgICByZXR1cm4gdGhpcy5yb290LnJldmVyc2VUcmF2ZXJzYWwodCk7XG4gICAgfVxuICAgIC8vIFJldHVybnMgYW4gaXRlcmF0b3Igb3ZlciB0aGUgU29ydGVkTWFwLlxuICAgIGdldEl0ZXJhdG9yKCkge1xuICAgICAgICByZXR1cm4gbmV3IGRlKHRoaXMucm9vdCwgbnVsbCwgdGhpcy5jb21wYXJhdG9yLCAhMSk7XG4gICAgfVxuICAgIGdldEl0ZXJhdG9yRnJvbSh0KSB7XG4gICAgICAgIHJldHVybiBuZXcgZGUodGhpcy5yb290LCB0LCB0aGlzLmNvbXBhcmF0b3IsICExKTtcbiAgICB9XG4gICAgZ2V0UmV2ZXJzZUl0ZXJhdG9yKCkge1xuICAgICAgICByZXR1cm4gbmV3IGRlKHRoaXMucm9vdCwgbnVsbCwgdGhpcy5jb21wYXJhdG9yLCAhMCk7XG4gICAgfVxuICAgIGdldFJldmVyc2VJdGVyYXRvckZyb20odCkge1xuICAgICAgICByZXR1cm4gbmV3IGRlKHRoaXMucm9vdCwgdCwgdGhpcy5jb21wYXJhdG9yLCAhMCk7XG4gICAgfVxufVxuXG4gLy8gZW5kIFNvcnRlZE1hcFxuLy8gQW4gaXRlcmF0b3Igb3ZlciBhbiBMTFJCTm9kZS5cbmNsYXNzIGRlIHtcbiAgICBjb25zdHJ1Y3Rvcih0LCBlLCBuLCBzKSB7XG4gICAgICAgIHRoaXMuaXNSZXZlcnNlID0gcywgdGhpcy5ub2RlU3RhY2sgPSBbXTtcbiAgICAgICAgbGV0IGkgPSAxO1xuICAgICAgICBmb3IgKDshdC5pc0VtcHR5KCk7ICkgaWYgKGkgPSBlID8gbih0LmtleSwgZSkgOiAxLCBcbiAgICAgICAgLy8gZmxpcCB0aGUgY29tcGFyaXNvbiBpZiB3ZSdyZSBnb2luZyBpbiByZXZlcnNlXG4gICAgICAgIGUgJiYgcyAmJiAoaSAqPSAtMSksIGkgPCAwKSBcbiAgICAgICAgLy8gVGhpcyBub2RlIGlzIGxlc3MgdGhhbiBvdXIgc3RhcnQga2V5LiBpZ25vcmUgaXRcbiAgICAgICAgdCA9IHRoaXMuaXNSZXZlcnNlID8gdC5sZWZ0IDogdC5yaWdodDsgZWxzZSB7XG4gICAgICAgICAgICBpZiAoMCA9PT0gaSkge1xuICAgICAgICAgICAgICAgIC8vIFRoaXMgbm9kZSBpcyBleGFjdGx5IGVxdWFsIHRvIG91ciBzdGFydCBrZXkuIFB1c2ggaXQgb24gdGhlIHN0YWNrLFxuICAgICAgICAgICAgICAgIC8vIGJ1dCBzdG9wIGl0ZXJhdGluZztcbiAgICAgICAgICAgICAgICB0aGlzLm5vZGVTdGFjay5wdXNoKHQpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gVGhpcyBub2RlIGlzIGdyZWF0ZXIgdGhhbiBvdXIgc3RhcnQga2V5LCBhZGQgaXQgdG8gdGhlIHN0YWNrIGFuZCBtb3ZlXG4gICAgICAgICAgICAvLyB0byB0aGUgbmV4dCBvbmVcbiAgICAgICAgICAgIHRoaXMubm9kZVN0YWNrLnB1c2godCksIHQgPSB0aGlzLmlzUmV2ZXJzZSA/IHQucmlnaHQgOiB0LmxlZnQ7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0TmV4dCgpIHtcbiAgICAgICAgbGV0IHQgPSB0aGlzLm5vZGVTdGFjay5wb3AoKTtcbiAgICAgICAgY29uc3QgZSA9IHtcbiAgICAgICAgICAgIGtleTogdC5rZXksXG4gICAgICAgICAgICB2YWx1ZTogdC52YWx1ZVxuICAgICAgICB9O1xuICAgICAgICBpZiAodGhpcy5pc1JldmVyc2UpIGZvciAodCA9IHQubGVmdDsgIXQuaXNFbXB0eSgpOyApIHRoaXMubm9kZVN0YWNrLnB1c2godCksIHQgPSB0LnJpZ2h0OyBlbHNlIGZvciAodCA9IHQucmlnaHQ7ICF0LmlzRW1wdHkoKTsgKSB0aGlzLm5vZGVTdGFjay5wdXNoKHQpLCBcbiAgICAgICAgdCA9IHQubGVmdDtcbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfVxuICAgIGhhc05leHQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm5vZGVTdGFjay5sZW5ndGggPiAwO1xuICAgIH1cbiAgICBwZWVrKCkge1xuICAgICAgICBpZiAoMCA9PT0gdGhpcy5ub2RlU3RhY2subGVuZ3RoKSByZXR1cm4gbnVsbDtcbiAgICAgICAgY29uc3QgdCA9IHRoaXMubm9kZVN0YWNrW3RoaXMubm9kZVN0YWNrLmxlbmd0aCAtIDFdO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAga2V5OiB0LmtleSxcbiAgICAgICAgICAgIHZhbHVlOiB0LnZhbHVlXG4gICAgICAgIH07XG4gICAgfVxufVxuXG4gLy8gZW5kIFNvcnRlZE1hcEl0ZXJhdG9yXG4vLyBSZXByZXNlbnRzIGEgbm9kZSBpbiBhIExlZnQtbGVhbmluZyBSZWQtQmxhY2sgdHJlZS5cbmNsYXNzIF9lIHtcbiAgICBjb25zdHJ1Y3Rvcih0LCBlLCBuLCBzLCBpKSB7XG4gICAgICAgIHRoaXMua2V5ID0gdCwgdGhpcy52YWx1ZSA9IGUsIHRoaXMuY29sb3IgPSBudWxsICE9IG4gPyBuIDogX2UuUkVELCB0aGlzLmxlZnQgPSBudWxsICE9IHMgPyBzIDogX2UuRU1QVFksIFxuICAgICAgICB0aGlzLnJpZ2h0ID0gbnVsbCAhPSBpID8gaSA6IF9lLkVNUFRZLCB0aGlzLnNpemUgPSB0aGlzLmxlZnQuc2l6ZSArIDEgKyB0aGlzLnJpZ2h0LnNpemU7XG4gICAgfVxuICAgIC8vIFJldHVybnMgYSBjb3B5IG9mIHRoZSBjdXJyZW50IG5vZGUsIG9wdGlvbmFsbHkgcmVwbGFjaW5nIHBpZWNlcyBvZiBpdC5cbiAgICBjb3B5KHQsIGUsIG4sIHMsIGkpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBfZShudWxsICE9IHQgPyB0IDogdGhpcy5rZXksIG51bGwgIT0gZSA/IGUgOiB0aGlzLnZhbHVlLCBudWxsICE9IG4gPyBuIDogdGhpcy5jb2xvciwgbnVsbCAhPSBzID8gcyA6IHRoaXMubGVmdCwgbnVsbCAhPSBpID8gaSA6IHRoaXMucmlnaHQpO1xuICAgIH1cbiAgICBpc0VtcHR5KCkge1xuICAgICAgICByZXR1cm4gITE7XG4gICAgfVxuICAgIC8vIFRyYXZlcnNlcyB0aGUgdHJlZSBpbiBrZXkgb3JkZXIgYW5kIGNhbGxzIHRoZSBzcGVjaWZpZWQgYWN0aW9uIGZ1bmN0aW9uXG4gICAgLy8gZm9yIGVhY2ggbm9kZS4gSWYgYWN0aW9uIHJldHVybnMgdHJ1ZSwgdHJhdmVyc2FsIGlzIGFib3J0ZWQuXG4gICAgLy8gUmV0dXJucyB0aGUgZmlyc3QgdHJ1dGh5IHZhbHVlIHJldHVybmVkIGJ5IGFjdGlvbiwgb3IgdGhlIGxhc3QgZmFsc2V5XG4gICAgLy8gdmFsdWUgcmV0dXJuZWQgYnkgYWN0aW9uLlxuICAgIGlub3JkZXJUcmF2ZXJzYWwodCkge1xuICAgICAgICByZXR1cm4gdGhpcy5sZWZ0Lmlub3JkZXJUcmF2ZXJzYWwodCkgfHwgdCh0aGlzLmtleSwgdGhpcy52YWx1ZSkgfHwgdGhpcy5yaWdodC5pbm9yZGVyVHJhdmVyc2FsKHQpO1xuICAgIH1cbiAgICAvLyBUcmF2ZXJzZXMgdGhlIHRyZWUgaW4gcmV2ZXJzZSBrZXkgb3JkZXIgYW5kIGNhbGxzIHRoZSBzcGVjaWZpZWQgYWN0aW9uXG4gICAgLy8gZnVuY3Rpb24gZm9yIGVhY2ggbm9kZS4gSWYgYWN0aW9uIHJldHVybnMgdHJ1ZSwgdHJhdmVyc2FsIGlzIGFib3J0ZWQuXG4gICAgLy8gUmV0dXJucyB0aGUgZmlyc3QgdHJ1dGh5IHZhbHVlIHJldHVybmVkIGJ5IGFjdGlvbiwgb3IgdGhlIGxhc3QgZmFsc2V5XG4gICAgLy8gdmFsdWUgcmV0dXJuZWQgYnkgYWN0aW9uLlxuICAgIHJldmVyc2VUcmF2ZXJzYWwodCkge1xuICAgICAgICByZXR1cm4gdGhpcy5yaWdodC5yZXZlcnNlVHJhdmVyc2FsKHQpIHx8IHQodGhpcy5rZXksIHRoaXMudmFsdWUpIHx8IHRoaXMubGVmdC5yZXZlcnNlVHJhdmVyc2FsKHQpO1xuICAgIH1cbiAgICAvLyBSZXR1cm5zIHRoZSBtaW5pbXVtIG5vZGUgaW4gdGhlIHRyZWUuXG4gICAgbWluKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5sZWZ0LmlzRW1wdHkoKSA/IHRoaXMgOiB0aGlzLmxlZnQubWluKCk7XG4gICAgfVxuICAgIC8vIFJldHVybnMgdGhlIG1heGltdW0ga2V5IGluIHRoZSB0cmVlLlxuICAgIG1pbktleSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubWluKCkua2V5O1xuICAgIH1cbiAgICAvLyBSZXR1cm5zIHRoZSBtYXhpbXVtIGtleSBpbiB0aGUgdHJlZS5cbiAgICBtYXhLZXkoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJpZ2h0LmlzRW1wdHkoKSA/IHRoaXMua2V5IDogdGhpcy5yaWdodC5tYXhLZXkoKTtcbiAgICB9XG4gICAgLy8gUmV0dXJucyBuZXcgdHJlZSwgd2l0aCB0aGUga2V5L3ZhbHVlIGFkZGVkLlxuICAgIGluc2VydCh0LCBlLCBuKSB7XG4gICAgICAgIGxldCBzID0gdGhpcztcbiAgICAgICAgY29uc3QgaSA9IG4odCwgcy5rZXkpO1xuICAgICAgICByZXR1cm4gcyA9IGkgPCAwID8gcy5jb3B5KG51bGwsIG51bGwsIG51bGwsIHMubGVmdC5pbnNlcnQodCwgZSwgbiksIG51bGwpIDogMCA9PT0gaSA/IHMuY29weShudWxsLCBlLCBudWxsLCBudWxsLCBudWxsKSA6IHMuY29weShudWxsLCBudWxsLCBudWxsLCBudWxsLCBzLnJpZ2h0Lmluc2VydCh0LCBlLCBuKSksIFxuICAgICAgICBzLmZpeFVwKCk7XG4gICAgfVxuICAgIHJlbW92ZU1pbigpIHtcbiAgICAgICAgaWYgKHRoaXMubGVmdC5pc0VtcHR5KCkpIHJldHVybiBfZS5FTVBUWTtcbiAgICAgICAgbGV0IHQgPSB0aGlzO1xuICAgICAgICByZXR1cm4gdC5sZWZ0LmlzUmVkKCkgfHwgdC5sZWZ0LmxlZnQuaXNSZWQoKSB8fCAodCA9IHQubW92ZVJlZExlZnQoKSksIHQgPSB0LmNvcHkobnVsbCwgbnVsbCwgbnVsbCwgdC5sZWZ0LnJlbW92ZU1pbigpLCBudWxsKSwgXG4gICAgICAgIHQuZml4VXAoKTtcbiAgICB9XG4gICAgLy8gUmV0dXJucyBuZXcgdHJlZSwgd2l0aCB0aGUgc3BlY2lmaWVkIGl0ZW0gcmVtb3ZlZC5cbiAgICByZW1vdmUodCwgZSkge1xuICAgICAgICBsZXQgbiwgcyA9IHRoaXM7XG4gICAgICAgIGlmIChlKHQsIHMua2V5KSA8IDApIHMubGVmdC5pc0VtcHR5KCkgfHwgcy5sZWZ0LmlzUmVkKCkgfHwgcy5sZWZ0LmxlZnQuaXNSZWQoKSB8fCAocyA9IHMubW92ZVJlZExlZnQoKSksIFxuICAgICAgICBzID0gcy5jb3B5KG51bGwsIG51bGwsIG51bGwsIHMubGVmdC5yZW1vdmUodCwgZSksIG51bGwpOyBlbHNlIHtcbiAgICAgICAgICAgIGlmIChzLmxlZnQuaXNSZWQoKSAmJiAocyA9IHMucm90YXRlUmlnaHQoKSksIHMucmlnaHQuaXNFbXB0eSgpIHx8IHMucmlnaHQuaXNSZWQoKSB8fCBzLnJpZ2h0LmxlZnQuaXNSZWQoKSB8fCAocyA9IHMubW92ZVJlZFJpZ2h0KCkpLCBcbiAgICAgICAgICAgIDAgPT09IGUodCwgcy5rZXkpKSB7XG4gICAgICAgICAgICAgICAgaWYgKHMucmlnaHQuaXNFbXB0eSgpKSByZXR1cm4gX2UuRU1QVFk7XG4gICAgICAgICAgICAgICAgbiA9IHMucmlnaHQubWluKCksIHMgPSBzLmNvcHkobi5rZXksIG4udmFsdWUsIG51bGwsIG51bGwsIHMucmlnaHQucmVtb3ZlTWluKCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcyA9IHMuY29weShudWxsLCBudWxsLCBudWxsLCBudWxsLCBzLnJpZ2h0LnJlbW92ZSh0LCBlKSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHMuZml4VXAoKTtcbiAgICB9XG4gICAgaXNSZWQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNvbG9yO1xuICAgIH1cbiAgICAvLyBSZXR1cm5zIG5ldyB0cmVlIGFmdGVyIHBlcmZvcm1pbmcgYW55IG5lZWRlZCByb3RhdGlvbnMuXG4gICAgZml4VXAoKSB7XG4gICAgICAgIGxldCB0ID0gdGhpcztcbiAgICAgICAgcmV0dXJuIHQucmlnaHQuaXNSZWQoKSAmJiAhdC5sZWZ0LmlzUmVkKCkgJiYgKHQgPSB0LnJvdGF0ZUxlZnQoKSksIHQubGVmdC5pc1JlZCgpICYmIHQubGVmdC5sZWZ0LmlzUmVkKCkgJiYgKHQgPSB0LnJvdGF0ZVJpZ2h0KCkpLCBcbiAgICAgICAgdC5sZWZ0LmlzUmVkKCkgJiYgdC5yaWdodC5pc1JlZCgpICYmICh0ID0gdC5jb2xvckZsaXAoKSksIHQ7XG4gICAgfVxuICAgIG1vdmVSZWRMZWZ0KCkge1xuICAgICAgICBsZXQgdCA9IHRoaXMuY29sb3JGbGlwKCk7XG4gICAgICAgIHJldHVybiB0LnJpZ2h0LmxlZnQuaXNSZWQoKSAmJiAodCA9IHQuY29weShudWxsLCBudWxsLCBudWxsLCBudWxsLCB0LnJpZ2h0LnJvdGF0ZVJpZ2h0KCkpLCBcbiAgICAgICAgdCA9IHQucm90YXRlTGVmdCgpLCB0ID0gdC5jb2xvckZsaXAoKSksIHQ7XG4gICAgfVxuICAgIG1vdmVSZWRSaWdodCgpIHtcbiAgICAgICAgbGV0IHQgPSB0aGlzLmNvbG9yRmxpcCgpO1xuICAgICAgICByZXR1cm4gdC5sZWZ0LmxlZnQuaXNSZWQoKSAmJiAodCA9IHQucm90YXRlUmlnaHQoKSwgdCA9IHQuY29sb3JGbGlwKCkpLCB0O1xuICAgIH1cbiAgICByb3RhdGVMZWZ0KCkge1xuICAgICAgICBjb25zdCB0ID0gdGhpcy5jb3B5KG51bGwsIG51bGwsIF9lLlJFRCwgbnVsbCwgdGhpcy5yaWdodC5sZWZ0KTtcbiAgICAgICAgcmV0dXJuIHRoaXMucmlnaHQuY29weShudWxsLCBudWxsLCB0aGlzLmNvbG9yLCB0LCBudWxsKTtcbiAgICB9XG4gICAgcm90YXRlUmlnaHQoKSB7XG4gICAgICAgIGNvbnN0IHQgPSB0aGlzLmNvcHkobnVsbCwgbnVsbCwgX2UuUkVELCB0aGlzLmxlZnQucmlnaHQsIG51bGwpO1xuICAgICAgICByZXR1cm4gdGhpcy5sZWZ0LmNvcHkobnVsbCwgbnVsbCwgdGhpcy5jb2xvciwgbnVsbCwgdCk7XG4gICAgfVxuICAgIGNvbG9yRmxpcCgpIHtcbiAgICAgICAgY29uc3QgdCA9IHRoaXMubGVmdC5jb3B5KG51bGwsIG51bGwsICF0aGlzLmxlZnQuY29sb3IsIG51bGwsIG51bGwpLCBlID0gdGhpcy5yaWdodC5jb3B5KG51bGwsIG51bGwsICF0aGlzLnJpZ2h0LmNvbG9yLCBudWxsLCBudWxsKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuY29weShudWxsLCBudWxsLCAhdGhpcy5jb2xvciwgdCwgZSk7XG4gICAgfVxuICAgIC8vIEZvciB0ZXN0aW5nLlxuICAgIGNoZWNrTWF4RGVwdGgoKSB7XG4gICAgICAgIGNvbnN0IHQgPSB0aGlzLmNoZWNrKCk7XG4gICAgICAgIHJldHVybiBNYXRoLnBvdygyLCB0KSA8PSB0aGlzLnNpemUgKyAxO1xuICAgIH1cbiAgICAvLyBJbiBhIGJhbGFuY2VkIFJCIHRyZWUsIHRoZSBibGFjay1kZXB0aCAobnVtYmVyIG9mIGJsYWNrIG5vZGVzKSBmcm9tIHJvb3QgdG9cbiAgICAvLyBsZWF2ZXMgaXMgZXF1YWwgb24gYm90aCBzaWRlcy4gIFRoaXMgZnVuY3Rpb24gdmVyaWZpZXMgdGhhdCBvciBhc3NlcnRzLlxuICAgIGNoZWNrKCkge1xuICAgICAgICBpZiAodGhpcy5pc1JlZCgpICYmIHRoaXMubGVmdC5pc1JlZCgpKSB0aHJvdyBMKCk7XG4gICAgICAgIGlmICh0aGlzLnJpZ2h0LmlzUmVkKCkpIHRocm93IEwoKTtcbiAgICAgICAgY29uc3QgdCA9IHRoaXMubGVmdC5jaGVjaygpO1xuICAgICAgICBpZiAodCAhPT0gdGhpcy5yaWdodC5jaGVjaygpKSB0aHJvdyBMKCk7XG4gICAgICAgIHJldHVybiB0ICsgKHRoaXMuaXNSZWQoKSA/IDAgOiAxKTtcbiAgICB9XG59XG5cbiAvLyBlbmQgTExSQk5vZGVcbi8vIEVtcHR5IG5vZGUgaXMgc2hhcmVkIGJldHdlZW4gYWxsIExMUkIgdHJlZXMuXG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuX2UuRU1QVFkgPSBudWxsLCBfZS5SRUQgPSAhMCwgX2UuQkxBQ0sgPSAhMTtcblxuLy8gZW5kIExMUkJFbXB0eU5vZGVcbl9lLkVNUFRZID0gbmV3IFxuLy8gUmVwcmVzZW50cyBhbiBlbXB0eSBub2RlIChhIGxlYWYgbm9kZSBpbiB0aGUgUmVkLUJsYWNrIFRyZWUpLlxuY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLnNpemUgPSAwO1xuICAgIH1cbiAgICBnZXQga2V5KCkge1xuICAgICAgICB0aHJvdyBMKCk7XG4gICAgfVxuICAgIGdldCB2YWx1ZSgpIHtcbiAgICAgICAgdGhyb3cgTCgpO1xuICAgIH1cbiAgICBnZXQgY29sb3IoKSB7XG4gICAgICAgIHRocm93IEwoKTtcbiAgICB9XG4gICAgZ2V0IGxlZnQoKSB7XG4gICAgICAgIHRocm93IEwoKTtcbiAgICB9XG4gICAgZ2V0IHJpZ2h0KCkge1xuICAgICAgICB0aHJvdyBMKCk7XG4gICAgfVxuICAgIC8vIFJldHVybnMgYSBjb3B5IG9mIHRoZSBjdXJyZW50IG5vZGUuXG4gICAgY29weSh0LCBlLCBuLCBzLCBpKSB7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICAvLyBSZXR1cm5zIGEgY29weSBvZiB0aGUgdHJlZSwgd2l0aCB0aGUgc3BlY2lmaWVkIGtleS92YWx1ZSBhZGRlZC5cbiAgICBpbnNlcnQodCwgZSwgbikge1xuICAgICAgICByZXR1cm4gbmV3IF9lKHQsIGUpO1xuICAgIH1cbiAgICAvLyBSZXR1cm5zIGEgY29weSBvZiB0aGUgdHJlZSwgd2l0aCB0aGUgc3BlY2lmaWVkIGtleSByZW1vdmVkLlxuICAgIHJlbW92ZSh0LCBlKSB7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICBpc0VtcHR5KCkge1xuICAgICAgICByZXR1cm4gITA7XG4gICAgfVxuICAgIGlub3JkZXJUcmF2ZXJzYWwodCkge1xuICAgICAgICByZXR1cm4gITE7XG4gICAgfVxuICAgIHJldmVyc2VUcmF2ZXJzYWwodCkge1xuICAgICAgICByZXR1cm4gITE7XG4gICAgfVxuICAgIG1pbktleSgpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIG1heEtleSgpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGlzUmVkKCkge1xuICAgICAgICByZXR1cm4gITE7XG4gICAgfVxuICAgIC8vIEZvciB0ZXN0aW5nLlxuICAgIGNoZWNrTWF4RGVwdGgoKSB7XG4gICAgICAgIHJldHVybiAhMDtcbiAgICB9XG4gICAgY2hlY2soKSB7XG4gICAgICAgIHJldHVybiAwO1xuICAgIH1cbn07XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIFNvcnRlZFNldCBpcyBhbiBpbW11dGFibGUgKGNvcHktb24td3JpdGUpIGNvbGxlY3Rpb24gdGhhdCBob2xkcyBlbGVtZW50c1xuICogaW4gb3JkZXIgc3BlY2lmaWVkIGJ5IHRoZSBwcm92aWRlZCBjb21wYXJhdG9yLlxuICpcbiAqIE5PVEU6IGlmIHByb3ZpZGVkIGNvbXBhcmF0b3IgcmV0dXJucyAwIGZvciB0d28gZWxlbWVudHMsIHdlIGNvbnNpZGVyIHRoZW0gdG9cbiAqIGJlIGVxdWFsIVxuICovXG5jbGFzcyB3ZSB7XG4gICAgY29uc3RydWN0b3IodCkge1xuICAgICAgICB0aGlzLmNvbXBhcmF0b3IgPSB0LCB0aGlzLmRhdGEgPSBuZXcgZmUodGhpcy5jb21wYXJhdG9yKTtcbiAgICB9XG4gICAgaGFzKHQpIHtcbiAgICAgICAgcmV0dXJuIG51bGwgIT09IHRoaXMuZGF0YS5nZXQodCk7XG4gICAgfVxuICAgIGZpcnN0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5kYXRhLm1pbktleSgpO1xuICAgIH1cbiAgICBsYXN0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5kYXRhLm1heEtleSgpO1xuICAgIH1cbiAgICBnZXQgc2l6ZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGF0YS5zaXplO1xuICAgIH1cbiAgICBpbmRleE9mKHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGF0YS5pbmRleE9mKHQpO1xuICAgIH1cbiAgICAvKiogSXRlcmF0ZXMgZWxlbWVudHMgaW4gb3JkZXIgZGVmaW5lZCBieSBcImNvbXBhcmF0b3JcIiAqLyAgICBmb3JFYWNoKHQpIHtcbiAgICAgICAgdGhpcy5kYXRhLmlub3JkZXJUcmF2ZXJzYWwoKChlLCBuKSA9PiAodChlKSwgITEpKSk7XG4gICAgfVxuICAgIC8qKiBJdGVyYXRlcyBvdmVyIGBlbGVtYHMgc3VjaCB0aGF0OiByYW5nZVswXSAmbHQ7PSBlbGVtICZsdDsgcmFuZ2VbMV0uICovICAgIGZvckVhY2hJblJhbmdlKHQsIGUpIHtcbiAgICAgICAgY29uc3QgbiA9IHRoaXMuZGF0YS5nZXRJdGVyYXRvckZyb20odFswXSk7XG4gICAgICAgIGZvciAoO24uaGFzTmV4dCgpOyApIHtcbiAgICAgICAgICAgIGNvbnN0IHMgPSBuLmdldE5leHQoKTtcbiAgICAgICAgICAgIGlmICh0aGlzLmNvbXBhcmF0b3Iocy5rZXksIHRbMV0pID49IDApIHJldHVybjtcbiAgICAgICAgICAgIGUocy5rZXkpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEl0ZXJhdGVzIG92ZXIgYGVsZW1gcyBzdWNoIHRoYXQ6IHN0YXJ0ICZsdDs9IGVsZW0gdW50aWwgZmFsc2UgaXMgcmV0dXJuZWQuXG4gICAgICovICAgIGZvckVhY2hXaGlsZSh0LCBlKSB7XG4gICAgICAgIGxldCBuO1xuICAgICAgICBmb3IgKG4gPSB2b2lkIDAgIT09IGUgPyB0aGlzLmRhdGEuZ2V0SXRlcmF0b3JGcm9tKGUpIDogdGhpcy5kYXRhLmdldEl0ZXJhdG9yKCk7IG4uaGFzTmV4dCgpOyApIHtcbiAgICAgICAgICAgIGlmICghdChuLmdldE5leHQoKS5rZXkpKSByZXR1cm47XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqIEZpbmRzIHRoZSBsZWFzdCBlbGVtZW50IGdyZWF0ZXIgdGhhbiBvciBlcXVhbCB0byBgZWxlbWAuICovICAgIGZpcnN0QWZ0ZXJPckVxdWFsKHQpIHtcbiAgICAgICAgY29uc3QgZSA9IHRoaXMuZGF0YS5nZXRJdGVyYXRvckZyb20odCk7XG4gICAgICAgIHJldHVybiBlLmhhc05leHQoKSA/IGUuZ2V0TmV4dCgpLmtleSA6IG51bGw7XG4gICAgfVxuICAgIGdldEl0ZXJhdG9yKCkge1xuICAgICAgICByZXR1cm4gbmV3IG1lKHRoaXMuZGF0YS5nZXRJdGVyYXRvcigpKTtcbiAgICB9XG4gICAgZ2V0SXRlcmF0b3JGcm9tKHQpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBtZSh0aGlzLmRhdGEuZ2V0SXRlcmF0b3JGcm9tKHQpKTtcbiAgICB9XG4gICAgLyoqIEluc2VydHMgb3IgdXBkYXRlcyBhbiBlbGVtZW50ICovICAgIGFkZCh0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNvcHkodGhpcy5kYXRhLnJlbW92ZSh0KS5pbnNlcnQodCwgITApKTtcbiAgICB9XG4gICAgLyoqIERlbGV0ZXMgYW4gZWxlbWVudCAqLyAgICBkZWxldGUodCkge1xuICAgICAgICByZXR1cm4gdGhpcy5oYXModCkgPyB0aGlzLmNvcHkodGhpcy5kYXRhLnJlbW92ZSh0KSkgOiB0aGlzO1xuICAgIH1cbiAgICBpc0VtcHR5KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5kYXRhLmlzRW1wdHkoKTtcbiAgICB9XG4gICAgdW5pb25XaXRoKHQpIHtcbiAgICAgICAgbGV0IGUgPSB0aGlzO1xuICAgICAgICAvLyBNYWtlIHN1cmUgYHJlc3VsdGAgYWx3YXlzIHJlZmVycyB0byB0aGUgbGFyZ2VyIG9uZSBvZiB0aGUgdHdvIHNldHMuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGUuc2l6ZSA8IHQuc2l6ZSAmJiAoZSA9IHQsIHQgPSB0aGlzKSwgdC5mb3JFYWNoKCh0ID0+IHtcbiAgICAgICAgICAgIGUgPSBlLmFkZCh0KTtcbiAgICAgICAgfSkpLCBlO1xuICAgIH1cbiAgICBpc0VxdWFsKHQpIHtcbiAgICAgICAgaWYgKCEodCBpbnN0YW5jZW9mIHdlKSkgcmV0dXJuICExO1xuICAgICAgICBpZiAodGhpcy5zaXplICE9PSB0LnNpemUpIHJldHVybiAhMTtcbiAgICAgICAgY29uc3QgZSA9IHRoaXMuZGF0YS5nZXRJdGVyYXRvcigpLCBuID0gdC5kYXRhLmdldEl0ZXJhdG9yKCk7XG4gICAgICAgIGZvciAoO2UuaGFzTmV4dCgpOyApIHtcbiAgICAgICAgICAgIGNvbnN0IHQgPSBlLmdldE5leHQoKS5rZXksIHMgPSBuLmdldE5leHQoKS5rZXk7XG4gICAgICAgICAgICBpZiAoMCAhPT0gdGhpcy5jb21wYXJhdG9yKHQsIHMpKSByZXR1cm4gITE7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuICEwO1xuICAgIH1cbiAgICB0b0FycmF5KCkge1xuICAgICAgICBjb25zdCB0ID0gW107XG4gICAgICAgIHJldHVybiB0aGlzLmZvckVhY2goKGUgPT4ge1xuICAgICAgICAgICAgdC5wdXNoKGUpO1xuICAgICAgICB9KSksIHQ7XG4gICAgfVxuICAgIHRvU3RyaW5nKCkge1xuICAgICAgICBjb25zdCB0ID0gW107XG4gICAgICAgIHJldHVybiB0aGlzLmZvckVhY2goKGUgPT4gdC5wdXNoKGUpKSksIFwiU29ydGVkU2V0KFwiICsgdC50b1N0cmluZygpICsgXCIpXCI7XG4gICAgfVxuICAgIGNvcHkodCkge1xuICAgICAgICBjb25zdCBlID0gbmV3IHdlKHRoaXMuY29tcGFyYXRvcik7XG4gICAgICAgIHJldHVybiBlLmRhdGEgPSB0LCBlO1xuICAgIH1cbn1cblxuY2xhc3MgbWUge1xuICAgIGNvbnN0cnVjdG9yKHQpIHtcbiAgICAgICAgdGhpcy5pdGVyID0gdDtcbiAgICB9XG4gICAgZ2V0TmV4dCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaXRlci5nZXROZXh0KCkua2V5O1xuICAgIH1cbiAgICBoYXNOZXh0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5pdGVyLmhhc05leHQoKTtcbiAgICB9XG59XG5cbi8qKlxuICogQ29tcGFyZXMgdHdvIHNvcnRlZCBzZXRzIGZvciBlcXVhbGl0eSB1c2luZyB0aGVpciBuYXR1cmFsIG9yZGVyaW5nLiBUaGVcbiAqIG1ldGhvZCBjb21wdXRlcyB0aGUgaW50ZXJzZWN0aW9uIGFuZCBpbnZva2VzIGBvbkFkZGAgZm9yIGV2ZXJ5IGVsZW1lbnQgdGhhdFxuICogaXMgaW4gYGFmdGVyYCBidXQgbm90IGBiZWZvcmVgLiBgb25SZW1vdmVgIGlzIGludm9rZWQgZm9yIGV2ZXJ5IGVsZW1lbnQgaW5cbiAqIGBiZWZvcmVgIGJ1dCBtaXNzaW5nIGZyb20gYGFmdGVyYC5cbiAqXG4gKiBUaGUgbWV0aG9kIGNyZWF0ZXMgYSBjb3B5IG9mIGJvdGggYGJlZm9yZWAgYW5kIGBhZnRlcmAgYW5kIHJ1bnMgaW4gTyhuIGxvZ1xuICogbiksIHdoZXJlIG4gaXMgdGhlIHNpemUgb2YgdGhlIHR3byBsaXN0cy5cbiAqXG4gKiBAcGFyYW0gYmVmb3JlIC0gVGhlIGVsZW1lbnRzIHRoYXQgZXhpc3QgaW4gdGhlIG9yaWdpbmFsIHNldC5cbiAqIEBwYXJhbSBhZnRlciAtIFRoZSBlbGVtZW50cyB0byBkaWZmIGFnYWluc3QgdGhlIG9yaWdpbmFsIHNldC5cbiAqIEBwYXJhbSBjb21wYXJhdG9yIC0gVGhlIGNvbXBhcmF0b3IgZm9yIHRoZSBlbGVtZW50cyBpbiBiZWZvcmUgYW5kIGFmdGVyLlxuICogQHBhcmFtIG9uQWRkIC0gQSBmdW5jdGlvbiB0byBpbnZva2UgZm9yIGV2ZXJ5IGVsZW1lbnQgdGhhdCBpcyBwYXJ0IG9mIGBcbiAqIGFmdGVyYCBidXQgbm90IGBiZWZvcmVgLlxuICogQHBhcmFtIG9uUmVtb3ZlIC0gQSBmdW5jdGlvbiB0byBpbnZva2UgZm9yIGV2ZXJ5IGVsZW1lbnQgdGhhdCBpcyBwYXJ0IG9mXG4gKiBgYmVmb3JlYCBidXQgbm90IGBhZnRlcmAuXG4gKi9cbi8qKlxuICogUmV0dXJucyB0aGUgbmV4dCBlbGVtZW50IGZyb20gdGhlIGl0ZXJhdG9yIG9yIGB1bmRlZmluZWRgIGlmIG5vbmUgYXZhaWxhYmxlLlxuICovXG5mdW5jdGlvbiBnZSh0KSB7XG4gICAgcmV0dXJuIHQuaGFzTmV4dCgpID8gdC5nZXROZXh0KCkgOiB2b2lkIDA7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vLyBWaXNpYmxlIGZvciB0ZXN0aW5nXG5jbGFzcyB5ZSB7XG4gICAgY29uc3RydWN0b3IodCwgZSA9IG51bGwsIG4gPSBbXSwgcyA9IFtdLCBpID0gbnVsbCwgciA9IG51bGwsIG8gPSBudWxsKSB7XG4gICAgICAgIHRoaXMucGF0aCA9IHQsIHRoaXMuY29sbGVjdGlvbkdyb3VwID0gZSwgdGhpcy5vcmRlckJ5ID0gbiwgdGhpcy5maWx0ZXJzID0gcywgdGhpcy5saW1pdCA9IGksIFxuICAgICAgICB0aGlzLnN0YXJ0QXQgPSByLCB0aGlzLmVuZEF0ID0gbywgdGhpcy5QID0gbnVsbDtcbiAgICB9XG59XG5cbi8qKlxuICogSW5pdGlhbGl6ZXMgYSBUYXJnZXQgd2l0aCBhIHBhdGggYW5kIG9wdGlvbmFsIGFkZGl0aW9uYWwgcXVlcnkgY29uc3RyYWludHMuXG4gKiBQYXRoIG11c3QgY3VycmVudGx5IGJlIGVtcHR5IGlmIHRoaXMgaXMgYSBjb2xsZWN0aW9uIGdyb3VwIHF1ZXJ5LlxuICpcbiAqIE5PVEU6IHlvdSBzaG91bGQgYWx3YXlzIGNvbnN0cnVjdCBgVGFyZ2V0YCBmcm9tIGBRdWVyeS50b1RhcmdldGAgaW5zdGVhZCBvZlxuICogdXNpbmcgdGhpcyBmYWN0b3J5IG1ldGhvZCwgYmVjYXVzZSBgUXVlcnlgIHByb3ZpZGVzIGFuIGltcGxpY2l0IGBvcmRlckJ5YFxuICogcHJvcGVydHkuXG4gKi8gZnVuY3Rpb24gcGUodCwgZSA9IG51bGwsIG4gPSBbXSwgcyA9IFtdLCBpID0gbnVsbCwgciA9IG51bGwsIG8gPSBudWxsKSB7XG4gICAgcmV0dXJuIG5ldyB5ZSh0LCBlLCBuLCBzLCBpLCByLCBvKTtcbn1cblxuZnVuY3Rpb24gSWUodCkge1xuICAgIGNvbnN0IGUgPSBLKHQpO1xuICAgIGlmIChudWxsID09PSBlLlApIHtcbiAgICAgICAgbGV0IHQgPSBlLnBhdGguY2Fub25pY2FsU3RyaW5nKCk7XG4gICAgICAgIG51bGwgIT09IGUuY29sbGVjdGlvbkdyb3VwICYmICh0ICs9IFwifGNnOlwiICsgZS5jb2xsZWN0aW9uR3JvdXApLCB0ICs9IFwifGY6XCIsIHQgKz0gZS5maWx0ZXJzLm1hcCgodCA9PiB7XG4gICAgICAgICAgICByZXR1cm4gKGUgPSB0KS5maWVsZC5jYW5vbmljYWxTdHJpbmcoKSArIGUub3AudG9TdHJpbmcoKSArIEx0KGUudmFsdWUpO1xuICAgICAgICAgICAgdmFyIGU7XG4gICAgICAgIH0pKS5qb2luKFwiLFwiKSwgdCArPSBcInxvYjpcIiwgdCArPSBlLm9yZGVyQnkubWFwKCh0ID0+IGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgICAgIC8vIFRPRE8oYi8yOTE4MzE2NSk6IE1ha2UgdGhpcyBjb2xsaXNpb24gcm9idXN0LlxuICAgICAgICAgICAgcmV0dXJuIHQuZmllbGQuY2Fub25pY2FsU3RyaW5nKCkgKyB0LmRpcjtcbiAgICAgICAgfSh0KSkpLmpvaW4oXCIsXCIpLCBTdChlLmxpbWl0KSB8fCAodCArPSBcInxsOlwiLCB0ICs9IGUubGltaXQpLCBlLnN0YXJ0QXQgJiYgKHQgKz0gXCJ8bGI6XCIsIFxuICAgICAgICB0ICs9IGUuc3RhcnRBdC5pbmNsdXNpdmUgPyBcImI6XCIgOiBcImE6XCIsIHQgKz0gZS5zdGFydEF0LnBvc2l0aW9uLm1hcCgodCA9PiBMdCh0KSkpLmpvaW4oXCIsXCIpKSwgXG4gICAgICAgIGUuZW5kQXQgJiYgKHQgKz0gXCJ8dWI6XCIsIHQgKz0gZS5lbmRBdC5pbmNsdXNpdmUgPyBcImE6XCIgOiBcImI6XCIsIHQgKz0gZS5lbmRBdC5wb3NpdGlvbi5tYXAoKHQgPT4gTHQodCkpKS5qb2luKFwiLFwiKSksIFxuICAgICAgICBlLlAgPSB0O1xuICAgIH1cbiAgICByZXR1cm4gZS5QO1xufVxuXG5mdW5jdGlvbiBUZSh0KSB7XG4gICAgbGV0IGUgPSB0LnBhdGguY2Fub25pY2FsU3RyaW5nKCk7XG4gICAgcmV0dXJuIG51bGwgIT09IHQuY29sbGVjdGlvbkdyb3VwICYmIChlICs9IFwiIGNvbGxlY3Rpb25Hcm91cD1cIiArIHQuY29sbGVjdGlvbkdyb3VwKSwgXG4gICAgdC5maWx0ZXJzLmxlbmd0aCA+IDAgJiYgKGUgKz0gYCwgZmlsdGVyczogWyR7dC5maWx0ZXJzLm1hcCgodCA9PiB7XG4gICAgICAgIHJldHVybiBgJHsoZSA9IHQpLmZpZWxkLmNhbm9uaWNhbFN0cmluZygpfSAke2Uub3B9ICR7THQoZS52YWx1ZSl9YDtcbiAgICAgICAgLyoqIFJldHVybnMgYSBkZWJ1ZyBkZXNjcmlwdGlvbiBmb3IgYGZpbHRlcmAuICovXG4gICAgICAgIHZhciBlO1xuICAgICAgICAvKiogRmlsdGVyIHRoYXQgbWF0Y2hlcyBvbiBrZXkgZmllbGRzIChpLmUuICdfX25hbWVfXycpLiAqLyAgICB9KSkuam9pbihcIiwgXCIpfV1gKSwgXG4gICAgU3QodC5saW1pdCkgfHwgKGUgKz0gXCIsIGxpbWl0OiBcIiArIHQubGltaXQpLCB0Lm9yZGVyQnkubGVuZ3RoID4gMCAmJiAoZSArPSBgLCBvcmRlckJ5OiBbJHt0Lm9yZGVyQnkubWFwKCh0ID0+IGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgcmV0dXJuIGAke3QuZmllbGQuY2Fub25pY2FsU3RyaW5nKCl9ICgke3QuZGlyfSlgO1xuICAgIH0odCkpKS5qb2luKFwiLCBcIil9XWApLCB0LnN0YXJ0QXQgJiYgKGUgKz0gXCIsIHN0YXJ0QXQ6IFwiLCBlICs9IHQuc3RhcnRBdC5pbmNsdXNpdmUgPyBcImI6XCIgOiBcImE6XCIsIFxuICAgIGUgKz0gdC5zdGFydEF0LnBvc2l0aW9uLm1hcCgodCA9PiBMdCh0KSkpLmpvaW4oXCIsXCIpKSwgdC5lbmRBdCAmJiAoZSArPSBcIiwgZW5kQXQ6IFwiLCBcbiAgICBlICs9IHQuZW5kQXQuaW5jbHVzaXZlID8gXCJhOlwiIDogXCJiOlwiLCBlICs9IHQuZW5kQXQucG9zaXRpb24ubWFwKCh0ID0+IEx0KHQpKSkuam9pbihcIixcIikpLCBcbiAgICBgVGFyZ2V0KCR7ZX0pYDtcbn1cblxuZnVuY3Rpb24gRWUodCwgZSkge1xuICAgIGlmICh0LmxpbWl0ICE9PSBlLmxpbWl0KSByZXR1cm4gITE7XG4gICAgaWYgKHQub3JkZXJCeS5sZW5ndGggIT09IGUub3JkZXJCeS5sZW5ndGgpIHJldHVybiAhMTtcbiAgICBmb3IgKGxldCBuID0gMDsgbiA8IHQub3JkZXJCeS5sZW5ndGg7IG4rKykgaWYgKCEkZSh0Lm9yZGVyQnlbbl0sIGUub3JkZXJCeVtuXSkpIHJldHVybiAhMTtcbiAgICBpZiAodC5maWx0ZXJzLmxlbmd0aCAhPT0gZS5maWx0ZXJzLmxlbmd0aCkgcmV0dXJuICExO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdC5maWx0ZXJzLmxlbmd0aDsgaSsrKSBpZiAobiA9IHQuZmlsdGVyc1tpXSwgcyA9IGUuZmlsdGVyc1tpXSwgXG4gICAgbi5vcCAhPT0gcy5vcCB8fCAhbi5maWVsZC5pc0VxdWFsKHMuZmllbGQpIHx8ICFPdChuLnZhbHVlLCBzLnZhbHVlKSkgcmV0dXJuICExO1xuICAgIHZhciBuLCBzO1xuICAgIHJldHVybiB0LmNvbGxlY3Rpb25Hcm91cCA9PT0gZS5jb2xsZWN0aW9uR3JvdXAgJiYgKCEhdC5wYXRoLmlzRXF1YWwoZS5wYXRoKSAmJiAoISFMZSh0LnN0YXJ0QXQsIGUuc3RhcnRBdCkgJiYgTGUodC5lbmRBdCwgZS5lbmRBdCkpKTtcbn1cblxuZnVuY3Rpb24gQWUodCkge1xuICAgIHJldHVybiB4dC5pc0RvY3VtZW50S2V5KHQucGF0aCkgJiYgbnVsbCA9PT0gdC5jb2xsZWN0aW9uR3JvdXAgJiYgMCA9PT0gdC5maWx0ZXJzLmxlbmd0aDtcbn1cblxuLyoqIFJldHVybnMgdGhlIGZpZWxkIGZpbHRlcnMgdGhhdCB0YXJnZXQgdGhlIGdpdmVuIGZpZWxkIHBhdGguICovIGZ1bmN0aW9uIFJlKHQsIGUpIHtcbiAgICByZXR1cm4gdC5maWx0ZXJzLmZpbHRlcigodCA9PiB0IGluc3RhbmNlb2YgVmUgJiYgdC5maWVsZC5pc0VxdWFsKGUpKSk7XG59XG5cbi8qKlxuICogUmV0dXJucyB0aGUgdmFsdWVzIHRoYXQgYXJlIHVzZWQgaW4gQVJSQVlfQ09OVEFJTlMgb3IgQVJSQVlfQ09OVEFJTlNfQU5ZXG4gKiBmaWx0ZXJzLiBSZXR1cm5zIGBudWxsYCBpZiB0aGVyZSBhcmUgbm8gc3VjaCBmaWx0ZXJzLlxuICovXG4vKipcbiAqIFJldHVybnMgdGhlIHZhbHVlIHRvIHVzZSBhcyB0aGUgbG93ZXIgYm91bmQgZm9yIGFzY2VuZGluZyBpbmRleCBzZWdtZW50IGF0XG4gKiB0aGUgcHJvdmlkZWQgYGZpZWxkUGF0aGAgKG9yIHRoZSB1cHBlciBib3VuZCBmb3IgYW4gZGVzY2VuZGluZyBzZWdtZW50KS5cbiAqL1xuZnVuY3Rpb24gYmUodCwgZSwgbikge1xuICAgIGxldCBzID0ga3QsIGkgPSAhMDtcbiAgICAvLyBQcm9jZXNzIGFsbCBmaWx0ZXJzIHRvIGZpbmQgYSB2YWx1ZSBmb3IgdGhlIGN1cnJlbnQgZmllbGQgc2VnbWVudFxuICAgIGZvciAoY29uc3QgbiBvZiBSZSh0LCBlKSkge1xuICAgICAgICBsZXQgdCA9IGt0LCBlID0gITA7XG4gICAgICAgIHN3aXRjaCAobi5vcCkge1xuICAgICAgICAgIGNhc2UgXCI8XCIgLyogTEVTU19USEFOICovIDpcbiAgICAgICAgICBjYXNlIFwiPD1cIiAvKiBMRVNTX1RIQU5fT1JfRVFVQUwgKi8gOlxuICAgICAgICAgICAgdCA9IEp0KG4udmFsdWUpO1xuICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICBjYXNlIFwiPT1cIiAvKiBFUVVBTCAqLyA6XG4gICAgICAgICAgY2FzZSBcImluXCIgLyogSU4gKi8gOlxuICAgICAgICAgIGNhc2UgXCI+PVwiIC8qIEdSRUFURVJfVEhBTl9PUl9FUVVBTCAqLyA6XG4gICAgICAgICAgICB0ID0gbi52YWx1ZTtcbiAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgY2FzZSBcIj5cIiAvKiBHUkVBVEVSX1RIQU4gKi8gOlxuICAgICAgICAgICAgdCA9IG4udmFsdWUsIGUgPSAhMTtcbiAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgY2FzZSBcIiE9XCIgLyogTk9UX0VRVUFMICovIDpcbiAgICAgICAgICBjYXNlIFwibm90LWluXCIgLyogTk9UX0lOICovIDpcbiAgICAgICAgICAgIHQgPSBrdDtcbiAvLyBSZW1haW5pbmcgZmlsdGVycyBjYW5ub3QgYmUgdXNlZCBhcyBsb3dlciBib3VuZHMuXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICBYdCh7XG4gICAgICAgICAgICB2YWx1ZTogcyxcbiAgICAgICAgICAgIGluY2x1c2l2ZTogaVxuICAgICAgICB9LCB7XG4gICAgICAgICAgICB2YWx1ZTogdCxcbiAgICAgICAgICAgIGluY2x1c2l2ZTogZVxuICAgICAgICB9KSA8IDAgJiYgKHMgPSB0LCBpID0gZSk7XG4gICAgfVxuICAgIC8vIElmIHRoZXJlIGlzIGFuIGFkZGl0aW9uYWwgYm91bmQsIGNvbXBhcmUgdGhlIHZhbHVlcyBhZ2FpbnN0IHRoZSBleGlzdGluZ1xuICAgIC8vIHJhbmdlIHRvIHNlZSBpZiB3ZSBjYW4gbmFycm93IHRoZSBzY29wZS5cbiAgICAgICAgaWYgKG51bGwgIT09IG4pIGZvciAobGV0IHIgPSAwOyByIDwgdC5vcmRlckJ5Lmxlbmd0aDsgKytyKSB7XG4gICAgICAgIGlmICh0Lm9yZGVyQnlbcl0uZmllbGQuaXNFcXVhbChlKSkge1xuICAgICAgICAgICAgY29uc3QgdCA9IG4ucG9zaXRpb25bcl07XG4gICAgICAgICAgICBYdCh7XG4gICAgICAgICAgICAgICAgdmFsdWU6IHMsXG4gICAgICAgICAgICAgICAgaW5jbHVzaXZlOiBpXG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgdmFsdWU6IHQsXG4gICAgICAgICAgICAgICAgaW5jbHVzaXZlOiBuLmluY2x1c2l2ZVxuICAgICAgICAgICAgfSkgPCAwICYmIChzID0gdCwgaSA9IG4uaW5jbHVzaXZlKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiB7XG4gICAgICAgIHZhbHVlOiBzLFxuICAgICAgICBpbmNsdXNpdmU6IGlcbiAgICB9O1xufVxuXG4vKipcbiAqIFJldHVybnMgdGhlIHZhbHVlIHRvIHVzZSBhcyB0aGUgdXBwZXIgYm91bmQgZm9yIGFzY2VuZGluZyBpbmRleCBzZWdtZW50IGF0XG4gKiB0aGUgcHJvdmlkZWQgYGZpZWxkUGF0aGAgKG9yIHRoZSBsb3dlciBib3VuZCBmb3IgYSBkZXNjZW5kaW5nIHNlZ21lbnQpLlxuICovIGZ1bmN0aW9uIFBlKHQsIGUsIG4pIHtcbiAgICBsZXQgcyA9IE50LCBpID0gITA7XG4gICAgLy8gUHJvY2VzcyBhbGwgZmlsdGVycyB0byBmaW5kIGEgdmFsdWUgZm9yIHRoZSBjdXJyZW50IGZpZWxkIHNlZ21lbnRcbiAgICBmb3IgKGNvbnN0IG4gb2YgUmUodCwgZSkpIHtcbiAgICAgICAgbGV0IHQgPSBOdCwgZSA9ICEwO1xuICAgICAgICBzd2l0Y2ggKG4ub3ApIHtcbiAgICAgICAgICBjYXNlIFwiPj1cIiAvKiBHUkVBVEVSX1RIQU5fT1JfRVFVQUwgKi8gOlxuICAgICAgICAgIGNhc2UgXCI+XCIgLyogR1JFQVRFUl9USEFOICovIDpcbiAgICAgICAgICAgIHQgPSBZdChuLnZhbHVlKSwgZSA9ICExO1xuICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICBjYXNlIFwiPT1cIiAvKiBFUVVBTCAqLyA6XG4gICAgICAgICAgY2FzZSBcImluXCIgLyogSU4gKi8gOlxuICAgICAgICAgIGNhc2UgXCI8PVwiIC8qIExFU1NfVEhBTl9PUl9FUVVBTCAqLyA6XG4gICAgICAgICAgICB0ID0gbi52YWx1ZTtcbiAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgY2FzZSBcIjxcIiAvKiBMRVNTX1RIQU4gKi8gOlxuICAgICAgICAgICAgdCA9IG4udmFsdWUsIGUgPSAhMTtcbiAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgY2FzZSBcIiE9XCIgLyogTk9UX0VRVUFMICovIDpcbiAgICAgICAgICBjYXNlIFwibm90LWluXCIgLyogTk9UX0lOICovIDpcbiAgICAgICAgICAgIHQgPSBOdDtcbiAvLyBSZW1haW5pbmcgZmlsdGVycyBjYW5ub3QgYmUgdXNlZCBhcyB1cHBlciBib3VuZHMuXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICBadCh7XG4gICAgICAgICAgICB2YWx1ZTogcyxcbiAgICAgICAgICAgIGluY2x1c2l2ZTogaVxuICAgICAgICB9LCB7XG4gICAgICAgICAgICB2YWx1ZTogdCxcbiAgICAgICAgICAgIGluY2x1c2l2ZTogZVxuICAgICAgICB9KSA+IDAgJiYgKHMgPSB0LCBpID0gZSk7XG4gICAgfVxuICAgIC8vIElmIHRoZXJlIGlzIGFuIGFkZGl0aW9uYWwgYm91bmQsIGNvbXBhcmUgdGhlIHZhbHVlcyBhZ2FpbnN0IHRoZSBleGlzdGluZ1xuICAgIC8vIHJhbmdlIHRvIHNlZSBpZiB3ZSBjYW4gbmFycm93IHRoZSBzY29wZS5cbiAgICAgICAgaWYgKG51bGwgIT09IG4pIGZvciAobGV0IHIgPSAwOyByIDwgdC5vcmRlckJ5Lmxlbmd0aDsgKytyKSB7XG4gICAgICAgIGlmICh0Lm9yZGVyQnlbcl0uZmllbGQuaXNFcXVhbChlKSkge1xuICAgICAgICAgICAgY29uc3QgdCA9IG4ucG9zaXRpb25bcl07XG4gICAgICAgICAgICBadCh7XG4gICAgICAgICAgICAgICAgdmFsdWU6IHMsXG4gICAgICAgICAgICAgICAgaW5jbHVzaXZlOiBpXG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgdmFsdWU6IHQsXG4gICAgICAgICAgICAgICAgaW5jbHVzaXZlOiBuLmluY2x1c2l2ZVxuICAgICAgICAgICAgfSkgPiAwICYmIChzID0gdCwgaSA9IG4uaW5jbHVzaXZlKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiB7XG4gICAgICAgIHZhbHVlOiBzLFxuICAgICAgICBpbmNsdXNpdmU6IGlcbiAgICB9O1xufVxuXG4vKiogUmV0dXJucyB0aGUgbnVtYmVyIG9mIHNlZ21lbnRzIG9mIGEgcGVyZmVjdCBpbmRleCBmb3IgdGhpcyB0YXJnZXQuICovIGNsYXNzIFZlIGV4dGVuZHMgY2xhc3Mge30ge1xuICAgIGNvbnN0cnVjdG9yKHQsIGUsIG4pIHtcbiAgICAgICAgc3VwZXIoKSwgdGhpcy5maWVsZCA9IHQsIHRoaXMub3AgPSBlLCB0aGlzLnZhbHVlID0gbjtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIGZpbHRlciBiYXNlZCBvbiB0aGUgcHJvdmlkZWQgYXJndW1lbnRzLlxuICAgICAqLyAgICBzdGF0aWMgY3JlYXRlKHQsIGUsIG4pIHtcbiAgICAgICAgcmV0dXJuIHQuaXNLZXlGaWVsZCgpID8gXCJpblwiIC8qIElOICovID09PSBlIHx8IFwibm90LWluXCIgLyogTk9UX0lOICovID09PSBlID8gdGhpcy5WKHQsIGUsIG4pIDogbmV3IHZlKHQsIGUsIG4pIDogXCJhcnJheS1jb250YWluc1wiIC8qIEFSUkFZX0NPTlRBSU5TICovID09PSBlID8gbmV3IHhlKHQsIG4pIDogXCJpblwiIC8qIElOICovID09PSBlID8gbmV3IE5lKHQsIG4pIDogXCJub3QtaW5cIiAvKiBOT1RfSU4gKi8gPT09IGUgPyBuZXcga2UodCwgbikgOiBcImFycmF5LWNvbnRhaW5zLWFueVwiIC8qIEFSUkFZX0NPTlRBSU5TX0FOWSAqLyA9PT0gZSA/IG5ldyBNZSh0LCBuKSA6IG5ldyBWZSh0LCBlLCBuKTtcbiAgICB9XG4gICAgc3RhdGljIFYodCwgZSwgbikge1xuICAgICAgICByZXR1cm4gXCJpblwiIC8qIElOICovID09PSBlID8gbmV3IFNlKHQsIG4pIDogbmV3IERlKHQsIG4pO1xuICAgIH1cbiAgICBtYXRjaGVzKHQpIHtcbiAgICAgICAgY29uc3QgZSA9IHQuZGF0YS5maWVsZCh0aGlzLmZpZWxkKTtcbiAgICAgICAgLy8gVHlwZXMgZG8gbm90IGhhdmUgdG8gbWF0Y2ggaW4gTk9UX0VRVUFMIGZpbHRlcnMuXG4gICAgICAgICAgICAgICAgcmV0dXJuIFwiIT1cIiAvKiBOT1RfRVFVQUwgKi8gPT09IHRoaXMub3AgPyBudWxsICE9PSBlICYmIHRoaXMudigkdChlLCB0aGlzLnZhbHVlKSkgOiBudWxsICE9PSBlICYmIE10KHRoaXMudmFsdWUpID09PSBNdChlKSAmJiB0aGlzLnYoJHQoZSwgdGhpcy52YWx1ZSkpO1xuICAgICAgICAvLyBPbmx5IGNvbXBhcmUgdHlwZXMgd2l0aCBtYXRjaGluZyBiYWNrZW5kIG9yZGVyIChzdWNoIGFzIGRvdWJsZSBhbmQgaW50KS5cbiAgICAgICAgfVxuICAgIHYodCkge1xuICAgICAgICBzd2l0Y2ggKHRoaXMub3ApIHtcbiAgICAgICAgICBjYXNlIFwiPFwiIC8qIExFU1NfVEhBTiAqLyA6XG4gICAgICAgICAgICByZXR1cm4gdCA8IDA7XG5cbiAgICAgICAgICBjYXNlIFwiPD1cIiAvKiBMRVNTX1RIQU5fT1JfRVFVQUwgKi8gOlxuICAgICAgICAgICAgcmV0dXJuIHQgPD0gMDtcblxuICAgICAgICAgIGNhc2UgXCI9PVwiIC8qIEVRVUFMICovIDpcbiAgICAgICAgICAgIHJldHVybiAwID09PSB0O1xuXG4gICAgICAgICAgY2FzZSBcIiE9XCIgLyogTk9UX0VRVUFMICovIDpcbiAgICAgICAgICAgIHJldHVybiAwICE9PSB0O1xuXG4gICAgICAgICAgY2FzZSBcIj5cIiAvKiBHUkVBVEVSX1RIQU4gKi8gOlxuICAgICAgICAgICAgcmV0dXJuIHQgPiAwO1xuXG4gICAgICAgICAgY2FzZSBcIj49XCIgLyogR1JFQVRFUl9USEFOX09SX0VRVUFMICovIDpcbiAgICAgICAgICAgIHJldHVybiB0ID49IDA7XG5cbiAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgcmV0dXJuIEwoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBTKCkge1xuICAgICAgICByZXR1cm4gWyBcIjxcIiAvKiBMRVNTX1RIQU4gKi8gLCBcIjw9XCIgLyogTEVTU19USEFOX09SX0VRVUFMICovICwgXCI+XCIgLyogR1JFQVRFUl9USEFOICovICwgXCI+PVwiIC8qIEdSRUFURVJfVEhBTl9PUl9FUVVBTCAqLyAsIFwiIT1cIiAvKiBOT1RfRVFVQUwgKi8gLCBcIm5vdC1pblwiIC8qIE5PVF9JTiAqLyBdLmluZGV4T2YodGhpcy5vcCkgPj0gMDtcbiAgICB9XG59XG5cbmNsYXNzIHZlIGV4dGVuZHMgVmUge1xuICAgIGNvbnN0cnVjdG9yKHQsIGUsIG4pIHtcbiAgICAgICAgc3VwZXIodCwgZSwgbiksIHRoaXMua2V5ID0geHQuZnJvbU5hbWUobi5yZWZlcmVuY2VWYWx1ZSk7XG4gICAgfVxuICAgIG1hdGNoZXModCkge1xuICAgICAgICBjb25zdCBlID0geHQuY29tcGFyYXRvcih0LmtleSwgdGhpcy5rZXkpO1xuICAgICAgICByZXR1cm4gdGhpcy52KGUpO1xuICAgIH1cbn1cblxuLyoqIEZpbHRlciB0aGF0IG1hdGNoZXMgb24ga2V5IGZpZWxkcyB3aXRoaW4gYW4gYXJyYXkuICovIGNsYXNzIFNlIGV4dGVuZHMgVmUge1xuICAgIGNvbnN0cnVjdG9yKHQsIGUpIHtcbiAgICAgICAgc3VwZXIodCwgXCJpblwiIC8qIElOICovICwgZSksIHRoaXMua2V5cyA9IENlKFwiaW5cIiAvKiBJTiAqLyAsIGUpO1xuICAgIH1cbiAgICBtYXRjaGVzKHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMua2V5cy5zb21lKChlID0+IGUuaXNFcXVhbCh0LmtleSkpKTtcbiAgICB9XG59XG5cbi8qKiBGaWx0ZXIgdGhhdCBtYXRjaGVzIG9uIGtleSBmaWVsZHMgbm90IHByZXNlbnQgd2l0aGluIGFuIGFycmF5LiAqLyBjbGFzcyBEZSBleHRlbmRzIFZlIHtcbiAgICBjb25zdHJ1Y3Rvcih0LCBlKSB7XG4gICAgICAgIHN1cGVyKHQsIFwibm90LWluXCIgLyogTk9UX0lOICovICwgZSksIHRoaXMua2V5cyA9IENlKFwibm90LWluXCIgLyogTk9UX0lOICovICwgZSk7XG4gICAgfVxuICAgIG1hdGNoZXModCkge1xuICAgICAgICByZXR1cm4gIXRoaXMua2V5cy5zb21lKChlID0+IGUuaXNFcXVhbCh0LmtleSkpKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIENlKHQsIGUpIHtcbiAgICB2YXIgbjtcbiAgICByZXR1cm4gKChudWxsID09PSAobiA9IGUuYXJyYXlWYWx1ZSkgfHwgdm9pZCAwID09PSBuID8gdm9pZCAwIDogbi52YWx1ZXMpIHx8IFtdKS5tYXAoKHQgPT4geHQuZnJvbU5hbWUodC5yZWZlcmVuY2VWYWx1ZSkpKTtcbn1cblxuLyoqIEEgRmlsdGVyIHRoYXQgaW1wbGVtZW50cyB0aGUgYXJyYXktY29udGFpbnMgb3BlcmF0b3IuICovIGNsYXNzIHhlIGV4dGVuZHMgVmUge1xuICAgIGNvbnN0cnVjdG9yKHQsIGUpIHtcbiAgICAgICAgc3VwZXIodCwgXCJhcnJheS1jb250YWluc1wiIC8qIEFSUkFZX0NPTlRBSU5TICovICwgZSk7XG4gICAgfVxuICAgIG1hdGNoZXModCkge1xuICAgICAgICBjb25zdCBlID0gdC5kYXRhLmZpZWxkKHRoaXMuZmllbGQpO1xuICAgICAgICByZXR1cm4gR3QoZSkgJiYgRnQoZS5hcnJheVZhbHVlLCB0aGlzLnZhbHVlKTtcbiAgICB9XG59XG5cbi8qKiBBIEZpbHRlciB0aGF0IGltcGxlbWVudHMgdGhlIElOIG9wZXJhdG9yLiAqLyBjbGFzcyBOZSBleHRlbmRzIFZlIHtcbiAgICBjb25zdHJ1Y3Rvcih0LCBlKSB7XG4gICAgICAgIHN1cGVyKHQsIFwiaW5cIiAvKiBJTiAqLyAsIGUpO1xuICAgIH1cbiAgICBtYXRjaGVzKHQpIHtcbiAgICAgICAgY29uc3QgZSA9IHQuZGF0YS5maWVsZCh0aGlzLmZpZWxkKTtcbiAgICAgICAgcmV0dXJuIG51bGwgIT09IGUgJiYgRnQodGhpcy52YWx1ZS5hcnJheVZhbHVlLCBlKTtcbiAgICB9XG59XG5cbi8qKiBBIEZpbHRlciB0aGF0IGltcGxlbWVudHMgdGhlIG5vdC1pbiBvcGVyYXRvci4gKi8gY2xhc3Mga2UgZXh0ZW5kcyBWZSB7XG4gICAgY29uc3RydWN0b3IodCwgZSkge1xuICAgICAgICBzdXBlcih0LCBcIm5vdC1pblwiIC8qIE5PVF9JTiAqLyAsIGUpO1xuICAgIH1cbiAgICBtYXRjaGVzKHQpIHtcbiAgICAgICAgaWYgKEZ0KHRoaXMudmFsdWUuYXJyYXlWYWx1ZSwge1xuICAgICAgICAgICAgbnVsbFZhbHVlOiBcIk5VTExfVkFMVUVcIlxuICAgICAgICB9KSkgcmV0dXJuICExO1xuICAgICAgICBjb25zdCBlID0gdC5kYXRhLmZpZWxkKHRoaXMuZmllbGQpO1xuICAgICAgICByZXR1cm4gbnVsbCAhPT0gZSAmJiAhRnQodGhpcy52YWx1ZS5hcnJheVZhbHVlLCBlKTtcbiAgICB9XG59XG5cbi8qKiBBIEZpbHRlciB0aGF0IGltcGxlbWVudHMgdGhlIGFycmF5LWNvbnRhaW5zLWFueSBvcGVyYXRvci4gKi8gY2xhc3MgTWUgZXh0ZW5kcyBWZSB7XG4gICAgY29uc3RydWN0b3IodCwgZSkge1xuICAgICAgICBzdXBlcih0LCBcImFycmF5LWNvbnRhaW5zLWFueVwiIC8qIEFSUkFZX0NPTlRBSU5TX0FOWSAqLyAsIGUpO1xuICAgIH1cbiAgICBtYXRjaGVzKHQpIHtcbiAgICAgICAgY29uc3QgZSA9IHQuZGF0YS5maWVsZCh0aGlzLmZpZWxkKTtcbiAgICAgICAgcmV0dXJuICEoIUd0KGUpIHx8ICFlLmFycmF5VmFsdWUudmFsdWVzKSAmJiBlLmFycmF5VmFsdWUudmFsdWVzLnNvbWUoKHQgPT4gRnQodGhpcy52YWx1ZS5hcnJheVZhbHVlLCB0KSkpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBSZXByZXNlbnRzIGEgYm91bmQgb2YgYSBxdWVyeS5cbiAqXG4gKiBUaGUgYm91bmQgaXMgc3BlY2lmaWVkIHdpdGggdGhlIGdpdmVuIGNvbXBvbmVudHMgcmVwcmVzZW50aW5nIGEgcG9zaXRpb24gYW5kXG4gKiB3aGV0aGVyIGl0J3MganVzdCBiZWZvcmUgb3IganVzdCBhZnRlciB0aGUgcG9zaXRpb24gKHJlbGF0aXZlIHRvIHdoYXRldmVyIHRoZVxuICogcXVlcnkgb3JkZXIgaXMpLlxuICpcbiAqIFRoZSBwb3NpdGlvbiByZXByZXNlbnRzIGEgbG9naWNhbCBpbmRleCBwb3NpdGlvbiBmb3IgYSBxdWVyeS4gSXQncyBhIHByZWZpeFxuICogb2YgdmFsdWVzIGZvciB0aGUgKHBvdGVudGlhbGx5IGltcGxpY2l0KSBvcmRlciBieSBjbGF1c2VzIG9mIGEgcXVlcnkuXG4gKlxuICogQm91bmQgcHJvdmlkZXMgYSBmdW5jdGlvbiB0byBkZXRlcm1pbmUgd2hldGhlciBhIGRvY3VtZW50IGNvbWVzIGJlZm9yZSBvclxuICogYWZ0ZXIgYSBib3VuZC4gVGhpcyBpcyBpbmZsdWVuY2VkIGJ5IHdoZXRoZXIgdGhlIHBvc2l0aW9uIGlzIGp1c3QgYmVmb3JlIG9yXG4gKiBqdXN0IGFmdGVyIHRoZSBwcm92aWRlZCB2YWx1ZXMuXG4gKi8gY2xhc3MgT2Uge1xuICAgIGNvbnN0cnVjdG9yKHQsIGUpIHtcbiAgICAgICAgdGhpcy5wb3NpdGlvbiA9IHQsIHRoaXMuaW5jbHVzaXZlID0gZTtcbiAgICB9XG59XG5cbi8qKlxuICogQW4gb3JkZXJpbmcgb24gYSBmaWVsZCwgaW4gc29tZSBEaXJlY3Rpb24uIERpcmVjdGlvbiBkZWZhdWx0cyB0byBBU0NFTkRJTkcuXG4gKi8gY2xhc3MgRmUge1xuICAgIGNvbnN0cnVjdG9yKHQsIGUgPSBcImFzY1wiIC8qIEFTQ0VORElORyAqLykge1xuICAgICAgICB0aGlzLmZpZWxkID0gdCwgdGhpcy5kaXIgPSBlO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gJGUodCwgZSkge1xuICAgIHJldHVybiB0LmRpciA9PT0gZS5kaXIgJiYgdC5maWVsZC5pc0VxdWFsKGUuZmllbGQpO1xufVxuXG5mdW5jdGlvbiBCZSh0LCBlLCBuKSB7XG4gICAgbGV0IHMgPSAwO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdC5wb3NpdGlvbi5sZW5ndGg7IGkrKykge1xuICAgICAgICBjb25zdCByID0gZVtpXSwgbyA9IHQucG9zaXRpb25baV07XG4gICAgICAgIGlmIChyLmZpZWxkLmlzS2V5RmllbGQoKSkgcyA9IHh0LmNvbXBhcmF0b3IoeHQuZnJvbU5hbWUoby5yZWZlcmVuY2VWYWx1ZSksIG4ua2V5KTsgZWxzZSB7XG4gICAgICAgICAgICBzID0gJHQobywgbi5kYXRhLmZpZWxkKHIuZmllbGQpKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoXCJkZXNjXCIgLyogREVTQ0VORElORyAqLyA9PT0gci5kaXIgJiYgKHMgKj0gLTEpLCAwICE9PSBzKSBicmVhaztcbiAgICB9XG4gICAgcmV0dXJuIHM7XG59XG5cbi8qKlxuICogUmV0dXJucyB0cnVlIGlmIGEgZG9jdW1lbnQgc29ydHMgYWZ0ZXIgYSBib3VuZCB1c2luZyB0aGUgcHJvdmlkZWQgc29ydFxuICogb3JkZXIuXG4gKi8gZnVuY3Rpb24gTGUodCwgZSkge1xuICAgIGlmIChudWxsID09PSB0KSByZXR1cm4gbnVsbCA9PT0gZTtcbiAgICBpZiAobnVsbCA9PT0gZSkgcmV0dXJuICExO1xuICAgIGlmICh0LmluY2x1c2l2ZSAhPT0gZS5pbmNsdXNpdmUgfHwgdC5wb3NpdGlvbi5sZW5ndGggIT09IGUucG9zaXRpb24ubGVuZ3RoKSByZXR1cm4gITE7XG4gICAgZm9yIChsZXQgbiA9IDA7IG4gPCB0LnBvc2l0aW9uLmxlbmd0aDsgbisrKSB7XG4gICAgICAgIGlmICghT3QodC5wb3NpdGlvbltuXSwgZS5wb3NpdGlvbltuXSkpIHJldHVybiAhMTtcbiAgICB9XG4gICAgcmV0dXJuICEwO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBRdWVyeSBlbmNhcHN1bGF0ZXMgYWxsIHRoZSBxdWVyeSBhdHRyaWJ1dGVzIHdlIHN1cHBvcnQgaW4gdGhlIFNESy4gSXQgY2FuXG4gKiBiZSBydW4gYWdhaW5zdCB0aGUgTG9jYWxTdG9yZSwgYXMgd2VsbCBhcyBiZSBjb252ZXJ0ZWQgdG8gYSBgVGFyZ2V0YCB0b1xuICogcXVlcnkgdGhlIFJlbW90ZVN0b3JlIHJlc3VsdHMuXG4gKlxuICogVmlzaWJsZSBmb3IgdGVzdGluZy5cbiAqLyBjbGFzcyBVZSB7XG4gICAgLyoqXG4gICAgICogSW5pdGlhbGl6ZXMgYSBRdWVyeSB3aXRoIGEgcGF0aCBhbmQgb3B0aW9uYWwgYWRkaXRpb25hbCBxdWVyeSBjb25zdHJhaW50cy5cbiAgICAgKiBQYXRoIG11c3QgY3VycmVudGx5IGJlIGVtcHR5IGlmIHRoaXMgaXMgYSBjb2xsZWN0aW9uIGdyb3VwIHF1ZXJ5LlxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKHQsIGUgPSBudWxsLCBuID0gW10sIHMgPSBbXSwgaSA9IG51bGwsIHIgPSBcIkZcIiAvKiBGaXJzdCAqLyAsIG8gPSBudWxsLCB1ID0gbnVsbCkge1xuICAgICAgICB0aGlzLnBhdGggPSB0LCB0aGlzLmNvbGxlY3Rpb25Hcm91cCA9IGUsIHRoaXMuZXhwbGljaXRPcmRlckJ5ID0gbiwgdGhpcy5maWx0ZXJzID0gcywgXG4gICAgICAgIHRoaXMubGltaXQgPSBpLCB0aGlzLmxpbWl0VHlwZSA9IHIsIHRoaXMuc3RhcnRBdCA9IG8sIHRoaXMuZW5kQXQgPSB1LCB0aGlzLkQgPSBudWxsLCBcbiAgICAgICAgLy8gVGhlIGNvcnJlc3BvbmRpbmcgYFRhcmdldGAgb2YgdGhpcyBgUXVlcnlgIGluc3RhbmNlLlxuICAgICAgICB0aGlzLkMgPSBudWxsLCB0aGlzLnN0YXJ0QXQsIHRoaXMuZW5kQXQ7XG4gICAgfVxufVxuXG4vKiogQ3JlYXRlcyBhIG5ldyBRdWVyeSBpbnN0YW5jZSB3aXRoIHRoZSBvcHRpb25zIHByb3ZpZGVkLiAqLyBmdW5jdGlvbiBxZSh0LCBlLCBuLCBzLCBpLCByLCBvLCB1KSB7XG4gICAgcmV0dXJuIG5ldyBVZSh0LCBlLCBuLCBzLCBpLCByLCBvLCB1KTtcbn1cblxuLyoqIENyZWF0ZXMgYSBuZXcgUXVlcnkgZm9yIGEgcXVlcnkgdGhhdCBtYXRjaGVzIGFsbCBkb2N1bWVudHMgYXQgYHBhdGhgICovIGZ1bmN0aW9uIEtlKHQpIHtcbiAgICByZXR1cm4gbmV3IFVlKHQpO1xufVxuXG4vKipcbiAqIEhlbHBlciB0byBjb252ZXJ0IGEgY29sbGVjdGlvbiBncm91cCBxdWVyeSBpbnRvIGEgY29sbGVjdGlvbiBxdWVyeSBhdCBhXG4gKiBzcGVjaWZpYyBwYXRoLiBUaGlzIGlzIHVzZWQgd2hlbiBleGVjdXRpbmcgY29sbGVjdGlvbiBncm91cCBxdWVyaWVzLCBzaW5jZVxuICogd2UgaGF2ZSB0byBzcGxpdCB0aGUgcXVlcnkgaW50byBhIHNldCBvZiBjb2xsZWN0aW9uIHF1ZXJpZXMgYXQgbXVsdGlwbGVcbiAqIHBhdGhzLlxuICovXG4vKipcbiAqIFJldHVybnMgdHJ1ZSBpZiB0aGlzIHF1ZXJ5IGRvZXMgbm90IHNwZWNpZnkgYW55IHF1ZXJ5IGNvbnN0cmFpbnRzIHRoYXRcbiAqIGNvdWxkIHJlbW92ZSByZXN1bHRzLlxuICovXG5mdW5jdGlvbiBHZSh0KSB7XG4gICAgcmV0dXJuIDAgPT09IHQuZmlsdGVycy5sZW5ndGggJiYgbnVsbCA9PT0gdC5saW1pdCAmJiBudWxsID09IHQuc3RhcnRBdCAmJiBudWxsID09IHQuZW5kQXQgJiYgKDAgPT09IHQuZXhwbGljaXRPcmRlckJ5Lmxlbmd0aCB8fCAxID09PSB0LmV4cGxpY2l0T3JkZXJCeS5sZW5ndGggJiYgdC5leHBsaWNpdE9yZGVyQnlbMF0uZmllbGQuaXNLZXlGaWVsZCgpKTtcbn1cblxuZnVuY3Rpb24gUWUodCkge1xuICAgIHJldHVybiB0LmV4cGxpY2l0T3JkZXJCeS5sZW5ndGggPiAwID8gdC5leHBsaWNpdE9yZGVyQnlbMF0uZmllbGQgOiBudWxsO1xufVxuXG5mdW5jdGlvbiBqZSh0KSB7XG4gICAgZm9yIChjb25zdCBlIG9mIHQuZmlsdGVycykgaWYgKGUuUygpKSByZXR1cm4gZS5maWVsZDtcbiAgICByZXR1cm4gbnVsbDtcbn1cblxuLyoqXG4gKiBDaGVja3MgaWYgYW55IG9mIHRoZSBwcm92aWRlZCBPcGVyYXRvcnMgYXJlIGluY2x1ZGVkIGluIHRoZSBxdWVyeSBhbmRcbiAqIHJldHVybnMgdGhlIGZpcnN0IG9uZSB0aGF0IGlzLCBvciBudWxsIGlmIG5vbmUgYXJlLlxuICovXG4vKipcbiAqIFJldHVybnMgd2hldGhlciB0aGUgcXVlcnkgbWF0Y2hlcyBhIGNvbGxlY3Rpb24gZ3JvdXAgcmF0aGVyIHRoYW4gYSBzcGVjaWZpY1xuICogY29sbGVjdGlvbi5cbiAqL1xuZnVuY3Rpb24gV2UodCkge1xuICAgIHJldHVybiBudWxsICE9PSB0LmNvbGxlY3Rpb25Hcm91cDtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIHRoZSBpbXBsaWNpdCBvcmRlciBieSBjb25zdHJhaW50IHRoYXQgaXMgdXNlZCB0byBleGVjdXRlIHRoZSBRdWVyeSxcbiAqIHdoaWNoIGNhbiBiZSBkaWZmZXJlbnQgZnJvbSB0aGUgb3JkZXIgYnkgY29uc3RyYWludHMgdGhlIHVzZXIgcHJvdmlkZWQgKGUuZy5cbiAqIHRoZSBTREsgYW5kIGJhY2tlbmQgYWx3YXlzIG9yZGVycyBieSBgX19uYW1lX19gKS5cbiAqLyBmdW5jdGlvbiB6ZSh0KSB7XG4gICAgY29uc3QgZSA9IEsodCk7XG4gICAgaWYgKG51bGwgPT09IGUuRCkge1xuICAgICAgICBlLkQgPSBbXTtcbiAgICAgICAgY29uc3QgdCA9IGplKGUpLCBuID0gUWUoZSk7XG4gICAgICAgIGlmIChudWxsICE9PSB0ICYmIG51bGwgPT09IG4pIFxuICAgICAgICAvLyBJbiBvcmRlciB0byBpbXBsaWNpdGx5IGFkZCBrZXkgb3JkZXJpbmcsIHdlIG11c3QgYWxzbyBhZGQgdGhlXG4gICAgICAgIC8vIGluZXF1YWxpdHkgZmlsdGVyIGZpZWxkIGZvciBpdCB0byBiZSBhIHZhbGlkIHF1ZXJ5LlxuICAgICAgICAvLyBOb3RlIHRoYXQgdGhlIGRlZmF1bHQgaW5lcXVhbGl0eSBmaWVsZCBhbmQga2V5IG9yZGVyaW5nIGlzIGFzY2VuZGluZy5cbiAgICAgICAgdC5pc0tleUZpZWxkKCkgfHwgZS5ELnB1c2gobmV3IEZlKHQpKSwgZS5ELnB1c2gobmV3IEZlKG10LmtleUZpZWxkKCksIFwiYXNjXCIgLyogQVNDRU5ESU5HICovKSk7IGVsc2Uge1xuICAgICAgICAgICAgbGV0IHQgPSAhMTtcbiAgICAgICAgICAgIGZvciAoY29uc3QgbiBvZiBlLmV4cGxpY2l0T3JkZXJCeSkgZS5ELnB1c2gobiksIG4uZmllbGQuaXNLZXlGaWVsZCgpICYmICh0ID0gITApO1xuICAgICAgICAgICAgaWYgKCF0KSB7XG4gICAgICAgICAgICAgICAgLy8gVGhlIG9yZGVyIG9mIHRoZSBpbXBsaWNpdCBrZXkgb3JkZXJpbmcgYWx3YXlzIG1hdGNoZXMgdGhlIGxhc3RcbiAgICAgICAgICAgICAgICAvLyBleHBsaWNpdCBvcmRlciBieVxuICAgICAgICAgICAgICAgIGNvbnN0IHQgPSBlLmV4cGxpY2l0T3JkZXJCeS5sZW5ndGggPiAwID8gZS5leHBsaWNpdE9yZGVyQnlbZS5leHBsaWNpdE9yZGVyQnkubGVuZ3RoIC0gMV0uZGlyIDogXCJhc2NcIiAvKiBBU0NFTkRJTkcgKi87XG4gICAgICAgICAgICAgICAgZS5ELnB1c2gobmV3IEZlKG10LmtleUZpZWxkKCksIHQpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZS5EO1xufVxuXG4vKipcbiAqIENvbnZlcnRzIHRoaXMgYFF1ZXJ5YCBpbnN0YW5jZSB0byBpdCdzIGNvcnJlc3BvbmRpbmcgYFRhcmdldGAgcmVwcmVzZW50YXRpb24uXG4gKi8gZnVuY3Rpb24gSGUodCkge1xuICAgIGNvbnN0IGUgPSBLKHQpO1xuICAgIGlmICghZS5DKSBpZiAoXCJGXCIgLyogRmlyc3QgKi8gPT09IGUubGltaXRUeXBlKSBlLkMgPSBwZShlLnBhdGgsIGUuY29sbGVjdGlvbkdyb3VwLCB6ZShlKSwgZS5maWx0ZXJzLCBlLmxpbWl0LCBlLnN0YXJ0QXQsIGUuZW5kQXQpOyBlbHNlIHtcbiAgICAgICAgLy8gRmxpcCB0aGUgb3JkZXJCeSBkaXJlY3Rpb25zIHNpbmNlIHdlIHdhbnQgdGhlIGxhc3QgcmVzdWx0c1xuICAgICAgICBjb25zdCB0ID0gW107XG4gICAgICAgIGZvciAoY29uc3QgbiBvZiB6ZShlKSkge1xuICAgICAgICAgICAgY29uc3QgZSA9IFwiZGVzY1wiIC8qIERFU0NFTkRJTkcgKi8gPT09IG4uZGlyID8gXCJhc2NcIiAvKiBBU0NFTkRJTkcgKi8gOiBcImRlc2NcIiAvKiBERVNDRU5ESU5HICovO1xuICAgICAgICAgICAgdC5wdXNoKG5ldyBGZShuLmZpZWxkLCBlKSk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gV2UgbmVlZCB0byBzd2FwIHRoZSBjdXJzb3JzIHRvIG1hdGNoIHRoZSBub3ctZmxpcHBlZCBxdWVyeSBvcmRlcmluZy5cbiAgICAgICAgICAgICAgICBjb25zdCBuID0gZS5lbmRBdCA/IG5ldyBPZShlLmVuZEF0LnBvc2l0aW9uLCBlLmVuZEF0LmluY2x1c2l2ZSkgOiBudWxsLCBzID0gZS5zdGFydEF0ID8gbmV3IE9lKGUuc3RhcnRBdC5wb3NpdGlvbiwgZS5zdGFydEF0LmluY2x1c2l2ZSkgOiBudWxsO1xuICAgICAgICAvLyBOb3cgcmV0dXJuIGFzIGEgTGltaXRUeXBlLkZpcnN0IHF1ZXJ5LlxuICAgICAgICBlLkMgPSBwZShlLnBhdGgsIGUuY29sbGVjdGlvbkdyb3VwLCB0LCBlLmZpbHRlcnMsIGUubGltaXQsIG4sIHMpO1xuICAgIH1cbiAgICByZXR1cm4gZS5DO1xufVxuXG5mdW5jdGlvbiBKZSh0LCBlLCBuKSB7XG4gICAgcmV0dXJuIG5ldyBVZSh0LnBhdGgsIHQuY29sbGVjdGlvbkdyb3VwLCB0LmV4cGxpY2l0T3JkZXJCeS5zbGljZSgpLCB0LmZpbHRlcnMuc2xpY2UoKSwgZSwgbiwgdC5zdGFydEF0LCB0LmVuZEF0KTtcbn1cblxuZnVuY3Rpb24gWWUodCwgZSkge1xuICAgIHJldHVybiBFZShIZSh0KSwgSGUoZSkpICYmIHQubGltaXRUeXBlID09PSBlLmxpbWl0VHlwZTtcbn1cblxuLy8gVE9ETyhiLzI5MTgzMTY1KTogVGhpcyBpcyB1c2VkIHRvIGdldCBhIHVuaXF1ZSBzdHJpbmcgZnJvbSBhIHF1ZXJ5IHRvLCBmb3Jcbi8vIGV4YW1wbGUsIHVzZSBhcyBhIGRpY3Rpb25hcnkga2V5LCBidXQgdGhlIGltcGxlbWVudGF0aW9uIGlzIHN1YmplY3QgdG9cbi8vIGNvbGxpc2lvbnMuIE1ha2UgaXQgY29sbGlzaW9uLWZyZWUuXG5mdW5jdGlvbiBYZSh0KSB7XG4gICAgcmV0dXJuIGAke0llKEhlKHQpKX18bHQ6JHt0LmxpbWl0VHlwZX1gO1xufVxuXG5mdW5jdGlvbiBaZSh0KSB7XG4gICAgcmV0dXJuIGBRdWVyeSh0YXJnZXQ9JHtUZShIZSh0KSl9OyBsaW1pdFR5cGU9JHt0LmxpbWl0VHlwZX0pYDtcbn1cblxuLyoqIFJldHVybnMgd2hldGhlciBgZG9jYCBtYXRjaGVzIHRoZSBjb25zdHJhaW50cyBvZiBgcXVlcnlgLiAqLyBmdW5jdGlvbiB0bih0LCBlKSB7XG4gICAgcmV0dXJuIGUuaXNGb3VuZERvY3VtZW50KCkgJiYgZnVuY3Rpb24odCwgZSkge1xuICAgICAgICBjb25zdCBuID0gZS5rZXkucGF0aDtcbiAgICAgICAgcmV0dXJuIG51bGwgIT09IHQuY29sbGVjdGlvbkdyb3VwID8gZS5rZXkuaGFzQ29sbGVjdGlvbklkKHQuY29sbGVjdGlvbkdyb3VwKSAmJiB0LnBhdGguaXNQcmVmaXhPZihuKSA6IHh0LmlzRG9jdW1lbnRLZXkodC5wYXRoKSA/IHQucGF0aC5pc0VxdWFsKG4pIDogdC5wYXRoLmlzSW1tZWRpYXRlUGFyZW50T2Yobik7XG4gICAgfVxuICAgIC8qKlxuICogQSBkb2N1bWVudCBtdXN0IGhhdmUgYSB2YWx1ZSBmb3IgZXZlcnkgb3JkZXJpbmcgY2xhdXNlIGluIG9yZGVyIHRvIHNob3cgdXBcbiAqIGluIHRoZSByZXN1bHRzLlxuICovICh0LCBlKSAmJiBmdW5jdGlvbih0LCBlKSB7XG4gICAgICAgIGZvciAoY29uc3QgbiBvZiB0LmV4cGxpY2l0T3JkZXJCeSkgXG4gICAgICAgIC8vIG9yZGVyIGJ5IGtleSBhbHdheXMgbWF0Y2hlc1xuICAgICAgICBpZiAoIW4uZmllbGQuaXNLZXlGaWVsZCgpICYmIG51bGwgPT09IGUuZGF0YS5maWVsZChuLmZpZWxkKSkgcmV0dXJuICExO1xuICAgICAgICByZXR1cm4gITA7XG4gICAgfSh0LCBlKSAmJiBmdW5jdGlvbih0LCBlKSB7XG4gICAgICAgIGZvciAoY29uc3QgbiBvZiB0LmZpbHRlcnMpIGlmICghbi5tYXRjaGVzKGUpKSByZXR1cm4gITE7XG4gICAgICAgIHJldHVybiAhMDtcbiAgICB9XG4gICAgLyoqIE1ha2VzIHN1cmUgYSBkb2N1bWVudCBpcyB3aXRoaW4gdGhlIGJvdW5kcywgaWYgcHJvdmlkZWQuICovICh0LCBlKSAmJiBmdW5jdGlvbih0LCBlKSB7XG4gICAgICAgIGlmICh0LnN0YXJ0QXQgJiYgIVxuICAgICAgICAvKipcbiAqIFJldHVybnMgdHJ1ZSBpZiBhIGRvY3VtZW50IHNvcnRzIGJlZm9yZSBhIGJvdW5kIHVzaW5nIHRoZSBwcm92aWRlZCBzb3J0XG4gKiBvcmRlci5cbiAqL1xuICAgICAgICBmdW5jdGlvbih0LCBlLCBuKSB7XG4gICAgICAgICAgICBjb25zdCBzID0gQmUodCwgZSwgbik7XG4gICAgICAgICAgICByZXR1cm4gdC5pbmNsdXNpdmUgPyBzIDw9IDAgOiBzIDwgMDtcbiAgICAgICAgfSh0LnN0YXJ0QXQsIHplKHQpLCBlKSkgcmV0dXJuICExO1xuICAgICAgICBpZiAodC5lbmRBdCAmJiAhZnVuY3Rpb24odCwgZSwgbikge1xuICAgICAgICAgICAgY29uc3QgcyA9IEJlKHQsIGUsIG4pO1xuICAgICAgICAgICAgcmV0dXJuIHQuaW5jbHVzaXZlID8gcyA+PSAwIDogcyA+IDA7XG4gICAgICAgIH0odC5lbmRBdCwgemUodCksIGUpKSByZXR1cm4gITE7XG4gICAgICAgIHJldHVybiAhMDtcbiAgICB9XG4gICAgLyoqXG4gKiBSZXR1cm5zIHRoZSBjb2xsZWN0aW9uIGdyb3VwIHRoYXQgdGhpcyBxdWVyeSB0YXJnZXRzLlxuICpcbiAqIFBPUlRJTkcgTk9URTogVGhpcyBpcyBvbmx5IHVzZWQgaW4gdGhlIFdlYiBTREsgdG8gZmFjaWxpdGF0ZSBtdWx0aS10YWJcbiAqIHN5bmNocm9uaXphdGlvbiBmb3IgcXVlcnkgcmVzdWx0cy5cbiAqLyAodCwgZSk7XG59XG5cbmZ1bmN0aW9uIGVuKHQpIHtcbiAgICByZXR1cm4gdC5jb2xsZWN0aW9uR3JvdXAgfHwgKHQucGF0aC5sZW5ndGggJSAyID09IDEgPyB0LnBhdGgubGFzdFNlZ21lbnQoKSA6IHQucGF0aC5nZXQodC5wYXRoLmxlbmd0aCAtIDIpKTtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIGEgbmV3IGNvbXBhcmF0b3IgZnVuY3Rpb24gdGhhdCBjYW4gYmUgdXNlZCB0byBjb21wYXJlIHR3byBkb2N1bWVudHNcbiAqIGJhc2VkIG9uIHRoZSBRdWVyeSdzIG9yZGVyaW5nIGNvbnN0cmFpbnQuXG4gKi8gZnVuY3Rpb24gbm4odCkge1xuICAgIHJldHVybiAoZSwgbikgPT4ge1xuICAgICAgICBsZXQgcyA9ICExO1xuICAgICAgICBmb3IgKGNvbnN0IGkgb2YgemUodCkpIHtcbiAgICAgICAgICAgIGNvbnN0IHQgPSBzbihpLCBlLCBuKTtcbiAgICAgICAgICAgIGlmICgwICE9PSB0KSByZXR1cm4gdDtcbiAgICAgICAgICAgIHMgPSBzIHx8IGkuZmllbGQuaXNLZXlGaWVsZCgpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAwO1xuICAgIH07XG59XG5cbmZ1bmN0aW9uIHNuKHQsIGUsIG4pIHtcbiAgICBjb25zdCBzID0gdC5maWVsZC5pc0tleUZpZWxkKCkgPyB4dC5jb21wYXJhdG9yKGUua2V5LCBuLmtleSkgOiBmdW5jdGlvbih0LCBlLCBuKSB7XG4gICAgICAgIGNvbnN0IHMgPSBlLmRhdGEuZmllbGQodCksIGkgPSBuLmRhdGEuZmllbGQodCk7XG4gICAgICAgIHJldHVybiBudWxsICE9PSBzICYmIG51bGwgIT09IGkgPyAkdChzLCBpKSA6IEwoKTtcbiAgICB9XG4gICAgLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjEgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbiAgICAvKipcbiAqIFRoZSBpbml0aWFsIG11dGF0aW9uIGJhdGNoIGlkIGZvciBlYWNoIGluZGV4LiBHZXRzIHVwZGF0ZWQgZHVyaW5nIGluZGV4XG4gKiBiYWNrZmlsbC5cbiAqLyAodC5maWVsZCwgZSwgbik7XG4gICAgc3dpdGNoICh0LmRpcikge1xuICAgICAgY2FzZSBcImFzY1wiIC8qIEFTQ0VORElORyAqLyA6XG4gICAgICAgIHJldHVybiBzO1xuXG4gICAgICBjYXNlIFwiZGVzY1wiIC8qIERFU0NFTkRJTkcgKi8gOlxuICAgICAgICByZXR1cm4gLTEgKiBzO1xuXG4gICAgICBkZWZhdWx0OlxuICAgICAgICByZXR1cm4gTCgpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogUmV0dXJucyBhbiBEb3VibGVWYWx1ZSBmb3IgYHZhbHVlYCB0aGF0IGlzIGVuY29kZWQgYmFzZWQgdGhlIHNlcmlhbGl6ZXInc1xuICogYHVzZVByb3RvM0pzb25gIHNldHRpbmcuXG4gKi8gZnVuY3Rpb24gcm4odCwgZSkge1xuICAgIGlmICh0Lk4pIHtcbiAgICAgICAgaWYgKGlzTmFOKGUpKSByZXR1cm4ge1xuICAgICAgICAgICAgZG91YmxlVmFsdWU6IFwiTmFOXCJcbiAgICAgICAgfTtcbiAgICAgICAgaWYgKGUgPT09IDEgLyAwKSByZXR1cm4ge1xuICAgICAgICAgICAgZG91YmxlVmFsdWU6IFwiSW5maW5pdHlcIlxuICAgICAgICB9O1xuICAgICAgICBpZiAoZSA9PT0gLTEgLyAwKSByZXR1cm4ge1xuICAgICAgICAgICAgZG91YmxlVmFsdWU6IFwiLUluZmluaXR5XCJcbiAgICAgICAgfTtcbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgICAgZG91YmxlVmFsdWU6IER0KGUpID8gXCItMFwiIDogZVxuICAgIH07XG59XG5cbi8qKlxuICogUmV0dXJucyBhbiBJbnRlZ2VyVmFsdWUgZm9yIGB2YWx1ZWAuXG4gKi8gZnVuY3Rpb24gb24odCkge1xuICAgIHJldHVybiB7XG4gICAgICAgIGludGVnZXJWYWx1ZTogXCJcIiArIHRcbiAgICB9O1xufVxuXG4vKipcbiAqIFJldHVybnMgYSB2YWx1ZSBmb3IgYSBudW1iZXIgdGhhdCdzIGFwcHJvcHJpYXRlIHRvIHB1dCBpbnRvIGEgcHJvdG8uXG4gKiBUaGUgcmV0dXJuIHZhbHVlIGlzIGFuIEludGVnZXJWYWx1ZSBpZiBpdCBjYW4gc2FmZWx5IHJlcHJlc2VudCB0aGUgdmFsdWUsXG4gKiBvdGhlcndpc2UgYSBEb3VibGVWYWx1ZSBpcyByZXR1cm5lZC5cbiAqLyBmdW5jdGlvbiB1bih0LCBlKSB7XG4gICAgcmV0dXJuIEN0KGUpID8gb24oZSkgOiBybih0LCBlKTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTggR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKiBVc2VkIHRvIHJlcHJlc2VudCBhIGZpZWxkIHRyYW5zZm9ybSBvbiBhIG11dGF0aW9uLiAqLyBjbGFzcyBhbiB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIC8vIE1ha2Ugc3VyZSB0aGF0IHRoZSBzdHJ1Y3R1cmFsIHR5cGUgb2YgYFRyYW5zZm9ybU9wZXJhdGlvbmAgaXMgdW5pcXVlLlxuICAgICAgICAvLyBTZWUgaHR0cHM6Ly9naXRodWIuY29tL21pY3Jvc29mdC9UeXBlU2NyaXB0L2lzc3Vlcy81NDUxXG4gICAgICAgIHRoaXMuXyA9IHZvaWQgMDtcbiAgICB9XG59XG5cbi8qKlxuICogQ29tcHV0ZXMgdGhlIGxvY2FsIHRyYW5zZm9ybSByZXN1bHQgYWdhaW5zdCB0aGUgcHJvdmlkZWQgYHByZXZpb3VzVmFsdWVgLFxuICogb3B0aW9uYWxseSB1c2luZyB0aGUgcHJvdmlkZWQgbG9jYWxXcml0ZVRpbWUuXG4gKi8gZnVuY3Rpb24gY24odCwgZSwgbikge1xuICAgIHJldHVybiB0IGluc3RhbmNlb2YgZm4gPyBmdW5jdGlvbih0LCBlKSB7XG4gICAgICAgIGNvbnN0IG4gPSB7XG4gICAgICAgICAgICBmaWVsZHM6IHtcbiAgICAgICAgICAgICAgICBfX3R5cGVfXzoge1xuICAgICAgICAgICAgICAgICAgICBzdHJpbmdWYWx1ZTogXCJzZXJ2ZXJfdGltZXN0YW1wXCJcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIF9fbG9jYWxfd3JpdGVfdGltZV9fOiB7XG4gICAgICAgICAgICAgICAgICAgIHRpbWVzdGFtcFZhbHVlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWNvbmRzOiB0LnNlY29uZHMsXG4gICAgICAgICAgICAgICAgICAgICAgICBuYW5vczogdC5uYW5vc2Vjb25kc1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gZSAmJiAobi5maWVsZHMuX19wcmV2aW91c192YWx1ZV9fID0gZSksIHtcbiAgICAgICAgICAgIG1hcFZhbHVlOiBuXG4gICAgICAgIH07XG4gICAgfShuLCBlKSA6IHQgaW5zdGFuY2VvZiBkbiA/IF9uKHQsIGUpIDogdCBpbnN0YW5jZW9mIHduID8gbW4odCwgZSkgOiBmdW5jdGlvbih0LCBlKSB7XG4gICAgICAgIC8vIFBPUlRJTkcgTk9URTogU2luY2UgSmF2YVNjcmlwdCdzIGludGVnZXIgYXJpdGhtZXRpYyBpcyBsaW1pdGVkIHRvIDUzIGJpdFxuICAgICAgICAvLyBwcmVjaXNpb24gYW5kIHJlc29sdmVzIG92ZXJmbG93cyBieSByZWR1Y2luZyBwcmVjaXNpb24sIHdlIGRvIG5vdFxuICAgICAgICAvLyBtYW51YWxseSBjYXAgb3ZlcmZsb3dzIGF0IDJeNjMuXG4gICAgICAgIGNvbnN0IG4gPSBsbih0LCBlKSwgcyA9IHluKG4pICsgeW4odC5rKTtcbiAgICAgICAgcmV0dXJuIEt0KG4pICYmIEt0KHQuaykgPyBvbihzKSA6IHJuKHQuTSwgcyk7XG4gICAgfSh0LCBlKTtcbn1cblxuLyoqXG4gKiBDb21wdXRlcyBhIGZpbmFsIHRyYW5zZm9ybSByZXN1bHQgYWZ0ZXIgdGhlIHRyYW5zZm9ybSBoYXMgYmVlbiBhY2tub3dsZWRnZWRcbiAqIGJ5IHRoZSBzZXJ2ZXIsIHBvdGVudGlhbGx5IHVzaW5nIHRoZSBzZXJ2ZXItcHJvdmlkZWQgdHJhbnNmb3JtUmVzdWx0LlxuICovIGZ1bmN0aW9uIGhuKHQsIGUsIG4pIHtcbiAgICAvLyBUaGUgc2VydmVyIGp1c3Qgc2VuZHMgbnVsbCBhcyB0aGUgdHJhbnNmb3JtIHJlc3VsdCBmb3IgYXJyYXkgb3BlcmF0aW9ucyxcbiAgICAvLyBzbyB3ZSBoYXZlIHRvIGNhbGN1bGF0ZSBhIHJlc3VsdCB0aGUgc2FtZSBhcyB3ZSBkbyBmb3IgbG9jYWxcbiAgICAvLyBhcHBsaWNhdGlvbnMuXG4gICAgcmV0dXJuIHQgaW5zdGFuY2VvZiBkbiA/IF9uKHQsIGUpIDogdCBpbnN0YW5jZW9mIHduID8gbW4odCwgZSkgOiBuO1xufVxuXG4vKipcbiAqIElmIHRoaXMgdHJhbnNmb3JtIG9wZXJhdGlvbiBpcyBub3QgaWRlbXBvdGVudCwgcmV0dXJucyB0aGUgYmFzZSB2YWx1ZSB0b1xuICogcGVyc2lzdCBmb3IgdGhpcyB0cmFuc2Zvcm0uIElmIGEgYmFzZSB2YWx1ZSBpcyByZXR1cm5lZCwgdGhlIHRyYW5zZm9ybVxuICogb3BlcmF0aW9uIGlzIGFsd2F5cyBhcHBsaWVkIHRvIHRoaXMgYmFzZSB2YWx1ZSwgZXZlbiBpZiBkb2N1bWVudCBoYXNcbiAqIGFscmVhZHkgYmVlbiB1cGRhdGVkLlxuICpcbiAqIEJhc2UgdmFsdWVzIHByb3ZpZGUgY29uc2lzdGVudCBiZWhhdmlvciBmb3Igbm9uLWlkZW1wb3RlbnQgdHJhbnNmb3JtcyBhbmRcbiAqIGFsbG93IHVzIHRvIHJldHVybiB0aGUgc2FtZSBsYXRlbmN5LWNvbXBlbnNhdGVkIHZhbHVlIGV2ZW4gaWYgdGhlIGJhY2tlbmRcbiAqIGhhcyBhbHJlYWR5IGFwcGxpZWQgdGhlIHRyYW5zZm9ybSBvcGVyYXRpb24uIFRoZSBiYXNlIHZhbHVlIGlzIG51bGwgZm9yXG4gKiBpZGVtcG90ZW50IHRyYW5zZm9ybXMsIGFzIHRoZXkgY2FuIGJlIHJlLXBsYXllZCBldmVuIGlmIHRoZSBiYWNrZW5kIGhhc1xuICogYWxyZWFkeSBhcHBsaWVkIHRoZW0uXG4gKlxuICogQHJldHVybnMgYSBiYXNlIHZhbHVlIHRvIHN0b3JlIGFsb25nIHdpdGggdGhlIG11dGF0aW9uLCBvciBudWxsIGZvclxuICogaWRlbXBvdGVudCB0cmFuc2Zvcm1zLlxuICovIGZ1bmN0aW9uIGxuKHQsIGUpIHtcbiAgICByZXR1cm4gdCBpbnN0YW5jZW9mIGduID8gS3QobiA9IGUpIHx8IGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgcmV0dXJuICEhdCAmJiBcImRvdWJsZVZhbHVlXCIgaW4gdDtcbiAgICB9XG4gICAgLyoqIFJldHVybnMgdHJ1ZSBpZiBgdmFsdWVgIGlzIGVpdGhlciBhbiBJbnRlZ2VyVmFsdWUgb3IgYSBEb3VibGVWYWx1ZS4gKi8gKG4pID8gZSA6IHtcbiAgICAgICAgaW50ZWdlclZhbHVlOiAwXG4gICAgfSA6IG51bGw7XG4gICAgdmFyIG47XG59XG5cbi8qKiBUcmFuc2Zvcm1zIGEgdmFsdWUgaW50byBhIHNlcnZlci1nZW5lcmF0ZWQgdGltZXN0YW1wLiAqL1xuY2xhc3MgZm4gZXh0ZW5kcyBhbiB7fVxuXG4vKiogVHJhbnNmb3JtcyBhbiBhcnJheSB2YWx1ZSB2aWEgYSB1bmlvbiBvcGVyYXRpb24uICovIGNsYXNzIGRuIGV4dGVuZHMgYW4ge1xuICAgIGNvbnN0cnVjdG9yKHQpIHtcbiAgICAgICAgc3VwZXIoKSwgdGhpcy5lbGVtZW50cyA9IHQ7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBfbih0LCBlKSB7XG4gICAgY29uc3QgbiA9IHBuKGUpO1xuICAgIGZvciAoY29uc3QgZSBvZiB0LmVsZW1lbnRzKSBuLnNvbWUoKHQgPT4gT3QodCwgZSkpKSB8fCBuLnB1c2goZSk7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgYXJyYXlWYWx1ZToge1xuICAgICAgICAgICAgdmFsdWVzOiBuXG4gICAgICAgIH1cbiAgICB9O1xufVxuXG4vKiogVHJhbnNmb3JtcyBhbiBhcnJheSB2YWx1ZSB2aWEgYSByZW1vdmUgb3BlcmF0aW9uLiAqLyBjbGFzcyB3biBleHRlbmRzIGFuIHtcbiAgICBjb25zdHJ1Y3Rvcih0KSB7XG4gICAgICAgIHN1cGVyKCksIHRoaXMuZWxlbWVudHMgPSB0O1xuICAgIH1cbn1cblxuZnVuY3Rpb24gbW4odCwgZSkge1xuICAgIGxldCBuID0gcG4oZSk7XG4gICAgZm9yIChjb25zdCBlIG9mIHQuZWxlbWVudHMpIG4gPSBuLmZpbHRlcigodCA9PiAhT3QodCwgZSkpKTtcbiAgICByZXR1cm4ge1xuICAgICAgICBhcnJheVZhbHVlOiB7XG4gICAgICAgICAgICB2YWx1ZXM6IG5cbiAgICAgICAgfVxuICAgIH07XG59XG5cbi8qKlxuICogSW1wbGVtZW50cyB0aGUgYmFja2VuZCBzZW1hbnRpY3MgZm9yIGxvY2FsbHkgY29tcHV0ZWQgTlVNRVJJQ19BREQgKGluY3JlbWVudClcbiAqIHRyYW5zZm9ybXMuIENvbnZlcnRzIGFsbCBmaWVsZCB2YWx1ZXMgdG8gaW50ZWdlcnMgb3IgZG91YmxlcywgYnV0IHVubGlrZSB0aGVcbiAqIGJhY2tlbmQgZG9lcyBub3QgY2FwIGludGVnZXIgdmFsdWVzIGF0IDJeNjMuIEluc3RlYWQsIEphdmFTY3JpcHQgbnVtYmVyXG4gKiBhcml0aG1ldGljIGlzIHVzZWQgYW5kIHByZWNpc2lvbiBsb3NzIGNhbiBvY2N1ciBmb3IgdmFsdWVzIGdyZWF0ZXIgdGhhbiAyXjUzLlxuICovIGNsYXNzIGduIGV4dGVuZHMgYW4ge1xuICAgIGNvbnN0cnVjdG9yKHQsIGUpIHtcbiAgICAgICAgc3VwZXIoKSwgdGhpcy5NID0gdCwgdGhpcy5rID0gZTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIHluKHQpIHtcbiAgICByZXR1cm4gRXQodC5pbnRlZ2VyVmFsdWUgfHwgdC5kb3VibGVWYWx1ZSk7XG59XG5cbmZ1bmN0aW9uIHBuKHQpIHtcbiAgICByZXR1cm4gR3QodCkgJiYgdC5hcnJheVZhbHVlLnZhbHVlcyA/IHQuYXJyYXlWYWx1ZS52YWx1ZXMuc2xpY2UoKSA6IFtdO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqIEEgZmllbGQgcGF0aCBhbmQgdGhlIFRyYW5zZm9ybU9wZXJhdGlvbiB0byBwZXJmb3JtIHVwb24gaXQuICovIGNsYXNzIEluIHtcbiAgICBjb25zdHJ1Y3Rvcih0LCBlKSB7XG4gICAgICAgIHRoaXMuZmllbGQgPSB0LCB0aGlzLnRyYW5zZm9ybSA9IGU7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBUbih0LCBlKSB7XG4gICAgcmV0dXJuIHQuZmllbGQuaXNFcXVhbChlLmZpZWxkKSAmJiBmdW5jdGlvbih0LCBlKSB7XG4gICAgICAgIHJldHVybiB0IGluc3RhbmNlb2YgZG4gJiYgZSBpbnN0YW5jZW9mIGRuIHx8IHQgaW5zdGFuY2VvZiB3biAmJiBlIGluc3RhbmNlb2Ygd24gPyBvdCh0LmVsZW1lbnRzLCBlLmVsZW1lbnRzLCBPdCkgOiB0IGluc3RhbmNlb2YgZ24gJiYgZSBpbnN0YW5jZW9mIGduID8gT3QodC5rLCBlLmspIDogdCBpbnN0YW5jZW9mIGZuICYmIGUgaW5zdGFuY2VvZiBmbjtcbiAgICB9KHQudHJhbnNmb3JtLCBlLnRyYW5zZm9ybSk7XG59XG5cbi8qKiBUaGUgcmVzdWx0IG9mIHN1Y2Nlc3NmdWxseSBhcHBseWluZyBhIG11dGF0aW9uIHRvIHRoZSBiYWNrZW5kLiAqL1xuY2xhc3MgRW4ge1xuICAgIGNvbnN0cnVjdG9yKFxuICAgIC8qKlxuICAgICAqIFRoZSB2ZXJzaW9uIGF0IHdoaWNoIHRoZSBtdXRhdGlvbiB3YXMgY29tbWl0dGVkOlxuICAgICAqXG4gICAgICogLSBGb3IgbW9zdCBvcGVyYXRpb25zLCB0aGlzIGlzIHRoZSB1cGRhdGVUaW1lIGluIHRoZSBXcml0ZVJlc3VsdC5cbiAgICAgKiAtIEZvciBkZWxldGVzLCB0aGUgY29tbWl0VGltZSBvZiB0aGUgV3JpdGVSZXNwb25zZSAoYmVjYXVzZSBkZWxldGVzIGFyZVxuICAgICAqICAgbm90IHN0b3JlZCBhbmQgaGF2ZSBubyB1cGRhdGVUaW1lKS5cbiAgICAgKlxuICAgICAqIE5vdGUgdGhhdCB0aGVzZSB2ZXJzaW9ucyBjYW4gYmUgZGlmZmVyZW50OiBOby1vcCB3cml0ZXMgd2lsbCBub3QgY2hhbmdlXG4gICAgICogdGhlIHVwZGF0ZVRpbWUgZXZlbiB0aG91Z2ggdGhlIGNvbW1pdFRpbWUgYWR2YW5jZXMuXG4gICAgICovXG4gICAgdCwgXG4gICAgLyoqXG4gICAgICogVGhlIHJlc3VsdGluZyBmaWVsZHMgcmV0dXJuZWQgZnJvbSB0aGUgYmFja2VuZCBhZnRlciBhIG11dGF0aW9uXG4gICAgICogY29udGFpbmluZyBmaWVsZCB0cmFuc2Zvcm1zIGhhcyBiZWVuIGNvbW1pdHRlZC4gQ29udGFpbnMgb25lIEZpZWxkVmFsdWVcbiAgICAgKiBmb3IgZWFjaCBGaWVsZFRyYW5zZm9ybSB0aGF0IHdhcyBpbiB0aGUgbXV0YXRpb24uXG4gICAgICpcbiAgICAgKiBXaWxsIGJlIGVtcHR5IGlmIHRoZSBtdXRhdGlvbiBkaWQgbm90IGNvbnRhaW4gYW55IGZpZWxkIHRyYW5zZm9ybXMuXG4gICAgICovXG4gICAgZSkge1xuICAgICAgICB0aGlzLnZlcnNpb24gPSB0LCB0aGlzLnRyYW5zZm9ybVJlc3VsdHMgPSBlO1xuICAgIH1cbn1cblxuLyoqXG4gKiBFbmNvZGVzIGEgcHJlY29uZGl0aW9uIGZvciBhIG11dGF0aW9uLiBUaGlzIGZvbGxvd3MgdGhlIG1vZGVsIHRoYXQgdGhlXG4gKiBiYWNrZW5kIGFjY2VwdHMgd2l0aCB0aGUgc3BlY2lhbCBjYXNlIG9mIGFuIGV4cGxpY2l0IFwiZW1wdHlcIiBwcmVjb25kaXRpb25cbiAqIChtZWFuaW5nIG5vIHByZWNvbmRpdGlvbikuXG4gKi8gY2xhc3MgQW4ge1xuICAgIGNvbnN0cnVjdG9yKHQsIGUpIHtcbiAgICAgICAgdGhpcy51cGRhdGVUaW1lID0gdCwgdGhpcy5leGlzdHMgPSBlO1xuICAgIH1cbiAgICAvKiogQ3JlYXRlcyBhIG5ldyBlbXB0eSBQcmVjb25kaXRpb24uICovICAgIHN0YXRpYyBub25lKCkge1xuICAgICAgICByZXR1cm4gbmV3IEFuO1xuICAgIH1cbiAgICAvKiogQ3JlYXRlcyBhIG5ldyBQcmVjb25kaXRpb24gd2l0aCBhbiBleGlzdHMgZmxhZy4gKi8gICAgc3RhdGljIGV4aXN0cyh0KSB7XG4gICAgICAgIHJldHVybiBuZXcgQW4odm9pZCAwLCB0KTtcbiAgICB9XG4gICAgLyoqIENyZWF0ZXMgYSBuZXcgUHJlY29uZGl0aW9uIGJhc2VkIG9uIGEgdmVyc2lvbiBhIGRvY3VtZW50IGV4aXN0cyBhdC4gKi8gICAgc3RhdGljIHVwZGF0ZVRpbWUodCkge1xuICAgICAgICByZXR1cm4gbmV3IEFuKHQpO1xuICAgIH1cbiAgICAvKiogUmV0dXJucyB3aGV0aGVyIHRoaXMgUHJlY29uZGl0aW9uIGlzIGVtcHR5LiAqLyAgICBnZXQgaXNOb25lKCkge1xuICAgICAgICByZXR1cm4gdm9pZCAwID09PSB0aGlzLnVwZGF0ZVRpbWUgJiYgdm9pZCAwID09PSB0aGlzLmV4aXN0cztcbiAgICB9XG4gICAgaXNFcXVhbCh0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLmV4aXN0cyA9PT0gdC5leGlzdHMgJiYgKHRoaXMudXBkYXRlVGltZSA/ICEhdC51cGRhdGVUaW1lICYmIHRoaXMudXBkYXRlVGltZS5pc0VxdWFsKHQudXBkYXRlVGltZSkgOiAhdC51cGRhdGVUaW1lKTtcbiAgICB9XG59XG5cbi8qKiBSZXR1cm5zIHRydWUgaWYgdGhlIHByZWNvbmRpdGlvbnMgaXMgdmFsaWQgZm9yIHRoZSBnaXZlbiBkb2N1bWVudC4gKi8gZnVuY3Rpb24gUm4odCwgZSkge1xuICAgIHJldHVybiB2b2lkIDAgIT09IHQudXBkYXRlVGltZSA/IGUuaXNGb3VuZERvY3VtZW50KCkgJiYgZS52ZXJzaW9uLmlzRXF1YWwodC51cGRhdGVUaW1lKSA6IHZvaWQgMCA9PT0gdC5leGlzdHMgfHwgdC5leGlzdHMgPT09IGUuaXNGb3VuZERvY3VtZW50KCk7XG59XG5cbi8qKlxuICogQSBtdXRhdGlvbiBkZXNjcmliZXMgYSBzZWxmLWNvbnRhaW5lZCBjaGFuZ2UgdG8gYSBkb2N1bWVudC4gTXV0YXRpb25zIGNhblxuICogY3JlYXRlLCByZXBsYWNlLCBkZWxldGUsIGFuZCB1cGRhdGUgc3Vic2V0cyBvZiBkb2N1bWVudHMuXG4gKlxuICogTXV0YXRpb25zIG5vdCBvbmx5IGFjdCBvbiB0aGUgdmFsdWUgb2YgdGhlIGRvY3VtZW50IGJ1dCBhbHNvIGl0cyB2ZXJzaW9uLlxuICpcbiAqIEZvciBsb2NhbCBtdXRhdGlvbnMgKG11dGF0aW9ucyB0aGF0IGhhdmVuJ3QgYmVlbiBjb21taXR0ZWQgeWV0KSwgd2UgcHJlc2VydmVcbiAqIHRoZSBleGlzdGluZyB2ZXJzaW9uIGZvciBTZXQgYW5kIFBhdGNoIG11dGF0aW9ucy4gRm9yIERlbGV0ZSBtdXRhdGlvbnMsIHdlXG4gKiByZXNldCB0aGUgdmVyc2lvbiB0byAwLlxuICpcbiAqIEhlcmUncyB0aGUgZXhwZWN0ZWQgdHJhbnNpdGlvbiB0YWJsZS5cbiAqXG4gKiBNVVRBVElPTiAgICAgICAgICAgQVBQTElFRCBUTyAgICAgICAgICAgIFJFU1VMVFMgSU5cbiAqXG4gKiBTZXRNdXRhdGlvbiAgICAgICAgRG9jdW1lbnQodjMpICAgICAgICAgIERvY3VtZW50KHYzKVxuICogU2V0TXV0YXRpb24gICAgICAgIE5vRG9jdW1lbnQodjMpICAgICAgICBEb2N1bWVudCh2MClcbiAqIFNldE11dGF0aW9uICAgICAgICBJbnZhbGlkRG9jdW1lbnQodjApICAgRG9jdW1lbnQodjApXG4gKiBQYXRjaE11dGF0aW9uICAgICAgRG9jdW1lbnQodjMpICAgICAgICAgIERvY3VtZW50KHYzKVxuICogUGF0Y2hNdXRhdGlvbiAgICAgIE5vRG9jdW1lbnQodjMpICAgICAgICBOb0RvY3VtZW50KHYzKVxuICogUGF0Y2hNdXRhdGlvbiAgICAgIEludmFsaWREb2N1bWVudCh2MCkgICBVbmtub3duRG9jdW1lbnQodjMpXG4gKiBEZWxldGVNdXRhdGlvbiAgICAgRG9jdW1lbnQodjMpICAgICAgICAgIE5vRG9jdW1lbnQodjApXG4gKiBEZWxldGVNdXRhdGlvbiAgICAgTm9Eb2N1bWVudCh2MykgICAgICAgIE5vRG9jdW1lbnQodjApXG4gKiBEZWxldGVNdXRhdGlvbiAgICAgSW52YWxpZERvY3VtZW50KHYwKSAgIE5vRG9jdW1lbnQodjApXG4gKlxuICogRm9yIGFja25vd2xlZGdlZCBtdXRhdGlvbnMsIHdlIHVzZSB0aGUgdXBkYXRlVGltZSBvZiB0aGUgV3JpdGVSZXNwb25zZSBhc1xuICogdGhlIHJlc3VsdGluZyB2ZXJzaW9uIGZvciBTZXQgYW5kIFBhdGNoIG11dGF0aW9ucy4gQXMgZGVsZXRlcyBoYXZlIG5vXG4gKiBleHBsaWNpdCB1cGRhdGUgdGltZSwgd2UgdXNlIHRoZSBjb21taXRUaW1lIG9mIHRoZSBXcml0ZVJlc3BvbnNlIGZvclxuICogRGVsZXRlIG11dGF0aW9ucy5cbiAqXG4gKiBJZiBhIG11dGF0aW9uIGlzIGFja25vd2xlZGdlZCBieSB0aGUgYmFja2VuZCBidXQgZmFpbHMgdGhlIHByZWNvbmRpdGlvbiBjaGVja1xuICogbG9jYWxseSwgd2UgdHJhbnNpdGlvbiB0byBhbiBgVW5rbm93bkRvY3VtZW50YCBhbmQgcmVseSBvbiBXYXRjaCB0byBzZW5kIHVzXG4gKiB0aGUgdXBkYXRlZCB2ZXJzaW9uLlxuICpcbiAqIEZpZWxkIHRyYW5zZm9ybXMgYXJlIHVzZWQgb25seSB3aXRoIFBhdGNoIGFuZCBTZXQgTXV0YXRpb25zLiBXZSB1c2UgdGhlXG4gKiBgdXBkYXRlVHJhbnNmb3Jtc2AgbWVzc2FnZSB0byBzdG9yZSB0cmFuc2Zvcm1zLCByYXRoZXIgdGhhbiB0aGUgYHRyYW5zZm9ybXNgc1xuICogbWVzc2FnZXMuXG4gKlxuICogIyMgU3ViY2xhc3NpbmcgTm90ZXNcbiAqXG4gKiBFdmVyeSB0eXBlIG9mIG11dGF0aW9uIG5lZWRzIHRvIGltcGxlbWVudCBpdHMgb3duIGFwcGx5VG9SZW1vdGVEb2N1bWVudCgpIGFuZFxuICogYXBwbHlUb0xvY2FsVmlldygpIHRvIGltcGxlbWVudCB0aGUgYWN0dWFsIGJlaGF2aW9yIG9mIGFwcGx5aW5nIHRoZSBtdXRhdGlvblxuICogdG8gc29tZSBzb3VyY2UgZG9jdW1lbnQgKHNlZSBgc2V0TXV0YXRpb25BcHBseVRvUmVtb3RlRG9jdW1lbnQoKWAgZm9yIGFuXG4gKiBleGFtcGxlKS5cbiAqLyBjbGFzcyBibiB7fVxuXG4vKipcbiAqIEFwcGxpZXMgdGhpcyBtdXRhdGlvbiB0byB0aGUgZ2l2ZW4gZG9jdW1lbnQgZm9yIHRoZSBwdXJwb3NlcyBvZiBjb21wdXRpbmcgYVxuICogbmV3IHJlbW90ZSBkb2N1bWVudC4gSWYgdGhlIGlucHV0IGRvY3VtZW50IGRvZXNuJ3QgbWF0Y2ggdGhlIGV4cGVjdGVkIHN0YXRlXG4gKiAoZS5nLiBpdCBpcyBpbnZhbGlkIG9yIG91dGRhdGVkKSwgdGhlIGRvY3VtZW50IHR5cGUgbWF5IHRyYW5zaXRpb24gdG9cbiAqIHVua25vd24uXG4gKlxuICogQHBhcmFtIG11dGF0aW9uIC0gVGhlIG11dGF0aW9uIHRvIGFwcGx5LlxuICogQHBhcmFtIGRvY3VtZW50IC0gVGhlIGRvY3VtZW50IHRvIG11dGF0ZS4gVGhlIGlucHV0IGRvY3VtZW50IGNhbiBiZSBhblxuICogICAgIGludmFsaWQgZG9jdW1lbnQgaWYgdGhlIGNsaWVudCBoYXMgbm8ga25vd2xlZGdlIG9mIHRoZSBwcmUtbXV0YXRpb24gc3RhdGVcbiAqICAgICBvZiB0aGUgZG9jdW1lbnQuXG4gKiBAcGFyYW0gbXV0YXRpb25SZXN1bHQgLSBUaGUgcmVzdWx0IG9mIGFwcGx5aW5nIHRoZSBtdXRhdGlvbiBmcm9tIHRoZSBiYWNrZW5kLlxuICovIGZ1bmN0aW9uIFBuKHQsIGUsIG4pIHtcbiAgICB0IGluc3RhbmNlb2YgQ24gPyBmdW5jdGlvbih0LCBlLCBuKSB7XG4gICAgICAgIC8vIFVubGlrZSBzZXRNdXRhdGlvbkFwcGx5VG9Mb2NhbFZpZXcsIGlmIHdlJ3JlIGFwcGx5aW5nIGEgbXV0YXRpb24gdG8gYVxuICAgICAgICAvLyByZW1vdGUgZG9jdW1lbnQgdGhlIHNlcnZlciBoYXMgYWNjZXB0ZWQgdGhlIG11dGF0aW9uIHNvIHRoZSBwcmVjb25kaXRpb25cbiAgICAgICAgLy8gbXVzdCBoYXZlIGhlbGQuXG4gICAgICAgIGNvbnN0IHMgPSB0LnZhbHVlLmNsb25lKCksIGkgPSBrbih0LmZpZWxkVHJhbnNmb3JtcywgZSwgbi50cmFuc2Zvcm1SZXN1bHRzKTtcbiAgICAgICAgcy5zZXRBbGwoaSksIGUuY29udmVydFRvRm91bmREb2N1bWVudChuLnZlcnNpb24sIHMpLnNldEhhc0NvbW1pdHRlZE11dGF0aW9ucygpO1xuICAgIH0odCwgZSwgbikgOiB0IGluc3RhbmNlb2YgeG4gPyBmdW5jdGlvbih0LCBlLCBuKSB7XG4gICAgICAgIGlmICghUm4odC5wcmVjb25kaXRpb24sIGUpKSBcbiAgICAgICAgLy8gU2luY2UgdGhlIG11dGF0aW9uIHdhcyBub3QgcmVqZWN0ZWQsIHdlIGtub3cgdGhhdCB0aGUgcHJlY29uZGl0aW9uXG4gICAgICAgIC8vIG1hdGNoZWQgb24gdGhlIGJhY2tlbmQuIFdlIHRoZXJlZm9yZSBtdXN0IG5vdCBoYXZlIHRoZSBleHBlY3RlZCB2ZXJzaW9uXG4gICAgICAgIC8vIG9mIHRoZSBkb2N1bWVudCBpbiBvdXIgY2FjaGUgYW5kIGNvbnZlcnQgdG8gYW4gVW5rbm93bkRvY3VtZW50IHdpdGggYVxuICAgICAgICAvLyBrbm93biB1cGRhdGVUaW1lLlxuICAgICAgICByZXR1cm4gdm9pZCBlLmNvbnZlcnRUb1Vua25vd25Eb2N1bWVudChuLnZlcnNpb24pO1xuICAgICAgICBjb25zdCBzID0ga24odC5maWVsZFRyYW5zZm9ybXMsIGUsIG4udHJhbnNmb3JtUmVzdWx0cyksIGkgPSBlLmRhdGE7XG4gICAgICAgIGkuc2V0QWxsKE5uKHQpKSwgaS5zZXRBbGwocyksIGUuY29udmVydFRvRm91bmREb2N1bWVudChuLnZlcnNpb24sIGkpLnNldEhhc0NvbW1pdHRlZE11dGF0aW9ucygpO1xuICAgIH0odCwgZSwgbikgOiBmdW5jdGlvbih0LCBlLCBuKSB7XG4gICAgICAgIC8vIFVubGlrZSBhcHBseVRvTG9jYWxWaWV3LCBpZiB3ZSdyZSBhcHBseWluZyBhIG11dGF0aW9uIHRvIGEgcmVtb3RlXG4gICAgICAgIC8vIGRvY3VtZW50IHRoZSBzZXJ2ZXIgaGFzIGFjY2VwdGVkIHRoZSBtdXRhdGlvbiBzbyB0aGUgcHJlY29uZGl0aW9uIG11c3RcbiAgICAgICAgLy8gaGF2ZSBoZWxkLlxuICAgICAgICBlLmNvbnZlcnRUb05vRG9jdW1lbnQobi52ZXJzaW9uKS5zZXRIYXNDb21taXR0ZWRNdXRhdGlvbnMoKTtcbiAgICB9KDAsIGUsIG4pO1xufVxuXG4vKipcbiAqIEFwcGxpZXMgdGhpcyBtdXRhdGlvbiB0byB0aGUgZ2l2ZW4gZG9jdW1lbnQgZm9yIHRoZSBwdXJwb3NlcyBvZiBjb21wdXRpbmdcbiAqIHRoZSBuZXcgbG9jYWwgdmlldyBvZiBhIGRvY3VtZW50LiBJZiB0aGUgaW5wdXQgZG9jdW1lbnQgZG9lc24ndCBtYXRjaCB0aGVcbiAqIGV4cGVjdGVkIHN0YXRlLCB0aGUgZG9jdW1lbnQgaXMgbm90IG1vZGlmaWVkLlxuICpcbiAqIEBwYXJhbSBtdXRhdGlvbiAtIFRoZSBtdXRhdGlvbiB0byBhcHBseS5cbiAqIEBwYXJhbSBkb2N1bWVudCAtIFRoZSBkb2N1bWVudCB0byBtdXRhdGUuIFRoZSBpbnB1dCBkb2N1bWVudCBjYW4gYmUgYW5cbiAqICAgICBpbnZhbGlkIGRvY3VtZW50IGlmIHRoZSBjbGllbnQgaGFzIG5vIGtub3dsZWRnZSBvZiB0aGUgcHJlLW11dGF0aW9uIHN0YXRlXG4gKiAgICAgb2YgdGhlIGRvY3VtZW50LlxuICogQHBhcmFtIGxvY2FsV3JpdGVUaW1lIC0gQSB0aW1lc3RhbXAgaW5kaWNhdGluZyB0aGUgbG9jYWwgd3JpdGUgdGltZSBvZiB0aGVcbiAqICAgICBiYXRjaCB0aGlzIG11dGF0aW9uIGlzIGEgcGFydCBvZi5cbiAqLyBmdW5jdGlvbiBWbih0LCBlLCBuKSB7XG4gICAgdCBpbnN0YW5jZW9mIENuID8gZnVuY3Rpb24odCwgZSwgbikge1xuICAgICAgICBpZiAoIVJuKHQucHJlY29uZGl0aW9uLCBlKSkgXG4gICAgICAgIC8vIFRoZSBtdXRhdGlvbiBmYWlsZWQgdG8gYXBwbHkgKGUuZy4gYSBkb2N1bWVudCBJRCBjcmVhdGVkIHdpdGggYWRkKClcbiAgICAgICAgLy8gY2F1c2VkIGEgbmFtZSBjb2xsaXNpb24pLlxuICAgICAgICByZXR1cm47XG4gICAgICAgIGNvbnN0IHMgPSB0LnZhbHVlLmNsb25lKCksIGkgPSBNbih0LmZpZWxkVHJhbnNmb3JtcywgbiwgZSk7XG4gICAgICAgIHMuc2V0QWxsKGkpLCBlLmNvbnZlcnRUb0ZvdW5kRG9jdW1lbnQoRG4oZSksIHMpLnNldEhhc0xvY2FsTXV0YXRpb25zKCk7XG4gICAgfVxuICAgIC8qKlxuICogQSBtdXRhdGlvbiB0aGF0IG1vZGlmaWVzIGZpZWxkcyBvZiB0aGUgZG9jdW1lbnQgYXQgdGhlIGdpdmVuIGtleSB3aXRoIHRoZVxuICogZ2l2ZW4gdmFsdWVzLiBUaGUgdmFsdWVzIGFyZSBhcHBsaWVkIHRocm91Z2ggYSBmaWVsZCBtYXNrOlxuICpcbiAqICAqIFdoZW4gYSBmaWVsZCBpcyBpbiBib3RoIHRoZSBtYXNrIGFuZCB0aGUgdmFsdWVzLCB0aGUgY29ycmVzcG9uZGluZyBmaWVsZFxuICogICAgaXMgdXBkYXRlZC5cbiAqICAqIFdoZW4gYSBmaWVsZCBpcyBpbiBuZWl0aGVyIHRoZSBtYXNrIG5vciB0aGUgdmFsdWVzLCB0aGUgY29ycmVzcG9uZGluZ1xuICogICAgZmllbGQgaXMgdW5tb2RpZmllZC5cbiAqICAqIFdoZW4gYSBmaWVsZCBpcyBpbiB0aGUgbWFzayBidXQgbm90IGluIHRoZSB2YWx1ZXMsIHRoZSBjb3JyZXNwb25kaW5nIGZpZWxkXG4gKiAgICBpcyBkZWxldGVkLlxuICogICogV2hlbiBhIGZpZWxkIGlzIG5vdCBpbiB0aGUgbWFzayBidXQgaXMgaW4gdGhlIHZhbHVlcywgdGhlIHZhbHVlcyBtYXAgaXNcbiAqICAgIGlnbm9yZWQuXG4gKi8gKHQsIGUsIG4pIDogdCBpbnN0YW5jZW9mIHhuID8gZnVuY3Rpb24odCwgZSwgbikge1xuICAgICAgICBpZiAoIVJuKHQucHJlY29uZGl0aW9uLCBlKSkgcmV0dXJuO1xuICAgICAgICBjb25zdCBzID0gTW4odC5maWVsZFRyYW5zZm9ybXMsIG4sIGUpLCBpID0gZS5kYXRhO1xuICAgICAgICBpLnNldEFsbChObih0KSksIGkuc2V0QWxsKHMpLCBlLmNvbnZlcnRUb0ZvdW5kRG9jdW1lbnQoRG4oZSksIGkpLnNldEhhc0xvY2FsTXV0YXRpb25zKCk7XG4gICAgfVxuICAgIC8qKlxuICogUmV0dXJucyBhIEZpZWxkUGF0aC9WYWx1ZSBtYXAgd2l0aCB0aGUgY29udGVudCBvZiB0aGUgUGF0Y2hNdXRhdGlvbi5cbiAqLyAodCwgZSwgbikgOiBmdW5jdGlvbih0LCBlKSB7XG4gICAgICAgIFJuKHQucHJlY29uZGl0aW9uLCBlKSAmJiBcbiAgICAgICAgLy8gV2UgZG9uJ3QgY2FsbCBgc2V0SGFzTG9jYWxNdXRhdGlvbnMoKWAgc2luY2Ugd2Ugd2FudCB0byBiZSBiYWNrd2FyZHNcbiAgICAgICAgLy8gY29tcGF0aWJsZSB3aXRoIHRoZSBleGlzdGluZyBTREsgYmVoYXZpb3IuXG4gICAgICAgIGUuY29udmVydFRvTm9Eb2N1bWVudChjdC5taW4oKSk7XG4gICAgfVxuICAgIC8qKlxuICogQSBtdXRhdGlvbiB0aGF0IHZlcmlmaWVzIHRoZSBleGlzdGVuY2Ugb2YgdGhlIGRvY3VtZW50IGF0IHRoZSBnaXZlbiBrZXkgd2l0aFxuICogdGhlIHByb3ZpZGVkIHByZWNvbmRpdGlvbi5cbiAqXG4gKiBUaGUgYHZlcmlmeWAgb3BlcmF0aW9uIGlzIG9ubHkgdXNlZCBpbiBUcmFuc2FjdGlvbnMsIGFuZCB0aGlzIGNsYXNzIHNlcnZlc1xuICogcHJpbWFyaWx5IHRvIGZhY2lsaXRhdGUgc2VyaWFsaXphdGlvbiBpbnRvIHByb3Rvcy5cbiAqLyAodCwgZSk7XG59XG5cbi8qKlxuICogSWYgdGhpcyBtdXRhdGlvbiBpcyBub3QgaWRlbXBvdGVudCwgcmV0dXJucyB0aGUgYmFzZSB2YWx1ZSB0byBwZXJzaXN0IHdpdGhcbiAqIHRoaXMgbXV0YXRpb24uIElmIGEgYmFzZSB2YWx1ZSBpcyByZXR1cm5lZCwgdGhlIG11dGF0aW9uIGlzIGFsd2F5cyBhcHBsaWVkXG4gKiB0byB0aGlzIGJhc2UgdmFsdWUsIGV2ZW4gaWYgZG9jdW1lbnQgaGFzIGFscmVhZHkgYmVlbiB1cGRhdGVkLlxuICpcbiAqIFRoZSBiYXNlIHZhbHVlIGlzIGEgc3BhcnNlIG9iamVjdCB0aGF0IGNvbnNpc3RzIG9mIG9ubHkgdGhlIGRvY3VtZW50XG4gKiBmaWVsZHMgZm9yIHdoaWNoIHRoaXMgbXV0YXRpb24gY29udGFpbnMgYSBub24taWRlbXBvdGVudCB0cmFuc2Zvcm1hdGlvblxuICogKGUuZy4gYSBudW1lcmljIGluY3JlbWVudCkuIFRoZSBwcm92aWRlZCB2YWx1ZSBndWFyYW50ZWVzIGNvbnNpc3RlbnRcbiAqIGJlaGF2aW9yIGZvciBub24taWRlbXBvdGVudCB0cmFuc2Zvcm1zIGFuZCBhbGxvdyB1cyB0byByZXR1cm4gdGhlIHNhbWVcbiAqIGxhdGVuY3ktY29tcGVuc2F0ZWQgdmFsdWUgZXZlbiBpZiB0aGUgYmFja2VuZCBoYXMgYWxyZWFkeSBhcHBsaWVkIHRoZVxuICogbXV0YXRpb24uIFRoZSBiYXNlIHZhbHVlIGlzIG51bGwgZm9yIGlkZW1wb3RlbnQgbXV0YXRpb25zLCBhcyB0aGV5IGNhbiBiZVxuICogcmUtcGxheWVkIGV2ZW4gaWYgdGhlIGJhY2tlbmQgaGFzIGFscmVhZHkgYXBwbGllZCB0aGVtLlxuICpcbiAqIEByZXR1cm5zIGEgYmFzZSB2YWx1ZSB0byBzdG9yZSBhbG9uZyB3aXRoIHRoZSBtdXRhdGlvbiwgb3IgbnVsbCBmb3JcbiAqIGlkZW1wb3RlbnQgbXV0YXRpb25zLlxuICovIGZ1bmN0aW9uIHZuKHQsIGUpIHtcbiAgICBsZXQgbiA9IG51bGw7XG4gICAgZm9yIChjb25zdCBzIG9mIHQuZmllbGRUcmFuc2Zvcm1zKSB7XG4gICAgICAgIGNvbnN0IHQgPSBlLmRhdGEuZmllbGQocy5maWVsZCksIGkgPSBsbihzLnRyYW5zZm9ybSwgdCB8fCBudWxsKTtcbiAgICAgICAgbnVsbCAhPSBpICYmIChudWxsID09IG4gJiYgKG4gPSB0ZS5lbXB0eSgpKSwgbi5zZXQocy5maWVsZCwgaSkpO1xuICAgIH1cbiAgICByZXR1cm4gbiB8fCBudWxsO1xufVxuXG5mdW5jdGlvbiBTbih0LCBlKSB7XG4gICAgcmV0dXJuIHQudHlwZSA9PT0gZS50eXBlICYmICghIXQua2V5LmlzRXF1YWwoZS5rZXkpICYmICghIXQucHJlY29uZGl0aW9uLmlzRXF1YWwoZS5wcmVjb25kaXRpb24pICYmICghIWZ1bmN0aW9uKHQsIGUpIHtcbiAgICAgICAgcmV0dXJuIHZvaWQgMCA9PT0gdCAmJiB2b2lkIDAgPT09IGUgfHwgISghdCB8fCAhZSkgJiYgb3QodCwgZSwgKCh0LCBlKSA9PiBUbih0LCBlKSkpO1xuICAgIH0odC5maWVsZFRyYW5zZm9ybXMsIGUuZmllbGRUcmFuc2Zvcm1zKSAmJiAoMCAvKiBTZXQgKi8gPT09IHQudHlwZSA/IHQudmFsdWUuaXNFcXVhbChlLnZhbHVlKSA6IDEgLyogUGF0Y2ggKi8gIT09IHQudHlwZSB8fCB0LmRhdGEuaXNFcXVhbChlLmRhdGEpICYmIHQuZmllbGRNYXNrLmlzRXF1YWwoZS5maWVsZE1hc2spKSkpKTtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIHRoZSB2ZXJzaW9uIGZyb20gdGhlIGdpdmVuIGRvY3VtZW50IGZvciB1c2UgYXMgdGhlIHJlc3VsdCBvZiBhXG4gKiBtdXRhdGlvbi4gTXV0YXRpb25zIGFyZSBkZWZpbmVkIHRvIHJldHVybiB0aGUgdmVyc2lvbiBvZiB0aGUgYmFzZSBkb2N1bWVudFxuICogb25seSBpZiBpdCBpcyBhbiBleGlzdGluZyBkb2N1bWVudC4gRGVsZXRlZCBhbmQgdW5rbm93biBkb2N1bWVudHMgaGF2ZSBhXG4gKiBwb3N0LW11dGF0aW9uIHZlcnNpb24gb2YgU25hcHNob3RWZXJzaW9uLm1pbigpLlxuICovIGZ1bmN0aW9uIERuKHQpIHtcbiAgICByZXR1cm4gdC5pc0ZvdW5kRG9jdW1lbnQoKSA/IHQudmVyc2lvbiA6IGN0Lm1pbigpO1xufVxuXG4vKipcbiAqIEEgbXV0YXRpb24gdGhhdCBjcmVhdGVzIG9yIHJlcGxhY2VzIHRoZSBkb2N1bWVudCBhdCB0aGUgZ2l2ZW4ga2V5IHdpdGggdGhlXG4gKiBvYmplY3QgdmFsdWUgY29udGVudHMuXG4gKi8gY2xhc3MgQ24gZXh0ZW5kcyBibiB7XG4gICAgY29uc3RydWN0b3IodCwgZSwgbiwgcyA9IFtdKSB7XG4gICAgICAgIHN1cGVyKCksIHRoaXMua2V5ID0gdCwgdGhpcy52YWx1ZSA9IGUsIHRoaXMucHJlY29uZGl0aW9uID0gbiwgdGhpcy5maWVsZFRyYW5zZm9ybXMgPSBzLCBcbiAgICAgICAgdGhpcy50eXBlID0gMCAvKiBTZXQgKi87XG4gICAgfVxufVxuXG5jbGFzcyB4biBleHRlbmRzIGJuIHtcbiAgICBjb25zdHJ1Y3Rvcih0LCBlLCBuLCBzLCBpID0gW10pIHtcbiAgICAgICAgc3VwZXIoKSwgdGhpcy5rZXkgPSB0LCB0aGlzLmRhdGEgPSBlLCB0aGlzLmZpZWxkTWFzayA9IG4sIHRoaXMucHJlY29uZGl0aW9uID0gcywgXG4gICAgICAgIHRoaXMuZmllbGRUcmFuc2Zvcm1zID0gaSwgdGhpcy50eXBlID0gMSAvKiBQYXRjaCAqLztcbiAgICB9XG59XG5cbmZ1bmN0aW9uIE5uKHQpIHtcbiAgICBjb25zdCBlID0gbmV3IE1hcDtcbiAgICByZXR1cm4gdC5maWVsZE1hc2suZmllbGRzLmZvckVhY2goKG4gPT4ge1xuICAgICAgICBpZiAoIW4uaXNFbXB0eSgpKSB7XG4gICAgICAgICAgICBjb25zdCBzID0gdC5kYXRhLmZpZWxkKG4pO1xuICAgICAgICAgICAgZS5zZXQobiwgcyk7XG4gICAgICAgIH1cbiAgICB9KSksIGU7XG59XG5cbi8qKlxuICogQ3JlYXRlcyBhIGxpc3Qgb2YgXCJ0cmFuc2Zvcm0gcmVzdWx0c1wiIChhIHRyYW5zZm9ybSByZXN1bHQgaXMgYSBmaWVsZCB2YWx1ZVxuICogcmVwcmVzZW50aW5nIHRoZSByZXN1bHQgb2YgYXBwbHlpbmcgYSB0cmFuc2Zvcm0pIGZvciB1c2UgYWZ0ZXIgYSBtdXRhdGlvblxuICogY29udGFpbmluZyB0cmFuc2Zvcm1zIGhhcyBiZWVuIGFja25vd2xlZGdlZCBieSB0aGUgc2VydmVyLlxuICpcbiAqIEBwYXJhbSBmaWVsZFRyYW5zZm9ybXMgLSBUaGUgZmllbGQgdHJhbnNmb3JtcyB0byBhcHBseSB0aGUgcmVzdWx0IHRvLlxuICogQHBhcmFtIG11dGFibGVEb2N1bWVudCAtIFRoZSBjdXJyZW50IHN0YXRlIG9mIHRoZSBkb2N1bWVudCBhZnRlciBhcHBseWluZyBhbGxcbiAqIHByZXZpb3VzIG11dGF0aW9ucy5cbiAqIEBwYXJhbSBzZXJ2ZXJUcmFuc2Zvcm1SZXN1bHRzIC0gVGhlIHRyYW5zZm9ybSByZXN1bHRzIHJlY2VpdmVkIGJ5IHRoZSBzZXJ2ZXIuXG4gKiBAcmV0dXJucyBUaGUgdHJhbnNmb3JtIHJlc3VsdHMgbGlzdC5cbiAqLyBmdW5jdGlvbiBrbih0LCBlLCBuKSB7XG4gICAgY29uc3QgcyA9IG5ldyBNYXA7XG4gICAgVSh0Lmxlbmd0aCA9PT0gbi5sZW5ndGgpO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbi5sZW5ndGg7IGkrKykge1xuICAgICAgICBjb25zdCByID0gdFtpXSwgbyA9IHIudHJhbnNmb3JtLCB1ID0gZS5kYXRhLmZpZWxkKHIuZmllbGQpO1xuICAgICAgICBzLnNldChyLmZpZWxkLCBobihvLCB1LCBuW2ldKSk7XG4gICAgfVxuICAgIHJldHVybiBzO1xufVxuXG4vKipcbiAqIENyZWF0ZXMgYSBsaXN0IG9mIFwidHJhbnNmb3JtIHJlc3VsdHNcIiAoYSB0cmFuc2Zvcm0gcmVzdWx0IGlzIGEgZmllbGQgdmFsdWVcbiAqIHJlcHJlc2VudGluZyB0aGUgcmVzdWx0IG9mIGFwcGx5aW5nIGEgdHJhbnNmb3JtKSBmb3IgdXNlIHdoZW4gYXBwbHlpbmcgYVxuICogdHJhbnNmb3JtIGxvY2FsbHkuXG4gKlxuICogQHBhcmFtIGZpZWxkVHJhbnNmb3JtcyAtIFRoZSBmaWVsZCB0cmFuc2Zvcm1zIHRvIGFwcGx5IHRoZSByZXN1bHQgdG8uXG4gKiBAcGFyYW0gbG9jYWxXcml0ZVRpbWUgLSBUaGUgbG9jYWwgdGltZSBvZiB0aGUgbXV0YXRpb24gKHVzZWQgdG9cbiAqICAgICBnZW5lcmF0ZSBTZXJ2ZXJUaW1lc3RhbXBWYWx1ZXMpLlxuICogQHBhcmFtIG11dGFibGVEb2N1bWVudCAtIFRoZSBjdXJyZW50IHN0YXRlIG9mIHRoZSBkb2N1bWVudCBhZnRlciBhcHBseWluZyBhbGxcbiAqICAgICBwcmV2aW91cyBtdXRhdGlvbnMuXG4gKiBAcmV0dXJucyBUaGUgdHJhbnNmb3JtIHJlc3VsdHMgbGlzdC5cbiAqLyBmdW5jdGlvbiBNbih0LCBlLCBuKSB7XG4gICAgY29uc3QgcyA9IG5ldyBNYXA7XG4gICAgZm9yIChjb25zdCBpIG9mIHQpIHtcbiAgICAgICAgY29uc3QgdCA9IGkudHJhbnNmb3JtLCByID0gbi5kYXRhLmZpZWxkKGkuZmllbGQpO1xuICAgICAgICBzLnNldChpLmZpZWxkLCBjbih0LCByLCBlKSk7XG4gICAgfVxuICAgIHJldHVybiBzO1xufVxuXG4vKiogQSBtdXRhdGlvbiB0aGF0IGRlbGV0ZXMgdGhlIGRvY3VtZW50IGF0IHRoZSBnaXZlbiBrZXkuICovIGNsYXNzIE9uIGV4dGVuZHMgYm4ge1xuICAgIGNvbnN0cnVjdG9yKHQsIGUpIHtcbiAgICAgICAgc3VwZXIoKSwgdGhpcy5rZXkgPSB0LCB0aGlzLnByZWNvbmRpdGlvbiA9IGUsIHRoaXMudHlwZSA9IDIgLyogRGVsZXRlICovICwgdGhpcy5maWVsZFRyYW5zZm9ybXMgPSBbXTtcbiAgICB9XG59XG5cbmNsYXNzIEZuIGV4dGVuZHMgYm4ge1xuICAgIGNvbnN0cnVjdG9yKHQsIGUpIHtcbiAgICAgICAgc3VwZXIoKSwgdGhpcy5rZXkgPSB0LCB0aGlzLnByZWNvbmRpdGlvbiA9IGUsIHRoaXMudHlwZSA9IDMgLyogVmVyaWZ5ICovICwgdGhpcy5maWVsZFRyYW5zZm9ybXMgPSBbXTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovIGNsYXNzICRuIHtcbiAgICAvLyBUT0RPKGIvMzMwNzgxNjMpOiBqdXN0IHVzZSBzaW1wbGVzdCBmb3JtIG9mIGV4aXN0ZW5jZSBmaWx0ZXIgZm9yIG5vd1xuICAgIGNvbnN0cnVjdG9yKHQpIHtcbiAgICAgICAgdGhpcy5jb3VudCA9IHQ7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBFcnJvciBDb2RlcyBkZXNjcmliaW5nIHRoZSBkaWZmZXJlbnQgd2F5cyBHUlBDIGNhbiBmYWlsLiBUaGVzZSBhcmUgY29waWVkXG4gKiBkaXJlY3RseSBmcm9tIEdSUEMncyBzb3VyY2VzIGhlcmU6XG4gKlxuICogaHR0cHM6Ly9naXRodWIuY29tL2dycGMvZ3JwYy9ibG9iL2JjZWVjOTRlYTRmYzVmMDA4NWQ4MTIzNWQ4ZTFjMDY3OThkYzM0MWEvaW5jbHVkZS9ncnBjJTJCJTJCL2ltcGwvY29kZWdlbi9zdGF0dXNfY29kZV9lbnVtLmhcbiAqXG4gKiBJbXBvcnRhbnQhIFRoZSBuYW1lcyBvZiB0aGVzZSBpZGVudGlmaWVycyBtYXR0ZXIgYmVjYXVzZSB0aGUgc3RyaW5nIGZvcm1zXG4gKiBhcmUgdXNlZCBmb3IgcmV2ZXJzZSBsb29rdXBzIGZyb20gdGhlIHdlYmNoYW5uZWwgc3RyZWFtLiBEbyBOT1QgY2hhbmdlIHRoZVxuICogbmFtZXMgb2YgdGhlc2UgaWRlbnRpZmllcnMgb3IgY2hhbmdlIHRoaXMgaW50byBhIGNvbnN0IGVudW0uXG4gKi8gdmFyIEJuLCBMbjtcblxuLyoqXG4gKiBEZXRlcm1pbmVzIHdoZXRoZXIgYW4gZXJyb3IgY29kZSByZXByZXNlbnRzIGEgcGVybWFuZW50IGVycm9yIHdoZW4gcmVjZWl2ZWRcbiAqIGluIHJlc3BvbnNlIHRvIGEgbm9uLXdyaXRlIG9wZXJhdGlvbi5cbiAqXG4gKiBTZWUgaXNQZXJtYW5lbnRXcml0ZUVycm9yIGZvciBjbGFzc2lmeWluZyB3cml0ZSBlcnJvcnMuXG4gKi9cbmZ1bmN0aW9uIFVuKHQpIHtcbiAgICBzd2l0Y2ggKHQpIHtcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJldHVybiBMKCk7XG5cbiAgICAgIGNhc2UgRy5DQU5DRUxMRUQ6XG4gICAgICBjYXNlIEcuVU5LTk9XTjpcbiAgICAgIGNhc2UgRy5ERUFETElORV9FWENFRURFRDpcbiAgICAgIGNhc2UgRy5SRVNPVVJDRV9FWEhBVVNURUQ6XG4gICAgICBjYXNlIEcuSU5URVJOQUw6XG4gICAgICBjYXNlIEcuVU5BVkFJTEFCTEU6XG4gLy8gVW5hdXRoZW50aWNhdGVkIG1lYW5zIHNvbWV0aGluZyB3ZW50IHdyb25nIHdpdGggb3VyIHRva2VuIGFuZCB3ZSBuZWVkXG4gICAgICAgIC8vIHRvIHJldHJ5IHdpdGggbmV3IGNyZWRlbnRpYWxzIHdoaWNoIHdpbGwgaGFwcGVuIGF1dG9tYXRpY2FsbHkuXG4gICAgICAgICAgICAgIGNhc2UgRy5VTkFVVEhFTlRJQ0FURUQ6XG4gICAgICAgIHJldHVybiAhMTtcblxuICAgICAgY2FzZSBHLklOVkFMSURfQVJHVU1FTlQ6XG4gICAgICBjYXNlIEcuTk9UX0ZPVU5EOlxuICAgICAgY2FzZSBHLkFMUkVBRFlfRVhJU1RTOlxuICAgICAgY2FzZSBHLlBFUk1JU1NJT05fREVOSUVEOlxuICAgICAgY2FzZSBHLkZBSUxFRF9QUkVDT05ESVRJT046XG4gLy8gQWJvcnRlZCBtaWdodCBiZSByZXRyaWVkIGluIHNvbWUgc2NlbmFyaW9zLCBidXQgdGhhdCBpcyBkZXBlbmRhbnQgb25cbiAgICAgICAgLy8gdGhlIGNvbnRleHQgYW5kIHNob3VsZCBoYW5kbGVkIGluZGl2aWR1YWxseSBieSB0aGUgY2FsbGluZyBjb2RlLlxuICAgICAgICAvLyBTZWUgaHR0cHM6Ly9jbG91ZC5nb29nbGUuY29tL2FwaXMvZGVzaWduL2Vycm9ycy5cbiAgICAgICAgICAgICAgY2FzZSBHLkFCT1JURUQ6XG4gICAgICBjYXNlIEcuT1VUX09GX1JBTkdFOlxuICAgICAgY2FzZSBHLlVOSU1QTEVNRU5URUQ6XG4gICAgICBjYXNlIEcuREFUQV9MT1NTOlxuICAgICAgICByZXR1cm4gITA7XG4gICAgfVxufVxuXG4vKipcbiAqIERldGVybWluZXMgd2hldGhlciBhbiBlcnJvciBjb2RlIHJlcHJlc2VudHMgYSBwZXJtYW5lbnQgZXJyb3Igd2hlbiByZWNlaXZlZFxuICogaW4gcmVzcG9uc2UgdG8gYSB3cml0ZSBvcGVyYXRpb24uXG4gKlxuICogV3JpdGUgb3BlcmF0aW9ucyBtdXN0IGJlIGhhbmRsZWQgc3BlY2lhbGx5IGJlY2F1c2UgYXMgb2YgYi8xMTk0Mzc3NjQsIEFCT1JURURcbiAqIGVycm9ycyBvbiB0aGUgd3JpdGUgc3RyZWFtIHNob3VsZCBiZSByZXRyaWVkIHRvbyAoZXZlbiB0aG91Z2ggQUJPUlRFRCBlcnJvcnNcbiAqIGFyZSBub3QgZ2VuZXJhbGx5IHJldHJ5YWJsZSkuXG4gKlxuICogTm90ZSB0aGF0IGR1cmluZyB0aGUgaW5pdGlhbCBoYW5kc2hha2Ugb24gdGhlIHdyaXRlIHN0cmVhbSBhbiBBQk9SVEVEIGVycm9yXG4gKiBzaWduYWxzIHRoYXQgd2Ugc2hvdWxkIGRpc2NhcmQgb3VyIHN0cmVhbSB0b2tlbiAoaS5lLiBpdCBpcyBwZXJtYW5lbnQpLiBUaGlzXG4gKiBtZWFucyBhIGhhbmRzaGFrZSBlcnJvciBzaG91bGQgYmUgY2xhc3NpZmllZCB3aXRoIGlzUGVybWFuZW50RXJyb3IsIGFib3ZlLlxuICovXG4vKipcbiAqIE1hcHMgYW4gZXJyb3IgQ29kZSBmcm9tIEdSUEMgc3RhdHVzIGNvZGUgbnVtYmVyLCBsaWtlIDAsIDEsIG9yIDE0LiBUaGVzZVxuICogYXJlIG5vdCB0aGUgc2FtZSBhcyBIVFRQIHN0YXR1cyBjb2Rlcy5cbiAqXG4gKiBAcmV0dXJucyBUaGUgQ29kZSBlcXVpdmFsZW50IHRvIHRoZSBnaXZlbiBHUlBDIHN0YXR1cyBjb2RlLiBGYWlscyBpZiB0aGVyZVxuICogICAgIGlzIG5vIG1hdGNoLlxuICovXG5mdW5jdGlvbiBxbih0KSB7XG4gICAgaWYgKHZvaWQgMCA9PT0gdCkgXG4gICAgLy8gVGhpcyBzaG91bGRuJ3Qgbm9ybWFsbHkgaGFwcGVuLCBidXQgaW4gY2VydGFpbiBlcnJvciBjYXNlcyAobGlrZSB0cnlpbmdcbiAgICAvLyB0byBzZW5kIGludmFsaWQgcHJvdG8gbWVzc2FnZXMpIHdlIG1heSBnZXQgYW4gZXJyb3Igd2l0aCBubyBHUlBDIGNvZGUuXG4gICAgcmV0dXJuIEYoXCJHUlBDIGVycm9yIGhhcyBubyAuY29kZVwiKSwgRy5VTktOT1dOO1xuICAgIHN3aXRjaCAodCkge1xuICAgICAgY2FzZSBCbi5PSzpcbiAgICAgICAgcmV0dXJuIEcuT0s7XG5cbiAgICAgIGNhc2UgQm4uQ0FOQ0VMTEVEOlxuICAgICAgICByZXR1cm4gRy5DQU5DRUxMRUQ7XG5cbiAgICAgIGNhc2UgQm4uVU5LTk9XTjpcbiAgICAgICAgcmV0dXJuIEcuVU5LTk9XTjtcblxuICAgICAgY2FzZSBCbi5ERUFETElORV9FWENFRURFRDpcbiAgICAgICAgcmV0dXJuIEcuREVBRExJTkVfRVhDRUVERUQ7XG5cbiAgICAgIGNhc2UgQm4uUkVTT1VSQ0VfRVhIQVVTVEVEOlxuICAgICAgICByZXR1cm4gRy5SRVNPVVJDRV9FWEhBVVNURUQ7XG5cbiAgICAgIGNhc2UgQm4uSU5URVJOQUw6XG4gICAgICAgIHJldHVybiBHLklOVEVSTkFMO1xuXG4gICAgICBjYXNlIEJuLlVOQVZBSUxBQkxFOlxuICAgICAgICByZXR1cm4gRy5VTkFWQUlMQUJMRTtcblxuICAgICAgY2FzZSBCbi5VTkFVVEhFTlRJQ0FURUQ6XG4gICAgICAgIHJldHVybiBHLlVOQVVUSEVOVElDQVRFRDtcblxuICAgICAgY2FzZSBCbi5JTlZBTElEX0FSR1VNRU5UOlxuICAgICAgICByZXR1cm4gRy5JTlZBTElEX0FSR1VNRU5UO1xuXG4gICAgICBjYXNlIEJuLk5PVF9GT1VORDpcbiAgICAgICAgcmV0dXJuIEcuTk9UX0ZPVU5EO1xuXG4gICAgICBjYXNlIEJuLkFMUkVBRFlfRVhJU1RTOlxuICAgICAgICByZXR1cm4gRy5BTFJFQURZX0VYSVNUUztcblxuICAgICAgY2FzZSBCbi5QRVJNSVNTSU9OX0RFTklFRDpcbiAgICAgICAgcmV0dXJuIEcuUEVSTUlTU0lPTl9ERU5JRUQ7XG5cbiAgICAgIGNhc2UgQm4uRkFJTEVEX1BSRUNPTkRJVElPTjpcbiAgICAgICAgcmV0dXJuIEcuRkFJTEVEX1BSRUNPTkRJVElPTjtcblxuICAgICAgY2FzZSBCbi5BQk9SVEVEOlxuICAgICAgICByZXR1cm4gRy5BQk9SVEVEO1xuXG4gICAgICBjYXNlIEJuLk9VVF9PRl9SQU5HRTpcbiAgICAgICAgcmV0dXJuIEcuT1VUX09GX1JBTkdFO1xuXG4gICAgICBjYXNlIEJuLlVOSU1QTEVNRU5URUQ6XG4gICAgICAgIHJldHVybiBHLlVOSU1QTEVNRU5URUQ7XG5cbiAgICAgIGNhc2UgQm4uREFUQV9MT1NTOlxuICAgICAgICByZXR1cm4gRy5EQVRBX0xPU1M7XG5cbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJldHVybiBMKCk7XG4gICAgfVxufVxuXG4vKipcbiAqIENvbnZlcnRzIGFuIEhUVFAgcmVzcG9uc2UncyBlcnJvciBzdGF0dXMgdG8gdGhlIGVxdWl2YWxlbnQgZXJyb3IgY29kZS5cbiAqXG4gKiBAcGFyYW0gc3RhdHVzIC0gQW4gSFRUUCBlcnJvciByZXNwb25zZSBzdGF0dXMgKFwiRkFJTEVEX1BSRUNPTkRJVElPTlwiLFxuICogXCJVTktOT1dOXCIsIGV0Yy4pXG4gKiBAcmV0dXJucyBUaGUgZXF1aXZhbGVudCBDb2RlLiBOb24tbWF0Y2hpbmcgcmVzcG9uc2VzIGFyZSBtYXBwZWQgdG9cbiAqICAgICBDb2RlLlVOS05PV04uXG4gKi8gKExuID0gQm4gfHwgKEJuID0ge30pKVtMbi5PSyA9IDBdID0gXCJPS1wiLCBMbltMbi5DQU5DRUxMRUQgPSAxXSA9IFwiQ0FOQ0VMTEVEXCIsIFxuTG5bTG4uVU5LTk9XTiA9IDJdID0gXCJVTktOT1dOXCIsIExuW0xuLklOVkFMSURfQVJHVU1FTlQgPSAzXSA9IFwiSU5WQUxJRF9BUkdVTUVOVFwiLCBcbkxuW0xuLkRFQURMSU5FX0VYQ0VFREVEID0gNF0gPSBcIkRFQURMSU5FX0VYQ0VFREVEXCIsIExuW0xuLk5PVF9GT1VORCA9IDVdID0gXCJOT1RfRk9VTkRcIiwgXG5MbltMbi5BTFJFQURZX0VYSVNUUyA9IDZdID0gXCJBTFJFQURZX0VYSVNUU1wiLCBMbltMbi5QRVJNSVNTSU9OX0RFTklFRCA9IDddID0gXCJQRVJNSVNTSU9OX0RFTklFRFwiLCBcbkxuW0xuLlVOQVVUSEVOVElDQVRFRCA9IDE2XSA9IFwiVU5BVVRIRU5USUNBVEVEXCIsIExuW0xuLlJFU09VUkNFX0VYSEFVU1RFRCA9IDhdID0gXCJSRVNPVVJDRV9FWEhBVVNURURcIiwgXG5MbltMbi5GQUlMRURfUFJFQ09ORElUSU9OID0gOV0gPSBcIkZBSUxFRF9QUkVDT05ESVRJT05cIiwgTG5bTG4uQUJPUlRFRCA9IDEwXSA9IFwiQUJPUlRFRFwiLCBcbkxuW0xuLk9VVF9PRl9SQU5HRSA9IDExXSA9IFwiT1VUX09GX1JBTkdFXCIsIExuW0xuLlVOSU1QTEVNRU5URUQgPSAxMl0gPSBcIlVOSU1QTEVNRU5URURcIiwgXG5MbltMbi5JTlRFUk5BTCA9IDEzXSA9IFwiSU5URVJOQUxcIiwgTG5bTG4uVU5BVkFJTEFCTEUgPSAxNF0gPSBcIlVOQVZBSUxBQkxFXCIsIExuW0xuLkRBVEFfTE9TUyA9IDE1XSA9IFwiREFUQV9MT1NTXCI7XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEEgbWFwIGltcGxlbWVudGF0aW9uIHRoYXQgdXNlcyBvYmplY3RzIGFzIGtleXMuIE9iamVjdHMgbXVzdCBoYXZlIGFuXG4gKiBhc3NvY2lhdGVkIGVxdWFscyBmdW5jdGlvbiBhbmQgbXVzdCBiZSBpbW11dGFibGUuIEVudHJpZXMgaW4gdGhlIG1hcCBhcmVcbiAqIHN0b3JlZCB0b2dldGhlciB3aXRoIHRoZSBrZXkgYmVpbmcgcHJvZHVjZWQgZnJvbSB0aGUgbWFwS2V5Rm4uIFRoaXMgbWFwXG4gKiBhdXRvbWF0aWNhbGx5IGhhbmRsZXMgY29sbGlzaW9ucyBvZiBrZXlzLlxuICovXG5jbGFzcyBLbiB7XG4gICAgY29uc3RydWN0b3IodCwgZSkge1xuICAgICAgICB0aGlzLm1hcEtleUZuID0gdCwgdGhpcy5lcXVhbHNGbiA9IGUsIFxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGlubmVyIG1hcCBmb3IgYSBrZXkvdmFsdWUgcGFpci4gRHVlIHRvIHRoZSBwb3NzaWJpbGl0eSBvZiBjb2xsaXNpb25zIHdlXG4gICAgICAgICAqIGtlZXAgYSBsaXN0IG9mIGVudHJpZXMgdGhhdCB3ZSBkbyBhIGxpbmVhciBzZWFyY2ggdGhyb3VnaCB0byBmaW5kIGFuIGFjdHVhbFxuICAgICAgICAgKiBtYXRjaC4gTm90ZSB0aGF0IGNvbGxpc2lvbnMgc2hvdWxkIGJlIHJhcmUsIHNvIHdlIHN0aWxsIGV4cGVjdCBuZWFyXG4gICAgICAgICAqIGNvbnN0YW50IHRpbWUgbG9va3VwcyBpbiBwcmFjdGljZS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuaW5uZXIgPSB7fSwgXG4gICAgICAgIC8qKiBUaGUgbnVtYmVyIG9mIGVudHJpZXMgc3RvcmVkIGluIHRoZSBtYXAgKi9cbiAgICAgICAgdGhpcy5pbm5lclNpemUgPSAwO1xuICAgIH1cbiAgICAvKiogR2V0IGEgdmFsdWUgZm9yIHRoaXMga2V5LCBvciB1bmRlZmluZWQgaWYgaXQgZG9lcyBub3QgZXhpc3QuICovICAgIGdldCh0KSB7XG4gICAgICAgIGNvbnN0IGUgPSB0aGlzLm1hcEtleUZuKHQpLCBuID0gdGhpcy5pbm5lcltlXTtcbiAgICAgICAgaWYgKHZvaWQgMCAhPT0gbikgZm9yIChjb25zdCBbZSwgc10gb2YgbikgaWYgKHRoaXMuZXF1YWxzRm4oZSwgdCkpIHJldHVybiBzO1xuICAgIH1cbiAgICBoYXModCkge1xuICAgICAgICByZXR1cm4gdm9pZCAwICE9PSB0aGlzLmdldCh0KTtcbiAgICB9XG4gICAgLyoqIFB1dCB0aGlzIGtleSBhbmQgdmFsdWUgaW4gdGhlIG1hcC4gKi8gICAgc2V0KHQsIGUpIHtcbiAgICAgICAgY29uc3QgbiA9IHRoaXMubWFwS2V5Rm4odCksIHMgPSB0aGlzLmlubmVyW25dO1xuICAgICAgICBpZiAodm9pZCAwID09PSBzKSByZXR1cm4gdGhpcy5pbm5lcltuXSA9IFsgWyB0LCBlIF0gXSwgdm9pZCB0aGlzLmlubmVyU2l6ZSsrO1xuICAgICAgICBmb3IgKGxldCBuID0gMDsgbiA8IHMubGVuZ3RoOyBuKyspIGlmICh0aGlzLmVxdWFsc0ZuKHNbbl1bMF0sIHQpKSBcbiAgICAgICAgLy8gVGhpcyBpcyB1cGRhdGluZyBhbiBleGlzdGluZyBlbnRyeSBhbmQgZG9lcyBub3QgaW5jcmVhc2UgYGlubmVyU2l6ZWAuXG4gICAgICAgIHJldHVybiB2b2lkIChzW25dID0gWyB0LCBlIF0pO1xuICAgICAgICBzLnB1c2goWyB0LCBlIF0pLCB0aGlzLmlubmVyU2l6ZSsrO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZW1vdmUgdGhpcyBrZXkgZnJvbSB0aGUgbWFwLiBSZXR1cm5zIGEgYm9vbGVhbiBpZiBhbnl0aGluZyB3YXMgZGVsZXRlZC5cbiAgICAgKi8gICAgZGVsZXRlKHQpIHtcbiAgICAgICAgY29uc3QgZSA9IHRoaXMubWFwS2V5Rm4odCksIG4gPSB0aGlzLmlubmVyW2VdO1xuICAgICAgICBpZiAodm9pZCAwID09PSBuKSByZXR1cm4gITE7XG4gICAgICAgIGZvciAobGV0IHMgPSAwOyBzIDwgbi5sZW5ndGg7IHMrKykgaWYgKHRoaXMuZXF1YWxzRm4obltzXVswXSwgdCkpIHJldHVybiAxID09PSBuLmxlbmd0aCA/IGRlbGV0ZSB0aGlzLmlubmVyW2VdIDogbi5zcGxpY2UocywgMSksIFxuICAgICAgICB0aGlzLmlubmVyU2l6ZS0tLCAhMDtcbiAgICAgICAgcmV0dXJuICExO1xuICAgIH1cbiAgICBmb3JFYWNoKHQpIHtcbiAgICAgICAgbHQodGhpcy5pbm5lciwgKChlLCBuKSA9PiB7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IFtlLCBzXSBvZiBuKSB0KGUsIHMpO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIGlzRW1wdHkoKSB7XG4gICAgICAgIHJldHVybiBmdCh0aGlzLmlubmVyKTtcbiAgICB9XG4gICAgc2l6ZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaW5uZXJTaXplO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi8gY29uc3QgR24gPSBuZXcgZmUoeHQuY29tcGFyYXRvcik7XG5cbmZ1bmN0aW9uIFFuKCkge1xuICAgIHJldHVybiBHbjtcbn1cblxuY29uc3Qgam4gPSBuZXcgZmUoeHQuY29tcGFyYXRvcik7XG5cbmZ1bmN0aW9uIFduKC4uLnQpIHtcbiAgICBsZXQgZSA9IGpuO1xuICAgIGZvciAoY29uc3QgbiBvZiB0KSBlID0gZS5pbnNlcnQobi5rZXksIG4pO1xuICAgIHJldHVybiBlO1xufVxuXG5mdW5jdGlvbiB6bigpIHtcbiAgICByZXR1cm4gbmV3IEtuKCh0ID0+IHQudG9TdHJpbmcoKSksICgodCwgZSkgPT4gdC5pc0VxdWFsKGUpKSk7XG59XG5cbmNvbnN0IEhuID0gbmV3IGZlKHh0LmNvbXBhcmF0b3IpO1xuXG5jb25zdCBKbiA9IG5ldyB3ZSh4dC5jb21wYXJhdG9yKTtcblxuZnVuY3Rpb24gWW4oLi4udCkge1xuICAgIGxldCBlID0gSm47XG4gICAgZm9yIChjb25zdCBuIG9mIHQpIGUgPSBlLmFkZChuKTtcbiAgICByZXR1cm4gZTtcbn1cblxuY29uc3QgWG4gPSBuZXcgd2UocnQpO1xuXG5mdW5jdGlvbiBabigpIHtcbiAgICByZXR1cm4gWG47XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEFuIGV2ZW50IGZyb20gdGhlIFJlbW90ZVN0b3JlLiBJdCBpcyBzcGxpdCBpbnRvIHRhcmdldENoYW5nZXMgKGNoYW5nZXMgdG8gdGhlXG4gKiBzdGF0ZSBvciB0aGUgc2V0IG9mIGRvY3VtZW50cyBpbiBvdXIgd2F0Y2hlZCB0YXJnZXRzKSBhbmQgZG9jdW1lbnRVcGRhdGVzXG4gKiAoY2hhbmdlcyB0byB0aGUgYWN0dWFsIGRvY3VtZW50cykuXG4gKi8gY2xhc3MgdHMge1xuICAgIGNvbnN0cnVjdG9yKFxuICAgIC8qKlxuICAgICAqIFRoZSBzbmFwc2hvdCB2ZXJzaW9uIHRoaXMgZXZlbnQgYnJpbmdzIHVzIHVwIHRvLCBvciBNSU4gaWYgbm90IHNldC5cbiAgICAgKi9cbiAgICB0LCBcbiAgICAvKipcbiAgICAgKiBBIG1hcCBmcm9tIHRhcmdldCB0byBjaGFuZ2VzIHRvIHRoZSB0YXJnZXQuIFNlZSBUYXJnZXRDaGFuZ2UuXG4gICAgICovXG4gICAgZSwgXG4gICAgLyoqXG4gICAgICogQSBzZXQgb2YgdGFyZ2V0cyB0aGF0IGlzIGtub3duIHRvIGJlIGluY29uc2lzdGVudC4gTGlzdGVucyBmb3IgdGhlc2VcbiAgICAgKiB0YXJnZXRzIHNob3VsZCBiZSByZS1lc3RhYmxpc2hlZCB3aXRob3V0IHJlc3VtZSB0b2tlbnMuXG4gICAgICovXG4gICAgbiwgXG4gICAgLyoqXG4gICAgICogQSBzZXQgb2Ygd2hpY2ggZG9jdW1lbnRzIGhhdmUgY2hhbmdlZCBvciBiZWVuIGRlbGV0ZWQsIGFsb25nIHdpdGggdGhlXG4gICAgICogZG9jJ3MgbmV3IHZhbHVlcyAoaWYgbm90IGRlbGV0ZWQpLlxuICAgICAqL1xuICAgIHMsIFxuICAgIC8qKlxuICAgICAqIEEgc2V0IG9mIHdoaWNoIGRvY3VtZW50IHVwZGF0ZXMgYXJlIGR1ZSBvbmx5IHRvIGxpbWJvIHJlc29sdXRpb24gdGFyZ2V0cy5cbiAgICAgKi9cbiAgICBpKSB7XG4gICAgICAgIHRoaXMuc25hcHNob3RWZXJzaW9uID0gdCwgdGhpcy50YXJnZXRDaGFuZ2VzID0gZSwgdGhpcy50YXJnZXRNaXNtYXRjaGVzID0gbiwgdGhpcy5kb2N1bWVudFVwZGF0ZXMgPSBzLCBcbiAgICAgICAgdGhpcy5yZXNvbHZlZExpbWJvRG9jdW1lbnRzID0gaTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogSEFDSzogVmlld3MgcmVxdWlyZSBSZW1vdGVFdmVudHMgaW4gb3JkZXIgdG8gZGV0ZXJtaW5lIHdoZXRoZXIgdGhlIHZpZXcgaXNcbiAgICAgKiBDVVJSRU5ULCBidXQgc2Vjb25kYXJ5IHRhYnMgZG9uJ3QgcmVjZWl2ZSByZW1vdGUgZXZlbnRzLiBTbyB0aGlzIG1ldGhvZCBpc1xuICAgICAqIHVzZWQgdG8gY3JlYXRlIGEgc3ludGhlc2l6ZWQgUmVtb3RlRXZlbnQgdGhhdCBjYW4gYmUgdXNlZCB0byBhcHBseSBhXG4gICAgICogQ1VSUkVOVCBzdGF0dXMgY2hhbmdlIHRvIGEgVmlldywgZm9yIHF1ZXJpZXMgZXhlY3V0ZWQgaW4gYSBkaWZmZXJlbnQgdGFiLlxuICAgICAqL1xuICAgIC8vIFBPUlRJTkcgTk9URTogTXVsdGktdGFiIG9ubHlcbiAgICBzdGF0aWMgY3JlYXRlU3ludGhlc2l6ZWRSZW1vdGVFdmVudEZvckN1cnJlbnRDaGFuZ2UodCwgZSkge1xuICAgICAgICBjb25zdCBuID0gbmV3IE1hcDtcbiAgICAgICAgcmV0dXJuIG4uc2V0KHQsIGVzLmNyZWF0ZVN5bnRoZXNpemVkVGFyZ2V0Q2hhbmdlRm9yQ3VycmVudENoYW5nZSh0LCBlKSksIG5ldyB0cyhjdC5taW4oKSwgbiwgWm4oKSwgUW4oKSwgWW4oKSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEEgVGFyZ2V0Q2hhbmdlIHNwZWNpZmllcyB0aGUgc2V0IG9mIGNoYW5nZXMgZm9yIGEgc3BlY2lmaWMgdGFyZ2V0IGFzIHBhcnQgb2ZcbiAqIGEgUmVtb3RlRXZlbnQuIFRoZXNlIGNoYW5nZXMgdHJhY2sgd2hpY2ggZG9jdW1lbnRzIGFyZSBhZGRlZCwgbW9kaWZpZWQgb3JcbiAqIHJlbW92ZWQsIGFzIHdlbGwgYXMgdGhlIHRhcmdldCdzIHJlc3VtZSB0b2tlbiBhbmQgd2hldGhlciB0aGUgdGFyZ2V0IGlzXG4gKiBtYXJrZWQgQ1VSUkVOVC5cbiAqIFRoZSBhY3R1YWwgY2hhbmdlcyAqdG8qIGRvY3VtZW50cyBhcmUgbm90IHBhcnQgb2YgdGhlIFRhcmdldENoYW5nZSBzaW5jZVxuICogZG9jdW1lbnRzIG1heSBiZSBwYXJ0IG9mIG11bHRpcGxlIHRhcmdldHMuXG4gKi8gY2xhc3MgZXMge1xuICAgIGNvbnN0cnVjdG9yKFxuICAgIC8qKlxuICAgICAqIEFuIG9wYXF1ZSwgc2VydmVyLWFzc2lnbmVkIHRva2VuIHRoYXQgYWxsb3dzIHdhdGNoaW5nIGEgcXVlcnkgdG8gYmUgcmVzdW1lZFxuICAgICAqIGFmdGVyIGRpc2Nvbm5lY3Rpbmcgd2l0aG91dCByZXRyYW5zbWl0dGluZyBhbGwgdGhlIGRhdGEgdGhhdCBtYXRjaGVzIHRoZVxuICAgICAqIHF1ZXJ5LiBUaGUgcmVzdW1lIHRva2VuIGVzc2VudGlhbGx5IGlkZW50aWZpZXMgYSBwb2ludCBpbiB0aW1lIGZyb20gd2hpY2hcbiAgICAgKiB0aGUgc2VydmVyIHNob3VsZCByZXN1bWUgc2VuZGluZyByZXN1bHRzLlxuICAgICAqL1xuICAgIHQsIFxuICAgIC8qKlxuICAgICAqIFRoZSBcImN1cnJlbnRcIiAoc3luY2VkKSBzdGF0dXMgb2YgdGhpcyB0YXJnZXQuIE5vdGUgdGhhdCBcImN1cnJlbnRcIlxuICAgICAqIGhhcyBzcGVjaWFsIG1lYW5pbmcgaW4gdGhlIFJQQyBwcm90b2NvbCB0aGF0IGltcGxpZXMgdGhhdCBhIHRhcmdldCBpc1xuICAgICAqIGJvdGggdXAtdG8tZGF0ZSBhbmQgY29uc2lzdGVudCB3aXRoIHRoZSByZXN0IG9mIHRoZSB3YXRjaCBzdHJlYW0uXG4gICAgICovXG4gICAgZSwgXG4gICAgLyoqXG4gICAgICogVGhlIHNldCBvZiBkb2N1bWVudHMgdGhhdCB3ZXJlIG5ld2x5IGFzc2lnbmVkIHRvIHRoaXMgdGFyZ2V0IGFzIHBhcnQgb2ZcbiAgICAgKiB0aGlzIHJlbW90ZSBldmVudC5cbiAgICAgKi9cbiAgICBuLCBcbiAgICAvKipcbiAgICAgKiBUaGUgc2V0IG9mIGRvY3VtZW50cyB0aGF0IHdlcmUgYWxyZWFkeSBhc3NpZ25lZCB0byB0aGlzIHRhcmdldCBidXQgcmVjZWl2ZWRcbiAgICAgKiBhbiB1cGRhdGUgZHVyaW5nIHRoaXMgcmVtb3RlIGV2ZW50LlxuICAgICAqL1xuICAgIHMsIFxuICAgIC8qKlxuICAgICAqIFRoZSBzZXQgb2YgZG9jdW1lbnRzIHRoYXQgd2VyZSByZW1vdmVkIGZyb20gdGhpcyB0YXJnZXQgYXMgcGFydCBvZiB0aGlzXG4gICAgICogcmVtb3RlIGV2ZW50LlxuICAgICAqL1xuICAgIGkpIHtcbiAgICAgICAgdGhpcy5yZXN1bWVUb2tlbiA9IHQsIHRoaXMuY3VycmVudCA9IGUsIHRoaXMuYWRkZWREb2N1bWVudHMgPSBuLCB0aGlzLm1vZGlmaWVkRG9jdW1lbnRzID0gcywgXG4gICAgICAgIHRoaXMucmVtb3ZlZERvY3VtZW50cyA9IGk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFRoaXMgbWV0aG9kIGlzIHVzZWQgdG8gY3JlYXRlIGEgc3ludGhlc2l6ZWQgVGFyZ2V0Q2hhbmdlcyB0aGF0IGNhbiBiZSB1c2VkIHRvXG4gICAgICogYXBwbHkgYSBDVVJSRU5UIHN0YXR1cyBjaGFuZ2UgdG8gYSBWaWV3IChmb3IgcXVlcmllcyBleGVjdXRlZCBpbiBhIGRpZmZlcmVudFxuICAgICAqIHRhYikgb3IgZm9yIG5ldyBxdWVyaWVzICh0byByYWlzZSBzbmFwc2hvdHMgd2l0aCBjb3JyZWN0IENVUlJFTlQgc3RhdHVzKS5cbiAgICAgKi8gICAgc3RhdGljIGNyZWF0ZVN5bnRoZXNpemVkVGFyZ2V0Q2hhbmdlRm9yQ3VycmVudENoYW5nZSh0LCBlKSB7XG4gICAgICAgIHJldHVybiBuZXcgZXMocHQuRU1QVFlfQllURV9TVFJJTkcsIGUsIFluKCksIFluKCksIFluKCkpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogUmVwcmVzZW50cyBhIGNoYW5nZWQgZG9jdW1lbnQgYW5kIGEgbGlzdCBvZiB0YXJnZXQgaWRzIHRvIHdoaWNoIHRoaXMgY2hhbmdlXG4gKiBhcHBsaWVzLlxuICpcbiAqIElmIGRvY3VtZW50IGhhcyBiZWVuIGRlbGV0ZWQgTm9Eb2N1bWVudCB3aWxsIGJlIHByb3ZpZGVkLlxuICovIGNsYXNzIG5zIHtcbiAgICBjb25zdHJ1Y3RvcihcbiAgICAvKiogVGhlIG5ldyBkb2N1bWVudCBhcHBsaWVzIHRvIGFsbCBvZiB0aGVzZSB0YXJnZXRzLiAqL1xuICAgIHQsIFxuICAgIC8qKiBUaGUgbmV3IGRvY3VtZW50IGlzIHJlbW92ZWQgZnJvbSBhbGwgb2YgdGhlc2UgdGFyZ2V0cy4gKi9cbiAgICBlLCBcbiAgICAvKiogVGhlIGtleSBvZiB0aGUgZG9jdW1lbnQgZm9yIHRoaXMgY2hhbmdlLiAqL1xuICAgIG4sIFxuICAgIC8qKlxuICAgICAqIFRoZSBuZXcgZG9jdW1lbnQgb3IgTm9Eb2N1bWVudCBpZiBpdCB3YXMgZGVsZXRlZC4gSXMgbnVsbCBpZiB0aGVcbiAgICAgKiBkb2N1bWVudCB3ZW50IG91dCBvZiB2aWV3IHdpdGhvdXQgdGhlIHNlcnZlciBzZW5kaW5nIGEgbmV3IGRvY3VtZW50LlxuICAgICAqL1xuICAgIHMpIHtcbiAgICAgICAgdGhpcy5PID0gdCwgdGhpcy5yZW1vdmVkVGFyZ2V0SWRzID0gZSwgdGhpcy5rZXkgPSBuLCB0aGlzLkYgPSBzO1xuICAgIH1cbn1cblxuY2xhc3Mgc3Mge1xuICAgIGNvbnN0cnVjdG9yKHQsIGUpIHtcbiAgICAgICAgdGhpcy50YXJnZXRJZCA9IHQsIHRoaXMuJCA9IGU7XG4gICAgfVxufVxuXG5jbGFzcyBpcyB7XG4gICAgY29uc3RydWN0b3IoXG4gICAgLyoqIFdoYXQga2luZCBvZiBjaGFuZ2Ugb2NjdXJyZWQgdG8gdGhlIHdhdGNoIHRhcmdldC4gKi9cbiAgICB0LCBcbiAgICAvKiogVGhlIHRhcmdldCBJRHMgdGhhdCB3ZXJlIGFkZGVkL3JlbW92ZWQvc2V0LiAqL1xuICAgIGUsIFxuICAgIC8qKlxuICAgICAqIEFuIG9wYXF1ZSwgc2VydmVyLWFzc2lnbmVkIHRva2VuIHRoYXQgYWxsb3dzIHdhdGNoaW5nIGEgdGFyZ2V0IHRvIGJlXG4gICAgICogcmVzdW1lZCBhZnRlciBkaXNjb25uZWN0aW5nIHdpdGhvdXQgcmV0cmFuc21pdHRpbmcgYWxsIHRoZSBkYXRhIHRoYXRcbiAgICAgKiBtYXRjaGVzIHRoZSB0YXJnZXQuIFRoZSByZXN1bWUgdG9rZW4gZXNzZW50aWFsbHkgaWRlbnRpZmllcyBhIHBvaW50IGluXG4gICAgICogdGltZSBmcm9tIHdoaWNoIHRoZSBzZXJ2ZXIgc2hvdWxkIHJlc3VtZSBzZW5kaW5nIHJlc3VsdHMuXG4gICAgICovXG4gICAgbiA9IHB0LkVNUFRZX0JZVEVfU1RSSU5HXG4gICAgLyoqIEFuIFJQQyBlcnJvciBpbmRpY2F0aW5nIHdoeSB0aGUgd2F0Y2ggZmFpbGVkLiAqLyAsIHMgPSBudWxsKSB7XG4gICAgICAgIHRoaXMuc3RhdGUgPSB0LCB0aGlzLnRhcmdldElkcyA9IGUsIHRoaXMucmVzdW1lVG9rZW4gPSBuLCB0aGlzLmNhdXNlID0gcztcbiAgICB9XG59XG5cbi8qKiBUcmFja3MgdGhlIGludGVybmFsIHN0YXRlIG9mIGEgV2F0Y2ggdGFyZ2V0LiAqLyBjbGFzcyBycyB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgbnVtYmVyIG9mIHBlbmRpbmcgcmVzcG9uc2VzIChhZGRzIG9yIHJlbW92ZXMpIHRoYXQgd2UgYXJlIHdhaXRpbmcgb24uXG4gICAgICAgICAqIFdlIG9ubHkgY29uc2lkZXIgdGFyZ2V0cyBhY3RpdmUgdGhhdCBoYXZlIG5vIHBlbmRpbmcgcmVzcG9uc2VzLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5CID0gMCwgXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBLZWVwcyB0cmFjayBvZiB0aGUgZG9jdW1lbnQgY2hhbmdlcyBzaW5jZSB0aGUgbGFzdCByYWlzZWQgc25hcHNob3QuXG4gICAgICAgICAqXG4gICAgICAgICAqIFRoZXNlIGNoYW5nZXMgYXJlIGNvbnRpbnVvdXNseSB1cGRhdGVkIGFzIHdlIHJlY2VpdmUgZG9jdW1lbnQgdXBkYXRlcyBhbmRcbiAgICAgICAgICogYWx3YXlzIHJlZmxlY3QgdGhlIGN1cnJlbnQgc2V0IG9mIGNoYW5nZXMgYWdhaW5zdCB0aGUgbGFzdCBpc3N1ZWQgc25hcHNob3QuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLkwgPSBhcygpLCBcbiAgICAgICAgLyoqIFNlZSBwdWJsaWMgZ2V0dGVycyBmb3IgZXhwbGFuYXRpb25zIG9mIHRoZXNlIGZpZWxkcy4gKi9cbiAgICAgICAgdGhpcy5VID0gcHQuRU1QVFlfQllURV9TVFJJTkcsIHRoaXMucSA9ICExLCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFdoZXRoZXIgdGhpcyB0YXJnZXQgc3RhdGUgc2hvdWxkIGJlIGluY2x1ZGVkIGluIHRoZSBuZXh0IHNuYXBzaG90LiBXZVxuICAgICAgICAgKiBpbml0aWFsaXplIHRvIHRydWUgc28gdGhhdCBuZXdseS1hZGRlZCB0YXJnZXRzIGFyZSBpbmNsdWRlZCBpbiB0aGUgbmV4dFxuICAgICAgICAgKiBSZW1vdGVFdmVudC5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuSyA9ICEwO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBXaGV0aGVyIHRoaXMgdGFyZ2V0IGhhcyBiZWVuIG1hcmtlZCAnY3VycmVudCcuXG4gICAgICpcbiAgICAgKiAnQ3VycmVudCcgaGFzIHNwZWNpYWwgbWVhbmluZyBpbiB0aGUgUlBDIHByb3RvY29sOiBJdCBpbXBsaWVzIHRoYXQgdGhlXG4gICAgICogV2F0Y2ggYmFja2VuZCBoYXMgc2VudCB1cyBhbGwgY2hhbmdlcyB1cCB0byB0aGUgcG9pbnQgYXQgd2hpY2ggdGhlIHRhcmdldFxuICAgICAqIHdhcyBhZGRlZCBhbmQgdGhhdCB0aGUgdGFyZ2V0IGlzIGNvbnNpc3RlbnQgd2l0aCB0aGUgcmVzdCBvZiB0aGUgd2F0Y2hcbiAgICAgKiBzdHJlYW0uXG4gICAgICovICAgIGdldCBjdXJyZW50KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5xO1xuICAgIH1cbiAgICAvKiogVGhlIGxhc3QgcmVzdW1lIHRva2VuIHNlbnQgdG8gdXMgZm9yIHRoaXMgdGFyZ2V0LiAqLyAgICBnZXQgcmVzdW1lVG9rZW4oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLlU7XG4gICAgfVxuICAgIC8qKiBXaGV0aGVyIHRoaXMgdGFyZ2V0IGhhcyBwZW5kaW5nIHRhcmdldCBhZGRzIG9yIHRhcmdldCByZW1vdmVzLiAqLyAgICBnZXQgRygpIHtcbiAgICAgICAgcmV0dXJuIDAgIT09IHRoaXMuQjtcbiAgICB9XG4gICAgLyoqIFdoZXRoZXIgd2UgaGF2ZSBtb2RpZmllZCBhbnkgc3RhdGUgdGhhdCBzaG91bGQgdHJpZ2dlciBhIHNuYXBzaG90LiAqLyAgICBnZXQgaigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuSztcbiAgICB9XG4gICAgLyoqXG4gICAgICogQXBwbGllcyB0aGUgcmVzdW1lIHRva2VuIHRvIHRoZSBUYXJnZXRDaGFuZ2UsIGJ1dCBvbmx5IHdoZW4gaXQgaGFzIGEgbmV3XG4gICAgICogdmFsdWUuIEVtcHR5IHJlc3VtZVRva2VucyBhcmUgZGlzY2FyZGVkLlxuICAgICAqLyAgICBXKHQpIHtcbiAgICAgICAgdC5hcHByb3hpbWF0ZUJ5dGVTaXplKCkgPiAwICYmICh0aGlzLksgPSAhMCwgdGhpcy5VID0gdCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSB0YXJnZXQgY2hhbmdlIGZyb20gdGhlIGN1cnJlbnQgc2V0IG9mIGNoYW5nZXMuXG4gICAgICpcbiAgICAgKiBUbyByZXNldCB0aGUgZG9jdW1lbnQgY2hhbmdlcyBhZnRlciByYWlzaW5nIHRoaXMgc25hcHNob3QsIGNhbGxcbiAgICAgKiBgY2xlYXJQZW5kaW5nQ2hhbmdlcygpYC5cbiAgICAgKi8gICAgSCgpIHtcbiAgICAgICAgbGV0IHQgPSBZbigpLCBlID0gWW4oKSwgbiA9IFluKCk7XG4gICAgICAgIHJldHVybiB0aGlzLkwuZm9yRWFjaCgoKHMsIGkpID0+IHtcbiAgICAgICAgICAgIHN3aXRjaCAoaSkge1xuICAgICAgICAgICAgICBjYXNlIDAgLyogQWRkZWQgKi8gOlxuICAgICAgICAgICAgICAgIHQgPSB0LmFkZChzKTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICBjYXNlIDIgLyogTW9kaWZpZWQgKi8gOlxuICAgICAgICAgICAgICAgIGUgPSBlLmFkZChzKTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICBjYXNlIDEgLyogUmVtb3ZlZCAqLyA6XG4gICAgICAgICAgICAgICAgbiA9IG4uYWRkKHMpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgTCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KSksIG5ldyBlcyh0aGlzLlUsIHRoaXMucSwgdCwgZSwgbik7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJlc2V0cyB0aGUgZG9jdW1lbnQgY2hhbmdlcyBhbmQgc2V0cyBgaGFzUGVuZGluZ0NoYW5nZXNgIHRvIGZhbHNlLlxuICAgICAqLyAgICBKKCkge1xuICAgICAgICB0aGlzLksgPSAhMSwgdGhpcy5MID0gYXMoKTtcbiAgICB9XG4gICAgWSh0LCBlKSB7XG4gICAgICAgIHRoaXMuSyA9ICEwLCB0aGlzLkwgPSB0aGlzLkwuaW5zZXJ0KHQsIGUpO1xuICAgIH1cbiAgICBYKHQpIHtcbiAgICAgICAgdGhpcy5LID0gITAsIHRoaXMuTCA9IHRoaXMuTC5yZW1vdmUodCk7XG4gICAgfVxuICAgIFooKSB7XG4gICAgICAgIHRoaXMuQiArPSAxO1xuICAgIH1cbiAgICB0dCgpIHtcbiAgICAgICAgdGhpcy5CIC09IDE7XG4gICAgfVxuICAgIGV0KCkge1xuICAgICAgICB0aGlzLksgPSAhMCwgdGhpcy5xID0gITA7XG4gICAgfVxufVxuXG4vKipcbiAqIEEgaGVscGVyIGNsYXNzIHRvIGFjY3VtdWxhdGUgd2F0Y2ggY2hhbmdlcyBpbnRvIGEgUmVtb3RlRXZlbnQuXG4gKi9cbmNsYXNzIG9zIHtcbiAgICBjb25zdHJ1Y3Rvcih0KSB7XG4gICAgICAgIHRoaXMubnQgPSB0LCBcbiAgICAgICAgLyoqIFRoZSBpbnRlcm5hbCBzdGF0ZSBvZiBhbGwgdHJhY2tlZCB0YXJnZXRzLiAqL1xuICAgICAgICB0aGlzLnN0ID0gbmV3IE1hcCwgXG4gICAgICAgIC8qKiBLZWVwcyB0cmFjayBvZiB0aGUgZG9jdW1lbnRzIHRvIHVwZGF0ZSBzaW5jZSB0aGUgbGFzdCByYWlzZWQgc25hcHNob3QuICovXG4gICAgICAgIHRoaXMuaXQgPSBRbigpLCBcbiAgICAgICAgLyoqIEEgbWFwcGluZyBvZiBkb2N1bWVudCBrZXlzIHRvIHRoZWlyIHNldCBvZiB0YXJnZXQgSURzLiAqL1xuICAgICAgICB0aGlzLnJ0ID0gdXMoKSwgXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBIGxpc3Qgb2YgdGFyZ2V0cyB3aXRoIGV4aXN0ZW5jZSBmaWx0ZXIgbWlzbWF0Y2hlcy4gVGhlc2UgdGFyZ2V0cyBhcmVcbiAgICAgICAgICoga25vd24gdG8gYmUgaW5jb25zaXN0ZW50IGFuZCB0aGVpciBsaXN0ZW5zIG5lZWRzIHRvIGJlIHJlLWVzdGFibGlzaGVkIGJ5XG4gICAgICAgICAqIFJlbW90ZVN0b3JlLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5vdCA9IG5ldyB3ZShydCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFByb2Nlc3NlcyBhbmQgYWRkcyB0aGUgRG9jdW1lbnRXYXRjaENoYW5nZSB0byB0aGUgY3VycmVudCBzZXQgb2YgY2hhbmdlcy5cbiAgICAgKi8gICAgdXQodCkge1xuICAgICAgICBmb3IgKGNvbnN0IGUgb2YgdC5PKSB0LkYgJiYgdC5GLmlzRm91bmREb2N1bWVudCgpID8gdGhpcy5hdChlLCB0LkYpIDogdGhpcy5jdChlLCB0LmtleSwgdC5GKTtcbiAgICAgICAgZm9yIChjb25zdCBlIG9mIHQucmVtb3ZlZFRhcmdldElkcykgdGhpcy5jdChlLCB0LmtleSwgdC5GKTtcbiAgICB9XG4gICAgLyoqIFByb2Nlc3NlcyBhbmQgYWRkcyB0aGUgV2F0Y2hUYXJnZXRDaGFuZ2UgdG8gdGhlIGN1cnJlbnQgc2V0IG9mIGNoYW5nZXMuICovICAgIGh0KHQpIHtcbiAgICAgICAgdGhpcy5mb3JFYWNoVGFyZ2V0KHQsIChlID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSB0aGlzLmx0KGUpO1xuICAgICAgICAgICAgc3dpdGNoICh0LnN0YXRlKSB7XG4gICAgICAgICAgICAgIGNhc2UgMCAvKiBOb0NoYW5nZSAqLyA6XG4gICAgICAgICAgICAgICAgdGhpcy5mdChlKSAmJiBuLlcodC5yZXN1bWVUb2tlbik7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgY2FzZSAxIC8qIEFkZGVkICovIDpcbiAgICAgICAgICAgICAgICAvLyBXZSBuZWVkIHRvIGRlY3JlbWVudCB0aGUgbnVtYmVyIG9mIHBlbmRpbmcgYWNrcyBuZWVkZWQgZnJvbSB3YXRjaFxuICAgICAgICAgICAgICAgIC8vIGZvciB0aGlzIHRhcmdldElkLlxuICAgICAgICAgICAgICAgIG4udHQoKSwgbi5HIHx8IFxuICAgICAgICAgICAgICAgIC8vIFdlIGhhdmUgYSBmcmVzaGx5IGFkZGVkIHRhcmdldCwgc28gd2UgbmVlZCB0byByZXNldCBhbnkgc3RhdGVcbiAgICAgICAgICAgICAgICAvLyB0aGF0IHdlIGhhZCBwcmV2aW91c2x5LiBUaGlzIGNhbiBoYXBwZW4gZS5nLiB3aGVuIHJlbW92ZSBhbmQgYWRkXG4gICAgICAgICAgICAgICAgLy8gYmFjayBhIHRhcmdldCBmb3IgZXhpc3RlbmNlIGZpbHRlciBtaXNtYXRjaGVzLlxuICAgICAgICAgICAgICAgIG4uSigpLCBuLlcodC5yZXN1bWVUb2tlbik7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgY2FzZSAyIC8qIFJlbW92ZWQgKi8gOlxuICAgICAgICAgICAgICAgIC8vIFdlIG5lZWQgdG8ga2VlcCB0cmFjayBvZiByZW1vdmVkIHRhcmdldHMgdG8gd2UgY2FuIHBvc3QtZmlsdGVyIGFuZFxuICAgICAgICAgICAgICAgIC8vIHJlbW92ZSBhbnkgdGFyZ2V0IGNoYW5nZXMuXG4gICAgICAgICAgICAgICAgLy8gV2UgbmVlZCB0byBkZWNyZW1lbnQgdGhlIG51bWJlciBvZiBwZW5kaW5nIGFja3MgbmVlZGVkIGZyb20gd2F0Y2hcbiAgICAgICAgICAgICAgICAvLyBmb3IgdGhpcyB0YXJnZXRJZC5cbiAgICAgICAgICAgICAgICBuLnR0KCksIG4uRyB8fCB0aGlzLnJlbW92ZVRhcmdldChlKTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICBjYXNlIDMgLyogQ3VycmVudCAqLyA6XG4gICAgICAgICAgICAgICAgdGhpcy5mdChlKSAmJiAobi5ldCgpLCBuLlcodC5yZXN1bWVUb2tlbikpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgIGNhc2UgNCAvKiBSZXNldCAqLyA6XG4gICAgICAgICAgICAgICAgdGhpcy5mdChlKSAmJiAoXG4gICAgICAgICAgICAgICAgLy8gUmVzZXQgdGhlIHRhcmdldCBhbmQgc3ludGhlc2l6ZXMgcmVtb3ZlcyBmb3IgYWxsIGV4aXN0aW5nXG4gICAgICAgICAgICAgICAgLy8gZG9jdW1lbnRzLiBUaGUgYmFja2VuZCB3aWxsIHJlLWFkZCBhbnkgZG9jdW1lbnRzIHRoYXQgc3RpbGxcbiAgICAgICAgICAgICAgICAvLyBtYXRjaCB0aGUgdGFyZ2V0IGJlZm9yZSBpdCBzZW5kcyB0aGUgbmV4dCBnbG9iYWwgc25hcHNob3QuXG4gICAgICAgICAgICAgICAgdGhpcy5kdChlKSwgbi5XKHQucmVzdW1lVG9rZW4pKTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIEwoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBJdGVyYXRlcyBvdmVyIGFsbCB0YXJnZXRJZHMgdGhhdCB0aGUgd2F0Y2ggY2hhbmdlIGFwcGxpZXMgdG86IGVpdGhlciB0aGVcbiAgICAgKiB0YXJnZXRJZHMgZXhwbGljaXRseSBsaXN0ZWQgaW4gdGhlIGNoYW5nZSBvciB0aGUgdGFyZ2V0SWRzIG9mIGFsbCBjdXJyZW50bHlcbiAgICAgKiBhY3RpdmUgdGFyZ2V0cy5cbiAgICAgKi8gICAgZm9yRWFjaFRhcmdldCh0LCBlKSB7XG4gICAgICAgIHQudGFyZ2V0SWRzLmxlbmd0aCA+IDAgPyB0LnRhcmdldElkcy5mb3JFYWNoKGUpIDogdGhpcy5zdC5mb3JFYWNoKCgodCwgbikgPT4ge1xuICAgICAgICAgICAgdGhpcy5mdChuKSAmJiBlKG4pO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEhhbmRsZXMgZXhpc3RlbmNlIGZpbHRlcnMgYW5kIHN5bnRoZXNpemVzIGRlbGV0ZXMgZm9yIGZpbHRlciBtaXNtYXRjaGVzLlxuICAgICAqIFRhcmdldHMgdGhhdCBhcmUgaW52YWxpZGF0ZWQgYnkgZmlsdGVyIG1pc21hdGNoZXMgYXJlIGFkZGVkIHRvXG4gICAgICogYHBlbmRpbmdUYXJnZXRSZXNldHNgLlxuICAgICAqLyAgICBfdCh0KSB7XG4gICAgICAgIGNvbnN0IGUgPSB0LnRhcmdldElkLCBuID0gdC4kLmNvdW50LCBzID0gdGhpcy53dChlKTtcbiAgICAgICAgaWYgKHMpIHtcbiAgICAgICAgICAgIGNvbnN0IHQgPSBzLnRhcmdldDtcbiAgICAgICAgICAgIGlmIChBZSh0KSkgaWYgKDAgPT09IG4pIHtcbiAgICAgICAgICAgICAgICAvLyBUaGUgZXhpc3RlbmNlIGZpbHRlciB0b2xkIHVzIHRoZSBkb2N1bWVudCBkb2VzIG5vdCBleGlzdC4gV2UgZGVkdWNlXG4gICAgICAgICAgICAgICAgLy8gdGhhdCB0aGlzIGRvY3VtZW50IGRvZXMgbm90IGV4aXN0IGFuZCBhcHBseSBhIGRlbGV0ZWQgZG9jdW1lbnQgdG9cbiAgICAgICAgICAgICAgICAvLyBvdXIgdXBkYXRlcy4gV2l0aG91dCBhcHBseWluZyB0aGlzIGRlbGV0ZWQgZG9jdW1lbnQgdGhlcmUgbWlnaHQgYmVcbiAgICAgICAgICAgICAgICAvLyBhbm90aGVyIHF1ZXJ5IHRoYXQgd2lsbCByYWlzZSB0aGlzIGRvY3VtZW50IGFzIHBhcnQgb2YgYSBzbmFwc2hvdFxuICAgICAgICAgICAgICAgIC8vIHVudGlsIGl0IGlzIHJlc29sdmVkLCBlc3NlbnRpYWxseSBleHBvc2luZyBpbmNvbnNpc3RlbmN5IGJldHdlZW5cbiAgICAgICAgICAgICAgICAvLyBxdWVyaWVzLlxuICAgICAgICAgICAgICAgIGNvbnN0IG4gPSBuZXcgeHQodC5wYXRoKTtcbiAgICAgICAgICAgICAgICB0aGlzLmN0KGUsIG4sIG5lLm5ld05vRG9jdW1lbnQobiwgY3QubWluKCkpKTtcbiAgICAgICAgICAgIH0gZWxzZSBVKDEgPT09IG4pOyBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmd0KGUpICE9PSBuICYmIChcbiAgICAgICAgICAgICAgICAvLyBFeGlzdGVuY2UgZmlsdGVyIG1pc21hdGNoOiBXZSByZXNldCB0aGUgbWFwcGluZyBhbmQgcmFpc2UgYSBuZXdcbiAgICAgICAgICAgICAgICAvLyBzbmFwc2hvdCB3aXRoIGBpc0Zyb21DYWNoZTp0cnVlYC5cbiAgICAgICAgICAgICAgICB0aGlzLmR0KGUpLCB0aGlzLm90ID0gdGhpcy5vdC5hZGQoZSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENvbnZlcnRzIHRoZSBjdXJyZW50bHkgYWNjdW11bGF0ZWQgc3RhdGUgaW50byBhIHJlbW90ZSBldmVudCBhdCB0aGVcbiAgICAgKiBwcm92aWRlZCBzbmFwc2hvdCB2ZXJzaW9uLiBSZXNldHMgdGhlIGFjY3VtdWxhdGVkIGNoYW5nZXMgYmVmb3JlIHJldHVybmluZy5cbiAgICAgKi8gICAgeXQodCkge1xuICAgICAgICBjb25zdCBlID0gbmV3IE1hcDtcbiAgICAgICAgdGhpcy5zdC5mb3JFYWNoKCgobiwgcykgPT4ge1xuICAgICAgICAgICAgY29uc3QgaSA9IHRoaXMud3Qocyk7XG4gICAgICAgICAgICBpZiAoaSkge1xuICAgICAgICAgICAgICAgIGlmIChuLmN1cnJlbnQgJiYgQWUoaS50YXJnZXQpKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIERvY3VtZW50IHF1ZXJpZXMgZm9yIGRvY3VtZW50IHRoYXQgZG9uJ3QgZXhpc3QgY2FuIHByb2R1Y2UgYW4gZW1wdHlcbiAgICAgICAgICAgICAgICAgICAgLy8gcmVzdWx0IHNldC4gVG8gdXBkYXRlIG91ciBsb2NhbCBjYWNoZSwgd2Ugc3ludGhlc2l6ZSBhIGRvY3VtZW50XG4gICAgICAgICAgICAgICAgICAgIC8vIGRlbGV0ZSBpZiB3ZSBoYXZlIG5vdCBwcmV2aW91c2x5IHJlY2VpdmVkIHRoZSBkb2N1bWVudC4gVGhpc1xuICAgICAgICAgICAgICAgICAgICAvLyByZXNvbHZlcyB0aGUgbGltYm8gc3RhdGUgb2YgdGhlIGRvY3VtZW50LCByZW1vdmluZyBpdCBmcm9tXG4gICAgICAgICAgICAgICAgICAgIC8vIGxpbWJvRG9jdW1lbnRSZWZzLlxuICAgICAgICAgICAgICAgICAgICAvLyBUT0RPKGRpbW9uZCk6IElkZWFsbHkgd2Ugd291bGQgaGF2ZSBhbiBleHBsaWNpdCBsb29rdXAgdGFyZ2V0XG4gICAgICAgICAgICAgICAgICAgIC8vIGluc3RlYWQgcmVzdWx0aW5nIGluIGFuIGV4cGxpY2l0IGRlbGV0ZSBtZXNzYWdlIGFuZCB3ZSBjb3VsZFxuICAgICAgICAgICAgICAgICAgICAvLyByZW1vdmUgdGhpcyBzcGVjaWFsIGxvZ2ljLlxuICAgICAgICAgICAgICAgICAgICBjb25zdCBlID0gbmV3IHh0KGkudGFyZ2V0LnBhdGgpO1xuICAgICAgICAgICAgICAgICAgICBudWxsICE9PSB0aGlzLml0LmdldChlKSB8fCB0aGlzLkl0KHMsIGUpIHx8IHRoaXMuY3QocywgZSwgbmUubmV3Tm9Eb2N1bWVudChlLCB0KSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIG4uaiAmJiAoZS5zZXQocywgbi5IKCkpLCBuLkooKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pKTtcbiAgICAgICAgbGV0IG4gPSBZbigpO1xuICAgICAgICAvLyBXZSBleHRyYWN0IHRoZSBzZXQgb2YgbGltYm8tb25seSBkb2N1bWVudCB1cGRhdGVzIGFzIHRoZSBHQyBsb2dpY1xuICAgICAgICAvLyBzcGVjaWFsLWNhc2VzIGRvY3VtZW50cyB0aGF0IGRvIG5vdCBhcHBlYXIgaW4gdGhlIHRhcmdldCBjYWNoZS5cbiAgICAgICAgXG4gICAgICAgIC8vIFRPRE8oZ3NvbHRpcyk6IEV4cGFuZCBvbiB0aGlzIGNvbW1lbnQgb25jZSBHQyBpcyBhdmFpbGFibGUgaW4gdGhlIEpTXG4gICAgICAgIC8vIGNsaWVudC5cbiAgICAgICAgICAgICAgICB0aGlzLnJ0LmZvckVhY2goKCh0LCBlKSA9PiB7XG4gICAgICAgICAgICBsZXQgcyA9ICEwO1xuICAgICAgICAgICAgZS5mb3JFYWNoV2hpbGUoKHQgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGUgPSB0aGlzLnd0KHQpO1xuICAgICAgICAgICAgICAgIHJldHVybiAhZSB8fCAyIC8qIExpbWJvUmVzb2x1dGlvbiAqLyA9PT0gZS5wdXJwb3NlIHx8IChzID0gITEsICExKTtcbiAgICAgICAgICAgIH0pKSwgcyAmJiAobiA9IG4uYWRkKHQpKTtcbiAgICAgICAgfSkpLCB0aGlzLml0LmZvckVhY2goKChlLCBuKSA9PiBuLnNldFJlYWRUaW1lKHQpKSk7XG4gICAgICAgIGNvbnN0IHMgPSBuZXcgdHModCwgZSwgdGhpcy5vdCwgdGhpcy5pdCwgbik7XG4gICAgICAgIHJldHVybiB0aGlzLml0ID0gUW4oKSwgdGhpcy5ydCA9IHVzKCksIHRoaXMub3QgPSBuZXcgd2UocnQpLCBzO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBBZGRzIHRoZSBwcm92aWRlZCBkb2N1bWVudCB0byB0aGUgaW50ZXJuYWwgbGlzdCBvZiBkb2N1bWVudCB1cGRhdGVzIGFuZFxuICAgICAqIGl0cyBkb2N1bWVudCBrZXkgdG8gdGhlIGdpdmVuIHRhcmdldCdzIG1hcHBpbmcuXG4gICAgICovXG4gICAgLy8gVmlzaWJsZSBmb3IgdGVzdGluZy5cbiAgICBhdCh0LCBlKSB7XG4gICAgICAgIGlmICghdGhpcy5mdCh0KSkgcmV0dXJuO1xuICAgICAgICBjb25zdCBuID0gdGhpcy5JdCh0LCBlLmtleSkgPyAyIC8qIE1vZGlmaWVkICovIDogMCAvKiBBZGRlZCAqLztcbiAgICAgICAgdGhpcy5sdCh0KS5ZKGUua2V5LCBuKSwgdGhpcy5pdCA9IHRoaXMuaXQuaW5zZXJ0KGUua2V5LCBlKSwgdGhpcy5ydCA9IHRoaXMucnQuaW5zZXJ0KGUua2V5LCB0aGlzLlR0KGUua2V5KS5hZGQodCkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZW1vdmVzIHRoZSBwcm92aWRlZCBkb2N1bWVudCBmcm9tIHRoZSB0YXJnZXQgbWFwcGluZy4gSWYgdGhlXG4gICAgICogZG9jdW1lbnQgbm8gbG9uZ2VyIG1hdGNoZXMgdGhlIHRhcmdldCwgYnV0IHRoZSBkb2N1bWVudCdzIHN0YXRlIGlzIHN0aWxsXG4gICAgICoga25vd24gKGUuZy4gd2Uga25vdyB0aGF0IHRoZSBkb2N1bWVudCB3YXMgZGVsZXRlZCBvciB3ZSByZWNlaXZlZCB0aGUgY2hhbmdlXG4gICAgICogdGhhdCBjYXVzZWQgdGhlIGZpbHRlciBtaXNtYXRjaCksIHRoZSBuZXcgZG9jdW1lbnQgY2FuIGJlIHByb3ZpZGVkXG4gICAgICogdG8gdXBkYXRlIHRoZSByZW1vdGUgZG9jdW1lbnQgY2FjaGUuXG4gICAgICovXG4gICAgLy8gVmlzaWJsZSBmb3IgdGVzdGluZy5cbiAgICBjdCh0LCBlLCBuKSB7XG4gICAgICAgIGlmICghdGhpcy5mdCh0KSkgcmV0dXJuO1xuICAgICAgICBjb25zdCBzID0gdGhpcy5sdCh0KTtcbiAgICAgICAgdGhpcy5JdCh0LCBlKSA/IHMuWShlLCAxIC8qIFJlbW92ZWQgKi8pIDogXG4gICAgICAgIC8vIFRoZSBkb2N1bWVudCBtYXkgaGF2ZSBlbnRlcmVkIGFuZCBsZWZ0IHRoZSB0YXJnZXQgYmVmb3JlIHdlIHJhaXNlZCBhXG4gICAgICAgIC8vIHNuYXBzaG90LCBzbyB3ZSBjYW4ganVzdCBpZ25vcmUgdGhlIGNoYW5nZS5cbiAgICAgICAgcy5YKGUpLCB0aGlzLnJ0ID0gdGhpcy5ydC5pbnNlcnQoZSwgdGhpcy5UdChlKS5kZWxldGUodCkpLCBuICYmICh0aGlzLml0ID0gdGhpcy5pdC5pbnNlcnQoZSwgbikpO1xuICAgIH1cbiAgICByZW1vdmVUYXJnZXQodCkge1xuICAgICAgICB0aGlzLnN0LmRlbGV0ZSh0KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0aGUgY3VycmVudCBjb3VudCBvZiBkb2N1bWVudHMgaW4gdGhlIHRhcmdldC4gVGhpcyBpbmNsdWRlcyBib3RoXG4gICAgICogdGhlIG51bWJlciBvZiBkb2N1bWVudHMgdGhhdCB0aGUgTG9jYWxTdG9yZSBjb25zaWRlcnMgdG8gYmUgcGFydCBvZiB0aGVcbiAgICAgKiB0YXJnZXQgYXMgd2VsbCBhcyBhbnkgYWNjdW11bGF0ZWQgY2hhbmdlcy5cbiAgICAgKi8gICAgZ3QodCkge1xuICAgICAgICBjb25zdCBlID0gdGhpcy5sdCh0KS5IKCk7XG4gICAgICAgIHJldHVybiB0aGlzLm50LmdldFJlbW90ZUtleXNGb3JUYXJnZXQodCkuc2l6ZSArIGUuYWRkZWREb2N1bWVudHMuc2l6ZSAtIGUucmVtb3ZlZERvY3VtZW50cy5zaXplO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBJbmNyZW1lbnQgdGhlIG51bWJlciBvZiBhY2tzIG5lZWRlZCBmcm9tIHdhdGNoIGJlZm9yZSB3ZSBjYW4gY29uc2lkZXIgdGhlXG4gICAgICogc2VydmVyIHRvIGJlICdpbi1zeW5jJyB3aXRoIHRoZSBjbGllbnQncyBhY3RpdmUgdGFyZ2V0cy5cbiAgICAgKi8gICAgWih0KSB7XG4gICAgICAgIHRoaXMubHQodCkuWigpO1xuICAgIH1cbiAgICBsdCh0KSB7XG4gICAgICAgIGxldCBlID0gdGhpcy5zdC5nZXQodCk7XG4gICAgICAgIHJldHVybiBlIHx8IChlID0gbmV3IHJzLCB0aGlzLnN0LnNldCh0LCBlKSksIGU7XG4gICAgfVxuICAgIFR0KHQpIHtcbiAgICAgICAgbGV0IGUgPSB0aGlzLnJ0LmdldCh0KTtcbiAgICAgICAgcmV0dXJuIGUgfHwgKGUgPSBuZXcgd2UocnQpLCB0aGlzLnJ0ID0gdGhpcy5ydC5pbnNlcnQodCwgZSkpLCBlO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBWZXJpZmllcyB0aGF0IHRoZSB1c2VyIGlzIHN0aWxsIGludGVyZXN0ZWQgaW4gdGhpcyB0YXJnZXQgKGJ5IGNhbGxpbmdcbiAgICAgKiBgZ2V0VGFyZ2V0RGF0YUZvclRhcmdldCgpYCkgYW5kIHRoYXQgd2UgYXJlIG5vdCB3YWl0aW5nIGZvciBwZW5kaW5nIEFERHNcbiAgICAgKiBmcm9tIHdhdGNoLlxuICAgICAqLyAgICBmdCh0KSB7XG4gICAgICAgIGNvbnN0IGUgPSBudWxsICE9PSB0aGlzLnd0KHQpO1xuICAgICAgICByZXR1cm4gZSB8fCBPKFwiV2F0Y2hDaGFuZ2VBZ2dyZWdhdG9yXCIsIFwiRGV0ZWN0ZWQgaW5hY3RpdmUgdGFyZ2V0XCIsIHQpLCBlO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRoZSBUYXJnZXREYXRhIGZvciBhbiBhY3RpdmUgdGFyZ2V0IChpLmUuIGEgdGFyZ2V0IHRoYXQgdGhlIHVzZXJcbiAgICAgKiBpcyBzdGlsbCBpbnRlcmVzdGVkIGluIHRoYXQgaGFzIG5vIG91dHN0YW5kaW5nIHRhcmdldCBjaGFuZ2UgcmVxdWVzdHMpLlxuICAgICAqLyAgICB3dCh0KSB7XG4gICAgICAgIGNvbnN0IGUgPSB0aGlzLnN0LmdldCh0KTtcbiAgICAgICAgcmV0dXJuIGUgJiYgZS5HID8gbnVsbCA6IHRoaXMubnQuRXQodCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJlc2V0cyB0aGUgc3RhdGUgb2YgYSBXYXRjaCB0YXJnZXQgdG8gaXRzIGluaXRpYWwgc3RhdGUgKGUuZy4gc2V0c1xuICAgICAqICdjdXJyZW50JyB0byBmYWxzZSwgY2xlYXJzIHRoZSByZXN1bWUgdG9rZW4gYW5kIHJlbW92ZXMgaXRzIHRhcmdldCBtYXBwaW5nXG4gICAgICogZnJvbSBhbGwgZG9jdW1lbnRzKS5cbiAgICAgKi8gICAgZHQodCkge1xuICAgICAgICB0aGlzLnN0LnNldCh0LCBuZXcgcnMpO1xuICAgICAgICB0aGlzLm50LmdldFJlbW90ZUtleXNGb3JUYXJnZXQodCkuZm9yRWFjaCgoZSA9PiB7XG4gICAgICAgICAgICB0aGlzLmN0KHQsIGUsIC8qdXBkYXRlZERvY3VtZW50PSovIG51bGwpO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgd2hldGhlciB0aGUgTG9jYWxTdG9yZSBjb25zaWRlcnMgdGhlIGRvY3VtZW50IHRvIGJlIHBhcnQgb2YgdGhlXG4gICAgICogc3BlY2lmaWVkIHRhcmdldC5cbiAgICAgKi8gICAgSXQodCwgZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5udC5nZXRSZW1vdGVLZXlzRm9yVGFyZ2V0KHQpLmhhcyhlKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIHVzKCkge1xuICAgIHJldHVybiBuZXcgZmUoeHQuY29tcGFyYXRvcik7XG59XG5cbmZ1bmN0aW9uIGFzKCkge1xuICAgIHJldHVybiBuZXcgZmUoeHQuY29tcGFyYXRvcik7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovIGNvbnN0IGNzID0gKCgpID0+IHtcbiAgICBjb25zdCB0ID0ge1xuICAgICAgICBhc2M6IFwiQVNDRU5ESU5HXCIsXG4gICAgICAgIGRlc2M6IFwiREVTQ0VORElOR1wiXG4gICAgfTtcbiAgICByZXR1cm4gdDtcbn0pKCksIGhzID0gKCgpID0+IHtcbiAgICBjb25zdCB0ID0ge1xuICAgICAgICBcIjxcIjogXCJMRVNTX1RIQU5cIixcbiAgICAgICAgXCI8PVwiOiBcIkxFU1NfVEhBTl9PUl9FUVVBTFwiLFxuICAgICAgICBcIj5cIjogXCJHUkVBVEVSX1RIQU5cIixcbiAgICAgICAgXCI+PVwiOiBcIkdSRUFURVJfVEhBTl9PUl9FUVVBTFwiLFxuICAgICAgICBcIj09XCI6IFwiRVFVQUxcIixcbiAgICAgICAgXCIhPVwiOiBcIk5PVF9FUVVBTFwiLFxuICAgICAgICBcImFycmF5LWNvbnRhaW5zXCI6IFwiQVJSQVlfQ09OVEFJTlNcIixcbiAgICAgICAgaW46IFwiSU5cIixcbiAgICAgICAgXCJub3QtaW5cIjogXCJOT1RfSU5cIixcbiAgICAgICAgXCJhcnJheS1jb250YWlucy1hbnlcIjogXCJBUlJBWV9DT05UQUlOU19BTllcIlxuICAgIH07XG4gICAgcmV0dXJuIHQ7XG59KSgpO1xuXG4vKipcbiAqIFRoaXMgY2xhc3MgZ2VuZXJhdGVzIEpzb25PYmplY3QgdmFsdWVzIGZvciB0aGUgRGF0YXN0b3JlIEFQSSBzdWl0YWJsZSBmb3JcbiAqIHNlbmRpbmcgdG8gZWl0aGVyIEdSUEMgc3R1YiBtZXRob2RzIG9yIHZpYSB0aGUgSlNPTi9IVFRQIFJFU1QgQVBJLlxuICpcbiAqIFRoZSBzZXJpYWxpemVyIHN1cHBvcnRzIGJvdGggUHJvdG9idWYuanMgYW5kIFByb3RvMyBKU09OIGZvcm1hdHMuIEJ5XG4gKiBzZXR0aW5nIGB1c2VQcm90bzNKc29uYCB0byB0cnVlLCB0aGUgc2VyaWFsaXplciB3aWxsIHVzZSB0aGUgUHJvdG8zIEpTT05cbiAqIGZvcm1hdC5cbiAqXG4gKiBGb3IgYSBkZXNjcmlwdGlvbiBvZiB0aGUgUHJvdG8zIEpTT04gZm9ybWF0IGNoZWNrXG4gKiBodHRwczovL2RldmVsb3BlcnMuZ29vZ2xlLmNvbS9wcm90b2NvbC1idWZmZXJzL2RvY3MvcHJvdG8zI2pzb25cbiAqXG4gKiBUT0RPKGtsaW10KTogV2UgY2FuIHJlbW92ZSB0aGUgZGF0YWJhc2VJZCBhcmd1bWVudCBpZiB3ZSBrZWVwIHRoZSBmdWxsXG4gKiByZXNvdXJjZSBuYW1lIGluIGRvY3VtZW50cy5cbiAqL1xuY2xhc3MgbHMge1xuICAgIGNvbnN0cnVjdG9yKHQsIGUpIHtcbiAgICAgICAgdGhpcy5kYXRhYmFzZUlkID0gdCwgdGhpcy5OID0gZTtcbiAgICB9XG59XG5cbi8qKlxuICogUmV0dXJucyBhIHZhbHVlIGZvciBhIERhdGUgdGhhdCdzIGFwcHJvcHJpYXRlIHRvIHB1dCBpbnRvIGEgcHJvdG8uXG4gKi9cbmZ1bmN0aW9uIGZzKHQsIGUpIHtcbiAgICBpZiAodC5OKSB7XG4gICAgICAgIHJldHVybiBgJHtuZXcgRGF0ZSgxZTMgKiBlLnNlY29uZHMpLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgvXFwuXFxkKi8sIFwiXCIpLnJlcGxhY2UoXCJaXCIsIFwiXCIpfS4keyhcIjAwMDAwMDAwMFwiICsgZS5uYW5vc2Vjb25kcykuc2xpY2UoLTkpfVpgO1xuICAgIH1cbiAgICByZXR1cm4ge1xuICAgICAgICBzZWNvbmRzOiBcIlwiICsgZS5zZWNvbmRzLFxuICAgICAgICBuYW5vczogZS5uYW5vc2Vjb25kc1xuICAgIH07XG59XG5cbi8qKlxuICogUmV0dXJucyBhIHZhbHVlIGZvciBieXRlcyB0aGF0J3MgYXBwcm9wcmlhdGUgdG8gcHV0IGluIGEgcHJvdG8uXG4gKlxuICogVmlzaWJsZSBmb3IgdGVzdGluZy5cbiAqL1xuZnVuY3Rpb24gZHModCwgZSkge1xuICAgIHJldHVybiB0Lk4gPyBlLnRvQmFzZTY0KCkgOiBlLnRvVWludDhBcnJheSgpO1xufVxuXG4vKipcbiAqIFJldHVybnMgYSBCeXRlU3RyaW5nIGJhc2VkIG9uIHRoZSBwcm90byBzdHJpbmcgdmFsdWUuXG4gKi8gZnVuY3Rpb24gX3ModCwgZSkge1xuICAgIHJldHVybiBmcyh0LCBlLnRvVGltZXN0YW1wKCkpO1xufVxuXG5mdW5jdGlvbiB3cyh0KSB7XG4gICAgcmV0dXJuIFUoISF0KSwgY3QuZnJvbVRpbWVzdGFtcChmdW5jdGlvbih0KSB7XG4gICAgICAgIGNvbnN0IGUgPSBUdCh0KTtcbiAgICAgICAgcmV0dXJuIG5ldyBhdChlLnNlY29uZHMsIGUubmFub3MpO1xuICAgIH0odCkpO1xufVxuXG5mdW5jdGlvbiBtcyh0LCBlKSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBfdChbIFwicHJvamVjdHNcIiwgdC5wcm9qZWN0SWQsIFwiZGF0YWJhc2VzXCIsIHQuZGF0YWJhc2UgXSk7XG4gICAgfSh0KS5jaGlsZChcImRvY3VtZW50c1wiKS5jaGlsZChlKS5jYW5vbmljYWxTdHJpbmcoKTtcbn1cblxuZnVuY3Rpb24gZ3ModCkge1xuICAgIGNvbnN0IGUgPSBfdC5mcm9tU3RyaW5nKHQpO1xuICAgIHJldHVybiBVKEtzKGUpKSwgZTtcbn1cblxuZnVuY3Rpb24geXModCwgZSkge1xuICAgIHJldHVybiBtcyh0LmRhdGFiYXNlSWQsIGUucGF0aCk7XG59XG5cbmZ1bmN0aW9uIHBzKHQsIGUpIHtcbiAgICBjb25zdCBuID0gZ3MoZSk7XG4gICAgaWYgKG4uZ2V0KDEpICE9PSB0LmRhdGFiYXNlSWQucHJvamVjdElkKSB0aHJvdyBuZXcgUShHLklOVkFMSURfQVJHVU1FTlQsIFwiVHJpZWQgdG8gZGVzZXJpYWxpemUga2V5IGZyb20gZGlmZmVyZW50IHByb2plY3Q6IFwiICsgbi5nZXQoMSkgKyBcIiB2cyBcIiArIHQuZGF0YWJhc2VJZC5wcm9qZWN0SWQpO1xuICAgIGlmIChuLmdldCgzKSAhPT0gdC5kYXRhYmFzZUlkLmRhdGFiYXNlKSB0aHJvdyBuZXcgUShHLklOVkFMSURfQVJHVU1FTlQsIFwiVHJpZWQgdG8gZGVzZXJpYWxpemUga2V5IGZyb20gZGlmZmVyZW50IGRhdGFiYXNlOiBcIiArIG4uZ2V0KDMpICsgXCIgdnMgXCIgKyB0LmRhdGFiYXNlSWQuZGF0YWJhc2UpO1xuICAgIHJldHVybiBuZXcgeHQoQXMobikpO1xufVxuXG5mdW5jdGlvbiBJcyh0LCBlKSB7XG4gICAgcmV0dXJuIG1zKHQuZGF0YWJhc2VJZCwgZSk7XG59XG5cbmZ1bmN0aW9uIFRzKHQpIHtcbiAgICBjb25zdCBlID0gZ3ModCk7XG4gICAgLy8gSW4gdjFiZXRhMSBxdWVyaWVzIGZvciBjb2xsZWN0aW9ucyBhdCB0aGUgcm9vdCBkaWQgbm90IGhhdmUgYSB0cmFpbGluZ1xuICAgIC8vIFwiL2RvY3VtZW50c1wiLiBJbiB2MSBhbGwgcmVzb3VyY2UgcGF0aHMgY29udGFpbiBcIi9kb2N1bWVudHNcIi4gUHJlc2VydmUgdGhlXG4gICAgLy8gYWJpbGl0eSB0byByZWFkIHRoZSB2MWJldGExIGZvcm0gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBxdWVyaWVzIHBlcnNpc3RlZFxuICAgIC8vIGluIHRoZSBsb2NhbCB0YXJnZXQgY2FjaGUuXG4gICAgICAgIHJldHVybiA0ID09PSBlLmxlbmd0aCA/IF90LmVtcHR5UGF0aCgpIDogQXMoZSk7XG59XG5cbmZ1bmN0aW9uIEVzKHQpIHtcbiAgICByZXR1cm4gbmV3IF90KFsgXCJwcm9qZWN0c1wiLCB0LmRhdGFiYXNlSWQucHJvamVjdElkLCBcImRhdGFiYXNlc1wiLCB0LmRhdGFiYXNlSWQuZGF0YWJhc2UgXSkuY2Fub25pY2FsU3RyaW5nKCk7XG59XG5cbmZ1bmN0aW9uIEFzKHQpIHtcbiAgICByZXR1cm4gVSh0Lmxlbmd0aCA+IDQgJiYgXCJkb2N1bWVudHNcIiA9PT0gdC5nZXQoNCkpLCB0LnBvcEZpcnN0KDUpO1xufVxuXG4vKiogQ3JlYXRlcyBhIERvY3VtZW50IHByb3RvIGZyb20ga2V5IGFuZCBmaWVsZHMgKGJ1dCBubyBjcmVhdGUvdXBkYXRlIHRpbWUpICovIGZ1bmN0aW9uIFJzKHQsIGUsIG4pIHtcbiAgICByZXR1cm4ge1xuICAgICAgICBuYW1lOiB5cyh0LCBlKSxcbiAgICAgICAgZmllbGRzOiBuLnZhbHVlLm1hcFZhbHVlLmZpZWxkc1xuICAgIH07XG59XG5cbmZ1bmN0aW9uIGJzKHQsIGUsIG4pIHtcbiAgICBjb25zdCBzID0gcHModCwgZS5uYW1lKSwgaSA9IHdzKGUudXBkYXRlVGltZSksIHIgPSBuZXcgdGUoe1xuICAgICAgICBtYXBWYWx1ZToge1xuICAgICAgICAgICAgZmllbGRzOiBlLmZpZWxkc1xuICAgICAgICB9XG4gICAgfSksIG8gPSBuZS5uZXdGb3VuZERvY3VtZW50KHMsIGksIHIpO1xuICAgIHJldHVybiBuICYmIG8uc2V0SGFzQ29tbWl0dGVkTXV0YXRpb25zKCksIG4gPyBvLnNldEhhc0NvbW1pdHRlZE11dGF0aW9ucygpIDogbztcbn1cblxuZnVuY3Rpb24gUHModCwgZSkge1xuICAgIHJldHVybiBcImZvdW5kXCIgaW4gZSA/IGZ1bmN0aW9uKHQsIGUpIHtcbiAgICAgICAgVSghIWUuZm91bmQpLCBlLmZvdW5kLm5hbWUsIGUuZm91bmQudXBkYXRlVGltZTtcbiAgICAgICAgY29uc3QgbiA9IHBzKHQsIGUuZm91bmQubmFtZSksIHMgPSB3cyhlLmZvdW5kLnVwZGF0ZVRpbWUpLCBpID0gbmV3IHRlKHtcbiAgICAgICAgICAgIG1hcFZhbHVlOiB7XG4gICAgICAgICAgICAgICAgZmllbGRzOiBlLmZvdW5kLmZpZWxkc1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIG5lLm5ld0ZvdW5kRG9jdW1lbnQobiwgcywgaSk7XG4gICAgfSh0LCBlKSA6IFwibWlzc2luZ1wiIGluIGUgPyBmdW5jdGlvbih0LCBlKSB7XG4gICAgICAgIFUoISFlLm1pc3NpbmcpLCBVKCEhZS5yZWFkVGltZSk7XG4gICAgICAgIGNvbnN0IG4gPSBwcyh0LCBlLm1pc3NpbmcpLCBzID0gd3MoZS5yZWFkVGltZSk7XG4gICAgICAgIHJldHVybiBuZS5uZXdOb0RvY3VtZW50KG4sIHMpO1xuICAgIH0odCwgZSkgOiBMKCk7XG59XG5cbmZ1bmN0aW9uIFZzKHQsIGUpIHtcbiAgICBsZXQgbjtcbiAgICBpZiAoXCJ0YXJnZXRDaGFuZ2VcIiBpbiBlKSB7XG4gICAgICAgIGUudGFyZ2V0Q2hhbmdlO1xuICAgICAgICAvLyBwcm90bzMgZGVmYXVsdCB2YWx1ZSBpcyB1bnNldCBpbiBKU09OICh1bmRlZmluZWQpLCBzbyB1c2UgJ05PX0NIQU5HRSdcbiAgICAgICAgLy8gaWYgdW5zZXRcbiAgICAgICAgY29uc3QgcyA9IGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgICAgIHJldHVybiBcIk5PX0NIQU5HRVwiID09PSB0ID8gMCAvKiBOb0NoYW5nZSAqLyA6IFwiQUREXCIgPT09IHQgPyAxIC8qIEFkZGVkICovIDogXCJSRU1PVkVcIiA9PT0gdCA/IDIgLyogUmVtb3ZlZCAqLyA6IFwiQ1VSUkVOVFwiID09PSB0ID8gMyAvKiBDdXJyZW50ICovIDogXCJSRVNFVFwiID09PSB0ID8gNCAvKiBSZXNldCAqLyA6IEwoKTtcbiAgICAgICAgfShlLnRhcmdldENoYW5nZS50YXJnZXRDaGFuZ2VUeXBlIHx8IFwiTk9fQ0hBTkdFXCIpLCBpID0gZS50YXJnZXRDaGFuZ2UudGFyZ2V0SWRzIHx8IFtdLCByID0gZnVuY3Rpb24odCwgZSkge1xuICAgICAgICAgICAgcmV0dXJuIHQuTiA/IChVKHZvaWQgMCA9PT0gZSB8fCBcInN0cmluZ1wiID09IHR5cGVvZiBlKSwgcHQuZnJvbUJhc2U2NFN0cmluZyhlIHx8IFwiXCIpKSA6IChVKHZvaWQgMCA9PT0gZSB8fCBlIGluc3RhbmNlb2YgVWludDhBcnJheSksIFxuICAgICAgICAgICAgcHQuZnJvbVVpbnQ4QXJyYXkoZSB8fCBuZXcgVWludDhBcnJheSkpO1xuICAgICAgICB9KHQsIGUudGFyZ2V0Q2hhbmdlLnJlc3VtZVRva2VuKSwgbyA9IGUudGFyZ2V0Q2hhbmdlLmNhdXNlLCB1ID0gbyAmJiBmdW5jdGlvbih0KSB7XG4gICAgICAgICAgICBjb25zdCBlID0gdm9pZCAwID09PSB0LmNvZGUgPyBHLlVOS05PV04gOiBxbih0LmNvZGUpO1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBRKGUsIHQubWVzc2FnZSB8fCBcIlwiKTtcbiAgICAgICAgfVxuICAgICAgICAvKipcbiAqIFJldHVybnMgYSB2YWx1ZSBmb3IgYSBudW1iZXIgKG9yIG51bGwpIHRoYXQncyBhcHByb3ByaWF0ZSB0byBwdXQgaW50b1xuICogYSBnb29nbGUucHJvdG9idWYuSW50MzJWYWx1ZSBwcm90by5cbiAqIERPIE5PVCBVU0UgVEhJUyBGT1IgQU5ZVEhJTkcgRUxTRS5cbiAqIFRoaXMgbWV0aG9kIGNoZWF0cy4gSXQncyB0eXBlZCBhcyByZXR1cm5pbmcgXCJudW1iZXJcIiBiZWNhdXNlIHRoYXQncyB3aGF0XG4gKiBvdXIgZ2VuZXJhdGVkIHByb3RvIGludGVyZmFjZXMgc2F5IEludDMyVmFsdWUgbXVzdCBiZS4gQnV0IEdSUEMgYWN0dWFsbHlcbiAqIGV4cGVjdHMgYSB7IHZhbHVlOiA8bnVtYmVyPiB9IHN0cnVjdC5cbiAqLyAobyk7XG4gICAgICAgIG4gPSBuZXcgaXMocywgaSwgciwgdSB8fCBudWxsKTtcbiAgICB9IGVsc2UgaWYgKFwiZG9jdW1lbnRDaGFuZ2VcIiBpbiBlKSB7XG4gICAgICAgIGUuZG9jdW1lbnRDaGFuZ2U7XG4gICAgICAgIGNvbnN0IHMgPSBlLmRvY3VtZW50Q2hhbmdlO1xuICAgICAgICBzLmRvY3VtZW50LCBzLmRvY3VtZW50Lm5hbWUsIHMuZG9jdW1lbnQudXBkYXRlVGltZTtcbiAgICAgICAgY29uc3QgaSA9IHBzKHQsIHMuZG9jdW1lbnQubmFtZSksIHIgPSB3cyhzLmRvY3VtZW50LnVwZGF0ZVRpbWUpLCBvID0gbmV3IHRlKHtcbiAgICAgICAgICAgIG1hcFZhbHVlOiB7XG4gICAgICAgICAgICAgICAgZmllbGRzOiBzLmRvY3VtZW50LmZpZWxkc1xuICAgICAgICAgICAgfVxuICAgICAgICB9KSwgdSA9IG5lLm5ld0ZvdW5kRG9jdW1lbnQoaSwgciwgbyksIGEgPSBzLnRhcmdldElkcyB8fCBbXSwgYyA9IHMucmVtb3ZlZFRhcmdldElkcyB8fCBbXTtcbiAgICAgICAgbiA9IG5ldyBucyhhLCBjLCB1LmtleSwgdSk7XG4gICAgfSBlbHNlIGlmIChcImRvY3VtZW50RGVsZXRlXCIgaW4gZSkge1xuICAgICAgICBlLmRvY3VtZW50RGVsZXRlO1xuICAgICAgICBjb25zdCBzID0gZS5kb2N1bWVudERlbGV0ZTtcbiAgICAgICAgcy5kb2N1bWVudDtcbiAgICAgICAgY29uc3QgaSA9IHBzKHQsIHMuZG9jdW1lbnQpLCByID0gcy5yZWFkVGltZSA/IHdzKHMucmVhZFRpbWUpIDogY3QubWluKCksIG8gPSBuZS5uZXdOb0RvY3VtZW50KGksIHIpLCB1ID0gcy5yZW1vdmVkVGFyZ2V0SWRzIHx8IFtdO1xuICAgICAgICBuID0gbmV3IG5zKFtdLCB1LCBvLmtleSwgbyk7XG4gICAgfSBlbHNlIGlmIChcImRvY3VtZW50UmVtb3ZlXCIgaW4gZSkge1xuICAgICAgICBlLmRvY3VtZW50UmVtb3ZlO1xuICAgICAgICBjb25zdCBzID0gZS5kb2N1bWVudFJlbW92ZTtcbiAgICAgICAgcy5kb2N1bWVudDtcbiAgICAgICAgY29uc3QgaSA9IHBzKHQsIHMuZG9jdW1lbnQpLCByID0gcy5yZW1vdmVkVGFyZ2V0SWRzIHx8IFtdO1xuICAgICAgICBuID0gbmV3IG5zKFtdLCByLCBpLCBudWxsKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoIShcImZpbHRlclwiIGluIGUpKSByZXR1cm4gTCgpO1xuICAgICAgICB7XG4gICAgICAgICAgICBlLmZpbHRlcjtcbiAgICAgICAgICAgIGNvbnN0IHQgPSBlLmZpbHRlcjtcbiAgICAgICAgICAgIHQudGFyZ2V0SWQ7XG4gICAgICAgICAgICBjb25zdCBzID0gdC5jb3VudCB8fCAwLCBpID0gbmV3ICRuKHMpLCByID0gdC50YXJnZXRJZDtcbiAgICAgICAgICAgIG4gPSBuZXcgc3MociwgaSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG47XG59XG5cbmZ1bmN0aW9uIHZzKHQsIGUpIHtcbiAgICBsZXQgbjtcbiAgICBpZiAoZSBpbnN0YW5jZW9mIENuKSBuID0ge1xuICAgICAgICB1cGRhdGU6IFJzKHQsIGUua2V5LCBlLnZhbHVlKVxuICAgIH07IGVsc2UgaWYgKGUgaW5zdGFuY2VvZiBPbikgbiA9IHtcbiAgICAgICAgZGVsZXRlOiB5cyh0LCBlLmtleSlcbiAgICB9OyBlbHNlIGlmIChlIGluc3RhbmNlb2YgeG4pIG4gPSB7XG4gICAgICAgIHVwZGF0ZTogUnModCwgZS5rZXksIGUuZGF0YSksXG4gICAgICAgIHVwZGF0ZU1hc2s6IHFzKGUuZmllbGRNYXNrKVxuICAgIH07IGVsc2Uge1xuICAgICAgICBpZiAoIShlIGluc3RhbmNlb2YgRm4pKSByZXR1cm4gTCgpO1xuICAgICAgICBuID0ge1xuICAgICAgICAgICAgdmVyaWZ5OiB5cyh0LCBlLmtleSlcbiAgICAgICAgfTtcbiAgICB9XG4gICAgcmV0dXJuIGUuZmllbGRUcmFuc2Zvcm1zLmxlbmd0aCA+IDAgJiYgKG4udXBkYXRlVHJhbnNmb3JtcyA9IGUuZmllbGRUcmFuc2Zvcm1zLm1hcCgodCA9PiBmdW5jdGlvbih0LCBlKSB7XG4gICAgICAgIGNvbnN0IG4gPSBlLnRyYW5zZm9ybTtcbiAgICAgICAgaWYgKG4gaW5zdGFuY2VvZiBmbikgcmV0dXJuIHtcbiAgICAgICAgICAgIGZpZWxkUGF0aDogZS5maWVsZC5jYW5vbmljYWxTdHJpbmcoKSxcbiAgICAgICAgICAgIHNldFRvU2VydmVyVmFsdWU6IFwiUkVRVUVTVF9USU1FXCJcbiAgICAgICAgfTtcbiAgICAgICAgaWYgKG4gaW5zdGFuY2VvZiBkbikgcmV0dXJuIHtcbiAgICAgICAgICAgIGZpZWxkUGF0aDogZS5maWVsZC5jYW5vbmljYWxTdHJpbmcoKSxcbiAgICAgICAgICAgIGFwcGVuZE1pc3NpbmdFbGVtZW50czoge1xuICAgICAgICAgICAgICAgIHZhbHVlczogbi5lbGVtZW50c1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICBpZiAobiBpbnN0YW5jZW9mIHduKSByZXR1cm4ge1xuICAgICAgICAgICAgZmllbGRQYXRoOiBlLmZpZWxkLmNhbm9uaWNhbFN0cmluZygpLFxuICAgICAgICAgICAgcmVtb3ZlQWxsRnJvbUFycmF5OiB7XG4gICAgICAgICAgICAgICAgdmFsdWVzOiBuLmVsZW1lbnRzXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIGlmIChuIGluc3RhbmNlb2YgZ24pIHJldHVybiB7XG4gICAgICAgICAgICBmaWVsZFBhdGg6IGUuZmllbGQuY2Fub25pY2FsU3RyaW5nKCksXG4gICAgICAgICAgICBpbmNyZW1lbnQ6IG4ua1xuICAgICAgICB9O1xuICAgICAgICB0aHJvdyBMKCk7XG4gICAgfSgwLCB0KSkpKSwgZS5wcmVjb25kaXRpb24uaXNOb25lIHx8IChuLmN1cnJlbnREb2N1bWVudCA9IGZ1bmN0aW9uKHQsIGUpIHtcbiAgICAgICAgcmV0dXJuIHZvaWQgMCAhPT0gZS51cGRhdGVUaW1lID8ge1xuICAgICAgICAgICAgdXBkYXRlVGltZTogX3ModCwgZS51cGRhdGVUaW1lKVxuICAgICAgICB9IDogdm9pZCAwICE9PSBlLmV4aXN0cyA/IHtcbiAgICAgICAgICAgIGV4aXN0czogZS5leGlzdHNcbiAgICAgICAgfSA6IEwoKTtcbiAgICB9KHQsIGUucHJlY29uZGl0aW9uKSksIG47XG59XG5cbmZ1bmN0aW9uIFNzKHQsIGUpIHtcbiAgICBjb25zdCBuID0gZS5jdXJyZW50RG9jdW1lbnQgPyBmdW5jdGlvbih0KSB7XG4gICAgICAgIHJldHVybiB2b2lkIDAgIT09IHQudXBkYXRlVGltZSA/IEFuLnVwZGF0ZVRpbWUod3ModC51cGRhdGVUaW1lKSkgOiB2b2lkIDAgIT09IHQuZXhpc3RzID8gQW4uZXhpc3RzKHQuZXhpc3RzKSA6IEFuLm5vbmUoKTtcbiAgICB9KGUuY3VycmVudERvY3VtZW50KSA6IEFuLm5vbmUoKSwgcyA9IGUudXBkYXRlVHJhbnNmb3JtcyA/IGUudXBkYXRlVHJhbnNmb3Jtcy5tYXAoKGUgPT4gZnVuY3Rpb24odCwgZSkge1xuICAgICAgICBsZXQgbiA9IG51bGw7XG4gICAgICAgIGlmIChcInNldFRvU2VydmVyVmFsdWVcIiBpbiBlKSBVKFwiUkVRVUVTVF9USU1FXCIgPT09IGUuc2V0VG9TZXJ2ZXJWYWx1ZSksIG4gPSBuZXcgZm47IGVsc2UgaWYgKFwiYXBwZW5kTWlzc2luZ0VsZW1lbnRzXCIgaW4gZSkge1xuICAgICAgICAgICAgY29uc3QgdCA9IGUuYXBwZW5kTWlzc2luZ0VsZW1lbnRzLnZhbHVlcyB8fCBbXTtcbiAgICAgICAgICAgIG4gPSBuZXcgZG4odCk7XG4gICAgICAgIH0gZWxzZSBpZiAoXCJyZW1vdmVBbGxGcm9tQXJyYXlcIiBpbiBlKSB7XG4gICAgICAgICAgICBjb25zdCB0ID0gZS5yZW1vdmVBbGxGcm9tQXJyYXkudmFsdWVzIHx8IFtdO1xuICAgICAgICAgICAgbiA9IG5ldyB3bih0KTtcbiAgICAgICAgfSBlbHNlIFwiaW5jcmVtZW50XCIgaW4gZSA/IG4gPSBuZXcgZ24odCwgZS5pbmNyZW1lbnQpIDogTCgpO1xuICAgICAgICBjb25zdCBzID0gbXQuZnJvbVNlcnZlckZvcm1hdChlLmZpZWxkUGF0aCk7XG4gICAgICAgIHJldHVybiBuZXcgSW4ocywgbik7XG4gICAgfSh0LCBlKSkpIDogW107XG4gICAgaWYgKGUudXBkYXRlKSB7XG4gICAgICAgIGUudXBkYXRlLm5hbWU7XG4gICAgICAgIGNvbnN0IGkgPSBwcyh0LCBlLnVwZGF0ZS5uYW1lKSwgciA9IG5ldyB0ZSh7XG4gICAgICAgICAgICBtYXBWYWx1ZToge1xuICAgICAgICAgICAgICAgIGZpZWxkczogZS51cGRhdGUuZmllbGRzXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBpZiAoZS51cGRhdGVNYXNrKSB7XG4gICAgICAgICAgICBjb25zdCB0ID0gZnVuY3Rpb24odCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGUgPSB0LmZpZWxkUGF0aHMgfHwgW107XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBndChlLm1hcCgodCA9PiBtdC5mcm9tU2VydmVyRm9ybWF0KHQpKSkpO1xuICAgICAgICAgICAgfShlLnVwZGF0ZU1hc2spO1xuICAgICAgICAgICAgcmV0dXJuIG5ldyB4bihpLCByLCB0LCBuLCBzKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmV3IENuKGksIHIsIG4sIHMpO1xuICAgIH1cbiAgICBpZiAoZS5kZWxldGUpIHtcbiAgICAgICAgY29uc3QgcyA9IHBzKHQsIGUuZGVsZXRlKTtcbiAgICAgICAgcmV0dXJuIG5ldyBPbihzLCBuKTtcbiAgICB9XG4gICAgaWYgKGUudmVyaWZ5KSB7XG4gICAgICAgIGNvbnN0IHMgPSBwcyh0LCBlLnZlcmlmeSk7XG4gICAgICAgIHJldHVybiBuZXcgRm4ocywgbik7XG4gICAgfVxuICAgIHJldHVybiBMKCk7XG59XG5cbmZ1bmN0aW9uIERzKHQsIGUpIHtcbiAgICByZXR1cm4gdCAmJiB0Lmxlbmd0aCA+IDAgPyAoVSh2b2lkIDAgIT09IGUpLCB0Lm1hcCgodCA9PiBmdW5jdGlvbih0LCBlKSB7XG4gICAgICAgIC8vIE5PVEU6IERlbGV0ZXMgZG9uJ3QgaGF2ZSBhbiB1cGRhdGVUaW1lLlxuICAgICAgICBsZXQgbiA9IHQudXBkYXRlVGltZSA/IHdzKHQudXBkYXRlVGltZSkgOiB3cyhlKTtcbiAgICAgICAgcmV0dXJuIG4uaXNFcXVhbChjdC5taW4oKSkgJiYgKFxuICAgICAgICAvLyBUaGUgRmlyZXN0b3JlIEVtdWxhdG9yIGN1cnJlbnRseSByZXR1cm5zIGFuIHVwZGF0ZSB0aW1lIG9mIDAgZm9yXG4gICAgICAgIC8vIGRlbGV0ZXMgb2Ygbm9uLWV4aXN0aW5nIGRvY3VtZW50cyAocmF0aGVyIHRoYW4gbnVsbCkuIFRoaXMgYnJlYWtzIHRoZVxuICAgICAgICAvLyB0ZXN0IFwiZ2V0IGRlbGV0ZWQgZG9jIHdoaWxlIG9mZmxpbmUgd2l0aCBzb3VyY2U9Y2FjaGVcIiBhcyBOb0RvY3VtZW50c1xuICAgICAgICAvLyB3aXRoIHZlcnNpb24gMCBhcmUgZmlsdGVyZWQgYnkgSW5kZXhlZERiJ3MgUmVtb3RlRG9jdW1lbnRDYWNoZS5cbiAgICAgICAgLy8gVE9ETygjMjE0OSk6IFJlbW92ZSB0aGlzIHdoZW4gRW11bGF0b3IgaXMgZml4ZWRcbiAgICAgICAgbiA9IHdzKGUpKSwgbmV3IEVuKG4sIHQudHJhbnNmb3JtUmVzdWx0cyB8fCBbXSk7XG4gICAgfSh0LCBlKSkpKSA6IFtdO1xufVxuXG5mdW5jdGlvbiBDcyh0LCBlKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgZG9jdW1lbnRzOiBbIElzKHQsIGUucGF0aCkgXVxuICAgIH07XG59XG5cbmZ1bmN0aW9uIHhzKHQsIGUpIHtcbiAgICAvLyBEaXNzZWN0IHRoZSBwYXRoIGludG8gcGFyZW50LCBjb2xsZWN0aW9uSWQsIGFuZCBvcHRpb25hbCBrZXkgZmlsdGVyLlxuICAgIGNvbnN0IG4gPSB7XG4gICAgICAgIHN0cnVjdHVyZWRRdWVyeToge31cbiAgICB9LCBzID0gZS5wYXRoO1xuICAgIG51bGwgIT09IGUuY29sbGVjdGlvbkdyb3VwID8gKG4ucGFyZW50ID0gSXModCwgcyksIG4uc3RydWN0dXJlZFF1ZXJ5LmZyb20gPSBbIHtcbiAgICAgICAgY29sbGVjdGlvbklkOiBlLmNvbGxlY3Rpb25Hcm91cCxcbiAgICAgICAgYWxsRGVzY2VuZGFudHM6ICEwXG4gICAgfSBdKSA6IChuLnBhcmVudCA9IElzKHQsIHMucG9wTGFzdCgpKSwgbi5zdHJ1Y3R1cmVkUXVlcnkuZnJvbSA9IFsge1xuICAgICAgICBjb2xsZWN0aW9uSWQ6IHMubGFzdFNlZ21lbnQoKVxuICAgIH0gXSk7XG4gICAgY29uc3QgaSA9IGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgaWYgKDAgPT09IHQubGVuZ3RoKSByZXR1cm47XG4gICAgICAgIGNvbnN0IGUgPSB0Lm1hcCgodCA9PiBcbiAgICAgICAgLy8gdmlzaWJsZSBmb3IgdGVzdGluZ1xuICAgICAgICBmdW5jdGlvbih0KSB7XG4gICAgICAgICAgICBpZiAoXCI9PVwiIC8qIEVRVUFMICovID09PSB0Lm9wKSB7XG4gICAgICAgICAgICAgICAgaWYgKGp0KHQudmFsdWUpKSByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICB1bmFyeUZpbHRlcjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgZmllbGQ6ICRzKHQuZmllbGQpLFxuICAgICAgICAgICAgICAgICAgICAgICAgb3A6IFwiSVNfTkFOXCJcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgaWYgKFF0KHQudmFsdWUpKSByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICB1bmFyeUZpbHRlcjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgZmllbGQ6ICRzKHQuZmllbGQpLFxuICAgICAgICAgICAgICAgICAgICAgICAgb3A6IFwiSVNfTlVMTFwiXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSBlbHNlIGlmIChcIiE9XCIgLyogTk9UX0VRVUFMICovID09PSB0Lm9wKSB7XG4gICAgICAgICAgICAgICAgaWYgKGp0KHQudmFsdWUpKSByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICB1bmFyeUZpbHRlcjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgZmllbGQ6ICRzKHQuZmllbGQpLFxuICAgICAgICAgICAgICAgICAgICAgICAgb3A6IFwiSVNfTk9UX05BTlwiXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGlmIChRdCh0LnZhbHVlKSkgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgdW5hcnlGaWx0ZXI6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkOiAkcyh0LmZpZWxkKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wOiBcIklTX05PVF9OVUxMXCJcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGZpZWxkRmlsdGVyOiB7XG4gICAgICAgICAgICAgICAgICAgIGZpZWxkOiAkcyh0LmZpZWxkKSxcbiAgICAgICAgICAgICAgICAgICAgb3A6IEZzKHQub3ApLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdC52YWx1ZVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgIH0odCkpKTtcbiAgICAgICAgaWYgKDEgPT09IGUubGVuZ3RoKSByZXR1cm4gZVswXTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGNvbXBvc2l0ZUZpbHRlcjoge1xuICAgICAgICAgICAgICAgIG9wOiBcIkFORFwiLFxuICAgICAgICAgICAgICAgIGZpbHRlcnM6IGVcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9KGUuZmlsdGVycyk7XG4gICAgaSAmJiAobi5zdHJ1Y3R1cmVkUXVlcnkud2hlcmUgPSBpKTtcbiAgICBjb25zdCByID0gZnVuY3Rpb24odCkge1xuICAgICAgICBpZiAoMCA9PT0gdC5sZW5ndGgpIHJldHVybjtcbiAgICAgICAgcmV0dXJuIHQubWFwKCh0ID0+IFxuICAgICAgICAvLyB2aXNpYmxlIGZvciB0ZXN0aW5nXG4gICAgICAgIGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgZmllbGQ6ICRzKHQuZmllbGQpLFxuICAgICAgICAgICAgICAgIGRpcmVjdGlvbjogT3ModC5kaXIpXG4gICAgICAgICAgICB9O1xuICAgICAgICB9KHQpKSk7XG4gICAgfShlLm9yZGVyQnkpO1xuICAgIHIgJiYgKG4uc3RydWN0dXJlZFF1ZXJ5Lm9yZGVyQnkgPSByKTtcbiAgICBjb25zdCBvID0gZnVuY3Rpb24odCwgZSkge1xuICAgICAgICByZXR1cm4gdC5OIHx8IFN0KGUpID8gZSA6IHtcbiAgICAgICAgICAgIHZhbHVlOiBlXG4gICAgICAgIH07XG4gICAgfVxuICAgIC8qKlxuICogUmV0dXJucyBhIG51bWJlciAob3IgbnVsbCkgZnJvbSBhIGdvb2dsZS5wcm90b2J1Zi5JbnQzMlZhbHVlIHByb3RvLlxuICovICh0LCBlLmxpbWl0KTtcbiAgICB2YXIgdTtcbiAgICByZXR1cm4gbnVsbCAhPT0gbyAmJiAobi5zdHJ1Y3R1cmVkUXVlcnkubGltaXQgPSBvKSwgZS5zdGFydEF0ICYmIChuLnN0cnVjdHVyZWRRdWVyeS5zdGFydEF0ID0ge1xuICAgICAgICBiZWZvcmU6ICh1ID0gZS5zdGFydEF0KS5pbmNsdXNpdmUsXG4gICAgICAgIHZhbHVlczogdS5wb3NpdGlvblxuICAgIH0pLCBlLmVuZEF0ICYmIChuLnN0cnVjdHVyZWRRdWVyeS5lbmRBdCA9IGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGJlZm9yZTogIXQuaW5jbHVzaXZlLFxuICAgICAgICAgICAgdmFsdWVzOiB0LnBvc2l0aW9uXG4gICAgICAgIH07XG4gICAgfShlLmVuZEF0KSksIG47XG59XG5cbmZ1bmN0aW9uIE5zKHQpIHtcbiAgICBsZXQgZSA9IFRzKHQucGFyZW50KTtcbiAgICBjb25zdCBuID0gdC5zdHJ1Y3R1cmVkUXVlcnksIHMgPSBuLmZyb20gPyBuLmZyb20ubGVuZ3RoIDogMDtcbiAgICBsZXQgaSA9IG51bGw7XG4gICAgaWYgKHMgPiAwKSB7XG4gICAgICAgIFUoMSA9PT0gcyk7XG4gICAgICAgIGNvbnN0IHQgPSBuLmZyb21bMF07XG4gICAgICAgIHQuYWxsRGVzY2VuZGFudHMgPyBpID0gdC5jb2xsZWN0aW9uSWQgOiBlID0gZS5jaGlsZCh0LmNvbGxlY3Rpb25JZCk7XG4gICAgfVxuICAgIGxldCByID0gW107XG4gICAgbi53aGVyZSAmJiAociA9IE1zKG4ud2hlcmUpKTtcbiAgICBsZXQgbyA9IFtdO1xuICAgIG4ub3JkZXJCeSAmJiAobyA9IG4ub3JkZXJCeS5tYXAoKHQgPT4gZnVuY3Rpb24odCkge1xuICAgICAgICByZXR1cm4gbmV3IEZlKEJzKHQuZmllbGQpLCBcbiAgICAgICAgLy8gdmlzaWJsZSBmb3IgdGVzdGluZ1xuICAgICAgICBmdW5jdGlvbih0KSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHQpIHtcbiAgICAgICAgICAgICAgY2FzZSBcIkFTQ0VORElOR1wiOlxuICAgICAgICAgICAgICAgIHJldHVybiBcImFzY1wiIC8qIEFTQ0VORElORyAqLztcblxuICAgICAgICAgICAgICBjYXNlIFwiREVTQ0VORElOR1wiOlxuICAgICAgICAgICAgICAgIHJldHVybiBcImRlc2NcIiAvKiBERVNDRU5ESU5HICovO1xuXG4gICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIHZpc2libGUgZm9yIHRlc3RpbmdcbiAgICAgICAgKHQuZGlyZWN0aW9uKSk7XG4gICAgfSh0KSkpKTtcbiAgICBsZXQgdSA9IG51bGw7XG4gICAgbi5saW1pdCAmJiAodSA9IGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgbGV0IGU7XG4gICAgICAgIHJldHVybiBlID0gXCJvYmplY3RcIiA9PSB0eXBlb2YgdCA/IHQudmFsdWUgOiB0LCBTdChlKSA/IG51bGwgOiBlO1xuICAgIH0obi5saW1pdCkpO1xuICAgIGxldCBhID0gbnVsbDtcbiAgICBuLnN0YXJ0QXQgJiYgKGEgPSBmdW5jdGlvbih0KSB7XG4gICAgICAgIGNvbnN0IGUgPSAhIXQuYmVmb3JlLCBuID0gdC52YWx1ZXMgfHwgW107XG4gICAgICAgIHJldHVybiBuZXcgT2UobiwgZSk7XG4gICAgfShuLnN0YXJ0QXQpKTtcbiAgICBsZXQgYyA9IG51bGw7XG4gICAgcmV0dXJuIG4uZW5kQXQgJiYgKGMgPSBmdW5jdGlvbih0KSB7XG4gICAgICAgIGNvbnN0IGUgPSAhdC5iZWZvcmUsIG4gPSB0LnZhbHVlcyB8fCBbXTtcbiAgICAgICAgcmV0dXJuIG5ldyBPZShuLCBlKTtcbiAgICB9XG4gICAgLy8gdmlzaWJsZSBmb3IgdGVzdGluZ1xuICAgIChuLmVuZEF0KSksIHFlKGUsIGksIG8sIHIsIHUsIFwiRlwiIC8qIEZpcnN0ICovICwgYSwgYyk7XG59XG5cbmZ1bmN0aW9uIGtzKHQsIGUpIHtcbiAgICBjb25zdCBuID0gZnVuY3Rpb24odCwgZSkge1xuICAgICAgICBzd2l0Y2ggKGUpIHtcbiAgICAgICAgICBjYXNlIDAgLyogTGlzdGVuICovIDpcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuXG4gICAgICAgICAgY2FzZSAxIC8qIEV4aXN0ZW5jZUZpbHRlck1pc21hdGNoICovIDpcbiAgICAgICAgICAgIHJldHVybiBcImV4aXN0ZW5jZS1maWx0ZXItbWlzbWF0Y2hcIjtcblxuICAgICAgICAgIGNhc2UgMiAvKiBMaW1ib1Jlc29sdXRpb24gKi8gOlxuICAgICAgICAgICAgcmV0dXJuIFwibGltYm8tZG9jdW1lbnRcIjtcblxuICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICByZXR1cm4gTCgpO1xuICAgICAgICB9XG4gICAgfSgwLCBlLnB1cnBvc2UpO1xuICAgIHJldHVybiBudWxsID09IG4gPyBudWxsIDoge1xuICAgICAgICBcImdvb2ctbGlzdGVuLXRhZ3NcIjogblxuICAgIH07XG59XG5cbmZ1bmN0aW9uIE1zKHQpIHtcbiAgICByZXR1cm4gdCA/IHZvaWQgMCAhPT0gdC51bmFyeUZpbHRlciA/IFsgVXModCkgXSA6IHZvaWQgMCAhPT0gdC5maWVsZEZpbHRlciA/IFsgTHModCkgXSA6IHZvaWQgMCAhPT0gdC5jb21wb3NpdGVGaWx0ZXIgPyB0LmNvbXBvc2l0ZUZpbHRlci5maWx0ZXJzLm1hcCgodCA9PiBNcyh0KSkpLnJlZHVjZSgoKHQsIGUpID0+IHQuY29uY2F0KGUpKSkgOiBMKCkgOiBbXTtcbn1cblxuZnVuY3Rpb24gT3ModCkge1xuICAgIHJldHVybiBjc1t0XTtcbn1cblxuZnVuY3Rpb24gRnModCkge1xuICAgIHJldHVybiBoc1t0XTtcbn1cblxuZnVuY3Rpb24gJHModCkge1xuICAgIHJldHVybiB7XG4gICAgICAgIGZpZWxkUGF0aDogdC5jYW5vbmljYWxTdHJpbmcoKVxuICAgIH07XG59XG5cbmZ1bmN0aW9uIEJzKHQpIHtcbiAgICByZXR1cm4gbXQuZnJvbVNlcnZlckZvcm1hdCh0LmZpZWxkUGF0aCk7XG59XG5cbmZ1bmN0aW9uIExzKHQpIHtcbiAgICByZXR1cm4gVmUuY3JlYXRlKEJzKHQuZmllbGRGaWx0ZXIuZmllbGQpLCBmdW5jdGlvbih0KSB7XG4gICAgICAgIHN3aXRjaCAodCkge1xuICAgICAgICAgIGNhc2UgXCJFUVVBTFwiOlxuICAgICAgICAgICAgcmV0dXJuIFwiPT1cIiAvKiBFUVVBTCAqLztcblxuICAgICAgICAgIGNhc2UgXCJOT1RfRVFVQUxcIjpcbiAgICAgICAgICAgIHJldHVybiBcIiE9XCIgLyogTk9UX0VRVUFMICovO1xuXG4gICAgICAgICAgY2FzZSBcIkdSRUFURVJfVEhBTlwiOlxuICAgICAgICAgICAgcmV0dXJuIFwiPlwiIC8qIEdSRUFURVJfVEhBTiAqLztcblxuICAgICAgICAgIGNhc2UgXCJHUkVBVEVSX1RIQU5fT1JfRVFVQUxcIjpcbiAgICAgICAgICAgIHJldHVybiBcIj49XCIgLyogR1JFQVRFUl9USEFOX09SX0VRVUFMICovO1xuXG4gICAgICAgICAgY2FzZSBcIkxFU1NfVEhBTlwiOlxuICAgICAgICAgICAgcmV0dXJuIFwiPFwiIC8qIExFU1NfVEhBTiAqLztcblxuICAgICAgICAgIGNhc2UgXCJMRVNTX1RIQU5fT1JfRVFVQUxcIjpcbiAgICAgICAgICAgIHJldHVybiBcIjw9XCIgLyogTEVTU19USEFOX09SX0VRVUFMICovO1xuXG4gICAgICAgICAgY2FzZSBcIkFSUkFZX0NPTlRBSU5TXCI6XG4gICAgICAgICAgICByZXR1cm4gXCJhcnJheS1jb250YWluc1wiIC8qIEFSUkFZX0NPTlRBSU5TICovO1xuXG4gICAgICAgICAgY2FzZSBcIklOXCI6XG4gICAgICAgICAgICByZXR1cm4gXCJpblwiIC8qIElOICovO1xuXG4gICAgICAgICAgY2FzZSBcIk5PVF9JTlwiOlxuICAgICAgICAgICAgcmV0dXJuIFwibm90LWluXCIgLyogTk9UX0lOICovO1xuXG4gICAgICAgICAgY2FzZSBcIkFSUkFZX0NPTlRBSU5TX0FOWVwiOlxuICAgICAgICAgICAgcmV0dXJuIFwiYXJyYXktY29udGFpbnMtYW55XCIgLyogQVJSQVlfQ09OVEFJTlNfQU5ZICovO1xuXG4gICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIHJldHVybiBMKCk7XG4gICAgICAgIH1cbiAgICB9KHQuZmllbGRGaWx0ZXIub3ApLCB0LmZpZWxkRmlsdGVyLnZhbHVlKTtcbn1cblxuZnVuY3Rpb24gVXModCkge1xuICAgIHN3aXRjaCAodC51bmFyeUZpbHRlci5vcCkge1xuICAgICAgY2FzZSBcIklTX05BTlwiOlxuICAgICAgICBjb25zdCBlID0gQnModC51bmFyeUZpbHRlci5maWVsZCk7XG4gICAgICAgIHJldHVybiBWZS5jcmVhdGUoZSwgXCI9PVwiIC8qIEVRVUFMICovICwge1xuICAgICAgICAgICAgZG91YmxlVmFsdWU6IE5hTlxuICAgICAgICB9KTtcblxuICAgICAgY2FzZSBcIklTX05VTExcIjpcbiAgICAgICAgY29uc3QgbiA9IEJzKHQudW5hcnlGaWx0ZXIuZmllbGQpO1xuICAgICAgICByZXR1cm4gVmUuY3JlYXRlKG4sIFwiPT1cIiAvKiBFUVVBTCAqLyAsIHtcbiAgICAgICAgICAgIG51bGxWYWx1ZTogXCJOVUxMX1ZBTFVFXCJcbiAgICAgICAgfSk7XG5cbiAgICAgIGNhc2UgXCJJU19OT1RfTkFOXCI6XG4gICAgICAgIGNvbnN0IHMgPSBCcyh0LnVuYXJ5RmlsdGVyLmZpZWxkKTtcbiAgICAgICAgcmV0dXJuIFZlLmNyZWF0ZShzLCBcIiE9XCIgLyogTk9UX0VRVUFMICovICwge1xuICAgICAgICAgICAgZG91YmxlVmFsdWU6IE5hTlxuICAgICAgICB9KTtcblxuICAgICAgY2FzZSBcIklTX05PVF9OVUxMXCI6XG4gICAgICAgIGNvbnN0IGkgPSBCcyh0LnVuYXJ5RmlsdGVyLmZpZWxkKTtcbiAgICAgICAgcmV0dXJuIFZlLmNyZWF0ZShpLCBcIiE9XCIgLyogTk9UX0VRVUFMICovICwge1xuICAgICAgICAgICAgbnVsbFZhbHVlOiBcIk5VTExfVkFMVUVcIlxuICAgICAgICB9KTtcblxuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuIEwoKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIHFzKHQpIHtcbiAgICBjb25zdCBlID0gW107XG4gICAgcmV0dXJuIHQuZmllbGRzLmZvckVhY2goKHQgPT4gZS5wdXNoKHQuY2Fub25pY2FsU3RyaW5nKCkpKSksIHtcbiAgICAgICAgZmllbGRQYXRoczogZVxuICAgIH07XG59XG5cbmZ1bmN0aW9uIEtzKHQpIHtcbiAgICAvLyBSZXNvdXJjZSBuYW1lcyBoYXZlIGF0IGxlYXN0IDQgY29tcG9uZW50cyAocHJvamVjdCBJRCwgZGF0YWJhc2UgSUQpXG4gICAgcmV0dXJuIHQubGVuZ3RoID49IDQgJiYgXCJwcm9qZWN0c1wiID09PSB0LmdldCgwKSAmJiBcImRhdGFiYXNlc1wiID09PSB0LmdldCgyKTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogRW5jb2RlcyBhIHJlc291cmNlIHBhdGggaW50byBhIEluZGV4ZWREYi1jb21wYXRpYmxlIHN0cmluZyBmb3JtLlxuICovXG5mdW5jdGlvbiBHcyh0KSB7XG4gICAgbGV0IGUgPSBcIlwiO1xuICAgIGZvciAobGV0IG4gPSAwOyBuIDwgdC5sZW5ndGg7IG4rKykgZS5sZW5ndGggPiAwICYmIChlID0ganMoZSkpLCBlID0gUXModC5nZXQobiksIGUpO1xuICAgIHJldHVybiBqcyhlKTtcbn1cblxuLyoqIEVuY29kZXMgYSBzaW5nbGUgc2VnbWVudCBvZiBhIHJlc291cmNlIHBhdGggaW50byB0aGUgZ2l2ZW4gcmVzdWx0ICovIGZ1bmN0aW9uIFFzKHQsIGUpIHtcbiAgICBsZXQgbiA9IGU7XG4gICAgY29uc3QgcyA9IHQubGVuZ3RoO1xuICAgIGZvciAobGV0IGUgPSAwOyBlIDwgczsgZSsrKSB7XG4gICAgICAgIGNvbnN0IHMgPSB0LmNoYXJBdChlKTtcbiAgICAgICAgc3dpdGNoIChzKSB7XG4gICAgICAgICAgY2FzZSBcIlxcMFwiOlxuICAgICAgICAgICAgbiArPSBcIlx1MDAwMVx1MDAxMFwiO1xuICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICBjYXNlIFwiXHUwMDAxXCI6XG4gICAgICAgICAgICBuICs9IFwiXHUwMDAxXHUwMDExXCI7XG4gICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICBuICs9IHM7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG47XG59XG5cbi8qKiBFbmNvZGVzIGEgcGF0aCBzZXBhcmF0b3IgaW50byB0aGUgZ2l2ZW4gcmVzdWx0ICovIGZ1bmN0aW9uIGpzKHQpIHtcbiAgICByZXR1cm4gdCArIFwiXHUwMDAxXHUwMDAxXCI7XG59XG5cbi8qKlxuICogRGVjb2RlcyB0aGUgZ2l2ZW4gSW5kZXhlZERiLWNvbXBhdGlibGUgc3RyaW5nIGZvcm0gb2YgYSByZXNvdXJjZSBwYXRoIGludG9cbiAqIGEgUmVzb3VyY2VQYXRoIGluc3RhbmNlLiBOb3RlIHRoYXQgdGhpcyBtZXRob2QgaXMgbm90IHN1aXRhYmxlIGZvciB1c2Ugd2l0aFxuICogZGVjb2RpbmcgcmVzb3VyY2UgbmFtZXMgZnJvbSB0aGUgc2VydmVyOyB0aG9zZSBhcmUgT25lIFBsYXRmb3JtIGZvcm1hdFxuICogc3RyaW5ncy5cbiAqLyBmdW5jdGlvbiBXcyh0KSB7XG4gICAgLy8gRXZlbnQgdGhlIGVtcHR5IHBhdGggbXVzdCBlbmNvZGUgYXMgYSBwYXRoIG9mIGF0IGxlYXN0IGxlbmd0aCAyLiBBIHBhdGhcbiAgICAvLyB3aXRoIGV4YWN0bHkgMiBtdXN0IGJlIHRoZSBlbXB0eSBwYXRoLlxuICAgIGNvbnN0IGUgPSB0Lmxlbmd0aDtcbiAgICBpZiAoVShlID49IDIpLCAyID09PSBlKSByZXR1cm4gVShcIlx1MDAwMVwiID09PSB0LmNoYXJBdCgwKSAmJiBcIlx1MDAwMVwiID09PSB0LmNoYXJBdCgxKSksIF90LmVtcHR5UGF0aCgpO1xuICAgIC8vIEVzY2FwZSBjaGFyYWN0ZXJzIGNhbm5vdCBleGlzdCBwYXN0IHRoZSBzZWNvbmQtdG8tbGFzdCBwb3NpdGlvbiBpbiB0aGVcbiAgICAvLyBzb3VyY2UgdmFsdWUuXG4gICAgICAgIGNvbnN0IG4gPSBlIC0gMiwgcyA9IFtdO1xuICAgIGxldCBpID0gXCJcIjtcbiAgICBmb3IgKGxldCByID0gMDsgciA8IGU7ICkge1xuICAgICAgICAvLyBUaGUgbGFzdCB0d28gY2hhcmFjdGVycyBvZiBhIHZhbGlkIGVuY29kZWQgcGF0aCBtdXN0IGJlIGEgc2VwYXJhdG9yLCBzb1xuICAgICAgICAvLyB0aGVyZSBtdXN0IGJlIGFuIGVuZCB0byB0aGlzIHNlZ21lbnQuXG4gICAgICAgIGNvbnN0IGUgPSB0LmluZGV4T2YoXCJcdTAwMDFcIiwgcik7XG4gICAgICAgIChlIDwgMCB8fCBlID4gbikgJiYgTCgpO1xuICAgICAgICBzd2l0Y2ggKHQuY2hhckF0KGUgKyAxKSkge1xuICAgICAgICAgIGNhc2UgXCJcdTAwMDFcIjpcbiAgICAgICAgICAgIGNvbnN0IG4gPSB0LnN1YnN0cmluZyhyLCBlKTtcbiAgICAgICAgICAgIGxldCBvO1xuICAgICAgICAgICAgMCA9PT0gaS5sZW5ndGggPyBcbiAgICAgICAgICAgIC8vIEF2b2lkIGNvcHlpbmcgZm9yIHRoZSBjb21tb24gY2FzZSBvZiBhIHNlZ21lbnQgdGhhdCBleGNsdWRlcyBcXDBcbiAgICAgICAgICAgIC8vIGFuZCBcXDAwMVxuICAgICAgICAgICAgbyA9IG4gOiAoaSArPSBuLCBvID0gaSwgaSA9IFwiXCIpLCBzLnB1c2gobyk7XG4gICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgIGNhc2UgXCJcdTAwMTBcIjpcbiAgICAgICAgICAgIGkgKz0gdC5zdWJzdHJpbmcociwgZSksIGkgKz0gXCJcXDBcIjtcbiAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgY2FzZSBcIlx1MDAxMVwiOlxuICAgICAgICAgICAgLy8gVGhlIGVzY2FwZSBjaGFyYWN0ZXIgY2FuIGJlIHVzZWQgaW4gdGhlIG91dHB1dCB0byBlbmNvZGUgaXRzZWxmLlxuICAgICAgICAgICAgaSArPSB0LnN1YnN0cmluZyhyLCBlICsgMSk7XG4gICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICBMKCk7XG4gICAgICAgIH1cbiAgICAgICAgciA9IGUgKyAyO1xuICAgIH1cbiAgICByZXR1cm4gbmV3IF90KHMpO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMiBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqLyBjb25zdCB6cyA9IFsgXCJ1c2VySWRcIiwgXCJiYXRjaElkXCIgXTtcblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjIgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogTmFtZSBvZiB0aGUgSW5kZXhlZERiIG9iamVjdCBzdG9yZS5cbiAqXG4gKiBOb3RlIHRoYXQgdGhlIG5hbWUgJ293bmVyJyBpcyBjaG9zZW4gdG8gZW5zdXJlIGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5IHdpdGhcbiAqIG9sZGVyIGNsaWVudHMgdGhhdCBvbmx5IHN1cHBvcnRlZCBzaW5nbGUgbG9ja2VkIGFjY2VzcyB0byB0aGUgcGVyc2lzdGVuY2VcbiAqIGxheWVyLlxuICovXG4vKipcbiAqIENyZWF0ZXMgYSBbdXNlcklkLCBlbmNvZGVkUGF0aF0ga2V5IGZvciB1c2UgaW4gdGhlIERiRG9jdW1lbnRNdXRhdGlvbnNcbiAqIGluZGV4IHRvIGl0ZXJhdGUgb3ZlciBhbGwgYXQgZG9jdW1lbnQgbXV0YXRpb25zIGZvciBhIGdpdmVuIHBhdGggb3IgbG93ZXIuXG4gKi9cbmZ1bmN0aW9uIEhzKHQsIGUpIHtcbiAgICByZXR1cm4gWyB0LCBHcyhlKSBdO1xufVxuXG4vKipcbiAqIENyZWF0ZXMgYSBmdWxsIGluZGV4IGtleSBvZiBbdXNlcklkLCBlbmNvZGVkUGF0aCwgYmF0Y2hJZF0gZm9yIGluc2VydGluZ1xuICogYW5kIGRlbGV0aW5nIGludG8gdGhlIERiRG9jdW1lbnRNdXRhdGlvbnMgaW5kZXguXG4gKi8gZnVuY3Rpb24gSnModCwgZSwgbikge1xuICAgIHJldHVybiBbIHQsIEdzKGUpLCBuIF07XG59XG5cbi8qKlxuICogQmVjYXVzZSB3ZSBzdG9yZSBhbGwgdGhlIHVzZWZ1bCBpbmZvcm1hdGlvbiBmb3IgdGhpcyBzdG9yZSBpbiB0aGUga2V5LFxuICogdGhlcmUgaXMgbm8gdXNlZnVsIGluZm9ybWF0aW9uIHRvIHN0b3JlIGFzIHRoZSB2YWx1ZS4gVGhlIHJhdyAodW5lbmNvZGVkKVxuICogcGF0aCBjYW5ub3QgYmUgc3RvcmVkIGJlY2F1c2UgSW5kZXhlZERiIGRvZXNuJ3Qgc3RvcmUgcHJvdG90eXBlXG4gKiBpbmZvcm1hdGlvbi5cbiAqLyBjb25zdCBZcyA9IHt9LCBYcyA9IFsgXCJwcmVmaXhQYXRoXCIsIFwiY29sbGVjdGlvbkdyb3VwXCIsIFwicmVhZFRpbWVcIiwgXCJkb2N1bWVudElkXCIgXSwgWnMgPSBbIFwicHJlZml4UGF0aFwiLCBcImNvbGxlY3Rpb25Hcm91cFwiLCBcImRvY3VtZW50SWRcIiBdLCB0aSA9IFsgXCJjb2xsZWN0aW9uR3JvdXBcIiwgXCJyZWFkVGltZVwiLCBcInByZWZpeFBhdGhcIiwgXCJkb2N1bWVudElkXCIgXSwgZWkgPSBbIFwiY2Fub25pY2FsSWRcIiwgXCJ0YXJnZXRJZFwiIF0sIG5pID0gWyBcInRhcmdldElkXCIsIFwicGF0aFwiIF0sIHNpID0gWyBcInBhdGhcIiwgXCJ0YXJnZXRJZFwiIF0sIGlpID0gWyBcImNvbGxlY3Rpb25JZFwiLCBcInBhcmVudFwiIF0sIHJpID0gWyBcImluZGV4SWRcIiwgXCJ1aWRcIiBdLCBvaSA9IFsgXCJ1aWRcIiwgXCJzZXF1ZW5jZU51bWJlclwiIF0sIHVpID0gWyBcImluZGV4SWRcIiwgXCJ1aWRcIiwgXCJhcnJheVZhbHVlXCIsIFwiZGlyZWN0aW9uYWxWYWx1ZVwiLCBcIm9yZGVyZWREb2N1bWVudEtleVwiLCBcImRvY3VtZW50S2V5XCIgXSwgYWkgPSBbIFwiaW5kZXhJZFwiLCBcInVpZFwiLCBcIm9yZGVyZWREb2N1bWVudEtleVwiIF0sIGNpID0gWyBcInVzZXJJZFwiLCBcImNvbGxlY3Rpb25QYXRoXCIsIFwiZG9jdW1lbnRJZFwiIF0sIGhpID0gWyBcInVzZXJJZFwiLCBcImNvbGxlY3Rpb25QYXRoXCIsIFwibGFyZ2VzdEJhdGNoSWRcIiBdLCBsaSA9IFsgXCJ1c2VySWRcIiwgXCJjb2xsZWN0aW9uR3JvdXBcIiwgXCJsYXJnZXN0QmF0Y2hJZFwiIF0sIGZpID0gWyAuLi5bIC4uLlsgLi4uWyAuLi5bIFwibXV0YXRpb25RdWV1ZXNcIiwgXCJtdXRhdGlvbnNcIiwgXCJkb2N1bWVudE11dGF0aW9uc1wiLCBcInJlbW90ZURvY3VtZW50c1wiLCBcInRhcmdldHNcIiwgXCJvd25lclwiLCBcInRhcmdldEdsb2JhbFwiLCBcInRhcmdldERvY3VtZW50c1wiIF0sIFwiY2xpZW50TWV0YWRhdGFcIiBdLCBcInJlbW90ZURvY3VtZW50R2xvYmFsXCIgXSwgXCJjb2xsZWN0aW9uUGFyZW50c1wiIF0sIFwiYnVuZGxlc1wiLCBcIm5hbWVkUXVlcmllc1wiIF0sIGRpID0gWyAuLi5maSwgXCJkb2N1bWVudE92ZXJsYXlzXCIgXSwgX2kgPSBbIFwibXV0YXRpb25RdWV1ZXNcIiwgXCJtdXRhdGlvbnNcIiwgXCJkb2N1bWVudE11dGF0aW9uc1wiLCBcInJlbW90ZURvY3VtZW50c1YxNFwiLCBcInRhcmdldHNcIiwgXCJvd25lclwiLCBcInRhcmdldEdsb2JhbFwiLCBcInRhcmdldERvY3VtZW50c1wiLCBcImNsaWVudE1ldGFkYXRhXCIsIFwicmVtb3RlRG9jdW1lbnRHbG9iYWxcIiwgXCJjb2xsZWN0aW9uUGFyZW50c1wiLCBcImJ1bmRsZXNcIiwgXCJuYW1lZFF1ZXJpZXNcIiwgXCJkb2N1bWVudE92ZXJsYXlzXCIgXSwgd2kgPSBbIC4uLl9pLCBcImluZGV4Q29uZmlndXJhdGlvblwiLCBcImluZGV4U3RhdGVcIiwgXCJpbmRleEVudHJpZXNcIiBdO1xuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuY29uc3QgbWkgPSBcIlRoZSBjdXJyZW50IHRhYiBpcyBub3QgaW4gdGhlIHJlcXVpcmVkIHN0YXRlIHRvIHBlcmZvcm0gdGhpcyBvcGVyYXRpb24uIEl0IG1pZ2h0IGJlIG5lY2Vzc2FyeSB0byByZWZyZXNoIHRoZSBicm93c2VyIHRhYi5cIjtcblxuLyoqXG4gKiBBIGJhc2UgY2xhc3MgcmVwcmVzZW50aW5nIGEgcGVyc2lzdGVuY2UgdHJhbnNhY3Rpb24sIGVuY2Fwc3VsYXRpbmcgYm90aCB0aGVcbiAqIHRyYW5zYWN0aW9uJ3Mgc2VxdWVuY2UgbnVtYmVycyBhcyB3ZWxsIGFzIGEgbGlzdCBvZiBvbkNvbW1pdHRlZCBsaXN0ZW5lcnMuXG4gKlxuICogV2hlbiB5b3UgY2FsbCBQZXJzaXN0ZW5jZS5ydW5UcmFuc2FjdGlvbigpLCBpdCB3aWxsIGNyZWF0ZSBhIHRyYW5zYWN0aW9uIGFuZFxuICogcGFzcyBpdCB0byB5b3VyIGNhbGxiYWNrLiBZb3UgdGhlbiBwYXNzIGl0IHRvIGFueSBtZXRob2QgdGhhdCBvcGVyYXRlc1xuICogb24gcGVyc2lzdGVuY2UuXG4gKi8gY2xhc3MgZ2kge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLm9uQ29tbWl0dGVkTGlzdGVuZXJzID0gW107XG4gICAgfVxuICAgIGFkZE9uQ29tbWl0dGVkTGlzdGVuZXIodCkge1xuICAgICAgICB0aGlzLm9uQ29tbWl0dGVkTGlzdGVuZXJzLnB1c2godCk7XG4gICAgfVxuICAgIHJhaXNlT25Db21taXR0ZWRFdmVudCgpIHtcbiAgICAgICAgdGhpcy5vbkNvbW1pdHRlZExpc3RlbmVycy5mb3JFYWNoKCh0ID0+IHQoKSkpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogUGVyc2lzdGVuY2VQcm9taXNlIGlzIGVzc2VudGlhbGx5IGEgcmUtaW1wbGVtZW50YXRpb24gb2YgUHJvbWlzZSBleGNlcHRcbiAqIGl0IGhhcyBhIC5uZXh0KCkgbWV0aG9kIGluc3RlYWQgb2YgLnRoZW4oKSBhbmQgLm5leHQoKSBhbmQgLmNhdGNoKCkgY2FsbGJhY2tzXG4gKiBhcmUgZXhlY3V0ZWQgc3luY2hyb25vdXNseSB3aGVuIGEgUGVyc2lzdGVuY2VQcm9taXNlIHJlc29sdmVzIHJhdGhlciB0aGFuXG4gKiBhc3luY2hyb25vdXNseSAoUHJvbWlzZSBpbXBsZW1lbnRhdGlvbnMgdXNlIHNldEltbWVkaWF0ZSgpIG9yIHNpbWlsYXIpLlxuICpcbiAqIFRoaXMgaXMgbmVjZXNzYXJ5IHRvIGludGVyb3BlcmF0ZSB3aXRoIEluZGV4ZWREQiB3aGljaCB3aWxsIGF1dG9tYXRpY2FsbHlcbiAqIGNvbW1pdCB0cmFuc2FjdGlvbnMgaWYgY29udHJvbCBpcyByZXR1cm5lZCB0byB0aGUgZXZlbnQgbG9vcCB3aXRob3V0XG4gKiBzeW5jaHJvbm91c2x5IGluaXRpYXRpbmcgYW5vdGhlciBvcGVyYXRpb24gb24gdGhlIHRyYW5zYWN0aW9uLlxuICpcbiAqIE5PVEU6IC50aGVuKCkgYW5kIC5jYXRjaCgpIG9ubHkgYWxsb3cgYSBzaW5nbGUgY29uc3VtZXIsIHVubGlrZSBub3JtYWxcbiAqIFByb21pc2VzLlxuICovIGNsYXNzIHlpIHtcbiAgICBjb25zdHJ1Y3Rvcih0KSB7XG4gICAgICAgIC8vIE5PVEU6IG5leHQvY2F0Y2hDYWxsYmFjayB3aWxsIGFsd2F5cyBwb2ludCB0byBvdXIgb3duIHdyYXBwZXIgZnVuY3Rpb25zLFxuICAgICAgICAvLyBub3QgdGhlIHVzZXIncyByYXcgbmV4dCgpIG9yIGNhdGNoKCkgY2FsbGJhY2tzLlxuICAgICAgICB0aGlzLm5leHRDYWxsYmFjayA9IG51bGwsIHRoaXMuY2F0Y2hDYWxsYmFjayA9IG51bGwsIFxuICAgICAgICAvLyBXaGVuIHRoZSBvcGVyYXRpb24gcmVzb2x2ZXMsIHdlJ2xsIHNldCByZXN1bHQgb3IgZXJyb3IgYW5kIG1hcmsgaXNEb25lLlxuICAgICAgICB0aGlzLnJlc3VsdCA9IHZvaWQgMCwgdGhpcy5lcnJvciA9IHZvaWQgMCwgdGhpcy5pc0RvbmUgPSAhMSwgXG4gICAgICAgIC8vIFNldCB0byB0cnVlIHdoZW4gLnRoZW4oKSBvciAuY2F0Y2goKSBhcmUgY2FsbGVkIGFuZCBwcmV2ZW50cyBhZGRpdGlvbmFsXG4gICAgICAgIC8vIGNoYWluaW5nLlxuICAgICAgICB0aGlzLmNhbGxiYWNrQXR0YWNoZWQgPSAhMSwgdCgodCA9PiB7XG4gICAgICAgICAgICB0aGlzLmlzRG9uZSA9ICEwLCB0aGlzLnJlc3VsdCA9IHQsIHRoaXMubmV4dENhbGxiYWNrICYmIFxuICAgICAgICAgICAgLy8gdmFsdWUgc2hvdWxkIGJlIGRlZmluZWQgdW5sZXNzIFQgaXMgVm9pZCwgYnV0IHdlIGNhbid0IGV4cHJlc3NcbiAgICAgICAgICAgIC8vIHRoYXQgaW4gdGhlIHR5cGUgc3lzdGVtLlxuICAgICAgICAgICAgdGhpcy5uZXh0Q2FsbGJhY2sodCk7XG4gICAgICAgIH0pLCAodCA9PiB7XG4gICAgICAgICAgICB0aGlzLmlzRG9uZSA9ICEwLCB0aGlzLmVycm9yID0gdCwgdGhpcy5jYXRjaENhbGxiYWNrICYmIHRoaXMuY2F0Y2hDYWxsYmFjayh0KTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICBjYXRjaCh0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLm5leHQodm9pZCAwLCB0KTtcbiAgICB9XG4gICAgbmV4dCh0LCBlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNhbGxiYWNrQXR0YWNoZWQgJiYgTCgpLCB0aGlzLmNhbGxiYWNrQXR0YWNoZWQgPSAhMCwgdGhpcy5pc0RvbmUgPyB0aGlzLmVycm9yID8gdGhpcy53cmFwRmFpbHVyZShlLCB0aGlzLmVycm9yKSA6IHRoaXMud3JhcFN1Y2Nlc3ModCwgdGhpcy5yZXN1bHQpIDogbmV3IHlpKCgobiwgcykgPT4ge1xuICAgICAgICAgICAgdGhpcy5uZXh0Q2FsbGJhY2sgPSBlID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLndyYXBTdWNjZXNzKHQsIGUpLm5leHQobiwgcyk7XG4gICAgICAgICAgICB9LCB0aGlzLmNhdGNoQ2FsbGJhY2sgPSB0ID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLndyYXBGYWlsdXJlKGUsIHQpLm5leHQobiwgcyk7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIHRvUHJvbWlzZSgpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKCgodCwgZSkgPT4ge1xuICAgICAgICAgICAgdGhpcy5uZXh0KHQsIGUpO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIHdyYXBVc2VyRnVuY3Rpb24odCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgZSA9IHQoKTtcbiAgICAgICAgICAgIHJldHVybiBlIGluc3RhbmNlb2YgeWkgPyBlIDogeWkucmVzb2x2ZShlKTtcbiAgICAgICAgfSBjYXRjaCAodCkge1xuICAgICAgICAgICAgcmV0dXJuIHlpLnJlamVjdCh0KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICB3cmFwU3VjY2Vzcyh0LCBlKSB7XG4gICAgICAgIHJldHVybiB0ID8gdGhpcy53cmFwVXNlckZ1bmN0aW9uKCgoKSA9PiB0KGUpKSkgOiB5aS5yZXNvbHZlKGUpO1xuICAgIH1cbiAgICB3cmFwRmFpbHVyZSh0LCBlKSB7XG4gICAgICAgIHJldHVybiB0ID8gdGhpcy53cmFwVXNlckZ1bmN0aW9uKCgoKSA9PiB0KGUpKSkgOiB5aS5yZWplY3QoZSk7XG4gICAgfVxuICAgIHN0YXRpYyByZXNvbHZlKHQpIHtcbiAgICAgICAgcmV0dXJuIG5ldyB5aSgoKGUsIG4pID0+IHtcbiAgICAgICAgICAgIGUodCk7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgc3RhdGljIHJlamVjdCh0KSB7XG4gICAgICAgIHJldHVybiBuZXcgeWkoKChlLCBuKSA9PiB7XG4gICAgICAgICAgICBuKHQpO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIHN0YXRpYyB3YWl0Rm9yKFxuICAgIC8vIEFjY2VwdCBhbGwgUHJvbWlzZSB0eXBlcyBpbiB3YWl0Rm9yKCkuXG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbiAgICB0KSB7XG4gICAgICAgIHJldHVybiBuZXcgeWkoKChlLCBuKSA9PiB7XG4gICAgICAgICAgICBsZXQgcyA9IDAsIGkgPSAwLCByID0gITE7XG4gICAgICAgICAgICB0LmZvckVhY2goKHQgPT4ge1xuICAgICAgICAgICAgICAgICsrcywgdC5uZXh0KCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICsraSwgciAmJiBpID09PSBzICYmIGUoKTtcbiAgICAgICAgICAgICAgICB9KSwgKHQgPT4gbih0KSkpO1xuICAgICAgICAgICAgfSkpLCByID0gITAsIGkgPT09IHMgJiYgZSgpO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEdpdmVuIGFuIGFycmF5IG9mIHByZWRpY2F0ZSBmdW5jdGlvbnMgdGhhdCBhc3luY2hyb25vdXNseSBldmFsdWF0ZSB0byBhXG4gICAgICogYm9vbGVhbiwgaW1wbGVtZW50cyBhIHNob3J0LWNpcmN1aXRpbmcgYG9yYCBiZXR3ZWVuIHRoZSByZXN1bHRzLiBQcmVkaWNhdGVzXG4gICAgICogd2lsbCBiZSBldmFsdWF0ZWQgdW50aWwgb25lIG9mIHRoZW0gcmV0dXJucyBgdHJ1ZWAsIHRoZW4gc3RvcC4gVGhlIGZpbmFsXG4gICAgICogcmVzdWx0IHdpbGwgYmUgd2hldGhlciBhbnkgb2YgdGhlbSByZXR1cm5lZCBgdHJ1ZWAuXG4gICAgICovICAgIHN0YXRpYyBvcih0KSB7XG4gICAgICAgIGxldCBlID0geWkucmVzb2x2ZSghMSk7XG4gICAgICAgIGZvciAoY29uc3QgbiBvZiB0KSBlID0gZS5uZXh0KCh0ID0+IHQgPyB5aS5yZXNvbHZlKHQpIDogbigpKSk7XG4gICAgICAgIHJldHVybiBlO1xuICAgIH1cbiAgICBzdGF0aWMgZm9yRWFjaCh0LCBlKSB7XG4gICAgICAgIGNvbnN0IG4gPSBbXTtcbiAgICAgICAgcmV0dXJuIHQuZm9yRWFjaCgoKHQsIHMpID0+IHtcbiAgICAgICAgICAgIG4ucHVzaChlLmNhbGwodGhpcywgdCwgcykpO1xuICAgICAgICB9KSksIHRoaXMud2FpdEZvcihuKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vLyBSZWZlcmVuY2VzIHRvIGB3aW5kb3dgIGFyZSBndWFyZGVkIGJ5IFNpbXBsZURiLmlzQXZhaWxhYmxlKClcbi8qIGVzbGludC1kaXNhYmxlIG5vLXJlc3RyaWN0ZWQtZ2xvYmFscyAqL1xuLyoqXG4gKiBXcmFwcyBhbiBJREJUcmFuc2FjdGlvbiBhbmQgZXhwb3NlcyBhIHN0b3JlKCkgbWV0aG9kIHRvIGdldCBhIGhhbmRsZSB0byBhXG4gKiBzcGVjaWZpYyBvYmplY3Qgc3RvcmUuXG4gKi9cbmNsYXNzIHBpIHtcbiAgICBjb25zdHJ1Y3Rvcih0LCBlKSB7XG4gICAgICAgIHRoaXMuYWN0aW9uID0gdCwgdGhpcy50cmFuc2FjdGlvbiA9IGUsIHRoaXMuYWJvcnRlZCA9ICExLCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEEgYFByb21pc2VgIHRoYXQgcmVzb2x2ZXMgd2l0aCB0aGUgcmVzdWx0IG9mIHRoZSBJbmRleGVkRGIgdHJhbnNhY3Rpb24uXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLkF0ID0gbmV3IGosIHRoaXMudHJhbnNhY3Rpb24ub25jb21wbGV0ZSA9ICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuQXQucmVzb2x2ZSgpO1xuICAgICAgICB9LCB0aGlzLnRyYW5zYWN0aW9uLm9uYWJvcnQgPSAoKSA9PiB7XG4gICAgICAgICAgICBlLmVycm9yID8gdGhpcy5BdC5yZWplY3QobmV3IEVpKHQsIGUuZXJyb3IpKSA6IHRoaXMuQXQucmVzb2x2ZSgpO1xuICAgICAgICB9LCB0aGlzLnRyYW5zYWN0aW9uLm9uZXJyb3IgPSBlID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSBWaShlLnRhcmdldC5lcnJvcik7XG4gICAgICAgICAgICB0aGlzLkF0LnJlamVjdChuZXcgRWkodCwgbikpO1xuICAgICAgICB9O1xuICAgIH1cbiAgICBzdGF0aWMgb3Blbih0LCBlLCBuLCBzKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IHBpKGUsIHQudHJhbnNhY3Rpb24ocywgbikpO1xuICAgICAgICB9IGNhdGNoICh0KSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRWkoZSwgdCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0IFJ0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5BdC5wcm9taXNlO1xuICAgIH1cbiAgICBhYm9ydCh0KSB7XG4gICAgICAgIHQgJiYgdGhpcy5BdC5yZWplY3QodCksIHRoaXMuYWJvcnRlZCB8fCAoTyhcIlNpbXBsZURiXCIsIFwiQWJvcnRpbmcgdHJhbnNhY3Rpb246XCIsIHQgPyB0Lm1lc3NhZ2UgOiBcIkNsaWVudC1pbml0aWF0ZWQgYWJvcnRcIiksIFxuICAgICAgICB0aGlzLmFib3J0ZWQgPSAhMCwgdGhpcy50cmFuc2FjdGlvbi5hYm9ydCgpKTtcbiAgICB9XG4gICAgYnQoKSB7XG4gICAgICAgIC8vIElmIHRoZSBicm93c2VyIHN1cHBvcnRzIFYzIEluZGV4ZWREQiwgd2UgaW52b2tlIGNvbW1pdCgpIGV4cGxpY2l0bHkgdG9cbiAgICAgICAgLy8gc3BlZWQgdXAgaW5kZXggREIgcHJvY2Vzc2luZyBpZiB0aGUgZXZlbnQgbG9vcCByZW1haW5zIGJsb2Nrcy5cbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbiAgICAgICAgY29uc3QgdCA9IHRoaXMudHJhbnNhY3Rpb247XG4gICAgICAgIHRoaXMuYWJvcnRlZCB8fCBcImZ1bmN0aW9uXCIgIT0gdHlwZW9mIHQuY29tbWl0IHx8IHQuY29tbWl0KCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgYSBTaW1wbGVEYlN0b3JlPEtleVR5cGUsIFZhbHVlVHlwZT4gZm9yIHRoZSBzcGVjaWZpZWQgc3RvcmUuIEFsbFxuICAgICAqIG9wZXJhdGlvbnMgcGVyZm9ybWVkIG9uIHRoZSBTaW1wbGVEYlN0b3JlIGhhcHBlbiB3aXRoaW4gdGhlIGNvbnRleHQgb2YgdGhpc1xuICAgICAqIHRyYW5zYWN0aW9uIGFuZCBpdCBjYW5ub3QgYmUgdXNlZCBhbnltb3JlIG9uY2UgdGhlIHRyYW5zYWN0aW9uIGlzXG4gICAgICogY29tcGxldGVkLlxuICAgICAqXG4gICAgICogTm90ZSB0aGF0IHdlIGNhbid0IGFjdHVhbGx5IGVuZm9yY2UgdGhhdCB0aGUgS2V5VHlwZSBhbmQgVmFsdWVUeXBlIGFyZVxuICAgICAqIGNvcnJlY3QsIGJ1dCB0aGV5IGFsbG93IHR5cGUgc2FmZXR5IHRocm91Z2ggdGhlIHJlc3Qgb2YgdGhlIGNvbnN1bWluZyBjb2RlLlxuICAgICAqLyAgICBzdG9yZSh0KSB7XG4gICAgICAgIGNvbnN0IGUgPSB0aGlzLnRyYW5zYWN0aW9uLm9iamVjdFN0b3JlKHQpO1xuICAgICAgICByZXR1cm4gbmV3IFJpKGUpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBQcm92aWRlcyBhIHdyYXBwZXIgYXJvdW5kIEluZGV4ZWREYiB3aXRoIGEgc2ltcGxpZmllZCBpbnRlcmZhY2UgdGhhdCB1c2VzXG4gKiBQcm9taXNlLWxpa2UgcmV0dXJuIHZhbHVlcyB0byBjaGFpbiBvcGVyYXRpb25zLiBSZWFsIHByb21pc2VzIGNhbm5vdCBiZSB1c2VkXG4gKiBzaW5jZSAudGhlbigpIGNvbnRpbnVhdGlvbnMgYXJlIGV4ZWN1dGVkIGFzeW5jaHJvbm91c2x5IChlLmcuIHZpYVxuICogLnNldEltbWVkaWF0ZSksIHdoaWNoIHdvdWxkIGNhdXNlIEluZGV4ZWREQiB0byBlbmQgdGhlIHRyYW5zYWN0aW9uLlxuICogU2VlIFBlcnNpc3RlbmNlUHJvbWlzZSBmb3IgbW9yZSBkZXRhaWxzLlxuICovIGNsYXNzIElpIHtcbiAgICAvKlxuICAgICAqIENyZWF0ZXMgYSBuZXcgU2ltcGxlRGIgd3JhcHBlciBmb3IgSW5kZXhlZERiIGRhdGFiYXNlIGBuYW1lYC5cbiAgICAgKlxuICAgICAqIE5vdGUgdGhhdCBgdmVyc2lvbmAgbXVzdCBub3QgYmUgYSBkb3duZ3JhZGUuIEluZGV4ZWREQiBkb2VzIG5vdCBzdXBwb3J0XG4gICAgICogZG93bmdyYWRpbmcgdGhlIHNjaGVtYSB2ZXJzaW9uLiBXZSBjdXJyZW50bHkgZG8gbm90IHN1cHBvcnQgYW55IHdheSB0byBkb1xuICAgICAqIHZlcnNpb25pbmcgb3V0c2lkZSBvZiBJbmRleGVkREIncyB2ZXJzaW9uaW5nIG1lY2hhbmlzbSwgYXMgb25seVxuICAgICAqIHZlcnNpb24tdXBncmFkZSB0cmFuc2FjdGlvbnMgYXJlIGFsbG93ZWQgdG8gZG8gdGhpbmdzIGxpa2UgY3JlYXRlXG4gICAgICogb2JqZWN0c3RvcmVzLlxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKHQsIGUsIG4pIHtcbiAgICAgICAgdGhpcy5uYW1lID0gdCwgdGhpcy52ZXJzaW9uID0gZSwgdGhpcy5QdCA9IG47XG4gICAgICAgIC8vIE5PVEU6IEFjY29yZGluZyB0byBodHRwczovL2J1Z3Mud2Via2l0Lm9yZy9zaG93X2J1Zy5jZ2k/aWQ9MTk3MDUwLCB0aGVcbiAgICAgICAgLy8gYnVnIHdlJ3JlIGNoZWNraW5nIGZvciBzaG91bGQgZXhpc3QgaW4gaU9TID49IDEyLjIgYW5kIDwgMTMsIGJ1dCBmb3JcbiAgICAgICAgLy8gd2hhdGV2ZXIgcmVhc29uIGl0J3MgbXVjaCBoYXJkZXIgdG8gaGl0IGFmdGVyIDEyLjIgc28gd2Ugb25seSBwcm9hY3RpdmVseVxuICAgICAgICAvLyBsb2cgb24gMTIuMi5cbiAgICAgICAgMTIuMiA9PT0gSWkuVnQoYygpKSAmJiBGKFwiRmlyZXN0b3JlIHBlcnNpc3RlbmNlIHN1ZmZlcnMgZnJvbSBhIGJ1ZyBpbiBpT1MgMTIuMiBTYWZhcmkgdGhhdCBtYXkgY2F1c2UgeW91ciBhcHAgdG8gc3RvcCB3b3JraW5nLiBTZWUgaHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9xLzU2NDk2Mjk2LzExMDkxNSBmb3IgZGV0YWlscyBhbmQgYSBwb3RlbnRpYWwgd29ya2Fyb3VuZC5cIik7XG4gICAgfVxuICAgIC8qKiBEZWxldGVzIHRoZSBzcGVjaWZpZWQgZGF0YWJhc2UuICovICAgIHN0YXRpYyBkZWxldGUodCkge1xuICAgICAgICByZXR1cm4gTyhcIlNpbXBsZURiXCIsIFwiUmVtb3ZpbmcgZGF0YWJhc2U6XCIsIHQpLCBiaSh3aW5kb3cuaW5kZXhlZERCLmRlbGV0ZURhdGFiYXNlKHQpKS50b1Byb21pc2UoKTtcbiAgICB9XG4gICAgLyoqIFJldHVybnMgdHJ1ZSBpZiBJbmRleGVkREIgaXMgYXZhaWxhYmxlIGluIHRoZSBjdXJyZW50IGVudmlyb25tZW50LiAqLyAgICBzdGF0aWMgdnQoKSB7XG4gICAgICAgIGlmICghaCgpKSByZXR1cm4gITE7XG4gICAgICAgIGlmIChJaS5TdCgpKSByZXR1cm4gITA7XG4gICAgICAgIC8vIFdlIGV4dGVuc2l2ZWx5IHVzZSBpbmRleGVkIGFycmF5IHZhbHVlcyBhbmQgY29tcG91bmQga2V5cyxcbiAgICAgICAgLy8gd2hpY2ggSUUgYW5kIEVkZ2UgZG8gbm90IHN1cHBvcnQuIEhvd2V2ZXIsIHRoZXkgc3RpbGwgaGF2ZSBpbmRleGVkREJcbiAgICAgICAgLy8gZGVmaW5lZCBvbiB0aGUgd2luZG93LCBzbyB3ZSBuZWVkIHRvIGNoZWNrIGZvciB0aGVtIGhlcmUgYW5kIG1ha2Ugc3VyZVxuICAgICAgICAvLyB0byByZXR1cm4gdGhhdCBwZXJzaXN0ZW5jZSBpcyBub3QgZW5hYmxlZCBmb3IgdGhvc2UgYnJvd3NlcnMuXG4gICAgICAgIC8vIEZvciB0cmFja2luZyBzdXBwb3J0IG9mIHRoaXMgZmVhdHVyZSwgc2VlIGhlcmU6XG4gICAgICAgIC8vIGh0dHBzOi8vZGV2ZWxvcGVyLm1pY3Jvc29mdC5jb20vZW4tdXMvbWljcm9zb2Z0LWVkZ2UvcGxhdGZvcm0vc3RhdHVzL2luZGV4ZWRkYmFycmF5c2FuZG11bHRpZW50cnlzdXBwb3J0L1xuICAgICAgICAvLyBDaGVjayB0aGUgVUEgc3RyaW5nIHRvIGZpbmQgb3V0IHRoZSBicm93c2VyLlxuICAgICAgICAgICAgICAgIGNvbnN0IHQgPSBjKCksIGUgPSBJaS5WdCh0KSwgbiA9IDAgPCBlICYmIGUgPCAxMCwgcyA9IElpLkR0KHQpLCBpID0gMCA8IHMgJiYgcyA8IDQuNTtcbiAgICAgICAgLy8gSUUgMTBcbiAgICAgICAgLy8gdWEgPSAnTW96aWxsYS81LjAgKGNvbXBhdGlibGU7IE1TSUUgMTAuMDsgV2luZG93cyBOVCA2LjI7IFRyaWRlbnQvNi4wKSc7XG4gICAgICAgIC8vIElFIDExXG4gICAgICAgIC8vIHVhID0gJ01vemlsbGEvNS4wIChXaW5kb3dzIE5UIDYuMzsgVHJpZGVudC83LjA7IHJ2OjExLjApIGxpa2UgR2Vja28nO1xuICAgICAgICAvLyBFZGdlXG4gICAgICAgIC8vIHVhID0gJ01vemlsbGEvNS4wIChXaW5kb3dzIE5UIDEwLjA7IFdPVzY0KSBBcHBsZVdlYktpdC81MzcuMzYgKEtIVE1MLFxuICAgICAgICAvLyBsaWtlIEdlY2tvKSBDaHJvbWUvMzkuMC4yMTcxLjcxIFNhZmFyaS81MzcuMzYgRWRnZS8xMi4wJztcbiAgICAgICAgLy8gaU9TIFNhZmFyaTogRGlzYWJsZSBmb3IgdXNlcnMgcnVubmluZyBpT1MgdmVyc2lvbiA8IDEwLlxuICAgICAgICAgICAgICAgIHJldHVybiAhKHQuaW5kZXhPZihcIk1TSUUgXCIpID4gMCB8fCB0LmluZGV4T2YoXCJUcmlkZW50L1wiKSA+IDAgfHwgdC5pbmRleE9mKFwiRWRnZS9cIikgPiAwIHx8IG4gfHwgaSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgYmFja2luZyBJbmRleGVkREIgc3RvcmUgaXMgdGhlIE5vZGUgSW5kZXhlZERCU2hpbVxuICAgICAqIChzZWUgaHR0cHM6Ly9naXRodWIuY29tL2F4ZW1jbGlvbi9JbmRleGVkREJTaGltKS5cbiAgICAgKi8gICAgc3RhdGljIFN0KCkge1xuICAgICAgICB2YXIgdDtcbiAgICAgICAgcmV0dXJuIFwidW5kZWZpbmVkXCIgIT0gdHlwZW9mIHByb2Nlc3MgJiYgXCJZRVNcIiA9PT0gKG51bGwgPT09ICh0ID0gcHJvY2Vzcy5lbnYpIHx8IHZvaWQgMCA9PT0gdCA/IHZvaWQgMCA6IHQuQ3QpO1xuICAgIH1cbiAgICAvKiogSGVscGVyIHRvIGdldCBhIHR5cGVkIFNpbXBsZURiU3RvcmUgZnJvbSBhIHRyYW5zYWN0aW9uLiAqLyAgICBzdGF0aWMgeHQodCwgZSkge1xuICAgICAgICByZXR1cm4gdC5zdG9yZShlKTtcbiAgICB9XG4gICAgLy8gdmlzaWJsZSBmb3IgdGVzdGluZ1xuICAgIC8qKiBQYXJzZSBVc2VyIEFnZW50IHRvIGRldGVybWluZSBpT1MgdmVyc2lvbi4gUmV0dXJucyAtMSBpZiBub3QgZm91bmQuICovXG4gICAgc3RhdGljIFZ0KHQpIHtcbiAgICAgICAgY29uc3QgZSA9IHQubWF0Y2goL2koPzpwaG9uZXxwYWR8cG9kKSBvcyAoW1xcZF9dKykvaSksIG4gPSBlID8gZVsxXS5zcGxpdChcIl9cIikuc2xpY2UoMCwgMikuam9pbihcIi5cIikgOiBcIi0xXCI7XG4gICAgICAgIHJldHVybiBOdW1iZXIobik7XG4gICAgfVxuICAgIC8vIHZpc2libGUgZm9yIHRlc3RpbmdcbiAgICAvKiogUGFyc2UgVXNlciBBZ2VudCB0byBkZXRlcm1pbmUgQW5kcm9pZCB2ZXJzaW9uLiBSZXR1cm5zIC0xIGlmIG5vdCBmb3VuZC4gKi9cbiAgICBzdGF0aWMgRHQodCkge1xuICAgICAgICBjb25zdCBlID0gdC5tYXRjaCgvQW5kcm9pZCAoW1xcZC5dKykvaSksIG4gPSBlID8gZVsxXS5zcGxpdChcIi5cIikuc2xpY2UoMCwgMikuam9pbihcIi5cIikgOiBcIi0xXCI7XG4gICAgICAgIHJldHVybiBOdW1iZXIobik7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIE9wZW5zIHRoZSBzcGVjaWZpZWQgZGF0YWJhc2UsIGNyZWF0aW5nIG9yIHVwZ3JhZGluZyBpdCBpZiBuZWNlc3NhcnkuXG4gICAgICovICAgIGFzeW5jIE50KHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGIgfHwgKE8oXCJTaW1wbGVEYlwiLCBcIk9wZW5pbmcgZGF0YWJhc2U6XCIsIHRoaXMubmFtZSksIHRoaXMuZGIgPSBhd2FpdCBuZXcgUHJvbWlzZSgoKGUsIG4pID0+IHtcbiAgICAgICAgICAgIC8vIFRPRE8obWlrZWxlaGVuKTogSW52ZXN0aWdhdGUgYnJvd3NlciBjb21wYXRpYmlsaXR5LlxuICAgICAgICAgICAgLy8gaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL0luZGV4ZWREQl9BUEkvVXNpbmdfSW5kZXhlZERCXG4gICAgICAgICAgICAvLyBzdWdnZXN0cyBJRTkgYW5kIG9sZGVyIFdlYktpdCBicm93c2VycyBoYW5kbGUgdXBncmFkZVxuICAgICAgICAgICAgLy8gZGlmZmVyZW50bHkuIFRoZXkgZXhwZWN0IHNldFZlcnNpb24sIGFzIGRlc2NyaWJlZCBoZXJlOlxuICAgICAgICAgICAgLy8gaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL0lEQlZlcnNpb25DaGFuZ2VSZXF1ZXN0L3NldFZlcnNpb25cbiAgICAgICAgICAgIGNvbnN0IHMgPSBpbmRleGVkREIub3Blbih0aGlzLm5hbWUsIHRoaXMudmVyc2lvbik7XG4gICAgICAgICAgICBzLm9uc3VjY2VzcyA9IHQgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IG4gPSB0LnRhcmdldC5yZXN1bHQ7XG4gICAgICAgICAgICAgICAgZShuKTtcbiAgICAgICAgICAgIH0sIHMub25ibG9ja2VkID0gKCkgPT4ge1xuICAgICAgICAgICAgICAgIG4obmV3IEVpKHQsIFwiQ2Fubm90IHVwZ3JhZGUgSW5kZXhlZERCIHNjaGVtYSB3aGlsZSBhbm90aGVyIHRhYiBpcyBvcGVuLiBDbG9zZSBhbGwgdGFicyB0aGF0IGFjY2VzcyBGaXJlc3RvcmUgYW5kIHJlbG9hZCB0aGlzIHBhZ2UgdG8gcHJvY2VlZC5cIikpO1xuICAgICAgICAgICAgfSwgcy5vbmVycm9yID0gZSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgcyA9IGUudGFyZ2V0LmVycm9yO1xuICAgICAgICAgICAgICAgIFwiVmVyc2lvbkVycm9yXCIgPT09IHMubmFtZSA/IG4obmV3IFEoRy5GQUlMRURfUFJFQ09ORElUSU9OLCBcIkEgbmV3ZXIgdmVyc2lvbiBvZiB0aGUgRmlyZXN0b3JlIFNESyB3YXMgcHJldmlvdXNseSB1c2VkIGFuZCBzbyB0aGUgcGVyc2lzdGVkIGRhdGEgaXMgbm90IGNvbXBhdGlibGUgd2l0aCB0aGUgdmVyc2lvbiBvZiB0aGUgU0RLIHlvdSBhcmUgbm93IHVzaW5nLiBUaGUgU0RLIHdpbGwgb3BlcmF0ZSB3aXRoIHBlcnNpc3RlbmNlIGRpc2FibGVkLiBJZiB5b3UgbmVlZCBwZXJzaXN0ZW5jZSwgcGxlYXNlIHJlLXVwZ3JhZGUgdG8gYSBuZXdlciB2ZXJzaW9uIG9mIHRoZSBTREsgb3IgZWxzZSBjbGVhciB0aGUgcGVyc2lzdGVkIEluZGV4ZWREQiBkYXRhIGZvciB5b3VyIGFwcCB0byBzdGFydCBmcmVzaC5cIikpIDogXCJJbnZhbGlkU3RhdGVFcnJvclwiID09PSBzLm5hbWUgPyBuKG5ldyBRKEcuRkFJTEVEX1BSRUNPTkRJVElPTiwgXCJVbmFibGUgdG8gb3BlbiBhbiBJbmRleGVkREIgY29ubmVjdGlvbi4gVGhpcyBjb3VsZCBiZSBkdWUgdG8gcnVubmluZyBpbiBhIHByaXZhdGUgYnJvd3Npbmcgc2Vzc2lvbiBvbiBhIGJyb3dzZXIgd2hvc2UgcHJpdmF0ZSBicm93c2luZyBzZXNzaW9ucyBkbyBub3Qgc3VwcG9ydCBJbmRleGVkREI6IFwiICsgcykpIDogbihuZXcgRWkodCwgcykpO1xuICAgICAgICAgICAgfSwgcy5vbnVwZ3JhZGVuZWVkZWQgPSB0ID0+IHtcbiAgICAgICAgICAgICAgICBPKFwiU2ltcGxlRGJcIiwgJ0RhdGFiYXNlIFwiJyArIHRoaXMubmFtZSArICdcIiByZXF1aXJlcyB1cGdyYWRlIGZyb20gdmVyc2lvbjonLCB0Lm9sZFZlcnNpb24pO1xuICAgICAgICAgICAgICAgIGNvbnN0IGUgPSB0LnRhcmdldC5yZXN1bHQ7XG4gICAgICAgICAgICAgICAgdGhpcy5QdC5rdChlLCBzLnRyYW5zYWN0aW9uLCB0Lm9sZFZlcnNpb24sIHRoaXMudmVyc2lvbikubmV4dCgoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBPKFwiU2ltcGxlRGJcIiwgXCJEYXRhYmFzZSB1cGdyYWRlIHRvIHZlcnNpb24gXCIgKyB0aGlzLnZlcnNpb24gKyBcIiBjb21wbGV0ZVwiKTtcbiAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9KSkpLCB0aGlzLk10ICYmICh0aGlzLmRiLm9udmVyc2lvbmNoYW5nZSA9IHQgPT4gdGhpcy5NdCh0KSksIHRoaXMuZGI7XG4gICAgfVxuICAgIE90KHQpIHtcbiAgICAgICAgdGhpcy5NdCA9IHQsIHRoaXMuZGIgJiYgKHRoaXMuZGIub252ZXJzaW9uY2hhbmdlID0gZSA9PiB0KGUpKTtcbiAgICB9XG4gICAgYXN5bmMgcnVuVHJhbnNhY3Rpb24odCwgZSwgbiwgcykge1xuICAgICAgICBjb25zdCBpID0gXCJyZWFkb25seVwiID09PSBlO1xuICAgICAgICBsZXQgciA9IDA7XG4gICAgICAgIGZvciAoOzspIHtcbiAgICAgICAgICAgICsrcjtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kYiA9IGF3YWl0IHRoaXMuTnQodCk7XG4gICAgICAgICAgICAgICAgY29uc3QgZSA9IHBpLm9wZW4odGhpcy5kYiwgdCwgaSA/IFwicmVhZG9ubHlcIiA6IFwicmVhZHdyaXRlXCIsIG4pLCByID0gcyhlKS5uZXh0KCh0ID0+IChlLmJ0KCksIFxuICAgICAgICAgICAgICAgIHQpKSkuY2F0Y2goKHQgPT4gKFxuICAgICAgICAgICAgICAgIC8vIEFib3J0IHRoZSB0cmFuc2FjdGlvbiBpZiB0aGVyZSB3YXMgYW4gZXJyb3IuXG4gICAgICAgICAgICAgICAgZS5hYm9ydCh0KSwgeWkucmVqZWN0KHQpKSkpLnRvUHJvbWlzZSgpO1xuICAgICAgICAgICAgICAgIC8vIEFzIG5vdGVkIGFib3ZlLCBlcnJvcnMgYXJlIHByb3BhZ2F0ZWQgYnkgYWJvcnRpbmcgdGhlIHRyYW5zYWN0aW9uLiBTb1xuICAgICAgICAgICAgICAgIC8vIHdlIHN3YWxsb3cgYW55IGVycm9yIGhlcmUgdG8gYXZvaWQgdGhlIGJyb3dzZXIgbG9nZ2luZyBpdCBhcyB1bmhhbmRsZWQuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHIuY2F0Y2goKCgpID0+IHt9KSksIFxuICAgICAgICAgICAgICAgIC8vIFdhaXQgZm9yIHRoZSB0cmFuc2FjdGlvbiB0byBjb21wbGV0ZSAoaS5lLiBJbmRleGVkRGIncyBvbnN1Y2Nlc3MgZXZlbnQgdG9cbiAgICAgICAgICAgICAgICAvLyBmaXJlKSwgYnV0IHN0aWxsIHJldHVybiB0aGUgb3JpZ2luYWwgdHJhbnNhY3Rpb25GblJlc3VsdCBiYWNrIHRvIHRoZVxuICAgICAgICAgICAgICAgIC8vIGNhbGxlci5cbiAgICAgICAgICAgICAgICBhd2FpdCBlLlJ0LCByO1xuICAgICAgICAgICAgfSBjYXRjaCAodCkge1xuICAgICAgICAgICAgICAgIC8vIFRPRE8oc2NobWlkdC1zZWJhc3RpYW4pOiBXZSBjb3VsZCBwcm9iYWJseSBiZSBzbWFydGVyIGFib3V0IHRoaXMgYW5kXG4gICAgICAgICAgICAgICAgLy8gbm90IHJldHJ5IGV4Y2VwdGlvbnMgdGhhdCBhcmUgbGlrZWx5IHVucmVjb3ZlcmFibGUgKHN1Y2ggYXMgcXVvdGFcbiAgICAgICAgICAgICAgICAvLyBleGNlZWRlZCBlcnJvcnMpLlxuICAgICAgICAgICAgICAgIC8vIE5vdGU6IFdlIGNhbm5vdCB1c2UgYW4gaW5zdGFuY2VvZiBjaGVjayBmb3IgRmlyZXN0b3JlRXhjZXB0aW9uLCBzaW5jZSB0aGVcbiAgICAgICAgICAgICAgICAvLyBleGNlcHRpb24gaXMgd3JhcHBlZCBpbiBhIGdlbmVyaWMgZXJyb3IgYnkgb3VyIGFzeW5jL2F3YWl0IGhhbmRsaW5nLlxuICAgICAgICAgICAgICAgIGNvbnN0IGUgPSBcIkZpcmViYXNlRXJyb3JcIiAhPT0gdC5uYW1lICYmIHIgPCAzO1xuICAgICAgICAgICAgICAgIGlmIChPKFwiU2ltcGxlRGJcIiwgXCJUcmFuc2FjdGlvbiBmYWlsZWQgd2l0aCBlcnJvcjpcIiwgdC5tZXNzYWdlLCBcIlJldHJ5aW5nOlwiLCBlKSwgXG4gICAgICAgICAgICAgICAgdGhpcy5jbG9zZSgpLCAhZSkgcmV0dXJuIFByb21pc2UucmVqZWN0KHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGNsb3NlKCkge1xuICAgICAgICB0aGlzLmRiICYmIHRoaXMuZGIuY2xvc2UoKSwgdGhpcy5kYiA9IHZvaWQgMDtcbiAgICB9XG59XG5cbi8qKlxuICogQSBjb250cm9sbGVyIGZvciBpdGVyYXRpbmcgb3ZlciBhIGtleSByYW5nZSBvciBpbmRleC4gSXQgYWxsb3dzIGFuIGl0ZXJhdGVcbiAqIGNhbGxiYWNrIHRvIGRlbGV0ZSB0aGUgY3VycmVudGx5LXJlZmVyZW5jZWQgb2JqZWN0LCBvciBqdW1wIHRvIGEgbmV3IGtleVxuICogd2l0aGluIHRoZSBrZXkgcmFuZ2Ugb3IgaW5kZXguXG4gKi8gY2xhc3MgVGkge1xuICAgIGNvbnN0cnVjdG9yKHQpIHtcbiAgICAgICAgdGhpcy5GdCA9IHQsIHRoaXMuJHQgPSAhMSwgdGhpcy5CdCA9IG51bGw7XG4gICAgfVxuICAgIGdldCBpc0RvbmUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiR0O1xuICAgIH1cbiAgICBnZXQgTHQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLkJ0O1xuICAgIH1cbiAgICBzZXQgY3Vyc29yKHQpIHtcbiAgICAgICAgdGhpcy5GdCA9IHQ7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFRoaXMgZnVuY3Rpb24gY2FuIGJlIGNhbGxlZCB0byBzdG9wIGl0ZXJhdGlvbiBhdCBhbnkgcG9pbnQuXG4gICAgICovICAgIGRvbmUoKSB7XG4gICAgICAgIHRoaXMuJHQgPSAhMDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVGhpcyBmdW5jdGlvbiBjYW4gYmUgY2FsbGVkIHRvIHNraXAgdG8gdGhhdCBuZXh0IGtleSwgd2hpY2ggY291bGQgYmVcbiAgICAgKiBhbiBpbmRleCBvciBhIHByaW1hcnkga2V5LlxuICAgICAqLyAgICBVdCh0KSB7XG4gICAgICAgIHRoaXMuQnQgPSB0O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBEZWxldGUgdGhlIGN1cnJlbnQgY3Vyc29yIHZhbHVlIGZyb20gdGhlIG9iamVjdCBzdG9yZS5cbiAgICAgKlxuICAgICAqIE5PVEU6IFlvdSBDQU5OT1QgZG8gdGhpcyB3aXRoIGEga2V5c09ubHkgcXVlcnkuXG4gICAgICovICAgIGRlbGV0ZSgpIHtcbiAgICAgICAgcmV0dXJuIGJpKHRoaXMuRnQuZGVsZXRlKCkpO1xuICAgIH1cbn1cblxuLyoqIEFuIGVycm9yIHRoYXQgd3JhcHMgZXhjZXB0aW9ucyB0aGF0IHRocm93biBkdXJpbmcgSW5kZXhlZERCIGV4ZWN1dGlvbi4gKi8gY2xhc3MgRWkgZXh0ZW5kcyBRIHtcbiAgICBjb25zdHJ1Y3Rvcih0LCBlKSB7XG4gICAgICAgIHN1cGVyKEcuVU5BVkFJTEFCTEUsIGBJbmRleGVkREIgdHJhbnNhY3Rpb24gJyR7dH0nIGZhaWxlZDogJHtlfWApLCB0aGlzLm5hbWUgPSBcIkluZGV4ZWREYlRyYW5zYWN0aW9uRXJyb3JcIjtcbiAgICB9XG59XG5cbi8qKiBWZXJpZmllcyB3aGV0aGVyIGBlYCBpcyBhbiBJbmRleGVkRGJUcmFuc2FjdGlvbkVycm9yLiAqLyBmdW5jdGlvbiBBaSh0KSB7XG4gICAgLy8gVXNlIG5hbWUgZXF1YWxpdHksIGFzIGluc3RhbmNlb2YgY2hlY2tzIG9uIGVycm9ycyBkb24ndCB3b3JrIHdpdGggZXJyb3JzXG4gICAgLy8gdGhhdCB3cmFwIG90aGVyIGVycm9ycy5cbiAgICByZXR1cm4gXCJJbmRleGVkRGJUcmFuc2FjdGlvbkVycm9yXCIgPT09IHQubmFtZTtcbn1cblxuLyoqXG4gKiBBIHdyYXBwZXIgYXJvdW5kIGFuIElEQk9iamVjdFN0b3JlIHByb3ZpZGluZyBhbiBBUEkgdGhhdDpcbiAqXG4gKiAxKSBIYXMgZ2VuZXJpYyBLZXlUeXBlIC8gVmFsdWVUeXBlIHBhcmFtZXRlcnMgdG8gcHJvdmlkZSBzdHJvbmdseS10eXBlZFxuICogbWV0aG9kcyBmb3IgYWN0aW5nIGFnYWluc3QgdGhlIG9iamVjdCBzdG9yZS5cbiAqIDIpIERlYWxzIHdpdGggSW5kZXhlZERCJ3Mgb25zdWNjZXNzIC8gb25lcnJvciBldmVudCBjYWxsYmFja3MsIG1ha2luZyBldmVyeVxuICogbWV0aG9kIHJldHVybiBhIFBlcnNpc3RlbmNlUHJvbWlzZSBpbnN0ZWFkLlxuICogMykgUHJvdmlkZXMgYSBoaWdoZXItbGV2ZWwgQVBJIHRvIGF2b2lkIG5lZWRpbmcgdG8gZG8gZXhjZXNzaXZlIHdyYXBwaW5nIG9mXG4gKiBpbnRlcm1lZGlhdGUgSW5kZXhlZERCIHR5cGVzIChJREJDdXJzb3JXaXRoVmFsdWUsIGV0Yy4pXG4gKi8gY2xhc3MgUmkge1xuICAgIGNvbnN0cnVjdG9yKHQpIHtcbiAgICAgICAgdGhpcy5zdG9yZSA9IHQ7XG4gICAgfVxuICAgIHB1dCh0LCBlKSB7XG4gICAgICAgIGxldCBuO1xuICAgICAgICByZXR1cm4gdm9pZCAwICE9PSBlID8gKE8oXCJTaW1wbGVEYlwiLCBcIlBVVFwiLCB0aGlzLnN0b3JlLm5hbWUsIHQsIGUpLCBuID0gdGhpcy5zdG9yZS5wdXQoZSwgdCkpIDogKE8oXCJTaW1wbGVEYlwiLCBcIlBVVFwiLCB0aGlzLnN0b3JlLm5hbWUsIFwiPGF1dG8ta2V5PlwiLCB0KSwgXG4gICAgICAgIG4gPSB0aGlzLnN0b3JlLnB1dCh0KSksIGJpKG4pO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBBZGRzIGEgbmV3IHZhbHVlIGludG8gYW4gT2JqZWN0IFN0b3JlIGFuZCByZXR1cm5zIHRoZSBuZXcga2V5LiBTaW1pbGFyIHRvXG4gICAgICogSW5kZXhlZERiJ3MgYGFkZCgpYCwgdGhpcyBtZXRob2Qgd2lsbCBmYWlsIG9uIHByaW1hcnkga2V5IGNvbGxpc2lvbnMuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gdmFsdWUgLSBUaGUgb2JqZWN0IHRvIHdyaXRlLlxuICAgICAqIEByZXR1cm5zIFRoZSBrZXkgb2YgdGhlIHZhbHVlIHRvIGFkZC5cbiAgICAgKi8gICAgYWRkKHQpIHtcbiAgICAgICAgTyhcIlNpbXBsZURiXCIsIFwiQUREXCIsIHRoaXMuc3RvcmUubmFtZSwgdCwgdCk7XG4gICAgICAgIHJldHVybiBiaSh0aGlzLnN0b3JlLmFkZCh0KSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEdldHMgdGhlIG9iamVjdCB3aXRoIHRoZSBzcGVjaWZpZWQga2V5IGZyb20gdGhlIHNwZWNpZmllZCBzdG9yZSwgb3IgbnVsbFxuICAgICAqIGlmIG5vIG9iamVjdCBleGlzdHMgd2l0aCB0aGUgc3BlY2lmaWVkIGtleS5cbiAgICAgKlxuICAgICAqIEBrZXkgVGhlIGtleSBvZiB0aGUgb2JqZWN0IHRvIGdldC5cbiAgICAgKiBAcmV0dXJucyBUaGUgb2JqZWN0IHdpdGggdGhlIHNwZWNpZmllZCBrZXkgb3IgbnVsbCBpZiBubyBvYmplY3QgZXhpc3RzLlxuICAgICAqLyAgICBnZXQodCkge1xuICAgICAgICAvLyBXZSdyZSBkb2luZyBhbiB1bnNhZmUgY2FzdCB0byBWYWx1ZVR5cGUuXG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG4gICAgICAgIHJldHVybiBiaSh0aGlzLnN0b3JlLmdldCh0KSkubmV4dCgoZSA9PiAoXG4gICAgICAgIC8vIE5vcm1hbGl6ZSBub25leGlzdGVuY2UgdG8gbnVsbC5cbiAgICAgICAgdm9pZCAwID09PSBlICYmIChlID0gbnVsbCksIE8oXCJTaW1wbGVEYlwiLCBcIkdFVFwiLCB0aGlzLnN0b3JlLm5hbWUsIHQsIGUpLCBlKSkpO1xuICAgIH1cbiAgICBkZWxldGUodCkge1xuICAgICAgICBPKFwiU2ltcGxlRGJcIiwgXCJERUxFVEVcIiwgdGhpcy5zdG9yZS5uYW1lLCB0KTtcbiAgICAgICAgcmV0dXJuIGJpKHRoaXMuc3RvcmUuZGVsZXRlKHQpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogSWYgd2UgZXZlciBuZWVkIG1vcmUgb2YgdGhlIGNvdW50IHZhcmlhbnRzLCB3ZSBjYW4gYWRkIG92ZXJsb2Fkcy4gRm9yIG5vdyxcbiAgICAgKiBhbGwgd2UgbmVlZCBpcyB0byBjb3VudCBldmVyeXRoaW5nIGluIGEgc3RvcmUuXG4gICAgICpcbiAgICAgKiBSZXR1cm5zIHRoZSBudW1iZXIgb2Ygcm93cyBpbiB0aGUgc3RvcmUuXG4gICAgICovICAgIGNvdW50KCkge1xuICAgICAgICBPKFwiU2ltcGxlRGJcIiwgXCJDT1VOVFwiLCB0aGlzLnN0b3JlLm5hbWUpO1xuICAgICAgICByZXR1cm4gYmkodGhpcy5zdG9yZS5jb3VudCgpKTtcbiAgICB9XG4gICAgcXQodCwgZSkge1xuICAgICAgICBjb25zdCBuID0gdGhpcy5vcHRpb25zKHQsIGUpO1xuICAgICAgICAvLyBVc2UgYGdldEFsbCgpYCBpZiB0aGUgYnJvd3NlciBzdXBwb3J0cyBJbmRleGVkREIgdjMsIGFzIGl0IGlzIHJvdWdobHlcbiAgICAgICAgLy8gMjAlIGZhc3Rlci4gVW5mb3J0dW5hdGVseSwgZ2V0QWxsKCkgZG9lcyBub3Qgc3VwcG9ydCBjdXN0b20gaW5kaWNlcy5cbiAgICAgICAgICAgICAgICBpZiAobi5pbmRleCB8fCBcImZ1bmN0aW9uXCIgIT0gdHlwZW9mIHRoaXMuc3RvcmUuZ2V0QWxsKSB7XG4gICAgICAgICAgICBjb25zdCB0ID0gdGhpcy5jdXJzb3IobiksIGUgPSBbXTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLkt0KHQsICgodCwgbikgPT4ge1xuICAgICAgICAgICAgICAgIGUucHVzaChuKTtcbiAgICAgICAgICAgIH0pKS5uZXh0KCgoKSA9PiBlKSk7XG4gICAgICAgIH1cbiAgICAgICAge1xuICAgICAgICAgICAgY29uc3QgdCA9IHRoaXMuc3RvcmUuZ2V0QWxsKG4ucmFuZ2UpO1xuICAgICAgICAgICAgcmV0dXJuIG5ldyB5aSgoKGUsIG4pID0+IHtcbiAgICAgICAgICAgICAgICB0Lm9uZXJyb3IgPSB0ID0+IHtcbiAgICAgICAgICAgICAgICAgICAgbih0LnRhcmdldC5lcnJvcik7XG4gICAgICAgICAgICAgICAgfSwgdC5vbnN1Y2Nlc3MgPSB0ID0+IHtcbiAgICAgICAgICAgICAgICAgICAgZSh0LnRhcmdldC5yZXN1bHQpO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9KSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogTG9hZHMgdGhlIGZpcnN0IGBjb3VudGAgZWxlbWVudHMgZnJvbSB0aGUgcHJvdmlkZWQgaW5kZXggcmFuZ2UuIExvYWRzIGFsbFxuICAgICAqIGVsZW1lbnRzIGlmIG5vIGxpbWl0IGlzIHByb3ZpZGVkLlxuICAgICAqLyAgICBHdCh0LCBlKSB7XG4gICAgICAgIGNvbnN0IG4gPSB0aGlzLnN0b3JlLmdldEFsbCh0LCBudWxsID09PSBlID8gdm9pZCAwIDogZSk7XG4gICAgICAgIHJldHVybiBuZXcgeWkoKCh0LCBlKSA9PiB7XG4gICAgICAgICAgICBuLm9uZXJyb3IgPSB0ID0+IHtcbiAgICAgICAgICAgICAgICBlKHQudGFyZ2V0LmVycm9yKTtcbiAgICAgICAgICAgIH0sIG4ub25zdWNjZXNzID0gZSA9PiB7XG4gICAgICAgICAgICAgICAgdChlLnRhcmdldC5yZXN1bHQpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICBRdCh0LCBlKSB7XG4gICAgICAgIE8oXCJTaW1wbGVEYlwiLCBcIkRFTEVURSBBTExcIiwgdGhpcy5zdG9yZS5uYW1lKTtcbiAgICAgICAgY29uc3QgbiA9IHRoaXMub3B0aW9ucyh0LCBlKTtcbiAgICAgICAgbi5qdCA9ICExO1xuICAgICAgICBjb25zdCBzID0gdGhpcy5jdXJzb3Iobik7XG4gICAgICAgIHJldHVybiB0aGlzLkt0KHMsICgodCwgZSwgbikgPT4gbi5kZWxldGUoKSkpO1xuICAgIH1cbiAgICBXdCh0LCBlKSB7XG4gICAgICAgIGxldCBuO1xuICAgICAgICBlID8gbiA9IHQgOiAobiA9IHt9LCBlID0gdCk7XG4gICAgICAgIGNvbnN0IHMgPSB0aGlzLmN1cnNvcihuKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuS3QocywgZSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEl0ZXJhdGVzIG92ZXIgYSBzdG9yZSwgYnV0IHdhaXRzIGZvciB0aGUgZ2l2ZW4gY2FsbGJhY2sgdG8gY29tcGxldGUgZm9yXG4gICAgICogZWFjaCBlbnRyeSBiZWZvcmUgaXRlcmF0aW5nIHRoZSBuZXh0IGVudHJ5LiBUaGlzIGFsbG93cyB0aGUgY2FsbGJhY2sgdG8gZG9cbiAgICAgKiBhc3luY2hyb25vdXMgd29yayB0byBkZXRlcm1pbmUgaWYgdGhpcyBpdGVyYXRpb24gc2hvdWxkIGNvbnRpbnVlLlxuICAgICAqXG4gICAgICogVGhlIHByb3ZpZGVkIGNhbGxiYWNrIHNob3VsZCByZXR1cm4gYHRydWVgIHRvIGNvbnRpbnVlIGl0ZXJhdGlvbiwgYW5kXG4gICAgICogYGZhbHNlYCBvdGhlcndpc2UuXG4gICAgICovICAgIHp0KHQpIHtcbiAgICAgICAgY29uc3QgZSA9IHRoaXMuY3Vyc29yKHt9KTtcbiAgICAgICAgcmV0dXJuIG5ldyB5aSgoKG4sIHMpID0+IHtcbiAgICAgICAgICAgIGUub25lcnJvciA9IHQgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGUgPSBWaSh0LnRhcmdldC5lcnJvcik7XG4gICAgICAgICAgICAgICAgcyhlKTtcbiAgICAgICAgICAgIH0sIGUub25zdWNjZXNzID0gZSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgcyA9IGUudGFyZ2V0LnJlc3VsdDtcbiAgICAgICAgICAgICAgICBzID8gdChzLnByaW1hcnlLZXksIHMudmFsdWUpLm5leHQoKHQgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0ID8gcy5jb250aW51ZSgpIDogbigpO1xuICAgICAgICAgICAgICAgIH0pKSA6IG4oKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgS3QodCwgZSkge1xuICAgICAgICBjb25zdCBuID0gW107XG4gICAgICAgIHJldHVybiBuZXcgeWkoKChzLCBpKSA9PiB7XG4gICAgICAgICAgICB0Lm9uZXJyb3IgPSB0ID0+IHtcbiAgICAgICAgICAgICAgICBpKHQudGFyZ2V0LmVycm9yKTtcbiAgICAgICAgICAgIH0sIHQub25zdWNjZXNzID0gdCA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgaSA9IHQudGFyZ2V0LnJlc3VsdDtcbiAgICAgICAgICAgICAgICBpZiAoIWkpIHJldHVybiB2b2lkIHMoKTtcbiAgICAgICAgICAgICAgICBjb25zdCByID0gbmV3IFRpKGkpLCBvID0gZShpLnByaW1hcnlLZXksIGkudmFsdWUsIHIpO1xuICAgICAgICAgICAgICAgIGlmIChvIGluc3RhbmNlb2YgeWkpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdCA9IG8uY2F0Y2goKHQgPT4gKHIuZG9uZSgpLCB5aS5yZWplY3QodCkpKSk7XG4gICAgICAgICAgICAgICAgICAgIG4ucHVzaCh0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgci5pc0RvbmUgPyBzKCkgOiBudWxsID09PSByLkx0ID8gaS5jb250aW51ZSgpIDogaS5jb250aW51ZShyLkx0KTtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0pKS5uZXh0KCgoKSA9PiB5aS53YWl0Rm9yKG4pKSk7XG4gICAgfVxuICAgIG9wdGlvbnModCwgZSkge1xuICAgICAgICBsZXQgbjtcbiAgICAgICAgcmV0dXJuIHZvaWQgMCAhPT0gdCAmJiAoXCJzdHJpbmdcIiA9PSB0eXBlb2YgdCA/IG4gPSB0IDogZSA9IHQpLCB7XG4gICAgICAgICAgICBpbmRleDogbixcbiAgICAgICAgICAgIHJhbmdlOiBlXG4gICAgICAgIH07XG4gICAgfVxuICAgIGN1cnNvcih0KSB7XG4gICAgICAgIGxldCBlID0gXCJuZXh0XCI7XG4gICAgICAgIGlmICh0LnJldmVyc2UgJiYgKGUgPSBcInByZXZcIiksIHQuaW5kZXgpIHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSB0aGlzLnN0b3JlLmluZGV4KHQuaW5kZXgpO1xuICAgICAgICAgICAgcmV0dXJuIHQuanQgPyBuLm9wZW5LZXlDdXJzb3IodC5yYW5nZSwgZSkgOiBuLm9wZW5DdXJzb3IodC5yYW5nZSwgZSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuc3RvcmUub3BlbkN1cnNvcih0LnJhbmdlLCBlKTtcbiAgICB9XG59XG5cbi8qKlxuICogV3JhcHMgYW4gSURCUmVxdWVzdCBpbiBhIFBlcnNpc3RlbmNlUHJvbWlzZSwgdXNpbmcgdGhlIG9uc3VjY2VzcyAvIG9uZXJyb3JcbiAqIGhhbmRsZXJzIHRvIHJlc29sdmUgLyByZWplY3QgdGhlIFBlcnNpc3RlbmNlUHJvbWlzZSBhcyBhcHByb3ByaWF0ZS5cbiAqLyBmdW5jdGlvbiBiaSh0KSB7XG4gICAgcmV0dXJuIG5ldyB5aSgoKGUsIG4pID0+IHtcbiAgICAgICAgdC5vbnN1Y2Nlc3MgPSB0ID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSB0LnRhcmdldC5yZXN1bHQ7XG4gICAgICAgICAgICBlKG4pO1xuICAgICAgICB9LCB0Lm9uZXJyb3IgPSB0ID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGUgPSBWaSh0LnRhcmdldC5lcnJvcik7XG4gICAgICAgICAgICBuKGUpO1xuICAgICAgICB9O1xuICAgIH0pKTtcbn1cblxuLy8gR3VhcmQgc28gd2Ugb25seSByZXBvcnQgdGhlIGVycm9yIG9uY2UuXG5sZXQgUGkgPSAhMTtcblxuZnVuY3Rpb24gVmkodCkge1xuICAgIGNvbnN0IGUgPSBJaS5WdChjKCkpO1xuICAgIGlmIChlID49IDEyLjIgJiYgZSA8IDEzKSB7XG4gICAgICAgIGNvbnN0IGUgPSBcIkFuIGludGVybmFsIGVycm9yIHdhcyBlbmNvdW50ZXJlZCBpbiB0aGUgSW5kZXhlZCBEYXRhYmFzZSBzZXJ2ZXJcIjtcbiAgICAgICAgaWYgKHQubWVzc2FnZS5pbmRleE9mKGUpID49IDApIHtcbiAgICAgICAgICAgIC8vIFdyYXAgZXJyb3IgaW4gYSBtb3JlIGRlc2NyaXB0aXZlIG9uZS5cbiAgICAgICAgICAgIGNvbnN0IHQgPSBuZXcgUShcImludGVybmFsXCIsIGBJT1NfSU5ERVhFRERCX0JVRzE6IEluZGV4ZWREYiBoYXMgdGhyb3duICcke2V9Jy4gVGhpcyBpcyBsaWtlbHkgZHVlIHRvIGFuIHVuYXZvaWRhYmxlIGJ1ZyBpbiBpT1MuIFNlZSBodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL3EvNTY0OTYyOTYvMTEwOTE1IGZvciBkZXRhaWxzIGFuZCBhIHBvdGVudGlhbCB3b3JrYXJvdW5kLmApO1xuICAgICAgICAgICAgcmV0dXJuIFBpIHx8IChQaSA9ICEwLCBcbiAgICAgICAgICAgIC8vIFRocm93IGEgZ2xvYmFsIGV4Y2VwdGlvbiBvdXRzaWRlIG9mIHRoaXMgcHJvbWlzZSBjaGFpbiwgZm9yIHRoZSB1c2VyIHRvXG4gICAgICAgICAgICAvLyBwb3RlbnRpYWxseSBjYXRjaC5cbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCgpID0+IHtcbiAgICAgICAgICAgICAgICB0aHJvdyB0O1xuICAgICAgICAgICAgfSksIDApKSwgdDtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdDtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi8gY2xhc3MgdmkgZXh0ZW5kcyBnaSB7XG4gICAgY29uc3RydWN0b3IodCwgZSkge1xuICAgICAgICBzdXBlcigpLCB0aGlzLkh0ID0gdCwgdGhpcy5jdXJyZW50U2VxdWVuY2VOdW1iZXIgPSBlO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gU2kodCwgZSkge1xuICAgIGNvbnN0IG4gPSBLKHQpO1xuICAgIHJldHVybiBJaS54dChuLkh0LCBlKTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogQSBiYXRjaCBvZiBtdXRhdGlvbnMgdGhhdCB3aWxsIGJlIHNlbnQgYXMgb25lIHVuaXQgdG8gdGhlIGJhY2tlbmQuXG4gKi8gY2xhc3MgRGkge1xuICAgIC8qKlxuICAgICAqIEBwYXJhbSBiYXRjaElkIC0gVGhlIHVuaXF1ZSBJRCBvZiB0aGlzIG11dGF0aW9uIGJhdGNoLlxuICAgICAqIEBwYXJhbSBsb2NhbFdyaXRlVGltZSAtIFRoZSBvcmlnaW5hbCB3cml0ZSB0aW1lIG9mIHRoaXMgbXV0YXRpb24uXG4gICAgICogQHBhcmFtIGJhc2VNdXRhdGlvbnMgLSBNdXRhdGlvbnMgdGhhdCBhcmUgdXNlZCB0byBwb3B1bGF0ZSB0aGUgYmFzZVxuICAgICAqIHZhbHVlcyB3aGVuIHRoaXMgbXV0YXRpb24gaXMgYXBwbGllZCBsb2NhbGx5LiBUaGlzIGNhbiBiZSB1c2VkIHRvIGxvY2FsbHlcbiAgICAgKiBvdmVyd3JpdGUgdmFsdWVzIHRoYXQgYXJlIHBlcnNpc3RlZCBpbiB0aGUgcmVtb3RlIGRvY3VtZW50IGNhY2hlLiBCYXNlXG4gICAgICogbXV0YXRpb25zIGFyZSBuZXZlciBzZW50IHRvIHRoZSBiYWNrZW5kLlxuICAgICAqIEBwYXJhbSBtdXRhdGlvbnMgLSBUaGUgdXNlci1wcm92aWRlZCBtdXRhdGlvbnMgaW4gdGhpcyBtdXRhdGlvbiBiYXRjaC5cbiAgICAgKiBVc2VyLXByb3ZpZGVkIG11dGF0aW9ucyBhcmUgYXBwbGllZCBib3RoIGxvY2FsbHkgYW5kIHJlbW90ZWx5IG9uIHRoZVxuICAgICAqIGJhY2tlbmQuXG4gICAgICovXG4gICAgY29uc3RydWN0b3IodCwgZSwgbiwgcykge1xuICAgICAgICB0aGlzLmJhdGNoSWQgPSB0LCB0aGlzLmxvY2FsV3JpdGVUaW1lID0gZSwgdGhpcy5iYXNlTXV0YXRpb25zID0gbiwgdGhpcy5tdXRhdGlvbnMgPSBzO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBBcHBsaWVzIGFsbCB0aGUgbXV0YXRpb25zIGluIHRoaXMgTXV0YXRpb25CYXRjaCB0byB0aGUgc3BlY2lmaWVkIGRvY3VtZW50XG4gICAgICogdG8gY29tcHV0ZSB0aGUgc3RhdGUgb2YgdGhlIHJlbW90ZSBkb2N1bWVudFxuICAgICAqXG4gICAgICogQHBhcmFtIGRvY3VtZW50IC0gVGhlIGRvY3VtZW50IHRvIGFwcGx5IG11dGF0aW9ucyB0by5cbiAgICAgKiBAcGFyYW0gYmF0Y2hSZXN1bHQgLSBUaGUgcmVzdWx0IG9mIGFwcGx5aW5nIHRoZSBNdXRhdGlvbkJhdGNoIHRvIHRoZVxuICAgICAqIGJhY2tlbmQuXG4gICAgICovICAgIGFwcGx5VG9SZW1vdGVEb2N1bWVudCh0LCBlKSB7XG4gICAgICAgIGNvbnN0IG4gPSBlLm11dGF0aW9uUmVzdWx0cztcbiAgICAgICAgZm9yIChsZXQgZSA9IDA7IGUgPCB0aGlzLm11dGF0aW9ucy5sZW5ndGg7IGUrKykge1xuICAgICAgICAgICAgY29uc3QgcyA9IHRoaXMubXV0YXRpb25zW2VdO1xuICAgICAgICAgICAgaWYgKHMua2V5LmlzRXF1YWwodC5rZXkpKSB7XG4gICAgICAgICAgICAgICAgUG4ocywgdCwgbltlXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogQ29tcHV0ZXMgdGhlIGxvY2FsIHZpZXcgb2YgYSBkb2N1bWVudCBnaXZlbiBhbGwgdGhlIG11dGF0aW9ucyBpbiB0aGlzXG4gICAgICogYmF0Y2guXG4gICAgICpcbiAgICAgKiBAcGFyYW0gZG9jdW1lbnQgLSBUaGUgZG9jdW1lbnQgdG8gYXBwbHkgbXV0YXRpb25zIHRvLlxuICAgICAqLyAgICBhcHBseVRvTG9jYWxWaWV3KHQpIHtcbiAgICAgICAgLy8gRmlyc3QsIGFwcGx5IHRoZSBiYXNlIHN0YXRlLiBUaGlzIGFsbG93cyB1cyB0byBhcHBseSBub24taWRlbXBvdGVudFxuICAgICAgICAvLyB0cmFuc2Zvcm0gYWdhaW5zdCBhIGNvbnNpc3RlbnQgc2V0IG9mIHZhbHVlcy5cbiAgICAgICAgZm9yIChjb25zdCBlIG9mIHRoaXMuYmFzZU11dGF0aW9ucykgZS5rZXkuaXNFcXVhbCh0LmtleSkgJiYgVm4oZSwgdCwgdGhpcy5sb2NhbFdyaXRlVGltZSk7XG4gICAgICAgIC8vIFNlY29uZCwgYXBwbHkgYWxsIHVzZXItcHJvdmlkZWQgbXV0YXRpb25zLlxuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgZSBvZiB0aGlzLm11dGF0aW9ucykgZS5rZXkuaXNFcXVhbCh0LmtleSkgJiYgVm4oZSwgdCwgdGhpcy5sb2NhbFdyaXRlVGltZSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENvbXB1dGVzIHRoZSBsb2NhbCB2aWV3IGZvciBhbGwgcHJvdmlkZWQgZG9jdW1lbnRzIGdpdmVuIHRoZSBtdXRhdGlvbnMgaW5cbiAgICAgKiB0aGlzIGJhdGNoLlxuICAgICAqLyAgICBhcHBseVRvTG9jYWxEb2N1bWVudFNldCh0KSB7XG4gICAgICAgIC8vIFRPRE8obXJzY2htaWR0KTogVGhpcyBpbXBsZW1lbnRhdGlvbiBpcyBPKG5eMikuIElmIHdlIGFwcGx5IHRoZSBtdXRhdGlvbnNcbiAgICAgICAgLy8gZGlyZWN0bHkgKGFzIGRvbmUgaW4gYGFwcGx5VG9Mb2NhbFZpZXcoKWApLCB3ZSBjYW4gcmVkdWNlIHRoZSBjb21wbGV4aXR5XG4gICAgICAgIC8vIHRvIE8obikuXG4gICAgICAgIHRoaXMubXV0YXRpb25zLmZvckVhY2goKGUgPT4ge1xuICAgICAgICAgICAgY29uc3QgbiA9IHQuZ2V0KGUua2V5KSwgcyA9IG47XG4gICAgICAgICAgICAvLyBUT0RPKG11dGFibGVkb2N1bWVudHMpOiBUaGlzIG1ldGhvZCBzaG91bGQgdGFrZSBhIE11dGFibGVEb2N1bWVudE1hcFxuICAgICAgICAgICAgLy8gYW5kIHdlIHNob3VsZCByZW1vdmUgdGhpcyBjYXN0LlxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hcHBseVRvTG9jYWxWaWV3KHMpLCBuLmlzVmFsaWREb2N1bWVudCgpIHx8IHMuY29udmVydFRvTm9Eb2N1bWVudChjdC5taW4oKSk7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAga2V5cygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubXV0YXRpb25zLnJlZHVjZSgoKHQsIGUpID0+IHQuYWRkKGUua2V5KSksIFluKCkpO1xuICAgIH1cbiAgICBpc0VxdWFsKHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYmF0Y2hJZCA9PT0gdC5iYXRjaElkICYmIG90KHRoaXMubXV0YXRpb25zLCB0Lm11dGF0aW9ucywgKCh0LCBlKSA9PiBTbih0LCBlKSkpICYmIG90KHRoaXMuYmFzZU11dGF0aW9ucywgdC5iYXNlTXV0YXRpb25zLCAoKHQsIGUpID0+IFNuKHQsIGUpKSk7XG4gICAgfVxufVxuXG4vKiogVGhlIHJlc3VsdCBvZiBhcHBseWluZyBhIG11dGF0aW9uIGJhdGNoIHRvIHRoZSBiYWNrZW5kLiAqLyBjbGFzcyBDaSB7XG4gICAgY29uc3RydWN0b3IodCwgZSwgbiwgXG4gICAgLyoqXG4gICAgICogQSBwcmUtY29tcHV0ZWQgbWFwcGluZyBmcm9tIGVhY2ggbXV0YXRlZCBkb2N1bWVudCB0byB0aGUgcmVzdWx0aW5nXG4gICAgICogdmVyc2lvbi5cbiAgICAgKi9cbiAgICBzKSB7XG4gICAgICAgIHRoaXMuYmF0Y2ggPSB0LCB0aGlzLmNvbW1pdFZlcnNpb24gPSBlLCB0aGlzLm11dGF0aW9uUmVzdWx0cyA9IG4sIHRoaXMuZG9jVmVyc2lvbnMgPSBzO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgbmV3IE11dGF0aW9uQmF0Y2hSZXN1bHQgZm9yIHRoZSBnaXZlbiBiYXRjaCBhbmQgcmVzdWx0cy4gVGhlcmVcbiAgICAgKiBtdXN0IGJlIG9uZSByZXN1bHQgZm9yIGVhY2ggbXV0YXRpb24gaW4gdGhlIGJhdGNoLiBUaGlzIHN0YXRpYyBmYWN0b3J5XG4gICAgICogY2FjaGVzIGEgZG9jdW1lbnQ9Jmd0O3ZlcnNpb24gbWFwcGluZyAoZG9jVmVyc2lvbnMpLlxuICAgICAqLyAgICBzdGF0aWMgZnJvbSh0LCBlLCBuKSB7XG4gICAgICAgIFUodC5tdXRhdGlvbnMubGVuZ3RoID09PSBuLmxlbmd0aCk7XG4gICAgICAgIGxldCBzID0gSG47XG4gICAgICAgIGNvbnN0IGkgPSB0Lm11dGF0aW9ucztcbiAgICAgICAgZm9yIChsZXQgdCA9IDA7IHQgPCBpLmxlbmd0aDsgdCsrKSBzID0gcy5pbnNlcnQoaVt0XS5rZXksIG5bdF0udmVyc2lvbik7XG4gICAgICAgIHJldHVybiBuZXcgQ2kodCwgZSwgbiwgcyk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMiBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBSZXByZXNlbnRhdGlvbiBvZiBhbiBvdmVybGF5IGNvbXB1dGVkIGJ5IEZpcmVzdG9yZS5cbiAqXG4gKiBIb2xkcyBpbmZvcm1hdGlvbiBhYm91dCBhIG11dGF0aW9uIGFuZCB0aGUgbGFyZ2VzdCBiYXRjaCBpZCBpbiBGaXJlc3RvcmUgd2hlblxuICogdGhlIG11dGF0aW9uIHdhcyBjcmVhdGVkLlxuICovIGNsYXNzIHhpIHtcbiAgICBjb25zdHJ1Y3Rvcih0LCBlKSB7XG4gICAgICAgIHRoaXMubGFyZ2VzdEJhdGNoSWQgPSB0LCB0aGlzLm11dGF0aW9uID0gZTtcbiAgICB9XG4gICAgZ2V0S2V5KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5tdXRhdGlvbi5rZXk7XG4gICAgfVxuICAgIGlzRXF1YWwodCkge1xuICAgICAgICByZXR1cm4gbnVsbCAhPT0gdCAmJiB0aGlzLm11dGF0aW9uID09PSB0Lm11dGF0aW9uO1xuICAgIH1cbiAgICB0b1N0cmluZygpIHtcbiAgICAgICAgcmV0dXJuIGBPdmVybGF5e1xcbiAgICAgIGxhcmdlc3RCYXRjaElkOiAke3RoaXMubGFyZ2VzdEJhdGNoSWR9LFxcbiAgICAgIG11dGF0aW9uOiAke3RoaXMubXV0YXRpb24udG9TdHJpbmcoKX1cXG4gICAgfWA7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBBbiBpbW11dGFibGUgc2V0IG9mIG1ldGFkYXRhIHRoYXQgdGhlIGxvY2FsIHN0b3JlIHRyYWNrcyBmb3IgZWFjaCB0YXJnZXQuXG4gKi8gY2xhc3MgTmkge1xuICAgIGNvbnN0cnVjdG9yKFxuICAgIC8qKiBUaGUgdGFyZ2V0IGJlaW5nIGxpc3RlbmVkIHRvLiAqL1xuICAgIHQsIFxuICAgIC8qKlxuICAgICAqIFRoZSB0YXJnZXQgSUQgdG8gd2hpY2ggdGhlIHRhcmdldCBjb3JyZXNwb25kczsgQXNzaWduZWQgYnkgdGhlXG4gICAgICogTG9jYWxTdG9yZSBmb3IgdXNlciBsaXN0ZW5zIGFuZCBieSB0aGUgU3luY0VuZ2luZSBmb3IgbGltYm8gd2F0Y2hlcy5cbiAgICAgKi9cbiAgICBlLCBcbiAgICAvKiogVGhlIHB1cnBvc2Ugb2YgdGhlIHRhcmdldC4gKi9cbiAgICBuLCBcbiAgICAvKipcbiAgICAgKiBUaGUgc2VxdWVuY2UgbnVtYmVyIG9mIHRoZSBsYXN0IHRyYW5zYWN0aW9uIGR1cmluZyB3aGljaCB0aGlzIHRhcmdldCBkYXRhXG4gICAgICogd2FzIG1vZGlmaWVkLlxuICAgICAqL1xuICAgIHMsIFxuICAgIC8qKiBUaGUgbGF0ZXN0IHNuYXBzaG90IHZlcnNpb24gc2VlbiBmb3IgdGhpcyB0YXJnZXQuICovXG4gICAgaSA9IGN0Lm1pbigpXG4gICAgLyoqXG4gICAgICogVGhlIG1heGltdW0gc25hcHNob3QgdmVyc2lvbiBhdCB3aGljaCB0aGUgYXNzb2NpYXRlZCB2aWV3XG4gICAgICogY29udGFpbmVkIG5vIGxpbWJvIGRvY3VtZW50cy5cbiAgICAgKi8gLCByID0gY3QubWluKClcbiAgICAvKipcbiAgICAgKiBBbiBvcGFxdWUsIHNlcnZlci1hc3NpZ25lZCB0b2tlbiB0aGF0IGFsbG93cyB3YXRjaGluZyBhIHRhcmdldCB0byBiZVxuICAgICAqIHJlc3VtZWQgYWZ0ZXIgZGlzY29ubmVjdGluZyB3aXRob3V0IHJldHJhbnNtaXR0aW5nIGFsbCB0aGUgZGF0YSB0aGF0XG4gICAgICogbWF0Y2hlcyB0aGUgdGFyZ2V0LiBUaGUgcmVzdW1lIHRva2VuIGVzc2VudGlhbGx5IGlkZW50aWZpZXMgYSBwb2ludCBpblxuICAgICAqIHRpbWUgZnJvbSB3aGljaCB0aGUgc2VydmVyIHNob3VsZCByZXN1bWUgc2VuZGluZyByZXN1bHRzLlxuICAgICAqLyAsIG8gPSBwdC5FTVBUWV9CWVRFX1NUUklORykge1xuICAgICAgICB0aGlzLnRhcmdldCA9IHQsIHRoaXMudGFyZ2V0SWQgPSBlLCB0aGlzLnB1cnBvc2UgPSBuLCB0aGlzLnNlcXVlbmNlTnVtYmVyID0gcywgdGhpcy5zbmFwc2hvdFZlcnNpb24gPSBpLCBcbiAgICAgICAgdGhpcy5sYXN0TGltYm9GcmVlU25hcHNob3RWZXJzaW9uID0gciwgdGhpcy5yZXN1bWVUb2tlbiA9IG87XG4gICAgfVxuICAgIC8qKiBDcmVhdGVzIGEgbmV3IHRhcmdldCBkYXRhIGluc3RhbmNlIHdpdGggYW4gdXBkYXRlZCBzZXF1ZW5jZSBudW1iZXIuICovICAgIHdpdGhTZXF1ZW5jZU51bWJlcih0KSB7XG4gICAgICAgIHJldHVybiBuZXcgTmkodGhpcy50YXJnZXQsIHRoaXMudGFyZ2V0SWQsIHRoaXMucHVycG9zZSwgdCwgdGhpcy5zbmFwc2hvdFZlcnNpb24sIHRoaXMubGFzdExpbWJvRnJlZVNuYXBzaG90VmVyc2lvbiwgdGhpcy5yZXN1bWVUb2tlbik7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBuZXcgdGFyZ2V0IGRhdGEgaW5zdGFuY2Ugd2l0aCBhbiB1cGRhdGVkIHJlc3VtZSB0b2tlbiBhbmRcbiAgICAgKiBzbmFwc2hvdCB2ZXJzaW9uLlxuICAgICAqLyAgICB3aXRoUmVzdW1lVG9rZW4odCwgZSkge1xuICAgICAgICByZXR1cm4gbmV3IE5pKHRoaXMudGFyZ2V0LCB0aGlzLnRhcmdldElkLCB0aGlzLnB1cnBvc2UsIHRoaXMuc2VxdWVuY2VOdW1iZXIsIGUsIHRoaXMubGFzdExpbWJvRnJlZVNuYXBzaG90VmVyc2lvbiwgdCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBuZXcgdGFyZ2V0IGRhdGEgaW5zdGFuY2Ugd2l0aCBhbiB1cGRhdGVkIGxhc3QgbGltYm8gZnJlZVxuICAgICAqIHNuYXBzaG90IHZlcnNpb24gbnVtYmVyLlxuICAgICAqLyAgICB3aXRoTGFzdExpbWJvRnJlZVNuYXBzaG90VmVyc2lvbih0KSB7XG4gICAgICAgIHJldHVybiBuZXcgTmkodGhpcy50YXJnZXQsIHRoaXMudGFyZ2V0SWQsIHRoaXMucHVycG9zZSwgdGhpcy5zZXF1ZW5jZU51bWJlciwgdGhpcy5zbmFwc2hvdFZlcnNpb24sIHQsIHRoaXMucmVzdW1lVG9rZW4pO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKiBTZXJpYWxpemVyIGZvciB2YWx1ZXMgc3RvcmVkIGluIHRoZSBMb2NhbFN0b3JlLiAqLyBjbGFzcyBraSB7XG4gICAgY29uc3RydWN0b3IodCkge1xuICAgICAgICB0aGlzLkp0ID0gdDtcbiAgICB9XG59XG5cbi8qKiBEZWNvZGVzIGEgcmVtb3RlIGRvY3VtZW50IGZyb20gc3RvcmFnZSBsb2NhbGx5IHRvIGEgRG9jdW1lbnQuICovIGZ1bmN0aW9uIE1pKHQsIGUpIHtcbiAgICBsZXQgbjtcbiAgICBpZiAoZS5kb2N1bWVudCkgbiA9IGJzKHQuSnQsIGUuZG9jdW1lbnQsICEhZS5oYXNDb21taXR0ZWRNdXRhdGlvbnMpOyBlbHNlIGlmIChlLm5vRG9jdW1lbnQpIHtcbiAgICAgICAgY29uc3QgdCA9IHh0LmZyb21TZWdtZW50cyhlLm5vRG9jdW1lbnQucGF0aCksIHMgPSBCaShlLm5vRG9jdW1lbnQucmVhZFRpbWUpO1xuICAgICAgICBuID0gbmUubmV3Tm9Eb2N1bWVudCh0LCBzKSwgZS5oYXNDb21taXR0ZWRNdXRhdGlvbnMgJiYgbi5zZXRIYXNDb21taXR0ZWRNdXRhdGlvbnMoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoIWUudW5rbm93bkRvY3VtZW50KSByZXR1cm4gTCgpO1xuICAgICAgICB7XG4gICAgICAgICAgICBjb25zdCB0ID0geHQuZnJvbVNlZ21lbnRzKGUudW5rbm93bkRvY3VtZW50LnBhdGgpLCBzID0gQmkoZS51bmtub3duRG9jdW1lbnQudmVyc2lvbik7XG4gICAgICAgICAgICBuID0gbmUubmV3VW5rbm93bkRvY3VtZW50KHQsIHMpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBlLnJlYWRUaW1lICYmIG4uc2V0UmVhZFRpbWUoZnVuY3Rpb24odCkge1xuICAgICAgICBjb25zdCBlID0gbmV3IGF0KHRbMF0sIHRbMV0pO1xuICAgICAgICByZXR1cm4gY3QuZnJvbVRpbWVzdGFtcChlKTtcbiAgICB9KGUucmVhZFRpbWUpKSwgbjtcbn1cblxuLyoqIEVuY29kZXMgYSBkb2N1bWVudCBmb3Igc3RvcmFnZSBsb2NhbGx5LiAqLyBmdW5jdGlvbiBPaSh0LCBlKSB7XG4gICAgY29uc3QgbiA9IGUua2V5LCBzID0ge1xuICAgICAgICBwcmVmaXhQYXRoOiBuLmdldENvbGxlY3Rpb25QYXRoKCkucG9wTGFzdCgpLnRvQXJyYXkoKSxcbiAgICAgICAgY29sbGVjdGlvbkdyb3VwOiBuLmNvbGxlY3Rpb25Hcm91cCxcbiAgICAgICAgZG9jdW1lbnRJZDogbi5wYXRoLmxhc3RTZWdtZW50KCksXG4gICAgICAgIHJlYWRUaW1lOiBGaShlLnJlYWRUaW1lKSxcbiAgICAgICAgaGFzQ29tbWl0dGVkTXV0YXRpb25zOiBlLmhhc0NvbW1pdHRlZE11dGF0aW9uc1xuICAgIH07XG4gICAgaWYgKGUuaXNGb3VuZERvY3VtZW50KCkpIHMuZG9jdW1lbnQgPSBmdW5jdGlvbih0LCBlKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBuYW1lOiB5cyh0LCBlLmtleSksXG4gICAgICAgICAgICBmaWVsZHM6IGUuZGF0YS52YWx1ZS5tYXBWYWx1ZS5maWVsZHMsXG4gICAgICAgICAgICB1cGRhdGVUaW1lOiBmcyh0LCBlLnZlcnNpb24udG9UaW1lc3RhbXAoKSlcbiAgICAgICAgfTtcbiAgICB9KHQuSnQsIGUpOyBlbHNlIGlmIChlLmlzTm9Eb2N1bWVudCgpKSBzLm5vRG9jdW1lbnQgPSB7XG4gICAgICAgIHBhdGg6IG4ucGF0aC50b0FycmF5KCksXG4gICAgICAgIHJlYWRUaW1lOiAkaShlLnZlcnNpb24pXG4gICAgfTsgZWxzZSB7XG4gICAgICAgIGlmICghZS5pc1Vua25vd25Eb2N1bWVudCgpKSByZXR1cm4gTCgpO1xuICAgICAgICBzLnVua25vd25Eb2N1bWVudCA9IHtcbiAgICAgICAgICAgIHBhdGg6IG4ucGF0aC50b0FycmF5KCksXG4gICAgICAgICAgICB2ZXJzaW9uOiAkaShlLnZlcnNpb24pXG4gICAgICAgIH07XG4gICAgfVxuICAgIHJldHVybiBzO1xufVxuXG5mdW5jdGlvbiBGaSh0KSB7XG4gICAgY29uc3QgZSA9IHQudG9UaW1lc3RhbXAoKTtcbiAgICByZXR1cm4gWyBlLnNlY29uZHMsIGUubmFub3NlY29uZHMgXTtcbn1cblxuZnVuY3Rpb24gJGkodCkge1xuICAgIGNvbnN0IGUgPSB0LnRvVGltZXN0YW1wKCk7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgc2Vjb25kczogZS5zZWNvbmRzLFxuICAgICAgICBuYW5vc2Vjb25kczogZS5uYW5vc2Vjb25kc1xuICAgIH07XG59XG5cbmZ1bmN0aW9uIEJpKHQpIHtcbiAgICBjb25zdCBlID0gbmV3IGF0KHQuc2Vjb25kcywgdC5uYW5vc2Vjb25kcyk7XG4gICAgcmV0dXJuIGN0LmZyb21UaW1lc3RhbXAoZSk7XG59XG5cbi8qKiBFbmNvZGVzIGEgYmF0Y2ggb2YgbXV0YXRpb25zIGludG8gYSBEYk11dGF0aW9uQmF0Y2ggZm9yIGxvY2FsIHN0b3JhZ2UuICovXG4vKiogRGVjb2RlcyBhIERiTXV0YXRpb25CYXRjaCBpbnRvIGEgTXV0YXRpb25CYXRjaCAqL1xuZnVuY3Rpb24gTGkodCwgZSkge1xuICAgIGNvbnN0IG4gPSAoZS5iYXNlTXV0YXRpb25zIHx8IFtdKS5tYXAoKGUgPT4gU3ModC5KdCwgZSkpKTtcbiAgICAvLyBTcXVhc2ggb2xkIHRyYW5zZm9ybSBtdXRhdGlvbnMgaW50byBleGlzdGluZyBwYXRjaCBvciBzZXQgbXV0YXRpb25zLlxuICAgIC8vIFRoZSByZXBsYWNlbWVudCBvZiByZXByZXNlbnRpbmcgYHRyYW5zZm9ybXNgIHdpdGggYHVwZGF0ZV90cmFuc2Zvcm1zYFxuICAgIC8vIG9uIHRoZSBTREsgbWVhbnMgdGhhdCBvbGQgYHRyYW5zZm9ybWAgbXV0YXRpb25zIHN0b3JlZCBpbiBJbmRleGVkREIgbmVlZFxuICAgIC8vIHRvIGJlIHVwZGF0ZWQgdG8gYHVwZGF0ZV90cmFuc2Zvcm1zYC5cbiAgICAvLyBUT0RPKGIvMTc0NjA4Mzc0KTogUmVtb3ZlIHRoaXMgY29kZSBvbmNlIHdlIHBlcmZvcm0gYSBzY2hlbWEgbWlncmF0aW9uLlxuICAgICAgICBmb3IgKGxldCB0ID0gMDsgdCA8IGUubXV0YXRpb25zLmxlbmd0aCAtIDE7ICsrdCkge1xuICAgICAgICBjb25zdCBuID0gZS5tdXRhdGlvbnNbdF07XG4gICAgICAgIGlmICh0ICsgMSA8IGUubXV0YXRpb25zLmxlbmd0aCAmJiB2b2lkIDAgIT09IGUubXV0YXRpb25zW3QgKyAxXS50cmFuc2Zvcm0pIHtcbiAgICAgICAgICAgIGNvbnN0IHMgPSBlLm11dGF0aW9uc1t0ICsgMV07XG4gICAgICAgICAgICBuLnVwZGF0ZVRyYW5zZm9ybXMgPSBzLnRyYW5zZm9ybS5maWVsZFRyYW5zZm9ybXMsIGUubXV0YXRpb25zLnNwbGljZSh0ICsgMSwgMSksIFxuICAgICAgICAgICAgKyt0O1xuICAgICAgICB9XG4gICAgfVxuICAgIGNvbnN0IHMgPSBlLm11dGF0aW9ucy5tYXAoKGUgPT4gU3ModC5KdCwgZSkpKSwgaSA9IGF0LmZyb21NaWxsaXMoZS5sb2NhbFdyaXRlVGltZU1zKTtcbiAgICByZXR1cm4gbmV3IERpKGUuYmF0Y2hJZCwgaSwgbiwgcyk7XG59XG5cbi8qKiBEZWNvZGVzIGEgRGJUYXJnZXQgaW50byBUYXJnZXREYXRhICovIGZ1bmN0aW9uIFVpKHQpIHtcbiAgICBjb25zdCBlID0gQmkodC5yZWFkVGltZSksIG4gPSB2b2lkIDAgIT09IHQubGFzdExpbWJvRnJlZVNuYXBzaG90VmVyc2lvbiA/IEJpKHQubGFzdExpbWJvRnJlZVNuYXBzaG90VmVyc2lvbikgOiBjdC5taW4oKTtcbiAgICBsZXQgcztcbiAgICB2YXIgaTtcbiAgICByZXR1cm4gdm9pZCAwICE9PSB0LnF1ZXJ5LmRvY3VtZW50cyA/IChVKDEgPT09IChpID0gdC5xdWVyeSkuZG9jdW1lbnRzLmxlbmd0aCksIFxuICAgIHMgPSBIZShLZShUcyhpLmRvY3VtZW50c1swXSkpKSkgOiBzID0gZnVuY3Rpb24odCkge1xuICAgICAgICByZXR1cm4gSGUoTnModCkpO1xuICAgIH0odC5xdWVyeSksIG5ldyBOaShzLCB0LnRhcmdldElkLCAwIC8qIExpc3RlbiAqLyAsIHQubGFzdExpc3RlblNlcXVlbmNlTnVtYmVyLCBlLCBuLCBwdC5mcm9tQmFzZTY0U3RyaW5nKHQucmVzdW1lVG9rZW4pKTtcbn1cblxuLyoqIEVuY29kZXMgVGFyZ2V0RGF0YSBpbnRvIGEgRGJUYXJnZXQgZm9yIHN0b3JhZ2UgbG9jYWxseS4gKi8gZnVuY3Rpb24gcWkodCwgZSkge1xuICAgIGNvbnN0IG4gPSAkaShlLnNuYXBzaG90VmVyc2lvbiksIHMgPSAkaShlLmxhc3RMaW1ib0ZyZWVTbmFwc2hvdFZlcnNpb24pO1xuICAgIGxldCBpO1xuICAgIGkgPSBBZShlLnRhcmdldCkgPyBDcyh0Lkp0LCBlLnRhcmdldCkgOiB4cyh0Lkp0LCBlLnRhcmdldCk7XG4gICAgLy8gV2UgY2FuJ3Qgc3RvcmUgdGhlIHJlc3VtZVRva2VuIGFzIGEgQnl0ZVN0cmluZyBpbiBJbmRleGVkRGIsIHNvIHdlXG4gICAgLy8gY29udmVydCBpdCB0byBhIGJhc2U2NCBzdHJpbmcgZm9yIHN0b3JhZ2UuXG4gICAgICAgIGNvbnN0IHIgPSBlLnJlc3VtZVRva2VuLnRvQmFzZTY0KCk7XG4gICAgLy8gbGFzdExpc3RlblNlcXVlbmNlTnVtYmVyIGlzIGFsd2F5cyAwIHVudGlsIHdlIGRvIHJlYWwgR0MuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgIHRhcmdldElkOiBlLnRhcmdldElkLFxuICAgICAgICBjYW5vbmljYWxJZDogSWUoZS50YXJnZXQpLFxuICAgICAgICByZWFkVGltZTogbixcbiAgICAgICAgcmVzdW1lVG9rZW46IHIsXG4gICAgICAgIGxhc3RMaXN0ZW5TZXF1ZW5jZU51bWJlcjogZS5zZXF1ZW5jZU51bWJlcixcbiAgICAgICAgbGFzdExpbWJvRnJlZVNuYXBzaG90VmVyc2lvbjogcyxcbiAgICAgICAgcXVlcnk6IGlcbiAgICB9O1xufVxuXG4vKipcbiAqIEEgaGVscGVyIGZ1bmN0aW9uIGZvciBmaWd1cmluZyBvdXQgd2hhdCBraW5kIG9mIHF1ZXJ5IGhhcyBiZWVuIHN0b3JlZC5cbiAqL1xuLyoqXG4gKiBFbmNvZGVzIGEgYEJ1bmRsZWRRdWVyeWAgZnJvbSBidW5kbGUgcHJvdG8gdG8gYSBRdWVyeSBvYmplY3QuXG4gKlxuICogVGhpcyByZWNvbnN0cnVjdHMgdGhlIG9yaWdpbmFsIHF1ZXJ5IHVzZWQgdG8gYnVpbGQgdGhlIGJ1bmRsZSBiZWluZyBsb2FkZWQsXG4gKiBpbmNsdWRpbmcgZmVhdHVyZXMgZXhpc3RzIG9ubHkgaW4gU0RLcyAoZm9yIGV4YW1wbGU6IGxpbWl0LXRvLWxhc3QpLlxuICovXG5mdW5jdGlvbiBLaSh0KSB7XG4gICAgY29uc3QgZSA9IE5zKHtcbiAgICAgICAgcGFyZW50OiB0LnBhcmVudCxcbiAgICAgICAgc3RydWN0dXJlZFF1ZXJ5OiB0LnN0cnVjdHVyZWRRdWVyeVxuICAgIH0pO1xuICAgIHJldHVybiBcIkxBU1RcIiA9PT0gdC5saW1pdFR5cGUgPyBKZShlLCBlLmxpbWl0LCBcIkxcIiAvKiBMYXN0ICovKSA6IGU7XG59XG5cbi8qKiBFbmNvZGVzIGEgTmFtZWRRdWVyeSBwcm90byBvYmplY3QgdG8gYSBOYW1lZFF1ZXJ5IG1vZGVsIG9iamVjdC4gKi9cbi8qKiBFbmNvZGVzIGEgRGJEb2N1bWVudE92ZXJsYXkgb2JqZWN0IHRvIGFuIE92ZXJsYXkgbW9kZWwgb2JqZWN0LiAqL1xuZnVuY3Rpb24gR2kodCwgZSkge1xuICAgIHJldHVybiBuZXcgeGkoZS5sYXJnZXN0QmF0Y2hJZCwgU3ModC5KdCwgZS5vdmVybGF5TXV0YXRpb24pKTtcbn1cblxuLyoqIERlY29kZXMgYW4gT3ZlcmxheSBtb2RlbCBvYmplY3QgaW50byBhIERiRG9jdW1lbnRPdmVybGF5IG9iamVjdC4gKi9cbi8qKlxuICogUmV0dXJucyB0aGUgRGJEb2N1bWVudE92ZXJsYXlLZXkgY29ycmVzcG9uZGluZyB0byB0aGUgZ2l2ZW4gdXNlciBhbmRcbiAqIGRvY3VtZW50IGtleS5cbiAqL1xuZnVuY3Rpb24gUWkodCwgZSkge1xuICAgIGNvbnN0IG4gPSBlLnBhdGgubGFzdFNlZ21lbnQoKTtcbiAgICByZXR1cm4gWyB0LCBHcyhlLnBhdGgucG9wTGFzdCgpKSwgbiBdO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuY2xhc3Mgamkge1xuICAgIGdldEJ1bmRsZU1ldGFkYXRhKHQsIGUpIHtcbiAgICAgICAgcmV0dXJuIFdpKHQpLmdldChlKS5uZXh0KCh0ID0+IHtcbiAgICAgICAgICAgIGlmICh0KSByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGlkOiAoZSA9IHQpLmJ1bmRsZUlkLFxuICAgICAgICAgICAgICAgIGNyZWF0ZVRpbWU6IEJpKGUuY3JlYXRlVGltZSksXG4gICAgICAgICAgICAgICAgdmVyc2lvbjogZS52ZXJzaW9uXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgLyoqIEVuY29kZXMgYSBEYkJ1bmRsZSB0byBhIEJ1bmRsZU1ldGFkYXRhIG9iamVjdC4gKi9cbiAgICAgICAgICAgIHZhciBlO1xuICAgICAgICAgICAgLyoqIEVuY29kZXMgYSBCdW5kbGVNZXRhZGF0YSB0byBhIERiQnVuZGxlLiAqLyAgICAgICAgfSkpO1xuICAgIH1cbiAgICBzYXZlQnVuZGxlTWV0YWRhdGEodCwgZSkge1xuICAgICAgICByZXR1cm4gV2kodCkucHV0KHtcbiAgICAgICAgICAgIGJ1bmRsZUlkOiAobiA9IGUpLmlkLFxuICAgICAgICAgICAgY3JlYXRlVGltZTogJGkod3Mobi5jcmVhdGVUaW1lKSksXG4gICAgICAgICAgICB2ZXJzaW9uOiBuLnZlcnNpb25cbiAgICAgICAgfSk7XG4gICAgICAgIHZhciBuO1xuICAgICAgICAvKiogRW5jb2RlcyBhIERiTmFtZWRRdWVyeSB0byBhIE5hbWVkUXVlcnkuICovICAgIH1cbiAgICBnZXROYW1lZFF1ZXJ5KHQsIGUpIHtcbiAgICAgICAgcmV0dXJuIHppKHQpLmdldChlKS5uZXh0KCh0ID0+IHtcbiAgICAgICAgICAgIGlmICh0KSByZXR1cm4ge1xuICAgICAgICAgICAgICAgIG5hbWU6IChlID0gdCkubmFtZSxcbiAgICAgICAgICAgICAgICBxdWVyeTogS2koZS5idW5kbGVkUXVlcnkpLFxuICAgICAgICAgICAgICAgIHJlYWRUaW1lOiBCaShlLnJlYWRUaW1lKVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHZhciBlO1xuICAgICAgICAgICAgLyoqIEVuY29kZXMgYSBOYW1lZFF1ZXJ5IGZyb20gYSBidW5kbGUgcHJvdG8gdG8gYSBEYk5hbWVkUXVlcnkuICovICAgICAgICB9KSk7XG4gICAgfVxuICAgIHNhdmVOYW1lZFF1ZXJ5KHQsIGUpIHtcbiAgICAgICAgcmV0dXJuIHppKHQpLnB1dChmdW5jdGlvbih0KSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIG5hbWU6IHQubmFtZSxcbiAgICAgICAgICAgICAgICByZWFkVGltZTogJGkod3ModC5yZWFkVGltZSkpLFxuICAgICAgICAgICAgICAgIGJ1bmRsZWRRdWVyeTogdC5idW5kbGVkUXVlcnlcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0oZSkpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBIZWxwZXIgdG8gZ2V0IGEgdHlwZWQgU2ltcGxlRGJTdG9yZSBmb3IgdGhlIGJ1bmRsZXMgb2JqZWN0IHN0b3JlLlxuICovIGZ1bmN0aW9uIFdpKHQpIHtcbiAgICByZXR1cm4gU2kodCwgXCJidW5kbGVzXCIpO1xufVxuXG4vKipcbiAqIEhlbHBlciB0byBnZXQgYSB0eXBlZCBTaW1wbGVEYlN0b3JlIGZvciB0aGUgbmFtZWRRdWVyaWVzIG9iamVjdCBzdG9yZS5cbiAqLyBmdW5jdGlvbiB6aSh0KSB7XG4gICAgcmV0dXJuIFNpKHQsIFwibmFtZWRRdWVyaWVzXCIpO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMiBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBJbXBsZW1lbnRhdGlvbiBvZiBEb2N1bWVudE92ZXJsYXlDYWNoZSB1c2luZyBJbmRleGVkRGIuXG4gKi8gY2xhc3MgSGkge1xuICAgIC8qKlxuICAgICAqIEBwYXJhbSBzZXJpYWxpemVyIC0gVGhlIGRvY3VtZW50IHNlcmlhbGl6ZXIuXG4gICAgICogQHBhcmFtIHVzZXJJZCAtIFRoZSB1c2VySWQgZm9yIHdoaWNoIHdlIGFyZSBhY2Nlc3Npbmcgb3ZlcmxheXMuXG4gICAgICovXG4gICAgY29uc3RydWN0b3IodCwgZSkge1xuICAgICAgICB0aGlzLk0gPSB0LCB0aGlzLnVzZXJJZCA9IGU7XG4gICAgfVxuICAgIHN0YXRpYyBZdCh0LCBlKSB7XG4gICAgICAgIGNvbnN0IG4gPSBlLnVpZCB8fCBcIlwiO1xuICAgICAgICByZXR1cm4gbmV3IEhpKHQsIG4pO1xuICAgIH1cbiAgICBnZXRPdmVybGF5KHQsIGUpIHtcbiAgICAgICAgcmV0dXJuIEppKHQpLmdldChRaSh0aGlzLnVzZXJJZCwgZSkpLm5leHQoKHQgPT4gdCA/IEdpKHRoaXMuTSwgdCkgOiBudWxsKSk7XG4gICAgfVxuICAgIHNhdmVPdmVybGF5cyh0LCBlLCBuKSB7XG4gICAgICAgIGNvbnN0IHMgPSBbXTtcbiAgICAgICAgcmV0dXJuIG4uZm9yRWFjaCgoKG4sIGkpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHIgPSBuZXcgeGkoZSwgaSk7XG4gICAgICAgICAgICBzLnB1c2godGhpcy5YdCh0LCByKSk7XG4gICAgICAgIH0pKSwgeWkud2FpdEZvcihzKTtcbiAgICB9XG4gICAgcmVtb3ZlT3ZlcmxheXNGb3JCYXRjaElkKHQsIGUsIG4pIHtcbiAgICAgICAgY29uc3QgcyA9IG5ldyBTZXQ7XG4gICAgICAgIC8vIEdldCB0aGUgc2V0IG9mIHVuaXF1ZSBjb2xsZWN0aW9uIHBhdGhzLlxuICAgICAgICAgICAgICAgIGUuZm9yRWFjaCgodCA9PiBzLmFkZChHcyh0LmdldENvbGxlY3Rpb25QYXRoKCkpKSkpO1xuICAgICAgICBjb25zdCBpID0gW107XG4gICAgICAgIHJldHVybiBzLmZvckVhY2goKGUgPT4ge1xuICAgICAgICAgICAgY29uc3QgcyA9IElEQktleVJhbmdlLmJvdW5kKFsgdGhpcy51c2VySWQsIGUsIG4gXSwgWyB0aGlzLnVzZXJJZCwgZSwgbiArIDEgXSwgXG4gICAgICAgICAgICAvKmxvd2VyT3Blbj0qLyAhMSwgXG4gICAgICAgICAgICAvKnVwcGVyT3Blbj0qLyAhMCk7XG4gICAgICAgICAgICBpLnB1c2goSmkodCkuUXQoXCJjb2xsZWN0aW9uUGF0aE92ZXJsYXlJbmRleFwiLCBzKSk7XG4gICAgICAgIH0pKSwgeWkud2FpdEZvcihpKTtcbiAgICB9XG4gICAgZ2V0T3ZlcmxheXNGb3JDb2xsZWN0aW9uKHQsIGUsIG4pIHtcbiAgICAgICAgY29uc3QgcyA9IHpuKCksIGkgPSBHcyhlKSwgciA9IElEQktleVJhbmdlLmJvdW5kKFsgdGhpcy51c2VySWQsIGksIG4gXSwgWyB0aGlzLnVzZXJJZCwgaSwgTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZIF0sIFxuICAgICAgICAvKmxvd2VyT3Blbj0qLyAhMCk7XG4gICAgICAgIHJldHVybiBKaSh0KS5xdChcImNvbGxlY3Rpb25QYXRoT3ZlcmxheUluZGV4XCIsIHIpLm5leHQoKHQgPT4ge1xuICAgICAgICAgICAgZm9yIChjb25zdCBlIG9mIHQpIHtcbiAgICAgICAgICAgICAgICBjb25zdCB0ID0gR2kodGhpcy5NLCBlKTtcbiAgICAgICAgICAgICAgICBzLnNldCh0LmdldEtleSgpLCB0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBzO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIGdldE92ZXJsYXlzRm9yQ29sbGVjdGlvbkdyb3VwKHQsIGUsIG4sIHMpIHtcbiAgICAgICAgY29uc3QgaSA9IHpuKCk7XG4gICAgICAgIGxldCByO1xuICAgICAgICAvLyBXZSB3YW50IGJhdGNoIElEcyBsYXJnZXIgdGhhbiBgc2luY2VCYXRjaElkYCwgYW5kIHNvIHRoZSBsb3dlciBib3VuZFxuICAgICAgICAvLyBpcyBub3QgaW5jbHVzaXZlLlxuICAgICAgICAgICAgICAgIGNvbnN0IG8gPSBJREJLZXlSYW5nZS5ib3VuZChbIHRoaXMudXNlcklkLCBlLCBuIF0sIFsgdGhpcy51c2VySWQsIGUsIE51bWJlci5QT1NJVElWRV9JTkZJTklUWSBdLCBcbiAgICAgICAgLypsb3dlck9wZW49Ki8gITApO1xuICAgICAgICByZXR1cm4gSmkodCkuV3Qoe1xuICAgICAgICAgICAgaW5kZXg6IFwiY29sbGVjdGlvbkdyb3VwT3ZlcmxheUluZGV4XCIsXG4gICAgICAgICAgICByYW5nZTogb1xuICAgICAgICB9LCAoKHQsIGUsIG4pID0+IHtcbiAgICAgICAgICAgIC8vIFdlIGRvIG5vdCB3YW50IHRvIHJldHVybiBwYXJ0aWFsIGJhdGNoIG92ZXJsYXlzLCBldmVuIGlmIHRoZSBzaXplXG4gICAgICAgICAgICAvLyBvZiB0aGUgcmVzdWx0IHNldCBleGNlZWRzIHRoZSBnaXZlbiBgY291bnRgIGFyZ3VtZW50LiBUaGVyZWZvcmUsIHdlXG4gICAgICAgICAgICAvLyBjb250aW51ZSB0byBhZ2dyZWdhdGUgcmVzdWx0cyBldmVuIGFmdGVyIHRoZSByZXN1bHQgc2l6ZSBleGNlZWRzXG4gICAgICAgICAgICAvLyBgY291bnRgIGlmIHRoZXJlIGFyZSBtb3JlIG92ZXJsYXlzIGZyb20gdGhlIGBjdXJyZW50QmF0Y2hJZGAuXG4gICAgICAgICAgICBjb25zdCBvID0gR2kodGhpcy5NLCBlKTtcbiAgICAgICAgICAgIGkuc2l6ZSgpIDwgcyB8fCBvLmxhcmdlc3RCYXRjaElkID09PSByID8gKGkuc2V0KG8uZ2V0S2V5KCksIG8pLCByID0gby5sYXJnZXN0QmF0Y2hJZCkgOiBuLmRvbmUoKTtcbiAgICAgICAgfSkpLm5leHQoKCgpID0+IGkpKTtcbiAgICB9XG4gICAgWHQodCwgZSkge1xuICAgICAgICByZXR1cm4gSmkodCkucHV0KGZ1bmN0aW9uKHQsIGUsIG4pIHtcbiAgICAgICAgICAgIGNvbnN0IFtzLCBpLCByXSA9IFFpKGUsIG4ubXV0YXRpb24ua2V5KTtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgdXNlcklkOiBlLFxuICAgICAgICAgICAgICAgIGNvbGxlY3Rpb25QYXRoOiBpLFxuICAgICAgICAgICAgICAgIGRvY3VtZW50SWQ6IHIsXG4gICAgICAgICAgICAgICAgY29sbGVjdGlvbkdyb3VwOiBuLm11dGF0aW9uLmtleS5nZXRDb2xsZWN0aW9uR3JvdXAoKSxcbiAgICAgICAgICAgICAgICBsYXJnZXN0QmF0Y2hJZDogbi5sYXJnZXN0QmF0Y2hJZCxcbiAgICAgICAgICAgICAgICBvdmVybGF5TXV0YXRpb246IHZzKHQuSnQsIG4ubXV0YXRpb24pXG4gICAgICAgICAgICB9O1xuICAgICAgICB9KHRoaXMuTSwgdGhpcy51c2VySWQsIGUpKTtcbiAgICB9XG59XG5cbi8qKlxuICogSGVscGVyIHRvIGdldCBhIHR5cGVkIFNpbXBsZURiU3RvcmUgZm9yIHRoZSBkb2N1bWVudCBvdmVybGF5IG9iamVjdCBzdG9yZS5cbiAqLyBmdW5jdGlvbiBKaSh0KSB7XG4gICAgcmV0dXJuIFNpKHQsIFwiZG9jdW1lbnRPdmVybGF5c1wiKTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjEgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8vIE5vdGU6IFRoaXMgY29kZSBpcyBjb3BpZWQgZnJvbSB0aGUgYmFja2VuZC4gQ29kZSB0aGF0IGlzIG5vdCB1c2VkIGJ5XG4vLyBGaXJlc3RvcmUgd2FzIHJlbW92ZWQuXG4vKiogRmlyZXN0b3JlIGluZGV4IHZhbHVlIHdyaXRlci4gICovXG5jbGFzcyBZaSB7XG4gICAgY29uc3RydWN0b3IoKSB7fVxuICAgIC8vIFRoZSB3cml0ZSBtZXRob2RzIGJlbG93IHNob3J0LWNpcmN1aXQgd3JpdGluZyB0ZXJtaW5hdG9ycyBmb3IgdmFsdWVzXG4gICAgLy8gY29udGFpbmluZyBhICh0ZXJtaW5hdGluZykgdHJ1bmNhdGVkIHZhbHVlLlxuICAgIC8vIEFzIGFuIGV4YW1wbGUsIGNvbnNpZGVyIHRoZSByZXN1bHRpbmcgZW5jb2RpbmcgZm9yOlxuICAgIC8vIFtcImJhclwiLCBbMiwgXCJmb29cIl1dIC0+IChTVFJJTkcsIFwiYmFyXCIsIFRFUk0sIEFSUkFZLCBOVU1CRVIsIDIsIFNUUklORywgXCJmb29cIiwgVEVSTSwgVEVSTSwgVEVSTSlcbiAgICAvLyBbXCJiYXJcIiwgWzIsIHRydW5jYXRlZChcImZvb1wiKV1dIC0+IChTVFJJTkcsIFwiYmFyXCIsIFRFUk0sIEFSUkFZLCBOVU1CRVIsIDIsIFNUUklORywgXCJmb29cIiwgVFJVTkMpXG4gICAgLy8gW1wiYmFyXCIsIHRydW5jYXRlZChbXCJmb29cIl0pXSAtPiAoU1RSSU5HLCBcImJhclwiLCBURVJNLCBBUlJBWS4gU1RSSU5HLCBcImZvb1wiLCBURVJNLCBUUlVOQylcbiAgICAvKiogV3JpdGVzIGFuIGluZGV4IHZhbHVlLiAgKi9cbiAgICBadCh0LCBlKSB7XG4gICAgICAgIHRoaXMudGUodCwgZSksIFxuICAgICAgICAvLyBXcml0ZSBzZXBhcmF0b3IgdG8gc3BsaXQgaW5kZXggdmFsdWVzXG4gICAgICAgIC8vIChzZWUgZ28vZmlyZXN0b3JlLXN0b3JhZ2UtZm9ybWF0I2VuY29kaW5ncykuXG4gICAgICAgIGUuZWUoKTtcbiAgICB9XG4gICAgdGUodCwgZSkge1xuICAgICAgICBpZiAoXCJudWxsVmFsdWVcIiBpbiB0KSB0aGlzLm5lKGUsIDUpOyBlbHNlIGlmIChcImJvb2xlYW5WYWx1ZVwiIGluIHQpIHRoaXMubmUoZSwgMTApLCBcbiAgICAgICAgZS5zZSh0LmJvb2xlYW5WYWx1ZSA/IDEgOiAwKTsgZWxzZSBpZiAoXCJpbnRlZ2VyVmFsdWVcIiBpbiB0KSB0aGlzLm5lKGUsIDE1KSwgZS5zZShFdCh0LmludGVnZXJWYWx1ZSkpOyBlbHNlIGlmIChcImRvdWJsZVZhbHVlXCIgaW4gdCkge1xuICAgICAgICAgICAgY29uc3QgbiA9IEV0KHQuZG91YmxlVmFsdWUpO1xuICAgICAgICAgICAgaXNOYU4obikgPyB0aGlzLm5lKGUsIDEzKSA6ICh0aGlzLm5lKGUsIDE1KSwgRHQobikgPyBcbiAgICAgICAgICAgIC8vIC0wLjAsIDAgYW5kIDAuMCBhcmUgYWxsIGNvbnNpZGVyZWQgdGhlIHNhbWVcbiAgICAgICAgICAgIGUuc2UoMCkgOiBlLnNlKG4pKTtcbiAgICAgICAgfSBlbHNlIGlmIChcInRpbWVzdGFtcFZhbHVlXCIgaW4gdCkge1xuICAgICAgICAgICAgY29uc3QgbiA9IHQudGltZXN0YW1wVmFsdWU7XG4gICAgICAgICAgICB0aGlzLm5lKGUsIDIwKSwgXCJzdHJpbmdcIiA9PSB0eXBlb2YgbiA/IGUuaWUobikgOiAoZS5pZShgJHtuLnNlY29uZHMgfHwgXCJcIn1gKSwgZS5zZShuLm5hbm9zIHx8IDApKTtcbiAgICAgICAgfSBlbHNlIGlmIChcInN0cmluZ1ZhbHVlXCIgaW4gdCkgdGhpcy5yZSh0LnN0cmluZ1ZhbHVlLCBlKSwgdGhpcy5vZShlKTsgZWxzZSBpZiAoXCJieXRlc1ZhbHVlXCIgaW4gdCkgdGhpcy5uZShlLCAzMCksIFxuICAgICAgICBlLnVlKEF0KHQuYnl0ZXNWYWx1ZSkpLCB0aGlzLm9lKGUpOyBlbHNlIGlmIChcInJlZmVyZW5jZVZhbHVlXCIgaW4gdCkgdGhpcy5hZSh0LnJlZmVyZW5jZVZhbHVlLCBlKTsgZWxzZSBpZiAoXCJnZW9Qb2ludFZhbHVlXCIgaW4gdCkge1xuICAgICAgICAgICAgY29uc3QgbiA9IHQuZ2VvUG9pbnRWYWx1ZTtcbiAgICAgICAgICAgIHRoaXMubmUoZSwgNDUpLCBlLnNlKG4ubGF0aXR1ZGUgfHwgMCksIGUuc2Uobi5sb25naXR1ZGUgfHwgMCk7XG4gICAgICAgIH0gZWxzZSBcIm1hcFZhbHVlXCIgaW4gdCA/IEh0KHQpID8gdGhpcy5uZShlLCBOdW1iZXIuTUFYX1NBRkVfSU5URUdFUikgOiAodGhpcy5jZSh0Lm1hcFZhbHVlLCBlKSwgXG4gICAgICAgIHRoaXMub2UoZSkpIDogXCJhcnJheVZhbHVlXCIgaW4gdCA/ICh0aGlzLmhlKHQuYXJyYXlWYWx1ZSwgZSksIHRoaXMub2UoZSkpIDogTCgpO1xuICAgIH1cbiAgICByZSh0LCBlKSB7XG4gICAgICAgIHRoaXMubmUoZSwgMjUpLCB0aGlzLmxlKHQsIGUpO1xuICAgIH1cbiAgICBsZSh0LCBlKSB7XG4gICAgICAgIGUuaWUodCk7XG4gICAgfVxuICAgIGNlKHQsIGUpIHtcbiAgICAgICAgY29uc3QgbiA9IHQuZmllbGRzIHx8IHt9O1xuICAgICAgICB0aGlzLm5lKGUsIDU1KTtcbiAgICAgICAgZm9yIChjb25zdCB0IG9mIE9iamVjdC5rZXlzKG4pKSB0aGlzLnJlKHQsIGUpLCB0aGlzLnRlKG5bdF0sIGUpO1xuICAgIH1cbiAgICBoZSh0LCBlKSB7XG4gICAgICAgIGNvbnN0IG4gPSB0LnZhbHVlcyB8fCBbXTtcbiAgICAgICAgdGhpcy5uZShlLCA1MCk7XG4gICAgICAgIGZvciAoY29uc3QgdCBvZiBuKSB0aGlzLnRlKHQsIGUpO1xuICAgIH1cbiAgICBhZSh0LCBlKSB7XG4gICAgICAgIHRoaXMubmUoZSwgMzcpO1xuICAgICAgICB4dC5mcm9tTmFtZSh0KS5wYXRoLmZvckVhY2goKHQgPT4ge1xuICAgICAgICAgICAgdGhpcy5uZShlLCA2MCksIHRoaXMubGUodCwgZSk7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgbmUodCwgZSkge1xuICAgICAgICB0LnNlKGUpO1xuICAgIH1cbiAgICBvZSh0KSB7XG4gICAgICAgIC8vIFdoaWxlIHRoZSBTREsgZG9lcyBub3QgaW1wbGVtZW50IHRydW5jYXRpb24sIHRoZSB0cnVuY2F0aW9uIG1hcmtlciBpc1xuICAgICAgICAvLyB1c2VkIHRvIHRlcm1pbmF0ZSBhbGwgdmFyaWFibGUgbGVuZ3RoIHZhbHVlcyAod2hpY2ggYXJlIHN0cmluZ3MsIGJ5dGVzLFxuICAgICAgICAvLyByZWZlcmVuY2VzLCBhcnJheXMgYW5kIG1hcHMpLlxuICAgICAgICB0LnNlKDIpO1xuICAgIH1cbn1cblxuWWkuZmUgPSBuZXcgWWk7XG5cbi8qKlxuICogQ291bnRzIHRoZSBudW1iZXIgb2YgemVyb3MgaW4gYSBieXRlLlxuICpcbiAqIFZpc2libGUgZm9yIHRlc3RpbmcuXG4gKi9cbmZ1bmN0aW9uIFhpKHQpIHtcbiAgICBpZiAoMCA9PT0gdCkgcmV0dXJuIDg7XG4gICAgbGV0IGUgPSAwO1xuICAgIHJldHVybiB0ID4+IDQgPT0gMCAmJiAoXG4gICAgLy8gVGVzdCBpZiB0aGUgZmlyc3QgZm91ciBiaXRzIGFyZSB6ZXJvLlxuICAgIGUgKz0gNCwgdCA8PD0gNCksIHQgPj4gNiA9PSAwICYmIChcbiAgICAvLyBUZXN0IGlmIHRoZSBmaXJzdCB0d28gKG9yIG5leHQgdHdvKSBiaXRzIGFyZSB6ZXJvLlxuICAgIGUgKz0gMiwgdCA8PD0gMiksIHQgPj4gNyA9PSAwICYmIChcbiAgICAvLyBUZXN0IGlmIHRoZSByZW1haW5pbmcgYml0IGlzIHplcm8uXG4gICAgZSArPSAxKSwgZTtcbn1cblxuLyoqIENvdW50cyB0aGUgbnVtYmVyIG9mIGxlYWRpbmcgemVyb3MgaW4gdGhlIGdpdmVuIGJ5dGUgYXJyYXkuICovXG4vKipcbiAqIFJldHVybnMgdGhlIG51bWJlciBvZiBieXRlcyByZXF1aXJlZCB0byBzdG9yZSBcInZhbHVlXCIuIExlYWRpbmcgemVybyBieXRlc1xuICogYXJlIHNraXBwZWQuXG4gKi9cbmZ1bmN0aW9uIFppKHQpIHtcbiAgICAvLyBUaGlzIGlzIGp1c3QgdGhlIG51bWJlciBvZiBieXRlcyBmb3IgdGhlIHVuc2lnbmVkIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBudW1iZXIuXG4gICAgY29uc3QgZSA9IDY0IC0gZnVuY3Rpb24odCkge1xuICAgICAgICBsZXQgZSA9IDA7XG4gICAgICAgIGZvciAobGV0IG4gPSAwOyBuIDwgODsgKytuKSB7XG4gICAgICAgICAgICBjb25zdCBzID0gWGkoMjU1ICYgdFtuXSk7XG4gICAgICAgICAgICBpZiAoZSArPSBzLCA4ICE9PSBzKSBicmVhaztcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZTtcbiAgICB9KHQpO1xuICAgIHJldHVybiBNYXRoLmNlaWwoZSAvIDgpO1xufVxuXG4vKipcbiAqIE9yZGVyZWRDb2RlV3JpdGVyIGlzIGEgbWluaW1hbC1hbGxvY2F0aW9uIGltcGxlbWVudGF0aW9uIG9mIHRoZSB3cml0aW5nXG4gKiBiZWhhdmlvciBkZWZpbmVkIGJ5IHRoZSBiYWNrZW5kLlxuICpcbiAqIFRoZSBjb2RlIGlzIHBvcnRlZCBmcm9tIGl0cyBKYXZhIGNvdW50ZXJwYXJ0LlxuICovIGNsYXNzIHRyIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5idWZmZXIgPSBuZXcgVWludDhBcnJheSgxMDI0KSwgdGhpcy5wb3NpdGlvbiA9IDA7XG4gICAgfVxuICAgIGRlKHQpIHtcbiAgICAgICAgY29uc3QgZSA9IHRbU3ltYm9sLml0ZXJhdG9yXSgpO1xuICAgICAgICBsZXQgbiA9IGUubmV4dCgpO1xuICAgICAgICBmb3IgKDshbi5kb25lOyApIHRoaXMuX2Uobi52YWx1ZSksIG4gPSBlLm5leHQoKTtcbiAgICAgICAgdGhpcy53ZSgpO1xuICAgIH1cbiAgICBtZSh0KSB7XG4gICAgICAgIGNvbnN0IGUgPSB0W1N5bWJvbC5pdGVyYXRvcl0oKTtcbiAgICAgICAgbGV0IG4gPSBlLm5leHQoKTtcbiAgICAgICAgZm9yICg7IW4uZG9uZTsgKSB0aGlzLmdlKG4udmFsdWUpLCBuID0gZS5uZXh0KCk7XG4gICAgICAgIHRoaXMueWUoKTtcbiAgICB9XG4gICAgLyoqIFdyaXRlcyB1dGY4IGJ5dGVzIGludG8gdGhpcyBieXRlIHNlcXVlbmNlLCBhc2NlbmRpbmcuICovICAgIHBlKHQpIHtcbiAgICAgICAgZm9yIChjb25zdCBlIG9mIHQpIHtcbiAgICAgICAgICAgIGNvbnN0IHQgPSBlLmNoYXJDb2RlQXQoMCk7XG4gICAgICAgICAgICBpZiAodCA8IDEyOCkgdGhpcy5fZSh0KTsgZWxzZSBpZiAodCA8IDIwNDgpIHRoaXMuX2UoOTYwIHwgdCA+Pj4gNiksIHRoaXMuX2UoMTI4IHwgNjMgJiB0KTsgZWxzZSBpZiAoZSA8IFwiXFx1ZDgwMFwiIHx8IFwiXFx1ZGJmZlwiIDwgZSkgdGhpcy5fZSg0ODAgfCB0ID4+PiAxMiksIFxuICAgICAgICAgICAgdGhpcy5fZSgxMjggfCA2MyAmIHQgPj4+IDYpLCB0aGlzLl9lKDEyOCB8IDYzICYgdCk7IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnN0IHQgPSBlLmNvZGVQb2ludEF0KDApO1xuICAgICAgICAgICAgICAgIHRoaXMuX2UoMjQwIHwgdCA+Pj4gMTgpLCB0aGlzLl9lKDEyOCB8IDYzICYgdCA+Pj4gMTIpLCB0aGlzLl9lKDEyOCB8IDYzICYgdCA+Pj4gNiksIFxuICAgICAgICAgICAgICAgIHRoaXMuX2UoMTI4IHwgNjMgJiB0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLndlKCk7XG4gICAgfVxuICAgIC8qKiBXcml0ZXMgdXRmOCBieXRlcyBpbnRvIHRoaXMgYnl0ZSBzZXF1ZW5jZSwgZGVzY2VuZGluZyAqLyAgICBJZSh0KSB7XG4gICAgICAgIGZvciAoY29uc3QgZSBvZiB0KSB7XG4gICAgICAgICAgICBjb25zdCB0ID0gZS5jaGFyQ29kZUF0KDApO1xuICAgICAgICAgICAgaWYgKHQgPCAxMjgpIHRoaXMuZ2UodCk7IGVsc2UgaWYgKHQgPCAyMDQ4KSB0aGlzLmdlKDk2MCB8IHQgPj4+IDYpLCB0aGlzLmdlKDEyOCB8IDYzICYgdCk7IGVsc2UgaWYgKGUgPCBcIlxcdWQ4MDBcIiB8fCBcIlxcdWRiZmZcIiA8IGUpIHRoaXMuZ2UoNDgwIHwgdCA+Pj4gMTIpLCBcbiAgICAgICAgICAgIHRoaXMuZ2UoMTI4IHwgNjMgJiB0ID4+PiA2KSwgdGhpcy5nZSgxMjggfCA2MyAmIHQpOyBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25zdCB0ID0gZS5jb2RlUG9pbnRBdCgwKTtcbiAgICAgICAgICAgICAgICB0aGlzLmdlKDI0MCB8IHQgPj4+IDE4KSwgdGhpcy5nZSgxMjggfCA2MyAmIHQgPj4+IDEyKSwgdGhpcy5nZSgxMjggfCA2MyAmIHQgPj4+IDYpLCBcbiAgICAgICAgICAgICAgICB0aGlzLmdlKDEyOCB8IDYzICYgdCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy55ZSgpO1xuICAgIH1cbiAgICBUZSh0KSB7XG4gICAgICAgIC8vIFZhbHVlcyBhcmUgZW5jb2RlZCB3aXRoIGEgc2luZ2xlIGJ5dGUgbGVuZ3RoIHByZWZpeCwgZm9sbG93ZWQgYnkgdGhlXG4gICAgICAgIC8vIGFjdHVhbCB2YWx1ZSBpbiBiaWctZW5kaWFuIGZvcm1hdCB3aXRoIGxlYWRpbmcgMCBieXRlcyBkcm9wcGVkLlxuICAgICAgICBjb25zdCBlID0gdGhpcy5FZSh0KSwgbiA9IFppKGUpO1xuICAgICAgICB0aGlzLkFlKDEgKyBuKSwgdGhpcy5idWZmZXJbdGhpcy5wb3NpdGlvbisrXSA9IDI1NSAmIG47XG4gICAgICAgIC8vIFdyaXRlIHRoZSBsZW5ndGhcbiAgICAgICAgZm9yIChsZXQgdCA9IGUubGVuZ3RoIC0gbjsgdCA8IGUubGVuZ3RoOyArK3QpIHRoaXMuYnVmZmVyW3RoaXMucG9zaXRpb24rK10gPSAyNTUgJiBlW3RdO1xuICAgIH1cbiAgICBSZSh0KSB7XG4gICAgICAgIC8vIFZhbHVlcyBhcmUgZW5jb2RlZCB3aXRoIGEgc2luZ2xlIGJ5dGUgbGVuZ3RoIHByZWZpeCwgZm9sbG93ZWQgYnkgdGhlXG4gICAgICAgIC8vIGludmVydGVkIHZhbHVlIGluIGJpZy1lbmRpYW4gZm9ybWF0IHdpdGggbGVhZGluZyAwIGJ5dGVzIGRyb3BwZWQuXG4gICAgICAgIGNvbnN0IGUgPSB0aGlzLkVlKHQpLCBuID0gWmkoZSk7XG4gICAgICAgIHRoaXMuQWUoMSArIG4pLCB0aGlzLmJ1ZmZlclt0aGlzLnBvc2l0aW9uKytdID0gfigyNTUgJiBuKTtcbiAgICAgICAgLy8gV3JpdGUgdGhlIGxlbmd0aFxuICAgICAgICBmb3IgKGxldCB0ID0gZS5sZW5ndGggLSBuOyB0IDwgZS5sZW5ndGg7ICsrdCkgdGhpcy5idWZmZXJbdGhpcy5wb3NpdGlvbisrXSA9IH4oMjU1ICYgZVt0XSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFdyaXRlcyB0aGUgXCJpbmZpbml0eVwiIGJ5dGUgc2VxdWVuY2UgdGhhdCBzb3J0cyBhZnRlciBhbGwgb3RoZXIgYnl0ZVxuICAgICAqIHNlcXVlbmNlcyB3cml0dGVuIGluIGFzY2VuZGluZyBvcmRlci5cbiAgICAgKi8gICAgYmUoKSB7XG4gICAgICAgIHRoaXMuUGUoMjU1KSwgdGhpcy5QZSgyNTUpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBXcml0ZXMgdGhlIFwiaW5maW5pdHlcIiBieXRlIHNlcXVlbmNlIHRoYXQgc29ydHMgYmVmb3JlIGFsbCBvdGhlciBieXRlXG4gICAgICogc2VxdWVuY2VzIHdyaXR0ZW4gaW4gZGVzY2VuZGluZyBvcmRlci5cbiAgICAgKi8gICAgVmUoKSB7XG4gICAgICAgIHRoaXMudmUoMjU1KSwgdGhpcy52ZSgyNTUpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXNldHMgdGhlIGJ1ZmZlciBzdWNoIHRoYXQgaXQgaXMgdGhlIHNhbWUgYXMgd2hlbiBpdCB3YXMgbmV3bHlcbiAgICAgKiBjb25zdHJ1Y3RlZC5cbiAgICAgKi8gICAgcmVzZXQoKSB7XG4gICAgICAgIHRoaXMucG9zaXRpb24gPSAwO1xuICAgIH1cbiAgICBzZWVkKHQpIHtcbiAgICAgICAgdGhpcy5BZSh0Lmxlbmd0aCksIHRoaXMuYnVmZmVyLnNldCh0LCB0aGlzLnBvc2l0aW9uKSwgdGhpcy5wb3NpdGlvbiArPSB0Lmxlbmd0aDtcbiAgICB9XG4gICAgLyoqIE1ha2VzIGEgY29weSBvZiB0aGUgZW5jb2RlZCBieXRlcyBpbiB0aGlzIGJ1ZmZlci4gICovICAgIFNlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5idWZmZXIuc2xpY2UoMCwgdGhpcy5wb3NpdGlvbik7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEVuY29kZXMgYHZhbGAgaW50byBhbiBlbmNvZGluZyBzbyB0aGF0IHRoZSBvcmRlciBtYXRjaGVzIHRoZSBJRUVFIDc1NFxuICAgICAqIGZsb2F0aW5nLXBvaW50IGNvbXBhcmlzb24gcmVzdWx0cyB3aXRoIHRoZSBmb2xsb3dpbmcgZXhjZXB0aW9uczpcbiAgICAgKiAgIC0wLjAgPCAwLjBcbiAgICAgKiAgIGFsbCBub24tTmFOIDwgTmFOXG4gICAgICogICBOYU4gPSBOYU5cbiAgICAgKi8gICAgRWUodCkge1xuICAgICAgICBjb25zdCBlID0gXG4gICAgICAgIC8qKiBDb252ZXJ0cyBhIEphdmFTY3JpcHQgbnVtYmVyIHRvIGEgYnl0ZSBhcnJheSAodXNpbmcgYmlnIGVuZGlhbiBlbmNvZGluZykuICovXG4gICAgICAgIGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgICAgIGNvbnN0IGUgPSBuZXcgRGF0YVZpZXcobmV3IEFycmF5QnVmZmVyKDgpKTtcbiAgICAgICAgICAgIHJldHVybiBlLnNldEZsb2F0NjQoMCwgdCwgLyogbGl0dGxlRW5kaWFuPSAqLyAhMSksIG5ldyBVaW50OEFycmF5KGUuYnVmZmVyKTtcbiAgICAgICAgfSh0KSwgbiA9IDAgIT0gKDEyOCAmIGVbMF0pO1xuICAgICAgICAvLyBDaGVjayBpZiB0aGUgZmlyc3QgYml0IGlzIHNldC4gV2UgdXNlIGEgYml0IG1hc2sgc2luY2UgdmFsdWVbMF0gaXNcbiAgICAgICAgLy8gZW5jb2RlZCBhcyBhIG51bWJlciBmcm9tIDAgdG8gMjU1LlxuICAgICAgICAgICAgICAgIC8vIFJldmVydCB0aGUgdHdvIGNvbXBsZW1lbnQgdG8gZ2V0IG5hdHVyYWwgb3JkZXJpbmdcbiAgICAgICAgZVswXSBePSBuID8gMjU1IDogMTI4O1xuICAgICAgICBmb3IgKGxldCB0ID0gMTsgdCA8IGUubGVuZ3RoOyArK3QpIGVbdF0gXj0gbiA/IDI1NSA6IDA7XG4gICAgICAgIHJldHVybiBlO1xuICAgIH1cbiAgICAvKiogV3JpdGVzIGEgc2luZ2xlIGJ5dGUgYXNjZW5kaW5nIHRvIHRoZSBidWZmZXIuICovICAgIF9lKHQpIHtcbiAgICAgICAgY29uc3QgZSA9IDI1NSAmIHQ7XG4gICAgICAgIDAgPT09IGUgPyAodGhpcy5QZSgwKSwgdGhpcy5QZSgyNTUpKSA6IDI1NSA9PT0gZSA/ICh0aGlzLlBlKDI1NSksIHRoaXMuUGUoMCkpIDogdGhpcy5QZShlKTtcbiAgICB9XG4gICAgLyoqIFdyaXRlcyBhIHNpbmdsZSBieXRlIGRlc2NlbmRpbmcgdG8gdGhlIGJ1ZmZlci4gICovICAgIGdlKHQpIHtcbiAgICAgICAgY29uc3QgZSA9IDI1NSAmIHQ7XG4gICAgICAgIDAgPT09IGUgPyAodGhpcy52ZSgwKSwgdGhpcy52ZSgyNTUpKSA6IDI1NSA9PT0gZSA/ICh0aGlzLnZlKDI1NSksIHRoaXMudmUoMCkpIDogdGhpcy52ZSh0KTtcbiAgICB9XG4gICAgd2UoKSB7XG4gICAgICAgIHRoaXMuUGUoMCksIHRoaXMuUGUoMSk7XG4gICAgfVxuICAgIHllKCkge1xuICAgICAgICB0aGlzLnZlKDApLCB0aGlzLnZlKDEpO1xuICAgIH1cbiAgICBQZSh0KSB7XG4gICAgICAgIHRoaXMuQWUoMSksIHRoaXMuYnVmZmVyW3RoaXMucG9zaXRpb24rK10gPSB0O1xuICAgIH1cbiAgICB2ZSh0KSB7XG4gICAgICAgIHRoaXMuQWUoMSksIHRoaXMuYnVmZmVyW3RoaXMucG9zaXRpb24rK10gPSB+dDtcbiAgICB9XG4gICAgQWUodCkge1xuICAgICAgICBjb25zdCBlID0gdCArIHRoaXMucG9zaXRpb247XG4gICAgICAgIGlmIChlIDw9IHRoaXMuYnVmZmVyLmxlbmd0aCkgcmV0dXJuO1xuICAgICAgICAvLyBUcnkgZG91YmxpbmcuXG4gICAgICAgICAgICAgICAgbGV0IG4gPSAyICogdGhpcy5idWZmZXIubGVuZ3RoO1xuICAgICAgICAvLyBTdGlsbCBub3QgYmlnIGVub3VnaD8gSnVzdCBhbGxvY2F0ZSB0aGUgcmlnaHQgc2l6ZS5cbiAgICAgICAgICAgICAgICBuIDwgZSAmJiAobiA9IGUpO1xuICAgICAgICAvLyBDcmVhdGUgdGhlIG5ldyBidWZmZXIuXG4gICAgICAgICAgICAgICAgY29uc3QgcyA9IG5ldyBVaW50OEFycmF5KG4pO1xuICAgICAgICBzLnNldCh0aGlzLmJ1ZmZlciksIC8vIGNvcHkgb2xkIGRhdGFcbiAgICAgICAgdGhpcy5idWZmZXIgPSBzO1xuICAgIH1cbn1cblxuY2xhc3MgZXIge1xuICAgIGNvbnN0cnVjdG9yKHQpIHtcbiAgICAgICAgdGhpcy5EZSA9IHQ7XG4gICAgfVxuICAgIHVlKHQpIHtcbiAgICAgICAgdGhpcy5EZS5kZSh0KTtcbiAgICB9XG4gICAgaWUodCkge1xuICAgICAgICB0aGlzLkRlLnBlKHQpO1xuICAgIH1cbiAgICBzZSh0KSB7XG4gICAgICAgIHRoaXMuRGUuVGUodCk7XG4gICAgfVxuICAgIGVlKCkge1xuICAgICAgICB0aGlzLkRlLmJlKCk7XG4gICAgfVxufVxuXG5jbGFzcyBuciB7XG4gICAgY29uc3RydWN0b3IodCkge1xuICAgICAgICB0aGlzLkRlID0gdDtcbiAgICB9XG4gICAgdWUodCkge1xuICAgICAgICB0aGlzLkRlLm1lKHQpO1xuICAgIH1cbiAgICBpZSh0KSB7XG4gICAgICAgIHRoaXMuRGUuSWUodCk7XG4gICAgfVxuICAgIHNlKHQpIHtcbiAgICAgICAgdGhpcy5EZS5SZSh0KTtcbiAgICB9XG4gICAgZWUoKSB7XG4gICAgICAgIHRoaXMuRGUuVmUoKTtcbiAgICB9XG59XG5cbi8qKlxuICogSW1wbGVtZW50cyBgRGlyZWN0aW9uYWxJbmRleEJ5dGVFbmNvZGVyYCB1c2luZyBgT3JkZXJlZENvZGVXcml0ZXJgIGZvciB0aGVcbiAqIGFjdHVhbCBlbmNvZGluZy5cbiAqLyBjbGFzcyBzciB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMuRGUgPSBuZXcgdHIsIHRoaXMuQ2UgPSBuZXcgZXIodGhpcy5EZSksIHRoaXMueGUgPSBuZXcgbnIodGhpcy5EZSk7XG4gICAgfVxuICAgIHNlZWQodCkge1xuICAgICAgICB0aGlzLkRlLnNlZWQodCk7XG4gICAgfVxuICAgIE5lKHQpIHtcbiAgICAgICAgcmV0dXJuIDAgLyogQVNDRU5ESU5HICovID09PSB0ID8gdGhpcy5DZSA6IHRoaXMueGU7XG4gICAgfVxuICAgIFNlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5EZS5TZSgpO1xuICAgIH1cbiAgICByZXNldCgpIHtcbiAgICAgICAgdGhpcy5EZS5yZXNldCgpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjIgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKiBSZXByZXNlbnRzIGFuIGluZGV4IGVudHJ5IHNhdmVkIGJ5IHRoZSBTREsgaW4gcGVyc2lzdGVkIHN0b3JhZ2UuICovIGNsYXNzIGlyIHtcbiAgICBjb25zdHJ1Y3Rvcih0LCBlLCBuLCBzKSB7XG4gICAgICAgIHRoaXMuaW5kZXhJZCA9IHQsIHRoaXMuZG9jdW1lbnRLZXkgPSBlLCB0aGlzLmFycmF5VmFsdWUgPSBuLCB0aGlzLmRpcmVjdGlvbmFsVmFsdWUgPSBzO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIGFuIEluZGV4RW50cnkgZW50cnkgdGhhdCBzb3J0cyBpbW1lZGlhdGVseSBhZnRlciB0aGUgY3VycmVudFxuICAgICAqIGRpcmVjdGlvbmFsIHZhbHVlLlxuICAgICAqLyAgICBrZSgpIHtcbiAgICAgICAgY29uc3QgdCA9IHRoaXMuZGlyZWN0aW9uYWxWYWx1ZS5sZW5ndGgsIGUgPSAwID09PSB0IHx8IDI1NSA9PT0gdGhpcy5kaXJlY3Rpb25hbFZhbHVlW3QgLSAxXSA/IHQgKyAxIDogdCwgbiA9IG5ldyBVaW50OEFycmF5KGUpO1xuICAgICAgICByZXR1cm4gbi5zZXQodGhpcy5kaXJlY3Rpb25hbFZhbHVlLCAwKSwgZSAhPT0gdCA/IG4uc2V0KFsgMCBdLCB0aGlzLmRpcmVjdGlvbmFsVmFsdWUubGVuZ3RoKSA6ICsrbltuLmxlbmd0aCAtIDFdLCBcbiAgICAgICAgbmV3IGlyKHRoaXMuaW5kZXhJZCwgdGhpcy5kb2N1bWVudEtleSwgdGhpcy5hcnJheVZhbHVlLCBuKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIHJyKHQsIGUpIHtcbiAgICBsZXQgbiA9IHQuaW5kZXhJZCAtIGUuaW5kZXhJZDtcbiAgICByZXR1cm4gMCAhPT0gbiA/IG4gOiAobiA9IG9yKHQuYXJyYXlWYWx1ZSwgZS5hcnJheVZhbHVlKSwgMCAhPT0gbiA/IG4gOiAobiA9IG9yKHQuZGlyZWN0aW9uYWxWYWx1ZSwgZS5kaXJlY3Rpb25hbFZhbHVlKSwgXG4gICAgMCAhPT0gbiA/IG4gOiB4dC5jb21wYXJhdG9yKHQuZG9jdW1lbnRLZXksIGUuZG9jdW1lbnRLZXkpKSk7XG59XG5cbmZ1bmN0aW9uIG9yKHQsIGUpIHtcbiAgICBmb3IgKGxldCBuID0gMDsgbiA8IHQubGVuZ3RoICYmIG4gPCBlLmxlbmd0aDsgKytuKSB7XG4gICAgICAgIGNvbnN0IHMgPSB0W25dIC0gZVtuXTtcbiAgICAgICAgaWYgKDAgIT09IHMpIHJldHVybiBzO1xuICAgIH1cbiAgICByZXR1cm4gdC5sZW5ndGggLSBlLmxlbmd0aDtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjIgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogQSBsaWdodCBxdWVyeSBwbGFubmVyIGZvciBGaXJlc3RvcmUuXG4gKlxuICogVGhpcyBjbGFzcyBtYXRjaGVzIGEgYEZpZWxkSW5kZXhgIGFnYWluc3QgYSBGaXJlc3RvcmUgUXVlcnkgYFRhcmdldGAuIEl0XG4gKiBkZXRlcm1pbmVzIHdoZXRoZXIgYSBnaXZlbiBpbmRleCBjYW4gYmUgdXNlZCB0byBzZXJ2ZSB0aGUgc3BlY2lmaWVkIHRhcmdldC5cbiAqXG4gKiBUaGUgZm9sbG93aW5nIHRhYmxlIHNob3djYXNlcyBzb21lIHBvc3NpYmxlIGluZGV4IGNvbmZpZ3VyYXRpb25zOlxuICpcbiAqIFF1ZXJ5ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8IEluZGV4XG4gKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICogd2hlcmUoJ2EnLCAnPT0nLCAnYScpLndoZXJlKCdiJywgJz09JywgJ2InKSAgICAgICAgIHwgYSBBU0MsIGIgREVTQ1xuICogd2hlcmUoJ2EnLCAnPT0nLCAnYScpLndoZXJlKCdiJywgJz09JywgJ2InKSAgICAgICAgIHwgYSBBU0NcbiAqIHdoZXJlKCdhJywgJz09JywgJ2EnKS53aGVyZSgnYicsICc9PScsICdiJykgICAgICAgICB8IGIgREVTQ1xuICogd2hlcmUoJ2EnLCAnPj0nLCAnYScpLm9yZGVyQnkoJ2EnKSAgICAgICAgICAgICAgICAgIHwgYSBBU0NcbiAqIHdoZXJlKCdhJywgJz49JywgJ2EnKS5vcmRlckJ5KCdhJywgJ2Rlc2MnKSAgICAgICAgICB8IGEgREVTQ1xuICogd2hlcmUoJ2EnLCAnPj0nLCAnYScpLm9yZGVyQnkoJ2EnKS5vcmRlckJ5KCdiJykgICAgIHwgYSBBU0MsIGIgQVNDXG4gKiB3aGVyZSgnYScsICc+PScsICdhJykub3JkZXJCeSgnYScpLm9yZGVyQnkoJ2InKSAgICAgfCBhIEFTQ1xuICogd2hlcmUoJ2EnLCAnYXJyYXktY29udGFpbnMnLCAnYScpLm9yZGVyQnkoJ2InKSAgICAgIHwgYSBDT05UQUlOUywgYiBBU0NFTkRJTkdcbiAqIHdoZXJlKCdhJywgJ2FycmF5LWNvbnRhaW5zJywgJ2EnKS5vcmRlckJ5KCdiJykgICAgICB8IGEgQ09OVEFJTlNcbiAqLyBjbGFzcyB1ciB7XG4gICAgY29uc3RydWN0b3IodCkge1xuICAgICAgICB0aGlzLmNvbGxlY3Rpb25JZCA9IG51bGwgIT0gdC5jb2xsZWN0aW9uR3JvdXAgPyB0LmNvbGxlY3Rpb25Hcm91cCA6IHQucGF0aC5sYXN0U2VnbWVudCgpLCBcbiAgICAgICAgdGhpcy5NZSA9IHQub3JkZXJCeSwgdGhpcy5PZSA9IFtdO1xuICAgICAgICBmb3IgKGNvbnN0IGUgb2YgdC5maWx0ZXJzKSB7XG4gICAgICAgICAgICBjb25zdCB0ID0gZTtcbiAgICAgICAgICAgIHQuUygpID8gdGhpcy5GZSA9IHQgOiB0aGlzLk9lLnB1c2godCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyB3aGV0aGVyIHRoZSBpbmRleCBjYW4gYmUgdXNlZCB0byBzZXJ2ZSB0aGUgVGFyZ2V0SW5kZXhNYXRjaGVyJ3NcbiAgICAgKiB0YXJnZXQuXG4gICAgICpcbiAgICAgKiBBbiBpbmRleCBpcyBjb25zaWRlcmVkIGNhcGFibGUgb2Ygc2VydmluZyB0aGUgdGFyZ2V0IHdoZW46XG4gICAgICogLSBUaGUgdGFyZ2V0IHVzZXMgYWxsIGluZGV4IHNlZ21lbnRzIGZvciBpdHMgZmlsdGVycyBhbmQgb3JkZXJCeSBjbGF1c2VzLlxuICAgICAqICAgVGhlIHRhcmdldCBjYW4gaGF2ZSBhZGRpdGlvbmFsIGZpbHRlciBhbmQgb3JkZXJCeSBjbGF1c2VzLCBidXQgbm90XG4gICAgICogICBmZXdlci5cbiAgICAgKiAtIElmIGFuIEFycmF5Q29udGFpbnMvQXJyYXlDb250YWluc0FueWZpbHRlciBpcyB1c2VkLCB0aGUgaW5kZXggbXVzdCBhbHNvXG4gICAgICogICBoYXZlIGEgY29ycmVzcG9uZGluZyBgQ09OVEFJTlNgIHNlZ21lbnQuXG4gICAgICogLSBBbGwgZGlyZWN0aW9uYWwgaW5kZXggc2VnbWVudHMgY2FuIGJlIG1hcHBlZCB0byB0aGUgdGFyZ2V0IGFzIGEgc2VyaWVzIG9mXG4gICAgICogICBlcXVhbGl0eSBmaWx0ZXJzLCBhIHNpbmdsZSBpbmVxdWFsaXR5IGZpbHRlciBhbmQgYSBzZXJpZXMgb2Ygb3JkZXJCeVxuICAgICAqICAgY2xhdXNlcy5cbiAgICAgKiAtIFRoZSBzZWdtZW50cyB0aGF0IHJlcHJlc2VudCB0aGUgZXF1YWxpdHkgZmlsdGVycyBtYXkgYXBwZWFyIG91dCBvZiBvcmRlci5cbiAgICAgKiAtIFRoZSBvcHRpb25hbCBzZWdtZW50IGZvciB0aGUgaW5lcXVhbGl0eSBmaWx0ZXIgbXVzdCBhcHBlYXIgYWZ0ZXIgYWxsXG4gICAgICogICBlcXVhbGl0eSBzZWdtZW50cy5cbiAgICAgKiAtIFRoZSBzZWdtZW50cyB0aGF0IHJlcHJlc2VudCB0aGF0IG9yZGVyQnkgY2xhdXNlIG9mIHRoZSB0YXJnZXQgbXVzdCBhcHBlYXJcbiAgICAgKiAgIGluIG9yZGVyIGFmdGVyIGFsbCBlcXVhbGl0eSBhbmQgaW5lcXVhbGl0eSBzZWdtZW50cy4gU2luZ2xlIG9yZGVyQnlcbiAgICAgKiAgIGNsYXVzZXMgY2Fubm90IGJlIHNraXBwZWQsIGJ1dCBhIGNvbnRpbnVvdXMgb3JkZXJCeSBzdWZmaXggbWF5IGJlXG4gICAgICogICBvbWl0dGVkLlxuICAgICAqLyAgICAkZSh0KSB7XG4gICAgICAgIC8vIElmIHRoZXJlIGlzIGFuIGFycmF5IGVsZW1lbnQsIGZpbmQgYSBtYXRjaGluZyBmaWx0ZXIuXG4gICAgICAgIGNvbnN0IGUgPSBpZSh0KTtcbiAgICAgICAgaWYgKHZvaWQgMCAhPT0gZSAmJiAhdGhpcy5CZShlKSkgcmV0dXJuICExO1xuICAgICAgICBjb25zdCBuID0gcmUodCk7XG4gICAgICAgIGxldCBzID0gMCwgaSA9IDA7XG4gICAgICAgIC8vIFByb2Nlc3MgYWxsIGVxdWFsaXRpZXMgZmlyc3QuIEVxdWFsaXRpZXMgY2FuIGFwcGVhciBvdXQgb2Ygb3JkZXIuXG4gICAgICAgIGZvciAoO3MgPCBuLmxlbmd0aCAmJiB0aGlzLkJlKG5bc10pOyArK3MpIDtcbiAgICAgICAgLy8gSWYgd2UgYWxyZWFkeSBoYXZlIHByb2Nlc3NlZCBhbGwgc2VnbWVudHMsIGFsbCBzZWdtZW50cyBhcmUgdXNlZCB0byBzZXJ2ZVxuICAgICAgICAvLyB0aGUgZXF1YWxpdHkgZmlsdGVycyBhbmQgd2UgZG8gbm90IG5lZWQgdG8gbWFwIGFueSBzZWdtZW50cyB0byB0aGVcbiAgICAgICAgLy8gdGFyZ2V0J3MgaW5lcXVhbGl0eSBhbmQgb3JkZXJCeSBjbGF1c2VzLlxuICAgICAgICAgICAgICAgIGlmIChzID09PSBuLmxlbmd0aCkgcmV0dXJuICEwO1xuICAgICAgICAvLyBJZiB0aGVyZSBpcyBhbiBpbmVxdWFsaXR5IGZpbHRlciwgdGhlIG5leHQgc2VnbWVudCBtdXN0IG1hdGNoIGJvdGggdGhlXG4gICAgICAgIC8vIGZpbHRlciBhbmQgdGhlIGZpcnN0IG9yZGVyQnkgY2xhdXNlLlxuICAgICAgICAgICAgICAgIGlmICh2b2lkIDAgIT09IHRoaXMuRmUpIHtcbiAgICAgICAgICAgIGNvbnN0IHQgPSBuW3NdO1xuICAgICAgICAgICAgaWYgKCF0aGlzLkxlKHRoaXMuRmUsIHQpIHx8ICF0aGlzLlVlKHRoaXMuTWVbaSsrXSwgdCkpIHJldHVybiAhMTtcbiAgICAgICAgICAgICsrcztcbiAgICAgICAgfVxuICAgICAgICAvLyBBbGwgcmVtYWluaW5nIHNlZ21lbnRzIG5lZWQgdG8gcmVwcmVzZW50IHRoZSBwcmVmaXggb2YgdGhlIHRhcmdldCdzXG4gICAgICAgIC8vIG9yZGVyQnkuXG4gICAgICAgICAgICAgICAgZm9yICg7cyA8IG4ubGVuZ3RoOyArK3MpIHtcbiAgICAgICAgICAgIGNvbnN0IHQgPSBuW3NdO1xuICAgICAgICAgICAgaWYgKGkgPj0gdGhpcy5NZS5sZW5ndGggfHwgIXRoaXMuVWUodGhpcy5NZVtpKytdLCB0KSkgcmV0dXJuICExO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAhMDtcbiAgICB9XG4gICAgQmUodCkge1xuICAgICAgICBmb3IgKGNvbnN0IGUgb2YgdGhpcy5PZSkgaWYgKHRoaXMuTGUoZSwgdCkpIHJldHVybiAhMDtcbiAgICAgICAgcmV0dXJuICExO1xuICAgIH1cbiAgICBMZSh0LCBlKSB7XG4gICAgICAgIGlmICh2b2lkIDAgPT09IHQgfHwgIXQuZmllbGQuaXNFcXVhbChlLmZpZWxkUGF0aCkpIHJldHVybiAhMTtcbiAgICAgICAgY29uc3QgbiA9IFwiYXJyYXktY29udGFpbnNcIiAvKiBBUlJBWV9DT05UQUlOUyAqLyA9PT0gdC5vcCB8fCBcImFycmF5LWNvbnRhaW5zLWFueVwiIC8qIEFSUkFZX0NPTlRBSU5TX0FOWSAqLyA9PT0gdC5vcDtcbiAgICAgICAgcmV0dXJuIDIgLyogQ09OVEFJTlMgKi8gPT09IGUua2luZCA9PT0gbjtcbiAgICB9XG4gICAgVWUodCwgZSkge1xuICAgICAgICByZXR1cm4gISF0LmZpZWxkLmlzRXF1YWwoZS5maWVsZFBhdGgpICYmICgwIC8qIEFTQ0VORElORyAqLyA9PT0gZS5raW5kICYmIFwiYXNjXCIgLyogQVNDRU5ESU5HICovID09PSB0LmRpciB8fCAxIC8qIERFU0NFTkRJTkcgKi8gPT09IGUua2luZCAmJiBcImRlc2NcIiAvKiBERVNDRU5ESU5HICovID09PSB0LmRpcik7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBBbiBpbi1tZW1vcnkgaW1wbGVtZW50YXRpb24gb2YgSW5kZXhNYW5hZ2VyLlxuICovIGNsYXNzIGFyIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5xZSA9IG5ldyBjcjtcbiAgICB9XG4gICAgYWRkVG9Db2xsZWN0aW9uUGFyZW50SW5kZXgodCwgZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5xZS5hZGQoZSksIHlpLnJlc29sdmUoKTtcbiAgICB9XG4gICAgZ2V0Q29sbGVjdGlvblBhcmVudHModCwgZSkge1xuICAgICAgICByZXR1cm4geWkucmVzb2x2ZSh0aGlzLnFlLmdldEVudHJpZXMoZSkpO1xuICAgIH1cbiAgICBhZGRGaWVsZEluZGV4KHQsIGUpIHtcbiAgICAgICAgLy8gRmllbGQgaW5kaWNlcyBhcmUgbm90IHN1cHBvcnRlZCB3aXRoIG1lbW9yeSBwZXJzaXN0ZW5jZS5cbiAgICAgICAgcmV0dXJuIHlpLnJlc29sdmUoKTtcbiAgICB9XG4gICAgZGVsZXRlRmllbGRJbmRleCh0LCBlKSB7XG4gICAgICAgIC8vIEZpZWxkIGluZGljZXMgYXJlIG5vdCBzdXBwb3J0ZWQgd2l0aCBtZW1vcnkgcGVyc2lzdGVuY2UuXG4gICAgICAgIHJldHVybiB5aS5yZXNvbHZlKCk7XG4gICAgfVxuICAgIGdldERvY3VtZW50c01hdGNoaW5nVGFyZ2V0KHQsIGUpIHtcbiAgICAgICAgLy8gRmllbGQgaW5kaWNlcyBhcmUgbm90IHN1cHBvcnRlZCB3aXRoIG1lbW9yeSBwZXJzaXN0ZW5jZS5cbiAgICAgICAgcmV0dXJuIHlpLnJlc29sdmUobnVsbCk7XG4gICAgfVxuICAgIGdldEluZGV4VHlwZSh0LCBlKSB7XG4gICAgICAgIC8vIEZpZWxkIGluZGljZXMgYXJlIG5vdCBzdXBwb3J0ZWQgd2l0aCBtZW1vcnkgcGVyc2lzdGVuY2UuXG4gICAgICAgIHJldHVybiB5aS5yZXNvbHZlKDAgLyogTk9ORSAqLyk7XG4gICAgfVxuICAgIGdldEZpZWxkSW5kZXhlcyh0LCBlKSB7XG4gICAgICAgIC8vIEZpZWxkIGluZGljZXMgYXJlIG5vdCBzdXBwb3J0ZWQgd2l0aCBtZW1vcnkgcGVyc2lzdGVuY2UuXG4gICAgICAgIHJldHVybiB5aS5yZXNvbHZlKFtdKTtcbiAgICB9XG4gICAgZ2V0TmV4dENvbGxlY3Rpb25Hcm91cFRvVXBkYXRlKHQpIHtcbiAgICAgICAgLy8gRmllbGQgaW5kaWNlcyBhcmUgbm90IHN1cHBvcnRlZCB3aXRoIG1lbW9yeSBwZXJzaXN0ZW5jZS5cbiAgICAgICAgcmV0dXJuIHlpLnJlc29sdmUobnVsbCk7XG4gICAgfVxuICAgIGdldE1pbk9mZnNldCh0LCBlKSB7XG4gICAgICAgIHJldHVybiB5aS5yZXNvbHZlKGhlLm1pbigpKTtcbiAgICB9XG4gICAgdXBkYXRlQ29sbGVjdGlvbkdyb3VwKHQsIGUsIG4pIHtcbiAgICAgICAgLy8gRmllbGQgaW5kaWNlcyBhcmUgbm90IHN1cHBvcnRlZCB3aXRoIG1lbW9yeSBwZXJzaXN0ZW5jZS5cbiAgICAgICAgcmV0dXJuIHlpLnJlc29sdmUoKTtcbiAgICB9XG4gICAgdXBkYXRlSW5kZXhFbnRyaWVzKHQsIGUpIHtcbiAgICAgICAgLy8gRmllbGQgaW5kaWNlcyBhcmUgbm90IHN1cHBvcnRlZCB3aXRoIG1lbW9yeSBwZXJzaXN0ZW5jZS5cbiAgICAgICAgcmV0dXJuIHlpLnJlc29sdmUoKTtcbiAgICB9XG59XG5cbi8qKlxuICogSW50ZXJuYWwgaW1wbGVtZW50YXRpb24gb2YgdGhlIGNvbGxlY3Rpb24tcGFyZW50IGluZGV4IGV4cG9zZWQgYnkgTWVtb3J5SW5kZXhNYW5hZ2VyLlxuICogQWxzbyB1c2VkIGZvciBpbi1tZW1vcnkgY2FjaGluZyBieSBJbmRleGVkRGJJbmRleE1hbmFnZXIgYW5kIGluaXRpYWwgaW5kZXggcG9wdWxhdGlvblxuICogaW4gaW5kZXhlZGRiX3NjaGVtYS50c1xuICovIGNsYXNzIGNyIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5pbmRleCA9IHt9O1xuICAgIH1cbiAgICAvLyBSZXR1cm5zIGZhbHNlIGlmIHRoZSBlbnRyeSBhbHJlYWR5IGV4aXN0ZWQuXG4gICAgYWRkKHQpIHtcbiAgICAgICAgY29uc3QgZSA9IHQubGFzdFNlZ21lbnQoKSwgbiA9IHQucG9wTGFzdCgpLCBzID0gdGhpcy5pbmRleFtlXSB8fCBuZXcgd2UoX3QuY29tcGFyYXRvciksIGkgPSAhcy5oYXMobik7XG4gICAgICAgIHJldHVybiB0aGlzLmluZGV4W2VdID0gcy5hZGQobiksIGk7XG4gICAgfVxuICAgIGhhcyh0KSB7XG4gICAgICAgIGNvbnN0IGUgPSB0Lmxhc3RTZWdtZW50KCksIG4gPSB0LnBvcExhc3QoKSwgcyA9IHRoaXMuaW5kZXhbZV07XG4gICAgICAgIHJldHVybiBzICYmIHMuaGFzKG4pO1xuICAgIH1cbiAgICBnZXRFbnRyaWVzKHQpIHtcbiAgICAgICAgcmV0dXJuICh0aGlzLmluZGV4W3RdIHx8IG5ldyB3ZShfdC5jb21wYXJhdG9yKSkudG9BcnJheSgpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi8gY29uc3QgaHIgPSBuZXcgVWludDhBcnJheSgwKTtcblxuLyoqXG4gKiBBIHBlcnNpc3RlZCBpbXBsZW1lbnRhdGlvbiBvZiBJbmRleE1hbmFnZXIuXG4gKlxuICogUE9SVElORyBOT1RFOiBVbmxpa2UgaU9TIGFuZCBBbmRyb2lkLCB0aGUgV2ViIFNESyBkb2VzIG5vdCBtZW1vaXplIGluZGV4XG4gKiBkYXRhIGFzIGl0IHN1cHBvcnRzIG11bHRpLXRhYiBhY2Nlc3MuXG4gKi9cbmNsYXNzIGxyIHtcbiAgICBjb25zdHJ1Y3Rvcih0LCBlKSB7XG4gICAgICAgIHRoaXMudXNlciA9IHQsIHRoaXMuZGF0YWJhc2VJZCA9IGUsIFxuICAgICAgICAvKipcbiAgICAgICAgICogQW4gaW4tbWVtb3J5IGNvcHkgb2YgdGhlIGluZGV4IGVudHJpZXMgd2UndmUgYWxyZWFkeSB3cml0dGVuIHNpbmNlIHRoZSBTREtcbiAgICAgICAgICogbGF1bmNoZWQuIFVzZWQgdG8gYXZvaWQgcmUtd3JpdGluZyB0aGUgc2FtZSBlbnRyeSByZXBlYXRlZGx5LlxuICAgICAgICAgKlxuICAgICAgICAgKiBUaGlzIGlzICpOT1QqIGEgY29tcGxldGUgY2FjaGUgb2Ygd2hhdCdzIGluIHBlcnNpc3RlbmNlIGFuZCBzbyBjYW4gbmV2ZXIgYmVcbiAgICAgICAgICogdXNlZCB0byBzYXRpc2Z5IHJlYWRzLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5LZSA9IG5ldyBjciwgXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBNYXBzIGZyb20gYSB0YXJnZXQgdG8gaXRzIGVxdWl2YWxlbnQgbGlzdCBvZiBzdWItdGFyZ2V0cy4gRWFjaCBzdWItdGFyZ2V0XG4gICAgICAgICAqIGNvbnRhaW5zIG9ubHkgb25lIHRlcm0gZnJvbSB0aGUgdGFyZ2V0J3MgZGlzanVuY3RpdmUgbm9ybWFsIGZvcm0gKERORikuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLkdlID0gbmV3IEtuKCh0ID0+IEllKHQpKSwgKCh0LCBlKSA9PiBFZSh0LCBlKSkpLCB0aGlzLnVpZCA9IHQudWlkIHx8IFwiXCI7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEFkZHMgYSBuZXcgZW50cnkgdG8gdGhlIGNvbGxlY3Rpb24gcGFyZW50IGluZGV4LlxuICAgICAqXG4gICAgICogUmVwZWF0ZWQgY2FsbHMgZm9yIHRoZSBzYW1lIGNvbGxlY3Rpb25QYXRoIHNob3VsZCBiZSBhdm9pZGVkIHdpdGhpbiBhXG4gICAgICogdHJhbnNhY3Rpb24gYXMgSW5kZXhlZERiSW5kZXhNYW5hZ2VyIG9ubHkgY2FjaGVzIHdyaXRlcyBvbmNlIGEgdHJhbnNhY3Rpb25cbiAgICAgKiBoYXMgYmVlbiBjb21taXR0ZWQuXG4gICAgICovICAgIGFkZFRvQ29sbGVjdGlvblBhcmVudEluZGV4KHQsIGUpIHtcbiAgICAgICAgaWYgKCF0aGlzLktlLmhhcyhlKSkge1xuICAgICAgICAgICAgY29uc3QgbiA9IGUubGFzdFNlZ21lbnQoKSwgcyA9IGUucG9wTGFzdCgpO1xuICAgICAgICAgICAgdC5hZGRPbkNvbW1pdHRlZExpc3RlbmVyKCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgLy8gQWRkIHRoZSBjb2xsZWN0aW9uIHRvIHRoZSBpbiBtZW1vcnkgY2FjaGUgb25seSBpZiB0aGUgdHJhbnNhY3Rpb24gd2FzXG4gICAgICAgICAgICAgICAgLy8gc3VjY2Vzc2Z1bGx5IGNvbW1pdHRlZC5cbiAgICAgICAgICAgICAgICB0aGlzLktlLmFkZChlKTtcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgIGNvbnN0IGkgPSB7XG4gICAgICAgICAgICAgICAgY29sbGVjdGlvbklkOiBuLFxuICAgICAgICAgICAgICAgIHBhcmVudDogR3MocylcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICByZXR1cm4gZnIodCkucHV0KGkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB5aS5yZXNvbHZlKCk7XG4gICAgfVxuICAgIGdldENvbGxlY3Rpb25QYXJlbnRzKHQsIGUpIHtcbiAgICAgICAgY29uc3QgbiA9IFtdLCBzID0gSURCS2V5UmFuZ2UuYm91bmQoWyBlLCBcIlwiIF0sIFsgdXQoZSksIFwiXCIgXSwgXG4gICAgICAgIC8qbG93ZXJPcGVuPSovICExLCBcbiAgICAgICAgLyp1cHBlck9wZW49Ki8gITApO1xuICAgICAgICByZXR1cm4gZnIodCkucXQocykubmV4dCgodCA9PiB7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IHMgb2YgdCkge1xuICAgICAgICAgICAgICAgIC8vIFRoaXMgY29sbGVjdGlvbklkIGd1YXJkIHNob3VsZG4ndCBiZSBuZWNlc3NhcnkgKGFuZCBpc24ndCBhcyBsb25nXG4gICAgICAgICAgICAgICAgLy8gYXMgd2UncmUgcnVubmluZyBpbiBhIHJlYWwgYnJvd3NlciksIGJ1dCB0aGVyZSdzIGEgYnVnIGluXG4gICAgICAgICAgICAgICAgLy8gaW5kZXhlZGRic2hpbSB0aGF0IGJyZWFrcyBvdXIgcmFuZ2UgaW4gb3VyIHRlc3RzIHJ1bm5pbmcgaW4gbm9kZTpcbiAgICAgICAgICAgICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vYXhlbWNsaW9uL0luZGV4ZWREQlNoaW0vaXNzdWVzLzMzNFxuICAgICAgICAgICAgICAgIGlmIChzLmNvbGxlY3Rpb25JZCAhPT0gZSkgYnJlYWs7XG4gICAgICAgICAgICAgICAgbi5wdXNoKFdzKHMucGFyZW50KSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbjtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICBhZGRGaWVsZEluZGV4KHQsIGUpIHtcbiAgICAgICAgLy8gVE9ETyhpbmRleGluZyk6IFZlcmlmeSB0aGF0IHRoZSBhdXRvLWluY3JlbWVudGluZyBpbmRleCBJRCB3b3JrcyBpblxuICAgICAgICAvLyBTYWZhcmkgJiBGaXJlZm94LlxuICAgICAgICBjb25zdCBuID0gX3IodCksIHMgPSBmdW5jdGlvbih0KSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGluZGV4SWQ6IHQuaW5kZXhJZCxcbiAgICAgICAgICAgICAgICBjb2xsZWN0aW9uR3JvdXA6IHQuY29sbGVjdGlvbkdyb3VwLFxuICAgICAgICAgICAgICAgIGZpZWxkczogdC5maWVsZHMubWFwKCh0ID0+IFsgdC5maWVsZFBhdGguY2Fub25pY2FsU3RyaW5nKCksIHQua2luZCBdKSlcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0oZSk7XG4gICAgICAgIC8vIGBpbmRleElkYCBpcyBhdXRvLXBvcHVsYXRlZCBieSBJbmRleGVkRGJcbiAgICAgICAgcmV0dXJuIGRlbGV0ZSBzLmluZGV4SWQsIG4uYWRkKHMpLm5leHQoKTtcbiAgICB9XG4gICAgZGVsZXRlRmllbGRJbmRleCh0LCBlKSB7XG4gICAgICAgIGNvbnN0IG4gPSBfcih0KSwgcyA9IHdyKHQpLCBpID0gZHIodCk7XG4gICAgICAgIHJldHVybiBuLmRlbGV0ZShlLmluZGV4SWQpLm5leHQoKCgpID0+IHMuZGVsZXRlKElEQktleVJhbmdlLmJvdW5kKFsgZS5pbmRleElkIF0sIFsgZS5pbmRleElkICsgMSBdLCBcbiAgICAgICAgLypsb3dlck9wZW49Ki8gITEsIFxuICAgICAgICAvKnVwcGVyT3Blbj0qLyAhMCkpKSkubmV4dCgoKCkgPT4gaS5kZWxldGUoSURCS2V5UmFuZ2UuYm91bmQoWyBlLmluZGV4SWQgXSwgWyBlLmluZGV4SWQgKyAxIF0sIFxuICAgICAgICAvKmxvd2VyT3Blbj0qLyAhMSwgXG4gICAgICAgIC8qdXBwZXJPcGVuPSovICEwKSkpKTtcbiAgICB9XG4gICAgZ2V0RG9jdW1lbnRzTWF0Y2hpbmdUYXJnZXQodCwgZSkge1xuICAgICAgICBjb25zdCBuID0gZHIodCk7XG4gICAgICAgIGxldCBzID0gITA7XG4gICAgICAgIGNvbnN0IGkgPSBuZXcgTWFwO1xuICAgICAgICByZXR1cm4geWkuZm9yRWFjaCh0aGlzLlFlKGUpLCAoZSA9PiB0aGlzLmplKHQsIGUpLm5leHQoKHQgPT4ge1xuICAgICAgICAgICAgcyAmJiAocyA9ICEhdCksIGkuc2V0KGUsIHQpO1xuICAgICAgICB9KSkpKS5uZXh0KCgoKSA9PiB7XG4gICAgICAgICAgICBpZiAocykge1xuICAgICAgICAgICAgICAgIGxldCB0ID0gWW4oKTtcbiAgICAgICAgICAgICAgICBjb25zdCBzID0gW107XG4gICAgICAgICAgICAgICAgcmV0dXJuIHlpLmZvckVhY2goaSwgKChpLCByKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIC8qKiBSZXR1cm5zIGEgZGVidWcgcmVwcmVzZW50YXRpb24gb2YgdGhlIGZpZWxkIGluZGV4ICovXG4gICAgICAgICAgICAgICAgICAgIHZhciBvO1xuICAgICAgICAgICAgICAgICAgICBPKFwiSW5kZXhlZERiSW5kZXhNYW5hZ2VyXCIsIGBVc2luZyBpbmRleCAke28gPSBpLCBgaWQ9JHtvLmluZGV4SWR9fGNnPSR7by5jb2xsZWN0aW9uR3JvdXB9fGY9JHtvLmZpZWxkcy5tYXAoKHQgPT4gYCR7dC5maWVsZFBhdGh9OiR7dC5raW5kfWApKS5qb2luKFwiLFwiKX1gfSB0byBleGVjdXRlICR7SWUoZSl9YCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHUgPSBmdW5jdGlvbih0LCBlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBuID0gaWUoZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodm9pZCAwID09PSBuKSByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgZSBvZiBSZSh0LCBuLmZpZWxkUGF0aCkpIHN3aXRjaCAoZS5vcCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiYXJyYXktY29udGFpbnMtYW55XCIgLyogQVJSQVlfQ09OVEFJTlNfQU5ZICovIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZS52YWx1ZS5hcnJheVZhbHVlLnZhbHVlcyB8fCBbXTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiYXJyYXktY29udGFpbnNcIiAvKiBBUlJBWV9DT05UQUlOUyAqLyA6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsgZS52YWx1ZSBdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJlbWFpbmluZyBmaWx0ZXJzIGFyZSBub3QgYXJyYXkgZmlsdGVycy5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8qKlxuICogUmV0dXJucyB0aGUgbGlzdCBvZiB2YWx1ZXMgdGhhdCBhcmUgdXNlZCBpbiAhPSBvciBOT1RfSU4gZmlsdGVycy4gUmV0dXJuc1xuICogYG51bGxgIGlmIHRoZXJlIGFyZSBubyBzdWNoIGZpbHRlcnMuXG4gKi8gKHIsIGkpLCBhID0gZnVuY3Rpb24odCwgZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbiA9IG5ldyBNYXA7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHMgb2YgcmUoZSkpIGZvciAoY29uc3QgZSBvZiBSZSh0LCBzLmZpZWxkUGF0aCkpIHN3aXRjaCAoZS5vcCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiPT1cIiAvKiBFUVVBTCAqLyA6XG4gICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJpblwiIC8qIElOICovIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBFbmNvZGUgZXF1YWxpdHkgcHJlZml4LCB3aGljaCBpcyBlbmNvZGVkIGluIHRoZSBpbmRleCB2YWx1ZSBiZWZvcmVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGUgaW5lcXVhbGl0eSAoZS5nLiBgYSA9PSAnYScgJiYgYiAhPSAnYidgIGlzIGVuY29kZWQgdG9cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBgdmFsdWUgIT0gJ2FiJ2ApLlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG4uc2V0KHMuZmllbGRQYXRoLmNhbm9uaWNhbFN0cmluZygpLCBlLnZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwibm90LWluXCIgLyogTk9UX0lOICovIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcIiE9XCIgLyogTk9UX0VRVUFMICovIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBOb3RJbi9Ob3RFcXVhbCBpcyBhbHdheXMgYSBzdWZmaXguIFRoZXJlIGNhbm5vdCBiZSBhbnkgcmVtYWluaW5nXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gc2VnbWVudHMgYW5kIGhlbmNlIHdlIGNhbiByZXR1cm4gZWFybHkgaGVyZS5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbi5zZXQocy5maWVsZFBhdGguY2Fub25pY2FsU3RyaW5nKCksIGUudmFsdWUpLCBBcnJheS5mcm9tKG4udmFsdWVzKCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJlbWFpbmluZyBmaWx0ZXJzIGNhbm5vdCBiZSB1c2VkIGFzIG5vdEluIGJvdW5kcy5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8qKlxuICogUmV0dXJucyBhIGxvd2VyIGJvdW5kIG9mIGZpZWxkIHZhbHVlcyB0aGF0IGNhbiBiZSB1c2VkIGFzIGEgc3RhcnRpbmcgcG9pbnQgdG9cbiAqIHNjYW4gdGhlIGluZGV4IGRlZmluZWQgYnkgYGZpZWxkSW5kZXhgLiBSZXR1cm5zIGBNSU5fVkFMVUVgIGlmIG5vIGxvd2VyIGJvdW5kXG4gKiBleGlzdHMuXG4gKi8gKHIsIGkpLCBjID0gZnVuY3Rpb24odCwgZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbiA9IFtdO1xuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHMgPSAhMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZvciBlYWNoIHNlZ21lbnQsIHJldHJpZXZlIGEgbG93ZXIgYm91bmQgaWYgdGhlcmUgaXMgYSBzdWl0YWJsZSBmaWx0ZXIgb3JcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHN0YXJ0QXQuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGkgb2YgcmUoZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBlID0gMCAvKiBBU0NFTkRJTkcgKi8gPT09IGkua2luZCA/IGJlKHQsIGkuZmllbGRQYXRoLCB0LnN0YXJ0QXQpIDogUGUodCwgaS5maWVsZFBhdGgsIHQuc3RhcnRBdCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbi5wdXNoKGUudmFsdWUpLCBzICYmIChzID0gZS5pbmNsdXNpdmUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBPZShuLCBzKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAvKipcbiAqIFJldHVybnMgYW4gdXBwZXIgYm91bmQgb2YgZmllbGQgdmFsdWVzIHRoYXQgY2FuIGJlIHVzZWQgYXMgYW4gZW5kaW5nIHBvaW50XG4gKiB3aGVuIHNjYW5uaW5nIHRoZSBpbmRleCBkZWZpbmVkIGJ5IGBmaWVsZEluZGV4YC4gUmV0dXJucyBgTUFYX1ZBTFVFYCBpZiBub1xuICogdXBwZXIgYm91bmQgZXhpc3RzLlxuICovIChyLCBpKSwgaCA9IGZ1bmN0aW9uKHQsIGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG4gPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBzID0gITA7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBGb3IgZWFjaCBzZWdtZW50LCByZXRyaWV2ZSBhbiB1cHBlciBib3VuZCBpZiB0aGVyZSBpcyBhIHN1aXRhYmxlIGZpbHRlciBvclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gZW5kQXQuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGkgb2YgcmUoZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBlID0gMCAvKiBBU0NFTkRJTkcgKi8gPT09IGkua2luZCA/IFBlKHQsIGkuZmllbGRQYXRoLCB0LmVuZEF0KSA6IGJlKHQsIGkuZmllbGRQYXRoLCB0LmVuZEF0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuLnB1c2goZS52YWx1ZSksIHMgJiYgKHMgPSBlLmluY2x1c2l2ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IE9lKG4sIHMpO1xuICAgICAgICAgICAgICAgICAgICB9KHIsIGkpLCBsID0gdGhpcy5XZShpLCByLCBjKSwgZiA9IHRoaXMuV2UoaSwgciwgaCksIGQgPSB0aGlzLnplKGksIHIsIGEpLCBfID0gdGhpcy5IZShpLmluZGV4SWQsIHUsIGwsIGMuaW5jbHVzaXZlLCBmLCBoLmluY2x1c2l2ZSwgZCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB5aS5mb3JFYWNoKF8sIChpID0+IG4uR3QoaSwgZS5saW1pdCkubmV4dCgoZSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlLmZvckVhY2goKGUgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG4gPSB4dC5mcm9tU2VnbWVudHMoZS5kb2N1bWVudEtleSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdC5oYXMobikgfHwgKHQgPSB0LmFkZChuKSwgcy5wdXNoKG4pKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgICAgICAgICAgfSkpKSk7XG4gICAgICAgICAgICAgICAgfSkpLm5leHQoKCgpID0+IHMpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB5aS5yZXNvbHZlKG51bGwpO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIFFlKHQpIHtcbiAgICAgICAgbGV0IGUgPSB0aGlzLkdlLmdldCh0KTtcbiAgICAgICAgcmV0dXJuIGUgfHwgKFxuICAgICAgICAvLyBUT0RPKG9ycXVlcnkpOiBJbXBsZW1lbnQgRE5GIHRyYW5zZm9ybVxuICAgICAgICBlID0gWyB0IF0sIHRoaXMuR2Uuc2V0KHQsIGUpLCBlKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ29uc3RydWN0cyBhIGtleSByYW5nZSBxdWVyeSBvbiBgRGJJbmRleEVudHJ5U3RvcmVgIHRoYXQgdW5pb25zIGFsbFxuICAgICAqIGJvdW5kcy5cbiAgICAgKi8gICAgSGUodCwgZSwgbiwgcywgaSwgciwgbykge1xuICAgICAgICAvLyBUaGUgbnVtYmVyIG9mIHRvdGFsIGluZGV4IHNjYW5zIHdlIHVuaW9uIHRvZ2V0aGVyLiBUaGlzIGlzIHNpbWlsYXIgdG8gYVxuICAgICAgICAvLyBkaXN0cmlidXRlZCBub3JtYWwgZm9ybSwgYnV0IGFkYXB0ZWQgZm9yIGFycmF5IHZhbHVlcy4gV2UgY3JlYXRlIGEgc2luZ2xlXG4gICAgICAgIC8vIGluZGV4IHJhbmdlIHBlciB2YWx1ZSBpbiBhbiBBUlJBWV9DT05UQUlOUyBvciBBUlJBWV9DT05UQUlOU19BTlkgZmlsdGVyXG4gICAgICAgIC8vIGNvbWJpbmVkIHdpdGggdGhlIHZhbHVlcyBmcm9tIHRoZSBxdWVyeSBib3VuZHMuXG4gICAgICAgIGNvbnN0IHUgPSAobnVsbCAhPSBlID8gZS5sZW5ndGggOiAxKSAqIE1hdGgubWF4KG4ubGVuZ3RoLCBpLmxlbmd0aCksIGEgPSB1IC8gKG51bGwgIT0gZSA/IGUubGVuZ3RoIDogMSksIGMgPSBbXTtcbiAgICAgICAgZm9yIChsZXQgaCA9IDA7IGggPCB1OyArK2gpIHtcbiAgICAgICAgICAgIGNvbnN0IHUgPSBlID8gdGhpcy5KZShlW2ggLyBhXSkgOiBociwgbCA9IHRoaXMuWWUodCwgdSwgbltoICUgYV0sIHMpLCBmID0gdGhpcy5YZSh0LCB1LCBpW2ggJSBhXSwgciksIGQgPSBvLm1hcCgoZSA9PiB0aGlzLlllKHQsIHUsIGUsIFxuICAgICAgICAgICAgLyogaW5jbHVzaXZlPSAqLyAhMCkpKTtcbiAgICAgICAgICAgIGMucHVzaCguLi50aGlzLmNyZWF0ZVJhbmdlKGwsIGYsIGQpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYztcbiAgICB9XG4gICAgLyoqIEdlbmVyYXRlcyB0aGUgbG93ZXIgYm91bmQgZm9yIGBhcnJheVZhbHVlYCBhbmQgYGRpcmVjdGlvbmFsVmFsdWVgLiAqLyAgICBZZSh0LCBlLCBuLCBzKSB7XG4gICAgICAgIGNvbnN0IGkgPSBuZXcgaXIodCwgeHQuZW1wdHkoKSwgZSwgbik7XG4gICAgICAgIHJldHVybiBzID8gaSA6IGkua2UoKTtcbiAgICB9XG4gICAgLyoqIEdlbmVyYXRlcyB0aGUgdXBwZXIgYm91bmQgZm9yIGBhcnJheVZhbHVlYCBhbmQgYGRpcmVjdGlvbmFsVmFsdWVgLiAqLyAgICBYZSh0LCBlLCBuLCBzKSB7XG4gICAgICAgIGNvbnN0IGkgPSBuZXcgaXIodCwgeHQuZW1wdHkoKSwgZSwgbik7XG4gICAgICAgIHJldHVybiBzID8gaS5rZSgpIDogaTtcbiAgICB9XG4gICAgamUodCwgZSkge1xuICAgICAgICBjb25zdCBuID0gbmV3IHVyKGUpLCBzID0gbnVsbCAhPSBlLmNvbGxlY3Rpb25Hcm91cCA/IGUuY29sbGVjdGlvbkdyb3VwIDogZS5wYXRoLmxhc3RTZWdtZW50KCk7XG4gICAgICAgIHJldHVybiB0aGlzLmdldEZpZWxkSW5kZXhlcyh0LCBzKS5uZXh0KCh0ID0+IHtcbiAgICAgICAgICAgIC8vIFJldHVybiB0aGUgaW5kZXggd2l0aCB0aGUgbW9zdCBudW1iZXIgb2Ygc2VnbWVudHMuXG4gICAgICAgICAgICBsZXQgZSA9IG51bGw7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IHMgb2YgdCkge1xuICAgICAgICAgICAgICAgIG4uJGUocykgJiYgKCFlIHx8IHMuZmllbGRzLmxlbmd0aCA+IGUuZmllbGRzLmxlbmd0aCkgJiYgKGUgPSBzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBlO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIGdldEluZGV4VHlwZSh0LCBlKSB7XG4gICAgICAgIGxldCBuID0gMiAvKiBGVUxMICovO1xuICAgICAgICByZXR1cm4geWkuZm9yRWFjaCh0aGlzLlFlKGUpLCAoZSA9PiB0aGlzLmplKHQsIGUpLm5leHQoKHQgPT4ge1xuICAgICAgICAgICAgdCA/IDAgLyogTk9ORSAqLyAhPT0gbiAmJiB0LmZpZWxkcy5sZW5ndGggPCBmdW5jdGlvbih0KSB7XG4gICAgICAgICAgICAgICAgbGV0IGUgPSBuZXcgd2UobXQuY29tcGFyYXRvciksIG4gPSAhMTtcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHMgb2YgdC5maWx0ZXJzKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFRPRE8ob3JxdWVyeSk6IFVzZSB0aGUgZmxhdHRlbmVkIGZpbHRlcnMgaGVyZVxuICAgICAgICAgICAgICAgICAgICBjb25zdCB0ID0gcztcbiAgICAgICAgICAgICAgICAgICAgLy8gX19uYW1lX18gaXMgbm90IGFuIGV4cGxpY2l0IHNlZ21lbnQgb2YgYW55IGluZGV4LCBzbyB3ZSBkb24ndCBuZWVkIHRvXG4gICAgICAgICAgICAgICAgICAgIC8vIGNvdW50IGl0LlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQuZmllbGQuaXNLZXlGaWVsZCgpIHx8IChcbiAgICAgICAgICAgICAgICAgICAgLy8gQVJSQVlfQ09OVEFJTlMgb3IgQVJSQVlfQ09OVEFJTlNfQU5ZIGZpbHRlcnMgbXVzdCBiZSBjb3VudGVkIHNlcGFyYXRlbHkuXG4gICAgICAgICAgICAgICAgICAgIC8vIEZvciBpbnN0YW5jZSwgaXQgaXMgcG9zc2libGUgdG8gaGF2ZSBhbiBpbmRleCBmb3IgXCJhIEFSUkFZIGEgQVNDXCIuIEV2ZW5cbiAgICAgICAgICAgICAgICAgICAgLy8gdGhvdWdoIHRoZXNlIGFyZSBvbiB0aGUgc2FtZSBmaWVsZCwgdGhleSBzaG91bGQgYmUgY291bnRlZCBhcyB0d29cbiAgICAgICAgICAgICAgICAgICAgLy8gc2VwYXJhdGUgc2VnbWVudHMgaW4gYW4gaW5kZXguXG4gICAgICAgICAgICAgICAgICAgIFwiYXJyYXktY29udGFpbnNcIiAvKiBBUlJBWV9DT05UQUlOUyAqLyA9PT0gdC5vcCB8fCBcImFycmF5LWNvbnRhaW5zLWFueVwiIC8qIEFSUkFZX0NPTlRBSU5TX0FOWSAqLyA9PT0gdC5vcCA/IG4gPSAhMCA6IGUgPSBlLmFkZCh0LmZpZWxkKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgbiBvZiB0Lm9yZGVyQnkpIFxuICAgICAgICAgICAgICAgIC8vIF9fbmFtZV9fIGlzIG5vdCBhbiBleHBsaWNpdCBzZWdtZW50IG9mIGFueSBpbmRleCwgc28gd2UgZG9uJ3QgbmVlZCB0b1xuICAgICAgICAgICAgICAgIC8vIGNvdW50IGl0LlxuICAgICAgICAgICAgICAgIG4uZmllbGQuaXNLZXlGaWVsZCgpIHx8IChlID0gZS5hZGQobi5maWVsZCkpO1xuICAgICAgICAgICAgICAgIHJldHVybiBlLnNpemUgKyAobiA/IDEgOiAwKTtcbiAgICAgICAgICAgIH0oZSkgJiYgKG4gPSAxIC8qIFBBUlRJQUwgKi8pIDogbiA9IDAgLyogTk9ORSAqLztcbiAgICAgICAgfSkpKSkubmV4dCgoKCkgPT4gbikpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRoZSBieXRlIGVuY29kZWQgZm9ybSBvZiB0aGUgZGlyZWN0aW9uYWwgdmFsdWVzIGluIHRoZSBmaWVsZCBpbmRleC5cbiAgICAgKiBSZXR1cm5zIGBudWxsYCBpZiB0aGUgZG9jdW1lbnQgZG9lcyBub3QgaGF2ZSBhbGwgZmllbGRzIHNwZWNpZmllZCBpbiB0aGVcbiAgICAgKiBpbmRleC5cbiAgICAgKi8gICAgWmUodCwgZSkge1xuICAgICAgICBjb25zdCBuID0gbmV3IHNyO1xuICAgICAgICBmb3IgKGNvbnN0IHMgb2YgcmUodCkpIHtcbiAgICAgICAgICAgIGNvbnN0IHQgPSBlLmRhdGEuZmllbGQocy5maWVsZFBhdGgpO1xuICAgICAgICAgICAgaWYgKG51bGwgPT0gdCkgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICBjb25zdCBpID0gbi5OZShzLmtpbmQpO1xuICAgICAgICAgICAgWWkuZmUuWnQodCwgaSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG4uU2UoKTtcbiAgICB9XG4gICAgLyoqIEVuY29kZXMgYSBzaW5nbGUgdmFsdWUgdG8gdGhlIGFzY2VuZGluZyBpbmRleCBmb3JtYXQuICovICAgIEplKHQpIHtcbiAgICAgICAgY29uc3QgZSA9IG5ldyBzcjtcbiAgICAgICAgcmV0dXJuIFlpLmZlLlp0KHQsIGUuTmUoMCAvKiBBU0NFTkRJTkcgKi8pKSwgZS5TZSgpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIGFuIGVuY29kZWQgZm9ybSBvZiB0aGUgZG9jdW1lbnQga2V5IHRoYXQgc29ydHMgYmFzZWQgb24gdGhlIGtleVxuICAgICAqIG9yZGVyaW5nIG9mIHRoZSBmaWVsZCBpbmRleC5cbiAgICAgKi8gICAgdG4odCwgZSkge1xuICAgICAgICBjb25zdCBuID0gbmV3IHNyO1xuICAgICAgICByZXR1cm4gWWkuZmUuWnQocXQodGhpcy5kYXRhYmFzZUlkLCBlKSwgbi5OZShmdW5jdGlvbih0KSB7XG4gICAgICAgICAgICBjb25zdCBlID0gcmUodCk7XG4gICAgICAgICAgICByZXR1cm4gMCA9PT0gZS5sZW5ndGggPyAwIC8qIEFTQ0VORElORyAqLyA6IGVbZS5sZW5ndGggLSAxXS5raW5kO1xuICAgICAgICB9KHQpKSksIG4uU2UoKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRW5jb2RlcyB0aGUgZ2l2ZW4gZmllbGQgdmFsdWVzIGFjY29yZGluZyB0byB0aGUgc3BlY2lmaWNhdGlvbiBpbiBgdGFyZ2V0YC5cbiAgICAgKiBGb3IgSU4gcXVlcmllcywgYSBsaXN0IG9mIHBvc3NpYmxlIHZhbHVlcyBpcyByZXR1cm5lZC5cbiAgICAgKi8gICAgemUodCwgZSwgbikge1xuICAgICAgICBpZiAobnVsbCA9PT0gbikgcmV0dXJuIFtdO1xuICAgICAgICBsZXQgcyA9IFtdO1xuICAgICAgICBzLnB1c2gobmV3IHNyKTtcbiAgICAgICAgbGV0IGkgPSAwO1xuICAgICAgICBmb3IgKGNvbnN0IHIgb2YgcmUodCkpIHtcbiAgICAgICAgICAgIGNvbnN0IHQgPSBuW2krK107XG4gICAgICAgICAgICBmb3IgKGNvbnN0IG4gb2YgcykgaWYgKHRoaXMuZW4oZSwgci5maWVsZFBhdGgpICYmIEd0KHQpKSBzID0gdGhpcy5ubihzLCByLCB0KTsgZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZSA9IG4uTmUoci5raW5kKTtcbiAgICAgICAgICAgICAgICBZaS5mZS5adCh0LCBlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5zbihzKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRW5jb2RlcyB0aGUgZ2l2ZW4gYm91bmRzIGFjY29yZGluZyB0byB0aGUgc3BlY2lmaWNhdGlvbiBpbiBgdGFyZ2V0YC4gRm9yIElOXG4gICAgICogcXVlcmllcywgYSBsaXN0IG9mIHBvc3NpYmxlIHZhbHVlcyBpcyByZXR1cm5lZC5cbiAgICAgKi8gICAgV2UodCwgZSwgbikge1xuICAgICAgICByZXR1cm4gdGhpcy56ZSh0LCBlLCBuLnBvc2l0aW9uKTtcbiAgICB9XG4gICAgLyoqIFJldHVybnMgdGhlIGJ5dGUgcmVwcmVzZW50YXRpb24gZm9yIHRoZSBwcm92aWRlZCBlbmNvZGVycy4gKi8gICAgc24odCkge1xuICAgICAgICBjb25zdCBlID0gW107XG4gICAgICAgIGZvciAobGV0IG4gPSAwOyBuIDwgdC5sZW5ndGg7ICsrbikgZVtuXSA9IHRbbl0uU2UoKTtcbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBzZXBhcmF0ZSBlbmNvZGVyIGZvciBlYWNoIGVsZW1lbnQgb2YgYW4gYXJyYXkuXG4gICAgICpcbiAgICAgKiBUaGUgbWV0aG9kIGFwcGVuZHMgZWFjaCB2YWx1ZSB0byBhbGwgZXhpc3RpbmcgZW5jb2RlcnMgKGUuZy4gZmlsdGVyKFwiYVwiLFxuICAgICAqIFwiPT1cIiwgXCJhMVwiKS5maWx0ZXIoXCJiXCIsIFwiaW5cIiwgW1wiYjFcIiwgXCJiMlwiXSkgYmVjb21lcyBbXCJhMSxiMVwiLCBcImExLGIyXCJdKS4gQVxuICAgICAqIGxpc3Qgb2YgbmV3IGVuY29kZXJzIGlzIHJldHVybmVkLlxuICAgICAqLyAgICBubih0LCBlLCBuKSB7XG4gICAgICAgIGNvbnN0IHMgPSBbIC4uLnQgXSwgaSA9IFtdO1xuICAgICAgICBmb3IgKGNvbnN0IHQgb2Ygbi5hcnJheVZhbHVlLnZhbHVlcyB8fCBbXSkgZm9yIChjb25zdCBuIG9mIHMpIHtcbiAgICAgICAgICAgIGNvbnN0IHMgPSBuZXcgc3I7XG4gICAgICAgICAgICBzLnNlZWQobi5TZSgpKSwgWWkuZmUuWnQodCwgcy5OZShlLmtpbmQpKSwgaS5wdXNoKHMpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBpO1xuICAgIH1cbiAgICBlbih0LCBlKSB7XG4gICAgICAgIHJldHVybiAhIXQuZmlsdGVycy5maW5kKCh0ID0+IHQgaW5zdGFuY2VvZiBWZSAmJiB0LmZpZWxkLmlzRXF1YWwoZSkgJiYgKFwiaW5cIiAvKiBJTiAqLyA9PT0gdC5vcCB8fCBcIm5vdC1pblwiIC8qIE5PVF9JTiAqLyA9PT0gdC5vcCkpKTtcbiAgICB9XG4gICAgZ2V0RmllbGRJbmRleGVzKHQsIGUpIHtcbiAgICAgICAgY29uc3QgbiA9IF9yKHQpLCBzID0gd3IodCk7XG4gICAgICAgIHJldHVybiAoZSA/IG4ucXQoXCJjb2xsZWN0aW9uR3JvdXBJbmRleFwiLCBJREJLZXlSYW5nZS5ib3VuZChlLCBlKSkgOiBuLnF0KCkpLm5leHQoKHQgPT4ge1xuICAgICAgICAgICAgY29uc3QgZSA9IFtdO1xuICAgICAgICAgICAgcmV0dXJuIHlpLmZvckVhY2godCwgKHQgPT4gcy5nZXQoWyB0LmluZGV4SWQsIHRoaXMudWlkIF0pLm5leHQoKG4gPT4ge1xuICAgICAgICAgICAgICAgIGUucHVzaChmdW5jdGlvbih0LCBlKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG4gPSBlID8gbmV3IHVlKGUuc2VxdWVuY2VOdW1iZXIsIG5ldyBoZShCaShlLnJlYWRUaW1lKSwgbmV3IHh0KFdzKGUuZG9jdW1lbnRLZXkpKSwgZS5sYXJnZXN0QmF0Y2hJZCkpIDogdWUuZW1wdHkoKSwgcyA9IHQuZmllbGRzLm1hcCgoKFt0LCBlXSkgPT4gbmV3IG9lKG10LmZyb21TZXJ2ZXJGb3JtYXQodCksIGUpKSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgc2UodC5pbmRleElkLCB0LmNvbGxlY3Rpb25Hcm91cCwgcywgbik7XG4gICAgICAgICAgICAgICAgfSh0LCBuKSk7XG4gICAgICAgICAgICB9KSkpKS5uZXh0KCgoKSA9PiBlKSk7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgZ2V0TmV4dENvbGxlY3Rpb25Hcm91cFRvVXBkYXRlKHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0RmllbGRJbmRleGVzKHQpLm5leHQoKHQgPT4gMCA9PT0gdC5sZW5ndGggPyBudWxsIDogKHQuc29ydCgoKHQsIGUpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSB0LmluZGV4U3RhdGUuc2VxdWVuY2VOdW1iZXIgLSBlLmluZGV4U3RhdGUuc2VxdWVuY2VOdW1iZXI7XG4gICAgICAgICAgICByZXR1cm4gMCAhPT0gbiA/IG4gOiBydCh0LmNvbGxlY3Rpb25Hcm91cCwgZS5jb2xsZWN0aW9uR3JvdXApO1xuICAgICAgICB9KSksIHRbMF0uY29sbGVjdGlvbkdyb3VwKSkpO1xuICAgIH1cbiAgICB1cGRhdGVDb2xsZWN0aW9uR3JvdXAodCwgZSwgbikge1xuICAgICAgICBjb25zdCBzID0gX3IodCksIGkgPSB3cih0KTtcbiAgICAgICAgcmV0dXJuIHRoaXMucm4odCkubmV4dCgodCA9PiBzLnF0KFwiY29sbGVjdGlvbkdyb3VwSW5kZXhcIiwgSURCS2V5UmFuZ2UuYm91bmQoZSwgZSkpLm5leHQoKGUgPT4geWkuZm9yRWFjaChlLCAoZSA9PiBpLnB1dChmdW5jdGlvbih0LCBlLCBuLCBzKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGluZGV4SWQ6IHQsXG4gICAgICAgICAgICAgICAgdWlkOiBlLnVpZCB8fCBcIlwiLFxuICAgICAgICAgICAgICAgIHNlcXVlbmNlTnVtYmVyOiBuLFxuICAgICAgICAgICAgICAgIHJlYWRUaW1lOiAkaShzLnJlYWRUaW1lKSxcbiAgICAgICAgICAgICAgICBkb2N1bWVudEtleTogR3Mocy5kb2N1bWVudEtleS5wYXRoKSxcbiAgICAgICAgICAgICAgICBsYXJnZXN0QmF0Y2hJZDogcy5sYXJnZXN0QmF0Y2hJZFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfShlLmluZGV4SWQsIHRoaXMudXNlciwgdCwgbikpKSkpKSkpO1xuICAgIH1cbiAgICB1cGRhdGVJbmRleEVudHJpZXModCwgZSkge1xuICAgICAgICAvLyBQb3J0aW5nIE5vdGU6IGBnZXRGaWVsZEluZGV4ZXMoKWAgb24gV2ViIGRvZXMgbm90IGNhY2hlIGluZGV4IGxvb2t1cHMgYXNcbiAgICAgICAgLy8gaXQgY291bGQgYmUgdXNlZCBhY3Jvc3MgZGlmZmVyZW50IEluZGV4ZWREQiB0cmFuc2FjdGlvbnMuIEFzIGFueSBjYWNoZWRcbiAgICAgICAgLy8gZGF0YSBtaWdodCBiZSBpbnZhbGlkYXRlZCBieSBvdGhlciBtdWx0aS10YWIgY2xpZW50cywgd2UgY2FuIG9ubHkgdHJ1c3RcbiAgICAgICAgLy8gZGF0YSB3aXRoaW4gYSBzaW5nbGUgSW5kZXhlZERCIHRyYW5zYWN0aW9uLiBXZSB0aGVyZWZvcmUgYWRkIGEgY2FjaGVcbiAgICAgICAgLy8gaGVyZS5cbiAgICAgICAgY29uc3QgbiA9IG5ldyBNYXA7XG4gICAgICAgIHJldHVybiB5aS5mb3JFYWNoKGUsICgoZSwgcykgPT4ge1xuICAgICAgICAgICAgY29uc3QgaSA9IG4uZ2V0KGUuY29sbGVjdGlvbkdyb3VwKTtcbiAgICAgICAgICAgIHJldHVybiAoaSA/IHlpLnJlc29sdmUoaSkgOiB0aGlzLmdldEZpZWxkSW5kZXhlcyh0LCBlLmNvbGxlY3Rpb25Hcm91cCkpLm5leHQoKGkgPT4gKG4uc2V0KGUuY29sbGVjdGlvbkdyb3VwLCBpKSwgXG4gICAgICAgICAgICB5aS5mb3JFYWNoKGksIChuID0+IHRoaXMub24odCwgZSwgbikubmV4dCgoZSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgaSA9IHRoaXMudW4ocywgbik7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGUuaXNFcXVhbChpKSA/IHlpLnJlc29sdmUoKSA6IHRoaXMuYW4odCwgcywgbiwgZSwgaSk7XG4gICAgICAgICAgICB9KSkpKSkpKTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICBjbih0LCBlLCBuLCBzKSB7XG4gICAgICAgIHJldHVybiBkcih0KS5wdXQoe1xuICAgICAgICAgICAgaW5kZXhJZDogcy5pbmRleElkLFxuICAgICAgICAgICAgdWlkOiB0aGlzLnVpZCxcbiAgICAgICAgICAgIGFycmF5VmFsdWU6IHMuYXJyYXlWYWx1ZSxcbiAgICAgICAgICAgIGRpcmVjdGlvbmFsVmFsdWU6IHMuZGlyZWN0aW9uYWxWYWx1ZSxcbiAgICAgICAgICAgIG9yZGVyZWREb2N1bWVudEtleTogdGhpcy50bihuLCBlLmtleSksXG4gICAgICAgICAgICBkb2N1bWVudEtleTogZS5rZXkucGF0aC50b0FycmF5KClcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGhuKHQsIGUsIG4sIHMpIHtcbiAgICAgICAgcmV0dXJuIGRyKHQpLmRlbGV0ZShbIHMuaW5kZXhJZCwgdGhpcy51aWQsIHMuYXJyYXlWYWx1ZSwgcy5kaXJlY3Rpb25hbFZhbHVlLCB0aGlzLnRuKG4sIGUua2V5KSwgZS5rZXkucGF0aC50b0FycmF5KCkgXSk7XG4gICAgfVxuICAgIG9uKHQsIGUsIG4pIHtcbiAgICAgICAgY29uc3QgcyA9IGRyKHQpO1xuICAgICAgICBsZXQgaSA9IG5ldyB3ZShycik7XG4gICAgICAgIHJldHVybiBzLld0KHtcbiAgICAgICAgICAgIGluZGV4OiBcImRvY3VtZW50S2V5SW5kZXhcIixcbiAgICAgICAgICAgIHJhbmdlOiBJREJLZXlSYW5nZS5vbmx5KFsgbi5pbmRleElkLCB0aGlzLnVpZCwgdGhpcy50bihuLCBlKSBdKVxuICAgICAgICB9LCAoKHQsIHMpID0+IHtcbiAgICAgICAgICAgIGkgPSBpLmFkZChuZXcgaXIobi5pbmRleElkLCBlLCBzLmFycmF5VmFsdWUsIHMuZGlyZWN0aW9uYWxWYWx1ZSkpO1xuICAgICAgICB9KSkubmV4dCgoKCkgPT4gaSkpO1xuICAgIH1cbiAgICAvKiogQ3JlYXRlcyB0aGUgaW5kZXggZW50cmllcyBmb3IgdGhlIGdpdmVuIGRvY3VtZW50LiAqLyAgICB1bih0LCBlKSB7XG4gICAgICAgIGxldCBuID0gbmV3IHdlKHJyKTtcbiAgICAgICAgY29uc3QgcyA9IHRoaXMuWmUoZSwgdCk7XG4gICAgICAgIGlmIChudWxsID09IHMpIHJldHVybiBuO1xuICAgICAgICBjb25zdCBpID0gaWUoZSk7XG4gICAgICAgIGlmIChudWxsICE9IGkpIHtcbiAgICAgICAgICAgIGNvbnN0IHIgPSB0LmRhdGEuZmllbGQoaS5maWVsZFBhdGgpO1xuICAgICAgICAgICAgaWYgKEd0KHIpKSBmb3IgKGNvbnN0IGkgb2Ygci5hcnJheVZhbHVlLnZhbHVlcyB8fCBbXSkgbiA9IG4uYWRkKG5ldyBpcihlLmluZGV4SWQsIHQua2V5LCB0aGlzLkplKGkpLCBzKSk7XG4gICAgICAgIH0gZWxzZSBuID0gbi5hZGQobmV3IGlyKGUuaW5kZXhJZCwgdC5rZXksIGhyLCBzKSk7XG4gICAgICAgIHJldHVybiBuO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBVcGRhdGVzIHRoZSBpbmRleCBlbnRyaWVzIGZvciB0aGUgcHJvdmlkZWQgZG9jdW1lbnQgYnkgZGVsZXRpbmcgZW50cmllc1xuICAgICAqIHRoYXQgYXJlIG5vIGxvbmdlciByZWZlcmVuY2VkIGluIGBuZXdFbnRyaWVzYCBhbmQgYWRkaW5nIGFsbCBuZXdseSBhZGRlZFxuICAgICAqIGVudHJpZXMuXG4gICAgICovICAgIGFuKHQsIGUsIG4sIHMsIGkpIHtcbiAgICAgICAgTyhcIkluZGV4ZWREYkluZGV4TWFuYWdlclwiLCBcIlVwZGF0aW5nIGluZGV4IGVudHJpZXMgZm9yIGRvY3VtZW50ICclcydcIiwgZS5rZXkpO1xuICAgICAgICBjb25zdCByID0gW107XG4gICAgICAgIHJldHVybiBmdW5jdGlvbih0LCBlLCBuLCBzLCBpKSB7XG4gICAgICAgICAgICBjb25zdCByID0gdC5nZXRJdGVyYXRvcigpLCBvID0gZS5nZXRJdGVyYXRvcigpO1xuICAgICAgICAgICAgbGV0IHUgPSBnZShyKSwgYSA9IGdlKG8pO1xuICAgICAgICAgICAgLy8gV2FsayB0aHJvdWdoIHRoZSB0d28gc2V0cyBhdCB0aGUgc2FtZSB0aW1lLCB1c2luZyB0aGUgb3JkZXJpbmcgZGVmaW5lZCBieVxuICAgICAgICAgICAgLy8gYGNvbXBhcmF0b3JgLlxuICAgICAgICAgICAgZm9yICg7dSB8fCBhOyApIHtcbiAgICAgICAgICAgICAgICBsZXQgdCA9ICExLCBlID0gITE7XG4gICAgICAgICAgICAgICAgaWYgKHUgJiYgYSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBzID0gbih1LCBhKTtcbiAgICAgICAgICAgICAgICAgICAgcyA8IDAgPyBcbiAgICAgICAgICAgICAgICAgICAgLy8gVGhlIGVsZW1lbnQgd2FzIHJlbW92ZWQgaWYgdGhlIG5leHQgZWxlbWVudCBpbiBvdXIgb3JkZXJlZFxuICAgICAgICAgICAgICAgICAgICAvLyB3YWxrdGhyb3VnaCBpcyBvbmx5IGluIGBiZWZvcmVgLlxuICAgICAgICAgICAgICAgICAgICBlID0gITAgOiBzID4gMCAmJiAoXG4gICAgICAgICAgICAgICAgICAgIC8vIFRoZSBlbGVtZW50IHdhcyBhZGRlZCBpZiB0aGUgbmV4dCBlbGVtZW50IGluIG91ciBvcmRlcmVkIHdhbGt0aHJvdWdoXG4gICAgICAgICAgICAgICAgICAgIC8vIGlzIG9ubHkgaW4gYGFmdGVyYC5cbiAgICAgICAgICAgICAgICAgICAgdCA9ICEwKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgbnVsbCAhPSB1ID8gZSA9ICEwIDogdCA9ICEwO1xuICAgICAgICAgICAgICAgIHQgPyAocyhhKSwgYSA9IGdlKG8pKSA6IGUgPyAoaSh1KSwgdSA9IGdlKHIpKSA6ICh1ID0gZ2UociksIGEgPSBnZShvKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0ocywgaSwgcnIsIChcbiAgICAgICAgLyogb25BZGQ9ICovIHMgPT4ge1xuICAgICAgICAgICAgci5wdXNoKHRoaXMuY24odCwgZSwgbiwgcykpO1xuICAgICAgICB9KSwgKFxuICAgICAgICAvKiBvblJlbW92ZT0gKi8gcyA9PiB7XG4gICAgICAgICAgICByLnB1c2godGhpcy5obih0LCBlLCBuLCBzKSk7XG4gICAgICAgIH0pKSwgeWkud2FpdEZvcihyKTtcbiAgICB9XG4gICAgcm4odCkge1xuICAgICAgICBsZXQgZSA9IDE7XG4gICAgICAgIHJldHVybiB3cih0KS5XdCh7XG4gICAgICAgICAgICBpbmRleDogXCJzZXF1ZW5jZU51bWJlckluZGV4XCIsXG4gICAgICAgICAgICByZXZlcnNlOiAhMCxcbiAgICAgICAgICAgIHJhbmdlOiBJREJLZXlSYW5nZS51cHBlckJvdW5kKFsgdGhpcy51aWQsIE51bWJlci5NQVhfU0FGRV9JTlRFR0VSIF0pXG4gICAgICAgIH0sICgodCwgbiwgcykgPT4ge1xuICAgICAgICAgICAgcy5kb25lKCksIGUgPSBuLnNlcXVlbmNlTnVtYmVyICsgMTtcbiAgICAgICAgfSkpLm5leHQoKCgpID0+IGUpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyBhIG5ldyBzZXQgb2YgSURCIHJhbmdlcyB0aGF0IHNwbGl0cyB0aGUgZXhpc3RpbmcgcmFuZ2UgYW5kIGV4Y2x1ZGVzXG4gICAgICogYW55IHZhbHVlcyB0aGF0IG1hdGNoIHRoZSBgbm90SW5WYWx1ZWAgZnJvbSB0aGVzZSByYW5nZXMuIEFzIGFuIGV4YW1wbGUsXG4gICAgICogJ1tmb28gPiAyICYmIGZvbyAhPSAzXWAgYmVjb21lcyAgYFtmb28gPiAyICYmIDwgMywgZm9vID4gM11gLlxuICAgICAqLyAgICBjcmVhdGVSYW5nZSh0LCBlLCBuKSB7XG4gICAgICAgIC8vIFRoZSBub3RJbiB2YWx1ZXMgbmVlZCB0byBiZSBzb3J0ZWQgYW5kIHVuaXF1ZSBzbyB0aGF0IHdlIGNhbiByZXR1cm4gYVxuICAgICAgICAvLyBzb3J0ZWQgc2V0IG9mIG5vbi1vdmVybGFwcGluZyByYW5nZXMuXG4gICAgICAgIG4gPSBuLnNvcnQoKCh0LCBlKSA9PiBycih0LCBlKSkpLmZpbHRlcigoKHQsIGUsIG4pID0+ICFlIHx8IDAgIT09IHJyKHQsIG5bZSAtIDFdKSkpO1xuICAgICAgICBjb25zdCBzID0gW107XG4gICAgICAgIHMucHVzaCh0KTtcbiAgICAgICAgZm9yIChjb25zdCBpIG9mIG4pIHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSBycihpLCB0KSwgciA9IHJyKGksIGUpO1xuICAgICAgICAgICAgaWYgKDAgPT09IG4pIFxuICAgICAgICAgICAgLy8gYG5vdEluVmFsdWVgIGlzIHRoZSBsb3dlciBib3VuZC4gV2UgdGhlcmVmb3JlIG5lZWQgdG8gcmFpc2UgdGhlIGJvdW5kXG4gICAgICAgICAgICAvLyB0byB0aGUgbmV4dCB2YWx1ZS5cbiAgICAgICAgICAgIHNbMF0gPSB0LmtlKCk7IGVsc2UgaWYgKG4gPiAwICYmIHIgPCAwKSBcbiAgICAgICAgICAgIC8vIGBub3RJblZhbHVlYCBpcyBpbiB0aGUgbWlkZGxlIG9mIHRoZSByYW5nZVxuICAgICAgICAgICAgcy5wdXNoKGkpLCBzLnB1c2goaS5rZSgpKTsgZWxzZSBpZiAociA+IDApIFxuICAgICAgICAgICAgLy8gYG5vdEluVmFsdWVgIChhbmQgYWxsIGZvbGxvd2luZyB2YWx1ZXMpIGFyZSBvdXQgb2YgdGhlIHJhbmdlXG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBzLnB1c2goZSk7XG4gICAgICAgIGNvbnN0IGkgPSBbXTtcbiAgICAgICAgZm9yIChsZXQgdCA9IDA7IHQgPCBzLmxlbmd0aDsgdCArPSAyKSBpLnB1c2goSURCS2V5UmFuZ2UuYm91bmQoWyBzW3RdLmluZGV4SWQsIHRoaXMudWlkLCBzW3RdLmFycmF5VmFsdWUsIHNbdF0uZGlyZWN0aW9uYWxWYWx1ZSwgaHIsIFtdIF0sIFsgc1t0ICsgMV0uaW5kZXhJZCwgdGhpcy51aWQsIHNbdCArIDFdLmFycmF5VmFsdWUsIHNbdCArIDFdLmRpcmVjdGlvbmFsVmFsdWUsIGhyLCBbXSBdKSk7XG4gICAgICAgIHJldHVybiBpO1xuICAgIH1cbiAgICBnZXRNaW5PZmZzZXQodCwgZSkge1xuICAgICAgICBsZXQgbjtcbiAgICAgICAgcmV0dXJuIHlpLmZvckVhY2godGhpcy5RZShlKSwgKGUgPT4gdGhpcy5qZSh0LCBlKS5uZXh0KCh0ID0+IHtcbiAgICAgICAgICAgIHQgPyAoIW4gfHwgbGUodC5pbmRleFN0YXRlLm9mZnNldCwgbikgPCAwKSAmJiAobiA9IHQuaW5kZXhTdGF0ZS5vZmZzZXQpIDogbiA9IGhlLm1pbigpO1xuICAgICAgICB9KSkpKS5uZXh0KCgoKSA9PiBuKSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEhlbHBlciB0byBnZXQgYSB0eXBlZCBTaW1wbGVEYlN0b3JlIGZvciB0aGUgY29sbGVjdGlvblBhcmVudHNcbiAqIGRvY3VtZW50IHN0b3JlLlxuICovIGZ1bmN0aW9uIGZyKHQpIHtcbiAgICByZXR1cm4gU2kodCwgXCJjb2xsZWN0aW9uUGFyZW50c1wiKTtcbn1cblxuLyoqXG4gKiBIZWxwZXIgdG8gZ2V0IGEgdHlwZWQgU2ltcGxlRGJTdG9yZSBmb3IgdGhlIGluZGV4IGVudHJ5IG9iamVjdCBzdG9yZS5cbiAqLyBmdW5jdGlvbiBkcih0KSB7XG4gICAgcmV0dXJuIFNpKHQsIFwiaW5kZXhFbnRyaWVzXCIpO1xufVxuXG4vKipcbiAqIEhlbHBlciB0byBnZXQgYSB0eXBlZCBTaW1wbGVEYlN0b3JlIGZvciB0aGUgaW5kZXggY29uZmlndXJhdGlvbiBvYmplY3Qgc3RvcmUuXG4gKi8gZnVuY3Rpb24gX3IodCkge1xuICAgIHJldHVybiBTaSh0LCBcImluZGV4Q29uZmlndXJhdGlvblwiKTtcbn1cblxuLyoqXG4gKiBIZWxwZXIgdG8gZ2V0IGEgdHlwZWQgU2ltcGxlRGJTdG9yZSBmb3IgdGhlIGluZGV4IHN0YXRlIG9iamVjdCBzdG9yZS5cbiAqLyBmdW5jdGlvbiB3cih0KSB7XG4gICAgcmV0dXJuIFNpKHQsIFwiaW5kZXhTdGF0ZVwiKTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTggR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi8gY29uc3QgbXIgPSB7XG4gICAgZGlkUnVuOiAhMSxcbiAgICBzZXF1ZW5jZU51bWJlcnNDb2xsZWN0ZWQ6IDAsXG4gICAgdGFyZ2V0c1JlbW92ZWQ6IDAsXG4gICAgZG9jdW1lbnRzUmVtb3ZlZDogMFxufTtcblxuY2xhc3MgZ3Ige1xuICAgIGNvbnN0cnVjdG9yKFxuICAgIC8vIFdoZW4gd2UgYXR0ZW1wdCB0byBjb2xsZWN0LCB3ZSB3aWxsIG9ubHkgZG8gc28gaWYgdGhlIGNhY2hlIHNpemUgaXMgZ3JlYXRlciB0aGFuIHRoaXNcbiAgICAvLyB0aHJlc2hvbGQuIFBhc3NpbmcgYENPTExFQ1RJT05fRElTQUJMRURgIGhlcmUgd2lsbCBjYXVzZSBjb2xsZWN0aW9uIHRvIGFsd2F5cyBiZSBza2lwcGVkLlxuICAgIHQsIFxuICAgIC8vIFRoZSBwZXJjZW50YWdlIG9mIHNlcXVlbmNlIG51bWJlcnMgdGhhdCB3ZSB3aWxsIGF0dGVtcHQgdG8gY29sbGVjdFxuICAgIGUsIFxuICAgIC8vIEEgY2FwIG9uIHRoZSB0b3RhbCBudW1iZXIgb2Ygc2VxdWVuY2UgbnVtYmVycyB0aGF0IHdpbGwgYmUgY29sbGVjdGVkLiBUaGlzIHByZXZlbnRzXG4gICAgLy8gdXMgZnJvbSBjb2xsZWN0aW5nIGEgaHVnZSBudW1iZXIgb2Ygc2VxdWVuY2UgbnVtYmVycyBpZiB0aGUgY2FjaGUgaGFzIGdyb3duIHZlcnkgbGFyZ2UuXG4gICAgbikge1xuICAgICAgICB0aGlzLmNhY2hlU2l6ZUNvbGxlY3Rpb25UaHJlc2hvbGQgPSB0LCB0aGlzLnBlcmNlbnRpbGVUb0NvbGxlY3QgPSBlLCB0aGlzLm1heGltdW1TZXF1ZW5jZU51bWJlcnNUb0NvbGxlY3QgPSBuO1xuICAgIH1cbiAgICBzdGF0aWMgd2l0aENhY2hlU2l6ZSh0KSB7XG4gICAgICAgIHJldHVybiBuZXcgZ3IodCwgZ3IuREVGQVVMVF9DT0xMRUNUSU9OX1BFUkNFTlRJTEUsIGdyLkRFRkFVTFRfTUFYX1NFUVVFTkNFX05VTUJFUlNfVE9fQ09MTEVDVCk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBEZWxldGUgYSBtdXRhdGlvbiBiYXRjaCBhbmQgdGhlIGFzc29jaWF0ZWQgZG9jdW1lbnQgbXV0YXRpb25zLlxuICogQHJldHVybnMgQSBQZXJzaXN0ZW5jZVByb21pc2Ugb2YgdGhlIGRvY3VtZW50IG11dGF0aW9ucyB0aGF0IHdlcmUgcmVtb3ZlZC5cbiAqL1xuZnVuY3Rpb24geXIodCwgZSwgbikge1xuICAgIGNvbnN0IHMgPSB0LnN0b3JlKFwibXV0YXRpb25zXCIpLCBpID0gdC5zdG9yZShcImRvY3VtZW50TXV0YXRpb25zXCIpLCByID0gW10sIG8gPSBJREJLZXlSYW5nZS5vbmx5KG4uYmF0Y2hJZCk7XG4gICAgbGV0IHUgPSAwO1xuICAgIGNvbnN0IGEgPSBzLld0KHtcbiAgICAgICAgcmFuZ2U6IG9cbiAgICB9LCAoKHQsIGUsIG4pID0+ICh1KyssIG4uZGVsZXRlKCkpKSk7XG4gICAgci5wdXNoKGEubmV4dCgoKCkgPT4ge1xuICAgICAgICBVKDEgPT09IHUpO1xuICAgIH0pKSk7XG4gICAgY29uc3QgYyA9IFtdO1xuICAgIGZvciAoY29uc3QgdCBvZiBuLm11dGF0aW9ucykge1xuICAgICAgICBjb25zdCBzID0gSnMoZSwgdC5rZXkucGF0aCwgbi5iYXRjaElkKTtcbiAgICAgICAgci5wdXNoKGkuZGVsZXRlKHMpKSwgYy5wdXNoKHQua2V5KTtcbiAgICB9XG4gICAgcmV0dXJuIHlpLndhaXRGb3IocikubmV4dCgoKCkgPT4gYykpO1xufVxuXG4vKipcbiAqIFJldHVybnMgYW4gYXBwcm94aW1hdGUgc2l6ZSBmb3IgdGhlIGdpdmVuIGRvY3VtZW50LlxuICovIGZ1bmN0aW9uIHByKHQpIHtcbiAgICBpZiAoIXQpIHJldHVybiAwO1xuICAgIGxldCBlO1xuICAgIGlmICh0LmRvY3VtZW50KSBlID0gdC5kb2N1bWVudDsgZWxzZSBpZiAodC51bmtub3duRG9jdW1lbnQpIGUgPSB0LnVua25vd25Eb2N1bWVudDsgZWxzZSB7XG4gICAgICAgIGlmICghdC5ub0RvY3VtZW50KSB0aHJvdyBMKCk7XG4gICAgICAgIGUgPSB0Lm5vRG9jdW1lbnQ7XG4gICAgfVxuICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShlKS5sZW5ndGg7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKiogQSBtdXRhdGlvbiBxdWV1ZSBmb3IgYSBzcGVjaWZpYyB1c2VyLCBiYWNrZWQgYnkgSW5kZXhlZERCLiAqLyBnci5ERUZBVUxUX0NPTExFQ1RJT05fUEVSQ0VOVElMRSA9IDEwLCBcbmdyLkRFRkFVTFRfTUFYX1NFUVVFTkNFX05VTUJFUlNfVE9fQ09MTEVDVCA9IDFlMywgZ3IuREVGQVVMVCA9IG5ldyBncig0MTk0MzA0MCwgZ3IuREVGQVVMVF9DT0xMRUNUSU9OX1BFUkNFTlRJTEUsIGdyLkRFRkFVTFRfTUFYX1NFUVVFTkNFX05VTUJFUlNfVE9fQ09MTEVDVCksIFxuZ3IuRElTQUJMRUQgPSBuZXcgZ3IoLTEsIDAsIDApO1xuXG5jbGFzcyBJciB7XG4gICAgY29uc3RydWN0b3IoXG4gICAgLyoqXG4gICAgICogVGhlIG5vcm1hbGl6ZWQgdXNlcklkIChlLmcuIG51bGwgVUlEID0+IFwiXCIgdXNlcklkKSB1c2VkIHRvIHN0b3JlIC9cbiAgICAgKiByZXRyaWV2ZSBtdXRhdGlvbnMuXG4gICAgICovXG4gICAgdCwgZSwgbiwgcykge1xuICAgICAgICB0aGlzLnVzZXJJZCA9IHQsIHRoaXMuTSA9IGUsIHRoaXMuaW5kZXhNYW5hZ2VyID0gbiwgdGhpcy5yZWZlcmVuY2VEZWxlZ2F0ZSA9IHMsIFxuICAgICAgICAvKipcbiAgICAgICAgICogQ2FjaGVzIHRoZSBkb2N1bWVudCBrZXlzIGZvciBwZW5kaW5nIG11dGF0aW9uIGJhdGNoZXMuIElmIHRoZSBtdXRhdGlvblxuICAgICAgICAgKiBoYXMgYmVlbiByZW1vdmVkIGZyb20gSW5kZXhlZERiLCB0aGUgY2FjaGVkIHZhbHVlIG1heSBjb250aW51ZSB0b1xuICAgICAgICAgKiBiZSB1c2VkIHRvIHJldHJpZXZlIHRoZSBiYXRjaCdzIGRvY3VtZW50IGtleXMuIFRvIHJlbW92ZSBhIGNhY2hlZCB2YWx1ZVxuICAgICAgICAgKiBsb2NhbGx5LCBgcmVtb3ZlQ2FjaGVkTXV0YXRpb25LZXlzKClgIHNob3VsZCBiZSBpbnZva2VkIGVpdGhlciBkaXJlY3RseVxuICAgICAgICAgKiBvciB0aHJvdWdoIGByZW1vdmVNdXRhdGlvbkJhdGNoZXMoKWAuXG4gICAgICAgICAqXG4gICAgICAgICAqIFdpdGggbXVsdGktdGFiLCB3aGVuIHRoZSBwcmltYXJ5IGNsaWVudCBhY2tub3dsZWRnZXMgb3IgcmVqZWN0cyBhIG11dGF0aW9uLFxuICAgICAgICAgKiB0aGlzIGNhY2hlIGlzIHVzZWQgYnkgc2Vjb25kYXJ5IGNsaWVudHMgdG8gaW52YWxpZGF0ZSB0aGUgbG9jYWxcbiAgICAgICAgICogdmlldyBvZiB0aGUgZG9jdW1lbnRzIHRoYXQgd2VyZSBwcmV2aW91c2x5IGFmZmVjdGVkIGJ5IHRoZSBtdXRhdGlvbi5cbiAgICAgICAgICovXG4gICAgICAgIC8vIFBPUlRJTkcgTk9URTogTXVsdGktdGFiIG9ubHkuXG4gICAgICAgIHRoaXMubG4gPSB7fTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIG5ldyBtdXRhdGlvbiBxdWV1ZSBmb3IgdGhlIGdpdmVuIHVzZXIuXG4gICAgICogQHBhcmFtIHVzZXIgLSBUaGUgdXNlciBmb3Igd2hpY2ggdG8gY3JlYXRlIGEgbXV0YXRpb24gcXVldWUuXG4gICAgICogQHBhcmFtIHNlcmlhbGl6ZXIgLSBUaGUgc2VyaWFsaXplciB0byB1c2Ugd2hlbiBwZXJzaXN0aW5nIHRvIEluZGV4ZWREYi5cbiAgICAgKi8gICAgc3RhdGljIFl0KHQsIGUsIG4sIHMpIHtcbiAgICAgICAgLy8gVE9ETyhtY2cpOiBGaWd1cmUgb3V0IHdoYXQgY29uc3RyYWludHMgdGhlcmUgYXJlIG9uIHVzZXJJRHNcbiAgICAgICAgLy8gSW4gcGFydGljdWxhciwgYXJlIHRoZXJlIGFueSByZXNlcnZlZCBjaGFyYWN0ZXJzPyBhcmUgZW1wdHkgaWRzIGFsbG93ZWQ/XG4gICAgICAgIC8vIEZvciB0aGUgbW9tZW50IHN0b3JlIHRoZXNlIHRvZ2V0aGVyIGluIHRoZSBzYW1lIG11dGF0aW9ucyB0YWJsZSBhc3N1bWluZ1xuICAgICAgICAvLyB0aGF0IGVtcHR5IHVzZXJJRHMgYXJlbid0IGFsbG93ZWQuXG4gICAgICAgIFUoXCJcIiAhPT0gdC51aWQpO1xuICAgICAgICBjb25zdCBpID0gdC5pc0F1dGhlbnRpY2F0ZWQoKSA/IHQudWlkIDogXCJcIjtcbiAgICAgICAgcmV0dXJuIG5ldyBJcihpLCBlLCBuLCBzKTtcbiAgICB9XG4gICAgY2hlY2tFbXB0eSh0KSB7XG4gICAgICAgIGxldCBlID0gITA7XG4gICAgICAgIGNvbnN0IG4gPSBJREJLZXlSYW5nZS5ib3VuZChbIHRoaXMudXNlcklkLCBOdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFkgXSwgWyB0aGlzLnVzZXJJZCwgTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZIF0pO1xuICAgICAgICByZXR1cm4gRXIodCkuV3Qoe1xuICAgICAgICAgICAgaW5kZXg6IFwidXNlck11dGF0aW9uc0luZGV4XCIsXG4gICAgICAgICAgICByYW5nZTogblxuICAgICAgICB9LCAoKHQsIG4sIHMpID0+IHtcbiAgICAgICAgICAgIGUgPSAhMSwgcy5kb25lKCk7XG4gICAgICAgIH0pKS5uZXh0KCgoKSA9PiBlKSk7XG4gICAgfVxuICAgIGFkZE11dGF0aW9uQmF0Y2godCwgZSwgbiwgcykge1xuICAgICAgICBjb25zdCBpID0gQXIodCksIHIgPSBFcih0KTtcbiAgICAgICAgLy8gVGhlIEluZGV4ZWREYiBpbXBsZW1lbnRhdGlvbiBpbiBDaHJvbWUgKGFuZCBGaXJlZm94KSBkb2VzIG5vdCBoYW5kbGVcbiAgICAgICAgLy8gY29tcG91bmQgaW5kaWNlcyB0aGF0IGluY2x1ZGUgYXV0by1nZW5lcmF0ZWQga2V5cyBjb3JyZWN0bHkuIFRvIGVuc3VyZVxuICAgICAgICAvLyB0aGF0IHRoZSBpbmRleCBlbnRyeSBpcyBhZGRlZCBjb3JyZWN0bHkgaW4gYWxsIGJyb3dzZXJzLCB3ZSBwZXJmb3JtIHR3b1xuICAgICAgICAvLyB3cml0ZXM6IFRoZSBmaXJzdCB3cml0ZSBpcyB1c2VkIHRvIHJldHJpZXZlIHRoZSBuZXh0IGF1dG8tZ2VuZXJhdGVkIEJhdGNoXG4gICAgICAgIC8vIElELCBhbmQgdGhlIHNlY29uZCB3cml0ZSBwb3B1bGF0ZXMgdGhlIGluZGV4IGFuZCBzdG9yZXMgdGhlIGFjdHVhbFxuICAgICAgICAvLyBtdXRhdGlvbiBiYXRjaC5cbiAgICAgICAgLy8gU2VlOiBodHRwczovL2J1Z3MuY2hyb21pdW0ub3JnL3AvY2hyb21pdW0vaXNzdWVzL2RldGFpbD9pZD03MDE5NzJcbiAgICAgICAgLy8gV2Ugd3JpdGUgYW4gZW1wdHkgb2JqZWN0IHRvIG9idGFpbiBrZXlcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbiAgICAgICAgcmV0dXJuIHIuYWRkKHt9KS5uZXh0KChvID0+IHtcbiAgICAgICAgICAgIFUoXCJudW1iZXJcIiA9PSB0eXBlb2Ygbyk7XG4gICAgICAgICAgICBjb25zdCB1ID0gbmV3IERpKG8sIGUsIG4sIHMpLCBhID0gZnVuY3Rpb24odCwgZSwgbikge1xuICAgICAgICAgICAgICAgIGNvbnN0IHMgPSBuLmJhc2VNdXRhdGlvbnMubWFwKChlID0+IHZzKHQuSnQsIGUpKSksIGkgPSBuLm11dGF0aW9ucy5tYXAoKGUgPT4gdnModC5KdCwgZSkpKTtcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICB1c2VySWQ6IGUsXG4gICAgICAgICAgICAgICAgICAgIGJhdGNoSWQ6IG4uYmF0Y2hJZCxcbiAgICAgICAgICAgICAgICAgICAgbG9jYWxXcml0ZVRpbWVNczogbi5sb2NhbFdyaXRlVGltZS50b01pbGxpcygpLFxuICAgICAgICAgICAgICAgICAgICBiYXNlTXV0YXRpb25zOiBzLFxuICAgICAgICAgICAgICAgICAgICBtdXRhdGlvbnM6IGlcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSh0aGlzLk0sIHRoaXMudXNlcklkLCB1KSwgYyA9IFtdO1xuICAgICAgICAgICAgbGV0IGggPSBuZXcgd2UoKCh0LCBlKSA9PiBydCh0LmNhbm9uaWNhbFN0cmluZygpLCBlLmNhbm9uaWNhbFN0cmluZygpKSkpO1xuICAgICAgICAgICAgZm9yIChjb25zdCB0IG9mIHMpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBlID0gSnModGhpcy51c2VySWQsIHQua2V5LnBhdGgsIG8pO1xuICAgICAgICAgICAgICAgIGggPSBoLmFkZCh0LmtleS5wYXRoLnBvcExhc3QoKSksIGMucHVzaChyLnB1dChhKSksIGMucHVzaChpLnB1dChlLCBZcykpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGguZm9yRWFjaCgoZSA9PiB7XG4gICAgICAgICAgICAgICAgYy5wdXNoKHRoaXMuaW5kZXhNYW5hZ2VyLmFkZFRvQ29sbGVjdGlvblBhcmVudEluZGV4KHQsIGUpKTtcbiAgICAgICAgICAgIH0pKSwgdC5hZGRPbkNvbW1pdHRlZExpc3RlbmVyKCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5sbltvXSA9IHUua2V5cygpO1xuICAgICAgICAgICAgfSkpLCB5aS53YWl0Rm9yKGMpLm5leHQoKCgpID0+IHUpKTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICBsb29rdXBNdXRhdGlvbkJhdGNoKHQsIGUpIHtcbiAgICAgICAgcmV0dXJuIEVyKHQpLmdldChlKS5uZXh0KCh0ID0+IHQgPyAoVSh0LnVzZXJJZCA9PT0gdGhpcy51c2VySWQpLCBMaSh0aGlzLk0sIHQpKSA6IG51bGwpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0aGUgZG9jdW1lbnQga2V5cyBmb3IgdGhlIG11dGF0aW9uIGJhdGNoIHdpdGggdGhlIGdpdmVuIGJhdGNoSWQuXG4gICAgICogRm9yIHByaW1hcnkgY2xpZW50cywgdGhpcyBtZXRob2QgcmV0dXJucyBgbnVsbGAgYWZ0ZXJcbiAgICAgKiBgcmVtb3ZlTXV0YXRpb25CYXRjaGVzKClgIGhhcyBiZWVuIGNhbGxlZC4gU2Vjb25kYXJ5IGNsaWVudHMgcmV0dXJuIGFcbiAgICAgKiBjYWNoZWQgcmVzdWx0IHVudGlsIGByZW1vdmVDYWNoZWRNdXRhdGlvbktleXMoKWAgaXMgaW52b2tlZC5cbiAgICAgKi9cbiAgICAvLyBQT1JUSU5HIE5PVEU6IE11bHRpLXRhYiBvbmx5LlxuICAgIGZuKHQsIGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubG5bZV0gPyB5aS5yZXNvbHZlKHRoaXMubG5bZV0pIDogdGhpcy5sb29rdXBNdXRhdGlvbkJhdGNoKHQsIGUpLm5leHQoKHQgPT4ge1xuICAgICAgICAgICAgaWYgKHQpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBuID0gdC5rZXlzKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubG5bZV0gPSBuLCBuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgZ2V0TmV4dE11dGF0aW9uQmF0Y2hBZnRlckJhdGNoSWQodCwgZSkge1xuICAgICAgICBjb25zdCBuID0gZSArIDEsIHMgPSBJREJLZXlSYW5nZS5sb3dlckJvdW5kKFsgdGhpcy51c2VySWQsIG4gXSk7XG4gICAgICAgIGxldCBpID0gbnVsbDtcbiAgICAgICAgcmV0dXJuIEVyKHQpLld0KHtcbiAgICAgICAgICAgIGluZGV4OiBcInVzZXJNdXRhdGlvbnNJbmRleFwiLFxuICAgICAgICAgICAgcmFuZ2U6IHNcbiAgICAgICAgfSwgKCh0LCBlLCBzKSA9PiB7XG4gICAgICAgICAgICBlLnVzZXJJZCA9PT0gdGhpcy51c2VySWQgJiYgKFUoZS5iYXRjaElkID49IG4pLCBpID0gTGkodGhpcy5NLCBlKSksIHMuZG9uZSgpO1xuICAgICAgICB9KSkubmV4dCgoKCkgPT4gaSkpO1xuICAgIH1cbiAgICBnZXRIaWdoZXN0VW5hY2tub3dsZWRnZWRCYXRjaElkKHQpIHtcbiAgICAgICAgY29uc3QgZSA9IElEQktleVJhbmdlLnVwcGVyQm91bmQoWyB0aGlzLnVzZXJJZCwgTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZIF0pO1xuICAgICAgICBsZXQgbiA9IC0xO1xuICAgICAgICByZXR1cm4gRXIodCkuV3Qoe1xuICAgICAgICAgICAgaW5kZXg6IFwidXNlck11dGF0aW9uc0luZGV4XCIsXG4gICAgICAgICAgICByYW5nZTogZSxcbiAgICAgICAgICAgIHJldmVyc2U6ICEwXG4gICAgICAgIH0sICgodCwgZSwgcykgPT4ge1xuICAgICAgICAgICAgbiA9IGUuYmF0Y2hJZCwgcy5kb25lKCk7XG4gICAgICAgIH0pKS5uZXh0KCgoKSA9PiBuKSk7XG4gICAgfVxuICAgIGdldEFsbE11dGF0aW9uQmF0Y2hlcyh0KSB7XG4gICAgICAgIGNvbnN0IGUgPSBJREJLZXlSYW5nZS5ib3VuZChbIHRoaXMudXNlcklkLCAtMSBdLCBbIHRoaXMudXNlcklkLCBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFkgXSk7XG4gICAgICAgIHJldHVybiBFcih0KS5xdChcInVzZXJNdXRhdGlvbnNJbmRleFwiLCBlKS5uZXh0KCh0ID0+IHQubWFwKCh0ID0+IExpKHRoaXMuTSwgdCkpKSkpO1xuICAgIH1cbiAgICBnZXRBbGxNdXRhdGlvbkJhdGNoZXNBZmZlY3RpbmdEb2N1bWVudEtleSh0LCBlKSB7XG4gICAgICAgIC8vIFNjYW4gdGhlIGRvY3VtZW50LW11dGF0aW9uIGluZGV4IHN0YXJ0aW5nIHdpdGggYSBwcmVmaXggc3RhcnRpbmcgd2l0aFxuICAgICAgICAvLyB0aGUgZ2l2ZW4gZG9jdW1lbnRLZXkuXG4gICAgICAgIGNvbnN0IG4gPSBIcyh0aGlzLnVzZXJJZCwgZS5wYXRoKSwgcyA9IElEQktleVJhbmdlLmxvd2VyQm91bmQobiksIGkgPSBbXTtcbiAgICAgICAgcmV0dXJuIEFyKHQpLld0KHtcbiAgICAgICAgICAgIHJhbmdlOiBzXG4gICAgICAgIH0sICgobiwgcywgcikgPT4ge1xuICAgICAgICAgICAgY29uc3QgW28sIHUsIGFdID0gbiwgYyA9IFdzKHUpO1xuICAgICAgICAgICAgLy8gT25seSBjb25zaWRlciByb3dzIG1hdGNoaW5nIGV4YWN0bHkgdGhlIHNwZWNpZmljIGtleSBvZlxuICAgICAgICAgICAgLy8gaW50ZXJlc3QuIE5vdGUgdGhhdCBiZWNhdXNlIHdlIG9yZGVyIGJ5IHBhdGggZmlyc3QsIGFuZCB3ZVxuICAgICAgICAgICAgLy8gb3JkZXIgdGVybWluYXRvcnMgYmVmb3JlIHBhdGggc2VwYXJhdG9ycywgd2UnbGwgZW5jb3VudGVyIGFsbFxuICAgICAgICAgICAgLy8gdGhlIGluZGV4IHJvd3MgZm9yIGRvY3VtZW50S2V5IGNvbnRpZ3VvdXNseS4gSW4gcGFydGljdWxhciwgYWxsXG4gICAgICAgICAgICAvLyB0aGUgcm93cyBmb3IgZG9jdW1lbnRLZXkgd2lsbCBvY2N1ciBiZWZvcmUgYW55IHJvd3MgZm9yXG4gICAgICAgICAgICAvLyBkb2N1bWVudHMgbmVzdGVkIGluIGEgc3ViY29sbGVjdGlvbiBiZW5lYXRoIGRvY3VtZW50S2V5IHNvIHdlXG4gICAgICAgICAgICAvLyBjYW4gc3RvcCBhcyBzb29uIGFzIHdlIGhpdCBhbnkgc3VjaCByb3cuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobyA9PT0gdGhpcy51c2VySWQgJiYgZS5wYXRoLmlzRXF1YWwoYykpIFxuICAgICAgICAgICAgLy8gTG9vayB1cCB0aGUgbXV0YXRpb24gYmF0Y2ggaW4gdGhlIHN0b3JlLlxuICAgICAgICAgICAgcmV0dXJuIEVyKHQpLmdldChhKS5uZXh0KCh0ID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoIXQpIHRocm93IEwoKTtcbiAgICAgICAgICAgICAgICBVKHQudXNlcklkID09PSB0aGlzLnVzZXJJZCksIGkucHVzaChMaSh0aGlzLk0sIHQpKTtcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgIHIuZG9uZSgpO1xuICAgICAgICB9KSkubmV4dCgoKCkgPT4gaSkpO1xuICAgIH1cbiAgICBnZXRBbGxNdXRhdGlvbkJhdGNoZXNBZmZlY3RpbmdEb2N1bWVudEtleXModCwgZSkge1xuICAgICAgICBsZXQgbiA9IG5ldyB3ZShydCk7XG4gICAgICAgIGNvbnN0IHMgPSBbXTtcbiAgICAgICAgcmV0dXJuIGUuZm9yRWFjaCgoZSA9PiB7XG4gICAgICAgICAgICBjb25zdCBpID0gSHModGhpcy51c2VySWQsIGUucGF0aCksIHIgPSBJREJLZXlSYW5nZS5sb3dlckJvdW5kKGkpLCBvID0gQXIodCkuV3Qoe1xuICAgICAgICAgICAgICAgIHJhbmdlOiByXG4gICAgICAgICAgICB9LCAoKHQsIHMsIGkpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBbciwgbywgdV0gPSB0LCBhID0gV3Mobyk7XG4gICAgICAgICAgICAgICAgLy8gT25seSBjb25zaWRlciByb3dzIG1hdGNoaW5nIGV4YWN0bHkgdGhlIHNwZWNpZmljIGtleSBvZlxuICAgICAgICAgICAgICAgIC8vIGludGVyZXN0LiBOb3RlIHRoYXQgYmVjYXVzZSB3ZSBvcmRlciBieSBwYXRoIGZpcnN0LCBhbmQgd2VcbiAgICAgICAgICAgICAgICAvLyBvcmRlciB0ZXJtaW5hdG9ycyBiZWZvcmUgcGF0aCBzZXBhcmF0b3JzLCB3ZSdsbCBlbmNvdW50ZXIgYWxsXG4gICAgICAgICAgICAgICAgLy8gdGhlIGluZGV4IHJvd3MgZm9yIGRvY3VtZW50S2V5IGNvbnRpZ3VvdXNseS4gSW4gcGFydGljdWxhciwgYWxsXG4gICAgICAgICAgICAgICAgLy8gdGhlIHJvd3MgZm9yIGRvY3VtZW50S2V5IHdpbGwgb2NjdXIgYmVmb3JlIGFueSByb3dzIGZvclxuICAgICAgICAgICAgICAgIC8vIGRvY3VtZW50cyBuZXN0ZWQgaW4gYSBzdWJjb2xsZWN0aW9uIGJlbmVhdGggZG9jdW1lbnRLZXkgc28gd2VcbiAgICAgICAgICAgICAgICAvLyBjYW4gc3RvcCBhcyBzb29uIGFzIHdlIGhpdCBhbnkgc3VjaCByb3cuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHIgPT09IHRoaXMudXNlcklkICYmIGUucGF0aC5pc0VxdWFsKGEpID8gbiA9IG4uYWRkKHUpIDogaS5kb25lKCk7XG4gICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICBzLnB1c2gobyk7XG4gICAgICAgIH0pKSwgeWkud2FpdEZvcihzKS5uZXh0KCgoKSA9PiB0aGlzLmRuKHQsIG4pKSk7XG4gICAgfVxuICAgIGdldEFsbE11dGF0aW9uQmF0Y2hlc0FmZmVjdGluZ1F1ZXJ5KHQsIGUpIHtcbiAgICAgICAgY29uc3QgbiA9IGUucGF0aCwgcyA9IG4ubGVuZ3RoICsgMSwgaSA9IEhzKHRoaXMudXNlcklkLCBuKSwgciA9IElEQktleVJhbmdlLmxvd2VyQm91bmQoaSk7XG4gICAgICAgIC8vIENvbGxlY3QgdXAgdW5pcXVlIGJhdGNoSURzIGVuY291bnRlcmVkIGR1cmluZyBhIHNjYW4gb2YgdGhlIGluZGV4LiBVc2UgYVxuICAgICAgICAvLyBTb3J0ZWRTZXQgdG8gYWNjdW11bGF0ZSBiYXRjaCBJRHMgc28gdGhleSBjYW4gYmUgdHJhdmVyc2VkIGluIG9yZGVyIGluIGFcbiAgICAgICAgLy8gc2NhbiBvZiB0aGUgbWFpbiB0YWJsZS5cbiAgICAgICAgbGV0IG8gPSBuZXcgd2UocnQpO1xuICAgICAgICByZXR1cm4gQXIodCkuV3Qoe1xuICAgICAgICAgICAgcmFuZ2U6IHJcbiAgICAgICAgfSwgKCh0LCBlLCBpKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBbciwgdSwgYV0gPSB0LCBjID0gV3ModSk7XG4gICAgICAgICAgICByID09PSB0aGlzLnVzZXJJZCAmJiBuLmlzUHJlZml4T2YoYykgPyBcbiAgICAgICAgICAgIC8vIFJvd3Mgd2l0aCBkb2N1bWVudCBrZXlzIG1vcmUgdGhhbiBvbmUgc2VnbWVudCBsb25nZXIgdGhhbiB0aGVcbiAgICAgICAgICAgIC8vIHF1ZXJ5IHBhdGggY2FuJ3QgYmUgbWF0Y2hlcy4gRm9yIGV4YW1wbGUsIGEgcXVlcnkgb24gJ3Jvb21zJ1xuICAgICAgICAgICAgLy8gY2FuJ3QgbWF0Y2ggdGhlIGRvY3VtZW50IC9yb29tcy9hYmMvbWVzc2FnZXMveHl4LlxuICAgICAgICAgICAgLy8gVE9ETyhtY2cpOiB3ZSdsbCBuZWVkIGEgZGlmZmVyZW50IHNjYW5uZXIgd2hlbiB3ZSBpbXBsZW1lbnRcbiAgICAgICAgICAgIC8vIGFuY2VzdG9yIHF1ZXJpZXMuXG4gICAgICAgICAgICBjLmxlbmd0aCA9PT0gcyAmJiAobyA9IG8uYWRkKGEpKSA6IGkuZG9uZSgpO1xuICAgICAgICB9KSkubmV4dCgoKCkgPT4gdGhpcy5kbih0LCBvKSkpO1xuICAgIH1cbiAgICBkbih0LCBlKSB7XG4gICAgICAgIGNvbnN0IG4gPSBbXSwgcyA9IFtdO1xuICAgICAgICAvLyBUT0RPKHJvY2t3b29kKTogSW1wbGVtZW50IHRoaXMgdXNpbmcgaXRlcmF0ZS5cbiAgICAgICAgcmV0dXJuIGUuZm9yRWFjaCgoZSA9PiB7XG4gICAgICAgICAgICBzLnB1c2goRXIodCkuZ2V0KGUpLm5leHQoKHQgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChudWxsID09PSB0KSB0aHJvdyBMKCk7XG4gICAgICAgICAgICAgICAgVSh0LnVzZXJJZCA9PT0gdGhpcy51c2VySWQpLCBuLnB1c2goTGkodGhpcy5NLCB0KSk7XG4gICAgICAgICAgICB9KSkpO1xuICAgICAgICB9KSksIHlpLndhaXRGb3IocykubmV4dCgoKCkgPT4gbikpO1xuICAgIH1cbiAgICByZW1vdmVNdXRhdGlvbkJhdGNoKHQsIGUpIHtcbiAgICAgICAgcmV0dXJuIHlyKHQuSHQsIHRoaXMudXNlcklkLCBlKS5uZXh0KChuID0+ICh0LmFkZE9uQ29tbWl0dGVkTGlzdGVuZXIoKCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuX24oZS5iYXRjaElkKTtcbiAgICAgICAgfSkpLCB5aS5mb3JFYWNoKG4sIChlID0+IHRoaXMucmVmZXJlbmNlRGVsZWdhdGUubWFya1BvdGVudGlhbGx5T3JwaGFuZWQodCwgZSkpKSkpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ2xlYXJzIHRoZSBjYWNoZWQga2V5cyBmb3IgYSBtdXRhdGlvbiBiYXRjaC4gVGhpcyBtZXRob2Qgc2hvdWxkIGJlXG4gICAgICogY2FsbGVkIGJ5IHNlY29uZGFyeSBjbGllbnRzIGFmdGVyIHRoZXkgcHJvY2VzcyBtdXRhdGlvbiB1cGRhdGVzLlxuICAgICAqXG4gICAgICogTm90ZSB0aGF0IHRoaXMgbWV0aG9kIGRvZXMgbm90IGhhdmUgdG8gYmUgY2FsbGVkIGZyb20gcHJpbWFyeSBjbGllbnRzIGFzXG4gICAgICogdGhlIGNvcnJlc3BvbmRpbmcgY2FjaGUgZW50cmllcyBhcmUgY2xlYXJlZCB3aGVuIGFuIGFja25vd2xlZGdlZCBvclxuICAgICAqIHJlamVjdGVkIGJhdGNoIGlzIHJlbW92ZWQgZnJvbSB0aGUgbXV0YXRpb24gcXVldWUuXG4gICAgICovXG4gICAgLy8gUE9SVElORyBOT1RFOiBNdWx0aS10YWIgb25seVxuICAgIF9uKHQpIHtcbiAgICAgICAgZGVsZXRlIHRoaXMubG5bdF07XG4gICAgfVxuICAgIHBlcmZvcm1Db25zaXN0ZW5jeUNoZWNrKHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2hlY2tFbXB0eSh0KS5uZXh0KChlID0+IHtcbiAgICAgICAgICAgIGlmICghZSkgcmV0dXJuIHlpLnJlc29sdmUoKTtcbiAgICAgICAgICAgIC8vIFZlcmlmeSB0aGF0IHRoZXJlIGFyZSBubyBlbnRyaWVzIGluIHRoZSBkb2N1bWVudE11dGF0aW9ucyBpbmRleCBpZlxuICAgICAgICAgICAgLy8gdGhlIHF1ZXVlIGlzIGVtcHR5LlxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbiA9IElEQktleVJhbmdlLmxvd2VyQm91bmQoWyB0aGlzLnVzZXJJZCBdKTtcbiAgICAgICAgICAgIGNvbnN0IHMgPSBbXTtcbiAgICAgICAgICAgIHJldHVybiBBcih0KS5XdCh7XG4gICAgICAgICAgICAgICAgcmFuZ2U6IG5cbiAgICAgICAgICAgIH0sICgodCwgZSwgbikgPT4ge1xuICAgICAgICAgICAgICAgIGlmICh0WzBdID09PSB0aGlzLnVzZXJJZCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBlID0gV3ModFsxXSk7XG4gICAgICAgICAgICAgICAgICAgIHMucHVzaChlKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Ugbi5kb25lKCk7XG4gICAgICAgICAgICB9KSkubmV4dCgoKCkgPT4ge1xuICAgICAgICAgICAgICAgIFUoMCA9PT0gcy5sZW5ndGgpO1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIGNvbnRhaW5zS2V5KHQsIGUpIHtcbiAgICAgICAgcmV0dXJuIFRyKHQsIHRoaXMudXNlcklkLCBlKTtcbiAgICB9XG4gICAgLy8gUE9SVElORyBOT1RFOiBNdWx0aS10YWIgb25seSAoc3RhdGUgaXMgaGVsZCBpbiBtZW1vcnkgaW4gb3RoZXIgY2xpZW50cykuXG4gICAgLyoqIFJldHVybnMgdGhlIG11dGF0aW9uIHF1ZXVlJ3MgbWV0YWRhdGEgZnJvbSBJbmRleGVkRGIuICovXG4gICAgd24odCkge1xuICAgICAgICByZXR1cm4gUnIodCkuZ2V0KHRoaXMudXNlcklkKS5uZXh0KCh0ID0+IHQgfHwge1xuICAgICAgICAgICAgdXNlcklkOiB0aGlzLnVzZXJJZCxcbiAgICAgICAgICAgIGxhc3RBY2tub3dsZWRnZWRCYXRjaElkOiAtMSxcbiAgICAgICAgICAgIGxhc3RTdHJlYW1Ub2tlbjogXCJcIlxuICAgICAgICB9KSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEByZXR1cm5zIHRydWUgaWYgdGhlIG11dGF0aW9uIHF1ZXVlIGZvciB0aGUgZ2l2ZW4gdXNlciBjb250YWlucyBhIHBlbmRpbmdcbiAqICAgICAgICAgbXV0YXRpb24gZm9yIHRoZSBnaXZlbiBrZXkuXG4gKi8gZnVuY3Rpb24gVHIodCwgZSwgbikge1xuICAgIGNvbnN0IHMgPSBIcyhlLCBuLnBhdGgpLCBpID0gc1sxXSwgciA9IElEQktleVJhbmdlLmxvd2VyQm91bmQocyk7XG4gICAgbGV0IG8gPSAhMTtcbiAgICByZXR1cm4gQXIodCkuV3Qoe1xuICAgICAgICByYW5nZTogcixcbiAgICAgICAganQ6ICEwXG4gICAgfSwgKCh0LCBuLCBzKSA9PiB7XG4gICAgICAgIGNvbnN0IFtyLCB1LCAvKmJhdGNoSUQqLyBhXSA9IHQ7XG4gICAgICAgIHIgPT09IGUgJiYgdSA9PT0gaSAmJiAobyA9ICEwKSwgcy5kb25lKCk7XG4gICAgfSkpLm5leHQoKCgpID0+IG8pKTtcbn1cblxuLyoqIFJldHVybnMgdHJ1ZSBpZiBhbnkgbXV0YXRpb24gcXVldWUgY29udGFpbnMgdGhlIGdpdmVuIGRvY3VtZW50LiAqL1xuLyoqXG4gKiBIZWxwZXIgdG8gZ2V0IGEgdHlwZWQgU2ltcGxlRGJTdG9yZSBmb3IgdGhlIG11dGF0aW9ucyBvYmplY3Qgc3RvcmUuXG4gKi9cbmZ1bmN0aW9uIEVyKHQpIHtcbiAgICByZXR1cm4gU2kodCwgXCJtdXRhdGlvbnNcIik7XG59XG5cbi8qKlxuICogSGVscGVyIHRvIGdldCBhIHR5cGVkIFNpbXBsZURiU3RvcmUgZm9yIHRoZSBtdXRhdGlvblF1ZXVlcyBvYmplY3Qgc3RvcmUuXG4gKi8gZnVuY3Rpb24gQXIodCkge1xuICAgIHJldHVybiBTaSh0LCBcImRvY3VtZW50TXV0YXRpb25zXCIpO1xufVxuXG4vKipcbiAqIEhlbHBlciB0byBnZXQgYSB0eXBlZCBTaW1wbGVEYlN0b3JlIGZvciB0aGUgbXV0YXRpb25RdWV1ZXMgb2JqZWN0IHN0b3JlLlxuICovIGZ1bmN0aW9uIFJyKHQpIHtcbiAgICByZXR1cm4gU2kodCwgXCJtdXRhdGlvblF1ZXVlc1wiKTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKiBPZmZzZXQgdG8gZW5zdXJlIG5vbi1vdmVybGFwcGluZyB0YXJnZXQgaWRzLiAqL1xuLyoqXG4gKiBHZW5lcmF0ZXMgbW9ub3RvbmljYWxseSBpbmNyZWFzaW5nIHRhcmdldCBJRHMgZm9yIHNlbmRpbmcgdGFyZ2V0cyB0byB0aGVcbiAqIHdhdGNoIHN0cmVhbS5cbiAqXG4gKiBUaGUgY2xpZW50IGNvbnN0cnVjdHMgdHdvIGdlbmVyYXRvcnMsIG9uZSBmb3IgdGhlIHRhcmdldCBjYWNoZSwgYW5kIG9uZSBmb3JcbiAqIGZvciB0aGUgc3luYyBlbmdpbmUgKHRvIGdlbmVyYXRlIGxpbWJvIGRvY3VtZW50cyB0YXJnZXRzKS4gVGhlc2VcbiAqIGdlbmVyYXRvcnMgcHJvZHVjZSBub24tb3ZlcmxhcHBpbmcgSURzIChieSB1c2luZyBldmVuIGFuZCBvZGQgSURzXG4gKiByZXNwZWN0aXZlbHkpLlxuICpcbiAqIEJ5IHNlcGFyYXRpbmcgdGhlIHRhcmdldCBJRCBzcGFjZSwgdGhlIHF1ZXJ5IGNhY2hlIGNhbiBnZW5lcmF0ZSB0YXJnZXQgSURzXG4gKiB0aGF0IHBlcnNpc3QgYWNyb3NzIGNsaWVudCByZXN0YXJ0cywgd2hpbGUgc3luYyBlbmdpbmUgY2FuIGluZGVwZW5kZW50bHlcbiAqIGdlbmVyYXRlIGluLW1lbW9yeSB0YXJnZXQgSURzIHRoYXQgYXJlIHRyYW5zaWVudCBhbmQgY2FuIGJlIHJldXNlZCBhZnRlciBhXG4gKiByZXN0YXJ0LlxuICovXG5jbGFzcyBiciB7XG4gICAgY29uc3RydWN0b3IodCkge1xuICAgICAgICB0aGlzLm1uID0gdDtcbiAgICB9XG4gICAgbmV4dCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubW4gKz0gMiwgdGhpcy5tbjtcbiAgICB9XG4gICAgc3RhdGljIGduKCkge1xuICAgICAgICAvLyBUaGUgdGFyZ2V0IGNhY2hlIGdlbmVyYXRvciBtdXN0IHJldHVybiAnMicgaW4gaXRzIGZpcnN0IGNhbGwgdG8gYG5leHQoKWBcbiAgICAgICAgLy8gYXMgdGhlcmUgaXMgbm8gZGlmZmVyZW50aWF0aW9uIGluIHRoZSBwcm90b2NvbCBsYXllciBiZXR3ZWVuIGFuIHVuc2V0XG4gICAgICAgIC8vIG51bWJlciBhbmQgdGhlIG51bWJlciAnMCcuIElmIHdlIHdlcmUgdG8gc2VudCBhIHRhcmdldCB3aXRoIHRhcmdldCBJRFxuICAgICAgICAvLyAnMCcsIHRoZSBiYWNrZW5kIHdvdWxkIGNvbnNpZGVyIGl0IHVuc2V0IGFuZCByZXBsYWNlIGl0IHdpdGggaXRzIG93biBJRC5cbiAgICAgICAgcmV0dXJuIG5ldyBicigwKTtcbiAgICB9XG4gICAgc3RhdGljIHluKCkge1xuICAgICAgICAvLyBTeW5jIGVuZ2luZSBhc3NpZ25zIHRhcmdldCBJRHMgZm9yIGxpbWJvIGRvY3VtZW50IGRldGVjdGlvbi5cbiAgICAgICAgcmV0dXJuIG5ldyBicigtMSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqLyBjbGFzcyBQciB7XG4gICAgY29uc3RydWN0b3IodCwgZSkge1xuICAgICAgICB0aGlzLnJlZmVyZW5jZURlbGVnYXRlID0gdCwgdGhpcy5NID0gZTtcbiAgICB9XG4gICAgLy8gUE9SVElORyBOT1RFOiBXZSBkb24ndCBjYWNoZSBnbG9iYWwgbWV0YWRhdGEgZm9yIHRoZSB0YXJnZXQgY2FjaGUsIHNpbmNlXG4gICAgLy8gc29tZSBvZiBpdCAoaW4gcGFydGljdWxhciBgaGlnaGVzdFRhcmdldElkYCkgY2FuIGJlIG1vZGlmaWVkIGJ5IHNlY29uZGFyeVxuICAgIC8vIHRhYnMuIFdlIGNvdWxkIHBlcmhhcHMgYmUgbW9yZSBncmFudWxhciAoYW5kIGUuZy4gc3RpbGwgY2FjaGVcbiAgICAvLyBgbGFzdFJlbW90ZVNuYXBzaG90VmVyc2lvbmAgaW4gbWVtb3J5KSBidXQgZm9yIHNpbXBsaWNpdHkgd2UgY3VycmVudGx5IGdvXG4gICAgLy8gdG8gSW5kZXhlZERiIHdoZW5ldmVyIHdlIG5lZWQgdG8gcmVhZCBtZXRhZGF0YS4gV2UgY2FuIHJldmlzaXQgaWYgaXQgdHVybnNcbiAgICAvLyBvdXQgdG8gaGF2ZSBhIG1lYW5pbmdmdWwgcGVyZm9ybWFuY2UgaW1wYWN0LlxuICAgIGFsbG9jYXRlVGFyZ2V0SWQodCkge1xuICAgICAgICByZXR1cm4gdGhpcy5wbih0KS5uZXh0KChlID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSBuZXcgYnIoZS5oaWdoZXN0VGFyZ2V0SWQpO1xuICAgICAgICAgICAgcmV0dXJuIGUuaGlnaGVzdFRhcmdldElkID0gbi5uZXh0KCksIHRoaXMuSW4odCwgZSkubmV4dCgoKCkgPT4gZS5oaWdoZXN0VGFyZ2V0SWQpKTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICBnZXRMYXN0UmVtb3RlU25hcHNob3RWZXJzaW9uKHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucG4odCkubmV4dCgodCA9PiBjdC5mcm9tVGltZXN0YW1wKG5ldyBhdCh0Lmxhc3RSZW1vdGVTbmFwc2hvdFZlcnNpb24uc2Vjb25kcywgdC5sYXN0UmVtb3RlU25hcHNob3RWZXJzaW9uLm5hbm9zZWNvbmRzKSkpKTtcbiAgICB9XG4gICAgZ2V0SGlnaGVzdFNlcXVlbmNlTnVtYmVyKHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucG4odCkubmV4dCgodCA9PiB0LmhpZ2hlc3RMaXN0ZW5TZXF1ZW5jZU51bWJlcikpO1xuICAgIH1cbiAgICBzZXRUYXJnZXRzTWV0YWRhdGEodCwgZSwgbikge1xuICAgICAgICByZXR1cm4gdGhpcy5wbih0KS5uZXh0KChzID0+IChzLmhpZ2hlc3RMaXN0ZW5TZXF1ZW5jZU51bWJlciA9IGUsIG4gJiYgKHMubGFzdFJlbW90ZVNuYXBzaG90VmVyc2lvbiA9IG4udG9UaW1lc3RhbXAoKSksIFxuICAgICAgICBlID4gcy5oaWdoZXN0TGlzdGVuU2VxdWVuY2VOdW1iZXIgJiYgKHMuaGlnaGVzdExpc3RlblNlcXVlbmNlTnVtYmVyID0gZSksIHRoaXMuSW4odCwgcykpKSk7XG4gICAgfVxuICAgIGFkZFRhcmdldERhdGEodCwgZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5Ubih0LCBlKS5uZXh0KCgoKSA9PiB0aGlzLnBuKHQpLm5leHQoKG4gPT4gKG4udGFyZ2V0Q291bnQgKz0gMSwgdGhpcy5FbihlLCBuKSwgXG4gICAgICAgIHRoaXMuSW4odCwgbikpKSkpKTtcbiAgICB9XG4gICAgdXBkYXRlVGFyZ2V0RGF0YSh0LCBlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLlRuKHQsIGUpO1xuICAgIH1cbiAgICByZW1vdmVUYXJnZXREYXRhKHQsIGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucmVtb3ZlTWF0Y2hpbmdLZXlzRm9yVGFyZ2V0SWQodCwgZS50YXJnZXRJZCkubmV4dCgoKCkgPT4gVnIodCkuZGVsZXRlKGUudGFyZ2V0SWQpKSkubmV4dCgoKCkgPT4gdGhpcy5wbih0KSkpLm5leHQoKGUgPT4gKFUoZS50YXJnZXRDb3VudCA+IDApLCBcbiAgICAgICAgZS50YXJnZXRDb3VudCAtPSAxLCB0aGlzLkluKHQsIGUpKSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBEcm9wcyBhbnkgdGFyZ2V0cyB3aXRoIHNlcXVlbmNlIG51bWJlciBsZXNzIHRoYW4gb3IgZXF1YWwgdG8gdGhlIHVwcGVyIGJvdW5kLCBleGNlcHRpbmcgdGhvc2VcbiAgICAgKiBwcmVzZW50IGluIGBhY3RpdmVUYXJnZXRJZHNgLiBEb2N1bWVudCBhc3NvY2lhdGlvbnMgZm9yIHRoZSByZW1vdmVkIHRhcmdldHMgYXJlIGFsc28gcmVtb3ZlZC5cbiAgICAgKiBSZXR1cm5zIHRoZSBudW1iZXIgb2YgdGFyZ2V0cyByZW1vdmVkLlxuICAgICAqLyAgICByZW1vdmVUYXJnZXRzKHQsIGUsIG4pIHtcbiAgICAgICAgbGV0IHMgPSAwO1xuICAgICAgICBjb25zdCBpID0gW107XG4gICAgICAgIHJldHVybiBWcih0KS5XdCgoKHIsIG8pID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHUgPSBVaShvKTtcbiAgICAgICAgICAgIHUuc2VxdWVuY2VOdW1iZXIgPD0gZSAmJiBudWxsID09PSBuLmdldCh1LnRhcmdldElkKSAmJiAocysrLCBpLnB1c2godGhpcy5yZW1vdmVUYXJnZXREYXRhKHQsIHUpKSk7XG4gICAgICAgIH0pKS5uZXh0KCgoKSA9PiB5aS53YWl0Rm9yKGkpKSkubmV4dCgoKCkgPT4gcykpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDYWxsIHByb3ZpZGVkIGZ1bmN0aW9uIHdpdGggZWFjaCBgVGFyZ2V0RGF0YWAgdGhhdCB3ZSBoYXZlIGNhY2hlZC5cbiAgICAgKi8gICAgZm9yRWFjaFRhcmdldCh0LCBlKSB7XG4gICAgICAgIHJldHVybiBWcih0KS5XdCgoKHQsIG4pID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHMgPSBVaShuKTtcbiAgICAgICAgICAgIGUocyk7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgcG4odCkge1xuICAgICAgICByZXR1cm4gdnIodCkuZ2V0KFwidGFyZ2V0R2xvYmFsS2V5XCIpLm5leHQoKHQgPT4gKFUobnVsbCAhPT0gdCksIHQpKSk7XG4gICAgfVxuICAgIEluKHQsIGUpIHtcbiAgICAgICAgcmV0dXJuIHZyKHQpLnB1dChcInRhcmdldEdsb2JhbEtleVwiLCBlKTtcbiAgICB9XG4gICAgVG4odCwgZSkge1xuICAgICAgICByZXR1cm4gVnIodCkucHV0KHFpKHRoaXMuTSwgZSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBJbi1wbGFjZSB1cGRhdGVzIHRoZSBwcm92aWRlZCBtZXRhZGF0YSB0byBhY2NvdW50IGZvciB2YWx1ZXMgaW4gdGhlIGdpdmVuXG4gICAgICogVGFyZ2V0RGF0YS4gU2F2aW5nIGlzIGRvbmUgc2VwYXJhdGVseS4gUmV0dXJucyB0cnVlIGlmIHRoZXJlIHdlcmUgYW55XG4gICAgICogY2hhbmdlcyB0byB0aGUgbWV0YWRhdGEuXG4gICAgICovICAgIEVuKHQsIGUpIHtcbiAgICAgICAgbGV0IG4gPSAhMTtcbiAgICAgICAgcmV0dXJuIHQudGFyZ2V0SWQgPiBlLmhpZ2hlc3RUYXJnZXRJZCAmJiAoZS5oaWdoZXN0VGFyZ2V0SWQgPSB0LnRhcmdldElkLCBuID0gITApLCBcbiAgICAgICAgdC5zZXF1ZW5jZU51bWJlciA+IGUuaGlnaGVzdExpc3RlblNlcXVlbmNlTnVtYmVyICYmIChlLmhpZ2hlc3RMaXN0ZW5TZXF1ZW5jZU51bWJlciA9IHQuc2VxdWVuY2VOdW1iZXIsIFxuICAgICAgICBuID0gITApLCBuO1xuICAgIH1cbiAgICBnZXRUYXJnZXRDb3VudCh0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLnBuKHQpLm5leHQoKHQgPT4gdC50YXJnZXRDb3VudCkpO1xuICAgIH1cbiAgICBnZXRUYXJnZXREYXRhKHQsIGUpIHtcbiAgICAgICAgLy8gSXRlcmF0aW5nIGJ5IHRoZSBjYW5vbmljYWxJZCBtYXkgeWllbGQgbW9yZSB0aGFuIG9uZSByZXN1bHQgYmVjYXVzZVxuICAgICAgICAvLyBjYW5vbmljYWxJZCB2YWx1ZXMgYXJlIG5vdCByZXF1aXJlZCB0byBiZSB1bmlxdWUgcGVyIHRhcmdldC4gVGhpcyBxdWVyeVxuICAgICAgICAvLyBkZXBlbmRzIG9uIHRoZSBxdWVyeVRhcmdldHMgaW5kZXggdG8gYmUgZWZmaWNpZW50LlxuICAgICAgICBjb25zdCBuID0gSWUoZSksIHMgPSBJREJLZXlSYW5nZS5ib3VuZChbIG4sIE51bWJlci5ORUdBVElWRV9JTkZJTklUWSBdLCBbIG4sIE51bWJlci5QT1NJVElWRV9JTkZJTklUWSBdKTtcbiAgICAgICAgbGV0IGkgPSBudWxsO1xuICAgICAgICByZXR1cm4gVnIodCkuV3Qoe1xuICAgICAgICAgICAgcmFuZ2U6IHMsXG4gICAgICAgICAgICBpbmRleDogXCJxdWVyeVRhcmdldHNJbmRleFwiXG4gICAgICAgIH0sICgodCwgbiwgcykgPT4ge1xuICAgICAgICAgICAgY29uc3QgciA9IFVpKG4pO1xuICAgICAgICAgICAgLy8gQWZ0ZXIgZmluZGluZyBhIHBvdGVudGlhbCBtYXRjaCwgY2hlY2sgdGhhdCB0aGUgdGFyZ2V0IGlzXG4gICAgICAgICAgICAvLyBhY3R1YWxseSBlcXVhbCB0byB0aGUgcmVxdWVzdGVkIHRhcmdldC5cbiAgICAgICAgICAgICAgICAgICAgICAgIEVlKGUsIHIudGFyZ2V0KSAmJiAoaSA9IHIsIHMuZG9uZSgpKTtcbiAgICAgICAgfSkpLm5leHQoKCgpID0+IGkpKTtcbiAgICB9XG4gICAgYWRkTWF0Y2hpbmdLZXlzKHQsIGUsIG4pIHtcbiAgICAgICAgLy8gUE9SVElORyBOT1RFOiBUaGUgcmV2ZXJzZSBpbmRleCAoZG9jdW1lbnRzVGFyZ2V0cykgaXMgbWFpbnRhaW5lZCBieVxuICAgICAgICAvLyBJbmRleGVkRGIuXG4gICAgICAgIGNvbnN0IHMgPSBbXSwgaSA9IFNyKHQpO1xuICAgICAgICByZXR1cm4gZS5mb3JFYWNoKChlID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHIgPSBHcyhlLnBhdGgpO1xuICAgICAgICAgICAgcy5wdXNoKGkucHV0KHtcbiAgICAgICAgICAgICAgICB0YXJnZXRJZDogbixcbiAgICAgICAgICAgICAgICBwYXRoOiByXG4gICAgICAgICAgICB9KSksIHMucHVzaCh0aGlzLnJlZmVyZW5jZURlbGVnYXRlLmFkZFJlZmVyZW5jZSh0LCBuLCBlKSk7XG4gICAgICAgIH0pKSwgeWkud2FpdEZvcihzKTtcbiAgICB9XG4gICAgcmVtb3ZlTWF0Y2hpbmdLZXlzKHQsIGUsIG4pIHtcbiAgICAgICAgLy8gUE9SVElORyBOT1RFOiBUaGUgcmV2ZXJzZSBpbmRleCAoZG9jdW1lbnRzVGFyZ2V0cykgaXMgbWFpbnRhaW5lZCBieVxuICAgICAgICAvLyBJbmRleGVkRGIuXG4gICAgICAgIGNvbnN0IHMgPSBTcih0KTtcbiAgICAgICAgcmV0dXJuIHlpLmZvckVhY2goZSwgKGUgPT4ge1xuICAgICAgICAgICAgY29uc3QgaSA9IEdzKGUucGF0aCk7XG4gICAgICAgICAgICByZXR1cm4geWkud2FpdEZvcihbIHMuZGVsZXRlKFsgbiwgaSBdKSwgdGhpcy5yZWZlcmVuY2VEZWxlZ2F0ZS5yZW1vdmVSZWZlcmVuY2UodCwgbiwgZSkgXSk7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgcmVtb3ZlTWF0Y2hpbmdLZXlzRm9yVGFyZ2V0SWQodCwgZSkge1xuICAgICAgICBjb25zdCBuID0gU3IodCksIHMgPSBJREJLZXlSYW5nZS5ib3VuZChbIGUgXSwgWyBlICsgMSBdLCBcbiAgICAgICAgLypsb3dlck9wZW49Ki8gITEsIFxuICAgICAgICAvKnVwcGVyT3Blbj0qLyAhMCk7XG4gICAgICAgIHJldHVybiBuLmRlbGV0ZShzKTtcbiAgICB9XG4gICAgZ2V0TWF0Y2hpbmdLZXlzRm9yVGFyZ2V0SWQodCwgZSkge1xuICAgICAgICBjb25zdCBuID0gSURCS2V5UmFuZ2UuYm91bmQoWyBlIF0sIFsgZSArIDEgXSwgXG4gICAgICAgIC8qbG93ZXJPcGVuPSovICExLCBcbiAgICAgICAgLyp1cHBlck9wZW49Ki8gITApLCBzID0gU3IodCk7XG4gICAgICAgIGxldCBpID0gWW4oKTtcbiAgICAgICAgcmV0dXJuIHMuV3Qoe1xuICAgICAgICAgICAgcmFuZ2U6IG4sXG4gICAgICAgICAgICBqdDogITBcbiAgICAgICAgfSwgKCh0LCBlLCBuKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBzID0gV3ModFsxXSksIHIgPSBuZXcgeHQocyk7XG4gICAgICAgICAgICBpID0gaS5hZGQocik7XG4gICAgICAgIH0pKS5uZXh0KCgoKSA9PiBpKSk7XG4gICAgfVxuICAgIGNvbnRhaW5zS2V5KHQsIGUpIHtcbiAgICAgICAgY29uc3QgbiA9IEdzKGUucGF0aCksIHMgPSBJREJLZXlSYW5nZS5ib3VuZChbIG4gXSwgWyB1dChuKSBdLCBcbiAgICAgICAgLypsb3dlck9wZW49Ki8gITEsIFxuICAgICAgICAvKnVwcGVyT3Blbj0qLyAhMCk7XG4gICAgICAgIGxldCBpID0gMDtcbiAgICAgICAgcmV0dXJuIFNyKHQpLld0KHtcbiAgICAgICAgICAgIGluZGV4OiBcImRvY3VtZW50VGFyZ2V0c0luZGV4XCIsXG4gICAgICAgICAgICBqdDogITAsXG4gICAgICAgICAgICByYW5nZTogc1xuICAgICAgICB9LCAoKFt0LCBlXSwgbiwgcykgPT4ge1xuICAgICAgICAgICAgLy8gSGF2aW5nIGEgc2VudGluZWwgcm93IGZvciBhIGRvY3VtZW50IGRvZXMgbm90IGNvdW50IGFzIGNvbnRhaW5pbmcgdGhhdCBkb2N1bWVudDtcbiAgICAgICAgICAgIC8vIEZvciB0aGUgdGFyZ2V0IGNhY2hlLCBjb250YWluaW5nIHRoZSBkb2N1bWVudCBtZWFucyB0aGUgZG9jdW1lbnQgaXMgcGFydCBvZiBzb21lXG4gICAgICAgICAgICAvLyB0YXJnZXQuXG4gICAgICAgICAgICAwICE9PSB0ICYmIChpKyssIHMuZG9uZSgpKTtcbiAgICAgICAgfSkpLm5leHQoKCgpID0+IGkgPiAwKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIExvb2tzIHVwIGEgVGFyZ2V0RGF0YSBlbnRyeSBieSB0YXJnZXQgSUQuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gdGFyZ2V0SWQgLSBUaGUgdGFyZ2V0IElEIG9mIHRoZSBUYXJnZXREYXRhIGVudHJ5IHRvIGxvb2sgdXAuXG4gICAgICogQHJldHVybnMgVGhlIGNhY2hlZCBUYXJnZXREYXRhIGVudHJ5LCBvciBudWxsIGlmIHRoZSBjYWNoZSBoYXMgbm8gZW50cnkgZm9yXG4gICAgICogdGhlIHRhcmdldC5cbiAgICAgKi9cbiAgICAvLyBQT1JUSU5HIE5PVEU6IE11bHRpLXRhYiBvbmx5LlxuICAgIEV0KHQsIGUpIHtcbiAgICAgICAgcmV0dXJuIFZyKHQpLmdldChlKS5uZXh0KCh0ID0+IHQgPyBVaSh0KSA6IG51bGwpKTtcbiAgICB9XG59XG5cbi8qKlxuICogSGVscGVyIHRvIGdldCBhIHR5cGVkIFNpbXBsZURiU3RvcmUgZm9yIHRoZSBxdWVyaWVzIG9iamVjdCBzdG9yZS5cbiAqLyBmdW5jdGlvbiBWcih0KSB7XG4gICAgcmV0dXJuIFNpKHQsIFwidGFyZ2V0c1wiKTtcbn1cblxuLyoqXG4gKiBIZWxwZXIgdG8gZ2V0IGEgdHlwZWQgU2ltcGxlRGJTdG9yZSBmb3IgdGhlIHRhcmdldCBnbG9iYWxzIG9iamVjdCBzdG9yZS5cbiAqLyBmdW5jdGlvbiB2cih0KSB7XG4gICAgcmV0dXJuIFNpKHQsIFwidGFyZ2V0R2xvYmFsXCIpO1xufVxuXG4vKipcbiAqIEhlbHBlciB0byBnZXQgYSB0eXBlZCBTaW1wbGVEYlN0b3JlIGZvciB0aGUgZG9jdW1lbnQgdGFyZ2V0IG9iamVjdCBzdG9yZS5cbiAqLyBmdW5jdGlvbiBTcih0KSB7XG4gICAgcmV0dXJuIFNpKHQsIFwidGFyZ2V0RG9jdW1lbnRzXCIpO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBWZXJpZmllcyB0aGUgZXJyb3IgdGhyb3duIGJ5IGEgTG9jYWxTdG9yZSBvcGVyYXRpb24uIElmIGEgTG9jYWxTdG9yZVxuICogb3BlcmF0aW9uIGZhaWxzIGJlY2F1c2UgdGhlIHByaW1hcnkgbGVhc2UgaGFzIGJlZW4gdGFrZW4gYnkgYW5vdGhlciBjbGllbnQsXG4gKiB3ZSBpZ25vcmUgdGhlIGVycm9yICh0aGUgcGVyc2lzdGVuY2UgbGF5ZXIgd2lsbCBpbW1lZGlhdGVseSBjYWxsXG4gKiBgYXBwbHlQcmltYXJ5TGVhc2VgIHRvIHByb3BhZ2F0ZSB0aGUgcHJpbWFyeSBzdGF0ZSBjaGFuZ2UpLiBBbGwgb3RoZXIgZXJyb3JzXG4gKiBhcmUgcmUtdGhyb3duLlxuICpcbiAqIEBwYXJhbSBlcnIgLSBBbiBlcnJvciByZXR1cm5lZCBieSBhIExvY2FsU3RvcmUgb3BlcmF0aW9uLlxuICogQHJldHVybnMgQSBQcm9taXNlIHRoYXQgcmVzb2x2ZXMgYWZ0ZXIgd2UgcmVjb3ZlcmVkLCBvciB0aGUgb3JpZ2luYWwgZXJyb3IuXG4gKi8gYXN5bmMgZnVuY3Rpb24gRHIodCkge1xuICAgIGlmICh0LmNvZGUgIT09IEcuRkFJTEVEX1BSRUNPTkRJVElPTiB8fCB0Lm1lc3NhZ2UgIT09IG1pKSB0aHJvdyB0O1xuICAgIE8oXCJMb2NhbFN0b3JlXCIsIFwiVW5leHBlY3RlZGx5IGxvc3QgcHJpbWFyeSBsZWFzZVwiKTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi8gZnVuY3Rpb24gQ3IoW3QsIGVdLCBbbiwgc10pIHtcbiAgICBjb25zdCBpID0gcnQodCwgbik7XG4gICAgcmV0dXJuIDAgPT09IGkgPyBydChlLCBzKSA6IGk7XG59XG5cbi8qKlxuICogVXNlZCB0byBjYWxjdWxhdGUgdGhlIG50aCBzZXF1ZW5jZSBudW1iZXIuIEtlZXBzIGEgcm9sbGluZyBidWZmZXIgb2YgdGhlXG4gKiBsb3dlc3QgbiB2YWx1ZXMgcGFzc2VkIHRvIGBhZGRFbGVtZW50YCwgYW5kIGZpbmFsbHkgcmVwb3J0cyB0aGUgbGFyZ2VzdCBvZlxuICogdGhlbSBpbiBgbWF4VmFsdWVgLlxuICovIGNsYXNzIHhyIHtcbiAgICBjb25zdHJ1Y3Rvcih0KSB7XG4gICAgICAgIHRoaXMuQW4gPSB0LCB0aGlzLmJ1ZmZlciA9IG5ldyB3ZShDciksIHRoaXMuUm4gPSAwO1xuICAgIH1cbiAgICBibigpIHtcbiAgICAgICAgcmV0dXJuICsrdGhpcy5SbjtcbiAgICB9XG4gICAgUG4odCkge1xuICAgICAgICBjb25zdCBlID0gWyB0LCB0aGlzLmJuKCkgXTtcbiAgICAgICAgaWYgKHRoaXMuYnVmZmVyLnNpemUgPCB0aGlzLkFuKSB0aGlzLmJ1ZmZlciA9IHRoaXMuYnVmZmVyLmFkZChlKTsgZWxzZSB7XG4gICAgICAgICAgICBjb25zdCB0ID0gdGhpcy5idWZmZXIubGFzdCgpO1xuICAgICAgICAgICAgQ3IoZSwgdCkgPCAwICYmICh0aGlzLmJ1ZmZlciA9IHRoaXMuYnVmZmVyLmRlbGV0ZSh0KS5hZGQoZSkpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGdldCBtYXhWYWx1ZSgpIHtcbiAgICAgICAgLy8gR3VhcmFudGVlZCB0byBiZSBub24tZW1wdHkuIElmIHdlIGRlY2lkZSB3ZSBhcmUgbm90IGNvbGxlY3RpbmcgYW55XG4gICAgICAgIC8vIHNlcXVlbmNlIG51bWJlcnMsIG50aFNlcXVlbmNlTnVtYmVyIGJlbG93IHNob3J0LWNpcmN1aXRzLiBJZiB3ZSBoYXZlXG4gICAgICAgIC8vIGRlY2lkZWQgdGhhdCB3ZSBhcmUgY29sbGVjdGluZyBuIHNlcXVlbmNlIG51bWJlcnMsIGl0J3MgYmVjYXVzZSBuIGlzIHNvbWVcbiAgICAgICAgLy8gcGVyY2VudGFnZSBvZiB0aGUgZXhpc3Rpbmcgc2VxdWVuY2UgbnVtYmVycy4gVGhhdCBtZWFucyB3ZSBzaG91bGQgbmV2ZXJcbiAgICAgICAgLy8gYmUgaW4gYSBzaXR1YXRpb24gd2hlcmUgd2UgYXJlIGNvbGxlY3Rpbmcgc2VxdWVuY2UgbnVtYmVycyBidXQgZG9uJ3RcbiAgICAgICAgLy8gYWN0dWFsbHkgaGF2ZSBhbnkuXG4gICAgICAgIHJldHVybiB0aGlzLmJ1ZmZlci5sYXN0KClbMF07XG4gICAgfVxufVxuXG4vKipcbiAqIFRoaXMgY2xhc3MgaXMgcmVzcG9uc2libGUgZm9yIHRoZSBzY2hlZHVsaW5nIG9mIExSVSBnYXJiYWdlIGNvbGxlY3Rpb24uIEl0IGhhbmRsZXMgY2hlY2tpbmdcbiAqIHdoZXRoZXIgb3Igbm90IEdDIGlzIGVuYWJsZWQsIGFzIHdlbGwgYXMgd2hpY2ggZGVsYXkgdG8gdXNlIGJlZm9yZSB0aGUgbmV4dCBydW4uXG4gKi8gY2xhc3MgTnIge1xuICAgIGNvbnN0cnVjdG9yKHQsIGUpIHtcbiAgICAgICAgdGhpcy5nYXJiYWdlQ29sbGVjdG9yID0gdCwgdGhpcy5hc3luY1F1ZXVlID0gZSwgdGhpcy5WbiA9ICExLCB0aGlzLnZuID0gbnVsbDtcbiAgICB9XG4gICAgc3RhcnQodCkge1xuICAgICAgICAtMSAhPT0gdGhpcy5nYXJiYWdlQ29sbGVjdG9yLnBhcmFtcy5jYWNoZVNpemVDb2xsZWN0aW9uVGhyZXNob2xkICYmIHRoaXMuU24odCk7XG4gICAgfVxuICAgIHN0b3AoKSB7XG4gICAgICAgIHRoaXMudm4gJiYgKHRoaXMudm4uY2FuY2VsKCksIHRoaXMudm4gPSBudWxsKTtcbiAgICB9XG4gICAgZ2V0IHN0YXJ0ZWQoKSB7XG4gICAgICAgIHJldHVybiBudWxsICE9PSB0aGlzLnZuO1xuICAgIH1cbiAgICBTbih0KSB7XG4gICAgICAgIGNvbnN0IGUgPSB0aGlzLlZuID8gM2U1IDogNmU0O1xuICAgICAgICBPKFwiTHJ1R2FyYmFnZUNvbGxlY3RvclwiLCBgR2FyYmFnZSBjb2xsZWN0aW9uIHNjaGVkdWxlZCBpbiAke2V9bXNgKSwgdGhpcy52biA9IHRoaXMuYXN5bmNRdWV1ZS5lbnF1ZXVlQWZ0ZXJEZWxheShcImxydV9nYXJiYWdlX2NvbGxlY3Rpb25cIiAvKiBMcnVHYXJiYWdlQ29sbGVjdGlvbiAqLyAsIGUsIChhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnZuID0gbnVsbCwgdGhpcy5WbiA9ICEwO1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBhd2FpdCB0LmNvbGxlY3RHYXJiYWdlKHRoaXMuZ2FyYmFnZUNvbGxlY3Rvcik7XG4gICAgICAgICAgICB9IGNhdGNoICh0KSB7XG4gICAgICAgICAgICAgICAgQWkodCkgPyBPKFwiTHJ1R2FyYmFnZUNvbGxlY3RvclwiLCBcIklnbm9yaW5nIEluZGV4ZWREQiBlcnJvciBkdXJpbmcgZ2FyYmFnZSBjb2xsZWN0aW9uOiBcIiwgdCkgOiBhd2FpdCBEcih0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGF3YWl0IHRoaXMuU24odCk7XG4gICAgICAgIH0pKTtcbiAgICB9XG59XG5cbi8qKiBJbXBsZW1lbnRzIHRoZSBzdGVwcyBmb3IgTFJVIGdhcmJhZ2UgY29sbGVjdGlvbi4gKi8gY2xhc3Mga3Ige1xuICAgIGNvbnN0cnVjdG9yKHQsIGUpIHtcbiAgICAgICAgdGhpcy5EbiA9IHQsIHRoaXMucGFyYW1zID0gZTtcbiAgICB9XG4gICAgY2FsY3VsYXRlVGFyZ2V0Q291bnQodCwgZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5Ebi5Dbih0KS5uZXh0KCh0ID0+IE1hdGguZmxvb3IoZSAvIDEwMCAqIHQpKSk7XG4gICAgfVxuICAgIG50aFNlcXVlbmNlTnVtYmVyKHQsIGUpIHtcbiAgICAgICAgaWYgKDAgPT09IGUpIHJldHVybiB5aS5yZXNvbHZlKG50LkEpO1xuICAgICAgICBjb25zdCBuID0gbmV3IHhyKGUpO1xuICAgICAgICByZXR1cm4gdGhpcy5Ebi5mb3JFYWNoVGFyZ2V0KHQsICh0ID0+IG4uUG4odC5zZXF1ZW5jZU51bWJlcikpKS5uZXh0KCgoKSA9PiB0aGlzLkRuLnhuKHQsICh0ID0+IG4uUG4odCkpKSkpLm5leHQoKCgpID0+IG4ubWF4VmFsdWUpKTtcbiAgICB9XG4gICAgcmVtb3ZlVGFyZ2V0cyh0LCBlLCBuKSB7XG4gICAgICAgIHJldHVybiB0aGlzLkRuLnJlbW92ZVRhcmdldHModCwgZSwgbik7XG4gICAgfVxuICAgIHJlbW92ZU9ycGhhbmVkRG9jdW1lbnRzKHQsIGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuRG4ucmVtb3ZlT3JwaGFuZWREb2N1bWVudHModCwgZSk7XG4gICAgfVxuICAgIGNvbGxlY3QodCwgZSkge1xuICAgICAgICByZXR1cm4gLTEgPT09IHRoaXMucGFyYW1zLmNhY2hlU2l6ZUNvbGxlY3Rpb25UaHJlc2hvbGQgPyAoTyhcIkxydUdhcmJhZ2VDb2xsZWN0b3JcIiwgXCJHYXJiYWdlIGNvbGxlY3Rpb24gc2tpcHBlZDsgZGlzYWJsZWRcIiksIFxuICAgICAgICB5aS5yZXNvbHZlKG1yKSkgOiB0aGlzLmdldENhY2hlU2l6ZSh0KS5uZXh0KChuID0+IG4gPCB0aGlzLnBhcmFtcy5jYWNoZVNpemVDb2xsZWN0aW9uVGhyZXNob2xkID8gKE8oXCJMcnVHYXJiYWdlQ29sbGVjdG9yXCIsIGBHYXJiYWdlIGNvbGxlY3Rpb24gc2tpcHBlZDsgQ2FjaGUgc2l6ZSAke259IGlzIGxvd2VyIHRoYW4gdGhyZXNob2xkICR7dGhpcy5wYXJhbXMuY2FjaGVTaXplQ29sbGVjdGlvblRocmVzaG9sZH1gKSwgXG4gICAgICAgIG1yKSA6IHRoaXMuTm4odCwgZSkpKTtcbiAgICB9XG4gICAgZ2V0Q2FjaGVTaXplKHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuRG4uZ2V0Q2FjaGVTaXplKHQpO1xuICAgIH1cbiAgICBObih0LCBlKSB7XG4gICAgICAgIGxldCBuLCBzLCBpLCByLCBvLCBhLCBjO1xuICAgICAgICBjb25zdCBoID0gRGF0ZS5ub3coKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2FsY3VsYXRlVGFyZ2V0Q291bnQodCwgdGhpcy5wYXJhbXMucGVyY2VudGlsZVRvQ29sbGVjdCkubmV4dCgoZSA9PiAoXG4gICAgICAgIC8vIENhcCBhdCB0aGUgY29uZmlndXJlZCBtYXhcbiAgICAgICAgZSA+IHRoaXMucGFyYW1zLm1heGltdW1TZXF1ZW5jZU51bWJlcnNUb0NvbGxlY3QgPyAoTyhcIkxydUdhcmJhZ2VDb2xsZWN0b3JcIiwgYENhcHBpbmcgc2VxdWVuY2UgbnVtYmVycyB0byBjb2xsZWN0IGRvd24gdG8gdGhlIG1heGltdW0gb2YgJHt0aGlzLnBhcmFtcy5tYXhpbXVtU2VxdWVuY2VOdW1iZXJzVG9Db2xsZWN0fSBmcm9tICR7ZX1gKSwgXG4gICAgICAgIHMgPSB0aGlzLnBhcmFtcy5tYXhpbXVtU2VxdWVuY2VOdW1iZXJzVG9Db2xsZWN0KSA6IHMgPSBlLCByID0gRGF0ZS5ub3coKSwgdGhpcy5udGhTZXF1ZW5jZU51bWJlcih0LCBzKSkpKS5uZXh0KChzID0+IChuID0gcywgXG4gICAgICAgIG8gPSBEYXRlLm5vdygpLCB0aGlzLnJlbW92ZVRhcmdldHModCwgbiwgZSkpKSkubmV4dCgoZSA9PiAoaSA9IGUsIGEgPSBEYXRlLm5vdygpLCBcbiAgICAgICAgdGhpcy5yZW1vdmVPcnBoYW5lZERvY3VtZW50cyh0LCBuKSkpKS5uZXh0KCh0ID0+IHtcbiAgICAgICAgICAgIGlmIChjID0gRGF0ZS5ub3coKSwgaygpIDw9IHUuREVCVUcpIHtcbiAgICAgICAgICAgICAgICBPKFwiTHJ1R2FyYmFnZUNvbGxlY3RvclwiLCBgTFJVIEdhcmJhZ2UgQ29sbGVjdGlvblxcblxcdENvdW50ZWQgdGFyZ2V0cyBpbiAke3IgLSBofW1zXFxuXFx0RGV0ZXJtaW5lZCBsZWFzdCByZWNlbnRseSB1c2VkICR7c30gaW4gYCArIChvIC0gcikgKyBcIm1zXFxuXCIgKyBgXFx0UmVtb3ZlZCAke2l9IHRhcmdldHMgaW4gYCArIChhIC0gbykgKyBcIm1zXFxuXCIgKyBgXFx0UmVtb3ZlZCAke3R9IGRvY3VtZW50cyBpbiBgICsgKGMgLSBhKSArIFwibXNcXG5cIiArIGBUb3RhbCBEdXJhdGlvbjogJHtjIC0gaH1tc2ApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHlpLnJlc29sdmUoe1xuICAgICAgICAgICAgICAgIGRpZFJ1bjogITAsXG4gICAgICAgICAgICAgICAgc2VxdWVuY2VOdW1iZXJzQ29sbGVjdGVkOiBzLFxuICAgICAgICAgICAgICAgIHRhcmdldHNSZW1vdmVkOiBpLFxuICAgICAgICAgICAgICAgIGRvY3VtZW50c1JlbW92ZWQ6IHRcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqIFByb3ZpZGVzIExSVSBmdW5jdGlvbmFsaXR5IGZvciBJbmRleGVkREIgcGVyc2lzdGVuY2UuICovXG5jbGFzcyBNciB7XG4gICAgY29uc3RydWN0b3IodCwgZSkge1xuICAgICAgICB0aGlzLmRiID0gdCwgdGhpcy5nYXJiYWdlQ29sbGVjdG9yID0gZnVuY3Rpb24odCwgZSkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBrcih0LCBlKTtcbiAgICAgICAgfSh0aGlzLCBlKTtcbiAgICB9XG4gICAgQ24odCkge1xuICAgICAgICBjb25zdCBlID0gdGhpcy5rbih0KTtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGIuZ2V0VGFyZ2V0Q2FjaGUoKS5nZXRUYXJnZXRDb3VudCh0KS5uZXh0KCh0ID0+IGUubmV4dCgoZSA9PiB0ICsgZSkpKSk7XG4gICAgfVxuICAgIGtuKHQpIHtcbiAgICAgICAgbGV0IGUgPSAwO1xuICAgICAgICByZXR1cm4gdGhpcy54bih0LCAodCA9PiB7XG4gICAgICAgICAgICBlKys7XG4gICAgICAgIH0pKS5uZXh0KCgoKSA9PiBlKSk7XG4gICAgfVxuICAgIGZvckVhY2hUYXJnZXQodCwgZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5kYi5nZXRUYXJnZXRDYWNoZSgpLmZvckVhY2hUYXJnZXQodCwgZSk7XG4gICAgfVxuICAgIHhuKHQsIGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuTW4odCwgKCh0LCBuKSA9PiBlKG4pKSk7XG4gICAgfVxuICAgIGFkZFJlZmVyZW5jZSh0LCBlLCBuKSB7XG4gICAgICAgIHJldHVybiBPcih0LCBuKTtcbiAgICB9XG4gICAgcmVtb3ZlUmVmZXJlbmNlKHQsIGUsIG4pIHtcbiAgICAgICAgcmV0dXJuIE9yKHQsIG4pO1xuICAgIH1cbiAgICByZW1vdmVUYXJnZXRzKHQsIGUsIG4pIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGIuZ2V0VGFyZ2V0Q2FjaGUoKS5yZW1vdmVUYXJnZXRzKHQsIGUsIG4pO1xuICAgIH1cbiAgICBtYXJrUG90ZW50aWFsbHlPcnBoYW5lZCh0LCBlKSB7XG4gICAgICAgIHJldHVybiBPcih0LCBlKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0cnVlIGlmIGFueXRoaW5nIHdvdWxkIHByZXZlbnQgdGhpcyBkb2N1bWVudCBmcm9tIGJlaW5nIGdhcmJhZ2VcbiAgICAgKiBjb2xsZWN0ZWQsIGdpdmVuIHRoYXQgdGhlIGRvY3VtZW50IGluIHF1ZXN0aW9uIGlzIG5vdCBwcmVzZW50IGluIGFueVxuICAgICAqIHRhcmdldHMgYW5kIGhhcyBhIHNlcXVlbmNlIG51bWJlciBsZXNzIHRoYW4gb3IgZXF1YWwgdG8gdGhlIHVwcGVyIGJvdW5kIGZvclxuICAgICAqIHRoZSBjb2xsZWN0aW9uIHJ1bi5cbiAgICAgKi8gICAgT24odCwgZSkge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24odCwgZSkge1xuICAgICAgICAgICAgbGV0IG4gPSAhMTtcbiAgICAgICAgICAgIHJldHVybiBScih0KS56dCgocyA9PiBUcih0LCBzLCBlKS5uZXh0KCh0ID0+ICh0ICYmIChuID0gITApLCB5aS5yZXNvbHZlKCF0KSkpKSkpLm5leHQoKCgpID0+IG4pKTtcbiAgICAgICAgfSh0LCBlKTtcbiAgICB9XG4gICAgcmVtb3ZlT3JwaGFuZWREb2N1bWVudHModCwgZSkge1xuICAgICAgICBjb25zdCBuID0gdGhpcy5kYi5nZXRSZW1vdGVEb2N1bWVudENhY2hlKCkubmV3Q2hhbmdlQnVmZmVyKCksIHMgPSBbXTtcbiAgICAgICAgbGV0IGkgPSAwO1xuICAgICAgICByZXR1cm4gdGhpcy5Nbih0LCAoKHIsIG8pID0+IHtcbiAgICAgICAgICAgIGlmIChvIDw9IGUpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBlID0gdGhpcy5Pbih0LCByKS5uZXh0KChlID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFlKSBcbiAgICAgICAgICAgICAgICAgICAgLy8gT3VyIHNpemUgYWNjb3VudGluZyByZXF1aXJlcyB1cyB0byByZWFkIGFsbCBkb2N1bWVudHMgYmVmb3JlXG4gICAgICAgICAgICAgICAgICAgIC8vIHJlbW92aW5nIHRoZW0uXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpKyssIG4uZ2V0RW50cnkodCwgcikubmV4dCgoKCkgPT4gKG4ucmVtb3ZlRW50cnkociwgY3QubWluKCkpLCBTcih0KS5kZWxldGUoWyAwLCBHcyhyLnBhdGgpIF0pKSkpO1xuICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgICAgICBzLnB1c2goZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pKS5uZXh0KCgoKSA9PiB5aS53YWl0Rm9yKHMpKSkubmV4dCgoKCkgPT4gbi5hcHBseSh0KSkpLm5leHQoKCgpID0+IGkpKTtcbiAgICB9XG4gICAgcmVtb3ZlVGFyZ2V0KHQsIGUpIHtcbiAgICAgICAgY29uc3QgbiA9IGUud2l0aFNlcXVlbmNlTnVtYmVyKHQuY3VycmVudFNlcXVlbmNlTnVtYmVyKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGIuZ2V0VGFyZ2V0Q2FjaGUoKS51cGRhdGVUYXJnZXREYXRhKHQsIG4pO1xuICAgIH1cbiAgICB1cGRhdGVMaW1ib0RvY3VtZW50KHQsIGUpIHtcbiAgICAgICAgcmV0dXJuIE9yKHQsIGUpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDYWxsIHByb3ZpZGVkIGZ1bmN0aW9uIGZvciBlYWNoIGRvY3VtZW50IGluIHRoZSBjYWNoZSB0aGF0IGlzICdvcnBoYW5lZCcuIE9ycGhhbmVkXG4gICAgICogbWVhbnMgbm90IGEgcGFydCBvZiBhbnkgdGFyZ2V0LCBzbyB0aGUgb25seSBlbnRyeSBpbiB0aGUgdGFyZ2V0LWRvY3VtZW50IGluZGV4IGZvclxuICAgICAqIHRoYXQgZG9jdW1lbnQgd2lsbCBiZSB0aGUgc2VudGluZWwgcm93ICh0YXJnZXRJZCAwKSwgd2hpY2ggd2lsbCBhbHNvIGhhdmUgdGhlIHNlcXVlbmNlXG4gICAgICogbnVtYmVyIGZvciB0aGUgbGFzdCB0aW1lIHRoZSBkb2N1bWVudCB3YXMgYWNjZXNzZWQuXG4gICAgICovICAgIE1uKHQsIGUpIHtcbiAgICAgICAgY29uc3QgbiA9IFNyKHQpO1xuICAgICAgICBsZXQgcywgaSA9IG50LkE7XG4gICAgICAgIHJldHVybiBuLld0KHtcbiAgICAgICAgICAgIGluZGV4OiBcImRvY3VtZW50VGFyZ2V0c0luZGV4XCJcbiAgICAgICAgfSwgKChbdCwgbl0sIHtwYXRoOiByLCBzZXF1ZW5jZU51bWJlcjogb30pID0+IHtcbiAgICAgICAgICAgIDAgPT09IHQgPyAoXG4gICAgICAgICAgICAvLyBpZiBuZXh0VG9SZXBvcnQgaXMgdmFsaWQsIHJlcG9ydCBpdCwgdGhpcyBpcyBhIG5ldyBrZXkgc28gdGhlXG4gICAgICAgICAgICAvLyBsYXN0IG9uZSBtdXN0IG5vdCBiZSBhIG1lbWJlciBvZiBhbnkgdGFyZ2V0cy5cbiAgICAgICAgICAgIGkgIT09IG50LkEgJiYgZShuZXcgeHQoV3MocykpLCBpKSwgXG4gICAgICAgICAgICAvLyBzZXQgbmV4dFRvUmVwb3J0IHRvIGJlIHRoaXMgc2VxdWVuY2UgbnVtYmVyLiBJdCdzIHRoZSBuZXh0IG9uZSB3ZVxuICAgICAgICAgICAgLy8gbWlnaHQgcmVwb3J0LCBpZiB3ZSBkb24ndCBmaW5kIGFueSB0YXJnZXRzIGZvciB0aGlzIGRvY3VtZW50LlxuICAgICAgICAgICAgLy8gTm90ZSB0aGF0IHRoZSBzZXF1ZW5jZSBudW1iZXIgbXVzdCBiZSBkZWZpbmVkIHdoZW4gdGhlIHRhcmdldElkXG4gICAgICAgICAgICAvLyBpcyAwLlxuICAgICAgICAgICAgaSA9IG8sIHMgPSByKSA6IFxuICAgICAgICAgICAgLy8gc2V0IG5leHRUb1JlcG9ydCB0byBiZSBpbnZhbGlkLCB3ZSBrbm93IHdlIGRvbid0IG5lZWQgdG8gcmVwb3J0XG4gICAgICAgICAgICAvLyB0aGlzIG9uZSBzaW5jZSB3ZSBmb3VuZCBhIHRhcmdldCBmb3IgaXQuXG4gICAgICAgICAgICBpID0gbnQuQTtcbiAgICAgICAgfSkpLm5leHQoKCgpID0+IHtcbiAgICAgICAgICAgIC8vIFNpbmNlIHdlIHJlcG9ydCBzZXF1ZW5jZSBudW1iZXJzIGFmdGVyIGdldHRpbmcgdG8gdGhlIG5leHQga2V5LCB3ZVxuICAgICAgICAgICAgLy8gbmVlZCB0byBjaGVjayBpZiB0aGUgbGFzdCBrZXkgd2UgaXRlcmF0ZWQgb3ZlciB3YXMgYW4gb3JwaGFuZWRcbiAgICAgICAgICAgIC8vIGRvY3VtZW50IGFuZCByZXBvcnQgaXQuXG4gICAgICAgICAgICBpICE9PSBudC5BICYmIGUobmV3IHh0KFdzKHMpKSwgaSk7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgZ2V0Q2FjaGVTaXplKHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGIuZ2V0UmVtb3RlRG9jdW1lbnRDYWNoZSgpLmdldFNpemUodCk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBPcih0LCBlKSB7XG4gICAgcmV0dXJuIFNyKHQpLnB1dChcbiAgICAvKipcbiAqIEByZXR1cm5zIEEgdmFsdWUgc3VpdGFibGUgZm9yIHdyaXRpbmcgYSBzZW50aW5lbCByb3cgaW4gdGhlIHRhcmdldC1kb2N1bWVudFxuICogc3RvcmUuXG4gKi9cbiAgICBmdW5jdGlvbih0LCBlKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB0YXJnZXRJZDogMCxcbiAgICAgICAgICAgIHBhdGg6IEdzKHQucGF0aCksXG4gICAgICAgICAgICBzZXF1ZW5jZU51bWJlcjogZVxuICAgICAgICB9O1xuICAgIH0oZSwgdC5jdXJyZW50U2VxdWVuY2VOdW1iZXIpKTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogQW4gaW4tbWVtb3J5IGJ1ZmZlciBvZiBlbnRyaWVzIHRvIGJlIHdyaXR0ZW4gdG8gYSBSZW1vdGVEb2N1bWVudENhY2hlLlxuICogSXQgY2FuIGJlIHVzZWQgdG8gYmF0Y2ggdXAgYSBzZXQgb2YgY2hhbmdlcyB0byBiZSB3cml0dGVuIHRvIHRoZSBjYWNoZSwgYnV0XG4gKiBhZGRpdGlvbmFsbHkgc3VwcG9ydHMgcmVhZGluZyBlbnRyaWVzIGJhY2sgd2l0aCB0aGUgYGdldEVudHJ5KClgIG1ldGhvZCxcbiAqIGZhbGxpbmcgYmFjayB0byB0aGUgdW5kZXJseWluZyBSZW1vdGVEb2N1bWVudENhY2hlIGlmIG5vIGVudHJ5IGlzXG4gKiBidWZmZXJlZC5cbiAqXG4gKiBFbnRyaWVzIGFkZGVkIHRvIHRoZSBjYWNoZSAqbXVzdCogYmUgcmVhZCBmaXJzdC4gVGhpcyBpcyB0byBmYWNpbGl0YXRlXG4gKiBjYWxjdWxhdGluZyB0aGUgc2l6ZSBkZWx0YSBvZiB0aGUgcGVuZGluZyBjaGFuZ2VzLlxuICpcbiAqIFBPUlRJTkcgTk9URTogVGhpcyBjbGFzcyB3YXMgaW1wbGVtZW50ZWQgdGhlbiByZW1vdmVkIGZyb20gb3RoZXIgcGxhdGZvcm1zLlxuICogSWYgYnl0ZS1jb3VudGluZyBlbmRzIHVwIGJlaW5nIG5lZWRlZCBvbiB0aGUgb3RoZXIgcGxhdGZvcm1zLCBjb25zaWRlclxuICogcG9ydGluZyB0aGlzIGNsYXNzIGFzIHBhcnQgb2YgdGhhdCBpbXBsZW1lbnRhdGlvbiB3b3JrLlxuICovIGNsYXNzIEZyIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgLy8gQSBtYXBwaW5nIG9mIGRvY3VtZW50IGtleSB0byB0aGUgbmV3IGNhY2hlIGVudHJ5IHRoYXQgc2hvdWxkIGJlIHdyaXR0ZW4uXG4gICAgICAgIHRoaXMuY2hhbmdlcyA9IG5ldyBLbigodCA9PiB0LnRvU3RyaW5nKCkpLCAoKHQsIGUpID0+IHQuaXNFcXVhbChlKSkpLCB0aGlzLmNoYW5nZXNBcHBsaWVkID0gITE7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEJ1ZmZlcnMgYSBgUmVtb3RlRG9jdW1lbnRDYWNoZS5hZGRFbnRyeSgpYCBjYWxsLlxuICAgICAqXG4gICAgICogWW91IGNhbiBvbmx5IG1vZGlmeSBkb2N1bWVudHMgdGhhdCBoYXZlIGFscmVhZHkgYmVlbiByZXRyaWV2ZWQgdmlhXG4gICAgICogYGdldEVudHJ5KCkvZ2V0RW50cmllcygpYCAoZW5mb3JjZWQgdmlhIEluZGV4ZWREYnMgYGFwcGx5KClgKS5cbiAgICAgKi8gICAgYWRkRW50cnkodCkge1xuICAgICAgICB0aGlzLmFzc2VydE5vdEFwcGxpZWQoKSwgdGhpcy5jaGFuZ2VzLnNldCh0LmtleSwgdCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEJ1ZmZlcnMgYSBgUmVtb3RlRG9jdW1lbnRDYWNoZS5yZW1vdmVFbnRyeSgpYCBjYWxsLlxuICAgICAqXG4gICAgICogWW91IGNhbiBvbmx5IHJlbW92ZSBkb2N1bWVudHMgdGhhdCBoYXZlIGFscmVhZHkgYmVlbiByZXRyaWV2ZWQgdmlhXG4gICAgICogYGdldEVudHJ5KCkvZ2V0RW50cmllcygpYCAoZW5mb3JjZWQgdmlhIEluZGV4ZWREYnMgYGFwcGx5KClgKS5cbiAgICAgKi8gICAgcmVtb3ZlRW50cnkodCwgZSkge1xuICAgICAgICB0aGlzLmFzc2VydE5vdEFwcGxpZWQoKSwgdGhpcy5jaGFuZ2VzLnNldCh0LCBuZS5uZXdJbnZhbGlkRG9jdW1lbnQodCkuc2V0UmVhZFRpbWUoZSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBMb29rcyB1cCBhbiBlbnRyeSBpbiB0aGUgY2FjaGUuIFRoZSBidWZmZXJlZCBjaGFuZ2VzIHdpbGwgZmlyc3QgYmUgY2hlY2tlZCxcbiAgICAgKiBhbmQgaWYgbm8gYnVmZmVyZWQgY2hhbmdlIGFwcGxpZXMsIHRoaXMgd2lsbCBmb3J3YXJkIHRvXG4gICAgICogYFJlbW90ZURvY3VtZW50Q2FjaGUuZ2V0RW50cnkoKWAuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gdHJhbnNhY3Rpb24gLSBUaGUgdHJhbnNhY3Rpb24gaW4gd2hpY2ggdG8gcGVyZm9ybSBhbnkgcGVyc2lzdGVuY2VcbiAgICAgKiAgICAgb3BlcmF0aW9ucy5cbiAgICAgKiBAcGFyYW0gZG9jdW1lbnRLZXkgLSBUaGUga2V5IG9mIHRoZSBlbnRyeSB0byBsb29rIHVwLlxuICAgICAqIEByZXR1cm5zIFRoZSBjYWNoZWQgZG9jdW1lbnQgb3IgYW4gaW52YWxpZCBkb2N1bWVudCBpZiB3ZSBoYXZlIG5vdGhpbmdcbiAgICAgKiBjYWNoZWQuXG4gICAgICovICAgIGdldEVudHJ5KHQsIGUpIHtcbiAgICAgICAgdGhpcy5hc3NlcnROb3RBcHBsaWVkKCk7XG4gICAgICAgIGNvbnN0IG4gPSB0aGlzLmNoYW5nZXMuZ2V0KGUpO1xuICAgICAgICByZXR1cm4gdm9pZCAwICE9PSBuID8geWkucmVzb2x2ZShuKSA6IHRoaXMuZ2V0RnJvbUNhY2hlKHQsIGUpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBMb29rcyB1cCBzZXZlcmFsIGVudHJpZXMgaW4gdGhlIGNhY2hlLCBmb3J3YXJkaW5nIHRvXG4gICAgICogYFJlbW90ZURvY3VtZW50Q2FjaGUuZ2V0RW50cnkoKWAuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gdHJhbnNhY3Rpb24gLSBUaGUgdHJhbnNhY3Rpb24gaW4gd2hpY2ggdG8gcGVyZm9ybSBhbnkgcGVyc2lzdGVuY2VcbiAgICAgKiAgICAgb3BlcmF0aW9ucy5cbiAgICAgKiBAcGFyYW0gZG9jdW1lbnRLZXlzIC0gVGhlIGtleXMgb2YgdGhlIGVudHJpZXMgdG8gbG9vayB1cC5cbiAgICAgKiBAcmV0dXJucyBBIG1hcCBvZiBjYWNoZWQgZG9jdW1lbnRzLCBpbmRleGVkIGJ5IGtleS4gSWYgYW4gZW50cnkgY2Fubm90IGJlXG4gICAgICogICAgIGZvdW5kLCB0aGUgY29ycmVzcG9uZGluZyBrZXkgd2lsbCBiZSBtYXBwZWQgdG8gYW4gaW52YWxpZCBkb2N1bWVudC5cbiAgICAgKi8gICAgZ2V0RW50cmllcyh0LCBlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldEFsbEZyb21DYWNoZSh0LCBlKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQXBwbGllcyBidWZmZXJlZCBjaGFuZ2VzIHRvIHRoZSB1bmRlcmx5aW5nIFJlbW90ZURvY3VtZW50Q2FjaGUsIHVzaW5nXG4gICAgICogdGhlIHByb3ZpZGVkIHRyYW5zYWN0aW9uLlxuICAgICAqLyAgICBhcHBseSh0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLmFzc2VydE5vdEFwcGxpZWQoKSwgdGhpcy5jaGFuZ2VzQXBwbGllZCA9ICEwLCB0aGlzLmFwcGx5Q2hhbmdlcyh0KTtcbiAgICB9XG4gICAgLyoqIEhlbHBlciB0byBhc3NlcnQgdGhpcy5jaGFuZ2VzIGlzIG5vdCBudWxsICAqLyAgICBhc3NlcnROb3RBcHBsaWVkKCkge31cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogVGhlIFJlbW90ZURvY3VtZW50Q2FjaGUgZm9yIEluZGV4ZWREYi4gVG8gY29uc3RydWN0LCBpbnZva2VcbiAqIGBuZXdJbmRleGVkRGJSZW1vdGVEb2N1bWVudENhY2hlKClgLlxuICovIGNsYXNzICRyIHtcbiAgICBjb25zdHJ1Y3Rvcih0KSB7XG4gICAgICAgIHRoaXMuTSA9IHQ7XG4gICAgfVxuICAgIHNldEluZGV4TWFuYWdlcih0KSB7XG4gICAgICAgIHRoaXMuaW5kZXhNYW5hZ2VyID0gdDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQWRkcyB0aGUgc3VwcGxpZWQgZW50cmllcyB0byB0aGUgY2FjaGUuXG4gICAgICpcbiAgICAgKiBBbGwgY2FsbHMgb2YgYGFkZEVudHJ5YCBhcmUgcmVxdWlyZWQgdG8gZ28gdGhyb3VnaCB0aGUgUmVtb3RlRG9jdW1lbnRDaGFuZ2VCdWZmZXJcbiAgICAgKiByZXR1cm5lZCBieSBgbmV3Q2hhbmdlQnVmZmVyKClgIHRvIGVuc3VyZSBwcm9wZXIgYWNjb3VudGluZyBvZiBtZXRhZGF0YS5cbiAgICAgKi8gICAgYWRkRW50cnkodCwgZSwgbikge1xuICAgICAgICByZXR1cm4gVXIodCkucHV0KG4pO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZW1vdmVzIGEgZG9jdW1lbnQgZnJvbSB0aGUgY2FjaGUuXG4gICAgICpcbiAgICAgKiBBbGwgY2FsbHMgb2YgYHJlbW92ZUVudHJ5YCAgYXJlIHJlcXVpcmVkIHRvIGdvIHRocm91Z2ggdGhlIFJlbW90ZURvY3VtZW50Q2hhbmdlQnVmZmVyXG4gICAgICogcmV0dXJuZWQgYnkgYG5ld0NoYW5nZUJ1ZmZlcigpYCB0byBlbnN1cmUgcHJvcGVyIGFjY291bnRpbmcgb2YgbWV0YWRhdGEuXG4gICAgICovICAgIHJlbW92ZUVudHJ5KHQsIGUsIG4pIHtcbiAgICAgICAgcmV0dXJuIFVyKHQpLmRlbGV0ZShcbiAgICAgICAgLyoqXG4gKiBSZXR1cm5zIGEga2V5IHRoYXQgY2FuIGJlIHVzZWQgZm9yIGRvY3VtZW50IGxvb2t1cHMgdmlhIHRoZSBwcmltYXJ5IGtleSBvZlxuICogdGhlIERiUmVtb3RlRG9jdW1lbnQgb2JqZWN0IHN0b3JlLlxuICovXG4gICAgICAgIGZ1bmN0aW9uKHQsIGUpIHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSB0LnBhdGgudG9BcnJheSgpO1xuICAgICAgICAgICAgcmV0dXJuIFsgXG4gICAgICAgICAgICAvKiBwcmVmaXggcGF0aCAqLyBuLnNsaWNlKDAsIG4ubGVuZ3RoIC0gMiksIFxuICAgICAgICAgICAgLyogY29sbGVjdGlvbiBpZCAqLyBuW24ubGVuZ3RoIC0gMl0sIEZpKGUpLCBcbiAgICAgICAgICAgIC8qIGRvY3VtZW50IGlkICovIG5bbi5sZW5ndGggLSAxXSBdO1xuICAgICAgICB9XG4gICAgICAgIC8qKlxuICogUmV0dXJucyBhIGtleSB0aGF0IGNhbiBiZSB1c2VkIGZvciBkb2N1bWVudCBsb29rdXBzIG9uIHRoZVxuICogYERiUmVtb3RlRG9jdW1lbnREb2N1bWVudENvbGxlY3Rpb25Hcm91cEluZGV4YCBpbmRleC5cbiAqLyAoZSwgbikpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBVcGRhdGVzIHRoZSBjdXJyZW50IGNhY2hlIHNpemUuXG4gICAgICpcbiAgICAgKiBDYWxsZXJzIHRvIGBhZGRFbnRyeSgpYCBhbmQgYHJlbW92ZUVudHJ5KClgICptdXN0KiBjYWxsIHRoaXMgYWZ0ZXJ3YXJkcyB0byB1cGRhdGUgdGhlXG4gICAgICogY2FjaGUncyBtZXRhZGF0YS5cbiAgICAgKi8gICAgdXBkYXRlTWV0YWRhdGEodCwgZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRNZXRhZGF0YSh0KS5uZXh0KChuID0+IChuLmJ5dGVTaXplICs9IGUsIHRoaXMuRm4odCwgbikpKSk7XG4gICAgfVxuICAgIGdldEVudHJ5KHQsIGUpIHtcbiAgICAgICAgbGV0IG4gPSBuZS5uZXdJbnZhbGlkRG9jdW1lbnQoZSk7XG4gICAgICAgIHJldHVybiBVcih0KS5XdCh7XG4gICAgICAgICAgICBpbmRleDogXCJkb2N1bWVudEtleUluZGV4XCIsXG4gICAgICAgICAgICByYW5nZTogSURCS2V5UmFuZ2Uub25seShxcihlKSlcbiAgICAgICAgfSwgKCh0LCBzKSA9PiB7XG4gICAgICAgICAgICBuID0gdGhpcy4kbihlLCBzKTtcbiAgICAgICAgfSkpLm5leHQoKCgpID0+IG4pKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogTG9va3MgdXAgYW4gZW50cnkgaW4gdGhlIGNhY2hlLlxuICAgICAqXG4gICAgICogQHBhcmFtIGRvY3VtZW50S2V5IC0gVGhlIGtleSBvZiB0aGUgZW50cnkgdG8gbG9vayB1cC5cbiAgICAgKiBAcmV0dXJucyBUaGUgY2FjaGVkIGRvY3VtZW50IGVudHJ5IGFuZCBpdHMgc2l6ZS5cbiAgICAgKi8gICAgQm4odCwgZSkge1xuICAgICAgICBsZXQgbiA9IHtcbiAgICAgICAgICAgIHNpemU6IDAsXG4gICAgICAgICAgICBkb2N1bWVudDogbmUubmV3SW52YWxpZERvY3VtZW50KGUpXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBVcih0KS5XdCh7XG4gICAgICAgICAgICBpbmRleDogXCJkb2N1bWVudEtleUluZGV4XCIsXG4gICAgICAgICAgICByYW5nZTogSURCS2V5UmFuZ2Uub25seShxcihlKSlcbiAgICAgICAgfSwgKCh0LCBzKSA9PiB7XG4gICAgICAgICAgICBuID0ge1xuICAgICAgICAgICAgICAgIGRvY3VtZW50OiB0aGlzLiRuKGUsIHMpLFxuICAgICAgICAgICAgICAgIHNpemU6IHByKHMpXG4gICAgICAgICAgICB9O1xuICAgICAgICB9KSkubmV4dCgoKCkgPT4gbikpO1xuICAgIH1cbiAgICBnZXRFbnRyaWVzKHQsIGUpIHtcbiAgICAgICAgbGV0IG4gPSBRbigpO1xuICAgICAgICByZXR1cm4gdGhpcy5Mbih0LCBlLCAoKHQsIGUpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHMgPSB0aGlzLiRuKHQsIGUpO1xuICAgICAgICAgICAgbiA9IG4uaW5zZXJ0KHQsIHMpO1xuICAgICAgICB9KSkubmV4dCgoKCkgPT4gbikpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBMb29rcyB1cCBzZXZlcmFsIGVudHJpZXMgaW4gdGhlIGNhY2hlLlxuICAgICAqXG4gICAgICogQHBhcmFtIGRvY3VtZW50S2V5cyAtIFRoZSBzZXQgb2Yga2V5cyBlbnRyaWVzIHRvIGxvb2sgdXAuXG4gICAgICogQHJldHVybnMgQSBtYXAgb2YgZG9jdW1lbnRzIGluZGV4ZWQgYnkga2V5IGFuZCBhIG1hcCBvZiBzaXplcyBpbmRleGVkIGJ5XG4gICAgICogICAgIGtleSAoemVybyBpZiB0aGUgZG9jdW1lbnQgZG9lcyBub3QgZXhpc3QpLlxuICAgICAqLyAgICBVbih0LCBlKSB7XG4gICAgICAgIGxldCBuID0gUW4oKSwgcyA9IG5ldyBmZSh4dC5jb21wYXJhdG9yKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuTG4odCwgZSwgKCh0LCBlKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBpID0gdGhpcy4kbih0LCBlKTtcbiAgICAgICAgICAgIG4gPSBuLmluc2VydCh0LCBpKSwgcyA9IHMuaW5zZXJ0KHQsIHByKGUpKTtcbiAgICAgICAgfSkpLm5leHQoKCgpID0+ICh7XG4gICAgICAgICAgICBkb2N1bWVudHM6IG4sXG4gICAgICAgICAgICBxbjogc1xuICAgICAgICB9KSkpO1xuICAgIH1cbiAgICBMbih0LCBlLCBuKSB7XG4gICAgICAgIGlmIChlLmlzRW1wdHkoKSkgcmV0dXJuIHlpLnJlc29sdmUoKTtcbiAgICAgICAgbGV0IHMgPSBuZXcgd2UoR3IpO1xuICAgICAgICBlLmZvckVhY2goKHQgPT4gcyA9IHMuYWRkKHQpKSk7XG4gICAgICAgIGNvbnN0IGkgPSBJREJLZXlSYW5nZS5ib3VuZChxcihzLmZpcnN0KCkpLCBxcihzLmxhc3QoKSkpLCByID0gcy5nZXRJdGVyYXRvcigpO1xuICAgICAgICBsZXQgbyA9IHIuZ2V0TmV4dCgpO1xuICAgICAgICByZXR1cm4gVXIodCkuV3Qoe1xuICAgICAgICAgICAgaW5kZXg6IFwiZG9jdW1lbnRLZXlJbmRleFwiLFxuICAgICAgICAgICAgcmFuZ2U6IGlcbiAgICAgICAgfSwgKCh0LCBlLCBzKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBpID0geHQuZnJvbVNlZ21lbnRzKFsgLi4uZS5wcmVmaXhQYXRoLCBlLmNvbGxlY3Rpb25Hcm91cCwgZS5kb2N1bWVudElkIF0pO1xuICAgICAgICAgICAgLy8gR28gdGhyb3VnaCBrZXlzIG5vdCBmb3VuZCBpbiBjYWNoZS5cbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoO28gJiYgR3IobywgaSkgPCAwOyApIG4obywgbnVsbCksIG8gPSByLmdldE5leHQoKTtcbiAgICAgICAgICAgIG8gJiYgby5pc0VxdWFsKGkpICYmIChcbiAgICAgICAgICAgIC8vIEtleSBmb3VuZCBpbiBjYWNoZS5cbiAgICAgICAgICAgIG4obywgZSksIG8gPSByLmhhc05leHQoKSA/IHIuZ2V0TmV4dCgpIDogbnVsbCksIFxuICAgICAgICAgICAgLy8gU2tpcCB0byB0aGUgbmV4dCBrZXkgKGlmIHRoZXJlIGlzIG9uZSkuXG4gICAgICAgICAgICBvID8gcy5VdChxcihvKSkgOiBzLmRvbmUoKTtcbiAgICAgICAgfSkpLm5leHQoKCgpID0+IHtcbiAgICAgICAgICAgIC8vIFRoZSByZXN0IG9mIHRoZSBrZXlzIGFyZSBub3QgaW4gdGhlIGNhY2hlLiBPbmUgY2FzZSB3aGVyZSBgaXRlcmF0ZWBcbiAgICAgICAgICAgIC8vIGFib3ZlIHdvbid0IGdvIHRocm91Z2ggdGhlbSBpcyB3aGVuIHRoZSBjYWNoZSBpcyBlbXB0eS5cbiAgICAgICAgICAgIGZvciAoO287ICkgbihvLCBudWxsKSwgbyA9IHIuaGFzTmV4dCgpID8gci5nZXROZXh0KCkgOiBudWxsO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIGdldEFsbEZyb21Db2xsZWN0aW9uKHQsIGUsIG4pIHtcbiAgICAgICAgY29uc3QgcyA9IFsgZS5wb3BMYXN0KCkudG9BcnJheSgpLCBlLmxhc3RTZWdtZW50KCksIEZpKG4ucmVhZFRpbWUpLCBuLmRvY3VtZW50S2V5LnBhdGguaXNFbXB0eSgpID8gXCJcIiA6IG4uZG9jdW1lbnRLZXkucGF0aC5sYXN0U2VnbWVudCgpIF0sIGkgPSBbIGUucG9wTGFzdCgpLnRvQXJyYXkoKSwgZS5sYXN0U2VnbWVudCgpLCBbIE51bWJlci5NQVhfU0FGRV9JTlRFR0VSLCBOdW1iZXIuTUFYX1NBRkVfSU5URUdFUiBdLCBcIlwiIF07XG4gICAgICAgIHJldHVybiBVcih0KS5xdChJREJLZXlSYW5nZS5ib3VuZChzLCBpLCAhMCkpLm5leHQoKHQgPT4ge1xuICAgICAgICAgICAgbGV0IGUgPSBRbigpO1xuICAgICAgICAgICAgZm9yIChjb25zdCBuIG9mIHQpIHtcbiAgICAgICAgICAgICAgICBjb25zdCB0ID0gdGhpcy4kbih4dC5mcm9tU2VnbWVudHMobi5wcmVmaXhQYXRoLmNvbmNhdChuLmNvbGxlY3Rpb25Hcm91cCwgbi5kb2N1bWVudElkKSksIG4pO1xuICAgICAgICAgICAgICAgIGUgPSBlLmluc2VydCh0LmtleSwgdCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICBnZXRBbGxGcm9tQ29sbGVjdGlvbkdyb3VwKHQsIGUsIG4sIHMpIHtcbiAgICAgICAgbGV0IGkgPSBRbigpO1xuICAgICAgICBjb25zdCByID0gS3IoZSwgbiksIG8gPSBLcihlLCBoZS5tYXgoKSk7XG4gICAgICAgIHJldHVybiBVcih0KS5XdCh7XG4gICAgICAgICAgICBpbmRleDogXCJjb2xsZWN0aW9uR3JvdXBJbmRleFwiLFxuICAgICAgICAgICAgcmFuZ2U6IElEQktleVJhbmdlLmJvdW5kKHIsIG8sICEwKVxuICAgICAgICB9LCAoKHQsIGUsIG4pID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLiRuKHh0LmZyb21TZWdtZW50cyhlLnByZWZpeFBhdGguY29uY2F0KGUuY29sbGVjdGlvbkdyb3VwLCBlLmRvY3VtZW50SWQpKSwgZSk7XG4gICAgICAgICAgICBpID0gaS5pbnNlcnQoci5rZXksIHIpLCBpLnNpemUgPT09IHMgJiYgbi5kb25lKCk7XG4gICAgICAgIH0pKS5uZXh0KCgoKSA9PiBpKSk7XG4gICAgfVxuICAgIG5ld0NoYW5nZUJ1ZmZlcih0KSB7XG4gICAgICAgIHJldHVybiBuZXcgQnIodGhpcywgISF0ICYmIHQudHJhY2tSZW1vdmFscyk7XG4gICAgfVxuICAgIGdldFNpemUodCkge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRNZXRhZGF0YSh0KS5uZXh0KCh0ID0+IHQuYnl0ZVNpemUpKTtcbiAgICB9XG4gICAgZ2V0TWV0YWRhdGEodCkge1xuICAgICAgICByZXR1cm4gTHIodCkuZ2V0KFwicmVtb3RlRG9jdW1lbnRHbG9iYWxLZXlcIikubmV4dCgodCA9PiAoVSghIXQpLCB0KSkpO1xuICAgIH1cbiAgICBGbih0LCBlKSB7XG4gICAgICAgIHJldHVybiBMcih0KS5wdXQoXCJyZW1vdGVEb2N1bWVudEdsb2JhbEtleVwiLCBlKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRGVjb2RlcyBgZGJSZW1vdGVEb2NgIGFuZCByZXR1cm5zIHRoZSBkb2N1bWVudCAob3IgYW4gaW52YWxpZCBkb2N1bWVudCBpZlxuICAgICAqIHRoZSBkb2N1bWVudCBjb3JyZXNwb25kcyB0byB0aGUgZm9ybWF0IHVzZWQgZm9yIHNlbnRpbmVsIGRlbGV0ZXMpLlxuICAgICAqLyAgICAkbih0LCBlKSB7XG4gICAgICAgIGlmIChlKSB7XG4gICAgICAgICAgICBjb25zdCB0ID0gTWkodGhpcy5NLCBlKTtcbiAgICAgICAgICAgIC8vIFdoZXRoZXIgdGhlIGRvY3VtZW50IGlzIGEgc2VudGluZWwgcmVtb3ZhbCBhbmQgc2hvdWxkIG9ubHkgYmUgdXNlZCBpbiB0aGVcbiAgICAgICAgICAgIC8vIGBnZXROZXdEb2N1bWVudENoYW5nZXMoKWBcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghKHQuaXNOb0RvY3VtZW50KCkgJiYgdC52ZXJzaW9uLmlzRXF1YWwoY3QubWluKCkpKSkgcmV0dXJuIHQ7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5lLm5ld0ludmFsaWREb2N1bWVudCh0KTtcbiAgICB9XG59XG5cbi8qKiBDcmVhdGVzIGEgbmV3IEluZGV4ZWREYlJlbW90ZURvY3VtZW50Q2FjaGUuICovXG4vKipcbiAqIEhhbmRsZXMgdGhlIGRldGFpbHMgb2YgYWRkaW5nIGFuZCB1cGRhdGluZyBkb2N1bWVudHMgaW4gdGhlIEluZGV4ZWREYlJlbW90ZURvY3VtZW50Q2FjaGUuXG4gKlxuICogVW5saWtlIHRoZSBNZW1vcnlSZW1vdGVEb2N1bWVudENoYW5nZUJ1ZmZlciwgdGhlIEluZGV4ZWREYiBpbXBsZW1lbnRhdGlvbiBjb21wdXRlcyB0aGUgc2l6ZVxuICogZGVsdGEgZm9yIGFsbCBzdWJtaXR0ZWQgY2hhbmdlcy4gVGhpcyBhdm9pZHMgaGF2aW5nIHRvIHJlLXJlYWQgYWxsIGRvY3VtZW50cyBmcm9tIEluZGV4ZWREYlxuICogd2hlbiB3ZSBhcHBseSB0aGUgY2hhbmdlcy5cbiAqL1xuY2xhc3MgQnIgZXh0ZW5kcyBGciB7XG4gICAgLyoqXG4gICAgICogQHBhcmFtIGRvY3VtZW50Q2FjaGUgLSBUaGUgSW5kZXhlZERiUmVtb3RlRG9jdW1lbnRDYWNoZSB0byBhcHBseSB0aGUgY2hhbmdlcyB0by5cbiAgICAgKiBAcGFyYW0gdHJhY2tSZW1vdmFscyAtIFdoZXRoZXIgdG8gY3JlYXRlIHNlbnRpbmVsIGRlbGV0ZXMgdGhhdCBjYW4gYmUgdHJhY2tlZCBieVxuICAgICAqIGBnZXROZXdEb2N1bWVudENoYW5nZXMoKWAuXG4gICAgICovXG4gICAgY29uc3RydWN0b3IodCwgZSkge1xuICAgICAgICBzdXBlcigpLCB0aGlzLktuID0gdCwgdGhpcy50cmFja1JlbW92YWxzID0gZSwgXG4gICAgICAgIC8vIEEgbWFwIG9mIGRvY3VtZW50IHNpemVzIGFuZCByZWFkIHRpbWVzIHByaW9yIHRvIGFwcGx5aW5nIHRoZSBjaGFuZ2VzIGluXG4gICAgICAgIC8vIHRoaXMgYnVmZmVyLlxuICAgICAgICB0aGlzLkduID0gbmV3IEtuKCh0ID0+IHQudG9TdHJpbmcoKSksICgodCwgZSkgPT4gdC5pc0VxdWFsKGUpKSk7XG4gICAgfVxuICAgIGFwcGx5Q2hhbmdlcyh0KSB7XG4gICAgICAgIGNvbnN0IGUgPSBbXTtcbiAgICAgICAgbGV0IG4gPSAwLCBzID0gbmV3IHdlKCgodCwgZSkgPT4gcnQodC5jYW5vbmljYWxTdHJpbmcoKSwgZS5jYW5vbmljYWxTdHJpbmcoKSkpKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2hhbmdlcy5mb3JFYWNoKCgoaSwgcikgPT4ge1xuICAgICAgICAgICAgY29uc3QgbyA9IHRoaXMuR24uZ2V0KGkpO1xuICAgICAgICAgICAgaWYgKGUucHVzaCh0aGlzLktuLnJlbW92ZUVudHJ5KHQsIGksIG8ucmVhZFRpbWUpKSwgci5pc1ZhbGlkRG9jdW1lbnQoKSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHUgPSBPaSh0aGlzLktuLk0sIHIpO1xuICAgICAgICAgICAgICAgIHMgPSBzLmFkZChpLnBhdGgucG9wTGFzdCgpKTtcbiAgICAgICAgICAgICAgICBjb25zdCBhID0gcHIodSk7XG4gICAgICAgICAgICAgICAgbiArPSBhIC0gby5zaXplLCBlLnB1c2godGhpcy5Lbi5hZGRFbnRyeSh0LCBpLCB1KSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKG4gLT0gby5zaXplLCB0aGlzLnRyYWNrUmVtb3ZhbHMpIHtcbiAgICAgICAgICAgICAgICAvLyBJbiBvcmRlciB0byB0cmFjayByZW1vdmFscywgd2Ugc3RvcmUgYSBcInNlbnRpbmVsIGRlbGV0ZVwiIGluIHRoZVxuICAgICAgICAgICAgICAgIC8vIFJlbW90ZURvY3VtZW50Q2FjaGUuIFRoaXMgZW50cnkgaXMgcmVwcmVzZW50ZWQgYnkgYSBOb0RvY3VtZW50XG4gICAgICAgICAgICAgICAgLy8gd2l0aCBhIHZlcnNpb24gb2YgMCBhbmQgaWdub3JlZCBieSBgbWF5YmVEZWNvZGVEb2N1bWVudCgpYCBidXRcbiAgICAgICAgICAgICAgICAvLyBwcmVzZXJ2ZWQgaW4gYGdldE5ld0RvY3VtZW50Q2hhbmdlcygpYC5cbiAgICAgICAgICAgICAgICBjb25zdCBuID0gT2kodGhpcy5Lbi5NLCByLmNvbnZlcnRUb05vRG9jdW1lbnQoY3QubWluKCkpKTtcbiAgICAgICAgICAgICAgICBlLnB1c2godGhpcy5Lbi5hZGRFbnRyeSh0LCBpLCBuKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pKSwgcy5mb3JFYWNoKChuID0+IHtcbiAgICAgICAgICAgIGUucHVzaCh0aGlzLktuLmluZGV4TWFuYWdlci5hZGRUb0NvbGxlY3Rpb25QYXJlbnRJbmRleCh0LCBuKSk7XG4gICAgICAgIH0pKSwgZS5wdXNoKHRoaXMuS24udXBkYXRlTWV0YWRhdGEodCwgbikpLCB5aS53YWl0Rm9yKGUpO1xuICAgIH1cbiAgICBnZXRGcm9tQ2FjaGUodCwgZSkge1xuICAgICAgICAvLyBSZWNvcmQgdGhlIHNpemUgb2YgZXZlcnl0aGluZyB3ZSBsb2FkIGZyb20gdGhlIGNhY2hlIHNvIHdlIGNhbiBjb21wdXRlIGEgZGVsdGEgbGF0ZXIuXG4gICAgICAgIHJldHVybiB0aGlzLktuLkJuKHQsIGUpLm5leHQoKHQgPT4gKHRoaXMuR24uc2V0KGUsIHtcbiAgICAgICAgICAgIHNpemU6IHQuc2l6ZSxcbiAgICAgICAgICAgIHJlYWRUaW1lOiB0LmRvY3VtZW50LnJlYWRUaW1lXG4gICAgICAgIH0pLCB0LmRvY3VtZW50KSkpO1xuICAgIH1cbiAgICBnZXRBbGxGcm9tQ2FjaGUodCwgZSkge1xuICAgICAgICAvLyBSZWNvcmQgdGhlIHNpemUgb2YgZXZlcnl0aGluZyB3ZSBsb2FkIGZyb20gdGhlIGNhY2hlIHNvIHdlIGNhbiBjb21wdXRlXG4gICAgICAgIC8vIGEgZGVsdGEgbGF0ZXIuXG4gICAgICAgIHJldHVybiB0aGlzLktuLlVuKHQsIGUpLm5leHQoKCh7ZG9jdW1lbnRzOiB0LCBxbjogZX0pID0+IChcbiAgICAgICAgLy8gTm90ZTogYGdldEFsbEZyb21DYWNoZWAgcmV0dXJucyB0d28gbWFwcyBpbnN0ZWFkIG9mIGEgc2luZ2xlIG1hcCBmcm9tXG4gICAgICAgIC8vIGtleXMgdG8gYERvY3VtZW50U2l6ZUVudHJ5YHMuIFRoaXMgaXMgdG8gYWxsb3cgcmV0dXJuaW5nIHRoZVxuICAgICAgICAvLyBgTXV0YWJsZURvY3VtZW50TWFwYCBkaXJlY3RseSwgd2l0aG91dCBhIGNvbnZlcnNpb24uXG4gICAgICAgIGUuZm9yRWFjaCgoKGUsIG4pID0+IHtcbiAgICAgICAgICAgIHRoaXMuR24uc2V0KGUsIHtcbiAgICAgICAgICAgICAgICBzaXplOiBuLFxuICAgICAgICAgICAgICAgIHJlYWRUaW1lOiB0LmdldChlKS5yZWFkVGltZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pKSwgdCkpKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIExyKHQpIHtcbiAgICByZXR1cm4gU2kodCwgXCJyZW1vdGVEb2N1bWVudEdsb2JhbFwiKTtcbn1cblxuLyoqXG4gKiBIZWxwZXIgdG8gZ2V0IGEgdHlwZWQgU2ltcGxlRGJTdG9yZSBmb3IgdGhlIHJlbW90ZURvY3VtZW50cyBvYmplY3Qgc3RvcmUuXG4gKi8gZnVuY3Rpb24gVXIodCkge1xuICAgIHJldHVybiBTaSh0LCBcInJlbW90ZURvY3VtZW50c1YxNFwiKTtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIGEga2V5IHRoYXQgY2FuIGJlIHVzZWQgZm9yIGRvY3VtZW50IGxvb2t1cHMgb24gdGhlXG4gKiBgRGJSZW1vdGVEb2N1bWVudERvY3VtZW50S2V5SW5kZXhgIGluZGV4LlxuICovIGZ1bmN0aW9uIHFyKHQpIHtcbiAgICBjb25zdCBlID0gdC5wYXRoLnRvQXJyYXkoKTtcbiAgICByZXR1cm4gWyBcbiAgICAvKiBwcmVmaXggcGF0aCAqLyBlLnNsaWNlKDAsIGUubGVuZ3RoIC0gMiksIFxuICAgIC8qIGNvbGxlY3Rpb24gaWQgKi8gZVtlLmxlbmd0aCAtIDJdLCBcbiAgICAvKiBkb2N1bWVudCBpZCAqLyBlW2UubGVuZ3RoIC0gMV0gXTtcbn1cblxuZnVuY3Rpb24gS3IodCwgZSkge1xuICAgIGNvbnN0IG4gPSBlLmRvY3VtZW50S2V5LnBhdGgudG9BcnJheSgpO1xuICAgIHJldHVybiBbIFxuICAgIC8qIGNvbGxlY3Rpb24gaWQgKi8gdCwgRmkoZS5yZWFkVGltZSksIFxuICAgIC8qIHByZWZpeCBwYXRoICovIG4uc2xpY2UoMCwgbi5sZW5ndGggLSAyKSwgXG4gICAgLyogZG9jdW1lbnQgaWQgKi8gbi5sZW5ndGggPiAwID8gbltuLmxlbmd0aCAtIDFdIDogXCJcIiBdO1xufVxuXG4vKipcbiAqIENvbXBhcmF0b3IgdGhhdCBjb21wYXJlcyBkb2N1bWVudCBrZXlzIGFjY29yZGluZyB0byB0aGUgcHJpbWFyeSBrZXkgc29ydGluZ1xuICogdXNlZCBieSB0aGUgYERiUmVtb3RlRG9jdW1lbnREb2N1bWVudGAgc3RvcmUgKGJ5IHByZWZpeCBwYXRoLCBjb2xsZWN0aW9uIGlkXG4gKiBhbmQgdGhlbiBkb2N1bWVudCBJRCkuXG4gKlxuICogVmlzaWJsZSBmb3IgdGVzdGluZy5cbiAqLyBmdW5jdGlvbiBHcih0LCBlKSB7XG4gICAgY29uc3QgbiA9IHQucGF0aC50b0FycmF5KCksIHMgPSBlLnBhdGgudG9BcnJheSgpO1xuICAgIC8vIFRoZSBvcmRlcmluZyBpcyBiYXNlZCBvbiBodHRwczovL2Nocm9taXVtLmdvb2dsZXNvdXJjZS5jb20vY2hyb21pdW0vYmxpbmsvKy9mZTVjMjFmZWY5NGRhZTcxYzFjMzM0NDc3NWI4ZDhhN2Y3ZTZkOWVjL1NvdXJjZS9tb2R1bGVzL2luZGV4ZWRkYi9JREJLZXkuY3BwIzc0XG4gICAgbGV0IGkgPSAwO1xuICAgIGZvciAobGV0IHQgPSAwOyB0IDwgbi5sZW5ndGggLSAyICYmIHQgPCBzLmxlbmd0aCAtIDI7ICsrdCkgaWYgKGkgPSBydChuW3RdLCBzW3RdKSwgXG4gICAgaSkgcmV0dXJuIGk7XG4gICAgcmV0dXJuIGkgPSBydChuLmxlbmd0aCwgcy5sZW5ndGgpLCBpIHx8IChpID0gcnQobltuLmxlbmd0aCAtIDJdLCBzW3MubGVuZ3RoIC0gMl0pLCBcbiAgICBpIHx8IHJ0KG5bbi5sZW5ndGggLSAxXSwgc1tzLmxlbmd0aCAtIDFdKSk7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vLyBUT0RPKGluZGV4aW5nKTogUmVtb3ZlIHRoaXMgY29uc3RhbnRcbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKiogUGVyZm9ybXMgZGF0YWJhc2UgY3JlYXRpb24gYW5kIHNjaGVtYSB1cGdyYWRlcy4gKi9cbmNsYXNzIFFyIHtcbiAgICBjb25zdHJ1Y3Rvcih0KSB7XG4gICAgICAgIHRoaXMuTSA9IHQ7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFBlcmZvcm1zIGRhdGFiYXNlIGNyZWF0aW9uIGFuZCBzY2hlbWEgdXBncmFkZXMuXG4gICAgICpcbiAgICAgKiBOb3RlIHRoYXQgaW4gcHJvZHVjdGlvbiwgdGhpcyBtZXRob2QgaXMgb25seSBldmVyIHVzZWQgdG8gdXBncmFkZSB0aGUgc2NoZW1hXG4gICAgICogdG8gU0NIRU1BX1ZFUlNJT04uIERpZmZlcmVudCB2YWx1ZXMgb2YgdG9WZXJzaW9uIGFyZSBvbmx5IHVzZWQgZm9yIHRlc3RpbmdcbiAgICAgKiBhbmQgbG9jYWwgZmVhdHVyZSBkZXZlbG9wbWVudC5cbiAgICAgKi8gICAga3QodCwgZSwgbiwgcykge1xuICAgICAgICBjb25zdCBpID0gbmV3IHBpKFwiY3JlYXRlT3JVcGdyYWRlXCIsIGUpO1xuICAgICAgICBuIDwgMSAmJiBzID49IDEgJiYgKGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgICAgIHQuY3JlYXRlT2JqZWN0U3RvcmUoXCJvd25lclwiKTtcbiAgICAgICAgfSh0KSwgZnVuY3Rpb24odCkge1xuICAgICAgICAgICAgdC5jcmVhdGVPYmplY3RTdG9yZShcIm11dGF0aW9uUXVldWVzXCIsIHtcbiAgICAgICAgICAgICAgICBrZXlQYXRoOiBcInVzZXJJZFwiXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHQuY3JlYXRlT2JqZWN0U3RvcmUoXCJtdXRhdGlvbnNcIiwge1xuICAgICAgICAgICAgICAgIGtleVBhdGg6IFwiYmF0Y2hJZFwiLFxuICAgICAgICAgICAgICAgIGF1dG9JbmNyZW1lbnQ6ICEwXG4gICAgICAgICAgICB9KS5jcmVhdGVJbmRleChcInVzZXJNdXRhdGlvbnNJbmRleFwiLCB6cywge1xuICAgICAgICAgICAgICAgIHVuaXF1ZTogITBcbiAgICAgICAgICAgIH0pLCB0LmNyZWF0ZU9iamVjdFN0b3JlKFwiZG9jdW1lbnRNdXRhdGlvbnNcIik7XG4gICAgICAgIH1cbiAgICAgICAgLyoqXG4gKiBVcGdyYWRlIGZ1bmN0aW9uIHRvIG1pZ3JhdGUgdGhlICdtdXRhdGlvbnMnIHN0b3JlIGZyb20gVjEgdG8gVjMuIExvYWRzXG4gKiBhbmQgcmV3cml0ZXMgYWxsIGRhdGEuXG4gKi8gKHQpLCBqcih0KSwgZnVuY3Rpb24odCkge1xuICAgICAgICAgICAgdC5jcmVhdGVPYmplY3RTdG9yZShcInJlbW90ZURvY3VtZW50c1wiKTtcbiAgICAgICAgfSh0KSk7XG4gICAgICAgIC8vIE1pZ3JhdGlvbiAyIHRvIHBvcHVsYXRlIHRoZSB0YXJnZXRHbG9iYWwgb2JqZWN0IG5vIGxvbmdlciBuZWVkZWQgc2luY2VcbiAgICAgICAgLy8gbWlncmF0aW9uIDMgdW5jb25kaXRpb25hbGx5IGNsZWFycyBpdC5cbiAgICAgICAgICAgICAgICBsZXQgciA9IHlpLnJlc29sdmUoKTtcbiAgICAgICAgcmV0dXJuIG4gPCAzICYmIHMgPj0gMyAmJiAoXG4gICAgICAgIC8vIEJyYW5kIG5ldyBjbGllbnRzIGRvbid0IG5lZWQgdG8gZHJvcCBhbmQgcmVjcmVhdGUtLW9ubHkgY2xpZW50cyB0aGF0XG4gICAgICAgIC8vIHBvdGVudGlhbGx5IGhhdmUgY29ycnVwdCBkYXRhLlxuICAgICAgICAwICE9PSBuICYmICghZnVuY3Rpb24odCkge1xuICAgICAgICAgICAgdC5kZWxldGVPYmplY3RTdG9yZShcInRhcmdldERvY3VtZW50c1wiKSwgdC5kZWxldGVPYmplY3RTdG9yZShcInRhcmdldHNcIiksIHQuZGVsZXRlT2JqZWN0U3RvcmUoXCJ0YXJnZXRHbG9iYWxcIik7XG4gICAgICAgIH0odCksIGpyKHQpKSwgciA9IHIubmV4dCgoKCkgPT4gXG4gICAgICAgIC8qKlxuICogQ3JlYXRlcyB0aGUgdGFyZ2V0IGdsb2JhbCBzaW5nbGV0b24gcm93LlxuICpcbiAqIEBwYXJhbSB0eG4gLSBUaGUgdmVyc2lvbiB1cGdyYWRlIHRyYW5zYWN0aW9uIGZvciBpbmRleGVkZGJcbiAqL1xuICAgICAgICBmdW5jdGlvbih0KSB7XG4gICAgICAgICAgICBjb25zdCBlID0gdC5zdG9yZShcInRhcmdldEdsb2JhbFwiKSwgbiA9IHtcbiAgICAgICAgICAgICAgICBoaWdoZXN0VGFyZ2V0SWQ6IDAsXG4gICAgICAgICAgICAgICAgaGlnaGVzdExpc3RlblNlcXVlbmNlTnVtYmVyOiAwLFxuICAgICAgICAgICAgICAgIGxhc3RSZW1vdGVTbmFwc2hvdFZlcnNpb246IGN0Lm1pbigpLnRvVGltZXN0YW1wKCksXG4gICAgICAgICAgICAgICAgdGFyZ2V0Q291bnQ6IDBcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICByZXR1cm4gZS5wdXQoXCJ0YXJnZXRHbG9iYWxLZXlcIiwgbik7XG4gICAgICAgIH0oaSkpKSksIG4gPCA0ICYmIHMgPj0gNCAmJiAoMCAhPT0gbiAmJiAoXG4gICAgICAgIC8vIFNjaGVtYSB2ZXJzaW9uIDMgdXNlcyBhdXRvLWdlbmVyYXRlZCBrZXlzIHRvIGdlbmVyYXRlIGdsb2JhbGx5IHVuaXF1ZVxuICAgICAgICAvLyBtdXRhdGlvbiBiYXRjaCBJRHMgKHRoaXMgd2FzIHByZXZpb3VzbHkgZW5zdXJlZCBpbnRlcm5hbGx5IGJ5IHRoZVxuICAgICAgICAvLyBjbGllbnQpLiBUbyBtaWdyYXRlIHRvIHRoZSBuZXcgc2NoZW1hLCB3ZSBoYXZlIHRvIHJlYWQgYWxsIG11dGF0aW9uc1xuICAgICAgICAvLyBhbmQgd3JpdGUgdGhlbSBiYWNrIG91dC4gV2UgcHJlc2VydmUgdGhlIGV4aXN0aW5nIGJhdGNoIElEcyB0byBndWFyYW50ZWVcbiAgICAgICAgLy8gY29uc2lzdGVuY3kgd2l0aCBvdGhlciBvYmplY3Qgc3RvcmVzLiBBbnkgZnVydGhlciBtdXRhdGlvbiBiYXRjaCBJRHMgd2lsbFxuICAgICAgICAvLyBiZSBhdXRvLWdlbmVyYXRlZC5cbiAgICAgICAgciA9IHIubmV4dCgoKCkgPT4gZnVuY3Rpb24odCwgZSkge1xuICAgICAgICAgICAgcmV0dXJuIGUuc3RvcmUoXCJtdXRhdGlvbnNcIikucXQoKS5uZXh0KChuID0+IHtcbiAgICAgICAgICAgICAgICB0LmRlbGV0ZU9iamVjdFN0b3JlKFwibXV0YXRpb25zXCIpO1xuICAgICAgICAgICAgICAgIHQuY3JlYXRlT2JqZWN0U3RvcmUoXCJtdXRhdGlvbnNcIiwge1xuICAgICAgICAgICAgICAgICAgICBrZXlQYXRoOiBcImJhdGNoSWRcIixcbiAgICAgICAgICAgICAgICAgICAgYXV0b0luY3JlbWVudDogITBcbiAgICAgICAgICAgICAgICB9KS5jcmVhdGVJbmRleChcInVzZXJNdXRhdGlvbnNJbmRleFwiLCB6cywge1xuICAgICAgICAgICAgICAgICAgICB1bmlxdWU6ICEwXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgY29uc3QgcyA9IGUuc3RvcmUoXCJtdXRhdGlvbnNcIiksIGkgPSBuLm1hcCgodCA9PiBzLnB1dCh0KSkpO1xuICAgICAgICAgICAgICAgIHJldHVybiB5aS53YWl0Rm9yKGkpO1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICB9KHQsIGkpKSkpLCByID0gci5uZXh0KCgoKSA9PiB7XG4gICAgICAgICAgICAhZnVuY3Rpb24odCkge1xuICAgICAgICAgICAgICAgIHQuY3JlYXRlT2JqZWN0U3RvcmUoXCJjbGllbnRNZXRhZGF0YVwiLCB7XG4gICAgICAgICAgICAgICAgICAgIGtleVBhdGg6IFwiY2xpZW50SWRcIlxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSh0KTtcbiAgICAgICAgfSkpKSwgbiA8IDUgJiYgcyA+PSA1ICYmIChyID0gci5uZXh0KCgoKSA9PiB0aGlzLlFuKGkpKSkpLCBuIDwgNiAmJiBzID49IDYgJiYgKHIgPSByLm5leHQoKCgpID0+IChmdW5jdGlvbih0KSB7XG4gICAgICAgICAgICB0LmNyZWF0ZU9iamVjdFN0b3JlKFwicmVtb3RlRG9jdW1lbnRHbG9iYWxcIik7XG4gICAgICAgIH0odCksIHRoaXMuam4oaSkpKSkpLCBuIDwgNyAmJiBzID49IDcgJiYgKHIgPSByLm5leHQoKCgpID0+IHRoaXMuV24oaSkpKSksIG4gPCA4ICYmIHMgPj0gOCAmJiAociA9IHIubmV4dCgoKCkgPT4gdGhpcy56bih0LCBpKSkpKSwgXG4gICAgICAgIG4gPCA5ICYmIHMgPj0gOSAmJiAociA9IHIubmV4dCgoKCkgPT4ge1xuICAgICAgICAgICAgLy8gTXVsdGktVGFiIHVzZWQgdG8gbWFuYWdlIGl0cyBvd24gY2hhbmdlbG9nLCBidXQgdGhpcyBoYXMgYmVlbiBtb3ZlZFxuICAgICAgICAgICAgLy8gdG8gdGhlIERiUmVtb3RlRG9jdW1lbnQgb2JqZWN0IHN0b3JlIGl0c2VsZi4gU2luY2UgdGhlIHByZXZpb3VzIGNoYW5nZVxuICAgICAgICAgICAgLy8gbG9nIG9ubHkgY29udGFpbmVkIHRyYW5zaWVudCBkYXRhLCB3ZSBjYW4gZHJvcCBpdHMgb2JqZWN0IHN0b3JlLlxuICAgICAgICAgICAgIWZ1bmN0aW9uKHQpIHtcbiAgICAgICAgICAgICAgICB0Lm9iamVjdFN0b3JlTmFtZXMuY29udGFpbnMoXCJyZW1vdGVEb2N1bWVudENoYW5nZXNcIikgJiYgdC5kZWxldGVPYmplY3RTdG9yZShcInJlbW90ZURvY3VtZW50Q2hhbmdlc1wiKTtcbiAgICAgICAgICAgIH0odCk7XG4gICAgICAgICAgICAvLyBOb3RlOiBTY2hlbWEgdmVyc2lvbiA5IHVzZWQgdG8gY3JlYXRlIGEgcmVhZCB0aW1lIGluZGV4IGZvciB0aGVcbiAgICAgICAgICAgIC8vIFJlbW90ZURvY3VtZW50Q2FjaGUuIFRoaXMgaXMgbm93IGRvbmUgd2l0aCBzY2hlbWEgdmVyc2lvbiAxMy5cbiAgICAgICAgICAgICAgICB9KSkpLCBuIDwgMTAgJiYgcyA+PSAxMCAmJiAociA9IHIubmV4dCgoKCkgPT4gdGhpcy5IbihpKSkpKSwgbiA8IDExICYmIHMgPj0gMTEgJiYgKHIgPSByLm5leHQoKCgpID0+IHtcbiAgICAgICAgICAgICFmdW5jdGlvbih0KSB7XG4gICAgICAgICAgICAgICAgdC5jcmVhdGVPYmplY3RTdG9yZShcImJ1bmRsZXNcIiwge1xuICAgICAgICAgICAgICAgICAgICBrZXlQYXRoOiBcImJ1bmRsZUlkXCJcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0odCksIGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgICAgICAgICB0LmNyZWF0ZU9iamVjdFN0b3JlKFwibmFtZWRRdWVyaWVzXCIsIHtcbiAgICAgICAgICAgICAgICAgICAga2V5UGF0aDogXCJuYW1lXCJcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0odCk7XG4gICAgICAgIH0pKSksIG4gPCAxMiAmJiBzID49IDEyICYmIChyID0gci5uZXh0KCgoKSA9PiB7XG4gICAgICAgICAgICAhZnVuY3Rpb24odCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGUgPSB0LmNyZWF0ZU9iamVjdFN0b3JlKFwiZG9jdW1lbnRPdmVybGF5c1wiLCB7XG4gICAgICAgICAgICAgICAgICAgIGtleVBhdGg6IGNpXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgZS5jcmVhdGVJbmRleChcImNvbGxlY3Rpb25QYXRoT3ZlcmxheUluZGV4XCIsIGhpLCB7XG4gICAgICAgICAgICAgICAgICAgIHVuaXF1ZTogITFcbiAgICAgICAgICAgICAgICB9KSwgZS5jcmVhdGVJbmRleChcImNvbGxlY3Rpb25Hcm91cE92ZXJsYXlJbmRleFwiLCBsaSwge1xuICAgICAgICAgICAgICAgICAgICB1bmlxdWU6ICExXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KHQpO1xuICAgICAgICB9KSkpLCBuIDwgMTMgJiYgcyA+PSAxMyAmJiAociA9IHIubmV4dCgoKCkgPT4gZnVuY3Rpb24odCkge1xuICAgICAgICAgICAgY29uc3QgZSA9IHQuY3JlYXRlT2JqZWN0U3RvcmUoXCJyZW1vdGVEb2N1bWVudHNWMTRcIiwge1xuICAgICAgICAgICAgICAgIGtleVBhdGg6IFhzXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGUuY3JlYXRlSW5kZXgoXCJkb2N1bWVudEtleUluZGV4XCIsIFpzKSwgZS5jcmVhdGVJbmRleChcImNvbGxlY3Rpb25Hcm91cEluZGV4XCIsIHRpKTtcbiAgICAgICAgfSh0KSkpLm5leHQoKCgpID0+IHRoaXMuSm4odCwgaSkpKS5uZXh0KCgoKSA9PiB0LmRlbGV0ZU9iamVjdFN0b3JlKFwicmVtb3RlRG9jdW1lbnRzXCIpKSkpLCBcbiAgICAgICAgbiA8IDE0ICYmIHMgPj0gMTQgJiYgKHIgPSByLm5leHQoKCgpID0+IHtcbiAgICAgICAgICAgICFmdW5jdGlvbih0KSB7XG4gICAgICAgICAgICAgICAgdC5jcmVhdGVPYmplY3RTdG9yZShcImluZGV4Q29uZmlndXJhdGlvblwiLCB7XG4gICAgICAgICAgICAgICAgICAgIGtleVBhdGg6IFwiaW5kZXhJZFwiLFxuICAgICAgICAgICAgICAgICAgICBhdXRvSW5jcmVtZW50OiAhMFxuICAgICAgICAgICAgICAgIH0pLmNyZWF0ZUluZGV4KFwiY29sbGVjdGlvbkdyb3VwSW5kZXhcIiwgXCJjb2xsZWN0aW9uR3JvdXBcIiwge1xuICAgICAgICAgICAgICAgICAgICB1bmlxdWU6ICExXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdC5jcmVhdGVPYmplY3RTdG9yZShcImluZGV4U3RhdGVcIiwge1xuICAgICAgICAgICAgICAgICAgICBrZXlQYXRoOiByaVxuICAgICAgICAgICAgICAgIH0pLmNyZWF0ZUluZGV4KFwic2VxdWVuY2VOdW1iZXJJbmRleFwiLCBvaSwge1xuICAgICAgICAgICAgICAgICAgICB1bmlxdWU6ICExXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdC5jcmVhdGVPYmplY3RTdG9yZShcImluZGV4RW50cmllc1wiLCB7XG4gICAgICAgICAgICAgICAgICAgIGtleVBhdGg6IHVpXG4gICAgICAgICAgICAgICAgfSkuY3JlYXRlSW5kZXgoXCJkb2N1bWVudEtleUluZGV4XCIsIGFpLCB7XG4gICAgICAgICAgICAgICAgICAgIHVuaXF1ZTogITFcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0odCk7XG4gICAgICAgIH0pKSksIHI7XG4gICAgfVxuICAgIGpuKHQpIHtcbiAgICAgICAgbGV0IGUgPSAwO1xuICAgICAgICByZXR1cm4gdC5zdG9yZShcInJlbW90ZURvY3VtZW50c1wiKS5XdCgoKHQsIG4pID0+IHtcbiAgICAgICAgICAgIGUgKz0gcHIobik7XG4gICAgICAgIH0pKS5uZXh0KCgoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBuID0ge1xuICAgICAgICAgICAgICAgIGJ5dGVTaXplOiBlXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIHQuc3RvcmUoXCJyZW1vdGVEb2N1bWVudEdsb2JhbFwiKS5wdXQoXCJyZW1vdGVEb2N1bWVudEdsb2JhbEtleVwiLCBuKTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICBRbih0KSB7XG4gICAgICAgIGNvbnN0IGUgPSB0LnN0b3JlKFwibXV0YXRpb25RdWV1ZXNcIiksIG4gPSB0LnN0b3JlKFwibXV0YXRpb25zXCIpO1xuICAgICAgICByZXR1cm4gZS5xdCgpLm5leHQoKGUgPT4geWkuZm9yRWFjaChlLCAoZSA9PiB7XG4gICAgICAgICAgICBjb25zdCBzID0gSURCS2V5UmFuZ2UuYm91bmQoWyBlLnVzZXJJZCwgLTEgXSwgWyBlLnVzZXJJZCwgZS5sYXN0QWNrbm93bGVkZ2VkQmF0Y2hJZCBdKTtcbiAgICAgICAgICAgIHJldHVybiBuLnF0KFwidXNlck11dGF0aW9uc0luZGV4XCIsIHMpLm5leHQoKG4gPT4geWkuZm9yRWFjaChuLCAobiA9PiB7XG4gICAgICAgICAgICAgICAgVShuLnVzZXJJZCA9PT0gZS51c2VySWQpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHMgPSBMaSh0aGlzLk0sIG4pO1xuICAgICAgICAgICAgICAgIHJldHVybiB5cih0LCBlLnVzZXJJZCwgcykubmV4dCgoKCkgPT4ge30pKTtcbiAgICAgICAgICAgIH0pKSkpO1xuICAgICAgICB9KSkpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRW5zdXJlcyB0aGF0IGV2ZXJ5IGRvY3VtZW50IGluIHRoZSByZW1vdGUgZG9jdW1lbnQgY2FjaGUgaGFzIGEgY29ycmVzcG9uZGluZyBzZW50aW5lbCByb3dcbiAgICAgKiB3aXRoIGEgc2VxdWVuY2UgbnVtYmVyLiBNaXNzaW5nIHJvd3MgYXJlIGdpdmVuIHRoZSBtb3N0IHJlY2VudGx5IHVzZWQgc2VxdWVuY2UgbnVtYmVyLlxuICAgICAqLyAgICBXbih0KSB7XG4gICAgICAgIGNvbnN0IGUgPSB0LnN0b3JlKFwidGFyZ2V0RG9jdW1lbnRzXCIpLCBuID0gdC5zdG9yZShcInJlbW90ZURvY3VtZW50c1wiKTtcbiAgICAgICAgcmV0dXJuIHQuc3RvcmUoXCJ0YXJnZXRHbG9iYWxcIikuZ2V0KFwidGFyZ2V0R2xvYmFsS2V5XCIpLm5leHQoKHQgPT4ge1xuICAgICAgICAgICAgY29uc3QgcyA9IFtdO1xuICAgICAgICAgICAgcmV0dXJuIG4uV3QoKChuLCBpKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgciA9IG5ldyBfdChuKSwgbyA9IGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsgMCwgR3ModCkgXTtcbiAgICAgICAgICAgICAgICB9KHIpO1xuICAgICAgICAgICAgICAgIHMucHVzaChlLmdldChvKS5uZXh0KChuID0+IG4gPyB5aS5yZXNvbHZlKCkgOiAobiA9PiBlLnB1dCh7XG4gICAgICAgICAgICAgICAgICAgIHRhcmdldElkOiAwLFxuICAgICAgICAgICAgICAgICAgICBwYXRoOiBHcyhuKSxcbiAgICAgICAgICAgICAgICAgICAgc2VxdWVuY2VOdW1iZXI6IHQuaGlnaGVzdExpc3RlblNlcXVlbmNlTnVtYmVyXG4gICAgICAgICAgICAgICAgfSkpKHIpKSkpO1xuICAgICAgICAgICAgfSkpLm5leHQoKCgpID0+IHlpLndhaXRGb3IocykpKTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICB6bih0LCBlKSB7XG4gICAgICAgIC8vIENyZWF0ZSB0aGUgaW5kZXguXG4gICAgICAgIHQuY3JlYXRlT2JqZWN0U3RvcmUoXCJjb2xsZWN0aW9uUGFyZW50c1wiLCB7XG4gICAgICAgICAgICBrZXlQYXRoOiBpaVxuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgbiA9IGUuc3RvcmUoXCJjb2xsZWN0aW9uUGFyZW50c1wiKSwgcyA9IG5ldyBjciwgaSA9IHQgPT4ge1xuICAgICAgICAgICAgaWYgKHMuYWRkKHQpKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZSA9IHQubGFzdFNlZ21lbnQoKSwgcyA9IHQucG9wTGFzdCgpO1xuICAgICAgICAgICAgICAgIHJldHVybiBuLnB1dCh7XG4gICAgICAgICAgICAgICAgICAgIGNvbGxlY3Rpb25JZDogZSxcbiAgICAgICAgICAgICAgICAgICAgcGFyZW50OiBHcyhzKVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICAvLyBIZWxwZXIgdG8gYWRkIGFuIGluZGV4IGVudHJ5IGlmZiB3ZSBoYXZlbid0IGFscmVhZHkgd3JpdHRlbiBpdC5cbiAgICAgICAgICAgICAgICAvLyBJbmRleCBleGlzdGluZyByZW1vdGUgZG9jdW1lbnRzLlxuICAgICAgICByZXR1cm4gZS5zdG9yZShcInJlbW90ZURvY3VtZW50c1wiKS5XdCh7XG4gICAgICAgICAgICBqdDogITBcbiAgICAgICAgfSwgKCh0LCBlKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBuID0gbmV3IF90KHQpO1xuICAgICAgICAgICAgcmV0dXJuIGkobi5wb3BMYXN0KCkpO1xuICAgICAgICB9KSkubmV4dCgoKCkgPT4gZS5zdG9yZShcImRvY3VtZW50TXV0YXRpb25zXCIpLld0KHtcbiAgICAgICAgICAgIGp0OiAhMFxuICAgICAgICB9LCAoKFt0LCBlLCBuXSwgcykgPT4ge1xuICAgICAgICAgICAgY29uc3QgciA9IFdzKGUpO1xuICAgICAgICAgICAgcmV0dXJuIGkoci5wb3BMYXN0KCkpO1xuICAgICAgICB9KSkpKTtcbiAgICB9XG4gICAgSG4odCkge1xuICAgICAgICBjb25zdCBlID0gdC5zdG9yZShcInRhcmdldHNcIik7XG4gICAgICAgIHJldHVybiBlLld0KCgodCwgbikgPT4ge1xuICAgICAgICAgICAgY29uc3QgcyA9IFVpKG4pLCBpID0gcWkodGhpcy5NLCBzKTtcbiAgICAgICAgICAgIHJldHVybiBlLnB1dChpKTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICBKbih0LCBlKSB7XG4gICAgICAgIGNvbnN0IG4gPSBlLnN0b3JlKFwicmVtb3RlRG9jdW1lbnRzXCIpLCBzID0gW107XG4gICAgICAgIHJldHVybiBuLld0KCgodCwgbikgPT4ge1xuICAgICAgICAgICAgY29uc3QgaSA9IGUuc3RvcmUoXCJyZW1vdGVEb2N1bWVudHNWMTRcIiksIHIgPSAobyA9IG4sIG8uZG9jdW1lbnQgPyBuZXcgeHQoX3QuZnJvbVN0cmluZyhvLmRvY3VtZW50Lm5hbWUpLnBvcEZpcnN0KDUpKSA6IG8ubm9Eb2N1bWVudCA/IHh0LmZyb21TZWdtZW50cyhvLm5vRG9jdW1lbnQucGF0aCkgOiBvLnVua25vd25Eb2N1bWVudCA/IHh0LmZyb21TZWdtZW50cyhvLnVua25vd25Eb2N1bWVudC5wYXRoKSA6IEwoKSkucGF0aC50b0FycmF5KCk7XG4gICAgICAgICAgICB2YXIgbztcbiAgICAgICAgICAgIC8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovICAgICAgICAgICAgY29uc3QgdSA9IHtcbiAgICAgICAgICAgICAgICBwcmVmaXhQYXRoOiByLnNsaWNlKDAsIHIubGVuZ3RoIC0gMiksXG4gICAgICAgICAgICAgICAgY29sbGVjdGlvbkdyb3VwOiByW3IubGVuZ3RoIC0gMl0sXG4gICAgICAgICAgICAgICAgZG9jdW1lbnRJZDogcltyLmxlbmd0aCAtIDFdLFxuICAgICAgICAgICAgICAgIHJlYWRUaW1lOiBuLnJlYWRUaW1lIHx8IFsgMCwgMCBdLFxuICAgICAgICAgICAgICAgIHVua25vd25Eb2N1bWVudDogbi51bmtub3duRG9jdW1lbnQsXG4gICAgICAgICAgICAgICAgbm9Eb2N1bWVudDogbi5ub0RvY3VtZW50LFxuICAgICAgICAgICAgICAgIGRvY3VtZW50OiBuLmRvY3VtZW50LFxuICAgICAgICAgICAgICAgIGhhc0NvbW1pdHRlZE11dGF0aW9uczogISFuLmhhc0NvbW1pdHRlZE11dGF0aW9uc1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHMucHVzaChpLnB1dCh1KSk7XG4gICAgICAgIH0pKS5uZXh0KCgoKSA9PiB5aS53YWl0Rm9yKHMpKSk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBqcih0KSB7XG4gICAgdC5jcmVhdGVPYmplY3RTdG9yZShcInRhcmdldERvY3VtZW50c1wiLCB7XG4gICAgICAgIGtleVBhdGg6IG5pXG4gICAgfSkuY3JlYXRlSW5kZXgoXCJkb2N1bWVudFRhcmdldHNJbmRleFwiLCBzaSwge1xuICAgICAgICB1bmlxdWU6ICEwXG4gICAgfSk7XG4gICAgLy8gTk9URTogVGhpcyBpcyB1bmlxdWUgb25seSBiZWNhdXNlIHRoZSBUYXJnZXRJZCBpcyB0aGUgc3VmZml4LlxuICAgIHQuY3JlYXRlT2JqZWN0U3RvcmUoXCJ0YXJnZXRzXCIsIHtcbiAgICAgICAga2V5UGF0aDogXCJ0YXJnZXRJZFwiXG4gICAgfSkuY3JlYXRlSW5kZXgoXCJxdWVyeVRhcmdldHNJbmRleFwiLCBlaSwge1xuICAgICAgICB1bmlxdWU6ICEwXG4gICAgfSksIHQuY3JlYXRlT2JqZWN0U3RvcmUoXCJ0YXJnZXRHbG9iYWxcIik7XG59XG5cbmNvbnN0IFdyID0gXCJGYWlsZWQgdG8gb2J0YWluIGV4Y2x1c2l2ZSBhY2Nlc3MgdG8gdGhlIHBlcnNpc3RlbmNlIGxheWVyLiBUbyBhbGxvdyBzaGFyZWQgYWNjZXNzLCBtdWx0aS10YWIgc3luY2hyb25pemF0aW9uIGhhcyB0byBiZSBlbmFibGVkIGluIGFsbCB0YWJzLiBJZiB5b3UgYXJlIHVzaW5nIGBleHBlcmltZW50YWxGb3JjZU93bmluZ1RhYjp0cnVlYCwgbWFrZSBzdXJlIHRoYXQgb25seSBvbmUgdGFiIGhhcyBwZXJzaXN0ZW5jZSBlbmFibGVkIGF0IGFueSBnaXZlbiB0aW1lLlwiO1xuXG4vKipcbiAqIE9sZGVzdCBhY2NlcHRhYmxlIGFnZSBpbiBtaWxsaXNlY29uZHMgZm9yIGNsaWVudCBtZXRhZGF0YSBiZWZvcmUgdGhlIGNsaWVudFxuICogaXMgY29uc2lkZXJlZCBpbmFjdGl2ZSBhbmQgaXRzIGFzc29jaWF0ZWQgZGF0YSBpcyBnYXJiYWdlIGNvbGxlY3RlZC5cbiAqL1xuLyoqXG4gKiBBbiBJbmRleGVkREItYmFja2VkIGluc3RhbmNlIG9mIFBlcnNpc3RlbmNlLiBEYXRhIGlzIHN0b3JlZCBwZXJzaXN0ZW50bHlcbiAqIGFjcm9zcyBzZXNzaW9ucy5cbiAqXG4gKiBPbiBXZWIgb25seSwgdGhlIEZpcmVzdG9yZSBTREtzIHN1cHBvcnQgc2hhcmVkIGFjY2VzcyB0byBpdHMgcGVyc2lzdGVuY2VcbiAqIGxheWVyLiBUaGlzIGFsbG93cyBtdWx0aXBsZSBicm93c2VyIHRhYnMgdG8gcmVhZCBhbmQgd3JpdGUgdG8gSW5kZXhlZERiIGFuZFxuICogdG8gc3luY2hyb25pemUgc3RhdGUgZXZlbiB3aXRob3V0IG5ldHdvcmsgY29ubmVjdGl2aXR5LiBTaGFyZWQgYWNjZXNzIGlzXG4gKiBjdXJyZW50bHkgb3B0aW9uYWwgYW5kIG5vdCBlbmFibGVkIHVubGVzcyBhbGwgY2xpZW50cyBpbnZva2VcbiAqIGBlbmFibGVQZXJzaXN0ZW5jZSgpYCB3aXRoIGB7c3luY2hyb25pemVUYWJzOnRydWV9YC5cbiAqXG4gKiBJbiBtdWx0aS10YWIgbW9kZSwgaWYgbXVsdGlwbGUgY2xpZW50cyBhcmUgYWN0aXZlIGF0IHRoZSBzYW1lIHRpbWUsIHRoZSBTREtcbiAqIHdpbGwgZGVzaWduYXRlIG9uZSBjbGllbnQgYXMgdGhlIFx1MjAxQ3ByaW1hcnkgY2xpZW50XHUyMDFELiBBbiBlZmZvcnQgaXMgbWFkZSB0byBwaWNrXG4gKiBhIHZpc2libGUsIG5ldHdvcmstY29ubmVjdGVkIGFuZCBhY3RpdmUgY2xpZW50LCBhbmQgdGhpcyBjbGllbnQgaXNcbiAqIHJlc3BvbnNpYmxlIGZvciBsZXR0aW5nIG90aGVyIGNsaWVudHMga25vdyBhYm91dCBpdHMgcHJlc2VuY2UuIFRoZSBwcmltYXJ5XG4gKiBjbGllbnQgd3JpdGVzIGEgdW5pcXVlIGNsaWVudC1nZW5lcmF0ZWQgaWRlbnRpZmllciAodGhlIGNsaWVudCBJRCkgdG9cbiAqIEluZGV4ZWREYlx1MjAxOXMgXHUyMDFDb3duZXJcdTIwMUQgc3RvcmUgZXZlcnkgNCBzZWNvbmRzLiBJZiB0aGUgcHJpbWFyeSBjbGllbnQgZmFpbHMgdG9cbiAqIHVwZGF0ZSB0aGlzIGVudHJ5LCBhbm90aGVyIGNsaWVudCBjYW4gYWNxdWlyZSB0aGUgbGVhc2UgYW5kIHRha2Ugb3ZlciBhc1xuICogcHJpbWFyeS5cbiAqXG4gKiBTb21lIHBlcnNpc3RlbmNlIG9wZXJhdGlvbnMgaW4gdGhlIFNESyBhcmUgZGVzaWduYXRlZCBhcyBwcmltYXJ5LWNsaWVudCBvbmx5XG4gKiBvcGVyYXRpb25zLiBUaGlzIGluY2x1ZGVzIHRoZSBhY2tub3dsZWRnbWVudCBvZiBtdXRhdGlvbnMgYW5kIGFsbCB1cGRhdGVzIG9mXG4gKiByZW1vdGUgZG9jdW1lbnRzLiBUaGUgZWZmZWN0cyBvZiB0aGVzZSBvcGVyYXRpb25zIGFyZSB3cml0dGVuIHRvIHBlcnNpc3RlbmNlXG4gKiBhbmQgdGhlbiBicm9hZGNhc3QgdG8gb3RoZXIgdGFicyB2aWEgTG9jYWxTdG9yYWdlIChzZWVcbiAqIGBXZWJTdG9yYWdlU2hhcmVkQ2xpZW50U3RhdGVgKSwgd2hpY2ggdGhlbiByZWZyZXNoIHRoZWlyIHN0YXRlIGZyb21cbiAqIHBlcnNpc3RlbmNlLlxuICpcbiAqIFNpbWlsYXJseSwgdGhlIHByaW1hcnkgY2xpZW50IGxpc3RlbnMgdG8gbm90aWZpY2F0aW9ucyBzZW50IGJ5IHNlY29uZGFyeVxuICogY2xpZW50cyB0byBkaXNjb3ZlciBwZXJzaXN0ZW5jZSBjaGFuZ2VzIHdyaXR0ZW4gYnkgc2Vjb25kYXJ5IGNsaWVudHMsIHN1Y2ggYXNcbiAqIHRoZSBhZGRpdGlvbiBvZiBuZXcgbXV0YXRpb25zIGFuZCBxdWVyeSB0YXJnZXRzLlxuICpcbiAqIElmIG11bHRpLXRhYiBpcyBub3QgZW5hYmxlZCBhbmQgYW5vdGhlciB0YWIgYWxyZWFkeSBvYnRhaW5lZCB0aGUgcHJpbWFyeVxuICogbGVhc2UsIEluZGV4ZWREYlBlcnNpc3RlbmNlIGVudGVycyBhIGZhaWxlZCBzdGF0ZSBhbmQgYWxsIHN1YnNlcXVlbnRcbiAqIG9wZXJhdGlvbnMgd2lsbCBhdXRvbWF0aWNhbGx5IGZhaWwuXG4gKlxuICogQWRkaXRpb25hbGx5LCB0aGVyZSBpcyBhbiBvcHRpbWl6YXRpb24gc28gdGhhdCB3aGVuIGEgdGFiIGlzIGNsb3NlZCwgdGhlXG4gKiBwcmltYXJ5IGxlYXNlIGlzIHJlbGVhc2VkIGltbWVkaWF0ZWx5ICh0aGlzIGlzIGVzcGVjaWFsbHkgaW1wb3J0YW50IHRvIG1ha2VcbiAqIHN1cmUgdGhhdCBhIHJlZnJlc2hlZCB0YWIgaXMgYWJsZSB0byBpbW1lZGlhdGVseSByZS1hY3F1aXJlIHRoZSBwcmltYXJ5XG4gKiBsZWFzZSkuIFVuZm9ydHVuYXRlbHksIEluZGV4ZWREQiBjYW5ub3QgYmUgcmVsaWFibHkgdXNlZCBpbiB3aW5kb3cudW5sb2FkXG4gKiBzaW5jZSBpdCBpcyBhbiBhc3luY2hyb25vdXMgQVBJLiBTbyBpbiBhZGRpdGlvbiB0byBhdHRlbXB0aW5nIHRvIGdpdmUgdXAgdGhlXG4gKiBsZWFzZSwgdGhlIGxlYXNlaG9sZGVyIHdyaXRlcyBpdHMgY2xpZW50IElEIHRvIGEgXCJ6b21iaWVkQ2xpZW50XCIgZW50cnkgaW5cbiAqIExvY2FsU3RvcmFnZSB3aGljaCBhY3RzIGFzIGFuIGluZGljYXRvciB0aGF0IGFub3RoZXIgdGFiIHNob3VsZCBnbyBhaGVhZCBhbmRcbiAqIHRha2UgdGhlIHByaW1hcnkgbGVhc2UgaW1tZWRpYXRlbHkgcmVnYXJkbGVzcyBvZiB0aGUgY3VycmVudCBsZWFzZSB0aW1lc3RhbXAuXG4gKlxuICogVE9ETyhiLzExNDIyNjIzNCk6IFJlbW92ZSBgc3luY2hyb25pemVUYWJzYCBzZWN0aW9uIHdoZW4gbXVsdGktdGFiIGlzIG5vXG4gKiBsb25nZXIgb3B0aW9uYWwuXG4gKi9cbmNsYXNzIHpyIHtcbiAgICBjb25zdHJ1Y3RvcihcbiAgICAvKipcbiAgICAgKiBXaGV0aGVyIHRvIHN5bmNocm9uaXplIHRoZSBpbi1tZW1vcnkgc3RhdGUgb2YgbXVsdGlwbGUgdGFicyBhbmQgc2hhcmVcbiAgICAgKiBhY2Nlc3MgdG8gbG9jYWwgcGVyc2lzdGVuY2UuXG4gICAgICovXG4gICAgdCwgZSwgbiwgcywgaSwgciwgbywgdSwgYSwgXG4gICAgLyoqXG4gICAgICogSWYgc2V0IHRvIHRydWUsIGZvcmNlZnVsbHkgb2J0YWlucyBkYXRhYmFzZSBhY2Nlc3MuIEV4aXN0aW5nIHRhYnMgd2lsbFxuICAgICAqIG5vIGxvbmdlciBiZSBhYmxlIHRvIGFjY2VzcyBJbmRleGVkREIuXG4gICAgICovXG4gICAgYywgaCA9IDEzKSB7XG4gICAgICAgIGlmICh0aGlzLmFsbG93VGFiU3luY2hyb25pemF0aW9uID0gdCwgdGhpcy5wZXJzaXN0ZW5jZUtleSA9IGUsIHRoaXMuY2xpZW50SWQgPSBuLCBcbiAgICAgICAgdGhpcy5ZbiA9IGksIHRoaXMud2luZG93ID0gciwgdGhpcy5kb2N1bWVudCA9IG8sIHRoaXMuWG4gPSBhLCB0aGlzLlpuID0gYywgdGhpcy50cyA9IGgsIFxuICAgICAgICB0aGlzLmVzID0gbnVsbCwgdGhpcy5ucyA9ICExLCB0aGlzLmlzUHJpbWFyeSA9ICExLCB0aGlzLm5ldHdvcmtFbmFibGVkID0gITAsIFxuICAgICAgICAvKiogT3VyIHdpbmRvdy51bmxvYWQgaGFuZGxlciwgaWYgcmVnaXN0ZXJlZC4gKi9cbiAgICAgICAgdGhpcy5zcyA9IG51bGwsIHRoaXMuaW5Gb3JlZ3JvdW5kID0gITEsIFxuICAgICAgICAvKiogT3VyICd2aXNpYmlsaXR5Y2hhbmdlJyBsaXN0ZW5lciBpZiByZWdpc3RlcmVkLiAqL1xuICAgICAgICB0aGlzLnJzID0gbnVsbCwgXG4gICAgICAgIC8qKiBUaGUgY2xpZW50IG1ldGFkYXRhIHJlZnJlc2ggdGFzay4gKi9cbiAgICAgICAgdGhpcy5vcyA9IG51bGwsIFxuICAgICAgICAvKiogVGhlIGxhc3QgdGltZSB3ZSBnYXJiYWdlIGNvbGxlY3RlZCB0aGUgY2xpZW50IG1ldGFkYXRhIG9iamVjdCBzdG9yZS4gKi9cbiAgICAgICAgdGhpcy51cyA9IE51bWJlci5ORUdBVElWRV9JTkZJTklUWSwgXG4gICAgICAgIC8qKiBBIGxpc3RlbmVyIHRvIG5vdGlmeSBvbiBwcmltYXJ5IHN0YXRlIGNoYW5nZXMuICovXG4gICAgICAgIHRoaXMuY3MgPSB0ID0+IFByb21pc2UucmVzb2x2ZSgpLCAhenIudnQoKSkgdGhyb3cgbmV3IFEoRy5VTklNUExFTUVOVEVELCBcIlRoaXMgcGxhdGZvcm0gaXMgZWl0aGVyIG1pc3NpbmcgSW5kZXhlZERCIG9yIGlzIGtub3duIHRvIGhhdmUgYW4gaW5jb21wbGV0ZSBpbXBsZW1lbnRhdGlvbi4gT2ZmbGluZSBwZXJzaXN0ZW5jZSBoYXMgYmVlbiBkaXNhYmxlZC5cIik7XG4gICAgICAgIHRoaXMucmVmZXJlbmNlRGVsZWdhdGUgPSBuZXcgTXIodGhpcywgcyksIHRoaXMuaHMgPSBlICsgXCJtYWluXCIsIHRoaXMuTSA9IG5ldyBraSh1KSwgXG4gICAgICAgIHRoaXMubHMgPSBuZXcgSWkodGhpcy5ocywgdGhpcy50cywgbmV3IFFyKHRoaXMuTSkpLCB0aGlzLmZzID0gbmV3IFByKHRoaXMucmVmZXJlbmNlRGVsZWdhdGUsIHRoaXMuTSksIFxuICAgICAgICB0aGlzLmRzID0gZnVuY3Rpb24odCkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyAkcih0KTtcbiAgICAgICAgfSh0aGlzLk0pLCB0aGlzLl9zID0gbmV3IGppLCB0aGlzLndpbmRvdyAmJiB0aGlzLndpbmRvdy5sb2NhbFN0b3JhZ2UgPyB0aGlzLndzID0gdGhpcy53aW5kb3cubG9jYWxTdG9yYWdlIDogKHRoaXMud3MgPSBudWxsLCBcbiAgICAgICAgITEgPT09IGMgJiYgRihcIkluZGV4ZWREYlBlcnNpc3RlbmNlXCIsIFwiTG9jYWxTdG9yYWdlIGlzIHVuYXZhaWxhYmxlLiBBcyBhIHJlc3VsdCwgcGVyc2lzdGVuY2UgbWF5IG5vdCB3b3JrIHJlbGlhYmx5LiBJbiBwYXJ0aWN1bGFyIGVuYWJsZVBlcnNpc3RlbmNlKCkgY291bGQgZmFpbCBpbW1lZGlhdGVseSBhZnRlciByZWZyZXNoaW5nIHRoZSBwYWdlLlwiKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEF0dGVtcHQgdG8gc3RhcnQgSW5kZXhlZERiIHBlcnNpc3RlbmNlLlxuICAgICAqXG4gICAgICogQHJldHVybnMgV2hldGhlciBwZXJzaXN0ZW5jZSB3YXMgZW5hYmxlZC5cbiAgICAgKi8gICAgc3RhcnQoKSB7XG4gICAgICAgIC8vIE5PVEU6IFRoaXMgaXMgZXhwZWN0ZWQgdG8gZmFpbCBzb21ldGltZXMgKGluIHRoZSBjYXNlIG9mIGFub3RoZXIgdGFiXG4gICAgICAgIC8vIGFscmVhZHkgaGF2aW5nIHRoZSBwZXJzaXN0ZW5jZSBsb2NrKSwgc28gaXQncyB0aGUgZmlyc3QgdGhpbmcgd2Ugc2hvdWxkXG4gICAgICAgIC8vIGRvLlxuICAgICAgICByZXR1cm4gdGhpcy5ncygpLnRoZW4oKCgpID0+IHtcbiAgICAgICAgICAgIGlmICghdGhpcy5pc1ByaW1hcnkgJiYgIXRoaXMuYWxsb3dUYWJTeW5jaHJvbml6YXRpb24pIFxuICAgICAgICAgICAgLy8gRmFpbCBgc3RhcnQoKWAgaWYgYHN5bmNocm9uaXplVGFic2AgaXMgZGlzYWJsZWQgYW5kIHdlIGNhbm5vdFxuICAgICAgICAgICAgLy8gb2J0YWluIHRoZSBwcmltYXJ5IGxlYXNlLlxuICAgICAgICAgICAgdGhyb3cgbmV3IFEoRy5GQUlMRURfUFJFQ09ORElUSU9OLCBXcik7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy55cygpLCB0aGlzLnBzKCksIHRoaXMuSXMoKSwgdGhpcy5ydW5UcmFuc2FjdGlvbihcImdldEhpZ2hlc3RMaXN0ZW5TZXF1ZW5jZU51bWJlclwiLCBcInJlYWRvbmx5XCIsICh0ID0+IHRoaXMuZnMuZ2V0SGlnaGVzdFNlcXVlbmNlTnVtYmVyKHQpKSk7XG4gICAgICAgIH0pKS50aGVuKCh0ID0+IHtcbiAgICAgICAgICAgIHRoaXMuZXMgPSBuZXcgbnQodCwgdGhpcy5Ybik7XG4gICAgICAgIH0pKS50aGVuKCgoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLm5zID0gITA7XG4gICAgICAgIH0pKS5jYXRjaCgodCA9PiAodGhpcy5scyAmJiB0aGlzLmxzLmNsb3NlKCksIFByb21pc2UucmVqZWN0KHQpKSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZWdpc3RlcnMgYSBsaXN0ZW5lciB0aGF0IGdldHMgY2FsbGVkIHdoZW4gdGhlIHByaW1hcnkgc3RhdGUgb2YgdGhlXG4gICAgICogaW5zdGFuY2UgY2hhbmdlcy4gVXBvbiByZWdpc3RlcmluZywgdGhpcyBsaXN0ZW5lciBpcyBpbnZva2VkIGltbWVkaWF0ZWx5XG4gICAgICogd2l0aCB0aGUgY3VycmVudCBwcmltYXJ5IHN0YXRlLlxuICAgICAqXG4gICAgICogUE9SVElORyBOT1RFOiBUaGlzIGlzIG9ubHkgdXNlZCBmb3IgV2ViIG11bHRpLXRhYi5cbiAgICAgKi8gICAgVHModCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jcyA9IGFzeW5jIGUgPT4ge1xuICAgICAgICAgICAgaWYgKHRoaXMuc3RhcnRlZCkgcmV0dXJuIHQoZSk7XG4gICAgICAgIH0sIHQodGhpcy5pc1ByaW1hcnkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZWdpc3RlcnMgYSBsaXN0ZW5lciB0aGF0IGdldHMgY2FsbGVkIHdoZW4gdGhlIGRhdGFiYXNlIHJlY2VpdmVzIGFcbiAgICAgKiB2ZXJzaW9uIGNoYW5nZSBldmVudCBpbmRpY2F0aW5nIHRoYXQgaXQgaGFzIGRlbGV0ZWQuXG4gICAgICpcbiAgICAgKiBQT1JUSU5HIE5PVEU6IFRoaXMgaXMgb25seSB1c2VkIGZvciBXZWIgbXVsdGktdGFiLlxuICAgICAqLyAgICBzZXREYXRhYmFzZURlbGV0ZWRMaXN0ZW5lcih0KSB7XG4gICAgICAgIHRoaXMubHMuT3QoKGFzeW5jIGUgPT4ge1xuICAgICAgICAgICAgLy8gQ2hlY2sgaWYgYW4gYXR0ZW1wdCBpcyBtYWRlIHRvIGRlbGV0ZSBJbmRleGVkREIuXG4gICAgICAgICAgICBudWxsID09PSBlLm5ld1ZlcnNpb24gJiYgYXdhaXQgdCgpO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEFkanVzdHMgdGhlIGN1cnJlbnQgbmV0d29yayBzdGF0ZSBpbiB0aGUgY2xpZW50J3MgbWV0YWRhdGEsIHBvdGVudGlhbGx5XG4gICAgICogYWZmZWN0aW5nIHRoZSBwcmltYXJ5IGxlYXNlLlxuICAgICAqXG4gICAgICogUE9SVElORyBOT1RFOiBUaGlzIGlzIG9ubHkgdXNlZCBmb3IgV2ViIG11bHRpLXRhYi5cbiAgICAgKi8gICAgc2V0TmV0d29ya0VuYWJsZWQodCkge1xuICAgICAgICB0aGlzLm5ldHdvcmtFbmFibGVkICE9PSB0ICYmICh0aGlzLm5ldHdvcmtFbmFibGVkID0gdCwgXG4gICAgICAgIC8vIFNjaGVkdWxlIGEgcHJpbWFyeSBsZWFzZSByZWZyZXNoIGZvciBpbW1lZGlhdGUgZXhlY3V0aW9uLiBUaGUgZXZlbnR1YWxcbiAgICAgICAgLy8gbGVhc2UgdXBkYXRlIHdpbGwgYmUgcHJvcGFnYXRlZCB2aWEgYHByaW1hcnlTdGF0ZUxpc3RlbmVyYC5cbiAgICAgICAgdGhpcy5Zbi5lbnF1ZXVlQW5kRm9yZ2V0KChhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnN0YXJ0ZWQgJiYgYXdhaXQgdGhpcy5ncygpO1xuICAgICAgICB9KSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBVcGRhdGVzIHRoZSBjbGllbnQgbWV0YWRhdGEgaW4gSW5kZXhlZERiIGFuZCBhdHRlbXB0cyB0byBlaXRoZXIgb2J0YWluIG9yXG4gICAgICogZXh0ZW5kIHRoZSBwcmltYXJ5IGxlYXNlIGZvciB0aGUgbG9jYWwgY2xpZW50LiBBc3luY2hyb25vdXNseSBub3RpZmllcyB0aGVcbiAgICAgKiBwcmltYXJ5IHN0YXRlIGxpc3RlbmVyIGlmIHRoZSBjbGllbnQgZWl0aGVyIG5ld2x5IG9idGFpbmVkIG9yIHJlbGVhc2VkIGl0c1xuICAgICAqIHByaW1hcnkgbGVhc2UuXG4gICAgICovICAgIGdzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5ydW5UcmFuc2FjdGlvbihcInVwZGF0ZUNsaWVudE1ldGFkYXRhQW5kVHJ5QmVjb21lUHJpbWFyeVwiLCBcInJlYWR3cml0ZVwiLCAodCA9PiBKcih0KS5wdXQoe1xuICAgICAgICAgICAgY2xpZW50SWQ6IHRoaXMuY2xpZW50SWQsXG4gICAgICAgICAgICB1cGRhdGVUaW1lTXM6IERhdGUubm93KCksXG4gICAgICAgICAgICBuZXR3b3JrRW5hYmxlZDogdGhpcy5uZXR3b3JrRW5hYmxlZCxcbiAgICAgICAgICAgIGluRm9yZWdyb3VuZDogdGhpcy5pbkZvcmVncm91bmRcbiAgICAgICAgfSkubmV4dCgoKCkgPT4ge1xuICAgICAgICAgICAgaWYgKHRoaXMuaXNQcmltYXJ5KSByZXR1cm4gdGhpcy5Fcyh0KS5uZXh0KCh0ID0+IHtcbiAgICAgICAgICAgICAgICB0IHx8ICh0aGlzLmlzUHJpbWFyeSA9ICExLCB0aGlzLlluLmVucXVldWVSZXRyeWFibGUoKCgpID0+IHRoaXMuY3MoITEpKSkpO1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICB9KSkubmV4dCgoKCkgPT4gdGhpcy5Bcyh0KSkpLm5leHQoKGUgPT4gdGhpcy5pc1ByaW1hcnkgJiYgIWUgPyB0aGlzLlJzKHQpLm5leHQoKCgpID0+ICExKSkgOiAhIWUgJiYgdGhpcy5icyh0KS5uZXh0KCgoKSA9PiAhMCkpKSkpKS5jYXRjaCgodCA9PiB7XG4gICAgICAgICAgICBpZiAoQWkodCkpIFxuICAgICAgICAgICAgLy8gUHJvY2VlZCB3aXRoIHRoZSBleGlzdGluZyBzdGF0ZS4gQW55IHN1YnNlcXVlbnQgYWNjZXNzIHRvXG4gICAgICAgICAgICAvLyBJbmRleGVkREIgd2lsbCB2ZXJpZnkgdGhlIGxlYXNlLlxuICAgICAgICAgICAgcmV0dXJuIE8oXCJJbmRleGVkRGJQZXJzaXN0ZW5jZVwiLCBcIkZhaWxlZCB0byBleHRlbmQgb3duZXIgbGVhc2U6IFwiLCB0KSwgdGhpcy5pc1ByaW1hcnk7XG4gICAgICAgICAgICBpZiAoIXRoaXMuYWxsb3dUYWJTeW5jaHJvbml6YXRpb24pIHRocm93IHQ7XG4gICAgICAgICAgICByZXR1cm4gTyhcIkluZGV4ZWREYlBlcnNpc3RlbmNlXCIsIFwiUmVsZWFzaW5nIG93bmVyIGxlYXNlIGFmdGVyIGVycm9yIGR1cmluZyBsZWFzZSByZWZyZXNoXCIsIHQpLCBcbiAgICAgICAgICAgIC8qIGlzUHJpbWFyeT0gKi8gITE7XG4gICAgICAgIH0pKS50aGVuKCh0ID0+IHtcbiAgICAgICAgICAgIHRoaXMuaXNQcmltYXJ5ICE9PSB0ICYmIHRoaXMuWW4uZW5xdWV1ZVJldHJ5YWJsZSgoKCkgPT4gdGhpcy5jcyh0KSkpLCB0aGlzLmlzUHJpbWFyeSA9IHQ7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgRXModCkge1xuICAgICAgICByZXR1cm4gSHIodCkuZ2V0KFwib3duZXJcIikubmV4dCgodCA9PiB5aS5yZXNvbHZlKHRoaXMuUHModCkpKSk7XG4gICAgfVxuICAgIFZzKHQpIHtcbiAgICAgICAgcmV0dXJuIEpyKHQpLmRlbGV0ZSh0aGlzLmNsaWVudElkKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogSWYgdGhlIGdhcmJhZ2UgY29sbGVjdGlvbiB0aHJlc2hvbGQgaGFzIHBhc3NlZCwgcHJ1bmVzIHRoZVxuICAgICAqIFJlbW90ZURvY3VtZW50Q2hhbmdlcyBhbmQgdGhlIENsaWVudE1ldGFkYXRhIHN0b3JlIGJhc2VkIG9uIHRoZSBsYXN0IHVwZGF0ZVxuICAgICAqIHRpbWUgb2YgYWxsIGNsaWVudHMuXG4gICAgICovICAgIGFzeW5jIHZzKCkge1xuICAgICAgICBpZiAodGhpcy5pc1ByaW1hcnkgJiYgIXRoaXMuU3ModGhpcy51cywgMThlNSkpIHtcbiAgICAgICAgICAgIHRoaXMudXMgPSBEYXRlLm5vdygpO1xuICAgICAgICAgICAgY29uc3QgdCA9IGF3YWl0IHRoaXMucnVuVHJhbnNhY3Rpb24oXCJtYXliZUdhcmJhZ2VDb2xsZWN0TXVsdGlDbGllbnRTdGF0ZVwiLCBcInJlYWR3cml0ZS1wcmltYXJ5XCIsICh0ID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBlID0gU2kodCwgXCJjbGllbnRNZXRhZGF0YVwiKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZS5xdCgpLm5leHQoKHQgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBuID0gdGhpcy5Ecyh0LCAxOGU1KSwgcyA9IHQuZmlsdGVyKCh0ID0+IC0xID09PSBuLmluZGV4T2YodCkpKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gRGVsZXRlIG1ldGFkYXRhIGZvciBjbGllbnRzIHRoYXQgYXJlIG5vIGxvbmdlciBjb25zaWRlcmVkIGFjdGl2ZS5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHlpLmZvckVhY2gocywgKHQgPT4gZS5kZWxldGUodC5jbGllbnRJZCkpKS5uZXh0KCgoKSA9PiBzKSk7XG4gICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgfSkpLmNhdGNoKCgoKSA9PiBbXSkpO1xuICAgICAgICAgICAgLy8gRGVsZXRlIHBvdGVudGlhbCBsZWZ0b3ZlciBlbnRyaWVzIHRoYXQgbWF5IGNvbnRpbnVlIHRvIG1hcmsgdGhlXG4gICAgICAgICAgICAvLyBpbmFjdGl2ZSBjbGllbnRzIGFzIHpvbWJpZWQgaW4gTG9jYWxTdG9yYWdlLlxuICAgICAgICAgICAgLy8gSWRlYWxseSB3ZSdkIGRlbGV0ZSB0aGUgSW5kZXhlZERiIGFuZCBMb2NhbFN0b3JhZ2Ugem9tYmllIGVudHJpZXMgZm9yXG4gICAgICAgICAgICAvLyB0aGUgY2xpZW50IGF0b21pY2FsbHksIGJ1dCB3ZSBjYW4ndC4gU28gd2Ugb3B0IHRvIGRlbGV0ZSB0aGUgSW5kZXhlZERiXG4gICAgICAgICAgICAvLyBlbnRyaWVzIGZpcnN0IHRvIGF2b2lkIHBvdGVudGlhbGx5IHJldml2aW5nIGEgem9tYmllZCBjbGllbnQuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy53cykgZm9yIChjb25zdCBlIG9mIHQpIHRoaXMud3MucmVtb3ZlSXRlbSh0aGlzLkNzKGUuY2xpZW50SWQpKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBTY2hlZHVsZXMgYSByZWN1cnJpbmcgdGltZXIgdG8gdXBkYXRlIHRoZSBjbGllbnQgbWV0YWRhdGEgYW5kIHRvIGVpdGhlclxuICAgICAqIGV4dGVuZCBvciBhY3F1aXJlIHRoZSBwcmltYXJ5IGxlYXNlIGlmIHRoZSBjbGllbnQgaXMgZWxpZ2libGUuXG4gICAgICovICAgIElzKCkge1xuICAgICAgICB0aGlzLm9zID0gdGhpcy5Zbi5lbnF1ZXVlQWZ0ZXJEZWxheShcImNsaWVudF9tZXRhZGF0YV9yZWZyZXNoXCIgLyogQ2xpZW50TWV0YWRhdGFSZWZyZXNoICovICwgNGUzLCAoKCkgPT4gdGhpcy5ncygpLnRoZW4oKCgpID0+IHRoaXMudnMoKSkpLnRoZW4oKCgpID0+IHRoaXMuSXMoKSkpKSk7XG4gICAgfVxuICAgIC8qKiBDaGVja3Mgd2hldGhlciBgY2xpZW50YCBpcyB0aGUgbG9jYWwgY2xpZW50LiAqLyAgICBQcyh0KSB7XG4gICAgICAgIHJldHVybiAhIXQgJiYgdC5vd25lcklkID09PSB0aGlzLmNsaWVudElkO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBFdmFsdWF0ZSB0aGUgc3RhdGUgb2YgYWxsIGFjdGl2ZSBjbGllbnRzIGFuZCBkZXRlcm1pbmUgd2hldGhlciB0aGUgbG9jYWxcbiAgICAgKiBjbGllbnQgaXMgb3IgY2FuIGFjdCBhcyB0aGUgaG9sZGVyIG9mIHRoZSBwcmltYXJ5IGxlYXNlLiBSZXR1cm5zIHdoZXRoZXJcbiAgICAgKiB0aGUgY2xpZW50IGlzIGVsaWdpYmxlIGZvciB0aGUgbGVhc2UsIGJ1dCBkb2VzIG5vdCBhY3R1YWxseSBhY3F1aXJlIGl0LlxuICAgICAqIE1heSByZXR1cm4gJ2ZhbHNlJyBldmVuIGlmIHRoZXJlIGlzIG5vIGFjdGl2ZSBsZWFzZWhvbGRlciBhbmQgYW5vdGhlclxuICAgICAqIChmb3JlZ3JvdW5kKSBjbGllbnQgc2hvdWxkIGJlY29tZSBsZWFzZWhvbGRlciBpbnN0ZWFkLlxuICAgICAqLyAgICBBcyh0KSB7XG4gICAgICAgIGlmICh0aGlzLlpuKSByZXR1cm4geWkucmVzb2x2ZSghMCk7XG4gICAgICAgIHJldHVybiBIcih0KS5nZXQoXCJvd25lclwiKS5uZXh0KChlID0+IHtcbiAgICAgICAgICAgIC8vIEEgY2xpZW50IGlzIGVsaWdpYmxlIGZvciB0aGUgcHJpbWFyeSBsZWFzZSBpZjpcbiAgICAgICAgICAgIC8vIC0gaXRzIG5ldHdvcmsgaXMgZW5hYmxlZCBhbmQgdGhlIGNsaWVudCdzIHRhYiBpcyBpbiB0aGUgZm9yZWdyb3VuZC5cbiAgICAgICAgICAgIC8vIC0gaXRzIG5ldHdvcmsgaXMgZW5hYmxlZCBhbmQgbm8gb3RoZXIgY2xpZW50J3MgdGFiIGlzIGluIHRoZVxuICAgICAgICAgICAgLy8gICBmb3JlZ3JvdW5kLlxuICAgICAgICAgICAgLy8gLSBldmVyeSBjbGllbnRzIG5ldHdvcmsgaXMgZGlzYWJsZWQgYW5kIHRoZSBjbGllbnQncyB0YWIgaXMgaW4gdGhlXG4gICAgICAgICAgICAvLyAgIGZvcmVncm91bmQuXG4gICAgICAgICAgICAvLyAtIGV2ZXJ5IGNsaWVudHMgbmV0d29yayBpcyBkaXNhYmxlZCBhbmQgbm8gb3RoZXIgY2xpZW50J3MgdGFiIGlzIGluXG4gICAgICAgICAgICAvLyAgIHRoZSBmb3JlZ3JvdW5kLlxuICAgICAgICAgICAgLy8gLSB0aGUgYGZvcmNlT3duaW5nVGFiYCBzZXR0aW5nIHdhcyBwYXNzZWQgaW4uXG4gICAgICAgICAgICBpZiAobnVsbCAhPT0gZSAmJiB0aGlzLlNzKGUubGVhc2VUaW1lc3RhbXBNcywgNWUzKSAmJiAhdGhpcy54cyhlLm93bmVySWQpKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuUHMoZSkgJiYgdGhpcy5uZXR3b3JrRW5hYmxlZCkgcmV0dXJuICEwO1xuICAgICAgICAgICAgICAgIGlmICghdGhpcy5QcyhlKSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWUuYWxsb3dUYWJTeW5jaHJvbml6YXRpb24pIFxuICAgICAgICAgICAgICAgICAgICAvLyBGYWlsIHRoZSBgY2FuQWN0QXNQcmltYXJ5YCBjaGVjayBpZiB0aGUgY3VycmVudCBsZWFzZWhvbGRlciBoYXNcbiAgICAgICAgICAgICAgICAgICAgLy8gbm90IG9wdGVkIGludG8gbXVsdGktdGFiIHN5bmNocm9uaXphdGlvbi4gSWYgdGhpcyBoYXBwZW5zIGF0XG4gICAgICAgICAgICAgICAgICAgIC8vIGNsaWVudCBzdGFydHVwLCB3ZSByZWplY3QgdGhlIFByb21pc2UgcmV0dXJuZWQgYnlcbiAgICAgICAgICAgICAgICAgICAgLy8gYGVuYWJsZVBlcnNpc3RlbmNlKClgIGFuZCB0aGUgdXNlciBjYW4gY29udGludWUgdG8gdXNlIEZpcmVzdG9yZVxuICAgICAgICAgICAgICAgICAgICAvLyB3aXRoIGluLW1lbW9yeSBwZXJzaXN0ZW5jZS5cbiAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGhpcyBmYWlscyBkdXJpbmcgYSBsZWFzZSByZWZyZXNoLCB3ZSB3aWxsIGluc3RlYWQgYmxvY2sgdGhlXG4gICAgICAgICAgICAgICAgICAgIC8vIEFzeW5jUXVldWUgZnJvbSBleGVjdXRpbmcgZnVydGhlciBvcGVyYXRpb25zLiBOb3RlIHRoYXQgdGhpcyBpc1xuICAgICAgICAgICAgICAgICAgICAvLyBhY2NlcHRhYmxlIHNpbmNlIG1peGluZyAmIG1hdGNoaW5nIGRpZmZlcmVudCBgc3luY2hyb25pemVUYWJzYFxuICAgICAgICAgICAgICAgICAgICAvLyBzZXR0aW5ncyBpcyBub3Qgc3VwcG9ydGVkLlxuICAgICAgICAgICAgICAgICAgICAvLyBUT0RPKGIvMTE0MjI2MjM0KTogUmVtb3ZlIHRoaXMgY2hlY2sgd2hlbiBgc3luY2hyb25pemVUYWJzYCBjYW5cbiAgICAgICAgICAgICAgICAgICAgLy8gbm8gbG9uZ2VyIGJlIHR1cm5lZCBvZmYuXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBRKEcuRkFJTEVEX1BSRUNPTkRJVElPTiwgV3IpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gITE7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuICEoIXRoaXMubmV0d29ya0VuYWJsZWQgfHwgIXRoaXMuaW5Gb3JlZ3JvdW5kKSB8fCBKcih0KS5xdCgpLm5leHQoKHQgPT4gdm9pZCAwID09PSB0aGlzLkRzKHQsIDVlMykuZmluZCgodCA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuY2xpZW50SWQgIT09IHQuY2xpZW50SWQpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZSA9ICF0aGlzLm5ldHdvcmtFbmFibGVkICYmIHQubmV0d29ya0VuYWJsZWQsIG4gPSAhdGhpcy5pbkZvcmVncm91bmQgJiYgdC5pbkZvcmVncm91bmQsIHMgPSB0aGlzLm5ldHdvcmtFbmFibGVkID09PSB0Lm5ldHdvcmtFbmFibGVkO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZSB8fCBuICYmIHMpIHJldHVybiAhMDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuICExO1xuICAgICAgICAgICAgfSkpKSk7XG4gICAgICAgIH0pKS5uZXh0KCh0ID0+ICh0aGlzLmlzUHJpbWFyeSAhPT0gdCAmJiBPKFwiSW5kZXhlZERiUGVyc2lzdGVuY2VcIiwgYENsaWVudCAke3QgPyBcImlzXCIgOiBcImlzIG5vdFwifSBlbGlnaWJsZSBmb3IgYSBwcmltYXJ5IGxlYXNlLmApLCBcbiAgICAgICAgdCkpKTtcbiAgICB9XG4gICAgYXN5bmMgc2h1dGRvd24oKSB7XG4gICAgICAgIC8vIFRoZSBzaHV0ZG93bigpIG9wZXJhdGlvbnMgYXJlIGlkZW1wb3RlbnQgYW5kIGNhbiBiZSBjYWxsZWQgZXZlbiB3aGVuXG4gICAgICAgIC8vIHN0YXJ0KCkgYWJvcnRlZCAoZS5nLiBiZWNhdXNlIGl0IGNvdWxkbid0IGFjcXVpcmUgdGhlIHBlcnNpc3RlbmNlIGxlYXNlKS5cbiAgICAgICAgdGhpcy5ucyA9ICExLCB0aGlzLk5zKCksIHRoaXMub3MgJiYgKHRoaXMub3MuY2FuY2VsKCksIHRoaXMub3MgPSBudWxsKSwgdGhpcy5rcygpLCBcbiAgICAgICAgdGhpcy5NcygpLCBcbiAgICAgICAgLy8gVXNlIGBTaW1wbGVEYi5ydW5UcmFuc2FjdGlvbmAgZGlyZWN0bHkgdG8gYXZvaWQgZmFpbGluZyBpZiBhbm90aGVyIHRhYlxuICAgICAgICAvLyBoYXMgb2J0YWluZWQgdGhlIHByaW1hcnkgbGVhc2UuXG4gICAgICAgIGF3YWl0IHRoaXMubHMucnVuVHJhbnNhY3Rpb24oXCJzaHV0ZG93blwiLCBcInJlYWR3cml0ZVwiLCBbIFwib3duZXJcIiwgXCJjbGllbnRNZXRhZGF0YVwiIF0sICh0ID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGUgPSBuZXcgdmkodCwgbnQuQSk7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5ScyhlKS5uZXh0KCgoKSA9PiB0aGlzLlZzKGUpKSk7XG4gICAgICAgIH0pKSwgdGhpcy5scy5jbG9zZSgpLCBcbiAgICAgICAgLy8gUmVtb3ZlIHRoZSBlbnRyeSBtYXJraW5nIHRoZSBjbGllbnQgYXMgem9tYmllZCBmcm9tIExvY2FsU3RvcmFnZSBzaW5jZVxuICAgICAgICAvLyB3ZSBzdWNjZXNzZnVsbHkgZGVsZXRlZCBpdHMgbWV0YWRhdGEgZnJvbSBJbmRleGVkRGIuXG4gICAgICAgIHRoaXMuT3MoKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyBjbGllbnRzIHRoYXQgYXJlIG5vdCB6b21iaWVkIGFuZCBoYXZlIGFuIHVwZGF0ZVRpbWUgd2l0aGluIHRoZVxuICAgICAqIHByb3ZpZGVkIHRocmVzaG9sZC5cbiAgICAgKi8gICAgRHModCwgZSkge1xuICAgICAgICByZXR1cm4gdC5maWx0ZXIoKHQgPT4gdGhpcy5Tcyh0LnVwZGF0ZVRpbWVNcywgZSkgJiYgIXRoaXMueHModC5jbGllbnRJZCkpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0aGUgSURzIG9mIHRoZSBjbGllbnRzIHRoYXQgYXJlIGN1cnJlbnRseSBhY3RpdmUuIElmIG11bHRpLXRhYlxuICAgICAqIGlzIG5vdCBzdXBwb3J0ZWQsIHJldHVybnMgYW4gYXJyYXkgdGhhdCBvbmx5IGNvbnRhaW5zIHRoZSBsb2NhbCBjbGllbnQnc1xuICAgICAqIElELlxuICAgICAqXG4gICAgICogUE9SVElORyBOT1RFOiBUaGlzIGlzIG9ubHkgdXNlZCBmb3IgV2ViIG11bHRpLXRhYi5cbiAgICAgKi8gICAgRnMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJ1blRyYW5zYWN0aW9uKFwiZ2V0QWN0aXZlQ2xpZW50c1wiLCBcInJlYWRvbmx5XCIsICh0ID0+IEpyKHQpLnF0KCkubmV4dCgodCA9PiB0aGlzLkRzKHQsIDE4ZTUpLm1hcCgodCA9PiB0LmNsaWVudElkKSkpKSkpO1xuICAgIH1cbiAgICBnZXQgc3RhcnRlZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubnM7XG4gICAgfVxuICAgIGdldE11dGF0aW9uUXVldWUodCwgZSkge1xuICAgICAgICByZXR1cm4gSXIuWXQodCwgdGhpcy5NLCBlLCB0aGlzLnJlZmVyZW5jZURlbGVnYXRlKTtcbiAgICB9XG4gICAgZ2V0VGFyZ2V0Q2FjaGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmZzO1xuICAgIH1cbiAgICBnZXRSZW1vdGVEb2N1bWVudENhY2hlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5kcztcbiAgICB9XG4gICAgZ2V0SW5kZXhNYW5hZ2VyKHQpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBscih0LCB0aGlzLk0uSnQuZGF0YWJhc2VJZCk7XG4gICAgfVxuICAgIGdldERvY3VtZW50T3ZlcmxheUNhY2hlKHQpIHtcbiAgICAgICAgcmV0dXJuIEhpLll0KHRoaXMuTSwgdCk7XG4gICAgfVxuICAgIGdldEJ1bmRsZUNhY2hlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fcztcbiAgICB9XG4gICAgcnVuVHJhbnNhY3Rpb24odCwgZSwgbikge1xuICAgICAgICBPKFwiSW5kZXhlZERiUGVyc2lzdGVuY2VcIiwgXCJTdGFydGluZyB0cmFuc2FjdGlvbjpcIiwgdCk7XG4gICAgICAgIGNvbnN0IHMgPSBcInJlYWRvbmx5XCIgPT09IGUgPyBcInJlYWRvbmx5XCIgOiBcInJlYWR3cml0ZVwiLCBpID0gMTQgPT09IChyID0gdGhpcy50cykgPyB3aSA6IDEzID09PSByID8gX2kgOiAxMiA9PT0gciA/IGRpIDogMTEgPT09IHIgPyBmaSA6IHZvaWQgTCgpO1xuICAgICAgICAvKiogUmV0dXJucyB0aGUgb2JqZWN0IHN0b3JlcyBmb3IgdGhlIHByb3ZpZGVkIHNjaGVtYS4gKi9cbiAgICAgICAgdmFyIHI7XG4gICAgICAgIGxldCBvO1xuICAgICAgICAvLyBEbyBhbGwgdHJhbnNhY3Rpb25zIGFzIHJlYWR3cml0ZSBhZ2FpbnN0IGFsbCBvYmplY3Qgc3RvcmVzLCBzaW5jZSB3ZVxuICAgICAgICAvLyBhcmUgdGhlIG9ubHkgcmVhZGVyL3dyaXRlci5cbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5scy5ydW5UcmFuc2FjdGlvbih0LCBzLCBpLCAocyA9PiAobyA9IG5ldyB2aShzLCB0aGlzLmVzID8gdGhpcy5lcy5uZXh0KCkgOiBudC5BKSwgXG4gICAgICAgIFwicmVhZHdyaXRlLXByaW1hcnlcIiA9PT0gZSA/IHRoaXMuRXMobykubmV4dCgodCA9PiAhIXQgfHwgdGhpcy5BcyhvKSkpLm5leHQoKGUgPT4ge1xuICAgICAgICAgICAgaWYgKCFlKSB0aHJvdyBGKGBGYWlsZWQgdG8gb2J0YWluIHByaW1hcnkgbGVhc2UgZm9yIGFjdGlvbiAnJHt0fScuYCksIHRoaXMuaXNQcmltYXJ5ID0gITEsIFxuICAgICAgICAgICAgdGhpcy5Zbi5lbnF1ZXVlUmV0cnlhYmxlKCgoKSA9PiB0aGlzLmNzKCExKSkpLCBuZXcgUShHLkZBSUxFRF9QUkVDT05ESVRJT04sIG1pKTtcbiAgICAgICAgICAgIHJldHVybiBuKG8pO1xuICAgICAgICB9KSkubmV4dCgodCA9PiB0aGlzLmJzKG8pLm5leHQoKCgpID0+IHQpKSkpIDogdGhpcy4kcyhvKS5uZXh0KCgoKSA9PiBuKG8pKSkpKSkudGhlbigodCA9PiAoby5yYWlzZU9uQ29tbWl0dGVkRXZlbnQoKSwgXG4gICAgICAgIHQpKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFZlcmlmaWVzIHRoYXQgdGhlIGN1cnJlbnQgdGFiIGlzIHRoZSBwcmltYXJ5IGxlYXNlaG9sZGVyIG9yIGFsdGVybmF0aXZlbHlcbiAgICAgKiB0aGF0IHRoZSBsZWFzZWhvbGRlciBoYXMgb3B0ZWQgaW50byBtdWx0aS10YWIgc3luY2hyb25pemF0aW9uLlxuICAgICAqL1xuICAgIC8vIFRPRE8oYi8xMTQyMjYyMzQpOiBSZW1vdmUgdGhpcyBjaGVjayB3aGVuIGBzeW5jaHJvbml6ZVRhYnNgIGNhbiBubyBsb25nZXJcbiAgICAvLyBiZSB0dXJuZWQgb2ZmLlxuICAgICRzKHQpIHtcbiAgICAgICAgcmV0dXJuIEhyKHQpLmdldChcIm93bmVyXCIpLm5leHQoKHQgPT4ge1xuICAgICAgICAgICAgaWYgKG51bGwgIT09IHQgJiYgdGhpcy5Tcyh0LmxlYXNlVGltZXN0YW1wTXMsIDVlMykgJiYgIXRoaXMueHModC5vd25lcklkKSAmJiAhdGhpcy5Qcyh0KSAmJiAhKHRoaXMuWm4gfHwgdGhpcy5hbGxvd1RhYlN5bmNocm9uaXphdGlvbiAmJiB0LmFsbG93VGFiU3luY2hyb25pemF0aW9uKSkgdGhyb3cgbmV3IFEoRy5GQUlMRURfUFJFQ09ORElUSU9OLCBXcik7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogT2J0YWlucyBvciBleHRlbmRzIHRoZSBuZXcgcHJpbWFyeSBsZWFzZSBmb3IgdGhlIGxvY2FsIGNsaWVudC4gVGhpc1xuICAgICAqIG1ldGhvZCBkb2VzIG5vdCB2ZXJpZnkgdGhhdCB0aGUgY2xpZW50IGlzIGVsaWdpYmxlIGZvciB0aGlzIGxlYXNlLlxuICAgICAqLyAgICBicyh0KSB7XG4gICAgICAgIGNvbnN0IGUgPSB7XG4gICAgICAgICAgICBvd25lcklkOiB0aGlzLmNsaWVudElkLFxuICAgICAgICAgICAgYWxsb3dUYWJTeW5jaHJvbml6YXRpb246IHRoaXMuYWxsb3dUYWJTeW5jaHJvbml6YXRpb24sXG4gICAgICAgICAgICBsZWFzZVRpbWVzdGFtcE1zOiBEYXRlLm5vdygpXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBIcih0KS5wdXQoXCJvd25lclwiLCBlKTtcbiAgICB9XG4gICAgc3RhdGljIHZ0KCkge1xuICAgICAgICByZXR1cm4gSWkudnQoKTtcbiAgICB9XG4gICAgLyoqIENoZWNrcyB0aGUgcHJpbWFyeSBsZWFzZSBhbmQgcmVtb3ZlcyBpdCBpZiB3ZSBhcmUgdGhlIGN1cnJlbnQgcHJpbWFyeS4gKi8gICAgUnModCkge1xuICAgICAgICBjb25zdCBlID0gSHIodCk7XG4gICAgICAgIHJldHVybiBlLmdldChcIm93bmVyXCIpLm5leHQoKHQgPT4gdGhpcy5Qcyh0KSA/IChPKFwiSW5kZXhlZERiUGVyc2lzdGVuY2VcIiwgXCJSZWxlYXNpbmcgcHJpbWFyeSBsZWFzZS5cIiksIFxuICAgICAgICBlLmRlbGV0ZShcIm93bmVyXCIpKSA6IHlpLnJlc29sdmUoKSkpO1xuICAgIH1cbiAgICAvKiogVmVyaWZpZXMgdGhhdCBgdXBkYXRlVGltZU1zYCBpcyB3aXRoaW4gYG1heEFnZU1zYC4gKi8gICAgU3ModCwgZSkge1xuICAgICAgICBjb25zdCBuID0gRGF0ZS5ub3coKTtcbiAgICAgICAgcmV0dXJuICEodCA8IG4gLSBlKSAmJiAoISh0ID4gbikgfHwgKEYoYERldGVjdGVkIGFuIHVwZGF0ZSB0aW1lIHRoYXQgaXMgaW4gdGhlIGZ1dHVyZTogJHt0fSA+ICR7bn1gKSwgXG4gICAgICAgICExKSk7XG4gICAgfVxuICAgIHlzKCkge1xuICAgICAgICBudWxsICE9PSB0aGlzLmRvY3VtZW50ICYmIFwiZnVuY3Rpb25cIiA9PSB0eXBlb2YgdGhpcy5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyICYmICh0aGlzLnJzID0gKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5Zbi5lbnF1ZXVlQW5kRm9yZ2V0KCgoKSA9PiAodGhpcy5pbkZvcmVncm91bmQgPSBcInZpc2libGVcIiA9PT0gdGhpcy5kb2N1bWVudC52aXNpYmlsaXR5U3RhdGUsIFxuICAgICAgICAgICAgdGhpcy5ncygpKSkpO1xuICAgICAgICB9LCB0aGlzLmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJ2aXNpYmlsaXR5Y2hhbmdlXCIsIHRoaXMucnMpLCB0aGlzLmluRm9yZWdyb3VuZCA9IFwidmlzaWJsZVwiID09PSB0aGlzLmRvY3VtZW50LnZpc2liaWxpdHlTdGF0ZSk7XG4gICAgfVxuICAgIGtzKCkge1xuICAgICAgICB0aGlzLnJzICYmICh0aGlzLmRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJ2aXNpYmlsaXR5Y2hhbmdlXCIsIHRoaXMucnMpLCB0aGlzLnJzID0gbnVsbCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEF0dGFjaGVzIGEgd2luZG93LnVubG9hZCBoYW5kbGVyIHRoYXQgd2lsbCBzeW5jaHJvbm91c2x5IHdyaXRlIG91clxuICAgICAqIGNsaWVudElkIHRvIGEgXCJ6b21iaWUgY2xpZW50IGlkXCIgbG9jYXRpb24gaW4gTG9jYWxTdG9yYWdlLiBUaGlzIGNhbiBiZSB1c2VkXG4gICAgICogYnkgdGFicyB0cnlpbmcgdG8gYWNxdWlyZSB0aGUgcHJpbWFyeSBsZWFzZSB0byBkZXRlcm1pbmUgdGhhdCB0aGUgbGVhc2VcbiAgICAgKiBpcyBubyBsb25nZXIgdmFsaWQgZXZlbiBpZiB0aGUgdGltZXN0YW1wIGlzIHJlY2VudC4gVGhpcyBpcyBwYXJ0aWN1bGFybHlcbiAgICAgKiBpbXBvcnRhbnQgZm9yIHRoZSByZWZyZXNoIGNhc2UgKHNvIHRoZSB0YWIgY29ycmVjdGx5IHJlLWFjcXVpcmVzIHRoZVxuICAgICAqIHByaW1hcnkgbGVhc2UpLiBMb2NhbFN0b3JhZ2UgaXMgdXNlZCBmb3IgdGhpcyByYXRoZXIgdGhhbiBJbmRleGVkRGIgYmVjYXVzZVxuICAgICAqIGl0IGlzIGEgc3luY2hyb25vdXMgQVBJIGFuZCBzbyBjYW4gYmUgdXNlZCByZWxpYWJseSBmcm9tICBhbiB1bmxvYWRcbiAgICAgKiBoYW5kbGVyLlxuICAgICAqLyAgICBwcygpIHtcbiAgICAgICAgdmFyIHQ7XG4gICAgICAgIFwiZnVuY3Rpb25cIiA9PSB0eXBlb2YgKG51bGwgPT09ICh0ID0gdGhpcy53aW5kb3cpIHx8IHZvaWQgMCA9PT0gdCA/IHZvaWQgMCA6IHQuYWRkRXZlbnRMaXN0ZW5lcikgJiYgKHRoaXMuc3MgPSAoKSA9PiB7XG4gICAgICAgICAgICAvLyBOb3RlOiBJbiB0aGVvcnksIHRoaXMgc2hvdWxkIGJlIHNjaGVkdWxlZCBvbiB0aGUgQXN5bmNRdWV1ZSBzaW5jZSBpdFxuICAgICAgICAgICAgLy8gYWNjZXNzZXMgaW50ZXJuYWwgc3RhdGUuIFdlIGV4ZWN1dGUgdGhpcyBjb2RlIGRpcmVjdGx5IGR1cmluZyBzaHV0ZG93blxuICAgICAgICAgICAgLy8gdG8gbWFrZSBzdXJlIGl0IGdldHMgYSBjaGFuY2UgdG8gcnVuLlxuICAgICAgICAgICAgdGhpcy5OcygpLCBsKCkgJiYgbmF2aWdhdG9yLmFwcFZlcnNpb24ubWF0Y2goL1ZlcnNpb25cXC8xWzQ1XS8pICYmIFxuICAgICAgICAgICAgLy8gT24gU2FmYXJpIDE0IGFuZCAxNSwgd2UgZG8gbm90IHJ1biBhbnkgY2xlYW51cCBhY3Rpb25zIGFzIGl0IG1pZ2h0XG4gICAgICAgICAgICAvLyB0cmlnZ2VyIGEgYnVnIHRoYXQgcHJldmVudHMgU2FmYXJpIGZyb20gcmUtb3BlbmluZyBJbmRleGVkREIgZHVyaW5nXG4gICAgICAgICAgICAvLyB0aGUgbmV4dCBwYWdlIGxvYWQuXG4gICAgICAgICAgICAvLyBTZWUgaHR0cHM6Ly9idWdzLndlYmtpdC5vcmcvc2hvd19idWcuY2dpP2lkPTIyNjU0N1xuICAgICAgICAgICAgdGhpcy5Zbi5lbnRlclJlc3RyaWN0ZWRNb2RlKC8qIHB1cmdlRXhpc3RpbmdUYXNrcz0gKi8gITApLCB0aGlzLlluLmVucXVldWVBbmRGb3JnZXQoKCgpID0+IHRoaXMuc2h1dGRvd24oKSkpO1xuICAgICAgICB9LCB0aGlzLndpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwicGFnZWhpZGVcIiwgdGhpcy5zcykpO1xuICAgIH1cbiAgICBNcygpIHtcbiAgICAgICAgdGhpcy5zcyAmJiAodGhpcy53aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInBhZ2VoaWRlXCIsIHRoaXMuc3MpLCB0aGlzLnNzID0gbnVsbCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgd2hldGhlciBhIGNsaWVudCBpcyBcInpvbWJpZWRcIiBiYXNlZCBvbiBpdHMgTG9jYWxTdG9yYWdlIGVudHJ5LlxuICAgICAqIENsaWVudHMgYmVjb21lIHpvbWJpZWQgd2hlbiB0aGVpciB0YWIgY2xvc2VzIHdpdGhvdXQgcnVubmluZyBhbGwgb2YgdGhlXG4gICAgICogY2xlYW51cCBsb2dpYyBpbiBgc2h1dGRvd24oKWAuXG4gICAgICovICAgIHhzKHQpIHtcbiAgICAgICAgdmFyIGU7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBuID0gbnVsbCAhPT0gKG51bGwgPT09IChlID0gdGhpcy53cykgfHwgdm9pZCAwID09PSBlID8gdm9pZCAwIDogZS5nZXRJdGVtKHRoaXMuQ3ModCkpKTtcbiAgICAgICAgICAgIHJldHVybiBPKFwiSW5kZXhlZERiUGVyc2lzdGVuY2VcIiwgYENsaWVudCAnJHt0fScgJHtuID8gXCJpc1wiIDogXCJpcyBub3RcIn0gem9tYmllZCBpbiBMb2NhbFN0b3JhZ2VgKSwgXG4gICAgICAgICAgICBuO1xuICAgICAgICB9IGNhdGNoICh0KSB7XG4gICAgICAgICAgICAvLyBHcmFjZWZ1bGx5IGhhbmRsZSBpZiBMb2NhbFN0b3JhZ2UgaXNuJ3Qgd29ya2luZy5cbiAgICAgICAgICAgIHJldHVybiBGKFwiSW5kZXhlZERiUGVyc2lzdGVuY2VcIiwgXCJGYWlsZWQgdG8gZ2V0IHpvbWJpZWQgY2xpZW50IGlkLlwiLCB0KSwgITE7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogUmVjb3JkIGNsaWVudCBhcyB6b21iaWVkIChhIGNsaWVudCB0aGF0IGhhZCBpdHMgdGFiIGNsb3NlZCkuIFpvbWJpZWRcbiAgICAgKiBjbGllbnRzIGFyZSBpZ25vcmVkIGR1cmluZyBwcmltYXJ5IHRhYiBzZWxlY3Rpb24uXG4gICAgICovICAgIE5zKCkge1xuICAgICAgICBpZiAodGhpcy53cykgdHJ5IHtcbiAgICAgICAgICAgIHRoaXMud3Muc2V0SXRlbSh0aGlzLkNzKHRoaXMuY2xpZW50SWQpLCBTdHJpbmcoRGF0ZS5ub3coKSkpO1xuICAgICAgICB9IGNhdGNoICh0KSB7XG4gICAgICAgICAgICAvLyBHcmFjZWZ1bGx5IGhhbmRsZSBpZiBMb2NhbFN0b3JhZ2UgaXNuJ3QgYXZhaWxhYmxlIC8gd29ya2luZy5cbiAgICAgICAgICAgIEYoXCJGYWlsZWQgdG8gc2V0IHpvbWJpZSBjbGllbnQgaWQuXCIsIHQpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKiBSZW1vdmVzIHRoZSB6b21iaWVkIGNsaWVudCBlbnRyeSBpZiBpdCBleGlzdHMuICovICAgIE9zKCkge1xuICAgICAgICBpZiAodGhpcy53cykgdHJ5IHtcbiAgICAgICAgICAgIHRoaXMud3MucmVtb3ZlSXRlbSh0aGlzLkNzKHRoaXMuY2xpZW50SWQpKTtcbiAgICAgICAgfSBjYXRjaCAodCkge1xuICAgICAgICAgICAgLy8gSWdub3JlXG4gICAgICAgIH1cbiAgICB9XG4gICAgQ3ModCkge1xuICAgICAgICByZXR1cm4gYGZpcmVzdG9yZV96b21iaWVfJHt0aGlzLnBlcnNpc3RlbmNlS2V5fV8ke3R9YDtcbiAgICB9XG59XG5cbi8qKlxuICogSGVscGVyIHRvIGdldCBhIHR5cGVkIFNpbXBsZURiU3RvcmUgZm9yIHRoZSBwcmltYXJ5IGNsaWVudCBvYmplY3Qgc3RvcmUuXG4gKi8gZnVuY3Rpb24gSHIodCkge1xuICAgIHJldHVybiBTaSh0LCBcIm93bmVyXCIpO1xufVxuXG4vKipcbiAqIEhlbHBlciB0byBnZXQgYSB0eXBlZCBTaW1wbGVEYlN0b3JlIGZvciB0aGUgY2xpZW50IG1ldGFkYXRhIG9iamVjdCBzdG9yZS5cbiAqLyBmdW5jdGlvbiBKcih0KSB7XG4gICAgcmV0dXJuIFNpKHQsIFwiY2xpZW50TWV0YWRhdGFcIik7XG59XG5cbi8qKlxuICogR2VuZXJhdGVzIGEgc3RyaW5nIHVzZWQgYXMgYSBwcmVmaXggd2hlbiBzdG9yaW5nIGRhdGEgaW4gSW5kZXhlZERCIGFuZFxuICogTG9jYWxTdG9yYWdlLlxuICovIGZ1bmN0aW9uIFlyKHQsIGUpIHtcbiAgICAvLyBVc2UgdHdvIGRpZmZlcmVudCBwcmVmaXggZm9ybWF0czpcbiAgICAvLyAgICogZmlyZXN0b3JlIC8gcGVyc2lzdGVuY2VLZXkgLyBwcm9qZWN0SUQgLiBkYXRhYmFzZUlEIC8gLi4uXG4gICAgLy8gICAqIGZpcmVzdG9yZSAvIHBlcnNpc3RlbmNlS2V5IC8gcHJvamVjdElEIC8gLi4uXG4gICAgLy8gcHJvamVjdElEcyBhcmUgRE5TLWNvbXBhdGlibGUgbmFtZXMgYW5kIGNhbm5vdCBjb250YWluIGRvdHNcbiAgICAvLyBzbyB0aGVyZSdzIG5vIGRhbmdlciBvZiBjb2xsaXNpb25zLlxuICAgIGxldCBuID0gdC5wcm9qZWN0SWQ7XG4gICAgcmV0dXJuIHQuaXNEZWZhdWx0RGF0YWJhc2UgfHwgKG4gKz0gXCIuXCIgKyB0LmRhdGFiYXNlKSwgXCJmaXJlc3RvcmUvXCIgKyBlICsgXCIvXCIgKyBuICsgXCIvXCI7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEEgcmVhZG9ubHkgdmlldyBvZiB0aGUgbG9jYWwgc3RhdGUgb2YgYWxsIGRvY3VtZW50cyB3ZSdyZSB0cmFja2luZyAoaS5lLiB3ZVxuICogaGF2ZSBhIGNhY2hlZCB2ZXJzaW9uIGluIHJlbW90ZURvY3VtZW50Q2FjaGUgb3IgbG9jYWwgbXV0YXRpb25zIGZvciB0aGVcbiAqIGRvY3VtZW50KS4gVGhlIHZpZXcgaXMgY29tcHV0ZWQgYnkgYXBwbHlpbmcgdGhlIG11dGF0aW9ucyBpbiB0aGVcbiAqIE11dGF0aW9uUXVldWUgdG8gdGhlIFJlbW90ZURvY3VtZW50Q2FjaGUuXG4gKi9cbmNsYXNzIFhyIHtcbiAgICBjb25zdHJ1Y3Rvcih0LCBlLCBuKSB7XG4gICAgICAgIHRoaXMuZHMgPSB0LCB0aGlzLkJzID0gZSwgdGhpcy5pbmRleE1hbmFnZXIgPSBuO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBHZXQgdGhlIGxvY2FsIHZpZXcgb2YgdGhlIGRvY3VtZW50IGlkZW50aWZpZWQgYnkgYGtleWAuXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyBMb2NhbCB2aWV3IG9mIHRoZSBkb2N1bWVudCBvciBudWxsIGlmIHdlIGRvbid0IGhhdmUgYW55IGNhY2hlZFxuICAgICAqIHN0YXRlIGZvciBpdC5cbiAgICAgKi8gICAgTHModCwgZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5Ccy5nZXRBbGxNdXRhdGlvbkJhdGNoZXNBZmZlY3RpbmdEb2N1bWVudEtleSh0LCBlKS5uZXh0KChuID0+IHRoaXMuVXModCwgZSwgbikpKTtcbiAgICB9XG4gICAgLyoqIEludGVybmFsIHZlcnNpb24gb2YgYGdldERvY3VtZW50YCB0aGF0IGFsbG93cyByZXVzaW5nIGJhdGNoZXMuICovICAgIFVzKHQsIGUsIG4pIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZHMuZ2V0RW50cnkodCwgZSkubmV4dCgodCA9PiB7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGUgb2YgbikgZS5hcHBseVRvTG9jYWxWaWV3KHQpO1xuICAgICAgICAgICAgcmV0dXJuIHQ7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgLy8gUmV0dXJucyB0aGUgdmlldyBvZiB0aGUgZ2l2ZW4gYGRvY3NgIGFzIHRoZXkgd291bGQgYXBwZWFyIGFmdGVyIGFwcGx5aW5nXG4gICAgLy8gYWxsIG11dGF0aW9ucyBpbiB0aGUgZ2l2ZW4gYGJhdGNoZXNgLlxuICAgIHFzKHQsIGUpIHtcbiAgICAgICAgdC5mb3JFYWNoKCgodCwgbikgPT4ge1xuICAgICAgICAgICAgZm9yIChjb25zdCB0IG9mIGUpIHQuYXBwbHlUb0xvY2FsVmlldyhuKTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBHZXRzIHRoZSBsb2NhbCB2aWV3IG9mIHRoZSBkb2N1bWVudHMgaWRlbnRpZmllZCBieSBga2V5c2AuXG4gICAgICpcbiAgICAgKiBJZiB3ZSBkb24ndCBoYXZlIGNhY2hlZCBzdGF0ZSBmb3IgYSBkb2N1bWVudCBpbiBga2V5c2AsIGEgTm9Eb2N1bWVudCB3aWxsXG4gICAgICogYmUgc3RvcmVkIGZvciB0aGF0IGtleSBpbiB0aGUgcmVzdWx0aW5nIHNldC5cbiAgICAgKi8gICAgS3ModCwgZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5kcy5nZXRFbnRyaWVzKHQsIGUpLm5leHQoKGUgPT4gdGhpcy5Hcyh0LCBlKS5uZXh0KCgoKSA9PiBlKSkpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQXBwbGllcyB0aGUgbG9jYWwgdmlldyB0aGUgZ2l2ZW4gYGJhc2VEb2NzYCB3aXRob3V0IHJldHJpZXZpbmcgZG9jdW1lbnRzXG4gICAgICogZnJvbSB0aGUgbG9jYWwgc3RvcmUuXG4gICAgICovICAgIEdzKHQsIGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuQnMuZ2V0QWxsTXV0YXRpb25CYXRjaGVzQWZmZWN0aW5nRG9jdW1lbnRLZXlzKHQsIGUpLm5leHQoKHQgPT4gdGhpcy5xcyhlLCB0KSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBQZXJmb3JtcyBhIHF1ZXJ5IGFnYWluc3QgdGhlIGxvY2FsIHZpZXcgb2YgYWxsIGRvY3VtZW50cy5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB0cmFuc2FjdGlvbiAtIFRoZSBwZXJzaXN0ZW5jZSB0cmFuc2FjdGlvbi5cbiAgICAgKiBAcGFyYW0gcXVlcnkgLSBUaGUgcXVlcnkgdG8gbWF0Y2ggZG9jdW1lbnRzIGFnYWluc3QuXG4gICAgICogQHBhcmFtIG9mZnNldCAtIFJlYWQgdGltZSBhbmQga2V5IHRvIHN0YXJ0IHNjYW5uaW5nIGJ5IChleGNsdXNpdmUpLlxuICAgICAqLyAgICBRcyh0LCBlLCBuKSB7XG4gICAgICAgIC8qKlxuICogUmV0dXJucyB3aGV0aGVyIHRoZSBxdWVyeSBtYXRjaGVzIGEgc2luZ2xlIGRvY3VtZW50IGJ5IHBhdGggKHJhdGhlciB0aGFuIGFcbiAqIGNvbGxlY3Rpb24pLlxuICovXG4gICAgICAgIHJldHVybiBmdW5jdGlvbih0KSB7XG4gICAgICAgICAgICByZXR1cm4geHQuaXNEb2N1bWVudEtleSh0LnBhdGgpICYmIG51bGwgPT09IHQuY29sbGVjdGlvbkdyb3VwICYmIDAgPT09IHQuZmlsdGVycy5sZW5ndGg7XG4gICAgICAgIH0oZSkgPyB0aGlzLmpzKHQsIGUucGF0aCkgOiBXZShlKSA/IHRoaXMuV3ModCwgZSwgbikgOiB0aGlzLnpzKHQsIGUsIG4pO1xuICAgIH1cbiAgICBqcyh0LCBlKSB7XG4gICAgICAgIC8vIEp1c3QgZG8gYSBzaW1wbGUgZG9jdW1lbnQgbG9va3VwLlxuICAgICAgICByZXR1cm4gdGhpcy5Mcyh0LCBuZXcgeHQoZSkpLm5leHQoKHQgPT4ge1xuICAgICAgICAgICAgbGV0IGUgPSBXbigpO1xuICAgICAgICAgICAgcmV0dXJuIHQuaXNGb3VuZERvY3VtZW50KCkgJiYgKGUgPSBlLmluc2VydCh0LmtleSwgdCkpLCBlO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIFdzKHQsIGUsIG4pIHtcbiAgICAgICAgY29uc3QgcyA9IGUuY29sbGVjdGlvbkdyb3VwO1xuICAgICAgICBsZXQgaSA9IFduKCk7XG4gICAgICAgIHJldHVybiB0aGlzLmluZGV4TWFuYWdlci5nZXRDb2xsZWN0aW9uUGFyZW50cyh0LCBzKS5uZXh0KChyID0+IHlpLmZvckVhY2gociwgKHIgPT4ge1xuICAgICAgICAgICAgY29uc3QgbyA9IGZ1bmN0aW9uKHQsIGUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFVlKGUsIFxuICAgICAgICAgICAgICAgIC8qY29sbGVjdGlvbkdyb3VwPSovIG51bGwsIHQuZXhwbGljaXRPcmRlckJ5LnNsaWNlKCksIHQuZmlsdGVycy5zbGljZSgpLCB0LmxpbWl0LCB0LmxpbWl0VHlwZSwgdC5zdGFydEF0LCB0LmVuZEF0KTtcbiAgICAgICAgICAgIH0oZSwgci5jaGlsZChzKSk7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy56cyh0LCBvLCBuKS5uZXh0KCh0ID0+IHtcbiAgICAgICAgICAgICAgICB0LmZvckVhY2goKCh0LCBlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGkgPSBpLmluc2VydCh0LCBlKTtcbiAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICB9KSk7XG4gICAgICAgIH0pKS5uZXh0KCgoKSA9PiBpKSkpKTtcbiAgICB9XG4gICAgenModCwgZSwgbikge1xuICAgICAgICAvLyBRdWVyeSB0aGUgcmVtb3RlIGRvY3VtZW50cyBhbmQgb3ZlcmxheSBtdXRhdGlvbnMuXG4gICAgICAgIGxldCBzO1xuICAgICAgICByZXR1cm4gdGhpcy5kcy5nZXRBbGxGcm9tQ29sbGVjdGlvbih0LCBlLnBhdGgsIG4pLm5leHQoKG4gPT4gKHMgPSBuLCB0aGlzLkJzLmdldEFsbE11dGF0aW9uQmF0Y2hlc0FmZmVjdGluZ1F1ZXJ5KHQsIGUpKSkpLm5leHQoKHQgPT4ge1xuICAgICAgICAgICAgZm9yIChjb25zdCBlIG9mIHQpIGZvciAoY29uc3QgdCBvZiBlLm11dGF0aW9ucykge1xuICAgICAgICAgICAgICAgIGNvbnN0IG4gPSB0LmtleTtcbiAgICAgICAgICAgICAgICBsZXQgaSA9IHMuZ2V0KG4pO1xuICAgICAgICAgICAgICAgIG51bGwgPT0gaSAmJiAoXG4gICAgICAgICAgICAgICAgLy8gQ3JlYXRlIGludmFsaWQgZG9jdW1lbnQgdG8gYXBwbHkgbXV0YXRpb25zIG9uIHRvcCBvZlxuICAgICAgICAgICAgICAgIGkgPSBuZS5uZXdJbnZhbGlkRG9jdW1lbnQobiksIHMgPSBzLmluc2VydChuLCBpKSksIFZuKHQsIGksIGUubG9jYWxXcml0ZVRpbWUpLCBpLmlzRm91bmREb2N1bWVudCgpIHx8IChzID0gcy5yZW1vdmUobikpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KSkubmV4dCgoKCkgPT4gKFxuICAgICAgICAvLyBGaW5hbGx5LCBmaWx0ZXIgb3V0IGFueSBkb2N1bWVudHMgdGhhdCBkb24ndCBhY3R1YWxseSBtYXRjaFxuICAgICAgICAvLyB0aGUgcXVlcnkuXG4gICAgICAgIHMuZm9yRWFjaCgoKHQsIG4pID0+IHtcbiAgICAgICAgICAgIHRuKGUsIG4pIHx8IChzID0gcy5yZW1vdmUodCkpO1xuICAgICAgICB9KSksIHMpKSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBBIHNldCBvZiBjaGFuZ2VzIHRvIHdoYXQgZG9jdW1lbnRzIGFyZSBjdXJyZW50bHkgaW4gdmlldyBhbmQgb3V0IG9mIHZpZXcgZm9yXG4gKiBhIGdpdmVuIHF1ZXJ5LiBUaGVzZSBjaGFuZ2VzIGFyZSBzZW50IHRvIHRoZSBMb2NhbFN0b3JlIGJ5IHRoZSBWaWV3ICh2aWFcbiAqIHRoZSBTeW5jRW5naW5lKSBhbmQgYXJlIHVzZWQgdG8gcGluIC8gdW5waW4gZG9jdW1lbnRzIGFzIGFwcHJvcHJpYXRlLlxuICovIGNsYXNzIFpyIHtcbiAgICBjb25zdHJ1Y3Rvcih0LCBlLCBuLCBzKSB7XG4gICAgICAgIHRoaXMudGFyZ2V0SWQgPSB0LCB0aGlzLmZyb21DYWNoZSA9IGUsIHRoaXMuSHMgPSBuLCB0aGlzLkpzID0gcztcbiAgICB9XG4gICAgc3RhdGljIFlzKHQsIGUpIHtcbiAgICAgICAgbGV0IG4gPSBZbigpLCBzID0gWW4oKTtcbiAgICAgICAgZm9yIChjb25zdCB0IG9mIGUuZG9jQ2hhbmdlcykgc3dpdGNoICh0LnR5cGUpIHtcbiAgICAgICAgICBjYXNlIDAgLyogQWRkZWQgKi8gOlxuICAgICAgICAgICAgbiA9IG4uYWRkKHQuZG9jLmtleSk7XG4gICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgIGNhc2UgMSAvKiBSZW1vdmVkICovIDpcbiAgICAgICAgICAgIHMgPSBzLmFkZCh0LmRvYy5rZXkpO1xuIC8vIGRvIG5vdGhpbmdcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXcgWnIodCwgZS5mcm9tQ2FjaGUsIG4sIHMpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogVGhlIEZpcmVzdG9yZSBxdWVyeSBlbmdpbmUuXG4gKlxuICogRmlyZXN0b3JlIHF1ZXJpZXMgY2FuIGJlIGV4ZWN1dGVkIGluIHRocmVlIG1vZGVzLiBUaGUgUXVlcnkgRW5naW5lIGRldGVybWluZXNcbiAqIHdoYXQgbW9kZSB0byB1c2UgYmFzZWQgb24gd2hhdCBkYXRhIGlzIHBlcnNpc3RlZC4gVGhlIG1vZGUgb25seSBkZXRlcm1pbmVzXG4gKiB0aGUgcnVudGltZSBjb21wbGV4aXR5IG9mIHRoZSBxdWVyeSAtIHRoZSByZXN1bHQgc2V0IGlzIGVxdWl2YWxlbnQgYWNyb3NzIGFsbFxuICogaW1wbGVtZW50YXRpb25zLlxuICpcbiAqIFRoZSBRdWVyeSBlbmdpbmUgd2lsbCB1c2UgaW5kZXhlZC1iYXNlZCBleGVjdXRpb24gaWYgYSB1c2VyIGhhcyBjb25maWd1cmVkXG4gKiBhbnkgaW5kZXggdGhhdCBjYW4gYmUgdXNlZCB0byBleGVjdXRlIHF1ZXJ5ICh2aWEgYHNldEluZGV4Q29uZmlndXJhdGlvbigpYCkuXG4gKiBPdGhlcndpc2UsIHRoZSBlbmdpbmUgd2lsbCB0cnkgdG8gb3B0aW1pemUgdGhlIHF1ZXJ5IGJ5IHJlLXVzaW5nIGEgcHJldmlvdXNseVxuICogcGVyc2lzdGVkIHF1ZXJ5IHJlc3VsdC4gSWYgdGhhdCBpcyBub3QgcG9zc2libGUsIHRoZSBxdWVyeSB3aWxsIGJlIGV4ZWN1dGVkXG4gKiB2aWEgYSBmdWxsIGNvbGxlY3Rpb24gc2Nhbi5cbiAqXG4gKiBJbmRleC1iYXNlZCBleGVjdXRpb24gaXMgdGhlIGRlZmF1bHQgd2hlbiBhdmFpbGFibGUuIFRoZSBxdWVyeSBlbmdpbmVcbiAqIHN1cHBvcnRzIHBhcnRpYWwgaW5kZXhlZCBleGVjdXRpb24gYW5kIG1lcmdlcyB0aGUgcmVzdWx0IGZyb20gdGhlIGluZGV4XG4gKiBsb29rdXAgd2l0aCBkb2N1bWVudHMgdGhhdCBoYXZlIG5vdCB5ZXQgYmVlbiBpbmRleGVkLiBUaGUgaW5kZXggZXZhbHVhdGlvblxuICogbWF0Y2hlcyB0aGUgYmFja2VuZCdzIGZvcm1hdCBhbmQgYXMgc3VjaCwgdGhlIFNESyBjYW4gdXNlIGluZGV4aW5nIGZvciBhbGxcbiAqIHF1ZXJpZXMgdGhhdCB0aGUgYmFja2VuZCBzdXBwb3J0cy5cbiAqXG4gKiBJZiBubyBpbmRleCBleGlzdHMsIHRoZSBxdWVyeSBlbmdpbmUgdHJpZXMgdG8gdGFrZSBhZHZhbnRhZ2Ugb2YgdGhlIHRhcmdldFxuICogZG9jdW1lbnQgbWFwcGluZyBpbiB0aGUgVGFyZ2V0Q2FjaGUuIFRoZXNlIG1hcHBpbmdzIGV4aXN0cyBmb3IgYWxsIHF1ZXJpZXNcbiAqIHRoYXQgaGF2ZSBiZWVuIHN5bmNlZCB3aXRoIHRoZSBiYWNrZW5kIGF0IGxlYXN0IG9uY2UgYW5kIGFsbG93IHRoZSBxdWVyeVxuICogZW5naW5lIHRvIG9ubHkgcmVhZCBkb2N1bWVudHMgdGhhdCBwcmV2aW91c2x5IG1hdGNoZWQgYSBxdWVyeSBwbHVzIGFueVxuICogZG9jdW1lbnRzIHRoYXQgd2VyZSBlZGl0ZWQgYWZ0ZXIgdGhlIHF1ZXJ5IHdhcyBsYXN0IGxpc3RlbmVkIHRvLlxuICpcbiAqIFRoZXJlIGFyZSBzb21lIGNhc2VzIHdoZW4gdGhpcyBvcHRpbWl6YXRpb24gaXMgbm90IGd1YXJhbnRlZWQgdG8gcHJvZHVjZVxuICogdGhlIHNhbWUgcmVzdWx0cyBhcyBmdWxsIGNvbGxlY3Rpb24gc2NhbnMuIEluIHRoZXNlIGNhc2VzLCBxdWVyeVxuICogcHJvY2Vzc2luZyBmYWxscyBiYWNrIHRvIGZ1bGwgc2NhbnMuIFRoZXNlIGNhc2VzIGFyZTpcbiAqXG4gKiAtIExpbWl0IHF1ZXJpZXMgd2hlcmUgYSBkb2N1bWVudCB0aGF0IG1hdGNoZWQgdGhlIHF1ZXJ5IHByZXZpb3VzbHkgbm8gbG9uZ2VyXG4gKiAgIG1hdGNoZXMgdGhlIHF1ZXJ5LlxuICpcbiAqIC0gTGltaXQgcXVlcmllcyB3aGVyZSBhIGRvY3VtZW50IGVkaXQgbWF5IGNhdXNlIHRoZSBkb2N1bWVudCB0byBzb3J0IGJlbG93XG4gKiAgIGFub3RoZXIgZG9jdW1lbnQgdGhhdCBpcyBpbiB0aGUgbG9jYWwgY2FjaGUuXG4gKlxuICogLSBRdWVyaWVzIHRoYXQgaGF2ZSBuZXZlciBiZWVuIENVUlJFTlQgb3IgZnJlZSBvZiBsaW1ibyBkb2N1bWVudHMuXG4gKi8gY2xhc3MgdG8ge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLlhzID0gITE7XG4gICAgfVxuICAgIC8qKiBTZXRzIHRoZSBkb2N1bWVudCB2aWV3IHRvIHF1ZXJ5IGFnYWluc3QuICovICAgIGluaXRpYWxpemUodCwgZSkge1xuICAgICAgICB0aGlzLlpzID0gdCwgdGhpcy5pbmRleE1hbmFnZXIgPSBlLCB0aGlzLlhzID0gITA7XG4gICAgfVxuICAgIC8qKiBSZXR1cm5zIGFsbCBsb2NhbCBkb2N1bWVudHMgbWF0Y2hpbmcgdGhlIHNwZWNpZmllZCBxdWVyeS4gKi8gICAgUXModCwgZSwgbiwgcykge1xuICAgICAgICByZXR1cm4gdGhpcy50aSh0LCBlKS5uZXh0KChpID0+IGkgfHwgdGhpcy5laSh0LCBlLCBzLCBuKSkpLm5leHQoKG4gPT4gbiB8fCB0aGlzLm5pKHQsIGUpKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFBlcmZvcm1zIGFuIGluZGV4ZWQgcXVlcnkgdGhhdCBldmFsdWF0ZXMgdGhlIHF1ZXJ5IGJhc2VkIG9uIGEgY29sbGVjdGlvbidzXG4gICAgICogcGVyc2lzdGVkIGluZGV4IHZhbHVlcy4gUmV0dXJucyBgbnVsbGAgaWYgYW4gaW5kZXggaXMgbm90IGF2YWlsYWJsZS5cbiAgICAgKi8gICAgdGkodCwgZSkge1xuICAgICAgICByZXR1cm4geWkucmVzb2x2ZShudWxsKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUGVyZm9ybXMgYSBxdWVyeSBiYXNlZCBvbiB0aGUgdGFyZ2V0J3MgcGVyc2lzdGVkIHF1ZXJ5IG1hcHBpbmcuIFJldHVybnNcbiAgICAgKiBgbnVsbGAgaWYgdGhlIG1hcHBpbmcgaXMgbm90IGF2YWlsYWJsZSBvciBjYW5ub3QgYmUgdXNlZC5cbiAgICAgKi8gICAgZWkodCwgZSwgbiwgcykge1xuICAgICAgICByZXR1cm4gR2UoZSkgfHwgcy5pc0VxdWFsKGN0Lm1pbigpKSA/IHRoaXMubmkodCwgZSkgOiB0aGlzLlpzLktzKHQsIG4pLm5leHQoKGkgPT4ge1xuICAgICAgICAgICAgY29uc3QgciA9IHRoaXMuc2koZSwgaSk7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5paShlLCByLCBuLCBzKSA/IHRoaXMubmkodCwgZSkgOiAoaygpIDw9IHUuREVCVUcgJiYgTyhcIlF1ZXJ5RW5naW5lXCIsIFwiUmUtdXNpbmcgcHJldmlvdXMgcmVzdWx0IGZyb20gJXMgdG8gZXhlY3V0ZSBxdWVyeTogJXNcIiwgcy50b1N0cmluZygpLCBaZShlKSksIFxuICAgICAgICAgICAgdGhpcy5yaSh0LCByLCBlLCBhZShzLCAtMSkpKTtcbiAgICAgICAgfSkpO1xuICAgICAgICAvLyBRdWVyaWVzIHRoYXQgaGF2ZSBuZXZlciBzZWVuIGEgc25hcHNob3Qgd2l0aG91dCBsaW1ibyBmcmVlIGRvY3VtZW50c1xuICAgICAgICAvLyBzaG91bGQgYWxzbyBiZSBydW4gYXMgYSBmdWxsIGNvbGxlY3Rpb24gc2Nhbi5cbiAgICAgICAgfVxuICAgIC8qKiBBcHBsaWVzIHRoZSBxdWVyeSBmaWx0ZXIgYW5kIHNvcnRpbmcgdG8gdGhlIHByb3ZpZGVkIGRvY3VtZW50cy4gICovICAgIHNpKHQsIGUpIHtcbiAgICAgICAgLy8gU29ydCB0aGUgZG9jdW1lbnRzIGFuZCByZS1hcHBseSB0aGUgcXVlcnkgZmlsdGVyIHNpbmNlIHByZXZpb3VzbHlcbiAgICAgICAgLy8gbWF0Y2hpbmcgZG9jdW1lbnRzIGRvIG5vdCBuZWNlc3NhcmlseSBzdGlsbCBtYXRjaCB0aGUgcXVlcnkuXG4gICAgICAgIGxldCBuID0gbmV3IHdlKG5uKHQpKTtcbiAgICAgICAgcmV0dXJuIGUuZm9yRWFjaCgoKGUsIHMpID0+IHtcbiAgICAgICAgICAgIHRuKHQsIHMpICYmIChuID0gbi5hZGQocykpO1xuICAgICAgICB9KSksIG47XG4gICAgfVxuICAgIC8qKlxuICAgICAqIERldGVybWluZXMgaWYgYSBsaW1pdCBxdWVyeSBuZWVkcyB0byBiZSByZWZpbGxlZCBmcm9tIGNhY2hlLCBtYWtpbmcgaXRcbiAgICAgKiBpbmVsaWdpYmxlIGZvciBpbmRleC1mcmVlIGV4ZWN1dGlvbi5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBxdWVyeSBUaGUgcXVlcnkuXG4gICAgICogQHBhcmFtIHNvcnRlZFByZXZpb3VzUmVzdWx0cyAtIFRoZSBkb2N1bWVudHMgdGhhdCBtYXRjaGVkIHRoZSBxdWVyeSB3aGVuIGl0XG4gICAgICogd2FzIGxhc3Qgc3luY2hyb25pemVkLCBzb3J0ZWQgYnkgdGhlIHF1ZXJ5J3MgY29tcGFyYXRvci5cbiAgICAgKiBAcGFyYW0gcmVtb3RlS2V5cyAtIFRoZSBkb2N1bWVudCBrZXlzIHRoYXQgbWF0Y2hlZCB0aGUgcXVlcnkgYXQgdGhlIGxhc3RcbiAgICAgKiBzbmFwc2hvdC5cbiAgICAgKiBAcGFyYW0gbGltYm9GcmVlU25hcHNob3RWZXJzaW9uIC0gVGhlIHZlcnNpb24gb2YgdGhlIHNuYXBzaG90IHdoZW4gdGhlXG4gICAgICogcXVlcnkgd2FzIGxhc3Qgc3luY2hyb25pemVkLlxuICAgICAqLyAgICBpaSh0LCBlLCBuLCBzKSB7XG4gICAgICAgIGlmIChudWxsID09PSB0LmxpbWl0KSBcbiAgICAgICAgLy8gUXVlcmllcyB3aXRob3V0IGxpbWl0cyBkbyBub3QgbmVlZCB0byBiZSByZWZpbGxlZC5cbiAgICAgICAgcmV0dXJuICExO1xuICAgICAgICBpZiAobi5zaXplICE9PSBlLnNpemUpIFxuICAgICAgICAvLyBUaGUgcXVlcnkgbmVlZHMgdG8gYmUgcmVmaWxsZWQgaWYgYSBwcmV2aW91c2x5IG1hdGNoaW5nIGRvY3VtZW50IG5vXG4gICAgICAgIC8vIGxvbmdlciBtYXRjaGVzLlxuICAgICAgICByZXR1cm4gITA7XG4gICAgICAgIC8vIExpbWl0IHF1ZXJpZXMgYXJlIG5vdCBlbGlnaWJsZSBmb3IgaW5kZXgtZnJlZSBxdWVyeSBleGVjdXRpb24gaWYgdGhlcmUgaXNcbiAgICAgICAgLy8gYSBwb3RlbnRpYWwgdGhhdCBhbiBvbGRlciBkb2N1bWVudCBmcm9tIGNhY2hlIG5vdyBzb3J0cyBiZWZvcmUgYSBkb2N1bWVudFxuICAgICAgICAvLyB0aGF0IHdhcyBwcmV2aW91c2x5IHBhcnQgb2YgdGhlIGxpbWl0LiBUaGlzLCBob3dldmVyLCBjYW4gb25seSBoYXBwZW4gaWZcbiAgICAgICAgLy8gdGhlIGRvY3VtZW50IGF0IHRoZSBlZGdlIG9mIHRoZSBsaW1pdCBnb2VzIG91dCBvZiBsaW1pdC5cbiAgICAgICAgLy8gSWYgYSBkb2N1bWVudCB0aGF0IGlzIG5vdCB0aGUgbGltaXQgYm91bmRhcnkgc29ydHMgZGlmZmVyZW50bHksXG4gICAgICAgIC8vIHRoZSBib3VuZGFyeSBvZiB0aGUgbGltaXQgaXRzZWxmIGRpZCBub3QgY2hhbmdlIGFuZCBkb2N1bWVudHMgZnJvbSBjYWNoZVxuICAgICAgICAvLyB3aWxsIGNvbnRpbnVlIHRvIGJlIFwicmVqZWN0ZWRcIiBieSB0aGlzIGJvdW5kYXJ5LiBUaGVyZWZvcmUsIHdlIGNhbiBpZ25vcmVcbiAgICAgICAgLy8gYW55IG1vZGlmaWNhdGlvbnMgdGhhdCBkb24ndCBhZmZlY3QgdGhlIGxhc3QgZG9jdW1lbnQuXG4gICAgICAgICAgICAgICAgY29uc3QgaSA9IFwiRlwiIC8qIEZpcnN0ICovID09PSB0LmxpbWl0VHlwZSA/IGUubGFzdCgpIDogZS5maXJzdCgpO1xuICAgICAgICByZXR1cm4gISFpICYmIChpLmhhc1BlbmRpbmdXcml0ZXMgfHwgaS52ZXJzaW9uLmNvbXBhcmVUbyhzKSA+IDApO1xuICAgIH1cbiAgICBuaSh0LCBlKSB7XG4gICAgICAgIHJldHVybiBrKCkgPD0gdS5ERUJVRyAmJiBPKFwiUXVlcnlFbmdpbmVcIiwgXCJVc2luZyBmdWxsIGNvbGxlY3Rpb24gc2NhbiB0byBleGVjdXRlIHF1ZXJ5OlwiLCBaZShlKSksIFxuICAgICAgICB0aGlzLlpzLlFzKHQsIGUsIGhlLm1pbigpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ29tYmluZXMgdGhlIHJlc3VsdHMgZnJvbSBhbiBpbmRleGVkIGV4ZWN1dGlvbiB3aXRoIHRoZSByZW1haW5pbmcgZG9jdW1lbnRzXG4gICAgICogdGhhdCBoYXZlIG5vdCB5ZXQgYmVlbiBpbmRleGVkLlxuICAgICAqLyAgICByaSh0LCBlLCBuLCBzKSB7XG4gICAgICAgIC8vIFJldHJpZXZlIGFsbCByZXN1bHRzIGZvciBkb2N1bWVudHMgdGhhdCB3ZXJlIHVwZGF0ZWQgc2luY2UgdGhlIG9mZnNldC5cbiAgICAgICAgcmV0dXJuIHRoaXMuWnMuUXModCwgbiwgcykubmV4dCgodCA9PiAoXG4gICAgICAgIC8vIE1lcmdlIHdpdGggZXhpc3RpbmcgcmVzdWx0c1xuICAgICAgICBlLmZvckVhY2goKGUgPT4ge1xuICAgICAgICAgICAgdCA9IHQuaW5zZXJ0KGUua2V5LCBlKTtcbiAgICAgICAgfSkpLCB0KSkpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogSW1wbGVtZW50cyBgTG9jYWxTdG9yZWAgaW50ZXJmYWNlLlxuICpcbiAqIE5vdGU6IHNvbWUgZmllbGQgZGVmaW5lZCBpbiB0aGlzIGNsYXNzIG1pZ2h0IGhhdmUgcHVibGljIGFjY2VzcyBsZXZlbCwgYnV0XG4gKiB0aGUgY2xhc3MgaXMgbm90IGV4cG9ydGVkIHNvIHRoZXkgYXJlIG9ubHkgYWNjZXNzaWJsZSBmcm9tIHRoaXMgbW9kdWxlLlxuICogVGhpcyBpcyB1c2VmdWwgdG8gaW1wbGVtZW50IG9wdGlvbmFsIGZlYXR1cmVzIChsaWtlIGJ1bmRsZXMpIGluIGZyZWVcbiAqIGZ1bmN0aW9ucywgc3VjaCB0aGF0IHRoZXkgYXJlIHRyZWUtc2hha2VhYmxlLlxuICovXG5jbGFzcyBlbyB7XG4gICAgY29uc3RydWN0b3IoXG4gICAgLyoqIE1hbmFnZXMgb3VyIGluLW1lbW9yeSBvciBkdXJhYmxlIHBlcnNpc3RlbmNlLiAqL1xuICAgIHQsIGUsIG4sIHMpIHtcbiAgICAgICAgdGhpcy5wZXJzaXN0ZW5jZSA9IHQsIHRoaXMub2kgPSBlLCB0aGlzLk0gPSBzLCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIE1hcHMgYSB0YXJnZXRJRCB0byBkYXRhIGFib3V0IGl0cyB0YXJnZXQuXG4gICAgICAgICAqXG4gICAgICAgICAqIFBPUlRJTkcgTk9URTogV2UgYXJlIHVzaW5nIGFuIGltbXV0YWJsZSBkYXRhIHN0cnVjdHVyZSBvbiBXZWIgdG8gbWFrZSByZS1ydW5zXG4gICAgICAgICAqIG9mIGBhcHBseVJlbW90ZUV2ZW50KClgIGlkZW1wb3RlbnQuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnVpID0gbmV3IGZlKHJ0KSwgXG4gICAgICAgIC8qKiBNYXBzIGEgdGFyZ2V0IHRvIGl0cyB0YXJnZXRJRC4gKi9cbiAgICAgICAgLy8gVE9ETyh3dWFuZHkpOiBFdmFsdWF0ZSBpZiBUYXJnZXRJZCBjYW4gYmUgcGFydCBvZiBUYXJnZXQuXG4gICAgICAgIHRoaXMuYWkgPSBuZXcgS24oKHQgPT4gSWUodCkpLCBFZSksIFxuICAgICAgICAvKipcbiAgICAgICAgICogQSBwZXIgY29sbGVjdGlvbiBncm91cCBpbmRleCBvZiB0aGUgbGFzdCByZWFkIHRpbWUgcHJvY2Vzc2VkIGJ5XG4gICAgICAgICAqIGBnZXROZXdEb2N1bWVudENoYW5nZXMoKWAuXG4gICAgICAgICAqXG4gICAgICAgICAqIFBPUlRJTkcgTk9URTogVGhpcyBpcyBvbmx5IHVzZWQgZm9yIG11bHRpLXRhYiBzeW5jaHJvbml6YXRpb24uXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmNpID0gbmV3IE1hcCwgdGhpcy5oaSA9IHQuZ2V0UmVtb3RlRG9jdW1lbnRDYWNoZSgpLCB0aGlzLmZzID0gdC5nZXRUYXJnZXRDYWNoZSgpLCBcbiAgICAgICAgdGhpcy5fcyA9IHQuZ2V0QnVuZGxlQ2FjaGUoKSwgdGhpcy5saShuKTtcbiAgICB9XG4gICAgbGkodCkge1xuICAgICAgICAvLyBUT0RPKGluZGV4aW5nKTogQWRkIHNwZWMgdGVzdHMgdGhhdCB0ZXN0IHRoZXNlIGNvbXBvbmVudHMgY2hhbmdlIGFmdGVyIGFcbiAgICAgICAgLy8gdXNlciBjaGFuZ2VcbiAgICAgICAgdGhpcy5pbmRleE1hbmFnZXIgPSB0aGlzLnBlcnNpc3RlbmNlLmdldEluZGV4TWFuYWdlcih0KSwgdGhpcy5CcyA9IHRoaXMucGVyc2lzdGVuY2UuZ2V0TXV0YXRpb25RdWV1ZSh0LCB0aGlzLmluZGV4TWFuYWdlciksIFxuICAgICAgICB0aGlzLmZpID0gbmV3IFhyKHRoaXMuaGksIHRoaXMuQnMsIHRoaXMuaW5kZXhNYW5hZ2VyKSwgdGhpcy5oaS5zZXRJbmRleE1hbmFnZXIodGhpcy5pbmRleE1hbmFnZXIpLCBcbiAgICAgICAgdGhpcy5vaS5pbml0aWFsaXplKHRoaXMuZmksIHRoaXMuaW5kZXhNYW5hZ2VyKTtcbiAgICB9XG4gICAgY29sbGVjdEdhcmJhZ2UodCkge1xuICAgICAgICByZXR1cm4gdGhpcy5wZXJzaXN0ZW5jZS5ydW5UcmFuc2FjdGlvbihcIkNvbGxlY3QgZ2FyYmFnZVwiLCBcInJlYWR3cml0ZS1wcmltYXJ5XCIsIChlID0+IHQuY29sbGVjdChlLCB0aGlzLnVpKSkpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gbm8oXG4vKiogTWFuYWdlcyBvdXIgaW4tbWVtb3J5IG9yIGR1cmFibGUgcGVyc2lzdGVuY2UuICovXG50LCBlLCBuLCBzKSB7XG4gICAgcmV0dXJuIG5ldyBlbyh0LCBlLCBuLCBzKTtcbn1cblxuLyoqXG4gKiBUZWxscyB0aGUgTG9jYWxTdG9yZSB0aGF0IHRoZSBjdXJyZW50bHkgYXV0aGVudGljYXRlZCB1c2VyIGhhcyBjaGFuZ2VkLlxuICpcbiAqIEluIHJlc3BvbnNlIHRoZSBsb2NhbCBzdG9yZSBzd2l0Y2hlcyB0aGUgbXV0YXRpb24gcXVldWUgdG8gdGhlIG5ldyB1c2VyIGFuZFxuICogcmV0dXJucyBhbnkgcmVzdWx0aW5nIGRvY3VtZW50IGNoYW5nZXMuXG4gKi9cbi8vIFBPUlRJTkcgTk9URTogQW5kcm9pZCBhbmQgaU9TIG9ubHkgcmV0dXJuIHRoZSBkb2N1bWVudHMgYWZmZWN0ZWQgYnkgdGhlXG4vLyBjaGFuZ2UuXG5hc3luYyBmdW5jdGlvbiBzbyh0LCBlKSB7XG4gICAgY29uc3QgbiA9IEsodCk7XG4gICAgcmV0dXJuIGF3YWl0IG4ucGVyc2lzdGVuY2UucnVuVHJhbnNhY3Rpb24oXCJIYW5kbGUgdXNlciBjaGFuZ2VcIiwgXCJyZWFkb25seVwiLCAodCA9PiB7XG4gICAgICAgIC8vIFN3YXAgb3V0IHRoZSBtdXRhdGlvbiBxdWV1ZSwgZ3JhYmJpbmcgdGhlIHBlbmRpbmcgbXV0YXRpb24gYmF0Y2hlc1xuICAgICAgICAvLyBiZWZvcmUgYW5kIGFmdGVyLlxuICAgICAgICBsZXQgcztcbiAgICAgICAgcmV0dXJuIG4uQnMuZ2V0QWxsTXV0YXRpb25CYXRjaGVzKHQpLm5leHQoKGkgPT4gKHMgPSBpLCBuLmxpKGUpLCBuLkJzLmdldEFsbE11dGF0aW9uQmF0Y2hlcyh0KSkpKS5uZXh0KChlID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGkgPSBbXSwgciA9IFtdO1xuICAgICAgICAgICAgLy8gVW5pb24gdGhlIG9sZC9uZXcgY2hhbmdlZCBrZXlzLlxuICAgICAgICAgICAgbGV0IG8gPSBZbigpO1xuICAgICAgICAgICAgZm9yIChjb25zdCB0IG9mIHMpIHtcbiAgICAgICAgICAgICAgICBpLnB1c2godC5iYXRjaElkKTtcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGUgb2YgdC5tdXRhdGlvbnMpIG8gPSBvLmFkZChlLmtleSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmb3IgKGNvbnN0IHQgb2YgZSkge1xuICAgICAgICAgICAgICAgIHIucHVzaCh0LmJhdGNoSWQpO1xuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgZSBvZiB0Lm11dGF0aW9ucykgbyA9IG8uYWRkKGUua2V5KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIFJldHVybiB0aGUgc2V0IG9mIGFsbCAocG90ZW50aWFsbHkpIGNoYW5nZWQgZG9jdW1lbnRzIGFuZCB0aGUgbGlzdFxuICAgICAgICAgICAgLy8gb2YgbXV0YXRpb24gYmF0Y2ggSURzIHRoYXQgd2VyZSBhZmZlY3RlZCBieSBjaGFuZ2UuXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbi5maS5Lcyh0LCBvKS5uZXh0KCh0ID0+ICh7XG4gICAgICAgICAgICAgICAgZGk6IHQsXG4gICAgICAgICAgICAgICAgcmVtb3ZlZEJhdGNoSWRzOiBpLFxuICAgICAgICAgICAgICAgIGFkZGVkQmF0Y2hJZHM6IHJcbiAgICAgICAgICAgIH0pKSk7XG4gICAgICAgIH0pKTtcbiAgICB9KSk7XG59XG5cbi8qIEFjY2VwdHMgbG9jYWxseSBnZW5lcmF0ZWQgTXV0YXRpb25zIGFuZCBjb21taXQgdGhlbSB0byBzdG9yYWdlLiAqL1xuLyoqXG4gKiBBY2tub3dsZWRnZXMgdGhlIGdpdmVuIGJhdGNoLlxuICpcbiAqIE9uIHRoZSBoYXBweSBwYXRoIHdoZW4gYSBiYXRjaCBpcyBhY2tub3dsZWRnZWQsIHRoZSBsb2NhbCBzdG9yZSB3aWxsXG4gKlxuICogICsgcmVtb3ZlIHRoZSBiYXRjaCBmcm9tIHRoZSBtdXRhdGlvbiBxdWV1ZTtcbiAqICArIGFwcGx5IHRoZSBjaGFuZ2VzIHRvIHRoZSByZW1vdGUgZG9jdW1lbnQgY2FjaGU7XG4gKiAgKyByZWNhbGN1bGF0ZSB0aGUgbGF0ZW5jeSBjb21wZW5zYXRlZCB2aWV3IGltcGxpZWQgYnkgdGhvc2UgY2hhbmdlcyAodGhlcmVcbiAqICAgIG1heSBiZSBtdXRhdGlvbnMgaW4gdGhlIHF1ZXVlIHRoYXQgYWZmZWN0IHRoZSBkb2N1bWVudHMgYnV0IGhhdmVuJ3QgYmVlblxuICogICAgYWNrbm93bGVkZ2VkIHlldCk7IGFuZFxuICogICsgZ2l2ZSB0aGUgY2hhbmdlZCBkb2N1bWVudHMgYmFjayB0aGUgc3luYyBlbmdpbmVcbiAqXG4gKiBAcmV0dXJucyBUaGUgcmVzdWx0aW5nIChtb2RpZmllZCkgZG9jdW1lbnRzLlxuICovXG5mdW5jdGlvbiBpbyh0LCBlKSB7XG4gICAgY29uc3QgbiA9IEsodCk7XG4gICAgcmV0dXJuIG4ucGVyc2lzdGVuY2UucnVuVHJhbnNhY3Rpb24oXCJBY2tub3dsZWRnZSBiYXRjaFwiLCBcInJlYWR3cml0ZS1wcmltYXJ5XCIsICh0ID0+IHtcbiAgICAgICAgY29uc3QgcyA9IGUuYmF0Y2gua2V5cygpLCBpID0gbi5oaS5uZXdDaGFuZ2VCdWZmZXIoe1xuICAgICAgICAgICAgdHJhY2tSZW1vdmFsczogITBcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbih0LCBlLCBuLCBzKSB7XG4gICAgICAgICAgICBjb25zdCBpID0gbi5iYXRjaCwgciA9IGkua2V5cygpO1xuICAgICAgICAgICAgbGV0IG8gPSB5aS5yZXNvbHZlKCk7XG4gICAgICAgICAgICByZXR1cm4gci5mb3JFYWNoKCh0ID0+IHtcbiAgICAgICAgICAgICAgICBvID0gby5uZXh0KCgoKSA9PiBzLmdldEVudHJ5KGUsIHQpKSkubmV4dCgoZSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHIgPSBuLmRvY1ZlcnNpb25zLmdldCh0KTtcbiAgICAgICAgICAgICAgICAgICAgVShudWxsICE9PSByKSwgZS52ZXJzaW9uLmNvbXBhcmVUbyhyKSA8IDAgJiYgKGkuYXBwbHlUb1JlbW90ZURvY3VtZW50KGUsIG4pLCBlLmlzVmFsaWREb2N1bWVudCgpICYmIChcbiAgICAgICAgICAgICAgICAgICAgLy8gV2UgdXNlIHRoZSBjb21taXRWZXJzaW9uIGFzIHRoZSByZWFkVGltZSByYXRoZXIgdGhhbiB0aGVcbiAgICAgICAgICAgICAgICAgICAgLy8gZG9jdW1lbnQncyB1cGRhdGVUaW1lIHNpbmNlIHRoZSB1cGRhdGVUaW1lIGlzIG5vdCBhZHZhbmNlZFxuICAgICAgICAgICAgICAgICAgICAvLyBmb3IgdXBkYXRlcyB0aGF0IGRvIG5vdCBtb2RpZnkgdGhlIHVuZGVybHlpbmcgZG9jdW1lbnQuXG4gICAgICAgICAgICAgICAgICAgIGUuc2V0UmVhZFRpbWUobi5jb21taXRWZXJzaW9uKSwgcy5hZGRFbnRyeShlKSkpO1xuICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgIH0pKSwgby5uZXh0KCgoKSA9PiB0LkJzLnJlbW92ZU11dGF0aW9uQmF0Y2goZSwgaSkpKTtcbiAgICAgICAgfVxuICAgICAgICAvKiogUmV0dXJucyB0aGUgbG9jYWwgdmlldyBvZiB0aGUgZG9jdW1lbnRzIGFmZmVjdGVkIGJ5IGEgbXV0YXRpb24gYmF0Y2guICovXG4gICAgICAgIC8vIFBPUlRJTkcgTk9URTogTXVsdGktVGFiIG9ubHkuXG4gICAgICAgIChuLCB0LCBlLCBpKS5uZXh0KCgoKSA9PiBpLmFwcGx5KHQpKSkubmV4dCgoKCkgPT4gbi5Ccy5wZXJmb3JtQ29uc2lzdGVuY3lDaGVjayh0KSkpLm5leHQoKCgpID0+IG4uZmkuS3ModCwgcykpKTtcbiAgICB9KSk7XG59XG5cbi8qKlxuICogUmVtb3ZlcyBtdXRhdGlvbnMgZnJvbSB0aGUgTXV0YXRpb25RdWV1ZSBmb3IgdGhlIHNwZWNpZmllZCBiYXRjaDtcbiAqIExvY2FsRG9jdW1lbnRzIHdpbGwgYmUgcmVjYWxjdWxhdGVkLlxuICpcbiAqIEByZXR1cm5zIFRoZSByZXN1bHRpbmcgbW9kaWZpZWQgZG9jdW1lbnRzLlxuICovXG4vKipcbiAqIFJldHVybnMgdGhlIGxhc3QgY29uc2lzdGVudCBzbmFwc2hvdCBwcm9jZXNzZWQgKHVzZWQgYnkgdGhlIFJlbW90ZVN0b3JlIHRvXG4gKiBkZXRlcm1pbmUgd2hldGhlciB0byBidWZmZXIgaW5jb21pbmcgc25hcHNob3RzIGZyb20gdGhlIGJhY2tlbmQpLlxuICovXG5mdW5jdGlvbiBybyh0KSB7XG4gICAgY29uc3QgZSA9IEsodCk7XG4gICAgcmV0dXJuIGUucGVyc2lzdGVuY2UucnVuVHJhbnNhY3Rpb24oXCJHZXQgbGFzdCByZW1vdGUgc25hcHNob3QgdmVyc2lvblwiLCBcInJlYWRvbmx5XCIsICh0ID0+IGUuZnMuZ2V0TGFzdFJlbW90ZVNuYXBzaG90VmVyc2lvbih0KSkpO1xufVxuXG4vKipcbiAqIFVwZGF0ZXMgdGhlIFwiZ3JvdW5kLXN0YXRlXCIgKHJlbW90ZSkgZG9jdW1lbnRzLiBXZSBhc3N1bWUgdGhhdCB0aGUgcmVtb3RlXG4gKiBldmVudCByZWZsZWN0cyBhbnkgd3JpdGUgYmF0Y2hlcyB0aGF0IGhhdmUgYmVlbiBhY2tub3dsZWRnZWQgb3IgcmVqZWN0ZWRcbiAqIChpLmUuIHdlIGRvIG5vdCByZS1hcHBseSBsb2NhbCBtdXRhdGlvbnMgdG8gdXBkYXRlcyBmcm9tIHRoaXMgZXZlbnQpLlxuICpcbiAqIExvY2FsRG9jdW1lbnRzIGFyZSByZS1jYWxjdWxhdGVkIGlmIHRoZXJlIGFyZSByZW1haW5pbmcgbXV0YXRpb25zIGluIHRoZVxuICogcXVldWUuXG4gKi8gZnVuY3Rpb24gb28odCwgZSkge1xuICAgIGNvbnN0IG4gPSBLKHQpLCBzID0gZS5zbmFwc2hvdFZlcnNpb247XG4gICAgbGV0IGkgPSBuLnVpO1xuICAgIHJldHVybiBuLnBlcnNpc3RlbmNlLnJ1blRyYW5zYWN0aW9uKFwiQXBwbHkgcmVtb3RlIGV2ZW50XCIsIFwicmVhZHdyaXRlLXByaW1hcnlcIiwgKHQgPT4ge1xuICAgICAgICBjb25zdCByID0gbi5oaS5uZXdDaGFuZ2VCdWZmZXIoe1xuICAgICAgICAgICAgdHJhY2tSZW1vdmFsczogITBcbiAgICAgICAgfSk7XG4gICAgICAgIC8vIFJlc2V0IG5ld1RhcmdldERhdGFCeVRhcmdldE1hcCBpbiBjYXNlIHRoaXMgdHJhbnNhY3Rpb24gZ2V0cyByZS1ydW4uXG4gICAgICAgICAgICAgICAgaSA9IG4udWk7XG4gICAgICAgIGNvbnN0IG8gPSBbXTtcbiAgICAgICAgZS50YXJnZXRDaGFuZ2VzLmZvckVhY2goKChyLCB1KSA9PiB7XG4gICAgICAgICAgICBjb25zdCBhID0gaS5nZXQodSk7XG4gICAgICAgICAgICBpZiAoIWEpIHJldHVybjtcbiAgICAgICAgICAgIC8vIE9ubHkgdXBkYXRlIHRoZSByZW1vdGUga2V5cyBpZiB0aGUgdGFyZ2V0IGlzIHN0aWxsIGFjdGl2ZS4gVGhpc1xuICAgICAgICAgICAgLy8gZW5zdXJlcyB0aGF0IHdlIGNhbiBwZXJzaXN0IHRoZSB1cGRhdGVkIHRhcmdldCBkYXRhIGFsb25nIHdpdGhcbiAgICAgICAgICAgIC8vIHRoZSB1cGRhdGVkIGFzc2lnbm1lbnQuXG4gICAgICAgICAgICAgICAgICAgICAgICBvLnB1c2gobi5mcy5yZW1vdmVNYXRjaGluZ0tleXModCwgci5yZW1vdmVkRG9jdW1lbnRzLCB1KS5uZXh0KCgoKSA9PiBuLmZzLmFkZE1hdGNoaW5nS2V5cyh0LCByLmFkZGVkRG9jdW1lbnRzLCB1KSkpKTtcbiAgICAgICAgICAgIGxldCBjID0gYS53aXRoU2VxdWVuY2VOdW1iZXIodC5jdXJyZW50U2VxdWVuY2VOdW1iZXIpO1xuICAgICAgICAgICAgZS50YXJnZXRNaXNtYXRjaGVzLmhhcyh1KSA/IGMgPSBjLndpdGhSZXN1bWVUb2tlbihwdC5FTVBUWV9CWVRFX1NUUklORywgY3QubWluKCkpLndpdGhMYXN0TGltYm9GcmVlU25hcHNob3RWZXJzaW9uKGN0Lm1pbigpKSA6IHIucmVzdW1lVG9rZW4uYXBwcm94aW1hdGVCeXRlU2l6ZSgpID4gMCAmJiAoYyA9IGMud2l0aFJlc3VtZVRva2VuKHIucmVzdW1lVG9rZW4sIHMpKSwgXG4gICAgICAgICAgICBpID0gaS5pbnNlcnQodSwgYyksIFxuICAgICAgICAgICAgLy8gVXBkYXRlIHRoZSB0YXJnZXQgZGF0YSBpZiB0aGVyZSBhcmUgdGFyZ2V0IGNoYW5nZXMgKG9yIGlmXG4gICAgICAgICAgICAvLyBzdWZmaWNpZW50IHRpbWUgaGFzIHBhc3NlZCBzaW5jZSB0aGUgbGFzdCB1cGRhdGUpLlxuICAgICAgICAgICAgLyoqXG4gKiBSZXR1cm5zIHRydWUgaWYgdGhlIG5ld1RhcmdldERhdGEgc2hvdWxkIGJlIHBlcnNpc3RlZCBkdXJpbmcgYW4gdXBkYXRlIG9mXG4gKiBhbiBhY3RpdmUgdGFyZ2V0LiBUYXJnZXREYXRhIHNob3VsZCBhbHdheXMgYmUgcGVyc2lzdGVkIHdoZW4gYSB0YXJnZXQgaXNcbiAqIGJlaW5nIHJlbGVhc2VkIGFuZCBzaG91bGQgbm90IGNhbGwgdGhpcyBmdW5jdGlvbi5cbiAqXG4gKiBXaGlsZSB0aGUgdGFyZ2V0IGlzIGFjdGl2ZSwgVGFyZ2V0RGF0YSB1cGRhdGVzIGNhbiBiZSBvbWl0dGVkIHdoZW4gbm90aGluZ1xuICogYWJvdXQgdGhlIHRhcmdldCBoYXMgY2hhbmdlZCBleGNlcHQgbWV0YWRhdGEgbGlrZSB0aGUgcmVzdW1lIHRva2VuIG9yXG4gKiBzbmFwc2hvdCB2ZXJzaW9uLiBPY2Nhc2lvbmFsbHkgaXQncyB3b3J0aCB0aGUgZXh0cmEgd3JpdGUgdG8gcHJldmVudCB0aGVzZVxuICogdmFsdWVzIGZyb20gZ2V0dGluZyB0b28gc3RhbGUgYWZ0ZXIgYSBjcmFzaCwgYnV0IHRoaXMgZG9lc24ndCBoYXZlIHRvIGJlXG4gKiB0b28gZnJlcXVlbnQuXG4gKi9cbiAgICAgICAgICAgIGZ1bmN0aW9uKHQsIGUsIG4pIHtcbiAgICAgICAgICAgICAgICAvLyBBbHdheXMgcGVyc2lzdCB0YXJnZXQgZGF0YSBpZiB3ZSBkb24ndCBhbHJlYWR5IGhhdmUgYSByZXN1bWUgdG9rZW4uXG4gICAgICAgICAgICAgICAgaWYgKDAgPT09IHQucmVzdW1lVG9rZW4uYXBwcm94aW1hdGVCeXRlU2l6ZSgpKSByZXR1cm4gITA7XG4gICAgICAgICAgICAgICAgLy8gRG9uJ3QgYWxsb3cgcmVzdW1lIHRva2VuIGNoYW5nZXMgdG8gYmUgYnVmZmVyZWQgaW5kZWZpbml0ZWx5LiBUaGlzXG4gICAgICAgICAgICAgICAgLy8gYWxsb3dzIHVzIHRvIGJlIHJlYXNvbmFibHkgdXAtdG8tZGF0ZSBhZnRlciBhIGNyYXNoIGFuZCBhdm9pZHMgbmVlZGluZ1xuICAgICAgICAgICAgICAgIC8vIHRvIGxvb3Agb3ZlciBhbGwgYWN0aXZlIHF1ZXJpZXMgb24gc2h1dGRvd24uIEVzcGVjaWFsbHkgaW4gdGhlIGJyb3dzZXJcbiAgICAgICAgICAgICAgICAvLyB3ZSBtYXkgbm90IGdldCB0aW1lIHRvIGRvIGFueXRoaW5nIGludGVyZXN0aW5nIHdoaWxlIHRoZSBjdXJyZW50IHRhYiBpc1xuICAgICAgICAgICAgICAgIC8vIGNsb3NpbmcuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlLnNuYXBzaG90VmVyc2lvbi50b01pY3Jvc2Vjb25kcygpIC0gdC5zbmFwc2hvdFZlcnNpb24udG9NaWNyb3NlY29uZHMoKSA+PSAzZTgpIHJldHVybiAhMDtcbiAgICAgICAgICAgICAgICAvLyBPdGhlcndpc2UgaWYgdGhlIG9ubHkgdGhpbmcgdGhhdCBoYXMgY2hhbmdlZCBhYm91dCBhIHRhcmdldCBpcyBpdHMgcmVzdW1lXG4gICAgICAgICAgICAgICAgLy8gdG9rZW4gaXQncyBub3Qgd29ydGggcGVyc2lzdGluZy4gTm90ZSB0aGF0IHRoZSBSZW1vdGVTdG9yZSBrZWVwcyBhblxuICAgICAgICAgICAgICAgIC8vIGluLW1lbW9yeSB2aWV3IG9mIHRoZSBjdXJyZW50bHkgYWN0aXZlIHRhcmdldHMgd2hpY2ggaW5jbHVkZXMgdGhlIGN1cnJlbnRcbiAgICAgICAgICAgICAgICAvLyByZXN1bWUgdG9rZW4sIHNvIHN0cmVhbSBmYWlsdXJlIG9yIHVzZXIgY2hhbmdlcyB3aWxsIHN0aWxsIHVzZSBhblxuICAgICAgICAgICAgICAgIC8vIHVwLXRvLWRhdGUgcmVzdW1lIHRva2VuIHJlZ2FyZGxlc3Mgb2Ygd2hhdCB3ZSBkbyBoZXJlLlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbi5hZGRlZERvY3VtZW50cy5zaXplICsgbi5tb2RpZmllZERvY3VtZW50cy5zaXplICsgbi5yZW1vdmVkRG9jdW1lbnRzLnNpemUgPiAwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLyoqXG4gKiBOb3RpZmllcyBsb2NhbCBzdG9yZSBvZiB0aGUgY2hhbmdlZCB2aWV3cyB0byBsb2NhbGx5IHBpbiBkb2N1bWVudHMuXG4gKi8gKGEsIGMsIHIpICYmIG8ucHVzaChuLmZzLnVwZGF0ZVRhcmdldERhdGEodCwgYykpO1xuICAgICAgICB9KSk7XG4gICAgICAgIGxldCB1ID0gUW4oKTtcbiAgICAgICAgLy8gSEFDSzogVGhlIG9ubHkgcmVhc29uIHdlIGFsbG93IGEgbnVsbCBzbmFwc2hvdCB2ZXJzaW9uIGlzIHNvIHRoYXQgd2VcbiAgICAgICAgLy8gY2FuIHN5bnRoZXNpemUgcmVtb3RlIGV2ZW50cyB3aGVuIHdlIGdldCBwZXJtaXNzaW9uIGRlbmllZCBlcnJvcnMgd2hpbGVcbiAgICAgICAgLy8gdHJ5aW5nIHRvIHJlc29sdmUgdGhlIHN0YXRlIG9mIGEgbG9jYWxseSBjYWNoZWQgZG9jdW1lbnQgdGhhdCBpcyBpblxuICAgICAgICAvLyBsaW1iby5cbiAgICAgICAgaWYgKGUuZG9jdW1lbnRVcGRhdGVzLmZvckVhY2goKHMgPT4ge1xuICAgICAgICAgICAgZS5yZXNvbHZlZExpbWJvRG9jdW1lbnRzLmhhcyhzKSAmJiBvLnB1c2gobi5wZXJzaXN0ZW5jZS5yZWZlcmVuY2VEZWxlZ2F0ZS51cGRhdGVMaW1ib0RvY3VtZW50KHQsIHMpKTtcbiAgICAgICAgfSkpLCBcbiAgICAgICAgLy8gRWFjaCBsb29wIGl0ZXJhdGlvbiBvbmx5IGFmZmVjdHMgaXRzIFwib3duXCIgZG9jLCBzbyBpdCdzIHNhZmUgdG8gZ2V0IGFsbCB0aGUgcmVtb3RlXG4gICAgICAgIC8vIGRvY3VtZW50cyBpbiBhZHZhbmNlIGluIGEgc2luZ2xlIGNhbGwuXG4gICAgICAgIG8ucHVzaCh1byh0LCByLCBlLmRvY3VtZW50VXBkYXRlcykubmV4dCgodCA9PiB7XG4gICAgICAgICAgICB1ID0gdDtcbiAgICAgICAgfSkpKSwgIXMuaXNFcXVhbChjdC5taW4oKSkpIHtcbiAgICAgICAgICAgIGNvbnN0IGUgPSBuLmZzLmdldExhc3RSZW1vdGVTbmFwc2hvdFZlcnNpb24odCkubmV4dCgoZSA9PiBuLmZzLnNldFRhcmdldHNNZXRhZGF0YSh0LCB0LmN1cnJlbnRTZXF1ZW5jZU51bWJlciwgcykpKTtcbiAgICAgICAgICAgIG8ucHVzaChlKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4geWkud2FpdEZvcihvKS5uZXh0KCgoKSA9PiByLmFwcGx5KHQpKSkubmV4dCgoKCkgPT4gbi5maS5Hcyh0LCB1KSkpLm5leHQoKCgpID0+IHUpKTtcbiAgICB9KSkudGhlbigodCA9PiAobi51aSA9IGksIHQpKSk7XG59XG5cbi8qKlxuICogUG9wdWxhdGVzIGRvY3VtZW50IGNoYW5nZSBidWZmZXIgd2l0aCBkb2N1bWVudHMgZnJvbSBiYWNrZW5kIG9yIGEgYnVuZGxlLlxuICogUmV0dXJucyB0aGUgZG9jdW1lbnQgY2hhbmdlcyByZXN1bHRpbmcgZnJvbSBhcHBseWluZyB0aG9zZSBkb2N1bWVudHMuXG4gKlxuICogQHBhcmFtIHR4biAtIFRyYW5zYWN0aW9uIHRvIHVzZSB0byByZWFkIGV4aXN0aW5nIGRvY3VtZW50cyBmcm9tIHN0b3JhZ2UuXG4gKiBAcGFyYW0gZG9jdW1lbnRCdWZmZXIgLSBEb2N1bWVudCBidWZmZXIgdG8gY29sbGVjdCB0aGUgcmVzdWx0ZWQgY2hhbmdlcyB0byBiZVxuICogICAgICAgIGFwcGxpZWQgdG8gc3RvcmFnZS5cbiAqIEBwYXJhbSBkb2N1bWVudHMgLSBEb2N1bWVudHMgdG8gYmUgYXBwbGllZC5cbiAqIEBwYXJhbSBnbG9iYWxWZXJzaW9uIC0gQSBgU25hcHNob3RWZXJzaW9uYCByZXByZXNlbnRpbmcgdGhlIHJlYWQgdGltZSBpZiBhbGxcbiAqICAgICAgICBkb2N1bWVudHMgaGF2ZSB0aGUgc2FtZSByZWFkIHRpbWUuXG4gKiBAcGFyYW0gZG9jdW1lbnRWZXJzaW9ucyAtIEEgRG9jdW1lbnRLZXktdG8tU25hcHNob3RWZXJzaW9uIG1hcCBpZiBkb2N1bWVudHNcbiAqICAgICAgICBoYXZlIHRoZWlyIG93biByZWFkIHRpbWUuXG4gKlxuICogTm90ZTogdGhpcyBmdW5jdGlvbiB3aWxsIHVzZSBgZG9jdW1lbnRWZXJzaW9uc2AgaWYgaXQgaXMgZGVmaW5lZDtcbiAqIHdoZW4gaXQgaXMgbm90IGRlZmluZWQsIHJlc29ydHMgdG8gYGdsb2JhbFZlcnNpb25gLlxuICovIGZ1bmN0aW9uIHVvKHQsIGUsIG4pIHtcbiAgICBsZXQgcyA9IFluKCk7XG4gICAgcmV0dXJuIG4uZm9yRWFjaCgodCA9PiBzID0gcy5hZGQodCkpKSwgZS5nZXRFbnRyaWVzKHQsIHMpLm5leHQoKHQgPT4ge1xuICAgICAgICBsZXQgcyA9IFFuKCk7XG4gICAgICAgIHJldHVybiBuLmZvckVhY2goKChuLCBpKSA9PiB7XG4gICAgICAgICAgICBjb25zdCByID0gdC5nZXQobik7XG4gICAgICAgICAgICAvLyBOb3RlOiBUaGUgb3JkZXIgb2YgdGhlIHN0ZXBzIGJlbG93IGlzIGltcG9ydGFudCwgc2luY2Ugd2Ugd2FudFxuICAgICAgICAgICAgLy8gdG8gZW5zdXJlIHRoYXQgcmVqZWN0ZWQgbGltYm8gcmVzb2x1dGlvbnMgKHdoaWNoIGZhYnJpY2F0ZVxuICAgICAgICAgICAgLy8gTm9Eb2N1bWVudHMgd2l0aCBTbmFwc2hvdFZlcnNpb24ubWluKCkpIG5ldmVyIGFkZCBkb2N1bWVudHMgdG9cbiAgICAgICAgICAgIC8vIGNhY2hlLlxuICAgICAgICAgICAgICAgICAgICAgICAgaS5pc05vRG9jdW1lbnQoKSAmJiBpLnZlcnNpb24uaXNFcXVhbChjdC5taW4oKSkgPyAoXG4gICAgICAgICAgICAvLyBOb0RvY3VtZW50cyB3aXRoIFNuYXBzaG90VmVyc2lvbi5taW4oKSBhcmUgdXNlZCBpbiBtYW51ZmFjdHVyZWRcbiAgICAgICAgICAgIC8vIGV2ZW50cy4gV2UgcmVtb3ZlIHRoZXNlIGRvY3VtZW50cyBmcm9tIGNhY2hlIHNpbmNlIHdlIGxvc3RcbiAgICAgICAgICAgIC8vIGFjY2Vzcy5cbiAgICAgICAgICAgIGUucmVtb3ZlRW50cnkobiwgaS5yZWFkVGltZSksIHMgPSBzLmluc2VydChuLCBpKSkgOiAhci5pc1ZhbGlkRG9jdW1lbnQoKSB8fCBpLnZlcnNpb24uY29tcGFyZVRvKHIudmVyc2lvbikgPiAwIHx8IDAgPT09IGkudmVyc2lvbi5jb21wYXJlVG8oci52ZXJzaW9uKSAmJiByLmhhc1BlbmRpbmdXcml0ZXMgPyAoZS5hZGRFbnRyeShpKSwgXG4gICAgICAgICAgICBzID0gcy5pbnNlcnQobiwgaSkpIDogTyhcIkxvY2FsU3RvcmVcIiwgXCJJZ25vcmluZyBvdXRkYXRlZCB3YXRjaCB1cGRhdGUgZm9yIFwiLCBuLCBcIi4gQ3VycmVudCB2ZXJzaW9uOlwiLCByLnZlcnNpb24sIFwiIFdhdGNoIHZlcnNpb246XCIsIGkudmVyc2lvbik7XG4gICAgICAgIH0pKSwgcztcbiAgICB9KSk7XG59XG5cbi8qKlxuICogR2V0cyB0aGUgbXV0YXRpb24gYmF0Y2ggYWZ0ZXIgdGhlIHBhc3NlZCBpbiBiYXRjaElkIGluIHRoZSBtdXRhdGlvbiBxdWV1ZVxuICogb3IgbnVsbCBpZiBlbXB0eS5cbiAqIEBwYXJhbSBhZnRlckJhdGNoSWQgLSBJZiBwcm92aWRlZCwgdGhlIGJhdGNoIHRvIHNlYXJjaCBhZnRlci5cbiAqIEByZXR1cm5zIFRoZSBuZXh0IG11dGF0aW9uIG9yIG51bGwgaWYgdGhlcmUgd2Fzbid0IG9uZS5cbiAqL1xuZnVuY3Rpb24gYW8odCwgZSkge1xuICAgIGNvbnN0IG4gPSBLKHQpO1xuICAgIHJldHVybiBuLnBlcnNpc3RlbmNlLnJ1blRyYW5zYWN0aW9uKFwiR2V0IG5leHQgbXV0YXRpb24gYmF0Y2hcIiwgXCJyZWFkb25seVwiLCAodCA9PiAodm9pZCAwID09PSBlICYmIChlID0gLTEpLCBcbiAgICBuLkJzLmdldE5leHRNdXRhdGlvbkJhdGNoQWZ0ZXJCYXRjaElkKHQsIGUpKSkpO1xufVxuXG4vKipcbiAqIFJlYWRzIHRoZSBjdXJyZW50IHZhbHVlIG9mIGEgRG9jdW1lbnQgd2l0aCBhIGdpdmVuIGtleSBvciBudWxsIGlmIG5vdFxuICogZm91bmQgLSB1c2VkIGZvciB0ZXN0aW5nLlxuICovXG4vKipcbiAqIEFzc2lnbnMgdGhlIGdpdmVuIHRhcmdldCBhbiBpbnRlcm5hbCBJRCBzbyB0aGF0IGl0cyByZXN1bHRzIGNhbiBiZSBwaW5uZWQgc29cbiAqIHRoZXkgZG9uJ3QgZ2V0IEdDJ2QuIEEgdGFyZ2V0IG11c3QgYmUgYWxsb2NhdGVkIGluIHRoZSBsb2NhbCBzdG9yZSBiZWZvcmVcbiAqIHRoZSBzdG9yZSBjYW4gYmUgdXNlZCB0byBtYW5hZ2UgaXRzIHZpZXcuXG4gKlxuICogQWxsb2NhdGluZyBhbiBhbHJlYWR5IGFsbG9jYXRlZCBgVGFyZ2V0YCB3aWxsIHJldHVybiB0aGUgZXhpc3RpbmcgYFRhcmdldERhdGFgXG4gKiBmb3IgdGhhdCBgVGFyZ2V0YC5cbiAqL1xuZnVuY3Rpb24gY28odCwgZSkge1xuICAgIGNvbnN0IG4gPSBLKHQpO1xuICAgIHJldHVybiBuLnBlcnNpc3RlbmNlLnJ1blRyYW5zYWN0aW9uKFwiQWxsb2NhdGUgdGFyZ2V0XCIsIFwicmVhZHdyaXRlXCIsICh0ID0+IHtcbiAgICAgICAgbGV0IHM7XG4gICAgICAgIHJldHVybiBuLmZzLmdldFRhcmdldERhdGEodCwgZSkubmV4dCgoaSA9PiBpID8gKFxuICAgICAgICAvLyBUaGlzIHRhcmdldCBoYXMgYmVlbiBsaXN0ZW5lZCB0byBwcmV2aW91c2x5LCBzbyByZXVzZSB0aGVcbiAgICAgICAgLy8gcHJldmlvdXMgdGFyZ2V0SUQuXG4gICAgICAgIC8vIFRPRE8obWNnKTogZnJlc2hlbiBsYXN0IGFjY2Vzc2VkIGRhdGU/XG4gICAgICAgIHMgPSBpLCB5aS5yZXNvbHZlKHMpKSA6IG4uZnMuYWxsb2NhdGVUYXJnZXRJZCh0KS5uZXh0KChpID0+IChzID0gbmV3IE5pKGUsIGksIDAgLyogTGlzdGVuICovICwgdC5jdXJyZW50U2VxdWVuY2VOdW1iZXIpLCBcbiAgICAgICAgbi5mcy5hZGRUYXJnZXREYXRhKHQsIHMpLm5leHQoKCgpID0+IHMpKSkpKSkpO1xuICAgIH0pKS50aGVuKCh0ID0+IHtcbiAgICAgICAgLy8gSWYgTXVsdGktVGFiIGlzIGVuYWJsZWQsIHRoZSBleGlzdGluZyB0YXJnZXQgZGF0YSBtYXkgYmUgbmV3ZXIgdGhhblxuICAgICAgICAvLyB0aGUgaW4tbWVtb3J5IGRhdGFcbiAgICAgICAgY29uc3QgcyA9IG4udWkuZ2V0KHQudGFyZ2V0SWQpO1xuICAgICAgICByZXR1cm4gKG51bGwgPT09IHMgfHwgdC5zbmFwc2hvdFZlcnNpb24uY29tcGFyZVRvKHMuc25hcHNob3RWZXJzaW9uKSA+IDApICYmIChuLnVpID0gbi51aS5pbnNlcnQodC50YXJnZXRJZCwgdCksIFxuICAgICAgICBuLmFpLnNldChlLCB0LnRhcmdldElkKSksIHQ7XG4gICAgfSkpO1xufVxuXG4vKipcbiAqIFJldHVybnMgdGhlIFRhcmdldERhdGEgYXMgc2VlbiBieSB0aGUgTG9jYWxTdG9yZSwgaW5jbHVkaW5nIHVwZGF0ZXMgdGhhdCBtYXlcbiAqIGhhdmUgbm90IHlldCBiZWVuIHBlcnNpc3RlZCB0byB0aGUgVGFyZ2V0Q2FjaGUuXG4gKi9cbi8vIFZpc2libGUgZm9yIHRlc3RpbmcuXG4vKipcbiAqIFVucGlucyBhbGwgdGhlIGRvY3VtZW50cyBhc3NvY2lhdGVkIHdpdGggdGhlIGdpdmVuIHRhcmdldC4gSWZcbiAqIGBrZWVwUGVyc2lzdGVkVGFyZ2V0RGF0YWAgaXMgc2V0IHRvIGZhbHNlIGFuZCBFYWdlciBHQyBlbmFibGVkLCB0aGUgbWV0aG9kXG4gKiBkaXJlY3RseSByZW1vdmVzIHRoZSBhc3NvY2lhdGVkIHRhcmdldCBkYXRhIGZyb20gdGhlIHRhcmdldCBjYWNoZS5cbiAqXG4gKiBSZWxlYXNpbmcgYSBub24tZXhpc3RpbmcgYFRhcmdldGAgaXMgYSBuby1vcC5cbiAqL1xuLy8gUE9SVElORyBOT1RFOiBga2VlcFBlcnNpc3RlZFRhcmdldERhdGFgIGlzIG11bHRpLXRhYiBvbmx5LlxuYXN5bmMgZnVuY3Rpb24gaG8odCwgZSwgbikge1xuICAgIGNvbnN0IHMgPSBLKHQpLCBpID0gcy51aS5nZXQoZSksIHIgPSBuID8gXCJyZWFkd3JpdGVcIiA6IFwicmVhZHdyaXRlLXByaW1hcnlcIjtcbiAgICB0cnkge1xuICAgICAgICBuIHx8IGF3YWl0IHMucGVyc2lzdGVuY2UucnVuVHJhbnNhY3Rpb24oXCJSZWxlYXNlIHRhcmdldFwiLCByLCAodCA9PiBzLnBlcnNpc3RlbmNlLnJlZmVyZW5jZURlbGVnYXRlLnJlbW92ZVRhcmdldCh0LCBpKSkpO1xuICAgIH0gY2F0Y2ggKHQpIHtcbiAgICAgICAgaWYgKCFBaSh0KSkgdGhyb3cgdDtcbiAgICAgICAgLy8gQWxsIGByZWxlYXNlVGFyZ2V0YCBkb2VzIGlzIHJlY29yZCB0aGUgZmluYWwgbWV0YWRhdGEgc3RhdGUgZm9yIHRoZVxuICAgICAgICAvLyB0YXJnZXQsIGJ1dCB3ZSd2ZSBiZWVuIHJlY29yZGluZyB0aGlzIHBlcmlvZGljYWxseSBkdXJpbmcgdGFyZ2V0XG4gICAgICAgIC8vIGFjdGl2aXR5LiBJZiB3ZSBsb3NlIHRoaXMgd3JpdGUgdGhpcyBjb3VsZCBjYXVzZSBhIHZlcnkgc2xpZ2h0XG4gICAgICAgIC8vIGRpZmZlcmVuY2UgaW4gdGhlIG9yZGVyIG9mIHRhcmdldCBkZWxldGlvbiBkdXJpbmcgR0MsIGJ1dCB3ZVxuICAgICAgICAvLyBkb24ndCBkZWZpbmUgZXhhY3QgTFJVIHNlbWFudGljcyBzbyB0aGlzIGlzIGFjY2VwdGFibGUuXG4gICAgICAgIE8oXCJMb2NhbFN0b3JlXCIsIGBGYWlsZWQgdG8gdXBkYXRlIHNlcXVlbmNlIG51bWJlcnMgZm9yIHRhcmdldCAke2V9OiAke3R9YCk7XG4gICAgfVxuICAgIHMudWkgPSBzLnVpLnJlbW92ZShlKSwgcy5haS5kZWxldGUoaS50YXJnZXQpO1xufVxuXG4vKipcbiAqIFJ1bnMgdGhlIHNwZWNpZmllZCBxdWVyeSBhZ2FpbnN0IHRoZSBsb2NhbCBzdG9yZSBhbmQgcmV0dXJucyB0aGUgcmVzdWx0cyxcbiAqIHBvdGVudGlhbGx5IHRha2luZyBhZHZhbnRhZ2Ugb2YgcXVlcnkgZGF0YSBmcm9tIHByZXZpb3VzIGV4ZWN1dGlvbnMgKHN1Y2hcbiAqIGFzIHRoZSBzZXQgb2YgcmVtb3RlIGtleXMpLlxuICpcbiAqIEBwYXJhbSB1c2VQcmV2aW91c1Jlc3VsdHMgLSBXaGV0aGVyIHJlc3VsdHMgZnJvbSBwcmV2aW91cyBleGVjdXRpb25zIGNhblxuICogYmUgdXNlZCB0byBvcHRpbWl6ZSB0aGlzIHF1ZXJ5IGV4ZWN1dGlvbi5cbiAqLyBmdW5jdGlvbiBsbyh0LCBlLCBuKSB7XG4gICAgY29uc3QgcyA9IEsodCk7XG4gICAgbGV0IGkgPSBjdC5taW4oKSwgciA9IFluKCk7XG4gICAgcmV0dXJuIHMucGVyc2lzdGVuY2UucnVuVHJhbnNhY3Rpb24oXCJFeGVjdXRlIHF1ZXJ5XCIsIFwicmVhZG9ubHlcIiwgKHQgPT4gZnVuY3Rpb24odCwgZSwgbikge1xuICAgICAgICBjb25zdCBzID0gSyh0KSwgaSA9IHMuYWkuZ2V0KG4pO1xuICAgICAgICByZXR1cm4gdm9pZCAwICE9PSBpID8geWkucmVzb2x2ZShzLnVpLmdldChpKSkgOiBzLmZzLmdldFRhcmdldERhdGEoZSwgbik7XG4gICAgfShzLCB0LCBIZShlKSkubmV4dCgoZSA9PiB7XG4gICAgICAgIGlmIChlKSByZXR1cm4gaSA9IGUubGFzdExpbWJvRnJlZVNuYXBzaG90VmVyc2lvbiwgcy5mcy5nZXRNYXRjaGluZ0tleXNGb3JUYXJnZXRJZCh0LCBlLnRhcmdldElkKS5uZXh0KCh0ID0+IHtcbiAgICAgICAgICAgIHIgPSB0O1xuICAgICAgICB9KSk7XG4gICAgfSkpLm5leHQoKCgpID0+IHMub2kuUXModCwgZSwgbiA/IGkgOiBjdC5taW4oKSwgbiA/IHIgOiBZbigpKSkpLm5leHQoKHQgPT4gKHdvKHMsIGVuKGUpLCB0KSwgXG4gICAge1xuICAgICAgICBkb2N1bWVudHM6IHQsXG4gICAgICAgIF9pOiByXG4gICAgfSkpKSkpO1xufVxuXG4vLyBQT1JUSU5HIE5PVEU6IE11bHRpLVRhYiBvbmx5LlxuZnVuY3Rpb24gZm8odCwgZSkge1xuICAgIGNvbnN0IG4gPSBLKHQpLCBzID0gSyhuLmZzKSwgaSA9IG4udWkuZ2V0KGUpO1xuICAgIHJldHVybiBpID8gUHJvbWlzZS5yZXNvbHZlKGkudGFyZ2V0KSA6IG4ucGVyc2lzdGVuY2UucnVuVHJhbnNhY3Rpb24oXCJHZXQgdGFyZ2V0IGRhdGFcIiwgXCJyZWFkb25seVwiLCAodCA9PiBzLkV0KHQsIGUpLm5leHQoKHQgPT4gdCA/IHQudGFyZ2V0IDogbnVsbCkpKSk7XG59XG5cbi8qKlxuICogUmV0dXJucyB0aGUgc2V0IG9mIGRvY3VtZW50cyB0aGF0IGhhdmUgYmVlbiB1cGRhdGVkIHNpbmNlIHRoZSBsYXN0IGNhbGwuXG4gKiBJZiB0aGlzIGlzIHRoZSBmaXJzdCBjYWxsLCByZXR1cm5zIHRoZSBzZXQgb2YgY2hhbmdlcyBzaW5jZSBjbGllbnRcbiAqIGluaXRpYWxpemF0aW9uLiBGdXJ0aGVyIGludm9jYXRpb25zIHdpbGwgcmV0dXJuIGRvY3VtZW50IHRoYXQgaGF2ZSBjaGFuZ2VkXG4gKiBzaW5jZSB0aGUgcHJpb3IgY2FsbC5cbiAqL1xuLy8gUE9SVElORyBOT1RFOiBNdWx0aS1UYWIgb25seS5cbmZ1bmN0aW9uIF9vKHQsIGUpIHtcbiAgICBjb25zdCBuID0gSyh0KSwgcyA9IG4uY2kuZ2V0KGUpIHx8IGN0Lm1pbigpO1xuICAgIC8vIEdldCB0aGUgY3VycmVudCBtYXhpbXVtIHJlYWQgdGltZSBmb3IgdGhlIGNvbGxlY3Rpb24uIFRoaXMgc2hvdWxkIGFsd2F5c1xuICAgIC8vIGV4aXN0LCBidXQgdG8gcmVkdWNlIHRoZSBjaGFuY2UgZm9yIHJlZ3Jlc3Npb25zIHdlIGRlZmF1bHQgdG9cbiAgICAvLyBTbmFwc2hvdFZlcnNpb24uTWluKClcbiAgICAvLyBUT0RPKGluZGV4aW5nKTogQ29uc2lkZXIgcmVtb3ZpbmcgdGhlIGRlZmF1bHQgdmFsdWUuXG4gICAgICAgIHJldHVybiBuLnBlcnNpc3RlbmNlLnJ1blRyYW5zYWN0aW9uKFwiR2V0IG5ldyBkb2N1bWVudCBjaGFuZ2VzXCIsIFwicmVhZG9ubHlcIiwgKHQgPT4gbi5oaS5nZXRBbGxGcm9tQ29sbGVjdGlvbkdyb3VwKHQsIGUsIGFlKHMsIC0xKSwgXG4gICAgLyogbGltaXQ9ICovIE51bWJlci5NQVhfU0FGRV9JTlRFR0VSKSkpLnRoZW4oKHQgPT4gKHdvKG4sIGUsIHQpLCB0KSkpO1xufVxuXG4vKiogU2V0cyB0aGUgY29sbGVjdGlvbiBncm91cCdzIG1heGltdW0gcmVhZCB0aW1lIGZyb20gdGhlIGdpdmVuIGRvY3VtZW50cy4gKi9cbi8vIFBPUlRJTkcgTk9URTogTXVsdGktVGFiIG9ubHkuXG5mdW5jdGlvbiB3byh0LCBlLCBuKSB7XG4gICAgbGV0IHMgPSBjdC5taW4oKTtcbiAgICBuLmZvckVhY2goKCh0LCBlKSA9PiB7XG4gICAgICAgIGUucmVhZFRpbWUuY29tcGFyZVRvKHMpID4gMCAmJiAocyA9IGUucmVhZFRpbWUpO1xuICAgIH0pKSwgdC5jaS5zZXQoZSwgcyk7XG59XG5cbi8qKlxuICogQ3JlYXRlcyBhIG5ldyB0YXJnZXQgdXNpbmcgdGhlIGdpdmVuIGJ1bmRsZSBuYW1lLCB3aGljaCB3aWxsIGJlIHVzZWQgdG9cbiAqIGhvbGQgdGhlIGtleXMgb2YgYWxsIGRvY3VtZW50cyBmcm9tIHRoZSBidW5kbGUgaW4gcXVlcnktZG9jdW1lbnQgbWFwcGluZ3MuXG4gKiBUaGlzIGVuc3VyZXMgdGhhdCB0aGUgbG9hZGVkIGRvY3VtZW50cyBkbyBub3QgZ2V0IGdhcmJhZ2UgY29sbGVjdGVkXG4gKiByaWdodCBhd2F5LlxuICovXG4vKipcbiAqIEFwcGxpZXMgdGhlIGRvY3VtZW50cyBmcm9tIGEgYnVuZGxlIHRvIHRoZSBcImdyb3VuZC1zdGF0ZVwiIChyZW1vdGUpXG4gKiBkb2N1bWVudHMuXG4gKlxuICogTG9jYWxEb2N1bWVudHMgYXJlIHJlLWNhbGN1bGF0ZWQgaWYgdGhlcmUgYXJlIHJlbWFpbmluZyBtdXRhdGlvbnMgaW4gdGhlXG4gKiBxdWV1ZS5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gbW8odCwgZSwgbiwgcykge1xuICAgIGNvbnN0IGkgPSBLKHQpO1xuICAgIGxldCByID0gWW4oKSwgbyA9IFFuKCk7XG4gICAgZm9yIChjb25zdCB0IG9mIG4pIHtcbiAgICAgICAgY29uc3QgbiA9IGUud2kodC5tZXRhZGF0YS5uYW1lKTtcbiAgICAgICAgdC5kb2N1bWVudCAmJiAociA9IHIuYWRkKG4pKTtcbiAgICAgICAgY29uc3QgcyA9IGUubWkodCk7XG4gICAgICAgIHMuc2V0UmVhZFRpbWUoZS5naSh0Lm1ldGFkYXRhLnJlYWRUaW1lKSksIG8gPSBvLmluc2VydChuLCBzKTtcbiAgICB9XG4gICAgY29uc3QgdSA9IGkuaGkubmV3Q2hhbmdlQnVmZmVyKHtcbiAgICAgICAgdHJhY2tSZW1vdmFsczogITBcbiAgICB9KSwgYSA9IGF3YWl0IGNvKGksIGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgLy8gSXQgaXMgT0sgdGhhdCB0aGUgcGF0aCB1c2VkIGZvciB0aGUgcXVlcnkgaXMgbm90IHZhbGlkLCBiZWNhdXNlIHRoaXMgd2lsbFxuICAgICAgICAvLyBub3QgYmUgcmVhZCBhbmQgcXVlcmllZC5cbiAgICAgICAgcmV0dXJuIEhlKEtlKF90LmZyb21TdHJpbmcoYF9fYnVuZGxlX18vZG9jcy8ke3R9YCkpKTtcbiAgICB9KHMpKTtcbiAgICAvLyBBbGxvY2F0ZXMgYSB0YXJnZXQgdG8gaG9sZCBhbGwgZG9jdW1lbnQga2V5cyBmcm9tIHRoZSBidW5kbGUsIHN1Y2ggdGhhdFxuICAgIC8vIHRoZXkgd2lsbCBub3QgZ2V0IGdhcmJhZ2UgY29sbGVjdGVkIHJpZ2h0IGF3YXkuXG4gICAgICAgIHJldHVybiBpLnBlcnNpc3RlbmNlLnJ1blRyYW5zYWN0aW9uKFwiQXBwbHkgYnVuZGxlIGRvY3VtZW50c1wiLCBcInJlYWR3cml0ZVwiLCAodCA9PiB1byh0LCB1LCBvKS5uZXh0KChlID0+ICh1LmFwcGx5KHQpLCBcbiAgICBlKSkpLm5leHQoKGUgPT4gaS5mcy5yZW1vdmVNYXRjaGluZ0tleXNGb3JUYXJnZXRJZCh0LCBhLnRhcmdldElkKS5uZXh0KCgoKSA9PiBpLmZzLmFkZE1hdGNoaW5nS2V5cyh0LCByLCBhLnRhcmdldElkKSkpLm5leHQoKCgpID0+IGkuZmkuR3ModCwgZSkpKS5uZXh0KCgoKSA9PiBlKSkpKSkpO1xufVxuXG4vKipcbiAqIFJldHVybnMgYSBwcm9taXNlIG9mIGEgYm9vbGVhbiB0byBpbmRpY2F0ZSBpZiB0aGUgZ2l2ZW4gYnVuZGxlIGhhcyBhbHJlYWR5XG4gKiBiZWVuIGxvYWRlZCBhbmQgdGhlIGNyZWF0ZSB0aW1lIGlzIG5ld2VyIHRoYW4gdGhlIGN1cnJlbnQgbG9hZGluZyBidW5kbGUuXG4gKi9cbi8qKlxuICogU2F2ZXMgdGhlIGdpdmVuIGBOYW1lZFF1ZXJ5YCB0byBsb2NhbCBwZXJzaXN0ZW5jZS5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gZ28odCwgZSwgbiA9IFluKCkpIHtcbiAgICAvLyBBbGxvY2F0ZSBhIHRhcmdldCBmb3IgdGhlIG5hbWVkIHF1ZXJ5IHN1Y2ggdGhhdCBpdCBjYW4gYmUgcmVzdW1lZFxuICAgIC8vIGZyb20gYXNzb2NpYXRlZCByZWFkIHRpbWUgaWYgdXNlcnMgdXNlIGl0IHRvIGxpc3Rlbi5cbiAgICAvLyBOT1RFOiB0aGlzIGFsc28gbWVhbnMgaWYgbm8gY29ycmVzcG9uZGluZyB0YXJnZXQgZXhpc3RzLCB0aGUgbmV3IHRhcmdldFxuICAgIC8vIHdpbGwgcmVtYWluIGFjdGl2ZSBhbmQgd2lsbCBub3QgZ2V0IGNvbGxlY3RlZCwgdW5sZXNzIHVzZXJzIGhhcHBlbiB0b1xuICAgIC8vIHVubGlzdGVuIHRoZSBxdWVyeSBzb21laG93LlxuICAgIGNvbnN0IHMgPSBhd2FpdCBjbyh0LCBIZShLaShlLmJ1bmRsZWRRdWVyeSkpKSwgaSA9IEsodCk7XG4gICAgcmV0dXJuIGkucGVyc2lzdGVuY2UucnVuVHJhbnNhY3Rpb24oXCJTYXZlIG5hbWVkIHF1ZXJ5XCIsIFwicmVhZHdyaXRlXCIsICh0ID0+IHtcbiAgICAgICAgY29uc3QgciA9IHdzKGUucmVhZFRpbWUpO1xuICAgICAgICAvLyBTaW1wbHkgc2F2ZSB0aGUgcXVlcnkgaXRzZWxmIGlmIGl0IGlzIG9sZGVyIHRoYW4gd2hhdCB0aGUgU0RLIGFscmVhZHlcbiAgICAgICAgLy8gaGFzLlxuICAgICAgICAgICAgICAgIGlmIChzLnNuYXBzaG90VmVyc2lvbi5jb21wYXJlVG8ocikgPj0gMCkgcmV0dXJuIGkuX3Muc2F2ZU5hbWVkUXVlcnkodCwgZSk7XG4gICAgICAgIC8vIFVwZGF0ZSBleGlzdGluZyB0YXJnZXQgZGF0YSBiZWNhdXNlIHRoZSBxdWVyeSBmcm9tIHRoZSBidW5kbGUgaXMgbmV3ZXIuXG4gICAgICAgICAgICAgICAgY29uc3QgbyA9IHMud2l0aFJlc3VtZVRva2VuKHB0LkVNUFRZX0JZVEVfU1RSSU5HLCByKTtcbiAgICAgICAgcmV0dXJuIGkudWkgPSBpLnVpLmluc2VydChvLnRhcmdldElkLCBvKSwgaS5mcy51cGRhdGVUYXJnZXREYXRhKHQsIG8pLm5leHQoKCgpID0+IGkuZnMucmVtb3ZlTWF0Y2hpbmdLZXlzRm9yVGFyZ2V0SWQodCwgcy50YXJnZXRJZCkpKS5uZXh0KCgoKSA9PiBpLmZzLmFkZE1hdGNoaW5nS2V5cyh0LCBuLCBzLnRhcmdldElkKSkpLm5leHQoKCgpID0+IGkuX3Muc2F2ZU5hbWVkUXVlcnkodCwgZSkpKTtcbiAgICB9KSk7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovIGNsYXNzIHlvIHtcbiAgICBjb25zdHJ1Y3Rvcih0KSB7XG4gICAgICAgIHRoaXMuTSA9IHQsIHRoaXMueWkgPSBuZXcgTWFwLCB0aGlzLnBpID0gbmV3IE1hcDtcbiAgICB9XG4gICAgZ2V0QnVuZGxlTWV0YWRhdGEodCwgZSkge1xuICAgICAgICByZXR1cm4geWkucmVzb2x2ZSh0aGlzLnlpLmdldChlKSk7XG4gICAgfVxuICAgIHNhdmVCdW5kbGVNZXRhZGF0YSh0LCBlKSB7XG4gICAgICAgIC8qKiBEZWNvZGVzIGEgQnVuZGxlTWV0YWRhdGEgcHJvdG8gaW50byBhIEJ1bmRsZU1ldGFkYXRhIG9iamVjdC4gKi9cbiAgICAgICAgdmFyIG47XG4gICAgICAgIHJldHVybiB0aGlzLnlpLnNldChlLmlkLCB7XG4gICAgICAgICAgICBpZDogKG4gPSBlKS5pZCxcbiAgICAgICAgICAgIHZlcnNpb246IG4udmVyc2lvbixcbiAgICAgICAgICAgIGNyZWF0ZVRpbWU6IHdzKG4uY3JlYXRlVGltZSlcbiAgICAgICAgfSksIHlpLnJlc29sdmUoKTtcbiAgICB9XG4gICAgZ2V0TmFtZWRRdWVyeSh0LCBlKSB7XG4gICAgICAgIHJldHVybiB5aS5yZXNvbHZlKHRoaXMucGkuZ2V0KGUpKTtcbiAgICB9XG4gICAgc2F2ZU5hbWVkUXVlcnkodCwgZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5waS5zZXQoZS5uYW1lLCBmdW5jdGlvbih0KSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIG5hbWU6IHQubmFtZSxcbiAgICAgICAgICAgICAgICBxdWVyeTogS2kodC5idW5kbGVkUXVlcnkpLFxuICAgICAgICAgICAgICAgIHJlYWRUaW1lOiB3cyh0LnJlYWRUaW1lKVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfShlKSksIHlpLnJlc29sdmUoKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIyIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEFuIGluLW1lbW9yeSBpbXBsZW1lbnRhdGlvbiBvZiBEb2N1bWVudE92ZXJsYXlDYWNoZS5cbiAqLyBjbGFzcyBwbyB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIC8vIEEgbWFwIHNvcnRlZCBieSBEb2N1bWVudEtleSwgd2hvc2UgdmFsdWUgaXMgYSBwYWlyIG9mIHRoZSBsYXJnZXN0IGJhdGNoIGlkXG4gICAgICAgIC8vIGZvciB0aGUgb3ZlcmxheSBhbmQgdGhlIG92ZXJsYXkgaXRzZWxmLlxuICAgICAgICB0aGlzLm92ZXJsYXlzID0gbmV3IGZlKHh0LmNvbXBhcmF0b3IpLCB0aGlzLklpID0gbmV3IE1hcDtcbiAgICB9XG4gICAgZ2V0T3ZlcmxheSh0LCBlKSB7XG4gICAgICAgIHJldHVybiB5aS5yZXNvbHZlKHRoaXMub3ZlcmxheXMuZ2V0KGUpKTtcbiAgICB9XG4gICAgc2F2ZU92ZXJsYXlzKHQsIGUsIG4pIHtcbiAgICAgICAgcmV0dXJuIG4uZm9yRWFjaCgoKG4sIHMpID0+IHtcbiAgICAgICAgICAgIHRoaXMuWHQodCwgZSwgcyk7XG4gICAgICAgIH0pKSwgeWkucmVzb2x2ZSgpO1xuICAgIH1cbiAgICByZW1vdmVPdmVybGF5c0ZvckJhdGNoSWQodCwgZSwgbikge1xuICAgICAgICBjb25zdCBzID0gdGhpcy5JaS5nZXQobik7XG4gICAgICAgIHJldHVybiB2b2lkIDAgIT09IHMgJiYgKHMuZm9yRWFjaCgodCA9PiB0aGlzLm92ZXJsYXlzID0gdGhpcy5vdmVybGF5cy5yZW1vdmUodCkpKSwgXG4gICAgICAgIHRoaXMuSWkuZGVsZXRlKG4pKSwgeWkucmVzb2x2ZSgpO1xuICAgIH1cbiAgICBnZXRPdmVybGF5c0ZvckNvbGxlY3Rpb24odCwgZSwgbikge1xuICAgICAgICBjb25zdCBzID0gem4oKSwgaSA9IGUubGVuZ3RoICsgMSwgciA9IG5ldyB4dChlLmNoaWxkKFwiXCIpKSwgbyA9IHRoaXMub3ZlcmxheXMuZ2V0SXRlcmF0b3JGcm9tKHIpO1xuICAgICAgICBmb3IgKDtvLmhhc05leHQoKTsgKSB7XG4gICAgICAgICAgICBjb25zdCB0ID0gby5nZXROZXh0KCkudmFsdWUsIHIgPSB0LmdldEtleSgpO1xuICAgICAgICAgICAgaWYgKCFlLmlzUHJlZml4T2Yoci5wYXRoKSkgYnJlYWs7XG4gICAgICAgICAgICAvLyBEb2N1bWVudHMgZnJvbSBzdWItY29sbGVjdGlvbnNcbiAgICAgICAgICAgICAgICAgICAgICAgIHIucGF0aC5sZW5ndGggPT09IGkgJiYgKHQubGFyZ2VzdEJhdGNoSWQgPiBuICYmIHMuc2V0KHQuZ2V0S2V5KCksIHQpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4geWkucmVzb2x2ZShzKTtcbiAgICB9XG4gICAgZ2V0T3ZlcmxheXNGb3JDb2xsZWN0aW9uR3JvdXAodCwgZSwgbiwgcykge1xuICAgICAgICBsZXQgaSA9IG5ldyBmZSgoKHQsIGUpID0+IHQgLSBlKSk7XG4gICAgICAgIGNvbnN0IHIgPSB0aGlzLm92ZXJsYXlzLmdldEl0ZXJhdG9yKCk7XG4gICAgICAgIGZvciAoO3IuaGFzTmV4dCgpOyApIHtcbiAgICAgICAgICAgIGNvbnN0IHQgPSByLmdldE5leHQoKS52YWx1ZTtcbiAgICAgICAgICAgIGlmICh0LmdldEtleSgpLmdldENvbGxlY3Rpb25Hcm91cCgpID09PSBlICYmIHQubGFyZ2VzdEJhdGNoSWQgPiBuKSB7XG4gICAgICAgICAgICAgICAgbGV0IGUgPSBpLmdldCh0Lmxhcmdlc3RCYXRjaElkKTtcbiAgICAgICAgICAgICAgICBudWxsID09PSBlICYmIChlID0gem4oKSwgaSA9IGkuaW5zZXJ0KHQubGFyZ2VzdEJhdGNoSWQsIGUpKSwgZS5zZXQodC5nZXRLZXkoKSwgdCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbyA9IHpuKCksIHUgPSBpLmdldEl0ZXJhdG9yKCk7XG4gICAgICAgIGZvciAoO3UuaGFzTmV4dCgpOyApIHtcbiAgICAgICAgICAgIGlmICh1LmdldE5leHQoKS52YWx1ZS5mb3JFYWNoKCgodCwgZSkgPT4gby5zZXQodCwgZSkpKSwgby5zaXplKCkgPj0gcykgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHlpLnJlc29sdmUobyk7XG4gICAgfVxuICAgIFh0KHQsIGUsIG4pIHtcbiAgICAgICAgaWYgKG51bGwgPT09IG4pIHJldHVybjtcbiAgICAgICAgLy8gUmVtb3ZlIHRoZSBhc3NvY2lhdGlvbiBvZiB0aGUgb3ZlcmxheSB0byBpdHMgYmF0Y2ggaWQuXG4gICAgICAgICAgICAgICAgY29uc3QgcyA9IHRoaXMub3ZlcmxheXMuZ2V0KG4ua2V5KTtcbiAgICAgICAgaWYgKG51bGwgIT09IHMpIHtcbiAgICAgICAgICAgIGNvbnN0IHQgPSB0aGlzLklpLmdldChzLmxhcmdlc3RCYXRjaElkKS5kZWxldGUobi5rZXkpO1xuICAgICAgICAgICAgdGhpcy5JaS5zZXQocy5sYXJnZXN0QmF0Y2hJZCwgdCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5vdmVybGF5cyA9IHRoaXMub3ZlcmxheXMuaW5zZXJ0KG4ua2V5LCBuZXcgeGkoZSwgbikpO1xuICAgICAgICAvLyBDcmVhdGUgdGhlIGFzc29jaWF0aW9uIG9mIHRoaXMgb3ZlcmxheSB0byB0aGUgZ2l2ZW4gbGFyZ2VzdEJhdGNoSWQuXG4gICAgICAgIGxldCBpID0gdGhpcy5JaS5nZXQoZSk7XG4gICAgICAgIHZvaWQgMCA9PT0gaSAmJiAoaSA9IFluKCksIHRoaXMuSWkuc2V0KGUsIGkpKSwgdGhpcy5JaS5zZXQoZSwgaS5hZGQobi5rZXkpKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEEgY29sbGVjdGlvbiBvZiByZWZlcmVuY2VzIHRvIGEgZG9jdW1lbnQgZnJvbSBzb21lIGtpbmQgb2YgbnVtYmVyZWQgZW50aXR5XG4gKiAoZWl0aGVyIGEgdGFyZ2V0IElEIG9yIGJhdGNoIElEKS4gQXMgcmVmZXJlbmNlcyBhcmUgYWRkZWQgdG8gb3IgcmVtb3ZlZCBmcm9tXG4gKiB0aGUgc2V0IGNvcnJlc3BvbmRpbmcgZXZlbnRzIGFyZSBlbWl0dGVkIHRvIGEgcmVnaXN0ZXJlZCBnYXJiYWdlIGNvbGxlY3Rvci5cbiAqXG4gKiBFYWNoIHJlZmVyZW5jZSBpcyByZXByZXNlbnRlZCBieSBhIERvY3VtZW50UmVmZXJlbmNlIG9iamVjdC4gRWFjaCBvZiB0aGVtXG4gKiBjb250YWlucyBlbm91Z2ggaW5mb3JtYXRpb24gdG8gdW5pcXVlbHkgaWRlbnRpZnkgdGhlIHJlZmVyZW5jZS4gVGhleSBhcmUgYWxsXG4gKiBzdG9yZWQgcHJpbWFyaWx5IGluIGEgc2V0IHNvcnRlZCBieSBrZXkuIEEgZG9jdW1lbnQgaXMgY29uc2lkZXJlZCBnYXJiYWdlIGlmXG4gKiB0aGVyZSdzIG5vIHJlZmVyZW5jZXMgaW4gdGhhdCBzZXQgKHRoaXMgY2FuIGJlIGVmZmljaWVudGx5IGNoZWNrZWQgdGhhbmtzIHRvXG4gKiBzb3J0aW5nIGJ5IGtleSkuXG4gKlxuICogUmVmZXJlbmNlU2V0IGFsc28ga2VlcHMgYSBzZWNvbmRhcnkgc2V0IHRoYXQgY29udGFpbnMgcmVmZXJlbmNlcyBzb3J0ZWQgYnlcbiAqIElEcy4gVGhpcyBvbmUgaXMgdXNlZCB0byBlZmZpY2llbnRseSBpbXBsZW1lbnQgcmVtb3ZhbCBvZiBhbGwgcmVmZXJlbmNlcyBieVxuICogc29tZSB0YXJnZXQgSUQuXG4gKi8gY2xhc3MgSW8ge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICAvLyBBIHNldCBvZiBvdXRzdGFuZGluZyByZWZlcmVuY2VzIHRvIGEgZG9jdW1lbnQgc29ydGVkIGJ5IGtleS5cbiAgICAgICAgdGhpcy5UaSA9IG5ldyB3ZShUby5FaSksIFxuICAgICAgICAvLyBBIHNldCBvZiBvdXRzdGFuZGluZyByZWZlcmVuY2VzIHRvIGEgZG9jdW1lbnQgc29ydGVkIGJ5IHRhcmdldCBpZC5cbiAgICAgICAgdGhpcy5BaSA9IG5ldyB3ZShUby5SaSk7XG4gICAgfVxuICAgIC8qKiBSZXR1cm5zIHRydWUgaWYgdGhlIHJlZmVyZW5jZSBzZXQgY29udGFpbnMgbm8gcmVmZXJlbmNlcy4gKi8gICAgaXNFbXB0eSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuVGkuaXNFbXB0eSgpO1xuICAgIH1cbiAgICAvKiogQWRkcyBhIHJlZmVyZW5jZSB0byB0aGUgZ2l2ZW4gZG9jdW1lbnQga2V5IGZvciB0aGUgZ2l2ZW4gSUQuICovICAgIGFkZFJlZmVyZW5jZSh0LCBlKSB7XG4gICAgICAgIGNvbnN0IG4gPSBuZXcgVG8odCwgZSk7XG4gICAgICAgIHRoaXMuVGkgPSB0aGlzLlRpLmFkZChuKSwgdGhpcy5BaSA9IHRoaXMuQWkuYWRkKG4pO1xuICAgIH1cbiAgICAvKiogQWRkIHJlZmVyZW5jZXMgdG8gdGhlIGdpdmVuIGRvY3VtZW50IGtleXMgZm9yIHRoZSBnaXZlbiBJRC4gKi8gICAgYmkodCwgZSkge1xuICAgICAgICB0LmZvckVhY2goKHQgPT4gdGhpcy5hZGRSZWZlcmVuY2UodCwgZSkpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmVtb3ZlcyBhIHJlZmVyZW5jZSB0byB0aGUgZ2l2ZW4gZG9jdW1lbnQga2V5IGZvciB0aGUgZ2l2ZW5cbiAgICAgKiBJRC5cbiAgICAgKi8gICAgcmVtb3ZlUmVmZXJlbmNlKHQsIGUpIHtcbiAgICAgICAgdGhpcy5QaShuZXcgVG8odCwgZSkpO1xuICAgIH1cbiAgICBWaSh0LCBlKSB7XG4gICAgICAgIHQuZm9yRWFjaCgodCA9PiB0aGlzLnJlbW92ZVJlZmVyZW5jZSh0LCBlKSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDbGVhcnMgYWxsIHJlZmVyZW5jZXMgd2l0aCBhIGdpdmVuIElELiBDYWxscyByZW1vdmVSZWYoKSBmb3IgZWFjaCBrZXlcbiAgICAgKiByZW1vdmVkLlxuICAgICAqLyAgICB2aSh0KSB7XG4gICAgICAgIGNvbnN0IGUgPSBuZXcgeHQobmV3IF90KFtdKSksIG4gPSBuZXcgVG8oZSwgdCksIHMgPSBuZXcgVG8oZSwgdCArIDEpLCBpID0gW107XG4gICAgICAgIHJldHVybiB0aGlzLkFpLmZvckVhY2hJblJhbmdlKFsgbiwgcyBdLCAodCA9PiB7XG4gICAgICAgICAgICB0aGlzLlBpKHQpLCBpLnB1c2godC5rZXkpO1xuICAgICAgICB9KSksIGk7XG4gICAgfVxuICAgIFNpKCkge1xuICAgICAgICB0aGlzLlRpLmZvckVhY2goKHQgPT4gdGhpcy5QaSh0KSkpO1xuICAgIH1cbiAgICBQaSh0KSB7XG4gICAgICAgIHRoaXMuVGkgPSB0aGlzLlRpLmRlbGV0ZSh0KSwgdGhpcy5BaSA9IHRoaXMuQWkuZGVsZXRlKHQpO1xuICAgIH1cbiAgICBEaSh0KSB7XG4gICAgICAgIGNvbnN0IGUgPSBuZXcgeHQobmV3IF90KFtdKSksIG4gPSBuZXcgVG8oZSwgdCksIHMgPSBuZXcgVG8oZSwgdCArIDEpO1xuICAgICAgICBsZXQgaSA9IFluKCk7XG4gICAgICAgIHJldHVybiB0aGlzLkFpLmZvckVhY2hJblJhbmdlKFsgbiwgcyBdLCAodCA9PiB7XG4gICAgICAgICAgICBpID0gaS5hZGQodC5rZXkpO1xuICAgICAgICB9KSksIGk7XG4gICAgfVxuICAgIGNvbnRhaW5zS2V5KHQpIHtcbiAgICAgICAgY29uc3QgZSA9IG5ldyBUbyh0LCAwKSwgbiA9IHRoaXMuVGkuZmlyc3RBZnRlck9yRXF1YWwoZSk7XG4gICAgICAgIHJldHVybiBudWxsICE9PSBuICYmIHQuaXNFcXVhbChuLmtleSk7XG4gICAgfVxufVxuXG5jbGFzcyBUbyB7XG4gICAgY29uc3RydWN0b3IodCwgZSkge1xuICAgICAgICB0aGlzLmtleSA9IHQsIHRoaXMuQ2kgPSBlO1xuICAgIH1cbiAgICAvKiogQ29tcGFyZSBieSBrZXkgdGhlbiBieSBJRCAqLyAgICBzdGF0aWMgRWkodCwgZSkge1xuICAgICAgICByZXR1cm4geHQuY29tcGFyYXRvcih0LmtleSwgZS5rZXkpIHx8IHJ0KHQuQ2ksIGUuQ2kpO1xuICAgIH1cbiAgICAvKiogQ29tcGFyZSBieSBJRCB0aGVuIGJ5IGtleSAqLyAgICBzdGF0aWMgUmkodCwgZSkge1xuICAgICAgICByZXR1cm4gcnQodC5DaSwgZS5DaSkgfHwgeHQuY29tcGFyYXRvcih0LmtleSwgZS5rZXkpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi8gY2xhc3MgRW8ge1xuICAgIGNvbnN0cnVjdG9yKHQsIGUpIHtcbiAgICAgICAgdGhpcy5pbmRleE1hbmFnZXIgPSB0LCB0aGlzLnJlZmVyZW5jZURlbGVnYXRlID0gZSwgXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgc2V0IG9mIGFsbCBtdXRhdGlvbnMgdGhhdCBoYXZlIGJlZW4gc2VudCBidXQgbm90IHlldCBiZWVuIGFwcGxpZWQgdG9cbiAgICAgICAgICogdGhlIGJhY2tlbmQuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLkJzID0gW10sIFxuICAgICAgICAvKiogTmV4dCB2YWx1ZSB0byB1c2Ugd2hlbiBhc3NpZ25pbmcgc2VxdWVudGlhbCBJRHMgdG8gZWFjaCBtdXRhdGlvbiBiYXRjaC4gKi9cbiAgICAgICAgdGhpcy54aSA9IDEsIFxuICAgICAgICAvKiogQW4gb3JkZXJlZCBtYXBwaW5nIGJldHdlZW4gZG9jdW1lbnRzIGFuZCB0aGUgbXV0YXRpb25zIGJhdGNoIElEcy4gKi9cbiAgICAgICAgdGhpcy5OaSA9IG5ldyB3ZShUby5FaSk7XG4gICAgfVxuICAgIGNoZWNrRW1wdHkodCkge1xuICAgICAgICByZXR1cm4geWkucmVzb2x2ZSgwID09PSB0aGlzLkJzLmxlbmd0aCk7XG4gICAgfVxuICAgIGFkZE11dGF0aW9uQmF0Y2godCwgZSwgbiwgcykge1xuICAgICAgICBjb25zdCBpID0gdGhpcy54aTtcbiAgICAgICAgdGhpcy54aSsrLCB0aGlzLkJzLmxlbmd0aCA+IDAgJiYgdGhpcy5Cc1t0aGlzLkJzLmxlbmd0aCAtIDFdO1xuICAgICAgICBjb25zdCByID0gbmV3IERpKGksIGUsIG4sIHMpO1xuICAgICAgICB0aGlzLkJzLnB1c2gocik7XG4gICAgICAgIC8vIFRyYWNrIHJlZmVyZW5jZXMgYnkgZG9jdW1lbnQga2V5IGFuZCBpbmRleCBjb2xsZWN0aW9uIHBhcmVudHMuXG4gICAgICAgIGZvciAoY29uc3QgZSBvZiBzKSB0aGlzLk5pID0gdGhpcy5OaS5hZGQobmV3IFRvKGUua2V5LCBpKSksIHRoaXMuaW5kZXhNYW5hZ2VyLmFkZFRvQ29sbGVjdGlvblBhcmVudEluZGV4KHQsIGUua2V5LnBhdGgucG9wTGFzdCgpKTtcbiAgICAgICAgcmV0dXJuIHlpLnJlc29sdmUocik7XG4gICAgfVxuICAgIGxvb2t1cE11dGF0aW9uQmF0Y2godCwgZSkge1xuICAgICAgICByZXR1cm4geWkucmVzb2x2ZSh0aGlzLmtpKGUpKTtcbiAgICB9XG4gICAgZ2V0TmV4dE11dGF0aW9uQmF0Y2hBZnRlckJhdGNoSWQodCwgZSkge1xuICAgICAgICBjb25zdCBuID0gZSArIDEsIHMgPSB0aGlzLk1pKG4pLCBpID0gcyA8IDAgPyAwIDogcztcbiAgICAgICAgLy8gVGhlIHJlcXVlc3RlZCBiYXRjaElkIG1heSBzdGlsbCBiZSBvdXQgb2YgcmFuZ2Ugc28gbm9ybWFsaXplIGl0IHRvIHRoZVxuICAgICAgICAvLyBzdGFydCBvZiB0aGUgcXVldWUuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHlpLnJlc29sdmUodGhpcy5Ccy5sZW5ndGggPiBpID8gdGhpcy5Cc1tpXSA6IG51bGwpO1xuICAgIH1cbiAgICBnZXRIaWdoZXN0VW5hY2tub3dsZWRnZWRCYXRjaElkKCkge1xuICAgICAgICByZXR1cm4geWkucmVzb2x2ZSgwID09PSB0aGlzLkJzLmxlbmd0aCA/IC0xIDogdGhpcy54aSAtIDEpO1xuICAgIH1cbiAgICBnZXRBbGxNdXRhdGlvbkJhdGNoZXModCkge1xuICAgICAgICByZXR1cm4geWkucmVzb2x2ZSh0aGlzLkJzLnNsaWNlKCkpO1xuICAgIH1cbiAgICBnZXRBbGxNdXRhdGlvbkJhdGNoZXNBZmZlY3RpbmdEb2N1bWVudEtleSh0LCBlKSB7XG4gICAgICAgIGNvbnN0IG4gPSBuZXcgVG8oZSwgMCksIHMgPSBuZXcgVG8oZSwgTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZKSwgaSA9IFtdO1xuICAgICAgICByZXR1cm4gdGhpcy5OaS5mb3JFYWNoSW5SYW5nZShbIG4sIHMgXSwgKHQgPT4ge1xuICAgICAgICAgICAgY29uc3QgZSA9IHRoaXMua2kodC5DaSk7XG4gICAgICAgICAgICBpLnB1c2goZSk7XG4gICAgICAgIH0pKSwgeWkucmVzb2x2ZShpKTtcbiAgICB9XG4gICAgZ2V0QWxsTXV0YXRpb25CYXRjaGVzQWZmZWN0aW5nRG9jdW1lbnRLZXlzKHQsIGUpIHtcbiAgICAgICAgbGV0IG4gPSBuZXcgd2UocnQpO1xuICAgICAgICByZXR1cm4gZS5mb3JFYWNoKCh0ID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGUgPSBuZXcgVG8odCwgMCksIHMgPSBuZXcgVG8odCwgTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZKTtcbiAgICAgICAgICAgIHRoaXMuTmkuZm9yRWFjaEluUmFuZ2UoWyBlLCBzIF0sICh0ID0+IHtcbiAgICAgICAgICAgICAgICBuID0gbi5hZGQodC5DaSk7XG4gICAgICAgICAgICB9KSk7XG4gICAgICAgIH0pKSwgeWkucmVzb2x2ZSh0aGlzLk9pKG4pKTtcbiAgICB9XG4gICAgZ2V0QWxsTXV0YXRpb25CYXRjaGVzQWZmZWN0aW5nUXVlcnkodCwgZSkge1xuICAgICAgICAvLyBVc2UgdGhlIHF1ZXJ5IHBhdGggYXMgYSBwcmVmaXggZm9yIHRlc3RpbmcgaWYgYSBkb2N1bWVudCBtYXRjaGVzIHRoZVxuICAgICAgICAvLyBxdWVyeS5cbiAgICAgICAgY29uc3QgbiA9IGUucGF0aCwgcyA9IG4ubGVuZ3RoICsgMTtcbiAgICAgICAgLy8gQ29uc3RydWN0IGEgZG9jdW1lbnQgcmVmZXJlbmNlIGZvciBhY3R1YWxseSBzY2FubmluZyB0aGUgaW5kZXguIFVubGlrZVxuICAgICAgICAvLyB0aGUgcHJlZml4IHRoZSBkb2N1bWVudCBrZXkgaW4gdGhpcyByZWZlcmVuY2UgbXVzdCBoYXZlIGFuIGV2ZW4gbnVtYmVyIG9mXG4gICAgICAgIC8vIHNlZ21lbnRzLiBUaGUgZW1wdHkgc2VnbWVudCBjYW4gYmUgdXNlZCBhIHN1ZmZpeCBvZiB0aGUgcXVlcnkgcGF0aFxuICAgICAgICAvLyBiZWNhdXNlIGl0IHByZWNlZGVzIGFsbCBvdGhlciBzZWdtZW50cyBpbiBhbiBvcmRlcmVkIHRyYXZlcnNhbC5cbiAgICAgICAgbGV0IGkgPSBuO1xuICAgICAgICB4dC5pc0RvY3VtZW50S2V5KGkpIHx8IChpID0gaS5jaGlsZChcIlwiKSk7XG4gICAgICAgIGNvbnN0IHIgPSBuZXcgVG8obmV3IHh0KGkpLCAwKTtcbiAgICAgICAgLy8gRmluZCB1bmlxdWUgYmF0Y2hJRHMgcmVmZXJlbmNlZCBieSBhbGwgZG9jdW1lbnRzIHBvdGVudGlhbGx5IG1hdGNoaW5nIHRoZVxuICAgICAgICAvLyBxdWVyeS5cbiAgICAgICAgICAgICAgICBsZXQgbyA9IG5ldyB3ZShydCk7XG4gICAgICAgIHJldHVybiB0aGlzLk5pLmZvckVhY2hXaGlsZSgodCA9PiB7XG4gICAgICAgICAgICBjb25zdCBlID0gdC5rZXkucGF0aDtcbiAgICAgICAgICAgIHJldHVybiAhIW4uaXNQcmVmaXhPZihlKSAmJiAoXG4gICAgICAgICAgICAvLyBSb3dzIHdpdGggZG9jdW1lbnQga2V5cyBtb3JlIHRoYW4gb25lIHNlZ21lbnQgbG9uZ2VyIHRoYW4gdGhlIHF1ZXJ5XG4gICAgICAgICAgICAvLyBwYXRoIGNhbid0IGJlIG1hdGNoZXMuIEZvciBleGFtcGxlLCBhIHF1ZXJ5IG9uICdyb29tcycgY2FuJ3QgbWF0Y2hcbiAgICAgICAgICAgIC8vIHRoZSBkb2N1bWVudCAvcm9vbXMvYWJjL21lc3NhZ2VzL3h5eC5cbiAgICAgICAgICAgIC8vIFRPRE8obWNnKTogd2UnbGwgbmVlZCBhIGRpZmZlcmVudCBzY2FubmVyIHdoZW4gd2UgaW1wbGVtZW50XG4gICAgICAgICAgICAvLyBhbmNlc3RvciBxdWVyaWVzLlxuICAgICAgICAgICAgZS5sZW5ndGggPT09IHMgJiYgKG8gPSBvLmFkZCh0LkNpKSksICEwKTtcbiAgICAgICAgfSksIHIpLCB5aS5yZXNvbHZlKHRoaXMuT2kobykpO1xuICAgIH1cbiAgICBPaSh0KSB7XG4gICAgICAgIC8vIENvbnN0cnVjdCBhbiBhcnJheSBvZiBtYXRjaGluZyBiYXRjaGVzLCBzb3J0ZWQgYnkgYmF0Y2hJRCB0byBlbnN1cmUgdGhhdFxuICAgICAgICAvLyBtdWx0aXBsZSBtdXRhdGlvbnMgYWZmZWN0aW5nIHRoZSBzYW1lIGRvY3VtZW50IGtleSBhcmUgYXBwbGllZCBpbiBvcmRlci5cbiAgICAgICAgY29uc3QgZSA9IFtdO1xuICAgICAgICByZXR1cm4gdC5mb3JFYWNoKCh0ID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSB0aGlzLmtpKHQpO1xuICAgICAgICAgICAgbnVsbCAhPT0gbiAmJiBlLnB1c2gobik7XG4gICAgICAgIH0pKSwgZTtcbiAgICB9XG4gICAgcmVtb3ZlTXV0YXRpb25CYXRjaCh0LCBlKSB7XG4gICAgICAgIFUoMCA9PT0gdGhpcy5GaShlLmJhdGNoSWQsIFwicmVtb3ZlZFwiKSksIHRoaXMuQnMuc2hpZnQoKTtcbiAgICAgICAgbGV0IG4gPSB0aGlzLk5pO1xuICAgICAgICByZXR1cm4geWkuZm9yRWFjaChlLm11dGF0aW9ucywgKHMgPT4ge1xuICAgICAgICAgICAgY29uc3QgaSA9IG5ldyBUbyhzLmtleSwgZS5iYXRjaElkKTtcbiAgICAgICAgICAgIHJldHVybiBuID0gbi5kZWxldGUoaSksIHRoaXMucmVmZXJlbmNlRGVsZWdhdGUubWFya1BvdGVudGlhbGx5T3JwaGFuZWQodCwgcy5rZXkpO1xuICAgICAgICB9KSkubmV4dCgoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5OaSA9IG47XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgX24odCkge1xuICAgICAgICAvLyBOby1vcCBzaW5jZSB0aGUgbWVtb3J5IG11dGF0aW9uIHF1ZXVlIGRvZXMgbm90IG1haW50YWluIGEgc2VwYXJhdGUgY2FjaGUuXG4gICAgfVxuICAgIGNvbnRhaW5zS2V5KHQsIGUpIHtcbiAgICAgICAgY29uc3QgbiA9IG5ldyBUbyhlLCAwKSwgcyA9IHRoaXMuTmkuZmlyc3RBZnRlck9yRXF1YWwobik7XG4gICAgICAgIHJldHVybiB5aS5yZXNvbHZlKGUuaXNFcXVhbChzICYmIHMua2V5KSk7XG4gICAgfVxuICAgIHBlcmZvcm1Db25zaXN0ZW5jeUNoZWNrKHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuQnMubGVuZ3RoLCB5aS5yZXNvbHZlKCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEZpbmRzIHRoZSBpbmRleCBvZiB0aGUgZ2l2ZW4gYmF0Y2hJZCBpbiB0aGUgbXV0YXRpb24gcXVldWUgYW5kIGFzc2VydHMgdGhhdFxuICAgICAqIHRoZSByZXN1bHRpbmcgaW5kZXggaXMgd2l0aGluIHRoZSBib3VuZHMgb2YgdGhlIHF1ZXVlLlxuICAgICAqXG4gICAgICogQHBhcmFtIGJhdGNoSWQgLSBUaGUgYmF0Y2hJZCB0byBzZWFyY2ggZm9yXG4gICAgICogQHBhcmFtIGFjdGlvbiAtIEEgZGVzY3JpcHRpb24gb2Ygd2hhdCB0aGUgY2FsbGVyIGlzIGRvaW5nLCBwaHJhc2VkIGluIHBhc3NpdmVcbiAgICAgKiBmb3JtIChlLmcuIFwiYWNrbm93bGVkZ2VkXCIgaW4gYSByb3V0aW5lIHRoYXQgYWNrbm93bGVkZ2VzIGJhdGNoZXMpLlxuICAgICAqLyAgICBGaSh0LCBlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLk1pKHQpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBGaW5kcyB0aGUgaW5kZXggb2YgdGhlIGdpdmVuIGJhdGNoSWQgaW4gdGhlIG11dGF0aW9uIHF1ZXVlLiBUaGlzIG9wZXJhdGlvblxuICAgICAqIGlzIE8oMSkuXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyBUaGUgY29tcHV0ZWQgaW5kZXggb2YgdGhlIGJhdGNoIHdpdGggdGhlIGdpdmVuIGJhdGNoSWQsIGJhc2VkIG9uXG4gICAgICogdGhlIHN0YXRlIG9mIHRoZSBxdWV1ZS4gTm90ZSB0aGlzIGluZGV4IGNhbiBiZSBuZWdhdGl2ZSBpZiB0aGUgcmVxdWVzdGVkXG4gICAgICogYmF0Y2hJZCBoYXMgYWxyZWFkeSBiZWVuIHJlbXZvZWQgZnJvbSB0aGUgcXVldWUgb3IgcGFzdCB0aGUgZW5kIG9mIHRoZVxuICAgICAqIHF1ZXVlIGlmIHRoZSBiYXRjaElkIGlzIGxhcmdlciB0aGFuIHRoZSBsYXN0IGFkZGVkIGJhdGNoLlxuICAgICAqLyAgICBNaSh0KSB7XG4gICAgICAgIGlmICgwID09PSB0aGlzLkJzLmxlbmd0aCkgXG4gICAgICAgIC8vIEFzIGFuIGluZGV4IHRoaXMgaXMgcGFzdCB0aGUgZW5kIG9mIHRoZSBxdWV1ZVxuICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgLy8gRXhhbWluZSB0aGUgZnJvbnQgb2YgdGhlIHF1ZXVlIHRvIGZpZ3VyZSBvdXQgdGhlIGRpZmZlcmVuY2UgYmV0d2VlbiB0aGVcbiAgICAgICAgLy8gYmF0Y2hJZCBhbmQgaW5kZXhlcyBpbiB0aGUgYXJyYXkuIE5vdGUgdGhhdCBzaW5jZSB0aGUgcXVldWUgaXMgb3JkZXJlZFxuICAgICAgICAvLyBieSBiYXRjaElkLCBpZiB0aGUgZmlyc3QgYmF0Y2ggaGFzIGEgbGFyZ2VyIGJhdGNoSWQgdGhlbiB0aGUgcmVxdWVzdGVkXG4gICAgICAgIC8vIGJhdGNoSWQgZG9lc24ndCBleGlzdCBpbiB0aGUgcXVldWUuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHQgLSB0aGlzLkJzWzBdLmJhdGNoSWQ7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEEgdmVyc2lvbiBvZiBsb29rdXBNdXRhdGlvbkJhdGNoIHRoYXQgZG9lc24ndCByZXR1cm4gYSBwcm9taXNlLCB0aGlzIG1ha2VzXG4gICAgICogb3RoZXIgZnVuY3Rpb25zIHRoYXQgdXNlcyB0aGlzIGNvZGUgZWFzaWVyIHRvIHJlYWQgYW5kIG1vcmUgZWZmaWNlbnQuXG4gICAgICovICAgIGtpKHQpIHtcbiAgICAgICAgY29uc3QgZSA9IHRoaXMuTWkodCk7XG4gICAgICAgIGlmIChlIDwgMCB8fCBlID49IHRoaXMuQnMubGVuZ3RoKSByZXR1cm4gbnVsbDtcbiAgICAgICAgcmV0dXJuIHRoaXMuQnNbZV07XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBUaGUgbWVtb3J5LW9ubHkgUmVtb3RlRG9jdW1lbnRDYWNoZSBmb3IgSW5kZXhlZERiLiBUbyBjb25zdHJ1Y3QsIGludm9rZVxuICogYG5ld01lbW9yeVJlbW90ZURvY3VtZW50Q2FjaGUoKWAuXG4gKi9cbmNsYXNzIEFvIHtcbiAgICAvKipcbiAgICAgKiBAcGFyYW0gc2l6ZXIgLSBVc2VkIHRvIGFzc2VzcyB0aGUgc2l6ZSBvZiBhIGRvY3VtZW50LiBGb3IgZWFnZXIgR0MsIHRoaXMgaXNcbiAgICAgKiBleHBlY3RlZCB0byBqdXN0IHJldHVybiAwIHRvIGF2b2lkIHVubmVjZXNzYXJpbHkgZG9pbmcgdGhlIHdvcmsgb2ZcbiAgICAgKiBjYWxjdWxhdGluZyB0aGUgc2l6ZS5cbiAgICAgKi9cbiAgICBjb25zdHJ1Y3Rvcih0KSB7XG4gICAgICAgIHRoaXMuJGkgPSB0LCBcbiAgICAgICAgLyoqIFVuZGVybHlpbmcgY2FjaGUgb2YgZG9jdW1lbnRzIGFuZCB0aGVpciByZWFkIHRpbWVzLiAqL1xuICAgICAgICB0aGlzLmRvY3MgPSBuZXcgZmUoeHQuY29tcGFyYXRvciksIFxuICAgICAgICAvKiogU2l6ZSBvZiBhbGwgY2FjaGVkIGRvY3VtZW50cy4gKi9cbiAgICAgICAgdGhpcy5zaXplID0gMDtcbiAgICB9XG4gICAgc2V0SW5kZXhNYW5hZ2VyKHQpIHtcbiAgICAgICAgdGhpcy5pbmRleE1hbmFnZXIgPSB0O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBBZGRzIHRoZSBzdXBwbGllZCBlbnRyeSB0byB0aGUgY2FjaGUgYW5kIHVwZGF0ZXMgdGhlIGNhY2hlIHNpemUgYXMgYXBwcm9wcmlhdGUuXG4gICAgICpcbiAgICAgKiBBbGwgY2FsbHMgb2YgYGFkZEVudHJ5YCAgYXJlIHJlcXVpcmVkIHRvIGdvIHRocm91Z2ggdGhlIFJlbW90ZURvY3VtZW50Q2hhbmdlQnVmZmVyXG4gICAgICogcmV0dXJuZWQgYnkgYG5ld0NoYW5nZUJ1ZmZlcigpYC5cbiAgICAgKi8gICAgYWRkRW50cnkodCwgZSkge1xuICAgICAgICBjb25zdCBuID0gZS5rZXksIHMgPSB0aGlzLmRvY3MuZ2V0KG4pLCBpID0gcyA/IHMuc2l6ZSA6IDAsIHIgPSB0aGlzLiRpKGUpO1xuICAgICAgICByZXR1cm4gdGhpcy5kb2NzID0gdGhpcy5kb2NzLmluc2VydChuLCB7XG4gICAgICAgICAgICBkb2N1bWVudDogZS5tdXRhYmxlQ29weSgpLFxuICAgICAgICAgICAgc2l6ZTogclxuICAgICAgICB9KSwgdGhpcy5zaXplICs9IHIgLSBpLCB0aGlzLmluZGV4TWFuYWdlci5hZGRUb0NvbGxlY3Rpb25QYXJlbnRJbmRleCh0LCBuLnBhdGgucG9wTGFzdCgpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmVtb3ZlcyB0aGUgc3BlY2lmaWVkIGVudHJ5IGZyb20gdGhlIGNhY2hlIGFuZCB1cGRhdGVzIHRoZSBjYWNoZSBzaXplIGFzIGFwcHJvcHJpYXRlLlxuICAgICAqXG4gICAgICogQWxsIGNhbGxzIG9mIGByZW1vdmVFbnRyeWAgYXJlIHJlcXVpcmVkIHRvIGdvIHRocm91Z2ggdGhlIFJlbW90ZURvY3VtZW50Q2hhbmdlQnVmZmVyXG4gICAgICogcmV0dXJuZWQgYnkgYG5ld0NoYW5nZUJ1ZmZlcigpYC5cbiAgICAgKi8gICAgcmVtb3ZlRW50cnkodCkge1xuICAgICAgICBjb25zdCBlID0gdGhpcy5kb2NzLmdldCh0KTtcbiAgICAgICAgZSAmJiAodGhpcy5kb2NzID0gdGhpcy5kb2NzLnJlbW92ZSh0KSwgdGhpcy5zaXplIC09IGUuc2l6ZSk7XG4gICAgfVxuICAgIGdldEVudHJ5KHQsIGUpIHtcbiAgICAgICAgY29uc3QgbiA9IHRoaXMuZG9jcy5nZXQoZSk7XG4gICAgICAgIHJldHVybiB5aS5yZXNvbHZlKG4gPyBuLmRvY3VtZW50Lm11dGFibGVDb3B5KCkgOiBuZS5uZXdJbnZhbGlkRG9jdW1lbnQoZSkpO1xuICAgIH1cbiAgICBnZXRFbnRyaWVzKHQsIGUpIHtcbiAgICAgICAgbGV0IG4gPSBRbigpO1xuICAgICAgICByZXR1cm4gZS5mb3JFYWNoKCh0ID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGUgPSB0aGlzLmRvY3MuZ2V0KHQpO1xuICAgICAgICAgICAgbiA9IG4uaW5zZXJ0KHQsIGUgPyBlLmRvY3VtZW50Lm11dGFibGVDb3B5KCkgOiBuZS5uZXdJbnZhbGlkRG9jdW1lbnQodCkpO1xuICAgICAgICB9KSksIHlpLnJlc29sdmUobik7XG4gICAgfVxuICAgIGdldEFsbEZyb21Db2xsZWN0aW9uKHQsIGUsIG4pIHtcbiAgICAgICAgbGV0IHMgPSBRbigpO1xuICAgICAgICAvLyBEb2N1bWVudHMgYXJlIG9yZGVyZWQgYnkga2V5LCBzbyB3ZSBjYW4gdXNlIGEgcHJlZml4IHNjYW4gdG8gbmFycm93IGRvd25cbiAgICAgICAgLy8gdGhlIGRvY3VtZW50cyB3ZSBuZWVkIHRvIG1hdGNoIHRoZSBxdWVyeSBhZ2FpbnN0LlxuICAgICAgICAgICAgICAgIGNvbnN0IGkgPSBuZXcgeHQoZS5jaGlsZChcIlwiKSksIHIgPSB0aGlzLmRvY3MuZ2V0SXRlcmF0b3JGcm9tKGkpO1xuICAgICAgICBmb3IgKDtyLmhhc05leHQoKTsgKSB7XG4gICAgICAgICAgICBjb25zdCB7a2V5OiB0LCB2YWx1ZToge2RvY3VtZW50OiBpfX0gPSByLmdldE5leHQoKTtcbiAgICAgICAgICAgIGlmICghZS5pc1ByZWZpeE9mKHQucGF0aCkpIGJyZWFrO1xuICAgICAgICAgICAgdC5wYXRoLmxlbmd0aCA+IGUubGVuZ3RoICsgMSB8fCAobGUoY2UoaSksIG4pIDw9IDAgfHwgKHMgPSBzLmluc2VydChpLmtleSwgaS5tdXRhYmxlQ29weSgpKSkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB5aS5yZXNvbHZlKHMpO1xuICAgIH1cbiAgICBnZXRBbGxGcm9tQ29sbGVjdGlvbkdyb3VwKHQsIGUsIG4sIHMpIHtcbiAgICAgICAgLy8gVGhpcyBtZXRob2Qgc2hvdWxkIG9ubHkgYmUgY2FsbGVkIGZyb20gdGhlIEluZGV4QmFja2ZpbGxlciBpZiBwZXJzaXN0ZW5jZVxuICAgICAgICAvLyBpcyBlbmFibGVkLlxuICAgICAgICBMKCk7XG4gICAgfVxuICAgIEJpKHQsIGUpIHtcbiAgICAgICAgcmV0dXJuIHlpLmZvckVhY2godGhpcy5kb2NzLCAodCA9PiBlKHQpKSk7XG4gICAgfVxuICAgIG5ld0NoYW5nZUJ1ZmZlcih0KSB7XG4gICAgICAgIC8vIGB0cmFja1JlbW92YWxzYCBpcyBpZ25vcmVzIHNpbmNlIHRoZSBNZW1vcnlSZW1vdGVEb2N1bWVudENhY2hlIGtlZXBzXG4gICAgICAgIC8vIGEgc2VwYXJhdGUgY2hhbmdlbG9nIGFuZCBkb2VzIG5vdCBuZWVkIHNwZWNpYWwgaGFuZGxpbmcgZm9yIHJlbW92YWxzLlxuICAgICAgICByZXR1cm4gbmV3IFJvKHRoaXMpO1xuICAgIH1cbiAgICBnZXRTaXplKHQpIHtcbiAgICAgICAgcmV0dXJuIHlpLnJlc29sdmUodGhpcy5zaXplKTtcbiAgICB9XG59XG5cbi8qKlxuICogQ3JlYXRlcyBhIG5ldyBtZW1vcnktb25seSBSZW1vdGVEb2N1bWVudENhY2hlLlxuICpcbiAqIEBwYXJhbSBzaXplciAtIFVzZWQgdG8gYXNzZXNzIHRoZSBzaXplIG9mIGEgZG9jdW1lbnQuIEZvciBlYWdlciBHQywgdGhpcyBpc1xuICogZXhwZWN0ZWQgdG8ganVzdCByZXR1cm4gMCB0byBhdm9pZCB1bm5lY2Vzc2FyaWx5IGRvaW5nIHRoZSB3b3JrIG9mXG4gKiBjYWxjdWxhdGluZyB0aGUgc2l6ZS5cbiAqL1xuLyoqXG4gKiBIYW5kbGVzIHRoZSBkZXRhaWxzIG9mIGFkZGluZyBhbmQgdXBkYXRpbmcgZG9jdW1lbnRzIGluIHRoZSBNZW1vcnlSZW1vdGVEb2N1bWVudENhY2hlLlxuICovXG5jbGFzcyBSbyBleHRlbmRzIEZyIHtcbiAgICBjb25zdHJ1Y3Rvcih0KSB7XG4gICAgICAgIHN1cGVyKCksIHRoaXMuS24gPSB0O1xuICAgIH1cbiAgICBhcHBseUNoYW5nZXModCkge1xuICAgICAgICBjb25zdCBlID0gW107XG4gICAgICAgIHJldHVybiB0aGlzLmNoYW5nZXMuZm9yRWFjaCgoKG4sIHMpID0+IHtcbiAgICAgICAgICAgIHMuaXNWYWxpZERvY3VtZW50KCkgPyBlLnB1c2godGhpcy5Lbi5hZGRFbnRyeSh0LCBzKSkgOiB0aGlzLktuLnJlbW92ZUVudHJ5KG4pO1xuICAgICAgICB9KSksIHlpLndhaXRGb3IoZSk7XG4gICAgfVxuICAgIGdldEZyb21DYWNoZSh0LCBlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLktuLmdldEVudHJ5KHQsIGUpO1xuICAgIH1cbiAgICBnZXRBbGxGcm9tQ2FjaGUodCwgZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5Lbi5nZXRFbnRyaWVzKHQsIGUpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi8gY2xhc3MgYm8ge1xuICAgIGNvbnN0cnVjdG9yKHQpIHtcbiAgICAgICAgdGhpcy5wZXJzaXN0ZW5jZSA9IHQsIFxuICAgICAgICAvKipcbiAgICAgICAgICogTWFwcyBhIHRhcmdldCB0byB0aGUgZGF0YSBhYm91dCB0aGF0IHRhcmdldFxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5MaSA9IG5ldyBLbigodCA9PiBJZSh0KSksIEVlKSwgXG4gICAgICAgIC8qKiBUaGUgbGFzdCByZWNlaXZlZCBzbmFwc2hvdCB2ZXJzaW9uLiAqL1xuICAgICAgICB0aGlzLmxhc3RSZW1vdGVTbmFwc2hvdFZlcnNpb24gPSBjdC5taW4oKSwgXG4gICAgICAgIC8qKiBUaGUgaGlnaGVzdCBudW1iZXJlZCB0YXJnZXQgSUQgZW5jb3VudGVyZWQuICovXG4gICAgICAgIHRoaXMuaGlnaGVzdFRhcmdldElkID0gMCwgXG4gICAgICAgIC8qKiBUaGUgaGlnaGVzdCBzZXF1ZW5jZSBudW1iZXIgZW5jb3VudGVyZWQuICovXG4gICAgICAgIHRoaXMuVWkgPSAwLCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEEgb3JkZXJlZCBiaWRpcmVjdGlvbmFsIG1hcHBpbmcgYmV0d2VlbiBkb2N1bWVudHMgYW5kIHRoZSByZW1vdGUgdGFyZ2V0XG4gICAgICAgICAqIElEcy5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMucWkgPSBuZXcgSW8sIHRoaXMudGFyZ2V0Q291bnQgPSAwLCB0aGlzLktpID0gYnIuZ24oKTtcbiAgICB9XG4gICAgZm9yRWFjaFRhcmdldCh0LCBlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLkxpLmZvckVhY2goKCh0LCBuKSA9PiBlKG4pKSksIHlpLnJlc29sdmUoKTtcbiAgICB9XG4gICAgZ2V0TGFzdFJlbW90ZVNuYXBzaG90VmVyc2lvbih0KSB7XG4gICAgICAgIHJldHVybiB5aS5yZXNvbHZlKHRoaXMubGFzdFJlbW90ZVNuYXBzaG90VmVyc2lvbik7XG4gICAgfVxuICAgIGdldEhpZ2hlc3RTZXF1ZW5jZU51bWJlcih0KSB7XG4gICAgICAgIHJldHVybiB5aS5yZXNvbHZlKHRoaXMuVWkpO1xuICAgIH1cbiAgICBhbGxvY2F0ZVRhcmdldElkKHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaGlnaGVzdFRhcmdldElkID0gdGhpcy5LaS5uZXh0KCksIHlpLnJlc29sdmUodGhpcy5oaWdoZXN0VGFyZ2V0SWQpO1xuICAgIH1cbiAgICBzZXRUYXJnZXRzTWV0YWRhdGEodCwgZSwgbikge1xuICAgICAgICByZXR1cm4gbiAmJiAodGhpcy5sYXN0UmVtb3RlU25hcHNob3RWZXJzaW9uID0gbiksIGUgPiB0aGlzLlVpICYmICh0aGlzLlVpID0gZSksIFxuICAgICAgICB5aS5yZXNvbHZlKCk7XG4gICAgfVxuICAgIFRuKHQpIHtcbiAgICAgICAgdGhpcy5MaS5zZXQodC50YXJnZXQsIHQpO1xuICAgICAgICBjb25zdCBlID0gdC50YXJnZXRJZDtcbiAgICAgICAgZSA+IHRoaXMuaGlnaGVzdFRhcmdldElkICYmICh0aGlzLktpID0gbmV3IGJyKGUpLCB0aGlzLmhpZ2hlc3RUYXJnZXRJZCA9IGUpLCB0LnNlcXVlbmNlTnVtYmVyID4gdGhpcy5VaSAmJiAodGhpcy5VaSA9IHQuc2VxdWVuY2VOdW1iZXIpO1xuICAgIH1cbiAgICBhZGRUYXJnZXREYXRhKHQsIGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuVG4oZSksIHRoaXMudGFyZ2V0Q291bnQgKz0gMSwgeWkucmVzb2x2ZSgpO1xuICAgIH1cbiAgICB1cGRhdGVUYXJnZXREYXRhKHQsIGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuVG4oZSksIHlpLnJlc29sdmUoKTtcbiAgICB9XG4gICAgcmVtb3ZlVGFyZ2V0RGF0YSh0LCBlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLkxpLmRlbGV0ZShlLnRhcmdldCksIHRoaXMucWkudmkoZS50YXJnZXRJZCksIHRoaXMudGFyZ2V0Q291bnQgLT0gMSwgXG4gICAgICAgIHlpLnJlc29sdmUoKTtcbiAgICB9XG4gICAgcmVtb3ZlVGFyZ2V0cyh0LCBlLCBuKSB7XG4gICAgICAgIGxldCBzID0gMDtcbiAgICAgICAgY29uc3QgaSA9IFtdO1xuICAgICAgICByZXR1cm4gdGhpcy5MaS5mb3JFYWNoKCgociwgbykgPT4ge1xuICAgICAgICAgICAgby5zZXF1ZW5jZU51bWJlciA8PSBlICYmIG51bGwgPT09IG4uZ2V0KG8udGFyZ2V0SWQpICYmICh0aGlzLkxpLmRlbGV0ZShyKSwgaS5wdXNoKHRoaXMucmVtb3ZlTWF0Y2hpbmdLZXlzRm9yVGFyZ2V0SWQodCwgby50YXJnZXRJZCkpLCBcbiAgICAgICAgICAgIHMrKyk7XG4gICAgICAgIH0pKSwgeWkud2FpdEZvcihpKS5uZXh0KCgoKSA9PiBzKSk7XG4gICAgfVxuICAgIGdldFRhcmdldENvdW50KHQpIHtcbiAgICAgICAgcmV0dXJuIHlpLnJlc29sdmUodGhpcy50YXJnZXRDb3VudCk7XG4gICAgfVxuICAgIGdldFRhcmdldERhdGEodCwgZSkge1xuICAgICAgICBjb25zdCBuID0gdGhpcy5MaS5nZXQoZSkgfHwgbnVsbDtcbiAgICAgICAgcmV0dXJuIHlpLnJlc29sdmUobik7XG4gICAgfVxuICAgIGFkZE1hdGNoaW5nS2V5cyh0LCBlLCBuKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnFpLmJpKGUsIG4pLCB5aS5yZXNvbHZlKCk7XG4gICAgfVxuICAgIHJlbW92ZU1hdGNoaW5nS2V5cyh0LCBlLCBuKSB7XG4gICAgICAgIHRoaXMucWkuVmkoZSwgbik7XG4gICAgICAgIGNvbnN0IHMgPSB0aGlzLnBlcnNpc3RlbmNlLnJlZmVyZW5jZURlbGVnYXRlLCBpID0gW107XG4gICAgICAgIHJldHVybiBzICYmIGUuZm9yRWFjaCgoZSA9PiB7XG4gICAgICAgICAgICBpLnB1c2gocy5tYXJrUG90ZW50aWFsbHlPcnBoYW5lZCh0LCBlKSk7XG4gICAgICAgIH0pKSwgeWkud2FpdEZvcihpKTtcbiAgICB9XG4gICAgcmVtb3ZlTWF0Y2hpbmdLZXlzRm9yVGFyZ2V0SWQodCwgZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5xaS52aShlKSwgeWkucmVzb2x2ZSgpO1xuICAgIH1cbiAgICBnZXRNYXRjaGluZ0tleXNGb3JUYXJnZXRJZCh0LCBlKSB7XG4gICAgICAgIGNvbnN0IG4gPSB0aGlzLnFpLkRpKGUpO1xuICAgICAgICByZXR1cm4geWkucmVzb2x2ZShuKTtcbiAgICB9XG4gICAgY29udGFpbnNLZXkodCwgZSkge1xuICAgICAgICByZXR1cm4geWkucmVzb2x2ZSh0aGlzLnFpLmNvbnRhaW5zS2V5KGUpKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEEgbWVtb3J5LWJhY2tlZCBpbnN0YW5jZSBvZiBQZXJzaXN0ZW5jZS4gRGF0YSBpcyBzdG9yZWQgb25seSBpbiBSQU0gYW5kXG4gKiBub3QgcGVyc2lzdGVkIGFjcm9zcyBzZXNzaW9ucy5cbiAqL1xuY2xhc3MgUG8ge1xuICAgIC8qKlxuICAgICAqIFRoZSBjb25zdHJ1Y3RvciBhY2NlcHRzIGEgZmFjdG9yeSBmb3IgY3JlYXRpbmcgYSByZWZlcmVuY2UgZGVsZWdhdGUuIFRoaXNcbiAgICAgKiBhbGxvd3MgYm90aCB0aGUgZGVsZWdhdGUgYW5kIHRoaXMgaW5zdGFuY2UgdG8gaGF2ZSBzdHJvbmcgcmVmZXJlbmNlcyB0b1xuICAgICAqIGVhY2ggb3RoZXIgd2l0aG91dCBoYXZpbmcgbnVsbGFibGUgZmllbGRzIHRoYXQgd291bGQgdGhlbiBuZWVkIHRvIGJlXG4gICAgICogY2hlY2tlZCBvciBhc3NlcnRlZCBvbiBldmVyeSBhY2Nlc3MuXG4gICAgICovXG4gICAgY29uc3RydWN0b3IodCwgZSkge1xuICAgICAgICB0aGlzLkdpID0ge30sIHRoaXMub3ZlcmxheXMgPSB7fSwgdGhpcy5lcyA9IG5ldyBudCgwKSwgdGhpcy5ucyA9ICExLCB0aGlzLm5zID0gITAsIFxuICAgICAgICB0aGlzLnJlZmVyZW5jZURlbGVnYXRlID0gdCh0aGlzKSwgdGhpcy5mcyA9IG5ldyBibyh0aGlzKTtcbiAgICAgICAgdGhpcy5pbmRleE1hbmFnZXIgPSBuZXcgYXIsIHRoaXMuZHMgPSBmdW5jdGlvbih0KSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IEFvKHQpO1xuICAgICAgICB9KCh0ID0+IHRoaXMucmVmZXJlbmNlRGVsZWdhdGUuUWkodCkpKSwgdGhpcy5NID0gbmV3IGtpKGUpLCB0aGlzLl9zID0gbmV3IHlvKHRoaXMuTSk7XG4gICAgfVxuICAgIHN0YXJ0KCkge1xuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgfVxuICAgIHNodXRkb3duKCkge1xuICAgICAgICAvLyBObyBkdXJhYmxlIHN0YXRlIHRvIGVuc3VyZSBpcyBjbG9zZWQgb24gc2h1dGRvd24uXG4gICAgICAgIHJldHVybiB0aGlzLm5zID0gITEsIFByb21pc2UucmVzb2x2ZSgpO1xuICAgIH1cbiAgICBnZXQgc3RhcnRlZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubnM7XG4gICAgfVxuICAgIHNldERhdGFiYXNlRGVsZXRlZExpc3RlbmVyKCkge1xuICAgICAgICAvLyBObyBvcC5cbiAgICB9XG4gICAgc2V0TmV0d29ya0VuYWJsZWQoKSB7XG4gICAgICAgIC8vIE5vIG9wLlxuICAgIH1cbiAgICBnZXRJbmRleE1hbmFnZXIodCkge1xuICAgICAgICAvLyBXZSBkbyBub3QgY3VycmVudGx5IHN1cHBvcnQgaW5kaWNlcyBmb3IgbWVtb3J5IHBlcnNpc3RlbmNlLCBzbyB3ZSBjYW5cbiAgICAgICAgLy8gcmV0dXJuIHRoZSBzYW1lIHNoYXJlZCBpbnN0YW5jZSBvZiB0aGUgbWVtb3J5IGluZGV4IG1hbmFnZXIuXG4gICAgICAgIHJldHVybiB0aGlzLmluZGV4TWFuYWdlcjtcbiAgICB9XG4gICAgZ2V0RG9jdW1lbnRPdmVybGF5Q2FjaGUodCkge1xuICAgICAgICBsZXQgZSA9IHRoaXMub3ZlcmxheXNbdC50b0tleSgpXTtcbiAgICAgICAgcmV0dXJuIGUgfHwgKGUgPSBuZXcgcG8sIHRoaXMub3ZlcmxheXNbdC50b0tleSgpXSA9IGUpLCBlO1xuICAgIH1cbiAgICBnZXRNdXRhdGlvblF1ZXVlKHQsIGUpIHtcbiAgICAgICAgbGV0IG4gPSB0aGlzLkdpW3QudG9LZXkoKV07XG4gICAgICAgIHJldHVybiBuIHx8IChuID0gbmV3IEVvKGUsIHRoaXMucmVmZXJlbmNlRGVsZWdhdGUpLCB0aGlzLkdpW3QudG9LZXkoKV0gPSBuKSwgbjtcbiAgICB9XG4gICAgZ2V0VGFyZ2V0Q2FjaGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmZzO1xuICAgIH1cbiAgICBnZXRSZW1vdGVEb2N1bWVudENhY2hlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5kcztcbiAgICB9XG4gICAgZ2V0QnVuZGxlQ2FjaGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9zO1xuICAgIH1cbiAgICBydW5UcmFuc2FjdGlvbih0LCBlLCBuKSB7XG4gICAgICAgIE8oXCJNZW1vcnlQZXJzaXN0ZW5jZVwiLCBcIlN0YXJ0aW5nIHRyYW5zYWN0aW9uOlwiLCB0KTtcbiAgICAgICAgY29uc3QgcyA9IG5ldyBWbyh0aGlzLmVzLm5leHQoKSk7XG4gICAgICAgIHJldHVybiB0aGlzLnJlZmVyZW5jZURlbGVnYXRlLmppKCksIG4ocykubmV4dCgodCA9PiB0aGlzLnJlZmVyZW5jZURlbGVnYXRlLldpKHMpLm5leHQoKCgpID0+IHQpKSkpLnRvUHJvbWlzZSgpLnRoZW4oKHQgPT4gKHMucmFpc2VPbkNvbW1pdHRlZEV2ZW50KCksIFxuICAgICAgICB0KSkpO1xuICAgIH1cbiAgICB6aSh0LCBlKSB7XG4gICAgICAgIHJldHVybiB5aS5vcihPYmplY3QudmFsdWVzKHRoaXMuR2kpLm1hcCgobiA9PiAoKSA9PiBuLmNvbnRhaW5zS2V5KHQsIGUpKSkpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBNZW1vcnkgcGVyc2lzdGVuY2UgaXMgbm90IGFjdHVhbGx5IHRyYW5zYWN0aW9uYWwsIGJ1dCBmdXR1cmUgaW1wbGVtZW50YXRpb25zXG4gKiBtYXkgaGF2ZSB0cmFuc2FjdGlvbi1zY29wZWQgc3RhdGUuXG4gKi8gY2xhc3MgVm8gZXh0ZW5kcyBnaSB7XG4gICAgY29uc3RydWN0b3IodCkge1xuICAgICAgICBzdXBlcigpLCB0aGlzLmN1cnJlbnRTZXF1ZW5jZU51bWJlciA9IHQ7XG4gICAgfVxufVxuXG5jbGFzcyB2byB7XG4gICAgY29uc3RydWN0b3IodCkge1xuICAgICAgICB0aGlzLnBlcnNpc3RlbmNlID0gdCwgXG4gICAgICAgIC8qKiBUcmFja3MgYWxsIGRvY3VtZW50cyB0aGF0IGFyZSBhY3RpdmUgaW4gUXVlcnkgdmlld3MuICovXG4gICAgICAgIHRoaXMuSGkgPSBuZXcgSW8sIFxuICAgICAgICAvKiogVGhlIGxpc3Qgb2YgZG9jdW1lbnRzIHRoYXQgYXJlIHBvdGVudGlhbGx5IEdDZWQgYWZ0ZXIgZWFjaCB0cmFuc2FjdGlvbi4gKi9cbiAgICAgICAgdGhpcy5KaSA9IG51bGw7XG4gICAgfVxuICAgIHN0YXRpYyBZaSh0KSB7XG4gICAgICAgIHJldHVybiBuZXcgdm8odCk7XG4gICAgfVxuICAgIGdldCBYaSgpIHtcbiAgICAgICAgaWYgKHRoaXMuSmkpIHJldHVybiB0aGlzLkppO1xuICAgICAgICB0aHJvdyBMKCk7XG4gICAgfVxuICAgIGFkZFJlZmVyZW5jZSh0LCBlLCBuKSB7XG4gICAgICAgIHJldHVybiB0aGlzLkhpLmFkZFJlZmVyZW5jZShuLCBlKSwgdGhpcy5YaS5kZWxldGUobi50b1N0cmluZygpKSwgeWkucmVzb2x2ZSgpO1xuICAgIH1cbiAgICByZW1vdmVSZWZlcmVuY2UodCwgZSwgbikge1xuICAgICAgICByZXR1cm4gdGhpcy5IaS5yZW1vdmVSZWZlcmVuY2UobiwgZSksIHRoaXMuWGkuYWRkKG4udG9TdHJpbmcoKSksIHlpLnJlc29sdmUoKTtcbiAgICB9XG4gICAgbWFya1BvdGVudGlhbGx5T3JwaGFuZWQodCwgZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5YaS5hZGQoZS50b1N0cmluZygpKSwgeWkucmVzb2x2ZSgpO1xuICAgIH1cbiAgICByZW1vdmVUYXJnZXQodCwgZSkge1xuICAgICAgICB0aGlzLkhpLnZpKGUudGFyZ2V0SWQpLmZvckVhY2goKHQgPT4gdGhpcy5YaS5hZGQodC50b1N0cmluZygpKSkpO1xuICAgICAgICBjb25zdCBuID0gdGhpcy5wZXJzaXN0ZW5jZS5nZXRUYXJnZXRDYWNoZSgpO1xuICAgICAgICByZXR1cm4gbi5nZXRNYXRjaGluZ0tleXNGb3JUYXJnZXRJZCh0LCBlLnRhcmdldElkKS5uZXh0KCh0ID0+IHtcbiAgICAgICAgICAgIHQuZm9yRWFjaCgodCA9PiB0aGlzLlhpLmFkZCh0LnRvU3RyaW5nKCkpKSk7XG4gICAgICAgIH0pKS5uZXh0KCgoKSA9PiBuLnJlbW92ZVRhcmdldERhdGEodCwgZSkpKTtcbiAgICB9XG4gICAgamkoKSB7XG4gICAgICAgIHRoaXMuSmkgPSBuZXcgU2V0O1xuICAgIH1cbiAgICBXaSh0KSB7XG4gICAgICAgIC8vIFJlbW92ZSBuZXdseSBvcnBoYW5lZCBkb2N1bWVudHMuXG4gICAgICAgIGNvbnN0IGUgPSB0aGlzLnBlcnNpc3RlbmNlLmdldFJlbW90ZURvY3VtZW50Q2FjaGUoKS5uZXdDaGFuZ2VCdWZmZXIoKTtcbiAgICAgICAgcmV0dXJuIHlpLmZvckVhY2godGhpcy5YaSwgKG4gPT4ge1xuICAgICAgICAgICAgY29uc3QgcyA9IHh0LmZyb21QYXRoKG4pO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuWmkodCwgcykubmV4dCgodCA9PiB7XG4gICAgICAgICAgICAgICAgdCB8fCBlLnJlbW92ZUVudHJ5KHMsIGN0Lm1pbigpKTtcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgfSkpLm5leHQoKCgpID0+ICh0aGlzLkppID0gbnVsbCwgZS5hcHBseSh0KSkpKTtcbiAgICB9XG4gICAgdXBkYXRlTGltYm9Eb2N1bWVudCh0LCBlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLlppKHQsIGUpLm5leHQoKHQgPT4ge1xuICAgICAgICAgICAgdCA/IHRoaXMuWGkuZGVsZXRlKGUudG9TdHJpbmcoKSkgOiB0aGlzLlhpLmFkZChlLnRvU3RyaW5nKCkpO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIFFpKHQpIHtcbiAgICAgICAgLy8gRm9yIGVhZ2VyIEdDLCB3ZSBkb24ndCBjYXJlIGFib3V0IHRoZSBkb2N1bWVudCBzaXplLCB0aGVyZSBhcmUgbm8gc2l6ZSB0aHJlc2hvbGRzLlxuICAgICAgICByZXR1cm4gMDtcbiAgICB9XG4gICAgWmkodCwgZSkge1xuICAgICAgICByZXR1cm4geWkub3IoWyAoKSA9PiB5aS5yZXNvbHZlKHRoaXMuSGkuY29udGFpbnNLZXkoZSkpLCAoKSA9PiB0aGlzLnBlcnNpc3RlbmNlLmdldFRhcmdldENhY2hlKCkuY29udGFpbnNLZXkodCwgZSksICgpID0+IHRoaXMucGVyc2lzdGVuY2UuemkodCwgZSkgXSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLy8gVGhlIGZvcm1hdCBvZiB0aGUgTG9jYWxTdG9yYWdlIGtleSB0aGF0IHN0b3JlcyB0aGUgY2xpZW50IHN0YXRlIGlzOlxuLy8gICAgIGZpcmVzdG9yZV9jbGllbnRzXzxwZXJzaXN0ZW5jZV9wcmVmaXg+XzxpbnN0YW5jZV9rZXk+XG4vKiogQXNzZW1ibGVzIHRoZSBrZXkgZm9yIGEgY2xpZW50IHN0YXRlIGluIFdlYlN0b3JhZ2UgKi9cbmZ1bmN0aW9uIFNvKHQsIGUpIHtcbiAgICByZXR1cm4gYGZpcmVzdG9yZV9jbGllbnRzXyR7dH1fJHtlfWA7XG59XG5cbi8vIFRoZSBmb3JtYXQgb2YgdGhlIFdlYlN0b3JhZ2Uga2V5IHRoYXQgc3RvcmVzIHRoZSBtdXRhdGlvbiBzdGF0ZSBpczpcbi8vICAgICBmaXJlc3RvcmVfbXV0YXRpb25zXzxwZXJzaXN0ZW5jZV9wcmVmaXg+XzxiYXRjaF9pZD5cbi8vICAgICAoZm9yIHVuYXV0aGVudGljYXRlZCB1c2Vycylcbi8vIG9yOiBmaXJlc3RvcmVfbXV0YXRpb25zXzxwZXJzaXN0ZW5jZV9wcmVmaXg+XzxiYXRjaF9pZD5fPHVzZXJfdWlkPlxuXG4vLyAndXNlcl91aWQnIGlzIGxhc3QgdG8gYXZvaWQgbmVlZGluZyB0byBlc2NhcGUgJ18nIGNoYXJhY3RlcnMgdGhhdCBpdCBtaWdodFxuLy8gY29udGFpbi5cbi8qKiBBc3NlbWJsZXMgdGhlIGtleSBmb3IgYSBtdXRhdGlvbiBiYXRjaCBpbiBXZWJTdG9yYWdlICovXG5mdW5jdGlvbiBEbyh0LCBlLCBuKSB7XG4gICAgbGV0IHMgPSBgZmlyZXN0b3JlX211dGF0aW9uc18ke3R9XyR7bn1gO1xuICAgIHJldHVybiBlLmlzQXV0aGVudGljYXRlZCgpICYmIChzICs9IGBfJHtlLnVpZH1gKSwgcztcbn1cblxuLy8gVGhlIGZvcm1hdCBvZiB0aGUgV2ViU3RvcmFnZSBrZXkgdGhhdCBzdG9yZXMgYSBxdWVyeSB0YXJnZXQncyBtZXRhZGF0YSBpczpcbi8vICAgICBmaXJlc3RvcmVfdGFyZ2V0c188cGVyc2lzdGVuY2VfcHJlZml4Pl88dGFyZ2V0X2lkPlxuLyoqIEFzc2VtYmxlcyB0aGUga2V5IGZvciBhIHF1ZXJ5IHN0YXRlIGluIFdlYlN0b3JhZ2UgKi9cbmZ1bmN0aW9uIENvKHQsIGUpIHtcbiAgICByZXR1cm4gYGZpcmVzdG9yZV90YXJnZXRzXyR7dH1fJHtlfWA7XG59XG5cbi8vIFRoZSBXZWJTdG9yYWdlIHByZWZpeCB0aGF0IHN0b3JlcyB0aGUgcHJpbWFyeSB0YWIncyBvbmxpbmUgc3RhdGUuIFRoZVxuLy8gZm9ybWF0IG9mIHRoZSBrZXkgaXM6XG4vLyAgICAgZmlyZXN0b3JlX29ubGluZV9zdGF0ZV88cGVyc2lzdGVuY2VfcHJlZml4PlxuLyoqXG4gKiBIb2xkcyB0aGUgc3RhdGUgb2YgYSBtdXRhdGlvbiBiYXRjaCwgaW5jbHVkaW5nIGl0cyB1c2VyIElELCBiYXRjaCBJRCBhbmRcbiAqIHdoZXRoZXIgdGhlIGJhdGNoIGlzICdwZW5kaW5nJywgJ2Fja25vd2xlZGdlZCcgb3IgJ3JlamVjdGVkJy5cbiAqL1xuLy8gVmlzaWJsZSBmb3IgdGVzdGluZ1xuY2xhc3MgeG8ge1xuICAgIGNvbnN0cnVjdG9yKHQsIGUsIG4sIHMpIHtcbiAgICAgICAgdGhpcy51c2VyID0gdCwgdGhpcy5iYXRjaElkID0gZSwgdGhpcy5zdGF0ZSA9IG4sIHRoaXMuZXJyb3IgPSBzO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBQYXJzZXMgYSBNdXRhdGlvbk1ldGFkYXRhIGZyb20gaXRzIEpTT04gcmVwcmVzZW50YXRpb24gaW4gV2ViU3RvcmFnZS5cbiAgICAgKiBMb2dzIGEgd2FybmluZyBhbmQgcmV0dXJucyBudWxsIGlmIHRoZSBmb3JtYXQgb2YgdGhlIGRhdGEgaXMgbm90IHZhbGlkLlxuICAgICAqLyAgICBzdGF0aWMgdHIodCwgZSwgbikge1xuICAgICAgICBjb25zdCBzID0gSlNPTi5wYXJzZShuKTtcbiAgICAgICAgbGV0IGksIHIgPSBcIm9iamVjdFwiID09IHR5cGVvZiBzICYmIC0xICE9PSBbIFwicGVuZGluZ1wiLCBcImFja25vd2xlZGdlZFwiLCBcInJlamVjdGVkXCIgXS5pbmRleE9mKHMuc3RhdGUpICYmICh2b2lkIDAgPT09IHMuZXJyb3IgfHwgXCJvYmplY3RcIiA9PSB0eXBlb2Ygcy5lcnJvcik7XG4gICAgICAgIHJldHVybiByICYmIHMuZXJyb3IgJiYgKHIgPSBcInN0cmluZ1wiID09IHR5cGVvZiBzLmVycm9yLm1lc3NhZ2UgJiYgXCJzdHJpbmdcIiA9PSB0eXBlb2Ygcy5lcnJvci5jb2RlLCBcbiAgICAgICAgciAmJiAoaSA9IG5ldyBRKHMuZXJyb3IuY29kZSwgcy5lcnJvci5tZXNzYWdlKSkpLCByID8gbmV3IHhvKHQsIGUsIHMuc3RhdGUsIGkpIDogKEYoXCJTaGFyZWRDbGllbnRTdGF0ZVwiLCBgRmFpbGVkIHRvIHBhcnNlIG11dGF0aW9uIHN0YXRlIGZvciBJRCAnJHtlfSc6ICR7bn1gKSwgXG4gICAgICAgIG51bGwpO1xuICAgIH1cbiAgICBlcigpIHtcbiAgICAgICAgY29uc3QgdCA9IHtcbiAgICAgICAgICAgIHN0YXRlOiB0aGlzLnN0YXRlLFxuICAgICAgICAgICAgdXBkYXRlVGltZU1zOiBEYXRlLm5vdygpXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiB0aGlzLmVycm9yICYmICh0LmVycm9yID0ge1xuICAgICAgICAgICAgY29kZTogdGhpcy5lcnJvci5jb2RlLFxuICAgICAgICAgICAgbWVzc2FnZTogdGhpcy5lcnJvci5tZXNzYWdlXG4gICAgICAgIH0pLCBKU09OLnN0cmluZ2lmeSh0KTtcbiAgICB9XG59XG5cbi8qKlxuICogSG9sZHMgdGhlIHN0YXRlIG9mIGEgcXVlcnkgdGFyZ2V0LCBpbmNsdWRpbmcgaXRzIHRhcmdldCBJRCBhbmQgd2hldGhlciB0aGVcbiAqIHRhcmdldCBpcyAnbm90LWN1cnJlbnQnLCAnY3VycmVudCcgb3IgJ3JlamVjdGVkJy5cbiAqL1xuLy8gVmlzaWJsZSBmb3IgdGVzdGluZ1xuY2xhc3MgTm8ge1xuICAgIGNvbnN0cnVjdG9yKHQsIGUsIG4pIHtcbiAgICAgICAgdGhpcy50YXJnZXRJZCA9IHQsIHRoaXMuc3RhdGUgPSBlLCB0aGlzLmVycm9yID0gbjtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUGFyc2VzIGEgUXVlcnlUYXJnZXRNZXRhZGF0YSBmcm9tIGl0cyBKU09OIHJlcHJlc2VudGF0aW9uIGluIFdlYlN0b3JhZ2UuXG4gICAgICogTG9ncyBhIHdhcm5pbmcgYW5kIHJldHVybnMgbnVsbCBpZiB0aGUgZm9ybWF0IG9mIHRoZSBkYXRhIGlzIG5vdCB2YWxpZC5cbiAgICAgKi8gICAgc3RhdGljIHRyKHQsIGUpIHtcbiAgICAgICAgY29uc3QgbiA9IEpTT04ucGFyc2UoZSk7XG4gICAgICAgIGxldCBzLCBpID0gXCJvYmplY3RcIiA9PSB0eXBlb2YgbiAmJiAtMSAhPT0gWyBcIm5vdC1jdXJyZW50XCIsIFwiY3VycmVudFwiLCBcInJlamVjdGVkXCIgXS5pbmRleE9mKG4uc3RhdGUpICYmICh2b2lkIDAgPT09IG4uZXJyb3IgfHwgXCJvYmplY3RcIiA9PSB0eXBlb2Ygbi5lcnJvcik7XG4gICAgICAgIHJldHVybiBpICYmIG4uZXJyb3IgJiYgKGkgPSBcInN0cmluZ1wiID09IHR5cGVvZiBuLmVycm9yLm1lc3NhZ2UgJiYgXCJzdHJpbmdcIiA9PSB0eXBlb2Ygbi5lcnJvci5jb2RlLCBcbiAgICAgICAgaSAmJiAocyA9IG5ldyBRKG4uZXJyb3IuY29kZSwgbi5lcnJvci5tZXNzYWdlKSkpLCBpID8gbmV3IE5vKHQsIG4uc3RhdGUsIHMpIDogKEYoXCJTaGFyZWRDbGllbnRTdGF0ZVwiLCBgRmFpbGVkIHRvIHBhcnNlIHRhcmdldCBzdGF0ZSBmb3IgSUQgJyR7dH0nOiAke2V9YCksIFxuICAgICAgICBudWxsKTtcbiAgICB9XG4gICAgZXIoKSB7XG4gICAgICAgIGNvbnN0IHQgPSB7XG4gICAgICAgICAgICBzdGF0ZTogdGhpcy5zdGF0ZSxcbiAgICAgICAgICAgIHVwZGF0ZVRpbWVNczogRGF0ZS5ub3coKVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gdGhpcy5lcnJvciAmJiAodC5lcnJvciA9IHtcbiAgICAgICAgICAgIGNvZGU6IHRoaXMuZXJyb3IuY29kZSxcbiAgICAgICAgICAgIG1lc3NhZ2U6IHRoaXMuZXJyb3IubWVzc2FnZVxuICAgICAgICB9KSwgSlNPTi5zdHJpbmdpZnkodCk7XG4gICAgfVxufVxuXG4vKipcbiAqIFRoaXMgY2xhc3MgcmVwcmVzZW50cyB0aGUgaW1tdXRhYmxlIENsaWVudFN0YXRlIGZvciBhIGNsaWVudCByZWFkIGZyb21cbiAqIFdlYlN0b3JhZ2UsIGNvbnRhaW5pbmcgdGhlIGxpc3Qgb2YgYWN0aXZlIHF1ZXJ5IHRhcmdldHMuXG4gKi8gY2xhc3Mga28ge1xuICAgIGNvbnN0cnVjdG9yKHQsIGUpIHtcbiAgICAgICAgdGhpcy5jbGllbnRJZCA9IHQsIHRoaXMuYWN0aXZlVGFyZ2V0SWRzID0gZTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUGFyc2VzIGEgUmVtb3RlQ2xpZW50U3RhdGUgZnJvbSB0aGUgSlNPTiByZXByZXNlbnRhdGlvbiBpbiBXZWJTdG9yYWdlLlxuICAgICAqIExvZ3MgYSB3YXJuaW5nIGFuZCByZXR1cm5zIG51bGwgaWYgdGhlIGZvcm1hdCBvZiB0aGUgZGF0YSBpcyBub3QgdmFsaWQuXG4gICAgICovICAgIHN0YXRpYyB0cih0LCBlKSB7XG4gICAgICAgIGNvbnN0IG4gPSBKU09OLnBhcnNlKGUpO1xuICAgICAgICBsZXQgcyA9IFwib2JqZWN0XCIgPT0gdHlwZW9mIG4gJiYgbi5hY3RpdmVUYXJnZXRJZHMgaW5zdGFuY2VvZiBBcnJheSwgaSA9IFpuKCk7XG4gICAgICAgIGZvciAobGV0IHQgPSAwOyBzICYmIHQgPCBuLmFjdGl2ZVRhcmdldElkcy5sZW5ndGg7ICsrdCkgcyA9IEN0KG4uYWN0aXZlVGFyZ2V0SWRzW3RdKSwgXG4gICAgICAgIGkgPSBpLmFkZChuLmFjdGl2ZVRhcmdldElkc1t0XSk7XG4gICAgICAgIHJldHVybiBzID8gbmV3IGtvKHQsIGkpIDogKEYoXCJTaGFyZWRDbGllbnRTdGF0ZVwiLCBgRmFpbGVkIHRvIHBhcnNlIGNsaWVudCBkYXRhIGZvciBpbnN0YW5jZSAnJHt0fSc6ICR7ZX1gKSwgXG4gICAgICAgIG51bGwpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBUaGlzIGNsYXNzIHJlcHJlc2VudHMgdGhlIG9ubGluZSBzdGF0ZSBmb3IgYWxsIGNsaWVudHMgcGFydGljaXBhdGluZyBpblxuICogbXVsdGktdGFiLiBUaGUgb25saW5lIHN0YXRlIGlzIG9ubHkgd3JpdHRlbiB0byBieSB0aGUgcHJpbWFyeSBjbGllbnQsIGFuZFxuICogdXNlZCBpbiBzZWNvbmRhcnkgY2xpZW50cyB0byB1cGRhdGUgdGhlaXIgcXVlcnkgdmlld3MuXG4gKi8gY2xhc3MgTW8ge1xuICAgIGNvbnN0cnVjdG9yKHQsIGUpIHtcbiAgICAgICAgdGhpcy5jbGllbnRJZCA9IHQsIHRoaXMub25saW5lU3RhdGUgPSBlO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBQYXJzZXMgYSBTaGFyZWRPbmxpbmVTdGF0ZSBmcm9tIGl0cyBKU09OIHJlcHJlc2VudGF0aW9uIGluIFdlYlN0b3JhZ2UuXG4gICAgICogTG9ncyBhIHdhcm5pbmcgYW5kIHJldHVybnMgbnVsbCBpZiB0aGUgZm9ybWF0IG9mIHRoZSBkYXRhIGlzIG5vdCB2YWxpZC5cbiAgICAgKi8gICAgc3RhdGljIHRyKHQpIHtcbiAgICAgICAgY29uc3QgZSA9IEpTT04ucGFyc2UodCk7XG4gICAgICAgIHJldHVybiBcIm9iamVjdFwiID09IHR5cGVvZiBlICYmIC0xICE9PSBbIFwiVW5rbm93blwiLCBcIk9ubGluZVwiLCBcIk9mZmxpbmVcIiBdLmluZGV4T2YoZS5vbmxpbmVTdGF0ZSkgJiYgXCJzdHJpbmdcIiA9PSB0eXBlb2YgZS5jbGllbnRJZCA/IG5ldyBNbyhlLmNsaWVudElkLCBlLm9ubGluZVN0YXRlKSA6IChGKFwiU2hhcmVkQ2xpZW50U3RhdGVcIiwgYEZhaWxlZCB0byBwYXJzZSBvbmxpbmUgc3RhdGU6ICR7dH1gKSwgXG4gICAgICAgIG51bGwpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBNZXRhZGF0YSBzdGF0ZSBvZiB0aGUgbG9jYWwgY2xpZW50LiBVbmxpa2UgYFJlbW90ZUNsaWVudFN0YXRlYCwgdGhpcyBjbGFzcyBpc1xuICogbXV0YWJsZSBhbmQga2VlcHMgdHJhY2sgb2YgYWxsIHBlbmRpbmcgbXV0YXRpb25zLCB3aGljaCBhbGxvd3MgdXMgdG9cbiAqIHVwZGF0ZSB0aGUgcmFuZ2Ugb2YgcGVuZGluZyBtdXRhdGlvbiBiYXRjaCBJRHMgYXMgbmV3IG11dGF0aW9ucyBhcmUgYWRkZWQgb3JcbiAqIHJlbW92ZWQuXG4gKlxuICogVGhlIGRhdGEgaW4gYExvY2FsQ2xpZW50U3RhdGVgIGlzIG5vdCByZWFkIGZyb20gV2ViU3RvcmFnZSBhbmQgaW5zdGVhZFxuICogdXBkYXRlZCB2aWEgaXRzIGluc3RhbmNlIG1ldGhvZHMuIFRoZSB1cGRhdGVkIHN0YXRlIGNhbiBiZSBzZXJpYWxpemVkIHZpYVxuICogYHRvV2ViU3RvcmFnZUpTT04oKWAuXG4gKi9cbi8vIFZpc2libGUgZm9yIHRlc3RpbmcuXG5jbGFzcyBPbyB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMuYWN0aXZlVGFyZ2V0SWRzID0gWm4oKTtcbiAgICB9XG4gICAgbnIodCkge1xuICAgICAgICB0aGlzLmFjdGl2ZVRhcmdldElkcyA9IHRoaXMuYWN0aXZlVGFyZ2V0SWRzLmFkZCh0KTtcbiAgICB9XG4gICAgc3IodCkge1xuICAgICAgICB0aGlzLmFjdGl2ZVRhcmdldElkcyA9IHRoaXMuYWN0aXZlVGFyZ2V0SWRzLmRlbGV0ZSh0KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ29udmVydHMgdGhpcyBlbnRyeSBpbnRvIGEgSlNPTi1lbmNvZGVkIGZvcm1hdCB3ZSBjYW4gdXNlIGZvciBXZWJTdG9yYWdlLlxuICAgICAqIERvZXMgbm90IGVuY29kZSBgY2xpZW50SWRgIGFzIGl0IGlzIHBhcnQgb2YgdGhlIGtleSBpbiBXZWJTdG9yYWdlLlxuICAgICAqLyAgICBlcigpIHtcbiAgICAgICAgY29uc3QgdCA9IHtcbiAgICAgICAgICAgIGFjdGl2ZVRhcmdldElkczogdGhpcy5hY3RpdmVUYXJnZXRJZHMudG9BcnJheSgpLFxuICAgICAgICAgICAgdXBkYXRlVGltZU1zOiBEYXRlLm5vdygpXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeSh0KTtcbiAgICB9XG59XG5cbi8qKlxuICogYFdlYlN0b3JhZ2VTaGFyZWRDbGllbnRTdGF0ZWAgdXNlcyBXZWJTdG9yYWdlICh3aW5kb3cubG9jYWxTdG9yYWdlKSBhcyB0aGVcbiAqIGJhY2tpbmcgc3RvcmUgZm9yIHRoZSBTaGFyZWRDbGllbnRTdGF0ZS4gSXQga2VlcHMgdHJhY2sgb2YgYWxsIGFjdGl2ZVxuICogY2xpZW50cyBhbmQgc3VwcG9ydHMgbW9kaWZpY2F0aW9ucyBvZiB0aGUgbG9jYWwgY2xpZW50J3MgZGF0YS5cbiAqLyBjbGFzcyBGbyB7XG4gICAgY29uc3RydWN0b3IodCwgZSwgbiwgcywgaSkge1xuICAgICAgICB0aGlzLndpbmRvdyA9IHQsIHRoaXMuWW4gPSBlLCB0aGlzLnBlcnNpc3RlbmNlS2V5ID0gbiwgdGhpcy5pciA9IHMsIHRoaXMuc3luY0VuZ2luZSA9IG51bGwsIFxuICAgICAgICB0aGlzLm9ubGluZVN0YXRlSGFuZGxlciA9IG51bGwsIHRoaXMuc2VxdWVuY2VOdW1iZXJIYW5kbGVyID0gbnVsbCwgdGhpcy5yciA9IHRoaXMudXIuYmluZCh0aGlzKSwgXG4gICAgICAgIHRoaXMuYXIgPSBuZXcgZmUocnQpLCB0aGlzLnN0YXJ0ZWQgPSAhMSwgXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBDYXB0dXJlcyBXZWJTdG9yYWdlIGV2ZW50cyB0aGF0IG9jY3VyIGJlZm9yZSBgc3RhcnQoKWAgaXMgY2FsbGVkLiBUaGVzZVxuICAgICAgICAgKiBldmVudHMgYXJlIHJlcGxheWVkIG9uY2UgYFdlYlN0b3JhZ2VTaGFyZWRDbGllbnRTdGF0ZWAgaXMgc3RhcnRlZC5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuY3IgPSBbXTtcbiAgICAgICAgLy8gRXNjYXBlIHRoZSBzcGVjaWFsIGNoYXJhY3RlcnMgbWVudGlvbmVkIGhlcmU6XG4gICAgICAgIC8vIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0phdmFTY3JpcHQvR3VpZGUvUmVndWxhcl9FeHByZXNzaW9uc1xuICAgICAgICBjb25zdCByID0gbi5yZXBsYWNlKC9bLiorP14ke30oKXxbXFxdXFxcXF0vZywgXCJcXFxcJCZcIik7XG4gICAgICAgIHRoaXMuc3RvcmFnZSA9IHRoaXMud2luZG93LmxvY2FsU3RvcmFnZSwgdGhpcy5jdXJyZW50VXNlciA9IGksIHRoaXMuaHIgPSBTbyh0aGlzLnBlcnNpc3RlbmNlS2V5LCB0aGlzLmlyKSwgXG4gICAgICAgIHRoaXMubHIgPSBcbiAgICAgICAgLyoqIEFzc2VtYmxlcyB0aGUga2V5IGZvciB0aGUgY3VycmVudCBzZXF1ZW5jZSBudW1iZXIuICovXG4gICAgICAgIGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgICAgIHJldHVybiBgZmlyZXN0b3JlX3NlcXVlbmNlX251bWJlcl8ke3R9YDtcbiAgICAgICAgfVxuICAgICAgICAvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqLyAodGhpcy5wZXJzaXN0ZW5jZUtleSksIHRoaXMuYXIgPSB0aGlzLmFyLmluc2VydCh0aGlzLmlyLCBuZXcgT28pLCB0aGlzLmRyID0gbmV3IFJlZ0V4cChgXmZpcmVzdG9yZV9jbGllbnRzXyR7cn1fKFteX10qKSRgKSwgXG4gICAgICAgIHRoaXMuX3IgPSBuZXcgUmVnRXhwKGBeZmlyZXN0b3JlX211dGF0aW9uc18ke3J9XyhcXFxcZCspKD86XyguKikpPyRgKSwgdGhpcy53ciA9IG5ldyBSZWdFeHAoYF5maXJlc3RvcmVfdGFyZ2V0c18ke3J9XyhcXFxcZCspJGApLCBcbiAgICAgICAgdGhpcy5tciA9IFxuICAgICAgICAvKiogQXNzZW1ibGVzIHRoZSBrZXkgZm9yIHRoZSBvbmxpbmUgc3RhdGUgb2YgdGhlIHByaW1hcnkgdGFiLiAqL1xuICAgICAgICBmdW5jdGlvbih0KSB7XG4gICAgICAgICAgICByZXR1cm4gYGZpcmVzdG9yZV9vbmxpbmVfc3RhdGVfJHt0fWA7XG4gICAgICAgIH1cbiAgICAgICAgLy8gVGhlIFdlYlN0b3JhZ2UgcHJlZml4IHRoYXQgcGxheXMgYXMgYSBldmVudCB0byBpbmRpY2F0ZSB0aGUgcmVtb3RlIGRvY3VtZW50c1xuICAgICAgICAvLyBtaWdodCBoYXZlIGNoYW5nZWQgZHVlIHRvIHNvbWUgc2Vjb25kYXJ5IHRhYnMgbG9hZGluZyBhIGJ1bmRsZS5cbiAgICAgICAgLy8gZm9ybWF0IG9mIHRoZSBrZXkgaXM6XG4gICAgICAgIC8vICAgICBmaXJlc3RvcmVfYnVuZGxlX2xvYWRlZF92Ml88cGVyc2lzdGVuY2VLZXk+XG4gICAgICAgIC8vIFRoZSB2ZXJzaW9uIGVuZGluZyB3aXRoIFwidjJcIiBzdG9yZXMgdGhlIGxpc3Qgb2YgbW9kaWZpZWQgY29sbGVjdGlvbiBncm91cHMuXG4gICAgICAgICh0aGlzLnBlcnNpc3RlbmNlS2V5KSwgdGhpcy5nciA9IGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgICAgIHJldHVybiBgZmlyZXN0b3JlX2J1bmRsZV9sb2FkZWRfdjJfJHt0fWA7XG4gICAgICAgIH1cbiAgICAgICAgLy8gVGhlIFdlYlN0b3JhZ2Uga2V5IHByZWZpeCBmb3IgdGhlIGtleSB0aGF0IHN0b3JlcyB0aGUgbGFzdCBzZXF1ZW5jZSBudW1iZXIgYWxsb2NhdGVkLiBUaGUga2V5XG4gICAgICAgIC8vIGxvb2tzIGxpa2UgJ2ZpcmVzdG9yZV9zZXF1ZW5jZV9udW1iZXJfPHBlcnNpc3RlbmNlX3ByZWZpeD4nLlxuICAgICAgICAodGhpcy5wZXJzaXN0ZW5jZUtleSksIFxuICAgICAgICAvLyBSYXRoZXIgdGhhbiBhZGRpbmcgdGhlIHN0b3JhZ2Ugb2JzZXJ2ZXIgZHVyaW5nIHN0YXJ0KCksIHdlIGFkZCB0aGVcbiAgICAgICAgLy8gc3RvcmFnZSBvYnNlcnZlciBkdXJpbmcgaW5pdGlhbGl6YXRpb24uIFRoaXMgZW5zdXJlcyB0aGF0IHdlIGNvbGxlY3RcbiAgICAgICAgLy8gZXZlbnRzIGJlZm9yZSBvdGhlciBjb21wb25lbnRzIHBvcHVsYXRlIHRoZWlyIGluaXRpYWwgc3RhdGUgKGR1cmluZyB0aGVpclxuICAgICAgICAvLyByZXNwZWN0aXZlIHN0YXJ0KCkgY2FsbHMpLiBPdGhlcndpc2UsIHdlIG1pZ2h0IGZvciBleGFtcGxlIG1pc3MgYVxuICAgICAgICAvLyBtdXRhdGlvbiB0aGF0IGlzIGFkZGVkIGFmdGVyIExvY2FsU3RvcmUncyBzdGFydCgpIHByb2Nlc3NlZCB0aGUgZXhpc3RpbmdcbiAgICAgICAgLy8gbXV0YXRpb25zIGJ1dCBiZWZvcmUgd2Ugb2JzZXJ2ZSBXZWJTdG9yYWdlIGV2ZW50cy5cbiAgICAgICAgdGhpcy53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcInN0b3JhZ2VcIiwgdGhpcy5ycik7XG4gICAgfVxuICAgIC8qKiBSZXR1cm5zICd0cnVlJyBpZiBXZWJTdG9yYWdlIGlzIGF2YWlsYWJsZSBpbiB0aGUgY3VycmVudCBlbnZpcm9ubWVudC4gKi8gICAgc3RhdGljIHZ0KHQpIHtcbiAgICAgICAgcmV0dXJuICEoIXQgfHwgIXQubG9jYWxTdG9yYWdlKTtcbiAgICB9XG4gICAgYXN5bmMgc3RhcnQoKSB7XG4gICAgICAgIC8vIFJldHJpZXZlIHRoZSBsaXN0IG9mIGV4aXN0aW5nIGNsaWVudHMgdG8gYmFja2ZpbGwgdGhlIGRhdGEgaW5cbiAgICAgICAgLy8gU2hhcmVkQ2xpZW50U3RhdGUuXG4gICAgICAgIGNvbnN0IHQgPSBhd2FpdCB0aGlzLnN5bmNFbmdpbmUuRnMoKTtcbiAgICAgICAgZm9yIChjb25zdCBlIG9mIHQpIHtcbiAgICAgICAgICAgIGlmIChlID09PSB0aGlzLmlyKSBjb250aW51ZTtcbiAgICAgICAgICAgIGNvbnN0IHQgPSB0aGlzLmdldEl0ZW0oU28odGhpcy5wZXJzaXN0ZW5jZUtleSwgZSkpO1xuICAgICAgICAgICAgaWYgKHQpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBuID0ga28udHIoZSwgdCk7XG4gICAgICAgICAgICAgICAgbiAmJiAodGhpcy5hciA9IHRoaXMuYXIuaW5zZXJ0KG4uY2xpZW50SWQsIG4pKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLnlyKCk7XG4gICAgICAgIC8vIENoZWNrIGlmIHRoZXJlIGlzIGFuIGV4aXN0aW5nIG9ubGluZSBzdGF0ZSBhbmQgY2FsbCB0aGUgY2FsbGJhY2sgaGFuZGxlclxuICAgICAgICAvLyBpZiBhcHBsaWNhYmxlLlxuICAgICAgICBjb25zdCBlID0gdGhpcy5zdG9yYWdlLmdldEl0ZW0odGhpcy5tcik7XG4gICAgICAgIGlmIChlKSB7XG4gICAgICAgICAgICBjb25zdCB0ID0gdGhpcy5wcihlKTtcbiAgICAgICAgICAgIHQgJiYgdGhpcy5Jcih0KTtcbiAgICAgICAgfVxuICAgICAgICBmb3IgKGNvbnN0IHQgb2YgdGhpcy5jcikgdGhpcy51cih0KTtcbiAgICAgICAgdGhpcy5jciA9IFtdLCBcbiAgICAgICAgLy8gUmVnaXN0ZXIgYSB3aW5kb3cgdW5sb2FkIGhvb2sgdG8gcmVtb3ZlIHRoZSBjbGllbnQgbWV0YWRhdGEgZW50cnkgZnJvbVxuICAgICAgICAvLyBXZWJTdG9yYWdlIGV2ZW4gaWYgYHNodXRkb3duKClgIHdhcyBub3QgY2FsbGVkLlxuICAgICAgICB0aGlzLndpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwicGFnZWhpZGVcIiwgKCgpID0+IHRoaXMuc2h1dGRvd24oKSkpLCB0aGlzLnN0YXJ0ZWQgPSAhMDtcbiAgICB9XG4gICAgd3JpdGVTZXF1ZW5jZU51bWJlcih0KSB7XG4gICAgICAgIHRoaXMuc2V0SXRlbSh0aGlzLmxyLCBKU09OLnN0cmluZ2lmeSh0KSk7XG4gICAgfVxuICAgIGdldEFsbEFjdGl2ZVF1ZXJ5VGFyZ2V0cygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuVHIodGhpcy5hcik7XG4gICAgfVxuICAgIGlzQWN0aXZlUXVlcnlUYXJnZXQodCkge1xuICAgICAgICBsZXQgZSA9ICExO1xuICAgICAgICByZXR1cm4gdGhpcy5hci5mb3JFYWNoKCgobiwgcykgPT4ge1xuICAgICAgICAgICAgcy5hY3RpdmVUYXJnZXRJZHMuaGFzKHQpICYmIChlID0gITApO1xuICAgICAgICB9KSksIGU7XG4gICAgfVxuICAgIGFkZFBlbmRpbmdNdXRhdGlvbih0KSB7XG4gICAgICAgIHRoaXMuRXIodCwgXCJwZW5kaW5nXCIpO1xuICAgIH1cbiAgICB1cGRhdGVNdXRhdGlvblN0YXRlKHQsIGUsIG4pIHtcbiAgICAgICAgdGhpcy5Fcih0LCBlLCBuKSwgXG4gICAgICAgIC8vIE9uY2UgYSBmaW5hbCBtdXRhdGlvbiByZXN1bHQgaXMgb2JzZXJ2ZWQgYnkgb3RoZXIgY2xpZW50cywgdGhleSBubyBsb25nZXJcbiAgICAgICAgLy8gYWNjZXNzIHRoZSBtdXRhdGlvbidzIG1ldGFkYXRhIGVudHJ5LiBTaW5jZSBXZWJTdG9yYWdlIHJlcGxheXMgZXZlbnRzXG4gICAgICAgIC8vIGluIG9yZGVyLCBpdCBpcyBzYWZlIHRvIGRlbGV0ZSB0aGUgZW50cnkgcmlnaHQgYWZ0ZXIgdXBkYXRpbmcgaXQuXG4gICAgICAgIHRoaXMuQXIodCk7XG4gICAgfVxuICAgIGFkZExvY2FsUXVlcnlUYXJnZXQodCkge1xuICAgICAgICBsZXQgZSA9IFwibm90LWN1cnJlbnRcIjtcbiAgICAgICAgLy8gTG9va3VwIGFuIGV4aXN0aW5nIHF1ZXJ5IHN0YXRlIGlmIHRoZSB0YXJnZXQgSUQgd2FzIGFscmVhZHkgcmVnaXN0ZXJlZFxuICAgICAgICAvLyBieSBhbm90aGVyIHRhYlxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzQWN0aXZlUXVlcnlUYXJnZXQodCkpIHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSB0aGlzLnN0b3JhZ2UuZ2V0SXRlbShDbyh0aGlzLnBlcnNpc3RlbmNlS2V5LCB0KSk7XG4gICAgICAgICAgICBpZiAobikge1xuICAgICAgICAgICAgICAgIGNvbnN0IHMgPSBOby50cih0LCBuKTtcbiAgICAgICAgICAgICAgICBzICYmIChlID0gcy5zdGF0ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuUnIubnIodCksIHRoaXMueXIoKSwgZTtcbiAgICB9XG4gICAgcmVtb3ZlTG9jYWxRdWVyeVRhcmdldCh0KSB7XG4gICAgICAgIHRoaXMuUnIuc3IodCksIHRoaXMueXIoKTtcbiAgICB9XG4gICAgaXNMb2NhbFF1ZXJ5VGFyZ2V0KHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuUnIuYWN0aXZlVGFyZ2V0SWRzLmhhcyh0KTtcbiAgICB9XG4gICAgY2xlYXJRdWVyeVN0YXRlKHQpIHtcbiAgICAgICAgdGhpcy5yZW1vdmVJdGVtKENvKHRoaXMucGVyc2lzdGVuY2VLZXksIHQpKTtcbiAgICB9XG4gICAgdXBkYXRlUXVlcnlTdGF0ZSh0LCBlLCBuKSB7XG4gICAgICAgIHRoaXMuYnIodCwgZSwgbik7XG4gICAgfVxuICAgIGhhbmRsZVVzZXJDaGFuZ2UodCwgZSwgbikge1xuICAgICAgICBlLmZvckVhY2goKHQgPT4ge1xuICAgICAgICAgICAgdGhpcy5Bcih0KTtcbiAgICAgICAgfSkpLCB0aGlzLmN1cnJlbnRVc2VyID0gdCwgbi5mb3JFYWNoKCh0ID0+IHtcbiAgICAgICAgICAgIHRoaXMuYWRkUGVuZGluZ011dGF0aW9uKHQpO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIHNldE9ubGluZVN0YXRlKHQpIHtcbiAgICAgICAgdGhpcy5Qcih0KTtcbiAgICB9XG4gICAgbm90aWZ5QnVuZGxlTG9hZGVkKHQpIHtcbiAgICAgICAgdGhpcy5Wcih0KTtcbiAgICB9XG4gICAgc2h1dGRvd24oKSB7XG4gICAgICAgIHRoaXMuc3RhcnRlZCAmJiAodGhpcy53aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInN0b3JhZ2VcIiwgdGhpcy5yciksIHRoaXMucmVtb3ZlSXRlbSh0aGlzLmhyKSwgXG4gICAgICAgIHRoaXMuc3RhcnRlZCA9ICExKTtcbiAgICB9XG4gICAgZ2V0SXRlbSh0KSB7XG4gICAgICAgIGNvbnN0IGUgPSB0aGlzLnN0b3JhZ2UuZ2V0SXRlbSh0KTtcbiAgICAgICAgcmV0dXJuIE8oXCJTaGFyZWRDbGllbnRTdGF0ZVwiLCBcIlJFQURcIiwgdCwgZSksIGU7XG4gICAgfVxuICAgIHNldEl0ZW0odCwgZSkge1xuICAgICAgICBPKFwiU2hhcmVkQ2xpZW50U3RhdGVcIiwgXCJTRVRcIiwgdCwgZSksIHRoaXMuc3RvcmFnZS5zZXRJdGVtKHQsIGUpO1xuICAgIH1cbiAgICByZW1vdmVJdGVtKHQpIHtcbiAgICAgICAgTyhcIlNoYXJlZENsaWVudFN0YXRlXCIsIFwiUkVNT1ZFXCIsIHQpLCB0aGlzLnN0b3JhZ2UucmVtb3ZlSXRlbSh0KTtcbiAgICB9XG4gICAgdXIodCkge1xuICAgICAgICAvLyBOb3RlOiBUaGUgZnVuY3Rpb24gaXMgdHlwZWQgdG8gdGFrZSBFdmVudCB0byBiZSBpbnRlcmZhY2UtY29tcGF0aWJsZSB3aXRoXG4gICAgICAgIC8vIGBXaW5kb3cuYWRkRXZlbnRMaXN0ZW5lcmAuXG4gICAgICAgIGNvbnN0IGUgPSB0O1xuICAgICAgICBpZiAoZS5zdG9yYWdlQXJlYSA9PT0gdGhpcy5zdG9yYWdlKSB7XG4gICAgICAgICAgICBpZiAoTyhcIlNoYXJlZENsaWVudFN0YXRlXCIsIFwiRVZFTlRcIiwgZS5rZXksIGUubmV3VmFsdWUpLCBlLmtleSA9PT0gdGhpcy5ocikgcmV0dXJuIHZvaWQgRihcIlJlY2VpdmVkIFdlYlN0b3JhZ2Ugbm90aWZpY2F0aW9uIGZvciBsb2NhbCBjaGFuZ2UuIEFub3RoZXIgY2xpZW50IG1pZ2h0IGhhdmUgZ2FyYmFnZS1jb2xsZWN0ZWQgb3VyIHN0YXRlXCIpO1xuICAgICAgICAgICAgdGhpcy5Zbi5lbnF1ZXVlUmV0cnlhYmxlKChhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc3RhcnRlZCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAobnVsbCAhPT0gZS5rZXkpIGlmICh0aGlzLmRyLnRlc3QoZS5rZXkpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobnVsbCA9PSBlLm5ld1ZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdCA9IHRoaXMudnIoZS5rZXkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLlNyKHQsIG51bGwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHQgPSB0aGlzLkRyKGUua2V5LCBlLm5ld1ZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodCkgcmV0dXJuIHRoaXMuU3IodC5jbGllbnRJZCwgdCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5fci50ZXN0KGUua2V5KSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG51bGwgIT09IGUubmV3VmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0ID0gdGhpcy5DcihlLmtleSwgZS5uZXdWYWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHQpIHJldHVybiB0aGlzLk5yKHQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMud3IudGVzdChlLmtleSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChudWxsICE9PSBlLm5ld1ZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdCA9IHRoaXMua3IoZS5rZXksIGUubmV3VmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0KSByZXR1cm4gdGhpcy5Ncih0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlLmtleSA9PT0gdGhpcy5tcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG51bGwgIT09IGUubmV3VmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0ID0gdGhpcy5wcihlLm5ld1ZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodCkgcmV0dXJuIHRoaXMuSXIodCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZS5rZXkgPT09IHRoaXMubHIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHQgPSBmdW5jdGlvbih0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGUgPSBudC5BO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChudWxsICE9IHQpIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG4gPSBKU09OLnBhcnNlKHQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBVKFwibnVtYmVyXCIgPT0gdHlwZW9mIG4pLCBlID0gbjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoICh0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEYoXCJTaGFyZWRDbGllbnRTdGF0ZVwiLCBcIkZhaWxlZCB0byByZWFkIHNlcXVlbmNlIG51bWJlciBmcm9tIFdlYlN0b3JhZ2VcIiwgdCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgLyoqXG4gKiBgTWVtb3J5U2hhcmVkQ2xpZW50U3RhdGVgIGlzIGEgc2ltcGxlIGltcGxlbWVudGF0aW9uIG9mIFNoYXJlZENsaWVudFN0YXRlIGZvclxuICogY2xpZW50cyB1c2luZyBtZW1vcnkgcGVyc2lzdGVuY2UuIFRoZSBzdGF0ZSBpbiB0aGlzIGNsYXNzIHJlbWFpbnMgZnVsbHlcbiAqIGlzb2xhdGVkIGFuZCBubyBzeW5jaHJvbml6YXRpb24gaXMgcGVyZm9ybWVkLlxuICovIChlLm5ld1ZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHQgIT09IG50LkEgJiYgdGhpcy5zZXF1ZW5jZU51bWJlckhhbmRsZXIodCk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZS5rZXkgPT09IHRoaXMuZ3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHQgPSB0aGlzLk9yKGUubmV3VmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgUHJvbWlzZS5hbGwodC5tYXAoKHQgPT4gdGhpcy5zeW5jRW5naW5lLkZyKHQpKSkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHRoaXMuY3IucHVzaChlKTtcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXQgUnIoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmFyLmdldCh0aGlzLmlyKTtcbiAgICB9XG4gICAgeXIoKSB7XG4gICAgICAgIHRoaXMuc2V0SXRlbSh0aGlzLmhyLCB0aGlzLlJyLmVyKCkpO1xuICAgIH1cbiAgICBFcih0LCBlLCBuKSB7XG4gICAgICAgIGNvbnN0IHMgPSBuZXcgeG8odGhpcy5jdXJyZW50VXNlciwgdCwgZSwgbiksIGkgPSBEbyh0aGlzLnBlcnNpc3RlbmNlS2V5LCB0aGlzLmN1cnJlbnRVc2VyLCB0KTtcbiAgICAgICAgdGhpcy5zZXRJdGVtKGksIHMuZXIoKSk7XG4gICAgfVxuICAgIEFyKHQpIHtcbiAgICAgICAgY29uc3QgZSA9IERvKHRoaXMucGVyc2lzdGVuY2VLZXksIHRoaXMuY3VycmVudFVzZXIsIHQpO1xuICAgICAgICB0aGlzLnJlbW92ZUl0ZW0oZSk7XG4gICAgfVxuICAgIFByKHQpIHtcbiAgICAgICAgY29uc3QgZSA9IHtcbiAgICAgICAgICAgIGNsaWVudElkOiB0aGlzLmlyLFxuICAgICAgICAgICAgb25saW5lU3RhdGU6IHRcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5zdG9yYWdlLnNldEl0ZW0odGhpcy5tciwgSlNPTi5zdHJpbmdpZnkoZSkpO1xuICAgIH1cbiAgICBicih0LCBlLCBuKSB7XG4gICAgICAgIGNvbnN0IHMgPSBDbyh0aGlzLnBlcnNpc3RlbmNlS2V5LCB0KSwgaSA9IG5ldyBObyh0LCBlLCBuKTtcbiAgICAgICAgdGhpcy5zZXRJdGVtKHMsIGkuZXIoKSk7XG4gICAgfVxuICAgIFZyKHQpIHtcbiAgICAgICAgY29uc3QgZSA9IEpTT04uc3RyaW5naWZ5KEFycmF5LmZyb20odCkpO1xuICAgICAgICB0aGlzLnNldEl0ZW0odGhpcy5nciwgZSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFBhcnNlcyBhIGNsaWVudCBzdGF0ZSBrZXkgaW4gV2ViU3RvcmFnZS4gUmV0dXJucyBudWxsIGlmIHRoZSBrZXkgZG9lcyBub3RcbiAgICAgKiBtYXRjaCB0aGUgZXhwZWN0ZWQga2V5IGZvcm1hdC5cbiAgICAgKi8gICAgdnIodCkge1xuICAgICAgICBjb25zdCBlID0gdGhpcy5kci5leGVjKHQpO1xuICAgICAgICByZXR1cm4gZSA/IGVbMV0gOiBudWxsO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBQYXJzZXMgYSBjbGllbnQgc3RhdGUgaW4gV2ViU3RvcmFnZS4gUmV0dXJucyAnbnVsbCcgaWYgdGhlIHZhbHVlIGNvdWxkIG5vdFxuICAgICAqIGJlIHBhcnNlZC5cbiAgICAgKi8gICAgRHIodCwgZSkge1xuICAgICAgICBjb25zdCBuID0gdGhpcy52cih0KTtcbiAgICAgICAgcmV0dXJuIGtvLnRyKG4sIGUpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBQYXJzZXMgYSBtdXRhdGlvbiBiYXRjaCBzdGF0ZSBpbiBXZWJTdG9yYWdlLiBSZXR1cm5zICdudWxsJyBpZiB0aGUgdmFsdWVcbiAgICAgKiBjb3VsZCBub3QgYmUgcGFyc2VkLlxuICAgICAqLyAgICBDcih0LCBlKSB7XG4gICAgICAgIGNvbnN0IG4gPSB0aGlzLl9yLmV4ZWModCksIHMgPSBOdW1iZXIoblsxXSksIGkgPSB2b2lkIDAgIT09IG5bMl0gPyBuWzJdIDogbnVsbDtcbiAgICAgICAgcmV0dXJuIHhvLnRyKG5ldyBDKGkpLCBzLCBlKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUGFyc2VzIGEgcXVlcnkgdGFyZ2V0IHN0YXRlIGZyb20gV2ViU3RvcmFnZS4gUmV0dXJucyAnbnVsbCcgaWYgdGhlIHZhbHVlXG4gICAgICogY291bGQgbm90IGJlIHBhcnNlZC5cbiAgICAgKi8gICAga3IodCwgZSkge1xuICAgICAgICBjb25zdCBuID0gdGhpcy53ci5leGVjKHQpLCBzID0gTnVtYmVyKG5bMV0pO1xuICAgICAgICByZXR1cm4gTm8udHIocywgZSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFBhcnNlcyBhbiBvbmxpbmUgc3RhdGUgZnJvbSBXZWJTdG9yYWdlLiBSZXR1cm5zICdudWxsJyBpZiB0aGUgdmFsdWVcbiAgICAgKiBjb3VsZCBub3QgYmUgcGFyc2VkLlxuICAgICAqLyAgICBwcih0KSB7XG4gICAgICAgIHJldHVybiBNby50cih0KTtcbiAgICB9XG4gICAgT3IodCkge1xuICAgICAgICByZXR1cm4gSlNPTi5wYXJzZSh0KTtcbiAgICB9XG4gICAgYXN5bmMgTnIodCkge1xuICAgICAgICBpZiAodC51c2VyLnVpZCA9PT0gdGhpcy5jdXJyZW50VXNlci51aWQpIHJldHVybiB0aGlzLnN5bmNFbmdpbmUuJHIodC5iYXRjaElkLCB0LnN0YXRlLCB0LmVycm9yKTtcbiAgICAgICAgTyhcIlNoYXJlZENsaWVudFN0YXRlXCIsIGBJZ25vcmluZyBtdXRhdGlvbiBmb3Igbm9uLWFjdGl2ZSB1c2VyICR7dC51c2VyLnVpZH1gKTtcbiAgICB9XG4gICAgTXIodCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zeW5jRW5naW5lLkJyKHQudGFyZ2V0SWQsIHQuc3RhdGUsIHQuZXJyb3IpO1xuICAgIH1cbiAgICBTcih0LCBlKSB7XG4gICAgICAgIGNvbnN0IG4gPSBlID8gdGhpcy5hci5pbnNlcnQodCwgZSkgOiB0aGlzLmFyLnJlbW92ZSh0KSwgcyA9IHRoaXMuVHIodGhpcy5hciksIGkgPSB0aGlzLlRyKG4pLCByID0gW10sIG8gPSBbXTtcbiAgICAgICAgcmV0dXJuIGkuZm9yRWFjaCgodCA9PiB7XG4gICAgICAgICAgICBzLmhhcyh0KSB8fCByLnB1c2godCk7XG4gICAgICAgIH0pKSwgcy5mb3JFYWNoKCh0ID0+IHtcbiAgICAgICAgICAgIGkuaGFzKHQpIHx8IG8ucHVzaCh0KTtcbiAgICAgICAgfSkpLCB0aGlzLnN5bmNFbmdpbmUuTHIociwgbykudGhlbigoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5hciA9IG47XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgSXIodCkge1xuICAgICAgICAvLyBXZSBjaGVjayB3aGV0aGVyIHRoZSBjbGllbnQgdGhhdCB3cm90ZSB0aGlzIG9ubGluZSBzdGF0ZSBpcyBzdGlsbCBhY3RpdmVcbiAgICAgICAgLy8gYnkgY29tcGFyaW5nIGl0cyBjbGllbnQgSUQgdG8gdGhlIGxpc3Qgb2YgY2xpZW50cyBrZXB0IGFjdGl2ZSBpblxuICAgICAgICAvLyBJbmRleGVkRGIuIElmIGEgY2xpZW50IGRvZXMgbm90IHVwZGF0ZSB0aGVpciBJbmRleGVkRGIgY2xpZW50IHN0YXRlXG4gICAgICAgIC8vIHdpdGhpbiA1IHNlY29uZHMsIGl0IGlzIGNvbnNpZGVyZWQgaW5hY3RpdmUgYW5kIHdlIGRvbid0IGVtaXQgYW4gb25saW5lXG4gICAgICAgIC8vIHN0YXRlIGV2ZW50LlxuICAgICAgICB0aGlzLmFyLmdldCh0LmNsaWVudElkKSAmJiB0aGlzLm9ubGluZVN0YXRlSGFuZGxlcih0Lm9ubGluZVN0YXRlKTtcbiAgICB9XG4gICAgVHIodCkge1xuICAgICAgICBsZXQgZSA9IFpuKCk7XG4gICAgICAgIHJldHVybiB0LmZvckVhY2goKCh0LCBuKSA9PiB7XG4gICAgICAgICAgICBlID0gZS51bmlvbldpdGgobi5hY3RpdmVUYXJnZXRJZHMpO1xuICAgICAgICB9KSksIGU7XG4gICAgfVxufVxuXG5jbGFzcyAkbyB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMuVXIgPSBuZXcgT28sIHRoaXMucXIgPSB7fSwgdGhpcy5vbmxpbmVTdGF0ZUhhbmRsZXIgPSBudWxsLCB0aGlzLnNlcXVlbmNlTnVtYmVySGFuZGxlciA9IG51bGw7XG4gICAgfVxuICAgIGFkZFBlbmRpbmdNdXRhdGlvbih0KSB7XG4gICAgICAgIC8vIE5vIG9wLlxuICAgIH1cbiAgICB1cGRhdGVNdXRhdGlvblN0YXRlKHQsIGUsIG4pIHtcbiAgICAgICAgLy8gTm8gb3AuXG4gICAgfVxuICAgIGFkZExvY2FsUXVlcnlUYXJnZXQodCkge1xuICAgICAgICByZXR1cm4gdGhpcy5Vci5ucih0KSwgdGhpcy5xclt0XSB8fCBcIm5vdC1jdXJyZW50XCI7XG4gICAgfVxuICAgIHVwZGF0ZVF1ZXJ5U3RhdGUodCwgZSwgbikge1xuICAgICAgICB0aGlzLnFyW3RdID0gZTtcbiAgICB9XG4gICAgcmVtb3ZlTG9jYWxRdWVyeVRhcmdldCh0KSB7XG4gICAgICAgIHRoaXMuVXIuc3IodCk7XG4gICAgfVxuICAgIGlzTG9jYWxRdWVyeVRhcmdldCh0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLlVyLmFjdGl2ZVRhcmdldElkcy5oYXModCk7XG4gICAgfVxuICAgIGNsZWFyUXVlcnlTdGF0ZSh0KSB7XG4gICAgICAgIGRlbGV0ZSB0aGlzLnFyW3RdO1xuICAgIH1cbiAgICBnZXRBbGxBY3RpdmVRdWVyeVRhcmdldHMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLlVyLmFjdGl2ZVRhcmdldElkcztcbiAgICB9XG4gICAgaXNBY3RpdmVRdWVyeVRhcmdldCh0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLlVyLmFjdGl2ZVRhcmdldElkcy5oYXModCk7XG4gICAgfVxuICAgIHN0YXJ0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5VciA9IG5ldyBPbywgUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgfVxuICAgIGhhbmRsZVVzZXJDaGFuZ2UodCwgZSwgbikge1xuICAgICAgICAvLyBObyBvcC5cbiAgICB9XG4gICAgc2V0T25saW5lU3RhdGUodCkge1xuICAgICAgICAvLyBObyBvcC5cbiAgICB9XG4gICAgc2h1dGRvd24oKSB7fVxuICAgIHdyaXRlU2VxdWVuY2VOdW1iZXIodCkge31cbiAgICBub3RpZnlCdW5kbGVMb2FkZWQodCkge1xuICAgICAgICAvLyBObyBvcC5cbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovIGNsYXNzIEJvIHtcbiAgICBLcih0KSB7XG4gICAgICAgIC8vIE5vLW9wLlxuICAgIH1cbiAgICBzaHV0ZG93bigpIHtcbiAgICAgICAgLy8gTm8tb3AuXG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLy8gUmVmZXJlbmNlcyB0byBgd2luZG93YCBhcmUgZ3VhcmRlZCBieSBCcm93c2VyQ29ubmVjdGl2aXR5TW9uaXRvci5pc0F2YWlsYWJsZSgpXG4vKiBlc2xpbnQtZGlzYWJsZSBuby1yZXN0cmljdGVkLWdsb2JhbHMgKi9cbi8qKlxuICogQnJvd3NlciBpbXBsZW1lbnRhdGlvbiBvZiBDb25uZWN0aXZpdHlNb25pdG9yLlxuICovXG5jbGFzcyBMbyB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMuR3IgPSAoKSA9PiB0aGlzLlFyKCksIHRoaXMuanIgPSAoKSA9PiB0aGlzLldyKCksIHRoaXMuenIgPSBbXSwgdGhpcy5IcigpO1xuICAgIH1cbiAgICBLcih0KSB7XG4gICAgICAgIHRoaXMuenIucHVzaCh0KTtcbiAgICB9XG4gICAgc2h1dGRvd24oKSB7XG4gICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKFwib25saW5lXCIsIHRoaXMuR3IpLCB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIm9mZmxpbmVcIiwgdGhpcy5qcik7XG4gICAgfVxuICAgIEhyKCkge1xuICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcIm9ubGluZVwiLCB0aGlzLkdyKSwgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJvZmZsaW5lXCIsIHRoaXMuanIpO1xuICAgIH1cbiAgICBRcigpIHtcbiAgICAgICAgTyhcIkNvbm5lY3Rpdml0eU1vbml0b3JcIiwgXCJOZXR3b3JrIGNvbm5lY3Rpdml0eSBjaGFuZ2VkOiBBVkFJTEFCTEVcIik7XG4gICAgICAgIGZvciAoY29uc3QgdCBvZiB0aGlzLnpyKSB0KDAgLyogQVZBSUxBQkxFICovKTtcbiAgICB9XG4gICAgV3IoKSB7XG4gICAgICAgIE8oXCJDb25uZWN0aXZpdHlNb25pdG9yXCIsIFwiTmV0d29yayBjb25uZWN0aXZpdHkgY2hhbmdlZDogVU5BVkFJTEFCTEVcIik7XG4gICAgICAgIGZvciAoY29uc3QgdCBvZiB0aGlzLnpyKSB0KDEgLyogVU5BVkFJTEFCTEUgKi8pO1xuICAgIH1cbiAgICAvLyBUT0RPKGNoZW5icmlhbik6IENvbnNpZGVyIHBhc3NpbmcgaW4gd2luZG93IGVpdGhlciBpbnRvIHRoaXMgY29tcG9uZW50IG9yXG4gICAgLy8gaGVyZSBmb3IgdGVzdGluZyB2aWEgRmFrZVdpbmRvdy5cbiAgICAvKiogQ2hlY2tzIHRoYXQgYWxsIHVzZWQgYXR0cmlidXRlcyBvZiB3aW5kb3cgYXJlIGF2YWlsYWJsZS4gKi9cbiAgICBzdGF0aWMgdnQoKSB7XG4gICAgICAgIHJldHVybiBcInVuZGVmaW5lZFwiICE9IHR5cGVvZiB3aW5kb3cgJiYgdm9pZCAwICE9PSB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lciAmJiB2b2lkIDAgIT09IHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi8gY29uc3QgVW8gPSB7XG4gICAgQmF0Y2hHZXREb2N1bWVudHM6IFwiYmF0Y2hHZXRcIixcbiAgICBDb21taXQ6IFwiY29tbWl0XCIsXG4gICAgUnVuUXVlcnk6IFwicnVuUXVlcnlcIlxufTtcblxuLyoqXG4gKiBNYXBzIFJQQyBuYW1lcyB0byB0aGUgY29ycmVzcG9uZGluZyBSRVNUIGVuZHBvaW50IG5hbWUuXG4gKlxuICogV2UgdXNlIGFycmF5IG5vdGF0aW9uIHRvIGF2b2lkIG1hbmdsaW5nLlxuICovXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBQcm92aWRlcyBhIHNpbXBsZSBoZWxwZXIgY2xhc3MgdGhhdCBpbXBsZW1lbnRzIHRoZSBTdHJlYW0gaW50ZXJmYWNlIHRvXG4gKiBicmlkZ2UgdG8gb3RoZXIgaW1wbGVtZW50YXRpb25zIHRoYXQgYXJlIHN0cmVhbXMgYnV0IGRvIG5vdCBpbXBsZW1lbnQgdGhlXG4gKiBpbnRlcmZhY2UuIFRoZSBzdHJlYW0gY2FsbGJhY2tzIGFyZSBpbnZva2VkIHdpdGggdGhlIGNhbGxPbi4uLiBtZXRob2RzLlxuICovXG5jbGFzcyBxbyB7XG4gICAgY29uc3RydWN0b3IodCkge1xuICAgICAgICB0aGlzLkpyID0gdC5KciwgdGhpcy5ZciA9IHQuWXI7XG4gICAgfVxuICAgIFhyKHQpIHtcbiAgICAgICAgdGhpcy5aciA9IHQ7XG4gICAgfVxuICAgIGVvKHQpIHtcbiAgICAgICAgdGhpcy5ubyA9IHQ7XG4gICAgfVxuICAgIG9uTWVzc2FnZSh0KSB7XG4gICAgICAgIHRoaXMuc28gPSB0O1xuICAgIH1cbiAgICBjbG9zZSgpIHtcbiAgICAgICAgdGhpcy5ZcigpO1xuICAgIH1cbiAgICBzZW5kKHQpIHtcbiAgICAgICAgdGhpcy5Kcih0KTtcbiAgICB9XG4gICAgaW8oKSB7XG4gICAgICAgIHRoaXMuWnIoKTtcbiAgICB9XG4gICAgcm8odCkge1xuICAgICAgICB0aGlzLm5vKHQpO1xuICAgIH1cbiAgICBvbyh0KSB7XG4gICAgICAgIHRoaXMuc28odCk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqLyBjbGFzcyBLbyBleHRlbmRzIFxuLyoqXG4gKiBCYXNlIGNsYXNzIGZvciBhbGwgUmVzdC1iYXNlZCBjb25uZWN0aW9ucyB0byB0aGUgYmFja2VuZCAoV2ViQ2hhbm5lbCBhbmRcbiAqIEhUVFApLlxuICovXG5jbGFzcyB7XG4gICAgY29uc3RydWN0b3IodCkge1xuICAgICAgICB0aGlzLmRhdGFiYXNlSW5mbyA9IHQsIHRoaXMuZGF0YWJhc2VJZCA9IHQuZGF0YWJhc2VJZDtcbiAgICAgICAgY29uc3QgZSA9IHQuc3NsID8gXCJodHRwc1wiIDogXCJodHRwXCI7XG4gICAgICAgIHRoaXMudW8gPSBlICsgXCI6Ly9cIiArIHQuaG9zdCwgdGhpcy5hbyA9IFwicHJvamVjdHMvXCIgKyB0aGlzLmRhdGFiYXNlSWQucHJvamVjdElkICsgXCIvZGF0YWJhc2VzL1wiICsgdGhpcy5kYXRhYmFzZUlkLmRhdGFiYXNlICsgXCIvZG9jdW1lbnRzXCI7XG4gICAgfVxuICAgIGNvKHQsIGUsIG4sIHMsIGkpIHtcbiAgICAgICAgY29uc3QgciA9IHRoaXMuaG8odCwgZSk7XG4gICAgICAgIE8oXCJSZXN0Q29ubmVjdGlvblwiLCBcIlNlbmRpbmc6IFwiLCByLCBuKTtcbiAgICAgICAgY29uc3QgbyA9IHt9O1xuICAgICAgICByZXR1cm4gdGhpcy5sbyhvLCBzLCBpKSwgdGhpcy5mbyh0LCByLCBvLCBuKS50aGVuKCh0ID0+IChPKFwiUmVzdENvbm5lY3Rpb25cIiwgXCJSZWNlaXZlZDogXCIsIHQpLCBcbiAgICAgICAgdCkpLCAoZSA9PiB7XG4gICAgICAgICAgICB0aHJvdyAkKFwiUmVzdENvbm5lY3Rpb25cIiwgYCR7dH0gZmFpbGVkIHdpdGggZXJyb3I6IGAsIGUsIFwidXJsOiBcIiwgciwgXCJyZXF1ZXN0OlwiLCBuKSwgXG4gICAgICAgICAgICBlO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIF9vKHQsIGUsIG4sIHMsIGkpIHtcbiAgICAgICAgLy8gVGhlIFJFU1QgQVBJIGF1dG9tYXRpY2FsbHkgYWdncmVnYXRlcyBhbGwgb2YgdGhlIHN0cmVhbWVkIHJlc3VsdHMsIHNvIHdlXG4gICAgICAgIC8vIGNhbiBqdXN0IHVzZSB0aGUgbm9ybWFsIGludm9rZSgpIG1ldGhvZC5cbiAgICAgICAgcmV0dXJuIHRoaXMuY28odCwgZSwgbiwgcywgaSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIE1vZGlmaWVzIHRoZSBoZWFkZXJzIGZvciBhIHJlcXVlc3QsIGFkZGluZyBhbnkgYXV0aG9yaXphdGlvbiB0b2tlbiBpZlxuICAgICAqIHByZXNlbnQgYW5kIGFueSBhZGRpdGlvbmFsIGhlYWRlcnMgZm9yIHRoZSByZXF1ZXN0LlxuICAgICAqLyAgICBsbyh0LCBlLCBuKSB7XG4gICAgICAgIHRbXCJYLUdvb2ctQXBpLUNsaWVudFwiXSA9IFwiZ2wtanMvIGZpcmUvXCIgKyB4LCBcbiAgICAgICAgLy8gQ29udGVudC1UeXBlOiB0ZXh0L3BsYWluIHdpbGwgYXZvaWQgcHJlZmxpZ2h0IHJlcXVlc3RzIHdoaWNoIG1pZ2h0XG4gICAgICAgIC8vIG1lc3Mgd2l0aCBDT1JTIGFuZCByZWRpcmVjdHMgYnkgcHJveGllcy4gSWYgd2UgYWRkIGN1c3RvbSBoZWFkZXJzXG4gICAgICAgIC8vIHdlIHdpbGwgbmVlZCB0byBjaGFuZ2UgdGhpcyBjb2RlIHRvIHBvdGVudGlhbGx5IHVzZSB0aGUgJGh0dHBPdmVyd3JpdGVcbiAgICAgICAgLy8gcGFyYW1ldGVyIHN1cHBvcnRlZCBieSBFU0YgdG8gYXZvaWQgdHJpZ2dlcmluZyBwcmVmbGlnaHQgcmVxdWVzdHMuXG4gICAgICAgIHRbXCJDb250ZW50LVR5cGVcIl0gPSBcInRleHQvcGxhaW5cIiwgdGhpcy5kYXRhYmFzZUluZm8uYXBwSWQgJiYgKHRbXCJYLUZpcmViYXNlLUdNUElEXCJdID0gdGhpcy5kYXRhYmFzZUluZm8uYXBwSWQpLCBcbiAgICAgICAgZSAmJiBlLmhlYWRlcnMuZm9yRWFjaCgoKGUsIG4pID0+IHRbbl0gPSBlKSksIG4gJiYgbi5oZWFkZXJzLmZvckVhY2goKChlLCBuKSA9PiB0W25dID0gZSkpO1xuICAgIH1cbiAgICBobyh0LCBlKSB7XG4gICAgICAgIGNvbnN0IG4gPSBVb1t0XTtcbiAgICAgICAgcmV0dXJuIGAke3RoaXMudW99L3YxLyR7ZX06JHtufWA7XG4gICAgfVxufSB7XG4gICAgY29uc3RydWN0b3IodCkge1xuICAgICAgICBzdXBlcih0KSwgdGhpcy5mb3JjZUxvbmdQb2xsaW5nID0gdC5mb3JjZUxvbmdQb2xsaW5nLCB0aGlzLmF1dG9EZXRlY3RMb25nUG9sbGluZyA9IHQuYXV0b0RldGVjdExvbmdQb2xsaW5nLCBcbiAgICAgICAgdGhpcy51c2VGZXRjaFN0cmVhbXMgPSB0LnVzZUZldGNoU3RyZWFtcztcbiAgICB9XG4gICAgZm8odCwgZSwgbiwgcykge1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKChpLCByKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBvID0gbmV3IFQ7XG4gICAgICAgICAgICBvLmxpc3Rlbk9uY2UoRS5DT01QTEVURSwgKCgpID0+IHtcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKG8uZ2V0TGFzdEVycm9yQ29kZSgpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgY2FzZSBBLk5PX0VSUk9SOlxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZSA9IG8uZ2V0UmVzcG9uc2VKc29uKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBPKFwiQ29ubmVjdGlvblwiLCBcIlhIUiByZWNlaXZlZDpcIiwgSlNPTi5zdHJpbmdpZnkoZSkpLCBpKGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICAgICAgICBjYXNlIEEuVElNRU9VVDpcbiAgICAgICAgICAgICAgICAgICAgICAgIE8oXCJDb25uZWN0aW9uXCIsICdSUEMgXCInICsgdCArICdcIiB0aW1lZCBvdXQnKSwgcihuZXcgUShHLkRFQURMSU5FX0VYQ0VFREVELCBcIlJlcXVlc3QgdGltZSBvdXRcIikpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICAgICAgICBjYXNlIEEuSFRUUF9FUlJPUjpcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG4gPSBvLmdldFN0YXR1cygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE8oXCJDb25uZWN0aW9uXCIsICdSUEMgXCInICsgdCArICdcIiBmYWlsZWQgd2l0aCBzdGF0dXM6JywgbiwgXCJyZXNwb25zZSB0ZXh0OlwiLCBvLmdldFJlc3BvbnNlVGV4dCgpKSwgXG4gICAgICAgICAgICAgICAgICAgICAgICBuID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHQgPSBvLmdldFJlc3BvbnNlSnNvbigpLmVycm9yO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0ICYmIHQuc3RhdHVzICYmIHQubWVzc2FnZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBlID0gZnVuY3Rpb24odCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZSA9IHQudG9Mb3dlckNhc2UoKS5yZXBsYWNlKC9fL2csIFwiLVwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBPYmplY3QudmFsdWVzKEcpLmluZGV4T2YoZSkgPj0gMCA/IGUgOiBHLlVOS05PV047XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0odC5zdGF0dXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByKG5ldyBRKGUsIHQubWVzc2FnZSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSByKG5ldyBRKEcuVU5LTk9XTiwgXCJTZXJ2ZXIgcmVzcG9uZGVkIHdpdGggc3RhdHVzIFwiICsgby5nZXRTdGF0dXMoKSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIFxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWYgd2UgcmVjZWl2ZWQgYW4gSFRUUF9FUlJPUiBidXQgdGhlcmUncyBubyBzdGF0dXMgY29kZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGl0J3MgbW9zdCBwcm9iYWJseSBhIGNvbm5lY3Rpb24gaXNzdWVcbiAgICAgICAgICAgICAgICAgICAgICAgIHIobmV3IFEoRy5VTkFWQUlMQUJMRSwgXCJDb25uZWN0aW9uIGZhaWxlZC5cIikpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgTCgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBmaW5hbGx5IHtcbiAgICAgICAgICAgICAgICAgICAgTyhcIkNvbm5lY3Rpb25cIiwgJ1JQQyBcIicgKyB0ICsgJ1wiIGNvbXBsZXRlZC4nKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICBjb25zdCB1ID0gSlNPTi5zdHJpbmdpZnkocyk7XG4gICAgICAgICAgICBvLnNlbmQoZSwgXCJQT1NUXCIsIHUsIG4sIDE1KTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICB3byh0LCBlLCBuKSB7XG4gICAgICAgIGNvbnN0IHMgPSBbIHRoaXMudW8sIFwiL1wiLCBcImdvb2dsZS5maXJlc3RvcmUudjEuRmlyZXN0b3JlXCIsIFwiL1wiLCB0LCBcIi9jaGFubmVsXCIgXSwgaSA9IFIoKSwgciA9IGIoKSwgbyA9IHtcbiAgICAgICAgICAgIC8vIFJlcXVpcmVkIGZvciBiYWNrZW5kIHN0aWNraW5lc3MsIHJvdXRpbmcgYmVoYXZpb3IgaXMgYmFzZWQgb24gdGhpc1xuICAgICAgICAgICAgLy8gcGFyYW1ldGVyLlxuICAgICAgICAgICAgaHR0cFNlc3Npb25JZFBhcmFtOiBcImdzZXNzaW9uaWRcIixcbiAgICAgICAgICAgIGluaXRNZXNzYWdlSGVhZGVyczoge30sXG4gICAgICAgICAgICBtZXNzYWdlVXJsUGFyYW1zOiB7XG4gICAgICAgICAgICAgICAgLy8gVGhpcyBwYXJhbSBpcyB1c2VkIHRvIGltcHJvdmUgcm91dGluZyBhbmQgcHJvamVjdCBpc29sYXRpb24gYnkgdGhlXG4gICAgICAgICAgICAgICAgLy8gYmFja2VuZCBhbmQgbXVzdCBiZSBpbmNsdWRlZCBpbiBldmVyeSByZXF1ZXN0LlxuICAgICAgICAgICAgICAgIGRhdGFiYXNlOiBgcHJvamVjdHMvJHt0aGlzLmRhdGFiYXNlSWQucHJvamVjdElkfS9kYXRhYmFzZXMvJHt0aGlzLmRhdGFiYXNlSWQuZGF0YWJhc2V9YFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNlbmRSYXdKc29uOiAhMCxcbiAgICAgICAgICAgIHN1cHBvcnRzQ3Jvc3NEb21haW5YaHI6ICEwLFxuICAgICAgICAgICAgaW50ZXJuYWxDaGFubmVsUGFyYW1zOiB7XG4gICAgICAgICAgICAgICAgLy8gT3ZlcnJpZGUgdGhlIGRlZmF1bHQgdGltZW91dCAocmFuZG9taXplZCBiZXR3ZWVuIDEwLTIwIHNlY29uZHMpIHNpbmNlXG4gICAgICAgICAgICAgICAgLy8gYSBsYXJnZSB3cml0ZSBiYXRjaCBvbiBhIHNsb3cgaW50ZXJuZXQgY29ubmVjdGlvbiBtYXkgdGFrZSBhIGxvbmdcbiAgICAgICAgICAgICAgICAvLyB0aW1lIHRvIHNlbmQgdG8gdGhlIGJhY2tlbmQuIFJhdGhlciB0aGFuIGhhdmUgV2ViQ2hhbm5lbCBpbXBvc2UgYVxuICAgICAgICAgICAgICAgIC8vIHRpZ2h0IHRpbWVvdXQgd2hpY2ggY291bGQgbGVhZCB0byBpbmZpbml0ZSB0aW1lb3V0cyBhbmQgcmV0cmllcywgd2VcbiAgICAgICAgICAgICAgICAvLyBzZXQgaXQgdmVyeSBsYXJnZSAoNS0xMCBtaW51dGVzKSBhbmQgcmVseSBvbiB0aGUgYnJvd3NlcidzIGJ1aWx0aW5cbiAgICAgICAgICAgICAgICAvLyB0aW1lb3V0cyB0byBraWNrIGluIGlmIHRoZSByZXF1ZXN0IGlzbid0IHdvcmtpbmcuXG4gICAgICAgICAgICAgICAgZm9yd2FyZENoYW5uZWxSZXF1ZXN0VGltZW91dE1zOiA2ZTVcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBmb3JjZUxvbmdQb2xsaW5nOiB0aGlzLmZvcmNlTG9uZ1BvbGxpbmcsXG4gICAgICAgICAgICBkZXRlY3RCdWZmZXJpbmdQcm94eTogdGhpcy5hdXRvRGV0ZWN0TG9uZ1BvbGxpbmdcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy51c2VGZXRjaFN0cmVhbXMgJiYgKG8ueG1sSHR0cEZhY3RvcnkgPSBuZXcgUCh7fSkpLCB0aGlzLmxvKG8uaW5pdE1lc3NhZ2VIZWFkZXJzLCBlLCBuKSwgXG4gICAgICAgIC8vIFNlbmRpbmcgdGhlIGN1c3RvbSBoZWFkZXJzIHdlIGp1c3QgYWRkZWQgdG8gcmVxdWVzdC5pbml0TWVzc2FnZUhlYWRlcnNcbiAgICAgICAgLy8gKEF1dGhvcml6YXRpb24sIGV0Yy4pIHdpbGwgdHJpZ2dlciB0aGUgYnJvd3NlciB0byBtYWtlIGEgQ09SUyBwcmVmbGlnaHRcbiAgICAgICAgLy8gcmVxdWVzdCBiZWNhdXNlIHRoZSBYSFIgd2lsbCBubyBsb25nZXIgbWVldCB0aGUgY3JpdGVyaWEgZm9yIGEgXCJzaW1wbGVcIlxuICAgICAgICAvLyBDT1JTIHJlcXVlc3Q6XG4gICAgICAgIC8vIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0hUVFAvQ09SUyNTaW1wbGVfcmVxdWVzdHNcbiAgICAgICAgLy8gVGhlcmVmb3JlIHRvIGF2b2lkIHRoZSBDT1JTIHByZWZsaWdodCByZXF1ZXN0IChhbiBleHRyYSBuZXR3b3JrXG4gICAgICAgIC8vIHJvdW5kdHJpcCksIHdlIHVzZSB0aGUgaHR0cEhlYWRlcnNPdmVyd3JpdGVQYXJhbSBvcHRpb24gdG8gc3BlY2lmeSB0aGF0XG4gICAgICAgIC8vIHRoZSBoZWFkZXJzIHNob3VsZCBpbnN0ZWFkIGJlIGVuY29kZWQgaW50byBhIHNwZWNpYWwgXCIkaHR0cEhlYWRlcnNcIiBxdWVyeVxuICAgICAgICAvLyBwYXJhbWV0ZXIsIHdoaWNoIGlzIHJlY29nbml6ZWQgYnkgdGhlIHdlYmNoYW5uZWwgYmFja2VuZC4gVGhpcyBpc1xuICAgICAgICAvLyBmb3JtYWxseSBkZWZpbmVkIGhlcmU6XG4gICAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9nb29nbGUvY2xvc3VyZS1saWJyYXJ5L2Jsb2IvYjBlMTgxNWIxM2ZiOTJhNDZkN2M5YjNjMzBkZTVkNmEzOTZhMzI0NS9jbG9zdXJlL2dvb2cvbmV0L3JwYy9odHRwY29ycy5qcyNMMzJcbiAgICAgICAgLy8gVE9ETyhiLzE0NTYyNDc1Nik6IFRoZXJlIGlzIGEgYmFja2VuZCBidWcgd2hlcmUgJGh0dHBIZWFkZXJzIGlzbid0IHJlc3BlY3RlZCBpZiB0aGUgcmVxdWVzdFxuICAgICAgICAvLyBkb2Vzbid0IGhhdmUgYW4gT3JpZ2luIGhlYWRlci4gU28gd2UgaGF2ZSB0byBleGNsdWRlIGEgZmV3IGJyb3dzZXIgZW52aXJvbm1lbnRzIHRoYXQgYXJlXG4gICAgICAgIC8vIGtub3duIHRvIChzb21ldGltZXMpIG5vdCBpbmNsdWRlIGFuIE9yaWdpbi4gU2VlXG4gICAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9maXJlYmFzZS9maXJlYmFzZS1qcy1zZGsvaXNzdWVzLzE0OTEuXG4gICAgICAgIGYoKSB8fCBkKCkgfHwgXygpIHx8IHcoKSB8fCBtKCkgfHwgZygpIHx8IChvLmh0dHBIZWFkZXJzT3ZlcndyaXRlUGFyYW0gPSBcIiRodHRwSGVhZGVyc1wiKTtcbiAgICAgICAgY29uc3QgdSA9IHMuam9pbihcIlwiKTtcbiAgICAgICAgTyhcIkNvbm5lY3Rpb25cIiwgXCJDcmVhdGluZyBXZWJDaGFubmVsOiBcIiArIHUsIG8pO1xuICAgICAgICBjb25zdCBhID0gaS5jcmVhdGVXZWJDaGFubmVsKHUsIG8pO1xuICAgICAgICAvLyBXZWJDaGFubmVsIHN1cHBvcnRzIHNlbmRpbmcgdGhlIGZpcnN0IG1lc3NhZ2Ugd2l0aCB0aGUgaGFuZHNoYWtlIC0gc2F2aW5nXG4gICAgICAgIC8vIGEgbmV0d29yayByb3VuZCB0cmlwLiBIb3dldmVyLCBpdCB3aWxsIGhhdmUgdG8gY2FsbCBzZW5kIGluIHRoZSBzYW1lXG4gICAgICAgIC8vIEpTIGV2ZW50IGxvb3AgYXMgb3Blbi4gSW4gb3JkZXIgdG8gZW5mb3JjZSB0aGlzLCB3ZSBkZWxheSBhY3R1YWxseVxuICAgICAgICAvLyBvcGVuaW5nIHRoZSBXZWJDaGFubmVsIHVudGlsIHNlbmQgaXMgY2FsbGVkLiBXaGV0aGVyIHdlIGhhdmUgY2FsbGVkXG4gICAgICAgIC8vIG9wZW4gaXMgdHJhY2tlZCB3aXRoIHRoaXMgdmFyaWFibGUuXG4gICAgICAgICAgICAgICAgbGV0IGMgPSAhMSwgaCA9ICExO1xuICAgICAgICAvLyBBIGZsYWcgdG8gZGV0ZXJtaW5lIHdoZXRoZXIgdGhlIHN0cmVhbSB3YXMgY2xvc2VkIChieSB1cyBvciB0aHJvdWdoIGFuXG4gICAgICAgIC8vIGVycm9yL2Nsb3NlIGV2ZW50KSB0byBhdm9pZCBkZWxpdmVyaW5nIG11bHRpcGxlIGNsb3NlIGV2ZW50cyBvciBzZW5kaW5nXG4gICAgICAgIC8vIG9uIGEgY2xvc2VkIHN0cmVhbVxuICAgICAgICAgICAgICAgIGNvbnN0IGwgPSBuZXcgcW8oe1xuICAgICAgICAgICAgSnI6IHQgPT4ge1xuICAgICAgICAgICAgICAgIGggPyBPKFwiQ29ubmVjdGlvblwiLCBcIk5vdCBzZW5kaW5nIGJlY2F1c2UgV2ViQ2hhbm5lbCBpcyBjbG9zZWQ6XCIsIHQpIDogKGMgfHwgKE8oXCJDb25uZWN0aW9uXCIsIFwiT3BlbmluZyBXZWJDaGFubmVsIHRyYW5zcG9ydC5cIiksIFxuICAgICAgICAgICAgICAgIGEub3BlbigpLCBjID0gITApLCBPKFwiQ29ubmVjdGlvblwiLCBcIldlYkNoYW5uZWwgc2VuZGluZzpcIiwgdCksIGEuc2VuZCh0KSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgWXI6ICgpID0+IGEuY2xvc2UoKVxuICAgICAgICB9KSwgeSA9ICh0LCBlLCBuKSA9PiB7XG4gICAgICAgICAgICAvLyBUT0RPKGRpbW9uZCk6IGNsb3N1cmUgdHlwaW5nIHNlZW1zIGJyb2tlbiBiZWNhdXNlIFdlYkNoYW5uZWwgZG9lc1xuICAgICAgICAgICAgLy8gbm90IGltcGxlbWVudCBnb29nLmV2ZW50cy5MaXN0ZW5hYmxlXG4gICAgICAgICAgICB0Lmxpc3RlbihlLCAodCA9PiB7XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgbih0KTtcbiAgICAgICAgICAgICAgICB9IGNhdGNoICh0KSB7XG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IHQ7XG4gICAgICAgICAgICAgICAgICAgIH0pLCAwKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KSk7XG4gICAgICAgIH07XG4gICAgICAgIC8vIENsb3N1cmUgZXZlbnRzIGFyZSBndWFyZGVkIGFuZCBleGNlcHRpb25zIGFyZSBzd2FsbG93ZWQsIHNvIGNhdGNoIGFueVxuICAgICAgICAvLyBleGNlcHRpb24gYW5kIHJldGhyb3cgdXNpbmcgYSBzZXRUaW1lb3V0IHNvIHRoZXkgYmVjb21lIHZpc2libGUgYWdhaW4uXG4gICAgICAgIC8vIE5vdGUgdGhhdCBldmVudHVhbGx5IHRoaXMgZnVuY3Rpb24gY291bGQgZ28gYXdheSBpZiB3ZSBhcmUgY29uZmlkZW50XG4gICAgICAgIC8vIGVub3VnaCB0aGUgY29kZSBpcyBleGNlcHRpb24gZnJlZS5cbiAgICAgICAgICAgICAgICByZXR1cm4geShhLCBWLkV2ZW50VHlwZS5PUEVOLCAoKCkgPT4ge1xuICAgICAgICAgICAgaCB8fCBPKFwiQ29ubmVjdGlvblwiLCBcIldlYkNoYW5uZWwgdHJhbnNwb3J0IG9wZW5lZC5cIik7XG4gICAgICAgIH0pKSwgeShhLCBWLkV2ZW50VHlwZS5DTE9TRSwgKCgpID0+IHtcbiAgICAgICAgICAgIGggfHwgKGggPSAhMCwgTyhcIkNvbm5lY3Rpb25cIiwgXCJXZWJDaGFubmVsIHRyYW5zcG9ydCBjbG9zZWRcIiksIGwucm8oKSk7XG4gICAgICAgIH0pKSwgeShhLCBWLkV2ZW50VHlwZS5FUlJPUiwgKHQgPT4ge1xuICAgICAgICAgICAgaCB8fCAoaCA9ICEwLCAkKFwiQ29ubmVjdGlvblwiLCBcIldlYkNoYW5uZWwgdHJhbnNwb3J0IGVycm9yZWQ6XCIsIHQpLCBsLnJvKG5ldyBRKEcuVU5BVkFJTEFCTEUsIFwiVGhlIG9wZXJhdGlvbiBjb3VsZCBub3QgYmUgY29tcGxldGVkXCIpKSk7XG4gICAgICAgIH0pKSwgeShhLCBWLkV2ZW50VHlwZS5NRVNTQUdFLCAodCA9PiB7XG4gICAgICAgICAgICB2YXIgZTtcbiAgICAgICAgICAgIGlmICghaCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IG4gPSB0LmRhdGFbMF07XG4gICAgICAgICAgICAgICAgVSghIW4pO1xuICAgICAgICAgICAgICAgIC8vIFRPRE8oYi8zNTE0Mzg5MSk6IFRoZXJlIGlzIGEgYnVnIGluIE9uZSBQbGF0Zm9ybSB0aGF0IGNhdXNlZCBlcnJvcnNcbiAgICAgICAgICAgICAgICAvLyAoYW5kIG9ubHkgZXJyb3JzKSB0byBiZSB3cmFwcGVkIGluIGFuIGV4dHJhIGFycmF5LiBUbyBiZSBmb3J3YXJkXG4gICAgICAgICAgICAgICAgLy8gY29tcGF0aWJsZSB3aXRoIHRoZSBidWcgd2UgbmVlZCB0byBjaGVjayBlaXRoZXIgY29uZGl0aW9uLiBUaGUgbGF0dGVyXG4gICAgICAgICAgICAgICAgLy8gY2FuIGJlIHJlbW92ZWQgb25jZSB0aGUgZml4IGhhcyBiZWVuIHJvbGxlZCBvdXQuXG4gICAgICAgICAgICAgICAgLy8gVXNlIGFueSBiZWNhdXNlIG1zZ0RhdGEuZXJyb3IgaXMgbm90IHR5cGVkLlxuICAgICAgICAgICAgICAgIGNvbnN0IHMgPSBuLCBpID0gcy5lcnJvciB8fCAobnVsbCA9PT0gKGUgPSBzWzBdKSB8fCB2b2lkIDAgPT09IGUgPyB2b2lkIDAgOiBlLmVycm9yKTtcbiAgICAgICAgICAgICAgICBpZiAoaSkge1xuICAgICAgICAgICAgICAgICAgICBPKFwiQ29ubmVjdGlvblwiLCBcIldlYkNoYW5uZWwgcmVjZWl2ZWQgZXJyb3I6XCIsIGkpO1xuICAgICAgICAgICAgICAgICAgICAvLyBlcnJvci5zdGF0dXMgd2lsbCBiZSBhIHN0cmluZyBsaWtlICdPSycgb3IgJ05PVF9GT1VORCcuXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHQgPSBpLnN0YXR1cztcbiAgICAgICAgICAgICAgICAgICAgbGV0IGUgPSBcbiAgICAgICAgICAgICAgICAgICAgLyoqXG4gKiBNYXBzIGFuIGVycm9yIENvZGUgZnJvbSBhIEdSUEMgc3RhdHVzIGlkZW50aWZpZXIgbGlrZSAnTk9UX0ZPVU5EJy5cbiAqXG4gKiBAcmV0dXJucyBUaGUgQ29kZSBlcXVpdmFsZW50IHRvIHRoZSBnaXZlbiBzdGF0dXMgc3RyaW5nIG9yIHVuZGVmaW5lZCBpZlxuICogICAgIHRoZXJlIGlzIG5vIG1hdGNoLlxuICovXG4gICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGxvb2t1cCBieSBzdHJpbmdcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBlID0gQm5bdF07XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodm9pZCAwICE9PSBlKSByZXR1cm4gcW4oZSk7XG4gICAgICAgICAgICAgICAgICAgIH0odCksIG4gPSBpLm1lc3NhZ2U7XG4gICAgICAgICAgICAgICAgICAgIHZvaWQgMCA9PT0gZSAmJiAoZSA9IEcuSU5URVJOQUwsIG4gPSBcIlVua25vd24gZXJyb3Igc3RhdHVzOiBcIiArIHQgKyBcIiB3aXRoIG1lc3NhZ2UgXCIgKyBpLm1lc3NhZ2UpLCBcbiAgICAgICAgICAgICAgICAgICAgLy8gTWFyayBjbG9zZWQgc28gbm8gZnVydGhlciBldmVudHMgYXJlIHByb3BhZ2F0ZWRcbiAgICAgICAgICAgICAgICAgICAgaCA9ICEwLCBsLnJvKG5ldyBRKGUsIG4pKSwgYS5jbG9zZSgpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBPKFwiQ29ubmVjdGlvblwiLCBcIldlYkNoYW5uZWwgcmVjZWl2ZWQ6XCIsIG4pLCBsLm9vKG4pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KSksIHkociwgdi5TVEFUX0VWRU5ULCAodCA9PiB7XG4gICAgICAgICAgICB0LnN0YXQgPT09IFMuUFJPWFkgPyBPKFwiQ29ubmVjdGlvblwiLCBcIkRldGVjdGVkIGJ1ZmZlcmluZyBwcm94eVwiKSA6IHQuc3RhdCA9PT0gUy5OT1BST1hZICYmIE8oXCJDb25uZWN0aW9uXCIsIFwiRGV0ZWN0ZWQgbm8gYnVmZmVyaW5nIHByb3h5XCIpO1xuICAgICAgICB9KSksIHNldFRpbWVvdXQoKCgpID0+IHtcbiAgICAgICAgICAgIC8vIFRlY2huaWNhbGx5IHdlIGNvdWxkL3Nob3VsZCB3YWl0IGZvciB0aGUgV2ViQ2hhbm5lbCBvcGVuZWQgZXZlbnQsXG4gICAgICAgICAgICAvLyBidXQgYmVjYXVzZSB3ZSB3YW50IHRvIHNlbmQgdGhlIGZpcnN0IG1lc3NhZ2Ugd2l0aCB0aGUgV2ViQ2hhbm5lbFxuICAgICAgICAgICAgLy8gaGFuZHNoYWtlIHdlIHByZXRlbmQgdGhlIGNoYW5uZWwgb3BlbmVkIGhlcmUgKGFzeW5jaHJvbm91c2x5KSwgYW5kXG4gICAgICAgICAgICAvLyB0aGVuIGRlbGF5IHRoZSBhY3R1YWwgb3BlbiB1bnRpbCB0aGUgZmlyc3QgbWVzc2FnZSBpcyBzZW50LlxuICAgICAgICAgICAgbC5pbygpO1xuICAgICAgICB9KSwgMCksIGw7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqIEluaXRpYWxpemVzIHRoZSBXZWJDaGFubmVsQ29ubmVjdGlvbiBmb3IgdGhlIGJyb3dzZXIuICovXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqIFRoZSBQbGF0Zm9ybSdzICd3aW5kb3cnIGltcGxlbWVudGF0aW9uIG9yIG51bGwgaWYgbm90IGF2YWlsYWJsZS4gKi9cbmZ1bmN0aW9uIEdvKCkge1xuICAgIC8vIGB3aW5kb3dgIGlzIG5vdCBhbHdheXMgYXZhaWxhYmxlLCBlLmcuIGluIFJlYWN0TmF0aXZlIGFuZCBXZWJXb3JrZXJzLlxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1yZXN0cmljdGVkLWdsb2JhbHNcbiAgICByZXR1cm4gXCJ1bmRlZmluZWRcIiAhPSB0eXBlb2Ygd2luZG93ID8gd2luZG93IDogbnVsbDtcbn1cblxuLyoqIFRoZSBQbGF0Zm9ybSdzICdkb2N1bWVudCcgaW1wbGVtZW50YXRpb24gb3IgbnVsbCBpZiBub3QgYXZhaWxhYmxlLiAqLyBmdW5jdGlvbiBRbygpIHtcbiAgICAvLyBgZG9jdW1lbnRgIGlzIG5vdCBhbHdheXMgYXZhaWxhYmxlLCBlLmcuIGluIFJlYWN0TmF0aXZlIGFuZCBXZWJXb3JrZXJzLlxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1yZXN0cmljdGVkLWdsb2JhbHNcbiAgICByZXR1cm4gXCJ1bmRlZmluZWRcIiAhPSB0eXBlb2YgZG9jdW1lbnQgPyBkb2N1bWVudCA6IG51bGw7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovIGZ1bmN0aW9uIGpvKHQpIHtcbiAgICByZXR1cm4gbmV3IGxzKHQsIC8qIHVzZVByb3RvM0pzb249ICovICEwKTtcbn1cblxuLyoqXG4gKiBBbiBpbnN0YW5jZSBvZiB0aGUgUGxhdGZvcm0ncyAnVGV4dEVuY29kZXInIGltcGxlbWVudGF0aW9uLlxuICovXG4vKipcbiAqIEEgaGVscGVyIGZvciBydW5uaW5nIGRlbGF5ZWQgdGFza3MgZm9sbG93aW5nIGFuIGV4cG9uZW50aWFsIGJhY2tvZmYgY3VydmVcbiAqIGJldHdlZW4gYXR0ZW1wdHMuXG4gKlxuICogRWFjaCBkZWxheSBpcyBtYWRlIHVwIG9mIGEgXCJiYXNlXCIgZGVsYXkgd2hpY2ggZm9sbG93cyB0aGUgZXhwb25lbnRpYWxcbiAqIGJhY2tvZmYgY3VydmUsIGFuZCBhICsvLSA1MCUgXCJqaXR0ZXJcIiB0aGF0IGlzIGNhbGN1bGF0ZWQgYW5kIGFkZGVkIHRvIHRoZVxuICogYmFzZSBkZWxheS4gVGhpcyBwcmV2ZW50cyBjbGllbnRzIGZyb20gYWNjaWRlbnRhbGx5IHN5bmNocm9uaXppbmcgdGhlaXJcbiAqIGRlbGF5cyBjYXVzaW5nIHNwaWtlcyBvZiBsb2FkIHRvIHRoZSBiYWNrZW5kLlxuICovXG5jbGFzcyBXbyB7XG4gICAgY29uc3RydWN0b3IoXG4gICAgLyoqXG4gICAgICogVGhlIEFzeW5jUXVldWUgdG8gcnVuIGJhY2tvZmYgb3BlcmF0aW9ucyBvbi5cbiAgICAgKi9cbiAgICB0LCBcbiAgICAvKipcbiAgICAgKiBUaGUgSUQgdG8gdXNlIHdoZW4gc2NoZWR1bGluZyBiYWNrb2ZmIG9wZXJhdGlvbnMgb24gdGhlIEFzeW5jUXVldWUuXG4gICAgICovXG4gICAgZSwgXG4gICAgLyoqXG4gICAgICogVGhlIGluaXRpYWwgZGVsYXkgKHVzZWQgYXMgdGhlIGJhc2UgZGVsYXkgb24gdGhlIGZpcnN0IHJldHJ5IGF0dGVtcHQpLlxuICAgICAqIE5vdGUgdGhhdCBqaXR0ZXIgd2lsbCBzdGlsbCBiZSBhcHBsaWVkLCBzbyB0aGUgYWN0dWFsIGRlbGF5IGNvdWxkIGJlIGFzXG4gICAgICogbGl0dGxlIGFzIDAuNSppbml0aWFsRGVsYXlNcy5cbiAgICAgKi9cbiAgICBuID0gMWUzXG4gICAgLyoqXG4gICAgICogVGhlIG11bHRpcGxpZXIgdG8gdXNlIHRvIGRldGVybWluZSB0aGUgZXh0ZW5kZWQgYmFzZSBkZWxheSBhZnRlciBlYWNoXG4gICAgICogYXR0ZW1wdC5cbiAgICAgKi8gLCBzID0gMS41XG4gICAgLyoqXG4gICAgICogVGhlIG1heGltdW0gYmFzZSBkZWxheSBhZnRlciB3aGljaCBubyBmdXJ0aGVyIGJhY2tvZmYgaXMgcGVyZm9ybWVkLlxuICAgICAqIE5vdGUgdGhhdCBqaXR0ZXIgd2lsbCBzdGlsbCBiZSBhcHBsaWVkLCBzbyB0aGUgYWN0dWFsIGRlbGF5IGNvdWxkIGJlIGFzXG4gICAgICogbXVjaCBhcyAxLjUqbWF4RGVsYXlNcy5cbiAgICAgKi8gLCBpID0gNmU0KSB7XG4gICAgICAgIHRoaXMuWW4gPSB0LCB0aGlzLnRpbWVySWQgPSBlLCB0aGlzLm1vID0gbiwgdGhpcy55byA9IHMsIHRoaXMucG8gPSBpLCB0aGlzLklvID0gMCwgXG4gICAgICAgIHRoaXMuVG8gPSBudWxsLCBcbiAgICAgICAgLyoqIFRoZSBsYXN0IGJhY2tvZmYgYXR0ZW1wdCwgYXMgZXBvY2ggbWlsbGlzZWNvbmRzLiAqL1xuICAgICAgICB0aGlzLkVvID0gRGF0ZS5ub3coKSwgdGhpcy5yZXNldCgpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXNldHMgdGhlIGJhY2tvZmYgZGVsYXkuXG4gICAgICpcbiAgICAgKiBUaGUgdmVyeSBuZXh0IGJhY2tvZmZBbmRXYWl0KCkgd2lsbCBoYXZlIG5vIGRlbGF5LiBJZiBpdCBpcyBjYWxsZWQgYWdhaW5cbiAgICAgKiAoaS5lLiBkdWUgdG8gYW4gZXJyb3IpLCBpbml0aWFsRGVsYXlNcyAocGx1cyBqaXR0ZXIpIHdpbGwgYmUgdXNlZCwgYW5kXG4gICAgICogc3Vic2VxdWVudCBvbmVzIHdpbGwgaW5jcmVhc2UgYWNjb3JkaW5nIHRvIHRoZSBiYWNrb2ZmRmFjdG9yLlxuICAgICAqLyAgICByZXNldCgpIHtcbiAgICAgICAgdGhpcy5JbyA9IDA7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJlc2V0cyB0aGUgYmFja29mZiBkZWxheSB0byB0aGUgbWF4aW11bSBkZWxheSAoZS5nLiBmb3IgdXNlIGFmdGVyIGFcbiAgICAgKiBSRVNPVVJDRV9FWEhBVVNURUQgZXJyb3IpLlxuICAgICAqLyAgICBBbygpIHtcbiAgICAgICAgdGhpcy5JbyA9IHRoaXMucG87XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgYSBwcm9taXNlIHRoYXQgcmVzb2x2ZXMgYWZ0ZXIgY3VycmVudERlbGF5TXMsIGFuZCBpbmNyZWFzZXMgdGhlXG4gICAgICogZGVsYXkgZm9yIGFueSBzdWJzZXF1ZW50IGF0dGVtcHRzLiBJZiB0aGVyZSB3YXMgYSBwZW5kaW5nIGJhY2tvZmYgb3BlcmF0aW9uXG4gICAgICogYWxyZWFkeSwgaXQgd2lsbCBiZSBjYW5jZWxlZC5cbiAgICAgKi8gICAgUm8odCkge1xuICAgICAgICAvLyBDYW5jZWwgYW55IHBlbmRpbmcgYmFja29mZiBvcGVyYXRpb24uXG4gICAgICAgIHRoaXMuY2FuY2VsKCk7XG4gICAgICAgIC8vIEZpcnN0IHNjaGVkdWxlIHVzaW5nIHRoZSBjdXJyZW50IGJhc2UgKHdoaWNoIG1heSBiZSAwIGFuZCBzaG91bGQgYmVcbiAgICAgICAgLy8gaG9ub3JlZCBhcyBzdWNoKS5cbiAgICAgICAgY29uc3QgZSA9IE1hdGguZmxvb3IodGhpcy5JbyArIHRoaXMuYm8oKSksIG4gPSBNYXRoLm1heCgwLCBEYXRlLm5vdygpIC0gdGhpcy5FbyksIHMgPSBNYXRoLm1heCgwLCBlIC0gbik7XG4gICAgICAgIC8vIEd1YXJkIGFnYWluc3QgbGFzdEF0dGVtcHRUaW1lIGJlaW5nIGluIHRoZSBmdXR1cmUgZHVlIHRvIGEgY2xvY2sgY2hhbmdlLlxuICAgICAgICAgICAgICAgIHMgPiAwICYmIE8oXCJFeHBvbmVudGlhbEJhY2tvZmZcIiwgYEJhY2tpbmcgb2ZmIGZvciAke3N9IG1zIChiYXNlIGRlbGF5OiAke3RoaXMuSW99IG1zLCBkZWxheSB3aXRoIGppdHRlcjogJHtlfSBtcywgbGFzdCBhdHRlbXB0OiAke259IG1zIGFnbylgKSwgXG4gICAgICAgIHRoaXMuVG8gPSB0aGlzLlluLmVucXVldWVBZnRlckRlbGF5KHRoaXMudGltZXJJZCwgcywgKCgpID0+ICh0aGlzLkVvID0gRGF0ZS5ub3coKSwgXG4gICAgICAgIHQoKSkpKSwgXG4gICAgICAgIC8vIEFwcGx5IGJhY2tvZmYgZmFjdG9yIHRvIGRldGVybWluZSBuZXh0IGRlbGF5IGFuZCBlbnN1cmUgaXQgaXMgd2l0aGluXG4gICAgICAgIC8vIGJvdW5kcy5cbiAgICAgICAgdGhpcy5JbyAqPSB0aGlzLnlvLCB0aGlzLklvIDwgdGhpcy5tbyAmJiAodGhpcy5JbyA9IHRoaXMubW8pLCB0aGlzLklvID4gdGhpcy5wbyAmJiAodGhpcy5JbyA9IHRoaXMucG8pO1xuICAgIH1cbiAgICBQbygpIHtcbiAgICAgICAgbnVsbCAhPT0gdGhpcy5UbyAmJiAodGhpcy5Uby5za2lwRGVsYXkoKSwgdGhpcy5UbyA9IG51bGwpO1xuICAgIH1cbiAgICBjYW5jZWwoKSB7XG4gICAgICAgIG51bGwgIT09IHRoaXMuVG8gJiYgKHRoaXMuVG8uY2FuY2VsKCksIHRoaXMuVG8gPSBudWxsKTtcbiAgICB9XG4gICAgLyoqIFJldHVybnMgYSByYW5kb20gdmFsdWUgaW4gdGhlIHJhbmdlIFstY3VycmVudEJhc2VNcy8yLCBjdXJyZW50QmFzZU1zLzJdICovICAgIGJvKCkge1xuICAgICAgICByZXR1cm4gKE1hdGgucmFuZG9tKCkgLSAuNSkgKiB0aGlzLklvO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogQSBQZXJzaXN0ZW50U3RyZWFtIGlzIGFuIGFic3RyYWN0IGJhc2UgY2xhc3MgdGhhdCByZXByZXNlbnRzIGEgc3RyZWFtaW5nIFJQQ1xuICogdG8gdGhlIEZpcmVzdG9yZSBiYWNrZW5kLiBJdCdzIGJ1aWx0IG9uIHRvcCBvZiB0aGUgY29ubmVjdGlvbnMgb3duIHN1cHBvcnRcbiAqIGZvciBzdHJlYW1pbmcgUlBDcywgYW5kIGFkZHMgc2V2ZXJhbCBjcml0aWNhbCBmZWF0dXJlcyBmb3Igb3VyIGNsaWVudHM6XG4gKlxuICogICAtIEV4cG9uZW50aWFsIGJhY2tvZmYgb24gZmFpbHVyZVxuICogICAtIEF1dGhlbnRpY2F0aW9uIHZpYSBDcmVkZW50aWFsc1Byb3ZpZGVyXG4gKiAgIC0gRGlzcGF0Y2hpbmcgYWxsIGNhbGxiYWNrcyBpbnRvIHRoZSBzaGFyZWQgd29ya2VyIHF1ZXVlXG4gKiAgIC0gQ2xvc2luZyBpZGxlIHN0cmVhbXMgYWZ0ZXIgNjAgc2Vjb25kcyBvZiBpbmFjdGl2aXR5XG4gKlxuICogU3ViY2xhc3NlcyBvZiBQZXJzaXN0ZW50U3RyZWFtIGltcGxlbWVudCBzZXJpYWxpemF0aW9uIG9mIG1vZGVscyB0byBhbmRcbiAqIGZyb20gdGhlIEpTT04gcmVwcmVzZW50YXRpb24gb2YgdGhlIHByb3RvY29sIGJ1ZmZlcnMgZm9yIGEgc3BlY2lmaWNcbiAqIHN0cmVhbWluZyBSUEMuXG4gKlxuICogIyMgU3RhcnRpbmcgYW5kIFN0b3BwaW5nXG4gKlxuICogU3RyZWFtaW5nIFJQQ3MgYXJlIHN0YXRlZnVsIGFuZCBuZWVkIHRvIGJlIHN0YXJ0KCllZCBiZWZvcmUgbWVzc2FnZXMgY2FuXG4gKiBiZSBzZW50IGFuZCByZWNlaXZlZC4gVGhlIFBlcnNpc3RlbnRTdHJlYW0gd2lsbCBjYWxsIHRoZSBvbk9wZW4oKSBmdW5jdGlvblxuICogb2YgdGhlIGxpc3RlbmVyIG9uY2UgdGhlIHN0cmVhbSBpcyByZWFkeSB0byBhY2NlcHQgcmVxdWVzdHMuXG4gKlxuICogU2hvdWxkIGEgc3RhcnQoKSBmYWlsLCBQZXJzaXN0ZW50U3RyZWFtIHdpbGwgY2FsbCB0aGUgcmVnaXN0ZXJlZCBvbkNsb3NlKClcbiAqIGxpc3RlbmVyIHdpdGggYSBGaXJlc3RvcmVFcnJvciBpbmRpY2F0aW5nIHdoYXQgd2VudCB3cm9uZy5cbiAqXG4gKiBBIFBlcnNpc3RlbnRTdHJlYW0gY2FuIGJlIHN0YXJ0ZWQgYW5kIHN0b3BwZWQgcmVwZWF0ZWRseS5cbiAqXG4gKiBHZW5lcmljIHR5cGVzOlxuICogIFNlbmRUeXBlOiBUaGUgdHlwZSBvZiB0aGUgb3V0Z29pbmcgbWVzc2FnZSBvZiB0aGUgdW5kZXJseWluZ1xuICogICAgY29ubmVjdGlvbiBzdHJlYW1cbiAqICBSZWNlaXZlVHlwZTogVGhlIHR5cGUgb2YgdGhlIGluY29taW5nIG1lc3NhZ2Ugb2YgdGhlIHVuZGVybHlpbmdcbiAqICAgIGNvbm5lY3Rpb24gc3RyZWFtXG4gKiAgTGlzdGVuZXJUeXBlOiBUaGUgdHlwZSBvZiB0aGUgbGlzdGVuZXIgdGhhdCB3aWxsIGJlIHVzZWQgZm9yIGNhbGxiYWNrc1xuICovXG5jbGFzcyB6byB7XG4gICAgY29uc3RydWN0b3IodCwgZSwgbiwgcywgaSwgciwgbywgdSkge1xuICAgICAgICB0aGlzLlluID0gdCwgdGhpcy5WbyA9IG4sIHRoaXMudm8gPSBzLCB0aGlzLlNvID0gaSwgdGhpcy5hdXRoQ3JlZGVudGlhbHNQcm92aWRlciA9IHIsIFxuICAgICAgICB0aGlzLmFwcENoZWNrQ3JlZGVudGlhbHNQcm92aWRlciA9IG8sIHRoaXMubGlzdGVuZXIgPSB1LCB0aGlzLnN0YXRlID0gMCAvKiBJbml0aWFsICovICwgXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBIGNsb3NlIGNvdW50IHRoYXQncyBpbmNyZW1lbnRlZCBldmVyeSB0aW1lIHRoZSBzdHJlYW0gaXMgY2xvc2VkOyB1c2VkIGJ5XG4gICAgICAgICAqIGdldENsb3NlR3VhcmRlZERpc3BhdGNoZXIoKSB0byBpbnZhbGlkYXRlIGNhbGxiYWNrcyB0aGF0IGhhcHBlbiBhZnRlclxuICAgICAgICAgKiBjbG9zZS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuRG8gPSAwLCB0aGlzLkNvID0gbnVsbCwgdGhpcy54byA9IG51bGwsIHRoaXMuc3RyZWFtID0gbnVsbCwgdGhpcy5ObyA9IG5ldyBXbyh0LCBlKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0cnVlIGlmIHN0YXJ0KCkgaGFzIGJlZW4gY2FsbGVkIGFuZCBubyBlcnJvciBoYXMgb2NjdXJyZWQuIFRydWVcbiAgICAgKiBpbmRpY2F0ZXMgdGhlIHN0cmVhbSBpcyBvcGVuIG9yIGluIHRoZSBwcm9jZXNzIG9mIG9wZW5pbmcgKHdoaWNoXG4gICAgICogZW5jb21wYXNzZXMgcmVzcGVjdGluZyBiYWNrb2ZmLCBnZXR0aW5nIGF1dGggdG9rZW5zLCBhbmQgc3RhcnRpbmcgdGhlXG4gICAgICogYWN0dWFsIFJQQykuIFVzZSBpc09wZW4oKSB0byBkZXRlcm1pbmUgaWYgdGhlIHN0cmVhbSBpcyBvcGVuIGFuZCByZWFkeSBmb3JcbiAgICAgKiBvdXRib3VuZCByZXF1ZXN0cy5cbiAgICAgKi8gICAga28oKSB7XG4gICAgICAgIHJldHVybiAxIC8qIFN0YXJ0aW5nICovID09PSB0aGlzLnN0YXRlIHx8IDUgLyogQmFja29mZiAqLyA9PT0gdGhpcy5zdGF0ZSB8fCB0aGlzLk1vKCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgdW5kZXJseWluZyBSUEMgaXMgb3BlbiAodGhlIG9uT3BlbigpIGxpc3RlbmVyIGhhcyBiZWVuXG4gICAgICogY2FsbGVkKSBhbmQgdGhlIHN0cmVhbSBpcyByZWFkeSBmb3Igb3V0Ym91bmQgcmVxdWVzdHMuXG4gICAgICovICAgIE1vKCkge1xuICAgICAgICByZXR1cm4gMiAvKiBPcGVuICovID09PSB0aGlzLnN0YXRlIHx8IDMgLyogSGVhbHRoeSAqLyA9PT0gdGhpcy5zdGF0ZTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogU3RhcnRzIHRoZSBSUEMuIE9ubHkgYWxsb3dlZCBpZiBpc1N0YXJ0ZWQoKSByZXR1cm5zIGZhbHNlLiBUaGUgc3RyZWFtIGlzXG4gICAgICogbm90IGltbWVkaWF0ZWx5IHJlYWR5IGZvciB1c2U6IG9uT3BlbigpIHdpbGwgYmUgaW52b2tlZCB3aGVuIHRoZSBSUEMgaXNcbiAgICAgKiByZWFkeSBmb3Igb3V0Ym91bmQgcmVxdWVzdHMsIGF0IHdoaWNoIHBvaW50IGlzT3BlbigpIHdpbGwgcmV0dXJuIHRydWUuXG4gICAgICpcbiAgICAgKiBXaGVuIHN0YXJ0IHJldHVybnMsIGlzU3RhcnRlZCgpIHdpbGwgcmV0dXJuIHRydWUuXG4gICAgICovICAgIHN0YXJ0KCkge1xuICAgICAgICA0IC8qIEVycm9yICovICE9PSB0aGlzLnN0YXRlID8gdGhpcy5hdXRoKCkgOiB0aGlzLk9vKCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFN0b3BzIHRoZSBSUEMuIFRoaXMgY2FsbCBpcyBpZGVtcG90ZW50IGFuZCBhbGxvd2VkIHJlZ2FyZGxlc3Mgb2YgdGhlXG4gICAgICogY3VycmVudCBpc1N0YXJ0ZWQoKSBzdGF0ZS5cbiAgICAgKlxuICAgICAqIFdoZW4gc3RvcCByZXR1cm5zLCBpc1N0YXJ0ZWQoKSBhbmQgaXNPcGVuKCkgd2lsbCBib3RoIHJldHVybiBmYWxzZS5cbiAgICAgKi8gICAgYXN5bmMgc3RvcCgpIHtcbiAgICAgICAgdGhpcy5rbygpICYmIGF3YWl0IHRoaXMuY2xvc2UoMCAvKiBJbml0aWFsICovKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQWZ0ZXIgYW4gZXJyb3IgdGhlIHN0cmVhbSB3aWxsIHVzdWFsbHkgYmFjayBvZmYgb24gdGhlIG5leHQgYXR0ZW1wdCB0b1xuICAgICAqIHN0YXJ0IGl0LiBJZiB0aGUgZXJyb3Igd2FycmFudHMgYW4gaW1tZWRpYXRlIHJlc3RhcnQgb2YgdGhlIHN0cmVhbSwgdGhlXG4gICAgICogc2VuZGVyIGNhbiB1c2UgdGhpcyB0byBpbmRpY2F0ZSB0aGF0IHRoZSByZWNlaXZlciBzaG91bGQgbm90IGJhY2sgb2ZmLlxuICAgICAqXG4gICAgICogRWFjaCBlcnJvciB3aWxsIGNhbGwgdGhlIG9uQ2xvc2UoKSBsaXN0ZW5lci4gVGhhdCBmdW5jdGlvbiBjYW4gZGVjaWRlIHRvXG4gICAgICogaW5oaWJpdCBiYWNrb2ZmIGlmIHJlcXVpcmVkLlxuICAgICAqLyAgICBGbygpIHtcbiAgICAgICAgdGhpcy5zdGF0ZSA9IDAgLyogSW5pdGlhbCAqLyAsIHRoaXMuTm8ucmVzZXQoKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogTWFya3MgdGhpcyBzdHJlYW0gYXMgaWRsZS4gSWYgbm8gZnVydGhlciBhY3Rpb25zIGFyZSBwZXJmb3JtZWQgb24gdGhlXG4gICAgICogc3RyZWFtIGZvciBvbmUgbWludXRlLCB0aGUgc3RyZWFtIHdpbGwgYXV0b21hdGljYWxseSBjbG9zZSBpdHNlbGYgYW5kXG4gICAgICogbm90aWZ5IHRoZSBzdHJlYW0ncyBvbkNsb3NlKCkgaGFuZGxlciB3aXRoIFN0YXR1cy5PSy4gVGhlIHN0cmVhbSB3aWxsIHRoZW5cbiAgICAgKiBiZSBpbiBhICFpc1N0YXJ0ZWQoKSBzdGF0ZSwgcmVxdWlyaW5nIHRoZSBjYWxsZXIgdG8gc3RhcnQgdGhlIHN0cmVhbSBhZ2FpblxuICAgICAqIGJlZm9yZSBmdXJ0aGVyIHVzZS5cbiAgICAgKlxuICAgICAqIE9ubHkgc3RyZWFtcyB0aGF0IGFyZSBpbiBzdGF0ZSAnT3BlbicgY2FuIGJlIG1hcmtlZCBpZGxlLCBhcyBhbGwgb3RoZXJcbiAgICAgKiBzdGF0ZXMgaW1wbHkgcGVuZGluZyBuZXR3b3JrIG9wZXJhdGlvbnMuXG4gICAgICovICAgICRvKCkge1xuICAgICAgICAvLyBTdGFydHMgdGhlIGlkbGUgdGltZSBpZiB3ZSBhcmUgaW4gc3RhdGUgJ09wZW4nIGFuZCBhcmUgbm90IHlldCBhbHJlYWR5XG4gICAgICAgIC8vIHJ1bm5pbmcgYSB0aW1lciAoaW4gd2hpY2ggY2FzZSB0aGUgcHJldmlvdXMgaWRsZSB0aW1lb3V0IHN0aWxsIGFwcGxpZXMpLlxuICAgICAgICB0aGlzLk1vKCkgJiYgbnVsbCA9PT0gdGhpcy5DbyAmJiAodGhpcy5DbyA9IHRoaXMuWW4uZW5xdWV1ZUFmdGVyRGVsYXkodGhpcy5WbywgNmU0LCAoKCkgPT4gdGhpcy5CbygpKSkpO1xuICAgIH1cbiAgICAvKiogU2VuZHMgYSBtZXNzYWdlIHRvIHRoZSB1bmRlcmx5aW5nIHN0cmVhbS4gKi8gICAgTG8odCkge1xuICAgICAgICB0aGlzLlVvKCksIHRoaXMuc3RyZWFtLnNlbmQodCk7XG4gICAgfVxuICAgIC8qKiBDYWxsZWQgYnkgdGhlIGlkbGUgdGltZXIgd2hlbiB0aGUgc3RyZWFtIHNob3VsZCBjbG9zZSBkdWUgdG8gaW5hY3Rpdml0eS4gKi8gICAgYXN5bmMgQm8oKSB7XG4gICAgICAgIGlmICh0aGlzLk1vKCkpIFxuICAgICAgICAvLyBXaGVuIHRpbWluZyBvdXQgYW4gaWRsZSBzdHJlYW0gdGhlcmUncyBubyByZWFzb24gdG8gZm9yY2UgdGhlIHN0cmVhbSBpbnRvIGJhY2tvZmYgd2hlblxuICAgICAgICAvLyBpdCByZXN0YXJ0cyBzbyBzZXQgdGhlIHN0cmVhbSBzdGF0ZSB0byBJbml0aWFsIGluc3RlYWQgb2YgRXJyb3IuXG4gICAgICAgIHJldHVybiB0aGlzLmNsb3NlKDAgLyogSW5pdGlhbCAqLyk7XG4gICAgfVxuICAgIC8qKiBNYXJrcyB0aGUgc3RyZWFtIGFzIGFjdGl2ZSBhZ2Fpbi4gKi8gICAgVW8oKSB7XG4gICAgICAgIHRoaXMuQ28gJiYgKHRoaXMuQ28uY2FuY2VsKCksIHRoaXMuQ28gPSBudWxsKTtcbiAgICB9XG4gICAgLyoqIENhbmNlbHMgdGhlIGhlYWx0aCBjaGVjayBkZWxheWVkIG9wZXJhdGlvbi4gKi8gICAgcW8oKSB7XG4gICAgICAgIHRoaXMueG8gJiYgKHRoaXMueG8uY2FuY2VsKCksIHRoaXMueG8gPSBudWxsKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ2xvc2VzIHRoZSBzdHJlYW0gYW5kIGNsZWFucyB1cCBhcyBuZWNlc3Nhcnk6XG4gICAgICpcbiAgICAgKiAqIGNsb3NlcyB0aGUgdW5kZXJseWluZyBHUlBDIHN0cmVhbTtcbiAgICAgKiAqIGNhbGxzIHRoZSBvbkNsb3NlIGhhbmRsZXIgd2l0aCB0aGUgZ2l2ZW4gJ2Vycm9yJztcbiAgICAgKiAqIHNldHMgaW50ZXJuYWwgc3RyZWFtIHN0YXRlIHRvICdmaW5hbFN0YXRlJztcbiAgICAgKiAqIGFkanVzdHMgdGhlIGJhY2tvZmYgdGltZXIgYmFzZWQgb24gdGhlIGVycm9yXG4gICAgICpcbiAgICAgKiBBIG5ldyBzdHJlYW0gY2FuIGJlIG9wZW5lZCBieSBjYWxsaW5nIHN0YXJ0KCkuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gZmluYWxTdGF0ZSAtIHRoZSBpbnRlbmRlZCBzdGF0ZSBvZiB0aGUgc3RyZWFtIGFmdGVyIGNsb3NpbmcuXG4gICAgICogQHBhcmFtIGVycm9yIC0gdGhlIGVycm9yIHRoZSBjb25uZWN0aW9uIHdhcyBjbG9zZWQgd2l0aC5cbiAgICAgKi8gICAgYXN5bmMgY2xvc2UodCwgZSkge1xuICAgICAgICAvLyBDYW5jZWwgYW55IG91dHN0YW5kaW5nIHRpbWVycyAodGhleSdyZSBndWFyYW50ZWVkIG5vdCB0byBleGVjdXRlKS5cbiAgICAgICAgdGhpcy5VbygpLCB0aGlzLnFvKCksIHRoaXMuTm8uY2FuY2VsKCksIFxuICAgICAgICAvLyBJbnZhbGlkYXRlcyBhbnkgc3RyZWFtLXJlbGF0ZWQgY2FsbGJhY2tzIChlLmcuIGZyb20gYXV0aCBvciB0aGVcbiAgICAgICAgLy8gdW5kZXJseWluZyBzdHJlYW0pLCBndWFyYW50ZWVpbmcgdGhleSB3b24ndCBleGVjdXRlLlxuICAgICAgICB0aGlzLkRvKyssIDQgLyogRXJyb3IgKi8gIT09IHQgPyBcbiAgICAgICAgLy8gSWYgdGhpcyBpcyBhbiBpbnRlbnRpb25hbCBjbG9zZSBlbnN1cmUgd2UgZG9uJ3QgZGVsYXkgb3VyIG5leHQgY29ubmVjdGlvbiBhdHRlbXB0LlxuICAgICAgICB0aGlzLk5vLnJlc2V0KCkgOiBlICYmIGUuY29kZSA9PT0gRy5SRVNPVVJDRV9FWEhBVVNURUQgPyAoXG4gICAgICAgIC8vIExvZyB0aGUgZXJyb3IuIChQcm9iYWJseSBlaXRoZXIgJ3F1b3RhIGV4Y2VlZGVkJyBvciAnbWF4IHF1ZXVlIGxlbmd0aCByZWFjaGVkJy4pXG4gICAgICAgIEYoZS50b1N0cmluZygpKSwgRihcIlVzaW5nIG1heGltdW0gYmFja29mZiBkZWxheSB0byBwcmV2ZW50IG92ZXJsb2FkaW5nIHRoZSBiYWNrZW5kLlwiKSwgXG4gICAgICAgIHRoaXMuTm8uQW8oKSkgOiBlICYmIGUuY29kZSA9PT0gRy5VTkFVVEhFTlRJQ0FURUQgJiYgMyAvKiBIZWFsdGh5ICovICE9PSB0aGlzLnN0YXRlICYmIChcbiAgICAgICAgLy8gXCJ1bmF1dGhlbnRpY2F0ZWRcIiBlcnJvciBtZWFucyB0aGUgdG9rZW4gd2FzIHJlamVjdGVkLiBUaGlzIHNob3VsZCByYXJlbHlcbiAgICAgICAgLy8gaGFwcGVuIHNpbmNlIGJvdGggQXV0aCBhbmQgQXBwQ2hlY2sgZW5zdXJlIGEgc3VmZmljaWVudCBUVEwgd2hlbiB3ZVxuICAgICAgICAvLyByZXF1ZXN0IGEgdG9rZW4uIElmIGEgdXNlciBtYW51YWxseSByZXNldHMgdGhlaXIgc3lzdGVtIGNsb2NrIHRoaXMgY2FuXG4gICAgICAgIC8vIGZhaWwsIGhvd2V2ZXIuIEluIHRoaXMgY2FzZSwgd2Ugc2hvdWxkIGdldCBhIENvZGUuVU5BVVRIRU5USUNBVEVEIGVycm9yXG4gICAgICAgIC8vIGJlZm9yZSB3ZSByZWNlaXZlZCB0aGUgZmlyc3QgbWVzc2FnZSBhbmQgd2UgbmVlZCB0byBpbnZhbGlkYXRlIHRoZSB0b2tlblxuICAgICAgICAvLyB0byBlbnN1cmUgdGhhdCB3ZSBmZXRjaCBhIG5ldyB0b2tlbi5cbiAgICAgICAgdGhpcy5hdXRoQ3JlZGVudGlhbHNQcm92aWRlci5pbnZhbGlkYXRlVG9rZW4oKSwgdGhpcy5hcHBDaGVja0NyZWRlbnRpYWxzUHJvdmlkZXIuaW52YWxpZGF0ZVRva2VuKCkpLCBcbiAgICAgICAgLy8gQ2xlYW4gdXAgdGhlIHVuZGVybHlpbmcgc3RyZWFtIGJlY2F1c2Ugd2UgYXJlIG5vIGxvbmdlciBpbnRlcmVzdGVkIGluIGV2ZW50cy5cbiAgICAgICAgbnVsbCAhPT0gdGhpcy5zdHJlYW0gJiYgKHRoaXMuS28oKSwgdGhpcy5zdHJlYW0uY2xvc2UoKSwgdGhpcy5zdHJlYW0gPSBudWxsKSwgXG4gICAgICAgIC8vIFRoaXMgc3RhdGUgbXVzdCBiZSBhc3NpZ25lZCBiZWZvcmUgY2FsbGluZyBvbkNsb3NlKCkgdG8gYWxsb3cgdGhlIGNhbGxiYWNrIHRvXG4gICAgICAgIC8vIGluaGliaXQgYmFja29mZiBvciBvdGhlcndpc2UgbWFuaXB1bGF0ZSB0aGUgc3RhdGUgaW4gaXRzIG5vbi1zdGFydGVkIHN0YXRlLlxuICAgICAgICB0aGlzLnN0YXRlID0gdCwgXG4gICAgICAgIC8vIE5vdGlmeSB0aGUgbGlzdGVuZXIgdGhhdCB0aGUgc3RyZWFtIGNsb3NlZC5cbiAgICAgICAgYXdhaXQgdGhpcy5saXN0ZW5lci5lbyhlKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ2FuIGJlIG92ZXJyaWRkZW4gdG8gcGVyZm9ybSBhZGRpdGlvbmFsIGNsZWFudXAgYmVmb3JlIHRoZSBzdHJlYW0gaXMgY2xvc2VkLlxuICAgICAqIENhbGxpbmcgc3VwZXIudGVhckRvd24oKSBpcyBub3QgcmVxdWlyZWQuXG4gICAgICovICAgIEtvKCkge31cbiAgICBhdXRoKCkge1xuICAgICAgICB0aGlzLnN0YXRlID0gMSAvKiBTdGFydGluZyAqLztcbiAgICAgICAgY29uc3QgdCA9IHRoaXMuR28odGhpcy5EbyksIGUgPSB0aGlzLkRvO1xuICAgICAgICAvLyBUT0RPKG1pa2VsZWhlbik6IEp1c3QgdXNlIGRpc3BhdGNoSWZOb3RDbG9zZWQsIGJ1dCBzZWUgVE9ETyBiZWxvdy5cbiAgICAgICAgICAgICAgICBQcm9taXNlLmFsbChbIHRoaXMuYXV0aENyZWRlbnRpYWxzUHJvdmlkZXIuZ2V0VG9rZW4oKSwgdGhpcy5hcHBDaGVja0NyZWRlbnRpYWxzUHJvdmlkZXIuZ2V0VG9rZW4oKSBdKS50aGVuKCgoW3QsIG5dKSA9PiB7XG4gICAgICAgICAgICAvLyBTdHJlYW0gY2FuIGJlIHN0b3BwZWQgd2hpbGUgd2FpdGluZyBmb3IgYXV0aGVudGljYXRpb24uXG4gICAgICAgICAgICAvLyBUT0RPKG1pa2VsZWhlbik6IFdlIHJlYWxseSBzaG91bGQganVzdCB1c2UgZGlzcGF0Y2hJZk5vdENsb3NlZFxuICAgICAgICAgICAgLy8gYW5kIGxldCB0aGlzIGRpc3BhdGNoIG9udG8gdGhlIHF1ZXVlLCBidXQgdGhhdCBvcGVuZWQgYSBzcGVjIHRlc3QgY2FuXG4gICAgICAgICAgICAvLyBvZiB3b3JtcyB0aGF0IEkgZG9uJ3Qgd2FudCB0byBkZWFsIHdpdGggaW4gdGhpcyBQUi5cbiAgICAgICAgICAgIHRoaXMuRG8gPT09IGUgJiYgXG4gICAgICAgICAgICAvLyBOb3JtYWxseSB3ZSdkIGhhdmUgdG8gc2NoZWR1bGUgdGhlIGNhbGxiYWNrIG9uIHRoZSBBc3luY1F1ZXVlLlxuICAgICAgICAgICAgLy8gSG93ZXZlciwgdGhlIGZvbGxvd2luZyBjYWxscyBhcmUgc2FmZSB0byBiZSBjYWxsZWQgb3V0c2lkZSB0aGVcbiAgICAgICAgICAgIC8vIEFzeW5jUXVldWUgc2luY2UgdGhleSBkb24ndCBjaGFpbiBhc3luY2hyb25vdXMgY2FsbHNcbiAgICAgICAgICAgIHRoaXMuUW8odCwgbik7XG4gICAgICAgIH0pLCAoZSA9PiB7XG4gICAgICAgICAgICB0KCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgdCA9IG5ldyBRKEcuVU5LTk9XTiwgXCJGZXRjaGluZyBhdXRoIHRva2VuIGZhaWxlZDogXCIgKyBlLm1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmpvKHQpO1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIFFvKHQsIGUpIHtcbiAgICAgICAgY29uc3QgbiA9IHRoaXMuR28odGhpcy5Ebyk7XG4gICAgICAgIHRoaXMuc3RyZWFtID0gdGhpcy5Xbyh0LCBlKSwgdGhpcy5zdHJlYW0uWHIoKCgpID0+IHtcbiAgICAgICAgICAgIG4oKCgpID0+ICh0aGlzLnN0YXRlID0gMiAvKiBPcGVuICovICwgdGhpcy54byA9IHRoaXMuWW4uZW5xdWV1ZUFmdGVyRGVsYXkodGhpcy52bywgMWU0LCAoKCkgPT4gKHRoaXMuTW8oKSAmJiAodGhpcy5zdGF0ZSA9IDMgLyogSGVhbHRoeSAqLyksIFxuICAgICAgICAgICAgUHJvbWlzZS5yZXNvbHZlKCkpKSksIHRoaXMubGlzdGVuZXIuWHIoKSkpKTtcbiAgICAgICAgfSkpLCB0aGlzLnN0cmVhbS5lbygodCA9PiB7XG4gICAgICAgICAgICBuKCgoKSA9PiB0aGlzLmpvKHQpKSk7XG4gICAgICAgIH0pKSwgdGhpcy5zdHJlYW0ub25NZXNzYWdlKCh0ID0+IHtcbiAgICAgICAgICAgIG4oKCgpID0+IHRoaXMub25NZXNzYWdlKHQpKSk7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgT28oKSB7XG4gICAgICAgIHRoaXMuc3RhdGUgPSA1IC8qIEJhY2tvZmYgKi8gLCB0aGlzLk5vLlJvKChhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnN0YXRlID0gMCAvKiBJbml0aWFsICovICwgdGhpcy5zdGFydCgpO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIC8vIFZpc2libGUgZm9yIHRlc3RzXG4gICAgam8odCkge1xuICAgICAgICAvLyBJbiB0aGVvcnkgdGhlIHN0cmVhbSBjb3VsZCBjbG9zZSBjbGVhbmx5LCBob3dldmVyLCBpbiBvdXIgY3VycmVudCBtb2RlbFxuICAgICAgICAvLyB3ZSBuZXZlciBleHBlY3QgdGhpcyB0byBoYXBwZW4gYmVjYXVzZSBpZiB3ZSBzdG9wIGEgc3RyZWFtIG91cnNlbHZlcyxcbiAgICAgICAgLy8gdGhpcyBjYWxsYmFjayB3aWxsIG5ldmVyIGJlIGNhbGxlZC4gVG8gcHJldmVudCBjYXNlcyB3aGVyZSB3ZSByZXRyeVxuICAgICAgICAvLyB3aXRob3V0IGEgYmFja29mZiBhY2NpZGVudGFsbHksIHdlIHNldCB0aGUgc3RyZWFtIHRvIGVycm9yIGluIGFsbCBjYXNlcy5cbiAgICAgICAgcmV0dXJuIE8oXCJQZXJzaXN0ZW50U3RyZWFtXCIsIGBjbG9zZSB3aXRoIGVycm9yOiAke3R9YCksIHRoaXMuc3RyZWFtID0gbnVsbCwgdGhpcy5jbG9zZSg0IC8qIEVycm9yICovICwgdCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgYSBcImRpc3BhdGNoZXJcIiBmdW5jdGlvbiB0aGF0IGRpc3BhdGNoZXMgb3BlcmF0aW9ucyBvbnRvIHRoZVxuICAgICAqIEFzeW5jUXVldWUgYnV0IG9ubHkgcnVucyB0aGVtIGlmIGNsb3NlQ291bnQgcmVtYWlucyB1bmNoYW5nZWQuIFRoaXMgYWxsb3dzXG4gICAgICogdXMgdG8gdHVybiBhdXRoIC8gc3RyZWFtIGNhbGxiYWNrcyBpbnRvIG5vLW9wcyBpZiB0aGUgc3RyZWFtIGlzIGNsb3NlZCAvXG4gICAgICogcmUtb3BlbmVkLCBldGMuXG4gICAgICovICAgIEdvKHQpIHtcbiAgICAgICAgcmV0dXJuIGUgPT4ge1xuICAgICAgICAgICAgdGhpcy5Zbi5lbnF1ZXVlQW5kRm9yZ2V0KCgoKSA9PiB0aGlzLkRvID09PSB0ID8gZSgpIDogKE8oXCJQZXJzaXN0ZW50U3RyZWFtXCIsIFwic3RyZWFtIGNhbGxiYWNrIHNraXBwZWQgYnkgZ2V0Q2xvc2VHdWFyZGVkRGlzcGF0Y2hlci5cIiksIFxuICAgICAgICAgICAgUHJvbWlzZS5yZXNvbHZlKCkpKSk7XG4gICAgICAgIH07XG4gICAgfVxufVxuXG4vKipcbiAqIEEgUGVyc2lzdGVudFN0cmVhbSB0aGF0IGltcGxlbWVudHMgdGhlIExpc3RlbiBSUEMuXG4gKlxuICogT25jZSB0aGUgTGlzdGVuIHN0cmVhbSBoYXMgY2FsbGVkIHRoZSBvbk9wZW4oKSBsaXN0ZW5lciwgYW55IG51bWJlciBvZlxuICogbGlzdGVuKCkgYW5kIHVubGlzdGVuKCkgY2FsbHMgY2FuIGJlIG1hZGUgdG8gY29udHJvbCB3aGF0IGNoYW5nZXMgd2lsbCBiZVxuICogc2VudCBmcm9tIHRoZSBzZXJ2ZXIgZm9yIExpc3RlblJlc3BvbnNlcy5cbiAqLyBjbGFzcyBIbyBleHRlbmRzIHpvIHtcbiAgICBjb25zdHJ1Y3Rvcih0LCBlLCBuLCBzLCBpLCByKSB7XG4gICAgICAgIHN1cGVyKHQsIFwibGlzdGVuX3N0cmVhbV9jb25uZWN0aW9uX2JhY2tvZmZcIiAvKiBMaXN0ZW5TdHJlYW1Db25uZWN0aW9uQmFja29mZiAqLyAsIFwibGlzdGVuX3N0cmVhbV9pZGxlXCIgLyogTGlzdGVuU3RyZWFtSWRsZSAqLyAsIFwiaGVhbHRoX2NoZWNrX3RpbWVvdXRcIiAvKiBIZWFsdGhDaGVja1RpbWVvdXQgKi8gLCBlLCBuLCBzLCByKSwgXG4gICAgICAgIHRoaXMuTSA9IGk7XG4gICAgfVxuICAgIFdvKHQsIGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuU28ud28oXCJMaXN0ZW5cIiwgdCwgZSk7XG4gICAgfVxuICAgIG9uTWVzc2FnZSh0KSB7XG4gICAgICAgIC8vIEEgc3VjY2Vzc2Z1bCByZXNwb25zZSBtZWFucyB0aGUgc3RyZWFtIGlzIGhlYWx0aHlcbiAgICAgICAgdGhpcy5Oby5yZXNldCgpO1xuICAgICAgICBjb25zdCBlID0gVnModGhpcy5NLCB0KSwgbiA9IGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgICAgIC8vIFdlIGhhdmUgb25seSByZWFjaGVkIGEgY29uc2lzdGVudCBzbmFwc2hvdCBmb3IgdGhlIGVudGlyZSBzdHJlYW0gaWYgdGhlcmVcbiAgICAgICAgICAgIC8vIGlzIGEgcmVhZF90aW1lIHNldCBhbmQgaXQgYXBwbGllcyB0byBhbGwgdGFyZ2V0cyAoaS5lLiB0aGUgbGlzdCBvZlxuICAgICAgICAgICAgLy8gdGFyZ2V0cyBpcyBlbXB0eSkuIFRoZSBiYWNrZW5kIGlzIGd1YXJhbnRlZWQgdG8gc2VuZCBzdWNoIHJlc3BvbnNlcy5cbiAgICAgICAgICAgIGlmICghKFwidGFyZ2V0Q2hhbmdlXCIgaW4gdCkpIHJldHVybiBjdC5taW4oKTtcbiAgICAgICAgICAgIGNvbnN0IGUgPSB0LnRhcmdldENoYW5nZTtcbiAgICAgICAgICAgIHJldHVybiBlLnRhcmdldElkcyAmJiBlLnRhcmdldElkcy5sZW5ndGggPyBjdC5taW4oKSA6IGUucmVhZFRpbWUgPyB3cyhlLnJlYWRUaW1lKSA6IGN0Lm1pbigpO1xuICAgICAgICB9KHQpO1xuICAgICAgICByZXR1cm4gdGhpcy5saXN0ZW5lci56byhlLCBuKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmVnaXN0ZXJzIGludGVyZXN0IGluIHRoZSByZXN1bHRzIG9mIHRoZSBnaXZlbiB0YXJnZXQuIElmIHRoZSB0YXJnZXRcbiAgICAgKiBpbmNsdWRlcyBhIHJlc3VtZVRva2VuIGl0IHdpbGwgYmUgaW5jbHVkZWQgaW4gdGhlIHJlcXVlc3QuIFJlc3VsdHMgdGhhdFxuICAgICAqIGFmZmVjdCB0aGUgdGFyZ2V0IHdpbGwgYmUgc3RyZWFtZWQgYmFjayBhcyBXYXRjaENoYW5nZSBtZXNzYWdlcyB0aGF0XG4gICAgICogcmVmZXJlbmNlIHRoZSB0YXJnZXRJZC5cbiAgICAgKi8gICAgSG8odCkge1xuICAgICAgICBjb25zdCBlID0ge307XG4gICAgICAgIGUuZGF0YWJhc2UgPSBFcyh0aGlzLk0pLCBlLmFkZFRhcmdldCA9IGZ1bmN0aW9uKHQsIGUpIHtcbiAgICAgICAgICAgIGxldCBuO1xuICAgICAgICAgICAgY29uc3QgcyA9IGUudGFyZ2V0O1xuICAgICAgICAgICAgcmV0dXJuIG4gPSBBZShzKSA/IHtcbiAgICAgICAgICAgICAgICBkb2N1bWVudHM6IENzKHQsIHMpXG4gICAgICAgICAgICB9IDoge1xuICAgICAgICAgICAgICAgIHF1ZXJ5OiB4cyh0LCBzKVxuICAgICAgICAgICAgfSwgbi50YXJnZXRJZCA9IGUudGFyZ2V0SWQsIGUucmVzdW1lVG9rZW4uYXBwcm94aW1hdGVCeXRlU2l6ZSgpID4gMCA/IG4ucmVzdW1lVG9rZW4gPSBkcyh0LCBlLnJlc3VtZVRva2VuKSA6IGUuc25hcHNob3RWZXJzaW9uLmNvbXBhcmVUbyhjdC5taW4oKSkgPiAwICYmIChcbiAgICAgICAgICAgIC8vIFRPRE8od3VhbmR5KTogQ29uc2lkZXIgcmVtb3ZpbmcgYWJvdmUgY2hlY2sgYmVjYXVzZSBpdCBpcyBtb3N0IGxpa2VseSB0cnVlLlxuICAgICAgICAgICAgLy8gUmlnaHQgbm93LCBtYW55IHRlc3RzIGRlcGVuZCBvbiB0aGlzIGJlaGF2aW91ciB0aG91Z2ggKGxlYXZpbmcgbWluKCkgb3V0XG4gICAgICAgICAgICAvLyBvZiBzZXJpYWxpemF0aW9uKS5cbiAgICAgICAgICAgIG4ucmVhZFRpbWUgPSBmcyh0LCBlLnNuYXBzaG90VmVyc2lvbi50b1RpbWVzdGFtcCgpKSksIG47XG4gICAgICAgIH0odGhpcy5NLCB0KTtcbiAgICAgICAgY29uc3QgbiA9IGtzKHRoaXMuTSwgdCk7XG4gICAgICAgIG4gJiYgKGUubGFiZWxzID0gbiksIHRoaXMuTG8oZSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFVucmVnaXN0ZXJzIGludGVyZXN0IGluIHRoZSByZXN1bHRzIG9mIHRoZSB0YXJnZXQgYXNzb2NpYXRlZCB3aXRoIHRoZVxuICAgICAqIGdpdmVuIHRhcmdldElkLlxuICAgICAqLyAgICBKbyh0KSB7XG4gICAgICAgIGNvbnN0IGUgPSB7fTtcbiAgICAgICAgZS5kYXRhYmFzZSA9IEVzKHRoaXMuTSksIGUucmVtb3ZlVGFyZ2V0ID0gdCwgdGhpcy5MbyhlKTtcbiAgICB9XG59XG5cbi8qKlxuICogQSBTdHJlYW0gdGhhdCBpbXBsZW1lbnRzIHRoZSBXcml0ZSBSUEMuXG4gKlxuICogVGhlIFdyaXRlIFJQQyByZXF1aXJlcyB0aGUgY2FsbGVyIHRvIG1haW50YWluIHNwZWNpYWwgc3RyZWFtVG9rZW5cbiAqIHN0YXRlIGluIGJldHdlZW4gY2FsbHMsIHRvIGhlbHAgdGhlIHNlcnZlciB1bmRlcnN0YW5kIHdoaWNoIHJlc3BvbnNlcyB0aGVcbiAqIGNsaWVudCBoYXMgcHJvY2Vzc2VkIGJ5IHRoZSB0aW1lIHRoZSBuZXh0IHJlcXVlc3QgaXMgbWFkZS4gRXZlcnkgcmVzcG9uc2VcbiAqIHdpbGwgY29udGFpbiBhIHN0cmVhbVRva2VuOyB0aGlzIHZhbHVlIG11c3QgYmUgcGFzc2VkIHRvIHRoZSBuZXh0XG4gKiByZXF1ZXN0LlxuICpcbiAqIEFmdGVyIGNhbGxpbmcgc3RhcnQoKSBvbiB0aGlzIHN0cmVhbSwgdGhlIG5leHQgcmVxdWVzdCBtdXN0IGJlIGEgaGFuZHNoYWtlLFxuICogY29udGFpbmluZyB3aGF0ZXZlciBzdHJlYW1Ub2tlbiBpcyBvbiBoYW5kLiBPbmNlIGEgcmVzcG9uc2UgdG8gdGhpc1xuICogcmVxdWVzdCBpcyByZWNlaXZlZCwgYWxsIHBlbmRpbmcgbXV0YXRpb25zIG1heSBiZSBzdWJtaXR0ZWQuIFdoZW5cbiAqIHN1Ym1pdHRpbmcgbXVsdGlwbGUgYmF0Y2hlcyBvZiBtdXRhdGlvbnMgYXQgdGhlIHNhbWUgdGltZSwgaXQnc1xuICogb2theSB0byB1c2UgdGhlIHNhbWUgc3RyZWFtVG9rZW4gZm9yIHRoZSBjYWxscyB0byB3cml0ZU11dGF0aW9ucy5cbiAqXG4gKiBUT0RPKGIvMzMyNzEyMzUpOiBVc2UgcHJvdG8gdHlwZXNcbiAqLyBjbGFzcyBKbyBleHRlbmRzIHpvIHtcbiAgICBjb25zdHJ1Y3Rvcih0LCBlLCBuLCBzLCBpLCByKSB7XG4gICAgICAgIHN1cGVyKHQsIFwid3JpdGVfc3RyZWFtX2Nvbm5lY3Rpb25fYmFja29mZlwiIC8qIFdyaXRlU3RyZWFtQ29ubmVjdGlvbkJhY2tvZmYgKi8gLCBcIndyaXRlX3N0cmVhbV9pZGxlXCIgLyogV3JpdGVTdHJlYW1JZGxlICovICwgXCJoZWFsdGhfY2hlY2tfdGltZW91dFwiIC8qIEhlYWx0aENoZWNrVGltZW91dCAqLyAsIGUsIG4sIHMsIHIpLCBcbiAgICAgICAgdGhpcy5NID0gaSwgdGhpcy5ZbyA9ICExO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBUcmFja3Mgd2hldGhlciBvciBub3QgYSBoYW5kc2hha2UgaGFzIGJlZW4gc3VjY2Vzc2Z1bGx5IGV4Y2hhbmdlZCBhbmRcbiAgICAgKiB0aGUgc3RyZWFtIGlzIHJlYWR5IHRvIGFjY2VwdCBtdXRhdGlvbnMuXG4gICAgICovICAgIGdldCBYbygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuWW87XG4gICAgfVxuICAgIC8vIE92ZXJyaWRlIG9mIFBlcnNpc3RlbnRTdHJlYW0uc3RhcnRcbiAgICBzdGFydCgpIHtcbiAgICAgICAgdGhpcy5ZbyA9ICExLCB0aGlzLmxhc3RTdHJlYW1Ub2tlbiA9IHZvaWQgMCwgc3VwZXIuc3RhcnQoKTtcbiAgICB9XG4gICAgS28oKSB7XG4gICAgICAgIHRoaXMuWW8gJiYgdGhpcy5abyhbXSk7XG4gICAgfVxuICAgIFdvKHQsIGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuU28ud28oXCJXcml0ZVwiLCB0LCBlKTtcbiAgICB9XG4gICAgb25NZXNzYWdlKHQpIHtcbiAgICAgICAgaWYgKFxuICAgICAgICAvLyBBbHdheXMgY2FwdHVyZSB0aGUgbGFzdCBzdHJlYW0gdG9rZW4uXG4gICAgICAgIFUoISF0LnN0cmVhbVRva2VuKSwgdGhpcy5sYXN0U3RyZWFtVG9rZW4gPSB0LnN0cmVhbVRva2VuLCB0aGlzLllvKSB7XG4gICAgICAgICAgICAvLyBBIHN1Y2Nlc3NmdWwgZmlyc3Qgd3JpdGUgcmVzcG9uc2UgbWVhbnMgdGhlIHN0cmVhbSBpcyBoZWFsdGh5LFxuICAgICAgICAgICAgLy8gTm90ZSwgdGhhdCB3ZSBjb3VsZCBjb25zaWRlciBhIHN1Y2Nlc3NmdWwgaGFuZHNoYWtlIGhlYWx0aHksIGhvd2V2ZXIsXG4gICAgICAgICAgICAvLyB0aGUgd3JpdGUgaXRzZWxmIG1pZ2h0IGJlIGNhdXNpbmcgYW4gZXJyb3Igd2Ugd2FudCB0byBiYWNrIG9mZiBmcm9tLlxuICAgICAgICAgICAgdGhpcy5Oby5yZXNldCgpO1xuICAgICAgICAgICAgY29uc3QgZSA9IERzKHQud3JpdGVSZXN1bHRzLCB0LmNvbW1pdFRpbWUpLCBuID0gd3ModC5jb21taXRUaW1lKTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmxpc3RlbmVyLnR1KG4sIGUpO1xuICAgICAgICB9XG4gICAgICAgIC8vIFRoZSBmaXJzdCByZXNwb25zZSBpcyBhbHdheXMgdGhlIGhhbmRzaGFrZSByZXNwb25zZVxuICAgICAgICByZXR1cm4gVSghdC53cml0ZVJlc3VsdHMgfHwgMCA9PT0gdC53cml0ZVJlc3VsdHMubGVuZ3RoKSwgdGhpcy5ZbyA9ICEwLCB0aGlzLmxpc3RlbmVyLmV1KCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFNlbmRzIGFuIGluaXRpYWwgc3RyZWFtVG9rZW4gdG8gdGhlIHNlcnZlciwgcGVyZm9ybWluZyB0aGUgaGFuZHNoYWtlXG4gICAgICogcmVxdWlyZWQgdG8gbWFrZSB0aGUgU3RyZWFtaW5nV3JpdGUgUlBDIHdvcmsuIFN1YnNlcXVlbnRcbiAgICAgKiBjYWxscyBzaG91bGQgd2FpdCB1bnRpbCBvbkhhbmRzaGFrZUNvbXBsZXRlIHdhcyBjYWxsZWQuXG4gICAgICovICAgIG51KCkge1xuICAgICAgICAvLyBUT0RPKGRpbW9uZCk6IFN1cHBvcnQgc3RyZWFtIHJlc3VtcHRpb24uIFdlIGludGVudGlvbmFsbHkgZG8gbm90IHNldCB0aGVcbiAgICAgICAgLy8gc3RyZWFtIHRva2VuIG9uIHRoZSBoYW5kc2hha2UsIGlnbm9yaW5nIGFueSBzdHJlYW0gdG9rZW4gd2UgbWlnaHQgaGF2ZS5cbiAgICAgICAgY29uc3QgdCA9IHt9O1xuICAgICAgICB0LmRhdGFiYXNlID0gRXModGhpcy5NKSwgdGhpcy5Mbyh0KTtcbiAgICB9XG4gICAgLyoqIFNlbmRzIGEgZ3JvdXAgb2YgbXV0YXRpb25zIHRvIHRoZSBGaXJlc3RvcmUgYmFja2VuZCB0byBhcHBseS4gKi8gICAgWm8odCkge1xuICAgICAgICBjb25zdCBlID0ge1xuICAgICAgICAgICAgc3RyZWFtVG9rZW46IHRoaXMubGFzdFN0cmVhbVRva2VuLFxuICAgICAgICAgICAgd3JpdGVzOiB0Lm1hcCgodCA9PiB2cyh0aGlzLk0sIHQpKSlcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5MbyhlKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIERhdGFzdG9yZSBhbmQgaXRzIHJlbGF0ZWQgbWV0aG9kcyBhcmUgYSB3cmFwcGVyIGFyb3VuZCB0aGUgZXh0ZXJuYWwgR29vZ2xlXG4gKiBDbG91ZCBEYXRhc3RvcmUgZ3JwYyBBUEksIHdoaWNoIHByb3ZpZGVzIGFuIGludGVyZmFjZSB0aGF0IGlzIG1vcmUgY29udmVuaWVudFxuICogZm9yIHRoZSByZXN0IG9mIHRoZSBjbGllbnQgU0RLIGFyY2hpdGVjdHVyZSB0byBjb25zdW1lLlxuICovXG4vKipcbiAqIEFuIGltcGxlbWVudGF0aW9uIG9mIERhdGFzdG9yZSB0aGF0IGV4cG9zZXMgYWRkaXRpb25hbCBzdGF0ZSBmb3IgaW50ZXJuYWxcbiAqIGNvbnN1bXB0aW9uLlxuICovXG5jbGFzcyBZbyBleHRlbmRzIGNsYXNzIHt9IHtcbiAgICBjb25zdHJ1Y3Rvcih0LCBlLCBuLCBzKSB7XG4gICAgICAgIHN1cGVyKCksIHRoaXMuYXV0aENyZWRlbnRpYWxzID0gdCwgdGhpcy5hcHBDaGVja0NyZWRlbnRpYWxzID0gZSwgdGhpcy5TbyA9IG4sIHRoaXMuTSA9IHMsIFxuICAgICAgICB0aGlzLnN1ID0gITE7XG4gICAgfVxuICAgIGl1KCkge1xuICAgICAgICBpZiAodGhpcy5zdSkgdGhyb3cgbmV3IFEoRy5GQUlMRURfUFJFQ09ORElUSU9OLCBcIlRoZSBjbGllbnQgaGFzIGFscmVhZHkgYmVlbiB0ZXJtaW5hdGVkLlwiKTtcbiAgICB9XG4gICAgLyoqIEludm9rZXMgdGhlIHByb3ZpZGVkIFJQQyB3aXRoIGF1dGggYW5kIEFwcENoZWNrIHRva2Vucy4gKi8gICAgY28odCwgZSwgbikge1xuICAgICAgICByZXR1cm4gdGhpcy5pdSgpLCBQcm9taXNlLmFsbChbIHRoaXMuYXV0aENyZWRlbnRpYWxzLmdldFRva2VuKCksIHRoaXMuYXBwQ2hlY2tDcmVkZW50aWFscy5nZXRUb2tlbigpIF0pLnRoZW4oKChbcywgaV0pID0+IHRoaXMuU28uY28odCwgZSwgbiwgcywgaSkpKS5jYXRjaCgodCA9PiB7XG4gICAgICAgICAgICB0aHJvdyBcIkZpcmViYXNlRXJyb3JcIiA9PT0gdC5uYW1lID8gKHQuY29kZSA9PT0gRy5VTkFVVEhFTlRJQ0FURUQgJiYgKHRoaXMuYXV0aENyZWRlbnRpYWxzLmludmFsaWRhdGVUb2tlbigpLCBcbiAgICAgICAgICAgIHRoaXMuYXBwQ2hlY2tDcmVkZW50aWFscy5pbnZhbGlkYXRlVG9rZW4oKSksIHQpIDogbmV3IFEoRy5VTktOT1dOLCB0LnRvU3RyaW5nKCkpO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIC8qKiBJbnZva2VzIHRoZSBwcm92aWRlZCBSUEMgd2l0aCBzdHJlYW1lZCByZXN1bHRzIHdpdGggYXV0aCBhbmQgQXBwQ2hlY2sgdG9rZW5zLiAqLyAgICBfbyh0LCBlLCBuKSB7XG4gICAgICAgIHJldHVybiB0aGlzLml1KCksIFByb21pc2UuYWxsKFsgdGhpcy5hdXRoQ3JlZGVudGlhbHMuZ2V0VG9rZW4oKSwgdGhpcy5hcHBDaGVja0NyZWRlbnRpYWxzLmdldFRva2VuKCkgXSkudGhlbigoKFtzLCBpXSkgPT4gdGhpcy5Tby5fbyh0LCBlLCBuLCBzLCBpKSkpLmNhdGNoKCh0ID0+IHtcbiAgICAgICAgICAgIHRocm93IFwiRmlyZWJhc2VFcnJvclwiID09PSB0Lm5hbWUgPyAodC5jb2RlID09PSBHLlVOQVVUSEVOVElDQVRFRCAmJiAodGhpcy5hdXRoQ3JlZGVudGlhbHMuaW52YWxpZGF0ZVRva2VuKCksIFxuICAgICAgICAgICAgdGhpcy5hcHBDaGVja0NyZWRlbnRpYWxzLmludmFsaWRhdGVUb2tlbigpKSwgdCkgOiBuZXcgUShHLlVOS05PV04sIHQudG9TdHJpbmcoKSk7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgdGVybWluYXRlKCkge1xuICAgICAgICB0aGlzLnN1ID0gITA7XG4gICAgfVxufVxuXG4vLyBUT0RPKGZpcmVzdG9yZXhwKTogTWFrZSBzdXJlIHRoZXJlIGlzIG9ubHkgb25lIERhdGFzdG9yZSBpbnN0YW5jZSBwZXJcbi8vIGZpcmVzdG9yZS1leHAgY2xpZW50LlxuLyoqXG4gKiBBIGNvbXBvbmVudCB1c2VkIGJ5IHRoZSBSZW1vdGVTdG9yZSB0byB0cmFjayB0aGUgT25saW5lU3RhdGUgKHRoYXQgaXMsXG4gKiB3aGV0aGVyIG9yIG5vdCB0aGUgY2xpZW50IGFzIGEgd2hvbGUgc2hvdWxkIGJlIGNvbnNpZGVyZWQgdG8gYmUgb25saW5lIG9yXG4gKiBvZmZsaW5lKSwgaW1wbGVtZW50aW5nIHRoZSBhcHByb3ByaWF0ZSBoZXVyaXN0aWNzLlxuICpcbiAqIEluIHBhcnRpY3VsYXIsIHdoZW4gdGhlIGNsaWVudCBpcyB0cnlpbmcgdG8gY29ubmVjdCB0byB0aGUgYmFja2VuZCwgd2VcbiAqIGFsbG93IHVwIHRvIE1BWF9XQVRDSF9TVFJFQU1fRkFJTFVSRVMgd2l0aGluIE9OTElORV9TVEFURV9USU1FT1VUX01TIGZvclxuICogYSBjb25uZWN0aW9uIHRvIHN1Y2NlZWQuIElmIHdlIGhhdmUgdG9vIG1hbnkgZmFpbHVyZXMgb3IgdGhlIHRpbWVvdXQgZWxhcHNlcyxcbiAqIHRoZW4gd2Ugc2V0IHRoZSBPbmxpbmVTdGF0ZSB0byBPZmZsaW5lLCBhbmQgdGhlIGNsaWVudCB3aWxsIGJlaGF2ZSBhcyBpZlxuICogaXQgaXMgb2ZmbGluZSAoZ2V0KClzIHdpbGwgcmV0dXJuIGNhY2hlZCBkYXRhLCBldGMuKS5cbiAqL1xuY2xhc3MgWG8ge1xuICAgIGNvbnN0cnVjdG9yKHQsIGUpIHtcbiAgICAgICAgdGhpcy5hc3luY1F1ZXVlID0gdCwgdGhpcy5vbmxpbmVTdGF0ZUhhbmRsZXIgPSBlLCBcbiAgICAgICAgLyoqIFRoZSBjdXJyZW50IE9ubGluZVN0YXRlLiAqL1xuICAgICAgICB0aGlzLnN0YXRlID0gXCJVbmtub3duXCIgLyogVW5rbm93biAqLyAsIFxuICAgICAgICAvKipcbiAgICAgICAgICogQSBjb3VudCBvZiBjb25zZWN1dGl2ZSBmYWlsdXJlcyB0byBvcGVuIHRoZSBzdHJlYW0uIElmIGl0IHJlYWNoZXMgdGhlXG4gICAgICAgICAqIG1heGltdW0gZGVmaW5lZCBieSBNQVhfV0FUQ0hfU1RSRUFNX0ZBSUxVUkVTLCB3ZSdsbCBzZXQgdGhlIE9ubGluZVN0YXRlIHRvXG4gICAgICAgICAqIE9mZmxpbmUuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnJ1ID0gMCwgXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBIHRpbWVyIHRoYXQgZWxhcHNlcyBhZnRlciBPTkxJTkVfU1RBVEVfVElNRU9VVF9NUywgYXQgd2hpY2ggcG9pbnQgd2VcbiAgICAgICAgICogdHJhbnNpdGlvbiBmcm9tIE9ubGluZVN0YXRlLlVua25vd24gdG8gT25saW5lU3RhdGUuT2ZmbGluZSB3aXRob3V0IHdhaXRpbmdcbiAgICAgICAgICogZm9yIHRoZSBzdHJlYW0gdG8gYWN0dWFsbHkgZmFpbCAoTUFYX1dBVENIX1NUUkVBTV9GQUlMVVJFUyB0aW1lcykuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLm91ID0gbnVsbCwgXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBXaGV0aGVyIHRoZSBjbGllbnQgc2hvdWxkIGxvZyBhIHdhcm5pbmcgbWVzc2FnZSBpZiBpdCBmYWlscyB0byBjb25uZWN0IHRvXG4gICAgICAgICAqIHRoZSBiYWNrZW5kIChpbml0aWFsbHkgdHJ1ZSwgY2xlYXJlZCBhZnRlciBhIHN1Y2Nlc3NmdWwgc3RyZWFtLCBvciBpZiB3ZSd2ZVxuICAgICAgICAgKiBsb2dnZWQgdGhlIG1lc3NhZ2UgYWxyZWFkeSkuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnV1ID0gITA7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENhbGxlZCBieSBSZW1vdGVTdG9yZSB3aGVuIGEgd2F0Y2ggc3RyZWFtIGlzIHN0YXJ0ZWQgKGluY2x1ZGluZyBvbiBlYWNoXG4gICAgICogYmFja29mZiBhdHRlbXB0KS5cbiAgICAgKlxuICAgICAqIElmIHRoaXMgaXMgdGhlIGZpcnN0IGF0dGVtcHQsIGl0IHNldHMgdGhlIE9ubGluZVN0YXRlIHRvIFVua25vd24gYW5kIHN0YXJ0c1xuICAgICAqIHRoZSBvbmxpbmVTdGF0ZVRpbWVyLlxuICAgICAqLyAgICBhdSgpIHtcbiAgICAgICAgMCA9PT0gdGhpcy5ydSAmJiAodGhpcy5jdShcIlVua25vd25cIiAvKiBVbmtub3duICovKSwgdGhpcy5vdSA9IHRoaXMuYXN5bmNRdWV1ZS5lbnF1ZXVlQWZ0ZXJEZWxheShcIm9ubGluZV9zdGF0ZV90aW1lb3V0XCIgLyogT25saW5lU3RhdGVUaW1lb3V0ICovICwgMWU0LCAoKCkgPT4gKHRoaXMub3UgPSBudWxsLCBcbiAgICAgICAgdGhpcy5odShcIkJhY2tlbmQgZGlkbid0IHJlc3BvbmQgd2l0aGluIDEwIHNlY29uZHMuXCIpLCB0aGlzLmN1KFwiT2ZmbGluZVwiIC8qIE9mZmxpbmUgKi8pLCBcbiAgICAgICAgUHJvbWlzZS5yZXNvbHZlKCkpKSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBVcGRhdGVzIG91ciBPbmxpbmVTdGF0ZSBhcyBhcHByb3ByaWF0ZSBhZnRlciB0aGUgd2F0Y2ggc3RyZWFtIHJlcG9ydHMgYVxuICAgICAqIGZhaWx1cmUuIFRoZSBmaXJzdCBmYWlsdXJlIG1vdmVzIHVzIHRvIHRoZSAnVW5rbm93bicgc3RhdGUuIFdlIHRoZW4gbWF5XG4gICAgICogYWxsb3cgbXVsdGlwbGUgZmFpbHVyZXMgKGJhc2VkIG9uIE1BWF9XQVRDSF9TVFJFQU1fRkFJTFVSRVMpIGJlZm9yZSB3ZVxuICAgICAqIGFjdHVhbGx5IHRyYW5zaXRpb24gdG8gdGhlICdPZmZsaW5lJyBzdGF0ZS5cbiAgICAgKi8gICAgbHUodCkge1xuICAgICAgICBcIk9ubGluZVwiIC8qIE9ubGluZSAqLyA9PT0gdGhpcy5zdGF0ZSA/IHRoaXMuY3UoXCJVbmtub3duXCIgLyogVW5rbm93biAqLykgOiAodGhpcy5ydSsrLCBcbiAgICAgICAgdGhpcy5ydSA+PSAxICYmICh0aGlzLmZ1KCksIHRoaXMuaHUoYENvbm5lY3Rpb24gZmFpbGVkIDEgdGltZXMuIE1vc3QgcmVjZW50IGVycm9yOiAke3QudG9TdHJpbmcoKX1gKSwgXG4gICAgICAgIHRoaXMuY3UoXCJPZmZsaW5lXCIgLyogT2ZmbGluZSAqLykpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRXhwbGljaXRseSBzZXRzIHRoZSBPbmxpbmVTdGF0ZSB0byB0aGUgc3BlY2lmaWVkIHN0YXRlLlxuICAgICAqXG4gICAgICogTm90ZSB0aGF0IHRoaXMgcmVzZXRzIG91ciB0aW1lcnMgLyBmYWlsdXJlIGNvdW50ZXJzLCBldGMuIHVzZWQgYnkgb3VyXG4gICAgICogT2ZmbGluZSBoZXVyaXN0aWNzLCBzbyBtdXN0IG5vdCBiZSB1c2VkIGluIHBsYWNlIG9mXG4gICAgICogaGFuZGxlV2F0Y2hTdHJlYW1TdGFydCgpIGFuZCBoYW5kbGVXYXRjaFN0cmVhbUZhaWx1cmUoKS5cbiAgICAgKi8gICAgc2V0KHQpIHtcbiAgICAgICAgdGhpcy5mdSgpLCB0aGlzLnJ1ID0gMCwgXCJPbmxpbmVcIiAvKiBPbmxpbmUgKi8gPT09IHQgJiYgKFxuICAgICAgICAvLyBXZSd2ZSBjb25uZWN0ZWQgdG8gd2F0Y2ggYXQgbGVhc3Qgb25jZS4gRG9uJ3Qgd2FybiB0aGUgZGV2ZWxvcGVyXG4gICAgICAgIC8vIGFib3V0IGJlaW5nIG9mZmxpbmUgZ29pbmcgZm9yd2FyZC5cbiAgICAgICAgdGhpcy51dSA9ICExKSwgdGhpcy5jdSh0KTtcbiAgICB9XG4gICAgY3UodCkge1xuICAgICAgICB0ICE9PSB0aGlzLnN0YXRlICYmICh0aGlzLnN0YXRlID0gdCwgdGhpcy5vbmxpbmVTdGF0ZUhhbmRsZXIodCkpO1xuICAgIH1cbiAgICBodSh0KSB7XG4gICAgICAgIGNvbnN0IGUgPSBgQ291bGQgbm90IHJlYWNoIENsb3VkIEZpcmVzdG9yZSBiYWNrZW5kLiAke3R9XFxuVGhpcyB0eXBpY2FsbHkgaW5kaWNhdGVzIHRoYXQgeW91ciBkZXZpY2UgZG9lcyBub3QgaGF2ZSBhIGhlYWx0aHkgSW50ZXJuZXQgY29ubmVjdGlvbiBhdCB0aGUgbW9tZW50LiBUaGUgY2xpZW50IHdpbGwgb3BlcmF0ZSBpbiBvZmZsaW5lIG1vZGUgdW50aWwgaXQgaXMgYWJsZSB0byBzdWNjZXNzZnVsbHkgY29ubmVjdCB0byB0aGUgYmFja2VuZC5gO1xuICAgICAgICB0aGlzLnV1ID8gKEYoZSksIHRoaXMudXUgPSAhMSkgOiBPKFwiT25saW5lU3RhdGVUcmFja2VyXCIsIGUpO1xuICAgIH1cbiAgICBmdSgpIHtcbiAgICAgICAgbnVsbCAhPT0gdGhpcy5vdSAmJiAodGhpcy5vdS5jYW5jZWwoKSwgdGhpcy5vdSA9IG51bGwpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi8gY2xhc3MgWm8ge1xuICAgIGNvbnN0cnVjdG9yKFxuICAgIC8qKlxuICAgICAqIFRoZSBsb2NhbCBzdG9yZSwgdXNlZCB0byBmaWxsIHRoZSB3cml0ZSBwaXBlbGluZSB3aXRoIG91dGJvdW5kIG11dGF0aW9ucy5cbiAgICAgKi9cbiAgICB0LCBcbiAgICAvKiogVGhlIGNsaWVudC1zaWRlIHByb3h5IGZvciBpbnRlcmFjdGluZyB3aXRoIHRoZSBiYWNrZW5kLiAqL1xuICAgIGUsIG4sIHMsIGkpIHtcbiAgICAgICAgdGhpcy5sb2NhbFN0b3JlID0gdCwgdGhpcy5kYXRhc3RvcmUgPSBlLCB0aGlzLmFzeW5jUXVldWUgPSBuLCB0aGlzLnJlbW90ZVN5bmNlciA9IHt9LCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEEgbGlzdCBvZiB1cCB0byBNQVhfUEVORElOR19XUklURVMgd3JpdGVzIHRoYXQgd2UgaGF2ZSBmZXRjaGVkIGZyb20gdGhlXG4gICAgICAgICAqIExvY2FsU3RvcmUgdmlhIGZpbGxXcml0ZVBpcGVsaW5lKCkgYW5kIGhhdmUgb3Igd2lsbCBzZW5kIHRvIHRoZSB3cml0ZVxuICAgICAgICAgKiBzdHJlYW0uXG4gICAgICAgICAqXG4gICAgICAgICAqIFdoZW5ldmVyIHdyaXRlUGlwZWxpbmUubGVuZ3RoID4gMCB0aGUgUmVtb3RlU3RvcmUgd2lsbCBhdHRlbXB0IHRvIHN0YXJ0IG9yXG4gICAgICAgICAqIHJlc3RhcnQgdGhlIHdyaXRlIHN0cmVhbS4gV2hlbiB0aGUgc3RyZWFtIGlzIGVzdGFibGlzaGVkIHRoZSB3cml0ZXMgaW4gdGhlXG4gICAgICAgICAqIHBpcGVsaW5lIHdpbGwgYmUgc2VudCBpbiBvcmRlci5cbiAgICAgICAgICpcbiAgICAgICAgICogV3JpdGVzIHJlbWFpbiBpbiB3cml0ZVBpcGVsaW5lIHVudGlsIHRoZXkgYXJlIGFja25vd2xlZGdlZCBieSB0aGUgYmFja2VuZFxuICAgICAgICAgKiBhbmQgdGh1cyB3aWxsIGF1dG9tYXRpY2FsbHkgYmUgcmUtc2VudCBpZiB0aGUgc3RyZWFtIGlzIGludGVycnVwdGVkIC9cbiAgICAgICAgICogcmVzdGFydGVkIGJlZm9yZSB0aGV5J3JlIGFja25vd2xlZGdlZC5cbiAgICAgICAgICpcbiAgICAgICAgICogV3JpdGUgcmVzcG9uc2VzIGZyb20gdGhlIGJhY2tlbmQgYXJlIGxpbmtlZCB0byB0aGVpciBvcmlnaW5hdGluZyByZXF1ZXN0XG4gICAgICAgICAqIHB1cmVseSBiYXNlZCBvbiBvcmRlciwgYW5kIHNvIHdlIGNhbiBqdXN0IHNoaWZ0KCkgd3JpdGVzIGZyb20gdGhlIGZyb250IG9mXG4gICAgICAgICAqIHRoZSB3cml0ZVBpcGVsaW5lIGFzIHdlIHJlY2VpdmUgcmVzcG9uc2VzLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5kdSA9IFtdLCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEEgbWFwcGluZyBvZiB3YXRjaGVkIHRhcmdldHMgdGhhdCB0aGUgY2xpZW50IGNhcmVzIGFib3V0IHRyYWNraW5nIGFuZCB0aGVcbiAgICAgICAgICogdXNlciBoYXMgZXhwbGljaXRseSBjYWxsZWQgYSAnbGlzdGVuJyBmb3IgdGhpcyB0YXJnZXQuXG4gICAgICAgICAqXG4gICAgICAgICAqIFRoZXNlIHRhcmdldHMgbWF5IG9yIG1heSBub3QgaGF2ZSBiZWVuIHNlbnQgdG8gb3IgYWNrbm93bGVkZ2VkIGJ5IHRoZVxuICAgICAgICAgKiBzZXJ2ZXIuIE9uIHJlLWVzdGFibGlzaGluZyB0aGUgbGlzdGVuIHN0cmVhbSwgdGhlc2UgdGFyZ2V0cyBzaG91bGQgYmUgc2VudFxuICAgICAgICAgKiB0byB0aGUgc2VydmVyLiBUaGUgdGFyZ2V0cyByZW1vdmVkIHdpdGggdW5saXN0ZW5zIGFyZSByZW1vdmVkIGVhZ2VybHlcbiAgICAgICAgICogd2l0aG91dCB3YWl0aW5nIGZvciBjb25maXJtYXRpb24gZnJvbSB0aGUgbGlzdGVuIHN0cmVhbS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuX3UgPSBuZXcgTWFwLCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEEgc2V0IG9mIHJlYXNvbnMgZm9yIHdoeSB0aGUgUmVtb3RlU3RvcmUgbWF5IGJlIG9mZmxpbmUuIElmIGVtcHR5LCB0aGVcbiAgICAgICAgICogUmVtb3RlU3RvcmUgbWF5IHN0YXJ0IGl0cyBuZXR3b3JrIGNvbm5lY3Rpb25zLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy53dSA9IG5ldyBTZXQsIFxuICAgICAgICAvKipcbiAgICAgICAgICogRXZlbnQgaGFuZGxlcnMgdGhhdCBnZXQgY2FsbGVkIHdoZW4gdGhlIG5ldHdvcmsgaXMgZGlzYWJsZWQgb3IgZW5hYmxlZC5cbiAgICAgICAgICpcbiAgICAgICAgICogUE9SVElORyBOT1RFOiBUaGVzZSBmdW5jdGlvbnMgYXJlIHVzZWQgb24gdGhlIFdlYiBjbGllbnQgdG8gY3JlYXRlIHRoZVxuICAgICAgICAgKiB1bmRlcmx5aW5nIHN0cmVhbXMgKHRvIHN1cHBvcnQgdHJlZS1zaGFrZWFibGUgc3RyZWFtcykuIE9uIEFuZHJvaWQgYW5kIGlPUyxcbiAgICAgICAgICogdGhlIHN0cmVhbXMgYXJlIGNyZWF0ZWQgZHVyaW5nIGNvbnN0cnVjdGlvbiBvZiBSZW1vdGVTdG9yZS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMubXUgPSBbXSwgdGhpcy5ndSA9IGksIHRoaXMuZ3UuS3IoKHQgPT4ge1xuICAgICAgICAgICAgbi5lbnF1ZXVlQW5kRm9yZ2V0KChhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgLy8gUG9ydGluZyBOb3RlOiBVbmxpa2UgaU9TLCBgcmVzdGFydE5ldHdvcmsoKWAgaXMgY2FsbGVkIGV2ZW4gd2hlbiB0aGVcbiAgICAgICAgICAgICAgICAvLyBuZXR3b3JrIGJlY29tZXMgdW5yZWFjaGFibGUgYXMgd2UgZG9uJ3QgaGF2ZSBhbnkgb3RoZXIgd2F5IHRvIHRlYXJcbiAgICAgICAgICAgICAgICAvLyBkb3duIG91ciBzdHJlYW1zLlxuICAgICAgICAgICAgICAgIGF1KHRoaXMpICYmIChPKFwiUmVtb3RlU3RvcmVcIiwgXCJSZXN0YXJ0aW5nIHN0cmVhbXMgZm9yIG5ldHdvcmsgcmVhY2hhYmlsaXR5IGNoYW5nZS5cIiksIFxuICAgICAgICAgICAgICAgIGF3YWl0IGFzeW5jIGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZSA9IEsodCk7XG4gICAgICAgICAgICAgICAgICAgIGUud3UuYWRkKDQgLyogQ29ubmVjdGl2aXR5Q2hhbmdlICovKSwgYXdhaXQgZXUoZSksIGUueXUuc2V0KFwiVW5rbm93blwiIC8qIFVua25vd24gKi8pLCBcbiAgICAgICAgICAgICAgICAgICAgZS53dS5kZWxldGUoNCAvKiBDb25uZWN0aXZpdHlDaGFuZ2UgKi8pLCBhd2FpdCB0dShlKTtcbiAgICAgICAgICAgICAgICB9KHRoaXMpKTtcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgfSkpLCB0aGlzLnl1ID0gbmV3IFhvKG4sIHMpO1xuICAgIH1cbn1cblxuYXN5bmMgZnVuY3Rpb24gdHUodCkge1xuICAgIGlmIChhdSh0KSkgZm9yIChjb25zdCBlIG9mIHQubXUpIGF3YWl0IGUoLyogZW5hYmxlZD0gKi8gITApO1xufVxuXG4vKipcbiAqIFRlbXBvcmFyaWx5IGRpc2FibGVzIHRoZSBuZXR3b3JrLiBUaGUgbmV0d29yayBjYW4gYmUgcmUtZW5hYmxlZCB1c2luZ1xuICogZW5hYmxlTmV0d29yaygpLlxuICovIGFzeW5jIGZ1bmN0aW9uIGV1KHQpIHtcbiAgICBmb3IgKGNvbnN0IGUgb2YgdC5tdSkgYXdhaXQgZSgvKiBlbmFibGVkPSAqLyAhMSk7XG59XG5cbi8qKlxuICogU3RhcnRzIG5ldyBsaXN0ZW4gZm9yIHRoZSBnaXZlbiB0YXJnZXQuIFVzZXMgcmVzdW1lIHRva2VuIGlmIHByb3ZpZGVkLiBJdFxuICogaXMgYSBuby1vcCBpZiB0aGUgdGFyZ2V0IG9mIGdpdmVuIGBUYXJnZXREYXRhYCBpcyBhbHJlYWR5IGJlaW5nIGxpc3RlbmVkIHRvLlxuICovXG5mdW5jdGlvbiBudSh0LCBlKSB7XG4gICAgY29uc3QgbiA9IEsodCk7XG4gICAgbi5fdS5oYXMoZS50YXJnZXRJZCkgfHwgKFxuICAgIC8vIE1hcmsgdGhpcyBhcyBzb21ldGhpbmcgdGhlIGNsaWVudCBpcyBjdXJyZW50bHkgbGlzdGVuaW5nIGZvci5cbiAgICBuLl91LnNldChlLnRhcmdldElkLCBlKSwgdXUobikgPyBcbiAgICAvLyBUaGUgbGlzdGVuIHdpbGwgYmUgc2VudCBpbiBvbldhdGNoU3RyZWFtT3BlblxuICAgIG91KG4pIDogUHUobikuTW8oKSAmJiBpdShuLCBlKSk7XG59XG5cbi8qKlxuICogUmVtb3ZlcyB0aGUgbGlzdGVuIGZyb20gc2VydmVyLiBJdCBpcyBhIG5vLW9wIGlmIHRoZSBnaXZlbiB0YXJnZXQgaWQgaXNcbiAqIG5vdCBiZWluZyBsaXN0ZW5lZCB0by5cbiAqLyBmdW5jdGlvbiBzdSh0LCBlKSB7XG4gICAgY29uc3QgbiA9IEsodCksIHMgPSBQdShuKTtcbiAgICBuLl91LmRlbGV0ZShlKSwgcy5NbygpICYmIHJ1KG4sIGUpLCAwID09PSBuLl91LnNpemUgJiYgKHMuTW8oKSA/IHMuJG8oKSA6IGF1KG4pICYmIFxuICAgIC8vIFJldmVydCB0byBPbmxpbmVTdGF0ZS5Vbmtub3duIGlmIHRoZSB3YXRjaCBzdHJlYW0gaXMgbm90IG9wZW4gYW5kIHdlXG4gICAgLy8gaGF2ZSBubyBsaXN0ZW5lcnMsIHNpbmNlIHdpdGhvdXQgYW55IGxpc3RlbnMgdG8gc2VuZCB3ZSBjYW5ub3RcbiAgICAvLyBjb25maXJtIGlmIHRoZSBzdHJlYW0gaXMgaGVhbHRoeSBhbmQgdXBncmFkZSB0byBPbmxpbmVTdGF0ZS5PbmxpbmUuXG4gICAgbi55dS5zZXQoXCJVbmtub3duXCIgLyogVW5rbm93biAqLykpO1xufVxuXG4vKipcbiAqIFdlIG5lZWQgdG8gaW5jcmVtZW50IHRoZSB0aGUgZXhwZWN0ZWQgbnVtYmVyIG9mIHBlbmRpbmcgcmVzcG9uc2VzIHdlJ3JlIGR1ZVxuICogZnJvbSB3YXRjaCBzbyB3ZSB3YWl0IGZvciB0aGUgYWNrIHRvIHByb2Nlc3MgYW55IG1lc3NhZ2VzIGZyb20gdGhpcyB0YXJnZXQuXG4gKi8gZnVuY3Rpb24gaXUodCwgZSkge1xuICAgIHQucHUuWihlLnRhcmdldElkKSwgUHUodCkuSG8oZSk7XG59XG5cbi8qKlxuICogV2UgbmVlZCB0byBpbmNyZW1lbnQgdGhlIGV4cGVjdGVkIG51bWJlciBvZiBwZW5kaW5nIHJlc3BvbnNlcyB3ZSdyZSBkdWVcbiAqIGZyb20gd2F0Y2ggc28gd2Ugd2FpdCBmb3IgdGhlIHJlbW92YWwgb24gdGhlIHNlcnZlciBiZWZvcmUgd2UgcHJvY2VzcyBhbnlcbiAqIG1lc3NhZ2VzIGZyb20gdGhpcyB0YXJnZXQuXG4gKi8gZnVuY3Rpb24gcnUodCwgZSkge1xuICAgIHQucHUuWihlKSwgUHUodCkuSm8oZSk7XG59XG5cbmZ1bmN0aW9uIG91KHQpIHtcbiAgICB0LnB1ID0gbmV3IG9zKHtcbiAgICAgICAgZ2V0UmVtb3RlS2V5c0ZvclRhcmdldDogZSA9PiB0LnJlbW90ZVN5bmNlci5nZXRSZW1vdGVLZXlzRm9yVGFyZ2V0KGUpLFxuICAgICAgICBFdDogZSA9PiB0Ll91LmdldChlKSB8fCBudWxsXG4gICAgfSksIFB1KHQpLnN0YXJ0KCksIHQueXUuYXUoKTtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIHdoZXRoZXIgdGhlIHdhdGNoIHN0cmVhbSBzaG91bGQgYmUgc3RhcnRlZCBiZWNhdXNlIGl0J3MgbmVjZXNzYXJ5XG4gKiBhbmQgaGFzIG5vdCB5ZXQgYmVlbiBzdGFydGVkLlxuICovIGZ1bmN0aW9uIHV1KHQpIHtcbiAgICByZXR1cm4gYXUodCkgJiYgIVB1KHQpLmtvKCkgJiYgdC5fdS5zaXplID4gMDtcbn1cblxuZnVuY3Rpb24gYXUodCkge1xuICAgIHJldHVybiAwID09PSBLKHQpLnd1LnNpemU7XG59XG5cbmZ1bmN0aW9uIGN1KHQpIHtcbiAgICB0LnB1ID0gdm9pZCAwO1xufVxuXG5hc3luYyBmdW5jdGlvbiBodSh0KSB7XG4gICAgdC5fdS5mb3JFYWNoKCgoZSwgbikgPT4ge1xuICAgICAgICBpdSh0LCBlKTtcbiAgICB9KSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGx1KHQsIGUpIHtcbiAgICBjdSh0KSwgXG4gICAgLy8gSWYgd2Ugc3RpbGwgbmVlZCB0aGUgd2F0Y2ggc3RyZWFtLCByZXRyeSB0aGUgY29ubmVjdGlvbi5cbiAgICB1dSh0KSA/ICh0Lnl1Lmx1KGUpLCBvdSh0KSkgOiBcbiAgICAvLyBObyBuZWVkIHRvIHJlc3RhcnQgd2F0Y2ggc3RyZWFtIGJlY2F1c2UgdGhlcmUgYXJlIG5vIGFjdGl2ZSB0YXJnZXRzLlxuICAgIC8vIFRoZSBvbmxpbmUgc3RhdGUgaXMgc2V0IHRvIHVua25vd24gYmVjYXVzZSB0aGVyZSBpcyBubyBhY3RpdmUgYXR0ZW1wdFxuICAgIC8vIGF0IGVzdGFibGlzaGluZyBhIGNvbm5lY3Rpb25cbiAgICB0Lnl1LnNldChcIlVua25vd25cIiAvKiBVbmtub3duICovKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZnUodCwgZSwgbikge1xuICAgIGlmIChcbiAgICAvLyBNYXJrIHRoZSBjbGllbnQgYXMgb25saW5lIHNpbmNlIHdlIGdvdCBhIG1lc3NhZ2UgZnJvbSB0aGUgc2VydmVyXG4gICAgdC55dS5zZXQoXCJPbmxpbmVcIiAvKiBPbmxpbmUgKi8pLCBlIGluc3RhbmNlb2YgaXMgJiYgMiAvKiBSZW1vdmVkICovID09PSBlLnN0YXRlICYmIGUuY2F1c2UpIFxuICAgIC8vIFRoZXJlIHdhcyBhbiBlcnJvciBvbiBhIHRhcmdldCwgZG9uJ3Qgd2FpdCBmb3IgYSBjb25zaXN0ZW50IHNuYXBzaG90XG4gICAgLy8gdG8gcmFpc2UgZXZlbnRzXG4gICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgXG4gICAgICAgIC8qKiBIYW5kbGVzIGFuIGVycm9yIG9uIGEgdGFyZ2V0ICovXG4gICAgICAgIGFzeW5jIGZ1bmN0aW9uKHQsIGUpIHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSBlLmNhdXNlO1xuICAgICAgICAgICAgZm9yIChjb25zdCBzIG9mIGUudGFyZ2V0SWRzKSBcbiAgICAgICAgICAgIC8vIEEgd2F0Y2hlZCB0YXJnZXQgbWlnaHQgaGF2ZSBiZWVuIHJlbW92ZWQgYWxyZWFkeS5cbiAgICAgICAgICAgIHQuX3UuaGFzKHMpICYmIChhd2FpdCB0LnJlbW90ZVN5bmNlci5yZWplY3RMaXN0ZW4ocywgbiksIHQuX3UuZGVsZXRlKHMpLCB0LnB1LnJlbW92ZVRhcmdldChzKSk7XG4gICAgICAgIH1cbiAgICAgICAgLyoqXG4gKiBBdHRlbXB0cyB0byBmaWxsIG91ciB3cml0ZSBwaXBlbGluZSB3aXRoIHdyaXRlcyBmcm9tIHRoZSBMb2NhbFN0b3JlLlxuICpcbiAqIENhbGxlZCBpbnRlcm5hbGx5IHRvIGJvb3RzdHJhcCBvciByZWZpbGwgdGhlIHdyaXRlIHBpcGVsaW5lIGFuZCBieVxuICogU3luY0VuZ2luZSB3aGVuZXZlciB0aGVyZSBhcmUgbmV3IG11dGF0aW9ucyB0byBwcm9jZXNzLlxuICpcbiAqIFN0YXJ0cyB0aGUgd3JpdGUgc3RyZWFtIGlmIG5lY2Vzc2FyeS5cbiAqLyAodCwgZSk7XG4gICAgfSBjYXRjaCAobikge1xuICAgICAgICBPKFwiUmVtb3RlU3RvcmVcIiwgXCJGYWlsZWQgdG8gcmVtb3ZlIHRhcmdldHMgJXM6ICVzIFwiLCBlLnRhcmdldElkcy5qb2luKFwiLFwiKSwgbiksIFxuICAgICAgICBhd2FpdCBkdSh0LCBuKTtcbiAgICB9IGVsc2UgaWYgKGUgaW5zdGFuY2VvZiBucyA/IHQucHUudXQoZSkgOiBlIGluc3RhbmNlb2Ygc3MgPyB0LnB1Ll90KGUpIDogdC5wdS5odChlKSwgXG4gICAgIW4uaXNFcXVhbChjdC5taW4oKSkpIHRyeSB7XG4gICAgICAgIGNvbnN0IGUgPSBhd2FpdCBybyh0LmxvY2FsU3RvcmUpO1xuICAgICAgICBuLmNvbXBhcmVUbyhlKSA+PSAwICYmIFxuICAgICAgICAvLyBXZSBoYXZlIHJlY2VpdmVkIGEgdGFyZ2V0IGNoYW5nZSB3aXRoIGEgZ2xvYmFsIHNuYXBzaG90IGlmIHRoZSBzbmFwc2hvdFxuICAgICAgICAvLyB2ZXJzaW9uIGlzIG5vdCBlcXVhbCB0byBTbmFwc2hvdFZlcnNpb24ubWluKCkuXG4gICAgICAgIGF3YWl0IFxuICAgICAgICAvKipcbiAqIFRha2VzIGEgYmF0Y2ggb2YgY2hhbmdlcyBmcm9tIHRoZSBEYXRhc3RvcmUsIHJlcGFja2FnZXMgdGhlbSBhcyBhXG4gKiBSZW1vdGVFdmVudCwgYW5kIHBhc3NlcyB0aGF0IG9uIHRvIHRoZSBsaXN0ZW5lciwgd2hpY2ggaXMgdHlwaWNhbGx5IHRoZVxuICogU3luY0VuZ2luZS5cbiAqL1xuICAgICAgICBmdW5jdGlvbih0LCBlKSB7XG4gICAgICAgICAgICBjb25zdCBuID0gdC5wdS55dChlKTtcbiAgICAgICAgICAgIC8vIFVwZGF0ZSBpbi1tZW1vcnkgcmVzdW1lIHRva2Vucy4gTG9jYWxTdG9yZSB3aWxsIHVwZGF0ZSB0aGVcbiAgICAgICAgICAgIC8vIHBlcnNpc3RlbnQgdmlldyBvZiB0aGVzZSB3aGVuIGFwcGx5aW5nIHRoZSBjb21wbGV0ZWQgUmVtb3RlRXZlbnQuXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbi50YXJnZXRDaGFuZ2VzLmZvckVhY2goKChuLCBzKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKG4ucmVzdW1lVG9rZW4uYXBwcm94aW1hdGVCeXRlU2l6ZSgpID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBpID0gdC5fdS5nZXQocyk7XG4gICAgICAgICAgICAgICAgICAgIC8vIEEgd2F0Y2hlZCB0YXJnZXQgbWlnaHQgaGF2ZSBiZWVuIHJlbW92ZWQgYWxyZWFkeS5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpICYmIHQuX3Uuc2V0KHMsIGkud2l0aFJlc3VtZVRva2VuKG4ucmVzdW1lVG9rZW4sIGUpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KSksIFxuICAgICAgICAgICAgLy8gUmUtZXN0YWJsaXNoIGxpc3RlbnMgZm9yIHRoZSB0YXJnZXRzIHRoYXQgaGF2ZSBiZWVuIGludmFsaWRhdGVkIGJ5XG4gICAgICAgICAgICAvLyBleGlzdGVuY2UgZmlsdGVyIG1pc21hdGNoZXMuXG4gICAgICAgICAgICBuLnRhcmdldE1pc21hdGNoZXMuZm9yRWFjaCgoZSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgbiA9IHQuX3UuZ2V0KGUpO1xuICAgICAgICAgICAgICAgIGlmICghbikgXG4gICAgICAgICAgICAgICAgLy8gQSB3YXRjaGVkIHRhcmdldCBtaWdodCBoYXZlIGJlZW4gcmVtb3ZlZCBhbHJlYWR5LlxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAvLyBDbGVhciB0aGUgcmVzdW1lIHRva2VuIGZvciB0aGUgdGFyZ2V0LCBzaW5jZSB3ZSdyZSBpbiBhIGtub3duIG1pc21hdGNoXG4gICAgICAgICAgICAgICAgLy8gc3RhdGUuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQuX3Uuc2V0KGUsIG4ud2l0aFJlc3VtZVRva2VuKHB0LkVNUFRZX0JZVEVfU1RSSU5HLCBuLnNuYXBzaG90VmVyc2lvbikpLCBcbiAgICAgICAgICAgICAgICAvLyBDYXVzZSBhIGhhcmQgcmVzZXQgYnkgdW53YXRjaGluZyBhbmQgcmV3YXRjaGluZyBpbW1lZGlhdGVseSwgYnV0XG4gICAgICAgICAgICAgICAgLy8gZGVsaWJlcmF0ZWx5IGRvbid0IHNlbmQgYSByZXN1bWUgdG9rZW4gc28gdGhhdCB3ZSBnZXQgYSBmdWxsIHVwZGF0ZS5cbiAgICAgICAgICAgICAgICBydSh0LCBlKTtcbiAgICAgICAgICAgICAgICAvLyBNYXJrIHRoZSB0YXJnZXQgd2Ugc2VuZCBhcyBiZWluZyBvbiBiZWhhbGYgb2YgYW4gZXhpc3RlbmNlIGZpbHRlclxuICAgICAgICAgICAgICAgIC8vIG1pc21hdGNoLCBidXQgZG9uJ3QgYWN0dWFsbHkgcmV0YWluIHRoYXQgaW4gbGlzdGVuVGFyZ2V0cy4gVGhpcyBlbnN1cmVzXG4gICAgICAgICAgICAgICAgLy8gdGhhdCB3ZSBmbGFnIHRoZSBmaXJzdCByZS1saXN0ZW4gdGhpcyB3YXkgd2l0aG91dCBpbXBhY3RpbmcgZnV0dXJlXG4gICAgICAgICAgICAgICAgLy8gbGlzdGVucyBvZiB0aGlzIHRhcmdldCAodGhhdCBtaWdodCBoYXBwZW4gZS5nLiBvbiByZWNvbm5lY3QpLlxuICAgICAgICAgICAgICAgIGNvbnN0IHMgPSBuZXcgTmkobi50YXJnZXQsIGUsIDEgLyogRXhpc3RlbmNlRmlsdGVyTWlzbWF0Y2ggKi8gLCBuLnNlcXVlbmNlTnVtYmVyKTtcbiAgICAgICAgICAgICAgICBpdSh0LCBzKTtcbiAgICAgICAgICAgIH0pKSwgdC5yZW1vdGVTeW5jZXIuYXBwbHlSZW1vdGVFdmVudChuKTtcbiAgICAgICAgfSh0LCBuKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIE8oXCJSZW1vdGVTdG9yZVwiLCBcIkZhaWxlZCB0byByYWlzZSBzbmFwc2hvdDpcIiwgZSksIGF3YWl0IGR1KHQsIGUpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBSZWNvdmVyeSBsb2dpYyBmb3IgSW5kZXhlZERCIGVycm9ycyB0aGF0IHRha2VzIHRoZSBuZXR3b3JrIG9mZmxpbmUgdW50aWxcbiAqIGBvcGAgc3VjY2VlZHMuIFJldHJpZXMgYXJlIHNjaGVkdWxlZCB3aXRoIGJhY2tvZmYgdXNpbmdcbiAqIGBlbnF1ZXVlUmV0cnlhYmxlKClgLiBJZiBgb3AoKWAgaXMgbm90IHByb3ZpZGVkLCBJbmRleGVkREIgYWNjZXNzIGlzXG4gKiB2YWxpZGF0ZWQgdmlhIGEgZ2VuZXJpYyBvcGVyYXRpb24uXG4gKlxuICogVGhlIHJldHVybmVkIFByb21pc2UgaXMgcmVzb2x2ZWQgb25jZSB0aGUgbmV0d29yayBpcyBkaXNhYmxlZCBhbmQgYmVmb3JlXG4gKiBhbnkgcmV0cnkgYXR0ZW1wdC5cbiAqLyBhc3luYyBmdW5jdGlvbiBkdSh0LCBlLCBuKSB7XG4gICAgaWYgKCFBaShlKSkgdGhyb3cgZTtcbiAgICB0Lnd1LmFkZCgxIC8qIEluZGV4ZWREYkZhaWxlZCAqLyksIFxuICAgIC8vIERpc2FibGUgbmV0d29yayBhbmQgcmFpc2Ugb2ZmbGluZSBzbmFwc2hvdHNcbiAgICBhd2FpdCBldSh0KSwgdC55dS5zZXQoXCJPZmZsaW5lXCIgLyogT2ZmbGluZSAqLyksIG4gfHwgKFxuICAgIC8vIFVzZSBhIHNpbXBsZSByZWFkIG9wZXJhdGlvbiB0byBkZXRlcm1pbmUgaWYgSW5kZXhlZERCIHJlY292ZXJlZC5cbiAgICAvLyBJZGVhbGx5LCB3ZSB3b3VsZCBleHBvc2UgYSBoZWFsdGggY2hlY2sgZGlyZWN0bHkgb24gU2ltcGxlRGIsIGJ1dFxuICAgIC8vIFJlbW90ZVN0b3JlIG9ubHkgaGFzIGFjY2VzcyB0byBwZXJzaXN0ZW5jZSB0aHJvdWdoIExvY2FsU3RvcmUuXG4gICAgbiA9ICgpID0+IHJvKHQubG9jYWxTdG9yZSkpLCBcbiAgICAvLyBQcm9iZSBJbmRleGVkREIgcGVyaW9kaWNhbGx5IGFuZCByZS1lbmFibGUgbmV0d29ya1xuICAgIHQuYXN5bmNRdWV1ZS5lbnF1ZXVlUmV0cnlhYmxlKChhc3luYyAoKSA9PiB7XG4gICAgICAgIE8oXCJSZW1vdGVTdG9yZVwiLCBcIlJldHJ5aW5nIEluZGV4ZWREQiBhY2Nlc3NcIiksIGF3YWl0IG4oKSwgdC53dS5kZWxldGUoMSAvKiBJbmRleGVkRGJGYWlsZWQgKi8pLCBcbiAgICAgICAgYXdhaXQgdHUodCk7XG4gICAgfSkpO1xufVxuXG4vKipcbiAqIEV4ZWN1dGVzIGBvcGAuIElmIGBvcGAgZmFpbHMsIHRha2VzIHRoZSBuZXR3b3JrIG9mZmxpbmUgdW50aWwgYG9wYFxuICogc3VjY2VlZHMuIFJldHVybnMgYWZ0ZXIgdGhlIGZpcnN0IGF0dGVtcHQuXG4gKi8gZnVuY3Rpb24gX3UodCwgZSkge1xuICAgIHJldHVybiBlKCkuY2F0Y2goKG4gPT4gZHUodCwgbiwgZSkpKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gd3UodCkge1xuICAgIGNvbnN0IGUgPSBLKHQpLCBuID0gVnUoZSk7XG4gICAgbGV0IHMgPSBlLmR1Lmxlbmd0aCA+IDAgPyBlLmR1W2UuZHUubGVuZ3RoIC0gMV0uYmF0Y2hJZCA6IC0xO1xuICAgIGZvciAoO211KGUpOyApIHRyeSB7XG4gICAgICAgIGNvbnN0IHQgPSBhd2FpdCBhbyhlLmxvY2FsU3RvcmUsIHMpO1xuICAgICAgICBpZiAobnVsbCA9PT0gdCkge1xuICAgICAgICAgICAgMCA9PT0gZS5kdS5sZW5ndGggJiYgbi4kbygpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgcyA9IHQuYmF0Y2hJZCwgZ3UoZSwgdCk7XG4gICAgfSBjYXRjaCAodCkge1xuICAgICAgICBhd2FpdCBkdShlLCB0KTtcbiAgICB9XG4gICAgeXUoZSkgJiYgcHUoZSk7XG59XG5cbi8qKlxuICogUmV0dXJucyB0cnVlIGlmIHdlIGNhbiBhZGQgdG8gdGhlIHdyaXRlIHBpcGVsaW5lIChpLmUuIHRoZSBuZXR3b3JrIGlzXG4gKiBlbmFibGVkIGFuZCB0aGUgd3JpdGUgcGlwZWxpbmUgaXMgbm90IGZ1bGwpLlxuICovIGZ1bmN0aW9uIG11KHQpIHtcbiAgICByZXR1cm4gYXUodCkgJiYgdC5kdS5sZW5ndGggPCAxMDtcbn1cblxuLyoqXG4gKiBRdWV1ZXMgYWRkaXRpb25hbCB3cml0ZXMgdG8gYmUgc2VudCB0byB0aGUgd3JpdGUgc3RyZWFtLCBzZW5kaW5nIHRoZW1cbiAqIGltbWVkaWF0ZWx5IGlmIHRoZSB3cml0ZSBzdHJlYW0gaXMgZXN0YWJsaXNoZWQuXG4gKi8gZnVuY3Rpb24gZ3UodCwgZSkge1xuICAgIHQuZHUucHVzaChlKTtcbiAgICBjb25zdCBuID0gVnUodCk7XG4gICAgbi5NbygpICYmIG4uWG8gJiYgbi5abyhlLm11dGF0aW9ucyk7XG59XG5cbmZ1bmN0aW9uIHl1KHQpIHtcbiAgICByZXR1cm4gYXUodCkgJiYgIVZ1KHQpLmtvKCkgJiYgdC5kdS5sZW5ndGggPiAwO1xufVxuXG5mdW5jdGlvbiBwdSh0KSB7XG4gICAgVnUodCkuc3RhcnQoKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gSXUodCkge1xuICAgIFZ1KHQpLm51KCk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIFR1KHQpIHtcbiAgICBjb25zdCBlID0gVnUodCk7XG4gICAgLy8gU2VuZCB0aGUgd3JpdGUgcGlwZWxpbmUgbm93IHRoYXQgdGhlIHN0cmVhbSBpcyBlc3RhYmxpc2hlZC5cbiAgICAgICAgZm9yIChjb25zdCBuIG9mIHQuZHUpIGUuWm8obi5tdXRhdGlvbnMpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBFdSh0LCBlLCBuKSB7XG4gICAgY29uc3QgcyA9IHQuZHUuc2hpZnQoKSwgaSA9IENpLmZyb20ocywgZSwgbik7XG4gICAgYXdhaXQgX3UodCwgKCgpID0+IHQucmVtb3RlU3luY2VyLmFwcGx5U3VjY2Vzc2Z1bFdyaXRlKGkpKSksIFxuICAgIC8vIEl0J3MgcG9zc2libGUgdGhhdCB3aXRoIHRoZSBjb21wbGV0aW9uIG9mIHRoaXMgbXV0YXRpb24gYW5vdGhlclxuICAgIC8vIHNsb3QgaGFzIGZyZWVkIHVwLlxuICAgIGF3YWl0IHd1KHQpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBBdSh0LCBlKSB7XG4gICAgLy8gSWYgdGhlIHdyaXRlIHN0cmVhbSBjbG9zZWQgYWZ0ZXIgdGhlIHdyaXRlIGhhbmRzaGFrZSBjb21wbGV0ZXMsIGEgd3JpdGVcbiAgICAvLyBvcGVyYXRpb24gZmFpbGVkIGFuZCB3ZSBmYWlsIHRoZSBwZW5kaW5nIG9wZXJhdGlvbi5cbiAgICBlICYmIFZ1KHQpLlhvICYmIFxuICAgIC8vIFRoaXMgZXJyb3IgYWZmZWN0cyB0aGUgYWN0dWFsIHdyaXRlLlxuICAgIGF3YWl0IGFzeW5jIGZ1bmN0aW9uKHQsIGUpIHtcbiAgICAgICAgLy8gT25seSBoYW5kbGUgcGVybWFuZW50IGVycm9ycyBoZXJlLiBJZiBpdCdzIHRyYW5zaWVudCwganVzdCBsZXQgdGhlIHJldHJ5XG4gICAgICAgIC8vIGxvZ2ljIGtpY2sgaW4uXG4gICAgICAgIGlmIChuID0gZS5jb2RlLCBVbihuKSAmJiBuICE9PSBHLkFCT1JURUQpIHtcbiAgICAgICAgICAgIC8vIFRoaXMgd2FzIGEgcGVybWFuZW50IGVycm9yLCB0aGUgcmVxdWVzdCBpdHNlbGYgd2FzIHRoZSBwcm9ibGVtXG4gICAgICAgICAgICAvLyBzbyBpdCdzIG5vdCBnb2luZyB0byBzdWNjZWVkIGlmIHdlIHJlc2VuZCBpdC5cbiAgICAgICAgICAgIGNvbnN0IG4gPSB0LmR1LnNoaWZ0KCk7XG4gICAgICAgICAgICAvLyBJbiB0aGlzIGNhc2UgaXQncyBhbHNvIHVubGlrZWx5IHRoYXQgdGhlIHNlcnZlciBpdHNlbGYgaXMgbWVsdGluZ1xuICAgICAgICAgICAgLy8gZG93biAtLSB0aGlzIHdhcyBqdXN0IGEgYmFkIHJlcXVlc3Qgc28gaW5oaWJpdCBiYWNrb2ZmIG9uIHRoZSBuZXh0XG4gICAgICAgICAgICAvLyByZXN0YXJ0LlxuICAgICAgICAgICAgICAgICAgICAgICAgVnUodCkuRm8oKSwgYXdhaXQgX3UodCwgKCgpID0+IHQucmVtb3RlU3luY2VyLnJlamVjdEZhaWxlZFdyaXRlKG4uYmF0Y2hJZCwgZSkpKSwgXG4gICAgICAgICAgICAvLyBJdCdzIHBvc3NpYmxlIHRoYXQgd2l0aCB0aGUgY29tcGxldGlvbiBvZiB0aGlzIG11dGF0aW9uXG4gICAgICAgICAgICAvLyBhbm90aGVyIHNsb3QgaGFzIGZyZWVkIHVwLlxuICAgICAgICAgICAgYXdhaXQgd3UodCk7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIG47XG4gICAgfSh0LCBlKSwgXG4gICAgLy8gVGhlIHdyaXRlIHN0cmVhbSBtaWdodCBoYXZlIGJlZW4gc3RhcnRlZCBieSByZWZpbGxpbmcgdGhlIHdyaXRlXG4gICAgLy8gcGlwZWxpbmUgZm9yIGZhaWxlZCB3cml0ZXNcbiAgICB5dSh0KSAmJiBwdSh0KTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gUnUodCwgZSkge1xuICAgIGNvbnN0IG4gPSBLKHQpO1xuICAgIG4uYXN5bmNRdWV1ZS52ZXJpZnlPcGVyYXRpb25JblByb2dyZXNzKCksIE8oXCJSZW1vdGVTdG9yZVwiLCBcIlJlbW90ZVN0b3JlIHJlY2VpdmVkIG5ldyBjcmVkZW50aWFsc1wiKTtcbiAgICBjb25zdCBzID0gYXUobik7XG4gICAgLy8gVGVhciBkb3duIGFuZCByZS1jcmVhdGUgb3VyIG5ldHdvcmsgc3RyZWFtcy4gVGhpcyB3aWxsIGVuc3VyZSB3ZSBnZXQgYVxuICAgIC8vIGZyZXNoIGF1dGggdG9rZW4gZm9yIHRoZSBuZXcgdXNlciBhbmQgcmUtZmlsbCB0aGUgd3JpdGUgcGlwZWxpbmUgd2l0aFxuICAgIC8vIG5ldyBtdXRhdGlvbnMgZnJvbSB0aGUgTG9jYWxTdG9yZSAoc2luY2UgbXV0YXRpb25zIGFyZSBwZXItdXNlcikuXG4gICAgICAgIG4ud3UuYWRkKDMgLyogQ3JlZGVudGlhbENoYW5nZSAqLyksIGF3YWl0IGV1KG4pLCBzICYmIFxuICAgIC8vIERvbid0IHNldCB0aGUgbmV0d29yayBzdGF0dXMgdG8gVW5rbm93biBpZiB3ZSBhcmUgb2ZmbGluZS5cbiAgICBuLnl1LnNldChcIlVua25vd25cIiAvKiBVbmtub3duICovKSwgYXdhaXQgbi5yZW1vdGVTeW5jZXIuaGFuZGxlQ3JlZGVudGlhbENoYW5nZShlKSwgXG4gICAgbi53dS5kZWxldGUoMyAvKiBDcmVkZW50aWFsQ2hhbmdlICovKSwgYXdhaXQgdHUobik7XG59XG5cbi8qKlxuICogVG9nZ2xlcyB0aGUgbmV0d29yayBzdGF0ZSB3aGVuIHRoZSBjbGllbnQgZ2FpbnMgb3IgbG9zZXMgaXRzIHByaW1hcnkgbGVhc2UuXG4gKi8gYXN5bmMgZnVuY3Rpb24gYnUodCwgZSkge1xuICAgIGNvbnN0IG4gPSBLKHQpO1xuICAgIGUgPyAobi53dS5kZWxldGUoMiAvKiBJc1NlY29uZGFyeSAqLyksIGF3YWl0IHR1KG4pKSA6IGUgfHwgKG4ud3UuYWRkKDIgLyogSXNTZWNvbmRhcnkgKi8pLCBcbiAgICBhd2FpdCBldShuKSwgbi55dS5zZXQoXCJVbmtub3duXCIgLyogVW5rbm93biAqLykpO1xufVxuXG4vKipcbiAqIElmIG5vdCB5ZXQgaW5pdGlhbGl6ZWQsIHJlZ2lzdGVycyB0aGUgV2F0Y2hTdHJlYW0gYW5kIGl0cyBuZXR3b3JrIHN0YXRlXG4gKiBjYWxsYmFjayB3aXRoIGByZW1vdGVTdG9yZUltcGxgLiBSZXR1cm5zIHRoZSBleGlzdGluZyBzdHJlYW0gaWYgb25lIGlzXG4gKiBhbHJlYWR5IGF2YWlsYWJsZS5cbiAqXG4gKiBQT1JUSU5HIE5PVEU6IE9uIGlPUyBhbmQgQW5kcm9pZCwgdGhlIFdhdGNoU3RyZWFtIGdldHMgcmVnaXN0ZXJlZCBvbiBzdGFydHVwLlxuICogVGhpcyBpcyBub3QgZG9uZSBvbiBXZWIgdG8gYWxsb3cgaXQgdG8gYmUgdHJlZS1zaGFrZW4uXG4gKi8gZnVuY3Rpb24gUHUodCkge1xuICAgIHJldHVybiB0Lkl1IHx8IChcbiAgICAvLyBDcmVhdGUgc3RyZWFtIChidXQgbm90ZSB0aGF0IGl0IGlzIG5vdCBzdGFydGVkIHlldCkuXG4gICAgdC5JdSA9IGZ1bmN0aW9uKHQsIGUsIG4pIHtcbiAgICAgICAgY29uc3QgcyA9IEsodCk7XG4gICAgICAgIHJldHVybiBzLml1KCksIG5ldyBIbyhlLCBzLlNvLCBzLmF1dGhDcmVkZW50aWFscywgcy5hcHBDaGVja0NyZWRlbnRpYWxzLCBzLk0sIG4pO1xuICAgIH1cbiAgICAvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqLyAodC5kYXRhc3RvcmUsIHQuYXN5bmNRdWV1ZSwge1xuICAgICAgICBYcjogaHUuYmluZChudWxsLCB0KSxcbiAgICAgICAgZW86IGx1LmJpbmQobnVsbCwgdCksXG4gICAgICAgIHpvOiBmdS5iaW5kKG51bGwsIHQpXG4gICAgfSksIHQubXUucHVzaCgoYXN5bmMgZSA9PiB7XG4gICAgICAgIGUgPyAodC5JdS5GbygpLCB1dSh0KSA/IG91KHQpIDogdC55dS5zZXQoXCJVbmtub3duXCIgLyogVW5rbm93biAqLykpIDogKGF3YWl0IHQuSXUuc3RvcCgpLCBcbiAgICAgICAgY3UodCkpO1xuICAgIH0pKSksIHQuSXU7XG59XG5cbi8qKlxuICogSWYgbm90IHlldCBpbml0aWFsaXplZCwgcmVnaXN0ZXJzIHRoZSBXcml0ZVN0cmVhbSBhbmQgaXRzIG5ldHdvcmsgc3RhdGVcbiAqIGNhbGxiYWNrIHdpdGggYHJlbW90ZVN0b3JlSW1wbGAuIFJldHVybnMgdGhlIGV4aXN0aW5nIHN0cmVhbSBpZiBvbmUgaXNcbiAqIGFscmVhZHkgYXZhaWxhYmxlLlxuICpcbiAqIFBPUlRJTkcgTk9URTogT24gaU9TIGFuZCBBbmRyb2lkLCB0aGUgV3JpdGVTdHJlYW0gZ2V0cyByZWdpc3RlcmVkIG9uIHN0YXJ0dXAuXG4gKiBUaGlzIGlzIG5vdCBkb25lIG9uIFdlYiB0byBhbGxvdyBpdCB0byBiZSB0cmVlLXNoYWtlbi5cbiAqLyBmdW5jdGlvbiBWdSh0KSB7XG4gICAgcmV0dXJuIHQuVHUgfHwgKFxuICAgIC8vIENyZWF0ZSBzdHJlYW0gKGJ1dCBub3RlIHRoYXQgaXQgaXMgbm90IHN0YXJ0ZWQgeWV0KS5cbiAgICB0LlR1ID0gZnVuY3Rpb24odCwgZSwgbikge1xuICAgICAgICBjb25zdCBzID0gSyh0KTtcbiAgICAgICAgcmV0dXJuIHMuaXUoKSwgbmV3IEpvKGUsIHMuU28sIHMuYXV0aENyZWRlbnRpYWxzLCBzLmFwcENoZWNrQ3JlZGVudGlhbHMsIHMuTSwgbik7XG4gICAgfSh0LmRhdGFzdG9yZSwgdC5hc3luY1F1ZXVlLCB7XG4gICAgICAgIFhyOiBJdS5iaW5kKG51bGwsIHQpLFxuICAgICAgICBlbzogQXUuYmluZChudWxsLCB0KSxcbiAgICAgICAgZXU6IFR1LmJpbmQobnVsbCwgdCksXG4gICAgICAgIHR1OiBFdS5iaW5kKG51bGwsIHQpXG4gICAgfSksIHQubXUucHVzaCgoYXN5bmMgZSA9PiB7XG4gICAgICAgIGUgPyAodC5UdS5GbygpLCBcbiAgICAgICAgLy8gVGhpcyB3aWxsIHN0YXJ0IHRoZSB3cml0ZSBzdHJlYW0gaWYgbmVjZXNzYXJ5LlxuICAgICAgICBhd2FpdCB3dSh0KSkgOiAoYXdhaXQgdC5UdS5zdG9wKCksIHQuZHUubGVuZ3RoID4gMCAmJiAoTyhcIlJlbW90ZVN0b3JlXCIsIGBTdG9wcGluZyB3cml0ZSBzdHJlYW0gd2l0aCAke3QuZHUubGVuZ3RofSBwZW5kaW5nIHdyaXRlc2ApLCBcbiAgICAgICAgdC5kdSA9IFtdKSk7XG4gICAgfSkpKSwgdC5UdTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogUmVwcmVzZW50cyBhbiBvcGVyYXRpb24gc2NoZWR1bGVkIHRvIGJlIHJ1biBpbiB0aGUgZnV0dXJlIG9uIGFuIEFzeW5jUXVldWUuXG4gKlxuICogSXQgaXMgY3JlYXRlZCB2aWEgRGVsYXllZE9wZXJhdGlvbi5jcmVhdGVBbmRTY2hlZHVsZSgpLlxuICpcbiAqIFN1cHBvcnRzIGNhbmNlbGxhdGlvbiAodmlhIGNhbmNlbCgpKSBhbmQgZWFybHkgZXhlY3V0aW9uICh2aWEgc2tpcERlbGF5KCkpLlxuICpcbiAqIE5vdGU6IFdlIGltcGxlbWVudCBgUHJvbWlzZUxpa2VgIGluc3RlYWQgb2YgYFByb21pc2VgLCBhcyB0aGUgYFByb21pc2VgIHR5cGVcbiAqIGluIG5ld2VyIHZlcnNpb25zIG9mIFR5cGVTY3JpcHQgZGVmaW5lcyBgZmluYWxseWAsIHdoaWNoIGlzIG5vdCBhdmFpbGFibGUgaW5cbiAqIElFLlxuICovXG5jbGFzcyB2dSB7XG4gICAgY29uc3RydWN0b3IodCwgZSwgbiwgcywgaSkge1xuICAgICAgICB0aGlzLmFzeW5jUXVldWUgPSB0LCB0aGlzLnRpbWVySWQgPSBlLCB0aGlzLnRhcmdldFRpbWVNcyA9IG4sIHRoaXMub3AgPSBzLCB0aGlzLnJlbW92YWxDYWxsYmFjayA9IGksIFxuICAgICAgICB0aGlzLmRlZmVycmVkID0gbmV3IGosIHRoaXMudGhlbiA9IHRoaXMuZGVmZXJyZWQucHJvbWlzZS50aGVuLmJpbmQodGhpcy5kZWZlcnJlZC5wcm9taXNlKSwgXG4gICAgICAgIC8vIEl0J3Mgbm9ybWFsIGZvciB0aGUgZGVmZXJyZWQgcHJvbWlzZSB0byBiZSBjYW5jZWxlZCAoZHVlIHRvIGNhbmNlbGxhdGlvbilcbiAgICAgICAgLy8gYW5kIHNvIHdlIGF0dGFjaCBhIGR1bW15IGNhdGNoIGNhbGxiYWNrIHRvIGF2b2lkXG4gICAgICAgIC8vICdVbmhhbmRsZWRQcm9taXNlUmVqZWN0aW9uV2FybmluZycgbG9nIHNwYW0uXG4gICAgICAgIHRoaXMuZGVmZXJyZWQucHJvbWlzZS5jYXRjaCgodCA9PiB7fSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGFuZCByZXR1cm5zIGEgRGVsYXllZE9wZXJhdGlvbiB0aGF0IGhhcyBiZWVuIHNjaGVkdWxlZCB0byBiZVxuICAgICAqIGV4ZWN1dGVkIG9uIHRoZSBwcm92aWRlZCBhc3luY1F1ZXVlIGFmdGVyIHRoZSBwcm92aWRlZCBkZWxheU1zLlxuICAgICAqXG4gICAgICogQHBhcmFtIGFzeW5jUXVldWUgLSBUaGUgcXVldWUgdG8gc2NoZWR1bGUgdGhlIG9wZXJhdGlvbiBvbi5cbiAgICAgKiBAcGFyYW0gaWQgLSBBIFRpbWVyIElEIGlkZW50aWZ5aW5nIHRoZSB0eXBlIG9mIG9wZXJhdGlvbiB0aGlzIGlzLlxuICAgICAqIEBwYXJhbSBkZWxheU1zIC0gVGhlIGRlbGF5IChtcykgYmVmb3JlIHRoZSBvcGVyYXRpb24gc2hvdWxkIGJlIHNjaGVkdWxlZC5cbiAgICAgKiBAcGFyYW0gb3AgLSBUaGUgb3BlcmF0aW9uIHRvIHJ1bi5cbiAgICAgKiBAcGFyYW0gcmVtb3ZhbENhbGxiYWNrIC0gQSBjYWxsYmFjayB0byBiZSBjYWxsZWQgc3luY2hyb25vdXNseSBvbmNlIHRoZVxuICAgICAqICAgb3BlcmF0aW9uIGlzIGV4ZWN1dGVkIG9yIGNhbmNlbGVkLCBub3RpZnlpbmcgdGhlIEFzeW5jUXVldWUgdG8gcmVtb3ZlIGl0XG4gICAgICogICBmcm9tIGl0cyBkZWxheWVkT3BlcmF0aW9ucyBsaXN0LlxuICAgICAqICAgUE9SVElORyBOT1RFOiBUaGlzIGV4aXN0cyB0byBwcmV2ZW50IG1ha2luZyByZW1vdmVEZWxheWVkT3BlcmF0aW9uKCkgYW5kXG4gICAgICogICB0aGUgRGVsYXllZE9wZXJhdGlvbiBjbGFzcyBwdWJsaWMuXG4gICAgICovICAgIHN0YXRpYyBjcmVhdGVBbmRTY2hlZHVsZSh0LCBlLCBuLCBzLCBpKSB7XG4gICAgICAgIGNvbnN0IHIgPSBEYXRlLm5vdygpICsgbiwgbyA9IG5ldyB2dSh0LCBlLCByLCBzLCBpKTtcbiAgICAgICAgcmV0dXJuIG8uc3RhcnQobiksIG87XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFN0YXJ0cyB0aGUgdGltZXIuIFRoaXMgaXMgY2FsbGVkIGltbWVkaWF0ZWx5IGFmdGVyIGNvbnN0cnVjdGlvbiBieVxuICAgICAqIGNyZWF0ZUFuZFNjaGVkdWxlKCkuXG4gICAgICovICAgIHN0YXJ0KHQpIHtcbiAgICAgICAgdGhpcy50aW1lckhhbmRsZSA9IHNldFRpbWVvdXQoKCgpID0+IHRoaXMuaGFuZGxlRGVsYXlFbGFwc2VkKCkpLCB0KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUXVldWVzIHRoZSBvcGVyYXRpb24gdG8gcnVuIGltbWVkaWF0ZWx5IChpZiBpdCBoYXNuJ3QgYWxyZWFkeSBiZWVuIHJ1biBvclxuICAgICAqIGNhbmNlbGVkKS5cbiAgICAgKi8gICAgc2tpcERlbGF5KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5oYW5kbGVEZWxheUVsYXBzZWQoKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ2FuY2VscyB0aGUgb3BlcmF0aW9uIGlmIGl0IGhhc24ndCBhbHJlYWR5IGJlZW4gZXhlY3V0ZWQgb3IgY2FuY2VsZWQuIFRoZVxuICAgICAqIHByb21pc2Ugd2lsbCBiZSByZWplY3RlZC5cbiAgICAgKlxuICAgICAqIEFzIGxvbmcgYXMgdGhlIG9wZXJhdGlvbiBoYXMgbm90IHlldCBiZWVuIHJ1biwgY2FsbGluZyBjYW5jZWwoKSBwcm92aWRlcyBhXG4gICAgICogZ3VhcmFudGVlIHRoYXQgdGhlIG9wZXJhdGlvbiB3aWxsIG5vdCBiZSBydW4uXG4gICAgICovICAgIGNhbmNlbCh0KSB7XG4gICAgICAgIG51bGwgIT09IHRoaXMudGltZXJIYW5kbGUgJiYgKHRoaXMuY2xlYXJUaW1lb3V0KCksIHRoaXMuZGVmZXJyZWQucmVqZWN0KG5ldyBRKEcuQ0FOQ0VMTEVELCBcIk9wZXJhdGlvbiBjYW5jZWxsZWRcIiArICh0ID8gXCI6IFwiICsgdCA6IFwiXCIpKSkpO1xuICAgIH1cbiAgICBoYW5kbGVEZWxheUVsYXBzZWQoKSB7XG4gICAgICAgIHRoaXMuYXN5bmNRdWV1ZS5lbnF1ZXVlQW5kRm9yZ2V0KCgoKSA9PiBudWxsICE9PSB0aGlzLnRpbWVySGFuZGxlID8gKHRoaXMuY2xlYXJUaW1lb3V0KCksIFxuICAgICAgICB0aGlzLm9wKCkudGhlbigodCA9PiB0aGlzLmRlZmVycmVkLnJlc29sdmUodCkpKSkgOiBQcm9taXNlLnJlc29sdmUoKSkpO1xuICAgIH1cbiAgICBjbGVhclRpbWVvdXQoKSB7XG4gICAgICAgIG51bGwgIT09IHRoaXMudGltZXJIYW5kbGUgJiYgKHRoaXMucmVtb3ZhbENhbGxiYWNrKHRoaXMpLCBjbGVhclRpbWVvdXQodGhpcy50aW1lckhhbmRsZSksIFxuICAgICAgICB0aGlzLnRpbWVySGFuZGxlID0gbnVsbCk7XG4gICAgfVxufVxuXG4vKipcbiAqIFJldHVybnMgYSBGaXJlc3RvcmVFcnJvciB0aGF0IGNhbiBiZSBzdXJmYWNlZCB0byB0aGUgdXNlciBpZiB0aGUgcHJvdmlkZWRcbiAqIGVycm9yIGlzIGFuIEluZGV4ZWREYlRyYW5zYWN0aW9uRXJyb3IuIFJlLXRocm93cyB0aGUgZXJyb3Igb3RoZXJ3aXNlLlxuICovIGZ1bmN0aW9uIFN1KHQsIGUpIHtcbiAgICBpZiAoRihcIkFzeW5jUXVldWVcIiwgYCR7ZX06ICR7dH1gKSwgQWkodCkpIHJldHVybiBuZXcgUShHLlVOQVZBSUxBQkxFLCBgJHtlfTogJHt0fWApO1xuICAgIHRocm93IHQ7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIERvY3VtZW50U2V0IGlzIGFuIGltbXV0YWJsZSAoY29weS1vbi13cml0ZSkgY29sbGVjdGlvbiB0aGF0IGhvbGRzIGRvY3VtZW50c1xuICogaW4gb3JkZXIgc3BlY2lmaWVkIGJ5IHRoZSBwcm92aWRlZCBjb21wYXJhdG9yLiBXZSBhbHdheXMgYWRkIGEgZG9jdW1lbnQga2V5XG4gKiBjb21wYXJhdG9yIG9uIHRvcCBvZiB3aGF0IGlzIHByb3ZpZGVkIHRvIGd1YXJhbnRlZSBkb2N1bWVudCBlcXVhbGl0eSBiYXNlZCBvblxuICogdGhlIGtleS5cbiAqLyBjbGFzcyBEdSB7XG4gICAgLyoqIFRoZSBkZWZhdWx0IG9yZGVyaW5nIGlzIGJ5IGtleSBpZiB0aGUgY29tcGFyYXRvciBpcyBvbWl0dGVkICovXG4gICAgY29uc3RydWN0b3IodCkge1xuICAgICAgICAvLyBXZSBhcmUgYWRkaW5nIGRvY3VtZW50IGtleSBjb21wYXJhdG9yIHRvIHRoZSBlbmQgYXMgaXQncyB0aGUgb25seVxuICAgICAgICAvLyBndWFyYW50ZWVkIHVuaXF1ZSBwcm9wZXJ0eSBvZiBhIGRvY3VtZW50LlxuICAgICAgICB0aGlzLmNvbXBhcmF0b3IgPSB0ID8gKGUsIG4pID0+IHQoZSwgbikgfHwgeHQuY29tcGFyYXRvcihlLmtleSwgbi5rZXkpIDogKHQsIGUpID0+IHh0LmNvbXBhcmF0b3IodC5rZXksIGUua2V5KSwgXG4gICAgICAgIHRoaXMua2V5ZWRNYXAgPSBXbigpLCB0aGlzLnNvcnRlZFNldCA9IG5ldyBmZSh0aGlzLmNvbXBhcmF0b3IpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIGFuIGVtcHR5IGNvcHkgb2YgdGhlIGV4aXN0aW5nIERvY3VtZW50U2V0LCB1c2luZyB0aGUgc2FtZVxuICAgICAqIGNvbXBhcmF0b3IuXG4gICAgICovICAgIHN0YXRpYyBlbXB0eVNldCh0KSB7XG4gICAgICAgIHJldHVybiBuZXcgRHUodC5jb21wYXJhdG9yKTtcbiAgICB9XG4gICAgaGFzKHQpIHtcbiAgICAgICAgcmV0dXJuIG51bGwgIT0gdGhpcy5rZXllZE1hcC5nZXQodCk7XG4gICAgfVxuICAgIGdldCh0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLmtleWVkTWFwLmdldCh0KTtcbiAgICB9XG4gICAgZmlyc3QoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNvcnRlZFNldC5taW5LZXkoKTtcbiAgICB9XG4gICAgbGFzdCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc29ydGVkU2V0Lm1heEtleSgpO1xuICAgIH1cbiAgICBpc0VtcHR5KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zb3J0ZWRTZXQuaXNFbXB0eSgpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRoZSBpbmRleCBvZiB0aGUgcHJvdmlkZWQga2V5IGluIHRoZSBkb2N1bWVudCBzZXQsIG9yIC0xIGlmIHRoZVxuICAgICAqIGRvY3VtZW50IGtleSBpcyBub3QgcHJlc2VudCBpbiB0aGUgc2V0O1xuICAgICAqLyAgICBpbmRleE9mKHQpIHtcbiAgICAgICAgY29uc3QgZSA9IHRoaXMua2V5ZWRNYXAuZ2V0KHQpO1xuICAgICAgICByZXR1cm4gZSA/IHRoaXMuc29ydGVkU2V0LmluZGV4T2YoZSkgOiAtMTtcbiAgICB9XG4gICAgZ2V0IHNpemUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNvcnRlZFNldC5zaXplO1xuICAgIH1cbiAgICAvKiogSXRlcmF0ZXMgZG9jdW1lbnRzIGluIG9yZGVyIGRlZmluZWQgYnkgXCJjb21wYXJhdG9yXCIgKi8gICAgZm9yRWFjaCh0KSB7XG4gICAgICAgIHRoaXMuc29ydGVkU2V0Lmlub3JkZXJUcmF2ZXJzYWwoKChlLCBuKSA9PiAodChlKSwgITEpKSk7XG4gICAgfVxuICAgIC8qKiBJbnNlcnRzIG9yIHVwZGF0ZXMgYSBkb2N1bWVudCB3aXRoIHRoZSBzYW1lIGtleSAqLyAgICBhZGQodCkge1xuICAgICAgICAvLyBGaXJzdCByZW1vdmUgdGhlIGVsZW1lbnQgaWYgd2UgaGF2ZSBpdC5cbiAgICAgICAgY29uc3QgZSA9IHRoaXMuZGVsZXRlKHQua2V5KTtcbiAgICAgICAgcmV0dXJuIGUuY29weShlLmtleWVkTWFwLmluc2VydCh0LmtleSwgdCksIGUuc29ydGVkU2V0Lmluc2VydCh0LCBudWxsKSk7XG4gICAgfVxuICAgIC8qKiBEZWxldGVzIGEgZG9jdW1lbnQgd2l0aCBhIGdpdmVuIGtleSAqLyAgICBkZWxldGUodCkge1xuICAgICAgICBjb25zdCBlID0gdGhpcy5nZXQodCk7XG4gICAgICAgIHJldHVybiBlID8gdGhpcy5jb3B5KHRoaXMua2V5ZWRNYXAucmVtb3ZlKHQpLCB0aGlzLnNvcnRlZFNldC5yZW1vdmUoZSkpIDogdGhpcztcbiAgICB9XG4gICAgaXNFcXVhbCh0KSB7XG4gICAgICAgIGlmICghKHQgaW5zdGFuY2VvZiBEdSkpIHJldHVybiAhMTtcbiAgICAgICAgaWYgKHRoaXMuc2l6ZSAhPT0gdC5zaXplKSByZXR1cm4gITE7XG4gICAgICAgIGNvbnN0IGUgPSB0aGlzLnNvcnRlZFNldC5nZXRJdGVyYXRvcigpLCBuID0gdC5zb3J0ZWRTZXQuZ2V0SXRlcmF0b3IoKTtcbiAgICAgICAgZm9yICg7ZS5oYXNOZXh0KCk7ICkge1xuICAgICAgICAgICAgY29uc3QgdCA9IGUuZ2V0TmV4dCgpLmtleSwgcyA9IG4uZ2V0TmV4dCgpLmtleTtcbiAgICAgICAgICAgIGlmICghdC5pc0VxdWFsKHMpKSByZXR1cm4gITE7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuICEwO1xuICAgIH1cbiAgICB0b1N0cmluZygpIHtcbiAgICAgICAgY29uc3QgdCA9IFtdO1xuICAgICAgICByZXR1cm4gdGhpcy5mb3JFYWNoKChlID0+IHtcbiAgICAgICAgICAgIHQucHVzaChlLnRvU3RyaW5nKCkpO1xuICAgICAgICB9KSksIDAgPT09IHQubGVuZ3RoID8gXCJEb2N1bWVudFNldCAoKVwiIDogXCJEb2N1bWVudFNldCAoXFxuICBcIiArIHQuam9pbihcIiAgXFxuXCIpICsgXCJcXG4pXCI7XG4gICAgfVxuICAgIGNvcHkodCwgZSkge1xuICAgICAgICBjb25zdCBuID0gbmV3IER1O1xuICAgICAgICByZXR1cm4gbi5jb21wYXJhdG9yID0gdGhpcy5jb21wYXJhdG9yLCBuLmtleWVkTWFwID0gdCwgbi5zb3J0ZWRTZXQgPSBlLCBuO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogRG9jdW1lbnRDaGFuZ2VTZXQga2VlcHMgdHJhY2sgb2YgYSBzZXQgb2YgY2hhbmdlcyB0byBkb2NzIGluIGEgcXVlcnksIG1lcmdpbmdcbiAqIGR1cGxpY2F0ZSBldmVudHMgZm9yIHRoZSBzYW1lIGRvYy5cbiAqLyBjbGFzcyBDdSB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMuRXUgPSBuZXcgZmUoeHQuY29tcGFyYXRvcik7XG4gICAgfVxuICAgIHRyYWNrKHQpIHtcbiAgICAgICAgY29uc3QgZSA9IHQuZG9jLmtleSwgbiA9IHRoaXMuRXUuZ2V0KGUpO1xuICAgICAgICBuID8gXG4gICAgICAgIC8vIE1lcmdlIHRoZSBuZXcgY2hhbmdlIHdpdGggdGhlIGV4aXN0aW5nIGNoYW5nZS5cbiAgICAgICAgMCAvKiBBZGRlZCAqLyAhPT0gdC50eXBlICYmIDMgLyogTWV0YWRhdGEgKi8gPT09IG4udHlwZSA/IHRoaXMuRXUgPSB0aGlzLkV1Lmluc2VydChlLCB0KSA6IDMgLyogTWV0YWRhdGEgKi8gPT09IHQudHlwZSAmJiAxIC8qIFJlbW92ZWQgKi8gIT09IG4udHlwZSA/IHRoaXMuRXUgPSB0aGlzLkV1Lmluc2VydChlLCB7XG4gICAgICAgICAgICB0eXBlOiBuLnR5cGUsXG4gICAgICAgICAgICBkb2M6IHQuZG9jXG4gICAgICAgIH0pIDogMiAvKiBNb2RpZmllZCAqLyA9PT0gdC50eXBlICYmIDIgLyogTW9kaWZpZWQgKi8gPT09IG4udHlwZSA/IHRoaXMuRXUgPSB0aGlzLkV1Lmluc2VydChlLCB7XG4gICAgICAgICAgICB0eXBlOiAyIC8qIE1vZGlmaWVkICovICxcbiAgICAgICAgICAgIGRvYzogdC5kb2NcbiAgICAgICAgfSkgOiAyIC8qIE1vZGlmaWVkICovID09PSB0LnR5cGUgJiYgMCAvKiBBZGRlZCAqLyA9PT0gbi50eXBlID8gdGhpcy5FdSA9IHRoaXMuRXUuaW5zZXJ0KGUsIHtcbiAgICAgICAgICAgIHR5cGU6IDAgLyogQWRkZWQgKi8gLFxuICAgICAgICAgICAgZG9jOiB0LmRvY1xuICAgICAgICB9KSA6IDEgLyogUmVtb3ZlZCAqLyA9PT0gdC50eXBlICYmIDAgLyogQWRkZWQgKi8gPT09IG4udHlwZSA/IHRoaXMuRXUgPSB0aGlzLkV1LnJlbW92ZShlKSA6IDEgLyogUmVtb3ZlZCAqLyA9PT0gdC50eXBlICYmIDIgLyogTW9kaWZpZWQgKi8gPT09IG4udHlwZSA/IHRoaXMuRXUgPSB0aGlzLkV1Lmluc2VydChlLCB7XG4gICAgICAgICAgICB0eXBlOiAxIC8qIFJlbW92ZWQgKi8gLFxuICAgICAgICAgICAgZG9jOiBuLmRvY1xuICAgICAgICB9KSA6IDAgLyogQWRkZWQgKi8gPT09IHQudHlwZSAmJiAxIC8qIFJlbW92ZWQgKi8gPT09IG4udHlwZSA/IHRoaXMuRXUgPSB0aGlzLkV1Lmluc2VydChlLCB7XG4gICAgICAgICAgICB0eXBlOiAyIC8qIE1vZGlmaWVkICovICxcbiAgICAgICAgICAgIGRvYzogdC5kb2NcbiAgICAgICAgfSkgOiBcbiAgICAgICAgLy8gVGhpcyBpbmNsdWRlcyB0aGVzZSBjYXNlcywgd2hpY2ggZG9uJ3QgbWFrZSBzZW5zZTpcbiAgICAgICAgLy8gQWRkZWQtPkFkZGVkXG4gICAgICAgIC8vIFJlbW92ZWQtPlJlbW92ZWRcbiAgICAgICAgLy8gTW9kaWZpZWQtPkFkZGVkXG4gICAgICAgIC8vIFJlbW92ZWQtPk1vZGlmaWVkXG4gICAgICAgIC8vIE1ldGFkYXRhLT5BZGRlZFxuICAgICAgICAvLyBSZW1vdmVkLT5NZXRhZGF0YVxuICAgICAgICBMKCkgOiB0aGlzLkV1ID0gdGhpcy5FdS5pbnNlcnQoZSwgdCk7XG4gICAgfVxuICAgIEF1KCkge1xuICAgICAgICBjb25zdCB0ID0gW107XG4gICAgICAgIHJldHVybiB0aGlzLkV1Lmlub3JkZXJUcmF2ZXJzYWwoKChlLCBuKSA9PiB7XG4gICAgICAgICAgICB0LnB1c2gobik7XG4gICAgICAgIH0pKSwgdDtcbiAgICB9XG59XG5cbmNsYXNzIHh1IHtcbiAgICBjb25zdHJ1Y3Rvcih0LCBlLCBuLCBzLCBpLCByLCBvLCB1KSB7XG4gICAgICAgIHRoaXMucXVlcnkgPSB0LCB0aGlzLmRvY3MgPSBlLCB0aGlzLm9sZERvY3MgPSBuLCB0aGlzLmRvY0NoYW5nZXMgPSBzLCB0aGlzLm11dGF0ZWRLZXlzID0gaSwgXG4gICAgICAgIHRoaXMuZnJvbUNhY2hlID0gciwgdGhpcy5zeW5jU3RhdGVDaGFuZ2VkID0gbywgdGhpcy5leGNsdWRlc01ldGFkYXRhQ2hhbmdlcyA9IHU7XG4gICAgfVxuICAgIC8qKiBSZXR1cm5zIGEgdmlldyBzbmFwc2hvdCBhcyBpZiBhbGwgZG9jdW1lbnRzIGluIHRoZSBzbmFwc2hvdCB3ZXJlIGFkZGVkLiAqLyAgICBzdGF0aWMgZnJvbUluaXRpYWxEb2N1bWVudHModCwgZSwgbiwgcykge1xuICAgICAgICBjb25zdCBpID0gW107XG4gICAgICAgIHJldHVybiBlLmZvckVhY2goKHQgPT4ge1xuICAgICAgICAgICAgaS5wdXNoKHtcbiAgICAgICAgICAgICAgICB0eXBlOiAwIC8qIEFkZGVkICovICxcbiAgICAgICAgICAgICAgICBkb2M6IHRcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KSksIG5ldyB4dSh0LCBlLCBEdS5lbXB0eVNldChlKSwgaSwgbiwgcywgXG4gICAgICAgIC8qIHN5bmNTdGF0ZUNoYW5nZWQ9ICovICEwLCBcbiAgICAgICAgLyogZXhjbHVkZXNNZXRhZGF0YUNoYW5nZXM9ICovICExKTtcbiAgICB9XG4gICAgZ2V0IGhhc1BlbmRpbmdXcml0ZXMoKSB7XG4gICAgICAgIHJldHVybiAhdGhpcy5tdXRhdGVkS2V5cy5pc0VtcHR5KCk7XG4gICAgfVxuICAgIGlzRXF1YWwodCkge1xuICAgICAgICBpZiAoISh0aGlzLmZyb21DYWNoZSA9PT0gdC5mcm9tQ2FjaGUgJiYgdGhpcy5zeW5jU3RhdGVDaGFuZ2VkID09PSB0LnN5bmNTdGF0ZUNoYW5nZWQgJiYgdGhpcy5tdXRhdGVkS2V5cy5pc0VxdWFsKHQubXV0YXRlZEtleXMpICYmIFllKHRoaXMucXVlcnksIHQucXVlcnkpICYmIHRoaXMuZG9jcy5pc0VxdWFsKHQuZG9jcykgJiYgdGhpcy5vbGREb2NzLmlzRXF1YWwodC5vbGREb2NzKSkpIHJldHVybiAhMTtcbiAgICAgICAgY29uc3QgZSA9IHRoaXMuZG9jQ2hhbmdlcywgbiA9IHQuZG9jQ2hhbmdlcztcbiAgICAgICAgaWYgKGUubGVuZ3RoICE9PSBuLmxlbmd0aCkgcmV0dXJuICExO1xuICAgICAgICBmb3IgKGxldCB0ID0gMDsgdCA8IGUubGVuZ3RoOyB0KyspIGlmIChlW3RdLnR5cGUgIT09IG5bdF0udHlwZSB8fCAhZVt0XS5kb2MuaXNFcXVhbChuW3RdLmRvYykpIHJldHVybiAhMTtcbiAgICAgICAgcmV0dXJuICEwO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogSG9sZHMgdGhlIGxpc3RlbmVycyBhbmQgdGhlIGxhc3QgcmVjZWl2ZWQgVmlld1NuYXBzaG90IGZvciBhIHF1ZXJ5IGJlaW5nXG4gKiB0cmFja2VkIGJ5IEV2ZW50TWFuYWdlci5cbiAqLyBjbGFzcyBOdSB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMuUnUgPSB2b2lkIDAsIHRoaXMubGlzdGVuZXJzID0gW107XG4gICAgfVxufVxuXG5jbGFzcyBrdSB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMucXVlcmllcyA9IG5ldyBLbigodCA9PiBYZSh0KSksIFllKSwgdGhpcy5vbmxpbmVTdGF0ZSA9IFwiVW5rbm93blwiIC8qIFVua25vd24gKi8gLCBcbiAgICAgICAgdGhpcy5idSA9IG5ldyBTZXQ7XG4gICAgfVxufVxuXG5hc3luYyBmdW5jdGlvbiBNdSh0LCBlKSB7XG4gICAgY29uc3QgbiA9IEsodCksIHMgPSBlLnF1ZXJ5O1xuICAgIGxldCBpID0gITEsIHIgPSBuLnF1ZXJpZXMuZ2V0KHMpO1xuICAgIGlmIChyIHx8IChpID0gITAsIHIgPSBuZXcgTnUpLCBpKSB0cnkge1xuICAgICAgICByLlJ1ID0gYXdhaXQgbi5vbkxpc3RlbihzKTtcbiAgICB9IGNhdGNoICh0KSB7XG4gICAgICAgIGNvbnN0IG4gPSBTdSh0LCBgSW5pdGlhbGl6YXRpb24gb2YgcXVlcnkgJyR7WmUoZS5xdWVyeSl9JyBmYWlsZWRgKTtcbiAgICAgICAgcmV0dXJuIHZvaWQgZS5vbkVycm9yKG4pO1xuICAgIH1cbiAgICBpZiAobi5xdWVyaWVzLnNldChzLCByKSwgci5saXN0ZW5lcnMucHVzaChlKSwgXG4gICAgLy8gUnVuIGdsb2JhbCBzbmFwc2hvdCBsaXN0ZW5lcnMgaWYgYSBjb25zaXN0ZW50IHNuYXBzaG90IGhhcyBiZWVuIGVtaXR0ZWQuXG4gICAgZS5QdShuLm9ubGluZVN0YXRlKSwgci5SdSkge1xuICAgICAgICBlLlZ1KHIuUnUpICYmIEJ1KG4pO1xuICAgIH1cbn1cblxuYXN5bmMgZnVuY3Rpb24gT3UodCwgZSkge1xuICAgIGNvbnN0IG4gPSBLKHQpLCBzID0gZS5xdWVyeTtcbiAgICBsZXQgaSA9ICExO1xuICAgIGNvbnN0IHIgPSBuLnF1ZXJpZXMuZ2V0KHMpO1xuICAgIGlmIChyKSB7XG4gICAgICAgIGNvbnN0IHQgPSByLmxpc3RlbmVycy5pbmRleE9mKGUpO1xuICAgICAgICB0ID49IDAgJiYgKHIubGlzdGVuZXJzLnNwbGljZSh0LCAxKSwgaSA9IDAgPT09IHIubGlzdGVuZXJzLmxlbmd0aCk7XG4gICAgfVxuICAgIGlmIChpKSByZXR1cm4gbi5xdWVyaWVzLmRlbGV0ZShzKSwgbi5vblVubGlzdGVuKHMpO1xufVxuXG5mdW5jdGlvbiBGdSh0LCBlKSB7XG4gICAgY29uc3QgbiA9IEsodCk7XG4gICAgbGV0IHMgPSAhMTtcbiAgICBmb3IgKGNvbnN0IHQgb2YgZSkge1xuICAgICAgICBjb25zdCBlID0gdC5xdWVyeSwgaSA9IG4ucXVlcmllcy5nZXQoZSk7XG4gICAgICAgIGlmIChpKSB7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGUgb2YgaS5saXN0ZW5lcnMpIGUuVnUodCkgJiYgKHMgPSAhMCk7XG4gICAgICAgICAgICBpLlJ1ID0gdDtcbiAgICAgICAgfVxuICAgIH1cbiAgICBzICYmIEJ1KG4pO1xufVxuXG5mdW5jdGlvbiAkdSh0LCBlLCBuKSB7XG4gICAgY29uc3QgcyA9IEsodCksIGkgPSBzLnF1ZXJpZXMuZ2V0KGUpO1xuICAgIGlmIChpKSBmb3IgKGNvbnN0IHQgb2YgaS5saXN0ZW5lcnMpIHQub25FcnJvcihuKTtcbiAgICAvLyBSZW1vdmUgYWxsIGxpc3RlbmVycy4gTk9URTogV2UgZG9uJ3QgbmVlZCB0byBjYWxsIHN5bmNFbmdpbmUudW5saXN0ZW4oKVxuICAgIC8vIGFmdGVyIGFuIGVycm9yLlxuICAgICAgICBzLnF1ZXJpZXMuZGVsZXRlKGUpO1xufVxuXG4vLyBDYWxsIGFsbCBnbG9iYWwgc25hcHNob3QgbGlzdGVuZXJzIHRoYXQgaGF2ZSBiZWVuIHNldC5cbmZ1bmN0aW9uIEJ1KHQpIHtcbiAgICB0LmJ1LmZvckVhY2goKHQgPT4ge1xuICAgICAgICB0Lm5leHQoKTtcbiAgICB9KSk7XG59XG5cbi8qKlxuICogUXVlcnlMaXN0ZW5lciB0YWtlcyBhIHNlcmllcyBvZiBpbnRlcm5hbCB2aWV3IHNuYXBzaG90cyBhbmQgZGV0ZXJtaW5lc1xuICogd2hlbiB0byByYWlzZSB0aGUgZXZlbnQuXG4gKlxuICogSXQgdXNlcyBhbiBPYnNlcnZlciB0byBkaXNwYXRjaCBldmVudHMuXG4gKi8gY2xhc3MgTHUge1xuICAgIGNvbnN0cnVjdG9yKHQsIGUsIG4pIHtcbiAgICAgICAgdGhpcy5xdWVyeSA9IHQsIHRoaXMudnUgPSBlLCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEluaXRpYWwgc25hcHNob3RzIChlLmcuIGZyb20gY2FjaGUpIG1heSBub3QgYmUgcHJvcGFnYXRlZCB0byB0aGUgd3JhcHBlZFxuICAgICAgICAgKiBvYnNlcnZlci4gVGhpcyBmbGFnIGlzIHNldCB0byB0cnVlIG9uY2Ugd2UndmUgYWN0dWFsbHkgcmFpc2VkIGFuIGV2ZW50LlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5TdSA9ICExLCB0aGlzLkR1ID0gbnVsbCwgdGhpcy5vbmxpbmVTdGF0ZSA9IFwiVW5rbm93blwiIC8qIFVua25vd24gKi8gLCB0aGlzLm9wdGlvbnMgPSBuIHx8IHt9O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBBcHBsaWVzIHRoZSBuZXcgVmlld1NuYXBzaG90IHRvIHRoaXMgbGlzdGVuZXIsIHJhaXNpbmcgYSB1c2VyLWZhY2luZyBldmVudFxuICAgICAqIGlmIGFwcGxpY2FibGUgKGRlcGVuZGluZyBvbiB3aGF0IGNoYW5nZWQsIHdoZXRoZXIgdGhlIHVzZXIgaGFzIG9wdGVkIGludG9cbiAgICAgKiBtZXRhZGF0YS1vbmx5IGNoYW5nZXMsIGV0Yy4pLiBSZXR1cm5zIHRydWUgaWYgYSB1c2VyLWZhY2luZyBldmVudCB3YXNcbiAgICAgKiBpbmRlZWQgcmFpc2VkLlxuICAgICAqLyAgICBWdSh0KSB7XG4gICAgICAgIGlmICghdGhpcy5vcHRpb25zLmluY2x1ZGVNZXRhZGF0YUNoYW5nZXMpIHtcbiAgICAgICAgICAgIC8vIFJlbW92ZSB0aGUgbWV0YWRhdGEgb25seSBjaGFuZ2VzLlxuICAgICAgICAgICAgY29uc3QgZSA9IFtdO1xuICAgICAgICAgICAgZm9yIChjb25zdCBuIG9mIHQuZG9jQ2hhbmdlcykgMyAvKiBNZXRhZGF0YSAqLyAhPT0gbi50eXBlICYmIGUucHVzaChuKTtcbiAgICAgICAgICAgIHQgPSBuZXcgeHUodC5xdWVyeSwgdC5kb2NzLCB0Lm9sZERvY3MsIGUsIHQubXV0YXRlZEtleXMsIHQuZnJvbUNhY2hlLCB0LnN5bmNTdGF0ZUNoYW5nZWQsIFxuICAgICAgICAgICAgLyogZXhjbHVkZXNNZXRhZGF0YUNoYW5nZXM9ICovICEwKTtcbiAgICAgICAgfVxuICAgICAgICBsZXQgZSA9ICExO1xuICAgICAgICByZXR1cm4gdGhpcy5TdSA/IHRoaXMuQ3UodCkgJiYgKHRoaXMudnUubmV4dCh0KSwgZSA9ICEwKSA6IHRoaXMueHUodCwgdGhpcy5vbmxpbmVTdGF0ZSkgJiYgKHRoaXMuTnUodCksIFxuICAgICAgICBlID0gITApLCB0aGlzLkR1ID0gdCwgZTtcbiAgICB9XG4gICAgb25FcnJvcih0KSB7XG4gICAgICAgIHRoaXMudnUuZXJyb3IodCk7XG4gICAgfVxuICAgIC8qKiBSZXR1cm5zIHdoZXRoZXIgYSBzbmFwc2hvdCB3YXMgcmFpc2VkLiAqLyAgICBQdSh0KSB7XG4gICAgICAgIHRoaXMub25saW5lU3RhdGUgPSB0O1xuICAgICAgICBsZXQgZSA9ICExO1xuICAgICAgICByZXR1cm4gdGhpcy5EdSAmJiAhdGhpcy5TdSAmJiB0aGlzLnh1KHRoaXMuRHUsIHQpICYmICh0aGlzLk51KHRoaXMuRHUpLCBlID0gITApLCBcbiAgICAgICAgZTtcbiAgICB9XG4gICAgeHUodCwgZSkge1xuICAgICAgICAvLyBBbHdheXMgcmFpc2UgdGhlIGZpcnN0IGV2ZW50IHdoZW4gd2UncmUgc3luY2VkXG4gICAgICAgIGlmICghdC5mcm9tQ2FjaGUpIHJldHVybiAhMDtcbiAgICAgICAgLy8gTk9URTogV2UgY29uc2lkZXIgT25saW5lU3RhdGUuVW5rbm93biBhcyBvbmxpbmUgKGl0IHNob3VsZCBiZWNvbWUgT2ZmbGluZVxuICAgICAgICAvLyBvciBPbmxpbmUgaWYgd2Ugd2FpdCBsb25nIGVub3VnaCkuXG4gICAgICAgICAgICAgICAgY29uc3QgbiA9IFwiT2ZmbGluZVwiIC8qIE9mZmxpbmUgKi8gIT09IGU7XG4gICAgICAgIC8vIERvbid0IHJhaXNlIHRoZSBldmVudCBpZiB3ZSdyZSBvbmxpbmUsIGFyZW4ndCBzeW5jZWQgeWV0IChjaGVja2VkXG4gICAgICAgIC8vIGFib3ZlKSBhbmQgYXJlIHdhaXRpbmcgZm9yIGEgc3luYy5cbiAgICAgICAgICAgICAgICByZXR1cm4gKCF0aGlzLm9wdGlvbnMua3UgfHwgIW4pICYmICghdC5kb2NzLmlzRW1wdHkoKSB8fCBcIk9mZmxpbmVcIiAvKiBPZmZsaW5lICovID09PSBlKTtcbiAgICAgICAgLy8gUmFpc2UgZGF0YSBmcm9tIGNhY2hlIGlmIHdlIGhhdmUgYW55IGRvY3VtZW50cyBvciB3ZSBhcmUgb2ZmbGluZVxuICAgICAgICB9XG4gICAgQ3UodCkge1xuICAgICAgICAvLyBXZSBkb24ndCBuZWVkIHRvIGhhbmRsZSBpbmNsdWRlRG9jdW1lbnRNZXRhZGF0YUNoYW5nZXMgaGVyZSBiZWNhdXNlXG4gICAgICAgIC8vIHRoZSBNZXRhZGF0YSBvbmx5IGNoYW5nZXMgaGF2ZSBhbHJlYWR5IGJlZW4gc3RyaXBwZWQgb3V0IGlmIG5lZWRlZC5cbiAgICAgICAgLy8gQXQgdGhpcyBwb2ludCB0aGUgb25seSBjaGFuZ2VzIHdlIHdpbGwgc2VlIGFyZSB0aGUgb25lcyB3ZSBzaG91bGRcbiAgICAgICAgLy8gcHJvcGFnYXRlLlxuICAgICAgICBpZiAodC5kb2NDaGFuZ2VzLmxlbmd0aCA+IDApIHJldHVybiAhMDtcbiAgICAgICAgY29uc3QgZSA9IHRoaXMuRHUgJiYgdGhpcy5EdS5oYXNQZW5kaW5nV3JpdGVzICE9PSB0Lmhhc1BlbmRpbmdXcml0ZXM7XG4gICAgICAgIHJldHVybiAhKCF0LnN5bmNTdGF0ZUNoYW5nZWQgJiYgIWUpICYmICEwID09PSB0aGlzLm9wdGlvbnMuaW5jbHVkZU1ldGFkYXRhQ2hhbmdlcztcbiAgICAgICAgLy8gR2VuZXJhbGx5IHdlIHNob3VsZCBoYXZlIGhpdCBvbmUgb2YgdGhlIGNhc2VzIGFib3ZlLCBidXQgaXQncyBwb3NzaWJsZVxuICAgICAgICAvLyB0byBnZXQgaGVyZSBpZiB0aGVyZSB3ZXJlIG9ubHkgbWV0YWRhdGEgZG9jQ2hhbmdlcyBhbmQgdGhleSBnb3RcbiAgICAgICAgLy8gc3RyaXBwZWQgb3V0LlxuICAgICAgICB9XG4gICAgTnUodCkge1xuICAgICAgICB0ID0geHUuZnJvbUluaXRpYWxEb2N1bWVudHModC5xdWVyeSwgdC5kb2NzLCB0Lm11dGF0ZWRLZXlzLCB0LmZyb21DYWNoZSksIHRoaXMuU3UgPSAhMCwgXG4gICAgICAgIHRoaXMudnUubmV4dCh0KTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEEgY29tcGxldGUgZWxlbWVudCBpbiB0aGUgYnVuZGxlIHN0cmVhbSwgdG9nZXRoZXIgd2l0aCB0aGUgYnl0ZSBsZW5ndGggaXRcbiAqIG9jY3VwaWVzIGluIHRoZSBzdHJlYW0uXG4gKi8gY2xhc3MgVXUge1xuICAgIGNvbnN0cnVjdG9yKHQsIFxuICAgIC8vIEhvdyBtYW55IGJ5dGVzIHRoaXMgZWxlbWVudCB0YWtlcyB0byBzdG9yZSBpbiB0aGUgYnVuZGxlLlxuICAgIGUpIHtcbiAgICAgICAgdGhpcy5wYXlsb2FkID0gdCwgdGhpcy5ieXRlTGVuZ3RoID0gZTtcbiAgICB9XG4gICAgTXUoKSB7XG4gICAgICAgIHJldHVybiBcIm1ldGFkYXRhXCIgaW4gdGhpcy5wYXlsb2FkO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogSGVscGVyIHRvIGNvbnZlcnQgb2JqZWN0cyBmcm9tIGJ1bmRsZXMgdG8gbW9kZWwgb2JqZWN0cyBpbiB0aGUgU0RLLlxuICovIGNsYXNzIHF1IHtcbiAgICBjb25zdHJ1Y3Rvcih0KSB7XG4gICAgICAgIHRoaXMuTSA9IHQ7XG4gICAgfVxuICAgIHdpKHQpIHtcbiAgICAgICAgcmV0dXJuIHBzKHRoaXMuTSwgdCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENvbnZlcnRzIGEgQnVuZGxlRG9jdW1lbnQgdG8gYSBNdXRhYmxlRG9jdW1lbnQuXG4gICAgICovICAgIG1pKHQpIHtcbiAgICAgICAgcmV0dXJuIHQubWV0YWRhdGEuZXhpc3RzID8gYnModGhpcy5NLCB0LmRvY3VtZW50LCAhMSkgOiBuZS5uZXdOb0RvY3VtZW50KHRoaXMud2kodC5tZXRhZGF0YS5uYW1lKSwgdGhpcy5naSh0Lm1ldGFkYXRhLnJlYWRUaW1lKSk7XG4gICAgfVxuICAgIGdpKHQpIHtcbiAgICAgICAgcmV0dXJuIHdzKHQpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBBIGNsYXNzIHRvIHByb2Nlc3MgdGhlIGVsZW1lbnRzIGZyb20gYSBidW5kbGUsIGxvYWQgdGhlbSBpbnRvIGxvY2FsXG4gKiBzdG9yYWdlIGFuZCBwcm92aWRlIHByb2dyZXNzIHVwZGF0ZSB3aGlsZSBsb2FkaW5nLlxuICovIGNsYXNzIEt1IHtcbiAgICBjb25zdHJ1Y3Rvcih0LCBlLCBuKSB7XG4gICAgICAgIHRoaXMuT3UgPSB0LCB0aGlzLmxvY2FsU3RvcmUgPSBlLCB0aGlzLk0gPSBuLCBcbiAgICAgICAgLyoqIEJhdGNoZWQgcXVlcmllcyB0byBiZSBzYXZlZCBpbnRvIHN0b3JhZ2UgKi9cbiAgICAgICAgdGhpcy5xdWVyaWVzID0gW10sIFxuICAgICAgICAvKiogQmF0Y2hlZCBkb2N1bWVudHMgdG8gYmUgc2F2ZWQgaW50byBzdG9yYWdlICovXG4gICAgICAgIHRoaXMuZG9jdW1lbnRzID0gW10sIFxuICAgICAgICAvKiogVGhlIGNvbGxlY3Rpb24gZ3JvdXBzIGFmZmVjdGVkIGJ5IHRoaXMgYnVuZGxlLiAqL1xuICAgICAgICB0aGlzLmNvbGxlY3Rpb25Hcm91cHMgPSBuZXcgU2V0LCB0aGlzLnByb2dyZXNzID0gR3UodCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEFkZHMgYW4gZWxlbWVudCBmcm9tIHRoZSBidW5kbGUgdG8gdGhlIGxvYWRlci5cbiAgICAgKlxuICAgICAqIFJldHVybnMgYSBuZXcgcHJvZ3Jlc3MgaWYgYWRkaW5nIHRoZSBlbGVtZW50IGxlYWRzIHRvIGEgbmV3IHByb2dyZXNzLFxuICAgICAqIG90aGVyd2lzZSByZXR1cm5zIG51bGwuXG4gICAgICovICAgIEZ1KHQpIHtcbiAgICAgICAgdGhpcy5wcm9ncmVzcy5ieXRlc0xvYWRlZCArPSB0LmJ5dGVMZW5ndGg7XG4gICAgICAgIGxldCBlID0gdGhpcy5wcm9ncmVzcy5kb2N1bWVudHNMb2FkZWQ7XG4gICAgICAgIGlmICh0LnBheWxvYWQubmFtZWRRdWVyeSkgdGhpcy5xdWVyaWVzLnB1c2godC5wYXlsb2FkLm5hbWVkUXVlcnkpOyBlbHNlIGlmICh0LnBheWxvYWQuZG9jdW1lbnRNZXRhZGF0YSkge1xuICAgICAgICAgICAgdGhpcy5kb2N1bWVudHMucHVzaCh7XG4gICAgICAgICAgICAgICAgbWV0YWRhdGE6IHQucGF5bG9hZC5kb2N1bWVudE1ldGFkYXRhXG4gICAgICAgICAgICB9KSwgdC5wYXlsb2FkLmRvY3VtZW50TWV0YWRhdGEuZXhpc3RzIHx8ICsrZTtcbiAgICAgICAgICAgIGNvbnN0IG4gPSBfdC5mcm9tU3RyaW5nKHQucGF5bG9hZC5kb2N1bWVudE1ldGFkYXRhLm5hbWUpO1xuICAgICAgICAgICAgdGhpcy5jb2xsZWN0aW9uR3JvdXBzLmFkZChuLmdldChuLmxlbmd0aCAtIDIpKTtcbiAgICAgICAgfSBlbHNlIHQucGF5bG9hZC5kb2N1bWVudCAmJiAodGhpcy5kb2N1bWVudHNbdGhpcy5kb2N1bWVudHMubGVuZ3RoIC0gMV0uZG9jdW1lbnQgPSB0LnBheWxvYWQuZG9jdW1lbnQsIFxuICAgICAgICArK2UpO1xuICAgICAgICByZXR1cm4gZSAhPT0gdGhpcy5wcm9ncmVzcy5kb2N1bWVudHNMb2FkZWQgPyAodGhpcy5wcm9ncmVzcy5kb2N1bWVudHNMb2FkZWQgPSBlLCBcbiAgICAgICAgT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5wcm9ncmVzcykpIDogbnVsbDtcbiAgICB9XG4gICAgJHUodCkge1xuICAgICAgICBjb25zdCBlID0gbmV3IE1hcCwgbiA9IG5ldyBxdSh0aGlzLk0pO1xuICAgICAgICBmb3IgKGNvbnN0IHMgb2YgdCkgaWYgKHMubWV0YWRhdGEucXVlcmllcykge1xuICAgICAgICAgICAgY29uc3QgdCA9IG4ud2kocy5tZXRhZGF0YS5uYW1lKTtcbiAgICAgICAgICAgIGZvciAoY29uc3QgbiBvZiBzLm1ldGFkYXRhLnF1ZXJpZXMpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBzID0gKGUuZ2V0KG4pIHx8IFluKCkpLmFkZCh0KTtcbiAgICAgICAgICAgICAgICBlLnNldChuLCBzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVXBkYXRlIHRoZSBwcm9ncmVzcyB0byAnU3VjY2VzcycgYW5kIHJldHVybiB0aGUgdXBkYXRlZCBwcm9ncmVzcy5cbiAgICAgKi8gICAgYXN5bmMgY29tcGxldGUoKSB7XG4gICAgICAgIGNvbnN0IHQgPSBhd2FpdCBtbyh0aGlzLmxvY2FsU3RvcmUsIG5ldyBxdSh0aGlzLk0pLCB0aGlzLmRvY3VtZW50cywgdGhpcy5PdS5pZCksIGUgPSB0aGlzLiR1KHRoaXMuZG9jdW1lbnRzKTtcbiAgICAgICAgZm9yIChjb25zdCB0IG9mIHRoaXMucXVlcmllcykgYXdhaXQgZ28odGhpcy5sb2NhbFN0b3JlLCB0LCBlLmdldCh0Lm5hbWUpKTtcbiAgICAgICAgcmV0dXJuIHRoaXMucHJvZ3Jlc3MudGFza1N0YXRlID0gXCJTdWNjZXNzXCIsIHtcbiAgICAgICAgICAgIHByb2dyZXNzOiB0aGlzLnByb2dyZXNzLFxuICAgICAgICAgICAgQnU6IHRoaXMuY29sbGVjdGlvbkdyb3VwcyxcbiAgICAgICAgICAgIEx1OiB0XG4gICAgICAgIH07XG4gICAgfVxufVxuXG4vKipcbiAqIFJldHVybnMgYSBgTG9hZEJ1bmRsZVRhc2tQcm9ncmVzc2AgcmVwcmVzZW50aW5nIHRoZSBpbml0aWFsIHByb2dyZXNzIG9mXG4gKiBsb2FkaW5nIGEgYnVuZGxlLlxuICovIGZ1bmN0aW9uIEd1KHQpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICB0YXNrU3RhdGU6IFwiUnVubmluZ1wiLFxuICAgICAgICBkb2N1bWVudHNMb2FkZWQ6IDAsXG4gICAgICAgIGJ5dGVzTG9hZGVkOiAwLFxuICAgICAgICB0b3RhbERvY3VtZW50czogdC50b3RhbERvY3VtZW50cyxcbiAgICAgICAgdG90YWxCeXRlczogdC50b3RhbEJ5dGVzXG4gICAgfTtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIGEgYExvYWRCdW5kbGVUYXNrUHJvZ3Jlc3NgIHJlcHJlc2VudGluZyB0aGUgcHJvZ3Jlc3MgdGhhdCB0aGUgbG9hZGluZ1xuICogaGFzIHN1Y2NlZWRlZC5cbiAqL1xuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmNsYXNzIFF1IHtcbiAgICBjb25zdHJ1Y3Rvcih0KSB7XG4gICAgICAgIHRoaXMua2V5ID0gdDtcbiAgICB9XG59XG5cbmNsYXNzIGp1IHtcbiAgICBjb25zdHJ1Y3Rvcih0KSB7XG4gICAgICAgIHRoaXMua2V5ID0gdDtcbiAgICB9XG59XG5cbi8qKlxuICogVmlldyBpcyByZXNwb25zaWJsZSBmb3IgY29tcHV0aW5nIHRoZSBmaW5hbCBtZXJnZWQgdHJ1dGggb2Ygd2hhdCBkb2NzIGFyZSBpblxuICogYSBxdWVyeS4gSXQgZ2V0cyBub3RpZmllZCBvZiBsb2NhbCBhbmQgcmVtb3RlIGNoYW5nZXMgdG8gZG9jcywgYW5kIGFwcGxpZXNcbiAqIHRoZSBxdWVyeSBmaWx0ZXJzIGFuZCBsaW1pdHMgdG8gZGV0ZXJtaW5lIHRoZSBtb3N0IGNvcnJlY3QgcG9zc2libGUgcmVzdWx0cy5cbiAqLyBjbGFzcyBXdSB7XG4gICAgY29uc3RydWN0b3IodCwgXG4gICAgLyoqIERvY3VtZW50cyBpbmNsdWRlZCBpbiB0aGUgcmVtb3RlIHRhcmdldCAqL1xuICAgIGUpIHtcbiAgICAgICAgdGhpcy5xdWVyeSA9IHQsIHRoaXMuVXUgPSBlLCB0aGlzLnF1ID0gbnVsbCwgXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBIGZsYWcgd2hldGhlciB0aGUgdmlldyBpcyBjdXJyZW50IHdpdGggdGhlIGJhY2tlbmQuIEEgdmlldyBpcyBjb25zaWRlcmVkXG4gICAgICAgICAqIGN1cnJlbnQgYWZ0ZXIgaXQgaGFzIHNlZW4gdGhlIGN1cnJlbnQgZmxhZyBmcm9tIHRoZSBiYWNrZW5kIGFuZCBkaWQgbm90XG4gICAgICAgICAqIGxvc2UgY29uc2lzdGVuY3kgd2l0aGluIHRoZSB3YXRjaCBzdHJlYW0gKGUuZy4gYmVjYXVzZSBvZiBhbiBleGlzdGVuY2VcbiAgICAgICAgICogZmlsdGVyIG1pc21hdGNoKS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuY3VycmVudCA9ICExLCBcbiAgICAgICAgLyoqIERvY3VtZW50cyBpbiB0aGUgdmlldyBidXQgbm90IGluIHRoZSByZW1vdGUgdGFyZ2V0ICovXG4gICAgICAgIHRoaXMuS3UgPSBZbigpLCBcbiAgICAgICAgLyoqIERvY3VtZW50IEtleXMgdGhhdCBoYXZlIGxvY2FsIGNoYW5nZXMgKi9cbiAgICAgICAgdGhpcy5tdXRhdGVkS2V5cyA9IFluKCksIHRoaXMuR3UgPSBubih0KSwgdGhpcy5RdSA9IG5ldyBEdSh0aGlzLkd1KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVGhlIHNldCBvZiByZW1vdGUgZG9jdW1lbnRzIHRoYXQgdGhlIHNlcnZlciBoYXMgdG9sZCB1cyBiZWxvbmdzIHRvIHRoZSB0YXJnZXQgYXNzb2NpYXRlZCB3aXRoXG4gICAgICogdGhpcyB2aWV3LlxuICAgICAqLyAgICBnZXQganUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLlV1O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBJdGVyYXRlcyBvdmVyIGEgc2V0IG9mIGRvYyBjaGFuZ2VzLCBhcHBsaWVzIHRoZSBxdWVyeSBsaW1pdCwgYW5kIGNvbXB1dGVzXG4gICAgICogd2hhdCB0aGUgbmV3IHJlc3VsdHMgc2hvdWxkIGJlLCB3aGF0IHRoZSBjaGFuZ2VzIHdlcmUsIGFuZCB3aGV0aGVyIHdlIG1heVxuICAgICAqIG5lZWQgdG8gZ28gYmFjayB0byB0aGUgbG9jYWwgY2FjaGUgZm9yIG1vcmUgcmVzdWx0cy4gRG9lcyBub3QgbWFrZSBhbnlcbiAgICAgKiBjaGFuZ2VzIHRvIHRoZSB2aWV3LlxuICAgICAqIEBwYXJhbSBkb2NDaGFuZ2VzIC0gVGhlIGRvYyBjaGFuZ2VzIHRvIGFwcGx5IHRvIHRoaXMgdmlldy5cbiAgICAgKiBAcGFyYW0gcHJldmlvdXNDaGFuZ2VzIC0gSWYgdGhpcyBpcyBiZWluZyBjYWxsZWQgd2l0aCBhIHJlZmlsbCwgdGhlbiBzdGFydFxuICAgICAqICAgICAgICB3aXRoIHRoaXMgc2V0IG9mIGRvY3MgYW5kIGNoYW5nZXMgaW5zdGVhZCBvZiB0aGUgY3VycmVudCB2aWV3LlxuICAgICAqIEByZXR1cm5zIGEgbmV3IHNldCBvZiBkb2NzLCBjaGFuZ2VzLCBhbmQgcmVmaWxsIGZsYWcuXG4gICAgICovICAgIFd1KHQsIGUpIHtcbiAgICAgICAgY29uc3QgbiA9IGUgPyBlLnp1IDogbmV3IEN1LCBzID0gZSA/IGUuUXUgOiB0aGlzLlF1O1xuICAgICAgICBsZXQgaSA9IGUgPyBlLm11dGF0ZWRLZXlzIDogdGhpcy5tdXRhdGVkS2V5cywgciA9IHMsIG8gPSAhMTtcbiAgICAgICAgLy8gVHJhY2sgdGhlIGxhc3QgZG9jIGluIGEgKGZ1bGwpIGxpbWl0LiBUaGlzIGlzIG5lY2Vzc2FyeSwgYmVjYXVzZSBzb21lXG4gICAgICAgIC8vIHVwZGF0ZSAoYSBkZWxldGUsIG9yIGFuIHVwZGF0ZSBtb3ZpbmcgYSBkb2MgcGFzdCB0aGUgb2xkIGxpbWl0KSBtaWdodFxuICAgICAgICAvLyBtZWFuIHRoZXJlIGlzIHNvbWUgb3RoZXIgZG9jdW1lbnQgaW4gdGhlIGxvY2FsIGNhY2hlIHRoYXQgZWl0aGVyIHNob3VsZFxuICAgICAgICAvLyBjb21lICgxKSBiZXR3ZWVuIHRoZSBvbGQgbGFzdCBsaW1pdCBkb2MgYW5kIHRoZSBuZXcgbGFzdCBkb2N1bWVudCwgaW4gdGhlXG4gICAgICAgIC8vIGNhc2Ugb2YgdXBkYXRlcywgb3IgKDIpIGFmdGVyIHRoZSBuZXcgbGFzdCBkb2N1bWVudCwgaW4gdGhlIGNhc2Ugb2ZcbiAgICAgICAgLy8gZGVsZXRlcy4gU28gd2Uga2VlcCB0aGlzIGRvYyBhdCB0aGUgb2xkIGxpbWl0IHRvIGNvbXBhcmUgdGhlIHVwZGF0ZXMgdG8uXG4gICAgICAgIC8vIE5vdGUgdGhhdCB0aGlzIHNob3VsZCBuZXZlciBnZXQgdXNlZCBpbiBhIHJlZmlsbCAod2hlbiBwcmV2aW91c0NoYW5nZXMgaXNcbiAgICAgICAgLy8gc2V0KSwgYmVjYXVzZSB0aGVyZSB3aWxsIG9ubHkgYmUgYWRkcyAtLSBubyBkZWxldGVzIG9yIHVwZGF0ZXMuXG4gICAgICAgIGNvbnN0IHUgPSBcIkZcIiAvKiBGaXJzdCAqLyA9PT0gdGhpcy5xdWVyeS5saW1pdFR5cGUgJiYgcy5zaXplID09PSB0aGlzLnF1ZXJ5LmxpbWl0ID8gcy5sYXN0KCkgOiBudWxsLCBhID0gXCJMXCIgLyogTGFzdCAqLyA9PT0gdGhpcy5xdWVyeS5saW1pdFR5cGUgJiYgcy5zaXplID09PSB0aGlzLnF1ZXJ5LmxpbWl0ID8gcy5maXJzdCgpIDogbnVsbDtcbiAgICAgICAgLy8gRHJvcCBkb2N1bWVudHMgb3V0IHRvIG1lZXQgbGltaXQvbGltaXRUb0xhc3QgcmVxdWlyZW1lbnQuXG4gICAgICAgIGlmICh0Lmlub3JkZXJUcmF2ZXJzYWwoKCh0LCBlKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBjID0gcy5nZXQodCksIGggPSB0bih0aGlzLnF1ZXJ5LCBlKSA/IGUgOiBudWxsLCBsID0gISFjICYmIHRoaXMubXV0YXRlZEtleXMuaGFzKGMua2V5KSwgZiA9ICEhaCAmJiAoaC5oYXNMb2NhbE11dGF0aW9ucyB8fCBcbiAgICAgICAgICAgIC8vIFdlIG9ubHkgY29uc2lkZXIgY29tbWl0dGVkIG11dGF0aW9ucyBmb3IgZG9jdW1lbnRzIHRoYXQgd2VyZVxuICAgICAgICAgICAgLy8gbXV0YXRlZCBkdXJpbmcgdGhlIGxpZmV0aW1lIG9mIHRoZSB2aWV3LlxuICAgICAgICAgICAgdGhpcy5tdXRhdGVkS2V5cy5oYXMoaC5rZXkpICYmIGguaGFzQ29tbWl0dGVkTXV0YXRpb25zKTtcbiAgICAgICAgICAgIGxldCBkID0gITE7XG4gICAgICAgICAgICAvLyBDYWxjdWxhdGUgY2hhbmdlXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYyAmJiBoKSB7XG4gICAgICAgICAgICAgICAgYy5kYXRhLmlzRXF1YWwoaC5kYXRhKSA/IGwgIT09IGYgJiYgKG4udHJhY2soe1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiAzIC8qIE1ldGFkYXRhICovICxcbiAgICAgICAgICAgICAgICAgICAgZG9jOiBoXG4gICAgICAgICAgICAgICAgfSksIGQgPSAhMCkgOiB0aGlzLkh1KGMsIGgpIHx8IChuLnRyYWNrKHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogMiAvKiBNb2RpZmllZCAqLyAsXG4gICAgICAgICAgICAgICAgICAgIGRvYzogaFxuICAgICAgICAgICAgICAgIH0pLCBkID0gITAsICh1ICYmIHRoaXMuR3UoaCwgdSkgPiAwIHx8IGEgJiYgdGhpcy5HdShoLCBhKSA8IDApICYmIChcbiAgICAgICAgICAgICAgICAvLyBUaGlzIGRvYyBtb3ZlZCBmcm9tIGluc2lkZSB0aGUgbGltaXQgdG8gb3V0c2lkZSB0aGUgbGltaXQuXG4gICAgICAgICAgICAgICAgLy8gVGhhdCBtZWFucyB0aGVyZSBtYXkgYmUgc29tZSBvdGhlciBkb2MgaW4gdGhlIGxvY2FsIGNhY2hlXG4gICAgICAgICAgICAgICAgLy8gdGhhdCBzaG91bGQgYmUgaW5jbHVkZWQgaW5zdGVhZC5cbiAgICAgICAgICAgICAgICBvID0gITApKTtcbiAgICAgICAgICAgIH0gZWxzZSAhYyAmJiBoID8gKG4udHJhY2soe1xuICAgICAgICAgICAgICAgIHR5cGU6IDAgLyogQWRkZWQgKi8gLFxuICAgICAgICAgICAgICAgIGRvYzogaFxuICAgICAgICAgICAgfSksIGQgPSAhMCkgOiBjICYmICFoICYmIChuLnRyYWNrKHtcbiAgICAgICAgICAgICAgICB0eXBlOiAxIC8qIFJlbW92ZWQgKi8gLFxuICAgICAgICAgICAgICAgIGRvYzogY1xuICAgICAgICAgICAgfSksIGQgPSAhMCwgKHUgfHwgYSkgJiYgKFxuICAgICAgICAgICAgLy8gQSBkb2Mgd2FzIHJlbW92ZWQgZnJvbSBhIGZ1bGwgbGltaXQgcXVlcnkuIFdlJ2xsIG5lZWQgdG9cbiAgICAgICAgICAgIC8vIHJlcXVlcnkgZnJvbSB0aGUgbG9jYWwgY2FjaGUgdG8gc2VlIGlmIHdlIGtub3cgYWJvdXQgc29tZSBvdGhlclxuICAgICAgICAgICAgLy8gZG9jIHRoYXQgc2hvdWxkIGJlIGluIHRoZSByZXN1bHRzLlxuICAgICAgICAgICAgbyA9ICEwKSk7XG4gICAgICAgICAgICBkICYmIChoID8gKHIgPSByLmFkZChoKSwgaSA9IGYgPyBpLmFkZCh0KSA6IGkuZGVsZXRlKHQpKSA6IChyID0gci5kZWxldGUodCksIGkgPSBpLmRlbGV0ZSh0KSkpO1xuICAgICAgICB9KSksIG51bGwgIT09IHRoaXMucXVlcnkubGltaXQpIGZvciAoO3Iuc2l6ZSA+IHRoaXMucXVlcnkubGltaXQ7ICkge1xuICAgICAgICAgICAgY29uc3QgdCA9IFwiRlwiIC8qIEZpcnN0ICovID09PSB0aGlzLnF1ZXJ5LmxpbWl0VHlwZSA/IHIubGFzdCgpIDogci5maXJzdCgpO1xuICAgICAgICAgICAgciA9IHIuZGVsZXRlKHQua2V5KSwgaSA9IGkuZGVsZXRlKHQua2V5KSwgbi50cmFjayh7XG4gICAgICAgICAgICAgICAgdHlwZTogMSAvKiBSZW1vdmVkICovICxcbiAgICAgICAgICAgICAgICBkb2M6IHRcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBRdTogcixcbiAgICAgICAgICAgIHp1OiBuLFxuICAgICAgICAgICAgaWk6IG8sXG4gICAgICAgICAgICBtdXRhdGVkS2V5czogaVxuICAgICAgICB9O1xuICAgIH1cbiAgICBIdSh0LCBlKSB7XG4gICAgICAgIC8vIFdlIHN1cHByZXNzIHRoZSBpbml0aWFsIGNoYW5nZSBldmVudCBmb3IgZG9jdW1lbnRzIHRoYXQgd2VyZSBtb2RpZmllZCBhc1xuICAgICAgICAvLyBwYXJ0IG9mIGEgd3JpdGUgYWNrbm93bGVkZ21lbnQgKGUuZy4gd2hlbiB0aGUgdmFsdWUgb2YgYSBzZXJ2ZXIgdHJhbnNmb3JtXG4gICAgICAgIC8vIGlzIGFwcGxpZWQpIGFzIFdhdGNoIHdpbGwgc2VuZCB1cyB0aGUgc2FtZSBkb2N1bWVudCBhZ2Fpbi5cbiAgICAgICAgLy8gQnkgc3VwcHJlc3NpbmcgdGhlIGV2ZW50LCB3ZSBvbmx5IHJhaXNlIHR3byB1c2VyIHZpc2libGUgZXZlbnRzIChvbmUgd2l0aFxuICAgICAgICAvLyBgaGFzUGVuZGluZ1dyaXRlc2AgYW5kIHRoZSBmaW5hbCBzdGF0ZSBvZiB0aGUgZG9jdW1lbnQpIGluc3RlYWQgb2YgdGhyZWVcbiAgICAgICAgLy8gKG9uZSB3aXRoIGBoYXNQZW5kaW5nV3JpdGVzYCwgdGhlIG1vZGlmaWVkIGRvY3VtZW50IHdpdGhcbiAgICAgICAgLy8gYGhhc1BlbmRpbmdXcml0ZXNgIGFuZCB0aGUgZmluYWwgc3RhdGUgb2YgdGhlIGRvY3VtZW50KS5cbiAgICAgICAgcmV0dXJuIHQuaGFzTG9jYWxNdXRhdGlvbnMgJiYgZS5oYXNDb21taXR0ZWRNdXRhdGlvbnMgJiYgIWUuaGFzTG9jYWxNdXRhdGlvbnM7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFVwZGF0ZXMgdGhlIHZpZXcgd2l0aCB0aGUgZ2l2ZW4gVmlld0RvY3VtZW50Q2hhbmdlcyBhbmQgb3B0aW9uYWxseSB1cGRhdGVzXG4gICAgICogbGltYm8gZG9jcyBhbmQgc3luYyBzdGF0ZSBmcm9tIHRoZSBwcm92aWRlZCB0YXJnZXQgY2hhbmdlLlxuICAgICAqIEBwYXJhbSBkb2NDaGFuZ2VzIC0gVGhlIHNldCBvZiBjaGFuZ2VzIHRvIG1ha2UgdG8gdGhlIHZpZXcncyBkb2NzLlxuICAgICAqIEBwYXJhbSB1cGRhdGVMaW1ib0RvY3VtZW50cyAtIFdoZXRoZXIgdG8gdXBkYXRlIGxpbWJvIGRvY3VtZW50cyBiYXNlZCBvblxuICAgICAqICAgICAgICB0aGlzIGNoYW5nZS5cbiAgICAgKiBAcGFyYW0gdGFyZ2V0Q2hhbmdlIC0gQSB0YXJnZXQgY2hhbmdlIHRvIGFwcGx5IGZvciBjb21wdXRpbmcgbGltYm8gZG9jcyBhbmRcbiAgICAgKiAgICAgICAgc3luYyBzdGF0ZS5cbiAgICAgKiBAcmV0dXJucyBBIG5ldyBWaWV3Q2hhbmdlIHdpdGggdGhlIGdpdmVuIGRvY3MsIGNoYW5nZXMsIGFuZCBzeW5jIHN0YXRlLlxuICAgICAqL1xuICAgIC8vIFBPUlRJTkcgTk9URTogVGhlIGlPUy9BbmRyb2lkIGNsaWVudHMgYWx3YXlzIGNvbXB1dGUgbGltYm8gZG9jdW1lbnQgY2hhbmdlcy5cbiAgICBhcHBseUNoYW5nZXModCwgZSwgbikge1xuICAgICAgICBjb25zdCBzID0gdGhpcy5RdTtcbiAgICAgICAgdGhpcy5RdSA9IHQuUXUsIHRoaXMubXV0YXRlZEtleXMgPSB0Lm11dGF0ZWRLZXlzO1xuICAgICAgICAvLyBTb3J0IGNoYW5nZXMgYmFzZWQgb24gdHlwZSBhbmQgcXVlcnkgY29tcGFyYXRvclxuICAgICAgICBjb25zdCBpID0gdC56dS5BdSgpO1xuICAgICAgICBpLnNvcnQoKCh0LCBlKSA9PiBmdW5jdGlvbih0LCBlKSB7XG4gICAgICAgICAgICBjb25zdCBuID0gdCA9PiB7XG4gICAgICAgICAgICAgICAgc3dpdGNoICh0KSB7XG4gICAgICAgICAgICAgICAgICBjYXNlIDAgLyogQWRkZWQgKi8gOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gMTtcblxuICAgICAgICAgICAgICAgICAgY2FzZSAyIC8qIE1vZGlmaWVkICovIDpcbiAgICAgICAgICAgICAgICAgIGNhc2UgMyAvKiBNZXRhZGF0YSAqLyA6XG4gICAgICAgICAgICAgICAgICAgIC8vIEEgbWV0YWRhdGEgY2hhbmdlIGlzIGNvbnZlcnRlZCB0byBhIG1vZGlmaWVkIGNoYW5nZSBhdCB0aGUgcHVibGljXG4gICAgICAgICAgICAgICAgICAgIC8vIGFwaSBsYXllci4gIFNpbmNlIHdlIHNvcnQgYnkgZG9jdW1lbnQga2V5IGFuZCB0aGVuIGNoYW5nZSB0eXBlLFxuICAgICAgICAgICAgICAgICAgICAvLyBtZXRhZGF0YSBhbmQgbW9kaWZpZWQgY2hhbmdlcyBtdXN0IGJlIHNvcnRlZCBlcXVpdmFsZW50bHkuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAyO1xuXG4gICAgICAgICAgICAgICAgICBjYXNlIDEgLyogUmVtb3ZlZCAqLyA6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAwO1xuXG4gICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gTCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICByZXR1cm4gbih0KSAtIG4oZSk7XG4gICAgICAgIH1cbiAgICAgICAgLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi8gKHQudHlwZSwgZS50eXBlKSB8fCB0aGlzLkd1KHQuZG9jLCBlLmRvYykpKSwgdGhpcy5KdShuKTtcbiAgICAgICAgY29uc3QgciA9IGUgPyB0aGlzLll1KCkgOiBbXSwgbyA9IDAgPT09IHRoaXMuS3Uuc2l6ZSAmJiB0aGlzLmN1cnJlbnQgPyAxIC8qIFN5bmNlZCAqLyA6IDAgLyogTG9jYWwgKi8gLCB1ID0gbyAhPT0gdGhpcy5xdTtcbiAgICAgICAgaWYgKHRoaXMucXUgPSBvLCAwICE9PSBpLmxlbmd0aCB8fCB1KSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHNuYXBzaG90OiBuZXcgeHUodGhpcy5xdWVyeSwgdC5RdSwgcywgaSwgdC5tdXRhdGVkS2V5cywgMCAvKiBMb2NhbCAqLyA9PT0gbywgdSwgXG4gICAgICAgICAgICAgICAgLyogZXhjbHVkZXNNZXRhZGF0YUNoYW5nZXM9ICovICExKSxcbiAgICAgICAgICAgICAgICBYdTogclxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICAvLyBubyBjaGFuZ2VzXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBYdTogclxuICAgICAgICB9O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBBcHBsaWVzIGFuIE9ubGluZVN0YXRlIGNoYW5nZSB0byB0aGUgdmlldywgcG90ZW50aWFsbHkgZ2VuZXJhdGluZyBhXG4gICAgICogVmlld0NoYW5nZSBpZiB0aGUgdmlldydzIHN5bmNTdGF0ZSBjaGFuZ2VzIGFzIGEgcmVzdWx0LlxuICAgICAqLyAgICBQdSh0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnQgJiYgXCJPZmZsaW5lXCIgLyogT2ZmbGluZSAqLyA9PT0gdCA/IChcbiAgICAgICAgLy8gSWYgd2UncmUgb2ZmbGluZSwgc2V0IGBjdXJyZW50YCB0byBmYWxzZSBhbmQgdGhlbiBjYWxsIGFwcGx5Q2hhbmdlcygpXG4gICAgICAgIC8vIHRvIHJlZnJlc2ggb3VyIHN5bmNTdGF0ZSBhbmQgZ2VuZXJhdGUgYSBWaWV3Q2hhbmdlIGFzIGFwcHJvcHJpYXRlLiBXZVxuICAgICAgICAvLyBhcmUgZ3VhcmFudGVlZCB0byBnZXQgYSBuZXcgVGFyZ2V0Q2hhbmdlIHRoYXQgc2V0cyBgY3VycmVudGAgYmFjayB0b1xuICAgICAgICAvLyB0cnVlIG9uY2UgdGhlIGNsaWVudCBpcyBiYWNrIG9ubGluZS5cbiAgICAgICAgdGhpcy5jdXJyZW50ID0gITEsIHRoaXMuYXBwbHlDaGFuZ2VzKHtcbiAgICAgICAgICAgIFF1OiB0aGlzLlF1LFxuICAgICAgICAgICAgenU6IG5ldyBDdSxcbiAgICAgICAgICAgIG11dGF0ZWRLZXlzOiB0aGlzLm11dGF0ZWRLZXlzLFxuICAgICAgICAgICAgaWk6ICExXG4gICAgICAgIH0sIFxuICAgICAgICAvKiB1cGRhdGVMaW1ib0RvY3VtZW50cz0gKi8gITEpKSA6IHtcbiAgICAgICAgICAgIFh1OiBbXVxuICAgICAgICB9O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHdoZXRoZXIgdGhlIGRvYyBmb3IgdGhlIGdpdmVuIGtleSBzaG91bGQgYmUgaW4gbGltYm8uXG4gICAgICovICAgIFp1KHQpIHtcbiAgICAgICAgLy8gSWYgdGhlIHJlbW90ZSBlbmQgc2F5cyBpdCdzIHBhcnQgb2YgdGhpcyBxdWVyeSwgaXQncyBub3QgaW4gbGltYm8uXG4gICAgICAgIHJldHVybiAhdGhpcy5VdS5oYXModCkgJiYgKFxuICAgICAgICAvLyBUaGUgbG9jYWwgc3RvcmUgZG9lc24ndCB0aGluayBpdCdzIGEgcmVzdWx0LCBzbyBpdCBzaG91bGRuJ3QgYmUgaW4gbGltYm8uXG4gICAgICAgICEhdGhpcy5RdS5oYXModCkgJiYgIXRoaXMuUXUuZ2V0KHQpLmhhc0xvY2FsTXV0YXRpb25zKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVXBkYXRlcyBzeW5jZWREb2N1bWVudHMsIGN1cnJlbnQsIGFuZCBsaW1ibyBkb2NzIGJhc2VkIG9uIHRoZSBnaXZlbiBjaGFuZ2UuXG4gICAgICogUmV0dXJucyB0aGUgbGlzdCBvZiBjaGFuZ2VzIHRvIHdoaWNoIGRvY3MgYXJlIGluIGxpbWJvLlxuICAgICAqLyAgICBKdSh0KSB7XG4gICAgICAgIHQgJiYgKHQuYWRkZWREb2N1bWVudHMuZm9yRWFjaCgodCA9PiB0aGlzLlV1ID0gdGhpcy5VdS5hZGQodCkpKSwgdC5tb2RpZmllZERvY3VtZW50cy5mb3JFYWNoKCh0ID0+IHt9KSksIFxuICAgICAgICB0LnJlbW92ZWREb2N1bWVudHMuZm9yRWFjaCgodCA9PiB0aGlzLlV1ID0gdGhpcy5VdS5kZWxldGUodCkpKSwgdGhpcy5jdXJyZW50ID0gdC5jdXJyZW50KTtcbiAgICB9XG4gICAgWXUoKSB7XG4gICAgICAgIC8vIFdlIGNhbiBvbmx5IGRldGVybWluZSBsaW1ibyBkb2N1bWVudHMgd2hlbiB3ZSdyZSBpbi1zeW5jIHdpdGggdGhlIHNlcnZlci5cbiAgICAgICAgaWYgKCF0aGlzLmN1cnJlbnQpIHJldHVybiBbXTtcbiAgICAgICAgLy8gVE9ETyhrbGltdCk6IERvIHRoaXMgaW5jcmVtZW50YWxseSBzbyB0aGF0IGl0J3Mgbm90IHF1YWRyYXRpYyB3aGVuXG4gICAgICAgIC8vIHVwZGF0aW5nIG1hbnkgZG9jdW1lbnRzLlxuICAgICAgICAgICAgICAgIGNvbnN0IHQgPSB0aGlzLkt1O1xuICAgICAgICB0aGlzLkt1ID0gWW4oKSwgdGhpcy5RdS5mb3JFYWNoKCh0ID0+IHtcbiAgICAgICAgICAgIHRoaXMuWnUodC5rZXkpICYmICh0aGlzLkt1ID0gdGhpcy5LdS5hZGQodC5rZXkpKTtcbiAgICAgICAgfSkpO1xuICAgICAgICAvLyBEaWZmIHRoZSBuZXcgbGltYm8gZG9jcyB3aXRoIHRoZSBvbGQgbGltYm8gZG9jcy5cbiAgICAgICAgY29uc3QgZSA9IFtdO1xuICAgICAgICByZXR1cm4gdC5mb3JFYWNoKCh0ID0+IHtcbiAgICAgICAgICAgIHRoaXMuS3UuaGFzKHQpIHx8IGUucHVzaChuZXcganUodCkpO1xuICAgICAgICB9KSksIHRoaXMuS3UuZm9yRWFjaCgobiA9PiB7XG4gICAgICAgICAgICB0LmhhcyhuKSB8fCBlLnB1c2gobmV3IFF1KG4pKTtcbiAgICAgICAgfSkpLCBlO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBVcGRhdGUgdGhlIGluLW1lbW9yeSBzdGF0ZSBvZiB0aGUgY3VycmVudCB2aWV3IHdpdGggdGhlIHN0YXRlIHJlYWQgZnJvbVxuICAgICAqIHBlcnNpc3RlbmNlLlxuICAgICAqXG4gICAgICogV2UgdXBkYXRlIHRoZSBxdWVyeSB2aWV3IHdoZW5ldmVyIGEgY2xpZW50J3MgcHJpbWFyeSBzdGF0dXMgY2hhbmdlczpcbiAgICAgKiAtIFdoZW4gYSBjbGllbnQgdHJhbnNpdGlvbnMgZnJvbSBwcmltYXJ5IHRvIHNlY29uZGFyeSwgaXQgY2FuIG1pc3NcbiAgICAgKiAgIExvY2FsU3RvcmFnZSB1cGRhdGVzIGFuZCBpdHMgcXVlcnkgdmlld3MgbWF5IHRlbXBvcmFyaWx5IG5vdCBiZVxuICAgICAqICAgc3luY2hyb25pemVkIHdpdGggdGhlIHN0YXRlIG9uIGRpc2suXG4gICAgICogLSBGb3Igc2Vjb25kYXJ5IHRvIHByaW1hcnkgdHJhbnNpdGlvbnMsIHRoZSBjbGllbnQgbmVlZHMgdG8gdXBkYXRlIHRoZSBsaXN0XG4gICAgICogICBvZiBgc3luY2VkRG9jdW1lbnRzYCBzaW5jZSBzZWNvbmRhcnkgY2xpZW50cyB1cGRhdGUgdGhlaXIgcXVlcnkgdmlld3NcbiAgICAgKiAgIGJhc2VkIHB1cmVseSBvbiBzeW50aGVzaXplZCBSZW1vdGVFdmVudHMuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gcXVlcnlSZXN1bHQuZG9jdW1lbnRzIC0gVGhlIGRvY3VtZW50cyB0aGF0IG1hdGNoIHRoZSBxdWVyeSBhY2NvcmRpbmdcbiAgICAgKiB0byB0aGUgTG9jYWxTdG9yZS5cbiAgICAgKiBAcGFyYW0gcXVlcnlSZXN1bHQucmVtb3RlS2V5cyAtIFRoZSBrZXlzIG9mIHRoZSBkb2N1bWVudHMgdGhhdCBtYXRjaCB0aGVcbiAgICAgKiBxdWVyeSBhY2NvcmRpbmcgdG8gdGhlIGJhY2tlbmQuXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyBUaGUgVmlld0NoYW5nZSB0aGF0IHJlc3VsdGVkIGZyb20gdGhpcyBzeW5jaHJvbml6YXRpb24uXG4gICAgICovXG4gICAgLy8gUE9SVElORyBOT1RFOiBNdWx0aS10YWIgb25seS5cbiAgICB0YSh0KSB7XG4gICAgICAgIHRoaXMuVXUgPSB0Ll9pLCB0aGlzLkt1ID0gWW4oKTtcbiAgICAgICAgY29uc3QgZSA9IHRoaXMuV3UodC5kb2N1bWVudHMpO1xuICAgICAgICByZXR1cm4gdGhpcy5hcHBseUNoYW5nZXMoZSwgLyp1cGRhdGVMaW1ib0RvY3VtZW50cz0qLyAhMCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgYSB2aWV3IHNuYXBzaG90IGFzIGlmIHRoaXMgcXVlcnkgd2FzIGp1c3QgbGlzdGVuZWQgdG8uIENvbnRhaW5zXG4gICAgICogYSBkb2N1bWVudCBhZGQgZm9yIGV2ZXJ5IGV4aXN0aW5nIGRvY3VtZW50IGFuZCB0aGUgYGZyb21DYWNoZWAgYW5kXG4gICAgICogYGhhc1BlbmRpbmdXcml0ZXNgIHN0YXR1cyBvZiB0aGUgYWxyZWFkeSBlc3RhYmxpc2hlZCB2aWV3LlxuICAgICAqL1xuICAgIC8vIFBPUlRJTkcgTk9URTogTXVsdGktdGFiIG9ubHkuXG4gICAgZWEoKSB7XG4gICAgICAgIHJldHVybiB4dS5mcm9tSW5pdGlhbERvY3VtZW50cyh0aGlzLnF1ZXJ5LCB0aGlzLlF1LCB0aGlzLm11dGF0ZWRLZXlzLCAwIC8qIExvY2FsICovID09PSB0aGlzLnF1KTtcbiAgICB9XG59XG5cbi8qKlxuICogUXVlcnlWaWV3IGNvbnRhaW5zIGFsbCBvZiB0aGUgZGF0YSB0aGF0IFN5bmNFbmdpbmUgbmVlZHMgdG8ga2VlcCB0cmFjayBvZiBmb3JcbiAqIGEgcGFydGljdWxhciBxdWVyeS5cbiAqL1xuY2xhc3MgenUge1xuICAgIGNvbnN0cnVjdG9yKFxuICAgIC8qKlxuICAgICAqIFRoZSBxdWVyeSBpdHNlbGYuXG4gICAgICovXG4gICAgdCwgXG4gICAgLyoqXG4gICAgICogVGhlIHRhcmdldCBudW1iZXIgY3JlYXRlZCBieSB0aGUgY2xpZW50IHRoYXQgaXMgdXNlZCBpbiB0aGUgd2F0Y2hcbiAgICAgKiBzdHJlYW0gdG8gaWRlbnRpZnkgdGhpcyBxdWVyeS5cbiAgICAgKi9cbiAgICBlLCBcbiAgICAvKipcbiAgICAgKiBUaGUgdmlldyBpcyByZXNwb25zaWJsZSBmb3IgY29tcHV0aW5nIHRoZSBmaW5hbCBtZXJnZWQgdHJ1dGggb2Ygd2hhdFxuICAgICAqIGRvY3MgYXJlIGluIHRoZSBxdWVyeS4gSXQgZ2V0cyBub3RpZmllZCBvZiBsb2NhbCBhbmQgcmVtb3RlIGNoYW5nZXMsXG4gICAgICogYW5kIGFwcGxpZXMgdGhlIHF1ZXJ5IGZpbHRlcnMgYW5kIGxpbWl0cyB0byBkZXRlcm1pbmUgdGhlIG1vc3QgY29ycmVjdFxuICAgICAqIHBvc3NpYmxlIHJlc3VsdHMuXG4gICAgICovXG4gICAgbikge1xuICAgICAgICB0aGlzLnF1ZXJ5ID0gdCwgdGhpcy50YXJnZXRJZCA9IGUsIHRoaXMudmlldyA9IG47XG4gICAgfVxufVxuXG4vKiogVHJhY2tzIGEgbGltYm8gcmVzb2x1dGlvbi4gKi8gY2xhc3MgSHUge1xuICAgIGNvbnN0cnVjdG9yKHQpIHtcbiAgICAgICAgdGhpcy5rZXkgPSB0LCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNldCB0byB0cnVlIG9uY2Ugd2UndmUgcmVjZWl2ZWQgYSBkb2N1bWVudC4gVGhpcyBpcyB1c2VkIGluXG4gICAgICAgICAqIGdldFJlbW90ZUtleXNGb3JUYXJnZXQoKSBhbmQgdWx0aW1hdGVseSB1c2VkIGJ5IFdhdGNoQ2hhbmdlQWdncmVnYXRvciB0b1xuICAgICAgICAgKiBkZWNpZGUgd2hldGhlciBpdCBuZWVkcyB0byBtYW51ZmFjdHVyZSBhIGRlbGV0ZSBldmVudCBmb3IgdGhlIHRhcmdldCBvbmNlXG4gICAgICAgICAqIHRoZSB0YXJnZXQgaXMgQ1VSUkVOVC5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMubmEgPSAhMTtcbiAgICB9XG59XG5cbi8qKlxuICogQW4gaW1wbGVtZW50YXRpb24gb2YgYFN5bmNFbmdpbmVgIGNvb3JkaW5hdGluZyB3aXRoIG90aGVyIHBhcnRzIG9mIFNESy5cbiAqXG4gKiBUaGUgcGFydHMgb2YgU3luY0VuZ2luZSB0aGF0IGFjdCBhcyBhIGNhbGxiYWNrIHRvIFJlbW90ZVN0b3JlIG5lZWQgdG8gYmVcbiAqIHJlZ2lzdGVyZWQgaW5kaXZpZHVhbGx5LiBUaGlzIGlzIGRvbmUgaW4gYHN5bmNFbmdpbmVXcml0ZSgpYCBhbmRcbiAqIGBzeW5jRW5naW5lTGlzdGVuKClgIChhcyB3ZWxsIGFzIGBhcHBseVByaW1hcnlTdGF0ZSgpYCkgYXMgdGhlc2UgbWV0aG9kc1xuICogc2VydmUgYXMgZW50cnkgcG9pbnRzIHRvIFJlbW90ZVN0b3JlJ3MgZnVuY3Rpb25hbGl0eS5cbiAqXG4gKiBOb3RlOiBzb21lIGZpZWxkIGRlZmluZWQgaW4gdGhpcyBjbGFzcyBtaWdodCBoYXZlIHB1YmxpYyBhY2Nlc3MgbGV2ZWwsIGJ1dFxuICogdGhlIGNsYXNzIGlzIG5vdCBleHBvcnRlZCBzbyB0aGV5IGFyZSBvbmx5IGFjY2Vzc2libGUgZnJvbSB0aGlzIG1vZHVsZS5cbiAqIFRoaXMgaXMgdXNlZnVsIHRvIGltcGxlbWVudCBvcHRpb25hbCBmZWF0dXJlcyAobGlrZSBidW5kbGVzKSBpbiBmcmVlXG4gKiBmdW5jdGlvbnMsIHN1Y2ggdGhhdCB0aGV5IGFyZSB0cmVlLXNoYWtlYWJsZS5cbiAqLyBjbGFzcyBKdSB7XG4gICAgY29uc3RydWN0b3IodCwgZSwgbiwgXG4gICAgLy8gUE9SVElORyBOT1RFOiBNYW5hZ2VzIHN0YXRlIHN5bmNocm9uaXphdGlvbiBpbiBtdWx0aS10YWIgZW52aXJvbm1lbnRzLlxuICAgIHMsIGksIHIpIHtcbiAgICAgICAgdGhpcy5sb2NhbFN0b3JlID0gdCwgdGhpcy5yZW1vdGVTdG9yZSA9IGUsIHRoaXMuZXZlbnRNYW5hZ2VyID0gbiwgdGhpcy5zaGFyZWRDbGllbnRTdGF0ZSA9IHMsIFxuICAgICAgICB0aGlzLmN1cnJlbnRVc2VyID0gaSwgdGhpcy5tYXhDb25jdXJyZW50TGltYm9SZXNvbHV0aW9ucyA9IHIsIHRoaXMuc2EgPSB7fSwgdGhpcy5pYSA9IG5ldyBLbigodCA9PiBYZSh0KSksIFllKSwgXG4gICAgICAgIHRoaXMucmEgPSBuZXcgTWFwLCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBrZXlzIG9mIGRvY3VtZW50cyB0aGF0IGFyZSBpbiBsaW1ibyBmb3Igd2hpY2ggd2UgaGF2ZW4ndCB5ZXQgc3RhcnRlZCBhXG4gICAgICAgICAqIGxpbWJvIHJlc29sdXRpb24gcXVlcnkuIFRoZSBzdHJpbmdzIGluIHRoaXMgc2V0IGFyZSB0aGUgcmVzdWx0IG9mIGNhbGxpbmdcbiAgICAgICAgICogYGtleS5wYXRoLmNhbm9uaWNhbFN0cmluZygpYCB3aGVyZSBga2V5YCBpcyBhIGBEb2N1bWVudEtleWAgb2JqZWN0LlxuICAgICAgICAgKlxuICAgICAgICAgKiBUaGUgYFNldGAgdHlwZSB3YXMgY2hvc2VuIGJlY2F1c2UgaXQgcHJvdmlkZXMgZWZmaWNpZW50IGxvb2t1cCBhbmQgcmVtb3ZhbFxuICAgICAgICAgKiBvZiBhcmJpdHJhcnkgZWxlbWVudHMgYW5kIGl0IGFsc28gbWFpbnRhaW5zIGluc2VydGlvbiBvcmRlciwgcHJvdmlkaW5nIHRoZVxuICAgICAgICAgKiBkZXNpcmVkIHF1ZXVlLWxpa2UgRklGTyBzZW1hbnRpY3MuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLm9hID0gbmV3IFNldCwgXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBLZWVwcyB0cmFjayBvZiB0aGUgdGFyZ2V0IElEIGZvciBlYWNoIGRvY3VtZW50IHRoYXQgaXMgaW4gbGltYm8gd2l0aCBhblxuICAgICAgICAgKiBhY3RpdmUgdGFyZ2V0LlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy51YSA9IG5ldyBmZSh4dC5jb21wYXJhdG9yKSwgXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBLZWVwcyB0cmFjayBvZiB0aGUgaW5mb3JtYXRpb24gYWJvdXQgYW4gYWN0aXZlIGxpbWJvIHJlc29sdXRpb24gZm9yIGVhY2hcbiAgICAgICAgICogYWN0aXZlIHRhcmdldCBJRCB0aGF0IHdhcyBzdGFydGVkIGZvciB0aGUgcHVycG9zZSBvZiBsaW1ibyByZXNvbHV0aW9uLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5hYSA9IG5ldyBNYXAsIHRoaXMuY2EgPSBuZXcgSW8sIFxuICAgICAgICAvKiogU3RvcmVzIHVzZXIgY29tcGxldGlvbiBoYW5kbGVycywgaW5kZXhlZCBieSBVc2VyIGFuZCBCYXRjaElkLiAqL1xuICAgICAgICB0aGlzLmhhID0ge30sIFxuICAgICAgICAvKiogU3RvcmVzIHVzZXIgY2FsbGJhY2tzIHdhaXRpbmcgZm9yIGFsbCBwZW5kaW5nIHdyaXRlcyB0byBiZSBhY2tub3dsZWRnZWQuICovXG4gICAgICAgIHRoaXMubGEgPSBuZXcgTWFwLCB0aGlzLmZhID0gYnIueW4oKSwgdGhpcy5vbmxpbmVTdGF0ZSA9IFwiVW5rbm93blwiIC8qIFVua25vd24gKi8gLCBcbiAgICAgICAgLy8gVGhlIHByaW1hcnkgc3RhdGUgaXMgc2V0IHRvIGB0cnVlYCBvciBgZmFsc2VgIGltbWVkaWF0ZWx5IGFmdGVyIEZpcmVzdG9yZVxuICAgICAgICAvLyBzdGFydHVwLiBJbiB0aGUgaW50ZXJpbSwgYSBjbGllbnQgc2hvdWxkIG9ubHkgYmUgY29uc2lkZXJlZCBwcmltYXJ5IGlmXG4gICAgICAgIC8vIGBpc1ByaW1hcnlgIGlzIHRydWUuXG4gICAgICAgIHRoaXMuZGEgPSB2b2lkIDA7XG4gICAgfVxuICAgIGdldCBpc1ByaW1hcnlDbGllbnQoKSB7XG4gICAgICAgIHJldHVybiAhMCA9PT0gdGhpcy5kYTtcbiAgICB9XG59XG5cbi8qKlxuICogSW5pdGlhdGVzIHRoZSBuZXcgbGlzdGVuLCByZXNvbHZlcyBwcm9taXNlIHdoZW4gbGlzdGVuIGVucXVldWVkIHRvIHRoZVxuICogc2VydmVyLiBBbGwgdGhlIHN1YnNlcXVlbnQgdmlldyBzbmFwc2hvdHMgb3IgZXJyb3JzIGFyZSBzZW50IHRvIHRoZVxuICogc3Vic2NyaWJlZCBoYW5kbGVycy4gUmV0dXJucyB0aGUgaW5pdGlhbCBzbmFwc2hvdC5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gWXUodCwgZSkge1xuICAgIGNvbnN0IG4gPSBQYSh0KTtcbiAgICBsZXQgcywgaTtcbiAgICBjb25zdCByID0gbi5pYS5nZXQoZSk7XG4gICAgaWYgKHIpIFxuICAgIC8vIFBPUlRJTkcgTk9URTogV2l0aCBNdWx0aS1UYWIgV2ViLCBpdCBpcyBwb3NzaWJsZSB0aGF0IGEgcXVlcnkgdmlld1xuICAgIC8vIGFscmVhZHkgZXhpc3RzIHdoZW4gRXZlbnRNYW5hZ2VyIGNhbGxzIHVzIGZvciB0aGUgZmlyc3QgdGltZS4gVGhpc1xuICAgIC8vIGhhcHBlbnMgd2hlbiB0aGUgcHJpbWFyeSB0YWIgaXMgYWxyZWFkeSBsaXN0ZW5pbmcgdG8gdGhpcyBxdWVyeSBvblxuICAgIC8vIGJlaGFsZiBvZiBhbm90aGVyIHRhYiBhbmQgdGhlIHVzZXIgb2YgdGhlIHByaW1hcnkgYWxzbyBzdGFydHMgbGlzdGVuaW5nXG4gICAgLy8gdG8gdGhlIHF1ZXJ5LiBFdmVudE1hbmFnZXIgd2lsbCBub3QgaGF2ZSBhbiBhc3NpZ25lZCB0YXJnZXQgSUQgaW4gdGhpc1xuICAgIC8vIGNhc2UgYW5kIGNhbGxzIGBsaXN0ZW5gIHRvIG9idGFpbiB0aGlzIElELlxuICAgIHMgPSByLnRhcmdldElkLCBuLnNoYXJlZENsaWVudFN0YXRlLmFkZExvY2FsUXVlcnlUYXJnZXQocyksIGkgPSByLnZpZXcuZWEoKTsgZWxzZSB7XG4gICAgICAgIGNvbnN0IHQgPSBhd2FpdCBjbyhuLmxvY2FsU3RvcmUsIEhlKGUpKTtcbiAgICAgICAgbi5pc1ByaW1hcnlDbGllbnQgJiYgbnUobi5yZW1vdGVTdG9yZSwgdCk7XG4gICAgICAgIGNvbnN0IHIgPSBuLnNoYXJlZENsaWVudFN0YXRlLmFkZExvY2FsUXVlcnlUYXJnZXQodC50YXJnZXRJZCk7XG4gICAgICAgIHMgPSB0LnRhcmdldElkLCBpID0gYXdhaXQgWHUobiwgZSwgcywgXCJjdXJyZW50XCIgPT09IHIpO1xuICAgIH1cbiAgICByZXR1cm4gaTtcbn1cblxuLyoqXG4gKiBSZWdpc3RlcnMgYSB2aWV3IGZvciBhIHByZXZpb3VzbHkgdW5rbm93biBxdWVyeSBhbmQgY29tcHV0ZXMgaXRzIGluaXRpYWxcbiAqIHNuYXBzaG90LlxuICovIGFzeW5jIGZ1bmN0aW9uIFh1KHQsIGUsIG4sIHMpIHtcbiAgICAvLyBQT1JUSU5HIE5PVEU6IE9uIFdlYiBvbmx5LCB3ZSBpbmplY3QgdGhlIGNvZGUgdGhhdCByZWdpc3RlcnMgbmV3IExpbWJvXG4gICAgLy8gdGFyZ2V0cyBiYXNlZCBvbiB2aWV3IGNoYW5nZXMuIFRoaXMgYWxsb3dzIHVzIHRvIG9ubHkgZGVwZW5kIG9uIExpbWJvXG4gICAgLy8gY2hhbmdlcyB3aGVuIHVzZXIgY29kZSBpbmNsdWRlcyBxdWVyaWVzLlxuICAgIHQuX2EgPSAoZSwgbiwgcykgPT4gYXN5bmMgZnVuY3Rpb24odCwgZSwgbiwgcykge1xuICAgICAgICBsZXQgaSA9IGUudmlldy5XdShuKTtcbiAgICAgICAgaS5paSAmJiAoXG4gICAgICAgIC8vIFRoZSBxdWVyeSBoYXMgYSBsaW1pdCBhbmQgc29tZSBkb2NzIHdlcmUgcmVtb3ZlZCwgc28gd2UgbmVlZFxuICAgICAgICAvLyB0byByZS1ydW4gdGhlIHF1ZXJ5IGFnYWluc3QgdGhlIGxvY2FsIHN0b3JlIHRvIG1ha2Ugc3VyZSB3ZVxuICAgICAgICAvLyBkaWRuJ3QgbG9zZSBhbnkgZ29vZCBkb2NzIHRoYXQgaGFkIGJlZW4gcGFzdCB0aGUgbGltaXQuXG4gICAgICAgIGkgPSBhd2FpdCBsbyh0LmxvY2FsU3RvcmUsIGUucXVlcnksIFxuICAgICAgICAvKiB1c2VQcmV2aW91c1Jlc3VsdHM9ICovICExKS50aGVuKCgoe2RvY3VtZW50czogdH0pID0+IGUudmlldy5XdSh0LCBpKSkpKTtcbiAgICAgICAgY29uc3QgciA9IHMgJiYgcy50YXJnZXRDaGFuZ2VzLmdldChlLnRhcmdldElkKSwgbyA9IGUudmlldy5hcHBseUNoYW5nZXMoaSwgXG4gICAgICAgIC8qIHVwZGF0ZUxpbWJvRG9jdW1lbnRzPSAqLyB0LmlzUHJpbWFyeUNsaWVudCwgcik7XG4gICAgICAgIHJldHVybiBsYSh0LCBlLnRhcmdldElkLCBvLlh1KSwgby5zbmFwc2hvdDtcbiAgICB9KHQsIGUsIG4sIHMpO1xuICAgIGNvbnN0IGkgPSBhd2FpdCBsbyh0LmxvY2FsU3RvcmUsIGUsIFxuICAgIC8qIHVzZVByZXZpb3VzUmVzdWx0cz0gKi8gITApLCByID0gbmV3IFd1KGUsIGkuX2kpLCBvID0gci5XdShpLmRvY3VtZW50cyksIHUgPSBlcy5jcmVhdGVTeW50aGVzaXplZFRhcmdldENoYW5nZUZvckN1cnJlbnRDaGFuZ2UobiwgcyAmJiBcIk9mZmxpbmVcIiAvKiBPZmZsaW5lICovICE9PSB0Lm9ubGluZVN0YXRlKSwgYSA9IHIuYXBwbHlDaGFuZ2VzKG8sIFxuICAgIC8qIHVwZGF0ZUxpbWJvRG9jdW1lbnRzPSAqLyB0LmlzUHJpbWFyeUNsaWVudCwgdSk7XG4gICAgbGEodCwgbiwgYS5YdSk7XG4gICAgY29uc3QgYyA9IG5ldyB6dShlLCBuLCByKTtcbiAgICByZXR1cm4gdC5pYS5zZXQoZSwgYyksIHQucmEuaGFzKG4pID8gdC5yYS5nZXQobikucHVzaChlKSA6IHQucmEuc2V0KG4sIFsgZSBdKSwgYS5zbmFwc2hvdDtcbn1cblxuLyoqIFN0b3BzIGxpc3RlbmluZyB0byB0aGUgcXVlcnkuICovIGFzeW5jIGZ1bmN0aW9uIFp1KHQsIGUpIHtcbiAgICBjb25zdCBuID0gSyh0KSwgcyA9IG4uaWEuZ2V0KGUpLCBpID0gbi5yYS5nZXQocy50YXJnZXRJZCk7XG4gICAgaWYgKGkubGVuZ3RoID4gMSkgcmV0dXJuIG4ucmEuc2V0KHMudGFyZ2V0SWQsIGkuZmlsdGVyKCh0ID0+ICFZZSh0LCBlKSkpKSwgdm9pZCBuLmlhLmRlbGV0ZShlKTtcbiAgICAvLyBObyBvdGhlciBxdWVyaWVzIGFyZSBtYXBwZWQgdG8gdGhlIHRhcmdldCwgY2xlYW4gdXAgdGhlIHF1ZXJ5IGFuZCB0aGUgdGFyZ2V0LlxuICAgICAgICBpZiAobi5pc1ByaW1hcnlDbGllbnQpIHtcbiAgICAgICAgLy8gV2UgbmVlZCB0byByZW1vdmUgdGhlIGxvY2FsIHF1ZXJ5IHRhcmdldCBmaXJzdCB0byBhbGxvdyB1cyB0byB2ZXJpZnlcbiAgICAgICAgLy8gd2hldGhlciBhbnkgb3RoZXIgY2xpZW50IGlzIHN0aWxsIGludGVyZXN0ZWQgaW4gdGhpcyB0YXJnZXQuXG4gICAgICAgIG4uc2hhcmVkQ2xpZW50U3RhdGUucmVtb3ZlTG9jYWxRdWVyeVRhcmdldChzLnRhcmdldElkKTtcbiAgICAgICAgbi5zaGFyZWRDbGllbnRTdGF0ZS5pc0FjdGl2ZVF1ZXJ5VGFyZ2V0KHMudGFyZ2V0SWQpIHx8IGF3YWl0IGhvKG4ubG9jYWxTdG9yZSwgcy50YXJnZXRJZCwgXG4gICAgICAgIC8qa2VlcFBlcnNpc3RlZFRhcmdldERhdGE9Ki8gITEpLnRoZW4oKCgpID0+IHtcbiAgICAgICAgICAgIG4uc2hhcmVkQ2xpZW50U3RhdGUuY2xlYXJRdWVyeVN0YXRlKHMudGFyZ2V0SWQpLCBzdShuLnJlbW90ZVN0b3JlLCBzLnRhcmdldElkKSwgXG4gICAgICAgICAgICBjYShuLCBzLnRhcmdldElkKTtcbiAgICAgICAgfSkpLmNhdGNoKERyKTtcbiAgICB9IGVsc2UgY2Eobiwgcy50YXJnZXRJZCksIGF3YWl0IGhvKG4ubG9jYWxTdG9yZSwgcy50YXJnZXRJZCwgXG4gICAgLyprZWVwUGVyc2lzdGVkVGFyZ2V0RGF0YT0qLyAhMCk7XG59XG5cbi8qKlxuICogSW5pdGlhdGVzIHRoZSB3cml0ZSBvZiBsb2NhbCBtdXRhdGlvbiBiYXRjaCB3aGljaCBpbnZvbHZlcyBhZGRpbmcgdGhlXG4gKiB3cml0ZXMgdG8gdGhlIG11dGF0aW9uIHF1ZXVlLCBub3RpZnlpbmcgdGhlIHJlbW90ZSBzdG9yZSBhYm91dCBuZXdcbiAqIG11dGF0aW9ucyBhbmQgcmFpc2luZyBldmVudHMgZm9yIGFueSBjaGFuZ2VzIHRoaXMgd3JpdGUgY2F1c2VkLlxuICpcbiAqIFRoZSBwcm9taXNlIHJldHVybmVkIGJ5IHRoaXMgY2FsbCBpcyByZXNvbHZlZCB3aGVuIHRoZSBhYm92ZSBzdGVwc1xuICogaGF2ZSBjb21wbGV0ZWQsICpub3QqIHdoZW4gdGhlIHdyaXRlIHdhcyBhY2tlZCBieSB0aGUgYmFja2VuZC4gVGhlXG4gKiB1c2VyQ2FsbGJhY2sgaXMgcmVzb2x2ZWQgb25jZSB0aGUgd3JpdGUgd2FzIGFja2VkL3JlamVjdGVkIGJ5IHRoZVxuICogYmFja2VuZCAob3IgZmFpbGVkIGxvY2FsbHkgZm9yIGFueSBvdGhlciByZWFzb24pLlxuICovIGFzeW5jIGZ1bmN0aW9uIHRhKHQsIGUsIG4pIHtcbiAgICBjb25zdCBzID0gVmEodCk7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgdCA9IGF3YWl0IGZ1bmN0aW9uKHQsIGUpIHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSBLKHQpLCBzID0gYXQubm93KCksIGkgPSBlLnJlZHVjZSgoKHQsIGUpID0+IHQuYWRkKGUua2V5KSksIFluKCkpO1xuICAgICAgICAgICAgbGV0IHI7XG4gICAgICAgICAgICByZXR1cm4gbi5wZXJzaXN0ZW5jZS5ydW5UcmFuc2FjdGlvbihcIkxvY2FsbHkgd3JpdGUgbXV0YXRpb25zXCIsIFwicmVhZHdyaXRlXCIsICh0ID0+IG4uZmkuS3ModCwgaSkubmV4dCgoaSA9PiB7XG4gICAgICAgICAgICAgICAgciA9IGk7XG4gICAgICAgICAgICAgICAgLy8gRm9yIG5vbi1pZGVtcG90ZW50IG11dGF0aW9ucyAoc3VjaCBhcyBgRmllbGRWYWx1ZS5pbmNyZW1lbnQoKWApLFxuICAgICAgICAgICAgICAgIC8vIHdlIHJlY29yZCB0aGUgYmFzZSBzdGF0ZSBpbiBhIHNlcGFyYXRlIHBhdGNoIG11dGF0aW9uLiBUaGlzIGlzXG4gICAgICAgICAgICAgICAgLy8gbGF0ZXIgdXNlZCB0byBndWFyYW50ZWUgY29uc2lzdGVudCB2YWx1ZXMgYW5kIHByZXZlbnRzIGZsaWNrZXJcbiAgICAgICAgICAgICAgICAvLyBldmVuIGlmIHRoZSBiYWNrZW5kIHNlbmRzIHVzIGFuIHVwZGF0ZSB0aGF0IGFscmVhZHkgaW5jbHVkZXMgb3VyXG4gICAgICAgICAgICAgICAgLy8gdHJhbnNmb3JtLlxuICAgICAgICAgICAgICAgIGNvbnN0IG8gPSBbXTtcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHQgb2YgZSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBlID0gdm4odCwgci5nZXQodC5rZXkpKTtcbiAgICAgICAgICAgICAgICAgICAgbnVsbCAhPSBlICYmIFxuICAgICAgICAgICAgICAgICAgICAvLyBOT1RFOiBUaGUgYmFzZSBzdGF0ZSBzaG91bGQgb25seSBiZSBhcHBsaWVkIGlmIHRoZXJlJ3Mgc29tZVxuICAgICAgICAgICAgICAgICAgICAvLyBleGlzdGluZyBkb2N1bWVudCB0byBvdmVycmlkZSwgc28gdXNlIGEgUHJlY29uZGl0aW9uIG9mXG4gICAgICAgICAgICAgICAgICAgIC8vIGV4aXN0cz10cnVlXG4gICAgICAgICAgICAgICAgICAgIG8ucHVzaChuZXcgeG4odC5rZXksIGUsIGVlKGUudmFsdWUubWFwVmFsdWUpLCBBbi5leGlzdHMoITApKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBuLkJzLmFkZE11dGF0aW9uQmF0Y2godCwgcywgbywgZSk7XG4gICAgICAgICAgICB9KSkpKS50aGVuKCh0ID0+ICh0LmFwcGx5VG9Mb2NhbERvY3VtZW50U2V0KHIpLCB7XG4gICAgICAgICAgICAgICAgYmF0Y2hJZDogdC5iYXRjaElkLFxuICAgICAgICAgICAgICAgIGNoYW5nZXM6IHJcbiAgICAgICAgICAgIH0pKSk7XG4gICAgICAgIH0ocy5sb2NhbFN0b3JlLCBlKTtcbiAgICAgICAgcy5zaGFyZWRDbGllbnRTdGF0ZS5hZGRQZW5kaW5nTXV0YXRpb24odC5iYXRjaElkKSwgZnVuY3Rpb24odCwgZSwgbikge1xuICAgICAgICAgICAgbGV0IHMgPSB0LmhhW3QuY3VycmVudFVzZXIudG9LZXkoKV07XG4gICAgICAgICAgICBzIHx8IChzID0gbmV3IGZlKHJ0KSk7XG4gICAgICAgICAgICBzID0gcy5pbnNlcnQoZSwgbiksIHQuaGFbdC5jdXJyZW50VXNlci50b0tleSgpXSA9IHM7XG4gICAgICAgIH1cbiAgICAgICAgLyoqXG4gKiBSZXNvbHZlcyBvciByZWplY3RzIHRoZSB1c2VyIGNhbGxiYWNrIGZvciB0aGUgZ2l2ZW4gYmF0Y2ggYW5kIHRoZW4gZGlzY2FyZHNcbiAqIGl0LlxuICovIChzLCB0LmJhdGNoSWQsIG4pLCBhd2FpdCBfYShzLCB0LmNoYW5nZXMpLCBhd2FpdCB3dShzLnJlbW90ZVN0b3JlKTtcbiAgICB9IGNhdGNoICh0KSB7XG4gICAgICAgIC8vIElmIHdlIGNhbid0IHBlcnNpc3QgdGhlIG11dGF0aW9uLCB3ZSByZWplY3QgdGhlIHVzZXIgY2FsbGJhY2sgYW5kXG4gICAgICAgIC8vIGRvbid0IHNlbmQgdGhlIG11dGF0aW9uLiBUaGUgdXNlciBjYW4gdGhlbiByZXRyeSB0aGUgd3JpdGUuXG4gICAgICAgIGNvbnN0IGUgPSBTdSh0LCBcIkZhaWxlZCB0byBwZXJzaXN0IHdyaXRlXCIpO1xuICAgICAgICBuLnJlamVjdChlKTtcbiAgICB9XG59XG5cbi8qKlxuICogQXBwbGllcyBvbmUgcmVtb3RlIGV2ZW50IHRvIHRoZSBzeW5jIGVuZ2luZSwgbm90aWZ5aW5nIGFueSB2aWV3cyBvZiB0aGVcbiAqIGNoYW5nZXMsIGFuZCByZWxlYXNpbmcgYW55IHBlbmRpbmcgbXV0YXRpb24gYmF0Y2hlcyB0aGF0IHdvdWxkIGJlY29tZVxuICogdmlzaWJsZSBiZWNhdXNlIG9mIHRoZSBzbmFwc2hvdCB2ZXJzaW9uIHRoZSByZW1vdGUgZXZlbnQgY29udGFpbnMuXG4gKi8gYXN5bmMgZnVuY3Rpb24gZWEodCwgZSkge1xuICAgIGNvbnN0IG4gPSBLKHQpO1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHQgPSBhd2FpdCBvbyhuLmxvY2FsU3RvcmUsIGUpO1xuICAgICAgICAvLyBVcGRhdGUgYHJlY2VpdmVkRG9jdW1lbnRgIGFzIGFwcHJvcHJpYXRlIGZvciBhbnkgbGltYm8gdGFyZ2V0cy5cbiAgICAgICAgICAgICAgICBlLnRhcmdldENoYW5nZXMuZm9yRWFjaCgoKHQsIGUpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHMgPSBuLmFhLmdldChlKTtcbiAgICAgICAgICAgIHMgJiYgKFxuICAgICAgICAgICAgLy8gU2luY2UgdGhpcyBpcyBhIGxpbWJvIHJlc29sdXRpb24gbG9va3VwLCBpdCdzIGZvciBhIHNpbmdsZSBkb2N1bWVudFxuICAgICAgICAgICAgLy8gYW5kIGl0IGNvdWxkIGJlIGFkZGVkLCBtb2RpZmllZCwgb3IgcmVtb3ZlZCwgYnV0IG5vdCBhIGNvbWJpbmF0aW9uLlxuICAgICAgICAgICAgVSh0LmFkZGVkRG9jdW1lbnRzLnNpemUgKyB0Lm1vZGlmaWVkRG9jdW1lbnRzLnNpemUgKyB0LnJlbW92ZWREb2N1bWVudHMuc2l6ZSA8PSAxKSwgXG4gICAgICAgICAgICB0LmFkZGVkRG9jdW1lbnRzLnNpemUgPiAwID8gcy5uYSA9ICEwIDogdC5tb2RpZmllZERvY3VtZW50cy5zaXplID4gMCA/IFUocy5uYSkgOiB0LnJlbW92ZWREb2N1bWVudHMuc2l6ZSA+IDAgJiYgKFUocy5uYSksIFxuICAgICAgICAgICAgcy5uYSA9ICExKSk7XG4gICAgICAgIH0pKSwgYXdhaXQgX2EobiwgdCwgZSk7XG4gICAgfSBjYXRjaCAodCkge1xuICAgICAgICBhd2FpdCBEcih0KTtcbiAgICB9XG59XG5cbi8qKlxuICogQXBwbGllcyBhbiBPbmxpbmVTdGF0ZSBjaGFuZ2UgdG8gdGhlIHN5bmMgZW5naW5lIGFuZCBub3RpZmllcyBhbnkgdmlld3Mgb2ZcbiAqIHRoZSBjaGFuZ2UuXG4gKi8gZnVuY3Rpb24gbmEodCwgZSwgbikge1xuICAgIGNvbnN0IHMgPSBLKHQpO1xuICAgIC8vIElmIHdlIGFyZSB0aGUgc2Vjb25kYXJ5IGNsaWVudCwgd2UgZXhwbGljaXRseSBpZ25vcmUgdGhlIHJlbW90ZSBzdG9yZSdzXG4gICAgLy8gb25saW5lIHN0YXRlICh0aGUgbG9jYWwgY2xpZW50IG1heSBnbyBvZmZsaW5lLCBldmVuIHRob3VnaCB0aGUgcHJpbWFyeVxuICAgIC8vIHRhYiByZW1haW5zIG9ubGluZSkgYW5kIG9ubHkgYXBwbHkgdGhlIHByaW1hcnkgdGFiJ3Mgb25saW5lIHN0YXRlIGZyb21cbiAgICAvLyBTaGFyZWRDbGllbnRTdGF0ZS5cbiAgICAgICAgaWYgKHMuaXNQcmltYXJ5Q2xpZW50ICYmIDAgLyogUmVtb3RlU3RvcmUgKi8gPT09IG4gfHwgIXMuaXNQcmltYXJ5Q2xpZW50ICYmIDEgLyogU2hhcmVkQ2xpZW50U3RhdGUgKi8gPT09IG4pIHtcbiAgICAgICAgY29uc3QgdCA9IFtdO1xuICAgICAgICBzLmlhLmZvckVhY2goKChuLCBzKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBpID0gcy52aWV3LlB1KGUpO1xuICAgICAgICAgICAgaS5zbmFwc2hvdCAmJiB0LnB1c2goaS5zbmFwc2hvdCk7XG4gICAgICAgIH0pKSwgZnVuY3Rpb24odCwgZSkge1xuICAgICAgICAgICAgY29uc3QgbiA9IEsodCk7XG4gICAgICAgICAgICBuLm9ubGluZVN0YXRlID0gZTtcbiAgICAgICAgICAgIGxldCBzID0gITE7XG4gICAgICAgICAgICBuLnF1ZXJpZXMuZm9yRWFjaCgoKHQsIG4pID0+IHtcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHQgb2Ygbi5saXN0ZW5lcnMpIFxuICAgICAgICAgICAgICAgIC8vIFJ1biBnbG9iYWwgc25hcHNob3QgbGlzdGVuZXJzIGlmIGEgY29uc2lzdGVudCBzbmFwc2hvdCBoYXMgYmVlbiBlbWl0dGVkLlxuICAgICAgICAgICAgICAgIHQuUHUoZSkgJiYgKHMgPSAhMCk7XG4gICAgICAgICAgICB9KSksIHMgJiYgQnUobik7XG4gICAgICAgIH0ocy5ldmVudE1hbmFnZXIsIGUpLCB0Lmxlbmd0aCAmJiBzLnNhLnpvKHQpLCBzLm9ubGluZVN0YXRlID0gZSwgcy5pc1ByaW1hcnlDbGllbnQgJiYgcy5zaGFyZWRDbGllbnRTdGF0ZS5zZXRPbmxpbmVTdGF0ZShlKTtcbiAgICB9XG59XG5cbi8qKlxuICogUmVqZWN0cyB0aGUgbGlzdGVuIGZvciB0aGUgZ2l2ZW4gdGFyZ2V0SUQuIFRoaXMgY2FuIGJlIHRyaWdnZXJlZCBieSB0aGVcbiAqIGJhY2tlbmQgZm9yIGFueSBhY3RpdmUgdGFyZ2V0LlxuICpcbiAqIEBwYXJhbSBzeW5jRW5naW5lIC0gVGhlIHN5bmMgZW5naW5lIGltcGxlbWVudGF0aW9uLlxuICogQHBhcmFtIHRhcmdldElkIC0gVGhlIHRhcmdldElEIGNvcnJlc3BvbmRzIHRvIG9uZSBwcmV2aW91c2x5IGluaXRpYXRlZCBieSB0aGVcbiAqIHVzZXIgYXMgcGFydCBvZiBUYXJnZXREYXRhIHBhc3NlZCB0byBsaXN0ZW4oKSBvbiBSZW1vdGVTdG9yZS5cbiAqIEBwYXJhbSBlcnIgLSBBIGRlc2NyaXB0aW9uIG9mIHRoZSBjb25kaXRpb24gdGhhdCBoYXMgZm9yY2VkIHRoZSByZWplY3Rpb24uXG4gKiBOZWFybHkgYWx3YXlzIHRoaXMgd2lsbCBiZSBhbiBpbmRpY2F0aW9uIHRoYXQgdGhlIHVzZXIgaXMgbm8gbG9uZ2VyXG4gKiBhdXRob3JpemVkIHRvIHNlZSB0aGUgZGF0YSBtYXRjaGluZyB0aGUgdGFyZ2V0LlxuICovIGFzeW5jIGZ1bmN0aW9uIHNhKHQsIGUsIG4pIHtcbiAgICBjb25zdCBzID0gSyh0KTtcbiAgICAvLyBQT1JUSU5HIE5PVEU6IE11bHRpLXRhYiBvbmx5LlxuICAgICAgICBzLnNoYXJlZENsaWVudFN0YXRlLnVwZGF0ZVF1ZXJ5U3RhdGUoZSwgXCJyZWplY3RlZFwiLCBuKTtcbiAgICBjb25zdCBpID0gcy5hYS5nZXQoZSksIHIgPSBpICYmIGkua2V5O1xuICAgIGlmIChyKSB7XG4gICAgICAgIC8vIFRPRE8oa2xpbXQpOiBXZSByZWFsbHkgb25seSBzaG91bGQgZG8gdGhlIGZvbGxvd2luZyBvbiBwZXJtaXNzaW9uXG4gICAgICAgIC8vIGRlbmllZCBlcnJvcnMsIGJ1dCB3ZSBkb24ndCBoYXZlIHRoZSBjYXVzZSBjb2RlIGhlcmUuXG4gICAgICAgIC8vIEl0J3MgYSBsaW1ibyBkb2MuIENyZWF0ZSBhIHN5bnRoZXRpYyBldmVudCBzYXlpbmcgaXQgd2FzIGRlbGV0ZWQuXG4gICAgICAgIC8vIFRoaXMgaXMga2luZCBvZiBhIGhhY2suIElkZWFsbHksIHdlIHdvdWxkIGhhdmUgYSBtZXRob2QgaW4gdGhlIGxvY2FsXG4gICAgICAgIC8vIHN0b3JlIHRvIHB1cmdlIGEgZG9jdW1lbnQuIEhvd2V2ZXIsIGl0IHdvdWxkIGJlIHRyaWNreSB0byBrZWVwIGFsbCBvZlxuICAgICAgICAvLyB0aGUgbG9jYWwgc3RvcmUncyBpbnZhcmlhbnRzIHdpdGggYW5vdGhlciBtZXRob2QuXG4gICAgICAgIGxldCB0ID0gbmV3IGZlKHh0LmNvbXBhcmF0b3IpO1xuICAgICAgICAvLyBUT0RPKGIvMjE3MTg5MjE2KTogVGhpcyBsaW1ibyBkb2N1bWVudCBzaG91bGQgaWRlYWxseSBoYXZlIGEgcmVhZCB0aW1lLFxuICAgICAgICAvLyBzbyB0aGF0IGl0IGlzIHBpY2tlZCB1cCBieSBhbnkgcmVhZC10aW1lIGJhc2VkIHNjYW5zLiBUaGUgYmFja2VuZCxcbiAgICAgICAgLy8gaG93ZXZlciwgZG9lcyBub3Qgc2VuZCBhIHJlYWQgdGltZSBmb3IgdGFyZ2V0IHJlbW92YWxzLlxuICAgICAgICAgICAgICAgIHQgPSB0Lmluc2VydChyLCBuZS5uZXdOb0RvY3VtZW50KHIsIGN0Lm1pbigpKSk7XG4gICAgICAgIGNvbnN0IG4gPSBZbigpLmFkZChyKSwgaSA9IG5ldyB0cyhjdC5taW4oKSwgXG4gICAgICAgIC8qIHRhcmdldENoYW5nZXM9ICovIG5ldyBNYXAsIFxuICAgICAgICAvKiB0YXJnZXRNaXNtYXRjaGVzPSAqLyBuZXcgd2UocnQpLCB0LCBuKTtcbiAgICAgICAgYXdhaXQgZWEocywgaSksIFxuICAgICAgICAvLyBTaW5jZSB0aGlzIHF1ZXJ5IGZhaWxlZCwgd2Ugd29uJ3Qgd2FudCB0byBtYW51YWxseSB1bmxpc3RlbiB0byBpdC5cbiAgICAgICAgLy8gV2Ugb25seSByZW1vdmUgaXQgZnJvbSBib29ra2VlcGluZyBhZnRlciB3ZSBzdWNjZXNzZnVsbHkgYXBwbGllZCB0aGVcbiAgICAgICAgLy8gUmVtb3RlRXZlbnQuIElmIGBhcHBseVJlbW90ZUV2ZW50KClgIHRocm93cywgd2Ugd2FudCB0byByZS1saXN0ZW4gdG9cbiAgICAgICAgLy8gdGhpcyBxdWVyeSB3aGVuIHRoZSBSZW1vdGVTdG9yZSByZXN0YXJ0cyB0aGUgV2F0Y2ggc3RyZWFtLCB3aGljaCBzaG91bGRcbiAgICAgICAgLy8gcmUtdHJpZ2dlciB0aGUgdGFyZ2V0IGZhaWx1cmUuXG4gICAgICAgIHMudWEgPSBzLnVhLnJlbW92ZShyKSwgcy5hYS5kZWxldGUoZSksIGRhKHMpO1xuICAgIH0gZWxzZSBhd2FpdCBobyhzLmxvY2FsU3RvcmUsIGUsIFxuICAgIC8qIGtlZXBQZXJzaXN0ZWRUYXJnZXREYXRhICovICExKS50aGVuKCgoKSA9PiBjYShzLCBlLCBuKSkpLmNhdGNoKERyKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gaWEodCwgZSkge1xuICAgIGNvbnN0IG4gPSBLKHQpLCBzID0gZS5iYXRjaC5iYXRjaElkO1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHQgPSBhd2FpdCBpbyhuLmxvY2FsU3RvcmUsIGUpO1xuICAgICAgICAvLyBUaGUgbG9jYWwgc3RvcmUgbWF5IG9yIG1heSBub3QgYmUgYWJsZSB0byBhcHBseSB0aGUgd3JpdGUgcmVzdWx0IGFuZFxuICAgICAgICAvLyByYWlzZSBldmVudHMgaW1tZWRpYXRlbHkgKGRlcGVuZGluZyBvbiB3aGV0aGVyIHRoZSB3YXRjaGVyIGlzIGNhdWdodFxuICAgICAgICAvLyB1cCksIHNvIHdlIHJhaXNlIHVzZXIgY2FsbGJhY2tzIGZpcnN0IHNvIHRoYXQgdGhleSBjb25zaXN0ZW50bHkgaGFwcGVuXG4gICAgICAgIC8vIGJlZm9yZSBsaXN0ZW4gZXZlbnRzLlxuICAgICAgICAgICAgICAgIGFhKG4sIHMsIC8qZXJyb3I9Ki8gbnVsbCksIHVhKG4sIHMpLCBuLnNoYXJlZENsaWVudFN0YXRlLnVwZGF0ZU11dGF0aW9uU3RhdGUocywgXCJhY2tub3dsZWRnZWRcIiksIFxuICAgICAgICBhd2FpdCBfYShuLCB0KTtcbiAgICB9IGNhdGNoICh0KSB7XG4gICAgICAgIGF3YWl0IERyKHQpO1xuICAgIH1cbn1cblxuYXN5bmMgZnVuY3Rpb24gcmEodCwgZSwgbikge1xuICAgIGNvbnN0IHMgPSBLKHQpO1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHQgPSBhd2FpdCBmdW5jdGlvbih0LCBlKSB7XG4gICAgICAgICAgICBjb25zdCBuID0gSyh0KTtcbiAgICAgICAgICAgIHJldHVybiBuLnBlcnNpc3RlbmNlLnJ1blRyYW5zYWN0aW9uKFwiUmVqZWN0IGJhdGNoXCIsIFwicmVhZHdyaXRlLXByaW1hcnlcIiwgKHQgPT4ge1xuICAgICAgICAgICAgICAgIGxldCBzO1xuICAgICAgICAgICAgICAgIHJldHVybiBuLkJzLmxvb2t1cE11dGF0aW9uQmF0Y2godCwgZSkubmV4dCgoZSA9PiAoVShudWxsICE9PSBlKSwgcyA9IGUua2V5cygpLCBuLkJzLnJlbW92ZU11dGF0aW9uQmF0Y2godCwgZSkpKSkubmV4dCgoKCkgPT4gbi5Ccy5wZXJmb3JtQ29uc2lzdGVuY3lDaGVjayh0KSkpLm5leHQoKCgpID0+IG4uZmkuS3ModCwgcykpKTtcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgfVxuICAgICAgICAvKipcbiAqIFJldHVybnMgdGhlIGxhcmdlc3QgKGxhdGVzdCkgYmF0Y2ggaWQgaW4gbXV0YXRpb24gcXVldWUgdGhhdCBpcyBwZW5kaW5nXG4gKiBzZXJ2ZXIgcmVzcG9uc2UuXG4gKlxuICogUmV0dXJucyBgQkFUQ0hJRF9VTktOT1dOYCBpZiB0aGUgcXVldWUgaXMgZW1wdHkuXG4gKi8gKHMubG9jYWxTdG9yZSwgZSk7XG4gICAgICAgIC8vIFRoZSBsb2NhbCBzdG9yZSBtYXkgb3IgbWF5IG5vdCBiZSBhYmxlIHRvIGFwcGx5IHRoZSB3cml0ZSByZXN1bHQgYW5kXG4gICAgICAgIC8vIHJhaXNlIGV2ZW50cyBpbW1lZGlhdGVseSAoZGVwZW5kaW5nIG9uIHdoZXRoZXIgdGhlIHdhdGNoZXIgaXMgY2F1Z2h0IHVwKSxcbiAgICAgICAgLy8gc28gd2UgcmFpc2UgdXNlciBjYWxsYmFja3MgZmlyc3Qgc28gdGhhdCB0aGV5IGNvbnNpc3RlbnRseSBoYXBwZW4gYmVmb3JlXG4gICAgICAgIC8vIGxpc3RlbiBldmVudHMuXG4gICAgICAgICAgICAgICAgYWEocywgZSwgbiksIHVhKHMsIGUpLCBzLnNoYXJlZENsaWVudFN0YXRlLnVwZGF0ZU11dGF0aW9uU3RhdGUoZSwgXCJyZWplY3RlZFwiLCBuKSwgXG4gICAgICAgIGF3YWl0IF9hKHMsIHQpO1xuICAgIH0gY2F0Y2ggKG4pIHtcbiAgICAgICAgYXdhaXQgRHIobik7XG4gICAgfVxufVxuXG4vKipcbiAqIFJlZ2lzdGVycyBhIHVzZXIgY2FsbGJhY2sgdGhhdCByZXNvbHZlcyB3aGVuIGFsbCBwZW5kaW5nIG11dGF0aW9ucyBhdCB0aGUgbW9tZW50IG9mIGNhbGxpbmdcbiAqIGFyZSBhY2tub3dsZWRnZWQgLlxuICovIGFzeW5jIGZ1bmN0aW9uIG9hKHQsIGUpIHtcbiAgICBjb25zdCBuID0gSyh0KTtcbiAgICBhdShuLnJlbW90ZVN0b3JlKSB8fCBPKFwiU3luY0VuZ2luZVwiLCBcIlRoZSBuZXR3b3JrIGlzIGRpc2FibGVkLiBUaGUgdGFzayByZXR1cm5lZCBieSAnYXdhaXRQZW5kaW5nV3JpdGVzKCknIHdpbGwgbm90IGNvbXBsZXRlIHVudGlsIHRoZSBuZXR3b3JrIGlzIGVuYWJsZWQuXCIpO1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHQgPSBhd2FpdCBmdW5jdGlvbih0KSB7XG4gICAgICAgICAgICBjb25zdCBlID0gSyh0KTtcbiAgICAgICAgICAgIHJldHVybiBlLnBlcnNpc3RlbmNlLnJ1blRyYW5zYWN0aW9uKFwiR2V0IGhpZ2hlc3QgdW5hY2tub3dsZWRnZWQgYmF0Y2ggaWRcIiwgXCJyZWFkb25seVwiLCAodCA9PiBlLkJzLmdldEhpZ2hlc3RVbmFja25vd2xlZGdlZEJhdGNoSWQodCkpKTtcbiAgICAgICAgfShuLmxvY2FsU3RvcmUpO1xuICAgICAgICBpZiAoLTEgPT09IHQpIFxuICAgICAgICAvLyBUcmlnZ2VyIHRoZSBjYWxsYmFjayByaWdodCBhd2F5IGlmIHRoZXJlIGlzIG5vIHBlbmRpbmcgd3JpdGVzIGF0IHRoZSBtb21lbnQuXG4gICAgICAgIHJldHVybiB2b2lkIGUucmVzb2x2ZSgpO1xuICAgICAgICBjb25zdCBzID0gbi5sYS5nZXQodCkgfHwgW107XG4gICAgICAgIHMucHVzaChlKSwgbi5sYS5zZXQodCwgcyk7XG4gICAgfSBjYXRjaCAodCkge1xuICAgICAgICBjb25zdCBuID0gU3UodCwgXCJJbml0aWFsaXphdGlvbiBvZiB3YWl0Rm9yUGVuZGluZ1dyaXRlcygpIG9wZXJhdGlvbiBmYWlsZWRcIik7XG4gICAgICAgIGUucmVqZWN0KG4pO1xuICAgIH1cbn1cblxuLyoqXG4gKiBUcmlnZ2VycyB0aGUgY2FsbGJhY2tzIHRoYXQgYXJlIHdhaXRpbmcgZm9yIHRoaXMgYmF0Y2ggaWQgdG8gZ2V0IGFja25vd2xlZGdlZCBieSBzZXJ2ZXIsXG4gKiBpZiB0aGVyZSBhcmUgYW55LlxuICovIGZ1bmN0aW9uIHVhKHQsIGUpIHtcbiAgICAodC5sYS5nZXQoZSkgfHwgW10pLmZvckVhY2goKHQgPT4ge1xuICAgICAgICB0LnJlc29sdmUoKTtcbiAgICB9KSksIHQubGEuZGVsZXRlKGUpO1xufVxuXG4vKiogUmVqZWN0IGFsbCBvdXRzdGFuZGluZyBjYWxsYmFja3Mgd2FpdGluZyBmb3IgcGVuZGluZyB3cml0ZXMgdG8gY29tcGxldGUuICovIGZ1bmN0aW9uIGFhKHQsIGUsIG4pIHtcbiAgICBjb25zdCBzID0gSyh0KTtcbiAgICBsZXQgaSA9IHMuaGFbcy5jdXJyZW50VXNlci50b0tleSgpXTtcbiAgICAvLyBOT1RFOiBNdXRhdGlvbnMgcmVzdG9yZWQgZnJvbSBwZXJzaXN0ZW5jZSB3b24ndCBoYXZlIGNhbGxiYWNrcywgc28gaXQnc1xuICAgIC8vIG9rYXkgZm9yIHRoZXJlIHRvIGJlIG5vIGNhbGxiYWNrIGZvciB0aGlzIElELlxuICAgICAgICBpZiAoaSkge1xuICAgICAgICBjb25zdCB0ID0gaS5nZXQoZSk7XG4gICAgICAgIHQgJiYgKG4gPyB0LnJlamVjdChuKSA6IHQucmVzb2x2ZSgpLCBpID0gaS5yZW1vdmUoZSkpLCBzLmhhW3MuY3VycmVudFVzZXIudG9LZXkoKV0gPSBpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gY2EodCwgZSwgbiA9IG51bGwpIHtcbiAgICB0LnNoYXJlZENsaWVudFN0YXRlLnJlbW92ZUxvY2FsUXVlcnlUYXJnZXQoZSk7XG4gICAgZm9yIChjb25zdCBzIG9mIHQucmEuZ2V0KGUpKSB0LmlhLmRlbGV0ZShzKSwgbiAmJiB0LnNhLndhKHMsIG4pO1xuICAgIGlmICh0LnJhLmRlbGV0ZShlKSwgdC5pc1ByaW1hcnlDbGllbnQpIHtcbiAgICAgICAgdC5jYS52aShlKS5mb3JFYWNoKChlID0+IHtcbiAgICAgICAgICAgIHQuY2EuY29udGFpbnNLZXkoZSkgfHwgXG4gICAgICAgICAgICAvLyBXZSByZW1vdmVkIHRoZSBsYXN0IHJlZmVyZW5jZSBmb3IgdGhpcyBrZXlcbiAgICAgICAgICAgIGhhKHQsIGUpO1xuICAgICAgICB9KSk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBoYSh0LCBlKSB7XG4gICAgdC5vYS5kZWxldGUoZS5wYXRoLmNhbm9uaWNhbFN0cmluZygpKTtcbiAgICAvLyBJdCdzIHBvc3NpYmxlIHRoYXQgdGhlIHRhcmdldCBhbHJlYWR5IGdvdCByZW1vdmVkIGJlY2F1c2UgdGhlIHF1ZXJ5IGZhaWxlZC4gSW4gdGhhdCBjYXNlLFxuICAgIC8vIHRoZSBrZXkgd29uJ3QgZXhpc3QgaW4gYGxpbWJvVGFyZ2V0c0J5S2V5YC4gT25seSBkbyB0aGUgY2xlYW51cCBpZiB3ZSBzdGlsbCBoYXZlIHRoZSB0YXJnZXQuXG4gICAgY29uc3QgbiA9IHQudWEuZ2V0KGUpO1xuICAgIG51bGwgIT09IG4gJiYgKHN1KHQucmVtb3RlU3RvcmUsIG4pLCB0LnVhID0gdC51YS5yZW1vdmUoZSksIHQuYWEuZGVsZXRlKG4pLCBkYSh0KSk7XG59XG5cbmZ1bmN0aW9uIGxhKHQsIGUsIG4pIHtcbiAgICBmb3IgKGNvbnN0IHMgb2YgbikgaWYgKHMgaW5zdGFuY2VvZiBRdSkgdC5jYS5hZGRSZWZlcmVuY2Uocy5rZXksIGUpLCBmYSh0LCBzKTsgZWxzZSBpZiAocyBpbnN0YW5jZW9mIGp1KSB7XG4gICAgICAgIE8oXCJTeW5jRW5naW5lXCIsIFwiRG9jdW1lbnQgbm8gbG9uZ2VyIGluIGxpbWJvOiBcIiArIHMua2V5KSwgdC5jYS5yZW1vdmVSZWZlcmVuY2Uocy5rZXksIGUpO1xuICAgICAgICB0LmNhLmNvbnRhaW5zS2V5KHMua2V5KSB8fCBcbiAgICAgICAgLy8gV2UgcmVtb3ZlZCB0aGUgbGFzdCByZWZlcmVuY2UgZm9yIHRoaXMga2V5XG4gICAgICAgIGhhKHQsIHMua2V5KTtcbiAgICB9IGVsc2UgTCgpO1xufVxuXG5mdW5jdGlvbiBmYSh0LCBlKSB7XG4gICAgY29uc3QgbiA9IGUua2V5LCBzID0gbi5wYXRoLmNhbm9uaWNhbFN0cmluZygpO1xuICAgIHQudWEuZ2V0KG4pIHx8IHQub2EuaGFzKHMpIHx8IChPKFwiU3luY0VuZ2luZVwiLCBcIk5ldyBkb2N1bWVudCBpbiBsaW1ibzogXCIgKyBuKSwgdC5vYS5hZGQocyksIFxuICAgIGRhKHQpKTtcbn1cblxuLyoqXG4gKiBTdGFydHMgbGlzdGVucyBmb3IgZG9jdW1lbnRzIGluIGxpbWJvIHRoYXQgYXJlIGVucXVldWVkIGZvciByZXNvbHV0aW9uLFxuICogc3ViamVjdCB0byBhIG1heGltdW0gbnVtYmVyIG9mIGNvbmN1cnJlbnQgcmVzb2x1dGlvbnMuXG4gKlxuICogV2l0aG91dCBib3VuZGluZyB0aGUgbnVtYmVyIG9mIGNvbmN1cnJlbnQgcmVzb2x1dGlvbnMsIHRoZSBzZXJ2ZXIgY2FuIGZhaWxcbiAqIHdpdGggXCJyZXNvdXJjZSBleGhhdXN0ZWRcIiBlcnJvcnMgd2hpY2ggY2FuIGxlYWQgdG8gcGF0aG9sb2dpY2FsIGNsaWVudFxuICogYmVoYXZpb3IgYXMgc2VlbiBpbiBodHRwczovL2dpdGh1Yi5jb20vZmlyZWJhc2UvZmlyZWJhc2UtanMtc2RrL2lzc3Vlcy8yNjgzLlxuICovIGZ1bmN0aW9uIGRhKHQpIHtcbiAgICBmb3IgKDt0Lm9hLnNpemUgPiAwICYmIHQudWEuc2l6ZSA8IHQubWF4Q29uY3VycmVudExpbWJvUmVzb2x1dGlvbnM7ICkge1xuICAgICAgICBjb25zdCBlID0gdC5vYS52YWx1ZXMoKS5uZXh0KCkudmFsdWU7XG4gICAgICAgIHQub2EuZGVsZXRlKGUpO1xuICAgICAgICBjb25zdCBuID0gbmV3IHh0KF90LmZyb21TdHJpbmcoZSkpLCBzID0gdC5mYS5uZXh0KCk7XG4gICAgICAgIHQuYWEuc2V0KHMsIG5ldyBIdShuKSksIHQudWEgPSB0LnVhLmluc2VydChuLCBzKSwgbnUodC5yZW1vdGVTdG9yZSwgbmV3IE5pKEhlKEtlKG4ucGF0aCkpLCBzLCAyIC8qIExpbWJvUmVzb2x1dGlvbiAqLyAsIG50LkEpKTtcbiAgICB9XG59XG5cbmFzeW5jIGZ1bmN0aW9uIF9hKHQsIGUsIG4pIHtcbiAgICBjb25zdCBzID0gSyh0KSwgaSA9IFtdLCByID0gW10sIG8gPSBbXTtcbiAgICBzLmlhLmlzRW1wdHkoKSB8fCAocy5pYS5mb3JFYWNoKCgodCwgdSkgPT4ge1xuICAgICAgICBvLnB1c2gocy5fYSh1LCBlLCBuKS50aGVuKCh0ID0+IHtcbiAgICAgICAgICAgIGlmICh0KSB7XG4gICAgICAgICAgICAgICAgcy5pc1ByaW1hcnlDbGllbnQgJiYgcy5zaGFyZWRDbGllbnRTdGF0ZS51cGRhdGVRdWVyeVN0YXRlKHUudGFyZ2V0SWQsIHQuZnJvbUNhY2hlID8gXCJub3QtY3VycmVudFwiIDogXCJjdXJyZW50XCIpLCBcbiAgICAgICAgICAgICAgICBpLnB1c2godCk7XG4gICAgICAgICAgICAgICAgY29uc3QgZSA9IFpyLllzKHUudGFyZ2V0SWQsIHQpO1xuICAgICAgICAgICAgICAgIHIucHVzaChlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkpKTtcbiAgICB9KSksIGF3YWl0IFByb21pc2UuYWxsKG8pLCBzLnNhLnpvKGkpLCBhd2FpdCBhc3luYyBmdW5jdGlvbih0LCBlKSB7XG4gICAgICAgIGNvbnN0IG4gPSBLKHQpO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgYXdhaXQgbi5wZXJzaXN0ZW5jZS5ydW5UcmFuc2FjdGlvbihcIm5vdGlmeUxvY2FsVmlld0NoYW5nZXNcIiwgXCJyZWFkd3JpdGVcIiwgKHQgPT4geWkuZm9yRWFjaChlLCAoZSA9PiB5aS5mb3JFYWNoKGUuSHMsIChzID0+IG4ucGVyc2lzdGVuY2UucmVmZXJlbmNlRGVsZWdhdGUuYWRkUmVmZXJlbmNlKHQsIGUudGFyZ2V0SWQsIHMpKSkubmV4dCgoKCkgPT4geWkuZm9yRWFjaChlLkpzLCAocyA9PiBuLnBlcnNpc3RlbmNlLnJlZmVyZW5jZURlbGVnYXRlLnJlbW92ZVJlZmVyZW5jZSh0LCBlLnRhcmdldElkLCBzKSkpKSkpKSkpO1xuICAgICAgICB9IGNhdGNoICh0KSB7XG4gICAgICAgICAgICBpZiAoIUFpKHQpKSB0aHJvdyB0O1xuICAgICAgICAgICAgLy8gSWYgYG5vdGlmeUxvY2FsVmlld0NoYW5nZXNgIGZhaWxzLCB3ZSBkaWQgbm90IGFkdmFuY2UgdGhlIHNlcXVlbmNlXG4gICAgICAgICAgICAvLyBudW1iZXIgZm9yIHRoZSBkb2N1bWVudHMgdGhhdCB3ZXJlIGluY2x1ZGVkIGluIHRoaXMgdHJhbnNhY3Rpb24uXG4gICAgICAgICAgICAvLyBUaGlzIG1pZ2h0IHRyaWdnZXIgdGhlbSB0byBiZSBkZWxldGVkIGVhcmxpZXIgdGhhbiB0aGV5IG90aGVyd2lzZVxuICAgICAgICAgICAgLy8gd291bGQgaGF2ZSwgYnV0IGl0IHNob3VsZCBub3QgaW52YWxpZGF0ZSB0aGUgaW50ZWdyaXR5IG9mIHRoZSBkYXRhLlxuICAgICAgICAgICAgTyhcIkxvY2FsU3RvcmVcIiwgXCJGYWlsZWQgdG8gdXBkYXRlIHNlcXVlbmNlIG51bWJlcnM6IFwiICsgdCk7XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChjb25zdCB0IG9mIGUpIHtcbiAgICAgICAgICAgIGNvbnN0IGUgPSB0LnRhcmdldElkO1xuICAgICAgICAgICAgaWYgKCF0LmZyb21DYWNoZSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHQgPSBuLnVpLmdldChlKSwgcyA9IHQuc25hcHNob3RWZXJzaW9uLCBpID0gdC53aXRoTGFzdExpbWJvRnJlZVNuYXBzaG90VmVyc2lvbihzKTtcbiAgICAgICAgICAgICAgICAvLyBBZHZhbmNlIHRoZSBsYXN0IGxpbWJvIGZyZWUgc25hcHNob3QgdmVyc2lvblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuLnVpID0gbi51aS5pbnNlcnQoZSwgaSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KHMubG9jYWxTdG9yZSwgcikpO1xufVxuXG5hc3luYyBmdW5jdGlvbiB3YSh0LCBlKSB7XG4gICAgY29uc3QgbiA9IEsodCk7XG4gICAgaWYgKCFuLmN1cnJlbnRVc2VyLmlzRXF1YWwoZSkpIHtcbiAgICAgICAgTyhcIlN5bmNFbmdpbmVcIiwgXCJVc2VyIGNoYW5nZS4gTmV3IHVzZXI6XCIsIGUudG9LZXkoKSk7XG4gICAgICAgIGNvbnN0IHQgPSBhd2FpdCBzbyhuLmxvY2FsU3RvcmUsIGUpO1xuICAgICAgICBuLmN1cnJlbnRVc2VyID0gZSwgXG4gICAgICAgIC8vIEZhaWxzIHRhc2tzIHdhaXRpbmcgZm9yIHBlbmRpbmcgd3JpdGVzIHJlcXVlc3RlZCBieSBwcmV2aW91cyB1c2VyLlxuICAgICAgICBmdW5jdGlvbih0LCBlKSB7XG4gICAgICAgICAgICB0LmxhLmZvckVhY2goKHQgPT4ge1xuICAgICAgICAgICAgICAgIHQuZm9yRWFjaCgodCA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHQucmVqZWN0KG5ldyBRKEcuQ0FOQ0VMTEVELCBlKSk7XG4gICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgfSkpLCB0LmxhLmNsZWFyKCk7XG4gICAgICAgIH0obiwgXCInd2FpdEZvclBlbmRpbmdXcml0ZXMnIHByb21pc2UgaXMgcmVqZWN0ZWQgZHVlIHRvIGEgdXNlciBjaGFuZ2UuXCIpLCBcbiAgICAgICAgLy8gVE9ETyhiLzExNDIyNjQxNyk6IENvbnNpZGVyIGNhbGxpbmcgdGhpcyBvbmx5IGluIHRoZSBwcmltYXJ5IHRhYi5cbiAgICAgICAgbi5zaGFyZWRDbGllbnRTdGF0ZS5oYW5kbGVVc2VyQ2hhbmdlKGUsIHQucmVtb3ZlZEJhdGNoSWRzLCB0LmFkZGVkQmF0Y2hJZHMpLCBhd2FpdCBfYShuLCB0LmRpKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIG1hKHQsIGUpIHtcbiAgICBjb25zdCBuID0gSyh0KSwgcyA9IG4uYWEuZ2V0KGUpO1xuICAgIGlmIChzICYmIHMubmEpIHJldHVybiBZbigpLmFkZChzLmtleSk7XG4gICAge1xuICAgICAgICBsZXQgdCA9IFluKCk7XG4gICAgICAgIGNvbnN0IHMgPSBuLnJhLmdldChlKTtcbiAgICAgICAgaWYgKCFzKSByZXR1cm4gdDtcbiAgICAgICAgZm9yIChjb25zdCBlIG9mIHMpIHtcbiAgICAgICAgICAgIGNvbnN0IHMgPSBuLmlhLmdldChlKTtcbiAgICAgICAgICAgIHQgPSB0LnVuaW9uV2l0aChzLnZpZXcuanUpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0O1xuICAgIH1cbn1cblxuLyoqXG4gKiBSZWNvbmNpbGUgdGhlIGxpc3Qgb2Ygc3luY2VkIGRvY3VtZW50cyBpbiBhbiBleGlzdGluZyB2aWV3IHdpdGggdGhvc2VcbiAqIGZyb20gcGVyc2lzdGVuY2UuXG4gKi8gYXN5bmMgZnVuY3Rpb24gZ2EodCwgZSkge1xuICAgIGNvbnN0IG4gPSBLKHQpLCBzID0gYXdhaXQgbG8obi5sb2NhbFN0b3JlLCBlLnF1ZXJ5LCBcbiAgICAvKiB1c2VQcmV2aW91c1Jlc3VsdHM9ICovICEwKSwgaSA9IGUudmlldy50YShzKTtcbiAgICByZXR1cm4gbi5pc1ByaW1hcnlDbGllbnQgJiYgbGEobiwgZS50YXJnZXRJZCwgaS5YdSksIGk7XG59XG5cbi8qKlxuICogUmV0cmlldmVzIG5ld2x5IGNoYW5nZWQgZG9jdW1lbnRzIGZyb20gcmVtb3RlIGRvY3VtZW50IGNhY2hlIGFuZCByYWlzZXNcbiAqIHNuYXBzaG90cyBpZiBuZWVkZWQuXG4gKi9cbi8vIFBPUlRJTkcgTk9URTogTXVsdGktVGFiIG9ubHkuXG5hc3luYyBmdW5jdGlvbiB5YSh0LCBlKSB7XG4gICAgY29uc3QgbiA9IEsodCk7XG4gICAgcmV0dXJuIF9vKG4ubG9jYWxTdG9yZSwgZSkudGhlbigodCA9PiBfYShuLCB0KSkpO1xufVxuXG4vKiogQXBwbGllcyBhIG11dGF0aW9uIHN0YXRlIHRvIGFuIGV4aXN0aW5nIGJhdGNoLiAgKi9cbi8vIFBPUlRJTkcgTk9URTogTXVsdGktVGFiIG9ubHkuXG5hc3luYyBmdW5jdGlvbiBwYSh0LCBlLCBuLCBzKSB7XG4gICAgY29uc3QgaSA9IEsodCksIHIgPSBhd2FpdCBmdW5jdGlvbih0LCBlKSB7XG4gICAgICAgIGNvbnN0IG4gPSBLKHQpLCBzID0gSyhuLkJzKTtcbiAgICAgICAgcmV0dXJuIG4ucGVyc2lzdGVuY2UucnVuVHJhbnNhY3Rpb24oXCJMb29rdXAgbXV0YXRpb24gZG9jdW1lbnRzXCIsIFwicmVhZG9ubHlcIiwgKHQgPT4gcy5mbih0LCBlKS5uZXh0KChlID0+IGUgPyBuLmZpLktzKHQsIGUpIDogeWkucmVzb2x2ZShudWxsKSkpKSk7XG4gICAgfVxuICAgIC8vIFBPUlRJTkcgTk9URTogTXVsdGktVGFiIG9ubHkuXG4gICAgKGkubG9jYWxTdG9yZSwgZSk7XG4gICAgbnVsbCAhPT0gciA/IChcInBlbmRpbmdcIiA9PT0gbiA/IFxuICAgIC8vIElmIHdlIGFyZSB0aGUgcHJpbWFyeSBjbGllbnQsIHdlIG5lZWQgdG8gc2VuZCB0aGlzIHdyaXRlIHRvIHRoZVxuICAgIC8vIGJhY2tlbmQuIFNlY29uZGFyeSBjbGllbnRzIHdpbGwgaWdub3JlIHRoZXNlIHdyaXRlcyBzaW5jZSB0aGVpciByZW1vdGVcbiAgICAvLyBjb25uZWN0aW9uIGlzIGRpc2FibGVkLlxuICAgIGF3YWl0IHd1KGkucmVtb3RlU3RvcmUpIDogXCJhY2tub3dsZWRnZWRcIiA9PT0gbiB8fCBcInJlamVjdGVkXCIgPT09IG4gPyAoXG4gICAgLy8gTk9URTogQm90aCB0aGVzZSBtZXRob2RzIGFyZSBuby1vcHMgZm9yIGJhdGNoZXMgdGhhdCBvcmlnaW5hdGVkIGZyb21cbiAgICAvLyBvdGhlciBjbGllbnRzLlxuICAgIGFhKGksIGUsIHMgfHwgbnVsbCksIHVhKGksIGUpLCBmdW5jdGlvbih0LCBlKSB7XG4gICAgICAgIEsoSyh0KS5CcykuX24oZSk7XG4gICAgfVxuICAgIC8vIFBPUlRJTkcgTk9URTogTXVsdGktVGFiIG9ubHkuXG4gICAgKGkubG9jYWxTdG9yZSwgZSkpIDogTCgpLCBhd2FpdCBfYShpLCByKSkgOiBcbiAgICAvLyBBIHRocm90dGxlZCB0YWIgbWF5IG5vdCBoYXZlIHNlZW4gdGhlIG11dGF0aW9uIGJlZm9yZSBpdCB3YXMgY29tcGxldGVkXG4gICAgLy8gYW5kIHJlbW92ZWQgZnJvbSB0aGUgbXV0YXRpb24gcXVldWUsIGluIHdoaWNoIGNhc2Ugd2Ugd29uJ3QgaGF2ZSBjYWNoZWRcbiAgICAvLyB0aGUgYWZmZWN0ZWQgZG9jdW1lbnRzLiBJbiB0aGlzIGNhc2Ugd2UgY2FuIHNhZmVseSBpZ25vcmUgdGhlIHVwZGF0ZVxuICAgIC8vIHNpbmNlIHRoYXQgbWVhbnMgd2UgZGlkbid0IGFwcGx5IHRoZSBtdXRhdGlvbiBsb2NhbGx5IGF0IGFsbCAoaWYgd2VcbiAgICAvLyBoYWQsIHdlIHdvdWxkIGhhdmUgY2FjaGVkIHRoZSBhZmZlY3RlZCBkb2N1bWVudHMpLCBhbmQgc28gd2Ugd2lsbCBqdXN0XG4gICAgLy8gc2VlIGFueSByZXN1bHRpbmcgZG9jdW1lbnQgY2hhbmdlcyB2aWEgbm9ybWFsIHJlbW90ZSBkb2N1bWVudCB1cGRhdGVzXG4gICAgLy8gYXMgYXBwbGljYWJsZS5cbiAgICBPKFwiU3luY0VuZ2luZVwiLCBcIkNhbm5vdCBhcHBseSBtdXRhdGlvbiBiYXRjaCB3aXRoIGlkOiBcIiArIGUpO1xufVxuXG4vKiogQXBwbGllcyBhIHF1ZXJ5IHRhcmdldCBjaGFuZ2UgZnJvbSBhIGRpZmZlcmVudCB0YWIuICovXG4vLyBQT1JUSU5HIE5PVEU6IE11bHRpLVRhYiBvbmx5LlxuYXN5bmMgZnVuY3Rpb24gSWEodCwgZSkge1xuICAgIGNvbnN0IG4gPSBLKHQpO1xuICAgIGlmIChQYShuKSwgVmEobiksICEwID09PSBlICYmICEwICE9PSBuLmRhKSB7XG4gICAgICAgIC8vIFNlY29uZGFyeSB0YWJzIG9ubHkgbWFpbnRhaW4gVmlld3MgZm9yIHRoZWlyIGxvY2FsIGxpc3RlbmVycyBhbmQgdGhlXG4gICAgICAgIC8vIFZpZXdzIGludGVybmFsIHN0YXRlIG1heSBub3QgYmUgMTAwJSBwb3B1bGF0ZWQgKGluIHBhcnRpY3VsYXJcbiAgICAgICAgLy8gc2Vjb25kYXJ5IHRhYnMgZG9uJ3QgdHJhY2sgc3luY2VkRG9jdW1lbnRzLCB0aGUgc2V0IG9mIGRvY3VtZW50cyB0aGVcbiAgICAgICAgLy8gc2VydmVyIGNvbnNpZGVycyB0byBiZSBpbiB0aGUgdGFyZ2V0KS4gU28gd2hlbiBhIHNlY29uZGFyeSBiZWNvbWVzXG4gICAgICAgIC8vIHByaW1hcnksIHdlIG5lZWQgdG8gbmVlZCB0byBtYWtlIHN1cmUgdGhhdCBhbGwgdmlld3MgZm9yIGFsbCB0YXJnZXRzXG4gICAgICAgIC8vIG1hdGNoIHRoZSBzdGF0ZSBvbiBkaXNrLlxuICAgICAgICBjb25zdCB0ID0gbi5zaGFyZWRDbGllbnRTdGF0ZS5nZXRBbGxBY3RpdmVRdWVyeVRhcmdldHMoKSwgZSA9IGF3YWl0IFRhKG4sIHQudG9BcnJheSgpKTtcbiAgICAgICAgbi5kYSA9ICEwLCBhd2FpdCBidShuLnJlbW90ZVN0b3JlLCAhMCk7XG4gICAgICAgIGZvciAoY29uc3QgdCBvZiBlKSBudShuLnJlbW90ZVN0b3JlLCB0KTtcbiAgICB9IGVsc2UgaWYgKCExID09PSBlICYmICExICE9PSBuLmRhKSB7XG4gICAgICAgIGNvbnN0IHQgPSBbXTtcbiAgICAgICAgbGV0IGUgPSBQcm9taXNlLnJlc29sdmUoKTtcbiAgICAgICAgbi5yYS5mb3JFYWNoKCgocywgaSkgPT4ge1xuICAgICAgICAgICAgbi5zaGFyZWRDbGllbnRTdGF0ZS5pc0xvY2FsUXVlcnlUYXJnZXQoaSkgPyB0LnB1c2goaSkgOiBlID0gZS50aGVuKCgoKSA9PiAoY2EobiwgaSksIFxuICAgICAgICAgICAgaG8obi5sb2NhbFN0b3JlLCBpLCBcbiAgICAgICAgICAgIC8qa2VlcFBlcnNpc3RlZFRhcmdldERhdGE9Ki8gITApKSkpLCBzdShuLnJlbW90ZVN0b3JlLCBpKTtcbiAgICAgICAgfSkpLCBhd2FpdCBlLCBhd2FpdCBUYShuLCB0KSwgXG4gICAgICAgIC8vIFBPUlRJTkcgTk9URTogTXVsdGktVGFiIG9ubHkuXG4gICAgICAgIGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgICAgIGNvbnN0IGUgPSBLKHQpO1xuICAgICAgICAgICAgZS5hYS5mb3JFYWNoKCgodCwgbikgPT4ge1xuICAgICAgICAgICAgICAgIHN1KGUucmVtb3RlU3RvcmUsIG4pO1xuICAgICAgICAgICAgfSkpLCBlLmNhLlNpKCksIGUuYWEgPSBuZXcgTWFwLCBlLnVhID0gbmV3IGZlKHh0LmNvbXBhcmF0b3IpO1xuICAgICAgICB9XG4gICAgICAgIC8qKlxuICogUmVjb25jaWxlIHRoZSBxdWVyeSB2aWV3cyBvZiB0aGUgcHJvdmlkZWQgcXVlcnkgdGFyZ2V0cyB3aXRoIHRoZSBzdGF0ZSBmcm9tXG4gKiBwZXJzaXN0ZW5jZS4gUmFpc2VzIHNuYXBzaG90cyBmb3IgYW55IGNoYW5nZXMgdGhhdCBhZmZlY3QgdGhlIGxvY2FsXG4gKiBjbGllbnQgYW5kIHJldHVybnMgdGhlIHVwZGF0ZWQgc3RhdGUgb2YgYWxsIHRhcmdldCdzIHF1ZXJ5IGRhdGEuXG4gKlxuICogQHBhcmFtIHN5bmNFbmdpbmUgLSBUaGUgc3luYyBlbmdpbmUgaW1wbGVtZW50YXRpb25cbiAqIEBwYXJhbSB0YXJnZXRzIC0gdGhlIGxpc3Qgb2YgdGFyZ2V0cyB3aXRoIHZpZXdzIHRoYXQgbmVlZCB0byBiZSByZWNvbXB1dGVkXG4gKiBAcGFyYW0gdHJhbnNpdGlvblRvUHJpbWFyeSAtIGB0cnVlYCBpZmYgdGhlIHRhYiB0cmFuc2l0aW9ucyBmcm9tIGEgc2Vjb25kYXJ5XG4gKiB0YWIgdG8gYSBwcmltYXJ5IHRhYlxuICovXG4gICAgICAgIC8vIFBPUlRJTkcgTk9URTogTXVsdGktVGFiIG9ubHkuXG4gICAgICAgIChuKSwgbi5kYSA9ICExLCBhd2FpdCBidShuLnJlbW90ZVN0b3JlLCAhMSk7XG4gICAgfVxufVxuXG5hc3luYyBmdW5jdGlvbiBUYSh0LCBlLCBuKSB7XG4gICAgY29uc3QgcyA9IEsodCksIGkgPSBbXSwgciA9IFtdO1xuICAgIGZvciAoY29uc3QgdCBvZiBlKSB7XG4gICAgICAgIGxldCBlO1xuICAgICAgICBjb25zdCBuID0gcy5yYS5nZXQodCk7XG4gICAgICAgIGlmIChuICYmIDAgIT09IG4ubGVuZ3RoKSB7XG4gICAgICAgICAgICAvLyBGb3IgcXVlcmllcyB0aGF0IGhhdmUgYSBsb2NhbCBWaWV3LCB3ZSBmZXRjaCB0aGVpciBjdXJyZW50IHN0YXRlXG4gICAgICAgICAgICAvLyBmcm9tIExvY2FsU3RvcmUgKGFzIHRoZSByZXN1bWUgdG9rZW4gYW5kIHRoZSBzbmFwc2hvdCB2ZXJzaW9uXG4gICAgICAgICAgICAvLyBtaWdodCBoYXZlIGNoYW5nZWQpIGFuZCByZWNvbmNpbGUgdGhlaXIgdmlld3Mgd2l0aCB0aGUgcGVyc2lzdGVkXG4gICAgICAgICAgICAvLyBzdGF0ZSAodGhlIGxpc3Qgb2Ygc3luY2VkRG9jdW1lbnRzIG1heSBoYXZlIGdvdHRlbiBvdXQgb2Ygc3luYykuXG4gICAgICAgICAgICBlID0gYXdhaXQgY28ocy5sb2NhbFN0b3JlLCBIZShuWzBdKSk7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IHQgb2Ygbikge1xuICAgICAgICAgICAgICAgIGNvbnN0IGUgPSBzLmlhLmdldCh0KSwgbiA9IGF3YWl0IGdhKHMsIGUpO1xuICAgICAgICAgICAgICAgIG4uc25hcHNob3QgJiYgci5wdXNoKG4uc25hcHNob3QpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gRm9yIHF1ZXJpZXMgdGhhdCBuZXZlciBleGVjdXRlZCBvbiB0aGlzIGNsaWVudCwgd2UgbmVlZCB0b1xuICAgICAgICAgICAgLy8gYWxsb2NhdGUgdGhlIHRhcmdldCBpbiBMb2NhbFN0b3JlIGFuZCBpbml0aWFsaXplIGEgbmV3IFZpZXcuXG4gICAgICAgICAgICBjb25zdCBuID0gYXdhaXQgZm8ocy5sb2NhbFN0b3JlLCB0KTtcbiAgICAgICAgICAgIGUgPSBhd2FpdCBjbyhzLmxvY2FsU3RvcmUsIG4pLCBhd2FpdCBYdShzLCBFYShuKSwgdCwgXG4gICAgICAgICAgICAvKmN1cnJlbnQ9Ki8gITEpO1xuICAgICAgICB9XG4gICAgICAgIGkucHVzaChlKTtcbiAgICB9XG4gICAgcmV0dXJuIHMuc2Euem8ociksIGk7XG59XG5cbi8qKlxuICogQ3JlYXRlcyBhIGBRdWVyeWAgb2JqZWN0IGZyb20gdGhlIHNwZWNpZmllZCBgVGFyZ2V0YC4gVGhlcmUgaXMgbm8gd2F5IHRvXG4gKiBvYnRhaW4gdGhlIG9yaWdpbmFsIGBRdWVyeWAsIHNvIHdlIHN5bnRoZXNpemUgYSBgUXVlcnlgIGZyb20gdGhlIGBUYXJnZXRgXG4gKiBvYmplY3QuXG4gKlxuICogVGhlIHN5bnRoZXNpemVkIHJlc3VsdCBtaWdodCBiZSBkaWZmZXJlbnQgZnJvbSB0aGUgb3JpZ2luYWwgYFF1ZXJ5YCwgYnV0XG4gKiBzaW5jZSB0aGUgc3ludGhlc2l6ZWQgYFF1ZXJ5YCBzaG91bGQgcmV0dXJuIHRoZSBzYW1lIHJlc3VsdHMgYXMgdGhlXG4gKiBvcmlnaW5hbCBvbmUgKG9ubHkgdGhlIHByZXNlbnRhdGlvbiBvZiByZXN1bHRzIG1pZ2h0IGRpZmZlciksIHRoZSBwb3RlbnRpYWxcbiAqIGRpZmZlcmVuY2Ugd2lsbCBub3QgY2F1c2UgaXNzdWVzLlxuICovXG4vLyBQT1JUSU5HIE5PVEU6IE11bHRpLVRhYiBvbmx5LlxuZnVuY3Rpb24gRWEodCkge1xuICAgIHJldHVybiBxZSh0LnBhdGgsIHQuY29sbGVjdGlvbkdyb3VwLCB0Lm9yZGVyQnksIHQuZmlsdGVycywgdC5saW1pdCwgXCJGXCIgLyogRmlyc3QgKi8gLCB0LnN0YXJ0QXQsIHQuZW5kQXQpO1xufVxuXG4vKiogUmV0dXJucyB0aGUgSURzIG9mIHRoZSBjbGllbnRzIHRoYXQgYXJlIGN1cnJlbnRseSBhY3RpdmUuICovXG4vLyBQT1JUSU5HIE5PVEU6IE11bHRpLVRhYiBvbmx5LlxuZnVuY3Rpb24gQWEodCkge1xuICAgIGNvbnN0IGUgPSBLKHQpO1xuICAgIHJldHVybiBLKEsoZS5sb2NhbFN0b3JlKS5wZXJzaXN0ZW5jZSkuRnMoKTtcbn1cblxuLyoqIEFwcGxpZXMgYSBxdWVyeSB0YXJnZXQgY2hhbmdlIGZyb20gYSBkaWZmZXJlbnQgdGFiLiAqL1xuLy8gUE9SVElORyBOT1RFOiBNdWx0aS1UYWIgb25seS5cbmFzeW5jIGZ1bmN0aW9uIFJhKHQsIGUsIG4sIHMpIHtcbiAgICBjb25zdCBpID0gSyh0KTtcbiAgICBpZiAoaS5kYSkgXG4gICAgLy8gSWYgd2UgcmVjZWl2ZSBhIHRhcmdldCBzdGF0ZSBub3RpZmljYXRpb24gdmlhIFdlYlN0b3JhZ2UsIHdlIGFyZVxuICAgIC8vIGVpdGhlciBhbHJlYWR5IHNlY29uZGFyeSBvciBhbm90aGVyIHRhYiBoYXMgdGFrZW4gdGhlIHByaW1hcnkgbGVhc2UuXG4gICAgcmV0dXJuIHZvaWQgTyhcIlN5bmNFbmdpbmVcIiwgXCJJZ25vcmluZyB1bmV4cGVjdGVkIHF1ZXJ5IHN0YXRlIG5vdGlmaWNhdGlvbi5cIik7XG4gICAgY29uc3QgciA9IGkucmEuZ2V0KGUpO1xuICAgIGlmIChyICYmIHIubGVuZ3RoID4gMCkgc3dpdGNoIChuKSB7XG4gICAgICBjYXNlIFwiY3VycmVudFwiOlxuICAgICAgY2FzZSBcIm5vdC1jdXJyZW50XCI6XG4gICAgICAgIHtcbiAgICAgICAgICAgIGNvbnN0IHQgPSBhd2FpdCBfbyhpLmxvY2FsU3RvcmUsIGVuKHJbMF0pKSwgcyA9IHRzLmNyZWF0ZVN5bnRoZXNpemVkUmVtb3RlRXZlbnRGb3JDdXJyZW50Q2hhbmdlKGUsIFwiY3VycmVudFwiID09PSBuKTtcbiAgICAgICAgICAgIGF3YWl0IF9hKGksIHQsIHMpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cblxuICAgICAgY2FzZSBcInJlamVjdGVkXCI6XG4gICAgICAgIGF3YWl0IGhvKGkubG9jYWxTdG9yZSwgZSwgXG4gICAgICAgIC8qIGtlZXBQZXJzaXN0ZWRUYXJnZXREYXRhICovICEwKSwgY2EoaSwgZSwgcyk7XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBkZWZhdWx0OlxuICAgICAgICBMKCk7XG4gICAgfVxufVxuXG4vKiogQWRkcyBvciByZW1vdmVzIFdhdGNoIHRhcmdldHMgZm9yIHF1ZXJpZXMgZnJvbSBkaWZmZXJlbnQgdGFicy4gKi8gYXN5bmMgZnVuY3Rpb24gYmEodCwgZSwgbikge1xuICAgIGNvbnN0IHMgPSBQYSh0KTtcbiAgICBpZiAocy5kYSkge1xuICAgICAgICBmb3IgKGNvbnN0IHQgb2YgZSkge1xuICAgICAgICAgICAgaWYgKHMucmEuaGFzKHQpKSB7XG4gICAgICAgICAgICAgICAgLy8gQSB0YXJnZXQgbWlnaHQgaGF2ZSBiZWVuIGFkZGVkIGluIGEgcHJldmlvdXMgYXR0ZW1wdFxuICAgICAgICAgICAgICAgIE8oXCJTeW5jRW5naW5lXCIsIFwiQWRkaW5nIGFuIGFscmVhZHkgYWN0aXZlIHRhcmdldCBcIiArIHQpO1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgZSA9IGF3YWl0IGZvKHMubG9jYWxTdG9yZSwgdCksIG4gPSBhd2FpdCBjbyhzLmxvY2FsU3RvcmUsIGUpO1xuICAgICAgICAgICAgYXdhaXQgWHUocywgRWEoZSksIG4udGFyZ2V0SWQsIFxuICAgICAgICAgICAgLypjdXJyZW50PSovICExKSwgbnUocy5yZW1vdGVTdG9yZSwgbik7XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChjb25zdCB0IG9mIG4pIFxuICAgICAgICAvLyBDaGVjayB0aGF0IHRoZSB0YXJnZXQgaXMgc3RpbGwgYWN0aXZlIHNpbmNlIHRoZSB0YXJnZXQgbWlnaHQgaGF2ZSBiZWVuXG4gICAgICAgIC8vIHJlbW92ZWQgaWYgaXQgaGFzIGJlZW4gcmVqZWN0ZWQgYnkgdGhlIGJhY2tlbmQuXG4gICAgICAgIHMucmEuaGFzKHQpICYmIFxuICAgICAgICAvLyBSZWxlYXNlIHF1ZXJpZXMgdGhhdCBhcmUgc3RpbGwgYWN0aXZlLlxuICAgICAgICBhd2FpdCBobyhzLmxvY2FsU3RvcmUsIHQsIFxuICAgICAgICAvKiBrZWVwUGVyc2lzdGVkVGFyZ2V0RGF0YSAqLyAhMSkudGhlbigoKCkgPT4ge1xuICAgICAgICAgICAgc3Uocy5yZW1vdGVTdG9yZSwgdCksIGNhKHMsIHQpO1xuICAgICAgICB9KSkuY2F0Y2goRHIpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gUGEodCkge1xuICAgIGNvbnN0IGUgPSBLKHQpO1xuICAgIHJldHVybiBlLnJlbW90ZVN0b3JlLnJlbW90ZVN5bmNlci5hcHBseVJlbW90ZUV2ZW50ID0gZWEuYmluZChudWxsLCBlKSwgZS5yZW1vdGVTdG9yZS5yZW1vdGVTeW5jZXIuZ2V0UmVtb3RlS2V5c0ZvclRhcmdldCA9IG1hLmJpbmQobnVsbCwgZSksIFxuICAgIGUucmVtb3RlU3RvcmUucmVtb3RlU3luY2VyLnJlamVjdExpc3RlbiA9IHNhLmJpbmQobnVsbCwgZSksIGUuc2Euem8gPSBGdS5iaW5kKG51bGwsIGUuZXZlbnRNYW5hZ2VyKSwgXG4gICAgZS5zYS53YSA9ICR1LmJpbmQobnVsbCwgZS5ldmVudE1hbmFnZXIpLCBlO1xufVxuXG5mdW5jdGlvbiBWYSh0KSB7XG4gICAgY29uc3QgZSA9IEsodCk7XG4gICAgcmV0dXJuIGUucmVtb3RlU3RvcmUucmVtb3RlU3luY2VyLmFwcGx5U3VjY2Vzc2Z1bFdyaXRlID0gaWEuYmluZChudWxsLCBlKSwgZS5yZW1vdGVTdG9yZS5yZW1vdGVTeW5jZXIucmVqZWN0RmFpbGVkV3JpdGUgPSByYS5iaW5kKG51bGwsIGUpLCBcbiAgICBlO1xufVxuXG4vKipcbiAqIExvYWRzIGEgRmlyZXN0b3JlIGJ1bmRsZSBpbnRvIHRoZSBTREsuIFRoZSByZXR1cm5lZCBwcm9taXNlIHJlc29sdmVzIHdoZW5cbiAqIHRoZSBidW5kbGUgZmluaXNoZWQgbG9hZGluZy5cbiAqXG4gKiBAcGFyYW0gc3luY0VuZ2luZSAtIFN5bmNFbmdpbmUgdG8gdXNlLlxuICogQHBhcmFtIGJ1bmRsZVJlYWRlciAtIEJ1bmRsZSB0byBsb2FkIGludG8gdGhlIFNESy5cbiAqIEBwYXJhbSB0YXNrIC0gTG9hZEJ1bmRsZVRhc2sgdXNlZCB0byB1cGRhdGUgdGhlIGxvYWRpbmcgcHJvZ3Jlc3MgdG8gcHVibGljIEFQSS5cbiAqLyBmdW5jdGlvbiB2YSh0LCBlLCBuKSB7XG4gICAgY29uc3QgcyA9IEsodCk7XG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1mbG9hdGluZy1wcm9taXNlc1xuICAgICAgICAoXG4gICAgLyoqIExvYWRzIGEgYnVuZGxlIGFuZCByZXR1cm5zIHRoZSBsaXN0IG9mIGFmZmVjdGVkIGNvbGxlY3Rpb24gZ3JvdXBzLiAqL1xuICAgIGFzeW5jIGZ1bmN0aW9uKHQsIGUsIG4pIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHMgPSBhd2FpdCBlLmdldE1ldGFkYXRhKCk7XG4gICAgICAgICAgICBpZiAoYXdhaXQgZnVuY3Rpb24odCwgZSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IG4gPSBLKHQpLCBzID0gd3MoZS5jcmVhdGVUaW1lKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gbi5wZXJzaXN0ZW5jZS5ydW5UcmFuc2FjdGlvbihcImhhc05ld2VyQnVuZGxlXCIsIFwicmVhZG9ubHlcIiwgKHQgPT4gbi5fcy5nZXRCdW5kbGVNZXRhZGF0YSh0LCBlLmlkKSkpLnRoZW4oKHQgPT4gISF0ICYmIHQuY3JlYXRlVGltZS5jb21wYXJlVG8ocykgPj0gMCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLyoqXG4gKiBTYXZlcyB0aGUgZ2l2ZW4gYEJ1bmRsZU1ldGFkYXRhYCB0byBsb2NhbCBwZXJzaXN0ZW5jZS5cbiAqLyAodC5sb2NhbFN0b3JlLCBzKSkgcmV0dXJuIGF3YWl0IGUuY2xvc2UoKSwgbi5fY29tcGxldGVXaXRoKGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICB0YXNrU3RhdGU6IFwiU3VjY2Vzc1wiLFxuICAgICAgICAgICAgICAgICAgICBkb2N1bWVudHNMb2FkZWQ6IHQudG90YWxEb2N1bWVudHMsXG4gICAgICAgICAgICAgICAgICAgIGJ5dGVzTG9hZGVkOiB0LnRvdGFsQnl0ZXMsXG4gICAgICAgICAgICAgICAgICAgIHRvdGFsRG9jdW1lbnRzOiB0LnRvdGFsRG9jdW1lbnRzLFxuICAgICAgICAgICAgICAgICAgICB0b3RhbEJ5dGVzOiB0LnRvdGFsQnl0ZXNcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfShzKSksIFByb21pc2UucmVzb2x2ZShuZXcgU2V0KTtcbiAgICAgICAgICAgIG4uX3VwZGF0ZVByb2dyZXNzKEd1KHMpKTtcbiAgICAgICAgICAgIGNvbnN0IGkgPSBuZXcgS3UocywgdC5sb2NhbFN0b3JlLCBlLk0pO1xuICAgICAgICAgICAgbGV0IHIgPSBhd2FpdCBlLm1hKCk7XG4gICAgICAgICAgICBmb3IgKDtyOyApIHtcbiAgICAgICAgICAgICAgICBjb25zdCB0ID0gYXdhaXQgaS5GdShyKTtcbiAgICAgICAgICAgICAgICB0ICYmIG4uX3VwZGF0ZVByb2dyZXNzKHQpLCByID0gYXdhaXQgZS5tYSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgbyA9IGF3YWl0IGkuY29tcGxldGUoKTtcbiAgICAgICAgICAgIHJldHVybiBhd2FpdCBfYSh0LCBvLkx1LCBcbiAgICAgICAgICAgIC8qIHJlbW90ZUV2ZW50ICovIHZvaWQgMCksIFxuICAgICAgICAgICAgLy8gU2F2ZSBtZXRhZGF0YSwgc28gbG9hZGluZyB0aGUgc2FtZSBidW5kbGUgd2lsbCBza2lwLlxuICAgICAgICAgICAgYXdhaXQgZnVuY3Rpb24odCwgZSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IG4gPSBLKHQpO1xuICAgICAgICAgICAgICAgIHJldHVybiBuLnBlcnNpc3RlbmNlLnJ1blRyYW5zYWN0aW9uKFwiU2F2ZSBidW5kbGVcIiwgXCJyZWFkd3JpdGVcIiwgKHQgPT4gbi5fcy5zYXZlQnVuZGxlTWV0YWRhdGEodCwgZSkpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8qKlxuICogUmV0dXJucyBhIHByb21pc2Ugb2YgYSBgTmFtZWRRdWVyeWAgYXNzb2NpYXRlZCB3aXRoIGdpdmVuIHF1ZXJ5IG5hbWUuIFByb21pc2VcbiAqIHJlc29sdmVzIHRvIHVuZGVmaW5lZCBpZiBubyBwZXJzaXN0ZWQgZGF0YSBjYW4gYmUgZm91bmQuXG4gKi8gKHQubG9jYWxTdG9yZSwgcyksIG4uX2NvbXBsZXRlV2l0aChvLnByb2dyZXNzKSwgUHJvbWlzZS5yZXNvbHZlKG8uQnUpO1xuICAgICAgICB9IGNhdGNoICh0KSB7XG4gICAgICAgICAgICByZXR1cm4gJChcIlN5bmNFbmdpbmVcIiwgYExvYWRpbmcgYnVuZGxlIGZhaWxlZCB3aXRoICR7dH1gKSwgbi5fZmFpbFdpdGgodCksIFByb21pc2UucmVzb2x2ZShuZXcgU2V0KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuICAgIC8qKlxuICogUHJvdmlkZXMgYWxsIGNvbXBvbmVudHMgbmVlZGVkIGZvciBGaXJlc3RvcmUgd2l0aCBpbi1tZW1vcnkgcGVyc2lzdGVuY2UuXG4gKiBVc2VzIEVhZ2VyR0MgZ2FyYmFnZSBjb2xsZWN0aW9uLlxuICovKShzLCBlLCBuKS50aGVuKCh0ID0+IHtcbiAgICAgICAgcy5zaGFyZWRDbGllbnRTdGF0ZS5ub3RpZnlCdW5kbGVMb2FkZWQodCk7XG4gICAgfSkpO1xufVxuXG5jbGFzcyBTYSB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMuc3luY2hyb25pemVUYWJzID0gITE7XG4gICAgfVxuICAgIGFzeW5jIGluaXRpYWxpemUodCkge1xuICAgICAgICB0aGlzLk0gPSBqbyh0LmRhdGFiYXNlSW5mby5kYXRhYmFzZUlkKSwgdGhpcy5zaGFyZWRDbGllbnRTdGF0ZSA9IHRoaXMuZ2EodCksIHRoaXMucGVyc2lzdGVuY2UgPSB0aGlzLnlhKHQpLCBcbiAgICAgICAgYXdhaXQgdGhpcy5wZXJzaXN0ZW5jZS5zdGFydCgpLCB0aGlzLmdjU2NoZWR1bGVyID0gdGhpcy5wYSh0KSwgdGhpcy5sb2NhbFN0b3JlID0gdGhpcy5JYSh0KTtcbiAgICB9XG4gICAgcGEodCkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgSWEodCkge1xuICAgICAgICByZXR1cm4gbm8odGhpcy5wZXJzaXN0ZW5jZSwgbmV3IHRvLCB0LmluaXRpYWxVc2VyLCB0aGlzLk0pO1xuICAgIH1cbiAgICB5YSh0KSB7XG4gICAgICAgIHJldHVybiBuZXcgUG8odm8uWWksIHRoaXMuTSk7XG4gICAgfVxuICAgIGdhKHQpIHtcbiAgICAgICAgcmV0dXJuIG5ldyAkbztcbiAgICB9XG4gICAgYXN5bmMgdGVybWluYXRlKCkge1xuICAgICAgICB0aGlzLmdjU2NoZWR1bGVyICYmIHRoaXMuZ2NTY2hlZHVsZXIuc3RvcCgpLCBhd2FpdCB0aGlzLnNoYXJlZENsaWVudFN0YXRlLnNodXRkb3duKCksIFxuICAgICAgICBhd2FpdCB0aGlzLnBlcnNpc3RlbmNlLnNodXRkb3duKCk7XG4gICAgfVxufVxuXG4vKipcbiAqIFByb3ZpZGVzIGFsbCBjb21wb25lbnRzIG5lZWRlZCBmb3IgRmlyZXN0b3JlIHdpdGggSW5kZXhlZERCIHBlcnNpc3RlbmNlLlxuICovIGNsYXNzIERhIGV4dGVuZHMgU2Ege1xuICAgIGNvbnN0cnVjdG9yKHQsIGUsIG4pIHtcbiAgICAgICAgc3VwZXIoKSwgdGhpcy5UYSA9IHQsIHRoaXMuY2FjaGVTaXplQnl0ZXMgPSBlLCB0aGlzLmZvcmNlT3duZXJzaGlwID0gbiwgdGhpcy5zeW5jaHJvbml6ZVRhYnMgPSAhMTtcbiAgICB9XG4gICAgYXN5bmMgaW5pdGlhbGl6ZSh0KSB7XG4gICAgICAgIGF3YWl0IHN1cGVyLmluaXRpYWxpemUodCksIGF3YWl0IHRoaXMuVGEuaW5pdGlhbGl6ZSh0aGlzLCB0KSwgXG4gICAgICAgIC8vIEVucXVldWUgd3JpdGVzIGZyb20gYSBwcmV2aW91cyBzZXNzaW9uXG4gICAgICAgIGF3YWl0IFZhKHRoaXMuVGEuc3luY0VuZ2luZSksIGF3YWl0IHd1KHRoaXMuVGEucmVtb3RlU3RvcmUpLCBcbiAgICAgICAgLy8gTk9URTogVGhpcyB3aWxsIGltbWVkaWF0ZWx5IGNhbGwgdGhlIGxpc3RlbmVyLCBzbyB3ZSBtYWtlIHN1cmUgdG9cbiAgICAgICAgLy8gc2V0IGl0IGFmdGVyIGxvY2FsU3RvcmUgLyByZW1vdGVTdG9yZSBhcmUgc3RhcnRlZC5cbiAgICAgICAgYXdhaXQgdGhpcy5wZXJzaXN0ZW5jZS5UcygoKCkgPT4gKHRoaXMuZ2NTY2hlZHVsZXIgJiYgIXRoaXMuZ2NTY2hlZHVsZXIuc3RhcnRlZCAmJiB0aGlzLmdjU2NoZWR1bGVyLnN0YXJ0KHRoaXMubG9jYWxTdG9yZSksIFxuICAgICAgICBQcm9taXNlLnJlc29sdmUoKSkpKTtcbiAgICB9XG4gICAgSWEodCkge1xuICAgICAgICByZXR1cm4gbm8odGhpcy5wZXJzaXN0ZW5jZSwgbmV3IHRvLCB0LmluaXRpYWxVc2VyLCB0aGlzLk0pO1xuICAgIH1cbiAgICBwYSh0KSB7XG4gICAgICAgIGNvbnN0IGUgPSB0aGlzLnBlcnNpc3RlbmNlLnJlZmVyZW5jZURlbGVnYXRlLmdhcmJhZ2VDb2xsZWN0b3I7XG4gICAgICAgIHJldHVybiBuZXcgTnIoZSwgdC5hc3luY1F1ZXVlKTtcbiAgICB9XG4gICAgeWEodCkge1xuICAgICAgICBjb25zdCBlID0gWXIodC5kYXRhYmFzZUluZm8uZGF0YWJhc2VJZCwgdC5kYXRhYmFzZUluZm8ucGVyc2lzdGVuY2VLZXkpLCBuID0gdm9pZCAwICE9PSB0aGlzLmNhY2hlU2l6ZUJ5dGVzID8gZ3Iud2l0aENhY2hlU2l6ZSh0aGlzLmNhY2hlU2l6ZUJ5dGVzKSA6IGdyLkRFRkFVTFQ7XG4gICAgICAgIHJldHVybiBuZXcgenIodGhpcy5zeW5jaHJvbml6ZVRhYnMsIGUsIHQuY2xpZW50SWQsIG4sIHQuYXN5bmNRdWV1ZSwgR28oKSwgUW8oKSwgdGhpcy5NLCB0aGlzLnNoYXJlZENsaWVudFN0YXRlLCAhIXRoaXMuZm9yY2VPd25lcnNoaXApO1xuICAgIH1cbiAgICBnYSh0KSB7XG4gICAgICAgIHJldHVybiBuZXcgJG87XG4gICAgfVxufVxuXG4vKipcbiAqIFByb3ZpZGVzIGFsbCBjb21wb25lbnRzIG5lZWRlZCBmb3IgRmlyZXN0b3JlIHdpdGggbXVsdGktdGFiIEluZGV4ZWREQlxuICogcGVyc2lzdGVuY2UuXG4gKlxuICogSW4gdGhlIGxlZ2FjeSBjbGllbnQsIHRoaXMgcHJvdmlkZXIgaXMgdXNlZCB0byBwcm92aWRlIGJvdGggbXVsdGktdGFiIGFuZFxuICogbm9uLW11bHRpLXRhYiBwZXJzaXN0ZW5jZSBzaW5jZSB3ZSBjYW5ub3QgdGVsbCBhdCBidWlsZCB0aW1lIHdoZXRoZXJcbiAqIGBzeW5jaHJvbml6ZVRhYnNgIHdpbGwgYmUgZW5hYmxlZC5cbiAqLyBjbGFzcyBDYSBleHRlbmRzIERhIHtcbiAgICBjb25zdHJ1Y3Rvcih0LCBlKSB7XG4gICAgICAgIHN1cGVyKHQsIGUsIC8qIGZvcmNlT3duZXJzaGlwPSAqLyAhMSksIHRoaXMuVGEgPSB0LCB0aGlzLmNhY2hlU2l6ZUJ5dGVzID0gZSwgdGhpcy5zeW5jaHJvbml6ZVRhYnMgPSAhMDtcbiAgICB9XG4gICAgYXN5bmMgaW5pdGlhbGl6ZSh0KSB7XG4gICAgICAgIGF3YWl0IHN1cGVyLmluaXRpYWxpemUodCk7XG4gICAgICAgIGNvbnN0IGUgPSB0aGlzLlRhLnN5bmNFbmdpbmU7XG4gICAgICAgIHRoaXMuc2hhcmVkQ2xpZW50U3RhdGUgaW5zdGFuY2VvZiBGbyAmJiAodGhpcy5zaGFyZWRDbGllbnRTdGF0ZS5zeW5jRW5naW5lID0ge1xuICAgICAgICAgICAgJHI6IHBhLmJpbmQobnVsbCwgZSksXG4gICAgICAgICAgICBCcjogUmEuYmluZChudWxsLCBlKSxcbiAgICAgICAgICAgIExyOiBiYS5iaW5kKG51bGwsIGUpLFxuICAgICAgICAgICAgRnM6IEFhLmJpbmQobnVsbCwgZSksXG4gICAgICAgICAgICBGcjogeWEuYmluZChudWxsLCBlKVxuICAgICAgICB9LCBhd2FpdCB0aGlzLnNoYXJlZENsaWVudFN0YXRlLnN0YXJ0KCkpLCBcbiAgICAgICAgLy8gTk9URTogVGhpcyB3aWxsIGltbWVkaWF0ZWx5IGNhbGwgdGhlIGxpc3RlbmVyLCBzbyB3ZSBtYWtlIHN1cmUgdG9cbiAgICAgICAgLy8gc2V0IGl0IGFmdGVyIGxvY2FsU3RvcmUgLyByZW1vdGVTdG9yZSBhcmUgc3RhcnRlZC5cbiAgICAgICAgYXdhaXQgdGhpcy5wZXJzaXN0ZW5jZS5UcygoYXN5bmMgdCA9PiB7XG4gICAgICAgICAgICBhd2FpdCBJYSh0aGlzLlRhLnN5bmNFbmdpbmUsIHQpLCB0aGlzLmdjU2NoZWR1bGVyICYmICh0ICYmICF0aGlzLmdjU2NoZWR1bGVyLnN0YXJ0ZWQgPyB0aGlzLmdjU2NoZWR1bGVyLnN0YXJ0KHRoaXMubG9jYWxTdG9yZSkgOiB0IHx8IHRoaXMuZ2NTY2hlZHVsZXIuc3RvcCgpKTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICBnYSh0KSB7XG4gICAgICAgIGNvbnN0IGUgPSBHbygpO1xuICAgICAgICBpZiAoIUZvLnZ0KGUpKSB0aHJvdyBuZXcgUShHLlVOSU1QTEVNRU5URUQsIFwiSW5kZXhlZERCIHBlcnNpc3RlbmNlIGlzIG9ubHkgYXZhaWxhYmxlIG9uIHBsYXRmb3JtcyB0aGF0IHN1cHBvcnQgTG9jYWxTdG9yYWdlLlwiKTtcbiAgICAgICAgY29uc3QgbiA9IFlyKHQuZGF0YWJhc2VJbmZvLmRhdGFiYXNlSWQsIHQuZGF0YWJhc2VJbmZvLnBlcnNpc3RlbmNlS2V5KTtcbiAgICAgICAgcmV0dXJuIG5ldyBGbyhlLCB0LmFzeW5jUXVldWUsIG4sIHQuY2xpZW50SWQsIHQuaW5pdGlhbFVzZXIpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBJbml0aWFsaXplcyBhbmQgd2lyZXMgdGhlIGNvbXBvbmVudHMgdGhhdCBhcmUgbmVlZGVkIHRvIGludGVyZmFjZSB3aXRoIHRoZVxuICogbmV0d29yay5cbiAqLyBjbGFzcyB4YSB7XG4gICAgYXN5bmMgaW5pdGlhbGl6ZSh0LCBlKSB7XG4gICAgICAgIHRoaXMubG9jYWxTdG9yZSB8fCAodGhpcy5sb2NhbFN0b3JlID0gdC5sb2NhbFN0b3JlLCB0aGlzLnNoYXJlZENsaWVudFN0YXRlID0gdC5zaGFyZWRDbGllbnRTdGF0ZSwgXG4gICAgICAgIHRoaXMuZGF0YXN0b3JlID0gdGhpcy5jcmVhdGVEYXRhc3RvcmUoZSksIHRoaXMucmVtb3RlU3RvcmUgPSB0aGlzLmNyZWF0ZVJlbW90ZVN0b3JlKGUpLCBcbiAgICAgICAgdGhpcy5ldmVudE1hbmFnZXIgPSB0aGlzLmNyZWF0ZUV2ZW50TWFuYWdlcihlKSwgdGhpcy5zeW5jRW5naW5lID0gdGhpcy5jcmVhdGVTeW5jRW5naW5lKGUsIFxuICAgICAgICAvKiBzdGFydEFzUHJpbWFyeT0qLyAhdC5zeW5jaHJvbml6ZVRhYnMpLCB0aGlzLnNoYXJlZENsaWVudFN0YXRlLm9ubGluZVN0YXRlSGFuZGxlciA9IHQgPT4gbmEodGhpcy5zeW5jRW5naW5lLCB0LCAxIC8qIFNoYXJlZENsaWVudFN0YXRlICovKSwgXG4gICAgICAgIHRoaXMucmVtb3RlU3RvcmUucmVtb3RlU3luY2VyLmhhbmRsZUNyZWRlbnRpYWxDaGFuZ2UgPSB3YS5iaW5kKG51bGwsIHRoaXMuc3luY0VuZ2luZSksIFxuICAgICAgICBhd2FpdCBidSh0aGlzLnJlbW90ZVN0b3JlLCB0aGlzLnN5bmNFbmdpbmUuaXNQcmltYXJ5Q2xpZW50KSk7XG4gICAgfVxuICAgIGNyZWF0ZUV2ZW50TWFuYWdlcih0KSB7XG4gICAgICAgIHJldHVybiBuZXcga3U7XG4gICAgfVxuICAgIGNyZWF0ZURhdGFzdG9yZSh0KSB7XG4gICAgICAgIGNvbnN0IGUgPSBqbyh0LmRhdGFiYXNlSW5mby5kYXRhYmFzZUlkKSwgbiA9IChzID0gdC5kYXRhYmFzZUluZm8sIG5ldyBLbyhzKSk7XG4gICAgICAgIHZhciBzO1xuICAgICAgICAvKiogUmV0dXJuIHRoZSBQbGF0Zm9ybS1zcGVjaWZpYyBjb25uZWN0aXZpdHkgbW9uaXRvci4gKi8gICAgICAgIHJldHVybiBmdW5jdGlvbih0LCBlLCBuLCBzKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IFlvKHQsIGUsIG4sIHMpO1xuICAgICAgICB9KHQuYXV0aENyZWRlbnRpYWxzLCB0LmFwcENoZWNrQ3JlZGVudGlhbHMsIG4sIGUpO1xuICAgIH1cbiAgICBjcmVhdGVSZW1vdGVTdG9yZSh0KSB7XG4gICAgICAgIHJldHVybiBlID0gdGhpcy5sb2NhbFN0b3JlLCBuID0gdGhpcy5kYXRhc3RvcmUsIHMgPSB0LmFzeW5jUXVldWUsIGkgPSB0ID0+IG5hKHRoaXMuc3luY0VuZ2luZSwgdCwgMCAvKiBSZW1vdGVTdG9yZSAqLyksIFxuICAgICAgICByID0gTG8udnQoKSA/IG5ldyBMbyA6IG5ldyBCbywgbmV3IFpvKGUsIG4sIHMsIGksIHIpO1xuICAgICAgICB2YXIgZSwgbiwgcywgaSwgcjtcbiAgICAgICAgLyoqIFJlLWVuYWJsZXMgdGhlIG5ldHdvcmsuIElkZW1wb3RlbnQuICovICAgIH1cbiAgICBjcmVhdGVTeW5jRW5naW5lKHQsIGUpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHQsIGUsIG4sIFxuICAgICAgICAvLyBQT1JUSU5HIE5PVEU6IE1hbmFnZXMgc3RhdGUgc3luY2hyb25pemF0aW9uIGluIG11bHRpLXRhYiBlbnZpcm9ubWVudHMuXG4gICAgICAgIHMsIGksIHIsIG8pIHtcbiAgICAgICAgICAgIGNvbnN0IHUgPSBuZXcgSnUodCwgZSwgbiwgcywgaSwgcik7XG4gICAgICAgICAgICByZXR1cm4gbyAmJiAodS5kYSA9ICEwKSwgdTtcbiAgICAgICAgfSh0aGlzLmxvY2FsU3RvcmUsIHRoaXMucmVtb3RlU3RvcmUsIHRoaXMuZXZlbnRNYW5hZ2VyLCB0aGlzLnNoYXJlZENsaWVudFN0YXRlLCB0LmluaXRpYWxVc2VyLCB0Lm1heENvbmN1cnJlbnRMaW1ib1Jlc29sdXRpb25zLCBlKTtcbiAgICB9XG4gICAgdGVybWluYXRlKCkge1xuICAgICAgICByZXR1cm4gYXN5bmMgZnVuY3Rpb24odCkge1xuICAgICAgICAgICAgY29uc3QgZSA9IEsodCk7XG4gICAgICAgICAgICBPKFwiUmVtb3RlU3RvcmVcIiwgXCJSZW1vdGVTdG9yZSBzaHV0dGluZyBkb3duLlwiKSwgZS53dS5hZGQoNSAvKiBTaHV0ZG93biAqLyksIGF3YWl0IGV1KGUpLCBcbiAgICAgICAgICAgIGUuZ3Uuc2h1dGRvd24oKSwgXG4gICAgICAgICAgICAvLyBTZXQgdGhlIE9ubGluZVN0YXRlIHRvIFVua25vd24gKHJhdGhlciB0aGFuIE9mZmxpbmUpIHRvIGF2b2lkIHBvdGVudGlhbGx5XG4gICAgICAgICAgICAvLyB0cmlnZ2VyaW5nIHNwdXJpb3VzIGxpc3RlbmVyIGV2ZW50cyB3aXRoIGNhY2hlZCBkYXRhLCBldGMuXG4gICAgICAgICAgICBlLnl1LnNldChcIlVua25vd25cIiAvKiBVbmtub3duICovKTtcbiAgICAgICAgfSh0aGlzLnJlbW90ZVN0b3JlKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEhvdyBtYW55IGJ5dGVzIHRvIHJlYWQgZWFjaCB0aW1lIHdoZW4gYFJlYWRhYmxlU3RyZWFtUmVhZGVyLnJlYWQoKWAgaXNcbiAqIGNhbGxlZC4gT25seSBhcHBsaWNhYmxlIGZvciBieXRlIHN0cmVhbXMgdGhhdCB3ZSBjb250cm9sIChlLmcuIHRob3NlIGJhY2tlZFxuICogYnkgYW4gVUludDhBcnJheSkuXG4gKi9cbi8qKlxuICogQnVpbGRzIGEgYEJ5dGVTdHJlYW1SZWFkZXJgIGZyb20gYSBVSW50OEFycmF5LlxuICogQHBhcmFtIHNvdXJjZSAtIFRoZSBkYXRhIHNvdXJjZSB0byB1c2UuXG4gKiBAcGFyYW0gYnl0ZXNQZXJSZWFkIC0gSG93IG1hbnkgYnl0ZXMgZWFjaCBgcmVhZCgpYCBmcm9tIHRoZSByZXR1cm5lZCByZWFkZXJcbiAqICAgICAgICB3aWxsIHJlYWQuXG4gKi9cbmZ1bmN0aW9uIE5hKHQsIGUgPSAxMDI0MCkge1xuICAgIGxldCBuID0gMDtcbiAgICAvLyBUaGUgVHlwZVNjcmlwdCBkZWZpbml0aW9uIGZvciBSZWFkYWJsZVN0cmVhbVJlYWRlciBjaGFuZ2VkLiBXZSB1c2VcbiAgICAvLyBgYW55YCBoZXJlIHRvIGFsbG93IHRoaXMgY29kZSB0byBjb21waWxlIHdpdGggZGlmZmVyZW50IHZlcnNpb25zLlxuICAgIC8vIFNlZSBodHRwczovL2dpdGh1Yi5jb20vbWljcm9zb2Z0L1R5cGVTY3JpcHQvaXNzdWVzLzQyOTcwXG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbiAgICAgICAgYXN5bmMgcmVhZCgpIHtcbiAgICAgICAgICAgIGlmIChuIDwgdC5ieXRlTGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcyA9IHtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHQuc2xpY2UobiwgbiArIGUpLFxuICAgICAgICAgICAgICAgICAgICBkb25lOiAhMVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgcmV0dXJuIG4gKz0gZSwgcztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgZG9uZTogITBcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0sXG4gICAgICAgIGFzeW5jIGNhbmNlbCgpIHt9LFxuICAgICAgICByZWxlYXNlTG9jaygpIHt9LFxuICAgICAgICBjbG9zZWQ6IFByb21pc2UucmVqZWN0KFwidW5pbXBsZW1lbnRlZFwiKVxuICAgIH07XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIE9uIHdlYiwgYSBgUmVhZGFibGVTdHJlYW1gIGlzIHdyYXBwZWQgYXJvdW5kIGJ5IGEgYEJ5dGVTdHJlYW1SZWFkZXJgLlxuICovXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLypcbiAqIEEgd3JhcHBlciBpbXBsZW1lbnRhdGlvbiBvZiBPYnNlcnZlcjxUPiB0aGF0IHdpbGwgZGlzcGF0Y2ggZXZlbnRzXG4gKiBhc3luY2hyb25vdXNseS4gVG8gYWxsb3cgaW1tZWRpYXRlIHNpbGVuY2luZywgYSBtdXRlIGNhbGwgaXMgYWRkZWQgd2hpY2hcbiAqIGNhdXNlcyBldmVudHMgc2NoZWR1bGVkIHRvIG5vIGxvbmdlciBiZSByYWlzZWQuXG4gKi9cbmNsYXNzIGthIHtcbiAgICBjb25zdHJ1Y3Rvcih0KSB7XG4gICAgICAgIHRoaXMub2JzZXJ2ZXIgPSB0LCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFdoZW4gc2V0IHRvIHRydWUsIHdpbGwgbm90IHJhaXNlIGZ1dHVyZSBldmVudHMuIE5lY2Vzc2FyeSB0byBkZWFsIHdpdGhcbiAgICAgICAgICogYXN5bmMgZGV0YWNobWVudCBvZiBsaXN0ZW5lci5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMubXV0ZWQgPSAhMTtcbiAgICB9XG4gICAgbmV4dCh0KSB7XG4gICAgICAgIHRoaXMub2JzZXJ2ZXIubmV4dCAmJiB0aGlzLkVhKHRoaXMub2JzZXJ2ZXIubmV4dCwgdCk7XG4gICAgfVxuICAgIGVycm9yKHQpIHtcbiAgICAgICAgdGhpcy5vYnNlcnZlci5lcnJvciA/IHRoaXMuRWEodGhpcy5vYnNlcnZlci5lcnJvciwgdCkgOiBjb25zb2xlLmVycm9yKFwiVW5jYXVnaHQgRXJyb3IgaW4gc25hcHNob3QgbGlzdGVuZXI6XCIsIHQpO1xuICAgIH1cbiAgICBBYSgpIHtcbiAgICAgICAgdGhpcy5tdXRlZCA9ICEwO1xuICAgIH1cbiAgICBFYSh0LCBlKSB7XG4gICAgICAgIHRoaXMubXV0ZWQgfHwgc2V0VGltZW91dCgoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5tdXRlZCB8fCB0KGUpO1xuICAgICAgICB9KSwgMCk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBBIGNsYXNzIHJlcHJlc2VudGluZyBhIGJ1bmRsZS5cbiAqXG4gKiBUYWtlcyBhIGJ1bmRsZSBzdHJlYW0gb3IgYnVmZmVyLCBhbmQgcHJlc2VudHMgYWJzdHJhY3Rpb25zIHRvIHJlYWQgYnVuZGxlZFxuICogZWxlbWVudHMgb3V0IG9mIHRoZSB1bmRlcmx5aW5nIGNvbnRlbnQuXG4gKi8gY2xhc3MgTWEge1xuICAgIGNvbnN0cnVjdG9yKFxuICAgIC8qKiBUaGUgcmVhZGVyIHRvIHJlYWQgZnJvbSB1bmRlcmx5aW5nIGJpbmFyeSBidW5kbGUgZGF0YSBzb3VyY2UuICovXG4gICAgdCwgZSkge1xuICAgICAgICB0aGlzLlJhID0gdCwgdGhpcy5NID0gZSwgXG4gICAgICAgIC8qKiBDYWNoZWQgYnVuZGxlIG1ldGFkYXRhLiAqL1xuICAgICAgICB0aGlzLm1ldGFkYXRhID0gbmV3IGosIFxuICAgICAgICAvKipcbiAgICAgICAgICogSW50ZXJuYWwgYnVmZmVyIHRvIGhvbGQgYnVuZGxlIGNvbnRlbnQsIGFjY3VtdWxhdGluZyBpbmNvbXBsZXRlIGVsZW1lbnRcbiAgICAgICAgICogY29udGVudC5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuYnVmZmVyID0gbmV3IFVpbnQ4QXJyYXksIHRoaXMuYmEgPSBuZXcgVGV4dERlY29kZXIoXCJ1dGYtOFwiKSwgXG4gICAgICAgIC8vIFJlYWQgdGhlIG1ldGFkYXRhICh3aGljaCBpcyB0aGUgZmlyc3QgZWxlbWVudCkuXG4gICAgICAgIHRoaXMuUGEoKS50aGVuKCh0ID0+IHtcbiAgICAgICAgICAgIHQgJiYgdC5NdSgpID8gdGhpcy5tZXRhZGF0YS5yZXNvbHZlKHQucGF5bG9hZC5tZXRhZGF0YSkgOiB0aGlzLm1ldGFkYXRhLnJlamVjdChuZXcgRXJyb3IoYFRoZSBmaXJzdCBlbGVtZW50IG9mIHRoZSBidW5kbGUgaXMgbm90IGEgbWV0YWRhdGEsIGl0IGlzXFxuICAgICAgICAgICAgICR7SlNPTi5zdHJpbmdpZnkobnVsbCA9PSB0ID8gdm9pZCAwIDogdC5wYXlsb2FkKX1gKSk7XG4gICAgICAgIH0pLCAodCA9PiB0aGlzLm1ldGFkYXRhLnJlamVjdCh0KSkpO1xuICAgIH1cbiAgICBjbG9zZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuUmEuY2FuY2VsKCk7XG4gICAgfVxuICAgIGFzeW5jIGdldE1ldGFkYXRhKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5tZXRhZGF0YS5wcm9taXNlO1xuICAgIH1cbiAgICBhc3luYyBtYSgpIHtcbiAgICAgICAgLy8gTWFrZXMgc3VyZSBtZXRhZGF0YSBpcyByZWFkIGJlZm9yZSBwcm9jZWVkaW5nLlxuICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5nZXRNZXRhZGF0YSgpLCB0aGlzLlBhKCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJlYWRzIGZyb20gdGhlIGhlYWQgb2YgaW50ZXJuYWwgYnVmZmVyLCBhbmQgcHVsbGluZyBtb3JlIGRhdGEgZnJvbVxuICAgICAqIHVuZGVybHlpbmcgc3RyZWFtIGlmIGEgY29tcGxldGUgZWxlbWVudCBjYW5ub3QgYmUgZm91bmQsIHVudGlsIGFuXG4gICAgICogZWxlbWVudChpbmNsdWRpbmcgdGhlIHByZWZpeGVkIGxlbmd0aCBhbmQgdGhlIEpTT04gc3RyaW5nKSBpcyBmb3VuZC5cbiAgICAgKlxuICAgICAqIE9uY2UgYSBjb21wbGV0ZSBlbGVtZW50IGlzIHJlYWQsIGl0IGlzIGRyb3BwZWQgZnJvbSBpbnRlcm5hbCBidWZmZXIuXG4gICAgICpcbiAgICAgKiBSZXR1cm5zIGVpdGhlciB0aGUgYnVuZGxlZCBlbGVtZW50LCBvciBudWxsIGlmIHdlIGhhdmUgcmVhY2hlZCB0aGUgZW5kIG9mXG4gICAgICogdGhlIHN0cmVhbS5cbiAgICAgKi8gICAgYXN5bmMgUGEoKSB7XG4gICAgICAgIGNvbnN0IHQgPSBhd2FpdCB0aGlzLlZhKCk7XG4gICAgICAgIGlmIChudWxsID09PSB0KSByZXR1cm4gbnVsbDtcbiAgICAgICAgY29uc3QgZSA9IHRoaXMuYmEuZGVjb2RlKHQpLCBuID0gTnVtYmVyKGUpO1xuICAgICAgICBpc05hTihuKSAmJiB0aGlzLnZhKGBsZW5ndGggc3RyaW5nICgke2V9KSBpcyBub3QgdmFsaWQgbnVtYmVyYCk7XG4gICAgICAgIGNvbnN0IHMgPSBhd2FpdCB0aGlzLlNhKG4pO1xuICAgICAgICByZXR1cm4gbmV3IFV1KEpTT04ucGFyc2UocyksIHQubGVuZ3RoICsgbik7XG4gICAgfVxuICAgIC8qKiBGaXJzdCBpbmRleCBvZiAneycgZnJvbSB0aGUgdW5kZXJseWluZyBidWZmZXIuICovICAgIERhKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5idWZmZXIuZmluZEluZGV4KCh0ID0+IHQgPT09IFwie1wiLmNoYXJDb2RlQXQoMCkpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmVhZHMgZnJvbSB0aGUgYmVnaW5uaW5nIG9mIHRoZSBpbnRlcm5hbCBidWZmZXIsIHVudGlsIHRoZSBmaXJzdCAneycsIGFuZFxuICAgICAqIHJldHVybiB0aGUgY29udGVudC5cbiAgICAgKlxuICAgICAqIElmIHJlYWNoZWQgZW5kIG9mIHRoZSBzdHJlYW0sIHJldHVybnMgYSBudWxsLlxuICAgICAqLyAgICBhc3luYyBWYSgpIHtcbiAgICAgICAgZm9yICg7dGhpcy5EYSgpIDwgMDsgKSB7XG4gICAgICAgICAgICBpZiAoYXdhaXQgdGhpcy5DYSgpKSBicmVhaztcbiAgICAgICAgfVxuICAgICAgICAvLyBCcm9rZSBvdXQgb2YgdGhlIGxvb3AgYmVjYXVzZSB1bmRlcmx5aW5nIHN0cmVhbSBpcyBjbG9zZWQsIGFuZCB0aGVyZVxuICAgICAgICAvLyBoYXBwZW5zIHRvIGJlIG5vIG1vcmUgZGF0YSB0byBwcm9jZXNzLlxuICAgICAgICAgICAgICAgIGlmICgwID09PSB0aGlzLmJ1ZmZlci5sZW5ndGgpIHJldHVybiBudWxsO1xuICAgICAgICBjb25zdCB0ID0gdGhpcy5EYSgpO1xuICAgICAgICAvLyBCcm9rZSBvdXQgb2YgdGhlIGxvb3AgYmVjYXVzZSB1bmRlcmx5aW5nIHN0cmVhbSBpcyBjbG9zZWQsIGJ1dCBzdGlsbFxuICAgICAgICAvLyBjYW5ub3QgZmluZCBhbiBvcGVuIGJyYWNrZXQuXG4gICAgICAgICAgICAgICAgdCA8IDAgJiYgdGhpcy52YShcIlJlYWNoZWQgdGhlIGVuZCBvZiBidW5kbGUgd2hlbiBhIGxlbmd0aCBzdHJpbmcgaXMgZXhwZWN0ZWQuXCIpO1xuICAgICAgICBjb25zdCBlID0gdGhpcy5idWZmZXIuc2xpY2UoMCwgdCk7XG4gICAgICAgIC8vIFVwZGF0ZSB0aGUgaW50ZXJuYWwgYnVmZmVyIHRvIGRyb3AgdGhlIHJlYWQgbGVuZ3RoLlxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmJ1ZmZlciA9IHRoaXMuYnVmZmVyLnNsaWNlKHQpLCBlO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZWFkcyBmcm9tIGEgc3BlY2lmaWVkIHBvc2l0aW9uIGZyb20gdGhlIGludGVybmFsIGJ1ZmZlciwgZm9yIGEgc3BlY2lmaWVkXG4gICAgICogbnVtYmVyIG9mIGJ5dGVzLCBwdWxsaW5nIG1vcmUgZGF0YSBmcm9tIHRoZSB1bmRlcmx5aW5nIHN0cmVhbSBpZiBuZWVkZWQuXG4gICAgICpcbiAgICAgKiBSZXR1cm5zIGEgc3RyaW5nIGRlY29kZWQgZnJvbSB0aGUgcmVhZCBieXRlcy5cbiAgICAgKi8gICAgYXN5bmMgU2EodCkge1xuICAgICAgICBmb3IgKDt0aGlzLmJ1ZmZlci5sZW5ndGggPCB0OyApIHtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuQ2EoKSAmJiB0aGlzLnZhKFwiUmVhY2hlZCB0aGUgZW5kIG9mIGJ1bmRsZSB3aGVuIG1vcmUgaXMgZXhwZWN0ZWQuXCIpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGUgPSB0aGlzLmJhLmRlY29kZSh0aGlzLmJ1ZmZlci5zbGljZSgwLCB0KSk7XG4gICAgICAgIC8vIFVwZGF0ZSB0aGUgaW50ZXJuYWwgYnVmZmVyIHRvIGRyb3AgdGhlIHJlYWQganNvbiBzdHJpbmcuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuYnVmZmVyID0gdGhpcy5idWZmZXIuc2xpY2UodCksIGU7XG4gICAgfVxuICAgIHZhKHQpIHtcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1mbG9hdGluZy1wcm9taXNlc1xuICAgICAgICB0aHJvdyB0aGlzLlJhLmNhbmNlbCgpLCBuZXcgRXJyb3IoYEludmFsaWQgYnVuZGxlIGZvcm1hdDogJHt0fWApO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBQdWxscyBtb3JlIGRhdGEgZnJvbSB1bmRlcmx5aW5nIHN0cmVhbSB0byBpbnRlcm5hbCBidWZmZXIuXG4gICAgICogUmV0dXJucyBhIGJvb2xlYW4gaW5kaWNhdGluZyB3aGV0aGVyIHRoZSBzdHJlYW0gaXMgZmluaXNoZWQuXG4gICAgICovICAgIGFzeW5jIENhKCkge1xuICAgICAgICBjb25zdCB0ID0gYXdhaXQgdGhpcy5SYS5yZWFkKCk7XG4gICAgICAgIGlmICghdC5kb25lKSB7XG4gICAgICAgICAgICBjb25zdCBlID0gbmV3IFVpbnQ4QXJyYXkodGhpcy5idWZmZXIubGVuZ3RoICsgdC52YWx1ZS5sZW5ndGgpO1xuICAgICAgICAgICAgZS5zZXQodGhpcy5idWZmZXIpLCBlLnNldCh0LnZhbHVlLCB0aGlzLmJ1ZmZlci5sZW5ndGgpLCB0aGlzLmJ1ZmZlciA9IGU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHQuZG9uZTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEludGVybmFsIHRyYW5zYWN0aW9uIG9iamVjdCByZXNwb25zaWJsZSBmb3IgYWNjdW11bGF0aW5nIHRoZSBtdXRhdGlvbnMgdG9cbiAqIHBlcmZvcm0gYW5kIHRoZSBiYXNlIHZlcnNpb25zIGZvciBhbnkgZG9jdW1lbnRzIHJlYWQuXG4gKi9cbmNsYXNzIE9hIHtcbiAgICBjb25zdHJ1Y3Rvcih0KSB7XG4gICAgICAgIHRoaXMuZGF0YXN0b3JlID0gdCwgXG4gICAgICAgIC8vIFRoZSB2ZXJzaW9uIG9mIGVhY2ggZG9jdW1lbnQgdGhhdCB3YXMgcmVhZCBkdXJpbmcgdGhpcyB0cmFuc2FjdGlvbi5cbiAgICAgICAgdGhpcy5yZWFkVmVyc2lvbnMgPSBuZXcgTWFwLCB0aGlzLm11dGF0aW9ucyA9IFtdLCB0aGlzLmNvbW1pdHRlZCA9ICExLCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEEgZGVmZXJyZWQgdXNhZ2UgZXJyb3IgdGhhdCBvY2N1cnJlZCBwcmV2aW91c2x5IGluIHRoaXMgdHJhbnNhY3Rpb24gdGhhdFxuICAgICAgICAgKiB3aWxsIGNhdXNlIHRoZSB0cmFuc2FjdGlvbiB0byBmYWlsIG9uY2UgaXQgYWN0dWFsbHkgY29tbWl0cy5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMubGFzdFdyaXRlRXJyb3IgPSBudWxsLCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNldCBvZiBkb2N1bWVudHMgdGhhdCBoYXZlIGJlZW4gd3JpdHRlbiBpbiB0aGUgdHJhbnNhY3Rpb24uXG4gICAgICAgICAqXG4gICAgICAgICAqIFdoZW4gdGhlcmUncyBtb3JlIHRoYW4gb25lIHdyaXRlIHRvIHRoZSBzYW1lIGtleSBpbiBhIHRyYW5zYWN0aW9uLCBhbnlcbiAgICAgICAgICogd3JpdGVzIGFmdGVyIHRoZSBmaXJzdCBhcmUgaGFuZGxlZCBkaWZmZXJlbnRseS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMud3JpdHRlbkRvY3MgPSBuZXcgU2V0O1xuICAgIH1cbiAgICBhc3luYyBsb29rdXAodCkge1xuICAgICAgICBpZiAodGhpcy5lbnN1cmVDb21taXROb3RDYWxsZWQoKSwgdGhpcy5tdXRhdGlvbnMubGVuZ3RoID4gMCkgdGhyb3cgbmV3IFEoRy5JTlZBTElEX0FSR1VNRU5ULCBcIkZpcmVzdG9yZSB0cmFuc2FjdGlvbnMgcmVxdWlyZSBhbGwgcmVhZHMgdG8gYmUgZXhlY3V0ZWQgYmVmb3JlIGFsbCB3cml0ZXMuXCIpO1xuICAgICAgICBjb25zdCBlID0gYXdhaXQgYXN5bmMgZnVuY3Rpb24odCwgZSkge1xuICAgICAgICAgICAgY29uc3QgbiA9IEsodCksIHMgPSBFcyhuLk0pICsgXCIvZG9jdW1lbnRzXCIsIGkgPSB7XG4gICAgICAgICAgICAgICAgZG9jdW1lbnRzOiBlLm1hcCgodCA9PiB5cyhuLk0sIHQpKSlcbiAgICAgICAgICAgIH0sIHIgPSBhd2FpdCBuLl9vKFwiQmF0Y2hHZXREb2N1bWVudHNcIiwgcywgaSksIG8gPSBuZXcgTWFwO1xuICAgICAgICAgICAgci5mb3JFYWNoKCh0ID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBlID0gUHMobi5NLCB0KTtcbiAgICAgICAgICAgICAgICBvLnNldChlLmtleS50b1N0cmluZygpLCBlKTtcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgIGNvbnN0IHUgPSBbXTtcbiAgICAgICAgICAgIHJldHVybiBlLmZvckVhY2goKHQgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGUgPSBvLmdldCh0LnRvU3RyaW5nKCkpO1xuICAgICAgICAgICAgICAgIFUoISFlKSwgdS5wdXNoKGUpO1xuICAgICAgICAgICAgfSkpLCB1O1xuICAgICAgICB9KHRoaXMuZGF0YXN0b3JlLCB0KTtcbiAgICAgICAgcmV0dXJuIGUuZm9yRWFjaCgodCA9PiB0aGlzLnJlY29yZFZlcnNpb24odCkpKSwgZTtcbiAgICB9XG4gICAgc2V0KHQsIGUpIHtcbiAgICAgICAgdGhpcy53cml0ZShlLnRvTXV0YXRpb24odCwgdGhpcy5wcmVjb25kaXRpb24odCkpKSwgdGhpcy53cml0dGVuRG9jcy5hZGQodC50b1N0cmluZygpKTtcbiAgICB9XG4gICAgdXBkYXRlKHQsIGUpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHRoaXMud3JpdGUoZS50b011dGF0aW9uKHQsIHRoaXMucHJlY29uZGl0aW9uRm9yVXBkYXRlKHQpKSk7XG4gICAgICAgIH0gY2F0Y2ggKHQpIHtcbiAgICAgICAgICAgIHRoaXMubGFzdFdyaXRlRXJyb3IgPSB0O1xuICAgICAgICB9XG4gICAgICAgIHRoaXMud3JpdHRlbkRvY3MuYWRkKHQudG9TdHJpbmcoKSk7XG4gICAgfVxuICAgIGRlbGV0ZSh0KSB7XG4gICAgICAgIHRoaXMud3JpdGUobmV3IE9uKHQsIHRoaXMucHJlY29uZGl0aW9uKHQpKSksIHRoaXMud3JpdHRlbkRvY3MuYWRkKHQudG9TdHJpbmcoKSk7XG4gICAgfVxuICAgIGFzeW5jIGNvbW1pdCgpIHtcbiAgICAgICAgaWYgKHRoaXMuZW5zdXJlQ29tbWl0Tm90Q2FsbGVkKCksIHRoaXMubGFzdFdyaXRlRXJyb3IpIHRocm93IHRoaXMubGFzdFdyaXRlRXJyb3I7XG4gICAgICAgIGNvbnN0IHQgPSB0aGlzLnJlYWRWZXJzaW9ucztcbiAgICAgICAgLy8gRm9yIGVhY2ggbXV0YXRpb24sIG5vdGUgdGhhdCB0aGUgZG9jIHdhcyB3cml0dGVuLlxuICAgICAgICAgICAgICAgIHRoaXMubXV0YXRpb25zLmZvckVhY2goKGUgPT4ge1xuICAgICAgICAgICAgdC5kZWxldGUoZS5rZXkudG9TdHJpbmcoKSk7XG4gICAgICAgIH0pKSwgXG4gICAgICAgIC8vIEZvciBlYWNoIGRvY3VtZW50IHRoYXQgd2FzIHJlYWQgYnV0IG5vdCB3cml0dGVuIHRvLCB3ZSB3YW50IHRvIHBlcmZvcm1cbiAgICAgICAgLy8gYSBgdmVyaWZ5YCBvcGVyYXRpb24uXG4gICAgICAgIHQuZm9yRWFjaCgoKHQsIGUpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSB4dC5mcm9tUGF0aChlKTtcbiAgICAgICAgICAgIHRoaXMubXV0YXRpb25zLnB1c2gobmV3IEZuKG4sIHRoaXMucHJlY29uZGl0aW9uKG4pKSk7XG4gICAgICAgIH0pKSwgYXdhaXQgYXN5bmMgZnVuY3Rpb24odCwgZSkge1xuICAgICAgICAgICAgY29uc3QgbiA9IEsodCksIHMgPSBFcyhuLk0pICsgXCIvZG9jdW1lbnRzXCIsIGkgPSB7XG4gICAgICAgICAgICAgICAgd3JpdGVzOiBlLm1hcCgodCA9PiB2cyhuLk0sIHQpKSlcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBhd2FpdCBuLmNvKFwiQ29tbWl0XCIsIHMsIGkpO1xuICAgICAgICB9KHRoaXMuZGF0YXN0b3JlLCB0aGlzLm11dGF0aW9ucyksIHRoaXMuY29tbWl0dGVkID0gITA7XG4gICAgfVxuICAgIHJlY29yZFZlcnNpb24odCkge1xuICAgICAgICBsZXQgZTtcbiAgICAgICAgaWYgKHQuaXNGb3VuZERvY3VtZW50KCkpIGUgPSB0LnZlcnNpb247IGVsc2Uge1xuICAgICAgICAgICAgaWYgKCF0LmlzTm9Eb2N1bWVudCgpKSB0aHJvdyBMKCk7XG4gICAgICAgICAgICAvLyBGb3IgZGVsZXRlZCBkb2NzLCB3ZSBtdXN0IHVzZSBiYXNlVmVyc2lvbiAwIHdoZW4gd2Ugb3ZlcndyaXRlIHRoZW0uXG4gICAgICAgICAgICBlID0gY3QubWluKCk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbiA9IHRoaXMucmVhZFZlcnNpb25zLmdldCh0LmtleS50b1N0cmluZygpKTtcbiAgICAgICAgaWYgKG4pIHtcbiAgICAgICAgICAgIGlmICghZS5pc0VxdWFsKG4pKSBcbiAgICAgICAgICAgIC8vIFRoaXMgdHJhbnNhY3Rpb24gd2lsbCBmYWlsIG5vIG1hdHRlciB3aGF0LlxuICAgICAgICAgICAgdGhyb3cgbmV3IFEoRy5BQk9SVEVELCBcIkRvY3VtZW50IHZlcnNpb24gY2hhbmdlZCBiZXR3ZWVuIHR3byByZWFkcy5cIik7XG4gICAgICAgIH0gZWxzZSB0aGlzLnJlYWRWZXJzaW9ucy5zZXQodC5rZXkudG9TdHJpbmcoKSwgZSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdGhlIHZlcnNpb24gb2YgdGhpcyBkb2N1bWVudCB3aGVuIGl0IHdhcyByZWFkIGluIHRoaXMgdHJhbnNhY3Rpb24sXG4gICAgICogYXMgYSBwcmVjb25kaXRpb24sIG9yIG5vIHByZWNvbmRpdGlvbiBpZiBpdCB3YXMgbm90IHJlYWQuXG4gICAgICovICAgIHByZWNvbmRpdGlvbih0KSB7XG4gICAgICAgIGNvbnN0IGUgPSB0aGlzLnJlYWRWZXJzaW9ucy5nZXQodC50b1N0cmluZygpKTtcbiAgICAgICAgcmV0dXJuICF0aGlzLndyaXR0ZW5Eb2NzLmhhcyh0LnRvU3RyaW5nKCkpICYmIGUgPyBBbi51cGRhdGVUaW1lKGUpIDogQW4ubm9uZSgpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRoZSBwcmVjb25kaXRpb24gZm9yIGEgZG9jdW1lbnQgaWYgdGhlIG9wZXJhdGlvbiBpcyBhbiB1cGRhdGUuXG4gICAgICovICAgIHByZWNvbmRpdGlvbkZvclVwZGF0ZSh0KSB7XG4gICAgICAgIGNvbnN0IGUgPSB0aGlzLnJlYWRWZXJzaW9ucy5nZXQodC50b1N0cmluZygpKTtcbiAgICAgICAgLy8gVGhlIGZpcnN0IHRpbWUgYSBkb2N1bWVudCBpcyB3cml0dGVuLCB3ZSB3YW50IHRvIHRha2UgaW50byBhY2NvdW50IHRoZVxuICAgICAgICAvLyByZWFkIHRpbWUgYW5kIGV4aXN0ZW5jZVxuICAgICAgICAgICAgICAgIGlmICghdGhpcy53cml0dGVuRG9jcy5oYXModC50b1N0cmluZygpKSAmJiBlKSB7XG4gICAgICAgICAgICBpZiAoZS5pc0VxdWFsKGN0Lm1pbigpKSkgXG4gICAgICAgICAgICAvLyBUaGUgZG9jdW1lbnQgZG9lc24ndCBleGlzdCwgc28gZmFpbCB0aGUgdHJhbnNhY3Rpb24uXG4gICAgICAgICAgICAvLyBUaGlzIGhhcyB0byBiZSB2YWxpZGF0ZWQgbG9jYWxseSBiZWNhdXNlIHlvdSBjYW4ndCBzZW5kIGFcbiAgICAgICAgICAgIC8vIHByZWNvbmRpdGlvbiB0aGF0IGEgZG9jdW1lbnQgZG9lcyBub3QgZXhpc3Qgd2l0aG91dCBjaGFuZ2luZyB0aGVcbiAgICAgICAgICAgIC8vIHNlbWFudGljcyBvZiB0aGUgYmFja2VuZCB3cml0ZSB0byBiZSBhbiBpbnNlcnQuIFRoaXMgaXMgdGhlIHJldmVyc2VcbiAgICAgICAgICAgIC8vIG9mIHdoYXQgd2Ugd2FudCwgc2luY2Ugd2Ugd2FudCB0byBhc3NlcnQgdGhhdCB0aGUgZG9jdW1lbnQgZG9lc24ndFxuICAgICAgICAgICAgLy8gZXhpc3QgYnV0IHRoZW4gc2VuZCB0aGUgdXBkYXRlIGFuZCBoYXZlIGl0IGZhaWwuIFNpbmNlIHdlIGNhbid0XG4gICAgICAgICAgICAvLyBleHByZXNzIHRoYXQgdG8gdGhlIGJhY2tlbmQsIHdlIGhhdmUgdG8gdmFsaWRhdGUgbG9jYWxseS5cbiAgICAgICAgICAgIC8vIE5vdGU6IHRoaXMgY2FuIGNoYW5nZSBvbmNlIHdlIGNhbiBzZW5kIHNlcGFyYXRlIHZlcmlmeSB3cml0ZXMgaW4gdGhlXG4gICAgICAgICAgICAvLyB0cmFuc2FjdGlvbi5cbiAgICAgICAgICAgIHRocm93IG5ldyBRKEcuSU5WQUxJRF9BUkdVTUVOVCwgXCJDYW4ndCB1cGRhdGUgYSBkb2N1bWVudCB0aGF0IGRvZXNuJ3QgZXhpc3QuXCIpO1xuICAgICAgICAgICAgLy8gRG9jdW1lbnQgZXhpc3RzLCBiYXNlIHByZWNvbmRpdGlvbiBvbiBkb2N1bWVudCB1cGRhdGUgdGltZS5cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBBbi51cGRhdGVUaW1lKGUpO1xuICAgICAgICB9XG4gICAgICAgIC8vIERvY3VtZW50IHdhcyBub3QgcmVhZCwgc28gd2UganVzdCB1c2UgdGhlIHByZWNvbmRpdGlvbnMgZm9yIGEgYmxpbmRcbiAgICAgICAgLy8gdXBkYXRlLlxuICAgICAgICByZXR1cm4gQW4uZXhpc3RzKCEwKTtcbiAgICB9XG4gICAgd3JpdGUodCkge1xuICAgICAgICB0aGlzLmVuc3VyZUNvbW1pdE5vdENhbGxlZCgpLCB0aGlzLm11dGF0aW9ucy5wdXNoKHQpO1xuICAgIH1cbiAgICBlbnN1cmVDb21taXROb3RDYWxsZWQoKSB7fVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBUcmFuc2FjdGlvblJ1bm5lciBlbmNhcHN1bGF0ZXMgdGhlIGxvZ2ljIG5lZWRlZCB0byBydW4gYW5kIHJldHJ5IHRyYW5zYWN0aW9uc1xuICogd2l0aCBiYWNrb2ZmLlxuICovIGNsYXNzIEZhIHtcbiAgICBjb25zdHJ1Y3Rvcih0LCBlLCBuLCBzLCBpKSB7XG4gICAgICAgIHRoaXMuYXN5bmNRdWV1ZSA9IHQsIHRoaXMuZGF0YXN0b3JlID0gZSwgdGhpcy5vcHRpb25zID0gbiwgdGhpcy51cGRhdGVGdW5jdGlvbiA9IHMsIFxuICAgICAgICB0aGlzLmRlZmVycmVkID0gaSwgdGhpcy54YSA9IG4ubWF4QXR0ZW1wdHMsIHRoaXMuTm8gPSBuZXcgV28odGhpcy5hc3luY1F1ZXVlLCBcInRyYW5zYWN0aW9uX3JldHJ5XCIgLyogVHJhbnNhY3Rpb25SZXRyeSAqLyk7XG4gICAgfVxuICAgIC8qKiBSdW5zIHRoZSB0cmFuc2FjdGlvbiBhbmQgc2V0cyB0aGUgcmVzdWx0IG9uIGRlZmVycmVkLiAqLyAgICBydW4oKSB7XG4gICAgICAgIHRoaXMueGEgLT0gMSwgdGhpcy5OYSgpO1xuICAgIH1cbiAgICBOYSgpIHtcbiAgICAgICAgdGhpcy5Oby5SbygoYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgdCA9IG5ldyBPYSh0aGlzLmRhdGFzdG9yZSksIGUgPSB0aGlzLmthKHQpO1xuICAgICAgICAgICAgZSAmJiBlLnRoZW4oKGUgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuYXN5bmNRdWV1ZS5lbnF1ZXVlQW5kRm9yZ2V0KCgoKSA9PiB0LmNvbW1pdCgpLnRoZW4oKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kZWZlcnJlZC5yZXNvbHZlKGUpO1xuICAgICAgICAgICAgICAgIH0pKS5jYXRjaCgodCA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuTWEodCk7XG4gICAgICAgICAgICAgICAgfSkpKSk7XG4gICAgICAgICAgICB9KSkuY2F0Y2goKHQgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuTWEodCk7XG4gICAgICAgICAgICB9KSk7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAga2EodCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgZSA9IHRoaXMudXBkYXRlRnVuY3Rpb24odCk7XG4gICAgICAgICAgICByZXR1cm4gIVN0KGUpICYmIGUuY2F0Y2ggJiYgZS50aGVuID8gZSA6ICh0aGlzLmRlZmVycmVkLnJlamVjdChFcnJvcihcIlRyYW5zYWN0aW9uIGNhbGxiYWNrIG11c3QgcmV0dXJuIGEgUHJvbWlzZVwiKSksIFxuICAgICAgICAgICAgbnVsbCk7XG4gICAgICAgIH0gY2F0Y2ggKHQpIHtcbiAgICAgICAgICAgIC8vIERvIG5vdCByZXRyeSBlcnJvcnMgdGhyb3duIGJ5IHVzZXIgcHJvdmlkZWQgdXBkYXRlRnVuY3Rpb24uXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5kZWZlcnJlZC5yZWplY3QodCksIG51bGw7XG4gICAgICAgIH1cbiAgICB9XG4gICAgTWEodCkge1xuICAgICAgICB0aGlzLnhhID4gMCAmJiB0aGlzLk9hKHQpID8gKHRoaXMueGEgLT0gMSwgdGhpcy5hc3luY1F1ZXVlLmVucXVldWVBbmRGb3JnZXQoKCgpID0+ICh0aGlzLk5hKCksIFxuICAgICAgICBQcm9taXNlLnJlc29sdmUoKSkpKSkgOiB0aGlzLmRlZmVycmVkLnJlamVjdCh0KTtcbiAgICB9XG4gICAgT2EodCkge1xuICAgICAgICBpZiAoXCJGaXJlYmFzZUVycm9yXCIgPT09IHQubmFtZSkge1xuICAgICAgICAgICAgLy8gSW4gdHJhbnNhY3Rpb25zLCB0aGUgYmFja2VuZCB3aWxsIGZhaWwgb3V0ZGF0ZWQgcmVhZHMgd2l0aCBGQUlMRURfUFJFQ09ORElUSU9OIGFuZFxuICAgICAgICAgICAgLy8gbm9uLW1hdGNoaW5nIGRvY3VtZW50IHZlcnNpb25zIHdpdGggQUJPUlRFRC4gVGhlc2UgZXJyb3JzIHNob3VsZCBiZSByZXRyaWVkLlxuICAgICAgICAgICAgY29uc3QgZSA9IHQuY29kZTtcbiAgICAgICAgICAgIHJldHVybiBcImFib3J0ZWRcIiA9PT0gZSB8fCBcImZhaWxlZC1wcmVjb25kaXRpb25cIiA9PT0gZSB8fCAhVW4oZSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuICExO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogRmlyZXN0b3JlQ2xpZW50IGlzIGEgdG9wLWxldmVsIGNsYXNzIHRoYXQgY29uc3RydWN0cyBhbmQgb3ducyBhbGwgb2YgdGhlXG4gKiBwaWVjZXMgb2YgdGhlIGNsaWVudCBTREsgYXJjaGl0ZWN0dXJlLiBJdCBpcyByZXNwb25zaWJsZSBmb3IgY3JlYXRpbmcgdGhlXG4gKiBhc3luYyBxdWV1ZSB0aGF0IGlzIHNoYXJlZCBieSBhbGwgb2YgdGhlIG90aGVyIGNvbXBvbmVudHMgaW4gdGhlIHN5c3RlbS5cbiAqL1xuY2xhc3MgJGEge1xuICAgIGNvbnN0cnVjdG9yKHQsIGUsIFxuICAgIC8qKlxuICAgICAqIEFzeW5jaHJvbm91cyBxdWV1ZSByZXNwb25zaWJsZSBmb3IgYWxsIG9mIG91ciBpbnRlcm5hbCBwcm9jZXNzaW5nLiBXaGVuXG4gICAgICogd2UgZ2V0IGluY29taW5nIHdvcmsgZnJvbSB0aGUgdXNlciAodmlhIHB1YmxpYyBBUEkpIG9yIHRoZSBuZXR3b3JrXG4gICAgICogKGluY29taW5nIEdSUEMgbWVzc2FnZXMpLCB3ZSBzaG91bGQgYWx3YXlzIHNjaGVkdWxlIG9udG8gdGhpcyBxdWV1ZS5cbiAgICAgKiBUaGlzIGVuc3VyZXMgYWxsIG9mIG91ciB3b3JrIGlzIHByb3Blcmx5IHNlcmlhbGl6ZWQgKGUuZy4gd2UgZG9uJ3RcbiAgICAgKiBzdGFydCBwcm9jZXNzaW5nIGEgbmV3IG9wZXJhdGlvbiB3aGlsZSB0aGUgcHJldmlvdXMgb25lIGlzIHdhaXRpbmcgZm9yXG4gICAgICogYW4gYXN5bmMgSS9PIHRvIGNvbXBsZXRlKS5cbiAgICAgKi9cbiAgICBuLCBzKSB7XG4gICAgICAgIHRoaXMuYXV0aENyZWRlbnRpYWxzID0gdCwgdGhpcy5hcHBDaGVja0NyZWRlbnRpYWxzID0gZSwgdGhpcy5hc3luY1F1ZXVlID0gbiwgdGhpcy5kYXRhYmFzZUluZm8gPSBzLCBcbiAgICAgICAgdGhpcy51c2VyID0gQy5VTkFVVEhFTlRJQ0FURUQsIHRoaXMuY2xpZW50SWQgPSBpdC5SKCksIHRoaXMuYXV0aENyZWRlbnRpYWxMaXN0ZW5lciA9ICgpID0+IFByb21pc2UucmVzb2x2ZSgpLCBcbiAgICAgICAgdGhpcy5hcHBDaGVja0NyZWRlbnRpYWxMaXN0ZW5lciA9ICgpID0+IFByb21pc2UucmVzb2x2ZSgpLCB0aGlzLmF1dGhDcmVkZW50aWFscy5zdGFydChuLCAoYXN5bmMgdCA9PiB7XG4gICAgICAgICAgICBPKFwiRmlyZXN0b3JlQ2xpZW50XCIsIFwiUmVjZWl2ZWQgdXNlcj1cIiwgdC51aWQpLCBhd2FpdCB0aGlzLmF1dGhDcmVkZW50aWFsTGlzdGVuZXIodCksIFxuICAgICAgICAgICAgdGhpcy51c2VyID0gdDtcbiAgICAgICAgfSkpLCB0aGlzLmFwcENoZWNrQ3JlZGVudGlhbHMuc3RhcnQobiwgKHQgPT4gKE8oXCJGaXJlc3RvcmVDbGllbnRcIiwgXCJSZWNlaXZlZCBuZXcgYXBwIGNoZWNrIHRva2VuPVwiLCB0KSwgXG4gICAgICAgIHRoaXMuYXBwQ2hlY2tDcmVkZW50aWFsTGlzdGVuZXIodCwgdGhpcy51c2VyKSkpKTtcbiAgICB9XG4gICAgYXN5bmMgZ2V0Q29uZmlndXJhdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGFzeW5jUXVldWU6IHRoaXMuYXN5bmNRdWV1ZSxcbiAgICAgICAgICAgIGRhdGFiYXNlSW5mbzogdGhpcy5kYXRhYmFzZUluZm8sXG4gICAgICAgICAgICBjbGllbnRJZDogdGhpcy5jbGllbnRJZCxcbiAgICAgICAgICAgIGF1dGhDcmVkZW50aWFsczogdGhpcy5hdXRoQ3JlZGVudGlhbHMsXG4gICAgICAgICAgICBhcHBDaGVja0NyZWRlbnRpYWxzOiB0aGlzLmFwcENoZWNrQ3JlZGVudGlhbHMsXG4gICAgICAgICAgICBpbml0aWFsVXNlcjogdGhpcy51c2VyLFxuICAgICAgICAgICAgbWF4Q29uY3VycmVudExpbWJvUmVzb2x1dGlvbnM6IDEwMFxuICAgICAgICB9O1xuICAgIH1cbiAgICBzZXRDcmVkZW50aWFsQ2hhbmdlTGlzdGVuZXIodCkge1xuICAgICAgICB0aGlzLmF1dGhDcmVkZW50aWFsTGlzdGVuZXIgPSB0O1xuICAgIH1cbiAgICBzZXRBcHBDaGVja1Rva2VuQ2hhbmdlTGlzdGVuZXIodCkge1xuICAgICAgICB0aGlzLmFwcENoZWNrQ3JlZGVudGlhbExpc3RlbmVyID0gdDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ2hlY2tzIHRoYXQgdGhlIGNsaWVudCBoYXMgbm90IGJlZW4gdGVybWluYXRlZC4gRW5zdXJlcyB0aGF0IG90aGVyIG1ldGhvZHMgb25cbiAgICAgKiB0aGlzIGNsYXNzIGNhbm5vdCBiZSBjYWxsZWQgYWZ0ZXIgdGhlIGNsaWVudCBpcyB0ZXJtaW5hdGVkLlxuICAgICAqLyAgICB2ZXJpZnlOb3RUZXJtaW5hdGVkKCkge1xuICAgICAgICBpZiAodGhpcy5hc3luY1F1ZXVlLmlzU2h1dHRpbmdEb3duKSB0aHJvdyBuZXcgUShHLkZBSUxFRF9QUkVDT05ESVRJT04sIFwiVGhlIGNsaWVudCBoYXMgYWxyZWFkeSBiZWVuIHRlcm1pbmF0ZWQuXCIpO1xuICAgIH1cbiAgICB0ZXJtaW5hdGUoKSB7XG4gICAgICAgIHRoaXMuYXN5bmNRdWV1ZS5lbnRlclJlc3RyaWN0ZWRNb2RlKCk7XG4gICAgICAgIGNvbnN0IHQgPSBuZXcgajtcbiAgICAgICAgcmV0dXJuIHRoaXMuYXN5bmNRdWV1ZS5lbnF1ZXVlQW5kRm9yZ2V0RXZlbldoaWxlUmVzdHJpY3RlZCgoYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICB0aGlzLm9ubGluZUNvbXBvbmVudHMgJiYgYXdhaXQgdGhpcy5vbmxpbmVDb21wb25lbnRzLnRlcm1pbmF0ZSgpLCB0aGlzLm9mZmxpbmVDb21wb25lbnRzICYmIGF3YWl0IHRoaXMub2ZmbGluZUNvbXBvbmVudHMudGVybWluYXRlKCksIFxuICAgICAgICAgICAgICAgIC8vIFRoZSBjcmVkZW50aWFscyBwcm92aWRlciBtdXN0IGJlIHRlcm1pbmF0ZWQgYWZ0ZXIgc2h1dHRpbmcgZG93biB0aGVcbiAgICAgICAgICAgICAgICAvLyBSZW1vdGVTdG9yZSBhcyBpdCB3aWxsIHByZXZlbnQgdGhlIFJlbW90ZVN0b3JlIGZyb20gcmV0cmlldmluZyBhdXRoXG4gICAgICAgICAgICAgICAgLy8gdG9rZW5zLlxuICAgICAgICAgICAgICAgIHRoaXMuYXV0aENyZWRlbnRpYWxzLnNodXRkb3duKCksIHRoaXMuYXBwQ2hlY2tDcmVkZW50aWFscy5zaHV0ZG93bigpLCB0LnJlc29sdmUoKTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBuID0gU3UoZSwgXCJGYWlsZWQgdG8gc2h1dGRvd24gcGVyc2lzdGVuY2VcIik7XG4gICAgICAgICAgICAgICAgdC5yZWplY3Qobik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pKSwgdC5wcm9taXNlO1xuICAgIH1cbn1cblxuYXN5bmMgZnVuY3Rpb24gQmEodCwgZSkge1xuICAgIHQuYXN5bmNRdWV1ZS52ZXJpZnlPcGVyYXRpb25JblByb2dyZXNzKCksIE8oXCJGaXJlc3RvcmVDbGllbnRcIiwgXCJJbml0aWFsaXppbmcgT2ZmbGluZUNvbXBvbmVudFByb3ZpZGVyXCIpO1xuICAgIGNvbnN0IG4gPSBhd2FpdCB0LmdldENvbmZpZ3VyYXRpb24oKTtcbiAgICBhd2FpdCBlLmluaXRpYWxpemUobik7XG4gICAgbGV0IHMgPSBuLmluaXRpYWxVc2VyO1xuICAgIHQuc2V0Q3JlZGVudGlhbENoYW5nZUxpc3RlbmVyKChhc3luYyB0ID0+IHtcbiAgICAgICAgcy5pc0VxdWFsKHQpIHx8IChhd2FpdCBzbyhlLmxvY2FsU3RvcmUsIHQpLCBzID0gdCk7XG4gICAgfSkpLCBcbiAgICAvLyBXaGVuIGEgdXNlciBjYWxscyBjbGVhclBlcnNpc3RlbmNlKCkgaW4gb25lIGNsaWVudCwgYWxsIG90aGVyIGNsaWVudHNcbiAgICAvLyBuZWVkIHRvIGJlIHRlcm1pbmF0ZWQgdG8gYWxsb3cgdGhlIGRlbGV0ZSB0byBzdWNjZWVkLlxuICAgIGUucGVyc2lzdGVuY2Uuc2V0RGF0YWJhc2VEZWxldGVkTGlzdGVuZXIoKCgpID0+IHQudGVybWluYXRlKCkpKSwgdC5vZmZsaW5lQ29tcG9uZW50cyA9IGU7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIExhKHQsIGUpIHtcbiAgICB0LmFzeW5jUXVldWUudmVyaWZ5T3BlcmF0aW9uSW5Qcm9ncmVzcygpO1xuICAgIGNvbnN0IG4gPSBhd2FpdCBVYSh0KTtcbiAgICBPKFwiRmlyZXN0b3JlQ2xpZW50XCIsIFwiSW5pdGlhbGl6aW5nIE9ubGluZUNvbXBvbmVudFByb3ZpZGVyXCIpO1xuICAgIGNvbnN0IHMgPSBhd2FpdCB0LmdldENvbmZpZ3VyYXRpb24oKTtcbiAgICBhd2FpdCBlLmluaXRpYWxpemUobiwgcyksIFxuICAgIC8vIFRoZSBDcmVkZW50aWFsQ2hhbmdlTGlzdGVuZXIgb2YgdGhlIG9ubGluZSBjb21wb25lbnQgcHJvdmlkZXIgdGFrZXNcbiAgICAvLyBwcmVjZWRlbmNlIG92ZXIgdGhlIG9mZmxpbmUgY29tcG9uZW50IHByb3ZpZGVyLlxuICAgIHQuc2V0Q3JlZGVudGlhbENoYW5nZUxpc3RlbmVyKCh0ID0+IFJ1KGUucmVtb3RlU3RvcmUsIHQpKSksIHQuc2V0QXBwQ2hlY2tUb2tlbkNoYW5nZUxpc3RlbmVyKCgodCwgbikgPT4gUnUoZS5yZW1vdGVTdG9yZSwgbikpKSwgXG4gICAgdC5vbmxpbmVDb21wb25lbnRzID0gZTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gVWEodCkge1xuICAgIHJldHVybiB0Lm9mZmxpbmVDb21wb25lbnRzIHx8IChPKFwiRmlyZXN0b3JlQ2xpZW50XCIsIFwiVXNpbmcgZGVmYXVsdCBPZmZsaW5lQ29tcG9uZW50UHJvdmlkZXJcIiksIFxuICAgIGF3YWl0IEJhKHQsIG5ldyBTYSkpLCB0Lm9mZmxpbmVDb21wb25lbnRzO1xufVxuXG5hc3luYyBmdW5jdGlvbiBxYSh0KSB7XG4gICAgcmV0dXJuIHQub25saW5lQ29tcG9uZW50cyB8fCAoTyhcIkZpcmVzdG9yZUNsaWVudFwiLCBcIlVzaW5nIGRlZmF1bHQgT25saW5lQ29tcG9uZW50UHJvdmlkZXJcIiksIFxuICAgIGF3YWl0IExhKHQsIG5ldyB4YSkpLCB0Lm9ubGluZUNvbXBvbmVudHM7XG59XG5cbmZ1bmN0aW9uIEthKHQpIHtcbiAgICByZXR1cm4gVWEodCkudGhlbigodCA9PiB0LnBlcnNpc3RlbmNlKSk7XG59XG5cbmZ1bmN0aW9uIEdhKHQpIHtcbiAgICByZXR1cm4gVWEodCkudGhlbigodCA9PiB0LmxvY2FsU3RvcmUpKTtcbn1cblxuZnVuY3Rpb24gUWEodCkge1xuICAgIHJldHVybiBxYSh0KS50aGVuKCh0ID0+IHQucmVtb3RlU3RvcmUpKTtcbn1cblxuZnVuY3Rpb24gamEodCkge1xuICAgIHJldHVybiBxYSh0KS50aGVuKCh0ID0+IHQuc3luY0VuZ2luZSkpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBXYSh0KSB7XG4gICAgY29uc3QgZSA9IGF3YWl0IHFhKHQpLCBuID0gZS5ldmVudE1hbmFnZXI7XG4gICAgcmV0dXJuIG4ub25MaXN0ZW4gPSBZdS5iaW5kKG51bGwsIGUuc3luY0VuZ2luZSksIG4ub25Vbmxpc3RlbiA9IFp1LmJpbmQobnVsbCwgZS5zeW5jRW5naW5lKSwgXG4gICAgbjtcbn1cblxuLyoqIEVuYWJsZXMgdGhlIG5ldHdvcmsgY29ubmVjdGlvbiBhbmQgcmUtZW5xdWV1ZXMgYWxsIHBlbmRpbmcgb3BlcmF0aW9ucy4gKi8gZnVuY3Rpb24gemEodCkge1xuICAgIHJldHVybiB0LmFzeW5jUXVldWUuZW5xdWV1ZSgoYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCBlID0gYXdhaXQgS2EodCksIG4gPSBhd2FpdCBRYSh0KTtcbiAgICAgICAgcmV0dXJuIGUuc2V0TmV0d29ya0VuYWJsZWQoITApLCBmdW5jdGlvbih0KSB7XG4gICAgICAgICAgICBjb25zdCBlID0gSyh0KTtcbiAgICAgICAgICAgIHJldHVybiBlLnd1LmRlbGV0ZSgwIC8qIFVzZXJEaXNhYmxlZCAqLyksIHR1KGUpO1xuICAgICAgICB9KG4pO1xuICAgIH0pKTtcbn1cblxuLyoqIERpc2FibGVzIHRoZSBuZXR3b3JrIGNvbm5lY3Rpb24uIFBlbmRpbmcgb3BlcmF0aW9ucyB3aWxsIG5vdCBjb21wbGV0ZS4gKi8gZnVuY3Rpb24gSGEodCkge1xuICAgIHJldHVybiB0LmFzeW5jUXVldWUuZW5xdWV1ZSgoYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCBlID0gYXdhaXQgS2EodCksIG4gPSBhd2FpdCBRYSh0KTtcbiAgICAgICAgcmV0dXJuIGUuc2V0TmV0d29ya0VuYWJsZWQoITEpLCBhc3luYyBmdW5jdGlvbih0KSB7XG4gICAgICAgICAgICBjb25zdCBlID0gSyh0KTtcbiAgICAgICAgICAgIGUud3UuYWRkKDAgLyogVXNlckRpc2FibGVkICovKSwgYXdhaXQgZXUoZSksIFxuICAgICAgICAgICAgLy8gU2V0IHRoZSBPbmxpbmVTdGF0ZSB0byBPZmZsaW5lIHNvIGdldCgpcyByZXR1cm4gZnJvbSBjYWNoZSwgZXRjLlxuICAgICAgICAgICAgZS55dS5zZXQoXCJPZmZsaW5lXCIgLyogT2ZmbGluZSAqLyk7XG4gICAgICAgIH0obik7XG4gICAgfSkpO1xufVxuXG4vKipcbiAqIFJldHVybnMgYSBQcm9taXNlIHRoYXQgcmVzb2x2ZXMgd2hlbiBhbGwgd3JpdGVzIHRoYXQgd2VyZSBwZW5kaW5nIGF0IHRoZSB0aW1lXG4gKiB0aGlzIG1ldGhvZCB3YXMgY2FsbGVkIHJlY2VpdmVkIHNlcnZlciBhY2tub3dsZWRnZW1lbnQuIEFuIGFja25vd2xlZGdlbWVudFxuICogY2FuIGJlIGVpdGhlciBhY2NlcHRhbmNlIG9yIHJlamVjdGlvbi5cbiAqLyBmdW5jdGlvbiBKYSh0LCBlKSB7XG4gICAgY29uc3QgbiA9IG5ldyBqO1xuICAgIHJldHVybiB0LmFzeW5jUXVldWUuZW5xdWV1ZUFuZEZvcmdldCgoYXN5bmMgKCkgPT4gYXN5bmMgZnVuY3Rpb24odCwgZSwgbikge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgcyA9IGF3YWl0IGZ1bmN0aW9uKHQsIGUpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBuID0gSyh0KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gbi5wZXJzaXN0ZW5jZS5ydW5UcmFuc2FjdGlvbihcInJlYWQgZG9jdW1lbnRcIiwgXCJyZWFkb25seVwiLCAodCA9PiBuLmZpLkxzKHQsIGUpKSk7XG4gICAgICAgICAgICB9KHQsIGUpO1xuICAgICAgICAgICAgcy5pc0ZvdW5kRG9jdW1lbnQoKSA/IG4ucmVzb2x2ZShzKSA6IHMuaXNOb0RvY3VtZW50KCkgPyBuLnJlc29sdmUobnVsbCkgOiBuLnJlamVjdChuZXcgUShHLlVOQVZBSUxBQkxFLCBcIkZhaWxlZCB0byBnZXQgZG9jdW1lbnQgZnJvbSBjYWNoZS4gKEhvd2V2ZXIsIHRoaXMgZG9jdW1lbnQgbWF5IGV4aXN0IG9uIHRoZSBzZXJ2ZXIuIFJ1biBhZ2FpbiB3aXRob3V0IHNldHRpbmcgJ3NvdXJjZScgaW4gdGhlIEdldE9wdGlvbnMgdG8gYXR0ZW1wdCB0byByZXRyaWV2ZSB0aGUgZG9jdW1lbnQgZnJvbSB0aGUgc2VydmVyLilcIikpO1xuICAgICAgICB9IGNhdGNoICh0KSB7XG4gICAgICAgICAgICBjb25zdCBzID0gU3UodCwgYEZhaWxlZCB0byBnZXQgZG9jdW1lbnQgJyR7ZX0gZnJvbSBjYWNoZWApO1xuICAgICAgICAgICAgbi5yZWplY3Qocyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gKiBSZXRyaWV2ZXMgYSBsYXRlbmN5LWNvbXBlbnNhdGVkIGRvY3VtZW50IGZyb20gdGhlIGJhY2tlbmQgdmlhIGFcbiAqIFNuYXBzaG90TGlzdGVuZXIuXG4gKi8gKGF3YWl0IEdhKHQpLCBlLCBuKSkpLCBuLnByb21pc2U7XG59XG5cbmZ1bmN0aW9uIFlhKHQsIGUsIG4gPSB7fSkge1xuICAgIGNvbnN0IHMgPSBuZXcgajtcbiAgICByZXR1cm4gdC5hc3luY1F1ZXVlLmVucXVldWVBbmRGb3JnZXQoKGFzeW5jICgpID0+IGZ1bmN0aW9uKHQsIGUsIG4sIHMsIGkpIHtcbiAgICAgICAgY29uc3QgciA9IG5ldyBrYSh7XG4gICAgICAgICAgICBuZXh0OiByID0+IHtcbiAgICAgICAgICAgICAgICAvLyBSZW1vdmUgcXVlcnkgZmlyc3QgYmVmb3JlIHBhc3NpbmcgZXZlbnQgdG8gdXNlciB0byBhdm9pZFxuICAgICAgICAgICAgICAgIC8vIHVzZXIgYWN0aW9ucyBhZmZlY3RpbmcgdGhlIG5vdyBzdGFsZSBxdWVyeS5cbiAgICAgICAgICAgICAgICBlLmVucXVldWVBbmRGb3JnZXQoKCgpID0+IE91KHQsIG8pKSk7XG4gICAgICAgICAgICAgICAgY29uc3QgdSA9IHIuZG9jcy5oYXMobik7XG4gICAgICAgICAgICAgICAgIXUgJiYgci5mcm9tQ2FjaGUgPyBcbiAgICAgICAgICAgICAgICAvLyBUT0RPKGRpbW9uZCk6IElmIHdlJ3JlIG9ubGluZSBhbmQgdGhlIGRvY3VtZW50IGRvZXNuJ3RcbiAgICAgICAgICAgICAgICAvLyBleGlzdCB0aGVuIHdlIHJlc29sdmUgd2l0aCBhIGRvYy5leGlzdHMgc2V0IHRvIGZhbHNlLiBJZlxuICAgICAgICAgICAgICAgIC8vIHdlJ3JlIG9mZmxpbmUgaG93ZXZlciwgd2UgcmVqZWN0IHRoZSBQcm9taXNlIGluIHRoaXNcbiAgICAgICAgICAgICAgICAvLyBjYXNlLiBUd28gb3B0aW9uczogMSkgQ2FjaGUgdGhlIG5lZ2F0aXZlIHJlc3BvbnNlIGZyb21cbiAgICAgICAgICAgICAgICAvLyB0aGUgc2VydmVyIHNvIHdlIGNhbiBkZWxpdmVyIHRoYXQgZXZlbiB3aGVuIHlvdSdyZVxuICAgICAgICAgICAgICAgIC8vIG9mZmxpbmUgMikgQWN0dWFsbHkgcmVqZWN0IHRoZSBQcm9taXNlIGluIHRoZSBvbmxpbmUgY2FzZVxuICAgICAgICAgICAgICAgIC8vIGlmIHRoZSBkb2N1bWVudCBkb2Vzbid0IGV4aXN0LlxuICAgICAgICAgICAgICAgIGkucmVqZWN0KG5ldyBRKEcuVU5BVkFJTEFCTEUsIFwiRmFpbGVkIHRvIGdldCBkb2N1bWVudCBiZWNhdXNlIHRoZSBjbGllbnQgaXMgb2ZmbGluZS5cIikpIDogdSAmJiByLmZyb21DYWNoZSAmJiBzICYmIFwic2VydmVyXCIgPT09IHMuc291cmNlID8gaS5yZWplY3QobmV3IFEoRy5VTkFWQUlMQUJMRSwgJ0ZhaWxlZCB0byBnZXQgZG9jdW1lbnQgZnJvbSBzZXJ2ZXIuIChIb3dldmVyLCB0aGlzIGRvY3VtZW50IGRvZXMgZXhpc3QgaW4gdGhlIGxvY2FsIGNhY2hlLiBSdW4gYWdhaW4gd2l0aG91dCBzZXR0aW5nIHNvdXJjZSB0byBcInNlcnZlclwiIHRvIHJldHJpZXZlIHRoZSBjYWNoZWQgZG9jdW1lbnQuKScpKSA6IGkucmVzb2x2ZShyKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlcnJvcjogdCA9PiBpLnJlamVjdCh0KVxuICAgICAgICB9KSwgbyA9IG5ldyBMdShLZShuLnBhdGgpLCByLCB7XG4gICAgICAgICAgICBpbmNsdWRlTWV0YWRhdGFDaGFuZ2VzOiAhMCxcbiAgICAgICAgICAgIGt1OiAhMFxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIE11KHQsIG8pO1xuICAgIH0oYXdhaXQgV2EodCksIHQuYXN5bmNRdWV1ZSwgZSwgbiwgcykpKSwgcy5wcm9taXNlO1xufVxuXG5mdW5jdGlvbiBYYSh0LCBlKSB7XG4gICAgY29uc3QgbiA9IG5ldyBqO1xuICAgIHJldHVybiB0LmFzeW5jUXVldWUuZW5xdWV1ZUFuZEZvcmdldCgoYXN5bmMgKCkgPT4gYXN5bmMgZnVuY3Rpb24odCwgZSwgbikge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgcyA9IGF3YWl0IGxvKHQsIGUsIFxuICAgICAgICAgICAgLyogdXNlUHJldmlvdXNSZXN1bHRzPSAqLyAhMCksIGkgPSBuZXcgV3UoZSwgcy5faSksIHIgPSBpLld1KHMuZG9jdW1lbnRzKSwgbyA9IGkuYXBwbHlDaGFuZ2VzKHIsIFxuICAgICAgICAgICAgLyogdXBkYXRlTGltYm9Eb2N1bWVudHM9ICovICExKTtcbiAgICAgICAgICAgIG4ucmVzb2x2ZShvLnNuYXBzaG90KTtcbiAgICAgICAgfSBjYXRjaCAodCkge1xuICAgICAgICAgICAgY29uc3QgcyA9IFN1KHQsIGBGYWlsZWQgdG8gZXhlY3V0ZSBxdWVyeSAnJHtlfSBhZ2FpbnN0IGNhY2hlYCk7XG4gICAgICAgICAgICBuLnJlamVjdChzKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAqIFJldHJpZXZlcyBhIGxhdGVuY3ktY29tcGVuc2F0ZWQgcXVlcnkgc25hcHNob3QgZnJvbSB0aGUgYmFja2VuZCB2aWEgYVxuICogU25hcHNob3RMaXN0ZW5lci5cbiAqLyAoYXdhaXQgR2EodCksIGUsIG4pKSksIG4ucHJvbWlzZTtcbn1cblxuZnVuY3Rpb24gWmEodCwgZSwgbiA9IHt9KSB7XG4gICAgY29uc3QgcyA9IG5ldyBqO1xuICAgIHJldHVybiB0LmFzeW5jUXVldWUuZW5xdWV1ZUFuZEZvcmdldCgoYXN5bmMgKCkgPT4gZnVuY3Rpb24odCwgZSwgbiwgcywgaSkge1xuICAgICAgICBjb25zdCByID0gbmV3IGthKHtcbiAgICAgICAgICAgIG5leHQ6IG4gPT4ge1xuICAgICAgICAgICAgICAgIC8vIFJlbW92ZSBxdWVyeSBmaXJzdCBiZWZvcmUgcGFzc2luZyBldmVudCB0byB1c2VyIHRvIGF2b2lkXG4gICAgICAgICAgICAgICAgLy8gdXNlciBhY3Rpb25zIGFmZmVjdGluZyB0aGUgbm93IHN0YWxlIHF1ZXJ5LlxuICAgICAgICAgICAgICAgIGUuZW5xdWV1ZUFuZEZvcmdldCgoKCkgPT4gT3UodCwgbykpKSwgbi5mcm9tQ2FjaGUgJiYgXCJzZXJ2ZXJcIiA9PT0gcy5zb3VyY2UgPyBpLnJlamVjdChuZXcgUShHLlVOQVZBSUxBQkxFLCAnRmFpbGVkIHRvIGdldCBkb2N1bWVudHMgZnJvbSBzZXJ2ZXIuIChIb3dldmVyLCB0aGVzZSBkb2N1bWVudHMgbWF5IGV4aXN0IGluIHRoZSBsb2NhbCBjYWNoZS4gUnVuIGFnYWluIHdpdGhvdXQgc2V0dGluZyBzb3VyY2UgdG8gXCJzZXJ2ZXJcIiB0byByZXRyaWV2ZSB0aGUgY2FjaGVkIGRvY3VtZW50cy4pJykpIDogaS5yZXNvbHZlKG4pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVycm9yOiB0ID0+IGkucmVqZWN0KHQpXG4gICAgICAgIH0pLCBvID0gbmV3IEx1KG4sIHIsIHtcbiAgICAgICAgICAgIGluY2x1ZGVNZXRhZGF0YUNoYW5nZXM6ICEwLFxuICAgICAgICAgICAga3U6ICEwXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gTXUodCwgbyk7XG4gICAgfShhd2FpdCBXYSh0KSwgdC5hc3luY1F1ZXVlLCBlLCBuLCBzKSkpLCBzLnByb21pc2U7XG59XG5cbmZ1bmN0aW9uIHRjKHQsIGUpIHtcbiAgICBjb25zdCBuID0gbmV3IGthKGUpO1xuICAgIHJldHVybiB0LmFzeW5jUXVldWUuZW5xdWV1ZUFuZEZvcmdldCgoYXN5bmMgKCkgPT4gZnVuY3Rpb24odCwgZSkge1xuICAgICAgICBLKHQpLmJ1LmFkZChlKSwgXG4gICAgICAgIC8vIEltbWVkaWF0ZWx5IGZpcmUgYW4gaW5pdGlhbCBldmVudCwgaW5kaWNhdGluZyBhbGwgZXhpc3RpbmcgbGlzdGVuZXJzXG4gICAgICAgIC8vIGFyZSBpbi1zeW5jLlxuICAgICAgICBlLm5leHQoKTtcbiAgICB9KGF3YWl0IFdhKHQpLCBuKSkpLCAoKSA9PiB7XG4gICAgICAgIG4uQWEoKSwgdC5hc3luY1F1ZXVlLmVucXVldWVBbmRGb3JnZXQoKGFzeW5jICgpID0+IGZ1bmN0aW9uKHQsIGUpIHtcbiAgICAgICAgICAgIEsodCkuYnUuZGVsZXRlKGUpO1xuICAgICAgICB9KGF3YWl0IFdhKHQpLCBuKSkpO1xuICAgIH07XG59XG5cbi8qKlxuICogVGFrZXMgYW4gdXBkYXRlRnVuY3Rpb24gaW4gd2hpY2ggYSBzZXQgb2YgcmVhZHMgYW5kIHdyaXRlcyBjYW4gYmUgcGVyZm9ybWVkXG4gKiBhdG9taWNhbGx5LiBJbiB0aGUgdXBkYXRlRnVuY3Rpb24sIHRoZSBjbGllbnQgY2FuIHJlYWQgYW5kIHdyaXRlIHZhbHVlc1xuICogdXNpbmcgdGhlIHN1cHBsaWVkIHRyYW5zYWN0aW9uIG9iamVjdC4gQWZ0ZXIgdGhlIHVwZGF0ZUZ1bmN0aW9uLCBhbGxcbiAqIGNoYW5nZXMgd2lsbCBiZSBjb21taXR0ZWQuIElmIGEgcmV0cnlhYmxlIGVycm9yIG9jY3VycyAoZXg6IHNvbWUgb3RoZXJcbiAqIGNsaWVudCBoYXMgY2hhbmdlZCBhbnkgb2YgdGhlIGRhdGEgcmVmZXJlbmNlZCksIHRoZW4gdGhlIHVwZGF0ZUZ1bmN0aW9uXG4gKiB3aWxsIGJlIGNhbGxlZCBhZ2FpbiBhZnRlciBhIGJhY2tvZmYuIElmIHRoZSB1cGRhdGVGdW5jdGlvbiBzdGlsbCBmYWlsc1xuICogYWZ0ZXIgYWxsIHJldHJpZXMsIHRoZW4gdGhlIHRyYW5zYWN0aW9uIHdpbGwgYmUgcmVqZWN0ZWQuXG4gKlxuICogVGhlIHRyYW5zYWN0aW9uIG9iamVjdCBwYXNzZWQgdG8gdGhlIHVwZGF0ZUZ1bmN0aW9uIGNvbnRhaW5zIG1ldGhvZHMgZm9yXG4gKiBhY2Nlc3NpbmcgZG9jdW1lbnRzIGFuZCBjb2xsZWN0aW9ucy4gVW5saWtlIG90aGVyIGRhdGFzdG9yZSBhY2Nlc3MsIGRhdGFcbiAqIGFjY2Vzc2VkIHdpdGggdGhlIHRyYW5zYWN0aW9uIHdpbGwgbm90IHJlZmxlY3QgbG9jYWwgY2hhbmdlcyB0aGF0IGhhdmUgbm90XG4gKiBiZWVuIGNvbW1pdHRlZC4gRm9yIHRoaXMgcmVhc29uLCBpdCBpcyByZXF1aXJlZCB0aGF0IGFsbCByZWFkcyBhcmVcbiAqIHBlcmZvcm1lZCBiZWZvcmUgYW55IHdyaXRlcy4gVHJhbnNhY3Rpb25zIG11c3QgYmUgcGVyZm9ybWVkIHdoaWxlIG9ubGluZS5cbiAqLyBmdW5jdGlvbiBlYyh0LCBlLCBuKSB7XG4gICAgY29uc3QgcyA9IG5ldyBqO1xuICAgIHJldHVybiB0LmFzeW5jUXVldWUuZW5xdWV1ZUFuZEZvcmdldCgoYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCBpID0gYXdhaXQgZnVuY3Rpb24odCkge1xuICAgICAgICAgICAgcmV0dXJuIHFhKHQpLnRoZW4oKHQgPT4gdC5kYXRhc3RvcmUpKTtcbiAgICAgICAgfSh0KTtcbiAgICAgICAgbmV3IEZhKHQuYXN5bmNRdWV1ZSwgaSwgbiwgZSwgcykucnVuKCk7XG4gICAgfSkpLCBzLnByb21pc2U7XG59XG5cbmZ1bmN0aW9uIG5jKHQsIGUsIG4sIHMpIHtcbiAgICBjb25zdCBpID0gZnVuY3Rpb24odCwgZSkge1xuICAgICAgICBsZXQgbjtcbiAgICAgICAgbiA9IFwic3RyaW5nXCIgPT0gdHlwZW9mIHQgPyAobmV3IFRleHRFbmNvZGVyKS5lbmNvZGUodCkgOiB0O1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24odCwgZSkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBNYSh0LCBlKTtcbiAgICAgICAgfShmdW5jdGlvbih0LCBlKSB7XG4gICAgICAgICAgICBpZiAodCBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkpIHJldHVybiBOYSh0LCBlKTtcbiAgICAgICAgICAgIGlmICh0IGluc3RhbmNlb2YgQXJyYXlCdWZmZXIpIHJldHVybiBOYShuZXcgVWludDhBcnJheSh0KSwgZSk7XG4gICAgICAgICAgICBpZiAodCBpbnN0YW5jZW9mIFJlYWRhYmxlU3RyZWFtKSByZXR1cm4gdC5nZXRSZWFkZXIoKTtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlNvdXJjZSBvZiBgdG9CeXRlU3RyZWFtUmVhZGVyYCBoYXMgdG8gYmUgYSBBcnJheUJ1ZmZlciBvciBSZWFkYWJsZVN0cmVhbVwiKTtcbiAgICAgICAgfShuKSwgZSk7XG4gICAgfVxuICAgIC8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovIChuLCBqbyhlKSk7XG4gICAgdC5hc3luY1F1ZXVlLmVucXVldWVBbmRGb3JnZXQoKGFzeW5jICgpID0+IHtcbiAgICAgICAgdmEoYXdhaXQgamEodCksIGksIHMpO1xuICAgIH0pKTtcbn1cblxuZnVuY3Rpb24gc2ModCwgZSkge1xuICAgIHJldHVybiB0LmFzeW5jUXVldWUuZW5xdWV1ZSgoYXN5bmMgKCkgPT4gZnVuY3Rpb24odCwgZSkge1xuICAgICAgICBjb25zdCBuID0gSyh0KTtcbiAgICAgICAgcmV0dXJuIG4ucGVyc2lzdGVuY2UucnVuVHJhbnNhY3Rpb24oXCJHZXQgbmFtZWQgcXVlcnlcIiwgXCJyZWFkb25seVwiLCAodCA9PiBuLl9zLmdldE5hbWVkUXVlcnkodCwgZSkpKTtcbiAgICB9KGF3YWl0IEdhKHQpLCBlKSkpO1xufVxuXG5jb25zdCBpYyA9IG5ldyBNYXA7XG5cbi8qKlxuICogQW4gaW5zdGFuY2UgbWFwIHRoYXQgZW5zdXJlcyBvbmx5IG9uZSBEYXRhc3RvcmUgZXhpc3RzIHBlciBGaXJlc3RvcmVcbiAqIGluc3RhbmNlLlxuICovXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuZnVuY3Rpb24gcmModCwgZSwgbikge1xuICAgIGlmICghbikgdGhyb3cgbmV3IFEoRy5JTlZBTElEX0FSR1VNRU5ULCBgRnVuY3Rpb24gJHt0fSgpIGNhbm5vdCBiZSBjYWxsZWQgd2l0aCBhbiBlbXB0eSAke2V9LmApO1xufVxuXG4vKipcbiAqIFZhbGlkYXRlcyB0aGF0IHR3byBib29sZWFuIG9wdGlvbnMgYXJlIG5vdCBzZXQgYXQgdGhlIHNhbWUgdGltZS5cbiAqIEBpbnRlcm5hbFxuICovIGZ1bmN0aW9uIG9jKHQsIGUsIG4sIHMpIHtcbiAgICBpZiAoITAgPT09IGUgJiYgITAgPT09IHMpIHRocm93IG5ldyBRKEcuSU5WQUxJRF9BUkdVTUVOVCwgYCR7dH0gYW5kICR7bn0gY2Fubm90IGJlIHVzZWQgdG9nZXRoZXIuYCk7XG59XG5cbi8qKlxuICogVmFsaWRhdGVzIHRoYXQgYHBhdGhgIHJlZmVycyB0byBhIGRvY3VtZW50IChpbmRpY2F0ZWQgYnkgdGhlIGZhY3QgaXQgY29udGFpbnNcbiAqIGFuIGV2ZW4gbnVtYmVycyBvZiBzZWdtZW50cykuXG4gKi8gZnVuY3Rpb24gdWModCkge1xuICAgIGlmICgheHQuaXNEb2N1bWVudEtleSh0KSkgdGhyb3cgbmV3IFEoRy5JTlZBTElEX0FSR1VNRU5ULCBgSW52YWxpZCBkb2N1bWVudCByZWZlcmVuY2UuIERvY3VtZW50IHJlZmVyZW5jZXMgbXVzdCBoYXZlIGFuIGV2ZW4gbnVtYmVyIG9mIHNlZ21lbnRzLCBidXQgJHt0fSBoYXMgJHt0Lmxlbmd0aH0uYCk7XG59XG5cbi8qKlxuICogVmFsaWRhdGVzIHRoYXQgYHBhdGhgIHJlZmVycyB0byBhIGNvbGxlY3Rpb24gKGluZGljYXRlZCBieSB0aGUgZmFjdCBpdFxuICogY29udGFpbnMgYW4gb2RkIG51bWJlcnMgb2Ygc2VnbWVudHMpLlxuICovIGZ1bmN0aW9uIGFjKHQpIHtcbiAgICBpZiAoeHQuaXNEb2N1bWVudEtleSh0KSkgdGhyb3cgbmV3IFEoRy5JTlZBTElEX0FSR1VNRU5ULCBgSW52YWxpZCBjb2xsZWN0aW9uIHJlZmVyZW5jZS4gQ29sbGVjdGlvbiByZWZlcmVuY2VzIG11c3QgaGF2ZSBhbiBvZGQgbnVtYmVyIG9mIHNlZ21lbnRzLCBidXQgJHt0fSBoYXMgJHt0Lmxlbmd0aH0uYCk7XG59XG5cbi8qKlxuICogUmV0dXJucyB0cnVlIGlmIGl0J3MgYSBub24tbnVsbCBvYmplY3Qgd2l0aG91dCBhIGN1c3RvbSBwcm90b3R5cGVcbiAqIChpLmUuIGV4Y2x1ZGVzIEFycmF5LCBEYXRlLCBldGMuKS5cbiAqL1xuLyoqIFJldHVybnMgYSBzdHJpbmcgZGVzY3JpYmluZyB0aGUgdHlwZSAvIHZhbHVlIG9mIHRoZSBwcm92aWRlZCBpbnB1dC4gKi9cbmZ1bmN0aW9uIGNjKHQpIHtcbiAgICBpZiAodm9pZCAwID09PSB0KSByZXR1cm4gXCJ1bmRlZmluZWRcIjtcbiAgICBpZiAobnVsbCA9PT0gdCkgcmV0dXJuIFwibnVsbFwiO1xuICAgIGlmIChcInN0cmluZ1wiID09IHR5cGVvZiB0KSByZXR1cm4gdC5sZW5ndGggPiAyMCAmJiAodCA9IGAke3Quc3Vic3RyaW5nKDAsIDIwKX0uLi5gKSwgXG4gICAgSlNPTi5zdHJpbmdpZnkodCk7XG4gICAgaWYgKFwibnVtYmVyXCIgPT0gdHlwZW9mIHQgfHwgXCJib29sZWFuXCIgPT0gdHlwZW9mIHQpIHJldHVybiBcIlwiICsgdDtcbiAgICBpZiAoXCJvYmplY3RcIiA9PSB0eXBlb2YgdCkge1xuICAgICAgICBpZiAodCBpbnN0YW5jZW9mIEFycmF5KSByZXR1cm4gXCJhbiBhcnJheVwiO1xuICAgICAgICB7XG4gICAgICAgICAgICBjb25zdCBlID0gXG4gICAgICAgICAgICAvKiogdHJ5IHRvIGdldCB0aGUgY29uc3RydWN0b3IgbmFtZSBmb3IgYW4gb2JqZWN0LiAqL1xuICAgICAgICAgICAgZnVuY3Rpb24odCkge1xuICAgICAgICAgICAgICAgIGlmICh0LmNvbnN0cnVjdG9yKSByZXR1cm4gdC5jb25zdHJ1Y3Rvci5uYW1lO1xuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLyoqXG4gKiBDYXN0cyBgb2JqYCB0byBgVGAsIG9wdGlvbmFsbHkgdW53cmFwcGluZyBDb21wYXQgdHlwZXMgdG8gZXhwb3NlIHRoZVxuICogdW5kZXJseWluZyBpbnN0YW5jZS4gVGhyb3dzIGlmICBgb2JqYCBpcyBub3QgYW4gaW5zdGFuY2Ugb2YgYFRgLlxuICpcbiAqIFRoaXMgY2FzdCBpcyB1c2VkIGluIHRoZSBMaXRlIGFuZCBGdWxsIFNESyB0byB2ZXJpZnkgaW5zdGFuY2UgdHlwZXMgZm9yXG4gKiBhcmd1bWVudHMgcGFzc2VkIHRvIHRoZSBwdWJsaWMgQVBJLlxuICogQGludGVybmFsXG4gKi8gKHQpO1xuICAgICAgICAgICAgcmV0dXJuIGUgPyBgYSBjdXN0b20gJHtlfSBvYmplY3RgIDogXCJhbiBvYmplY3RcIjtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gXCJmdW5jdGlvblwiID09IHR5cGVvZiB0ID8gXCJhIGZ1bmN0aW9uXCIgOiBMKCk7XG59XG5cbmZ1bmN0aW9uIGhjKHQsIFxuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbmUpIHtcbiAgICBpZiAoXCJfZGVsZWdhdGVcIiBpbiB0ICYmIChcbiAgICAvLyBVbndyYXAgQ29tcGF0IHR5cGVzXG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbiAgICB0ID0gdC5fZGVsZWdhdGUpLCAhKHQgaW5zdGFuY2VvZiBlKSkge1xuICAgICAgICBpZiAoZS5uYW1lID09PSB0LmNvbnN0cnVjdG9yLm5hbWUpIHRocm93IG5ldyBRKEcuSU5WQUxJRF9BUkdVTUVOVCwgXCJUeXBlIGRvZXMgbm90IG1hdGNoIHRoZSBleHBlY3RlZCBpbnN0YW5jZS4gRGlkIHlvdSBwYXNzIGEgcmVmZXJlbmNlIGZyb20gYSBkaWZmZXJlbnQgRmlyZXN0b3JlIFNESz9cIik7XG4gICAgICAgIHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSBjYyh0KTtcbiAgICAgICAgICAgIHRocm93IG5ldyBRKEcuSU5WQUxJRF9BUkdVTUVOVCwgYEV4cGVjdGVkIHR5cGUgJyR7ZS5uYW1lfScsIGJ1dCBpdCB3YXM6ICR7bn1gKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdDtcbn1cblxuZnVuY3Rpb24gbGModCwgZSkge1xuICAgIGlmIChlIDw9IDApIHRocm93IG5ldyBRKEcuSU5WQUxJRF9BUkdVTUVOVCwgYEZ1bmN0aW9uICR7dH0oKSByZXF1aXJlcyBhIHBvc2l0aXZlIG51bWJlciwgYnV0IGl0IHdhczogJHtlfS5gKTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8vIHNldHRpbmdzKCkgZGVmYXVsdHM6XG4vKipcbiAqIEEgY29uY3JldGUgdHlwZSBkZXNjcmliaW5nIGFsbCB0aGUgdmFsdWVzIHRoYXQgY2FuIGJlIGFwcGxpZWQgdmlhIGFcbiAqIHVzZXItc3VwcGxpZWQgYEZpcmVzdG9yZVNldHRpbmdzYCBvYmplY3QuIFRoaXMgaXMgYSBzZXBhcmF0ZSB0eXBlIHNvIHRoYXRcbiAqIGRlZmF1bHRzIGNhbiBiZSBzdXBwbGllZCBhbmQgdGhlIHZhbHVlIGNhbiBiZSBjaGVja2VkIGZvciBlcXVhbGl0eS5cbiAqL1xuY2xhc3MgZmMge1xuICAgIGNvbnN0cnVjdG9yKHQpIHtcbiAgICAgICAgdmFyIGU7XG4gICAgICAgIGlmICh2b2lkIDAgPT09IHQuaG9zdCkge1xuICAgICAgICAgICAgaWYgKHZvaWQgMCAhPT0gdC5zc2wpIHRocm93IG5ldyBRKEcuSU5WQUxJRF9BUkdVTUVOVCwgXCJDYW4ndCBwcm92aWRlIHNzbCBvcHRpb24gaWYgaG9zdCBvcHRpb24gaXMgbm90IHNldFwiKTtcbiAgICAgICAgICAgIHRoaXMuaG9zdCA9IFwiZmlyZXN0b3JlLmdvb2dsZWFwaXMuY29tXCIsIHRoaXMuc3NsID0gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIHRoaXMuaG9zdCA9IHQuaG9zdCwgdGhpcy5zc2wgPSBudWxsID09PSAoZSA9IHQuc3NsKSB8fCB2b2lkIDAgPT09IGUgfHwgZTtcbiAgICAgICAgaWYgKHRoaXMuY3JlZGVudGlhbHMgPSB0LmNyZWRlbnRpYWxzLCB0aGlzLmlnbm9yZVVuZGVmaW5lZFByb3BlcnRpZXMgPSAhIXQuaWdub3JlVW5kZWZpbmVkUHJvcGVydGllcywgXG4gICAgICAgIHZvaWQgMCA9PT0gdC5jYWNoZVNpemVCeXRlcykgdGhpcy5jYWNoZVNpemVCeXRlcyA9IDQxOTQzMDQwOyBlbHNlIHtcbiAgICAgICAgICAgIGlmICgtMSAhPT0gdC5jYWNoZVNpemVCeXRlcyAmJiB0LmNhY2hlU2l6ZUJ5dGVzIDwgMTA0ODU3NikgdGhyb3cgbmV3IFEoRy5JTlZBTElEX0FSR1VNRU5ULCBcImNhY2hlU2l6ZUJ5dGVzIG11c3QgYmUgYXQgbGVhc3QgMTA0ODU3NlwiKTtcbiAgICAgICAgICAgIHRoaXMuY2FjaGVTaXplQnl0ZXMgPSB0LmNhY2hlU2l6ZUJ5dGVzO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZXhwZXJpbWVudGFsRm9yY2VMb25nUG9sbGluZyA9ICEhdC5leHBlcmltZW50YWxGb3JjZUxvbmdQb2xsaW5nLCB0aGlzLmV4cGVyaW1lbnRhbEF1dG9EZXRlY3RMb25nUG9sbGluZyA9ICEhdC5leHBlcmltZW50YWxBdXRvRGV0ZWN0TG9uZ1BvbGxpbmcsIFxuICAgICAgICB0aGlzLnVzZUZldGNoU3RyZWFtcyA9ICEhdC51c2VGZXRjaFN0cmVhbXMsIG9jKFwiZXhwZXJpbWVudGFsRm9yY2VMb25nUG9sbGluZ1wiLCB0LmV4cGVyaW1lbnRhbEZvcmNlTG9uZ1BvbGxpbmcsIFwiZXhwZXJpbWVudGFsQXV0b0RldGVjdExvbmdQb2xsaW5nXCIsIHQuZXhwZXJpbWVudGFsQXV0b0RldGVjdExvbmdQb2xsaW5nKTtcbiAgICB9XG4gICAgaXNFcXVhbCh0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLmhvc3QgPT09IHQuaG9zdCAmJiB0aGlzLnNzbCA9PT0gdC5zc2wgJiYgdGhpcy5jcmVkZW50aWFscyA9PT0gdC5jcmVkZW50aWFscyAmJiB0aGlzLmNhY2hlU2l6ZUJ5dGVzID09PSB0LmNhY2hlU2l6ZUJ5dGVzICYmIHRoaXMuZXhwZXJpbWVudGFsRm9yY2VMb25nUG9sbGluZyA9PT0gdC5leHBlcmltZW50YWxGb3JjZUxvbmdQb2xsaW5nICYmIHRoaXMuZXhwZXJpbWVudGFsQXV0b0RldGVjdExvbmdQb2xsaW5nID09PSB0LmV4cGVyaW1lbnRhbEF1dG9EZXRlY3RMb25nUG9sbGluZyAmJiB0aGlzLmlnbm9yZVVuZGVmaW5lZFByb3BlcnRpZXMgPT09IHQuaWdub3JlVW5kZWZpbmVkUHJvcGVydGllcyAmJiB0aGlzLnVzZUZldGNoU3RyZWFtcyA9PT0gdC51c2VGZXRjaFN0cmVhbXM7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBUaGUgQ2xvdWQgRmlyZXN0b3JlIHNlcnZpY2UgaW50ZXJmYWNlLlxuICpcbiAqIERvIG5vdCBjYWxsIHRoaXMgY29uc3RydWN0b3IgZGlyZWN0bHkuIEluc3RlYWQsIHVzZSB7QGxpbmsgZ2V0RmlyZXN0b3JlfS5cbiAqLyBjbGFzcyBkYyB7XG4gICAgLyoqIEBoaWRlY29uc3RydWN0b3IgKi9cbiAgICBjb25zdHJ1Y3Rvcih0LCBlLCBuKSB7XG4gICAgICAgIHRoaXMuX2F1dGhDcmVkZW50aWFscyA9IGUsIHRoaXMuX2FwcENoZWNrQ3JlZGVudGlhbHMgPSBuLCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFdoZXRoZXIgaXQncyBhIEZpcmVzdG9yZSBvciBGaXJlc3RvcmUgTGl0ZSBpbnN0YW5jZS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMudHlwZSA9IFwiZmlyZXN0b3JlLWxpdGVcIiwgdGhpcy5fcGVyc2lzdGVuY2VLZXkgPSBcIihsaXRlKVwiLCB0aGlzLl9zZXR0aW5ncyA9IG5ldyBmYyh7fSksIFxuICAgICAgICB0aGlzLl9zZXR0aW5nc0Zyb3plbiA9ICExLCB0IGluc3RhbmNlb2YgdnQgPyB0aGlzLl9kYXRhYmFzZUlkID0gdCA6ICh0aGlzLl9hcHAgPSB0LCBcbiAgICAgICAgdGhpcy5fZGF0YWJhc2VJZCA9IGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgICAgIGlmICghT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5hcHBseSh0Lm9wdGlvbnMsIFsgXCJwcm9qZWN0SWRcIiBdKSkgdGhyb3cgbmV3IFEoRy5JTlZBTElEX0FSR1VNRU5ULCAnXCJwcm9qZWN0SWRcIiBub3QgcHJvdmlkZWQgaW4gZmlyZWJhc2UuaW5pdGlhbGl6ZUFwcC4nKTtcbiAgICAgICAgICAgIHJldHVybiBuZXcgdnQodC5vcHRpb25zLnByb2plY3RJZCk7XG4gICAgICAgIH1cbiAgICAgICAgLyoqXG4gKiBNb2RpZnkgdGhpcyBpbnN0YW5jZSB0byBjb21tdW5pY2F0ZSB3aXRoIHRoZSBDbG91ZCBGaXJlc3RvcmUgZW11bGF0b3IuXG4gKlxuICogTm90ZTogVGhpcyBtdXN0IGJlIGNhbGxlZCBiZWZvcmUgdGhpcyBpbnN0YW5jZSBoYXMgYmVlbiB1c2VkIHRvIGRvIGFueVxuICogb3BlcmF0aW9ucy5cbiAqXG4gKiBAcGFyYW0gZmlyZXN0b3JlIC0gVGhlIGBGaXJlc3RvcmVgIGluc3RhbmNlIHRvIGNvbmZpZ3VyZSB0byBjb25uZWN0IHRvIHRoZVxuICogZW11bGF0b3IuXG4gKiBAcGFyYW0gaG9zdCAtIHRoZSBlbXVsYXRvciBob3N0IChleDogbG9jYWxob3N0KS5cbiAqIEBwYXJhbSBwb3J0IC0gdGhlIGVtdWxhdG9yIHBvcnQgKGV4OiA5MDAwKS5cbiAqIEBwYXJhbSBvcHRpb25zLm1vY2tVc2VyVG9rZW4gLSB0aGUgbW9jayBhdXRoIHRva2VuIHRvIHVzZSBmb3IgdW5pdCB0ZXN0aW5nXG4gKiBTZWN1cml0eSBSdWxlcy5cbiAqLyAodCkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBUaGUge0BsaW5rIEBmaXJlYmFzZS9hcHAjRmlyZWJhc2VBcHB9IGFzc29jaWF0ZWQgd2l0aCB0aGlzIGBGaXJlc3RvcmVgIHNlcnZpY2VcbiAgICAgKiBpbnN0YW5jZS5cbiAgICAgKi8gICAgZ2V0IGFwcCgpIHtcbiAgICAgICAgaWYgKCF0aGlzLl9hcHApIHRocm93IG5ldyBRKEcuRkFJTEVEX1BSRUNPTkRJVElPTiwgXCJGaXJlc3RvcmUgd2FzIG5vdCBpbml0aWFsaXplZCB1c2luZyB0aGUgRmlyZWJhc2UgU0RLLiAnYXBwJyBpcyBub3QgYXZhaWxhYmxlXCIpO1xuICAgICAgICByZXR1cm4gdGhpcy5fYXBwO1xuICAgIH1cbiAgICBnZXQgX2luaXRpYWxpemVkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fc2V0dGluZ3NGcm96ZW47XG4gICAgfVxuICAgIGdldCBfdGVybWluYXRlZCgpIHtcbiAgICAgICAgcmV0dXJuIHZvaWQgMCAhPT0gdGhpcy5fdGVybWluYXRlVGFzaztcbiAgICB9XG4gICAgX3NldFNldHRpbmdzKHQpIHtcbiAgICAgICAgaWYgKHRoaXMuX3NldHRpbmdzRnJvemVuKSB0aHJvdyBuZXcgUShHLkZBSUxFRF9QUkVDT05ESVRJT04sIFwiRmlyZXN0b3JlIGhhcyBhbHJlYWR5IGJlZW4gc3RhcnRlZCBhbmQgaXRzIHNldHRpbmdzIGNhbiBubyBsb25nZXIgYmUgY2hhbmdlZC4gWW91IGNhbiBvbmx5IG1vZGlmeSBzZXR0aW5ncyBiZWZvcmUgY2FsbGluZyBhbnkgb3RoZXIgbWV0aG9kcyBvbiBhIEZpcmVzdG9yZSBvYmplY3QuXCIpO1xuICAgICAgICB0aGlzLl9zZXR0aW5ncyA9IG5ldyBmYyh0KSwgdm9pZCAwICE9PSB0LmNyZWRlbnRpYWxzICYmICh0aGlzLl9hdXRoQ3JlZGVudGlhbHMgPSBmdW5jdGlvbih0KSB7XG4gICAgICAgICAgICBpZiAoIXQpIHJldHVybiBuZXcgejtcbiAgICAgICAgICAgIHN3aXRjaCAodC50eXBlKSB7XG4gICAgICAgICAgICAgIGNhc2UgXCJnYXBpXCI6XG4gICAgICAgICAgICAgICAgY29uc3QgZSA9IHQuY2xpZW50O1xuICAgICAgICAgICAgICAgIC8vIE1ha2Ugc3VyZSB0aGlzIHJlYWxseSBpcyBhIEdhcGkgY2xpZW50LlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gVSghKFwib2JqZWN0XCIgIT0gdHlwZW9mIGUgfHwgbnVsbCA9PT0gZSB8fCAhZS5hdXRoIHx8ICFlLmF1dGguZ2V0QXV0aEhlYWRlclZhbHVlRm9yRmlyc3RQYXJ0eSkpLCBcbiAgICAgICAgICAgICAgICBuZXcgWChlLCB0LnNlc3Npb25JbmRleCB8fCBcIjBcIiwgdC5pYW1Ub2tlbiB8fCBudWxsKTtcblxuICAgICAgICAgICAgICBjYXNlIFwicHJvdmlkZXJcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gdC5jbGllbnQ7XG5cbiAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgUShHLklOVkFMSURfQVJHVU1FTlQsIFwibWFrZUF1dGhDcmVkZW50aWFsc1Byb3ZpZGVyIGZhaWxlZCBkdWUgdG8gaW52YWxpZCBjcmVkZW50aWFsIHR5cGVcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0odC5jcmVkZW50aWFscykpO1xuICAgIH1cbiAgICBfZ2V0U2V0dGluZ3MoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9zZXR0aW5ncztcbiAgICB9XG4gICAgX2ZyZWV6ZVNldHRpbmdzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fc2V0dGluZ3NGcm96ZW4gPSAhMCwgdGhpcy5fc2V0dGluZ3M7XG4gICAgfVxuICAgIF9kZWxldGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl90ZXJtaW5hdGVUYXNrIHx8ICh0aGlzLl90ZXJtaW5hdGVUYXNrID0gdGhpcy5fdGVybWluYXRlKCkpLCB0aGlzLl90ZXJtaW5hdGVUYXNrO1xuICAgIH1cbiAgICAvKiogUmV0dXJucyBhIEpTT04tc2VyaWFsaXphYmxlIHJlcHJlc2VudGF0aW9uIG9mIHRoaXMgYEZpcmVzdG9yZWAgaW5zdGFuY2UuICovICAgIHRvSlNPTigpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGFwcDogdGhpcy5fYXBwLFxuICAgICAgICAgICAgZGF0YWJhc2VJZDogdGhpcy5fZGF0YWJhc2VJZCxcbiAgICAgICAgICAgIHNldHRpbmdzOiB0aGlzLl9zZXR0aW5nc1xuICAgICAgICB9O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBUZXJtaW5hdGVzIGFsbCBjb21wb25lbnRzIHVzZWQgYnkgdGhpcyBjbGllbnQuIFN1YmNsYXNzZXMgY2FuIG92ZXJyaWRlXG4gICAgICogdGhpcyBtZXRob2QgdG8gY2xlYW4gdXAgdGhlaXIgb3duIGRlcGVuZGVuY2llcywgYnV0IG11c3QgYWxzbyBjYWxsIHRoaXNcbiAgICAgKiBtZXRob2QuXG4gICAgICpcbiAgICAgKiBPbmx5IGV2ZXIgY2FsbGVkIG9uY2UuXG4gICAgICovICAgIF90ZXJtaW5hdGUoKSB7XG4gICAgICAgIC8qKlxuICogUmVtb3ZlcyBhbGwgY29tcG9uZW50cyBhc3NvY2lhdGVkIHdpdGggdGhlIHByb3ZpZGVkIGluc3RhbmNlLiBNdXN0IGJlIGNhbGxlZFxuICogd2hlbiB0aGUgYEZpcmVzdG9yZWAgaW5zdGFuY2UgaXMgdGVybWluYXRlZC5cbiAqL1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24odCkge1xuICAgICAgICAgICAgY29uc3QgZSA9IGljLmdldCh0KTtcbiAgICAgICAgICAgIGUgJiYgKE8oXCJDb21wb25lbnRQcm92aWRlclwiLCBcIlJlbW92aW5nIERhdGFzdG9yZVwiKSwgaWMuZGVsZXRlKHQpLCBlLnRlcm1pbmF0ZSgpKTtcbiAgICAgICAgfSh0aGlzKSwgUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBfYyh0LCBlLCBuLCBzID0ge30pIHtcbiAgICB2YXIgaTtcbiAgICBjb25zdCByID0gKHQgPSBoYyh0LCBkYykpLl9nZXRTZXR0aW5ncygpO1xuICAgIGlmIChcImZpcmVzdG9yZS5nb29nbGVhcGlzLmNvbVwiICE9PSByLmhvc3QgJiYgci5ob3N0ICE9PSBlICYmICQoXCJIb3N0IGhhcyBiZWVuIHNldCBpbiBib3RoIHNldHRpbmdzKCkgYW5kIHVzZUVtdWxhdG9yKCksIGVtdWxhdG9yIGhvc3Qgd2lsbCBiZSB1c2VkXCIpLCBcbiAgICB0Ll9zZXRTZXR0aW5ncyhPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIHIpLCB7XG4gICAgICAgIGhvc3Q6IGAke2V9OiR7bn1gLFxuICAgICAgICBzc2w6ICExXG4gICAgfSkpLCBzLm1vY2tVc2VyVG9rZW4pIHtcbiAgICAgICAgbGV0IGUsIG47XG4gICAgICAgIGlmIChcInN0cmluZ1wiID09IHR5cGVvZiBzLm1vY2tVc2VyVG9rZW4pIGUgPSBzLm1vY2tVc2VyVG9rZW4sIG4gPSBDLk1PQ0tfVVNFUjsgZWxzZSB7XG4gICAgICAgICAgICAvLyBMZXQgY3JlYXRlTW9ja1VzZXJUb2tlbiB2YWxpZGF0ZSBmaXJzdCAoY2F0Y2hlcyBjb21tb24gbWlzdGFrZXMgbGlrZVxuICAgICAgICAgICAgLy8gaW52YWxpZCBmaWVsZCBcInVpZFwiIGFuZCBtaXNzaW5nIGZpZWxkIFwic3ViXCIgLyBcInVzZXJfaWRcIi4pXG4gICAgICAgICAgICBlID0geShzLm1vY2tVc2VyVG9rZW4sIG51bGwgPT09IChpID0gdC5fYXBwKSB8fCB2b2lkIDAgPT09IGkgPyB2b2lkIDAgOiBpLm9wdGlvbnMucHJvamVjdElkKTtcbiAgICAgICAgICAgIGNvbnN0IHIgPSBzLm1vY2tVc2VyVG9rZW4uc3ViIHx8IHMubW9ja1VzZXJUb2tlbi51c2VyX2lkO1xuICAgICAgICAgICAgaWYgKCFyKSB0aHJvdyBuZXcgUShHLklOVkFMSURfQVJHVU1FTlQsIFwibW9ja1VzZXJUb2tlbiBtdXN0IGNvbnRhaW4gJ3N1Yicgb3IgJ3VzZXJfaWQnIGZpZWxkIVwiKTtcbiAgICAgICAgICAgIG4gPSBuZXcgQyhyKTtcbiAgICAgICAgfVxuICAgICAgICB0Ll9hdXRoQ3JlZGVudGlhbHMgPSBuZXcgSChuZXcgVyhlLCBuKSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBBIGBEb2N1bWVudFJlZmVyZW5jZWAgcmVmZXJzIHRvIGEgZG9jdW1lbnQgbG9jYXRpb24gaW4gYSBGaXJlc3RvcmUgZGF0YWJhc2VcbiAqIGFuZCBjYW4gYmUgdXNlZCB0byB3cml0ZSwgcmVhZCwgb3IgbGlzdGVuIHRvIHRoZSBsb2NhdGlvbi4gVGhlIGRvY3VtZW50IGF0XG4gKiB0aGUgcmVmZXJlbmNlZCBsb2NhdGlvbiBtYXkgb3IgbWF5IG5vdCBleGlzdC5cbiAqLyBjbGFzcyB3YyB7XG4gICAgLyoqIEBoaWRlY29uc3RydWN0b3IgKi9cbiAgICBjb25zdHJ1Y3Rvcih0LCBcbiAgICAvKipcbiAgICAgKiBJZiBwcm92aWRlZCwgdGhlIGBGaXJlc3RvcmVEYXRhQ29udmVydGVyYCBhc3NvY2lhdGVkIHdpdGggdGhpcyBpbnN0YW5jZS5cbiAgICAgKi9cbiAgICBlLCBuKSB7XG4gICAgICAgIHRoaXMuY29udmVydGVyID0gZSwgdGhpcy5fa2V5ID0gbiwgXG4gICAgICAgIC8qKiBUaGUgdHlwZSBvZiB0aGlzIEZpcmVzdG9yZSByZWZlcmVuY2UuICovXG4gICAgICAgIHRoaXMudHlwZSA9IFwiZG9jdW1lbnRcIiwgdGhpcy5maXJlc3RvcmUgPSB0O1xuICAgIH1cbiAgICBnZXQgX3BhdGgoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9rZXkucGF0aDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVGhlIGRvY3VtZW50J3MgaWRlbnRpZmllciB3aXRoaW4gaXRzIGNvbGxlY3Rpb24uXG4gICAgICovICAgIGdldCBpZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2tleS5wYXRoLmxhc3RTZWdtZW50KCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEEgc3RyaW5nIHJlcHJlc2VudGluZyB0aGUgcGF0aCBvZiB0aGUgcmVmZXJlbmNlZCBkb2N1bWVudCAocmVsYXRpdmVcbiAgICAgKiB0byB0aGUgcm9vdCBvZiB0aGUgZGF0YWJhc2UpLlxuICAgICAqLyAgICBnZXQgcGF0aCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2tleS5wYXRoLmNhbm9uaWNhbFN0cmluZygpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBUaGUgY29sbGVjdGlvbiB0aGlzIGBEb2N1bWVudFJlZmVyZW5jZWAgYmVsb25ncyB0by5cbiAgICAgKi8gICAgZ2V0IHBhcmVudCgpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBnYyh0aGlzLmZpcmVzdG9yZSwgdGhpcy5jb252ZXJ0ZXIsIHRoaXMuX2tleS5wYXRoLnBvcExhc3QoKSk7XG4gICAgfVxuICAgIHdpdGhDb252ZXJ0ZXIodCkge1xuICAgICAgICByZXR1cm4gbmV3IHdjKHRoaXMuZmlyZXN0b3JlLCB0LCB0aGlzLl9rZXkpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBBIGBRdWVyeWAgcmVmZXJzIHRvIGEgcXVlcnkgd2hpY2ggeW91IGNhbiByZWFkIG9yIGxpc3RlbiB0by4gWW91IGNhbiBhbHNvXG4gKiBjb25zdHJ1Y3QgcmVmaW5lZCBgUXVlcnlgIG9iamVjdHMgYnkgYWRkaW5nIGZpbHRlcnMgYW5kIG9yZGVyaW5nLlxuICovIGNsYXNzIG1jIHtcbiAgICAvLyBUaGlzIGlzIHRoZSBsaXRlIHZlcnNpb24gb2YgdGhlIFF1ZXJ5IGNsYXNzIGluIHRoZSBtYWluIFNESy5cbiAgICAvKiogQGhpZGVjb25zdHJ1Y3RvciBwcm90ZWN0ZWQgKi9cbiAgICBjb25zdHJ1Y3Rvcih0LCBcbiAgICAvKipcbiAgICAgKiBJZiBwcm92aWRlZCwgdGhlIGBGaXJlc3RvcmVEYXRhQ29udmVydGVyYCBhc3NvY2lhdGVkIHdpdGggdGhpcyBpbnN0YW5jZS5cbiAgICAgKi9cbiAgICBlLCBuKSB7XG4gICAgICAgIHRoaXMuY29udmVydGVyID0gZSwgdGhpcy5fcXVlcnkgPSBuLCBcbiAgICAgICAgLyoqIFRoZSB0eXBlIG9mIHRoaXMgRmlyZXN0b3JlIHJlZmVyZW5jZS4gKi9cbiAgICAgICAgdGhpcy50eXBlID0gXCJxdWVyeVwiLCB0aGlzLmZpcmVzdG9yZSA9IHQ7XG4gICAgfVxuICAgIHdpdGhDb252ZXJ0ZXIodCkge1xuICAgICAgICByZXR1cm4gbmV3IG1jKHRoaXMuZmlyZXN0b3JlLCB0LCB0aGlzLl9xdWVyeSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEEgYENvbGxlY3Rpb25SZWZlcmVuY2VgIG9iamVjdCBjYW4gYmUgdXNlZCBmb3IgYWRkaW5nIGRvY3VtZW50cywgZ2V0dGluZ1xuICogZG9jdW1lbnQgcmVmZXJlbmNlcywgYW5kIHF1ZXJ5aW5nIGZvciBkb2N1bWVudHMgKHVzaW5nIHtAbGluayBxdWVyeX0pLlxuICovIGNsYXNzIGdjIGV4dGVuZHMgbWMge1xuICAgIC8qKiBAaGlkZWNvbnN0cnVjdG9yICovXG4gICAgY29uc3RydWN0b3IodCwgZSwgbikge1xuICAgICAgICBzdXBlcih0LCBlLCBLZShuKSksIHRoaXMuX3BhdGggPSBuLCBcbiAgICAgICAgLyoqIFRoZSB0eXBlIG9mIHRoaXMgRmlyZXN0b3JlIHJlZmVyZW5jZS4gKi9cbiAgICAgICAgdGhpcy50eXBlID0gXCJjb2xsZWN0aW9uXCI7XG4gICAgfVxuICAgIC8qKiBUaGUgY29sbGVjdGlvbidzIGlkZW50aWZpZXIuICovICAgIGdldCBpZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3F1ZXJ5LnBhdGgubGFzdFNlZ21lbnQoKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQSBzdHJpbmcgcmVwcmVzZW50aW5nIHRoZSBwYXRoIG9mIHRoZSByZWZlcmVuY2VkIGNvbGxlY3Rpb24gKHJlbGF0aXZlXG4gICAgICogdG8gdGhlIHJvb3Qgb2YgdGhlIGRhdGFiYXNlKS5cbiAgICAgKi8gICAgZ2V0IHBhdGgoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9xdWVyeS5wYXRoLmNhbm9uaWNhbFN0cmluZygpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBBIHJlZmVyZW5jZSB0byB0aGUgY29udGFpbmluZyBgRG9jdW1lbnRSZWZlcmVuY2VgIGlmIHRoaXMgaXMgYVxuICAgICAqIHN1YmNvbGxlY3Rpb24uIElmIHRoaXMgaXNuJ3QgYSBzdWJjb2xsZWN0aW9uLCB0aGUgcmVmZXJlbmNlIGlzIG51bGwuXG4gICAgICovICAgIGdldCBwYXJlbnQoKSB7XG4gICAgICAgIGNvbnN0IHQgPSB0aGlzLl9wYXRoLnBvcExhc3QoKTtcbiAgICAgICAgcmV0dXJuIHQuaXNFbXB0eSgpID8gbnVsbCA6IG5ldyB3Yyh0aGlzLmZpcmVzdG9yZSwgXG4gICAgICAgIC8qIGNvbnZlcnRlcj0gKi8gbnVsbCwgbmV3IHh0KHQpKTtcbiAgICB9XG4gICAgd2l0aENvbnZlcnRlcih0KSB7XG4gICAgICAgIHJldHVybiBuZXcgZ2ModGhpcy5maXJlc3RvcmUsIHQsIHRoaXMuX3BhdGgpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24geWModCwgZSwgLi4ubikge1xuICAgIGlmICh0ID0gcCh0KSwgcmMoXCJjb2xsZWN0aW9uXCIsIFwicGF0aFwiLCBlKSwgdCBpbnN0YW5jZW9mIGRjKSB7XG4gICAgICAgIGNvbnN0IHMgPSBfdC5mcm9tU3RyaW5nKGUsIC4uLm4pO1xuICAgICAgICByZXR1cm4gYWMocyksIG5ldyBnYyh0LCAvKiBjb252ZXJ0ZXI9ICovIG51bGwsIHMpO1xuICAgIH1cbiAgICB7XG4gICAgICAgIGlmICghKHQgaW5zdGFuY2VvZiB3YyB8fCB0IGluc3RhbmNlb2YgZ2MpKSB0aHJvdyBuZXcgUShHLklOVkFMSURfQVJHVU1FTlQsIFwiRXhwZWN0ZWQgZmlyc3QgYXJndW1lbnQgdG8gY29sbGVjdGlvbigpIHRvIGJlIGEgQ29sbGVjdGlvblJlZmVyZW5jZSwgYSBEb2N1bWVudFJlZmVyZW5jZSBvciBGaXJlYmFzZUZpcmVzdG9yZVwiKTtcbiAgICAgICAgY29uc3QgcyA9IHQuX3BhdGguY2hpbGQoX3QuZnJvbVN0cmluZyhlLCAuLi5uKSk7XG4gICAgICAgIHJldHVybiBhYyhzKSwgbmV3IGdjKHQuZmlyZXN0b3JlLCBcbiAgICAgICAgLyogY29udmVydGVyPSAqLyBudWxsLCBzKTtcbiAgICB9XG59XG5cbi8vIFRPRE8oZmlyZXN0b3JlbGl0ZSk6IENvbnNpZGVyIHVzaW5nIEVycm9yRmFjdG9yeSAtXG4vLyBodHRwczovL2dpdGh1Yi5jb20vZmlyZWJhc2UvZmlyZWJhc2UtanMtc2RrL2Jsb2IvMDEzMWUxZi9wYWNrYWdlcy91dGlsL3NyYy9lcnJvcnMudHMjTDEwNlxuLyoqXG4gKiBDcmVhdGVzIGFuZCByZXR1cm5zIGEgbmV3IGBRdWVyeWAgaW5zdGFuY2UgdGhhdCBpbmNsdWRlcyBhbGwgZG9jdW1lbnRzIGluIHRoZVxuICogZGF0YWJhc2UgdGhhdCBhcmUgY29udGFpbmVkIGluIGEgY29sbGVjdGlvbiBvciBzdWJjb2xsZWN0aW9uIHdpdGggdGhlXG4gKiBnaXZlbiBgY29sbGVjdGlvbklkYC5cbiAqXG4gKiBAcGFyYW0gZmlyZXN0b3JlIC0gQSByZWZlcmVuY2UgdG8gdGhlIHJvb3QgYEZpcmVzdG9yZWAgaW5zdGFuY2UuXG4gKiBAcGFyYW0gY29sbGVjdGlvbklkIC0gSWRlbnRpZmllcyB0aGUgY29sbGVjdGlvbnMgdG8gcXVlcnkgb3Zlci4gRXZlcnlcbiAqIGNvbGxlY3Rpb24gb3Igc3ViY29sbGVjdGlvbiB3aXRoIHRoaXMgSUQgYXMgdGhlIGxhc3Qgc2VnbWVudCBvZiBpdHMgcGF0aFxuICogd2lsbCBiZSBpbmNsdWRlZC4gQ2Fubm90IGNvbnRhaW4gYSBzbGFzaC5cbiAqIEByZXR1cm5zIFRoZSBjcmVhdGVkIGBRdWVyeWAuXG4gKi8gZnVuY3Rpb24gcGModCwgZSkge1xuICAgIGlmICh0ID0gaGModCwgZGMpLCByYyhcImNvbGxlY3Rpb25Hcm91cFwiLCBcImNvbGxlY3Rpb24gaWRcIiwgZSksIGUuaW5kZXhPZihcIi9cIikgPj0gMCkgdGhyb3cgbmV3IFEoRy5JTlZBTElEX0FSR1VNRU5ULCBgSW52YWxpZCBjb2xsZWN0aW9uIElEICcke2V9JyBwYXNzZWQgdG8gZnVuY3Rpb24gY29sbGVjdGlvbkdyb3VwKCkuIENvbGxlY3Rpb24gSURzIG11c3Qgbm90IGNvbnRhaW4gJy8nLmApO1xuICAgIHJldHVybiBuZXcgbWModCwgXG4gICAgLyogY29udmVydGVyPSAqLyBudWxsLCBcbiAgICAvKipcbiAqIENyZWF0ZXMgYSBuZXcgUXVlcnkgZm9yIGEgY29sbGVjdGlvbiBncm91cCBxdWVyeSB0aGF0IG1hdGNoZXMgYWxsIGRvY3VtZW50c1xuICogd2l0aGluIHRoZSBwcm92aWRlZCBjb2xsZWN0aW9uIGdyb3VwLlxuICovXG4gICAgZnVuY3Rpb24odCkge1xuICAgICAgICByZXR1cm4gbmV3IFVlKF90LmVtcHR5UGF0aCgpLCB0KTtcbiAgICB9KGUpKTtcbn1cblxuZnVuY3Rpb24gSWModCwgZSwgLi4ubikge1xuICAgIGlmICh0ID0gcCh0KSwgXG4gICAgLy8gV2UgYWxsb3cgb21pc3Npb24gb2YgJ3BhdGhTdHJpbmcnIGJ1dCBleHBsaWNpdGx5IHByb2hpYml0IHBhc3NpbmcgaW4gYm90aFxuICAgIC8vICd1bmRlZmluZWQnIGFuZCAnbnVsbCcuXG4gICAgMSA9PT0gYXJndW1lbnRzLmxlbmd0aCAmJiAoZSA9IGl0LlIoKSksIHJjKFwiZG9jXCIsIFwicGF0aFwiLCBlKSwgdCBpbnN0YW5jZW9mIGRjKSB7XG4gICAgICAgIGNvbnN0IHMgPSBfdC5mcm9tU3RyaW5nKGUsIC4uLm4pO1xuICAgICAgICByZXR1cm4gdWMocyksIG5ldyB3Yyh0LCBcbiAgICAgICAgLyogY29udmVydGVyPSAqLyBudWxsLCBuZXcgeHQocykpO1xuICAgIH1cbiAgICB7XG4gICAgICAgIGlmICghKHQgaW5zdGFuY2VvZiB3YyB8fCB0IGluc3RhbmNlb2YgZ2MpKSB0aHJvdyBuZXcgUShHLklOVkFMSURfQVJHVU1FTlQsIFwiRXhwZWN0ZWQgZmlyc3QgYXJndW1lbnQgdG8gY29sbGVjdGlvbigpIHRvIGJlIGEgQ29sbGVjdGlvblJlZmVyZW5jZSwgYSBEb2N1bWVudFJlZmVyZW5jZSBvciBGaXJlYmFzZUZpcmVzdG9yZVwiKTtcbiAgICAgICAgY29uc3QgcyA9IHQuX3BhdGguY2hpbGQoX3QuZnJvbVN0cmluZyhlLCAuLi5uKSk7XG4gICAgICAgIHJldHVybiB1YyhzKSwgbmV3IHdjKHQuZmlyZXN0b3JlLCB0IGluc3RhbmNlb2YgZ2MgPyB0LmNvbnZlcnRlciA6IG51bGwsIG5ldyB4dChzKSk7XG4gICAgfVxufVxuXG4vKipcbiAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgcHJvdmlkZWQgcmVmZXJlbmNlcyBhcmUgZXF1YWwuXG4gKlxuICogQHBhcmFtIGxlZnQgLSBBIHJlZmVyZW5jZSB0byBjb21wYXJlLlxuICogQHBhcmFtIHJpZ2h0IC0gQSByZWZlcmVuY2UgdG8gY29tcGFyZS5cbiAqIEByZXR1cm5zIHRydWUgaWYgdGhlIHJlZmVyZW5jZXMgcG9pbnQgdG8gdGhlIHNhbWUgbG9jYXRpb24gaW4gdGhlIHNhbWVcbiAqIEZpcmVzdG9yZSBkYXRhYmFzZS5cbiAqLyBmdW5jdGlvbiBUYyh0LCBlKSB7XG4gICAgcmV0dXJuIHQgPSBwKHQpLCBlID0gcChlKSwgKHQgaW5zdGFuY2VvZiB3YyB8fCB0IGluc3RhbmNlb2YgZ2MpICYmIChlIGluc3RhbmNlb2Ygd2MgfHwgZSBpbnN0YW5jZW9mIGdjKSAmJiAodC5maXJlc3RvcmUgPT09IGUuZmlyZXN0b3JlICYmIHQucGF0aCA9PT0gZS5wYXRoICYmIHQuY29udmVydGVyID09PSBlLmNvbnZlcnRlcik7XG59XG5cbi8qKlxuICogUmV0dXJucyB0cnVlIGlmIHRoZSBwcm92aWRlZCBxdWVyaWVzIHBvaW50IHRvIHRoZSBzYW1lIGNvbGxlY3Rpb24gYW5kIGFwcGx5XG4gKiB0aGUgc2FtZSBjb25zdHJhaW50cy5cbiAqXG4gKiBAcGFyYW0gbGVmdCAtIEEgYFF1ZXJ5YCB0byBjb21wYXJlLlxuICogQHBhcmFtIHJpZ2h0IC0gQSBgUXVlcnlgIHRvIGNvbXBhcmUuXG4gKiBAcmV0dXJucyB0cnVlIGlmIHRoZSByZWZlcmVuY2VzIHBvaW50IHRvIHRoZSBzYW1lIGxvY2F0aW9uIGluIHRoZSBzYW1lXG4gKiBGaXJlc3RvcmUgZGF0YWJhc2UuXG4gKi8gZnVuY3Rpb24gRWModCwgZSkge1xuICAgIHJldHVybiB0ID0gcCh0KSwgZSA9IHAoZSksIHQgaW5zdGFuY2VvZiBtYyAmJiBlIGluc3RhbmNlb2YgbWMgJiYgKHQuZmlyZXN0b3JlID09PSBlLmZpcmVzdG9yZSAmJiBZZSh0Ll9xdWVyeSwgZS5fcXVlcnkpICYmIHQuY29udmVydGVyID09PSBlLmNvbnZlcnRlcik7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovIGNsYXNzIEFjIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgLy8gVGhlIGxhc3QgcHJvbWlzZSBpbiB0aGUgcXVldWUuXG4gICAgICAgIHRoaXMuRmEgPSBQcm9taXNlLnJlc29sdmUoKSwgXG4gICAgICAgIC8vIEEgbGlzdCBvZiByZXRyeWFibGUgb3BlcmF0aW9ucy4gUmV0cnlhYmxlIG9wZXJhdGlvbnMgYXJlIHJ1biBpbiBvcmRlciBhbmRcbiAgICAgICAgLy8gcmV0cmllZCB3aXRoIGJhY2tvZmYuXG4gICAgICAgIHRoaXMuJGEgPSBbXSwgXG4gICAgICAgIC8vIElzIHRoaXMgQXN5bmNRdWV1ZSBiZWluZyBzaHV0IGRvd24/IE9uY2UgaXQgaXMgc2V0IHRvIHRydWUsIGl0IHdpbGwgbm90XG4gICAgICAgIC8vIGJlIGNoYW5nZWQgYWdhaW4uXG4gICAgICAgIHRoaXMuQmEgPSAhMSwgXG4gICAgICAgIC8vIE9wZXJhdGlvbnMgc2NoZWR1bGVkIHRvIGJlIHF1ZXVlZCBpbiB0aGUgZnV0dXJlLiBPcGVyYXRpb25zIGFyZVxuICAgICAgICAvLyBhdXRvbWF0aWNhbGx5IHJlbW92ZWQgYWZ0ZXIgdGhleSBhcmUgcnVuIG9yIGNhbmNlbGVkLlxuICAgICAgICB0aGlzLkxhID0gW10sIFxuICAgICAgICAvLyB2aXNpYmxlIGZvciB0ZXN0aW5nXG4gICAgICAgIHRoaXMuVWEgPSBudWxsLCBcbiAgICAgICAgLy8gRmxhZyBzZXQgd2hpbGUgdGhlcmUncyBhbiBvdXRzdGFuZGluZyBBc3luY1F1ZXVlIG9wZXJhdGlvbiwgdXNlZCBmb3JcbiAgICAgICAgLy8gYXNzZXJ0aW9uIHNhbml0eS1jaGVja3MuXG4gICAgICAgIHRoaXMucWEgPSAhMSwgXG4gICAgICAgIC8vIEVuYWJsZWQgZHVyaW5nIHNodXRkb3duIG9uIFNhZmFyaSB0byBwcmV2ZW50IGZ1dHVyZSBhY2Nlc3MgdG8gSW5kZXhlZERCLlxuICAgICAgICB0aGlzLkthID0gITEsIFxuICAgICAgICAvLyBMaXN0IG9mIFRpbWVySWRzIHRvIGZhc3QtZm9yd2FyZCBkZWxheXMgZm9yLlxuICAgICAgICB0aGlzLkdhID0gW10sIFxuICAgICAgICAvLyBCYWNrb2ZmIHRpbWVyIHVzZWQgdG8gc2NoZWR1bGUgcmV0cmllcyBmb3IgcmV0cnlhYmxlIG9wZXJhdGlvbnNcbiAgICAgICAgdGhpcy5ObyA9IG5ldyBXbyh0aGlzLCBcImFzeW5jX3F1ZXVlX3JldHJ5XCIgLyogQXN5bmNRdWV1ZVJldHJ5ICovKSwgXG4gICAgICAgIC8vIFZpc2liaWxpdHkgaGFuZGxlciB0aGF0IHRyaWdnZXJzIGFuIGltbWVkaWF0ZSByZXRyeSBvZiBhbGwgcmV0cnlhYmxlXG4gICAgICAgIC8vIG9wZXJhdGlvbnMuIE1lYW50IHRvIHNwZWVkIHVwIHJlY292ZXJ5IHdoZW4gd2UgcmVnYWluIGZpbGUgc3lzdGVtIGFjY2Vzc1xuICAgICAgICAvLyBhZnRlciBwYWdlIGNvbWVzIGludG8gZm9yZWdyb3VuZC5cbiAgICAgICAgdGhpcy5RYSA9ICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHQgPSBRbygpO1xuICAgICAgICAgICAgdCAmJiBPKFwiQXN5bmNRdWV1ZVwiLCBcIlZpc2liaWxpdHkgc3RhdGUgY2hhbmdlZCB0byBcIiArIHQudmlzaWJpbGl0eVN0YXRlKSwgdGhpcy5Oby5QbygpO1xuICAgICAgICB9O1xuICAgICAgICBjb25zdCB0ID0gUW8oKTtcbiAgICAgICAgdCAmJiBcImZ1bmN0aW9uXCIgPT0gdHlwZW9mIHQuYWRkRXZlbnRMaXN0ZW5lciAmJiB0LmFkZEV2ZW50TGlzdGVuZXIoXCJ2aXNpYmlsaXR5Y2hhbmdlXCIsIHRoaXMuUWEpO1xuICAgIH1cbiAgICBnZXQgaXNTaHV0dGluZ0Rvd24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLkJhO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBBZGRzIGEgbmV3IG9wZXJhdGlvbiB0byB0aGUgcXVldWUgd2l0aG91dCB3YWl0aW5nIGZvciBpdCB0byBjb21wbGV0ZSAoaS5lLlxuICAgICAqIHdlIGlnbm9yZSB0aGUgUHJvbWlzZSByZXN1bHQpLlxuICAgICAqLyAgICBlbnF1ZXVlQW5kRm9yZ2V0KHQpIHtcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1mbG9hdGluZy1wcm9taXNlc1xuICAgICAgICB0aGlzLmVucXVldWUodCk7XG4gICAgfVxuICAgIGVucXVldWVBbmRGb3JnZXRFdmVuV2hpbGVSZXN0cmljdGVkKHQpIHtcbiAgICAgICAgdGhpcy5qYSgpLCBcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1mbG9hdGluZy1wcm9taXNlc1xuICAgICAgICB0aGlzLldhKHQpO1xuICAgIH1cbiAgICBlbnRlclJlc3RyaWN0ZWRNb2RlKHQpIHtcbiAgICAgICAgaWYgKCF0aGlzLkJhKSB7XG4gICAgICAgICAgICB0aGlzLkJhID0gITAsIHRoaXMuS2EgPSB0IHx8ICExO1xuICAgICAgICAgICAgY29uc3QgZSA9IFFvKCk7XG4gICAgICAgICAgICBlICYmIFwiZnVuY3Rpb25cIiA9PSB0eXBlb2YgZS5yZW1vdmVFdmVudExpc3RlbmVyICYmIGUucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInZpc2liaWxpdHljaGFuZ2VcIiwgdGhpcy5RYSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZW5xdWV1ZSh0KSB7XG4gICAgICAgIGlmICh0aGlzLmphKCksIHRoaXMuQmEpIFxuICAgICAgICAvLyBSZXR1cm4gYSBQcm9taXNlIHdoaWNoIG5ldmVyIHJlc29sdmVzLlxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKCgpID0+IHt9KSk7XG4gICAgICAgIC8vIENyZWF0ZSBhIGRlZmVycmVkIFByb21pc2UgdGhhdCB3ZSBjYW4gcmV0dXJuIHRvIHRoZSBjYWxsZWUuIFRoaXNcbiAgICAgICAgLy8gYWxsb3dzIHVzIHRvIHJldHVybiBhIFwiaGFuZ2luZyBQcm9taXNlXCIgb25seSB0byB0aGUgY2FsbGVlIGFuZCBzdGlsbFxuICAgICAgICAvLyBhZHZhbmNlIHRoZSBxdWV1ZSBldmVuIHdoZW4gdGhlIG9wZXJhdGlvbiBpcyBub3QgcnVuLlxuICAgICAgICAgICAgICAgIGNvbnN0IGUgPSBuZXcgajtcbiAgICAgICAgcmV0dXJuIHRoaXMuV2EoKCgpID0+IHRoaXMuQmEgJiYgdGhpcy5LYSA/IFByb21pc2UucmVzb2x2ZSgpIDogKHQoKS50aGVuKGUucmVzb2x2ZSwgZS5yZWplY3QpLCBcbiAgICAgICAgZS5wcm9taXNlKSkpLnRoZW4oKCgpID0+IGUucHJvbWlzZSkpO1xuICAgIH1cbiAgICBlbnF1ZXVlUmV0cnlhYmxlKHQpIHtcbiAgICAgICAgdGhpcy5lbnF1ZXVlQW5kRm9yZ2V0KCgoKSA9PiAodGhpcy4kYS5wdXNoKHQpLCB0aGlzLnphKCkpKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJ1bnMgdGhlIG5leHQgb3BlcmF0aW9uIGZyb20gdGhlIHJldHJ5YWJsZSBxdWV1ZS4gSWYgdGhlIG9wZXJhdGlvbiBmYWlscyxcbiAgICAgKiByZXNjaGVkdWxlcyB3aXRoIGJhY2tvZmYuXG4gICAgICovICAgIGFzeW5jIHphKCkge1xuICAgICAgICBpZiAoMCAhPT0gdGhpcy4kYS5sZW5ndGgpIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy4kYVswXSgpLCB0aGlzLiRhLnNoaWZ0KCksIHRoaXMuTm8ucmVzZXQoKTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKHQpIHtcbiAgICAgICAgICAgICAgICBpZiAoIUFpKHQpKSB0aHJvdyB0O1xuIC8vIEZhaWx1cmUgd2lsbCBiZSBoYW5kbGVkIGJ5IEFzeW5jUXVldWVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTyhcIkFzeW5jUXVldWVcIiwgXCJPcGVyYXRpb24gZmFpbGVkIHdpdGggcmV0cnlhYmxlIGVycm9yOiBcIiArIHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy4kYS5sZW5ndGggPiAwICYmIFxuICAgICAgICAgICAgLy8gSWYgdGhlcmUgYXJlIGFkZGl0aW9uYWwgb3BlcmF0aW9ucywgd2UgcmUtc2NoZWR1bGUgYHJldHJ5TmV4dE9wKClgLlxuICAgICAgICAgICAgLy8gVGhpcyBpcyBuZWNlc3NhcnkgdG8gcnVuIHJldHJ5YWJsZSBvcGVyYXRpb25zIHRoYXQgZmFpbGVkIGR1cmluZ1xuICAgICAgICAgICAgLy8gdGhlaXIgaW5pdGlhbCBhdHRlbXB0IHNpbmNlIHdlIGRvbid0IGtub3cgd2hldGhlciB0aGV5IGFyZSBhbHJlYWR5XG4gICAgICAgICAgICAvLyBlbnF1ZXVlZC4gSWYsIGZvciBleGFtcGxlLCBgb3AxYCwgYG9wMmAsIGBvcDNgIGFyZSBlbnF1ZXVlZCBhbmQgYG9wMWBcbiAgICAgICAgICAgIC8vIG5lZWRzIHRvICBiZSByZS1ydW4sIHdlIHdpbGwgcnVuIGBvcDFgLCBgb3AxYCwgYG9wMmAgdXNpbmcgdGhlXG4gICAgICAgICAgICAvLyBhbHJlYWR5IGVucXVldWVkIGNhbGxzIHRvIGByZXRyeU5leHRPcCgpYC4gYG9wMygpYCB3aWxsIHRoZW4gcnVuIGluIHRoZVxuICAgICAgICAgICAgLy8gY2FsbCBzY2hlZHVsZWQgaGVyZS5cbiAgICAgICAgICAgIC8vIFNpbmNlIGBiYWNrb2ZmQW5kUnVuKClgIGNhbmNlbHMgYW4gZXhpc3RpbmcgYmFja29mZiBhbmQgc2NoZWR1bGVzIGFcbiAgICAgICAgICAgIC8vIG5ldyBiYWNrb2ZmIG9uIGV2ZXJ5IGNhbGwsIHRoZXJlIGlzIG9ubHkgZXZlciBhIHNpbmdsZSBhZGRpdGlvbmFsXG4gICAgICAgICAgICAvLyBvcGVyYXRpb24gaW4gdGhlIHF1ZXVlLlxuICAgICAgICAgICAgdGhpcy5Oby5SbygoKCkgPT4gdGhpcy56YSgpKSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgV2EodCkge1xuICAgICAgICBjb25zdCBlID0gdGhpcy5GYS50aGVuKCgoKSA9PiAodGhpcy5xYSA9ICEwLCB0KCkuY2F0Y2goKHQgPT4ge1xuICAgICAgICAgICAgdGhpcy5VYSA9IHQsIHRoaXMucWEgPSAhMTtcbiAgICAgICAgICAgIGNvbnN0IGUgPSBcbiAgICAgICAgICAgIC8qKlxuICogQ2hyb21lIGluY2x1ZGVzIEVycm9yLm1lc3NhZ2UgaW4gRXJyb3Iuc3RhY2suIE90aGVyIGJyb3dzZXJzIGRvIG5vdC5cbiAqIFRoaXMgcmV0dXJucyBleHBlY3RlZCBvdXRwdXQgb2YgbWVzc2FnZSArIHN0YWNrIHdoZW4gYXZhaWxhYmxlLlxuICogQHBhcmFtIGVycm9yIC0gRXJyb3Igb3IgRmlyZXN0b3JlRXJyb3JcbiAqL1xuICAgICAgICAgICAgZnVuY3Rpb24odCkge1xuICAgICAgICAgICAgICAgIGxldCBlID0gdC5tZXNzYWdlIHx8IFwiXCI7XG4gICAgICAgICAgICAgICAgdC5zdGFjayAmJiAoZSA9IHQuc3RhY2suaW5jbHVkZXModC5tZXNzYWdlKSA/IHQuc3RhY2sgOiB0Lm1lc3NhZ2UgKyBcIlxcblwiICsgdC5zdGFjayk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqLyAodCk7XG4gICAgICAgICAgICAvLyBSZS10aHJvdyB0aGUgZXJyb3Igc28gdGhhdCB0aGlzLnRhaWwgYmVjb21lcyBhIHJlamVjdGVkIFByb21pc2UgYW5kXG4gICAgICAgICAgICAvLyBhbGwgZnVydGhlciBhdHRlbXB0cyB0byBjaGFpbiAodmlhIC50aGVuKSB3aWxsIGp1c3Qgc2hvcnQtY2lyY3VpdFxuICAgICAgICAgICAgLy8gYW5kIHJldHVybiB0aGUgcmVqZWN0ZWQgUHJvbWlzZS5cbiAgICAgICAgICAgIHRocm93IEYoXCJJTlRFUk5BTCBVTkhBTkRMRUQgRVJST1I6IFwiLCBlKSwgdDtcbiAgICAgICAgfSkpLnRoZW4oKHQgPT4gKHRoaXMucWEgPSAhMSwgdCkpKSkpKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuRmEgPSBlLCBlO1xuICAgIH1cbiAgICBlbnF1ZXVlQWZ0ZXJEZWxheSh0LCBlLCBuKSB7XG4gICAgICAgIHRoaXMuamEoKSwgXG4gICAgICAgIC8vIEZhc3QtZm9yd2FyZCBkZWxheXMgZm9yIHRpbWVySWRzIHRoYXQgaGF2ZSBiZWVuIG92ZXJyaWRlbi5cbiAgICAgICAgdGhpcy5HYS5pbmRleE9mKHQpID4gLTEgJiYgKGUgPSAwKTtcbiAgICAgICAgY29uc3QgcyA9IHZ1LmNyZWF0ZUFuZFNjaGVkdWxlKHRoaXMsIHQsIGUsIG4sICh0ID0+IHRoaXMuSGEodCkpKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuTGEucHVzaChzKSwgcztcbiAgICB9XG4gICAgamEoKSB7XG4gICAgICAgIHRoaXMuVWEgJiYgTCgpO1xuICAgIH1cbiAgICB2ZXJpZnlPcGVyYXRpb25JblByb2dyZXNzKCkge31cbiAgICAvKipcbiAgICAgKiBXYWl0cyB1bnRpbCBhbGwgY3VycmVudGx5IHF1ZXVlZCB0YXNrcyBhcmUgZmluaXNoZWQgZXhlY3V0aW5nLiBEZWxheWVkXG4gICAgICogb3BlcmF0aW9ucyBhcmUgbm90IHJ1bi5cbiAgICAgKi8gICAgYXN5bmMgSmEoKSB7XG4gICAgICAgIC8vIE9wZXJhdGlvbnMgaW4gdGhlIHF1ZXVlIHByaW9yIHRvIGRyYWluaW5nIG1heSBoYXZlIGVucXVldWVkIGFkZGl0aW9uYWxcbiAgICAgICAgLy8gb3BlcmF0aW9ucy4gS2VlcCBkcmFpbmluZyB0aGUgcXVldWUgdW50aWwgdGhlIHRhaWwgaXMgbm8gbG9uZ2VyIGFkdmFuY2VkLFxuICAgICAgICAvLyB3aGljaCBpbmRpY2F0ZXMgdGhhdCBubyBtb3JlIG5ldyBvcGVyYXRpb25zIHdlcmUgZW5xdWV1ZWQgYW5kIHRoYXQgYWxsXG4gICAgICAgIC8vIG9wZXJhdGlvbnMgd2VyZSBleGVjdXRlZC5cbiAgICAgICAgbGV0IHQ7XG4gICAgICAgIGRvIHtcbiAgICAgICAgICAgIHQgPSB0aGlzLkZhLCBhd2FpdCB0O1xuICAgICAgICB9IHdoaWxlICh0ICE9PSB0aGlzLkZhKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRm9yIFRlc3RzOiBEZXRlcm1pbmUgaWYgYSBkZWxheWVkIG9wZXJhdGlvbiB3aXRoIGEgcGFydGljdWxhciBUaW1lcklkXG4gICAgICogZXhpc3RzLlxuICAgICAqLyAgICBZYSh0KSB7XG4gICAgICAgIGZvciAoY29uc3QgZSBvZiB0aGlzLkxhKSBpZiAoZS50aW1lcklkID09PSB0KSByZXR1cm4gITA7XG4gICAgICAgIHJldHVybiAhMTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRm9yIFRlc3RzOiBSdW5zIHNvbWUgb3IgYWxsIGRlbGF5ZWQgb3BlcmF0aW9ucyBlYXJseS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBsYXN0VGltZXJJZCAtIERlbGF5ZWQgb3BlcmF0aW9ucyB1cCB0byBhbmQgaW5jbHVkaW5nIHRoaXMgVGltZXJJZFxuICAgICAqIHdpbGwgYmUgZHJhaW5lZC4gUGFzcyBUaW1lcklkLkFsbCB0byBydW4gYWxsIGRlbGF5ZWQgb3BlcmF0aW9ucy5cbiAgICAgKiBAcmV0dXJucyBhIFByb21pc2UgdGhhdCByZXNvbHZlcyBvbmNlIGFsbCBvcGVyYXRpb25zIGhhdmUgYmVlbiBydW4uXG4gICAgICovICAgIFhhKHQpIHtcbiAgICAgICAgLy8gTm90ZSB0aGF0IGRyYWluaW5nIG1heSBnZW5lcmF0ZSBtb3JlIGRlbGF5ZWQgb3BzLCBzbyB3ZSBkbyB0aGF0IGZpcnN0LlxuICAgICAgICByZXR1cm4gdGhpcy5KYSgpLnRoZW4oKCgpID0+IHtcbiAgICAgICAgICAgIC8vIFJ1biBvcHMgaW4gdGhlIHNhbWUgb3JkZXIgdGhleSdkIHJ1biBpZiB0aGV5IHJhbiBuYXR1cmFsbHkuXG4gICAgICAgICAgICB0aGlzLkxhLnNvcnQoKCh0LCBlKSA9PiB0LnRhcmdldFRpbWVNcyAtIGUudGFyZ2V0VGltZU1zKSk7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGUgb2YgdGhpcy5MYSkgaWYgKGUuc2tpcERlbGF5KCksIFwiYWxsXCIgLyogQWxsICovICE9PSB0ICYmIGUudGltZXJJZCA9PT0gdCkgYnJlYWs7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5KYSgpO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEZvciBUZXN0czogU2tpcCBhbGwgc3Vic2VxdWVudCBkZWxheXMgZm9yIGEgdGltZXIgaWQuXG4gICAgICovICAgIFphKHQpIHtcbiAgICAgICAgdGhpcy5HYS5wdXNoKHQpO1xuICAgIH1cbiAgICAvKiogQ2FsbGVkIG9uY2UgYSBEZWxheWVkT3BlcmF0aW9uIGlzIHJ1biBvciBjYW5jZWxlZC4gKi8gICAgSGEodCkge1xuICAgICAgICAvLyBOT1RFOiBpbmRleE9mIC8gc2xpY2UgYXJlIE8obiksIGJ1dCBkZWxheWVkT3BlcmF0aW9ucyBpcyBleHBlY3RlZCB0byBiZSBzbWFsbC5cbiAgICAgICAgY29uc3QgZSA9IHRoaXMuTGEuaW5kZXhPZih0KTtcbiAgICAgICAgdGhpcy5MYS5zcGxpY2UoZSwgMSk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBSYyh0KSB7XG4gICAgLyoqXG4gKiBSZXR1cm5zIHRydWUgaWYgb2JqIGlzIGFuIG9iamVjdCBhbmQgY29udGFpbnMgYXQgbGVhc3Qgb25lIG9mIHRoZSBzcGVjaWZpZWRcbiAqIG1ldGhvZHMuXG4gKi9cbiAgICByZXR1cm4gZnVuY3Rpb24odCwgZSkge1xuICAgICAgICBpZiAoXCJvYmplY3RcIiAhPSB0eXBlb2YgdCB8fCBudWxsID09PSB0KSByZXR1cm4gITE7XG4gICAgICAgIGNvbnN0IG4gPSB0O1xuICAgICAgICBmb3IgKGNvbnN0IHQgb2YgZSkgaWYgKHQgaW4gbiAmJiBcImZ1bmN0aW9uXCIgPT0gdHlwZW9mIG5bdF0pIHJldHVybiAhMDtcbiAgICAgICAgcmV0dXJuICExO1xuICAgIH1cbiAgICAvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuICAgIC8qKlxuICogUmVwcmVzZW50cyB0aGUgdGFzayBvZiBsb2FkaW5nIGEgRmlyZXN0b3JlIGJ1bmRsZS4gSXQgcHJvdmlkZXMgcHJvZ3Jlc3Mgb2YgYnVuZGxlXG4gKiBsb2FkaW5nLCBhcyB3ZWxsIGFzIHRhc2sgY29tcGxldGlvbiBhbmQgZXJyb3IgZXZlbnRzLlxuICpcbiAqIFRoZSBBUEkgaXMgY29tcGF0aWJsZSB3aXRoIGBQcm9taXNlPExvYWRCdW5kbGVUYXNrUHJvZ3Jlc3M+YC5cbiAqLyAodCwgWyBcIm5leHRcIiwgXCJlcnJvclwiLCBcImNvbXBsZXRlXCIgXSk7XG59XG5cbmNsYXNzIGJjIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5fcHJvZ3Jlc3NPYnNlcnZlciA9IHt9LCB0aGlzLl90YXNrQ29tcGxldGlvblJlc29sdmVyID0gbmV3IGosIHRoaXMuX2xhc3RQcm9ncmVzcyA9IHtcbiAgICAgICAgICAgIHRhc2tTdGF0ZTogXCJSdW5uaW5nXCIsXG4gICAgICAgICAgICB0b3RhbEJ5dGVzOiAwLFxuICAgICAgICAgICAgdG90YWxEb2N1bWVudHM6IDAsXG4gICAgICAgICAgICBieXRlc0xvYWRlZDogMCxcbiAgICAgICAgICAgIGRvY3VtZW50c0xvYWRlZDogMFxuICAgICAgICB9O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZWdpc3RlcnMgZnVuY3Rpb25zIHRvIGxpc3RlbiB0byBidW5kbGUgbG9hZGluZyBwcm9ncmVzcyBldmVudHMuXG4gICAgICogQHBhcmFtIG5leHQgLSBDYWxsZWQgd2hlbiB0aGVyZSBpcyBhIHByb2dyZXNzIHVwZGF0ZSBmcm9tIGJ1bmRsZSBsb2FkaW5nLiBUeXBpY2FsbHkgYG5leHRgIGNhbGxzIG9jY3VyXG4gICAgICogICBlYWNoIHRpbWUgYSBGaXJlc3RvcmUgZG9jdW1lbnQgaXMgbG9hZGVkIGZyb20gdGhlIGJ1bmRsZS5cbiAgICAgKiBAcGFyYW0gZXJyb3IgLSBDYWxsZWQgd2hlbiBhbiBlcnJvciBvY2N1cnMgZHVyaW5nIGJ1bmRsZSBsb2FkaW5nLiBUaGUgdGFzayBhYm9ydHMgYWZ0ZXIgcmVwb3J0aW5nIHRoZVxuICAgICAqICAgZXJyb3IsIGFuZCB0aGVyZSBzaG91bGQgYmUgbm8gbW9yZSB1cGRhdGVzIGFmdGVyIHRoaXMuXG4gICAgICogQHBhcmFtIGNvbXBsZXRlIC0gQ2FsbGVkIHdoZW4gdGhlIGxvYWRpbmcgdGFzayBpcyBjb21wbGV0ZS5cbiAgICAgKi8gICAgb25Qcm9ncmVzcyh0LCBlLCBuKSB7XG4gICAgICAgIHRoaXMuX3Byb2dyZXNzT2JzZXJ2ZXIgPSB7XG4gICAgICAgICAgICBuZXh0OiB0LFxuICAgICAgICAgICAgZXJyb3I6IGUsXG4gICAgICAgICAgICBjb21wbGV0ZTogblxuICAgICAgICB9O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBJbXBsZW1lbnRzIHRoZSBgUHJvbWlzZTxMb2FkQnVuZGxlVGFza1Byb2dyZXNzPi5jYXRjaGAgaW50ZXJmYWNlLlxuICAgICAqXG4gICAgICogQHBhcmFtIG9uUmVqZWN0ZWQgLSBDYWxsZWQgd2hlbiBhbiBlcnJvciBvY2N1cnMgZHVyaW5nIGJ1bmRsZSBsb2FkaW5nLlxuICAgICAqLyAgICBjYXRjaCh0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLl90YXNrQ29tcGxldGlvblJlc29sdmVyLnByb21pc2UuY2F0Y2godCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEltcGxlbWVudHMgdGhlIGBQcm9taXNlPExvYWRCdW5kbGVUYXNrUHJvZ3Jlc3M+LnRoZW5gIGludGVyZmFjZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBvbkZ1bGZpbGxlZCAtIENhbGxlZCBvbiB0aGUgY29tcGxldGlvbiBvZiB0aGUgbG9hZGluZyB0YXNrIHdpdGggYSBmaW5hbCBgTG9hZEJ1bmRsZVRhc2tQcm9ncmVzc2AgdXBkYXRlLlxuICAgICAqICAgVGhlIHVwZGF0ZSB3aWxsIGFsd2F5cyBoYXZlIGl0cyBgdGFza1N0YXRlYCBzZXQgdG8gYFwiU3VjY2Vzc1wiYC5cbiAgICAgKiBAcGFyYW0gb25SZWplY3RlZCAtIENhbGxlZCB3aGVuIGFuIGVycm9yIG9jY3VycyBkdXJpbmcgYnVuZGxlIGxvYWRpbmcuXG4gICAgICovICAgIHRoZW4odCwgZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5fdGFza0NvbXBsZXRpb25SZXNvbHZlci5wcm9taXNlLnRoZW4odCwgZSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIE5vdGlmaWVzIGFsbCBvYnNlcnZlcnMgdGhhdCBidW5kbGUgbG9hZGluZyBoYXMgY29tcGxldGVkLCB3aXRoIGEgcHJvdmlkZWRcbiAgICAgKiBgTG9hZEJ1bmRsZVRhc2tQcm9ncmVzc2Agb2JqZWN0LlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKi8gICAgX2NvbXBsZXRlV2l0aCh0KSB7XG4gICAgICAgIHRoaXMuX3VwZGF0ZVByb2dyZXNzKHQpLCB0aGlzLl9wcm9ncmVzc09ic2VydmVyLmNvbXBsZXRlICYmIHRoaXMuX3Byb2dyZXNzT2JzZXJ2ZXIuY29tcGxldGUoKSwgXG4gICAgICAgIHRoaXMuX3Rhc2tDb21wbGV0aW9uUmVzb2x2ZXIucmVzb2x2ZSh0KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogTm90aWZpZXMgYWxsIG9ic2VydmVycyB0aGF0IGJ1bmRsZSBsb2FkaW5nIGhhcyBmYWlsZWQsIHdpdGggYSBwcm92aWRlZFxuICAgICAqIGBFcnJvcmAgYXMgdGhlIHJlYXNvbi5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICovICAgIF9mYWlsV2l0aCh0KSB7XG4gICAgICAgIHRoaXMuX2xhc3RQcm9ncmVzcy50YXNrU3RhdGUgPSBcIkVycm9yXCIsIHRoaXMuX3Byb2dyZXNzT2JzZXJ2ZXIubmV4dCAmJiB0aGlzLl9wcm9ncmVzc09ic2VydmVyLm5leHQodGhpcy5fbGFzdFByb2dyZXNzKSwgXG4gICAgICAgIHRoaXMuX3Byb2dyZXNzT2JzZXJ2ZXIuZXJyb3IgJiYgdGhpcy5fcHJvZ3Jlc3NPYnNlcnZlci5lcnJvcih0KSwgdGhpcy5fdGFza0NvbXBsZXRpb25SZXNvbHZlci5yZWplY3QodCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIE5vdGlmaWVzIGEgcHJvZ3Jlc3MgdXBkYXRlIG9mIGxvYWRpbmcgYSBidW5kbGUuXG4gICAgICogQHBhcmFtIHByb2dyZXNzIC0gVGhlIG5ldyBwcm9ncmVzcy5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICovICAgIF91cGRhdGVQcm9ncmVzcyh0KSB7XG4gICAgICAgIHRoaXMuX2xhc3RQcm9ncmVzcyA9IHQsIHRoaXMuX3Byb2dyZXNzT2JzZXJ2ZXIubmV4dCAmJiB0aGlzLl9wcm9ncmVzc09ic2VydmVyLm5leHQodCk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqIERPTUV4Y2VwdGlvbiBlcnJvciBjb2RlIGNvbnN0YW50cy4gKi8gY29uc3QgUGMgPSAtMTtcblxuLyoqXG4gKiBUaGUgQ2xvdWQgRmlyZXN0b3JlIHNlcnZpY2UgaW50ZXJmYWNlLlxuICpcbiAqIERvIG5vdCBjYWxsIHRoaXMgY29uc3RydWN0b3IgZGlyZWN0bHkuIEluc3RlYWQsIHVzZSB7QGxpbmsgZ2V0RmlyZXN0b3JlfS5cbiAqL1xuY2xhc3MgVmMgZXh0ZW5kcyBkYyB7XG4gICAgLyoqIEBoaWRlY29uc3RydWN0b3IgKi9cbiAgICBjb25zdHJ1Y3Rvcih0LCBlLCBuKSB7XG4gICAgICAgIHN1cGVyKHQsIGUsIG4pLCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFdoZXRoZXIgaXQncyBhIHtAbGluayBGaXJlc3RvcmV9IG9yIEZpcmVzdG9yZSBMaXRlIGluc3RhbmNlLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy50eXBlID0gXCJmaXJlc3RvcmVcIiwgdGhpcy5fcXVldWUgPSBuZXcgQWMsIHRoaXMuX3BlcnNpc3RlbmNlS2V5ID0gXCJuYW1lXCIgaW4gdCA/IHQubmFtZSA6IFwiW0RFRkFVTFRdXCI7XG4gICAgfVxuICAgIF90ZXJtaW5hdGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9maXJlc3RvcmVDbGllbnQgfHwgXG4gICAgICAgIC8vIFRoZSBjbGllbnQgbXVzdCBiZSBpbml0aWFsaXplZCB0byBlbnN1cmUgdGhhdCBhbGwgc3Vic2VxdWVudCBBUElcbiAgICAgICAgLy8gdXNhZ2UgdGhyb3dzIGFuIGV4Y2VwdGlvbi5cbiAgICAgICAgQ2ModGhpcyksIHRoaXMuX2ZpcmVzdG9yZUNsaWVudC50ZXJtaW5hdGUoKTtcbiAgICB9XG59XG5cbi8qKlxuICogSW5pdGlhbGl6ZXMgYSBuZXcgaW5zdGFuY2Ugb2Yge0BsaW5rIEZpcmVzdG9yZX0gd2l0aCB0aGUgcHJvdmlkZWQgc2V0dGluZ3MuXG4gKiBDYW4gb25seSBiZSBjYWxsZWQgYmVmb3JlIGFueSBvdGhlciBmdW5jdGlvbiwgaW5jbHVkaW5nXG4gKiB7QGxpbmsgZ2V0RmlyZXN0b3JlfS4gSWYgdGhlIGN1c3RvbSBzZXR0aW5ncyBhcmUgZW1wdHksIHRoaXMgZnVuY3Rpb24gaXNcbiAqIGVxdWl2YWxlbnQgdG8gY2FsbGluZyB7QGxpbmsgZ2V0RmlyZXN0b3JlfS5cbiAqXG4gKiBAcGFyYW0gYXBwIC0gVGhlIHtAbGluayBAZmlyZWJhc2UvYXBwI0ZpcmViYXNlQXBwfSB3aXRoIHdoaWNoIHRoZSB7QGxpbmsgRmlyZXN0b3JlfSBpbnN0YW5jZSB3aWxsXG4gKiBiZSBhc3NvY2lhdGVkLlxuICogQHBhcmFtIHNldHRpbmdzIC0gQSBzZXR0aW5ncyBvYmplY3QgdG8gY29uZmlndXJlIHRoZSB7QGxpbmsgRmlyZXN0b3JlfSBpbnN0YW5jZS5cbiAqIEByZXR1cm5zIEEgbmV3bHkgaW5pdGlhbGl6ZWQge0BsaW5rIEZpcmVzdG9yZX0gaW5zdGFuY2UuXG4gKi8gZnVuY3Rpb24gdmModCwgZSkge1xuICAgIGNvbnN0IG4gPSBfZ2V0UHJvdmlkZXIodCwgXCJmaXJlc3RvcmVcIik7XG4gICAgaWYgKG4uaXNJbml0aWFsaXplZCgpKSB7XG4gICAgICAgIGNvbnN0IHQgPSBuLmdldEltbWVkaWF0ZSgpLCBzID0gbi5nZXRPcHRpb25zKCk7XG4gICAgICAgIGlmIChJKHMsIGUpKSByZXR1cm4gdDtcbiAgICAgICAgdGhyb3cgbmV3IFEoRy5GQUlMRURfUFJFQ09ORElUSU9OLCBcImluaXRpYWxpemVGaXJlc3RvcmUoKSBoYXMgYWxyZWFkeSBiZWVuIGNhbGxlZCB3aXRoIGRpZmZlcmVudCBvcHRpb25zLiBUbyBhdm9pZCB0aGlzIGVycm9yLCBjYWxsIGluaXRpYWxpemVGaXJlc3RvcmUoKSB3aXRoIHRoZSBzYW1lIG9wdGlvbnMgYXMgd2hlbiBpdCB3YXMgb3JpZ2luYWxseSBjYWxsZWQsIG9yIGNhbGwgZ2V0RmlyZXN0b3JlKCkgdG8gcmV0dXJuIHRoZSBhbHJlYWR5IGluaXRpYWxpemVkIGluc3RhbmNlLlwiKTtcbiAgICB9XG4gICAgaWYgKHZvaWQgMCAhPT0gZS5jYWNoZVNpemVCeXRlcyAmJiAtMSAhPT0gZS5jYWNoZVNpemVCeXRlcyAmJiBlLmNhY2hlU2l6ZUJ5dGVzIDwgMTA0ODU3NikgdGhyb3cgbmV3IFEoRy5JTlZBTElEX0FSR1VNRU5ULCBcImNhY2hlU2l6ZUJ5dGVzIG11c3QgYmUgYXQgbGVhc3QgMTA0ODU3NlwiKTtcbiAgICByZXR1cm4gbi5pbml0aWFsaXplKHtcbiAgICAgICAgb3B0aW9uczogZVxuICAgIH0pO1xufVxuXG4vKipcbiAqIFJldHVybnMgdGhlIGV4aXN0aW5nIHtAbGluayBGaXJlc3RvcmV9IGluc3RhbmNlIHRoYXQgaXMgYXNzb2NpYXRlZCB3aXRoIHRoZVxuICogcHJvdmlkZWQge0BsaW5rIEBmaXJlYmFzZS9hcHAjRmlyZWJhc2VBcHB9LiBJZiBubyBpbnN0YW5jZSBleGlzdHMsIGluaXRpYWxpemVzIGEgbmV3XG4gKiBpbnN0YW5jZSB3aXRoIGRlZmF1bHQgc2V0dGluZ3MuXG4gKlxuICogQHBhcmFtIGFwcCAtIFRoZSB7QGxpbmsgQGZpcmViYXNlL2FwcCNGaXJlYmFzZUFwcH0gaW5zdGFuY2UgdGhhdCB0aGUgcmV0dXJuZWQge0BsaW5rIEZpcmVzdG9yZX1cbiAqIGluc3RhbmNlIGlzIGFzc29jaWF0ZWQgd2l0aC5cbiAqIEByZXR1cm5zIFRoZSB7QGxpbmsgRmlyZXN0b3JlfSBpbnN0YW5jZSBvZiB0aGUgcHJvdmlkZWQgYXBwLlxuICovIGZ1bmN0aW9uIFNjKGUgPSB0KCkpIHtcbiAgICByZXR1cm4gX2dldFByb3ZpZGVyKGUsIFwiZmlyZXN0b3JlXCIpLmdldEltbWVkaWF0ZSgpO1xufVxuXG4vKipcbiAqIEBpbnRlcm5hbFxuICovIGZ1bmN0aW9uIERjKHQpIHtcbiAgICByZXR1cm4gdC5fZmlyZXN0b3JlQ2xpZW50IHx8IENjKHQpLCB0Ll9maXJlc3RvcmVDbGllbnQudmVyaWZ5Tm90VGVybWluYXRlZCgpLCB0Ll9maXJlc3RvcmVDbGllbnQ7XG59XG5cbmZ1bmN0aW9uIENjKHQpIHtcbiAgICB2YXIgZTtcbiAgICBjb25zdCBuID0gdC5fZnJlZXplU2V0dGluZ3MoKSwgcyA9IGZ1bmN0aW9uKHQsIGUsIG4sIHMpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBWdCh0LCBlLCBuLCBzLmhvc3QsIHMuc3NsLCBzLmV4cGVyaW1lbnRhbEZvcmNlTG9uZ1BvbGxpbmcsIHMuZXhwZXJpbWVudGFsQXV0b0RldGVjdExvbmdQb2xsaW5nLCBzLnVzZUZldGNoU3RyZWFtcyk7XG4gICAgfSh0Ll9kYXRhYmFzZUlkLCAobnVsbCA9PT0gKGUgPSB0Ll9hcHApIHx8IHZvaWQgMCA9PT0gZSA/IHZvaWQgMCA6IGUub3B0aW9ucy5hcHBJZCkgfHwgXCJcIiwgdC5fcGVyc2lzdGVuY2VLZXksIG4pO1xuICAgIHQuX2ZpcmVzdG9yZUNsaWVudCA9IG5ldyAkYSh0Ll9hdXRoQ3JlZGVudGlhbHMsIHQuX2FwcENoZWNrQ3JlZGVudGlhbHMsIHQuX3F1ZXVlLCBzKTtcbn1cblxuLyoqXG4gKiBBdHRlbXB0cyB0byBlbmFibGUgcGVyc2lzdGVudCBzdG9yYWdlLCBpZiBwb3NzaWJsZS5cbiAqXG4gKiBNdXN0IGJlIGNhbGxlZCBiZWZvcmUgYW55IG90aGVyIGZ1bmN0aW9ucyAob3RoZXIgdGhhblxuICoge0BsaW5rIGluaXRpYWxpemVGaXJlc3RvcmV9LCB7QGxpbmsgZ2V0RmlyZXN0b3JlfSBvclxuICoge0BsaW5rIGNsZWFySW5kZXhlZERiUGVyc2lzdGVuY2V9LlxuICpcbiAqIElmIHRoaXMgZmFpbHMsIGBlbmFibGVJbmRleGVkRGJQZXJzaXN0ZW5jZSgpYCB3aWxsIHJlamVjdCB0aGUgcHJvbWlzZSBpdFxuICogcmV0dXJucy4gTm90ZSB0aGF0IGV2ZW4gYWZ0ZXIgdGhpcyBmYWlsdXJlLCB0aGUge0BsaW5rIEZpcmVzdG9yZX0gaW5zdGFuY2Ugd2lsbFxuICogcmVtYWluIHVzYWJsZSwgaG93ZXZlciBvZmZsaW5lIHBlcnNpc3RlbmNlIHdpbGwgYmUgZGlzYWJsZWQuXG4gKlxuICogVGhlcmUgYXJlIHNldmVyYWwgcmVhc29ucyB3aHkgdGhpcyBjYW4gZmFpbCwgd2hpY2ggY2FuIGJlIGlkZW50aWZpZWQgYnlcbiAqIHRoZSBgY29kZWAgb24gdGhlIGVycm9yLlxuICpcbiAqICAgKiBmYWlsZWQtcHJlY29uZGl0aW9uOiBUaGUgYXBwIGlzIGFscmVhZHkgb3BlbiBpbiBhbm90aGVyIGJyb3dzZXIgdGFiLlxuICogICAqIHVuaW1wbGVtZW50ZWQ6IFRoZSBicm93c2VyIGlzIGluY29tcGF0aWJsZSB3aXRoIHRoZSBvZmZsaW5lXG4gKiAgICAgcGVyc2lzdGVuY2UgaW1wbGVtZW50YXRpb24uXG4gKlxuICogQHBhcmFtIGZpcmVzdG9yZSAtIFRoZSB7QGxpbmsgRmlyZXN0b3JlfSBpbnN0YW5jZSB0byBlbmFibGUgcGVyc2lzdGVuY2UgZm9yLlxuICogQHBhcmFtIHBlcnNpc3RlbmNlU2V0dGluZ3MgLSBPcHRpb25hbCBzZXR0aW5ncyBvYmplY3QgdG8gY29uZmlndXJlXG4gKiBwZXJzaXN0ZW5jZS5cbiAqIEByZXR1cm5zIEEgYFByb21pc2VgIHRoYXQgcmVwcmVzZW50cyBzdWNjZXNzZnVsbHkgZW5hYmxpbmcgcGVyc2lzdGVudCBzdG9yYWdlLlxuICovIGZ1bmN0aW9uIHhjKHQsIGUpIHtcbiAgICBxYyh0ID0gaGModCwgVmMpKTtcbiAgICBjb25zdCBuID0gRGModCksIHMgPSB0Ll9mcmVlemVTZXR0aW5ncygpLCBpID0gbmV3IHhhO1xuICAgIHJldHVybiBrYyhuLCBpLCBuZXcgRGEoaSwgcy5jYWNoZVNpemVCeXRlcywgbnVsbCA9PSBlID8gdm9pZCAwIDogZS5mb3JjZU93bmVyc2hpcCkpO1xufVxuXG4vKipcbiAqIEF0dGVtcHRzIHRvIGVuYWJsZSBtdWx0aS10YWIgcGVyc2lzdGVudCBzdG9yYWdlLCBpZiBwb3NzaWJsZS4gSWYgZW5hYmxlZFxuICogYWNyb3NzIGFsbCB0YWJzLCBhbGwgb3BlcmF0aW9ucyBzaGFyZSBhY2Nlc3MgdG8gbG9jYWwgcGVyc2lzdGVuY2UsIGluY2x1ZGluZ1xuICogc2hhcmVkIGV4ZWN1dGlvbiBvZiBxdWVyaWVzIGFuZCBsYXRlbmN5LWNvbXBlbnNhdGVkIGxvY2FsIGRvY3VtZW50IHVwZGF0ZXNcbiAqIGFjcm9zcyBhbGwgY29ubmVjdGVkIGluc3RhbmNlcy5cbiAqXG4gKiBJZiB0aGlzIGZhaWxzLCBgZW5hYmxlTXVsdGlUYWJJbmRleGVkRGJQZXJzaXN0ZW5jZSgpYCB3aWxsIHJlamVjdCB0aGUgcHJvbWlzZVxuICogaXQgcmV0dXJucy4gTm90ZSB0aGF0IGV2ZW4gYWZ0ZXIgdGhpcyBmYWlsdXJlLCB0aGUge0BsaW5rIEZpcmVzdG9yZX0gaW5zdGFuY2Ugd2lsbFxuICogcmVtYWluIHVzYWJsZSwgaG93ZXZlciBvZmZsaW5lIHBlcnNpc3RlbmNlIHdpbGwgYmUgZGlzYWJsZWQuXG4gKlxuICogVGhlcmUgYXJlIHNldmVyYWwgcmVhc29ucyB3aHkgdGhpcyBjYW4gZmFpbCwgd2hpY2ggY2FuIGJlIGlkZW50aWZpZWQgYnlcbiAqIHRoZSBgY29kZWAgb24gdGhlIGVycm9yLlxuICpcbiAqICAgKiBmYWlsZWQtcHJlY29uZGl0aW9uOiBUaGUgYXBwIGlzIGFscmVhZHkgb3BlbiBpbiBhbm90aGVyIGJyb3dzZXIgdGFiIGFuZFxuICogICAgIG11bHRpLXRhYiBpcyBub3QgZW5hYmxlZC5cbiAqICAgKiB1bmltcGxlbWVudGVkOiBUaGUgYnJvd3NlciBpcyBpbmNvbXBhdGlibGUgd2l0aCB0aGUgb2ZmbGluZVxuICogICAgIHBlcnNpc3RlbmNlIGltcGxlbWVudGF0aW9uLlxuICpcbiAqIEBwYXJhbSBmaXJlc3RvcmUgLSBUaGUge0BsaW5rIEZpcmVzdG9yZX0gaW5zdGFuY2UgdG8gZW5hYmxlIHBlcnNpc3RlbmNlIGZvci5cbiAqIEByZXR1cm5zIEEgYFByb21pc2VgIHRoYXQgcmVwcmVzZW50cyBzdWNjZXNzZnVsbHkgZW5hYmxpbmcgcGVyc2lzdGVudFxuICogc3RvcmFnZS5cbiAqLyBmdW5jdGlvbiBOYyh0KSB7XG4gICAgcWModCA9IGhjKHQsIFZjKSk7XG4gICAgY29uc3QgZSA9IERjKHQpLCBuID0gdC5fZnJlZXplU2V0dGluZ3MoKSwgcyA9IG5ldyB4YTtcbiAgICByZXR1cm4ga2MoZSwgcywgbmV3IENhKHMsIG4uY2FjaGVTaXplQnl0ZXMpKTtcbn1cblxuLyoqXG4gKiBSZWdpc3RlcnMgYm90aCB0aGUgYE9mZmxpbmVDb21wb25lbnRQcm92aWRlcmAgYW5kIGBPbmxpbmVDb21wb25lbnRQcm92aWRlcmAuXG4gKiBJZiB0aGUgb3BlcmF0aW9uIGZhaWxzIHdpdGggYSByZWNvdmVyYWJsZSBlcnJvciAoc2VlXG4gKiBgY2FuUmVjb3ZlckZyb21JbmRleGVkRGJFcnJvcigpYCBiZWxvdyksIHRoZSByZXR1cm5lZCBQcm9taXNlIGlzIHJlamVjdGVkXG4gKiBidXQgdGhlIGNsaWVudCByZW1haW5zIHVzYWJsZS5cbiAqLyBmdW5jdGlvbiBrYyh0LCBlLCBuKSB7XG4gICAgY29uc3QgcyA9IG5ldyBqO1xuICAgIHJldHVybiB0LmFzeW5jUXVldWUuZW5xdWV1ZSgoYXN5bmMgKCkgPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgYXdhaXQgQmEodCwgbiksIGF3YWl0IExhKHQsIGUpLCBzLnJlc29sdmUoKTtcbiAgICAgICAgfSBjYXRjaCAodCkge1xuICAgICAgICAgICAgaWYgKCFcbiAgICAgICAgICAgIC8qKlxuICogRGVjaWRlcyB3aGV0aGVyIHRoZSBwcm92aWRlZCBlcnJvciBhbGxvd3MgdXMgdG8gZ3JhY2VmdWxseSBkaXNhYmxlXG4gKiBwZXJzaXN0ZW5jZSAoYXMgb3Bwb3NlZCB0byBjcmFzaGluZyB0aGUgY2xpZW50KS5cbiAqL1xuICAgICAgICAgICAgZnVuY3Rpb24odCkge1xuICAgICAgICAgICAgICAgIGlmIChcIkZpcmViYXNlRXJyb3JcIiA9PT0gdC5uYW1lKSByZXR1cm4gdC5jb2RlID09PSBHLkZBSUxFRF9QUkVDT05ESVRJT04gfHwgdC5jb2RlID09PSBHLlVOSU1QTEVNRU5URUQ7XG4gICAgICAgICAgICAgICAgaWYgKFwidW5kZWZpbmVkXCIgIT0gdHlwZW9mIERPTUV4Y2VwdGlvbiAmJiB0IGluc3RhbmNlb2YgRE9NRXhjZXB0aW9uKSBcbiAgICAgICAgICAgICAgICAvLyBUaGVyZSBhcmUgYSBmZXcga25vd24gY2lyY3Vtc3RhbmNlcyB3aGVyZSB3ZSBjYW4gb3BlbiBJbmRleGVkRGIgYnV0XG4gICAgICAgICAgICAgICAgLy8gdHJ5aW5nIHRvIHJlYWQvd3JpdGUgd2lsbCBmYWlsIChlLmcuIHF1b3RhIGV4Y2VlZGVkKS4gRm9yXG4gICAgICAgICAgICAgICAgLy8gd2VsbC11bmRlcnN0b29kIGNhc2VzLCB3ZSBhdHRlbXB0IHRvIGRldGVjdCB0aGVzZSBhbmQgdGhlbiBncmFjZWZ1bGx5XG4gICAgICAgICAgICAgICAgLy8gZmFsbCBiYWNrIHRvIG1lbW9yeSBwZXJzaXN0ZW5jZS5cbiAgICAgICAgICAgICAgICAvLyBOT1RFOiBSYXRoZXIgdGhhbiBjb250aW51ZSB0byBhZGQgdG8gdGhpcyBsaXN0LCB3ZSBjb3VsZCBkZWNpZGUgdG9cbiAgICAgICAgICAgICAgICAvLyBhbHdheXMgZmFsbCBiYWNrLCB3aXRoIHRoZSByaXNrIHRoYXQgd2UgbWlnaHQgYWNjaWRlbnRhbGx5IGhpZGUgZXJyb3JzXG4gICAgICAgICAgICAgICAgLy8gcmVwcmVzZW50aW5nIGFjdHVhbCBTREsgYnVncy5cbiAgICAgICAgICAgICAgICAvLyBXaGVuIHRoZSBicm93c2VyIGlzIG91dCBvZiBxdW90YSB3ZSBjb3VsZCBnZXQgZWl0aGVyIHF1b3RhIGV4Y2VlZGVkXG4gICAgICAgICAgICAgICAgLy8gb3IgYW4gYWJvcnRlZCBlcnJvciBkZXBlbmRpbmcgb24gd2hldGhlciB0aGUgZXJyb3IgaGFwcGVuZWQgZHVyaW5nXG4gICAgICAgICAgICAgICAgLy8gc2NoZW1hIG1pZ3JhdGlvbi5cbiAgICAgICAgICAgICAgICByZXR1cm4gMjIgPT09IHQuY29kZSB8fCAyMCA9PT0gdC5jb2RlIHx8IFxuICAgICAgICAgICAgICAgIC8vIEZpcmVmb3ggUHJpdmF0ZSBCcm93c2luZyBtb2RlIGRpc2FibGVzIEluZGV4ZWREYiBhbmQgcmV0dXJuc1xuICAgICAgICAgICAgICAgIC8vIElOVkFMSURfU1RBVEUgZm9yIGFueSB1c2FnZS5cbiAgICAgICAgICAgICAgICAxMSA9PT0gdC5jb2RlO1xuICAgICAgICAgICAgICAgIHJldHVybiAhMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8qKlxuICogQ2xlYXJzIHRoZSBwZXJzaXN0ZW50IHN0b3JhZ2UuIFRoaXMgaW5jbHVkZXMgcGVuZGluZyB3cml0ZXMgYW5kIGNhY2hlZFxuICogZG9jdW1lbnRzLlxuICpcbiAqIE11c3QgYmUgY2FsbGVkIHdoaWxlIHRoZSB7QGxpbmsgRmlyZXN0b3JlfSBpbnN0YW5jZSBpcyBub3Qgc3RhcnRlZCAoYWZ0ZXIgdGhlIGFwcCBpc1xuICogdGVybWluYXRlZCBvciB3aGVuIHRoZSBhcHAgaXMgZmlyc3QgaW5pdGlhbGl6ZWQpLiBPbiBzdGFydHVwLCB0aGlzIGZ1bmN0aW9uXG4gKiBtdXN0IGJlIGNhbGxlZCBiZWZvcmUgb3RoZXIgZnVuY3Rpb25zIChvdGhlciB0aGFuIHtAbGlua1xuICogaW5pdGlhbGl6ZUZpcmVzdG9yZX0gb3Ige0BsaW5rIGdldEZpcmVzdG9yZX0pKS4gSWYgdGhlIHtAbGluayBGaXJlc3RvcmV9XG4gKiBpbnN0YW5jZSBpcyBzdGlsbCBydW5uaW5nLCB0aGUgcHJvbWlzZSB3aWxsIGJlIHJlamVjdGVkIHdpdGggdGhlIGVycm9yIGNvZGVcbiAqIG9mIGBmYWlsZWQtcHJlY29uZGl0aW9uYC5cbiAqXG4gKiBOb3RlOiBgY2xlYXJJbmRleGVkRGJQZXJzaXN0ZW5jZSgpYCBpcyBwcmltYXJpbHkgaW50ZW5kZWQgdG8gaGVscCB3cml0ZVxuICogcmVsaWFibGUgdGVzdHMgdGhhdCB1c2UgQ2xvdWQgRmlyZXN0b3JlLiBJdCB1c2VzIGFuIGVmZmljaWVudCBtZWNoYW5pc20gZm9yXG4gKiBkcm9wcGluZyBleGlzdGluZyBkYXRhIGJ1dCBkb2VzIG5vdCBhdHRlbXB0IHRvIHNlY3VyZWx5IG92ZXJ3cml0ZSBvclxuICogb3RoZXJ3aXNlIG1ha2UgY2FjaGVkIGRhdGEgdW5yZWNvdmVyYWJsZS4gRm9yIGFwcGxpY2F0aW9ucyB0aGF0IGFyZSBzZW5zaXRpdmVcbiAqIHRvIHRoZSBkaXNjbG9zdXJlIG9mIGNhY2hlZCBkYXRhIGluIGJldHdlZW4gdXNlciBzZXNzaW9ucywgd2Ugc3Ryb25nbHlcbiAqIHJlY29tbWVuZCBub3QgZW5hYmxpbmcgcGVyc2lzdGVuY2UgYXQgYWxsLlxuICpcbiAqIEBwYXJhbSBmaXJlc3RvcmUgLSBUaGUge0BsaW5rIEZpcmVzdG9yZX0gaW5zdGFuY2UgdG8gY2xlYXIgcGVyc2lzdGVuY2UgZm9yLlxuICogQHJldHVybnMgQSBgUHJvbWlzZWAgdGhhdCBpcyByZXNvbHZlZCB3aGVuIHRoZSBwZXJzaXN0ZW50IHN0b3JhZ2UgaXNcbiAqIGNsZWFyZWQuIE90aGVyd2lzZSwgdGhlIHByb21pc2UgaXMgcmVqZWN0ZWQgd2l0aCBhbiBlcnJvci5cbiAqLyAodCkpIHRocm93IHQ7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oXCJFcnJvciBlbmFibGluZyBvZmZsaW5lIHBlcnNpc3RlbmNlLiBGYWxsaW5nIGJhY2sgdG8gcGVyc2lzdGVuY2UgZGlzYWJsZWQ6IFwiICsgdCksIFxuICAgICAgICAgICAgcy5yZWplY3QodCk7XG4gICAgICAgIH1cbiAgICB9KSkudGhlbigoKCkgPT4gcy5wcm9taXNlKSk7XG59XG5cbmZ1bmN0aW9uIE1jKHQpIHtcbiAgICBpZiAodC5faW5pdGlhbGl6ZWQgJiYgIXQuX3Rlcm1pbmF0ZWQpIHRocm93IG5ldyBRKEcuRkFJTEVEX1BSRUNPTkRJVElPTiwgXCJQZXJzaXN0ZW5jZSBjYW4gb25seSBiZSBjbGVhcmVkIGJlZm9yZSBhIEZpcmVzdG9yZSBpbnN0YW5jZSBpcyBpbml0aWFsaXplZCBvciBhZnRlciBpdCBpcyB0ZXJtaW5hdGVkLlwiKTtcbiAgICBjb25zdCBlID0gbmV3IGo7XG4gICAgcmV0dXJuIHQuX3F1ZXVlLmVucXVldWVBbmRGb3JnZXRFdmVuV2hpbGVSZXN0cmljdGVkKChhc3luYyAoKSA9PiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBhd2FpdCBhc3luYyBmdW5jdGlvbih0KSB7XG4gICAgICAgICAgICAgICAgaWYgKCFJaS52dCgpKSByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgICAgICAgICAgICAgY29uc3QgZSA9IHQgKyBcIm1haW5cIjtcbiAgICAgICAgICAgICAgICBhd2FpdCBJaS5kZWxldGUoZSk7XG4gICAgICAgICAgICB9KFlyKHQuX2RhdGFiYXNlSWQsIHQuX3BlcnNpc3RlbmNlS2V5KSksIGUucmVzb2x2ZSgpO1xuICAgICAgICB9IGNhdGNoICh0KSB7XG4gICAgICAgICAgICBlLnJlamVjdCh0KTtcbiAgICAgICAgfVxuICAgIH0pKSwgZS5wcm9taXNlO1xufVxuXG4vKipcbiAqIFdhaXRzIHVudGlsIGFsbCBjdXJyZW50bHkgcGVuZGluZyB3cml0ZXMgZm9yIHRoZSBhY3RpdmUgdXNlciBoYXZlIGJlZW5cbiAqIGFja25vd2xlZGdlZCBieSB0aGUgYmFja2VuZC5cbiAqXG4gKiBUaGUgcmV0dXJuZWQgcHJvbWlzZSByZXNvbHZlcyBpbW1lZGlhdGVseSBpZiB0aGVyZSBhcmUgbm8gb3V0c3RhbmRpbmcgd3JpdGVzLlxuICogT3RoZXJ3aXNlLCB0aGUgcHJvbWlzZSB3YWl0cyBmb3IgYWxsIHByZXZpb3VzbHkgaXNzdWVkIHdyaXRlcyAoaW5jbHVkaW5nXG4gKiB0aG9zZSB3cml0dGVuIGluIGEgcHJldmlvdXMgYXBwIHNlc3Npb24pLCBidXQgaXQgZG9lcyBub3Qgd2FpdCBmb3Igd3JpdGVzXG4gKiB0aGF0IHdlcmUgYWRkZWQgYWZ0ZXIgdGhlIGZ1bmN0aW9uIGlzIGNhbGxlZC4gSWYgeW91IHdhbnQgdG8gd2FpdCBmb3JcbiAqIGFkZGl0aW9uYWwgd3JpdGVzLCBjYWxsIGB3YWl0Rm9yUGVuZGluZ1dyaXRlcygpYCBhZ2Fpbi5cbiAqXG4gKiBBbnkgb3V0c3RhbmRpbmcgYHdhaXRGb3JQZW5kaW5nV3JpdGVzKClgIHByb21pc2VzIGFyZSByZWplY3RlZCBkdXJpbmcgdXNlclxuICogY2hhbmdlcy5cbiAqXG4gKiBAcmV0dXJucyBBIGBQcm9taXNlYCB3aGljaCByZXNvbHZlcyB3aGVuIGFsbCBjdXJyZW50bHkgcGVuZGluZyB3cml0ZXMgaGF2ZSBiZWVuXG4gKiBhY2tub3dsZWRnZWQgYnkgdGhlIGJhY2tlbmQuXG4gKi8gZnVuY3Rpb24gT2ModCkge1xuICAgIHJldHVybiBmdW5jdGlvbih0KSB7XG4gICAgICAgIGNvbnN0IGUgPSBuZXcgajtcbiAgICAgICAgcmV0dXJuIHQuYXN5bmNRdWV1ZS5lbnF1ZXVlQW5kRm9yZ2V0KChhc3luYyAoKSA9PiBvYShhd2FpdCBqYSh0KSwgZSkpKSwgZS5wcm9taXNlO1xuICAgIH0oRGModCA9IGhjKHQsIFZjKSkpO1xufVxuXG4vKipcbiAqIFJlLWVuYWJsZXMgdXNlIG9mIHRoZSBuZXR3b3JrIGZvciB0aGlzIHtAbGluayBGaXJlc3RvcmV9IGluc3RhbmNlIGFmdGVyIGEgcHJpb3JcbiAqIGNhbGwgdG8ge0BsaW5rIGRpc2FibGVOZXR3b3JrfS5cbiAqXG4gKiBAcmV0dXJucyBBIGBQcm9taXNlYCB0aGF0IGlzIHJlc29sdmVkIG9uY2UgdGhlIG5ldHdvcmsgaGFzIGJlZW4gZW5hYmxlZC5cbiAqLyBmdW5jdGlvbiBGYyh0KSB7XG4gICAgcmV0dXJuIHphKERjKHQgPSBoYyh0LCBWYykpKTtcbn1cblxuLyoqXG4gKiBEaXNhYmxlcyBuZXR3b3JrIHVzYWdlIGZvciB0aGlzIGluc3RhbmNlLiBJdCBjYW4gYmUgcmUtZW5hYmxlZCB2aWEge0BsaW5rXG4gKiBlbmFibGVOZXR3b3JrfS4gV2hpbGUgdGhlIG5ldHdvcmsgaXMgZGlzYWJsZWQsIGFueSBzbmFwc2hvdCBsaXN0ZW5lcnMsXG4gKiBgZ2V0RG9jKClgIG9yIGBnZXREb2NzKClgIGNhbGxzIHdpbGwgcmV0dXJuIHJlc3VsdHMgZnJvbSBjYWNoZSwgYW5kIGFueSB3cml0ZVxuICogb3BlcmF0aW9ucyB3aWxsIGJlIHF1ZXVlZCB1bnRpbCB0aGUgbmV0d29yayBpcyByZXN0b3JlZC5cbiAqXG4gKiBAcmV0dXJucyBBIGBQcm9taXNlYCB0aGF0IGlzIHJlc29sdmVkIG9uY2UgdGhlIG5ldHdvcmsgaGFzIGJlZW4gZGlzYWJsZWQuXG4gKi8gZnVuY3Rpb24gJGModCkge1xuICAgIHJldHVybiBIYShEYyh0ID0gaGModCwgVmMpKSk7XG59XG5cbi8qKlxuICogVGVybWluYXRlcyB0aGUgcHJvdmlkZWQge0BsaW5rIEZpcmVzdG9yZX0gaW5zdGFuY2UuXG4gKlxuICogQWZ0ZXIgY2FsbGluZyBgdGVybWluYXRlKClgIG9ubHkgdGhlIGBjbGVhckluZGV4ZWREYlBlcnNpc3RlbmNlKClgIGZ1bmN0aW9uXG4gKiBtYXkgYmUgdXNlZC4gQW55IG90aGVyIGZ1bmN0aW9uIHdpbGwgdGhyb3cgYSBgRmlyZXN0b3JlRXJyb3JgLlxuICpcbiAqIFRvIHJlc3RhcnQgYWZ0ZXIgdGVybWluYXRpb24sIGNyZWF0ZSBhIG5ldyBpbnN0YW5jZSBvZiBGaXJlYmFzZUZpcmVzdG9yZSB3aXRoXG4gKiB7QGxpbmsgZ2V0RmlyZXN0b3JlfS5cbiAqXG4gKiBUZXJtaW5hdGlvbiBkb2VzIG5vdCBjYW5jZWwgYW55IHBlbmRpbmcgd3JpdGVzLCBhbmQgYW55IHByb21pc2VzIHRoYXQgYXJlXG4gKiBhd2FpdGluZyBhIHJlc3BvbnNlIGZyb20gdGhlIHNlcnZlciB3aWxsIG5vdCBiZSByZXNvbHZlZC4gSWYgeW91IGhhdmVcbiAqIHBlcnNpc3RlbmNlIGVuYWJsZWQsIHRoZSBuZXh0IHRpbWUgeW91IHN0YXJ0IHRoaXMgaW5zdGFuY2UsIGl0IHdpbGwgcmVzdW1lXG4gKiBzZW5kaW5nIHRoZXNlIHdyaXRlcyB0byB0aGUgc2VydmVyLlxuICpcbiAqIE5vdGU6IFVuZGVyIG5vcm1hbCBjaXJjdW1zdGFuY2VzLCBjYWxsaW5nIGB0ZXJtaW5hdGUoKWAgaXMgbm90IHJlcXVpcmVkLiBUaGlzXG4gKiBmdW5jdGlvbiBpcyB1c2VmdWwgb25seSB3aGVuIHlvdSB3YW50IHRvIGZvcmNlIHRoaXMgaW5zdGFuY2UgdG8gcmVsZWFzZSBhbGxcbiAqIG9mIGl0cyByZXNvdXJjZXMgb3IgaW4gY29tYmluYXRpb24gd2l0aCBgY2xlYXJJbmRleGVkRGJQZXJzaXN0ZW5jZSgpYCB0b1xuICogZW5zdXJlIHRoYXQgYWxsIGxvY2FsIHN0YXRlIGlzIGRlc3Ryb3llZCBiZXR3ZWVuIHRlc3QgcnVucy5cbiAqXG4gKiBAcmV0dXJucyBBIGBQcm9taXNlYCB0aGF0IGlzIHJlc29sdmVkIHdoZW4gdGhlIGluc3RhbmNlIGhhcyBiZWVuIHN1Y2Nlc3NmdWxseVxuICogdGVybWluYXRlZC5cbiAqLyBmdW5jdGlvbiBCYyh0KSB7XG4gICAgcmV0dXJuIGUodC5hcHAsIFwiZmlyZXN0b3JlXCIpLCB0Ll9kZWxldGUoKTtcbn1cblxuLyoqXG4gKiBMb2FkcyBhIEZpcmVzdG9yZSBidW5kbGUgaW50byB0aGUgbG9jYWwgY2FjaGUuXG4gKlxuICogQHBhcmFtIGZpcmVzdG9yZSAtIFRoZSB7QGxpbmsgRmlyZXN0b3JlfSBpbnN0YW5jZSB0byBsb2FkIGJ1bmRsZXMgZm9yLlxuICogQHBhcmFtIGJ1bmRsZURhdGEgLSBBbiBvYmplY3QgcmVwcmVzZW50aW5nIHRoZSBidW5kbGUgdG8gYmUgbG9hZGVkLiBWYWxpZFxuICogb2JqZWN0cyBhcmUgYEFycmF5QnVmZmVyYCwgYFJlYWRhYmxlU3RyZWFtPFVpbnQ4QXJyYXk+YCBvciBgc3RyaW5nYC5cbiAqXG4gKiBAcmV0dXJucyBBIGBMb2FkQnVuZGxlVGFza2Agb2JqZWN0LCB3aGljaCBub3RpZmllcyBjYWxsZXJzIHdpdGggcHJvZ3Jlc3NcbiAqIHVwZGF0ZXMsIGFuZCBjb21wbGV0aW9uIG9yIGVycm9yIGV2ZW50cy4gSXQgY2FuIGJlIHVzZWQgYXMgYVxuICogYFByb21pc2U8TG9hZEJ1bmRsZVRhc2tQcm9ncmVzcz5gLlxuICovIGZ1bmN0aW9uIExjKHQsIGUpIHtcbiAgICBjb25zdCBuID0gRGModCA9IGhjKHQsIFZjKSksIHMgPSBuZXcgYmM7XG4gICAgcmV0dXJuIG5jKG4sIHQuX2RhdGFiYXNlSWQsIGUsIHMpLCBzO1xufVxuXG4vKipcbiAqIFJlYWRzIGEgRmlyZXN0b3JlIHtAbGluayBRdWVyeX0gZnJvbSBsb2NhbCBjYWNoZSwgaWRlbnRpZmllZCBieSB0aGUgZ2l2ZW5cbiAqIG5hbWUuXG4gKlxuICogVGhlIG5hbWVkIHF1ZXJpZXMgYXJlIHBhY2thZ2VkICBpbnRvIGJ1bmRsZXMgb24gdGhlIHNlcnZlciBzaWRlIChhbG9uZ1xuICogd2l0aCByZXN1bHRpbmcgZG9jdW1lbnRzKSwgYW5kIGxvYWRlZCB0byBsb2NhbCBjYWNoZSB1c2luZyBgbG9hZEJ1bmRsZWAuIE9uY2VcbiAqIGluIGxvY2FsIGNhY2hlLCB1c2UgdGhpcyBtZXRob2QgdG8gZXh0cmFjdCBhIHtAbGluayBRdWVyeX0gYnkgbmFtZS5cbiAqXG4gKiBAcGFyYW0gZmlyZXN0b3JlIC0gVGhlIHtAbGluayBGaXJlc3RvcmV9IGluc3RhbmNlIHRvIHJlYWQgdGhlIHF1ZXJ5IGZyb20uXG4gKiBAcGFyYW0gbmFtZSAtIFRoZSBuYW1lIG9mIHRoZSBxdWVyeS5cbiAqIEByZXR1cm5zIEEgYFByb21pc2VgIHRoYXQgaXMgcmVzb2x2ZWQgd2l0aCB0aGUgUXVlcnkgb3IgYG51bGxgLlxuICovIGZ1bmN0aW9uIFVjKHQsIGUpIHtcbiAgICByZXR1cm4gc2MoRGModCA9IGhjKHQsIFZjKSksIGUpLnRoZW4oKGUgPT4gZSA/IG5ldyBtYyh0LCBudWxsLCBlLnF1ZXJ5KSA6IG51bGwpKTtcbn1cblxuZnVuY3Rpb24gcWModCkge1xuICAgIGlmICh0Ll9pbml0aWFsaXplZCB8fCB0Ll90ZXJtaW5hdGVkKSB0aHJvdyBuZXcgUShHLkZBSUxFRF9QUkVDT05ESVRJT04sIFwiRmlyZXN0b3JlIGhhcyBhbHJlYWR5IGJlZW4gc3RhcnRlZCBhbmQgcGVyc2lzdGVuY2UgY2FuIG5vIGxvbmdlciBiZSBlbmFibGVkLiBZb3UgY2FuIG9ubHkgZW5hYmxlIHBlcnNpc3RlbmNlIGJlZm9yZSBjYWxsaW5nIGFueSBvdGhlciBtZXRob2RzIG9uIGEgRmlyZXN0b3JlIG9iamVjdC5cIik7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBBIGBGaWVsZFBhdGhgIHJlZmVycyB0byBhIGZpZWxkIGluIGEgZG9jdW1lbnQuIFRoZSBwYXRoIG1heSBjb25zaXN0IG9mIGFcbiAqIHNpbmdsZSBmaWVsZCBuYW1lIChyZWZlcnJpbmcgdG8gYSB0b3AtbGV2ZWwgZmllbGQgaW4gdGhlIGRvY3VtZW50KSwgb3IgYVxuICogbGlzdCBvZiBmaWVsZCBuYW1lcyAocmVmZXJyaW5nIHRvIGEgbmVzdGVkIGZpZWxkIGluIHRoZSBkb2N1bWVudCkuXG4gKlxuICogQ3JlYXRlIGEgYEZpZWxkUGF0aGAgYnkgcHJvdmlkaW5nIGZpZWxkIG5hbWVzLiBJZiBtb3JlIHRoYW4gb25lIGZpZWxkXG4gKiBuYW1lIGlzIHByb3ZpZGVkLCB0aGUgcGF0aCB3aWxsIHBvaW50IHRvIGEgbmVzdGVkIGZpZWxkIGluIGEgZG9jdW1lbnQuXG4gKi9cbmNsYXNzIEtjIHtcbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgYEZpZWxkUGF0aGAgZnJvbSB0aGUgcHJvdmlkZWQgZmllbGQgbmFtZXMuIElmIG1vcmUgdGhhbiBvbmUgZmllbGRcbiAgICAgKiBuYW1lIGlzIHByb3ZpZGVkLCB0aGUgcGF0aCB3aWxsIHBvaW50IHRvIGEgbmVzdGVkIGZpZWxkIGluIGEgZG9jdW1lbnQuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gZmllbGROYW1lcyAtIEEgbGlzdCBvZiBmaWVsZCBuYW1lcy5cbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvciguLi50KSB7XG4gICAgICAgIGZvciAobGV0IGUgPSAwOyBlIDwgdC5sZW5ndGg7ICsrZSkgaWYgKDAgPT09IHRbZV0ubGVuZ3RoKSB0aHJvdyBuZXcgUShHLklOVkFMSURfQVJHVU1FTlQsIFwiSW52YWxpZCBmaWVsZCBuYW1lIGF0IGFyZ3VtZW50ICQoaSArIDEpLiBGaWVsZCBuYW1lcyBtdXN0IG5vdCBiZSBlbXB0eS5cIik7XG4gICAgICAgIHRoaXMuX2ludGVybmFsUGF0aCA9IG5ldyBtdCh0KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0cnVlIGlmIHRoaXMgYEZpZWxkUGF0aGAgaXMgZXF1YWwgdG8gdGhlIHByb3ZpZGVkIG9uZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBvdGhlciAtIFRoZSBgRmllbGRQYXRoYCB0byBjb21wYXJlIGFnYWluc3QuXG4gICAgICogQHJldHVybnMgdHJ1ZSBpZiB0aGlzIGBGaWVsZFBhdGhgIGlzIGVxdWFsIHRvIHRoZSBwcm92aWRlZCBvbmUuXG4gICAgICovICAgIGlzRXF1YWwodCkge1xuICAgICAgICByZXR1cm4gdGhpcy5faW50ZXJuYWxQYXRoLmlzRXF1YWwodC5faW50ZXJuYWxQYXRoKTtcbiAgICB9XG59XG5cbi8qKlxuICogUmV0dXJucyBhIHNwZWNpYWwgc2VudGluZWwgYEZpZWxkUGF0aGAgdG8gcmVmZXIgdG8gdGhlIElEIG9mIGEgZG9jdW1lbnQuXG4gKiBJdCBjYW4gYmUgdXNlZCBpbiBxdWVyaWVzIHRvIHNvcnQgb3IgZmlsdGVyIGJ5IHRoZSBkb2N1bWVudCBJRC5cbiAqLyBmdW5jdGlvbiBHYygpIHtcbiAgICByZXR1cm4gbmV3IEtjKFwiX19uYW1lX19cIik7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEFuIGltbXV0YWJsZSBvYmplY3QgcmVwcmVzZW50aW5nIGFuIGFycmF5IG9mIGJ5dGVzLlxuICovIGNsYXNzIFFjIHtcbiAgICAvKiogQGhpZGVjb25zdHJ1Y3RvciAqL1xuICAgIGNvbnN0cnVjdG9yKHQpIHtcbiAgICAgICAgdGhpcy5fYnl0ZVN0cmluZyA9IHQ7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBuZXcgYEJ5dGVzYCBvYmplY3QgZnJvbSB0aGUgZ2l2ZW4gQmFzZTY0IHN0cmluZywgY29udmVydGluZyBpdCB0b1xuICAgICAqIGJ5dGVzLlxuICAgICAqXG4gICAgICogQHBhcmFtIGJhc2U2NCAtIFRoZSBCYXNlNjQgc3RyaW5nIHVzZWQgdG8gY3JlYXRlIHRoZSBgQnl0ZXNgIG9iamVjdC5cbiAgICAgKi8gICAgc3RhdGljIGZyb21CYXNlNjRTdHJpbmcodCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBRYyhwdC5mcm9tQmFzZTY0U3RyaW5nKHQpKTtcbiAgICAgICAgfSBjYXRjaCAodCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IFEoRy5JTlZBTElEX0FSR1VNRU5ULCBcIkZhaWxlZCB0byBjb25zdHJ1Y3QgZGF0YSBmcm9tIEJhc2U2NCBzdHJpbmc6IFwiICsgdCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIG5ldyBgQnl0ZXNgIG9iamVjdCBmcm9tIHRoZSBnaXZlbiBVaW50OEFycmF5LlxuICAgICAqXG4gICAgICogQHBhcmFtIGFycmF5IC0gVGhlIFVpbnQ4QXJyYXkgdXNlZCB0byBjcmVhdGUgdGhlIGBCeXRlc2Agb2JqZWN0LlxuICAgICAqLyAgICBzdGF0aWMgZnJvbVVpbnQ4QXJyYXkodCkge1xuICAgICAgICByZXR1cm4gbmV3IFFjKHB0LmZyb21VaW50OEFycmF5KHQpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0aGUgdW5kZXJseWluZyBieXRlcyBhcyBhIEJhc2U2NC1lbmNvZGVkIHN0cmluZy5cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIFRoZSBCYXNlNjQtZW5jb2RlZCBzdHJpbmcgY3JlYXRlZCBmcm9tIHRoZSBgQnl0ZXNgIG9iamVjdC5cbiAgICAgKi8gICAgdG9CYXNlNjQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9ieXRlU3RyaW5nLnRvQmFzZTY0KCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdGhlIHVuZGVybHlpbmcgYnl0ZXMgaW4gYSBuZXcgYFVpbnQ4QXJyYXlgLlxuICAgICAqXG4gICAgICogQHJldHVybnMgVGhlIFVpbnQ4QXJyYXkgY3JlYXRlZCBmcm9tIHRoZSBgQnl0ZXNgIG9iamVjdC5cbiAgICAgKi8gICAgdG9VaW50OEFycmF5KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fYnl0ZVN0cmluZy50b1VpbnQ4QXJyYXkoKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyBhIHN0cmluZyByZXByZXNlbnRhdGlvbiBvZiB0aGUgYEJ5dGVzYCBvYmplY3QuXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyBBIHN0cmluZyByZXByZXNlbnRhdGlvbiBvZiB0aGUgYEJ5dGVzYCBvYmplY3QuXG4gICAgICovICAgIHRvU3RyaW5nKCkge1xuICAgICAgICByZXR1cm4gXCJCeXRlcyhiYXNlNjQ6IFwiICsgdGhpcy50b0Jhc2U2NCgpICsgXCIpXCI7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdHJ1ZSBpZiB0aGlzIGBCeXRlc2Agb2JqZWN0IGlzIGVxdWFsIHRvIHRoZSBwcm92aWRlZCBvbmUuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gb3RoZXIgLSBUaGUgYEJ5dGVzYCBvYmplY3QgdG8gY29tcGFyZSBhZ2FpbnN0LlxuICAgICAqIEByZXR1cm5zIHRydWUgaWYgdGhpcyBgQnl0ZXNgIG9iamVjdCBpcyBlcXVhbCB0byB0aGUgcHJvdmlkZWQgb25lLlxuICAgICAqLyAgICBpc0VxdWFsKHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2J5dGVTdHJpbmcuaXNFcXVhbCh0Ll9ieXRlU3RyaW5nKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIFNlbnRpbmVsIHZhbHVlcyB0aGF0IGNhbiBiZSB1c2VkIHdoZW4gd3JpdGluZyBkb2N1bWVudCBmaWVsZHMgd2l0aCBgc2V0KClgXG4gKiBvciBgdXBkYXRlKClgLlxuICovIGNsYXNzIGpjIHtcbiAgICAvKipcbiAgICAgKiBAcGFyYW0gX21ldGhvZE5hbWUgLSBUaGUgcHVibGljIEFQSSBlbmRwb2ludCB0aGF0IHJldHVybnMgdGhpcyBjbGFzcy5cbiAgICAgKiBAaGlkZWNvbnN0cnVjdG9yXG4gICAgICovXG4gICAgY29uc3RydWN0b3IodCkge1xuICAgICAgICB0aGlzLl9tZXRob2ROYW1lID0gdDtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEFuIGltbXV0YWJsZSBvYmplY3QgcmVwcmVzZW50aW5nIGEgZ2VvZ3JhcGhpYyBsb2NhdGlvbiBpbiBGaXJlc3RvcmUuIFRoZVxuICogbG9jYXRpb24gaXMgcmVwcmVzZW50ZWQgYXMgbGF0aXR1ZGUvbG9uZ2l0dWRlIHBhaXIuXG4gKlxuICogTGF0aXR1ZGUgdmFsdWVzIGFyZSBpbiB0aGUgcmFuZ2Ugb2YgWy05MCwgOTBdLlxuICogTG9uZ2l0dWRlIHZhbHVlcyBhcmUgaW4gdGhlIHJhbmdlIG9mIFstMTgwLCAxODBdLlxuICovIGNsYXNzIFdjIHtcbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgbmV3IGltbXV0YWJsZSBgR2VvUG9pbnRgIG9iamVjdCB3aXRoIHRoZSBwcm92aWRlZCBsYXRpdHVkZSBhbmRcbiAgICAgKiBsb25naXR1ZGUgdmFsdWVzLlxuICAgICAqIEBwYXJhbSBsYXRpdHVkZSAtIFRoZSBsYXRpdHVkZSBhcyBudW1iZXIgYmV0d2VlbiAtOTAgYW5kIDkwLlxuICAgICAqIEBwYXJhbSBsb25naXR1ZGUgLSBUaGUgbG9uZ2l0dWRlIGFzIG51bWJlciBiZXR3ZWVuIC0xODAgYW5kIDE4MC5cbiAgICAgKi9cbiAgICBjb25zdHJ1Y3Rvcih0LCBlKSB7XG4gICAgICAgIGlmICghaXNGaW5pdGUodCkgfHwgdCA8IC05MCB8fCB0ID4gOTApIHRocm93IG5ldyBRKEcuSU5WQUxJRF9BUkdVTUVOVCwgXCJMYXRpdHVkZSBtdXN0IGJlIGEgbnVtYmVyIGJldHdlZW4gLTkwIGFuZCA5MCwgYnV0IHdhczogXCIgKyB0KTtcbiAgICAgICAgaWYgKCFpc0Zpbml0ZShlKSB8fCBlIDwgLTE4MCB8fCBlID4gMTgwKSB0aHJvdyBuZXcgUShHLklOVkFMSURfQVJHVU1FTlQsIFwiTG9uZ2l0dWRlIG11c3QgYmUgYSBudW1iZXIgYmV0d2VlbiAtMTgwIGFuZCAxODAsIGJ1dCB3YXM6IFwiICsgZSk7XG4gICAgICAgIHRoaXMuX2xhdCA9IHQsIHRoaXMuX2xvbmcgPSBlO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBUaGUgbGF0aXR1ZGUgb2YgdGhpcyBgR2VvUG9pbnRgIGluc3RhbmNlLlxuICAgICAqLyAgICBnZXQgbGF0aXR1ZGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9sYXQ7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFRoZSBsb25naXR1ZGUgb2YgdGhpcyBgR2VvUG9pbnRgIGluc3RhbmNlLlxuICAgICAqLyAgICBnZXQgbG9uZ2l0dWRlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fbG9uZztcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0cnVlIGlmIHRoaXMgYEdlb1BvaW50YCBpcyBlcXVhbCB0byB0aGUgcHJvdmlkZWQgb25lLlxuICAgICAqXG4gICAgICogQHBhcmFtIG90aGVyIC0gVGhlIGBHZW9Qb2ludGAgdG8gY29tcGFyZSBhZ2FpbnN0LlxuICAgICAqIEByZXR1cm5zIHRydWUgaWYgdGhpcyBgR2VvUG9pbnRgIGlzIGVxdWFsIHRvIHRoZSBwcm92aWRlZCBvbmUuXG4gICAgICovICAgIGlzRXF1YWwodCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fbGF0ID09PSB0Ll9sYXQgJiYgdGhpcy5fbG9uZyA9PT0gdC5fbG9uZztcbiAgICB9XG4gICAgLyoqIFJldHVybnMgYSBKU09OLXNlcmlhbGl6YWJsZSByZXByZXNlbnRhdGlvbiBvZiB0aGlzIEdlb1BvaW50LiAqLyAgICB0b0pTT04oKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBsYXRpdHVkZTogdGhpcy5fbGF0LFxuICAgICAgICAgICAgbG9uZ2l0dWRlOiB0aGlzLl9sb25nXG4gICAgICAgIH07XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEFjdHVhbGx5IHByaXZhdGUgdG8gSlMgY29uc3VtZXJzIG9mIG91ciBBUEksIHNvIHRoaXMgZnVuY3Rpb24gaXMgcHJlZml4ZWRcbiAgICAgKiB3aXRoIGFuIHVuZGVyc2NvcmUuXG4gICAgICovICAgIF9jb21wYXJlVG8odCkge1xuICAgICAgICByZXR1cm4gcnQodGhpcy5fbGF0LCB0Ll9sYXQpIHx8IHJ0KHRoaXMuX2xvbmcsIHQuX2xvbmcpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi8gY29uc3QgemMgPSAvXl9fLipfXyQvO1xuXG4vKiogVGhlIHJlc3VsdCBvZiBwYXJzaW5nIGRvY3VtZW50IGRhdGEgKGUuZy4gZm9yIGEgc2V0RGF0YSBjYWxsKS4gKi8gY2xhc3MgSGMge1xuICAgIGNvbnN0cnVjdG9yKHQsIGUsIG4pIHtcbiAgICAgICAgdGhpcy5kYXRhID0gdCwgdGhpcy5maWVsZE1hc2sgPSBlLCB0aGlzLmZpZWxkVHJhbnNmb3JtcyA9IG47XG4gICAgfVxuICAgIHRvTXV0YXRpb24odCwgZSkge1xuICAgICAgICByZXR1cm4gbnVsbCAhPT0gdGhpcy5maWVsZE1hc2sgPyBuZXcgeG4odCwgdGhpcy5kYXRhLCB0aGlzLmZpZWxkTWFzaywgZSwgdGhpcy5maWVsZFRyYW5zZm9ybXMpIDogbmV3IENuKHQsIHRoaXMuZGF0YSwgZSwgdGhpcy5maWVsZFRyYW5zZm9ybXMpO1xuICAgIH1cbn1cblxuLyoqIFRoZSByZXN1bHQgb2YgcGFyc2luZyBcInVwZGF0ZVwiIGRhdGEgKGkuZS4gZm9yIGFuIHVwZGF0ZURhdGEgY2FsbCkuICovIGNsYXNzIEpjIHtcbiAgICBjb25zdHJ1Y3Rvcih0LCBcbiAgICAvLyBUaGUgZmllbGRNYXNrIGRvZXMgbm90IGluY2x1ZGUgZG9jdW1lbnQgdHJhbnNmb3Jtcy5cbiAgICBlLCBuKSB7XG4gICAgICAgIHRoaXMuZGF0YSA9IHQsIHRoaXMuZmllbGRNYXNrID0gZSwgdGhpcy5maWVsZFRyYW5zZm9ybXMgPSBuO1xuICAgIH1cbiAgICB0b011dGF0aW9uKHQsIGUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyB4bih0LCB0aGlzLmRhdGEsIHRoaXMuZmllbGRNYXNrLCBlLCB0aGlzLmZpZWxkVHJhbnNmb3Jtcyk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBZYyh0KSB7XG4gICAgc3dpdGNoICh0KSB7XG4gICAgICBjYXNlIDAgLyogU2V0ICovIDpcbiAvLyBmYWxsIHRocm91Z2hcbiAgICAgICAgICAgICAgY2FzZSAyIC8qIE1lcmdlU2V0ICovIDpcbiAvLyBmYWxsIHRocm91Z2hcbiAgICAgICAgICAgICAgY2FzZSAxIC8qIFVwZGF0ZSAqLyA6XG4gICAgICAgIHJldHVybiAhMDtcblxuICAgICAgY2FzZSAzIC8qIEFyZ3VtZW50ICovIDpcbiAgICAgIGNhc2UgNCAvKiBBcnJheUFyZ3VtZW50ICovIDpcbiAgICAgICAgcmV0dXJuICExO1xuXG4gICAgICBkZWZhdWx0OlxuICAgICAgICB0aHJvdyBMKCk7XG4gICAgfVxufVxuXG4vKiogQSBcImNvbnRleHRcIiBvYmplY3QgcGFzc2VkIGFyb3VuZCB3aGlsZSBwYXJzaW5nIHVzZXIgZGF0YS4gKi8gY2xhc3MgWGMge1xuICAgIC8qKlxuICAgICAqIEluaXRpYWxpemVzIGEgUGFyc2VDb250ZXh0IHdpdGggdGhlIGdpdmVuIHNvdXJjZSBhbmQgcGF0aC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBzZXR0aW5ncyAtIFRoZSBzZXR0aW5ncyBmb3IgdGhlIHBhcnNlci5cbiAgICAgKiBAcGFyYW0gZGF0YWJhc2VJZCAtIFRoZSBkYXRhYmFzZSBJRCBvZiB0aGUgRmlyZXN0b3JlIGluc3RhbmNlLlxuICAgICAqIEBwYXJhbSBzZXJpYWxpemVyIC0gVGhlIHNlcmlhbGl6ZXIgdG8gdXNlIHRvIGdlbmVyYXRlIHRoZSBWYWx1ZSBwcm90by5cbiAgICAgKiBAcGFyYW0gaWdub3JlVW5kZWZpbmVkUHJvcGVydGllcyAtIFdoZXRoZXIgdG8gaWdub3JlIHVuZGVmaW5lZCBwcm9wZXJ0aWVzXG4gICAgICogcmF0aGVyIHRoYW4gdGhyb3cuXG4gICAgICogQHBhcmFtIGZpZWxkVHJhbnNmb3JtcyAtIEEgbXV0YWJsZSBsaXN0IG9mIGZpZWxkIHRyYW5zZm9ybXMgZW5jb3VudGVyZWRcbiAgICAgKiB3aGlsZSBwYXJzaW5nIHRoZSBkYXRhLlxuICAgICAqIEBwYXJhbSBmaWVsZE1hc2sgLSBBIG11dGFibGUgbGlzdCBvZiBmaWVsZCBwYXRocyBlbmNvdW50ZXJlZCB3aGlsZSBwYXJzaW5nXG4gICAgICogdGhlIGRhdGEuXG4gICAgICpcbiAgICAgKiBUT0RPKGIvMzQ4NzExMzEpOiBXZSBkb24ndCBzdXBwb3J0IGFycmF5IHBhdGhzIHJpZ2h0IG5vdywgc28gcGF0aCBjYW4gYmVcbiAgICAgKiBudWxsIHRvIGluZGljYXRlIHRoZSBjb250ZXh0IHJlcHJlc2VudHMgYW55IGxvY2F0aW9uIHdpdGhpbiBhbiBhcnJheSAoaW5cbiAgICAgKiB3aGljaCBjYXNlIGNlcnRhaW4gZmVhdHVyZXMgd2lsbCBub3Qgd29yayBhbmQgZXJyb3JzIHdpbGwgYmUgc29tZXdoYXRcbiAgICAgKiBjb21wcm9taXNlZCkuXG4gICAgICovXG4gICAgY29uc3RydWN0b3IodCwgZSwgbiwgcywgaSwgcikge1xuICAgICAgICB0aGlzLnNldHRpbmdzID0gdCwgdGhpcy5kYXRhYmFzZUlkID0gZSwgdGhpcy5NID0gbiwgdGhpcy5pZ25vcmVVbmRlZmluZWRQcm9wZXJ0aWVzID0gcywgXG4gICAgICAgIC8vIE1pbm9yIGhhY2s6IElmIGZpZWxkVHJhbnNmb3JtcyBpcyB1bmRlZmluZWQsIHdlIGFzc3VtZSB0aGlzIGlzIGFuXG4gICAgICAgIC8vIGV4dGVybmFsIGNhbGwgYW5kIHdlIG5lZWQgdG8gdmFsaWRhdGUgdGhlIGVudGlyZSBwYXRoLlxuICAgICAgICB2b2lkIDAgPT09IGkgJiYgdGhpcy50YygpLCB0aGlzLmZpZWxkVHJhbnNmb3JtcyA9IGkgfHwgW10sIHRoaXMuZmllbGRNYXNrID0gciB8fCBbXTtcbiAgICB9XG4gICAgZ2V0IHBhdGgoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNldHRpbmdzLnBhdGg7XG4gICAgfVxuICAgIGdldCBlYygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2V0dGluZ3MuZWM7XG4gICAgfVxuICAgIC8qKiBSZXR1cm5zIGEgbmV3IGNvbnRleHQgd2l0aCB0aGUgc3BlY2lmaWVkIHNldHRpbmdzIG92ZXJ3cml0dGVuLiAqLyAgICBuYyh0KSB7XG4gICAgICAgIHJldHVybiBuZXcgWGMoT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCB0aGlzLnNldHRpbmdzKSwgdCksIHRoaXMuZGF0YWJhc2VJZCwgdGhpcy5NLCB0aGlzLmlnbm9yZVVuZGVmaW5lZFByb3BlcnRpZXMsIHRoaXMuZmllbGRUcmFuc2Zvcm1zLCB0aGlzLmZpZWxkTWFzayk7XG4gICAgfVxuICAgIHNjKHQpIHtcbiAgICAgICAgdmFyIGU7XG4gICAgICAgIGNvbnN0IG4gPSBudWxsID09PSAoZSA9IHRoaXMucGF0aCkgfHwgdm9pZCAwID09PSBlID8gdm9pZCAwIDogZS5jaGlsZCh0KSwgcyA9IHRoaXMubmMoe1xuICAgICAgICAgICAgcGF0aDogbixcbiAgICAgICAgICAgIGljOiAhMVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHMucmModCksIHM7XG4gICAgfVxuICAgIG9jKHQpIHtcbiAgICAgICAgdmFyIGU7XG4gICAgICAgIGNvbnN0IG4gPSBudWxsID09PSAoZSA9IHRoaXMucGF0aCkgfHwgdm9pZCAwID09PSBlID8gdm9pZCAwIDogZS5jaGlsZCh0KSwgcyA9IHRoaXMubmMoe1xuICAgICAgICAgICAgcGF0aDogbixcbiAgICAgICAgICAgIGljOiAhMVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHMudGMoKSwgcztcbiAgICB9XG4gICAgdWModCkge1xuICAgICAgICAvLyBUT0RPKGIvMzQ4NzExMzEpOiBXZSBkb24ndCBzdXBwb3J0IGFycmF5IHBhdGhzIHJpZ2h0IG5vdzsgc28gbWFrZSBwYXRoXG4gICAgICAgIC8vIHVuZGVmaW5lZC5cbiAgICAgICAgcmV0dXJuIHRoaXMubmMoe1xuICAgICAgICAgICAgcGF0aDogdm9pZCAwLFxuICAgICAgICAgICAgaWM6ICEwXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBhYyh0KSB7XG4gICAgICAgIHJldHVybiB5aCh0LCB0aGlzLnNldHRpbmdzLm1ldGhvZE5hbWUsIHRoaXMuc2V0dGluZ3MuY2MgfHwgITEsIHRoaXMucGF0aCwgdGhpcy5zZXR0aW5ncy5oYyk7XG4gICAgfVxuICAgIC8qKiBSZXR1cm5zICd0cnVlJyBpZiAnZmllbGRQYXRoJyB3YXMgdHJhdmVyc2VkIHdoZW4gY3JlYXRpbmcgdGhpcyBjb250ZXh0LiAqLyAgICBjb250YWlucyh0KSB7XG4gICAgICAgIHJldHVybiB2b2lkIDAgIT09IHRoaXMuZmllbGRNYXNrLmZpbmQoKGUgPT4gdC5pc1ByZWZpeE9mKGUpKSkgfHwgdm9pZCAwICE9PSB0aGlzLmZpZWxkVHJhbnNmb3Jtcy5maW5kKChlID0+IHQuaXNQcmVmaXhPZihlLmZpZWxkKSkpO1xuICAgIH1cbiAgICB0YygpIHtcbiAgICAgICAgLy8gVE9ETyhiLzM0ODcxMTMxKTogUmVtb3ZlIG51bGwgY2hlY2sgb25jZSB3ZSBoYXZlIHByb3BlciBwYXRocyBmb3IgZmllbGRzXG4gICAgICAgIC8vIHdpdGhpbiBhcnJheXMuXG4gICAgICAgIGlmICh0aGlzLnBhdGgpIGZvciAobGV0IHQgPSAwOyB0IDwgdGhpcy5wYXRoLmxlbmd0aDsgdCsrKSB0aGlzLnJjKHRoaXMucGF0aC5nZXQodCkpO1xuICAgIH1cbiAgICByYyh0KSB7XG4gICAgICAgIGlmICgwID09PSB0Lmxlbmd0aCkgdGhyb3cgdGhpcy5hYyhcIkRvY3VtZW50IGZpZWxkcyBtdXN0IG5vdCBiZSBlbXB0eVwiKTtcbiAgICAgICAgaWYgKFljKHRoaXMuZWMpICYmIHpjLnRlc3QodCkpIHRocm93IHRoaXMuYWMoJ0RvY3VtZW50IGZpZWxkcyBjYW5ub3QgYmVnaW4gYW5kIGVuZCB3aXRoIFwiX19cIicpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBIZWxwZXIgZm9yIHBhcnNpbmcgcmF3IHVzZXIgaW5wdXQgKHByb3ZpZGVkIHZpYSB0aGUgQVBJKSBpbnRvIGludGVybmFsIG1vZGVsXG4gKiBjbGFzc2VzLlxuICovIGNsYXNzIFpjIHtcbiAgICBjb25zdHJ1Y3Rvcih0LCBlLCBuKSB7XG4gICAgICAgIHRoaXMuZGF0YWJhc2VJZCA9IHQsIHRoaXMuaWdub3JlVW5kZWZpbmVkUHJvcGVydGllcyA9IGUsIHRoaXMuTSA9IG4gfHwgam8odCk7XG4gICAgfVxuICAgIC8qKiBDcmVhdGVzIGEgbmV3IHRvcC1sZXZlbCBwYXJzZSBjb250ZXh0LiAqLyAgICBsYyh0LCBlLCBuLCBzID0gITEpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBYYyh7XG4gICAgICAgICAgICBlYzogdCxcbiAgICAgICAgICAgIG1ldGhvZE5hbWU6IGUsXG4gICAgICAgICAgICBoYzogbixcbiAgICAgICAgICAgIHBhdGg6IG10LmVtcHR5UGF0aCgpLFxuICAgICAgICAgICAgaWM6ICExLFxuICAgICAgICAgICAgY2M6IHNcbiAgICAgICAgfSwgdGhpcy5kYXRhYmFzZUlkLCB0aGlzLk0sIHRoaXMuaWdub3JlVW5kZWZpbmVkUHJvcGVydGllcyk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiB0aCh0KSB7XG4gICAgY29uc3QgZSA9IHQuX2ZyZWV6ZVNldHRpbmdzKCksIG4gPSBqbyh0Ll9kYXRhYmFzZUlkKTtcbiAgICByZXR1cm4gbmV3IFpjKHQuX2RhdGFiYXNlSWQsICEhZS5pZ25vcmVVbmRlZmluZWRQcm9wZXJ0aWVzLCBuKTtcbn1cblxuLyoqIFBhcnNlIGRvY3VtZW50IGRhdGEgZnJvbSBhIHNldCgpIGNhbGwuICovIGZ1bmN0aW9uIGVoKHQsIGUsIG4sIHMsIGksIHIgPSB7fSkge1xuICAgIGNvbnN0IG8gPSB0LmxjKHIubWVyZ2UgfHwgci5tZXJnZUZpZWxkcyA/IDIgLyogTWVyZ2VTZXQgKi8gOiAwIC8qIFNldCAqLyAsIGUsIG4sIGkpO1xuICAgIF9oKFwiRGF0YSBtdXN0IGJlIGFuIG9iamVjdCwgYnV0IGl0IHdhczpcIiwgbywgcyk7XG4gICAgY29uc3QgdSA9IGZoKHMsIG8pO1xuICAgIGxldCBhLCBjO1xuICAgIGlmIChyLm1lcmdlKSBhID0gbmV3IGd0KG8uZmllbGRNYXNrKSwgYyA9IG8uZmllbGRUcmFuc2Zvcm1zOyBlbHNlIGlmIChyLm1lcmdlRmllbGRzKSB7XG4gICAgICAgIGNvbnN0IHQgPSBbXTtcbiAgICAgICAgZm9yIChjb25zdCBzIG9mIHIubWVyZ2VGaWVsZHMpIHtcbiAgICAgICAgICAgIGNvbnN0IGkgPSB3aChlLCBzLCBuKTtcbiAgICAgICAgICAgIGlmICghby5jb250YWlucyhpKSkgdGhyb3cgbmV3IFEoRy5JTlZBTElEX0FSR1VNRU5ULCBgRmllbGQgJyR7aX0nIGlzIHNwZWNpZmllZCBpbiB5b3VyIGZpZWxkIG1hc2sgYnV0IG1pc3NpbmcgZnJvbSB5b3VyIGlucHV0IGRhdGEuYCk7XG4gICAgICAgICAgICBwaCh0LCBpKSB8fCB0LnB1c2goaSk7XG4gICAgICAgIH1cbiAgICAgICAgYSA9IG5ldyBndCh0KSwgYyA9IG8uZmllbGRUcmFuc2Zvcm1zLmZpbHRlcigodCA9PiBhLmNvdmVycyh0LmZpZWxkKSkpO1xuICAgIH0gZWxzZSBhID0gbnVsbCwgYyA9IG8uZmllbGRUcmFuc2Zvcm1zO1xuICAgIHJldHVybiBuZXcgSGMobmV3IHRlKHUpLCBhLCBjKTtcbn1cblxuY2xhc3MgbmggZXh0ZW5kcyBqYyB7XG4gICAgX3RvRmllbGRUcmFuc2Zvcm0odCkge1xuICAgICAgICBpZiAoMiAvKiBNZXJnZVNldCAqLyAhPT0gdC5lYykgdGhyb3cgMSAvKiBVcGRhdGUgKi8gPT09IHQuZWMgPyB0LmFjKGAke3RoaXMuX21ldGhvZE5hbWV9KCkgY2FuIG9ubHkgYXBwZWFyIGF0IHRoZSB0b3AgbGV2ZWwgb2YgeW91ciB1cGRhdGUgZGF0YWApIDogdC5hYyhgJHt0aGlzLl9tZXRob2ROYW1lfSgpIGNhbm5vdCBiZSB1c2VkIHdpdGggc2V0KCkgdW5sZXNzIHlvdSBwYXNzIHttZXJnZTp0cnVlfWApO1xuICAgICAgICAvLyBObyB0cmFuc2Zvcm0gdG8gYWRkIGZvciBhIGRlbGV0ZSwgYnV0IHdlIG5lZWQgdG8gYWRkIGl0IHRvIG91clxuICAgICAgICAvLyBmaWVsZE1hc2sgc28gaXQgZ2V0cyBkZWxldGVkLlxuICAgICAgICByZXR1cm4gdC5maWVsZE1hc2sucHVzaCh0LnBhdGgpLCBudWxsO1xuICAgIH1cbiAgICBpc0VxdWFsKHQpIHtcbiAgICAgICAgcmV0dXJuIHQgaW5zdGFuY2VvZiBuaDtcbiAgICB9XG59XG5cbi8qKlxuICogQ3JlYXRlcyBhIGNoaWxkIGNvbnRleHQgZm9yIHBhcnNpbmcgU2VyaWFsaXphYmxlRmllbGRWYWx1ZXMuXG4gKlxuICogVGhpcyBpcyBkaWZmZXJlbnQgdGhhbiBjYWxsaW5nIGBQYXJzZUNvbnRleHQuY29udGV4dFdpdGhgIGJlY2F1c2UgaXQga2VlcHNcbiAqIHRoZSBmaWVsZFRyYW5zZm9ybXMgYW5kIGZpZWxkTWFzayBzZXBhcmF0ZS5cbiAqXG4gKiBUaGUgY3JlYXRlZCBjb250ZXh0IGhhcyBpdHMgYGRhdGFTb3VyY2VgIHNldCB0byBgVXNlckRhdGFTb3VyY2UuQXJndW1lbnRgLlxuICogQWx0aG91Z2ggdGhlc2UgdmFsdWVzIGFyZSB1c2VkIHdpdGggd3JpdGVzLCBhbnkgZWxlbWVudHMgaW4gdGhlc2UgRmllbGRWYWx1ZXNcbiAqIGFyZSBub3QgY29uc2lkZXJlZCB3cml0ZXMgc2luY2UgdGhleSBjYW5ub3QgY29udGFpbiBhbnkgRmllbGRWYWx1ZSBzZW50aW5lbHMsXG4gKiBldGMuXG4gKlxuICogQHBhcmFtIGZpZWxkVmFsdWUgLSBUaGUgc2VudGluZWwgRmllbGRWYWx1ZSBmb3Igd2hpY2ggdG8gY3JlYXRlIGEgY2hpbGRcbiAqICAgICBjb250ZXh0LlxuICogQHBhcmFtIGNvbnRleHQgLSBUaGUgcGFyZW50IGNvbnRleHQuXG4gKiBAcGFyYW0gYXJyYXlFbGVtZW50IC0gV2hldGhlciBvciBub3QgdGhlIEZpZWxkVmFsdWUgaGFzIGFuIGFycmF5LlxuICovIGZ1bmN0aW9uIHNoKHQsIGUsIG4pIHtcbiAgICByZXR1cm4gbmV3IFhjKHtcbiAgICAgICAgZWM6IDMgLyogQXJndW1lbnQgKi8gLFxuICAgICAgICBoYzogZS5zZXR0aW5ncy5oYyxcbiAgICAgICAgbWV0aG9kTmFtZTogdC5fbWV0aG9kTmFtZSxcbiAgICAgICAgaWM6IG5cbiAgICB9LCBlLmRhdGFiYXNlSWQsIGUuTSwgZS5pZ25vcmVVbmRlZmluZWRQcm9wZXJ0aWVzKTtcbn1cblxuY2xhc3MgaWggZXh0ZW5kcyBqYyB7XG4gICAgX3RvRmllbGRUcmFuc2Zvcm0odCkge1xuICAgICAgICByZXR1cm4gbmV3IEluKHQucGF0aCwgbmV3IGZuKTtcbiAgICB9XG4gICAgaXNFcXVhbCh0KSB7XG4gICAgICAgIHJldHVybiB0IGluc3RhbmNlb2YgaWg7XG4gICAgfVxufVxuXG5jbGFzcyByaCBleHRlbmRzIGpjIHtcbiAgICBjb25zdHJ1Y3Rvcih0LCBlKSB7XG4gICAgICAgIHN1cGVyKHQpLCB0aGlzLmZjID0gZTtcbiAgICB9XG4gICAgX3RvRmllbGRUcmFuc2Zvcm0odCkge1xuICAgICAgICBjb25zdCBlID0gc2godGhpcywgdCwgXG4gICAgICAgIC8qYXJyYXk9Ki8gITApLCBuID0gdGhpcy5mYy5tYXAoKHQgPT4gbGgodCwgZSkpKSwgcyA9IG5ldyBkbihuKTtcbiAgICAgICAgcmV0dXJuIG5ldyBJbih0LnBhdGgsIHMpO1xuICAgIH1cbiAgICBpc0VxdWFsKHQpIHtcbiAgICAgICAgLy8gVE9ETyhtcnNjaG1pZHQpOiBJbXBsZW1lbnQgaXNFcXVhbHNcbiAgICAgICAgcmV0dXJuIHRoaXMgPT09IHQ7XG4gICAgfVxufVxuXG5jbGFzcyBvaCBleHRlbmRzIGpjIHtcbiAgICBjb25zdHJ1Y3Rvcih0LCBlKSB7XG4gICAgICAgIHN1cGVyKHQpLCB0aGlzLmZjID0gZTtcbiAgICB9XG4gICAgX3RvRmllbGRUcmFuc2Zvcm0odCkge1xuICAgICAgICBjb25zdCBlID0gc2godGhpcywgdCwgXG4gICAgICAgIC8qYXJyYXk9Ki8gITApLCBuID0gdGhpcy5mYy5tYXAoKHQgPT4gbGgodCwgZSkpKSwgcyA9IG5ldyB3bihuKTtcbiAgICAgICAgcmV0dXJuIG5ldyBJbih0LnBhdGgsIHMpO1xuICAgIH1cbiAgICBpc0VxdWFsKHQpIHtcbiAgICAgICAgLy8gVE9ETyhtcnNjaG1pZHQpOiBJbXBsZW1lbnQgaXNFcXVhbHNcbiAgICAgICAgcmV0dXJuIHRoaXMgPT09IHQ7XG4gICAgfVxufVxuXG5jbGFzcyB1aCBleHRlbmRzIGpjIHtcbiAgICBjb25zdHJ1Y3Rvcih0LCBlKSB7XG4gICAgICAgIHN1cGVyKHQpLCB0aGlzLmRjID0gZTtcbiAgICB9XG4gICAgX3RvRmllbGRUcmFuc2Zvcm0odCkge1xuICAgICAgICBjb25zdCBlID0gbmV3IGduKHQuTSwgdW4odC5NLCB0aGlzLmRjKSk7XG4gICAgICAgIHJldHVybiBuZXcgSW4odC5wYXRoLCBlKTtcbiAgICB9XG4gICAgaXNFcXVhbCh0KSB7XG4gICAgICAgIC8vIFRPRE8obXJzY2htaWR0KTogSW1wbGVtZW50IGlzRXF1YWxzXG4gICAgICAgIHJldHVybiB0aGlzID09PSB0O1xuICAgIH1cbn1cblxuLyoqIFBhcnNlIHVwZGF0ZSBkYXRhIGZyb20gYW4gdXBkYXRlKCkgY2FsbC4gKi8gZnVuY3Rpb24gYWgodCwgZSwgbiwgcykge1xuICAgIGNvbnN0IGkgPSB0LmxjKDEgLyogVXBkYXRlICovICwgZSwgbik7XG4gICAgX2goXCJEYXRhIG11c3QgYmUgYW4gb2JqZWN0LCBidXQgaXQgd2FzOlwiLCBpLCBzKTtcbiAgICBjb25zdCByID0gW10sIG8gPSB0ZS5lbXB0eSgpO1xuICAgIGx0KHMsICgodCwgcykgPT4ge1xuICAgICAgICBjb25zdCB1ID0gZ2goZSwgdCwgbik7XG4gICAgICAgIC8vIEZvciBDb21wYXQgdHlwZXMsIHdlIGhhdmUgdG8gXCJleHRyYWN0XCIgdGhlIHVuZGVybHlpbmcgdHlwZXMgYmVmb3JlXG4gICAgICAgIC8vIHBlcmZvcm1pbmcgdmFsaWRhdGlvbi5cbiAgICAgICAgICAgICAgICBzID0gcChzKTtcbiAgICAgICAgY29uc3QgYSA9IGkub2ModSk7XG4gICAgICAgIGlmIChzIGluc3RhbmNlb2YgbmgpIFxuICAgICAgICAvLyBBZGQgaXQgdG8gdGhlIGZpZWxkIG1hc2ssIGJ1dCBkb24ndCBhZGQgYW55dGhpbmcgdG8gdXBkYXRlRGF0YS5cbiAgICAgICAgci5wdXNoKHUpOyBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IHQgPSBsaChzLCBhKTtcbiAgICAgICAgICAgIG51bGwgIT0gdCAmJiAoci5wdXNoKHUpLCBvLnNldCh1LCB0KSk7XG4gICAgICAgIH1cbiAgICB9KSk7XG4gICAgY29uc3QgdSA9IG5ldyBndChyKTtcbiAgICByZXR1cm4gbmV3IEpjKG8sIHUsIGkuZmllbGRUcmFuc2Zvcm1zKTtcbn1cblxuLyoqIFBhcnNlIHVwZGF0ZSBkYXRhIGZyb20gYSBsaXN0IG9mIGZpZWxkL3ZhbHVlIGFyZ3VtZW50cy4gKi8gZnVuY3Rpb24gY2godCwgZSwgbiwgcywgaSwgcikge1xuICAgIGNvbnN0IG8gPSB0LmxjKDEgLyogVXBkYXRlICovICwgZSwgbiksIHUgPSBbIHdoKGUsIHMsIG4pIF0sIGEgPSBbIGkgXTtcbiAgICBpZiAoci5sZW5ndGggJSAyICE9IDApIHRocm93IG5ldyBRKEcuSU5WQUxJRF9BUkdVTUVOVCwgYEZ1bmN0aW9uICR7ZX0oKSBuZWVkcyB0byBiZSBjYWxsZWQgd2l0aCBhbiBldmVuIG51bWJlciBvZiBhcmd1bWVudHMgdGhhdCBhbHRlcm5hdGUgYmV0d2VlbiBmaWVsZCBuYW1lcyBhbmQgdmFsdWVzLmApO1xuICAgIGZvciAobGV0IHQgPSAwOyB0IDwgci5sZW5ndGg7IHQgKz0gMikgdS5wdXNoKHdoKGUsIHJbdF0pKSwgYS5wdXNoKHJbdCArIDFdKTtcbiAgICBjb25zdCBjID0gW10sIGggPSB0ZS5lbXB0eSgpO1xuICAgIC8vIFdlIGl0ZXJhdGUgaW4gcmV2ZXJzZSBvcmRlciB0byBwaWNrIHRoZSBsYXN0IHZhbHVlIGZvciBhIGZpZWxkIGlmIHRoZVxuICAgIC8vIHVzZXIgc3BlY2lmaWVkIHRoZSBmaWVsZCBtdWx0aXBsZSB0aW1lcy5cbiAgICBmb3IgKGxldCB0ID0gdS5sZW5ndGggLSAxOyB0ID49IDA7IC0tdCkgaWYgKCFwaChjLCB1W3RdKSkge1xuICAgICAgICBjb25zdCBlID0gdVt0XTtcbiAgICAgICAgbGV0IG4gPSBhW3RdO1xuICAgICAgICAvLyBGb3IgQ29tcGF0IHR5cGVzLCB3ZSBoYXZlIHRvIFwiZXh0cmFjdFwiIHRoZSB1bmRlcmx5aW5nIHR5cGVzIGJlZm9yZVxuICAgICAgICAvLyBwZXJmb3JtaW5nIHZhbGlkYXRpb24uXG4gICAgICAgICAgICAgICAgbiA9IHAobik7XG4gICAgICAgIGNvbnN0IHMgPSBvLm9jKGUpO1xuICAgICAgICBpZiAobiBpbnN0YW5jZW9mIG5oKSBcbiAgICAgICAgLy8gQWRkIGl0IHRvIHRoZSBmaWVsZCBtYXNrLCBidXQgZG9uJ3QgYWRkIGFueXRoaW5nIHRvIHVwZGF0ZURhdGEuXG4gICAgICAgIGMucHVzaChlKTsgZWxzZSB7XG4gICAgICAgICAgICBjb25zdCB0ID0gbGgobiwgcyk7XG4gICAgICAgICAgICBudWxsICE9IHQgJiYgKGMucHVzaChlKSwgaC5zZXQoZSwgdCkpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNvbnN0IGwgPSBuZXcgZ3QoYyk7XG4gICAgcmV0dXJuIG5ldyBKYyhoLCBsLCBvLmZpZWxkVHJhbnNmb3Jtcyk7XG59XG5cbi8qKlxuICogUGFyc2UgYSBcInF1ZXJ5IHZhbHVlXCIgKGUuZy4gdmFsdWUgaW4gYSB3aGVyZSBmaWx0ZXIgb3IgYSB2YWx1ZSBpbiBhIGN1cnNvclxuICogYm91bmQpLlxuICpcbiAqIEBwYXJhbSBhbGxvd0FycmF5cyAtIFdoZXRoZXIgdGhlIHF1ZXJ5IHZhbHVlIGlzIGFuIGFycmF5IHRoYXQgbWF5IGRpcmVjdGx5XG4gKiBjb250YWluIGFkZGl0aW9uYWwgYXJyYXlzIChlLmcuIHRoZSBvcGVyYW5kIG9mIGFuIGBpbmAgcXVlcnkpLlxuICovIGZ1bmN0aW9uIGhoKHQsIGUsIG4sIHMgPSAhMSkge1xuICAgIHJldHVybiBsaChuLCB0LmxjKHMgPyA0IC8qIEFycmF5QXJndW1lbnQgKi8gOiAzIC8qIEFyZ3VtZW50ICovICwgZSkpO1xufVxuXG4vKipcbiAqIFBhcnNlcyB1c2VyIGRhdGEgdG8gUHJvdG9idWYgVmFsdWVzLlxuICpcbiAqIEBwYXJhbSBpbnB1dCAtIERhdGEgdG8gYmUgcGFyc2VkLlxuICogQHBhcmFtIGNvbnRleHQgLSBBIGNvbnRleHQgb2JqZWN0IHJlcHJlc2VudGluZyB0aGUgY3VycmVudCBwYXRoIGJlaW5nIHBhcnNlZCxcbiAqIHRoZSBzb3VyY2Ugb2YgdGhlIGRhdGEgYmVpbmcgcGFyc2VkLCBldGMuXG4gKiBAcmV0dXJucyBUaGUgcGFyc2VkIHZhbHVlLCBvciBudWxsIGlmIHRoZSB2YWx1ZSB3YXMgYSBGaWVsZFZhbHVlIHNlbnRpbmVsXG4gKiB0aGF0IHNob3VsZCBub3QgYmUgaW5jbHVkZWQgaW4gdGhlIHJlc3VsdGluZyBwYXJzZWQgZGF0YS5cbiAqLyBmdW5jdGlvbiBsaCh0LCBlKSB7XG4gICAgaWYgKGRoKFxuICAgIC8vIFVud3JhcCB0aGUgQVBJIHR5cGUgZnJvbSB0aGUgQ29tcGF0IFNESy4gVGhpcyB3aWxsIHJldHVybiB0aGUgQVBJIHR5cGVcbiAgICAvLyBmcm9tIGZpcmVzdG9yZS1leHAuXG4gICAgdCA9IHAodCkpKSByZXR1cm4gX2goXCJVbnN1cHBvcnRlZCBmaWVsZCB2YWx1ZTpcIiwgZSwgdCksIGZoKHQsIGUpO1xuICAgIGlmICh0IGluc3RhbmNlb2YgamMpIFxuICAgIC8vIEZpZWxkVmFsdWVzIHVzdWFsbHkgcGFyc2UgaW50byB0cmFuc2Zvcm1zIChleGNlcHQgZGVsZXRlRmllbGQoKSlcbiAgICAvLyBpbiB3aGljaCBjYXNlIHdlIGRvIG5vdCB3YW50IHRvIGluY2x1ZGUgdGhpcyBmaWVsZCBpbiBvdXIgcGFyc2VkIGRhdGFcbiAgICAvLyAoYXMgZG9pbmcgc28gd2lsbCBvdmVyd3JpdGUgdGhlIGZpZWxkIGRpcmVjdGx5IHByaW9yIHRvIHRoZSB0cmFuc2Zvcm1cbiAgICAvLyB0cnlpbmcgdG8gdHJhbnNmb3JtIGl0KS4gU28gd2UgZG9uJ3QgYWRkIHRoaXMgbG9jYXRpb24gdG9cbiAgICAvLyBjb250ZXh0LmZpZWxkTWFzayBhbmQgd2UgcmV0dXJuIG51bGwgYXMgb3VyIHBhcnNpbmcgcmVzdWx0LlxuICAgIC8qKlxuICogXCJQYXJzZXNcIiB0aGUgcHJvdmlkZWQgRmllbGRWYWx1ZUltcGwsIGFkZGluZyBhbnkgbmVjZXNzYXJ5IHRyYW5zZm9ybXMgdG9cbiAqIGNvbnRleHQuZmllbGRUcmFuc2Zvcm1zLlxuICovXG4gICAgcmV0dXJuIGZ1bmN0aW9uKHQsIGUpIHtcbiAgICAgICAgLy8gU2VudGluZWxzIGFyZSBvbmx5IHN1cHBvcnRlZCB3aXRoIHdyaXRlcywgYW5kIG5vdCB3aXRoaW4gYXJyYXlzLlxuICAgICAgICBpZiAoIVljKGUuZWMpKSB0aHJvdyBlLmFjKGAke3QuX21ldGhvZE5hbWV9KCkgY2FuIG9ubHkgYmUgdXNlZCB3aXRoIHVwZGF0ZSgpIGFuZCBzZXQoKWApO1xuICAgICAgICBpZiAoIWUucGF0aCkgdGhyb3cgZS5hYyhgJHt0Ll9tZXRob2ROYW1lfSgpIGlzIG5vdCBjdXJyZW50bHkgc3VwcG9ydGVkIGluc2lkZSBhcnJheXNgKTtcbiAgICAgICAgY29uc3QgbiA9IHQuX3RvRmllbGRUcmFuc2Zvcm0oZSk7XG4gICAgICAgIG4gJiYgZS5maWVsZFRyYW5zZm9ybXMucHVzaChuKTtcbiAgICB9XG4gICAgLyoqXG4gKiBIZWxwZXIgdG8gcGFyc2UgYSBzY2FsYXIgdmFsdWUgKGkuZS4gbm90IGFuIE9iamVjdCwgQXJyYXksIG9yIEZpZWxkVmFsdWUpXG4gKlxuICogQHJldHVybnMgVGhlIHBhcnNlZCB2YWx1ZVxuICovICh0LCBlKSwgbnVsbDtcbiAgICBpZiAodm9pZCAwID09PSB0ICYmIGUuaWdub3JlVW5kZWZpbmVkUHJvcGVydGllcykgXG4gICAgLy8gSWYgdGhlIGlucHV0IGlzIHVuZGVmaW5lZCBpdCBjYW4gbmV2ZXIgcGFydGljaXBhdGUgaW4gdGhlIGZpZWxkTWFzaywgc29cbiAgICAvLyBkb24ndCBoYW5kbGUgdGhpcyBiZWxvdy4gSWYgYGlnbm9yZVVuZGVmaW5lZFByb3BlcnRpZXNgIGlzIGZhbHNlLFxuICAgIC8vIGBwYXJzZVNjYWxhclZhbHVlYCB3aWxsIHJlamVjdCBhbiB1bmRlZmluZWQgdmFsdWUuXG4gICAgcmV0dXJuIG51bGw7XG4gICAgaWYgKFxuICAgIC8vIElmIGNvbnRleHQucGF0aCBpcyBudWxsIHdlIGFyZSBpbnNpZGUgYW4gYXJyYXkgYW5kIHdlIGRvbid0IHN1cHBvcnRcbiAgICAvLyBmaWVsZCBtYXNrIHBhdGhzIG1vcmUgZ3JhbnVsYXIgdGhhbiB0aGUgdG9wLWxldmVsIGFycmF5LlxuICAgIGUucGF0aCAmJiBlLmZpZWxkTWFzay5wdXNoKGUucGF0aCksIHQgaW5zdGFuY2VvZiBBcnJheSkge1xuICAgICAgICAvLyBUT0RPKGIvMzQ4NzExMzEpOiBJbmNsdWRlIHRoZSBwYXRoIGNvbnRhaW5pbmcgdGhlIGFycmF5IGluIHRoZSBlcnJvclxuICAgICAgICAvLyBtZXNzYWdlLlxuICAgICAgICAvLyBJbiB0aGUgY2FzZSBvZiBJTiBxdWVyaWVzLCB0aGUgcGFyc2VkIGRhdGEgaXMgYW4gYXJyYXkgKHJlcHJlc2VudGluZ1xuICAgICAgICAvLyB0aGUgc2V0IG9mIHZhbHVlcyB0byBiZSBpbmNsdWRlZCBmb3IgdGhlIElOIHF1ZXJ5KSB0aGF0IG1heSBkaXJlY3RseVxuICAgICAgICAvLyBjb250YWluIGFkZGl0aW9uYWwgYXJyYXlzIChlYWNoIHJlcHJlc2VudGluZyBhbiBpbmRpdmlkdWFsIGZpZWxkXG4gICAgICAgIC8vIHZhbHVlKSwgc28gd2UgZGlzYWJsZSB0aGlzIHZhbGlkYXRpb24uXG4gICAgICAgIGlmIChlLnNldHRpbmdzLmljICYmIDQgLyogQXJyYXlBcmd1bWVudCAqLyAhPT0gZS5lYykgdGhyb3cgZS5hYyhcIk5lc3RlZCBhcnJheXMgYXJlIG5vdCBzdXBwb3J0ZWRcIik7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbih0LCBlKSB7XG4gICAgICAgICAgICBjb25zdCBuID0gW107XG4gICAgICAgICAgICBsZXQgcyA9IDA7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGkgb2YgdCkge1xuICAgICAgICAgICAgICAgIGxldCB0ID0gbGgoaSwgZS51YyhzKSk7XG4gICAgICAgICAgICAgICAgbnVsbCA9PSB0ICYmIChcbiAgICAgICAgICAgICAgICAvLyBKdXN0IGluY2x1ZGUgbnVsbHMgaW4gdGhlIGFycmF5IGZvciBmaWVsZHMgYmVpbmcgcmVwbGFjZWQgd2l0aCBhXG4gICAgICAgICAgICAgICAgLy8gc2VudGluZWwuXG4gICAgICAgICAgICAgICAgdCA9IHtcbiAgICAgICAgICAgICAgICAgICAgbnVsbFZhbHVlOiBcIk5VTExfVkFMVUVcIlxuICAgICAgICAgICAgICAgIH0pLCBuLnB1c2godCksIHMrKztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgYXJyYXlWYWx1ZToge1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZXM6IG5cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICB9KHQsIGUpO1xuICAgIH1cbiAgICByZXR1cm4gZnVuY3Rpb24odCwgZSkge1xuICAgICAgICBpZiAobnVsbCA9PT0gKHQgPSBwKHQpKSkgcmV0dXJuIHtcbiAgICAgICAgICAgIG51bGxWYWx1ZTogXCJOVUxMX1ZBTFVFXCJcbiAgICAgICAgfTtcbiAgICAgICAgaWYgKFwibnVtYmVyXCIgPT0gdHlwZW9mIHQpIHJldHVybiB1bihlLk0sIHQpO1xuICAgICAgICBpZiAoXCJib29sZWFuXCIgPT0gdHlwZW9mIHQpIHJldHVybiB7XG4gICAgICAgICAgICBib29sZWFuVmFsdWU6IHRcbiAgICAgICAgfTtcbiAgICAgICAgaWYgKFwic3RyaW5nXCIgPT0gdHlwZW9mIHQpIHJldHVybiB7XG4gICAgICAgICAgICBzdHJpbmdWYWx1ZTogdFxuICAgICAgICB9O1xuICAgICAgICBpZiAodCBpbnN0YW5jZW9mIERhdGUpIHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSBhdC5mcm9tRGF0ZSh0KTtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgdGltZXN0YW1wVmFsdWU6IGZzKGUuTSwgbilcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHQgaW5zdGFuY2VvZiBhdCkge1xuICAgICAgICAgICAgLy8gRmlyZXN0b3JlIGJhY2tlbmQgdHJ1bmNhdGVzIHByZWNpc2lvbiBkb3duIHRvIG1pY3Jvc2Vjb25kcy4gVG8gZW5zdXJlXG4gICAgICAgICAgICAvLyBvZmZsaW5lIG1vZGUgd29ya3MgdGhlIHNhbWUgd2l0aCByZWdhcmRzIHRvIHRydW5jYXRpb24sIHBlcmZvcm0gdGhlXG4gICAgICAgICAgICAvLyB0cnVuY2F0aW9uIGltbWVkaWF0ZWx5IHdpdGhvdXQgd2FpdGluZyBmb3IgdGhlIGJhY2tlbmQgdG8gZG8gdGhhdC5cbiAgICAgICAgICAgIGNvbnN0IG4gPSBuZXcgYXQodC5zZWNvbmRzLCAxZTMgKiBNYXRoLmZsb29yKHQubmFub3NlY29uZHMgLyAxZTMpKTtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgdGltZXN0YW1wVmFsdWU6IGZzKGUuTSwgbilcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHQgaW5zdGFuY2VvZiBXYykgcmV0dXJuIHtcbiAgICAgICAgICAgIGdlb1BvaW50VmFsdWU6IHtcbiAgICAgICAgICAgICAgICBsYXRpdHVkZTogdC5sYXRpdHVkZSxcbiAgICAgICAgICAgICAgICBsb25naXR1ZGU6IHQubG9uZ2l0dWRlXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIGlmICh0IGluc3RhbmNlb2YgUWMpIHJldHVybiB7XG4gICAgICAgICAgICBieXRlc1ZhbHVlOiBkcyhlLk0sIHQuX2J5dGVTdHJpbmcpXG4gICAgICAgIH07XG4gICAgICAgIGlmICh0IGluc3RhbmNlb2Ygd2MpIHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSBlLmRhdGFiYXNlSWQsIHMgPSB0LmZpcmVzdG9yZS5fZGF0YWJhc2VJZDtcbiAgICAgICAgICAgIGlmICghcy5pc0VxdWFsKG4pKSB0aHJvdyBlLmFjKGBEb2N1bWVudCByZWZlcmVuY2UgaXMgZm9yIGRhdGFiYXNlICR7cy5wcm9qZWN0SWR9LyR7cy5kYXRhYmFzZX0gYnV0IHNob3VsZCBiZSBmb3IgZGF0YWJhc2UgJHtuLnByb2plY3RJZH0vJHtuLmRhdGFiYXNlfWApO1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICByZWZlcmVuY2VWYWx1ZTogbXModC5maXJlc3RvcmUuX2RhdGFiYXNlSWQgfHwgZS5kYXRhYmFzZUlkLCB0Ll9rZXkucGF0aClcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgdGhyb3cgZS5hYyhgVW5zdXBwb3J0ZWQgZmllbGQgdmFsdWU6ICR7Y2ModCl9YCk7XG4gICAgfVxuICAgIC8qKlxuICogQ2hlY2tzIHdoZXRoZXIgYW4gb2JqZWN0IGxvb2tzIGxpa2UgYSBKU09OIG9iamVjdCB0aGF0IHNob3VsZCBiZSBjb252ZXJ0ZWRcbiAqIGludG8gYSBzdHJ1Y3QuIE5vcm1hbCBjbGFzcy9wcm90b3R5cGUgaW5zdGFuY2VzIGFyZSBjb25zaWRlcmVkIHRvIGxvb2sgbGlrZVxuICogSlNPTiBvYmplY3RzIHNpbmNlIHRoZXkgc2hvdWxkIGJlIGNvbnZlcnRlZCB0byBhIHN0cnVjdCB2YWx1ZS4gQXJyYXlzLCBEYXRlcyxcbiAqIEdlb1BvaW50cywgZXRjLiBhcmUgbm90IGNvbnNpZGVyZWQgdG8gbG9vayBsaWtlIEpTT04gb2JqZWN0cyBzaW5jZSB0aGV5IG1hcFxuICogdG8gc3BlY2lmaWMgRmllbGRWYWx1ZSB0eXBlcyBvdGhlciB0aGFuIE9iamVjdFZhbHVlLlxuICovICh0LCBlKTtcbn1cblxuZnVuY3Rpb24gZmgodCwgZSkge1xuICAgIGNvbnN0IG4gPSB7fTtcbiAgICByZXR1cm4gZnQodCkgPyBcbiAgICAvLyBJZiB3ZSBlbmNvdW50ZXIgYW4gZW1wdHkgb2JqZWN0LCB3ZSBleHBsaWNpdGx5IGFkZCBpdCB0byB0aGUgdXBkYXRlXG4gICAgLy8gbWFzayB0byBlbnN1cmUgdGhhdCB0aGUgc2VydmVyIGNyZWF0ZXMgYSBtYXAgZW50cnkuXG4gICAgZS5wYXRoICYmIGUucGF0aC5sZW5ndGggPiAwICYmIGUuZmllbGRNYXNrLnB1c2goZS5wYXRoKSA6IGx0KHQsICgodCwgcykgPT4ge1xuICAgICAgICBjb25zdCBpID0gbGgocywgZS5zYyh0KSk7XG4gICAgICAgIG51bGwgIT0gaSAmJiAoblt0XSA9IGkpO1xuICAgIH0pKSwge1xuICAgICAgICBtYXBWYWx1ZToge1xuICAgICAgICAgICAgZmllbGRzOiBuXG4gICAgICAgIH1cbiAgICB9O1xufVxuXG5mdW5jdGlvbiBkaCh0KSB7XG4gICAgcmV0dXJuICEoXCJvYmplY3RcIiAhPSB0eXBlb2YgdCB8fCBudWxsID09PSB0IHx8IHQgaW5zdGFuY2VvZiBBcnJheSB8fCB0IGluc3RhbmNlb2YgRGF0ZSB8fCB0IGluc3RhbmNlb2YgYXQgfHwgdCBpbnN0YW5jZW9mIFdjIHx8IHQgaW5zdGFuY2VvZiBRYyB8fCB0IGluc3RhbmNlb2Ygd2MgfHwgdCBpbnN0YW5jZW9mIGpjKTtcbn1cblxuZnVuY3Rpb24gX2godCwgZSwgbikge1xuICAgIGlmICghZGgobikgfHwgIWZ1bmN0aW9uKHQpIHtcbiAgICAgICAgcmV0dXJuIFwib2JqZWN0XCIgPT0gdHlwZW9mIHQgJiYgbnVsbCAhPT0gdCAmJiAoT2JqZWN0LmdldFByb3RvdHlwZU9mKHQpID09PSBPYmplY3QucHJvdG90eXBlIHx8IG51bGwgPT09IE9iamVjdC5nZXRQcm90b3R5cGVPZih0KSk7XG4gICAgfShuKSkge1xuICAgICAgICBjb25zdCBzID0gY2Mobik7XG4gICAgICAgIHRocm93IFwiYW4gb2JqZWN0XCIgPT09IHMgPyBlLmFjKHQgKyBcIiBhIGN1c3RvbSBvYmplY3RcIikgOiBlLmFjKHQgKyBcIiBcIiArIHMpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBIZWxwZXIgdGhhdCBjYWxscyBmcm9tRG90U2VwYXJhdGVkU3RyaW5nKCkgYnV0IHdyYXBzIGFueSBlcnJvciB0aHJvd24uXG4gKi8gZnVuY3Rpb24gd2godCwgZSwgbikge1xuICAgIGlmICgoXG4gICAgLy8gSWYgcmVxdWlyZWQsIHJlcGxhY2UgdGhlIEZpZWxkUGF0aCBDb21wYXQgY2xhc3Mgd2l0aCB3aXRoIHRoZSBmaXJlc3RvcmUtZXhwXG4gICAgLy8gRmllbGRQYXRoLlxuICAgIGUgPSBwKGUpKSBpbnN0YW5jZW9mIEtjKSByZXR1cm4gZS5faW50ZXJuYWxQYXRoO1xuICAgIGlmIChcInN0cmluZ1wiID09IHR5cGVvZiBlKSByZXR1cm4gZ2godCwgZSk7XG4gICAgdGhyb3cgeWgoXCJGaWVsZCBwYXRoIGFyZ3VtZW50cyBtdXN0IGJlIG9mIHR5cGUgc3RyaW5nIG9yIFwiLCB0LCBcbiAgICAvKiBoYXNDb252ZXJ0ZXI9ICovICExLCBcbiAgICAvKiBwYXRoPSAqLyB2b2lkIDAsIG4pO1xufVxuXG4vKipcbiAqIE1hdGNoZXMgYW55IGNoYXJhY3RlcnMgaW4gYSBmaWVsZCBwYXRoIHN0cmluZyB0aGF0IGFyZSByZXNlcnZlZC5cbiAqLyBjb25zdCBtaCA9IG5ldyBSZWdFeHAoXCJbflxcXFwqL1xcXFxbXFxcXF1dXCIpO1xuXG4vKipcbiAqIFdyYXBzIGZyb21Eb3RTZXBhcmF0ZWRTdHJpbmcgd2l0aCBhbiBlcnJvciBtZXNzYWdlIGFib3V0IHRoZSBtZXRob2QgdGhhdFxuICogd2FzIHRocm93bi5cbiAqIEBwYXJhbSBtZXRob2ROYW1lIC0gVGhlIHB1YmxpY2x5IHZpc2libGUgbWV0aG9kIG5hbWVcbiAqIEBwYXJhbSBwYXRoIC0gVGhlIGRvdC1zZXBhcmF0ZWQgc3RyaW5nIGZvcm0gb2YgYSBmaWVsZCBwYXRoIHdoaWNoIHdpbGwgYmVcbiAqIHNwbGl0IG9uIGRvdHMuXG4gKiBAcGFyYW0gdGFyZ2V0RG9jIC0gVGhlIGRvY3VtZW50IGFnYWluc3Qgd2hpY2ggdGhlIGZpZWxkIHBhdGggd2lsbCBiZVxuICogZXZhbHVhdGVkLlxuICovIGZ1bmN0aW9uIGdoKHQsIGUsIG4pIHtcbiAgICBpZiAoZS5zZWFyY2gobWgpID49IDApIHRocm93IHloKGBJbnZhbGlkIGZpZWxkIHBhdGggKCR7ZX0pLiBQYXRocyBtdXN0IG5vdCBjb250YWluICd+JywgJyonLCAnLycsICdbJywgb3IgJ10nYCwgdCwgXG4gICAgLyogaGFzQ29udmVydGVyPSAqLyAhMSwgXG4gICAgLyogcGF0aD0gKi8gdm9pZCAwLCBuKTtcbiAgICB0cnkge1xuICAgICAgICByZXR1cm4gbmV3IEtjKC4uLmUuc3BsaXQoXCIuXCIpKS5faW50ZXJuYWxQYXRoO1xuICAgIH0gY2F0Y2ggKHMpIHtcbiAgICAgICAgdGhyb3cgeWgoYEludmFsaWQgZmllbGQgcGF0aCAoJHtlfSkuIFBhdGhzIG11c3Qgbm90IGJlIGVtcHR5LCBiZWdpbiB3aXRoICcuJywgZW5kIHdpdGggJy4nLCBvciBjb250YWluICcuLidgLCB0LCBcbiAgICAgICAgLyogaGFzQ29udmVydGVyPSAqLyAhMSwgXG4gICAgICAgIC8qIHBhdGg9ICovIHZvaWQgMCwgbik7XG4gICAgfVxufVxuXG5mdW5jdGlvbiB5aCh0LCBlLCBuLCBzLCBpKSB7XG4gICAgY29uc3QgciA9IHMgJiYgIXMuaXNFbXB0eSgpLCBvID0gdm9pZCAwICE9PSBpO1xuICAgIGxldCB1ID0gYEZ1bmN0aW9uICR7ZX0oKSBjYWxsZWQgd2l0aCBpbnZhbGlkIGRhdGFgO1xuICAgIG4gJiYgKHUgKz0gXCIgKHZpYSBgdG9GaXJlc3RvcmUoKWApXCIpLCB1ICs9IFwiLiBcIjtcbiAgICBsZXQgYSA9IFwiXCI7XG4gICAgcmV0dXJuIChyIHx8IG8pICYmIChhICs9IFwiIChmb3VuZFwiLCByICYmIChhICs9IGAgaW4gZmllbGQgJHtzfWApLCBvICYmIChhICs9IGAgaW4gZG9jdW1lbnQgJHtpfWApLCBcbiAgICBhICs9IFwiKVwiKSwgbmV3IFEoRy5JTlZBTElEX0FSR1VNRU5ULCB1ICsgdCArIGEpO1xufVxuXG4vKiogQ2hlY2tzIGBoYXlzdGFja2AgaWYgRmllbGRQYXRoIGBuZWVkbGVgIGlzIHByZXNlbnQuIFJ1bnMgaW4gTyhuKS4gKi8gZnVuY3Rpb24gcGgodCwgZSkge1xuICAgIHJldHVybiB0LnNvbWUoKHQgPT4gdC5pc0VxdWFsKGUpKSk7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEEgYERvY3VtZW50U25hcHNob3RgIGNvbnRhaW5zIGRhdGEgcmVhZCBmcm9tIGEgZG9jdW1lbnQgaW4geW91ciBGaXJlc3RvcmVcbiAqIGRhdGFiYXNlLiBUaGUgZGF0YSBjYW4gYmUgZXh0cmFjdGVkIHdpdGggYC5kYXRhKClgIG9yIGAuZ2V0KDxmaWVsZD4pYCB0b1xuICogZ2V0IGEgc3BlY2lmaWMgZmllbGQuXG4gKlxuICogRm9yIGEgYERvY3VtZW50U25hcHNob3RgIHRoYXQgcG9pbnRzIHRvIGEgbm9uLWV4aXN0aW5nIGRvY3VtZW50LCBhbnkgZGF0YVxuICogYWNjZXNzIHdpbGwgcmV0dXJuICd1bmRlZmluZWQnLiBZb3UgY2FuIHVzZSB0aGUgYGV4aXN0cygpYCBtZXRob2QgdG9cbiAqIGV4cGxpY2l0bHkgdmVyaWZ5IGEgZG9jdW1lbnQncyBleGlzdGVuY2UuXG4gKi8gY2xhc3MgSWgge1xuICAgIC8vIE5vdGU6IFRoaXMgY2xhc3MgaXMgc3RyaXBwZWQgZG93biB2ZXJzaW9uIG9mIHRoZSBEb2N1bWVudFNuYXBzaG90IGluXG4gICAgLy8gdGhlIGxlZ2FjeSBTREsuIFRoZSBjaGFuZ2VzIGFyZTpcbiAgICAvLyAtIE5vIHN1cHBvcnQgZm9yIFNuYXBzaG90TWV0YWRhdGEuXG4gICAgLy8gLSBObyBzdXBwb3J0IGZvciBTbmFwc2hvdE9wdGlvbnMuXG4gICAgLyoqIEBoaWRlY29uc3RydWN0b3IgcHJvdGVjdGVkICovXG4gICAgY29uc3RydWN0b3IodCwgZSwgbiwgcywgaSkge1xuICAgICAgICB0aGlzLl9maXJlc3RvcmUgPSB0LCB0aGlzLl91c2VyRGF0YVdyaXRlciA9IGUsIHRoaXMuX2tleSA9IG4sIHRoaXMuX2RvY3VtZW50ID0gcywgXG4gICAgICAgIHRoaXMuX2NvbnZlcnRlciA9IGk7XG4gICAgfVxuICAgIC8qKiBQcm9wZXJ0eSBvZiB0aGUgYERvY3VtZW50U25hcHNob3RgIHRoYXQgcHJvdmlkZXMgdGhlIGRvY3VtZW50J3MgSUQuICovICAgIGdldCBpZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2tleS5wYXRoLmxhc3RTZWdtZW50KCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFRoZSBgRG9jdW1lbnRSZWZlcmVuY2VgIGZvciB0aGUgZG9jdW1lbnQgaW5jbHVkZWQgaW4gdGhlIGBEb2N1bWVudFNuYXBzaG90YC5cbiAgICAgKi8gICAgZ2V0IHJlZigpIHtcbiAgICAgICAgcmV0dXJuIG5ldyB3Yyh0aGlzLl9maXJlc3RvcmUsIHRoaXMuX2NvbnZlcnRlciwgdGhpcy5fa2V5KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogU2lnbmFscyB3aGV0aGVyIG9yIG5vdCB0aGUgZG9jdW1lbnQgYXQgdGhlIHNuYXBzaG90J3MgbG9jYXRpb24gZXhpc3RzLlxuICAgICAqXG4gICAgICogQHJldHVybnMgdHJ1ZSBpZiB0aGUgZG9jdW1lbnQgZXhpc3RzLlxuICAgICAqLyAgICBleGlzdHMoKSB7XG4gICAgICAgIHJldHVybiBudWxsICE9PSB0aGlzLl9kb2N1bWVudDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0cmlldmVzIGFsbCBmaWVsZHMgaW4gdGhlIGRvY3VtZW50IGFzIGFuIGBPYmplY3RgLiBSZXR1cm5zIGB1bmRlZmluZWRgIGlmXG4gICAgICogdGhlIGRvY3VtZW50IGRvZXNuJ3QgZXhpc3QuXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyBBbiBgT2JqZWN0YCBjb250YWluaW5nIGFsbCBmaWVsZHMgaW4gdGhlIGRvY3VtZW50IG9yIGB1bmRlZmluZWRgXG4gICAgICogaWYgdGhlIGRvY3VtZW50IGRvZXNuJ3QgZXhpc3QuXG4gICAgICovICAgIGRhdGEoKSB7XG4gICAgICAgIGlmICh0aGlzLl9kb2N1bWVudCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuX2NvbnZlcnRlcikge1xuICAgICAgICAgICAgICAgIC8vIFdlIG9ubHkgd2FudCB0byB1c2UgdGhlIGNvbnZlcnRlciBhbmQgY3JlYXRlIGEgbmV3IERvY3VtZW50U25hcHNob3RcbiAgICAgICAgICAgICAgICAvLyBpZiBhIGNvbnZlcnRlciBoYXMgYmVlbiBwcm92aWRlZC5cbiAgICAgICAgICAgICAgICBjb25zdCB0ID0gbmV3IFRoKHRoaXMuX2ZpcmVzdG9yZSwgdGhpcy5fdXNlckRhdGFXcml0ZXIsIHRoaXMuX2tleSwgdGhpcy5fZG9jdW1lbnQsIFxuICAgICAgICAgICAgICAgIC8qIGNvbnZlcnRlcj0gKi8gbnVsbCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NvbnZlcnRlci5mcm9tRmlyZXN0b3JlKHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3VzZXJEYXRhV3JpdGVyLmNvbnZlcnRWYWx1ZSh0aGlzLl9kb2N1bWVudC5kYXRhLnZhbHVlKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXRyaWV2ZXMgdGhlIGZpZWxkIHNwZWNpZmllZCBieSBgZmllbGRQYXRoYC4gUmV0dXJucyBgdW5kZWZpbmVkYCBpZiB0aGVcbiAgICAgKiBkb2N1bWVudCBvciBmaWVsZCBkb2Vzbid0IGV4aXN0LlxuICAgICAqXG4gICAgICogQHBhcmFtIGZpZWxkUGF0aCAtIFRoZSBwYXRoIChmb3IgZXhhbXBsZSAnZm9vJyBvciAnZm9vLmJhcicpIHRvIGEgc3BlY2lmaWNcbiAgICAgKiBmaWVsZC5cbiAgICAgKiBAcmV0dXJucyBUaGUgZGF0YSBhdCB0aGUgc3BlY2lmaWVkIGZpZWxkIGxvY2F0aW9uIG9yIHVuZGVmaW5lZCBpZiBubyBzdWNoXG4gICAgICogZmllbGQgZXhpc3RzIGluIHRoZSBkb2N1bWVudC5cbiAgICAgKi9cbiAgICAvLyBXZSBhcmUgdXNpbmcgYGFueWAgaGVyZSB0byBhdm9pZCBhbiBleHBsaWNpdCBjYXN0IGJ5IG91ciB1c2Vycy5cbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICAgIGdldCh0KSB7XG4gICAgICAgIGlmICh0aGlzLl9kb2N1bWVudCkge1xuICAgICAgICAgICAgY29uc3QgZSA9IHRoaXMuX2RvY3VtZW50LmRhdGEuZmllbGQoRWgoXCJEb2N1bWVudFNuYXBzaG90LmdldFwiLCB0KSk7XG4gICAgICAgICAgICBpZiAobnVsbCAhPT0gZSkgcmV0dXJuIHRoaXMuX3VzZXJEYXRhV3JpdGVyLmNvbnZlcnRWYWx1ZShlKTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuLyoqXG4gKiBBIGBRdWVyeURvY3VtZW50U25hcHNob3RgIGNvbnRhaW5zIGRhdGEgcmVhZCBmcm9tIGEgZG9jdW1lbnQgaW4geW91clxuICogRmlyZXN0b3JlIGRhdGFiYXNlIGFzIHBhcnQgb2YgYSBxdWVyeS4gVGhlIGRvY3VtZW50IGlzIGd1YXJhbnRlZWQgdG8gZXhpc3RcbiAqIGFuZCBpdHMgZGF0YSBjYW4gYmUgZXh0cmFjdGVkIHdpdGggYC5kYXRhKClgIG9yIGAuZ2V0KDxmaWVsZD4pYCB0byBnZXQgYVxuICogc3BlY2lmaWMgZmllbGQuXG4gKlxuICogQSBgUXVlcnlEb2N1bWVudFNuYXBzaG90YCBvZmZlcnMgdGhlIHNhbWUgQVBJIHN1cmZhY2UgYXMgYVxuICogYERvY3VtZW50U25hcHNob3RgLiBTaW5jZSBxdWVyeSByZXN1bHRzIGNvbnRhaW4gb25seSBleGlzdGluZyBkb2N1bWVudHMsIHRoZVxuICogYGV4aXN0c2AgcHJvcGVydHkgd2lsbCBhbHdheXMgYmUgdHJ1ZSBhbmQgYGRhdGEoKWAgd2lsbCBuZXZlciByZXR1cm5cbiAqICd1bmRlZmluZWQnLlxuICovIGNsYXNzIFRoIGV4dGVuZHMgSWgge1xuICAgIC8qKlxuICAgICAqIFJldHJpZXZlcyBhbGwgZmllbGRzIGluIHRoZSBkb2N1bWVudCBhcyBhbiBgT2JqZWN0YC5cbiAgICAgKlxuICAgICAqIEBvdmVycmlkZVxuICAgICAqIEByZXR1cm5zIEFuIGBPYmplY3RgIGNvbnRhaW5pbmcgYWxsIGZpZWxkcyBpbiB0aGUgZG9jdW1lbnQuXG4gICAgICovXG4gICAgZGF0YSgpIHtcbiAgICAgICAgcmV0dXJuIHN1cGVyLmRhdGEoKTtcbiAgICB9XG59XG5cbi8qKlxuICogSGVscGVyIHRoYXQgY2FsbHMgYGZyb21Eb3RTZXBhcmF0ZWRTdHJpbmcoKWAgYnV0IHdyYXBzIGFueSBlcnJvciB0aHJvd24uXG4gKi8gZnVuY3Rpb24gRWgodCwgZSkge1xuICAgIHJldHVybiBcInN0cmluZ1wiID09IHR5cGVvZiBlID8gZ2godCwgZSkgOiBlIGluc3RhbmNlb2YgS2MgPyBlLl9pbnRlcm5hbFBhdGggOiBlLl9kZWxlZ2F0ZS5faW50ZXJuYWxQYXRoO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBNZXRhZGF0YSBhYm91dCBhIHNuYXBzaG90LCBkZXNjcmliaW5nIHRoZSBzdGF0ZSBvZiB0aGUgc25hcHNob3QuXG4gKi8gY2xhc3MgQWgge1xuICAgIC8qKiBAaGlkZWNvbnN0cnVjdG9yICovXG4gICAgY29uc3RydWN0b3IodCwgZSkge1xuICAgICAgICB0aGlzLmhhc1BlbmRpbmdXcml0ZXMgPSB0LCB0aGlzLmZyb21DYWNoZSA9IGU7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdHJ1ZSBpZiB0aGlzIGBTbmFwc2hvdE1ldGFkYXRhYCBpcyBlcXVhbCB0byB0aGUgcHJvdmlkZWQgb25lLlxuICAgICAqXG4gICAgICogQHBhcmFtIG90aGVyIC0gVGhlIGBTbmFwc2hvdE1ldGFkYXRhYCB0byBjb21wYXJlIGFnYWluc3QuXG4gICAgICogQHJldHVybnMgdHJ1ZSBpZiB0aGlzIGBTbmFwc2hvdE1ldGFkYXRhYCBpcyBlcXVhbCB0byB0aGUgcHJvdmlkZWQgb25lLlxuICAgICAqLyAgICBpc0VxdWFsKHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaGFzUGVuZGluZ1dyaXRlcyA9PT0gdC5oYXNQZW5kaW5nV3JpdGVzICYmIHRoaXMuZnJvbUNhY2hlID09PSB0LmZyb21DYWNoZTtcbiAgICB9XG59XG5cbi8qKlxuICogQSBgRG9jdW1lbnRTbmFwc2hvdGAgY29udGFpbnMgZGF0YSByZWFkIGZyb20gYSBkb2N1bWVudCBpbiB5b3VyIEZpcmVzdG9yZVxuICogZGF0YWJhc2UuIFRoZSBkYXRhIGNhbiBiZSBleHRyYWN0ZWQgd2l0aCBgLmRhdGEoKWAgb3IgYC5nZXQoPGZpZWxkPilgIHRvXG4gKiBnZXQgYSBzcGVjaWZpYyBmaWVsZC5cbiAqXG4gKiBGb3IgYSBgRG9jdW1lbnRTbmFwc2hvdGAgdGhhdCBwb2ludHMgdG8gYSBub24tZXhpc3RpbmcgZG9jdW1lbnQsIGFueSBkYXRhXG4gKiBhY2Nlc3Mgd2lsbCByZXR1cm4gJ3VuZGVmaW5lZCcuIFlvdSBjYW4gdXNlIHRoZSBgZXhpc3RzKClgIG1ldGhvZCB0b1xuICogZXhwbGljaXRseSB2ZXJpZnkgYSBkb2N1bWVudCdzIGV4aXN0ZW5jZS5cbiAqLyBjbGFzcyBSaCBleHRlbmRzIEloIHtcbiAgICAvKiogQGhpZGVjb25zdHJ1Y3RvciBwcm90ZWN0ZWQgKi9cbiAgICBjb25zdHJ1Y3Rvcih0LCBlLCBuLCBzLCBpLCByKSB7XG4gICAgICAgIHN1cGVyKHQsIGUsIG4sIHMsIHIpLCB0aGlzLl9maXJlc3RvcmUgPSB0LCB0aGlzLl9maXJlc3RvcmVJbXBsID0gdCwgdGhpcy5tZXRhZGF0YSA9IGk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgd2hldGhlciBvciBub3QgdGhlIGRhdGEgZXhpc3RzLiBUcnVlIGlmIHRoZSBkb2N1bWVudCBleGlzdHMuXG4gICAgICovICAgIGV4aXN0cygpIHtcbiAgICAgICAgcmV0dXJuIHN1cGVyLmV4aXN0cygpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXRyaWV2ZXMgYWxsIGZpZWxkcyBpbiB0aGUgZG9jdW1lbnQgYXMgYW4gYE9iamVjdGAuIFJldHVybnMgYHVuZGVmaW5lZGAgaWZcbiAgICAgKiB0aGUgZG9jdW1lbnQgZG9lc24ndCBleGlzdC5cbiAgICAgKlxuICAgICAqIEJ5IGRlZmF1bHQsIGBzZXJ2ZXJUaW1lc3RhbXAoKWAgdmFsdWVzIHRoYXQgaGF2ZSBub3QgeWV0IGJlZW5cbiAgICAgKiBzZXQgdG8gdGhlaXIgZmluYWwgdmFsdWUgd2lsbCBiZSByZXR1cm5lZCBhcyBgbnVsbGAuIFlvdSBjYW4gb3ZlcnJpZGVcbiAgICAgKiB0aGlzIGJ5IHBhc3NpbmcgYW4gb3B0aW9ucyBvYmplY3QuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyAtIEFuIG9wdGlvbnMgb2JqZWN0IHRvIGNvbmZpZ3VyZSBob3cgZGF0YSBpcyByZXRyaWV2ZWQgZnJvbVxuICAgICAqIHRoZSBzbmFwc2hvdCAoZm9yIGV4YW1wbGUgdGhlIGRlc2lyZWQgYmVoYXZpb3IgZm9yIHNlcnZlciB0aW1lc3RhbXBzIHRoYXRcbiAgICAgKiBoYXZlIG5vdCB5ZXQgYmVlbiBzZXQgdG8gdGhlaXIgZmluYWwgdmFsdWUpLlxuICAgICAqIEByZXR1cm5zIEFuIGBPYmplY3RgIGNvbnRhaW5pbmcgYWxsIGZpZWxkcyBpbiB0aGUgZG9jdW1lbnQgb3IgYHVuZGVmaW5lZGAgaWZcbiAgICAgKiB0aGUgZG9jdW1lbnQgZG9lc24ndCBleGlzdC5cbiAgICAgKi8gICAgZGF0YSh0ID0ge30pIHtcbiAgICAgICAgaWYgKHRoaXMuX2RvY3VtZW50KSB7XG4gICAgICAgICAgICBpZiAodGhpcy5fY29udmVydGVyKSB7XG4gICAgICAgICAgICAgICAgLy8gV2Ugb25seSB3YW50IHRvIHVzZSB0aGUgY29udmVydGVyIGFuZCBjcmVhdGUgYSBuZXcgRG9jdW1lbnRTbmFwc2hvdFxuICAgICAgICAgICAgICAgIC8vIGlmIGEgY29udmVydGVyIGhhcyBiZWVuIHByb3ZpZGVkLlxuICAgICAgICAgICAgICAgIGNvbnN0IGUgPSBuZXcgYmgodGhpcy5fZmlyZXN0b3JlLCB0aGlzLl91c2VyRGF0YVdyaXRlciwgdGhpcy5fa2V5LCB0aGlzLl9kb2N1bWVudCwgdGhpcy5tZXRhZGF0YSwgXG4gICAgICAgICAgICAgICAgLyogY29udmVydGVyPSAqLyBudWxsKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fY29udmVydGVyLmZyb21GaXJlc3RvcmUoZSwgdCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fdXNlckRhdGFXcml0ZXIuY29udmVydFZhbHVlKHRoaXMuX2RvY3VtZW50LmRhdGEudmFsdWUsIHQuc2VydmVyVGltZXN0YW1wcyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0cmlldmVzIHRoZSBmaWVsZCBzcGVjaWZpZWQgYnkgYGZpZWxkUGF0aGAuIFJldHVybnMgYHVuZGVmaW5lZGAgaWYgdGhlXG4gICAgICogZG9jdW1lbnQgb3IgZmllbGQgZG9lc24ndCBleGlzdC5cbiAgICAgKlxuICAgICAqIEJ5IGRlZmF1bHQsIGEgYHNlcnZlclRpbWVzdGFtcCgpYCB0aGF0IGhhcyBub3QgeWV0IGJlZW4gc2V0IHRvXG4gICAgICogaXRzIGZpbmFsIHZhbHVlIHdpbGwgYmUgcmV0dXJuZWQgYXMgYG51bGxgLiBZb3UgY2FuIG92ZXJyaWRlIHRoaXMgYnlcbiAgICAgKiBwYXNzaW5nIGFuIG9wdGlvbnMgb2JqZWN0LlxuICAgICAqXG4gICAgICogQHBhcmFtIGZpZWxkUGF0aCAtIFRoZSBwYXRoIChmb3IgZXhhbXBsZSAnZm9vJyBvciAnZm9vLmJhcicpIHRvIGEgc3BlY2lmaWNcbiAgICAgKiBmaWVsZC5cbiAgICAgKiBAcGFyYW0gb3B0aW9ucyAtIEFuIG9wdGlvbnMgb2JqZWN0IHRvIGNvbmZpZ3VyZSBob3cgdGhlIGZpZWxkIGlzIHJldHJpZXZlZFxuICAgICAqIGZyb20gdGhlIHNuYXBzaG90IChmb3IgZXhhbXBsZSB0aGUgZGVzaXJlZCBiZWhhdmlvciBmb3Igc2VydmVyIHRpbWVzdGFtcHNcbiAgICAgKiB0aGF0IGhhdmUgbm90IHlldCBiZWVuIHNldCB0byB0aGVpciBmaW5hbCB2YWx1ZSkuXG4gICAgICogQHJldHVybnMgVGhlIGRhdGEgYXQgdGhlIHNwZWNpZmllZCBmaWVsZCBsb2NhdGlvbiBvciB1bmRlZmluZWQgaWYgbm8gc3VjaFxuICAgICAqIGZpZWxkIGV4aXN0cyBpbiB0aGUgZG9jdW1lbnQuXG4gICAgICovXG4gICAgLy8gV2UgYXJlIHVzaW5nIGBhbnlgIGhlcmUgdG8gYXZvaWQgYW4gZXhwbGljaXQgY2FzdCBieSBvdXIgdXNlcnMuXG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbiAgICBnZXQodCwgZSA9IHt9KSB7XG4gICAgICAgIGlmICh0aGlzLl9kb2N1bWVudCkge1xuICAgICAgICAgICAgY29uc3QgbiA9IHRoaXMuX2RvY3VtZW50LmRhdGEuZmllbGQoRWgoXCJEb2N1bWVudFNuYXBzaG90LmdldFwiLCB0KSk7XG4gICAgICAgICAgICBpZiAobnVsbCAhPT0gbikgcmV0dXJuIHRoaXMuX3VzZXJEYXRhV3JpdGVyLmNvbnZlcnRWYWx1ZShuLCBlLnNlcnZlclRpbWVzdGFtcHMpO1xuICAgICAgICB9XG4gICAgfVxufVxuXG4vKipcbiAqIEEgYFF1ZXJ5RG9jdW1lbnRTbmFwc2hvdGAgY29udGFpbnMgZGF0YSByZWFkIGZyb20gYSBkb2N1bWVudCBpbiB5b3VyXG4gKiBGaXJlc3RvcmUgZGF0YWJhc2UgYXMgcGFydCBvZiBhIHF1ZXJ5LiBUaGUgZG9jdW1lbnQgaXMgZ3VhcmFudGVlZCB0byBleGlzdFxuICogYW5kIGl0cyBkYXRhIGNhbiBiZSBleHRyYWN0ZWQgd2l0aCBgLmRhdGEoKWAgb3IgYC5nZXQoPGZpZWxkPilgIHRvIGdldCBhXG4gKiBzcGVjaWZpYyBmaWVsZC5cbiAqXG4gKiBBIGBRdWVyeURvY3VtZW50U25hcHNob3RgIG9mZmVycyB0aGUgc2FtZSBBUEkgc3VyZmFjZSBhcyBhXG4gKiBgRG9jdW1lbnRTbmFwc2hvdGAuIFNpbmNlIHF1ZXJ5IHJlc3VsdHMgY29udGFpbiBvbmx5IGV4aXN0aW5nIGRvY3VtZW50cywgdGhlXG4gKiBgZXhpc3RzYCBwcm9wZXJ0eSB3aWxsIGFsd2F5cyBiZSB0cnVlIGFuZCBgZGF0YSgpYCB3aWxsIG5ldmVyIHJldHVyblxuICogJ3VuZGVmaW5lZCcuXG4gKi8gY2xhc3MgYmggZXh0ZW5kcyBSaCB7XG4gICAgLyoqXG4gICAgICogUmV0cmlldmVzIGFsbCBmaWVsZHMgaW4gdGhlIGRvY3VtZW50IGFzIGFuIGBPYmplY3RgLlxuICAgICAqXG4gICAgICogQnkgZGVmYXVsdCwgYHNlcnZlclRpbWVzdGFtcCgpYCB2YWx1ZXMgdGhhdCBoYXZlIG5vdCB5ZXQgYmVlblxuICAgICAqIHNldCB0byB0aGVpciBmaW5hbCB2YWx1ZSB3aWxsIGJlIHJldHVybmVkIGFzIGBudWxsYC4gWW91IGNhbiBvdmVycmlkZVxuICAgICAqIHRoaXMgYnkgcGFzc2luZyBhbiBvcHRpb25zIG9iamVjdC5cbiAgICAgKlxuICAgICAqIEBvdmVycmlkZVxuICAgICAqIEBwYXJhbSBvcHRpb25zIC0gQW4gb3B0aW9ucyBvYmplY3QgdG8gY29uZmlndXJlIGhvdyBkYXRhIGlzIHJldHJpZXZlZCBmcm9tXG4gICAgICogdGhlIHNuYXBzaG90IChmb3IgZXhhbXBsZSB0aGUgZGVzaXJlZCBiZWhhdmlvciBmb3Igc2VydmVyIHRpbWVzdGFtcHMgdGhhdFxuICAgICAqIGhhdmUgbm90IHlldCBiZWVuIHNldCB0byB0aGVpciBmaW5hbCB2YWx1ZSkuXG4gICAgICogQHJldHVybnMgQW4gYE9iamVjdGAgY29udGFpbmluZyBhbGwgZmllbGRzIGluIHRoZSBkb2N1bWVudC5cbiAgICAgKi9cbiAgICBkYXRhKHQgPSB7fSkge1xuICAgICAgICByZXR1cm4gc3VwZXIuZGF0YSh0KTtcbiAgICB9XG59XG5cbi8qKlxuICogQSBgUXVlcnlTbmFwc2hvdGAgY29udGFpbnMgemVybyBvciBtb3JlIGBEb2N1bWVudFNuYXBzaG90YCBvYmplY3RzXG4gKiByZXByZXNlbnRpbmcgdGhlIHJlc3VsdHMgb2YgYSBxdWVyeS4gVGhlIGRvY3VtZW50cyBjYW4gYmUgYWNjZXNzZWQgYXMgYW5cbiAqIGFycmF5IHZpYSB0aGUgYGRvY3NgIHByb3BlcnR5IG9yIGVudW1lcmF0ZWQgdXNpbmcgdGhlIGBmb3JFYWNoYCBtZXRob2QuIFRoZVxuICogbnVtYmVyIG9mIGRvY3VtZW50cyBjYW4gYmUgZGV0ZXJtaW5lZCB2aWEgdGhlIGBlbXB0eWAgYW5kIGBzaXplYFxuICogcHJvcGVydGllcy5cbiAqLyBjbGFzcyBQaCB7XG4gICAgLyoqIEBoaWRlY29uc3RydWN0b3IgKi9cbiAgICBjb25zdHJ1Y3Rvcih0LCBlLCBuLCBzKSB7XG4gICAgICAgIHRoaXMuX2ZpcmVzdG9yZSA9IHQsIHRoaXMuX3VzZXJEYXRhV3JpdGVyID0gZSwgdGhpcy5fc25hcHNob3QgPSBzLCB0aGlzLm1ldGFkYXRhID0gbmV3IEFoKHMuaGFzUGVuZGluZ1dyaXRlcywgcy5mcm9tQ2FjaGUpLCBcbiAgICAgICAgdGhpcy5xdWVyeSA9IG47XG4gICAgfVxuICAgIC8qKiBBbiBhcnJheSBvZiBhbGwgdGhlIGRvY3VtZW50cyBpbiB0aGUgYFF1ZXJ5U25hcHNob3RgLiAqLyAgICBnZXQgZG9jcygpIHtcbiAgICAgICAgY29uc3QgdCA9IFtdO1xuICAgICAgICByZXR1cm4gdGhpcy5mb3JFYWNoKChlID0+IHQucHVzaChlKSkpLCB0O1xuICAgIH1cbiAgICAvKiogVGhlIG51bWJlciBvZiBkb2N1bWVudHMgaW4gdGhlIGBRdWVyeVNuYXBzaG90YC4gKi8gICAgZ2V0IHNpemUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9zbmFwc2hvdC5kb2NzLnNpemU7XG4gICAgfVxuICAgIC8qKiBUcnVlIGlmIHRoZXJlIGFyZSBubyBkb2N1bWVudHMgaW4gdGhlIGBRdWVyeVNuYXBzaG90YC4gKi8gICAgZ2V0IGVtcHR5KCkge1xuICAgICAgICByZXR1cm4gMCA9PT0gdGhpcy5zaXplO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBFbnVtZXJhdGVzIGFsbCBvZiB0aGUgZG9jdW1lbnRzIGluIHRoZSBgUXVlcnlTbmFwc2hvdGAuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gY2FsbGJhY2sgLSBBIGNhbGxiYWNrIHRvIGJlIGNhbGxlZCB3aXRoIGEgYFF1ZXJ5RG9jdW1lbnRTbmFwc2hvdGAgZm9yXG4gICAgICogZWFjaCBkb2N1bWVudCBpbiB0aGUgc25hcHNob3QuXG4gICAgICogQHBhcmFtIHRoaXNBcmcgLSBUaGUgYHRoaXNgIGJpbmRpbmcgZm9yIHRoZSBjYWxsYmFjay5cbiAgICAgKi8gICAgZm9yRWFjaCh0LCBlKSB7XG4gICAgICAgIHRoaXMuX3NuYXBzaG90LmRvY3MuZm9yRWFjaCgobiA9PiB7XG4gICAgICAgICAgICB0LmNhbGwoZSwgbmV3IGJoKHRoaXMuX2ZpcmVzdG9yZSwgdGhpcy5fdXNlckRhdGFXcml0ZXIsIG4ua2V5LCBuLCBuZXcgQWgodGhpcy5fc25hcHNob3QubXV0YXRlZEtleXMuaGFzKG4ua2V5KSwgdGhpcy5fc25hcHNob3QuZnJvbUNhY2hlKSwgdGhpcy5xdWVyeS5jb252ZXJ0ZXIpKTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIGFuIGFycmF5IG9mIHRoZSBkb2N1bWVudHMgY2hhbmdlcyBzaW5jZSB0aGUgbGFzdCBzbmFwc2hvdC4gSWYgdGhpc1xuICAgICAqIGlzIHRoZSBmaXJzdCBzbmFwc2hvdCwgYWxsIGRvY3VtZW50cyB3aWxsIGJlIGluIHRoZSBsaXN0IGFzICdhZGRlZCdcbiAgICAgKiBjaGFuZ2VzLlxuICAgICAqXG4gICAgICogQHBhcmFtIG9wdGlvbnMgLSBgU25hcHNob3RMaXN0ZW5PcHRpb25zYCB0aGF0IGNvbnRyb2wgd2hldGhlciBtZXRhZGF0YS1vbmx5XG4gICAgICogY2hhbmdlcyAoaS5lLiBvbmx5IGBEb2N1bWVudFNuYXBzaG90Lm1ldGFkYXRhYCBjaGFuZ2VkKSBzaG91bGQgdHJpZ2dlclxuICAgICAqIHNuYXBzaG90IGV2ZW50cy5cbiAgICAgKi8gICAgZG9jQ2hhbmdlcyh0ID0ge30pIHtcbiAgICAgICAgY29uc3QgZSA9ICEhdC5pbmNsdWRlTWV0YWRhdGFDaGFuZ2VzO1xuICAgICAgICBpZiAoZSAmJiB0aGlzLl9zbmFwc2hvdC5leGNsdWRlc01ldGFkYXRhQ2hhbmdlcykgdGhyb3cgbmV3IFEoRy5JTlZBTElEX0FSR1VNRU5ULCBcIlRvIGluY2x1ZGUgbWV0YWRhdGEgY2hhbmdlcyB3aXRoIHlvdXIgZG9jdW1lbnQgY2hhbmdlcywgeW91IG11c3QgYWxzbyBwYXNzIHsgaW5jbHVkZU1ldGFkYXRhQ2hhbmdlczp0cnVlIH0gdG8gb25TbmFwc2hvdCgpLlwiKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NhY2hlZENoYW5nZXMgJiYgdGhpcy5fY2FjaGVkQ2hhbmdlc0luY2x1ZGVNZXRhZGF0YUNoYW5nZXMgPT09IGUgfHwgKHRoaXMuX2NhY2hlZENoYW5nZXMgPSBcbiAgICAgICAgLyoqIENhbGN1bGF0ZXMgdGhlIGFycmF5IG9mIGBEb2N1bWVudENoYW5nZWBzIGZvciBhIGdpdmVuIGBWaWV3U25hcHNob3RgLiAqL1xuICAgICAgICBmdW5jdGlvbih0LCBlKSB7XG4gICAgICAgICAgICBpZiAodC5fc25hcHNob3Qub2xkRG9jcy5pc0VtcHR5KCkpIHtcbiAgICAgICAgICAgICAgICBsZXQgZSA9IDA7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHQuX3NuYXBzaG90LmRvY0NoYW5nZXMubWFwKChuID0+ICh7XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiYWRkZWRcIixcbiAgICAgICAgICAgICAgICAgICAgZG9jOiBuZXcgYmgodC5fZmlyZXN0b3JlLCB0Ll91c2VyRGF0YVdyaXRlciwgbi5kb2Mua2V5LCBuLmRvYywgbmV3IEFoKHQuX3NuYXBzaG90Lm11dGF0ZWRLZXlzLmhhcyhuLmRvYy5rZXkpLCB0Ll9zbmFwc2hvdC5mcm9tQ2FjaGUpLCB0LnF1ZXJ5LmNvbnZlcnRlciksXG4gICAgICAgICAgICAgICAgICAgIG9sZEluZGV4OiAtMSxcbiAgICAgICAgICAgICAgICAgICAgbmV3SW5kZXg6IGUrK1xuICAgICAgICAgICAgICAgIH0pKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgLy8gQSBgRG9jdW1lbnRTZXRgIHRoYXQgaXMgdXBkYXRlZCBpbmNyZW1lbnRhbGx5IGFzIGNoYW5nZXMgYXJlIGFwcGxpZWQgdG8gdXNlXG4gICAgICAgICAgICAgICAgLy8gdG8gbG9va3VwIHRoZSBpbmRleCBvZiBhIGRvY3VtZW50LlxuICAgICAgICAgICAgICAgIGxldCBuID0gdC5fc25hcHNob3Qub2xkRG9jcztcbiAgICAgICAgICAgICAgICByZXR1cm4gdC5fc25hcHNob3QuZG9jQ2hhbmdlcy5maWx0ZXIoKHQgPT4gZSB8fCAzIC8qIE1ldGFkYXRhICovICE9PSB0LnR5cGUpKS5tYXAoKGUgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBzID0gbmV3IGJoKHQuX2ZpcmVzdG9yZSwgdC5fdXNlckRhdGFXcml0ZXIsIGUuZG9jLmtleSwgZS5kb2MsIG5ldyBBaCh0Ll9zbmFwc2hvdC5tdXRhdGVkS2V5cy5oYXMoZS5kb2Mua2V5KSwgdC5fc25hcHNob3QuZnJvbUNhY2hlKSwgdC5xdWVyeS5jb252ZXJ0ZXIpO1xuICAgICAgICAgICAgICAgICAgICBsZXQgaSA9IC0xLCByID0gLTE7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAwIC8qIEFkZGVkICovICE9PSBlLnR5cGUgJiYgKGkgPSBuLmluZGV4T2YoZS5kb2Mua2V5KSwgbiA9IG4uZGVsZXRlKGUuZG9jLmtleSkpLCBcbiAgICAgICAgICAgICAgICAgICAgMSAvKiBSZW1vdmVkICovICE9PSBlLnR5cGUgJiYgKG4gPSBuLmFkZChlLmRvYyksIHIgPSBuLmluZGV4T2YoZS5kb2Mua2V5KSksIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFZoKGUudHlwZSksXG4gICAgICAgICAgICAgICAgICAgICAgICBkb2M6IHMsXG4gICAgICAgICAgICAgICAgICAgICAgICBvbGRJbmRleDogaSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ld0luZGV4OiByXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KHRoaXMsIGUpLCB0aGlzLl9jYWNoZWRDaGFuZ2VzSW5jbHVkZU1ldGFkYXRhQ2hhbmdlcyA9IGUpLCB0aGlzLl9jYWNoZWRDaGFuZ2VzO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gVmgodCkge1xuICAgIHN3aXRjaCAodCkge1xuICAgICAgY2FzZSAwIC8qIEFkZGVkICovIDpcbiAgICAgICAgcmV0dXJuIFwiYWRkZWRcIjtcblxuICAgICAgY2FzZSAyIC8qIE1vZGlmaWVkICovIDpcbiAgICAgIGNhc2UgMyAvKiBNZXRhZGF0YSAqLyA6XG4gICAgICAgIHJldHVybiBcIm1vZGlmaWVkXCI7XG5cbiAgICAgIGNhc2UgMSAvKiBSZW1vdmVkICovIDpcbiAgICAgICAgcmV0dXJuIFwicmVtb3ZlZFwiO1xuXG4gICAgICBkZWZhdWx0OlxuICAgICAgICByZXR1cm4gTCgpO1xuICAgIH1cbn1cblxuLy8gVE9ETyhmaXJlc3RvcmVleHApOiBBZGQgdGVzdHMgZm9yIHNuYXBzaG90RXF1YWwgd2l0aCBkaWZmZXJlbnQgc25hcHNob3Rcbi8vIG1ldGFkYXRhXG4vKipcbiAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgcHJvdmlkZWQgc25hcHNob3RzIGFyZSBlcXVhbC5cbiAqXG4gKiBAcGFyYW0gbGVmdCAtIEEgc25hcHNob3QgdG8gY29tcGFyZS5cbiAqIEBwYXJhbSByaWdodCAtIEEgc25hcHNob3QgdG8gY29tcGFyZS5cbiAqIEByZXR1cm5zIHRydWUgaWYgdGhlIHNuYXBzaG90cyBhcmUgZXF1YWwuXG4gKi8gZnVuY3Rpb24gdmgodCwgZSkge1xuICAgIHJldHVybiB0IGluc3RhbmNlb2YgUmggJiYgZSBpbnN0YW5jZW9mIFJoID8gdC5fZmlyZXN0b3JlID09PSBlLl9maXJlc3RvcmUgJiYgdC5fa2V5LmlzRXF1YWwoZS5fa2V5KSAmJiAobnVsbCA9PT0gdC5fZG9jdW1lbnQgPyBudWxsID09PSBlLl9kb2N1bWVudCA6IHQuX2RvY3VtZW50LmlzRXF1YWwoZS5fZG9jdW1lbnQpKSAmJiB0Ll9jb252ZXJ0ZXIgPT09IGUuX2NvbnZlcnRlciA6IHQgaW5zdGFuY2VvZiBQaCAmJiBlIGluc3RhbmNlb2YgUGggJiYgKHQuX2ZpcmVzdG9yZSA9PT0gZS5fZmlyZXN0b3JlICYmIEVjKHQucXVlcnksIGUucXVlcnkpICYmIHQubWV0YWRhdGEuaXNFcXVhbChlLm1ldGFkYXRhKSAmJiB0Ll9zbmFwc2hvdC5pc0VxdWFsKGUuX3NuYXBzaG90KSk7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovIGZ1bmN0aW9uIFNoKHQpIHtcbiAgICBpZiAoXCJMXCIgLyogTGFzdCAqLyA9PT0gdC5saW1pdFR5cGUgJiYgMCA9PT0gdC5leHBsaWNpdE9yZGVyQnkubGVuZ3RoKSB0aHJvdyBuZXcgUShHLlVOSU1QTEVNRU5URUQsIFwibGltaXRUb0xhc3QoKSBxdWVyaWVzIHJlcXVpcmUgc3BlY2lmeWluZyBhdCBsZWFzdCBvbmUgb3JkZXJCeSgpIGNsYXVzZVwiKTtcbn1cblxuLyoqXG4gKiBBIGBRdWVyeUNvbnN0cmFpbnRgIGlzIHVzZWQgdG8gbmFycm93IHRoZSBzZXQgb2YgZG9jdW1lbnRzIHJldHVybmVkIGJ5IGFcbiAqIEZpcmVzdG9yZSBxdWVyeS4gYFF1ZXJ5Q29uc3RyYWludGBzIGFyZSBjcmVhdGVkIGJ5IGludm9raW5nIHtAbGluayB3aGVyZX0sXG4gKiB7QGxpbmsgb3JkZXJCeX0sIHtAbGluayAoc3RhcnRBdDoxKX0sIHtAbGluayAoc3RhcnRBZnRlcjoxKX0sIHtAbGlua1xuICogZW5kQmVmb3JlOjF9LCB7QGxpbmsgKGVuZEF0OjEpfSwge0BsaW5rIGxpbWl0fSBvciB7QGxpbmsgbGltaXRUb0xhc3R9IGFuZFxuICogY2FuIHRoZW4gYmUgcGFzc2VkIHRvIHtAbGluayBxdWVyeX0gdG8gY3JlYXRlIGEgbmV3IHF1ZXJ5IGluc3RhbmNlIHRoYXRcbiAqIGFsc28gY29udGFpbnMgdGhpcyBgUXVlcnlDb25zdHJhaW50YC5cbiAqLyBjbGFzcyBEaCB7fVxuXG4vKipcbiAqIENyZWF0ZXMgYSBuZXcgaW1tdXRhYmxlIGluc3RhbmNlIG9mIHtAbGluayBRdWVyeX0gdGhhdCBpcyBleHRlbmRlZCB0byBhbHNvIGluY2x1ZGVcbiAqIGFkZGl0aW9uYWwgcXVlcnkgY29uc3RyYWludHMuXG4gKlxuICogQHBhcmFtIHF1ZXJ5IC0gVGhlIHtAbGluayBRdWVyeX0gaW5zdGFuY2UgdG8gdXNlIGFzIGEgYmFzZSBmb3IgdGhlIG5ldyBjb25zdHJhaW50cy5cbiAqIEBwYXJhbSBxdWVyeUNvbnN0cmFpbnRzIC0gVGhlIGxpc3Qgb2Yge0BsaW5rIFF1ZXJ5Q29uc3RyYWludH1zIHRvIGFwcGx5LlxuICogQHRocm93cyBpZiBhbnkgb2YgdGhlIHByb3ZpZGVkIHF1ZXJ5IGNvbnN0cmFpbnRzIGNhbm5vdCBiZSBjb21iaW5lZCB3aXRoIHRoZVxuICogZXhpc3Rpbmcgb3IgbmV3IGNvbnN0cmFpbnRzLlxuICovIGZ1bmN0aW9uIENoKHQsIC4uLmUpIHtcbiAgICBmb3IgKGNvbnN0IG4gb2YgZSkgdCA9IG4uX2FwcGx5KHQpO1xuICAgIHJldHVybiB0O1xufVxuXG5jbGFzcyB4aCBleHRlbmRzIERoIHtcbiAgICBjb25zdHJ1Y3Rvcih0LCBlLCBuKSB7XG4gICAgICAgIHN1cGVyKCksIHRoaXMuX2MgPSB0LCB0aGlzLndjID0gZSwgdGhpcy5tYyA9IG4sIHRoaXMudHlwZSA9IFwid2hlcmVcIjtcbiAgICB9XG4gICAgX2FwcGx5KHQpIHtcbiAgICAgICAgY29uc3QgZSA9IHRoKHQuZmlyZXN0b3JlKSwgbiA9IGZ1bmN0aW9uKHQsIGUsIG4sIHMsIGksIHIsIG8pIHtcbiAgICAgICAgICAgIGxldCB1O1xuICAgICAgICAgICAgaWYgKGkuaXNLZXlGaWVsZCgpKSB7XG4gICAgICAgICAgICAgICAgaWYgKFwiYXJyYXktY29udGFpbnNcIiAvKiBBUlJBWV9DT05UQUlOUyAqLyA9PT0gciB8fCBcImFycmF5LWNvbnRhaW5zLWFueVwiIC8qIEFSUkFZX0NPTlRBSU5TX0FOWSAqLyA9PT0gcikgdGhyb3cgbmV3IFEoRy5JTlZBTElEX0FSR1VNRU5ULCBgSW52YWxpZCBRdWVyeS4gWW91IGNhbid0IHBlcmZvcm0gJyR7cn0nIHF1ZXJpZXMgb24gZG9jdW1lbnRJZCgpLmApO1xuICAgICAgICAgICAgICAgIGlmIChcImluXCIgLyogSU4gKi8gPT09IHIgfHwgXCJub3QtaW5cIiAvKiBOT1RfSU4gKi8gPT09IHIpIHtcbiAgICAgICAgICAgICAgICAgICAgV2gobywgcik7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGUgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBuIG9mIG8pIGUucHVzaChqaChzLCB0LCBuKSk7XG4gICAgICAgICAgICAgICAgICAgIHUgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhcnJheVZhbHVlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWVzOiBlXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfSBlbHNlIHUgPSBqaChzLCB0LCBvKTtcbiAgICAgICAgICAgIH0gZWxzZSBcImluXCIgLyogSU4gKi8gIT09IHIgJiYgXCJub3QtaW5cIiAvKiBOT1RfSU4gKi8gIT09IHIgJiYgXCJhcnJheS1jb250YWlucy1hbnlcIiAvKiBBUlJBWV9DT05UQUlOU19BTlkgKi8gIT09IHIgfHwgV2gobywgciksIFxuICAgICAgICAgICAgdSA9IGhoKG4sIGUsIG8sIFxuICAgICAgICAgICAgLyogYWxsb3dBcnJheXM9ICovIFwiaW5cIiAvKiBJTiAqLyA9PT0gciB8fCBcIm5vdC1pblwiIC8qIE5PVF9JTiAqLyA9PT0gcik7XG4gICAgICAgICAgICBjb25zdCBhID0gVmUuY3JlYXRlKGksIHIsIHUpO1xuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHQsIGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoZS5TKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbiA9IGplKHQpO1xuICAgICAgICAgICAgICAgICAgICBpZiAobnVsbCAhPT0gbiAmJiAhbi5pc0VxdWFsKGUuZmllbGQpKSB0aHJvdyBuZXcgUShHLklOVkFMSURfQVJHVU1FTlQsIGBJbnZhbGlkIHF1ZXJ5LiBBbGwgd2hlcmUgZmlsdGVycyB3aXRoIGFuIGluZXF1YWxpdHkgKDwsIDw9LCAhPSwgbm90LWluLCA+LCBvciA+PSkgbXVzdCBiZSBvbiB0aGUgc2FtZSBmaWVsZC4gQnV0IHlvdSBoYXZlIGluZXF1YWxpdHkgZmlsdGVycyBvbiAnJHtuLnRvU3RyaW5nKCl9JyBhbmQgJyR7ZS5maWVsZC50b1N0cmluZygpfSdgKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcyA9IFFlKHQpO1xuICAgICAgICAgICAgICAgICAgICBudWxsICE9PSBzICYmIHpoKHQsIGUuZmllbGQsIHMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb25zdCBuID0gZnVuY3Rpb24odCwgZSkge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IG4gb2YgdC5maWx0ZXJzKSBpZiAoZS5pbmRleE9mKG4ub3ApID49IDApIHJldHVybiBuLm9wO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgICAgICB9KHQsIFxuICAgICAgICAgICAgICAgIC8qKlxuICogR2l2ZW4gYW4gb3BlcmF0b3IsIHJldHVybnMgdGhlIHNldCBvZiBvcGVyYXRvcnMgdGhhdCBjYW5ub3QgYmUgdXNlZCB3aXRoIGl0LlxuICpcbiAqIE9wZXJhdG9ycyBpbiBhIHF1ZXJ5IG11c3QgYWRoZXJlIHRvIHRoZSBmb2xsb3dpbmcgc2V0IG9mIHJ1bGVzOlxuICogMS4gT25seSBvbmUgYXJyYXkgb3BlcmF0b3IgaXMgYWxsb3dlZC5cbiAqIDIuIE9ubHkgb25lIGRpc2p1bmN0aXZlIG9wZXJhdG9yIGlzIGFsbG93ZWQuXG4gKiAzLiBgTk9UX0VRVUFMYCBjYW5ub3QgYmUgdXNlZCB3aXRoIGFub3RoZXIgYE5PVF9FUVVBTGAgb3BlcmF0b3IuXG4gKiA0LiBgTk9UX0lOYCBjYW5ub3QgYmUgdXNlZCB3aXRoIGFycmF5LCBkaXNqdW5jdGl2ZSwgb3IgYE5PVF9FUVVBTGAgb3BlcmF0b3JzLlxuICpcbiAqIEFycmF5IG9wZXJhdG9yczogYEFSUkFZX0NPTlRBSU5TYCwgYEFSUkFZX0NPTlRBSU5TX0FOWWBcbiAqIERpc2p1bmN0aXZlIG9wZXJhdG9yczogYElOYCwgYEFSUkFZX0NPTlRBSU5TX0FOWWAsIGBOT1RfSU5gXG4gKi9cbiAgICAgICAgICAgICAgICBmdW5jdGlvbih0KSB7XG4gICAgICAgICAgICAgICAgICAgIHN3aXRjaCAodCkge1xuICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCIhPVwiIC8qIE5PVF9FUVVBTCAqLyA6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWyBcIiE9XCIgLyogTk9UX0VRVUFMICovICwgXCJub3QtaW5cIiAvKiBOT1RfSU4gKi8gXTtcblxuICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJhcnJheS1jb250YWluc1wiIC8qIEFSUkFZX0NPTlRBSU5TICovIDpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbIFwiYXJyYXktY29udGFpbnNcIiAvKiBBUlJBWV9DT05UQUlOUyAqLyAsIFwiYXJyYXktY29udGFpbnMtYW55XCIgLyogQVJSQVlfQ09OVEFJTlNfQU5ZICovICwgXCJub3QtaW5cIiAvKiBOT1RfSU4gKi8gXTtcblxuICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJpblwiIC8qIElOICovIDpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbIFwiYXJyYXktY29udGFpbnMtYW55XCIgLyogQVJSQVlfQ09OVEFJTlNfQU5ZICovICwgXCJpblwiIC8qIElOICovICwgXCJub3QtaW5cIiAvKiBOT1RfSU4gKi8gXTtcblxuICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJhcnJheS1jb250YWlucy1hbnlcIiAvKiBBUlJBWV9DT05UQUlOU19BTlkgKi8gOlxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsgXCJhcnJheS1jb250YWluc1wiIC8qIEFSUkFZX0NPTlRBSU5TICovICwgXCJhcnJheS1jb250YWlucy1hbnlcIiAvKiBBUlJBWV9DT05UQUlOU19BTlkgKi8gLCBcImluXCIgLyogSU4gKi8gLCBcIm5vdC1pblwiIC8qIE5PVF9JTiAqLyBdO1xuXG4gICAgICAgICAgICAgICAgICAgICAgY2FzZSBcIm5vdC1pblwiIC8qIE5PVF9JTiAqLyA6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWyBcImFycmF5LWNvbnRhaW5zXCIgLyogQVJSQVlfQ09OVEFJTlMgKi8gLCBcImFycmF5LWNvbnRhaW5zLWFueVwiIC8qIEFSUkFZX0NPTlRBSU5TX0FOWSAqLyAsIFwiaW5cIiAvKiBJTiAqLyAsIFwibm90LWluXCIgLyogTk9UX0lOICovICwgXCIhPVwiIC8qIE5PVF9FUVVBTCAqLyBdO1xuXG4gICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0oZS5vcCkpO1xuICAgICAgICAgICAgICAgIGlmIChudWxsICE9PSBuKSBcbiAgICAgICAgICAgICAgICAvLyBTcGVjaWFsIGNhc2Ugd2hlbiBpdCdzIGEgZHVwbGljYXRlIG9wIHRvIGdpdmUgYSBzbGlnaHRseSBjbGVhcmVyIGVycm9yIG1lc3NhZ2UuXG4gICAgICAgICAgICAgICAgdGhyb3cgbiA9PT0gZS5vcCA/IG5ldyBRKEcuSU5WQUxJRF9BUkdVTUVOVCwgYEludmFsaWQgcXVlcnkuIFlvdSBjYW5ub3QgdXNlIG1vcmUgdGhhbiBvbmUgJyR7ZS5vcC50b1N0cmluZygpfScgZmlsdGVyLmApIDogbmV3IFEoRy5JTlZBTElEX0FSR1VNRU5ULCBgSW52YWxpZCBxdWVyeS4gWW91IGNhbm5vdCB1c2UgJyR7ZS5vcC50b1N0cmluZygpfScgZmlsdGVycyB3aXRoICcke24udG9TdHJpbmcoKX0nIGZpbHRlcnMuYCk7XG4gICAgICAgICAgICB9KHQsIGEpLCBhO1xuICAgICAgICB9KHQuX3F1ZXJ5LCBcIndoZXJlXCIsIGUsIHQuZmlyZXN0b3JlLl9kYXRhYmFzZUlkLCB0aGlzLl9jLCB0aGlzLndjLCB0aGlzLm1jKTtcbiAgICAgICAgcmV0dXJuIG5ldyBtYyh0LmZpcmVzdG9yZSwgdC5jb252ZXJ0ZXIsIGZ1bmN0aW9uKHQsIGUpIHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSB0LmZpbHRlcnMuY29uY2F0KFsgZSBdKTtcbiAgICAgICAgICAgIHJldHVybiBuZXcgVWUodC5wYXRoLCB0LmNvbGxlY3Rpb25Hcm91cCwgdC5leHBsaWNpdE9yZGVyQnkuc2xpY2UoKSwgbiwgdC5saW1pdCwgdC5saW1pdFR5cGUsIHQuc3RhcnRBdCwgdC5lbmRBdCk7XG4gICAgICAgIH0odC5fcXVlcnksIG4pKTtcbiAgICB9XG59XG5cbi8qKlxuICogQ3JlYXRlcyBhIHtAbGluayBRdWVyeUNvbnN0cmFpbnR9IHRoYXQgZW5mb3JjZXMgdGhhdCBkb2N1bWVudHMgbXVzdCBjb250YWluIHRoZVxuICogc3BlY2lmaWVkIGZpZWxkIGFuZCB0aGF0IHRoZSB2YWx1ZSBzaG91bGQgc2F0aXNmeSB0aGUgcmVsYXRpb24gY29uc3RyYWludFxuICogcHJvdmlkZWQuXG4gKlxuICogQHBhcmFtIGZpZWxkUGF0aCAtIFRoZSBwYXRoIHRvIGNvbXBhcmVcbiAqIEBwYXJhbSBvcFN0ciAtIFRoZSBvcGVyYXRpb24gc3RyaW5nIChlLmcgXCImbHQ7XCIsIFwiJmx0Oz1cIiwgXCI9PVwiLCBcIiZsdDtcIixcbiAqICAgXCImbHQ7PVwiLCBcIiE9XCIpLlxuICogQHBhcmFtIHZhbHVlIC0gVGhlIHZhbHVlIGZvciBjb21wYXJpc29uXG4gKiBAcmV0dXJucyBUaGUgY3JlYXRlZCB7QGxpbmsgUXVlcnl9LlxuICovIGZ1bmN0aW9uIE5oKHQsIGUsIG4pIHtcbiAgICBjb25zdCBzID0gZSwgaSA9IEVoKFwid2hlcmVcIiwgdCk7XG4gICAgcmV0dXJuIG5ldyB4aChpLCBzLCBuKTtcbn1cblxuY2xhc3Mga2ggZXh0ZW5kcyBEaCB7XG4gICAgY29uc3RydWN0b3IodCwgZSkge1xuICAgICAgICBzdXBlcigpLCB0aGlzLl9jID0gdCwgdGhpcy5nYyA9IGUsIHRoaXMudHlwZSA9IFwib3JkZXJCeVwiO1xuICAgIH1cbiAgICBfYXBwbHkodCkge1xuICAgICAgICBjb25zdCBlID0gZnVuY3Rpb24odCwgZSwgbikge1xuICAgICAgICAgICAgaWYgKG51bGwgIT09IHQuc3RhcnRBdCkgdGhyb3cgbmV3IFEoRy5JTlZBTElEX0FSR1VNRU5ULCBcIkludmFsaWQgcXVlcnkuIFlvdSBtdXN0IG5vdCBjYWxsIHN0YXJ0QXQoKSBvciBzdGFydEFmdGVyKCkgYmVmb3JlIGNhbGxpbmcgb3JkZXJCeSgpLlwiKTtcbiAgICAgICAgICAgIGlmIChudWxsICE9PSB0LmVuZEF0KSB0aHJvdyBuZXcgUShHLklOVkFMSURfQVJHVU1FTlQsIFwiSW52YWxpZCBxdWVyeS4gWW91IG11c3Qgbm90IGNhbGwgZW5kQXQoKSBvciBlbmRCZWZvcmUoKSBiZWZvcmUgY2FsbGluZyBvcmRlckJ5KCkuXCIpO1xuICAgICAgICAgICAgY29uc3QgcyA9IG5ldyBGZShlLCBuKTtcbiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbih0LCBlKSB7XG4gICAgICAgICAgICAgICAgaWYgKG51bGwgPT09IFFlKHQpKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFRoaXMgaXMgdGhlIGZpcnN0IG9yZGVyIGJ5LiBJdCBtdXN0IG1hdGNoIGFueSBpbmVxdWFsaXR5LlxuICAgICAgICAgICAgICAgICAgICBjb25zdCBuID0gamUodCk7XG4gICAgICAgICAgICAgICAgICAgIG51bGwgIT09IG4gJiYgemgodCwgbiwgZS5maWVsZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSh0LCBzKSwgcztcbiAgICAgICAgfVxuICAgICAgICAvKipcbiAqIENyZWF0ZSBhIGBCb3VuZGAgZnJvbSBhIHF1ZXJ5IGFuZCBhIGRvY3VtZW50LlxuICpcbiAqIE5vdGUgdGhhdCB0aGUgYEJvdW5kYCB3aWxsIGFsd2F5cyBpbmNsdWRlIHRoZSBrZXkgb2YgdGhlIGRvY3VtZW50XG4gKiBhbmQgc28gb25seSB0aGUgcHJvdmlkZWQgZG9jdW1lbnQgd2lsbCBjb21wYXJlIGVxdWFsIHRvIHRoZSByZXR1cm5lZFxuICogcG9zaXRpb24uXG4gKlxuICogV2lsbCB0aHJvdyBpZiB0aGUgZG9jdW1lbnQgZG9lcyBub3QgY29udGFpbiBhbGwgZmllbGRzIG9mIHRoZSBvcmRlciBieVxuICogb2YgdGhlIHF1ZXJ5IG9yIGlmIGFueSBvZiB0aGUgZmllbGRzIGluIHRoZSBvcmRlciBieSBhcmUgYW4gdW5jb21taXR0ZWRcbiAqIHNlcnZlciB0aW1lc3RhbXAuXG4gKi8gKHQuX3F1ZXJ5LCB0aGlzLl9jLCB0aGlzLmdjKTtcbiAgICAgICAgcmV0dXJuIG5ldyBtYyh0LmZpcmVzdG9yZSwgdC5jb252ZXJ0ZXIsIGZ1bmN0aW9uKHQsIGUpIHtcbiAgICAgICAgICAgIC8vIFRPRE8oZGltb25kKTogdmFsaWRhdGUgdGhhdCBvcmRlckJ5IGRvZXMgbm90IGxpc3QgdGhlIHNhbWUga2V5IHR3aWNlLlxuICAgICAgICAgICAgY29uc3QgbiA9IHQuZXhwbGljaXRPcmRlckJ5LmNvbmNhdChbIGUgXSk7XG4gICAgICAgICAgICByZXR1cm4gbmV3IFVlKHQucGF0aCwgdC5jb2xsZWN0aW9uR3JvdXAsIG4sIHQuZmlsdGVycy5zbGljZSgpLCB0LmxpbWl0LCB0LmxpbWl0VHlwZSwgdC5zdGFydEF0LCB0LmVuZEF0KTtcbiAgICAgICAgfSh0Ll9xdWVyeSwgZSkpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBDcmVhdGVzIGEge0BsaW5rIFF1ZXJ5Q29uc3RyYWludH0gdGhhdCBzb3J0cyB0aGUgcXVlcnkgcmVzdWx0IGJ5IHRoZVxuICogc3BlY2lmaWVkIGZpZWxkLCBvcHRpb25hbGx5IGluIGRlc2NlbmRpbmcgb3JkZXIgaW5zdGVhZCBvZiBhc2NlbmRpbmcuXG4gKlxuICogQHBhcmFtIGZpZWxkUGF0aCAtIFRoZSBmaWVsZCB0byBzb3J0IGJ5LlxuICogQHBhcmFtIGRpcmVjdGlvblN0ciAtIE9wdGlvbmFsIGRpcmVjdGlvbiB0byBzb3J0IGJ5ICgnYXNjJyBvciAnZGVzYycpLiBJZlxuICogbm90IHNwZWNpZmllZCwgb3JkZXIgd2lsbCBiZSBhc2NlbmRpbmcuXG4gKiBAcmV0dXJucyBUaGUgY3JlYXRlZCB7QGxpbmsgUXVlcnl9LlxuICovIGZ1bmN0aW9uIE1oKHQsIGUgPSBcImFzY1wiKSB7XG4gICAgY29uc3QgbiA9IGUsIHMgPSBFaChcIm9yZGVyQnlcIiwgdCk7XG4gICAgcmV0dXJuIG5ldyBraChzLCBuKTtcbn1cblxuY2xhc3MgT2ggZXh0ZW5kcyBEaCB7XG4gICAgY29uc3RydWN0b3IodCwgZSwgbikge1xuICAgICAgICBzdXBlcigpLCB0aGlzLnR5cGUgPSB0LCB0aGlzLnljID0gZSwgdGhpcy5JYyA9IG47XG4gICAgfVxuICAgIF9hcHBseSh0KSB7XG4gICAgICAgIHJldHVybiBuZXcgbWModC5maXJlc3RvcmUsIHQuY29udmVydGVyLCBKZSh0Ll9xdWVyeSwgdGhpcy55YywgdGhpcy5JYykpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBDcmVhdGVzIGEge0BsaW5rIFF1ZXJ5Q29uc3RyYWludH0gdGhhdCBvbmx5IHJldHVybnMgdGhlIGZpcnN0IG1hdGNoaW5nIGRvY3VtZW50cy5cbiAqXG4gKiBAcGFyYW0gbGltaXQgLSBUaGUgbWF4aW11bSBudW1iZXIgb2YgaXRlbXMgdG8gcmV0dXJuLlxuICogQHJldHVybnMgVGhlIGNyZWF0ZWQge0BsaW5rIFF1ZXJ5fS5cbiAqLyBmdW5jdGlvbiBGaCh0KSB7XG4gICAgcmV0dXJuIGxjKFwibGltaXRcIiwgdCksIG5ldyBPaChcImxpbWl0XCIsIHQsIFwiRlwiIC8qIEZpcnN0ICovKTtcbn1cblxuLyoqXG4gKiBDcmVhdGVzIGEge0BsaW5rIFF1ZXJ5Q29uc3RyYWludH0gdGhhdCBvbmx5IHJldHVybnMgdGhlIGxhc3QgbWF0Y2hpbmcgZG9jdW1lbnRzLlxuICpcbiAqIFlvdSBtdXN0IHNwZWNpZnkgYXQgbGVhc3Qgb25lIGBvcmRlckJ5YCBjbGF1c2UgZm9yIGBsaW1pdFRvTGFzdGAgcXVlcmllcyxcbiAqIG90aGVyd2lzZSBhbiBleGNlcHRpb24gd2lsbCBiZSB0aHJvd24gZHVyaW5nIGV4ZWN1dGlvbi5cbiAqXG4gKiBAcGFyYW0gbGltaXQgLSBUaGUgbWF4aW11bSBudW1iZXIgb2YgaXRlbXMgdG8gcmV0dXJuLlxuICogQHJldHVybnMgVGhlIGNyZWF0ZWQge0BsaW5rIFF1ZXJ5fS5cbiAqLyBmdW5jdGlvbiAkaCh0KSB7XG4gICAgcmV0dXJuIGxjKFwibGltaXRUb0xhc3RcIiwgdCksIG5ldyBPaChcImxpbWl0VG9MYXN0XCIsIHQsIFwiTFwiIC8qIExhc3QgKi8pO1xufVxuXG5jbGFzcyBCaCBleHRlbmRzIERoIHtcbiAgICBjb25zdHJ1Y3Rvcih0LCBlLCBuKSB7XG4gICAgICAgIHN1cGVyKCksIHRoaXMudHlwZSA9IHQsIHRoaXMuVGMgPSBlLCB0aGlzLkVjID0gbjtcbiAgICB9XG4gICAgX2FwcGx5KHQpIHtcbiAgICAgICAgY29uc3QgZSA9IFFoKHQsIHRoaXMudHlwZSwgdGhpcy5UYywgdGhpcy5FYyk7XG4gICAgICAgIHJldHVybiBuZXcgbWModC5maXJlc3RvcmUsIHQuY29udmVydGVyLCBmdW5jdGlvbih0LCBlKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IFVlKHQucGF0aCwgdC5jb2xsZWN0aW9uR3JvdXAsIHQuZXhwbGljaXRPcmRlckJ5LnNsaWNlKCksIHQuZmlsdGVycy5zbGljZSgpLCB0LmxpbWl0LCB0LmxpbWl0VHlwZSwgZSwgdC5lbmRBdCk7XG4gICAgICAgIH0odC5fcXVlcnksIGUpKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIExoKC4uLnQpIHtcbiAgICByZXR1cm4gbmV3IEJoKFwic3RhcnRBdFwiLCB0LCBcbiAgICAvKmluY2x1c2l2ZT0qLyAhMCk7XG59XG5cbmZ1bmN0aW9uIFVoKC4uLnQpIHtcbiAgICByZXR1cm4gbmV3IEJoKFwic3RhcnRBZnRlclwiLCB0LCBcbiAgICAvKmluY2x1c2l2ZT0qLyAhMSk7XG59XG5cbmNsYXNzIHFoIGV4dGVuZHMgRGgge1xuICAgIGNvbnN0cnVjdG9yKHQsIGUsIG4pIHtcbiAgICAgICAgc3VwZXIoKSwgdGhpcy50eXBlID0gdCwgdGhpcy5UYyA9IGUsIHRoaXMuRWMgPSBuO1xuICAgIH1cbiAgICBfYXBwbHkodCkge1xuICAgICAgICBjb25zdCBlID0gUWgodCwgdGhpcy50eXBlLCB0aGlzLlRjLCB0aGlzLkVjKTtcbiAgICAgICAgcmV0dXJuIG5ldyBtYyh0LmZpcmVzdG9yZSwgdC5jb252ZXJ0ZXIsIGZ1bmN0aW9uKHQsIGUpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgVWUodC5wYXRoLCB0LmNvbGxlY3Rpb25Hcm91cCwgdC5leHBsaWNpdE9yZGVyQnkuc2xpY2UoKSwgdC5maWx0ZXJzLnNsaWNlKCksIHQubGltaXQsIHQubGltaXRUeXBlLCB0LnN0YXJ0QXQsIGUpO1xuICAgICAgICB9KHQuX3F1ZXJ5LCBlKSk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBLaCguLi50KSB7XG4gICAgcmV0dXJuIG5ldyBxaChcImVuZEJlZm9yZVwiLCB0LCBcbiAgICAvKmluY2x1c2l2ZT0qLyAhMSk7XG59XG5cbmZ1bmN0aW9uIEdoKC4uLnQpIHtcbiAgICByZXR1cm4gbmV3IHFoKFwiZW5kQXRcIiwgdCwgLyppbmNsdXNpdmU9Ki8gITApO1xufVxuXG4vKiogSGVscGVyIGZ1bmN0aW9uIHRvIGNyZWF0ZSBhIGJvdW5kIGZyb20gYSBkb2N1bWVudCBvciBmaWVsZHMgKi8gZnVuY3Rpb24gUWgodCwgZSwgbiwgcykge1xuICAgIGlmIChuWzBdID0gcChuWzBdKSwgblswXSBpbnN0YW5jZW9mIEloKSByZXR1cm4gZnVuY3Rpb24odCwgZSwgbiwgcywgaSkge1xuICAgICAgICBpZiAoIXMpIHRocm93IG5ldyBRKEcuTk9UX0ZPVU5ELCBgQ2FuJ3QgdXNlIGEgRG9jdW1lbnRTbmFwc2hvdCB0aGF0IGRvZXNuJ3QgZXhpc3QgZm9yICR7bn0oKS5gKTtcbiAgICAgICAgY29uc3QgciA9IFtdO1xuICAgICAgICAvLyBCZWNhdXNlIHBlb3BsZSBleHBlY3QgdG8gY29udGludWUvZW5kIGEgcXVlcnkgYXQgdGhlIGV4YWN0IGRvY3VtZW50XG4gICAgICAgIC8vIHByb3ZpZGVkLCB3ZSBuZWVkIHRvIHVzZSB0aGUgaW1wbGljaXQgc29ydCBvcmRlciByYXRoZXIgdGhhbiB0aGUgZXhwbGljaXRcbiAgICAgICAgLy8gc29ydCBvcmRlciwgYmVjYXVzZSBpdCdzIGd1YXJhbnRlZWQgdG8gY29udGFpbiB0aGUgZG9jdW1lbnQga2V5LiBUaGF0IHdheVxuICAgICAgICAvLyB0aGUgcG9zaXRpb24gYmVjb21lcyB1bmFtYmlndW91cyBhbmQgdGhlIHF1ZXJ5IGNvbnRpbnVlcy9lbmRzIGV4YWN0bHkgYXRcbiAgICAgICAgLy8gdGhlIHByb3ZpZGVkIGRvY3VtZW50LiBXaXRob3V0IHRoZSBrZXkgKGJ5IHVzaW5nIHRoZSBleHBsaWNpdCBzb3J0XG4gICAgICAgIC8vIG9yZGVycyksIG11bHRpcGxlIGRvY3VtZW50cyBjb3VsZCBtYXRjaCB0aGUgcG9zaXRpb24sIHlpZWxkaW5nIGR1cGxpY2F0ZVxuICAgICAgICAvLyByZXN1bHRzLlxuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgbiBvZiB6ZSh0KSkgaWYgKG4uZmllbGQuaXNLZXlGaWVsZCgpKSByLnB1c2gocXQoZSwgcy5rZXkpKTsgZWxzZSB7XG4gICAgICAgICAgICBjb25zdCB0ID0gcy5kYXRhLmZpZWxkKG4uZmllbGQpO1xuICAgICAgICAgICAgaWYgKFJ0KHQpKSB0aHJvdyBuZXcgUShHLklOVkFMSURfQVJHVU1FTlQsICdJbnZhbGlkIHF1ZXJ5LiBZb3UgYXJlIHRyeWluZyB0byBzdGFydCBvciBlbmQgYSBxdWVyeSB1c2luZyBhIGRvY3VtZW50IGZvciB3aGljaCB0aGUgZmllbGQgXCInICsgbi5maWVsZCArICdcIiBpcyBhbiB1bmNvbW1pdHRlZCBzZXJ2ZXIgdGltZXN0YW1wLiAoU2luY2UgdGhlIHZhbHVlIG9mIHRoaXMgZmllbGQgaXMgdW5rbm93biwgeW91IGNhbm5vdCBzdGFydC9lbmQgYSBxdWVyeSB3aXRoIGl0LiknKTtcbiAgICAgICAgICAgIGlmIChudWxsID09PSB0KSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdCA9IG4uZmllbGQuY2Fub25pY2FsU3RyaW5nKCk7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IFEoRy5JTlZBTElEX0FSR1VNRU5ULCBgSW52YWxpZCBxdWVyeS4gWW91IGFyZSB0cnlpbmcgdG8gc3RhcnQgb3IgZW5kIGEgcXVlcnkgdXNpbmcgYSBkb2N1bWVudCBmb3Igd2hpY2ggdGhlIGZpZWxkICcke3R9JyAodXNlZCBhcyB0aGUgb3JkZXJCeSkgZG9lcyBub3QgZXhpc3QuYCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByLnB1c2godCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5ldyBPZShyLCBpKTtcbiAgICB9XG4gICAgLyoqXG4gKiBDb252ZXJ0cyBhIGxpc3Qgb2YgZmllbGQgdmFsdWVzIHRvIGEgYEJvdW5kYCBmb3IgdGhlIGdpdmVuIHF1ZXJ5LlxuICovICh0Ll9xdWVyeSwgdC5maXJlc3RvcmUuX2RhdGFiYXNlSWQsIGUsIG5bMF0uX2RvY3VtZW50LCBzKTtcbiAgICB7XG4gICAgICAgIGNvbnN0IGkgPSB0aCh0LmZpcmVzdG9yZSk7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbih0LCBlLCBuLCBzLCBpLCByKSB7XG4gICAgICAgICAgICAvLyBVc2UgZXhwbGljaXQgb3JkZXIgYnkncyBiZWNhdXNlIGl0IGhhcyB0byBtYXRjaCB0aGUgcXVlcnkgdGhlIHVzZXIgbWFkZVxuICAgICAgICAgICAgY29uc3QgbyA9IHQuZXhwbGljaXRPcmRlckJ5O1xuICAgICAgICAgICAgaWYgKGkubGVuZ3RoID4gby5sZW5ndGgpIHRocm93IG5ldyBRKEcuSU5WQUxJRF9BUkdVTUVOVCwgYFRvbyBtYW55IGFyZ3VtZW50cyBwcm92aWRlZCB0byAke3N9KCkuIFRoZSBudW1iZXIgb2YgYXJndW1lbnRzIG11c3QgYmUgbGVzcyB0aGFuIG9yIGVxdWFsIHRvIHRoZSBudW1iZXIgb2Ygb3JkZXJCeSgpIGNsYXVzZXNgKTtcbiAgICAgICAgICAgIGNvbnN0IHUgPSBbXTtcbiAgICAgICAgICAgIGZvciAobGV0IHIgPSAwOyByIDwgaS5sZW5ndGg7IHIrKykge1xuICAgICAgICAgICAgICAgIGNvbnN0IGEgPSBpW3JdO1xuICAgICAgICAgICAgICAgIGlmIChvW3JdLmZpZWxkLmlzS2V5RmllbGQoKSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoXCJzdHJpbmdcIiAhPSB0eXBlb2YgYSkgdGhyb3cgbmV3IFEoRy5JTlZBTElEX0FSR1VNRU5ULCBgSW52YWxpZCBxdWVyeS4gRXhwZWN0ZWQgYSBzdHJpbmcgZm9yIGRvY3VtZW50IElEIGluICR7c30oKSwgYnV0IGdvdCBhICR7dHlwZW9mIGF9YCk7XG4gICAgICAgICAgICAgICAgICAgIGlmICghV2UodCkgJiYgLTEgIT09IGEuaW5kZXhPZihcIi9cIikpIHRocm93IG5ldyBRKEcuSU5WQUxJRF9BUkdVTUVOVCwgYEludmFsaWQgcXVlcnkuIFdoZW4gcXVlcnlpbmcgYSBjb2xsZWN0aW9uIGFuZCBvcmRlcmluZyBieSBkb2N1bWVudElkKCksIHRoZSB2YWx1ZSBwYXNzZWQgdG8gJHtzfSgpIG11c3QgYmUgYSBwbGFpbiBkb2N1bWVudCBJRCwgYnV0ICcke2F9JyBjb250YWlucyBhIHNsYXNoLmApO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBuID0gdC5wYXRoLmNoaWxkKF90LmZyb21TdHJpbmcoYSkpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXh0LmlzRG9jdW1lbnRLZXkobikpIHRocm93IG5ldyBRKEcuSU5WQUxJRF9BUkdVTUVOVCwgYEludmFsaWQgcXVlcnkuIFdoZW4gcXVlcnlpbmcgYSBjb2xsZWN0aW9uIGdyb3VwIGFuZCBvcmRlcmluZyBieSBkb2N1bWVudElkKCksIHRoZSB2YWx1ZSBwYXNzZWQgdG8gJHtzfSgpIG11c3QgcmVzdWx0IGluIGEgdmFsaWQgZG9jdW1lbnQgcGF0aCwgYnV0ICcke259JyBpcyBub3QgYmVjYXVzZSBpdCBjb250YWlucyBhbiBvZGQgbnVtYmVyIG9mIHNlZ21lbnRzLmApO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBpID0gbmV3IHh0KG4pO1xuICAgICAgICAgICAgICAgICAgICB1LnB1c2gocXQoZSwgaSkpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHQgPSBoaChuLCBzLCBhKTtcbiAgICAgICAgICAgICAgICAgICAgdS5wdXNoKHQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgT2UodSwgcik7XG4gICAgICAgIH1cbiAgICAgICAgLyoqXG4gKiBQYXJzZXMgdGhlIGdpdmVuIGBkb2N1bWVudElkVmFsdWVgIGludG8gYSBgUmVmZXJlbmNlVmFsdWVgLCB0aHJvd2luZ1xuICogYXBwcm9wcmlhdGUgZXJyb3JzIGlmIHRoZSB2YWx1ZSBpcyBhbnl0aGluZyBvdGhlciB0aGFuIGEgYERvY3VtZW50UmVmZXJlbmNlYFxuICogb3IgYHN0cmluZ2AsIG9yIGlmIHRoZSBzdHJpbmcgaXMgbWFsZm9ybWVkLlxuICovICh0Ll9xdWVyeSwgdC5maXJlc3RvcmUuX2RhdGFiYXNlSWQsIGksIGUsIG4sIHMpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gamgodCwgZSwgbikge1xuICAgIGlmIChcInN0cmluZ1wiID09IHR5cGVvZiAobiA9IHAobikpKSB7XG4gICAgICAgIGlmIChcIlwiID09PSBuKSB0aHJvdyBuZXcgUShHLklOVkFMSURfQVJHVU1FTlQsIFwiSW52YWxpZCBxdWVyeS4gV2hlbiBxdWVyeWluZyB3aXRoIGRvY3VtZW50SWQoKSwgeW91IG11c3QgcHJvdmlkZSBhIHZhbGlkIGRvY3VtZW50IElELCBidXQgaXQgd2FzIGFuIGVtcHR5IHN0cmluZy5cIik7XG4gICAgICAgIGlmICghV2UoZSkgJiYgLTEgIT09IG4uaW5kZXhPZihcIi9cIikpIHRocm93IG5ldyBRKEcuSU5WQUxJRF9BUkdVTUVOVCwgYEludmFsaWQgcXVlcnkuIFdoZW4gcXVlcnlpbmcgYSBjb2xsZWN0aW9uIGJ5IGRvY3VtZW50SWQoKSwgeW91IG11c3QgcHJvdmlkZSBhIHBsYWluIGRvY3VtZW50IElELCBidXQgJyR7bn0nIGNvbnRhaW5zIGEgJy8nIGNoYXJhY3Rlci5gKTtcbiAgICAgICAgY29uc3QgcyA9IGUucGF0aC5jaGlsZChfdC5mcm9tU3RyaW5nKG4pKTtcbiAgICAgICAgaWYgKCF4dC5pc0RvY3VtZW50S2V5KHMpKSB0aHJvdyBuZXcgUShHLklOVkFMSURfQVJHVU1FTlQsIGBJbnZhbGlkIHF1ZXJ5LiBXaGVuIHF1ZXJ5aW5nIGEgY29sbGVjdGlvbiBncm91cCBieSBkb2N1bWVudElkKCksIHRoZSB2YWx1ZSBwcm92aWRlZCBtdXN0IHJlc3VsdCBpbiBhIHZhbGlkIGRvY3VtZW50IHBhdGgsIGJ1dCAnJHtzfScgaXMgbm90IGJlY2F1c2UgaXQgaGFzIGFuIG9kZCBudW1iZXIgb2Ygc2VnbWVudHMgKCR7cy5sZW5ndGh9KS5gKTtcbiAgICAgICAgcmV0dXJuIHF0KHQsIG5ldyB4dChzKSk7XG4gICAgfVxuICAgIGlmIChuIGluc3RhbmNlb2Ygd2MpIHJldHVybiBxdCh0LCBuLl9rZXkpO1xuICAgIHRocm93IG5ldyBRKEcuSU5WQUxJRF9BUkdVTUVOVCwgYEludmFsaWQgcXVlcnkuIFdoZW4gcXVlcnlpbmcgd2l0aCBkb2N1bWVudElkKCksIHlvdSBtdXN0IHByb3ZpZGUgYSB2YWxpZCBzdHJpbmcgb3IgYSBEb2N1bWVudFJlZmVyZW5jZSwgYnV0IGl0IHdhczogJHtjYyhuKX0uYCk7XG59XG5cbi8qKlxuICogVmFsaWRhdGVzIHRoYXQgdGhlIHZhbHVlIHBhc3NlZCBpbnRvIGEgZGlzanVuY3RpdmUgZmlsdGVyIHNhdGlzZmllcyBhbGxcbiAqIGFycmF5IHJlcXVpcmVtZW50cy5cbiAqLyBmdW5jdGlvbiBXaCh0LCBlKSB7XG4gICAgaWYgKCFBcnJheS5pc0FycmF5KHQpIHx8IDAgPT09IHQubGVuZ3RoKSB0aHJvdyBuZXcgUShHLklOVkFMSURfQVJHVU1FTlQsIGBJbnZhbGlkIFF1ZXJ5LiBBIG5vbi1lbXB0eSBhcnJheSBpcyByZXF1aXJlZCBmb3IgJyR7ZS50b1N0cmluZygpfScgZmlsdGVycy5gKTtcbiAgICBpZiAodC5sZW5ndGggPiAxMCkgdGhyb3cgbmV3IFEoRy5JTlZBTElEX0FSR1VNRU5ULCBgSW52YWxpZCBRdWVyeS4gJyR7ZS50b1N0cmluZygpfScgZmlsdGVycyBzdXBwb3J0IGEgbWF4aW11bSBvZiAxMCBlbGVtZW50cyBpbiB0aGUgdmFsdWUgYXJyYXkuYCk7XG59XG5cbmZ1bmN0aW9uIHpoKHQsIGUsIG4pIHtcbiAgICBpZiAoIW4uaXNFcXVhbChlKSkgdGhyb3cgbmV3IFEoRy5JTlZBTElEX0FSR1VNRU5ULCBgSW52YWxpZCBxdWVyeS4gWW91IGhhdmUgYSB3aGVyZSBmaWx0ZXIgd2l0aCBhbiBpbmVxdWFsaXR5ICg8LCA8PSwgIT0sIG5vdC1pbiwgPiwgb3IgPj0pIG9uIGZpZWxkICcke2UudG9TdHJpbmcoKX0nIGFuZCBzbyB5b3UgbXVzdCBhbHNvIHVzZSAnJHtlLnRvU3RyaW5nKCl9JyBhcyB5b3VyIGZpcnN0IGFyZ3VtZW50IHRvIG9yZGVyQnkoKSwgYnV0IHlvdXIgZmlyc3Qgb3JkZXJCeSgpIGlzIG9uIGZpZWxkICcke24udG9TdHJpbmcoKX0nIGluc3RlYWQuYCk7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIyIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovIGNvbnN0IEhoID0ge1xuICAgIG1heEF0dGVtcHRzOiA1XG59O1xuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBDb252ZXJ0cyBGaXJlc3RvcmUncyBpbnRlcm5hbCB0eXBlcyB0byB0aGUgSmF2YVNjcmlwdCB0eXBlcyB0aGF0IHdlIGV4cG9zZVxuICogdG8gdGhlIHVzZXIuXG4gKlxuICogQGludGVybmFsXG4gKi9cbmNsYXNzIEpoIHtcbiAgICBjb252ZXJ0VmFsdWUodCwgZSA9IFwibm9uZVwiKSB7XG4gICAgICAgIHN3aXRjaCAoTXQodCkpIHtcbiAgICAgICAgICBjYXNlIDAgLyogTnVsbFZhbHVlICovIDpcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuXG4gICAgICAgICAgY2FzZSAxIC8qIEJvb2xlYW5WYWx1ZSAqLyA6XG4gICAgICAgICAgICByZXR1cm4gdC5ib29sZWFuVmFsdWU7XG5cbiAgICAgICAgICBjYXNlIDIgLyogTnVtYmVyVmFsdWUgKi8gOlxuICAgICAgICAgICAgcmV0dXJuIEV0KHQuaW50ZWdlclZhbHVlIHx8IHQuZG91YmxlVmFsdWUpO1xuXG4gICAgICAgICAgY2FzZSAzIC8qIFRpbWVzdGFtcFZhbHVlICovIDpcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbnZlcnRUaW1lc3RhbXAodC50aW1lc3RhbXBWYWx1ZSk7XG5cbiAgICAgICAgICBjYXNlIDQgLyogU2VydmVyVGltZXN0YW1wVmFsdWUgKi8gOlxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29udmVydFNlcnZlclRpbWVzdGFtcCh0LCBlKTtcblxuICAgICAgICAgIGNhc2UgNSAvKiBTdHJpbmdWYWx1ZSAqLyA6XG4gICAgICAgICAgICByZXR1cm4gdC5zdHJpbmdWYWx1ZTtcblxuICAgICAgICAgIGNhc2UgNiAvKiBCbG9iVmFsdWUgKi8gOlxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29udmVydEJ5dGVzKEF0KHQuYnl0ZXNWYWx1ZSkpO1xuXG4gICAgICAgICAgY2FzZSA3IC8qIFJlZlZhbHVlICovIDpcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbnZlcnRSZWZlcmVuY2UodC5yZWZlcmVuY2VWYWx1ZSk7XG5cbiAgICAgICAgICBjYXNlIDggLyogR2VvUG9pbnRWYWx1ZSAqLyA6XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jb252ZXJ0R2VvUG9pbnQodC5nZW9Qb2ludFZhbHVlKTtcblxuICAgICAgICAgIGNhc2UgOSAvKiBBcnJheVZhbHVlICovIDpcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbnZlcnRBcnJheSh0LmFycmF5VmFsdWUsIGUpO1xuXG4gICAgICAgICAgY2FzZSAxMCAvKiBPYmplY3RWYWx1ZSAqLyA6XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jb252ZXJ0T2JqZWN0KHQubWFwVmFsdWUsIGUpO1xuXG4gICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIHRocm93IEwoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjb252ZXJ0T2JqZWN0KHQsIGUpIHtcbiAgICAgICAgY29uc3QgbiA9IHt9O1xuICAgICAgICByZXR1cm4gbHQodC5maWVsZHMsICgodCwgcykgPT4ge1xuICAgICAgICAgICAgblt0XSA9IHRoaXMuY29udmVydFZhbHVlKHMsIGUpO1xuICAgICAgICB9KSksIG47XG4gICAgfVxuICAgIGNvbnZlcnRHZW9Qb2ludCh0KSB7XG4gICAgICAgIHJldHVybiBuZXcgV2MoRXQodC5sYXRpdHVkZSksIEV0KHQubG9uZ2l0dWRlKSk7XG4gICAgfVxuICAgIGNvbnZlcnRBcnJheSh0LCBlKSB7XG4gICAgICAgIHJldHVybiAodC52YWx1ZXMgfHwgW10pLm1hcCgodCA9PiB0aGlzLmNvbnZlcnRWYWx1ZSh0LCBlKSkpO1xuICAgIH1cbiAgICBjb252ZXJ0U2VydmVyVGltZXN0YW1wKHQsIGUpIHtcbiAgICAgICAgc3dpdGNoIChlKSB7XG4gICAgICAgICAgY2FzZSBcInByZXZpb3VzXCI6XG4gICAgICAgICAgICBjb25zdCBuID0gYnQodCk7XG4gICAgICAgICAgICByZXR1cm4gbnVsbCA9PSBuID8gbnVsbCA6IHRoaXMuY29udmVydFZhbHVlKG4sIGUpO1xuXG4gICAgICAgICAgY2FzZSBcImVzdGltYXRlXCI6XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jb252ZXJ0VGltZXN0YW1wKFB0KHQpKTtcblxuICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjb252ZXJ0VGltZXN0YW1wKHQpIHtcbiAgICAgICAgY29uc3QgZSA9IFR0KHQpO1xuICAgICAgICByZXR1cm4gbmV3IGF0KGUuc2Vjb25kcywgZS5uYW5vcyk7XG4gICAgfVxuICAgIGNvbnZlcnREb2N1bWVudEtleSh0LCBlKSB7XG4gICAgICAgIGNvbnN0IG4gPSBfdC5mcm9tU3RyaW5nKHQpO1xuICAgICAgICBVKEtzKG4pKTtcbiAgICAgICAgY29uc3QgcyA9IG5ldyB2dChuLmdldCgxKSwgbi5nZXQoMykpLCBpID0gbmV3IHh0KG4ucG9wRmlyc3QoNSkpO1xuICAgICAgICByZXR1cm4gcy5pc0VxdWFsKGUpIHx8IFxuICAgICAgICAvLyBUT0RPKGIvNjQxMzAyMDIpOiBTb21laG93IHN1cHBvcnQgZm9yZWlnbiByZWZlcmVuY2VzLlxuICAgICAgICBGKGBEb2N1bWVudCAke2l9IGNvbnRhaW5zIGEgZG9jdW1lbnQgcmVmZXJlbmNlIHdpdGhpbiBhIGRpZmZlcmVudCBkYXRhYmFzZSAoJHtzLnByb2plY3RJZH0vJHtzLmRhdGFiYXNlfSkgd2hpY2ggaXMgbm90IHN1cHBvcnRlZC4gSXQgd2lsbCBiZSB0cmVhdGVkIGFzIGEgcmVmZXJlbmNlIGluIHRoZSBjdXJyZW50IGRhdGFiYXNlICgke2UucHJvamVjdElkfS8ke2UuZGF0YWJhc2V9KSBpbnN0ZWFkLmApLCBcbiAgICAgICAgaTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIENvbnZlcnRzIGN1c3RvbSBtb2RlbCBvYmplY3Qgb2YgdHlwZSBUIGludG8gYERvY3VtZW50RGF0YWAgYnkgYXBwbHlpbmcgdGhlXG4gKiBjb252ZXJ0ZXIgaWYgaXQgZXhpc3RzLlxuICpcbiAqIFRoaXMgZnVuY3Rpb24gaXMgdXNlZCB3aGVuIGNvbnZlcnRpbmcgdXNlciBvYmplY3RzIHRvIGBEb2N1bWVudERhdGFgXG4gKiBiZWNhdXNlIHdlIHdhbnQgdG8gcHJvdmlkZSB0aGUgdXNlciB3aXRoIGEgbW9yZSBzcGVjaWZpYyBlcnJvciBtZXNzYWdlIGlmXG4gKiB0aGVpciBgc2V0KClgIG9yIGZhaWxzIGR1ZSB0byBpbnZhbGlkIGRhdGEgb3JpZ2luYXRpbmcgZnJvbSBhIGB0b0ZpcmVzdG9yZSgpYFxuICogY2FsbC5cbiAqLyBmdW5jdGlvbiBZaCh0LCBlLCBuKSB7XG4gICAgbGV0IHM7XG4gICAgLy8gQ2FzdCB0byBgYW55YCBpbiBvcmRlciB0byBzYXRpc2Z5IHRoZSB1bmlvbiB0eXBlIGNvbnN0cmFpbnQgb25cbiAgICAvLyB0b0ZpcmVzdG9yZSgpLlxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG4gICAgcmV0dXJuIHMgPSB0ID8gbiAmJiAobi5tZXJnZSB8fCBuLm1lcmdlRmllbGRzKSA/IHQudG9GaXJlc3RvcmUoZSwgbikgOiB0LnRvRmlyZXN0b3JlKGUpIDogZSwgXG4gICAgcztcbn1cblxuY2xhc3MgWGggZXh0ZW5kcyBKaCB7XG4gICAgY29uc3RydWN0b3IodCkge1xuICAgICAgICBzdXBlcigpLCB0aGlzLmZpcmVzdG9yZSA9IHQ7XG4gICAgfVxuICAgIGNvbnZlcnRCeXRlcyh0KSB7XG4gICAgICAgIHJldHVybiBuZXcgUWModCk7XG4gICAgfVxuICAgIGNvbnZlcnRSZWZlcmVuY2UodCkge1xuICAgICAgICBjb25zdCBlID0gdGhpcy5jb252ZXJ0RG9jdW1lbnRLZXkodCwgdGhpcy5maXJlc3RvcmUuX2RhdGFiYXNlSWQpO1xuICAgICAgICByZXR1cm4gbmV3IHdjKHRoaXMuZmlyZXN0b3JlLCAvKiBjb252ZXJ0ZXI9ICovIG51bGwsIGUpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogQSB3cml0ZSBiYXRjaCwgdXNlZCB0byBwZXJmb3JtIG11bHRpcGxlIHdyaXRlcyBhcyBhIHNpbmdsZSBhdG9taWMgdW5pdC5cbiAqXG4gKiBBIGBXcml0ZUJhdGNoYCBvYmplY3QgY2FuIGJlIGFjcXVpcmVkIGJ5IGNhbGxpbmcge0BsaW5rIHdyaXRlQmF0Y2h9LiBJdFxuICogcHJvdmlkZXMgbWV0aG9kcyBmb3IgYWRkaW5nIHdyaXRlcyB0byB0aGUgd3JpdGUgYmF0Y2guIE5vbmUgb2YgdGhlIHdyaXRlc1xuICogd2lsbCBiZSBjb21taXR0ZWQgKG9yIHZpc2libGUgbG9jYWxseSkgdW50aWwge0BsaW5rIFdyaXRlQmF0Y2guY29tbWl0fSBpc1xuICogY2FsbGVkLlxuICovIGNsYXNzIFpoIHtcbiAgICAvKiogQGhpZGVjb25zdHJ1Y3RvciAqL1xuICAgIGNvbnN0cnVjdG9yKHQsIGUpIHtcbiAgICAgICAgdGhpcy5fZmlyZXN0b3JlID0gdCwgdGhpcy5fY29tbWl0SGFuZGxlciA9IGUsIHRoaXMuX211dGF0aW9ucyA9IFtdLCB0aGlzLl9jb21taXR0ZWQgPSAhMSwgXG4gICAgICAgIHRoaXMuX2RhdGFSZWFkZXIgPSB0aCh0KTtcbiAgICB9XG4gICAgc2V0KHQsIGUsIG4pIHtcbiAgICAgICAgdGhpcy5fdmVyaWZ5Tm90Q29tbWl0dGVkKCk7XG4gICAgICAgIGNvbnN0IHMgPSB0bCh0LCB0aGlzLl9maXJlc3RvcmUpLCBpID0gWWgocy5jb252ZXJ0ZXIsIGUsIG4pLCByID0gZWgodGhpcy5fZGF0YVJlYWRlciwgXCJXcml0ZUJhdGNoLnNldFwiLCBzLl9rZXksIGksIG51bGwgIT09IHMuY29udmVydGVyLCBuKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuX211dGF0aW9ucy5wdXNoKHIudG9NdXRhdGlvbihzLl9rZXksIEFuLm5vbmUoKSkpLCB0aGlzO1xuICAgIH1cbiAgICB1cGRhdGUodCwgZSwgbiwgLi4ucykge1xuICAgICAgICB0aGlzLl92ZXJpZnlOb3RDb21taXR0ZWQoKTtcbiAgICAgICAgY29uc3QgaSA9IHRsKHQsIHRoaXMuX2ZpcmVzdG9yZSk7XG4gICAgICAgIC8vIEZvciBDb21wYXQgdHlwZXMsIHdlIGhhdmUgdG8gXCJleHRyYWN0XCIgdGhlIHVuZGVybHlpbmcgdHlwZXMgYmVmb3JlXG4gICAgICAgIC8vIHBlcmZvcm1pbmcgdmFsaWRhdGlvbi5cbiAgICAgICAgICAgICAgICBsZXQgcjtcbiAgICAgICAgcmV0dXJuIHIgPSBcInN0cmluZ1wiID09IHR5cGVvZiAoZSA9IHAoZSkpIHx8IGUgaW5zdGFuY2VvZiBLYyA/IGNoKHRoaXMuX2RhdGFSZWFkZXIsIFwiV3JpdGVCYXRjaC51cGRhdGVcIiwgaS5fa2V5LCBlLCBuLCBzKSA6IGFoKHRoaXMuX2RhdGFSZWFkZXIsIFwiV3JpdGVCYXRjaC51cGRhdGVcIiwgaS5fa2V5LCBlKSwgXG4gICAgICAgIHRoaXMuX211dGF0aW9ucy5wdXNoKHIudG9NdXRhdGlvbihpLl9rZXksIEFuLmV4aXN0cyghMCkpKSwgdGhpcztcbiAgICB9XG4gICAgLyoqXG4gICAgICogRGVsZXRlcyB0aGUgZG9jdW1lbnQgcmVmZXJyZWQgdG8gYnkgdGhlIHByb3ZpZGVkIHtAbGluayBEb2N1bWVudFJlZmVyZW5jZX0uXG4gICAgICpcbiAgICAgKiBAcGFyYW0gZG9jdW1lbnRSZWYgLSBBIHJlZmVyZW5jZSB0byB0aGUgZG9jdW1lbnQgdG8gYmUgZGVsZXRlZC5cbiAgICAgKiBAcmV0dXJucyBUaGlzIGBXcml0ZUJhdGNoYCBpbnN0YW5jZS4gVXNlZCBmb3IgY2hhaW5pbmcgbWV0aG9kIGNhbGxzLlxuICAgICAqLyAgICBkZWxldGUodCkge1xuICAgICAgICB0aGlzLl92ZXJpZnlOb3RDb21taXR0ZWQoKTtcbiAgICAgICAgY29uc3QgZSA9IHRsKHQsIHRoaXMuX2ZpcmVzdG9yZSk7XG4gICAgICAgIHJldHVybiB0aGlzLl9tdXRhdGlvbnMgPSB0aGlzLl9tdXRhdGlvbnMuY29uY2F0KG5ldyBPbihlLl9rZXksIEFuLm5vbmUoKSkpLCB0aGlzO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDb21taXRzIGFsbCBvZiB0aGUgd3JpdGVzIGluIHRoaXMgd3JpdGUgYmF0Y2ggYXMgYSBzaW5nbGUgYXRvbWljIHVuaXQuXG4gICAgICpcbiAgICAgKiBUaGUgcmVzdWx0IG9mIHRoZXNlIHdyaXRlcyB3aWxsIG9ubHkgYmUgcmVmbGVjdGVkIGluIGRvY3VtZW50IHJlYWRzIHRoYXRcbiAgICAgKiBvY2N1ciBhZnRlciB0aGUgcmV0dXJuZWQgcHJvbWlzZSByZXNvbHZlcy4gSWYgdGhlIGNsaWVudCBpcyBvZmZsaW5lLCB0aGVcbiAgICAgKiB3cml0ZSBmYWlscy4gSWYgeW91IHdvdWxkIGxpa2UgdG8gc2VlIGxvY2FsIG1vZGlmaWNhdGlvbnMgb3IgYnVmZmVyIHdyaXRlc1xuICAgICAqIHVudGlsIHRoZSBjbGllbnQgaXMgb25saW5lLCB1c2UgdGhlIGZ1bGwgRmlyZXN0b3JlIFNESy5cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIEEgYFByb21pc2VgIHJlc29sdmVkIG9uY2UgYWxsIG9mIHRoZSB3cml0ZXMgaW4gdGhlIGJhdGNoIGhhdmUgYmVlblxuICAgICAqIHN1Y2Nlc3NmdWxseSB3cml0dGVuIHRvIHRoZSBiYWNrZW5kIGFzIGFuIGF0b21pYyB1bml0IChub3RlIHRoYXQgaXQgd29uJ3RcbiAgICAgKiByZXNvbHZlIHdoaWxlIHlvdSdyZSBvZmZsaW5lKS5cbiAgICAgKi8gICAgY29tbWl0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fdmVyaWZ5Tm90Q29tbWl0dGVkKCksIHRoaXMuX2NvbW1pdHRlZCA9ICEwLCB0aGlzLl9tdXRhdGlvbnMubGVuZ3RoID4gMCA/IHRoaXMuX2NvbW1pdEhhbmRsZXIodGhpcy5fbXV0YXRpb25zKSA6IFByb21pc2UucmVzb2x2ZSgpO1xuICAgIH1cbiAgICBfdmVyaWZ5Tm90Q29tbWl0dGVkKCkge1xuICAgICAgICBpZiAodGhpcy5fY29tbWl0dGVkKSB0aHJvdyBuZXcgUShHLkZBSUxFRF9QUkVDT05ESVRJT04sIFwiQSB3cml0ZSBiYXRjaCBjYW4gbm8gbG9uZ2VyIGJlIHVzZWQgYWZ0ZXIgY29tbWl0KCkgaGFzIGJlZW4gY2FsbGVkLlwiKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIHRsKHQsIGUpIHtcbiAgICBpZiAoKHQgPSBwKHQpKS5maXJlc3RvcmUgIT09IGUpIHRocm93IG5ldyBRKEcuSU5WQUxJRF9BUkdVTUVOVCwgXCJQcm92aWRlZCBkb2N1bWVudCByZWZlcmVuY2UgaXMgZnJvbSBhIGRpZmZlcmVudCBGaXJlc3RvcmUgaW5zdGFuY2UuXCIpO1xuICAgIHJldHVybiB0O1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLy8gVE9ETyhtcnNjaG1pZHQpIENvbnNpZGVyIHVzaW5nIGBCYXNlVHJhbnNhY3Rpb25gIGFzIHRoZSBiYXNlIGNsYXNzIGluIHRoZVxuLy8gbGVnYWN5IFNESy5cbi8qKlxuICogQSByZWZlcmVuY2UgdG8gYSB0cmFuc2FjdGlvbi5cbiAqXG4gKiBUaGUgYFRyYW5zYWN0aW9uYCBvYmplY3QgcGFzc2VkIHRvIGEgdHJhbnNhY3Rpb24ncyBgdXBkYXRlRnVuY3Rpb25gIHByb3ZpZGVzXG4gKiB0aGUgbWV0aG9kcyB0byByZWFkIGFuZCB3cml0ZSBkYXRhIHdpdGhpbiB0aGUgdHJhbnNhY3Rpb24gY29udGV4dC4gU2VlXG4gKiB7QGxpbmsgcnVuVHJhbnNhY3Rpb259LlxuICovXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBSZWFkcyB0aGUgZG9jdW1lbnQgcmVmZXJyZWQgdG8gYnkgdGhpcyBgRG9jdW1lbnRSZWZlcmVuY2VgLlxuICpcbiAqIE5vdGU6IGBnZXREb2MoKWAgYXR0ZW1wdHMgdG8gcHJvdmlkZSB1cC10by1kYXRlIGRhdGEgd2hlbiBwb3NzaWJsZSBieSB3YWl0aW5nXG4gKiBmb3IgZGF0YSBmcm9tIHRoZSBzZXJ2ZXIsIGJ1dCBpdCBtYXkgcmV0dXJuIGNhY2hlZCBkYXRhIG9yIGZhaWwgaWYgeW91IGFyZVxuICogb2ZmbGluZSBhbmQgdGhlIHNlcnZlciBjYW5ub3QgYmUgcmVhY2hlZC4gVG8gc3BlY2lmeSB0aGlzIGJlaGF2aW9yLCBpbnZva2VcbiAqIHtAbGluayBnZXREb2NGcm9tQ2FjaGV9IG9yIHtAbGluayBnZXREb2NGcm9tU2VydmVyfS5cbiAqXG4gKiBAcGFyYW0gcmVmZXJlbmNlIC0gVGhlIHJlZmVyZW5jZSBvZiB0aGUgZG9jdW1lbnQgdG8gZmV0Y2guXG4gKiBAcmV0dXJucyBBIFByb21pc2UgcmVzb2x2ZWQgd2l0aCBhIGBEb2N1bWVudFNuYXBzaG90YCBjb250YWluaW5nIHRoZVxuICogY3VycmVudCBkb2N1bWVudCBjb250ZW50cy5cbiAqL1xuZnVuY3Rpb24gZWwodCkge1xuICAgIHQgPSBoYyh0LCB3Yyk7XG4gICAgY29uc3QgZSA9IGhjKHQuZmlyZXN0b3JlLCBWYyk7XG4gICAgcmV0dXJuIFlhKERjKGUpLCB0Ll9rZXkpLnRoZW4oKG4gPT4gd2woZSwgdCwgbikpKTtcbn1cblxuY2xhc3MgbmwgZXh0ZW5kcyBKaCB7XG4gICAgY29uc3RydWN0b3IodCkge1xuICAgICAgICBzdXBlcigpLCB0aGlzLmZpcmVzdG9yZSA9IHQ7XG4gICAgfVxuICAgIGNvbnZlcnRCeXRlcyh0KSB7XG4gICAgICAgIHJldHVybiBuZXcgUWModCk7XG4gICAgfVxuICAgIGNvbnZlcnRSZWZlcmVuY2UodCkge1xuICAgICAgICBjb25zdCBlID0gdGhpcy5jb252ZXJ0RG9jdW1lbnRLZXkodCwgdGhpcy5maXJlc3RvcmUuX2RhdGFiYXNlSWQpO1xuICAgICAgICByZXR1cm4gbmV3IHdjKHRoaXMuZmlyZXN0b3JlLCAvKiBjb252ZXJ0ZXI9ICovIG51bGwsIGUpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBSZWFkcyB0aGUgZG9jdW1lbnQgcmVmZXJyZWQgdG8gYnkgdGhpcyBgRG9jdW1lbnRSZWZlcmVuY2VgIGZyb20gY2FjaGUuXG4gKiBSZXR1cm5zIGFuIGVycm9yIGlmIHRoZSBkb2N1bWVudCBpcyBub3QgY3VycmVudGx5IGNhY2hlZC5cbiAqXG4gKiBAcmV0dXJucyBBIGBQcm9taXNlYCByZXNvbHZlZCB3aXRoIGEgYERvY3VtZW50U25hcHNob3RgIGNvbnRhaW5pbmcgdGhlXG4gKiBjdXJyZW50IGRvY3VtZW50IGNvbnRlbnRzLlxuICovIGZ1bmN0aW9uIHNsKHQpIHtcbiAgICB0ID0gaGModCwgd2MpO1xuICAgIGNvbnN0IGUgPSBoYyh0LmZpcmVzdG9yZSwgVmMpLCBuID0gRGMoZSksIHMgPSBuZXcgbmwoZSk7XG4gICAgcmV0dXJuIEphKG4sIHQuX2tleSkudGhlbigobiA9PiBuZXcgUmgoZSwgcywgdC5fa2V5LCBuLCBuZXcgQWgobnVsbCAhPT0gbiAmJiBuLmhhc0xvY2FsTXV0YXRpb25zLCBcbiAgICAvKiBmcm9tQ2FjaGU9ICovICEwKSwgdC5jb252ZXJ0ZXIpKSk7XG59XG5cbi8qKlxuICogUmVhZHMgdGhlIGRvY3VtZW50IHJlZmVycmVkIHRvIGJ5IHRoaXMgYERvY3VtZW50UmVmZXJlbmNlYCBmcm9tIHRoZSBzZXJ2ZXIuXG4gKiBSZXR1cm5zIGFuIGVycm9yIGlmIHRoZSBuZXR3b3JrIGlzIG5vdCBhdmFpbGFibGUuXG4gKlxuICogQHJldHVybnMgQSBgUHJvbWlzZWAgcmVzb2x2ZWQgd2l0aCBhIGBEb2N1bWVudFNuYXBzaG90YCBjb250YWluaW5nIHRoZVxuICogY3VycmVudCBkb2N1bWVudCBjb250ZW50cy5cbiAqLyBmdW5jdGlvbiBpbCh0KSB7XG4gICAgdCA9IGhjKHQsIHdjKTtcbiAgICBjb25zdCBlID0gaGModC5maXJlc3RvcmUsIFZjKTtcbiAgICByZXR1cm4gWWEoRGMoZSksIHQuX2tleSwge1xuICAgICAgICBzb3VyY2U6IFwic2VydmVyXCJcbiAgICB9KS50aGVuKChuID0+IHdsKGUsIHQsIG4pKSk7XG59XG5cbi8qKlxuICogRXhlY3V0ZXMgdGhlIHF1ZXJ5IGFuZCByZXR1cm5zIHRoZSByZXN1bHRzIGFzIGEgYFF1ZXJ5U25hcHNob3RgLlxuICpcbiAqIE5vdGU6IGBnZXREb2NzKClgIGF0dGVtcHRzIHRvIHByb3ZpZGUgdXAtdG8tZGF0ZSBkYXRhIHdoZW4gcG9zc2libGUgYnlcbiAqIHdhaXRpbmcgZm9yIGRhdGEgZnJvbSB0aGUgc2VydmVyLCBidXQgaXQgbWF5IHJldHVybiBjYWNoZWQgZGF0YSBvciBmYWlsIGlmXG4gKiB5b3UgYXJlIG9mZmxpbmUgYW5kIHRoZSBzZXJ2ZXIgY2Fubm90IGJlIHJlYWNoZWQuIFRvIHNwZWNpZnkgdGhpcyBiZWhhdmlvcixcbiAqIGludm9rZSB7QGxpbmsgZ2V0RG9jc0Zyb21DYWNoZX0gb3Ige0BsaW5rIGdldERvY3NGcm9tU2VydmVyfS5cbiAqXG4gKiBAcmV0dXJucyBBIGBQcm9taXNlYCB0aGF0IHdpbGwgYmUgcmVzb2x2ZWQgd2l0aCB0aGUgcmVzdWx0cyBvZiB0aGUgcXVlcnkuXG4gKi8gZnVuY3Rpb24gcmwodCkge1xuICAgIHQgPSBoYyh0LCBtYyk7XG4gICAgY29uc3QgZSA9IGhjKHQuZmlyZXN0b3JlLCBWYyksIG4gPSBEYyhlKSwgcyA9IG5ldyBubChlKTtcbiAgICByZXR1cm4gU2godC5fcXVlcnkpLCBaYShuLCB0Ll9xdWVyeSkudGhlbigobiA9PiBuZXcgUGgoZSwgcywgdCwgbikpKTtcbn1cblxuLyoqXG4gKiBFeGVjdXRlcyB0aGUgcXVlcnkgYW5kIHJldHVybnMgdGhlIHJlc3VsdHMgYXMgYSBgUXVlcnlTbmFwc2hvdGAgZnJvbSBjYWNoZS5cbiAqIFJldHVybnMgYW4gZXJyb3IgaWYgdGhlIGRvY3VtZW50IGlzIG5vdCBjdXJyZW50bHkgY2FjaGVkLlxuICpcbiAqIEByZXR1cm5zIEEgYFByb21pc2VgIHRoYXQgd2lsbCBiZSByZXNvbHZlZCB3aXRoIHRoZSByZXN1bHRzIG9mIHRoZSBxdWVyeS5cbiAqLyBmdW5jdGlvbiBvbCh0KSB7XG4gICAgdCA9IGhjKHQsIG1jKTtcbiAgICBjb25zdCBlID0gaGModC5maXJlc3RvcmUsIFZjKSwgbiA9IERjKGUpLCBzID0gbmV3IG5sKGUpO1xuICAgIHJldHVybiBYYShuLCB0Ll9xdWVyeSkudGhlbigobiA9PiBuZXcgUGgoZSwgcywgdCwgbikpKTtcbn1cblxuLyoqXG4gKiBFeGVjdXRlcyB0aGUgcXVlcnkgYW5kIHJldHVybnMgdGhlIHJlc3VsdHMgYXMgYSBgUXVlcnlTbmFwc2hvdGAgZnJvbSB0aGVcbiAqIHNlcnZlci4gUmV0dXJucyBhbiBlcnJvciBpZiB0aGUgbmV0d29yayBpcyBub3QgYXZhaWxhYmxlLlxuICpcbiAqIEByZXR1cm5zIEEgYFByb21pc2VgIHRoYXQgd2lsbCBiZSByZXNvbHZlZCB3aXRoIHRoZSByZXN1bHRzIG9mIHRoZSBxdWVyeS5cbiAqLyBmdW5jdGlvbiB1bCh0KSB7XG4gICAgdCA9IGhjKHQsIG1jKTtcbiAgICBjb25zdCBlID0gaGModC5maXJlc3RvcmUsIFZjKSwgbiA9IERjKGUpLCBzID0gbmV3IG5sKGUpO1xuICAgIHJldHVybiBaYShuLCB0Ll9xdWVyeSwge1xuICAgICAgICBzb3VyY2U6IFwic2VydmVyXCJcbiAgICB9KS50aGVuKChuID0+IG5ldyBQaChlLCBzLCB0LCBuKSkpO1xufVxuXG5mdW5jdGlvbiBhbCh0LCBlLCBuKSB7XG4gICAgdCA9IGhjKHQsIHdjKTtcbiAgICBjb25zdCBzID0gaGModC5maXJlc3RvcmUsIFZjKSwgaSA9IFloKHQuY29udmVydGVyLCBlLCBuKTtcbiAgICByZXR1cm4gX2wocywgWyBlaCh0aChzKSwgXCJzZXREb2NcIiwgdC5fa2V5LCBpLCBudWxsICE9PSB0LmNvbnZlcnRlciwgbikudG9NdXRhdGlvbih0Ll9rZXksIEFuLm5vbmUoKSkgXSk7XG59XG5cbmZ1bmN0aW9uIGNsKHQsIGUsIG4sIC4uLnMpIHtcbiAgICB0ID0gaGModCwgd2MpO1xuICAgIGNvbnN0IGkgPSBoYyh0LmZpcmVzdG9yZSwgVmMpLCByID0gdGgoaSk7XG4gICAgbGV0IG87XG4gICAgbyA9IFwic3RyaW5nXCIgPT0gdHlwZW9mIChcbiAgICAvLyBGb3IgQ29tcGF0IHR5cGVzLCB3ZSBoYXZlIHRvIFwiZXh0cmFjdFwiIHRoZSB1bmRlcmx5aW5nIHR5cGVzIGJlZm9yZVxuICAgIC8vIHBlcmZvcm1pbmcgdmFsaWRhdGlvbi5cbiAgICBlID0gcChlKSkgfHwgZSBpbnN0YW5jZW9mIEtjID8gY2gociwgXCJ1cGRhdGVEb2NcIiwgdC5fa2V5LCBlLCBuLCBzKSA6IGFoKHIsIFwidXBkYXRlRG9jXCIsIHQuX2tleSwgZSk7XG4gICAgcmV0dXJuIF9sKGksIFsgby50b011dGF0aW9uKHQuX2tleSwgQW4uZXhpc3RzKCEwKSkgXSk7XG59XG5cbi8qKlxuICogRGVsZXRlcyB0aGUgZG9jdW1lbnQgcmVmZXJyZWQgdG8gYnkgdGhlIHNwZWNpZmllZCBgRG9jdW1lbnRSZWZlcmVuY2VgLlxuICpcbiAqIEBwYXJhbSByZWZlcmVuY2UgLSBBIHJlZmVyZW5jZSB0byB0aGUgZG9jdW1lbnQgdG8gZGVsZXRlLlxuICogQHJldHVybnMgQSBQcm9taXNlIHJlc29sdmVkIG9uY2UgdGhlIGRvY3VtZW50IGhhcyBiZWVuIHN1Y2Nlc3NmdWxseVxuICogZGVsZXRlZCBmcm9tIHRoZSBiYWNrZW5kIChub3RlIHRoYXQgaXQgd29uJ3QgcmVzb2x2ZSB3aGlsZSB5b3UncmUgb2ZmbGluZSkuXG4gKi8gZnVuY3Rpb24gaGwodCkge1xuICAgIHJldHVybiBfbChoYyh0LmZpcmVzdG9yZSwgVmMpLCBbIG5ldyBPbih0Ll9rZXksIEFuLm5vbmUoKSkgXSk7XG59XG5cbi8qKlxuICogQWRkIGEgbmV3IGRvY3VtZW50IHRvIHNwZWNpZmllZCBgQ29sbGVjdGlvblJlZmVyZW5jZWAgd2l0aCB0aGUgZ2l2ZW4gZGF0YSxcbiAqIGFzc2lnbmluZyBpdCBhIGRvY3VtZW50IElEIGF1dG9tYXRpY2FsbHkuXG4gKlxuICogQHBhcmFtIHJlZmVyZW5jZSAtIEEgcmVmZXJlbmNlIHRvIHRoZSBjb2xsZWN0aW9uIHRvIGFkZCB0aGlzIGRvY3VtZW50IHRvLlxuICogQHBhcmFtIGRhdGEgLSBBbiBPYmplY3QgY29udGFpbmluZyB0aGUgZGF0YSBmb3IgdGhlIG5ldyBkb2N1bWVudC5cbiAqIEByZXR1cm5zIEEgYFByb21pc2VgIHJlc29sdmVkIHdpdGggYSBgRG9jdW1lbnRSZWZlcmVuY2VgIHBvaW50aW5nIHRvIHRoZVxuICogbmV3bHkgY3JlYXRlZCBkb2N1bWVudCBhZnRlciBpdCBoYXMgYmVlbiB3cml0dGVuIHRvIHRoZSBiYWNrZW5kIChOb3RlIHRoYXQgaXRcbiAqIHdvbid0IHJlc29sdmUgd2hpbGUgeW91J3JlIG9mZmxpbmUpLlxuICovIGZ1bmN0aW9uIGxsKHQsIGUpIHtcbiAgICBjb25zdCBuID0gaGModC5maXJlc3RvcmUsIFZjKSwgcyA9IEljKHQpLCBpID0gWWgodC5jb252ZXJ0ZXIsIGUpO1xuICAgIHJldHVybiBfbChuLCBbIGVoKHRoKHQuZmlyZXN0b3JlKSwgXCJhZGREb2NcIiwgcy5fa2V5LCBpLCBudWxsICE9PSB0LmNvbnZlcnRlciwge30pLnRvTXV0YXRpb24ocy5fa2V5LCBBbi5leGlzdHMoITEpKSBdKS50aGVuKCgoKSA9PiBzKSk7XG59XG5cbmZ1bmN0aW9uIGZsKHQsIC4uLmUpIHtcbiAgICB2YXIgbiwgcywgaTtcbiAgICB0ID0gcCh0KTtcbiAgICBsZXQgciA9IHtcbiAgICAgICAgaW5jbHVkZU1ldGFkYXRhQ2hhbmdlczogITFcbiAgICB9LCBvID0gMDtcbiAgICBcIm9iamVjdFwiICE9IHR5cGVvZiBlW29dIHx8IFJjKGVbb10pIHx8IChyID0gZVtvXSwgbysrKTtcbiAgICBjb25zdCB1ID0ge1xuICAgICAgICBpbmNsdWRlTWV0YWRhdGFDaGFuZ2VzOiByLmluY2x1ZGVNZXRhZGF0YUNoYW5nZXNcbiAgICB9O1xuICAgIGlmIChSYyhlW29dKSkge1xuICAgICAgICBjb25zdCB0ID0gZVtvXTtcbiAgICAgICAgZVtvXSA9IG51bGwgPT09IChuID0gdC5uZXh0KSB8fCB2b2lkIDAgPT09IG4gPyB2b2lkIDAgOiBuLmJpbmQodCksIGVbbyArIDFdID0gbnVsbCA9PT0gKHMgPSB0LmVycm9yKSB8fCB2b2lkIDAgPT09IHMgPyB2b2lkIDAgOiBzLmJpbmQodCksIFxuICAgICAgICBlW28gKyAyXSA9IG51bGwgPT09IChpID0gdC5jb21wbGV0ZSkgfHwgdm9pZCAwID09PSBpID8gdm9pZCAwIDogaS5iaW5kKHQpO1xuICAgIH1cbiAgICBsZXQgYSwgYywgaDtcbiAgICBpZiAodCBpbnN0YW5jZW9mIHdjKSBjID0gaGModC5maXJlc3RvcmUsIFZjKSwgaCA9IEtlKHQuX2tleS5wYXRoKSwgYSA9IHtcbiAgICAgICAgbmV4dDogbiA9PiB7XG4gICAgICAgICAgICBlW29dICYmIGVbb10od2woYywgdCwgbikpO1xuICAgICAgICB9LFxuICAgICAgICBlcnJvcjogZVtvICsgMV0sXG4gICAgICAgIGNvbXBsZXRlOiBlW28gKyAyXVxuICAgIH07IGVsc2Uge1xuICAgICAgICBjb25zdCBuID0gaGModCwgbWMpO1xuICAgICAgICBjID0gaGMobi5maXJlc3RvcmUsIFZjKSwgaCA9IG4uX3F1ZXJ5O1xuICAgICAgICBjb25zdCBzID0gbmV3IG5sKGMpO1xuICAgICAgICBhID0ge1xuICAgICAgICAgICAgbmV4dDogdCA9PiB7XG4gICAgICAgICAgICAgICAgZVtvXSAmJiBlW29dKG5ldyBQaChjLCBzLCBuLCB0KSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZXJyb3I6IGVbbyArIDFdLFxuICAgICAgICAgICAgY29tcGxldGU6IGVbbyArIDJdXG4gICAgICAgIH0sIFNoKHQuX3F1ZXJ5KTtcbiAgICB9XG4gICAgcmV0dXJuIGZ1bmN0aW9uKHQsIGUsIG4sIHMpIHtcbiAgICAgICAgY29uc3QgaSA9IG5ldyBrYShzKSwgciA9IG5ldyBMdShlLCBpLCBuKTtcbiAgICAgICAgcmV0dXJuIHQuYXN5bmNRdWV1ZS5lbnF1ZXVlQW5kRm9yZ2V0KChhc3luYyAoKSA9PiBNdShhd2FpdCBXYSh0KSwgcikpKSwgKCkgPT4ge1xuICAgICAgICAgICAgaS5BYSgpLCB0LmFzeW5jUXVldWUuZW5xdWV1ZUFuZEZvcmdldCgoYXN5bmMgKCkgPT4gT3UoYXdhaXQgV2EodCksIHIpKSk7XG4gICAgICAgIH07XG4gICAgfShEYyhjKSwgaCwgdSwgYSk7XG59XG5cbmZ1bmN0aW9uIGRsKHQsIGUpIHtcbiAgICByZXR1cm4gdGMoRGModCA9IGhjKHQsIFZjKSksIFJjKGUpID8gZSA6IHtcbiAgICAgICAgbmV4dDogZVxuICAgIH0pO1xufVxuXG4vKipcbiAqIExvY2FsbHkgd3JpdGVzIGBtdXRhdGlvbnNgIG9uIHRoZSBhc3luYyBxdWV1ZS5cbiAqIEBpbnRlcm5hbFxuICovIGZ1bmN0aW9uIF9sKHQsIGUpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24odCwgZSkge1xuICAgICAgICBjb25zdCBuID0gbmV3IGo7XG4gICAgICAgIHJldHVybiB0LmFzeW5jUXVldWUuZW5xdWV1ZUFuZEZvcmdldCgoYXN5bmMgKCkgPT4gdGEoYXdhaXQgamEodCksIGUsIG4pKSksIG4ucHJvbWlzZTtcbiAgICB9KERjKHQpLCBlKTtcbn1cblxuLyoqXG4gKiBDb252ZXJ0cyBhIHtAbGluayBWaWV3U25hcHNob3R9IHRoYXQgY29udGFpbnMgdGhlIHNpbmdsZSBkb2N1bWVudCBzcGVjaWZpZWQgYnkgYHJlZmBcbiAqIHRvIGEge0BsaW5rIERvY3VtZW50U25hcHNob3R9LlxuICovIGZ1bmN0aW9uIHdsKHQsIGUsIG4pIHtcbiAgICBjb25zdCBzID0gbi5kb2NzLmdldChlLl9rZXkpLCBpID0gbmV3IG5sKHQpO1xuICAgIHJldHVybiBuZXcgUmgodCwgaSwgZS5fa2V5LCBzLCBuZXcgQWgobi5oYXNQZW5kaW5nV3JpdGVzLCBuLmZyb21DYWNoZSksIGUuY29udmVydGVyKTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogQSByZWZlcmVuY2UgdG8gYSB0cmFuc2FjdGlvbi5cbiAqXG4gKiBUaGUgYFRyYW5zYWN0aW9uYCBvYmplY3QgcGFzc2VkIHRvIGEgdHJhbnNhY3Rpb24ncyBgdXBkYXRlRnVuY3Rpb25gIHByb3ZpZGVzXG4gKiB0aGUgbWV0aG9kcyB0byByZWFkIGFuZCB3cml0ZSBkYXRhIHdpdGhpbiB0aGUgdHJhbnNhY3Rpb24gY29udGV4dC4gU2VlXG4gKiB7QGxpbmsgcnVuVHJhbnNhY3Rpb259LlxuICovIGNsYXNzIG1sIGV4dGVuZHMgY2xhc3Mge1xuICAgIC8qKiBAaGlkZWNvbnN0cnVjdG9yICovXG4gICAgY29uc3RydWN0b3IodCwgZSkge1xuICAgICAgICB0aGlzLl9maXJlc3RvcmUgPSB0LCB0aGlzLl90cmFuc2FjdGlvbiA9IGUsIHRoaXMuX2RhdGFSZWFkZXIgPSB0aCh0KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmVhZHMgdGhlIGRvY3VtZW50IHJlZmVyZW5jZWQgYnkgdGhlIHByb3ZpZGVkIHtAbGluayBEb2N1bWVudFJlZmVyZW5jZX0uXG4gICAgICpcbiAgICAgKiBAcGFyYW0gZG9jdW1lbnRSZWYgLSBBIHJlZmVyZW5jZSB0byB0aGUgZG9jdW1lbnQgdG8gYmUgcmVhZC5cbiAgICAgKiBAcmV0dXJucyBBIGBEb2N1bWVudFNuYXBzaG90YCB3aXRoIHRoZSByZWFkIGRhdGEuXG4gICAgICovICAgIGdldCh0KSB7XG4gICAgICAgIGNvbnN0IGUgPSB0bCh0LCB0aGlzLl9maXJlc3RvcmUpLCBuID0gbmV3IFhoKHRoaXMuX2ZpcmVzdG9yZSk7XG4gICAgICAgIHJldHVybiB0aGlzLl90cmFuc2FjdGlvbi5sb29rdXAoWyBlLl9rZXkgXSkudGhlbigodCA9PiB7XG4gICAgICAgICAgICBpZiAoIXQgfHwgMSAhPT0gdC5sZW5ndGgpIHJldHVybiBMKCk7XG4gICAgICAgICAgICBjb25zdCBzID0gdFswXTtcbiAgICAgICAgICAgIGlmIChzLmlzRm91bmREb2N1bWVudCgpKSByZXR1cm4gbmV3IEloKHRoaXMuX2ZpcmVzdG9yZSwgbiwgcy5rZXksIHMsIGUuY29udmVydGVyKTtcbiAgICAgICAgICAgIGlmIChzLmlzTm9Eb2N1bWVudCgpKSByZXR1cm4gbmV3IEloKHRoaXMuX2ZpcmVzdG9yZSwgbiwgZS5fa2V5LCBudWxsLCBlLmNvbnZlcnRlcik7XG4gICAgICAgICAgICB0aHJvdyBMKCk7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgc2V0KHQsIGUsIG4pIHtcbiAgICAgICAgY29uc3QgcyA9IHRsKHQsIHRoaXMuX2ZpcmVzdG9yZSksIGkgPSBZaChzLmNvbnZlcnRlciwgZSwgbiksIHIgPSBlaCh0aGlzLl9kYXRhUmVhZGVyLCBcIlRyYW5zYWN0aW9uLnNldFwiLCBzLl9rZXksIGksIG51bGwgIT09IHMuY29udmVydGVyLCBuKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3RyYW5zYWN0aW9uLnNldChzLl9rZXksIHIpLCB0aGlzO1xuICAgIH1cbiAgICB1cGRhdGUodCwgZSwgbiwgLi4ucykge1xuICAgICAgICBjb25zdCBpID0gdGwodCwgdGhpcy5fZmlyZXN0b3JlKTtcbiAgICAgICAgLy8gRm9yIENvbXBhdCB0eXBlcywgd2UgaGF2ZSB0byBcImV4dHJhY3RcIiB0aGUgdW5kZXJseWluZyB0eXBlcyBiZWZvcmVcbiAgICAgICAgLy8gcGVyZm9ybWluZyB2YWxpZGF0aW9uLlxuICAgICAgICAgICAgICAgIGxldCByO1xuICAgICAgICByZXR1cm4gciA9IFwic3RyaW5nXCIgPT0gdHlwZW9mIChlID0gcChlKSkgfHwgZSBpbnN0YW5jZW9mIEtjID8gY2godGhpcy5fZGF0YVJlYWRlciwgXCJUcmFuc2FjdGlvbi51cGRhdGVcIiwgaS5fa2V5LCBlLCBuLCBzKSA6IGFoKHRoaXMuX2RhdGFSZWFkZXIsIFwiVHJhbnNhY3Rpb24udXBkYXRlXCIsIGkuX2tleSwgZSksIFxuICAgICAgICB0aGlzLl90cmFuc2FjdGlvbi51cGRhdGUoaS5fa2V5LCByKSwgdGhpcztcbiAgICB9XG4gICAgLyoqXG4gICAgICogRGVsZXRlcyB0aGUgZG9jdW1lbnQgcmVmZXJyZWQgdG8gYnkgdGhlIHByb3ZpZGVkIHtAbGluayBEb2N1bWVudFJlZmVyZW5jZX0uXG4gICAgICpcbiAgICAgKiBAcGFyYW0gZG9jdW1lbnRSZWYgLSBBIHJlZmVyZW5jZSB0byB0aGUgZG9jdW1lbnQgdG8gYmUgZGVsZXRlZC5cbiAgICAgKiBAcmV0dXJucyBUaGlzIGBUcmFuc2FjdGlvbmAgaW5zdGFuY2UuIFVzZWQgZm9yIGNoYWluaW5nIG1ldGhvZCBjYWxscy5cbiAgICAgKi8gICAgZGVsZXRlKHQpIHtcbiAgICAgICAgY29uc3QgZSA9IHRsKHQsIHRoaXMuX2ZpcmVzdG9yZSk7XG4gICAgICAgIHJldHVybiB0aGlzLl90cmFuc2FjdGlvbi5kZWxldGUoZS5fa2V5KSwgdGhpcztcbiAgICB9XG59IHtcbiAgICAvLyBUaGlzIGNsYXNzIGltcGxlbWVudHMgdGhlIHNhbWUgbG9naWMgYXMgdGhlIFRyYW5zYWN0aW9uIEFQSSBpbiB0aGUgTGl0ZSBTREtcbiAgICAvLyBidXQgaXMgc3ViY2xhc3NlZCBpbiBvcmRlciB0byByZXR1cm4gaXRzIG93biBEb2N1bWVudFNuYXBzaG90IHR5cGVzLlxuICAgIC8qKiBAaGlkZWNvbnN0cnVjdG9yICovXG4gICAgY29uc3RydWN0b3IodCwgZSkge1xuICAgICAgICBzdXBlcih0LCBlKSwgdGhpcy5fZmlyZXN0b3JlID0gdDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmVhZHMgdGhlIGRvY3VtZW50IHJlZmVyZW5jZWQgYnkgdGhlIHByb3ZpZGVkIHtAbGluayBEb2N1bWVudFJlZmVyZW5jZX0uXG4gICAgICpcbiAgICAgKiBAcGFyYW0gZG9jdW1lbnRSZWYgLSBBIHJlZmVyZW5jZSB0byB0aGUgZG9jdW1lbnQgdG8gYmUgcmVhZC5cbiAgICAgKiBAcmV0dXJucyBBIGBEb2N1bWVudFNuYXBzaG90YCB3aXRoIHRoZSByZWFkIGRhdGEuXG4gICAgICovICAgIGdldCh0KSB7XG4gICAgICAgIGNvbnN0IGUgPSB0bCh0LCB0aGlzLl9maXJlc3RvcmUpLCBuID0gbmV3IG5sKHRoaXMuX2ZpcmVzdG9yZSk7XG4gICAgICAgIHJldHVybiBzdXBlci5nZXQodCkudGhlbigodCA9PiBuZXcgUmgodGhpcy5fZmlyZXN0b3JlLCBuLCBlLl9rZXksIHQuX2RvY3VtZW50LCBuZXcgQWgoXG4gICAgICAgIC8qIGhhc1BlbmRpbmdXcml0ZXM9ICovICExLCBcbiAgICAgICAgLyogZnJvbUNhY2hlPSAqLyAhMSksIGUuY29udmVydGVyKSkpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBFeGVjdXRlcyB0aGUgZ2l2ZW4gYHVwZGF0ZUZ1bmN0aW9uYCBhbmQgdGhlbiBhdHRlbXB0cyB0byBjb21taXQgdGhlIGNoYW5nZXNcbiAqIGFwcGxpZWQgd2l0aGluIHRoZSB0cmFuc2FjdGlvbi4gSWYgYW55IGRvY3VtZW50IHJlYWQgd2l0aGluIHRoZSB0cmFuc2FjdGlvblxuICogaGFzIGNoYW5nZWQsIENsb3VkIEZpcmVzdG9yZSByZXRyaWVzIHRoZSBgdXBkYXRlRnVuY3Rpb25gLiBJZiBpdCBmYWlscyB0b1xuICogY29tbWl0IGFmdGVyIDUgYXR0ZW1wdHMsIHRoZSB0cmFuc2FjdGlvbiBmYWlscy5cbiAqXG4gKiBUaGUgbWF4aW11bSBudW1iZXIgb2Ygd3JpdGVzIGFsbG93ZWQgaW4gYSBzaW5nbGUgdHJhbnNhY3Rpb24gaXMgNTAwLlxuICpcbiAqIEBwYXJhbSBmaXJlc3RvcmUgLSBBIHJlZmVyZW5jZSB0byB0aGUgRmlyZXN0b3JlIGRhdGFiYXNlIHRvIHJ1biB0aGlzXG4gKiB0cmFuc2FjdGlvbiBhZ2FpbnN0LlxuICogQHBhcmFtIHVwZGF0ZUZ1bmN0aW9uIC0gVGhlIGZ1bmN0aW9uIHRvIGV4ZWN1dGUgd2l0aGluIHRoZSB0cmFuc2FjdGlvblxuICogY29udGV4dC5cbiAqIEByZXR1cm5zIElmIHRoZSB0cmFuc2FjdGlvbiBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5IG9yIHdhcyBleHBsaWNpdGx5IGFib3J0ZWRcbiAqICh0aGUgYHVwZGF0ZUZ1bmN0aW9uYCByZXR1cm5lZCBhIGZhaWxlZCBwcm9taXNlKSwgdGhlIHByb21pc2UgcmV0dXJuZWQgYnkgdGhlXG4gKiBgdXBkYXRlRnVuY3Rpb24gYGlzIHJldHVybmVkIGhlcmUuIE90aGVyd2lzZSwgaWYgdGhlIHRyYW5zYWN0aW9uIGZhaWxlZCwgYVxuICogcmVqZWN0ZWQgcHJvbWlzZSB3aXRoIHRoZSBjb3JyZXNwb25kaW5nIGZhaWx1cmUgZXJyb3IgaXMgcmV0dXJuZWQuXG4gKi8gZnVuY3Rpb24gZ2wodCwgZSwgbikge1xuICAgIHQgPSBoYyh0LCBWYyk7XG4gICAgY29uc3QgcyA9IE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgSGgpLCBuKTtcbiAgICAhZnVuY3Rpb24odCkge1xuICAgICAgICBpZiAodC5tYXhBdHRlbXB0cyA8IDEpIHRocm93IG5ldyBRKEcuSU5WQUxJRF9BUkdVTUVOVCwgXCJNYXggYXR0ZW1wdHMgbXVzdCBiZSBhdCBsZWFzdCAxXCIpO1xuICAgIH0ocyk7XG4gICAgcmV0dXJuIGVjKERjKHQpLCAobiA9PiBlKG5ldyBtbCh0LCBuKSkpLCBzKTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogUmV0dXJucyBhIHNlbnRpbmVsIGZvciB1c2Ugd2l0aCB7QGxpbmsgQGZpcmViYXNlL2ZpcmVzdG9yZS9saXRlIyh1cGRhdGVEb2M6MSl9IG9yXG4gKiB7QGxpbmsgQGZpcmViYXNlL2ZpcmVzdG9yZS9saXRlIyhzZXREb2M6MSl9IHdpdGggYHttZXJnZTogdHJ1ZX1gIHRvIG1hcmsgYSBmaWVsZCBmb3IgZGVsZXRpb24uXG4gKi8gZnVuY3Rpb24geWwoKSB7XG4gICAgcmV0dXJuIG5ldyBuaChcImRlbGV0ZUZpZWxkXCIpO1xufVxuXG4vKipcbiAqIFJldHVybnMgYSBzZW50aW5lbCB1c2VkIHdpdGgge0BsaW5rIEBmaXJlYmFzZS9maXJlc3RvcmUvbGl0ZSMoc2V0RG9jOjEpfSBvciB7QGxpbmsgQGZpcmViYXNlL2ZpcmVzdG9yZS9saXRlIyh1cGRhdGVEb2M6MSl9IHRvXG4gKiBpbmNsdWRlIGEgc2VydmVyLWdlbmVyYXRlZCB0aW1lc3RhbXAgaW4gdGhlIHdyaXR0ZW4gZGF0YS5cbiAqLyBmdW5jdGlvbiBwbCgpIHtcbiAgICByZXR1cm4gbmV3IGloKFwic2VydmVyVGltZXN0YW1wXCIpO1xufVxuXG4vKipcbiAqIFJldHVybnMgYSBzcGVjaWFsIHZhbHVlIHRoYXQgY2FuIGJlIHVzZWQgd2l0aCB7QGxpbmsgQGZpcmViYXNlL2ZpcmVzdG9yZS9saXRlIyhzZXREb2M6MSl9IG9yIHtAbGlua1xuICogQGZpcmViYXNlL2ZpcmVzdG9yZS9saXRlIyh1cGRhdGVEb2M6MSl9IHRoYXQgdGVsbHMgdGhlIHNlcnZlciB0byB1bmlvbiB0aGUgZ2l2ZW4gZWxlbWVudHMgd2l0aCBhbnkgYXJyYXlcbiAqIHZhbHVlIHRoYXQgYWxyZWFkeSBleGlzdHMgb24gdGhlIHNlcnZlci4gRWFjaCBzcGVjaWZpZWQgZWxlbWVudCB0aGF0IGRvZXNuJ3RcbiAqIGFscmVhZHkgZXhpc3QgaW4gdGhlIGFycmF5IHdpbGwgYmUgYWRkZWQgdG8gdGhlIGVuZC4gSWYgdGhlIGZpZWxkIGJlaW5nXG4gKiBtb2RpZmllZCBpcyBub3QgYWxyZWFkeSBhbiBhcnJheSBpdCB3aWxsIGJlIG92ZXJ3cml0dGVuIHdpdGggYW4gYXJyYXlcbiAqIGNvbnRhaW5pbmcgZXhhY3RseSB0aGUgc3BlY2lmaWVkIGVsZW1lbnRzLlxuICpcbiAqIEBwYXJhbSBlbGVtZW50cyAtIFRoZSBlbGVtZW50cyB0byB1bmlvbiBpbnRvIHRoZSBhcnJheS5cbiAqIEByZXR1cm5zIFRoZSBgRmllbGRWYWx1ZWAgc2VudGluZWwgZm9yIHVzZSBpbiBhIGNhbGwgdG8gYHNldERvYygpYCBvclxuICogYHVwZGF0ZURvYygpYC5cbiAqLyBmdW5jdGlvbiBJbCguLi50KSB7XG4gICAgLy8gTk9URTogV2UgZG9uJ3QgYWN0dWFsbHkgcGFyc2UgdGhlIGRhdGEgdW50aWwgaXQncyB1c2VkIGluIHNldCgpIG9yXG4gICAgLy8gdXBkYXRlKCkgc2luY2Ugd2UnZCBuZWVkIHRoZSBGaXJlc3RvcmUgaW5zdGFuY2UgdG8gZG8gdGhpcy5cbiAgICByZXR1cm4gbmV3IHJoKFwiYXJyYXlVbmlvblwiLCB0KTtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIGEgc3BlY2lhbCB2YWx1ZSB0aGF0IGNhbiBiZSB1c2VkIHdpdGgge0BsaW5rIChzZXREb2M6MSl9IG9yIHtAbGlua1xuICogdXBkYXRlRG9jOjF9IHRoYXQgdGVsbHMgdGhlIHNlcnZlciB0byByZW1vdmUgdGhlIGdpdmVuIGVsZW1lbnRzIGZyb20gYW55XG4gKiBhcnJheSB2YWx1ZSB0aGF0IGFscmVhZHkgZXhpc3RzIG9uIHRoZSBzZXJ2ZXIuIEFsbCBpbnN0YW5jZXMgb2YgZWFjaCBlbGVtZW50XG4gKiBzcGVjaWZpZWQgd2lsbCBiZSByZW1vdmVkIGZyb20gdGhlIGFycmF5LiBJZiB0aGUgZmllbGQgYmVpbmcgbW9kaWZpZWQgaXMgbm90XG4gKiBhbHJlYWR5IGFuIGFycmF5IGl0IHdpbGwgYmUgb3ZlcndyaXR0ZW4gd2l0aCBhbiBlbXB0eSBhcnJheS5cbiAqXG4gKiBAcGFyYW0gZWxlbWVudHMgLSBUaGUgZWxlbWVudHMgdG8gcmVtb3ZlIGZyb20gdGhlIGFycmF5LlxuICogQHJldHVybnMgVGhlIGBGaWVsZFZhbHVlYCBzZW50aW5lbCBmb3IgdXNlIGluIGEgY2FsbCB0byBgc2V0RG9jKClgIG9yXG4gKiBgdXBkYXRlRG9jKClgXG4gKi8gZnVuY3Rpb24gVGwoLi4udCkge1xuICAgIC8vIE5PVEU6IFdlIGRvbid0IGFjdHVhbGx5IHBhcnNlIHRoZSBkYXRhIHVudGlsIGl0J3MgdXNlZCBpbiBzZXQoKSBvclxuICAgIC8vIHVwZGF0ZSgpIHNpbmNlIHdlJ2QgbmVlZCB0aGUgRmlyZXN0b3JlIGluc3RhbmNlIHRvIGRvIHRoaXMuXG4gICAgcmV0dXJuIG5ldyBvaChcImFycmF5UmVtb3ZlXCIsIHQpO1xufVxuXG4vKipcbiAqIFJldHVybnMgYSBzcGVjaWFsIHZhbHVlIHRoYXQgY2FuIGJlIHVzZWQgd2l0aCB7QGxpbmsgQGZpcmViYXNlL2ZpcmVzdG9yZS9saXRlIyhzZXREb2M6MSl9IG9yIHtAbGlua1xuICogQGZpcmViYXNlL2ZpcmVzdG9yZS9saXRlIyh1cGRhdGVEb2M6MSl9IHRoYXQgdGVsbHMgdGhlIHNlcnZlciB0byBpbmNyZW1lbnQgdGhlIGZpZWxkJ3MgY3VycmVudCB2YWx1ZSBieVxuICogdGhlIGdpdmVuIHZhbHVlLlxuICpcbiAqIElmIGVpdGhlciB0aGUgb3BlcmFuZCBvciB0aGUgY3VycmVudCBmaWVsZCB2YWx1ZSB1c2VzIGZsb2F0aW5nIHBvaW50XG4gKiBwcmVjaXNpb24sIGFsbCBhcml0aG1ldGljIGZvbGxvd3MgSUVFRSA3NTQgc2VtYW50aWNzLiBJZiBib3RoIHZhbHVlcyBhcmVcbiAqIGludGVnZXJzLCB2YWx1ZXMgb3V0c2lkZSBvZiBKYXZhU2NyaXB0J3Mgc2FmZSBudW1iZXIgcmFuZ2VcbiAqIChgTnVtYmVyLk1JTl9TQUZFX0lOVEVHRVJgIHRvIGBOdW1iZXIuTUFYX1NBRkVfSU5URUdFUmApIGFyZSBhbHNvIHN1YmplY3QgdG9cbiAqIHByZWNpc2lvbiBsb3NzLiBGdXJ0aGVybW9yZSwgb25jZSBwcm9jZXNzZWQgYnkgdGhlIEZpcmVzdG9yZSBiYWNrZW5kLCBhbGxcbiAqIGludGVnZXIgb3BlcmF0aW9ucyBhcmUgY2FwcGVkIGJldHdlZW4gLTJeNjMgYW5kIDJeNjMtMS5cbiAqXG4gKiBJZiB0aGUgY3VycmVudCBmaWVsZCB2YWx1ZSBpcyBub3Qgb2YgdHlwZSBgbnVtYmVyYCwgb3IgaWYgdGhlIGZpZWxkIGRvZXMgbm90XG4gKiB5ZXQgZXhpc3QsIHRoZSB0cmFuc2Zvcm1hdGlvbiBzZXRzIHRoZSBmaWVsZCB0byB0aGUgZ2l2ZW4gdmFsdWUuXG4gKlxuICogQHBhcmFtIG4gLSBUaGUgdmFsdWUgdG8gaW5jcmVtZW50IGJ5LlxuICogQHJldHVybnMgVGhlIGBGaWVsZFZhbHVlYCBzZW50aW5lbCBmb3IgdXNlIGluIGEgY2FsbCB0byBgc2V0RG9jKClgIG9yXG4gKiBgdXBkYXRlRG9jKClgXG4gKi8gZnVuY3Rpb24gRWwodCkge1xuICAgIHJldHVybiBuZXcgdWgoXCJpbmNyZW1lbnRcIiwgdCk7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIENyZWF0ZXMgYSB3cml0ZSBiYXRjaCwgdXNlZCBmb3IgcGVyZm9ybWluZyBtdWx0aXBsZSB3cml0ZXMgYXMgYSBzaW5nbGVcbiAqIGF0b21pYyBvcGVyYXRpb24uIFRoZSBtYXhpbXVtIG51bWJlciBvZiB3cml0ZXMgYWxsb3dlZCBpbiBhIHNpbmdsZSB7QGxpbmsgV3JpdGVCYXRjaH1cbiAqIGlzIDUwMC5cbiAqXG4gKiBVbmxpa2UgdHJhbnNhY3Rpb25zLCB3cml0ZSBiYXRjaGVzIGFyZSBwZXJzaXN0ZWQgb2ZmbGluZSBhbmQgdGhlcmVmb3JlIGFyZVxuICogcHJlZmVyYWJsZSB3aGVuIHlvdSBkb24ndCBuZWVkIHRvIGNvbmRpdGlvbiB5b3VyIHdyaXRlcyBvbiByZWFkIGRhdGEuXG4gKlxuICogQHJldHVybnMgQSB7QGxpbmsgV3JpdGVCYXRjaH0gdGhhdCBjYW4gYmUgdXNlZCB0byBhdG9taWNhbGx5IGV4ZWN1dGUgbXVsdGlwbGVcbiAqIHdyaXRlcy5cbiAqLyBmdW5jdGlvbiBBbCh0KSB7XG4gICAgcmV0dXJuIERjKHQgPSBoYyh0LCBWYykpLCBuZXcgWmgodCwgKGUgPT4gX2wodCwgZSkpKTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjEgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi8gZnVuY3Rpb24gUmwodCwgZSkge1xuICAgIERjKHQgPSBoYyh0LCBWYykpO1xuICAgIGNvbnN0IG4gPSBcInN0cmluZ1wiID09IHR5cGVvZiBlID8gZnVuY3Rpb24odCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UodCk7XG4gICAgICAgIH0gY2F0Y2ggKHQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBRKEcuSU5WQUxJRF9BUkdVTUVOVCwgXCJGYWlsZWQgdG8gcGFyc2UgSlNPTjpcIiArIHQubWVzc2FnZSk7XG4gICAgICAgIH1cbiAgICB9KGUpIDogZSwgcyA9IFtdO1xuICAgIC8vIFBPUlRJTkcgTk9URTogV2UgZG9uJ3QgcmV0dXJuIGFuIGVycm9yIGlmIHRoZSB1c2VyIGhhcyBub3QgZW5hYmxlZFxuICAgIC8vIHBlcnNpc3RlbmNlIHNpbmNlIGBlbmFibGVJbmRleGVkZGJQZXJzaXN0ZW5jZSgpYCBjYW4gZmFpbCBvbiB0aGUgV2ViLlxuICAgIGlmIChBcnJheS5pc0FycmF5KG4uaW5kZXhlcykpIGZvciAoY29uc3QgdCBvZiBuLmluZGV4ZXMpIHtcbiAgICAgICAgY29uc3QgZSA9IGJsKHQsIFwiY29sbGVjdGlvbkdyb3VwXCIpLCBuID0gW107XG4gICAgICAgIGlmIChBcnJheS5pc0FycmF5KHQuZmllbGRzKSkgZm9yIChjb25zdCBlIG9mIHQuZmllbGRzKSB7XG4gICAgICAgICAgICBjb25zdCB0ID0gZ2goXCJzZXRJbmRleENvbmZpZ3VyYXRpb25cIiwgYmwoZSwgXCJmaWVsZFBhdGhcIikpO1xuICAgICAgICAgICAgXCJDT05UQUlOU1wiID09PSBlLmFycmF5Q29uZmlnID8gbi5wdXNoKG5ldyBvZSh0LCAyIC8qIENPTlRBSU5TICovKSkgOiBcIkFTQ0VORElOR1wiID09PSBlLm9yZGVyID8gbi5wdXNoKG5ldyBvZSh0LCAwIC8qIEFTQ0VORElORyAqLykpIDogXCJERVNDRU5ESU5HXCIgPT09IGUub3JkZXIgJiYgbi5wdXNoKG5ldyBvZSh0LCAxIC8qIERFU0NFTkRJTkcgKi8pKTtcbiAgICAgICAgfVxuICAgICAgICBzLnB1c2gobmV3IHNlKHNlLlVOS05PV05fSUQsIGUsIG4sIHVlLmVtcHR5KCkpKTtcbiAgICB9XG4gICAgLy8gVE9ETyhpbmRleGluZyk6IENvbmZpZ3VyZSBpbmRleGVzXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcbn1cblxuZnVuY3Rpb24gYmwodCwgZSkge1xuICAgIGlmIChcInN0cmluZ1wiICE9IHR5cGVvZiB0W2VdKSB0aHJvdyBuZXcgUShHLklOVkFMSURfQVJHVU1FTlQsIFwiTWlzc2luZyBzdHJpbmcgdmFsdWUgZm9yOiBcIiArIGUpO1xuICAgIHJldHVybiB0W2VdO1xufVxuXG4vKipcbiAqIENsb3VkIEZpcmVzdG9yZVxuICpcbiAqIEBwYWNrYWdlRG9jdW1lbnRhdGlvblxuICovICFmdW5jdGlvbih0LCBlID0gITApIHtcbiAgICAhZnVuY3Rpb24odCkge1xuICAgICAgICB4ID0gdDtcbiAgICB9KGkpLCBuKG5ldyByKFwiZmlyZXN0b3JlXCIsICgodCwge29wdGlvbnM6IG59KSA9PiB7XG4gICAgICAgIGNvbnN0IHMgPSB0LmdldFByb3ZpZGVyKFwiYXBwXCIpLmdldEltbWVkaWF0ZSgpLCBpID0gbmV3IFZjKHMsIG5ldyBKKHQuZ2V0UHJvdmlkZXIoXCJhdXRoLWludGVybmFsXCIpKSwgbmV3IHR0KHQuZ2V0UHJvdmlkZXIoXCJhcHAtY2hlY2staW50ZXJuYWxcIikpKTtcbiAgICAgICAgcmV0dXJuIG4gPSBPYmplY3QuYXNzaWduKHtcbiAgICAgICAgICAgIHVzZUZldGNoU3RyZWFtczogZVxuICAgICAgICB9LCBuKSwgaS5fc2V0U2V0dGluZ3MobiksIGk7XG4gICAgfSksIFwiUFVCTElDXCIpKSwgcyhELCBcIjMuNC45XCIsIHQpLCBcbiAgICAvLyBCVUlMRF9UQVJHRVQgd2lsbCBiZSByZXBsYWNlZCBieSB2YWx1ZXMgbGlrZSBlc201LCBlc20yMDE3LCBjanM1LCBldGMgZHVyaW5nIHRoZSBjb21waWxhdGlvblxuICAgIHMoRCwgXCIzLjQuOVwiLCBcIl9fQlVJTERfVEFSR0VUX19cIik7XG59KCk7XG5cbmV4cG9ydCB7IEpoIGFzIEFic3RyYWN0VXNlckRhdGFXcml0ZXIsIFFjIGFzIEJ5dGVzLCBQYyBhcyBDQUNIRV9TSVpFX1VOTElNSVRFRCwgZ2MgYXMgQ29sbGVjdGlvblJlZmVyZW5jZSwgd2MgYXMgRG9jdW1lbnRSZWZlcmVuY2UsIFJoIGFzIERvY3VtZW50U25hcHNob3QsIEtjIGFzIEZpZWxkUGF0aCwgamMgYXMgRmllbGRWYWx1ZSwgVmMgYXMgRmlyZXN0b3JlLCBRIGFzIEZpcmVzdG9yZUVycm9yLCBXYyBhcyBHZW9Qb2ludCwgYmMgYXMgTG9hZEJ1bmRsZVRhc2ssIG1jIGFzIFF1ZXJ5LCBEaCBhcyBRdWVyeUNvbnN0cmFpbnQsIGJoIGFzIFF1ZXJ5RG9jdW1lbnRTbmFwc2hvdCwgUGggYXMgUXVlcnlTbmFwc2hvdCwgQWggYXMgU25hcHNob3RNZXRhZGF0YSwgYXQgYXMgVGltZXN0YW1wLCBtbCBhcyBUcmFuc2FjdGlvbiwgWmggYXMgV3JpdGVCYXRjaCwgdnQgYXMgX0RhdGFiYXNlSWQsIHh0IGFzIF9Eb2N1bWVudEtleSwgZXQgYXMgX0VtcHR5QXBwQ2hlY2tUb2tlblByb3ZpZGVyLCB6IGFzIF9FbXB0eUF1dGhDcmVkZW50aWFsc1Byb3ZpZGVyLCBtdCBhcyBfRmllbGRQYXRoLCBoYyBhcyBfY2FzdCwgcSBhcyBfZGVidWdBc3NlcnQsIHl0IGFzIF9pc0Jhc2U2NEF2YWlsYWJsZSwgJCBhcyBfbG9nV2FybiwgUmwgYXMgX3NldEluZGV4Q29uZmlndXJhdGlvbiwgb2MgYXMgX3ZhbGlkYXRlSXNOb3RVc2VkVG9nZXRoZXIsIGxsIGFzIGFkZERvYywgVGwgYXMgYXJyYXlSZW1vdmUsIElsIGFzIGFycmF5VW5pb24sIE1jIGFzIGNsZWFySW5kZXhlZERiUGVyc2lzdGVuY2UsIHljIGFzIGNvbGxlY3Rpb24sIHBjIGFzIGNvbGxlY3Rpb25Hcm91cCwgX2MgYXMgY29ubmVjdEZpcmVzdG9yZUVtdWxhdG9yLCBobCBhcyBkZWxldGVEb2MsIHlsIGFzIGRlbGV0ZUZpZWxkLCAkYyBhcyBkaXNhYmxlTmV0d29yaywgSWMgYXMgZG9jLCBHYyBhcyBkb2N1bWVudElkLCB4YyBhcyBlbmFibGVJbmRleGVkRGJQZXJzaXN0ZW5jZSwgTmMgYXMgZW5hYmxlTXVsdGlUYWJJbmRleGVkRGJQZXJzaXN0ZW5jZSwgRmMgYXMgZW5hYmxlTmV0d29yaywgR2ggYXMgZW5kQXQsIEtoIGFzIGVuZEJlZm9yZSwgRGMgYXMgZW5zdXJlRmlyZXN0b3JlQ29uZmlndXJlZCwgX2wgYXMgZXhlY3V0ZVdyaXRlLCBlbCBhcyBnZXREb2MsIHNsIGFzIGdldERvY0Zyb21DYWNoZSwgaWwgYXMgZ2V0RG9jRnJvbVNlcnZlciwgcmwgYXMgZ2V0RG9jcywgb2wgYXMgZ2V0RG9jc0Zyb21DYWNoZSwgdWwgYXMgZ2V0RG9jc0Zyb21TZXJ2ZXIsIFNjIGFzIGdldEZpcmVzdG9yZSwgRWwgYXMgaW5jcmVtZW50LCB2YyBhcyBpbml0aWFsaXplRmlyZXN0b3JlLCBGaCBhcyBsaW1pdCwgJGggYXMgbGltaXRUb0xhc3QsIExjIGFzIGxvYWRCdW5kbGUsIFVjIGFzIG5hbWVkUXVlcnksIGZsIGFzIG9uU25hcHNob3QsIGRsIGFzIG9uU25hcHNob3RzSW5TeW5jLCBNaCBhcyBvcmRlckJ5LCBDaCBhcyBxdWVyeSwgRWMgYXMgcXVlcnlFcXVhbCwgVGMgYXMgcmVmRXF1YWwsIGdsIGFzIHJ1blRyYW5zYWN0aW9uLCBwbCBhcyBzZXJ2ZXJUaW1lc3RhbXAsIGFsIGFzIHNldERvYywgTSBhcyBzZXRMb2dMZXZlbCwgdmggYXMgc25hcHNob3RFcXVhbCwgVWggYXMgc3RhcnRBZnRlciwgTGggYXMgc3RhcnRBdCwgQmMgYXMgdGVybWluYXRlLCBjbCBhcyB1cGRhdGVEb2MsIE9jIGFzIHdhaXRGb3JQZW5kaW5nV3JpdGVzLCBOaCBhcyB3aGVyZSwgQWwgYXMgd3JpdGVCYXRjaCB9O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXguZXNtMjAxNy5qcy5tYXBcbiIsICIvLyBJbXBvcnQgdGhlIGZ1bmN0aW9ucyB5b3UgbmVlZCBmcm9tIHRoZSBTREtzIHlvdSBuZWVkXHJcbmltcG9ydCB7IGluaXRpYWxpemVBcHAgfSBmcm9tIFwiZmlyZWJhc2UvYXBwXCI7XHJcbmltcG9ydCB7XHJcbiAgICBnZXRGaXJlc3RvcmUsIGNvbGxlY3Rpb24sIGdldERvY3NcclxufSBmcm9tIFwiZmlyZWJhc2UvZmlyZXN0b3JlXCJcclxuLy8gVE9ETzogQWRkIFNES3MgZm9yIEZpcmViYXNlIHByb2R1Y3RzIHRoYXQgeW91IHdhbnQgdG8gdXNlXHJcbi8vIGh0dHBzOi8vZmlyZWJhc2UuZ29vZ2xlLmNvbS9kb2NzL3dlYi9zZXR1cCNhdmFpbGFibGUtbGlicmFyaWVzXHJcblxyXG4vLyBZb3VyIHdlYiBhcHAncyBGaXJlYmFzZSBjb25maWd1cmF0aW9uXHJcbmNvbnN0IGZpcmViYXNlQ29uZmlnID0ge1xyXG4gIGFwaUtleTogXCJBSXphU3lDYk1hbU1JU1ZpTXBOdHc0SlhRR3FuLUo1VnhVTXlNS3NcIixcclxuICBhdXRoRG9tYWluOiBcImZpcnN0cGFnZS1mOWRkZS5maXJlYmFzZWFwcC5jb21cIixcclxuICBwcm9qZWN0SWQ6IFwiZmlyc3RwYWdlLWY5ZGRlXCIsXHJcbiAgc3RvcmFnZUJ1Y2tldDogXCJmaXJzdHBhZ2UtZjlkZGUuYXBwc3BvdC5jb21cIixcclxuICBtZXNzYWdpbmdTZW5kZXJJZDogXCIxMjAzNDc2OTczMzZcIixcclxuICBhcHBJZDogXCIxOjEyMDM0NzY5NzMzNjp3ZWI6ZTk2ZTNkNDUxZWEyNGUzNGI2ZDQ0ZFwiXHJcbn07XHJcblxyXG4vLyBJbml0aWFsaXplIEZpcmViYXNlXHJcbmNvbnN0IGFwcCA9IGluaXRpYWxpemVBcHAoZmlyZWJhc2VDb25maWcpO1xyXG4vLyBjb25uZWN0IHRvIHRoZSBkYXRhYmFzZVxyXG5jb25zdCBkYiA9IGdldEZpcmVzdG9yZSgpO1xyXG4vLyByZWZlcmVuY2UgdG8gdGhlIG1haW4gY29sbGVjdGlvblxyXG5jb25zdCBjb2xVc2VycyA9IGNvbGxlY3Rpb24oZGIsICd1c2VycycpO1xyXG5cclxuZ2V0RG9jcyhjb2xVc2VycylcclxuLnRoZW4oc25hcHNob3QgPT4ge1xyXG4gIC8vIGNvbnNvbGUubG9nKHNuYXBzaG90LmRvY3MpXHJcbiAgbGV0IHVzZXJzID0gW11cclxuICBzbmFwc2hvdC5kb2NzLmZvckVhY2goZG9jID0+IHtcclxuICAgIHVzZXJzLnB1c2goeyAuLi5kb2MuZGF0YSgpLCBpZDogZG9jLmlkIH0pXHJcbiAgfSlcclxuICBjb25zb2xlLmxvZyh1c2VycylcclxufSlcclxuLmNhdGNoKGVyciA9PiB7XHJcbiAgY29uc29sZS5sb2coZXJyLm1lc3NhZ2UpXHJcbn0pIl0sCiAgIm1hcHBpbmdzIjogIjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxBQ0FBOztBQ0FBLEFBaUJBLE1BQU0sc0JBQW9CLFNBQVUsS0FBVztBQUU3QyxVQUFNLE1BQWdCLENBQUE7QUFDdEIsUUFBSSxLQUFJO0FBQ1IsYUFBUyxJQUFJLEdBQUcsSUFBSSxJ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
